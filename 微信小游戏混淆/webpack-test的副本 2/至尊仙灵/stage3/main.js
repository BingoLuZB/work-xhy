var egret=window.egret;var __reflect=this&&this.__reflect||function(p,c,t){p.__class__=c,t?t.push(c):t=[c],p.__types__=p.__types__?t.concat(p.__types__):t;window[c]=p.constructor};var __extends=this&&this.__extends||function __extends(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r};var BaseItemRender=function(_super){__extends(BaseItemRender,_super);function BaseItemRender(){return _super.call(this)||this}Object.defineProperty(BaseItemRender.prototype,"className",{get:function(){return this._className},set:function(v){this._className=v},enumerable:true,configurable:true});return BaseItemRender}(eui.ItemRenderer);__reflect(BaseItemRender.prototype,"BaseItemRender");var BaseClass=function(){function BaseClass(){}BaseClass.ins=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var Class=this;if(!Class._instance){var argsLen=args.length;if(argsLen==0){Class._instance=new Class}else if(argsLen==1){Class._instance=new Class(args[0])}else if(argsLen==2){Class._instance=new Class(args[0],args[1])}else if(argsLen==3){Class._instance=new Class(args[0],args[1],args[2])}else if(argsLen==4){Class._instance=new Class(args[0],args[1],args[2],args[3])}else if(argsLen==5){Class._instance=new Class(args[0],args[1],args[2],args[3],args[4])}}return Class._instance};return BaseClass}();__reflect(BaseClass.prototype,"BaseClass");var CharEnum;(function(CharEnum){CharEnum[CharEnum["NORTH"]=0]="NORTH";CharEnum[CharEnum["NORTH_EAST"]=1]="NORTH_EAST";CharEnum[CharEnum["EAST"]=2]="EAST";CharEnum[CharEnum["SOUTH_EAST"]=3]="SOUTH_EAST";CharEnum[CharEnum["SOUTH"]=4]="SOUTH";CharEnum[CharEnum["SOUTH_WEST"]=5]="SOUTH_WEST";CharEnum[CharEnum["WEST"]=6]="WEST";CharEnum[CharEnum["NORTH_WEST"]=7]="NORTH_WEST"})(CharEnum||(CharEnum={}));window["CharEnum"]=CharEnum;var CharMcOrder;(function(CharMcOrder){CharMcOrder[CharMcOrder["BODY"]=2]="BODY";CharMcOrder[CharMcOrder["WEAPON"]=3]="WEAPON";CharMcOrder[CharMcOrder["WING"]=4]="WING";CharMcOrder[CharMcOrder["FOUR"]=5]="FOUR";CharMcOrder[CharMcOrder["MEDAL"]=6]="MEDAL";CharMcOrder[CharMcOrder["HEIR"]=7]="HEIR";CharMcOrder[CharMcOrder["SOUL"]=8]="SOUL";CharMcOrder[CharMcOrder["ZHANLING"]=9]="ZHANLING";CharMcOrder[CharMcOrder["XIANYU"]=1]="XIANYU";CharMcOrder[CharMcOrder["DIZUO"]=0]="DIZUO";CharMcOrder[CharMcOrder["SPRINT"]=10]="SPRINT";CharMcOrder[CharMcOrder["FLYSWORD"]=11]="FLYSWORD";CharMcOrder[CharMcOrder["CLOUD"]=12]="CLOUD"})(CharMcOrder||(CharMcOrder={}));window["CharMcOrder"]=CharMcOrder;var EffectModel=function(){function EffectModel(){this.dir=4;this.team=Team.NotAtk}return EffectModel}();__reflect(EffectModel.prototype,"EffectModel");var GuildWarMemberHeadRender=function(_super){__extends(GuildWarMemberHeadRender,_super);function GuildWarMemberHeadRender(){var _this=_super.call(this)||this;_this.skinName="MemberHeadSkin";_this.clickEffc=new MovieClip;_this.clickEffc.x=48.5;_this.clickEffc.y=54;return _this}GuildWarMemberHeadRender.prototype.dataChanged=function(){this.haveGuildName(false);if(!isNaN(this.data)){this.currentState="war";var charSource=EntityManager.ins().getEntityBymasterhHandle(this.data);if(charSource){var info=charSource.infoModel;var guildName=info.guildName?"\n<font color='#6495ed'>"+info.guildName+"</font>":"";var str=DevildomSys.ins().isDevildomBattle&&guildName?info.name+guildName:info.getNameWithServer2();if(str.indexOf("\n")>-1){this.haveGuildName(true)}this.roleName.textFlow=(new egret.HtmlTextParser).parser(str);this.roleHead.source="yuanhead"+info.job+info.sex;if(GuildWar.ins().getModel().attHandle&&GuildWar.ins().getModel().attHandle==this.data){this.addAttEffect()}}else{this.roleName.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildWarMemberHeadRender_0"))}}else if(this.data instanceof SelectInfoData){this.currentState="panel";this.num.textFlow=(new egret.HtmlTextParser).parser(this.data.num+i18n("GuildWarMemberHeadRender_1"));this.roleName.textFlow=(new egret.HtmlTextParser).parser(this.data.data.name);this.roleHead.source="yuanhead"+this.data.data.job+this.data.data.sex}};GuildWarMemberHeadRender.prototype.addAttEffect=function(){if(!this.attEffect){this.attEffect=new MovieClip;this.attEffect.x=44;this.attEffect.y=25}this.attEffect.playFile(RES_DIR_EFF+"FightingEff",-1);this.addChild(this.attEffect)};GuildWarMemberHeadRender.prototype.removeAttEffect=function(){if(this.attEffect){this.attEffect.stop();this.attEffect.destroy();this.attEffect=null}};GuildWarMemberHeadRender.prototype.showEffect=function(){this.clickEffc.playFile(RES_DIR_EFF+"tapCircle",1);this.addChild(this.clickEffc)};GuildWarMemberHeadRender.prototype.clearEffect=function(){DisplayUtils.removeFromParent(this.clickEffc);DisplayUtils.removeFromParent(this.attEffect)};GuildWarMemberHeadRender.prototype.haveGuildName=function(b){if(b){this.namebg.height=45;this.height=110}else{this.namebg.height=26;this.height=98}};return GuildWarMemberHeadRender}(BaseItemRender);__reflect(GuildWarMemberHeadRender.prototype,"GuildWarMemberHeadRender");var BaseView=function(_super){__extends(BaseView,_super);function BaseView(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this._className="";return _this}Object.defineProperty(BaseView.prototype,"className",{get:function(){return this._className},set:function(v){this._className=v},enumerable:true,configurable:true});BaseView.prototype.observe=function(func,myfunc,callobj){if(callobj===void 0){callobj=undefined}MessageCenter.addListener(func,myfunc,this,callobj)};BaseView.prototype.removeObserve=function(){MessageCenter.ins().removeAll(this)};BaseView.prototype.addTouchEvent=function(obj,func){this.addEvent(egret.TouchEvent.TOUCH_TAP,obj,func)};BaseView.prototype.addTouchEndEvent=function(obj,func){this.addEvent(egret.TouchEvent.TOUCH_END,obj,func)};BaseView.prototype.addChangeEvent=function(obj,func){var _this=this;if(obj&&obj instanceof eui.TabBar){this.addEvent(egret.TouchEvent.CHANGE,obj,function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}SoundUtil.ins().playEffect(SoundUtil.WINDOW);func.call.apply(func,[_this].concat(param))})}else{this.addEvent(egret.TouchEvent.CHANGE,obj,func)}};BaseView.prototype.addChangingEvent=function(obj,func){this.addEvent(egret.TouchEvent.CHANGING,obj,func)};BaseView.prototype.addEvent=function(ev,obj,func){if(!obj){console.error("不存在绑定对象");return}obj.addEventListener(ev,func,this)};BaseView.prototype.removeTouchEvent=function(obj,func){if(obj)obj.removeEventListener(egret.TouchEvent.TOUCH_TAP,func,this)};BaseView.prototype.$onClose=function(){var fun=function(tar){for(var i=0;i<tar.numChildren;i++){var obj=tar.getChildAt(i);if(obj instanceof BaseView){obj.$onClose()}else if(obj instanceof egret.DisplayObjectContainer){fun(obj)}}};fun(this);this.removeObserve()};return BaseView}(eui.Component);__reflect(BaseView.prototype,"BaseView");var EntityAction=function(){function EntityAction(){}EntityAction.ATTACK="a";EntityAction.CAST="c";EntityAction.STAND="s";EntityAction.RUN="r";EntityAction.DIE="d";EntityAction.HIT="h";EntityAction.FLY="f";EntityAction.JUMP="j";return EntityAction}();__reflect(EntityAction.prototype,"EntityAction");var MessageCenter=function(_super){__extends(MessageCenter,_super);function MessageCenter(type){var _this=_super.call(this)||this;_this.flag=0;_this.type=type;_this.dict={};_this.eVec=[];if(_this.type==0){egret.startTick(_this.run,_this)}return _this}MessageCenter.ins=function(){return _super.ins.call(this,0)};MessageCenter.prototype.clear=function(){this.dict={};this.eVec.splice(0)};MessageCenter.prototype.addListener=function(type,listener,listenerObj){var arr=this.dict[type];if(!arr){this.dict[type]=arr=[]}else if(this.flag!=0){this.dict[type]=arr=arr.concat()}for(var _i=0,arr_1=arr;_i<arr_1.length;_i++){var item=arr_1[_i];if(item[0]==listener&&item[1]==listenerObj){return}}arr.push([listener,listenerObj])};MessageCenter.prototype.removeListener=function(type,listener,listenerObj){var arr=this.dict[type];if(!arr){return}if(this.flag!=0){this.dict[type]=arr=arr.concat()}var len=arr.length;for(var i=0;i<len;i++){if(arr[i][0]==listener&&arr[i][1]==listenerObj){arr.splice(i,1);break}}if(arr.length==0){this.dict[type]=null;delete this.dict[type]}};MessageCenter.prototype.removeAll=function(listenerObj){var keys=Object.keys(this.dict);for(var _i=0,keys_1=keys;_i<keys_1.length;_i++){var type=keys_1[_i];var arr=this.dict[type];if(this.flag!=0){this.dict[type]=arr=arr.concat()}var length_1=arr.length;for(var j=length_1-1;j>=0;j--){if(arr[j][1]==listenerObj){arr.splice(j,1)}}if(arr.length==0){this.dict[type]=null;delete this.dict[type]}}};MessageCenter.prototype.dispatch=function(type){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}var vo=ObjectPool.pop("MessageVo");vo.type=type;vo.param=param;if(this.type==0){this.eVec.push(vo)}else if(this.type==1){this.dealMsg(vo)}else{Log.trace(i18n("MessageCenter_0"))}};MessageCenter.prototype.run=function(time){var currTime=egret.getTimer();while(this.eVec.length>0){this.dealMsg(this.eVec.shift());if(egret.getTimer()-currTime>5){break}}return false};MessageCenter.prototype.dealMsg=function(msgVo){var listeners=this.dict[msgVo.type];if(!listeners){return}var len=listeners.length;if(len==0)return;this.flag++;for(var _i=0,listeners_1=listeners;_i<listeners_1.length;_i++){var listener=listeners_1[_i];listener[0].apply(listener[1],msgVo.param)}this.flag--;msgVo.dispose();ObjectPool.push(msgVo)};MessageCenter.setFunction=function(ins,obj,name,ex){if(name.indexOf(ex)==0&&typeof obj[name]=="function"){var msgname_1=egret.getQualifiedClassName(obj)+MessageCenter.splite+name+MessageCenter.msgIndex;MessageCenter.msgIndex+=1;var func_1=obj[name];var newfunc=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var argsLen=args.length;var data;if(ins)data=func_1.call.apply(func_1,[this].concat(args));else data=func_1.apply(void 0,args);if(typeof data!="boolean"||data){MessageCenter.ins().dispatch(msgname_1,data)}return data};newfunc["funcallname"]=msgname_1;obj[name]=newfunc;return true}return false};MessageCenter.compile=function(thisobj,ex){if(ex===void 0){ex="post"}var p=thisobj.prototype;for(var name_1 in p){MessageCenter.setFunction(true,p,name_1,ex)}};MessageCenter.addListener=function(func,listener,thisObj,callobj){if(callobj===void 0){callobj=undefined}if(func&&func["funcallname"]){MessageCenter.ins().addListener(func.funcallname,listener,thisObj);if(callobj)func.call(callobj);return true}else{debug.log("MessageCenter.addListener error:"+egret.getQualifiedClassName(thisObj));return false}};MessageCenter.splite=".";MessageCenter.msgIndex=1;return MessageCenter}(BaseClass);__reflect(MessageCenter.prototype,"MessageCenter");var MessageVo=function(){function MessageVo(){}MessageVo.prototype.dispose=function(){this.type=null;this.param=null};return MessageVo}();__reflect(MessageVo.prototype,"MessageVo");window["post"]=function post(target,key,descriptor){var method=descriptor.value;var msgname=target.constructor.name+MessageCenter.splite+key;var newfunc=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var data=method.call.apply(method,[this].concat(args));if(typeof data!="boolean"||data){MessageCenter.ins().dispatch(msgname,data)}return data};newfunc["funcallname"]=msgname;descriptor.value=newfunc;return descriptor};window["callLater"]=function callLater(target,key,descriptor){var method=descriptor.value;var tkey="$"+key+"CL";var newfunc=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}delete this[tkey];method.call.apply(method,[this].concat(args))};var newfunc2=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if(this[tkey])return;egret.callLater.apply(egret,[newfunc,this].concat(args));this[tkey]=true};descriptor.value=newfunc2;return descriptor};window["callDelay"]=function callDelay(delay){var func=function(target,key,descriptor){var method=descriptor.value;var tkey="$isDelay"+key;var newfunc=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this[tkey]=false;method.call.apply(method,[this].concat(args))};var newfunc2=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if(this[tkey])return;this[tkey]=true;egret.setTimeout.apply(egret,[newfunc,this,delay].concat(args))};descriptor.value=newfunc2;return descriptor};return func};var CharEffect=function(_super){__extends(CharEffect,_super);function CharEffect(){var _this=_super.call(this)||this;_this.myHeight=EntityManager.CHAR_DEFAULT_HEIGHT;_this.typeface=EntityManager.CHAR_DEFAULT_TYPEFACE;_this.groundDistance=0;_this._dir=4;_this._scale=1;_this._state=EntityAction.STAND;_this.specifiedFrame=undefined;_this.specifiedAct=undefined;_this.playCompletes=[];_this.hasDir=[CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.WING,CharMcOrder.SOUL,CharMcOrder.ZHANLING];_this.lastSS=false;_this._disOrder={};_this._mcFileName={};_this._bodyContainer=new egret.DisplayObjectContainer;_this.addChild(_this._bodyContainer);_this._body=ObjectPool.pop("MovieClip");_this._bodyContainer.addChild(_this._body);_this._disOrder[CharMcOrder.BODY]=_this._body;_this.titleContainer=new egret.DisplayObjectContainer;_this.titleContainer.anchorOffsetY=_this.myHeight;_this.addChild(_this.titleContainer);return _this}CharEffect.prototype.getScaleX=function(dir){var s=dir>4?-1:1;var ss=this._scale;return ss*s};CharEffect.prototype.copyImage=function(){var bodySrc=this._body.$texture;var body=new eui.Image(bodySrc);body.scaleX=this._body.scaleX;body.scaleY=this._body.scaleY;body.x=this.x+this._body["offsetPoint"].x*body.scaleX;body.y=this.y+this._body["offsetPoint"].y*body.scaleY+this.groundDistance;return body};CharEffect.prototype.getMC=function(mcType,state,dir){var fileName=this.getFileName(mcType);if(fileName){return this.getResMc(fileName,state,dir)}else{return null}};CharEffect.prototype.getBodyMC=function(state,dir){var fileName=this.getFileName(CharMcOrder.BODY);return this.getResMc(fileName,state,dir)};CharEffect.prototype.getResMc=function(fileName,state,dir){var mc=new MovieClip;if(!fileName)return;mc.scaleX=this.getScaleX(dir);var td=2*(dir-4);if(td<0)td=0;var resDir=dir-td;var s=fileName+"_"+resDir+state;mc.playFile(s,-1,null,false);return mc};CharEffect.prototype.setBodyScale=function(value){this._bodyContainer.scaleX=this._bodyContainer.scaleY=value;this.myHeight=this.myHeight*value;this.typeface*=value;this.titleContainer.anchorOffsetY=Math.floor(this.myHeight)};CharEffect.prototype.checkShapeShifting=function(){var isPlayerChar=this instanceof CharRole;if(isPlayerChar){if(!TimerManager.ins().isExists(this.shapeShift,this)){TimerManager.ins().doTimer(10,0,this.shapeShift,this)}}};Object.defineProperty(CharEffect.prototype,"infoModel",{get:function(){return this._infoModel},set:function(model){this._infoModel=model},enumerable:true,configurable:true});CharEffect.prototype.setConfig=function(avatar){var config=GlobalConfig.MonstershpConfig[avatar];if(config){this.myHeight=config.hp;this.typeface=config.hp}else{this.myHeight=EntityManager.CHAR_DEFAULT_HEIGHT;this.typeface=EntityManager.CHAR_DEFAULT_TYPEFACE}this.titleContainer.anchorOffsetY=Math.floor(this.myHeight)};CharEffect.prototype.updateModel=function(){};Object.defineProperty(CharEffect.prototype,"dir",{get:function(){return this._dir},set:function(value){if(this._dir==value)return;this._dir=value;this.loadBody()},enumerable:true,configurable:true});CharEffect.prototype.getResDir=function(mcType){var td=2*(this._dir-4);if(td<0)td=0;return this._dir-td};CharEffect.prototype.playAction=function(action,callBack,specifiedFrame,specifiedAct){if(specifiedFrame===void 0){specifiedFrame=undefined}if(specifiedAct===void 0){specifiedAct=undefined}this.specifiedFrame=specifiedFrame;this.specifiedAct=specifiedAct;this._state=action;if(callBack){this.playCompletes.push(callBack)}this._body.clearComFun();this.loadBody()};CharEffect.prototype.shapeShift=function(){var isShapeShifting=false;var g=0;var s=1;if(this.infoModel instanceof EntityModel){var model=this.infoModel;var isMy=model.checkHandleIsMy(this.infoModel.handle);var a="";if(isMy){var roleId=model.handleToRoleID(this.infoModel.handle);roleId=roleId>-1?roleId:0;var info=ShapeShiftingMgr.ins().getShowApperance(roleId+1);a=info[0];g=info[2];s=info[3]}else{info=ShapeShiftingMgr.ins().getOthersShowApperance(this.infoModel.handle);a=info[0];g=info[2];s=info[3]}if(a){isShapeShifting=true}}if(isShapeShifting){if(!this.lastSS&&this._state!=EntityAction.DIE){this.loadBody()}this._scale=s;for(var k in this._disOrder){if(k==CharMcOrder.BODY.toString()||k==CharMcOrder.DIZUO.toString()){this._disOrder[k].visible=true}else{this._disOrder[k].visible=false}this._disOrder[k].scaleX=this.getScaleX(this._dir);this._disOrder[k].scaleY=this._scale}this.titleContainer.y=-this.groundDistance+g}else{if(this.lastSS){this.loadBody()}this._scale=1;for(var k in this._disOrder){this._disOrder[k].scaleX=this.getScaleX(this._dir);this._disOrder[k].scaleY=this._scale}if(this._state==EntityAction.DIE){for(var k in this._disOrder){if(k==CharMcOrder.BODY.toString()||k==CharMcOrder.WEAPON.toString()){this._disOrder[k].visible=true}else{this._disOrder[k].visible=false}}}else{for(var k in this._disOrder){if(k==CharMcOrder.DIZUO.toString()){this._disOrder[k].visible=false}else{this._disOrder[k].visible=true}}}this.titleContainer.y=-this.groundDistance}this.lastSS=isShapeShifting};CharEffect.prototype.loadBody=function(){this.checkShapeShifting();this._body.stop();this._body.addEventListener(egret.Event.CHANGE,this.playBody,this);var res=this.getFileName(CharMcOrder.BODY);var isShapeShifting=false;if(this.infoModel instanceof EntityModel){var model=this.infoModel;var isMy=model.checkHandleIsMy(this.infoModel.handle);var a="";var d="";if(isMy){var roleId=model.handleToRoleID(this.infoModel.handle);roleId=roleId>-1?roleId:0;var info=ShapeShiftingMgr.ins().getShowApperance(roleId+1);a=info[0];d=info[1]}else{info=ShapeShiftingMgr.ins().getOthersShowApperance(this.infoModel.handle);a=info[0];d=info[1]}if(a){isShapeShifting=true;res=a;var dizuo=this.getMc(CharMcOrder.DIZUO);if(!dizuo){dizuo=this.addMc(CharMcOrder.DIZUO,"");dizuo.playFile(RES_DIR_EFF+d,-1)}}else{this.removeMc(CharMcOrder.DIZUO)}}if(this.hasDir.indexOf(CharMcOrder.BODY)>=0){this.loadFile(this._body,res,CharMcOrder.BODY,isShapeShifting)}else{this.playFile(this._body,res)}};CharEffect.prototype.loadOther=function(mcType){var mc=this.getMc(mcType);if(!mc)return;mc.stop();mc.addEventListener(egret.Event.CHANGE,this.syncFrame,this);this.loadFile(mc,this.getFileName(mcType),mcType)};CharEffect.prototype.loadNoDir=function(mcType){var mc=this.getMc(mcType);var fileName=this.getFileName(mcType);if(mc&&fileName){this.playFile(mc,fileName)}};CharEffect.prototype.getFileName=function(mcType){return this._mcFileName[mcType]};CharEffect.prototype.playFile=function(mc,fileName){mc.playFile(fileName,-1,null,false)};CharEffect.prototype.loadFile=function(mc,fileName,mcType,isShapeShifting){if(isShapeShifting===void 0){isShapeShifting=false}if(!fileName)return;if(CharEffect.ACTION_ODER[mcType]&&CharEffect.ACTION_ODER[mcType].indexOf(this._state)<0)return;var dir=this.getResDir(mcType);mc.scaleX=this.getScaleX(this._dir);var s;var sa=this.specifiedAct;if(this.hasFlySword()&&this._state=="r"&&!isShapeShifting){sa="f"}if(sa==null){s=fileName+"_"+dir+this._state}else{s=fileName+"_"+dir+sa}var arr=fileName.split("/");var resName=arr[arr.length-1];if(resName.indexOf("zhanling")>-1&&(this._state=="h"||sa=="h"||this._state=="c"||sa=="c")){return}if(resName.indexOf("body")<0&&(this._state=="t"||sa=="t")){return}if(resName.indexOf("body")>=0&&resName.indexOf("r")<0&&(this._state=="t"||sa=="t")){s=fileName+"_"+dir+"a"}if(resName.indexOf("monster")>-1&&(this._state=="t"||sa=="t"||this._state=="c"||sa=="c")){s=fileName+"_"+dir+"a"}if(resName.indexOf("monster")>-1&&resName.indexOf("monster10000")<0&&(this._state=="f"||sa=="f"||this._state=="j"||sa=="j")){s=fileName+"_"+dir+"r"}mc.playFile(s,this.playCount(),mc==this._body?this.playAllCompletes.bind(this):null,false)};CharEffect.prototype.playAllCompletes=function(){for(var _i=0,_a=this.playCompletes;_i<_a.length;_i++){var v=_a[_i];v()}this.playCompletes.splice(0)};CharEffect.prototype.playBody=function(e){if(this.specifiedFrame==null){var firstFrame=1;this._body.gotoAndPlay(firstFrame,this.playCount())}else{this._body.gotoAndStop(this.specifiedFrame)}this.removeBodyEvent(this._body);for(var mcType in this._disOrder){var mc=this._disOrder[mcType];if(mc!=this._body){if(this.hasDir.indexOf(+mcType)>=0&&mc instanceof MovieClip){this.loadOther(+mcType)}}}this.playSprintWind();this.updateFlySword();this.sortEffect()};CharEffect.prototype.hasFlySword=function(){if(this instanceof CharMonster){var infoModel=this.infoModel;if(this instanceof CharRole&&infoModel.isMy){if(!SysSetting.ins().getBool(SysSetting.SHOW_SWORD)){return false}var ringList=SpecialRing.ins().ringList;var hasFeiJian=false;if(ringList!=null){for(var _i=0,ringList_1=ringList;_i<ringList_1.length;_i++){var ring=ringList_1[_i];if(ring.level>0){hasFeiJian=true}}}return hasFeiJian}else{var otherRole=infoModel;if(otherRole instanceof EntityModel){return otherRole.flySwordAct!=null&&otherRole.flySwordAct>0}return false}}};CharEffect.prototype.setGroundDistance=function(d){this.groundDistance=d;var _disOrder=this._disOrder;for(var k in _disOrder){var v=_disOrder[k];if(v){v.y=-d}}for(var i=0,c=this.numChildren;i<c;++i){var child=this.getChildAt(i);if(child instanceof MovieClip){child.y=-d}}this.titleContainer.y=-this.groundDistance};CharEffect.prototype.updateFlySword=function(){if(this.hasFlySword()){var resdir=this.getResDir(CharMcOrder.FLYSWORD);var name=null;if(this instanceof CharMonster){var infoModel=this.infoModel;if(this instanceof CharRole&&infoModel instanceof Role&&infoModel.isMy){if(SpecialRing.ins().isFireRingFuse()){name=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID].appearance}else{name=GlobalConfig.ActorExRingConfig[5].appearance}var skin=SwordSkinMgr.ins().getSelectedSkin(infoModel.index+1);if(skin!=null){name=skin}}else{var otherRole=infoModel;if(otherRole.flySwordAct==2){name=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID].appearance}else if(otherRole.flySwordAct==1){name=GlobalConfig.ActorExRingConfig[5].appearance}if(otherRole.flySwordSkin!=null&&otherRole.flySwordSkin!=""){name=otherRole.flySwordSkin}if(otherRole.flySwordSkinId!=null&&otherRole.flySwordSkinId>0){var cfg=GlobalConfig.SwordSkinConfig[otherRole.flySwordSkinId];var skin=cfg&&cfg.appearance||null;if(skin!=null){name=skin}}}}if(name!=null){this.groundDistance=30;var mc=this.addMc(CharMcOrder.FLYSWORD,"resource/res/feijian/"+name+"_"+resdir+"f",0);mc.play(-1);mc.scaleX=this.getScaleX(this._dir);var mc2=this.addMc(CharMcOrder.CLOUD,"resource/res/feijian/feijian_yun_"+resdir+"f",0);mc2.play(-1);mc2.scaleX=this.getScaleX(this._dir)}}else{this.removeMc(CharMcOrder.FLYSWORD);this.removeMc(CharMcOrder.CLOUD);this.setGroundDistance(0)}};CharEffect.prototype.playSprintWind=function(){if(this.specifiedAct=="f"||this.specifiedAct=="j"&&this.hasFlySword()){var resdir=this.getResDir(CharMcOrder.SPRINT);var mc=this.addMc(CharMcOrder.SPRINT,"resource/res/skilleff/skillbadyfly_"+resdir,0);mc.play(-1);mc.scaleX=this.getScaleX(this._dir)}else{this.removeMc(CharMcOrder.SPRINT)}};CharEffect.prototype.syncFrame=function(e){this.removeMcEvent(e.currentTarget);if(this.specifiedFrame==null){e.currentTarget.gotoAndPlay(this._body.currentFrame,this.playCount())}else{e.currentTarget.gotoAndStop(this._body.currentFrame)}};CharEffect.prototype.removeBodyEvent=function(mc){mc.removeEventListener(egret.Event.CHANGE,this.playBody,this)};CharEffect.prototype.removeMcEvent=function(mc){mc.removeEventListener(egret.Event.CHANGE,this.syncFrame,this)};CharEffect.prototype.onImgLoaded=function(e){var img=e.currentTarget;img.removeEventListener(egret.Event.COMPLETE,this.onImgLoaded,this);img.anchorOffsetX=img.width/2;img.anchorOffsetY=img.height/2};CharEffect.prototype.playCount=function(){return-1};CharEffect.prototype.addMc=function(mcType,fileName,disType){if(disType===void 0){disType=0}if(this._mcFileName[mcType]==fileName)return this._disOrder[mcType];this._mcFileName[mcType]=fileName;var mc=this._disOrder[mcType];if(mcType==CharMcOrder.DIZUO){if(!mc){mc=new MovieClip;this._bodyContainer.addChild(mc);this._disOrder[mcType]=mc}this.sortEffect();return mc}if(mcType==CharMcOrder.XIANYU){if(!mc){mc=new eui.Group;this._bodyContainer.addChild(mc);this._disOrder[mcType]=mc}this.sortEffect();return mc}if(!mc){if(disType==0){mc=ObjectPool.pop("MovieClip")}else{mc=new eui.Image}this._bodyContainer.addChild(mc);this._disOrder[mcType]=mc}if(mc instanceof MovieClip){if(this.hasDir.indexOf(mcType)>=0){if(mc==this._body){this.loadBody()}else{this.loadOther(mcType)}}else{this.loadNoDir(mcType)}}else{mc.addEventListener(egret.Event.COMPLETE,this.onImgLoaded,this);mc.source=fileName}this.sortEffect();return mc};CharEffect.prototype.removeMc=function(mcType){if(mcType==CharMcOrder.BODY)return;var mc=this._disOrder[mcType];if(mc){if(mc instanceof MovieClip){this.removeMcEvent(mc);mc.destroy()}else{DisplayUtils.removeFromParent(mc)}delete this._mcFileName[mcType];delete this._disOrder[mcType]}};CharEffect.prototype.getMc=function(mcType){return this._disOrder[mcType]};CharEffect.prototype.removeAll=function(){for(var mcType in this._disOrder){var mc=this._disOrder[mcType];if(mc!=this._body){if(mc instanceof MovieClip){this.removeMcEvent(mc);mc.destroy()}else{DisplayUtils.removeFromParent(mc)}delete this._mcFileName[mcType];delete this._disOrder[mcType]}}this._body.dispose();this.removeBodyEvent(this._body);delete this._mcFileName[CharMcOrder.BODY]};CharEffect.prototype.addShadow=function(){if(!this.shadow){this.shadow=new eui.Image("yingzi_png");this.addChildAt(this.shadow,0);this.shadow.anchorOffsetX=57>>1;this.shadow.anchorOffsetY=37>>1}};CharEffect.prototype.removeShadow=function(){if(this.shadow){this.shadow.parent.removeChild(this.shadow);this.shadow=null}};CharEffect.prototype.sortEffect=function(){var order=CharEffect.FRAME_ODER[this._dir];var len=order.length;var childIndex=0;for(var i=0;i<len;i++){var index=order[i];if(this._disOrder[index]&&this._disOrder[index].parent){this._disOrder[index].y=-this.groundDistance;this._bodyContainer.addChildAt(this._disOrder[index],childIndex);childIndex+=1}}this.titleContainer.y=-this.groundDistance};Object.defineProperty(CharEffect.prototype,"weight",{get:function(){return this.y},enumerable:true,configurable:true});Object.defineProperty(CharEffect.prototype,"team",{get:function(){return this.infoModel.team},enumerable:true,configurable:true});CharEffect.prototype.destroy=function(){this.removeAll();this.removeTimers()};CharEffect.prototype.removeTimers=function(){TimerManager.ins().remove(this.shapeShift,this)};CharEffect.FRAME_ODER=[[CharMcOrder.DIZUO,CharMcOrder.XIANYU,CharMcOrder.CLOUD,CharMcOrder.FLYSWORD,CharMcOrder.SOUL,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.WING,CharMcOrder.ZHANLING,CharMcOrder.SPRINT],[CharMcOrder.DIZUO,CharMcOrder.XIANYU,CharMcOrder.CLOUD,CharMcOrder.FLYSWORD,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.WING,CharMcOrder.ZHANLING,CharMcOrder.SPRINT],[CharMcOrder.DIZUO,CharMcOrder.XIANYU,CharMcOrder.CLOUD,CharMcOrder.FLYSWORD,CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING,CharMcOrder.SPRINT],[CharMcOrder.DIZUO,CharMcOrder.XIANYU,CharMcOrder.CLOUD,CharMcOrder.FLYSWORD,CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING,CharMcOrder.SPRINT],[CharMcOrder.DIZUO,CharMcOrder.XIANYU,CharMcOrder.CLOUD,CharMcOrder.FLYSWORD,CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING,CharMcOrder.SPRINT],[CharMcOrder.DIZUO,CharMcOrder.XIANYU,CharMcOrder.CLOUD,CharMcOrder.FLYSWORD,CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING,CharMcOrder.SPRINT],[CharMcOrder.DIZUO,CharMcOrder.XIANYU,CharMcOrder.CLOUD,CharMcOrder.FLYSWORD,CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING,CharMcOrder.SPRINT],[CharMcOrder.DIZUO,CharMcOrder.XIANYU,CharMcOrder.CLOUD,CharMcOrder.FLYSWORD,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.WING,CharMcOrder.ZHANLING,CharMcOrder.SPRINT]];CharEffect.ACTION_ODER={8:[EntityAction.STAND,EntityAction.RUN,EntityAction.ATTACK]};return CharEffect}(egret.DisplayObjectContainer);__reflect(CharEffect.prototype,"CharEffect");var BaseSystem=function(_super){__extends(BaseSystem,_super);function BaseSystem(){var _this=_super.call(this)||this;MessageCenter.compile(_this.constructor);_this.observe(GameApp.ins().postLoginInit,_this.initLogin);_this.observe(GameApp.ins().postZeroInit,_this.initZero);return _this}BaseSystem.prototype.regNetMsg=function(msgId,fun){GameSocket.ins().registerSTCFunc(this.sysId,msgId,fun,this)};BaseSystem.prototype.initLogin=function(){};BaseSystem.prototype.initZero=function(){};BaseSystem.prototype.getGameByteArray=function(){return GameSocket.ins().getBytes()};BaseSystem.prototype.getBytes=function(msgid){var bytes=this.getGameByteArray();bytes.writeCmd(this.sysId,msgid);return bytes};BaseSystem.prototype.sendBaseProto=function(msgid){var bytes=this.getGameByteArray();bytes.writeCmd(this.sysId,msgid);this.sendToServer(bytes)};BaseSystem.prototype.sendToServer=function(bytes){GameSocket.ins().sendToServer(bytes)};BaseSystem.prototype.observe=function(func,myfunc){MessageCenter.addListener(func,myfunc,this)};BaseSystem.prototype.removeObserve=function(){MessageCenter.ins().removeAll(this)};BaseSystem.prototype.associated=function(fun){var _this=this;var funs=[];for(var _i=1;_i<arguments.length;_i++){funs[_i-1]=arguments[_i]}var isDelayCall=false;var callFunc=function(){isDelayCall=false;fun.call(_this)};var delayFunc=function(){if(!isDelayCall){isDelayCall=true;TimerManager.ins().doTimer(60,1,callFunc,_this)}};for(var _a=0,funs_1=funs;_a<funs_1.length;_a++){var i=funs_1[_a];this.observe(i,delayFunc)}};return BaseSystem}(BaseClass);__reflect(BaseSystem.prototype,"BaseSystem");MessageCenter.compile(BaseSystem);var BaseEuiView=function(_super){__extends(BaseEuiView,_super);function BaseEuiView(){var _this=_super.call(this)||this;_this._resources=null;_this.isTopLevel=false;_this.needBg=true;_this.isPlayOpenSound=false;_this.exclusionWins=[];_this._isInit=false;_this.percentHeight=100;_this.percentWidth=100;return _this}BaseEuiView.prototype.addExclusionWin=function(classOrName){if(this.exclusionWins.indexOf(classOrName)==-1)this.exclusionWins.push(classOrName)};BaseEuiView.prototype.isInit=function(){return this._isInit};BaseEuiView.prototype.isShow=function(){return this.stage!=null&&this.visible};BaseEuiView.prototype.addToParent=function(p){p.addChild(this);TimerManager.ins().remove(this.destoryView,this)};BaseEuiView.prototype.removeFromParent=function(){DisplayUtils.removeFromParent(this);this.destoryView()};BaseEuiView.prototype.initUI=function(){this._isInit=true};BaseEuiView.prototype.initData=function(){};BaseEuiView.prototype.destroy=function(){};BaseEuiView.prototype.destoryView=function(destroyUI){if(destroyUI===void 0){destroyUI=true}TimerManager.ins().removeAll(this);ViewManager.ins().destroy(this.hashCode);if(destroyUI){ResourceMgr.ins().destroyWin()}};BaseEuiView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};BaseEuiView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};BaseEuiView.prototype.loadResource=function(loadComplete,initComplete){if(this._resources&&this._resources.length>0){ResourceUtils.ins().loadResource(this._resources,[],loadComplete,null,this);this.addEventListener(eui.UIEvent.CREATION_COMPLETE,initComplete,this)}else{loadComplete();initComplete()}};BaseEuiView.prototype.setVisible=function(value){this.visible=value};BaseEuiView.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};BaseEuiView.prototype.playUIEff=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.anigroup)UIAnimation.setAnimation(this.anigroup,UIAnimation.ANITYPE_IN_SCALE_VER,{time:200})};BaseEuiView.prototype.closeEx=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var func=param[0];if(this.parent==LayerManager.UI_Popup){if(this.anigroup)UIAnimation.setAnimation(this.anigroup,UIAnimation.ANITYPE_OUT_SCALE_VER,{time:200,func:func,ease:egret.Ease.sineIn});else func()}else{func()}};return BaseEuiView}(BaseView);__reflect(BaseEuiView.prototype,"BaseEuiView",["IBaseView"]);var NpcModel=function(_super){__extends(NpcModel,_super);function NpcModel(){var _this=_super.call(this)||this;_this.type=EntityType.Npc;return _this}Object.defineProperty(NpcModel.prototype,"avatarString",{get:function(){var config=GlobalConfig.NpcBaseConfig[this.configID];return config?config.avatar:null},enumerable:true,configurable:true});Object.defineProperty(NpcModel.prototype,"avatarFileName",{get:function(){var config=this.npcConfig;if(config.actType==1){return RES_DIR_BODY+"body"+config.avatar}return RES_DIR_MONSTER+"monster"+config.avatar},enumerable:true,configurable:true});Object.defineProperty(NpcModel.prototype,"weaponFileName",{get:function(){var config=this.npcConfig;if(config.weapon){return RES_DIR_WEAPON+"weapon"+config.weapon}return""},enumerable:true,configurable:true});Object.defineProperty(NpcModel.prototype,"npcConfig",{get:function(){return GlobalConfig.NpcBaseConfig[this.configID]},enumerable:true,configurable:true});NpcModel.prototype.clone=function(model){var Cls=egret.getQualifiedClassName(this);model=model||ObjectPool.pop(Cls);for(var key in this){if(typeof this[key]!="function"){if(key!="__class__"&&key!="__types__"){model[key]=this[key]}}}return model};return NpcModel}(EffectModel);__reflect(NpcModel.prototype,"NpcModel");var ActivityBaseData=function(){function ActivityBaseData(bytes){}ActivityBaseData.prototype.init=function(bytes,id){};ActivityBaseData.prototype.update=function(bytes){};ActivityBaseData.prototype.canReward=function(){return false};ActivityBaseData.prototype.isOpenActivity=function(){return false};Object.defineProperty(ActivityBaseData.prototype,"rewardState",{get:function(){return 0},enumerable:true,configurable:true});ActivityBaseData.prototype.specialState=function(){return true};ActivityBaseData.prototype.getHide=function(){return false};return ActivityBaseData}();__reflect(ActivityBaseData.prototype,"ActivityBaseData");var ActivityType;(function(ActivityType){ActivityType[ActivityType["Normal"]=0]="Normal";ActivityType[ActivityType["Personal"]=1]="Personal";ActivityType[ActivityType["Nesting"]=2]="Nesting"})(ActivityType||(ActivityType={}));window["ActivityType"]=ActivityType;var WorldBossHeadRender=function(_super){__extends(WorldBossHeadRender,_super);function WorldBossHeadRender(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.isAddEff=false;return _this}WorldBossHeadRender.prototype.dataChanged=function(){this.hpBar.visible=false;this.haveGuildName(false);this.isAddEff=false;if(this.data instanceof CharMonster){this.currentState="war";this.updateChar(this.data)}else if(!isNaN(this.data)){this.currentState="war";if(this.data){var charSource=EntityManager.ins().getEntityByHandle(this.data)||EntityManager.ins().getEntityBymasterhHandle(this.data);if(charSource)this.updateChar(charSource);else if(KFBossSys.ins().isKFBossBattle&&KFBossSys.ins().flagHandle==this.data){var flagConfig=GlobalConfig.MonstersConfig[GlobalConfig.CrossBossBase.flagId];if(flagConfig&&this.checkMonHead(flagConfig)){var t=KFBossSys.ins().flagCD-egret.getTimer();var tStr=DateUtils.getFormatBySecond(t/1e3);if(t<=0){tStr="";this.haveGuildName(false)}else this.haveGuildName(true);var str=i18n("WorldBossHeadRender_5",flagConfig.name,ColorUtil.RED_COLOR_N,tStr);this.roleName.textFlow=TextFlowMaker.generateTextFlow1(str);this.roleHead.source="monhead"+flagConfig.head+"_png";this.addAttEffect()}}else if(KfArenaSys.ins().isKFArena&&KfArenaSys.ins().flagHandle==this.data){var flagConfig=GlobalConfig.MonstersConfig[GlobalConfig.CrossArenaBase.flagBossId];if(flagConfig&&this.checkMonHead(flagConfig)){var t=KfArenaSys.ins().flagCD-egret.getTimer();var tStr=DateUtils.getFormatBySecond(t/1e3);this.haveGuildName(true);if(KfArenaSys.ins().gotFirstFlag==false){tStr=i18n("WorldBossHeadRender_7")}else if(t<=0){tStr="";this.haveGuildName(false)}var str=void 0;if(tStr.length>0){str=i18n("WorldBossHeadRender_6",flagConfig.name,ColorUtil.RED_COLOR_N,tStr)}else{str=flagConfig.name}this.roleName.textFlow=TextFlowMaker.generateTextFlow1(str);this.roleHead.source="monhead"+flagConfig.head+"_png";this.addAttEffect()}}}else{var bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];if(bossConfig&&this.checkMonHead(bossConfig)){this.roleName.textFlow=(new egret.HtmlTextParser).parser(bossConfig.name);this.roleHead.source="monhead"+bossConfig.head+"_png";this.addAttEffect()}}}else if(this.data instanceof SelectInfoData){this.currentState="panel";this.num.textFlow=(new egret.HtmlTextParser).parser(this.data.num+i18n("WorldBossHeadRender_0"));this.roleName.textFlow=(new egret.HtmlTextParser).parser(this.data.data.name);this.roleHead.source="yuanhead"+this.data.data.job+this.data.data.sex}if(!this.isAddEff){this.removeAttEffect()}};WorldBossHeadRender.prototype.checkMonHead=function(config){if(Assert(config.head,i18n("WorldBossHeadRender_1",config.id,config.name)))return false;return true};WorldBossHeadRender.prototype.updateChar=function(charSource){if(charSource instanceof CharRole){var info=charSource.infoModel;if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){var tname=info.name;if(info.type==EntityType.LadderPlayer){var strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];tname=StringUtils.replaceStr(tname,"0xffffff",this.roleName.textColor+"")}this.roleName.textFlow=TextFlowMaker.generateTextFlow1(tname)}else{var guildName=info.guildName?"\n<font color='#6495ed'>"+info.guildName+"</font>":"";var str=DevildomSys.ins().isDevildomBattle&&guildName?info.name+guildName:info.getNameWithServer2();if(str.indexOf("\n")>-1){this.haveGuildName(true)}this.roleName.textFlow=(new egret.HtmlTextParser).parser(str)}if(Assert(info.job,i18n("WorldBossHeadRender_3",info.configID,info.name)))return;this.roleHead.source="yuanhead"+info.job+info.sex;if(this.checkIsCurrAttack(info.handle)){this.addAttEffect()}}else{var monster=charSource;if(monster.infoModel.type==EntityType.Monster||KFBossSys.ins().isKFBossBattle&&monster.infoModel.type==EntityType.CollectionMonst){var config=GlobalConfig.MonstersConfig[monster.infoModel.configID];if(Assert(config,i18n("WorldBossHeadRender_4",monster.infoModel.configID)))return;if(!this.checkMonHead(config))return;this.roleName.textFlow=(new egret.HtmlTextParser).parser(config.name);this.roleHead.source="monhead"+config.head+"_png";if(this.checkIsCurrAttack(monster.infoModel.handle))this.addAttEffect()}}};WorldBossHeadRender.prototype.checkIsCurrAttack=function(handle){var curMasterHandle=EntityManager.ins().getRootMasterHandle(GameLogic.ins().currAttackHandle);return curMasterHandle==EntityManager.ins().getRootMasterHandle(handle)};WorldBossHeadRender.prototype.addAttEffect=function(){_super.prototype.addAttEffect.call(this);this.isAddEff=true};return WorldBossHeadRender}(GuildWarMemberHeadRender);__reflect(WorldBossHeadRender.prototype,"WorldBossHeadRender");var BaseEuiLayer=function(_super){__extends(BaseEuiLayer,_super);function BaseEuiLayer(){var _this=_super.call(this)||this;_this.percentWidth=100;_this.percentHeight=100;_this.touchEnabled=false;return _this}return BaseEuiLayer}(eui.Group);__reflect(BaseEuiLayer.prototype,"BaseEuiLayer");var CharNpc=function(_super){__extends(CharNpc,_super);function CharNpc(){var _this=_super.call(this)||this;_this.npcHead=new MineNpcHead;_this.npcHead.anchorOffsetY=190;_this.npcHead.anchorOffsetX=115;_this.npcHead.currentState=_this.npcHead.states[0];_this.titleContainer.addChild(_this.npcHead);_this.touchEnabled=true;_this.touchChildren=false;return _this}Object.defineProperty(CharNpc.prototype,"infoModel",{get:function(){return this._infoModel},set:function(model){this._infoModel=model},enumerable:true,configurable:true});CharNpc.prototype.playCount=function(){return this._state==EntityAction.RUN||this._state==EntityAction.STAND?-1:1};CharNpc.prototype.updateModel=function(){var config=this.infoModel.npcConfig;this.npcHead.nameTxt.text=config.name;this.npcHead.updateModel(this.infoModel);this.x=this.infoModel.x;this.y=this.infoModel.y;this.setConfig(this.infoModel.avatarString);this.dir=this.infoModel.dir;this.playAction(config.action||EntityAction.STAND);this.addMc(CharMcOrder.BODY,this.infoModel.avatarFileName);if(this.infoModel.weaponFileName){this.addMc(CharMcOrder.WEAPON,this.infoModel.weaponFileName)}};return CharNpc}(CharEffect);__reflect(CharNpc.prototype,"CharNpc");var GuideViewBase=function(_super){__extends(GuideViewBase,_super);function GuideViewBase(){var _this=_super.call(this)||this;_this.clickCD=true;_this.otherMc=[];_this.rect=new egret.Rectangle(1,1,1,1);_this.infoGroup=new eui.Group;_this.infoGroup.touchEnabled=false;_this.infoGroup.touchChildren=false;_this.addChild(_this.infoGroup);return _this}GuideViewBase.prototype.drawMask=function(){if(!this.shapeMasks){this.shapeMasks=[];for(var i=0;i<8;i++){this.shapeMasks[i]=new egret.Shape;this.shapeMasks[i].touchEnabled=true}}var rect=this.rect;var w1=rect.x;var w2=rect.width;var w3=StageUtils.ins().getWidth()-rect.right;var h1=rect.y;var h2=rect.height;var h3=StageUtils.ins().getHeight()-rect.bottom;this.drawShape(this.shapeMasks[0],new egret.Rectangle(0,0,w1,h1));this.drawShape(this.shapeMasks[1],new egret.Rectangle(rect.x,0,w2,h1));this.drawShape(this.shapeMasks[2],new egret.Rectangle(rect.right,0,w3,h1));this.drawShape(this.shapeMasks[3],new egret.Rectangle(0,rect.topLeft.y,w1,h2));this.drawShape(this.shapeMasks[4],new egret.Rectangle(rect.bottomRight.x,rect.topLeft.y,w3,h2));this.drawShape(this.shapeMasks[5],new egret.Rectangle(0,rect.bottomRight.y,w1,h3));this.drawShape(this.shapeMasks[6],new egret.Rectangle(rect.x,rect.bottomRight.y,w2,h3));this.drawShape(this.shapeMasks[7],new egret.Rectangle(rect.right,rect.bottomRight.y,w3,h3))};GuideViewBase.prototype.drawShape=function(shape,rect){shape.graphics.clear();shape.graphics.beginFill(0,0);shape.graphics.drawRect(rect.x,rect.y,rect.width,rect.height);shape.graphics.endFill();this.addChild(shape)};GuideViewBase.prototype.onResize=function(){if(this.target){var p=this.target.localToGlobal();if(this.rect.x!=p.x||this.rect.y!=p.y||this.rect.width!=this.target.width||this.rect.height!=this.target.height){this.refurbish();this.drawMask()}return false}};GuideViewBase.prototype.onClick=function(e){var _this=this;if(this.rect.contains(e.stageX,e.stageY)){if(this.clickCD){this.clickCD=false;TimerManager.ins().doNext(function(){_this.dispatchEventWith(egret.Event.CHANGE)},this)}for(var i=0;i<this.otherMc.length;i++){egret.Tween.removeTweens(this.otherMc[i]);DisplayUtils.removeFromParent(this.otherMc[i])}this.clicking=false}else{GuideUtils.ins().clickOut();if(this.clicking)return;this.clicking=true;this.otherMc.length=2;var _loop_1=function(i){if(!this_1.otherMc[i]){this_1.otherMc[i]=new MovieClip}if(!this_1.otherMc[i].parent){this_1.addChild(this_1.otherMc[i])}this_1.otherMc[i].scaleX=3.3;this_1.otherMc[i].scaleY=3.3;this_1.otherMc[i].x=this_1.infoGroup.x;this_1.otherMc[i].y=this_1.infoGroup.y;var tw=egret.Tween.get(this_1.otherMc[i]);var self_1=this_1;tw.wait(i*240).call(function(){self_1.otherMc[i].playFile(RES_DIR_EFF+"forceguildeff",1,function(){egret.Tween.removeTweens(self_1.otherMc[i]);DisplayUtils.removeFromParent(self_1.otherMc[i]);if(i==self_1.otherMc.length-1)self_1.clicking=false})})};var this_1=this;for(var i=0;i<this.otherMc.length;i++){_loop_1(i)}}};GuideViewBase.prototype.refurbish=function(){this.show(this.target)};GuideViewBase.prototype.show=function(target){if(target==null){return}this.target=target;var p=target.localToGlobal();this.rect.x=p.x;this.rect.y=p.y;this.rect.width=target.width?target.width:60;this.rect.height=target.height?target.height:60;this.drawMask();this.addChild(this.infoGroup);this.infoGroup.x=p.x+(this.rect.width>>1);this.infoGroup.y=p.y+(this.rect.height>>1);var st=StageUtils.ins().getStage();st.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this,true,0);egret.stopTick(this.onResize,this);egret.startTick(this.onResize,this)};GuideViewBase.prototype.close=function(){this.target=null;this.rect.x=this.rect.y=this.rect.width=this.rect.height=1;var st=StageUtils.ins().getStage();st.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this,true);egret.stopTick(this.onResize,this)};return GuideViewBase}(egret.DisplayObjectContainer);__reflect(GuideViewBase.prototype,"GuideViewBase");var enPropEntity;(function(enPropEntity){enPropEntity[enPropEntity["P_ID"]=0]="P_ID";enPropEntity[enPropEntity["P_POS_X"]=1]="P_POS_X";enPropEntity[enPropEntity["P_POS_Y"]=2]="P_POS_Y";enPropEntity[enPropEntity["P_MODELID"]=3]="P_MODELID";enPropEntity[enPropEntity["P_ICON"]=4]="P_ICON";enPropEntity[enPropEntity["P_DIR"]=5]="P_DIR";enPropEntity[enPropEntity["P_MAX_ENTITY"]=6]="P_MAX_ENTITY"})(enPropEntity||(enPropEntity={}));window["enPropEntity"]=enPropEntity;var enPropAnimal;(function(enPropAnimal){enPropAnimal[enPropAnimal["P_LEVEL"]=6]="P_LEVEL";enPropAnimal[enPropAnimal["P_HP"]=7]="P_HP";enPropAnimal[enPropAnimal["P_MP"]=8]="P_MP";enPropAnimal[enPropAnimal["P_SPEED"]=9]="P_SPEED";enPropAnimal[enPropAnimal["P_MAXHP"]=10]="P_MAXHP";enPropAnimal[enPropAnimal["P_MAXMP"]=11]="P_MAXMP";enPropAnimal[enPropAnimal["P_OUT_ATTACK"]=12]="P_OUT_ATTACK";enPropAnimal[enPropAnimal["P_OUT_DEFENCE"]=13]="P_OUT_DEFENCE";enPropAnimal[enPropAnimal["P_DEFCRITICALSTRIKES"]=14]="P_DEFCRITICALSTRIKES";enPropAnimal[enPropAnimal["P_ALL_ATTACK"]=15]="P_ALL_ATTACK";enPropAnimal[enPropAnimal["P_SUB_DEF"]=16]="P_SUB_DEF";enPropAnimal[enPropAnimal["P_IN_ATTACK"]=17]="P_IN_ATTACK";enPropAnimal[enPropAnimal["P_IN_DEFENCE"]=18]="P_IN_DEFENCE";enPropAnimal[enPropAnimal["P_CRITICALSTRIKES"]=19]="P_CRITICALSTRIKES";enPropAnimal[enPropAnimal["P_DODGERATE"]=20]="P_DODGERATE";enPropAnimal[enPropAnimal["P_HITRATE"]=21]="P_HITRATE";enPropAnimal[enPropAnimal["P_ATTACK_ADD"]=22]="P_ATTACK_ADD";enPropAnimal[enPropAnimal["P_HP_RENEW"]=23]="P_HP_RENEW";enPropAnimal[enPropAnimal["P_MP_RENEW"]=24]="P_MP_RENEW";enPropAnimal[enPropAnimal["P_ATTACK_SPEED"]=25]="P_ATTACK_SPEED";enPropAnimal[enPropAnimal["P_IN_ATTACK_DAMAGE_ADD"]=26]="P_IN_ATTACK_DAMAGE_ADD";enPropAnimal[enPropAnimal["P_OUT_ATTACK_DAMAGE_ADD"]=27]="P_OUT_ATTACK_DAMAGE_ADD";enPropAnimal[enPropAnimal["P_THUNDER_ATTACK"]=28]="P_THUNDER_ATTACK";enPropAnimal[enPropAnimal["P_THUNDER_DEFENCE"]=29]="P_THUNDER_DEFENCE";enPropAnimal[enPropAnimal["P_POISON_ATTACK"]=30]="P_POISON_ATTACK";enPropAnimal[enPropAnimal["P_POISON_DEFENCE"]=31]="P_POISON_DEFENCE";enPropAnimal[enPropAnimal["P_ICE_ATTACK"]=32]="P_ICE_ATTACK";enPropAnimal[enPropAnimal["P_ICE_DEFENCE"]=33]="P_ICE_DEFENCE";enPropAnimal[enPropAnimal["P_FIRE_ATTACK"]=34]="P_FIRE_ATTACK";enPropAnimal[enPropAnimal["P_FIRE_DEFENCE"]=35]="P_FIRE_DEFENCE";enPropAnimal[enPropAnimal["P_STATE"]=36]="P_STATE";enPropAnimal[enPropAnimal["P_BASE_MAXHP"]=37]="P_BASE_MAXHP";enPropAnimal[enPropAnimal["P_BASE_MAXMP"]=38]="P_BASE_MAXMP";enPropAnimal[enPropAnimal["P_STAND_POINT"]=39]="P_STAND_POINT";enPropAnimal[enPropAnimal["P_MAX_ANIMAL"]=40]="P_MAX_ANIMAL"})(enPropAnimal||(enPropAnimal={}));window["enPropAnimal"]=enPropAnimal;var enPropActor;(function(enPropActor){enPropActor[enPropActor["P_WEAPON"]=40]="P_WEAPON";enPropActor[enPropActor["P_MOUNT"]=41]="P_MOUNT";enPropActor[enPropActor["P_DIZZY_RATE11"]=42]="P_DIZZY_RATE11";enPropActor[enPropActor["P_DIZZY_TIME1"]=43]="P_DIZZY_TIME1";enPropActor[enPropActor["P_HP_STORE"]=44]="P_HP_STORE";enPropActor[enPropActor["P_MP_STORE"]=45]="P_MP_STORE";enPropActor[enPropActor["P_SPIRIT"]=46]="P_SPIRIT";enPropActor[enPropActor["P_PK_MOD"]=47]="P_PK_MOD";enPropActor[enPropActor["P_STRONG_EFFECT"]=48]="P_STRONG_EFFECT";enPropActor[enPropActor["P_WING"]=49]="P_WING";enPropActor[enPropActor["P_STAGE_EFFECT"]=50]="P_STAGE_EFFECT";enPropActor[enPropActor["P_PET_HP_STORE"]=51]="P_PET_HP_STORE";enPropActor[enPropActor["PROP_ACTOR_XIUWEI_RENEW_RATE"]=52]="PROP_ACTOR_XIUWEI_RENEW_RATE";enPropActor[enPropActor["P_SEX"]=53]="P_SEX";enPropActor[enPropActor["P_VOCATION"]=54]="P_VOCATION";enPropActor[enPropActor["P_EXP"]=55]="P_EXP";enPropActor[enPropActor["P_PK_VALUE"]=57]="P_PK_VALUE";enPropActor[enPropActor["P_BAG_GRID"]=58]="P_BAG_GRID";enPropActor[enPropActor["P_WEEK_CHARM"]=59]="P_WEEK_CHARM";enPropActor[enPropActor["P_BIND_COIN"]=60]="P_BIND_COIN";enPropActor[enPropActor["P_COIN"]=61]="P_COIN";enPropActor[enPropActor["P_BIND_YB"]=62]="P_BIND_YB";enPropActor[enPropActor["P_YB"]=63]="P_YB";enPropActor[enPropActor["P_SHENGWANG"]=64]="P_SHENGWANG";enPropActor[enPropActor["P_CHARM"]=65]="P_CHARM";enPropActor[enPropActor["P_SPIRIT_SLOT"]=66]="P_SPIRIT_SLOT";enPropActor[enPropActor["P_RENOWN"]=67]="P_RENOWN";enPropActor[enPropActor["P_GUILD_ID"]=68]="P_GUILD_ID";enPropActor[enPropActor["P_TEAM_ID"]=69]="P_TEAM_ID";enPropActor[enPropActor["P_SOCIAL"]=70]="P_SOCIAL";enPropActor[enPropActor["P_GUILD_EXP"]=71]="P_GUILD_EXP";enPropActor[enPropActor["P_LUCKY"]=72]="P_LUCKY";enPropActor[enPropActor["P_SYS_OPEN"]=73]="P_SYS_OPEN";enPropActor[enPropActor["P_ROOT_EXP_POWER"]=74]="P_ROOT_EXP_POWER";enPropActor[enPropActor["P_CHANGE_MODEL"]=75]="P_CHANGE_MODEL";enPropActor[enPropActor["PROP_BANGBANGTANG_EXP"]=76]="PROP_BANGBANGTANG_EXP";enPropActor[enPropActor["P_GIVE_YB"]=77]="P_GIVE_YB";enPropActor[enPropActor["P_CRITICAL_STRIKE"]=78]="P_CRITICAL_STRIKE";enPropActor[enPropActor["P_EXP_RATE"]=79]="P_EXP_RATE";enPropActor[enPropActor["P_DEPOT_GRID"]=80]="P_DEPOT_GRID";enPropActor[enPropActor["P_ANGER"]=81]="P_ANGER";enPropActor[enPropActor["P_ROOT_EXP"]=82]="P_ROOT_EXP";enPropActor[enPropActor["P_ACHIEVEPOINT"]=83]="P_ACHIEVEPOINT";enPropActor[enPropActor["P_ZYCONT"]=84]="P_ZYCONT";enPropActor[enPropActor["P_QQ_VIP"]=85]="P_QQ_VIP";enPropActor[enPropActor["P_WING_ID"]=86]="P_WING_ID";enPropActor[enPropActor["P_WING_SCORE"]=87]="P_WING_SCORE";enPropActor[enPropActor["P_PET_SCORE"]=88]="P_PET_SCORE";enPropActor[enPropActor["PROP_ACTOR_VIPFLAG"]=89]="PROP_ACTOR_VIPFLAG";enPropActor[enPropActor["P_CAMP"]=90]="P_CAMP";enPropActor[enPropActor["P_PET_SLOT"]=91]="P_PET_SLOT";enPropActor[enPropActor["P_HONOR"]=92]="P_HONOR";enPropActor[enPropActor["P_QING_YUAN"]=93]="P_QING_YUAN";enPropActor[enPropActor["PROP_ACTOR_DUR_KILLTIMES"]=94]="PROP_ACTOR_DUR_KILLTIMES";enPropActor[enPropActor["PROP_ACTOR_BASE_FIGHT"]=95]="PROP_ACTOR_BASE_FIGHT";enPropActor[enPropActor["P_FIGHT_VALUE"]=96]="P_FIGHT_VALUE";enPropActor[enPropActor["P_MAX_RENOWN"]=97]="P_MAX_RENOWN";enPropActor[enPropActor["P_RECHARGE"]=98]="P_RECHARGE";enPropActor[enPropActor["P_VIP_LEVEL"]=99]="P_VIP_LEVEL";enPropActor[enPropActor["P_BEAST_LEVEL"]=100]="P_BEAST_LEVEL";enPropActor[enPropActor["P_FOOT_EFFECT"]=101]="P_FOOT_EFFECT";enPropActor[enPropActor["P_EQUIP_SCORE"]=102]="P_EQUIP_SCORE";enPropActor[enPropActor["P_HAIR_MODEL"]=103]="P_HAIR_MODEL";enPropActor[enPropActor["P_BUBBLE"]=104]="P_BUBBLE";enPropActor[enPropActor["P_ACTOR_STATE"]=105]="P_ACTOR_STATE";enPropActor[enPropActor["P_JINGJIE_TITLE"]=106]="P_JINGJIE_TITLE";enPropActor[enPropActor["P_ZHUMOBI"]=107]="P_ZHUMOBI";enPropActor[enPropActor["P_WARSPIRIT"]=108]="P_WARSPIRIT";enPropActor[enPropActor["P_GUILDFB_SCORE"]=109]="P_GUILDFB_SCORE";enPropActor[enPropActor["P_SYS_OPENEX"]=110]="P_SYS_OPENEX";enPropActor[enPropActor["P_MAX_ACTOR"]=111]="P_MAX_ACTOR"})(enPropActor||(enPropActor={}));window["enPropActor"]=enPropActor;var AttributeType;(function(AttributeType){AttributeType[AttributeType["atHp"]=0]="atHp";AttributeType[AttributeType["atMp"]=1]="atMp";AttributeType[AttributeType["atMaxHp"]=2]="atMaxHp";AttributeType[AttributeType["atMaxMp"]=3]="atMaxMp";AttributeType[AttributeType["atAttack"]=4]="atAttack";AttributeType[AttributeType["atDef"]=5]="atDef";AttributeType[AttributeType["atRes"]=6]="atRes";AttributeType[AttributeType["atCrit"]=7]="atCrit";AttributeType[AttributeType["atTough"]=8]="atTough";AttributeType[AttributeType["atMoveSpeed"]=9]="atMoveSpeed";AttributeType[AttributeType["atAttackSpeed"]=10]="atAttackSpeed";AttributeType[AttributeType["atHpEx"]=11]="atHpEx";AttributeType[AttributeType["atAtkEx"]=12]="atAtkEx";AttributeType[AttributeType["atStunPower"]=13]="atStunPower";AttributeType[AttributeType["atStunRes"]=14]="atStunRes";AttributeType[AttributeType["atStunTime"]=15]="atStunTime";AttributeType[AttributeType["atDamageReduction"]=16]="atDamageReduction";AttributeType[AttributeType["atCritHurt"]=17]="atCritHurt";AttributeType[AttributeType["atRegeneration"]=18]="atRegeneration";AttributeType[AttributeType["atCritEnhance"]=19]="atCritEnhance";AttributeType[AttributeType["atPenetrate"]=20]="atPenetrate";AttributeType[AttributeType["atRoleDamageEnhance"]=21]="atRoleDamageEnhance";AttributeType[AttributeType["atRoleDamageReduction"]=22]="atRoleDamageReduction";AttributeType[AttributeType["atDefEx"]=23]="atDefEx";AttributeType[AttributeType["atResEx"]=24]="atResEx";AttributeType[AttributeType["cruNeiGong"]=25]="cruNeiGong";AttributeType[AttributeType["maxNeiGong"]=26]="maxNeiGong";AttributeType[AttributeType["neigongAbsorbHurt"]=27]="neigongAbsorbHurt";AttributeType[AttributeType["atJob1HpEx"]=28]="atJob1HpEx";AttributeType[AttributeType["atJob2HpEx"]=29]="atJob2HpEx";AttributeType[AttributeType["atJob3HpEx"]=30]="atJob3HpEx";AttributeType[AttributeType["atNeiGongRestore"]=31]="atNeiGongRestore";AttributeType[AttributeType["atVamirePro"]=32]="atVamirePro";AttributeType[AttributeType["atVamirePen"]=33]="atVamirePen";AttributeType[AttributeType["atVamireCd"]=34]="atVamireCd";AttributeType[AttributeType["atCursePro"]=35]="atCursePro";AttributeType[AttributeType["atCurseCd"]=36]="atCurseCd";AttributeType[AttributeType["atAttAddDamPro"]=37]="atAttAddDamPro";AttributeType[AttributeType["atAttAddDamVal"]=38]="atAttAddDamVal";AttributeType[AttributeType["atBeAttAddHpPro"]=39]="atBeAttAddHpPro";AttributeType[AttributeType["atBeAttAddHpVal"]=40]="atBeAttAddHpVal";AttributeType[AttributeType["atAttMbAddDamPen"]=41]="atAttMbAddDamPen";AttributeType[AttributeType["atHpLtAddBuff"]=42]="atHpLtAddBuff";AttributeType[AttributeType["atAttHpLtPenAddDam"]=43]="atAttHpLtPenAddDam";AttributeType[AttributeType["atAttHpLtAddDamPen"]=44]="atAttHpLtAddDamPen";AttributeType[AttributeType["atJob1AtkEx"]=45]="atJob1AtkEx";AttributeType[AttributeType["atJob2AtkEx"]=46]="atJob2AtkEx";AttributeType[AttributeType["atJob3AtkEx"]=47]="atJob3AtkEx";AttributeType[AttributeType["atJob1DefEx"]=48]="atJob1DefEx";AttributeType[AttributeType["atJob2DefEx"]=49]="atJob2DefEx";AttributeType[AttributeType["atJob3DefEx"]=50]="atJob3DefEx";AttributeType[AttributeType["atJob1ResEx"]=51]="atJob1ResEx";AttributeType[AttributeType["atJob2ResEx"]=52]="atJob2ResEx";AttributeType[AttributeType["atJob3ResEx"]=53]="atJob3ResEx";AttributeType[AttributeType["atAttPerDamPan"]=54]="atAttPerDamPan";AttributeType[AttributeType["atYuPeiDeterDam"]=55]="atYuPeiDeterDam";AttributeType[AttributeType["atCritEnhanceResist"]=56]="atCritEnhanceResist";AttributeType[AttributeType["atHolyDamege"]=57]="atHolyDamege";AttributeType[AttributeType["atHolyMaster"]=58]="atHolyMaster";AttributeType[AttributeType["atHolyResist"]=59]="atHolyResist";AttributeType[AttributeType["atTogetherHolyDamege"]=60]="atTogetherHolyDamege";AttributeType[AttributeType["atTogetherHolyMaster"]=61]="atTogetherHolyMaster";AttributeType[AttributeType["atTogetherHolyResist"]=62]="atTogetherHolyResist";AttributeType[AttributeType["atZhuiMingPro"]=63]="atZhuiMingPro";AttributeType[AttributeType["atZhuiMingVal"]=64]="atZhuiMingVal";AttributeType[AttributeType["atHuiXinDamage"]=65]="atHuiXinDamage";AttributeType[AttributeType["atNeiGongEx"]=66]="atNeiGongEx";AttributeType[AttributeType["atDeadLyPro"]=67]="atDeadLyPro";AttributeType[AttributeType["atDeadLyMaster"]=68]="atDeadLyMaster";AttributeType[AttributeType["atDeadLyResist"]=69]="atDeadLyResist";AttributeType[AttributeType["atAddEnemyHp"]=70]="atAddEnemyHp";AttributeType[AttributeType["atHurtMyself"]=71]="atHurtMyself";AttributeType[AttributeType["atBladeMailPro"]=72]="atBladeMailPro";AttributeType[AttributeType["atBladeMailPer"]=73]="atBladeMailPer";AttributeType[AttributeType["atDefPen"]=74]="atDefPen";AttributeType[AttributeType["atResPen"]=75]="atResPen";AttributeType[AttributeType["atDeadLyHurt"]=76]="atDeadLyHurt";AttributeType[AttributeType["atDeadLyHurtResist"]=77]="atDeadLyHurtResist";AttributeType[AttributeType["atCritHurtResist"]=78]="atCritHurtResist";AttributeType[AttributeType["atHunGuPro"]=79]="atHunGuPro";AttributeType[AttributeType["atHunGuHurt"]=80]="atHunGuHurt";AttributeType[AttributeType["atHunGuCd"]=81]="atHunGuCd";AttributeType[AttributeType["atHearthDamege"]=82]="atHearthDamege";AttributeType[AttributeType["atHearthHurt"]=83]="atHearthHurt";AttributeType[AttributeType["atHearthCount"]=84]="atHearthCount";AttributeType[AttributeType["atCount"]=85]="atCount"})(AttributeType||(AttributeType={}));window["AttributeType"]=AttributeType;var GameByteArray=function(_super){__extends(GameByteArray,_super);function GameByteArray(){var _this=_super.call(this)||this;_this.endian=egret.Endian.LITTLE_ENDIAN;return _this}GameByteArray.prototype.readString=function(){var s=this.readUTF();this.position+=1;return s};GameByteArray.prototype.readNumber=function(){var i64=new uint64(this);var str=i64.toString();return+str};GameByteArray.prototype.writeNumber=function(val){var i64=uint64.stringToUint64(val.toString());this.writeInt64(i64)};GameByteArray.prototype.writeInt64=function(bigInt){this.writeUnsignedInt(bigInt._lowUint);this.writeUnsignedInt(bigInt._highUint)};GameByteArray.prototype.writeString=function(value){this.writeUTF(value);this.writeByte(0)};GameByteArray.prototype.writeCmd=function(id,subId){this.writeByte(id);this.writeByte(subId)};GameByteArray.prototype.readInts=function(count){var result=[];for(var i=0;i<count;i++){result.push(this.readInt())}return result};GameByteArray.prototype.writeInts=function(){var nums=[];for(var _i=0;_i<arguments.length;_i++){nums[_i]=arguments[_i]}for(var _a=0,nums_1=nums;_a<nums_1.length;_a++){var i=nums_1[_a];this.writeInt(i)}};return GameByteArray}(egret.ByteArray);__reflect(GameByteArray.prototype,"GameByteArray");var EntityModel=function(_super){__extends(EntityModel,_super);function EntityModel(){var _this=_super.call(this)||this;_this.isElite=false;_this.attributeData=[];_this.attributeExData=[];_this.killNum=0;_this.isMy=false;_this.weaponsId=0;_this.isWander=false;_this.lyMarkLv=0;_this.lyMarkSkills=[];_this.type=EntityType.Monster;return _this}EntityModel.prototype.parser=function(bytes){this.parserBase(bytes);if(this.type!=EntityType.CollectionMonst){this.parserAtt(bytes);var count=bytes.readShort();for(var i=0;i<count;i++)bytes.readInt();this.parserLyMark(bytes)}};EntityModel.prototype.parserLyMark=function(bytes){this.lyMarkLv=bytes.readShort();this.lyMarkSkills=[];var len=bytes.readByte();this.lyMarkSkills.length=len;for(var i=0;i<len;i++)this.lyMarkSkills[i]=bytes.readShort()};EntityModel.prototype.parserBase=function(bytes){this.type=bytes.readShort();this.handle=bytes.readDouble();this.configID=bytes.readInt();this.masterHandle=bytes.readDouble();this.x=bytes.readInt();this.y=bytes.readInt();this.isMy=this.checkHandleIsMy(this.masterHandle)};EntityModel.prototype.checkHandleIsMy=function(handle){if(handle==Actor.handle){return true}var roles=SubRoles.ins().roles;for(var _i=0,roles_1=roles;_i<roles_1.length;_i++){var role=roles_1[_i];if(role.handle==handle){return true}}return false};EntityModel.prototype.handleToRoleID=function(handle){if(handle==Actor.handle){return 0}var i=0;var roles=SubRoles.ins().roles;for(var _i=0,roles_2=roles;_i<roles_2.length;_i++){var role=roles_2[_i];if(role.handle==handle){return i}i++}return-1};EntityModel.prototype.parserAtt=function(bytes,showTip){if(showTip===void 0){showTip=false}var count=bytes.readShort();if(showTip){for(var i=0;i<count;i++){var oldValue=this.attributeData[i];this.attributeData[i]=bytes.readDouble();var changeValue=this.attributeData[i]-oldValue;if(oldValue!=this.attributeData[i]&&AttributeData.FILTER_BASE_DATA_ID.lastIndexOf(i)==-1){if(changeValue<=0)continue;if(i<2||i>6){var color=changeValue>0?"03b154":"f3311e";var td=new AttributeData(i,changeValue);if(!AttributeData.getAttrStrByType(td.type))continue;continue}UserTips.ins().showAttrTips(i,changeValue)}}}else{for(var i=0;i<count;i++){this.attributeData[i]=bytes.readDouble()}}};EntityModel.prototype.parserExtAtt=function(bytes,showTip){if(showTip===void 0){showTip=false}var count=bytes.readShort();if(showTip){for(var i=0;i<count;i++){var oldValue=this.attributeExData[i];this.attributeExData[i]=bytes.readInt();if(oldValue!=this.attributeExData[i]&&AttributeData.FILTER_EXTDATA_ID.lastIndexOf(i)==-1){var changeValue=this.attributeExData[i]-oldValue;if(changeValue<=0)continue;var color=changeValue>0?"03b154":"f3311e";var str=changeValue>0?"+":"";var td=new AttributeData(i,changeValue);var str1=i18n("EntityModel_1",color,AttributeData.getExtAttStrByType(td,0));UserTips.ins().showTips2(str1)}}}else{for(var i=0;i<count;i++){this.attributeData[i]=bytes.readInt()}}};EntityModel.prototype.parserHeirloom=function(){};EntityModel.prototype.getAtt=function(attType){return this.attributeData[attType]||0};EntityModel.prototype.setAtt=function(attType,value){this.attributeData[attType]=value};EntityModel.prototype.getExAtt=function(attType){return this.attributeExData[attType]||0};Object.defineProperty(EntityModel.prototype,"avatarFileName",{get:function(){return"monster"+this.avatar},enumerable:true,configurable:true});Object.defineProperty(EntityModel.prototype,"weaponFileName",{get:function(){return""},enumerable:true,configurable:true});Object.defineProperty(EntityModel.prototype,"avatar",{get:function(){return this._avatar||GlobalConfig.MonstersConfig[this.configID].avatar},enumerable:true,configurable:true});Object.defineProperty(EntityModel.prototype,"name",{get:function(){return this._name||GlobalConfig.MonstersConfig[this.configID].name},set:function(str){this._name=str},enumerable:true,configurable:true});EntityModel.prototype.getNameWithServer=function(){return this._servId&&KFServerSys.ins().isKF?this.name+("S"+this._servId):this.name};EntityModel.prototype.getDir=function(){var config=GlobalConfig.MonstersConfig[this.configID];if(!config)return-1;var dir=GlobalConfig.MonstersConfig[this.configID].dir;if(isNaN(dir))return-1;return dir};Object.defineProperty(EntityModel.prototype,"dirNum",{get:function(){var config=GlobalConfig.MonstersConfig[this.configID];if(config){this._dirNum=NaN;if(config.dirNum){return config.dirNum}}if(this._dirNum){return this._dirNum}return 2},enumerable:true,configurable:true});Object.defineProperty(EntityModel.prototype,"avatarScale",{get:function(){var s=this._scale||GlobalConfig.MonstersConfig[this.configID].scale;if(s)return s/100;return 1},enumerable:true,configurable:true});Object.defineProperty(EntityModel.prototype,"avatarEffect",{get:function(){if(GlobalConfig.MonstersConfig[this.configID]&&GlobalConfig.MonstersConfig[this.configID].effect){return GlobalConfig.EffectConfig[GlobalConfig.MonstersConfig[this.configID].effect].fileName}return""},enumerable:true,configurable:true});Object.defineProperty(EntityModel.prototype,"attRange",{get:function(){if(GlobalConfig.MonstersConfig[this.configID].attrange){return GlobalConfig.MonstersConfig[this.configID].attrange}return 0},enumerable:true,configurable:true});Object.defineProperty(EntityModel.prototype,"movePara",{get:function(){if(GlobalConfig.YouDangConfig[this.wandertime]&&this.wanderrange){return[this.wanderrange,GlobalConfig.YouDangConfig[this.wandertime].fileName]}return null},enumerable:true,configurable:true});Object.defineProperty(EntityModel.prototype,"lv",{get:function(){return GlobalConfig.MonstersConfig[this.configID].level},set:function(value){this._lv=value},enumerable:true,configurable:true});EntityModel.prototype.setPos=function(x,y){this.x=x;this.y=y};return EntityModel}(NpcModel);__reflect(EntityModel.prototype,"EntityModel");var RedPointBase=function(_super){__extends(RedPointBase,_super);function RedPointBase(){var _this=_super.call(this)||this;_this.initTabs();return _this}RedPointBase.ins=function(){return _super.ins.call(this)};RedPointBase.prototype.initTabs=function(){this.isOpen=false;this.redpoint=false;this.tabs={};this.toTabs={};this.sumTabs={};this.observe(this.postRedPoint,this.postOpen)};RedPointBase.prototype.registerTab=function(tab){var _this=this;var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}this.tabs[tab]=false;this.associated.apply(this,[function(){return _this.updateTabRedPoint(tab)}].concat(args))};RedPointBase.prototype.registerSum=function(tab,tabs){this.sumTabs[tab]=tabs;for(var _i=0,tabs_1=tabs;_i<tabs_1.length;_i++){var t=tabs_1[_i];if(this.toTabs[t])this.toTabs[t].push(tab);else this.toTabs[t]=[tab]}};RedPointBase.prototype.registerOpen=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.associated.apply(this,[this.postOpen].concat(args))};RedPointBase.prototype.postOpen=function(){var oldv=this.isOpen;this.isOpen=this.getIsOpen();if(this.isOpen&&oldv!=this.isOpen){var keys=Object.keys(this.tabs);for(var i=0;i<keys.length;i++){var tab=+keys[i];this.updateTabRedPoint(tab)}}return this.isOpen!=oldv};RedPointBase.prototype.postRedPoint=function(){if(!this.isOpen){if(this.redpoint){this.redpoint=false;return true}else{return false}}var oldv=this.redpoint;this.redpoint=this.and();return this.redpoint!=oldv};RedPointBase.prototype.postTabs=function(tab){return tab};RedPointBase.prototype.getRedPoint=function(tab){return this.tabs[tab]};RedPointBase.prototype.updateTabRedPoint=function(tab){if(!this.isOpen)return;var oldv=this.tabs[tab];this.tabs[tab]=this.getTabRedPoint(tab);if(this.tabs[tab]!=oldv){this.sendTabs(tab)}};RedPointBase.prototype.sendTabs=function(tab){this.postTabs(tab);var toTabs=this.toTabs[tab];if(toTabs){for(var _i=0,toTabs_1=toTabs;_i<toTabs_1.length;_i++){var t=toTabs_1[_i];var oldv=this.tabs[t];this.tabs[t]=this.andTabs(this.sumTabs[t]);if(this.tabs[t]!=oldv){this.postTabs(t)}}}this.postRedPoint()};RedPointBase.prototype.and=function(){for(var k in this.tabs){if(this.tabs[k])return true}return false};RedPointBase.prototype.andTabs=function(tabs){for(var k in tabs){if(this.getRedPoint(tabs[k]))return true}return false};RedPointBase.prototype.andList=function(list){for(var k in list){if(list[k])return true}return false};RedPointBase.prototype.getTabRedPoint=function(tab){return false};RedPointBase.prototype.getIsOpen=function(){return true};return RedPointBase}(BaseSystem);__reflect(RedPointBase.prototype,"RedPointBase");var ActivityType1Config=function(){function ActivityType1Config(){}return ActivityType1Config}();__reflect(ActivityType1Config.prototype,"ActivityType1Config");var ActivityType28_1Config=function(){function ActivityType28_1Config(){}return ActivityType28_1Config}();__reflect(ActivityType28_1Config.prototype,"ActivityType28_1Config");var ActivityType9Config=function(){function ActivityType9Config(){}return ActivityType9Config}();__reflect(ActivityType9Config.prototype,"ActivityType9Config");var ExRing0Config=function(){function ExRing0Config(){this.power=0}return ExRing0Config}();__reflect(ExRing0Config.prototype,"ExRing0Config");var ExRingAttrConfig=function(){function ExRingAttrConfig(){this.level=0;this.costItem=0;this.cost=0;this.attrAward=[];this.extAttrAward=[];this.upPower=0;this.addPower=0;this.judgeup=0;this.SpecialRingSkin=""}return ExRingAttrConfig}();__reflect(ExRingAttrConfig.prototype,"ExRingAttrConfig");var ItemBase=function(_super){__extends(ItemBase,_super);function ItemBase(){var _this=_super.call(this)||this;_this.showSpeicalDetail=true;_this.isOpenSelectImg=false;_this.isCurrency=false;_this.showName=false;_this.showVip=false;_this.showQzVip=false;_this.showDaTVip=false;_this.skinName="ItemSkin";_this.init();return _this}ItemBase.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};ItemBase.prototype.setVip=function(b){this.vip.visible=b;this.showVip=b};ItemBase.prototype.setQzVip=function(b){this.Qzvip.visible=b;this.showQzVip=b};ItemBase.prototype.setDatHighVip=function(b){this.DaTvip.visible=b;this.showDaTVip=b;this.DaTvip.source="hhlztips"};ItemBase.prototype.setDatYearVip=function(b){this.DaTvip.visible=b;this.showDaTVip=b;this.DaTvip.source="nflztips"};ItemBase.prototype.setSoul=function(isSoul){this.itemIcon.setSoul(isSoul)};ItemBase.prototype.setItemImg=function(str){this.itemIcon.imgIcon.source=str};ItemBase.prototype.setItemHeirloomBgImg=function(v,path){if(path)this.itemIcon.imgheirloom.source=path+"_png";this.itemIcon.imgheirloom.visible=v};ItemBase.prototype.setDataByConfig=function(config,nText){if(!config)return;if(this.itemIcon&&typeof this.itemIcon.setData=="function"){this.itemIcon.setData(config)}var type=ItemConfig.getType(config);if(type==ItemType.TYPE_0&&config.descIndex!=248&&!this.showName){var nameStr=isNaN(config.zsLevel)?(config.level||1)+i18n("ItemBase_1"):config.zsLevel+i18n("ItemBase_0");this.nameTxt.text=nameStr;if(UserBag.fitleEquip.indexOf(config.id)!=-1){this.nameTxt.text=i18n("ItemBase_2");this.nameTxt.textColor=ItemConfig.getQualityColor(config);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(config)}}else{this.nameTxt.text=nText?nText:config.name;this.nameTxt.textColor=ItemConfig.getQualityColor(config);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(config)}if(this.num!=undefined){this.setCount(this.num+"")}if(type==ItemType.TYPE_12)this.redPoint.visible=this.getGuildGift(config)};ItemBase.prototype.dataChanged=function(){this.clear();var checkRedPoint=false;this.redPoint.visible=false;if(this.vip){this.vip.visible=this.showVip}if(this.Qzvip){this.Qzvip.visible=this.showQzVip}if(this.DaTvip){this.DaTvip.visible=this.showDaTVip}if(!this.data){console.log("ItemBase dataChanged this.data = "+this.data);return}var _ItemConfig=GlobalConfig.getConfigByName("ItemConfig");if(!isNaN(this.data)){this.itemConfig=_ItemConfig[this.data];this.setDataByConfig(this.itemConfig,this.runeName)}else if(this.data instanceof ItemData){this.itemConfig=this.data.itemConfig;if(!this.itemConfig)return;this.setDataByConfig(this.itemConfig);this.data.count>1?this.setCount(this.data.count+""):this.setCount("");checkRedPoint=true}else{if(this.data.type==0){this.itemIcon.imgIcon.source=RewardData.getCurrencyRes(this.data.id);var type=1;switch(this.data.id){case MoneyConst.yuanbao:type=5;break;case MoneyConst.gold:type=0;break;case MoneyConst.soul:case MoneyConst.chip:type=2;break;case MoneyConst.piece:type=2;this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[this.data.id];break;case MoneyConst.godweaponExp:type=2;break;default:break}this.isCurrency=true;this.itemIcon.imgBg.source="quality"+type;this.nameTxt.text=RewardData.getCurrencyName(this.data.id);this.nameTxt.textColor=ItemBase.QUALITY_COLOR[type];this.nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[type];var count=this.data.count;count!=undefined&&count>1?this.setCount(count+""):this.setCount("")}else if(this.data.type==1){this.itemConfig=_ItemConfig[this.data.id];if(!this.itemConfig)return;this.setDataByConfig(this.itemConfig);var count=this.data.count;count>1?this.setCount(count+""):this.setCount("")}else if(this.data.type==6){this.itemConfig=_ItemConfig[this.data.id];this.setDataByConfig(this.itemConfig);var count=this.data.count;count!=undefined&&count>1?this.setCount(count+""):this.setCount("")}}if(!this.redPoint.visible)this.redPoint.visible=this.data.canbeUsed;this.showEquipEffect();if(checkRedPoint){if(this.itemConfig){if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_8||ItemConfig.getType(this.itemConfig)==ItemType.TYPE_27){var boo=true;if(this.itemConfig.id==ItemConst.EXP_ITEM)boo=Actor.level>=65;this.redPoint.visible=this.data&&this.data.count>0&&boo;if(this.itemConfig.descIndex==814){if(nPChapterGiftSys.ins().isCangetchapterGift())this.redPoint.visible=true;else this.redPoint.visible=false}if(this.itemConfig.id==ItemConst.LEVELUP_ITEM){this.redPoint.visible=true}}else if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_17){this.redPoint.visible=true}else if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_20){this.redPoint.visible=this.data.canbeUsed}else if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_25){this.redPoint.visible=true}else{var TeamFuBenBaseConfig_1=GlobalConfig.getConfigByName("TeamFuBenBaseConfig");if(this.itemConfig.id==TeamFuBenBaseConfig_1.itemId){this.redPoint.visible=true}else{var ItemComposeConfig=GlobalConfig.getConfigByName("ItemComposeConfig");var composeConf=ItemComposeConfig[this.itemConfig.id];if(composeConf&&composeConf.srcCount<=this.data.count){this.redPoint.visible=true}}}}}this.setSelect(this.selected);this.dataChangeHandler()};ItemBase.prototype.dataChangeHandler=function(){};ItemBase.prototype.clear=function(){this.itemConfig=null;if(this.itemIcon&&typeof this.itemIcon.setData=="function")this.itemIcon.setData(null);this.count.text="";this.nameTxt.text="";this.nameTxt.textColor=14668213;DisplayUtils.removeFromParent(this.EquipEffect)};ItemBase.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};ItemBase.prototype.isShowJob=function(b){this.itemIcon.imgJob.visible=b};ItemBase.prototype.onClick=function(){this.showCurrency();this.showDetail()};ItemBase.prototype.getItemType=function(){if(!this.itemConfig)return-1;else return ItemConfig.getType(this.itemConfig)};ItemBase.prototype.showCurrency=function(){if(!this.isCurrency)return;switch(this.data.id){case MoneyConst.yuanbao:case MoneyConst.feat:case MoneyConst.godweaponExp:ViewManager.ins().open(ItemCurrencyWin,this.data.id,this.data.count);break}};ItemBase.prototype.showDetail=function(){if(!this.itemConfig)return;var TeamFuBenBaseConfig=GlobalConfig.getConfigByName("TeamFuBenBaseConfig");if(this.itemConfig.id==TeamFuBenBaseConfig.itemId){ViewManager.ins().open(FlowerUseTipsWin);return}switch(ItemConfig.getType(this.itemConfig)){case ItemType.TYPE_0:case ItemType.TYPE_4:this.openEquipsTips();break;case ItemType.TYPE_5:ViewManager.ins().open(HejiEquipTipsWin,this.data,false,true);break;case ItemType.TYPE_1:var ItemComposeConfig=GlobalConfig.getConfigByName("ItemComposeConfig");var ShenShouConfig=GlobalConfig.getConfigByName("ShenShouConfig");if(this.data.handle&&ItemComposeConfig[this.itemConfig.id]){ViewManager.ins().open(ItemUseTipsWin,this.data)}else if(this.data.handle&&this.itemConfig.id==ShenShouConfig.battleCountItem){ViewManager.ins().open(ShenshouDanUseWin,this.itemConfig)}else if(this.data.handle&&this.itemConfig.id==Dress.ins().getIdZhuangBanId(this.itemConfig.id)){ViewManager.ins().open(DressTipsWin,this.itemConfig,0)}else if(this.data.handle&&Dress.ins().isTrival(this.itemConfig.id)){ViewManager.ins().open(DressTipsWin,this.itemConfig,1)}else if(this.data.handle&&this.itemConfig.id==SwordSkinMgr.ins().getIdSwordSkinId(this.itemConfig.id)){ViewManager.ins().open(SwordSkinTipsWin,this.itemConfig,0)}else if(this.data.handle&&SwordSkinMgr.ins().isTrival(this.itemConfig.id)){ViewManager.ins().open(SwordSkinTipsWin,this.itemConfig,1)}else{ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count)}break;case ItemType.TYPE_2:if(this.data.handle)ViewManager.ins().open(ItemUseTipsWin,this.data);else{if(this.data.count)ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count);else ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id)}break;case ItemType.TYPE_6:ViewManager.ins().open(RuneTipsWin,0,this.itemConfig.id,this.desc,this.desc2);break;case ItemType.TYPE_9:ViewManager.ins().open(BookTipsWin,this.itemConfig.id,0,this.data.handle);break;case ItemType.TYPE_10:case ItemType.TYPE_28:if(this.data.handle){ViewManager.ins().open(ItemUseTipsWin,this.data)}else{ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id)}break;case ItemType.TYPE_8:case ItemType.TYPE_20:case ItemType.TYPE_27:if(this.data.type==1){ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count)}else{var count=+this.count.text;this.showSpeicalDetail=false;var parentDisplay_1=this.parent;while(parentDisplay_1&&parentDisplay_1.parent){parentDisplay_1=parentDisplay_1.parent;if(parentDisplay_1 instanceof BagWin){this.showSpeicalDetail=true;break}}if(this.showSpeicalDetail){ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:count})}else{ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,count)}}break;case ItemType.TYPE_12:if(!this.data.itemConfig){ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:this.data.count},true)}else if(this.getGuildGift(this.data)){ViewManager.ins().open(ItemUseTipsWin,this.data)}else{ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:this.data.count},true)}break;case ItemType.TYPE_11:var HeirloomEquipItemConfig_1=GlobalConfig.getConfigByName("HeirloomEquipItemConfig");for(var k in HeirloomEquipItemConfig_1){var hcfg=HeirloomEquipItemConfig_1[k];if(hcfg&&hcfg.item==this.itemConfig.id){ViewManager.ins().open(HeirloomEquipTipsWin,null,hcfg.pos-1);break}}break;case ItemType.TYPE_13:case ItemType.TYPE_14:if(this.data.type==ItemType.TYPE_1){ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count)}else{ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:this.data.count})}break;case ItemType.TYPE_15:ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data?this.data.count:undefined);break;case ItemType.TYPE_16:var GodWingItemConfig_1=GlobalConfig.getConfigByName("GodWingItemConfig");var gwConfig=GodWingItemConfig_1[this.itemConfig.id];ViewManager.ins().open(GodWingTipsWin,gwConfig);break;case ItemType.TYPE_17:this.showSpeicalDetail=false;var parentDisplay=this.parent;while(parentDisplay&&parentDisplay.parent){parentDisplay=parentDisplay.parent;if(parentDisplay instanceof BagWin){this.showSpeicalDetail=true;break}}ViewManager.ins().open(this.showSpeicalDetail?TreasureChuanshiGiftWin:ItemDetailedWin,0,this.itemConfig.id,this.data.count);break;case ItemType.TYPE_19:ViewManager.ins().open(ExtremeEquipTipsWin,ItemConfig.getSubType(this.itemConfig));break;case ItemType.TYPE_21:ZhanLing.ins().ZhanLingItemTips(this.itemConfig.id);break;case ItemType.TYPE_22:ViewManager.ins().open(ZhanlingZBTipWin,this.itemConfig.id);break;case ItemType.TYPE_23:ViewManager.ins().open(ShenshouEquipTip,0,0,this.itemConfig.id);break;case ItemType.TYPE_24:ViewManager.ins().open(HunguTipsWin,false,0,this.itemConfig.id);break;case ItemType.TYPE_25:ViewManager.ins().open(ItemUseTipsWin,this.data);break;case ItemType.TYPE_26:ViewManager.ins().open(ShapeshiftingTips,this.itemConfig);break;default:ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id)}};ItemBase.prototype.getGuildGift=function(config){var level=0;if(config instanceof ItemConfig){level=config.level}else if(config instanceof ItemData){var _ItemConfig=GlobalConfig.getConfigByName("ItemConfig");var cfg=_ItemConfig[config._configID];level=cfg.level}if(Actor.level>=level&&Guild.ins().guildID!=0){return true}else{return false}};ItemBase.prototype.setCount=function(str){if(str.length>4){var wNum=Math.floor(Number(str)/1e3);str=wNum/10+i18n("ItemBase_3")}this.count.text=str};ItemBase.prototype.openEquipsTips=function(){var subType=ItemConfig.getSubType(this.itemConfig);if(subType>=EquipPos.HAT&&subType<=EquipPos.SHIELD){ViewManager.ins().open(SamsaraEquipTips,this.itemConfig.id)}else{ViewManager.ins().open(EquipDetailedWin,1,this.data.handle,this.itemConfig.id,this.data)}};ItemBase.prototype.isShowName=function(b){this.nameTxt.visible=b};ItemBase.prototype.getItemSoure=function(){var str="";if(this.data.type==0){str=RewardData.getCurrencyRes(this.data.id)}else{str=this.itemIcon.config.icon+"_png"}return str};ItemBase.prototype.getText=function(){return this.nameTxt.text};ItemBase.prototype.getTextColor=function(){return this.nameTxt.textColor};ItemBase.prototype.showEquipEffect=function(){this.equipEffect.removeChildren();var quality=ItemConfig.getQuality(this.itemConfig);var type=ItemConfig.getType(this.itemConfig);if(!this.itemConfig&&this.data.id!=MoneyConst.yuanbao)return;var effectName="";this.EquipEffect=this.EquipEffect||new MovieClip;this.EquipEffect.touchEnabled=false;this.EquipEffect.x=this.equipEffect.width/2;this.EquipEffect.y=this.equipEffect.height/2;this.EquipEffect.scaleX=this.equipEffect.width/76;this.EquipEffect.scaleY=this.equipEffect.height/76;if(this.data.id==MoneyConst.yuanbao){effectName="quaeff6"}else if(quality==3){effectName="quality3_eff";this.EquipEffect.scaleX=this.equipEffect.width/76*1.1;this.EquipEffect.scaleY=this.equipEffect.height/76*1.1}else if(quality==4){effectName="quality4_eff";this.EquipEffect.scaleX=this.equipEffect.width/76*1.1;this.EquipEffect.scaleY=this.equipEffect.height/76*1.1}else if(quality==5){effectName="chuanqizbeff";this.EquipEffect.scaleX=this.equipEffect.width/76*1.1;this.EquipEffect.scaleY=this.equipEffect.height/76*1.1}if(effectName){this.equipEffect.addChild(this.EquipEffect);this.EquipEffect.playFile(RES_DIR_EFF+effectName,-1)}};ItemBase.prototype.clearEffect=function(){DisplayUtils.removeFromParent(this.EquipEffect);this.EquipEffect=null};ItemBase.prototype.HideImgBg=function(){this.itemIcon.imgBg.visible=false};ItemBase.prototype.showNum=function(isShow){this.count.visible=isShow};ItemBase.prototype.setImgBg=function(type){this.itemIcon.imgBg.source="quality"+type};ItemBase.prototype.getItemIcon=function(){return this.itemIcon};ItemBase.prototype.setSelect=function(selected){if(this.isOpenSelectImg){this.selectFrame.visible=selected}};ItemBase.prototype.hideName=function(){this.nameTxt.visible=false};ItemBase.prototype.setName=function(src){this.nameTxt.textFlow=TextFlowMaker.generateTextFlow1(src)};ItemBase.prototype.setImgBg1=function(res){this.itemIcon.setImgBg1(res)};ItemBase.QUALITY_COLOR=[16777215,8161491,14502316,13728052,16733802,15203915];ItemBase.QUALITY_STROKE_COLOR=[4605509,1192009,4657737,4795666,4788769,4798226];ItemBase.additionRange=15;return ItemBase}(BaseItemRender);__reflect(ItemBase.prototype,"ItemBase");var Actor=function(_super){__extends(Actor,_super);function Actor(){var _this=_super.call(this)||this;_this._power=0;_this._gold=0;_this._yb=0;_this._feats=0;_this._togeatter1=-1;_this._togeatter2=-1;_this._weiWang=0;_this._chip=0;_this.isFirstEnter=false;_this.sysId=PackageID.Default;_this.regNetMsg(1,_this.postInit);_this.regNetMsg(7,_this.postExp);_this.regNetMsg(38,_this.postSyncGuideStep);return _this}Actor.ins=function(){return _super.ins.call(this)};Actor.prototype.postExp=function(bytes){var lastLV=this._level;this._level=bytes.readInt();this._exp=bytes.readInt();var exp=bytes.readInt();if(lastLV<this._level){this.postLevelChange();ReportData.getIns().roleUp();var char=EntityManager.ins().getNoDieRole();if(!char)return;var mc=new MovieClip;mc.playFile(RES_DIR_EFF+"levelUpEffect",1);char.addChild(mc)}return exp};Actor.prototype.postInit=function(bytes){Actor.handle=bytes.readDouble();Actor.actorID=bytes.readInt();GameServer.serverID=bytes.readInt();this.postNameChange(bytes.readUTFBytes(33));this._level=bytes.readInt();this._exp=bytes.readInt();bytes.readDouble();this.postGoldChange(bytes.readNumber());this.postYbChange(bytes.readNumber());UserVip.ins().lv=bytes.readInt();this.postSoulChange(bytes.readNumber());UserBag.ins().bagNum=bytes.readInt();this.postFeatsChange(bytes.readNumber());Actor.runeShatter=bytes.readNumber();Actor.runeExchange=bytes.readNumber();this.postUpdateTogeatter(bytes.readNumber(),1);this.postUpdateTogeatter(bytes.readNumber(),2);this.postWeiWang(bytes.readInt());var chapter_scene_id=bytes.readInt();var mapName=GlobalConfig.ScenesConfig[chapter_scene_id].mapfilename;var mapUrl=""+MAP_DIR+mapName+"/small.jpg";console.log(mapUrl);RES.getResByUrl(mapUrl,function(){},undefined);SysSetting.ins().init();if(ChannelMgr.ins().isDouYinChannel()){if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2,Actor.myName)}}else if(ChannelMgr.ins().isQuickH5SDKChannel()){if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}ChannelMgr.ins().channelReport(3)}else if(ChannelMgr.ins().isDuoYouChannel()){ChannelMgr.ins().channelReport(1);if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}}else if(ChannelMgr.ins().isTongChengChannel()){ChannelMgr.ins().channelReport(1);if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}}else if(ChannelMgr.ins().isDouYuChannel()){ChannelMgr.ins().channelReport(1);if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}sqsdk=window["SQ_SDK"];var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var data={server_name:LocationProperty.srvName,game_id:obj["game_id"],sid:LocationProperty.srvid};sqsdk.log(data)}else if(ChannelMgr.ins().isQQSmallGameChannel()){if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}ChannelMgr.ins().channelReport(3)}else if(ChannelMgr.ins().isWXSmallGameChannel()){if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}this.isFirstEnter=true}else if(ChannelMgr.ins().isDiMaiChannel()){ChannelMgr.ins().channelReport(1);if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2,"1605000706")}this.isFirstEnter=true}else if(ChannelMgr.ins().isAnQiGeChannel()){ChannelMgr.ins().channelReport(3,"createRole")}else if(ChannelMgr.ins().isChongChongChannel()){ChannelMgr.ins().channelReport(1);if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}ChannelMgr.ins().channelReport(3)}else if(ChannelMgr.ins().isMeiShengYuanChannelH5()){ChannelMgr.ins().channelReport(1);if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}}else if(ChannelMgr.ins().isFKYLCChannel()){if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}}else if(ChannelMgr.ins().isAWYCChannel()){if(LocationProperty.isCreated){ChannelMgr.ins().channelReport(2)}ChannelMgr.ins().channelReport(3)}else if(ChannelMgr.ins().isJuHeAppChannel()){ChannelMgr.ins().channelReport(3)}else if(!ChannelMgr.ins().isYiYouChannel()){ChannelMgr.ins().channelReport()}ReportData.getIns().enterGame();if(ChannelMgr.ins().isQQZoneChannel()){QzoneSys.ins().sendQQzoneInfo()}if(ChannelMgr.ins().isQQDaTingChannel()){QQDaTingSys.ins().sendQQDaTingInfo()}};Actor.prototype.postNameChange=function(value){if(this._myName!=value){this._myName=value}};Actor.prototype.postGoldChange=function(value){if(this._gold!=value){if(this._gold>0){var addGold=value-this._gold;if(addGold>0){var str=i18n("Actor_0",addGold);UserTips.ins().showTips2(str)}}this._gold=value}};Actor.prototype.postYbChange=function(value){if(this._yb!=value){if(this._yb>0){var addYB=value-this._yb;if(addYB>0){var str=i18n("Actor_1",addYB);UserTips.ins().showTips2(str)}}this._yb=value}};Actor.prototype.postFeatsChange=function(value){if(this._feats!=value){if(this._feats>0){var u64=value-this._feats;var addFeats=parseInt(u64.toString());if(addFeats>0){var str=i18n("Actor_2",addFeats);UserTips.ins().showTips2(str)}}this._feats=value}};Actor.prototype.postZsExpChange=function(value){var str=i18n("Actor_3",value);UserTips.ins().showTips2(str)};Actor.prototype.postUpdateTogeatter=function(value,type){var oldValue=0;if(type==1){oldValue=this._togeatter1}else{oldValue=this._togeatter2}if(oldValue!=value){if(oldValue!=-1){var addValue=value-oldValue;if(addValue>0){var name_2=type==1?RewardData.getCurrencyName(MoneyConst.punch1):RewardData.getCurrencyName(MoneyConst.punch2);var str=i18n("Actor_4",addValue,name_2);UserTips.ins().showTips2(str)}}oldValue=value}if(type==1){this._togeatter1=oldValue}else{this._togeatter2=oldValue}return{value:value,type:type}};Actor.prototype.postLevelChange=function(){if(ChannelMgr.ins().isDiMaiChannel()){var levelupTime=GameServer.serverTime/1e3;ChannelMgr.ins().channelReport(4,"1605000706",levelupTime);return}if(ChannelMgr.ins().isAnQiGeChannel()){ChannelMgr.ins().channelReport(4,"levelUp")}if(ChannelMgr.ins().isWXSmallGameChannel()){ChannelMgr.ins().channelReport(4)}if(ChannelMgr.ins().isDouYuChannel()){ChannelMgr.ins().channelReport(4)}if(ChannelMgr.ins().isTongChengChannel()){ChannelMgr.ins().channelReport(4)}if(ChannelMgr.ins().isQuickH5SDKChannel()){ChannelMgr.ins().channelReport(4)}if(ChannelMgr.ins().isDuoYouChannel()){ChannelMgr.ins().channelReport(4)}};Actor.prototype.postSoulChange=function(value){if(this._soul>0){var addSoul=value-this._soul;if(addSoul>0){var str=i18n("Actor_5",addSoul);UserTips.ins().showTips2(str)}}this._soul=value};Actor.prototype.postPowerChange=function(value,temp){if(temp===void 0){temp=1}if(this._power!=value&&temp!=0){if(this._power>0){UserTips.ins().showBoostPower(value,this._power)}this._power=value;if(ChannelMgr.ins().isQQSmallGameChannel()){if(window["isPrd"]){var openid=ChannelNet.ins().getOpenId();var env=window["qq"];var list={power:value.toString()};var arr=new Array;arr.push(list);console.log("qq.setUserCloudStorage, openid:"+openid+" power:"+value);env.setUserCloudStorage({KVDataList:arr,success:function(){console.log("qq.setUserCloudStorage success, openid:"+openid+" power:"+value)},fail:function(){console.log("qq.setUserCloudStorage fail, openid:"+openid+" power:"+value)},complete:function(){console.log("qq.setUserCloudStorage complete, openid:"+openid+" power:"+value)}})}}}};Actor.prototype.postWeiWang=function(value){if(this._weiWang>0&&value-this._weiWang>0)UserTips.ins().showTips2(i18n("Actor_6",value-this._weiWang,RewardData.getCurrencyName(MoneyConst.weiWang)));this._weiWang=value};Actor.prototype.sendSyncGuideStep=function(guide_name,guide_step,isLogin){if(guide_step===void 0){guide_step=0}if(isLogin===void 0){isLogin=0}var bytes=this.getBytes(35);bytes.writeString(guide_name);bytes.writeInt(guide_step);bytes.writeByte(isLogin);this.sendToServer(bytes)};Actor.prototype.postSyncGuideStep=function(bytes){var guide_name=bytes.readString();var guide_step=bytes.readInt();var isLogin=bytes.readByte();if(guide_name=="MijiGuide"){MijiGuideMgr.ins().setStep(guide_step,isLogin)}if(guide_name=="DressGuide"){DressGuideMgr.ins().setStep(guide_step,isLogin)}};Actor.prototype.postChip=function(value){if(this._chip>0&&value-this._chip>0)UserTips.ins().showTips2(i18n("Actor_7",value-this._chip,RewardData.getCurrencyName(MoneyConst.chip)));this._chip=value};Actor.canZhuanSheng=function(){return this.ins()._level>=this.zhuanShengLv};Object.defineProperty(Actor,"level",{get:function(){return this.ins()._level},enumerable:true,configurable:true});Object.defineProperty(Actor,"exp",{get:function(){return this.ins()._exp},enumerable:true,configurable:true});Object.defineProperty(Actor,"power",{get:function(){return this.ins()._power},enumerable:true,configurable:true});Object.defineProperty(Actor,"myName",{get:function(){return this.ins()._myName},enumerable:true,configurable:true});Object.defineProperty(Actor,"gold",{get:function(){return this.ins()._gold},enumerable:true,configurable:true});Object.defineProperty(Actor,"yb",{get:function(){return this.ins()._yb},enumerable:true,configurable:true});Object.defineProperty(Actor,"soul",{get:function(){return this.ins()._soul},enumerable:true,configurable:true});Object.defineProperty(Actor,"feats",{get:function(){return this.ins()._feats},enumerable:true,configurable:true});Object.defineProperty(Actor,"togeatter1",{get:function(){return this.ins()._togeatter1<0?0:this.ins()._togeatter1},enumerable:true,configurable:true});Object.defineProperty(Actor,"togeatter2",{get:function(){return this.ins()._togeatter2<0?0:this.ins()._togeatter2},enumerable:true,configurable:true});Object.defineProperty(Actor,"samsaraLv",{get:function(){var data=SamsaraModel.ins().samsaraInfo;return data?data.lv:0},enumerable:true,configurable:true});Object.defineProperty(Actor,"weiWang",{get:function(){return this.ins()._weiWang},enumerable:true,configurable:true});Object.defineProperty(Actor,"chip",{get:function(){return this.ins()._chip},enumerable:true,configurable:true});Actor.zhuanShengLv=80;Actor.runeShatter=0;Actor.runeExchange=0;return Actor}(BaseSystem);__reflect(Actor.prototype,"Actor");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.actor=Actor.ins.bind(Actor)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ByteArrayMsg=function(){function ByteArrayMsg(){this._msgBuffer=new egret.ByteArray}ByteArrayMsg.prototype.receive=function(socket){socket.readBytes(this._msgBuffer);var obj=this.decode(this._msgBuffer);if(obj){MessageCenter.ins().dispatch(obj.key,obj.body)}if(this._msgBuffer.bytesAvailable==0){this._msgBuffer.clear()}};ByteArrayMsg.prototype.send=function(socket,msg){var obj=this.encode(msg);if(obj){obj.position=0;socket.writeBytes(obj,0,obj.bytesAvailable)}};ByteArrayMsg.prototype.decode=function(msg){Log.trace(i18n("ByteArrayMsg_0"));return null};ByteArrayMsg.prototype.encode=function(msg){Log.trace(i18n("ByteArrayMsg_1"));return null};return ByteArrayMsg}();__reflect(ByteArrayMsg.prototype,"ByteArrayMsg",["BaseMsg"]);var UTFMsg=function(){function UTFMsg(){}UTFMsg.prototype.receive=function(socket){var msg=socket.readUTF();var obj=this.decode(msg);if(obj){MessageCenter.ins().dispatch(obj.key,obj.body)}};UTFMsg.prototype.send=function(socket,msg){var obj=this.encode(msg);if(obj){socket.type=egret.WebSocket.TYPE_STRING;socket.writeUTF(obj)}};UTFMsg.prototype.decode=function(msg){Log.trace(i18n("UTFMsg_0"));return null};UTFMsg.prototype.encode=function(msg){Log.trace(i18n("UTFMsg_1"));return null};return UTFMsg}();__reflect(UTFMsg.prototype,"UTFMsg",["BaseMsg"]);var CharMonster=function(_super){__extends(CharMonster,_super);function CharMonster(){var _this=_super.call(this)||this;_this.AI_STATE=AI_State.Stand;_this.filterDic={};_this.publicCD=0;_this.nextPatrolTick=0;_this.myKill=false;_this.isShowBody=true;_this.canMove=false;_this.moveTo={x:-1,y:-1};_this.jumping=false;_this.onDeadCalled=false;_this.moveRange=-1;_this.moveLimTime=-1;_this.moveMaxTime=-1;_this.touchEnabled=true;_this.touchChildren=false;_this.buffList={};_this.buffEff={};_this.damageOverTimeList={};_this.createTweenObj();_this.effs={};_this.addShadow();_this._hpBar=new eui.ProgressBar;_this._hpBar.skinName="bloodBarSkin";_this._hpBar.anchorOffsetY=0;_this._hpBar.labelDisplay.size=14;_this._hpBar.visible=false;_this._hpBar.labelDisplay.visible=false;_this._hpBar.labelFunction=function(){return""};_this.titleContainer.addChild(_this._hpBar);_this._hpBar.anchorOffsetX=_this._hpBar.width>>1;_this._nameGroup=new eui.Group;_this._nameGroup.touchEnabled=false;_this._nameGroup.height=30;_this._nameGroup.width=260;_this._nameGroup.anchorOffsetY=Math.floor(_this._nameGroup.height+2);_this._nameGroup.anchorOffsetX=Math.floor(_this._nameGroup.width>>1);_this.titleContainer.addChild(_this._nameGroup);_this._nameTxt=new eui.Label;_this._nameTxt.textAlign="center";_this._nameTxt.size=14;_this._nameTxt.stroke=1;_this._nameTxt.strokeColor=0;_this._nameTxt.textColor=15589033;_this._nameTxt.bottom=0;_this._nameTxt.horizontalCenter=0;_this._nameGroup.addChild(_this._nameTxt);_this._nameGroup.visible=false;return _this}CharMonster.prototype.isJumping=function(){return this.jumping};CharMonster.prototype.createTweenObj=function(){var self=this;this.dieTweenObj={set alpha(al){self.alpha=al},get alpha(){return self.alpha}};this.moveTweenObj={set x(x){self.x=x>>0},set y(y){self.y=y>>0},get x(){return self.x},get y(){return self.y}}};Object.defineProperty(CharMonster.prototype,"infoModel",{get:function(){return this._infoModel},set:function(model){this._infoModel=model;if(GlobalConfig.FlameStamp.monsterId.indexOf(model.configID)!=-1){if(!this._lyMark)this._lyMark=new LyMarkEffect(this._body,model)}else if(this._lyMark)this.clearLyMark()},enumerable:true,configurable:true});CharMonster.prototype.setCharName=function(str){this._nameTxt.textFlow=TextFlowMaker.generateTextFlow(str)};CharMonster.prototype.setNameTxtColor=function(value){this._nameTxt.textColor=value};CharMonster.prototype.usedLyMarkSkill=function(){if(this._lyMark)this._lyMark.usedLyMarkSkill()};CharMonster.prototype.playAction=function(action,callBack,specifiedFrame,specifiedAct){if(specifiedFrame===void 0){specifiedFrame=undefined}if(specifiedAct===void 0){specifiedAct=undefined}if(this._state==action&&this.specifiedFrame==specifiedFrame&&this.specifiedAct==specifiedAct&&!this.isAtkAction())return;if(this.hasFilter(EntityFilter.hard)&&action!=EntityAction.DIE){return}if(action==EntityAction.HIT||action==EntityAction.DIE){if(this.infoModel.type==EntityType.Monster&&GlobalConfig.MonstersConfig[this.infoModel.configID]&&GlobalConfig.MonstersConfig[this.infoModel.configID].type==4){return}}_super.prototype.playAction.call(this,action,callBack,specifiedFrame,specifiedAct)};CharMonster.prototype.stopMove=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.canMove=false;egret.Tween.removeTweens(this.moveTweenObj)};Object.defineProperty(CharMonster.prototype,"dir",{get:function(){if(this.infoModel){var d=this.infoModel.getDir();return d<0?this._dir:d}return this._dir},set:function(value){if(this._dir==value||this.hasFilter(EntityFilter.hard))return;if(this._state==EntityAction.DIE){return}this._dir=value;this.loadBody()},enumerable:true,configurable:true});Object.defineProperty(CharMonster.prototype,"action",{get:function(){return this._state},set:function(value){if(this._state==EntityAction.DIE)return;this._state=value},enumerable:true,configurable:true});CharMonster.prototype.getResDir=function(mcType){var td=2*(this._dir-4);if(td<0)td=0;var dir=this._dir-td;if(this.infoModel&&this.infoModel.dirNum!=2){return dir}if(dir<2){return 1}else{return 3}};Object.defineProperty(CharMonster.prototype,"moveSpeed",{get:function(){if(!this.infoModel)return 0;return this.infoModel.getAtt(AttributeType.atMoveSpeed)/1e3*GameMap.CELL_SIZE},enumerable:true,configurable:true});CharMonster.prototype.hram=function(value){this._hpBar.value=Math.min(this._hpBar.value-value,this.infoModel.getAtt(AttributeType.atMaxHp))};CharMonster.prototype.getHP=function(){return this._hpBar.value};CharMonster.prototype.getRealHp=function(){return this.infoModel.getAtt(AttributeType.atHp)};CharMonster.prototype.reset=function(){this._state=EntityAction.STAND;this.AI_STATE=AI_State.Stand;this.dir=4;this._hpBar.slideDuration=500;this.myKill=false;this.onDeadCalled=false;this.visible=true;this.removeAllFilters()};CharMonster.prototype.destruct=function(){this.destroy();ObjectPool.push(this)};CharMonster.prototype.destroy=function(){_super.prototype.destroy.call(this);this.deadDelay();this.alpha=1;this.AI_STATE=AI_State.Stand;this._nameTxt.textColor=15589033;this.clearLyMark();this.removeAllEffect();this.removeAllFilters();TimerManager.ins().removeAll(this);this.stopMove();DisplayUtils.removeFromParent(this)};CharMonster.prototype.deadDelay=function(){this._hpBar.slideDuration=0;this._hpBar.value=0;this.removeHardStraight();for(var i in this.damageOverTimeList){var element=this.damageOverTimeList[i];this.deleteDamageOverTimer(element)}this.removeAllBuff();this.atking=false;if(this.haloMc){DisplayUtils.removeFromParent(this.haloMc)}};CharMonster.prototype.clearLyMark=function(){if(this._lyMark){this._lyMark.destruct();this._lyMark=null}};CharMonster.prototype.addHardStraight=function(time){this.isHardStraight=true;TimerManager.ins().doTimer(time,1,this.removeHardStraight,this)};CharMonster.prototype.removeHardStraight=function(){this.isHardStraight=false};CharMonster.prototype.initBody=function(fileName){this.addMc(CharMcOrder.BODY,fileName);ResourceMgr.ins().reloadImg(this.shadow)};Object.defineProperty(CharMonster.prototype,"isPlaying",{get:function(){return this._body.isPlaying},enumerable:true,configurable:true});CharMonster.prototype.isAtkAction=function(){return this._state==EntityAction.ATTACK||this._state==EntityAction.CAST};CharMonster.prototype.playBody=function(e){_super.prototype.playBody.call(this,e)};CharMonster.prototype.loadBody=function(){if(!this.isShowBody)return;_super.prototype.loadBody.call(this)};CharMonster.prototype.loadOther=function(mcType){if(!this.isShowBody)return;_super.prototype.loadOther.call(this,mcType)};CharMonster.prototype.loadNoDir=function(mcType){if(!this.isShowBody)return;_super.prototype.loadNoDir.call(this,mcType)};CharMonster.prototype.showBodyContainer=function(){if(this.isShowBody)return;this.isShowBody=true;this.addChildAt(this._bodyContainer,1);this.loadBody();for(var mcType in this._disOrder){var t=+mcType;if(this._disOrder[mcType]instanceof MovieClip&&this.hasDir.indexOf(t)<0){this.loadNoDir(t)}}this.updateTitle();if(this._lyMark){this._lyMark.showBall()}};CharMonster.prototype.hideBodyContainer=function(){if(!this.isShowBody)return;this.isShowBody=false;this.removeChild(this._bodyContainer);this.updateTitle();if(this._lyMark){this._lyMark.hideBall()}};CharMonster.prototype.getIsShowBody=function(){return this.isShowBody};CharMonster.prototype.resetStand=function(){if(!this.isAtkAction())return;this.playAction(EntityAction.STAND)};CharMonster.prototype.hasEffById=function(id){if(this.effs&&this.effs[id]){return true}return false};CharMonster.prototype.updateBlood=function(force){if(force===void 0){force=false}if(!this.infoModel)return;this._hpBar.maximum=this.infoModel.getAtt(AttributeType.atMaxHp);if(force||!(EntityManager.ins().getTeamCount(Team.WillEntity)>0&&GameMap.fubenID==0)){this._hpBar.value=this.infoModel.getAtt(AttributeType.atHp)}};CharMonster.prototype.getHpBar=function(){return this._hpBar};CharMonster.prototype.updateTitle=function(){var model=this.infoModel;var config=GlobalConfig.MonstersConfig[model.configID];var title=config&&config["titleId"];this.removeTitle();if(this.getIsShowBody()&&title&&title>0){var config_1=GlobalConfig.MonsterTitleConf[title];if(config_1){if(config_1.img){if(this._title==null){this._title=new eui.Image;this._title.anchorOffsetX=230>>1;this.titleContainer.addChild(this._title)}if(config_1.anchorOffsetY){this._title.anchorOffsetY=config_1.anchorOffsetY}else{this._title.anchorOffsetY=100}this._title.source=config_1.img}else if(config_1.eff){if(this._titleMc==null){this._titleMc=ObjectPool.pop("MovieClip");this._titleMc.anchorOffsetX=0;this.titleContainer.addChild(this._titleMc)}var eff=RES_DIR_EFF+config_1.eff;this.playFile(this._titleMc,eff);if(config_1.anchorOffsetY){this._titleMc.anchorOffsetY=config_1.anchorOffsetY}else{this._titleMc.anchorOffsetY=80}}}}if(this.inGuanQia(model)){if(this._fightMc==null){this._fightMc=ObjectPool.pop("MovieClip");this._fightMc.anchorOffsetX=0;this._fightMc.anchorOffsetY=80;this.playFile(this._fightMc,RES_DIR_EFF+"tz_daoeff")}if(!this._fightMc.parent){this.titleContainer.addChild(this._fightMc)}}else{if(this._fightMc&&this._fightMc.parent){this.titleContainer.removeChild(this._fightMc)}}};CharMonster.prototype.inGuanQia=function(model){return model.team!=Team.My&&GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS&&GameMap.fubenID!=0&&!CityCC.ins().isCity};CharMonster.prototype.removeTitle=function(){if(this._title)this._title.source="";if(this._titleMc){this._titleMc.destroy();this._titleMc=null}if(this._fightMc){this._fightMc.destroy();this._fightMc=null}};CharMonster.prototype.onDead=function(callBack,sourceTarget){this.stopMove();this.dieX=this.x;this.dieY=this.y;this.showBlood(false);this.showName(false);this.removeTitle();this.playAction(EntityAction.DIE);var model=this.infoModel;if(this.inGuanQia(model)){SkillEffNewPlayer.playCoinAni(this)}var delayTime=600;if(sourceTarget!=null){var dir=DirUtil.get8DirBy2Point(this,sourceTarget);if(this._dir!=dir){this._dir=dir;this.loadBody()}var dx=this.x-sourceTarget.x;var dy=this.y-sourceTarget.y;if(dx==0&&dy==0){dx=1}var dxy=Math.sqrt(dx*dx+dy*dy);dx=dx/dxy;dy=dy/dxy;var speed=200;var tw=Tween.get(this);tw.to({x:this.x+dx*speed*delayTime/1e3,y:this.y+dy*speed*delayTime/1e3},delayTime,egret.Ease.quadOut);if(callBack){tw.call(callBack,this)}}else{if(callBack){TimerManager.ins().doTimer(delayTime,1,callBack,this)}}};Object.defineProperty(CharMonster.prototype,"isCanAddBlood",{get:function(){return this._hpBar.value/this._hpBar.maximum<.8},enumerable:true,configurable:true});CharMonster.prototype.damageOverTime=function(e){var timer=e instanceof egret.Timer?e:e.currentTarget;if(timer.currentCount==timer.repeatCount){this.deleteDamageOverTimer(timer)}};CharMonster.prototype.deleteDamageOverTimer=function(timer){for(var i in this.damageOverTimeList){if(this.damageOverTimeList[i]==timer){delete this.damageOverTimeList[i];timer.stop();timer.removeEventListener(egret.TimerEvent.TIMER,this.damageOverTime,this)}}};CharMonster.prototype.addEffect=function(effID){var config=GlobalConfig.EffectConfig[effID];if(!config)return;if(config.type==0){var image_1=new eui.Image;image_1.source=config.fileName;this.addChild(image_1);var t=egret.Tween.get(image_1);image_1.x=image_1.x-23;t.to({y:-100},2e3).call(function(){DisplayUtils.removeFromParent(image_1)});return}var mc=this.effs[effID]||ObjectPool.pop("MovieClip");var s=RES_DIR_SKILLEFF+config.fileName;this.playFile(mc,s);mc.y=-this.groundDistance;this.addChild(mc);this.effs[effID]=mc};CharMonster.prototype.addHalo=function(str){this.haloMc=this.haloMc?this.haloMc:ObjectPool.pop("MovieClip");this.playFile(this.haloMc,RES_DIR_EFF+str);this.addChildAt(this.haloMc,0)};CharMonster.prototype.removeEffect=function(effID){var config=GlobalConfig.EffectConfig[effID];if(!config)return;if(config.type==0)return;var mc=this.effs[effID];if(!mc)return;if(mc instanceof MovieClip)mc.destroy();delete this.effs[effID]};CharMonster.prototype.removeAllEffect=function(){for(var effId in this.effs){var mc=this.effs[effId];if(mc&&mc instanceof MovieClip){mc.destroy()}}this.effs={}};CharMonster.prototype.hasBuff=function(groupID){return!!this.buffList[groupID]};CharMonster.prototype.addBuff=function(buff){var config=buff.effConfig;if(!config)return;var groupID=config.group;var oldBuff=this.buffList[groupID];if(oldBuff){if(oldBuff.effConfig.overlayType==2){var multRate=oldBuff.multRate+1;if(multRate>oldBuff.effConfig.overMaxCount)multRate=oldBuff.effConfig.overMaxCount;buff.multRate=multRate}this.removeBuff(oldBuff)}this.buffList[groupID]=buff;if(config.effName){var mc=this.buffEff[groupID]||ObjectPool.pop("MovieClip");var s=RES_DIR_SKILLEFF+config.effName;this.playFile(mc,s);mc.y=-this.groundDistance;this.addChild(mc);this.buffEff[groupID]=mc}if(config.effID){this.addEffect(config.effID)}if(buff.effConfig.type==SkillEffType.AdditionalState){if(buff.effConfig.args&&buff.effConfig.args.i==9){var holdTime=buff.effConfig.duration;this.addHardStraight(holdTime)}}this.addGroup(groupID)};CharMonster.prototype.removeBuff=function(buff){var config=buff.effConfig;var groupID=config.group;if(this.buffList[groupID]==buff){buff.dispose();ObjectPool.push(this.buffList[groupID]);delete this.buffList[groupID];if(this.buffEff[groupID]){DisplayUtils.removeFromParent(this.buffEff[groupID]);delete this.buffEff[groupID]}if(config.effID){this.removeEffect(config.effID)}if(config.unionBuff){var union=this.buffList[config.unionBuff];if(union)this.removeBuff(union)}}this.removeGroup(groupID)};CharMonster.prototype.removeAllBuff=function(){for(var i in this.buffList)this.removeBuff(this.buffList[i])};CharMonster.prototype.addPaoPao=function(paoID){if(!this.paoPao){this.paoPao=new PaoPaoView;this.addChildAt(this.paoPao,100);this.paoPao.open()}this.paoPao.anchorOffsetY=170;this.paoPao.anchorOffsetX=100;var job=this.infoModel.job;this.paoPao.setSpeak(paoID,job)};Object.defineProperty(CharMonster.prototype,"team",{get:function(){return this._infoModel.team},enumerable:true,configurable:true});CharMonster.prototype.startPatrol=function(){if(TimerManager.ins().getCurrTime()>this.nextPatrolTick){var p=this.getPointCanMove();if(p){GameMap.moveEntity(this,p.x,p.y);this.nextPatrolTick=TimerManager.ins().getCurrTime()+MathUtils.limit(this.moveLimTime,this.moveMaxTime)}}};CharMonster.prototype.setMoveAtt=function(para){this.moveRange=para[0];this.moveLimTime=para[1][0];this.moveMaxTime=para[1][1]};CharMonster.prototype.getPointCanMove=function(){var count=0;var X=0;var Y=0;var range=this.moveRange;var p;while(count<100){var X_1=MathUtils.limit(this.x-range>>0,this.x+range>>0);var Y_1=MathUtils.limit(this.y-range>>0,this.y+range>>0);if(GameMap.checkWalkableByPixel(X_1,Y_1)){p=new egret.Point;p.x=X_1;p.y=Y_1;break}count++}return p};CharMonster.prototype.playCount=function(){return this._state==EntityAction.RUN||this._state==EntityAction.STAND?_super.prototype.playCount.call(this):1};CharMonster.prototype.shakeIt=function(){var _this=this;if(this.onDeadCalled)return;if(this.action!=EntityAction.STAND&&this.action!=EntityAction.HIT)return;DisplayUtils.shakeItEntity(this,3,200,1);if(this.moveSpeed){this.playAction(EntityAction.HIT,function(){if(_this.action!=EntityAction.DIE){_this.playAction(EntityAction.STAND)}})}};CharMonster.prototype.showName=function(b){this._nameGroup.visible=b};CharMonster.prototype.showBlood=function(b){if(b&&this.infoModel&&!this.shouldShowBlood()){return}this._hpBar.visible=b};Object.defineProperty(CharMonster.prototype,"isMy",{get:function(){return this.infoModel.isMy},enumerable:true,configurable:true});Object.defineProperty(CharMonster.prototype,"weight",{get:function(){if(this._infoModel&&this.team==Team.My&&this instanceof CharRole){return this.y+32}return this.y},enumerable:true,configurable:true});CharMonster.prototype.updateModel=function(){this.removeAll();this.parseModel()};CharMonster.prototype.shouldShowBlood=function(){var monster=this;var model=this.infoModel;if((model.configID==80010||model.configID==80011)&&!(monster instanceof CharRole)){return false}if((model.configID==54004||model.configID==85002)&&!(monster instanceof CharRole)){return false}if((model.configID>=34001&&model.configID<=34210||model.configID>=34501&&model.configID<=34710)&&!(monster instanceof CharRole)){return false}return true};CharMonster.prototype.parseModel=function(){var monster=this;var model=this.infoModel;monster.showBlood(true);if(model.team!=Team.My){monster.updateBlood(true);monster.setCharName(model.name)}if(!this.shouldShowBlood()){monster.showBlood(false);monster.setCharName("")}monster.initBody(RES_DIR_MONSTER+model.avatarFileName);monster.setConfig(model.avatar+"");monster.updateTitle();if(model.avatarEffect&&model.avatarEffect!=""){monster.addHalo(model.avatarEffect)}if(model.movePara){monster.setMoveAtt(model.movePara)}monster.setBodyScale(model.avatarScale)};CharMonster.prototype.addGroup=function(groupId){var filter=EntityFilterUtil.getEntityFilter(groupId);if(filter){this.filterDic[filter]=this.filterDic[filter]||[];var index=this.filterDic[filter].indexOf(groupId);if(index==-1){this.filterDic[filter].push(groupId);this.updateFilter()}}};CharMonster.prototype.removeGroup=function(groupId){var filterId=EntityFilterUtil.getEntityFilter(groupId);if(filterId){var filters=this.filterDic[filterId];if(!filters)return;var index=filters.indexOf(groupId);if(index>=0){filters.splice(index,1);this.updateFilter()}}};CharMonster.prototype.updateFilter=function(){var filter=EntityFilter.no;if(this.hasFilter(EntityFilter.hard)){filter=EntityFilter.hard}else if(this.hasFilter(EntityFilter.poison)){filter=EntityFilter.poison}if(this.curFilter!=filter){this.setFilter(filter)}};CharMonster.prototype.hasFilter=function(filter){return!!(this.filterDic[filter]&&this.filterDic[filter].length)};CharMonster.prototype.setFilter=function(filter){this.curFilter=filter;if(filter){this.setMcFilter(filter);if(filter==EntityFilter.hard){this.setMcFilterPlayOrStop(false)}else{this.setMcFilterPlayOrStop(true)}}else{this.setMcFilter(filter);this.setMcFilterPlayOrStop(true)}};CharMonster.prototype.setMcFilter=function(filter){if(egret.Capabilities.renderMode!="webgl")return;for(var mcType in this._disOrder){if(+mcType!=CharMcOrder.ZHANLING){var mc=this._disOrder[mcType];mc.filters=filter?EntityFilterUtil.buffFilter[filter].filters:null}}};CharMonster.prototype.setMcFilterPlayOrStop=function(play){for(var _i=0,_a=this.hasDir;_i<_a.length;_i++){var mcType=_a[_i];if(mcType==CharMcOrder.ZHANLING)continue;var mc=this.getMc(mcType);if(mc){if(play)mc.play();else mc.stop()}}};CharMonster.prototype.removeAllFilters=function(){this.filterDic={};this.curFilter=EntityFilter.no;for(var mcType in this._disOrder){var mc=this._disOrder[mcType];mc.filters=null}};CharMonster.prototype.setBarColor=function(){var model=this.infoModel;var isFriend=model.camp!=undefined&&BattleCC.ins().camp!=undefined&&model.camp==BattleCC.ins().camp?true:false;var isTeam=GameMap.fbType==UserFb.FB_TEAM?true:false;this._hpBar.thumb.source=this.isMy?"boolGreen_png":isFriend||isTeam?"boolBlue_png":"boolRed_png"};return CharMonster}(CharEffect);__reflect(CharMonster.prototype,"CharMonster",["IChar"]);var ZhanLingPanel=function(_super){__extends(ZhanLingPanel,_super);function ZhanLingPanel(){var _this=_super.call(this)||this;_this.coolSecond=3;return _this}ZhanLingPanel.prototype.childrenCreated=function(){};ZhanLingPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isAutoUp=false;this.upBtn.label=this.isAutoUp?i18n("ZhanLingPanel_0"):i18n("ZhanLingPanel_1");TimerManager.ins().remove(this.checkUpdate,this);TimerManager.ins().remove(this.autoUpStar,this);this.stopCool();this.removeObserve();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};ZhanLingPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.openView(param)};ZhanLingPanel.prototype.openView=function(param){this.addTouchEvent(this.detail,this.onEvent);this.addTouchEvent(this.suit,this.onEvent);this.addTouchEvent(this.huanxing,this.onEvent);this.addTouchEvent(this.upBtn,this.onEvent);this.addTouchEvent(this.upBtnEx,this.onEvent);this.addTouchEvent(this["skillIcon0"],this.onEvent);this.addTouchEvent(this.huanhua,this.onEvent);this.addTouchEvent(this.btn0,this.onEvent);this.addTouchEvent(this.btn1,this.onEvent);this.addTouchEvent(this.closeBtn,this.onEvent);this.addTouchEvent(this.checkBoxs,this.updateCost);this.addTouchEvent(this.checkBoxs,this.updateModel);this.addTouchEvent(this.icon,this.showIconTips);this.addTouchEvent(this.help,this.onEvent);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSoulClick,this);this.observe(UserBag.ins().postItemAdd,this.timerUpdate);this.observe(UserBag.ins().postItemDel,this.timerUpdate);this.observe(UserBag.ins().postItemCountChange,this.timerUpdate);this.observe(ZhanLing.ins().postZhanLingInfo,this.timerUpdate);this.observe(ZhanLing.ins().postZhanLingUpExp,this.timerUpdate);this.observe(ZhanLing.ins().postZhanLingDrug,this.timerUpdate);this.observe(ZhanLing.ins().postZhanLingWear,this.timerUpdate);this.observe(ZhanLing.ins().postZhanLingSkinUpGrade,this.timerUpdate);this.observe(ZhanLing.ins().postZhangLingSkinChange,this.timerUpdate);this.observe(ZhanLing.ins().postZhanLingUpgrade,this.stopUpGrade);this.observe(ZhanLing.ins().postZhanLingTalentLvUpGrade,this.TanlentLvUpGrade);this.list.itemRenderer=ZhanLingSkinItem;this.list.useVirtualLayout=false;this.listData=new eui.ArrayCollection;this.list.dataProvider=this.listData;this.zlId=param[0]||0;this._tick=0;this.postEvent=Math.floor(150/GlobalConfig.ZhanLingConfig.unitTime);for(var i=0;i<GlobalConfig.ZhanLingBase[this.zlId].skill.length;i++){this.addTouchEvent(this["skillIcon"+(i+1)],this.onSkillEvent)}for(var k in GlobalConfig.ZhanLingConfig.upgradeInfo){var idx=GlobalConfig.ZhanLingConfig.upgradeInfo[k].sort;this.addTouchEvent(this["up"+idx],this.onDrugEvent)}this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange);this.isAutoUp=false;this.roleSelect.setState("nohead");this.init();TimerManager.ins().doTimer(500,0,this.checkUpdate,this);this.upStarTip.visible=false;GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.shenLing)};ZhanLingPanel.prototype.checkUpdate=function(){var _this=this;if(this._tick&&this._tick<=this.postEvent){this._tick=0;TimerManager.ins().doNext(function(){_this.updateUI()},this)}};ZhanLingPanel.prototype.timerUpdate=function(){var _this=this;this._tick++;if(this._tick&&this._tick>this.postEvent){this._tick=0;TimerManager.ins().doNext(function(){_this.updateUI()},this)}};ZhanLingPanel.prototype.init=function(){this.updateUI(true)};ZhanLingPanel.prototype.updateState=function(){var zlData=ZhanLingModel.ins().getZhanLingDataById(this.zlId);var zlLeve=zlData?zlData.level:0;var maxLv=CommonUtils.getObjectLength(GlobalConfig.ZhanLingLevel[this.zlId])-1;if(!this.zlId){if(zlLeve>=maxLv){this.currentState="zl_max"}else{this.currentState="zl_up"}}else{if(zlLeve>=maxLv){this.currentState="skin_max"}else{this.currentState="skin_up"}}this.validateNow()};ZhanLingPanel.prototype.updateUI=function(init){this.updateState();this.updateTop(init);this.updateItem();this.updateSkill();this.updateValue();this.updateDown();this.updateCost();this.updateRedPoint()};ZhanLingPanel.prototype.updateTop=function(init){if(this.currentState=="skin_up"||this.currentState=="skin_max"){this.listData.replaceAll(ZhanLingModel.ins().showZLlist);this.list.validateNow();if(this.zlId){for(var i=0;i<this.list.numElements;i++){var render=this.list.getVirtualElementAt(i);var zlbase=this.list.dataProvider.getItemAt(i);if(zlbase.id==this.zlId){render.setSelect(true);if(init){var startPos=0;if(i>3){this.listScroller.stopAnimation();startPos=Math.floor((i+1)/4)*render.height}this.setStartPosition(startPos)}break}}}this.onChange();this.huanhua.visible=ZhanLingModel.ins().getZhanLingDataById(this.zlId)?true:false;this.huanhua.icon=ZhanLingModel.ins().ZhanLingSkinId==this.zlId?"zl_quxiao_btn":"zl_huanhua_btn"}var zllconfig=GlobalConfig.ZhanLingConfig;for(var k in zllconfig.upgradeInfo){var i=zllconfig.upgradeInfo[k].sort;if(this["up"+i]){this["up"+i].icon=GlobalConfig.ItemConfig[k].icon+"_png"}if(this["redPoint"+i]){this["redPoint"+i].visible=ZhanLingModel.ins().getZhanLingDataByDrugUse(this.zlId,Number(k))}if(this["used"+i]){this["used"+i].text=ZhanLingModel.ins().getZhanLingDataByDrug(this.zlId,Number(k))}}var level=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);this.lv.data=GlobalConfig.ZhanLingLevel[this.zlId][level].stageDesc;if(!this.model)this.model=new MovieClip;if(!this.model.parent)this.zhanling.addChild(this.model);this.updateModel()};ZhanLingPanel.prototype.updateModel=function(){var level=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);var cfg;if(this.isAutoUp){var stage=ZhanLingModel.ins().getZhanLingDataByStage(this.zlId);var nextLv=stage*10+1;cfg=GlobalConfig.ZhanLingLevel[this.zlId][nextLv];if(!cfg)cfg=GlobalConfig.ZhanLingLevel[this.zlId][level];else level=nextLv}else{cfg=GlobalConfig.ZhanLingLevel[this.zlId][level]}this.zhanlingName.source=GlobalConfig.ZhanLingLevel[this.zlId][level].zlName;if(this.model.name!=RES_DIR_EFF+cfg.innerAppearance)this.model.playFile(RES_DIR_EFF+cfg.innerAppearance,-1)};ZhanLingPanel.prototype.updateItem=function(){var itemData=UserBag.ins().getBagGoodsByType(ItemType.TYPE_21);if(itemData)itemData.sort(this.sort);for(var i=1;i<=GlobalConfig.ZhanLingConfig.equipPosCount;i++){this["item"+i].name=i.toString();var itemid=ZhanLingModel.ins().getZhanLingDataByItem(this.zlId,i);this["item"+i].data={zlId:this.zlId,id:itemid,equips:itemData}}};ZhanLingPanel.prototype.updateSkill=function(){var config=GlobalConfig.ZhanLingBase[this.zlId];if(!config)return;var talentId=config.talent;var talentLv=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.zlId);var zlTconfig=GlobalConfig.ZhanLingTalent[talentId][talentLv];if(!zlTconfig)zlTconfig=GlobalConfig.ZhanLingTalent[talentId][1];if(zlTconfig.talentDesc&&zlTconfig.talentDesc.icon){this["skillIcon0"].source=zlTconfig.talentDesc.icon}else{if(zlTconfig.passive)this["skillIcon0"].source=Math.floor(zlTconfig.passive[0].id/1e3)*1e3+"_png"}for(var i=0;i<GlobalConfig.ZhanLingBase[this.zlId].skill.length;i++){var skillid=GlobalConfig.ZhanLingBase[this.zlId].skill[i].id;var zlskill=GlobalConfig.ZhanLingSkill[skillid];if(zlskill.desc&&zlskill.desc.icon)this["skillIcon"+(i+1)].source=zlskill.desc.icon;else this["skillIcon"+(i+1)].source=Math.floor(zlskill.passive/1e3)*1e3+"_png"}this["blackImg0"].visible=talentLv?false:true;var lv=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);for(var i=0;i<GlobalConfig.ZhanLingBase[this.zlId].skill.length;i++){var sk=GlobalConfig.ZhanLingBase[this.zlId].skill[i];this["blackImg"+(i+1)].visible=sk.open>lv?true:false}};ZhanLingPanel.prototype.updateValue=function(){var lv=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);var zllconfig=GlobalConfig.ZhanLingLevel[this.zlId][lv];if(!zllconfig)return;var TotalValue=ZhanLingModel.ins().getZhanLingPower(this.zlId);var power=TotalValue[0]?TotalValue[0]:0;this.powerPanel.setPower(power);if(!TotalValue[1].length)TotalValue[1]=this.getEmptyAttrs(this.zlId);if(!TotalValue[2].length)TotalValue[2]=this.getEmptyAttrs(this.zlId,true);var curAttrs=AttributeData.getAttStr(TotalValue[1],0,1,"：")+"\n";var netAttrs=AttributeData.getAttStr(TotalValue[2],0,1,"：")+"\n";this.curAtt.text=curAttrs;this.nextAtt.text=netAttrs};ZhanLingPanel.prototype.getEmptyAttrs=function(id,next){var zlAttr=[];var config=GlobalConfig.ZhanLingLevel[id][0];zlAttr=ZhanLingModel.ins().addAttrs(zlAttr,config.attrs);if(!next){for(var i=0;i<zlAttr.length;i++){zlAttr[i].value=0}}return zlAttr};ZhanLingPanel.prototype.updateDown=function(isUp){if(isUp===void 0){isUp=0}if(this.zlId){var zlData=ZhanLingModel.ins().getZhanLingDataById(this.zlId);this.starGroup.visible=this.barGroup.visible=zlData?true:false;if(!zlData)return}if(!this.starList){this.starList=new StarList(10);this.starList.horizontalCenter=0}if(!this.starList.parent){this.starGroup.addChild(this.starList)}var lv=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);var showLv=Math.floor(lv%10);if(lv){var stage2=showLv;if(!stage2){showLv=10}}this.starList.setStarNum(showLv,isUp);if(!this.barbc){this.barbc=new ProgressBarEff;this.barbc.setWidth(500)}if(!this.barbc.parent){this.barGroup.addChild(this.barbc)}var exp=ZhanLingModel.ins().getZhanLingDataByExp(this.zlId);var config=GlobalConfig.ZhanLingLevel[this.zlId][lv];if(config){this.barbc.reset();this.barbc.setData(exp,config.exp)}};ZhanLingPanel.prototype.updateCost=function(){var arr=this.getCostValue();var curCount=arr[0];var totalCount=arr[1];var color=curCount>=totalCount?65280:16711680;this.countLabel.textFlow=TextFlowMaker.generateTextFlow1(i18n("ZhanLingPanel_23",color,curCount,totalCount));this.upBtn.visible=ZhanLingModel.ins().getZhanLingDataById(this.zlId)?true:false;this.upBtnEx.visible=!this.upBtn.visible};ZhanLingPanel.prototype.getCostValue=function(){var zlData=ZhanLingModel.ins().getZhanLingDataById(this.zlId);var zlBase=GlobalConfig.ZhanLingBase[this.zlId];this.checkBoxs.visible=true;this.costType=ItemType.TYPE_1;if(zlData||!zlBase.mat){var curCount_1=0;var totalCount_1=0;var lv=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);var zllconfig=GlobalConfig.ZhanLingLevel[this.zlId][lv];var config_2=GlobalConfig.ItemConfig[GlobalConfig.ZhanLingConfig.stageitemid];this.icon.source=config_2.icon+"_png";var itemData_1=UserBag.ins().getBagItemById(GlobalConfig.ZhanLingConfig.stageitemid);curCount_1=itemData_1?itemData_1.count:0;totalCount_1=zllconfig.count;if(this.checkBoxs.selected&&curCount_1<totalCount_1){curCount_1=Actor.yb;this.icon.source="szyuanbao";totalCount_1=GlobalConfig.ZhanLingConfig.unitPrice*zllconfig.count;this.costType=MoneyConst.yuanbao}this.costCount=totalCount_1;return[curCount_1,totalCount_1]}var config=GlobalConfig.ItemConfig[zlBase.mat];this.icon.source=config.icon+"_png";var itemData=UserBag.ins().getBagItemById(zlBase.mat);var curCount=itemData?itemData.count:0;var zlTalent=GlobalConfig.ZhanLingTalent[this.zlId][1];var totalCount=zlTalent.costCount;this.checkBoxs.visible=false;this.costType=ItemType.TYPE_22;this.costCount=totalCount;return[curCount,totalCount]};ZhanLingPanel.prototype.updateRedPoint=function(){for(var i=0;i<5;i++){if(this["skillRedPoint"+i]){this["skillRedPoint"+i].visible=false}}this.hhRedPoint.visible=false;this.upRedPoint.visible=ZhanLingModel.ins().isUpGradeByStar(this.zlId)||ZhanLingModel.ins().isHintNum(this.zlId);this["skillRedPoint0"].visible=ZhanLingModel.ins().isUpGradeByTalent(this.zlId);if(this["hxRedPoint"]){var b=false;for(var i=0;i<ZhanLingModel.ins().showZLlist.length;i++){var zlBase=ZhanLingModel.ins().showZLlist[i];if(zlBase.id){var b1=ZhanLingModel.ins().isUpGradeByStar(zlBase.id)||ZhanLingModel.ins().isHintNum(zlBase.id);if(b1){b=true;break}var b2=ZhanLingModel.ins().isUpGradeByTalent(zlBase.id);if(b2){b=true;break}}}this["hxRedPoint"].visible=b}};ZhanLingPanel.prototype.onSoulClick=function(e){if(e&&e.itemRenderer&&e.item){if(this.currentState=="zl_up"||this.currentState=="zl_max"){var index=this.getIndexRule();ViewManager.ins().open(ZhanLingPanelEx,index)}else{var item=e.item;this.zlId=item.id;this.updateUI()}}};ZhanLingPanel.prototype.onSkillEvent=function(e){for(var i=0;i<GlobalConfig.ZhanLingBase[this.zlId].skill.length;i++){if(e.currentTarget==this["skillIcon"+(i+1)]){var sk=GlobalConfig.ZhanLingBase[this.zlId].skill[i];ViewManager.ins().open(ZhanLingTips,this.zlId,sk.id);break}}};ZhanLingPanel.prototype.onDrugEvent=function(e){for(var k in GlobalConfig.ZhanLingConfig.upgradeInfo){var idx=GlobalConfig.ZhanLingConfig.upgradeInfo[k].sort;if(e.currentTarget==this["up"+idx]){var itemid=this.getDrugItemByIndex(idx);if(this["redPoint"+idx].visible){ZhanLing.ins().sendZhanLingDrug(this.zlId,itemid)}else{ViewManager.ins().open(ZhanLingItemTips,this.zlId,itemid)}}}};ZhanLingPanel.prototype.onEvent=function(e){var _this=this;var num=84*4;var scrollV=0;switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.detail:break;case this.suit:ViewManager.ins().open(ZhanLingSuitTip,this.zlId);break;case this.huanxing:var index=this.getIndexRule();ViewManager.ins().open(ZhanLingPanelEx,index);break;case this.upBtn:this.sendUpGrade();break;case this.upBtnEx:if(this.upRedPoint.visible){ZhanLing.ins().sendZhanLingSkinUpGrade(this.zlId)}else{UserTips.ins().showTips(i18n("ZhanLingPanel_2"))}break;case this["skillIcon0"]:if(this["skillRedPoint0"]&&this["skillRedPoint0"].visible){var talentId=ZhanLingModel.ins().getZhanLingDataByTalentId(this.zlId);var talentLv=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.zlId);var nzltalent=GlobalConfig.ZhanLingTalent[talentId][talentLv+1];var nzlBase=GlobalConfig.ZhanLingBase[this.zlId];var itemcfg=GlobalConfig.ItemConfig[nzlBase.mat];var w=WarnWin.show(i18n("ZhanLingPanel_3",itemcfg.name,nzltalent.costCount),null,null,function(){ZhanLing.ins().sendZhanLingSkinUpGrade(_this.zlId)},this);w.setBtnLabel(i18n("ZhanLingPanel_4"),i18n("ZhanLingPanel_5"))}else{ViewManager.ins().open(ZhanLingTips,this.zlId)}break;case this.btn0:scrollV=this.list.scrollV-num;scrollV=Math.round(scrollV/84)*84;if(scrollV<0){scrollV=0}this.list.scrollV=scrollV;this.onChange();break;case this.btn1:scrollV=this.list.scrollV+num;scrollV=Math.round(scrollV/84)*84;if(scrollV>this.list.contentHeight-this.listScroller.height){scrollV=this.list.contentHeight-this.listScroller.height}this.list.scrollV=scrollV;this.onChange();break;case this.huanhua:if(!ZhanLingModel.ins().getZhanLingDataById(this.zlId)){UserTips.ins().showTips(i18n("ZhanLingPanel_6"));return}var hhId=this.zlId;if(ZhanLingModel.ins().ZhanLingSkinId==hhId){hhId=0}ZhanLing.ins().sendZhangLingSkinChange(hhId);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[35].text);break}};ZhanLingPanel.prototype.sendUpGrade=function(){this.isAutoUp=!this.isAutoUp;if(this.isAutoUp){if(!this.checkUpStar()){this.isAutoUp=false;return}this.updateModel();TimerManager.ins().doTimer(GlobalConfig.ZhanLingConfig.unitTime,0,this.autoUpStar,this)}else{TimerManager.ins().remove(this.autoUpStar,this);this.stopCool()}this.upBtn.label=this.isAutoUp?i18n("ZhanLingPanel_8"):i18n("ZhanLingPanel_9")};ZhanLingPanel.prototype.stopUpGrade=function(){this.isAutoUp=false;TimerManager.ins().remove(this.autoUpStar,this);this.updateDown(1);this.updateModel();this.upStarTip.visible=true;this.coolSecond=3;this.showCoolTip();TimerManager.ins().doTimer(1e3,0,this.coolAutoUpStar,this);var lv=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);var zlLevel=GlobalConfig.ZhanLingLevel[this.zlId][lv];if(zlLevel.activeLv&&this.isTopLevel){RewardWin.showAct(0,zlLevel.zlNameLabel,"",true,null,"",zlLevel.innerAppearance)}};ZhanLingPanel.prototype.showCoolTip=function(){this.upStarTip.visible=true;this.upStarCoolSec.text=this.coolSecond.toString()};ZhanLingPanel.prototype.stopCool=function(){TimerManager.ins().remove(this.coolAutoUpStar,this);this.upStarTip.visible=false};ZhanLingPanel.prototype.coolAutoUpStar=function(){var self=this;self.coolSecond--;if(self.coolSecond>0){self.showCoolTip()}else{self.stopCool();self.sendUpGrade()}};ZhanLingPanel.prototype.TanlentLvUpGrade=function(){var talentLv=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.zlId);var lv=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);var zlLevel=GlobalConfig.ZhanLingLevel[this.zlId][lv];if(zlLevel&&talentLv&&talentLv!=1&&this.isTopLevel){RewardWin.showAct(1,i18n("ZhanLingPanel_12",talentLv),"",true,null,"",zlLevel.innerAppearance)}};ZhanLingPanel.prototype.showIconTips=function(){var id=MoneyConst.yuanbao;switch(this.costType){case MoneyConst.yuanbao:ViewManager.ins().open(ItemCurrencyWin,id,this.costCount);break;case ItemType.TYPE_1:id=GlobalConfig.ZhanLingConfig.stageitemid;ViewManager.ins().open(ItemDetailedWin,0,id,this.costCount);break;case ItemType.TYPE_22:id=GlobalConfig.ZhanLingBase[this.zlId].mat;ViewManager.ins().open(ZhanlingZBTipWin,id);break}};ZhanLingPanel.prototype.autoUpStar=function(){if(this.isAutoUp){var buy=this.checkBoxs.selected?1:0;if(!this._tick){if(!this.checkUpStar()){this.isAutoUp=false;this.stopCool();TimerManager.ins().remove(this.autoUpStar,this);return}}ZhanLing.ins().sendZhanLingUpExp(this.zlId,buy)}};ZhanLingPanel.prototype.checkUpStar=function(){if(this.currentState=="skin_max"||this.currentState=="zl_max"){UserTips.ins().showTips(i18n("ZhanLingPanel_13"));this.upBtn.label=i18n("ZhanLingPanel_14");return false}if(!ZhanLingModel.ins().getZhanLingDataById(this.zlId)){UserTips.ins().showTips(i18n("ZhanLingPanel_15"));this.upBtn.label=i18n("ZhanLingPanel_16");return false}var buy=this.checkBoxs.selected?1:0;var arr=this.getCostValue();var curCount=arr[0];var needCount=arr[1];if(!curCount||curCount<needCount){if(buy){curCount=Actor.yb;needCount=GlobalConfig.ZhanLingConfig.unitPrice*needCount;if(!curCount||curCount<needCount){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("ZhanLingPanel_17"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("ZhanLingPanel_18"))}this.upBtn.label=i18n("ZhanLingPanel_19");return false}}else{UserTips.ins().showTips(i18n("ZhanLingPanel_20"));this.upBtn.label=i18n("ZhanLingPanel_21");return false}}this.upBtn.label=i18n("ZhanLingPanel_22");return true};ZhanLingPanel.prototype.sort=function(a,b){var aconfig=GlobalConfig.ZhanLingEquip[a.configID];var bconfig=GlobalConfig.ZhanLingEquip[b.configID];if(aconfig.level>bconfig.level)return-1;else return 1};ZhanLingPanel.prototype.getIndexRule=function(){var index=0;ZhanLingModel.ins().updateShowZLlist();index=ZhanLingModel.ins().showZLlist[0].id;for(var i=0;i<ZhanLingModel.ins().showZLlist.length;i++){var isUpStar=ZhanLingModel.ins().isUpGradeByStar(ZhanLingModel.ins().showZLlist[i].id);var isUpTalent=ZhanLingModel.ins().isUpGradeByTalent(ZhanLingModel.ins().showZLlist[i].id);if(isUpStar||isUpTalent){index=ZhanLingModel.ins().showZLlist[i].id;break}else{var isAct=ZhanLingModel.ins().getZhanLingDataByLevel(ZhanLingModel.ins().showZLlist[i].id);if(!isAct){if(ZhanLingModel.ins().getZhanLingDataById(GlobalConfig.ZhanLingBase[index].id))index=ZhanLingModel.ins().showZLlist[i].id;else if(GlobalConfig.ZhanLingBase[index].sort>GlobalConfig.ZhanLingBase[ZhanLingModel.ins().showZLlist[i].id].sort){index=ZhanLingModel.ins().showZLlist[i].id}}}}return index};ZhanLingPanel.prototype.onChange=function(){if(this.list.scrollV<39){this.btn0.visible=false;this.btn1.visible=true}else if(this.list.scrollV>=this.list.contentHeight-this.list.height-39){this.btn0.visible=true;this.btn1.visible=false}else{this.btn0.visible=true;this.btn1.visible=true}if(this.list.numElements<=4){this.btn0.visible=this.btn1.visible=false}this.rightRed0.visible=this.btn0.visible?this["hxRedPoint"].visible:false;this.rightRed1.visible=this.btn1.visible?this["hxRedPoint"].visible:false};ZhanLingPanel.prototype.setStartPosition=function(startPos){if(this.listScroller.height>=this.list.contentHeight)startPos=0;else{var maxHeight=this.list.contentHeight-this.listScroller.height;maxHeight=maxHeight>0?maxHeight:0;if(startPos>=maxHeight)startPos=maxHeight}this.list.scrollV=startPos};ZhanLingPanel.prototype.getDrugItemByIndex=function(sortId){var itemid=0;var zllconfig=GlobalConfig.ZhanLingConfig;for(var k in zllconfig.upgradeInfo){var i=zllconfig.upgradeInfo[k].sort;if(i==sortId){itemid=Number(k);break}}return itemid};return ZhanLingPanel}(BaseEuiView);__reflect(ZhanLingPanel.prototype,"ZhanLingPanel");var BaseScene=function(){function BaseScene(){this._layers=new Array}BaseScene.prototype.onEnter=function(){};BaseScene.prototype.onExit=function(){ViewManager.ins().closeAll();this.removeAllLayer()};BaseScene.prototype.addLayer=function(layer){if(layer instanceof BaseSpriteLayer){StageUtils.ins().getStage().addChild(layer);this._layers.push(layer)}else if(layer instanceof BaseEuiLayer){StageUtils.ins().getUIStage().addChild(layer);this._layers.push(layer)}};BaseScene.prototype.addLayerAt=function(layer,index){if(layer instanceof BaseSpriteLayer){StageUtils.ins().getStage().addChildAt(layer,index);this._layers.push(layer)}else if(layer instanceof BaseEuiLayer){StageUtils.ins().getUIStage().addChildAt(layer,index);this._layers.push(layer)}};BaseScene.prototype.removeLayer=function(layer){if(layer instanceof BaseSpriteLayer){StageUtils.ins().getStage().removeChild(layer);this._layers.splice(this._layers.indexOf(layer),1)}else if(layer instanceof BaseEuiLayer){StageUtils.ins().getUIStage().removeChild(layer);this._layers.splice(this._layers.indexOf(layer),1)}};BaseScene.prototype.layerRemoveAllChild=function(layer){if(layer instanceof BaseSpriteLayer){layer.removeChildren()}else if(layer instanceof BaseEuiLayer){layer.removeChildren()}};BaseScene.prototype.removeAllLayer=function(){while(this._layers.length){var layer=this._layers[0];this.layerRemoveAllChild(layer);this.removeLayer(layer)}};return BaseScene}();__reflect(BaseScene.prototype,"BaseScene");var LayerManager=function(){function LayerManager(){}LayerManager.Game_Bg=new BaseEuiLayer;LayerManager.Game_Main=new BaseEuiLayer;LayerManager.Main_View=new BaseEuiLayer;LayerManager.Main_Ani=new BaseEuiLayer;LayerManager.UI_Main=new BaseEuiLayer;LayerManager.UI_Main2=new BaseEuiLayer;LayerManager.UI_Popup=new BaseEuiLayer;LayerManager.UI_Message=new BaseEuiLayer;LayerManager.UI_Tips=new BaseEuiLayer;return LayerManager}();__reflect(LayerManager.prototype,"LayerManager");var BaseSound=function(){function BaseSound(){this._cache={};this._loadingCache=new Array;TimerManager.ins().doTimer(1*60*1e3,0,this.dealSoundTimer,this)}BaseSound.prototype.dealSoundTimer=function(){var currTime=egret.getTimer();var keys=Object.keys(this._cache);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];if(!this.checkCanClear(key))continue;if(currTime-this._cache[key]>=SoundManager.CLEAR_TIME){delete this._cache[key];var osua=this.osua;if(osua==null){this.osua=egret.Capabilities.os}if(osua!="Mac OS"&&osua!="iOS"){RES.destroyRes(key)}}}};BaseSound.prototype.getSound=function(key){var sound=RES.getRes(key);if(sound){if(this._cache[key]){this._cache[key]=egret.getTimer()}}else{if(this._loadingCache.indexOf(key)!=-1){return null}this._loadingCache.push(key);RES.getResAsync(key,this.onResourceLoadComplete,this)}return sound};BaseSound.prototype.onResourceLoadComplete=function(data,key){var index=this._loadingCache.indexOf(key);if(index!=-1){this._loadingCache.splice(index,1);this._cache[key]=egret.getTimer();this.loadedPlay(key)}};BaseSound.prototype.loadedPlay=function(key){};BaseSound.prototype.checkCanClear=function(key){return true};return BaseSound}();__reflect(BaseSound.prototype,"BaseSound");var ActivityType1Data=function(_super){__extends(ActivityType1Data,_super);function ActivityType1Data(bytes){var _this=_super.call(this,bytes)||this;_this.rewardsSum=[];_this.hFTotalConsumption=0;_this.readReawards(bytes);return _this}ActivityType1Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);var rewardID=bytes.readShort();this.record=bytes.readInt()};ActivityType1Data.prototype.readReawards=function(bytes){this.record=bytes.readInt();this.hFTotalConsumption=bytes.readInt();var len=bytes.readShort();for(var i=1;i<=len;i++){this.rewardsSum[i]=bytes.readShort()}};ActivityType1Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType1Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType1Data.prototype.getConfig=function(){var config;if(this.activityType==ActivityType.Personal){config=GlobalConfig.PActivityType1Config}else{config=GlobalConfig.ActivityType1Config}return config};ActivityType1Data.prototype.getIns=function(){var ins;if(this.activityType==ActivityType.Personal){ins=PActivity.ins()}else{ins=Activity.ins()}return ins};ActivityType1Data.prototype.getRewardStateById=function(index){var config=this.getConfig()[this.id][index];switch(config.showType){case ShowType.LEVEL:if(Actor.level<config.level||UserZs.ins().lv<config.zslevel)return Activity.NotReached;break;case ShowType.WING:if(WingsData.getWingAllLevel()<config.wingLv)return Activity.NotReached;break;case ShowType.ZHUZAO:if(Role.getAllForgeLevelByType(PackageID.Zhuling)<config.zzLv)return Activity.NotReached;break;case ShowType.LONGHUN:if(LongHunData.getLongHunAllLevel()<config.lhLv)return Activity.NotReached;break;case ShowType.BOOK:var power=Book.ins().getBookPowerNumEx();if(power<config.tjPower)return Activity.NotReached;break;case ShowType.EQUIP:if(UserBag.ins().getEquipsScoreByRolesOfBody()<config.equipPower)return Activity.NotReached;break;case ShowType.XIAOFEI:var data=this.getIns().getActivityDataById(config.Id);if(data.hFTotalConsumption<config.consumeYuanbao){return Activity.NotReached}break;case ShowType.RING:var lvl=0;var ringData=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(ringData&&ringData.level)lvl=ringData.level;if(lvl<config.huoyanRingLv){return Activity.NotReached}break;case ShowType.SAMSARA:if(Actor.samsaraLv<config.lunhLv)return Activity.NotReached;break;case ShowType.ZHANLING:if(ZhanLingModel.ins().getMaxZhanLingDataByLevel()<config.zhanlingLv)return Activity.NotReached;break;case ShowType.XIANYU:var xianyuziseNum=config.xianyuziseNum;var xianyuLv=config.xianyuLv;var xianyuNum=config.xianyuNum;var xianyuziseNum_me=UserMiji.ins().getZiNumTotal();var xianyuLv_me=UserMiji.ins().getMinLevelTotal();var xianyuNum_me=UserMiji.ins().getXianYuNumTotal();var reached=false;if(xianyuziseNum&&xianyuziseNum_me&&xianyuziseNum_me>=xianyuziseNum){reached=true}if(xianyuLv&&xianyuLv_me&&xianyuLv_me>=xianyuLv&&xianyuNum_me>=24){reached=true}if(xianyuNum&&xianyuNum_me&&xianyuNum_me>=xianyuNum){reached=true}if(!reached){return Activity.NotReached}break;case ShowType.TONGGUAN:if(UserFb.ins().guanqiaID<config.tgNum)return Activity.NotReached;break;case ShowType.FUWENTA:var level=SkyLevelModel.ins().cruLevel-1;if(level<config.fwtLv)return Activity.NotReached;break;case ShowType.SHENJIANG:if(ShapeShiftingMgr.ins().getTotalPower()<config.sjPower)return Activity.NotReached;break}var record=Math.floor(this.record/Math.pow(2,config.index))%2;return record?Activity.Geted:Activity.CanGet};ActivityType1Data.prototype.checkRedPoint=function(){var tmplist=this.getConfig()[this.id];for(var k in tmplist){var config=tmplist[k];var btnType=this.getRewardStateById(config.index);var curget=this.rewardsSum[config.index];var sum=config.total?config.total-curget:1;switch(btnType){case Activity.NotReached:break;case Activity.CanGet:if(sum>0)return true;break;case Activity.Geted:break}}return false};ActivityType1Data.prototype.getHide=function(){if(this.isHide)return this.isHide;var rec=this.record>>1;var tmplist=this.getConfig()[this.id];if(!tmplist)return false;var tlist=Object.keys(tmplist);if(rec>=Math.pow(2,tlist.length)-1){this.isHide=true;return this.isHide}this.isHide=false;return this.isHide};return ActivityType1Data}(ActivityBaseData);__reflect(ActivityType1Data.prototype,"ActivityType1Data");var ShowType;(function(ShowType){ShowType[ShowType["LEVEL"]=0]="LEVEL";ShowType[ShowType["WING"]=1]="WING";ShowType[ShowType["ZHUZAO"]=2]="ZHUZAO";ShowType[ShowType["LONGHUN"]=3]="LONGHUN";ShowType[ShowType["BOOK"]=5]="BOOK";ShowType[ShowType["EQUIP"]=6]="EQUIP";ShowType[ShowType["RING"]=7]="RING";ShowType[ShowType["SAMSARA"]=8]="SAMSARA";ShowType[ShowType["ZHANLING"]=9]="ZHANLING";ShowType[ShowType["XIAOFEI"]=100]="XIAOFEI";ShowType[ShowType["XIANYU"]=11]="XIANYU";ShowType[ShowType["TONGGUAN"]=12]="TONGGUAN";ShowType[ShowType["FUWENTA"]=13]="FUWENTA";ShowType[ShowType["SHENJIANG"]=14]="SHENJIANG"})(ShowType||(ShowType={}));window["ShowType"]=ShowType;var ActivityType28_1Data=function(_super){__extends(ActivityType28_1Data,_super);function ActivityType28_1Data(bytes){var _this=_super.call(this,bytes)||this;_this.update(bytes);return _this}ActivityType28_1Data.prototype.getIns=function(){var ins;if(this.activityType==ActivityType.Personal){ins=PActivity.ins()}else{ins=Activity.ins()}return ins};ActivityType28_1Data.prototype.update=function(bytes){this.record=bytes.readInt();this.count=bytes.readInt();this.score=bytes.readInt();var len=bytes.readInt();this.gotArr=[];for(var i=0;i<len;i++){this.gotArr.push(bytes.readByte())}this.indexs=[];len=bytes.readByte();for(var i=0;i<len;i++){this.indexs.push(bytes.readByte())}len=bytes.readByte();this.noticeArr=[];for(var i=0;i<len;i++){this.noticeArr.push({name:bytes.readString(),index:bytes.readByte()})}this.noticeArr.reverse()};ActivityType28_1Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType28_1Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType28_1Data.prototype.checkRedPoint=function(){return this.getIns().getType28RedPoint(this.id)||this.isNewdayShowRedPoint(this.id)};ActivityType28_1Data.prototype.isNewdayShowRedPoint=function(id){if(id==Activity.ins().duanwuID[0]){var isshow=Activity.ins().getfirstShowRedPointById(id);return isshow}return false};ActivityType28_1Data.prototype.getRemainTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc;if(beganTime>=0){desc=i18n("ActivityType9Data_0")}else if(endedTime<=0){desc=i18n("ActivityType9Data_1")}else{desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}return desc};ActivityType28_1Data.prototype.getLastTime=function(){var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3);return desc};ActivityType28_1Data.prototype.getStateByIndex=function(index){var state=this.record>>index&1;return state};return ActivityType28_1Data}(ActivityBaseData);__reflect(ActivityType28_1Data.prototype,"ActivityType28_1Data");var ActivityType9Data=function(_super){__extends(ActivityType9Data,_super);function ActivityType9Data(bytes){var _this=_super.call(this,bytes)||this;_this.update(bytes);return _this}ActivityType9Data.prototype.getIns=function(){var ins;if(this.activityType==ActivityType.Personal){ins=PActivity.ins()}else{ins=Activity.ins()}return ins};ActivityType9Data.prototype.update=function(bytes){this.record=bytes.readInt();this.count=bytes.readInt();var len=bytes.readByte();this.indexs=[];for(var i=0;i<len;i++){this.indexs.push(bytes.readByte())}len=bytes.readByte();this.noticeArr=[];for(var i=0;i<len;i++){this.noticeArr.push({name:bytes.readString(),index:bytes.readByte()})}this.noticeArr.reverse()};ActivityType9Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType9Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType9Data.prototype.checkRedPoint=function(){return this.getIns().getType9RedPoint(this.id)||this.isNewdayShowRedPoint(this.id)};ActivityType9Data.prototype.isNewdayShowRedPoint=function(id){if(id==Activity.ins().duanwuID[0]){var isshow=Activity.ins().getfirstShowRedPointById(id);return isshow}return false};ActivityType9Data.prototype.getRemainTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc;if(beganTime>=0){desc=i18n("ActivityType9Data_0")}else if(endedTime<=0){desc=i18n("ActivityType9Data_1")}else{desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}return desc};ActivityType9Data.prototype.getLastTime=function(){var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3);return desc};ActivityType9Data.prototype.getStateByIndex=function(index){var state=this.record>>index&1;return state};return ActivityType9Data}(ActivityBaseData);__reflect(ActivityType9Data.prototype,"ActivityType9Data");var ActivityPanel=function(_super){__extends(ActivityPanel,_super);function ActivityPanel(){var _this=_super.call(this)||this;_this._activityBtnType=-1;_this.activityType=ActivityType.Normal;return _this}Object.defineProperty(ActivityPanel.prototype,"activityBtnType",{get:function(){return this._activityBtnType},enumerable:true,configurable:true});Object.defineProperty(ActivityPanel.prototype,"activityID",{get:function(){return this._activityID},set:function(value){this._activityID=value;var config;var abc;if(this.activityType==ActivityType.Normal){config=GlobalConfig.ActivityConfig[value];abc=GlobalConfig.ActivityBtnConfig[value]}else if(this.activityType==ActivityType.Personal){config=GlobalConfig.PActivityConfig[value];abc=GlobalConfig.PActivityBtnConfig[value]}if(config&&config.tabName)this.name=config.tabName;this._activityBtnType=abc.type},enumerable:true,configurable:true});ActivityPanel.create=function(activityID,actType){var config;if(actType==ActivityType.Normal){config=GlobalConfig.ActivityConfig[activityID]}else{config=GlobalConfig.PActivityConfig[activityID]}if(activityID>1e4){var pan=ObjectPool.pop("OSATarget0Panel");pan.activityType=actType;pan.activityID=activityID;return pan}var panel;if(config.activityType==1){panel=ObjectPool.pop("OSATarget"+config.activityType+"Panel",activityID);panel.activityType=actType;panel.activityID=activityID}else{panel=ObjectPool.pop("OSATarget"+config.activityType+"Panel");panel.activityType=actType;panel.activityID=activityID}return panel};ActivityPanel.prototype.updateData=function(){};ActivityPanel.getActivityTypeFromId=function(activityID){var config;if(GlobalConfig.ActivityBtnConfig[activityID]){config=GlobalConfig.ActivityBtnConfig[activityID]}else if(GlobalConfig.PActivityBtnConfig[activityID]){config=GlobalConfig.PActivityBtnConfig[activityID]}if(config){return config.activityType}return ActivityType.Normal};return ActivityPanel}(BaseView);__reflect(ActivityPanel.prototype,"ActivityPanel");var Auction=function(_super){__extends(Auction,_super);function Auction(){var _this=_super.call(this)||this;_this.bonus=[];_this.bonusGetTime=[];_this.bonusGot=0;_this.total=4;_this.sysId=PackageID.Auction;_this.regNetMsg(1,_this.postListData);_this.regNetMsg(2,_this.onOpenSuccess);_this.regNetMsg(4,_this.postAuctionResult);_this.regNetMsg(5,_this.postBuyResult);_this.regNetMsg(6,_this.postRecord);_this.regNetMsg(7,_this.noLimit);_this.regNetMsg(8,_this.postBonusResult);_this.regNetMsg(9,_this.postBonusRefresh);return _this}Auction.ins=function(){return _super.ins.call(this)};Auction.prototype.initLogin=function(){this.sendGetList(0);this.sendGetList(1);var c=0;var cfg=GlobalConfig.BonusConfig;for(var key in cfg){var v=cfg[key];if(v.id>0){c=c+1}}this.total=c};Auction.prototype.sendGetList=function(type){var bytes=this.getBytes(1);bytes.writeByte(type);this.sendToServer(bytes)};Auction.prototype.postListData=function(bytes){var type=bytes.readByte();var len=bytes.readInt();var list=[];for(var i_1=0;i_1<len;i_1++){list.push(new AuctionVo(bytes))}if(list.length>=2)list.sort(this.sort);if(type==0)this.auGuildDatas=list;else this.auServerDatas=list;for(var i=1;i<=this.total;i++){this.bonus[i]=bytes.readInt();this.bonusGetTime[i]=bytes.readInt()}this.bonusGot=bytes.readInt()};Auction.prototype.sort=function(a,b){if(a.putAwayTime>b.putAwayTime)return-1;if(a.putAwayTime<b.putAwayTime)return 1;return 0};Auction.prototype.sortByAuTime=function(a,b){if(a.time>b.time)return-1;if(a.time<b.time)return 1;return 0};Auction.prototype.sendOpenAuBox=function(id){var bytes=this.getBytes(2);bytes.writeInt(id);this.sendToServer(bytes)};Auction.prototype.onOpenSuccess=function(bytes){ViewManager.ins().open(AuctionItemChoiceWin,bytes.readInt(),bytes.readInt())};Auction.prototype.sendUseAuBox=function(type,id){var bytes=this.getBytes(3);bytes.writeByte(type);bytes.writeInt(id);this.sendToServer(bytes)};Auction.prototype.sendAUction=function(id,type,auctionTimes){var bytes=this.getBytes(4);bytes.writeInt(id);bytes.writeByte(type);bytes.writeByte(auctionTimes);this.sendToServer(bytes)};Auction.prototype.postAuctionResult=function(bytes){var result=bytes.readByte();switch(result){case 0:case 1:case 2:var vo=new AuctionVo(bytes);var itemVo=this.getVoByID(vo.id);if(result==1){this.deleteVo(itemVo);UserTips.ins().showTips(i18n("Auction_0"))}else{this.dateChanged(itemVo,vo);UserTips.ins().showTips(result==0?i18n("Auction_1"):i18n("Auction_2"))}break;case 3:UserTips.ins().showTips(i18n("Auction_3"));break;case 4:UserTips.ins().showTips(i18n("Auction_4"));break}};Auction.prototype.deleteVo=function(itemVo){if(this.auGuildDatas){var index=this.auGuildDatas.indexOf(itemVo);if(index>=0){this.auGuildDatas.splice(index,1);return}}if(this.auServerDatas){var index=this.auServerDatas.indexOf(itemVo);if(index>=0)this.auServerDatas.splice(index,1)}};Auction.prototype.postUpdate=function(){};Auction.prototype.getVoByID=function(id){return this.getVo(id,this.auGuildDatas)||this.getVo(id,this.auServerDatas)};Auction.prototype.getVo=function(id,list){if(!list||list.length<=0)return null;var len=list.length;for(var i=0;i<len;i++){if(list[i].id==id)return list[i]}return null};Auction.prototype.sendBuy=function(id,type){var bytes=this.getBytes(5);bytes.writeInt(id);bytes.writeByte(type);this.sendToServer(bytes)};Auction.prototype.postBuyResult=function(bytes){var result=bytes.readByte();switch(result){case 0:case 1:case 2:var vo=new AuctionVo(bytes);var itemVo=this.getVoByID(vo.id);if(result!=2){this.deleteVo(itemVo);UserTips.ins().showTips(result==1?i18n("Auction_5"):i18n("Auction_6"))}else{this.dateChanged(itemVo,vo);UserTips.ins().showTips(i18n("Auction_7"))}break;case 3:UserTips.ins().showTips(i18n("Auction_8"));break;case 4:UserTips.ins().showTips(i18n("Auction_9"));break}};Auction.prototype.dateChanged=function(oldData,newData){if(oldData.type!=newData.type){this.deleteVo(oldData);if(newData.type==0){this.auGuildDatas.push(newData);if(this.auGuildDatas.length>=2)this.auGuildDatas.sort(this.sort)}else{this.auServerDatas.push(newData);if(this.auServerDatas.length>=2)this.auServerDatas.sort(this.sort)}}else{oldData.putAwayTime=newData.putAwayTime;oldData.endTime=newData.endTime;oldData.myAuPrice=newData.myAuPrice;oldData.auctionTimes=newData.auctionTimes;oldData.aID=newData.aID}};Auction.prototype.getMaxPageByType=function(type,count){var datas=type?this.auServerDatas:this.auGuildDatas;if(!datas||!datas.length)return 1;return Math.ceil(datas.length/count)};Auction.prototype.getDataByPage=function(type,page,count){var datas=type==1?this.auServerDatas:this.auGuildDatas;if(!datas||!datas.length)return null;var index=(page-1)*count;return datas.slice(index,index+count)};Auction.prototype.isAuctionOpen=function(){return Actor.level>=GlobalConfig.AuctionConfig.openlv&&GameServer.serverOpenDay+1>=GlobalConfig.AuctionConfig.openserverday};Auction.prototype.sendRecord=function(type){var bytes=this.getBytes(6);bytes.writeByte(type);this.sendToServer(bytes)};Auction.prototype.postRecord=function(bytes){var type=bytes.readByte();var len=bytes.readShort();var list=[];var vo;for(var i=0;i<len;i++){vo=new AuctionRecordVo(bytes);vo.type=type;list.push(vo)}if(list.length>1)list.sort(this.sortByAuTime);return{type:type,list:list}};Auction.prototype.noLimit=function(bytes){ViewManager.ins().open(AuctionQuotaTipWin,bytes.readInt(),bytes.readInt())};Auction.prototype.checkRed=function(){return this.checkRedByType(0)||this.checkRedByType(1)||this.checkRedByType(2)};Auction.prototype.checkRedByType=function(type){if(type==2){return this.canGetBonus()==true}if(type==1){return false}var list=type?this.auServerDatas:this.auGuildDatas;return list&&list.length>0};Auction.prototype.getBonusCount=function(id){if(id===void 0){id=0}if(id>=1&&id<=this.total){return this.bonus[id]||0}var sum=0;for(var i=1;i<=this.total;i++){var b=this.bonus[i]||0;sum+=b}return sum};Auction.prototype.getBonusGetTime=function(id){if(id===void 0){id=0}if(id>=1&&id<=this.total){return this.bonusGetTime[id]||0}return 0};Auction.prototype.canGetBonus=function(id){if(id===void 0){id=0}if(id>=1&&id<=this.total){var t=this.getBonusGetTime(id);var now=Math.floor(GameServer.serverTime/1e3);return now>=t&&this.getBonusCount(id)>0}var sum=false;for(var i=1;i<=this.total;i++){var b=this.canGetBonus(i);if(b){sum=true}}return sum};Auction.prototype.sendReqBonus=function(fid){var bytes=this.getBytes(8);bytes.writeShort(fid);this.sendToServer(bytes)};Auction.prototype.postBonusResult=function(bytes){var errid=bytes.readByte();var got=bytes.readInt();var fid=bytes.readShort();switch(errid){case 0:this.bonus[fid]=0;this.bonusGetTime[fid]=0;this.bonusGot=got;console.log("get auction bonus success, fid = "+fid);break;case 1:console.log("get auction bonus failed, fid = "+fid+" no bonus");break;case 2:console.log("get auction bonus failed, fid = "+fid+" bonusWaitTime");break}};Auction.prototype.postBonusRefresh=function(bytes){Auction.ins().sendGetList(0)};return Auction}(BaseSystem);__reflect(Auction.prototype,"Auction");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.auction=Auction.ins.bind(Auction)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var Book=function(_super){__extends(Book,_super);function Book(){var _this=_super.call(this)||this;_this.bookPower=0;_this.score=-1;_this.sysId=PackageID.Book;_this.regNetMsg(1,_this.postDataChange);_this.listBook={};_this.itemBook={};return _this}Book.ins=function(){return _super.ins.call(this)};Book.prototype.getSuitIdByBookId=function(id){var cardConfig=GlobalConfig.CardConfig[id][0];if(!cardConfig)return 0;for(var k in GlobalConfig.SuitConfig){if(GlobalConfig.SuitConfig[k][1].idList.indexOf(id)!=-1){return Number(k)}}return 0};Book.prototype.getSuitNum=function(suitId){var conf=GlobalConfig.SuitConfig[suitId][1];var num=0;for(var i=0;i<conf.idList.length;i++){var bookData=this.getBookById(conf.idList[i]);if(bookData.level>-1){num++}}return num};Book.prototype.getSuitLevel=function(suitId){var num=this.getSuitNum(suitId);var level=0;var index=1;while(GlobalConfig.SuitConfig[suitId][index]){if(GlobalConfig.SuitConfig[suitId][index].count<=num){level=GlobalConfig.SuitConfig[suitId][index].level}index++}return level};Book.prototype.getBookRed=function(){for(var key in GlobalConfig.BookListConfig){var idList=GlobalConfig.BookListConfig[key].idList;for(var _i=0,idList_1=idList;_i<idList_1.length;_i++){var i=idList_1[_i];var element=GlobalConfig.SuitConfig[i][1].idList;for(var _a=0,element_1=element;_a<element_1.length;_a++){var id=element_1[_a];if(this.getBookById(id).getState()==BookState.canOpen)return true}}}return false};Book.prototype.getBookUpRed=function(){for(var key in GlobalConfig.BookListConfig){var idList=GlobalConfig.BookListConfig[key].idList;for(var _i=0,idList_2=idList;_i<idList_2.length;_i++){var i=idList_2[_i];if(this.getBookUpRedByListId(i))return true}}return false};Book.prototype.getBookUpRedByListId=function(listId){var elements=GlobalConfig.SuitConfig[listId][1].idList;for(var _i=0,elements_1=elements;_i<elements_1.length;_i++){var id=elements_1[_i];var data=this.getBookById(id);var nextCost=data.getNextLevelCost();if(nextCost&&this.score>=nextCost){return true}}};Book.prototype.getBookRedById=function(bookId){if(this.getBookById(bookId).getState()==BookState.canOpen)return true;return false};Book.prototype.getBookById=function(id){if(!this.listBook[id]){var data=new BooKData;this.listBook[id]=data;data.id=id}return this.listBook[id]};Book.prototype.getBookByItemId=function(itemId){if(!this.itemBook[itemId]){this.itemBook[itemId]=[]}return this.itemBook[itemId]};Book.prototype.getBookPown=function(){var conf=GlobalConfig.CardConfig;var pown=0;for(var k in this.listBook){var bookData=this.listBook[k];if(bookData.level>-1){var data=conf[k][bookData.level];pown+=Math.floor(UserBag.getAttrPower(data.attrs))}}var suitAttrSum=[];for(var i in GlobalConfig.BookListConfig){var cfg=GlobalConfig.BookListConfig[i];var curNum=Book.ins().getSuitNum(cfg.idList[0]);for(var j in GlobalConfig.SuitConfig[cfg.idList[0]]){var suit=GlobalConfig.SuitConfig[cfg.idList[0]][j];if(curNum>=suit.count){suitAttrSum=suit.attrs}else{pown+=Math.floor(UserBag.getAttrPower(suitAttrSum));suitAttrSum=[];break}}if(suitAttrSum.length>0)pown+=Math.floor(UserBag.getAttrPower(suitAttrSum))}return pown};Book.prototype.getBookPowerNum=function(power,id){var len=SubRoles.ins().subRolesLen;if(id){for(var k in GlobalConfig.SuitConfig){if(Book.jobs.indexOf(Number(k))!=-1&&GlobalConfig.SuitConfig[k][1].idList.indexOf(id)!=-1){len=1;break}}}return power*len};Book.prototype.getBookPowerNumEx=function(){return this.bookPower};Book.prototype.getUpChipData=function(booKData){var result=[];var conf=GlobalConfig.CardConfig;var arrConf=conf[booKData.id];var maxExp=0;for(var k in arrConf){if(arrConf[k].level>booKData.level)maxExp+=arrConf[k].cost}var chipConf=GlobalConfig.DecomposeConfig;var needExp=maxExp-booKData.exp;var upExp=0;for(var k in this.listBook){var data=conf[k][1];var count=UserBag.ins().getBagGoodsCountById(0,data.itemId);var chip=chipConf[booKData.id];var bookData=this.listBook[k];if(bookData.level>-1&&count>0){for(var i=0;i<count;i++){if(upExp>needExp)break;upExp+=chip.value;result.push(+k);if(result.length>=12)return result}}}result.sort(Book.sort);return result};Book.sort=function(a,b){if(a==b)return 0;var aConf=GlobalConfig.DecomposeConfig[a];var bConf=GlobalConfig.DecomposeConfig[b];if(aConf.value>bConf.value)return 1;if(aConf.value<bConf.value)return-1;else return 0};Book.prototype.getTitleById=function(id){var config=GlobalConfig.BookListConfig;for(var k in config){if(config[k].idList.indexOf(id)!=-1)return config[k].name}return""};Book.prototype.getListData=function(){return this.listBook};Book.prototype.sendBookData=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};Book.prototype.postDataChange=function(bytes){if(this.score==-1){var configs=GlobalConfig.DecomposeConfig;for(var id in configs){var data=this.getBookById(+id);this.getBookByItemId(configs[id].itemId).push(data)}}var len=bytes.readInt();for(var i=0;i<len;i++){var id=bytes.readShort();var data=this.getBookById(id);data.updateData(bytes)}var score=bytes.readInt();if(this.score>-1){var addScore=score-this.score;if(addScore>0){UserTips.ins().showTips(i18n("Book_0")+i18n("Book_1",addScore))}}this.score=score;this.bookPower=bytes.readDouble()};Book.prototype.sendOpen=function(id){var bytes=this.getBytes(2);bytes.writeShort(id);this.sendToServer(bytes)};Book.prototype.sendDecompose=function(arrId){var bytes=this.getBytes(3);bytes.writeInt(arrId.length);for(var i=0;i<arrId.length;i++){bytes.writeShort(arrId[i][0]);bytes.writeShort(arrId[i][1])}this.sendToServer(bytes)};Book.prototype.sendUp=function(id){var bytes=this.getBytes(4);bytes.writeShort(id);this.sendToServer(bytes)};Book.prototype.getDecomposeConfigByItemId=function(itemId){var configs=GlobalConfig.DecomposeConfig;if(!this.itemBook[itemId]){Assert(false,i18n("Book_2",itemId,Object.keys(this.itemBook).length));return null}if(this.itemBook[itemId][0]){var id=this.itemBook[itemId][0].id;return configs[id]}return null};Book.prototype.checkResolveRedPoint=function(){var itemData=UserBag.ins().getBagGoodsByType(ItemType.TYPE_9);if(!itemData.length){return false}var listBook=this.itemBook;var noActDic={};for(var itemId in listBook){for(var _i=0,_a=listBook[itemId];_i<_a.length;_i++){var item=_a[_i];if(item.getState()!=BookState.haveOpen){noActDic[itemId]=true;break}}}for(var _b=0,itemData_2=itemData;_b<itemData_2.length;_b++){var item=itemData_2[_b];if(!noActDic[item.configID]){return true}}return false};Book.prototype.getSuitRedPoint=function(s){var self=this;var config=GlobalConfig.SuitConfig;var books=UserBag.ins().getBagGoodsByType(ItemType.TYPE_9);if(books.length==0)return false;var packDic={};for(var _i=0,books_1=books;_i<books_1.length;_i++){var item=books_1[_i];packDic[item.configID]=true}var f=function(_suit){var conf=config[_suit][1];var idList=conf["idList"];for(var _i=0,idList_3=idList;_i<idList_3.length;_i++){var id=idList_3[_i];if(self.listBook[id]&&self.listBook[id].level==-1){var roleJob=Book.jobs.indexOf(conf.id);if(roleJob==-1){var c=GlobalConfig.DecomposeConfig[id];if(packDic[c.itemId]){return true}}else{var isHaveRole=false;for(var i=0;i<SubRoles.ins().subRolesLen;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role.job==roleJob+1){isHaveRole=true;break}}if(!isHaveRole)continue;var cardConfig=GlobalConfig.CardConfig[id][0];if(cardConfig){if(packDic[cardConfig.itemId]){return true}}}}}return false};if(s==0){for(var suit in config){if(f(suit))return true}}else{return f(s)}return false};Book.prototype.getHaveBookSuit=function(id){var books=UserBag.ins().getBagGoodsByType(ItemType.TYPE_9);var config=GlobalConfig.SuitConfig[id][1];if(books.length==0){return{ishave:false,cur:0,target:config.idList.length}}};Book.jobs=[6,7,8];return Book}(BaseSystem);__reflect(Book.prototype,"Book");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.book=Book.ins.bind(Book)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var WorldBossRankItemData=function(){function WorldBossRankItemData(){}WorldBossRankItemData.prototype.parser=function(bytes){this.id=bytes.readInt();this.roleName=bytes.readString();this.value=bytes.readDouble()};WorldBossRankItemData.prototype.parser1=function(bytes){this.roleName=bytes.readString();this.value=bytes.readInt()};Object.defineProperty(WorldBossRankItemData.prototype,"name",{get:function(){var str=this.roleName+":"+CommonUtils.overLength(this.value);return str},enumerable:true,configurable:true});return WorldBossRankItemData}();__reflect(WorldBossRankItemData.prototype,"WorldBossRankItemData");var BaseComponent=function(_super){__extends(BaseComponent,_super);function BaseComponent(){var _this=_super.call(this)||this;_this.className="@策划@使用此组件必须填写逻辑类名";return _this}BaseComponent.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};BaseComponent.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};Object.defineProperty(BaseComponent.prototype,"data",{get:function(){return this["_data"]},set:function(value){this["_data"]=value;eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"data");if(this["dataChanged"])this["dataChanged"]()},enumerable:true,configurable:true});BaseComponent.filterKeys=["data"];BaseComponent.copyKeys=["open","close"];return BaseComponent}(BaseView);__reflect(BaseComponent.prototype,"BaseComponent");var ChatDataBase=function(){function ChatDataBase(){}return ChatDataBase}();__reflect(ChatDataBase.prototype,"ChatDataBase");var UserFb=function(_super){__extends(UserFb,_super);function UserFb(){var _this=_super.call(this)||this;_this.fbModel={};_this._groupID=1;_this._guanqiaID=-1;_this.rewards=[];_this.eliteRewards=[];_this.maxLen=0;_this.guanqiaReward=0;_this.worldReward=0;_this.worldGuanQias=[];_this.worldGuanQiaHasReceive=[];_this.currentEnergy=0;_this.canChallengGuanQia=true;_this.encounterPos=[];_this.expMonterCount=0;_this.expMonterCountKill=0;_this.isQuite=true;_this.guideBossKill=0;_this.showAni=true;_this.showAutoPk=-1;_this.showAutoPk2=-1;_this.firstAutoGuilder=false;_this.isCloseFbEntrance=false;_this.fbExpTotal=0;_this.tfRoomID=0;_this.tfPassID=0;_this._tfInviteTime=0;_this.showTfRed=true;_this.needStory=false;_this.awardCount=3;_this.helpCount=10;_this.tfOpenID=0;_this.fbRings={buyTime:0,challengeTime:0,canTakeAward:false};_this.guanqiaMonster=[];_this.fbConfig={};_this.mijingFingfen=4;_this.mijingUseTime=0;_this.pkGqboss=false;_this.storyOnce={};_this.exp=0;_this.guanqiaIDFast=-1;_this.fbDataList=[];_this.initPos=true;_this.sysId=PackageID.Guanqia;_this.regNetMsg(4,_this.doRoleAllDie);_this.regNetMsg(10,_this.postFbInfoInit);_this.regNetMsg(11,_this.postUpDataInfo);_this.regNetMsg(13,_this.postFbTime);_this.regNetMsg(14,_this.doBossBoxNum);_this.regNetMsg(16,_this.postFbExpInfo);_this.regNetMsg(17,_this.postFbExpTotal);_this.regNetMsg(18,_this.doGuideFbAliveTime);_this.regNetMsg(21,_this.postFbRingInfo);_this.regNetMsg(1,_this.postGuanqiaInfo);_this.regNetMsg(2,_this.doWaveData);_this.regNetMsg(3,_this.doBossResult);_this.regNetMsg(5,_this.doGuanqiaReward);_this.regNetMsg(6,_this.doGuanqiaWroldReward);_this.regNetMsg(12,_this.doOfflineReward);_this.regNetMsg(24,_this.postGuardLeftTime);_this.regNetMsg(25,_this.postGuardInfo);_this.regNetMsg(27,_this.postGuardUseSkill);_this.regNetMsg(28,_this.postGuardCopyInfo);_this.regNetMsg(29,_this.postBossDrop);_this.regNetMsg(30,_this.postCreateTFRoomSuccess);_this.regNetMsg(31,_this.postEnterTFRoomSuccess);_this.regNetMsg(32,_this.exitTFRoom);_this.regNetMsg(33,_this.postFTRoomChange);_this.regNetMsg(34,_this.postFTRoomPassInfo);_this.regNetMsg(35,_this.doTeamFuBenEnd);_this.regNetMsg(36,_this.doTeamFuBenRelive);_this.regNetMsg(37,_this.postTeamFuBenRank);_this.regNetMsg(38,_this.postTeamFbFlowarRecords);_this.regNetMsg(39,_this.teamFbSysInviteInfo);_this.regNetMsg(40,_this.postGuardWeaponLogs);_this.regNetMsg(41,_this.postGuanqiaIDFast);_this.regNetMsg(43,_this.postChangeJobRes);_this.regNetMsg(44,_this.postChangeRoomRes);_this.regNetMsg(45,_this.postCollectState);_this.observe(GameLogic.ins().postEnterMap,_this.onChangeScene);_this.observe(GameLogic.ins().postHpChange,_this.recordKill);return _this}Object.defineProperty(UserFb.prototype,"rCount",{get:function(){return this.fbConfig.rCount||0},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"goldEff",{get:function(){return this.fbConfig.goldEff||0},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"expEff",{get:function(){return this.fbConfig.expEff||0},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"ssExpEff",{get:function(){return this.fbConfig.bsexpEff||0},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"zyPos",{get:function(){return this.fbConfig.zyPos},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"energy",{get:function(){return this.fbConfig.energy||0},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"waveEnergy",{get:function(){return this.fbConfig.waveEnergy||0},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"waveMonsterCount",{get:function(){return this.fbConfig.waveMonsterCount||0},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"waveMonsterId",{get:function(){return this.fbConfig.waveMonsterId||[]},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"outPos",{get:function(){return this.fbConfig.outPos||{x:0,y:0,a:0}},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"rPos",{get:function(){return this.fbConfig.rPos||[]},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"eliteMonsterId",{get:function(){return this.fbConfig.eliteMonsterId||0},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"wanderpercent",{get:function(){return this.fbConfig.wanderpercent==undefined?5e3:this.fbConfig.wanderpercent},enumerable:true,configurable:true});UserFb.prototype.postGuanqiaIDFast=function(bytes){this.guanqiaIDFast=bytes.readInt()};UserFb.prototype.getBossDrop=function(type,bossHandler){var bytes=this.getBytes(29);bytes.writeByte(type);bytes.writeDouble(bossHandler);this.sendToServer(bytes)};UserFb.prototype.postBossDrop=function(bytes){var _this=this;var type=bytes.readByte();var bossHandle=bytes.readDouble();var len=bytes.readByte();for(var j=0;j<len;j++){var reward=new RewardData;reward.type=bytes.readInt();reward.id=bytes.readInt();reward.count=bytes.readInt();if(reward.type==0&&reward.id!=1&&reward.id!=2&&reward.id!=MoneyConst.rune){}else{DropHelp.addDrop([DropHelp.tempDropPoint.x!=0?DropHelp.tempDropPoint.x:Math.floor(EntityManager.ins().getNoDieRole().x/GameMap.CELL_SIZE),DropHelp.tempDropPoint.y!=0?DropHelp.tempDropPoint.y:Math.floor(EntityManager.ins().getNoDieRole().y/GameMap.CELL_SIZE),reward])}}DropHelp.start();TimerManager.ins().doTimerDelay(500,100,1,function(){_this.getBossDrop(type,bossHandle)},this)};UserFb.prototype.postGuardLeftTime=function(bytes){GuardWeaponModel.ins().leftTime=bytes.readUnsignedInt()};UserFb.prototype.challengeGuard=function(){var bytes=this.getBytes(24);this.sendToServer(bytes)};UserFb.prototype.callGuardBoss=function(){var bytes=this.getBytes(26);this.sendToServer(bytes)};UserFb.prototype.guardUseSkill=function(index){var bytes=this.getBytes(27);bytes.writeByte(index);this.sendToServer(bytes)};UserFb.prototype.postGuardInfo=function(bytes){var num=bytes.readByte();GuardWeaponModel.ins().challengeTimes=num;GuardWeaponModel.ins().isShowSweep=bytes.readByte()==1};UserFb.prototype.postGuardUseSkill=function(bytes){return bytes.readByte()};UserFb.prototype.postGuardCopyInfo=function(bytes){var info=GuardWeaponModel.ins().guardCopyInfo||new GuardCopyInfo;info.parser(bytes.readByte(),bytes.readInt(),bytes.readByte(),bytes.readInt(),bytes.readByte(),bytes.readInt());GuardWeaponModel.ins().guardCopyInfo=info};UserFb.prototype.recordKill=function(_a){var target=_a[0],value=_a[1];if(target instanceof CharRole)return;if(value<=0)this.expMonterCountKill+=1};UserFb.prototype.initLogin=function(){if(GlobalConfig.DailyFubenConfig){this.fbDataList.length=0;for(var key in GlobalConfig.DailyFubenConfig){var cfg=GlobalConfig.DailyFubenConfig[key];if(cfg.bossId){continue}this.fbDataList.push(cfg.id)}}};UserFb.ins=function(){return _super.ins.call(this)};UserFb.prototype.onChangeScene=function(){this.rewards=[];this.eliteRewards=[];this.expMonterCountKill=0;this.expMonterCount=0;if(!this.tfRoomID)ViewManager.ins().close(TeamFbRoomWin);ViewManager.ins().close(TeamFbResultWin);if(GameMap.fbType==UserFb.FB_TEAM){ViewManager.ins().open(TeamFbFightWin)}else{ViewManager.ins().close(TeamFbFightWin)}};UserFb.prototype.getFbDataById=function(id){return this.fbModel[id]};UserFb.prototype.autoPk=function(){if(!GameMap.sceneInMain())return;if(Encounter.ins().isEncounter()){UserTips.ins().showTips(i18n("UserFb_0"));return}if(!EntityManager.ins().getNoDieRole()){return}var self=this;var continuePK=function(){RoleAI.ins().stop();RoleAI.ins().clearAIList();self.postPlayWarm(1);UserFb.ins().sendPKBoss();UserFb.ins().pkGqboss=true};continuePK()};UserFb.prototype.showStory=function(type,compFunc){if(type===void 0){type="begin"}var guanqiaID=this.guanqiaID;var storyCfg=GlobalConfig.StoryConfig;var key=guanqiaID.toString()+"_"+type;if(this.storyOnce[key]){compFunc();return}this.storyOnce[key]=true;var storys=storyCfg[key];var needBody=false;if(key=="1_begin"){needBody=true}if(storys&&this.needStory){ViewManager.ins().open(StoryWin,storys,compFunc,needBody)}else{compFunc()}};UserFb.prototype.postAddEnergy=function(){this.currentEnergy+=Math.ceil(this.waveEnergy/this.waveMonsterCount);if(this.currentEnergy>UserFb.ins().energy){this.currentEnergy=UserFb.ins().energy}};UserFb.prototype.postPlayWarm=function(num){return num};UserFb.prototype.hasCount=function(){if(GlobalConfig.DailyFubenConfig){for(var key in GlobalConfig.DailyFubenConfig){var cfg=GlobalConfig.DailyFubenConfig[key];var mo=this.fbModel[cfg.id];if(!mo||cfg.bossId){continue}var count=this.fbModel[mo.fbID].getCount();if(count>0){var open=true;if(UserZs.ins().lv<cfg.zsLevel){open=false}else{if(cfg.id==GlobalConfig.ZhanLingConfig.fbIndex){open=GameServer.serverOpenDay+1>=GlobalConfig.ZhanLingConfig.openserverday}}if(open){return true}}if(DieGuide.ins().dieFbRedPoint(this.fbModel[mo.fbID].getResetCount(),cfg.id))return true}}return false};UserFb.prototype.doRoleAllDie=function(bytes){ResultManager.ins().create(GameMap.fbType,0)};UserFb.prototype.postFbInfoInit=function(bytes){var count=bytes.readShort();var fbModel;for(var i=0;i<count;i++){fbModel=new FbModel;fbModel.parser(bytes);this.fbModel[fbModel.fbID]=fbModel}};UserFb.prototype.sendCallBossPlay=function(id){var bytes=this.getBytes(12);bytes.writeInt(id);this.sendToServer(bytes)};UserFb.prototype.sendChallenge=function(fbID){var bytes=this.getBytes(10);bytes.writeInt(fbID);this.sendToServer(bytes)};UserFb.prototype.postUpDataInfo=function(bytes){var fbID=bytes.readInt();bytes.position-=4;this.fbModel[fbID].parser(bytes)};UserFb.prototype.sendAddCount=function(fbID,isDouble){if(isDouble===void 0){isDouble=0}var bytes=this.getBytes(11);bytes.writeInt(fbID);bytes.writeByte(isDouble);this.sendToServer(bytes)};UserFb.prototype.postFbTime=function(bytes){this.curFbID=bytes.readInt();this.curFbLeftTime=bytes.readInt();return[this.curFbID,this.curFbLeftTime]};UserFb.prototype.doBossBoxNum=function(bytes){this.bossCallNum=bytes.readShort()};UserFb.prototype.postFbExpInfo=function(bytes){this.fbExp=this.fbExp||{};this.fbExp.useTime=bytes.readByte();this.fbExp.sdTime=bytes.readByte();this.fbExp.cid=bytes.readByte();this.fbExp.sid=bytes.readByte();this.fbExp.isfirstT=bytes.readInt();return this.fbExp};UserFb.prototype.postFbExpTotal=function(bytes){this.fbExpTotal=bytes.readInt();return this.fbExpTotal};UserFb.prototype.fbExpRed=function(){if(Actor.level>=GlobalConfig.ExpFubenBaseConfig.openLv){if(this.fbExp.useTime<GlobalConfig.ExpFubenBaseConfig.freeCount+(GlobalConfig.ExpFubenBaseConfig.vipCount[UserVip.ins().lv]||0)||this.fbExp.cid||this.fbExp.sid){return true}}return false};UserFb.prototype.sendIntoGuideFb=function(fbId){var bytes=this.getBytes(18);bytes.writeInt(fbId);this.sendToServer(bytes)};UserFb.prototype.sendGuideFbAttacker=function(){this.sendBaseProto(19)};UserFb.prototype.sendGuideFbAlive=function(){this.sendBaseProto(20)};UserFb.prototype.doGuideFbAliveTime=function(bytes){UserBoss.ins().postRemainTime(bytes)};UserFb.prototype.postFbRingInfo=function(bytes){this.fbRings.buyTime=bytes.readShort();this.fbRings.challengeTime=bytes.readShort();this.fbRings.canTakeAward=bytes.readBoolean()};UserFb.prototype.sendRingSweep=function(count){var bytes=this.getBytes(41);bytes.writeShort(count);this.sendToServer(bytes)};UserFb.prototype.sendShSweep=function(count){var bytes=this.getBytes(42);bytes.writeByte(count);this.sendToServer(bytes)};UserFb.prototype.sendChangeJob=function(rid,rjob){var bytes=this.getBytes(43);bytes.writeInt(rid);bytes.writeInt(rjob);this.sendToServer(bytes)};UserFb.prototype.postChangeJobRes=function(bytes){switch(bytes.readByte()){case 0:console.log(i18n("UserFb_1"));break;case 1:console.log(i18n("UserFb_2",DateUtils.WEEK_CN[GlobalConfig.TeamFuBenBaseConfig.closeTime[0]],GlobalConfig.TeamFuBenBaseConfig.closeTime[1]));break;case 4:console.log(i18n("UserFb_3"));break;case 6:console.log(i18n("UserFb_4"));break}};UserFb.prototype.sendChangeRoom=function(next){if(next===void 0){next=1}var bytes=this.getBytes(44);bytes.writeByte(next);this.sendToServer(bytes)};UserFb.prototype.postChangeRoomRes=function(bytes){switch(bytes.readByte()){case 0:console.log(i18n("UserFb_5"));break;case 1:console.log(i18n("UserFb_6"));break;case 2:console.log(i18n("UserFb_7"));break;case 3:UserTips.ins().showTips(i18n("UserFb_8"));break;case 4:console.log(i18n("UserFb_9"));break;case 5:console.log(i18n("UserFb_10"));break;case 6:console.log(i18n("UserFb_11"));break;case 7:UserTips.ins().showTips(i18n("UserFb_12"));break;case 8:UserTips.ins().showTips(i18n("UserFb_13"));break;case 9:UserTips.ins().showTips(i18n("UserFb_14"));break}};UserFb.prototype.postCollectState=function(bytes){var handle=bytes.readDouble();var past=bytes.readInt();var period=bytes.readInt();if(KfArenaSys.ins().isKFArena){KfArenaSys.ins().curCollecHandle=handle}if(handle&&handle==Actor.handle&&period){ViewManager.ins().open(CollectWin,handle,past,period);GameLogic.ins().currAttackHandle=0}else ViewManager.ins().close(CollectWin)};UserFb.prototype.sendReqRobot=function(){var bytes=this.getBytes(45);bytes.writeInt(UserFb.ins().tfRoomID);this.sendToServer(bytes)};UserFb.prototype.parser=function(bytes){var idIndex=bytes.readInt();this.guanqiaID=idIndex;if(this.firstAutoGuilder&&this.guanqiaID==GlobalConfig.OpenSystemConfig[SystemType.CHALLENGE].opencheck){this.firstAutoGuilder=false;UserFb.ins().setAutoPk2()}};Object.defineProperty(UserFb.prototype,"guanqiaID",{get:function(){return this._guanqiaID},set:function(value){this.guanqiaIDFast=value;if(this._guanqiaID!=value){this._guanqiaID=value;this.bossIsChallenged=false;for(var i in GlobalConfig.WorldRewardConfig){if(this._guanqiaID<=GlobalConfig.WorldRewardConfig[i].needLevel){this._groupID=GlobalConfig.WorldRewardConfig[i].groupId;break}}this.postGuanKaIdChange()}this.encounterPos=[];for(var k in this.zyPos){this.encounterPos.push(parseInt(k))}},enumerable:true,configurable:true});Object.defineProperty(UserFb.prototype,"groupID",{get:function(){return this._groupID},enumerable:true,configurable:true});UserFb.prototype.isReceiveBox=function(pass){return this.worldGuanQias.indexOf(pass)!=-1};UserFb.prototype.isGetReceiveBox=function(pass){return this.worldGuanQiaHasReceive.indexOf(pass)!=-1};UserFb.prototype.isShowBossPK=function(){return this.guanqiaID!=-1};UserFb.prototype.getRewardsPop=function(){return this.rewards};UserFb.prototype.getMapReward=function(){var index=1;while(GlobalConfig.WorldRewardConfig[index]){if(!this.isGetReceiveBox(index)&&GlobalConfig.WorldRewardConfig[index].needLevel<UserFb.ins().guanqiaID){this.sendGuanqiaWroldReward(index);return}index++}};UserFb.prototype.getCurrentReward=function(){var index=1;while(GlobalConfig.WorldRewardConfig[index]){var config=GlobalConfig.WorldRewardConfig[index];var result=this.isGetReceiveBox(index);var id=UserFb.ins().guanqiaID;if(!this.isGetReceiveBox(index)&&UserFb.ins().guanqiaID>config.needLevel){return config.rewards}index++}return null};UserFb.prototype.getNextReward=function(){var index=1;while(GlobalConfig.WorldRewardConfig[index]){var config=GlobalConfig.WorldRewardConfig[index];if(UserFb.ins().guanqiaID<=config.needLevel){return config.rewards}index++}return null};UserFb.prototype.getNextNeedChapter=function(){var index=1;while(GlobalConfig.WorldRewardConfig[index]){var config=GlobalConfig.WorldRewardConfig[index];if(UserFb.ins().guanqiaID<=config.needLevel){return config.needLevel-UserFb.ins().guanqiaID+1}index++}return 0};UserFb.prototype.getDiffChapter=function(){var index=1;while(GlobalConfig.WorldRewardConfig[index]){var config=GlobalConfig.WorldRewardConfig[index];if(UserFb.ins().guanqiaID<=config.needLevel){var preconfig=GlobalConfig.WorldRewardConfig[index-1];return config.needLevel-preconfig.needLevel}index++}return 0};UserFb.prototype.getNewChapter=function(){var index=1;while(GlobalConfig.WorldRewardConfig[index]){var config=GlobalConfig.WorldRewardConfig[index];if(UserFb.ins().guanqiaID<=config.needLevel){var idx=index-1;idx=idx?idx:1;return GlobalConfig.WorldRewardConfig[idx]}index++}return null};UserFb.prototype.getChipByGuanQia=function(){for(var k in GlobalConfig.WorldRewardConfig){var config=GlobalConfig.WorldRewardConfig[k];if(this.guanqiaID<=config.needLevel)return config.rewards[0].id}return 0};UserFb.prototype.postGuanqiaInfo=function(bytes){var lastID=this.guanqiaID;this.parser(bytes);this.goldEffLast=bytes.readInt();this.expEffLast=bytes.readInt();this.bsExpEffLast=bytes.readInt();this.fbConfig=JSON.parse(bytes.readString());if(lastID!=-1&&this.guanqiaID!=lastID){this.currentEnergy=0;RewardWin.addOnCloseOnce(function(){ViewManager.ins().open(EffectivenessTip)})}this.guanqiaMonster=JSON.parse(bytes.readString());if(GameMap.fubenID==0)GameLogic.ins().createGuanqiaMonster()};UserFb.prototype.postGuanKaIdChange=function(){};UserFb.prototype.sendGetReward=function(isElite){var bytes=this.getBytes(1);bytes.writeByte(isElite?1:0);this.sendToServer(bytes)};UserFb.prototype.sendPKBoss=function(){var _this=this;var bytes=this.getBytes(2);var char=EntityManager.ins().getNoDieRole();TimerManager.ins().doTimer(500,1,function(){bytes.writeInt(Math.floor(char.x));bytes.writeInt(Math.floor(char.y));_this.sendToServer(bytes)},this)};UserFb.prototype.doWaveData=function(bytes){this.exp=bytes.readInt();var count=bytes.readInt();var awards=[];for(var i=0;i<count;i++){var item=new WaveDropData;item.parser(bytes);awards.push(item)}var numElite=bytes.readInt();var eliteRewards=[];for(var i=0;i<numElite;i++){var item=new WaveDropData;item.parser(bytes);eliteRewards.push(item)}if(numElite>0){this.eliteRewards.push(eliteRewards);if(this.eliteRewards.length>5)this.eliteRewards.shift();GameLogic.ins().createGuanqiaMonster(false,true)}if(count>0){this.rewards=this.rewards.concat(awards)}};UserFb.prototype.doBossResult=function(bytes){var _this=this;var result=bytes.readBoolean();var fbType=bytes.readShort();var count=bytes.readShort();var reward;var rewards=[];for(var i=0;i<count;i++){reward=new RewardData;reward.parser(bytes);rewards.push(reward)}count=bytes.readShort();var extraRewards=[];for(var i=0;i<count;i++){reward=new RewardData;reward.parser(bytes);extraRewards.push(reward)}if(result){var len=SubRoles.ins().subRolesLen;var role=void 0;for(var k=0;k<len;k++){role=EntityManager.ins().getMainRole(k);if(role){role.resetStand()}}for(var j=0;j<rewards.length;j++){reward=rewards[j];if(reward.type==0&&reward.id!=1&&reward.id!=2&&reward.id!=MoneyConst.rune){}else if(fbType==UserFb.FB_TYPE_GUARD_WEAPON){}else{DropHelp.addDrop([DropHelp.tempDropPoint.x!=0?DropHelp.tempDropPoint.x:Math.floor(EntityManager.ins().getNoDieRole().x/GameMap.CELL_SIZE),DropHelp.tempDropPoint.y!=0?DropHelp.tempDropPoint.y:Math.floor(EntityManager.ins().getNoDieRole().y/GameMap.CELL_SIZE),reward])}if(reward.type==1){var conf=GlobalConfig.ItemConfig[reward.id];var type=ItemConfig.getType(conf);if(type==7){var itemData=new ItemData;itemData.configID=reward.id;UserTips.ins().showGoodEquipTips(itemData)}}}var f=function(){if(GameMap.fbType!=UserFb.FB_TYPE_EXP){_this.sendGetBossReward()}var f2=null;if(fbType==UserFb.FB_TYPE_TIAOZHAN&&SkyLevelModel.ins().getIsopenNext||GameMap.fbType==UserFb.FB_TYPE_PERSONAL){f2=function(){UserFb.ins().pkGqboss=false;if(GameMap.fbType==UserFb.FB_TYPE_PERSONAL){ViewManager.ins().open(BossWin,0)}else{if(UserFb.ins().isQuite){ViewManager.ins().open(FbWin,2)}}}}if(fbType==UserFb.FB_TYPE_GUIDEBOSS&&GameMap.fubenID==4e4){var isBelong=UserFb.ins().guideBossKill;var belongName=void 0,job=void 0,sex=void 0,belongImg=void 0;if(isBelong){belongName=Actor.myName;job=SubRoles.ins().roles[0].job;sex=SubRoles.ins().roles[0].sex}else{belongName=UserFb.ins().guideBossPlayerName;job=UserFb.ins().guideBossPlayerJob;sex=UserFb.ins().guideBossPlayerSex}belongImg="yuanhead"+job+sex;ResultManager.ins().create(fbType,true,rewards,"",null,[isBelong,belongName,belongImg])}else if(GameMap.fbType==UserFb.FB_TYPE_EXP){TimerManager.ins().doTimer(800,1,function(){ViewManager.ins().open(ExpFbResultWin)},_this)}else if(GameMap.fbType==UserFb.FB_TYPE_LIEYAN){TimerManager.ins().doTimer(800,1,function(){ViewManager.ins().open(FireResultWin)},_this)}else if(GameMap.fbType==UserFb.FB_TYPE_MIJING||GameMap.fbType==UserFb.FB_TYPE_LABA){}else if(fbType!=UserFb.FB_TYPE_GUANQIABOSS){if(rewards.length){TimerManager.ins().doTimer(800,1,function(){ResultManager.ins().create(fbType,1,rewards,i18n("UserFb_16"),f2,extraRewards)},_this)}else{UserFb.ins().pkGqboss=false;UserFb.ins().sendExitFb()}}else{if(_this.outPos.x&&_this.outPos.y){var posX=_this.outPos.x*GameMap.CELL_SIZE;var posY=_this.outPos.y*GameMap.CELL_SIZE;if(_this.outPos.hasOwnProperty("a")&&_this.outPos.a==1)GameLogic.ins().addOutEff(posX,posY);var len_1=SubRoles.ins().subRolesLen;var char=void 0;for(var i=0;i<len_1;i++){char=EntityManager.ins().getMainRole(i);if(char)GameMap.moveEntity(char,posX,posY)}TimerManager.ins().doTimer(1e3,0,_this.tempFunc,_this)}else{_this.initPos=true;UserFb.ins().pkGqboss=false;UserFb.ins().sendExitFb()}}if(fbType==UserFb.FB_TYPE_GUANQIABOSS){RewardWin.show(rewards,RewardWin.TYPE_DEFAULT)}};DropHelp.addCompleteFunc(f,this);DropHelp.start()}else{UserFb.ins().pkGqboss=false;if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS){PlayFun.ins().closeAuto()}ResultManager.ins().create(fbType,0)}if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS){Hint.ins().postKillBossEx(UserFb.ins().guanqiaID)}if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS){var view=ViewManager.ins().getView(UIView2);if(view&&view.autoPkBoss.selected){PlayFun.ins().closeAuto();this.showStory("end",function(){PlayFun.ins().openAuto()})}else{this.showStory("end",function(){})}}};UserFb.prototype.tempFunc=function(){var char=EntityManager.ins().getNoDieRole();if(!char){TimerManager.ins().remove(this.tempFunc,this);return}var x_Grid=Math.floor(char.x/GameMap.CELL_SIZE);var y_Grid=Math.floor(char.y/GameMap.CELL_SIZE);var out_X_Grid=this.outPos.x;var out_Y_Grid=this.outPos.y;if(x_Grid==out_X_Grid&&y_Grid==out_Y_Grid){TimerManager.ins().remove(this.tempFunc,this);GameLogic.ins().removeOutEff();this.initPos=false;UserFb.ins().pkGqboss=false;UserFb.ins().sendExitFb();Hint.ins().postSeceneIn()}};UserFb.prototype.sendGetBossReward=function(){this.sendBaseProto(3)};UserFb.prototype.sendExitFb=function(){this.sendBaseProto(4)};UserFb.prototype.sendGetAward=function(){this.sendBaseProto(5)};UserFb.prototype.doGuanqiaReward=function(bytes){this.guanqiaReward=bytes.readShort()+1;this.postZhangJieAwardChange();this.postGuanKaIdChange();this.postGuanqiaWroldReward()};UserFb.prototype.postZhangJieAwardChange=function(){};UserFb.prototype.sendGuanqiaWroldReward=function(pass){var bytes=this.getBytes(6);bytes.writeInt(pass);this.sendToServer(bytes)};UserFb.prototype.doGuanqiaWroldReward=function(bytes){var len=bytes.readInt();var isReceive=0;var pass=0;this.worldGuanQias=[];this.worldGuanQiaHasReceive=[];for(var i=0;i<len;i++){isReceive=bytes.readInt();pass=i+1;if(isReceive==0){this.worldGuanQias.push(pass)}else if(isReceive==1){this.worldGuanQiaHasReceive.push(pass)}if(isReceive==0||isReceive==1){this.worldReward=pass}}this.postGuanqiaWroldReward()};UserFb.prototype.postGuanqiaWroldReward=function(){};UserFb.prototype.doOfflineReward=function(bytes){var arr=[];arr[0]=bytes.readInt();arr[1]=bytes.readInt();arr[2]=bytes.readInt();arr[3]=bytes.readInt();arr[4]=bytes.readInt();arr[5]=bytes.readInt();var len=bytes.readInt();var aryObj=[];for(var i=0;i<len;i++){var obj=new Object;obj["type"]=bytes.readInt();obj["exp"]=bytes.readInt();obj["ssExp"]=bytes.readInt();obj["gold"]=bytes.readInt();aryObj.push(obj)}arr[6]=aryObj;len=bytes.readByte();var coin=[];for(var i=0;i<len;i++){var tmp={};tmp.id=bytes.readByte();tmp.count=bytes.readInt();coin.push(tmp)}if(NewStoryMgr.ins().curStoryId==undefined){ViewManager.ins().open(OfflineRewardWin,arr,coin)}};UserFb.prototype.getWorldGuanQia=function(){if(this.worldGuanQias.length>0)return this.worldGuanQias[this.worldGuanQias.length-1];else return 0};UserFb.prototype.getWorldGuanQiaBox=function(){var len=this.worldGuanQias.length;if(len>0){var index=void 0;for(var i=0;i<len;i++){index=this.worldGuanQias[i];if(UserFb.ins().isReceiveBox(index))return index}}return this.worldReward+1};UserFb.prototype.sendKillMonster=function(id){var bytes=this.getBytes(13);bytes.writeInt(id);this.sendToServer(bytes)};UserFb.prototype.sendChallengeExpFb=function(){this.sendBaseProto(14)};UserFb.prototype.sendSaodang=function(){var bytes=this.getBytes(15);this.sendToServer(bytes)};UserFb.prototype.sendGetAwardMul=function(type,mul){var bytes=this.getBytes(16);bytes.writeByte(type);bytes.writeByte(mul);this.sendToServer(bytes)};UserFb.prototype.sendChallengeFbRing=function(){this.sendBaseProto(22)};UserFb.prototype.sendFbRingTakeAward=function(mul){var bytes=this.getBytes(23);bytes.writeShort(mul);this.sendToServer(bytes)};UserFb.prototype.checkGuanqiaIconShow=function(){return OpenSystem.ins().checkSysOpen(SystemType.CHALLENGE)};UserFb.prototype.postExpFly=function(globalPoint,count,delay){if(count===void 0){count=1}if(delay===void 0){delay=10}return[globalPoint,count,delay]};UserFb.prototype.getExpFbId=function(){var config=GlobalConfig.ExpFubenConfig;var lv=Actor.level;var _id=0;for(var id in config){if(config[id].slv>lv){break}_id=+id}return _id};UserFb.prototype.checkInFB=function(hideTip){if(KfArenaSys.ins().isKFMacthing()){if(!hideTip)UserTips.ins().showCenterTips(i18n("UserFb_17"));return true}if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS||UserFb.ins().pkGqboss){if(!hideTip)UserTips.ins().showCenterTips(i18n("UserFb_18"));return true}if(GameMap.fubenID!=0&&!CityCC.ins().isCity){if(!hideTip)UserTips.ins().showCenterTips(i18n("UserFb_19"));return true}return false};UserFb.prototype.checkInOtherFB=function(needTips){if(needTips===void 0){needTips=true}if(KfArenaSys.ins().isKFMacthing()){if(needTips){UserTips.ins().showCenterTips(i18n("UserFb_30"))}return true}if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS||UserFb.ins().pkGqboss){return false}if(GameMap.fubenID!=0&&!CityCC.ins().isCity){if(needTips){UserTips.ins().showCenterTips(i18n("UserFb_30"))}return true}return false};UserFb.prototype.createMonster=function(id){var config=this.guanqiaMonster[id];var model=UserFb.createModel(config);model.name=config.name;model._avatar=+config.avatar;model._scale=config.scale;model.wanderrange=config["wanderrange"];model.wandertime=config["wandertime"];model.effect=config.effect;model._dirNum=config.dirNum;return model};UserFb.createModel=function(config){var model=new EntityModel;model.type=EntityType.Monster;model.configID=config.id;model.setAtt(AttributeType.atHp,config.hp);model.setAtt(AttributeType.atMaxHp,config.hp);model.setAtt(AttributeType.atAttack,config.atk);model.setAtt(AttributeType.atDef,config.def);model.setAtt(AttributeType.atRes,config.res);model.setAtt(AttributeType.atCrit,config["crit"]);model.setAtt(AttributeType.atTough,config["tough"]);model.setAtt(AttributeType.atMoveSpeed,config["ms"]||1e3);model.setAtt(AttributeType.atAttackSpeed,config["as"]||1e3);model.setAtt(AttributeType.atPenetrate,config["penetRate"]||0);return model};UserFb.getPersonalBossFbIds=function(){var result=[];for(var i in GlobalConfig.DailyFubenConfig){var c=GlobalConfig.DailyFubenConfig[i];if(c&&c.bossId){if((c.monthcard==1||c.specialCard==1)&&UserZs.ins().lv!=c.zsLevel){continue}else{result.push(c)}}}return result};UserFb.isCanChallenge=function(){var datas=this.getPersonalBossFbIds();var len=datas.length;var data;var sCount;for(var i=0;i<len;i++){data=datas[i];if(!UserFb.ins().getFbDataById(data.id))continue;sCount=UserFb.ins().getFbDataById(data.id).getCount();if(sCount>0){if(data.monthcard){if(Recharge.ins().monthDay>0){return true}}else if(data.privilege){if(Recharge.ins().getIsForeve()){return true}}else if(data.specialCard){if(Recharge.ins().franchise){return true}}else{if(data.zsLevel>0){if(UserZs.ins().lv>=data.zsLevel)return true}else{if(Actor.level>=data.levelLimit)return true}}}}return false};UserFb.prototype.setAutoPk=function(){if(this.showAutoPk==-1){this.showAutoPk=0;this.postAutoPk()}};UserFb.prototype.postAutoPk=function(){};UserFb.prototype.setAutoPk2=function(){if(this.showAutoPk2==-1){this.showAutoPk2=0;this.postAutoPk2()}};UserFb.prototype.postAutoPk2=function(){};UserFb.prototype.sendCreateTFRoom=function(fid){var bytes=this.getBytes(30);bytes.writeShort(fid);this.sendToServer(bytes)};UserFb.prototype.postCreateTFRoomSuccess=function(bytes){this.tfRoomID=bytes.readInt();var cfgID=bytes.readInt();if(this.tfRoomID)ViewManager.ins().open(TeamFbRoomWin,1,cfgID,this.tfRoomID,true);else ViewManager.ins().close(TeamFbRoomWin)};UserFb.prototype.sendEnterTFRoom=function(id){if(this.isAutoPkBoss()){UserTips.ins().showCenterTips(i18n("TeamFbItemRender_11"));return}var bytes=this.getBytes(31);bytes.writeInt(id);this.sendToServer(bytes)};UserFb.prototype.postEnterTFRoomSuccess=function(bytes){var str="";switch(bytes.readByte()){case 0:var cfgID=bytes.readInt();this.tfRoomID=bytes.readInt();ViewManager.ins().open(TeamFbRoomWin,1,cfgID,this.tfRoomID,false);break;case 1:UserTips.ins().showTips(i18n("UserFb_20",DateUtils.WEEK_CN[GlobalConfig.TeamFuBenBaseConfig.closeTime[0]],GlobalConfig.TeamFuBenBaseConfig.closeTime[1]));break;case 2:str=i18n("UserFb_21");break;case 3:console.log(i18n("UserFb_22"));break;case 4:str=i18n("UserFb_23");break;case 5:str=i18n("UserFb_24");break;case 6:str=i18n("UserFb_25");break;case 7:str=i18n("UserFb_26");break}if(str&&str!=""){UserTips.ins().showTips(i18n("UserFb_29")+str+"|")}};UserFb.prototype.sendExitTFRoom=function(){this.sendBaseProto(32)};UserFb.prototype.exitTFRoom=function(bytes){switch(bytes.readByte()){case 1:break;case 2:UserTips.ins().showTips(i18n("UserFb_27"));break;case 3:UserTips.ins().showTips(i18n("UserFb_28"));break}ViewManager.ins().close(TeamFbRoomWin);this.tfRoomID=0};UserFb.prototype.sendBeginTF=function(){this.sendBaseProto(33)};UserFb.prototype.postFTRoomChange=function(bytes){this.tfRoomID=bytes.readInt();var len=bytes.readByte();if(!this.tfMembers)this.tfMembers=[];this.tfMembers.length=len;this.isTFCaptain=false;var vo;for(var i=0;i<len;i++){vo=this.tfMembers[i];if(!vo){vo=new TeamFuBenRoleVo;this.tfMembers[i]=vo}vo.parse(bytes);if(vo.roleID==Actor.actorID&&vo.position==1)this.isTFCaptain=true}};UserFb.prototype.sendOutTFRoom=function(id){var bytes=this.getBytes(34);bytes.writeInt(id);this.sendToServer(bytes)};UserFb.prototype.sendExitTFFb=function(type,fid){var bytes=this.getBytes(35);bytes.writeByte(type);bytes.writeShort(fid);this.sendToServer(bytes)};UserFb.prototype.postFTRoomPassInfo=function(bytes){this.tfOpenID=bytes.readShort();this.tfPassID=bytes.readShort();this._tfInviteTime=bytes.readInt();this.awardCount=bytes.readShort();this.helpCount=bytes.readShort();this.postShowRedChange()};UserFb.prototype.getTfInviteCD=function(){return Math.floor((this._tfInviteTime*1e3+DateUtils.SECOND_2010*1e3-GameServer.serverTime)/1e3)};UserFb.prototype.isTeamFBOpen=function(){return Actor.level>=GlobalConfig.TeamFuBenBaseConfig.needLv&&GameServer.serverOpenDay+1>=GlobalConfig.TeamFuBenBaseConfig.openDay};UserFb.prototype.doTeamFuBenEnd=function(bytes){var id=bytes.readInt();var result=bytes.readByte();var len=bytes.readByte();var list=[];list.length=len;var vo;for(var i=0;i<len;i++){vo=new TeamFuBenRoleVo;list[i]=vo;vo.roleID=bytes.readInt();vo.position=bytes.readByte();vo.roleName=bytes.readString();vo.job=bytes.readByte();vo.sex=bytes.readByte()}ViewManager.ins().open(TeamFbResultWin,id,result,list)};UserFb.prototype.doTeamFuBenRelive=function(bytes){UserBoss.ins().killerHandler=bytes.readDouble();UserBoss.ins().reliveTime=bytes.readInt();if(UserBoss.ins().reliveTime>0){UserBoss.ins().clearWorldBossList();ViewManager.ins().open(WorldBossBeKillWin)}else ViewManager.ins().close(WorldBossBeKillWin)};UserFb.prototype.sendTFRank=function(){this.sendBaseProto(36)};UserFb.prototype.postTeamFuBenRank=function(bytes){this.tfPassRanks=[];var len=bytes.readByte();var vo;var subLen;for(var i=0;i<len;i++){vo={configID:bytes.readInt(),members:[]};subLen=bytes.readByte();for(var j=0;j<subLen;j++)vo.members.push({position:bytes.readByte(),roleName:bytes.readString()});this.tfPassRanks.push(vo)}};UserFb.prototype.sendTfFlower=function(id,count){var bytes=this.getBytes(37);bytes.writeInt(id);bytes.writeInt(count);this.sendToServer(bytes)};UserFb.prototype.postTeamFbFlowarRecords=function(bytes){var len=bytes.readInt();if(!this.tfFlowerRecords)this.tfFlowerRecords=[];for(var i=0;i<len;i++)this.tfFlowerRecords.push({roleName:bytes.readString(),count:bytes.readInt()});while(this.tfFlowerRecords.length>10)this.tfFlowerRecords.shift()};UserFb.prototype.clearTfFlowerRecords=function(){this.tfFlowerRecords=[]};UserFb.prototype.sendTfSysInvite=function(des){var bytes=this.getBytes(38);bytes.writeString(des);this.sendToServer(bytes)};UserFb.prototype.teamFbSysInviteInfo=function(bytes){Chat.ins().postSysChatMsg(new ChatSystemData(3,bytes.readString()))};UserFb.prototype.checkTFRed=function(){if(!this.isTeamFBOpen())return false;return this.showTfRed};UserFb.prototype.postShowRedChange=function(){this.showTfRed=this.awardCount>0};UserFb.prototype.sendGuardWeaponLogs=function(){this.sendBaseProto(40)};UserFb.prototype.postGuardWeaponLogs=function(bytes){var len=bytes.readByte();var arr=[];for(var i=0;i<len;i++){var noticeId=bytes.readInt();var roleName=bytes.readString();var monsterName=bytes.readString();var itemName=bytes.readString();arr.push({noticeId:noticeId,roleName:roleName,monsterName:monsterName,itemName:itemName})}return arr};UserFb.prototype.getTeamfbAwardCountMax=function(){var maxAwardCount=GlobalConfig.TeamFuBenBaseConfig.maxAwardCount;var maxHelpCount=GlobalConfig.TeamFuBenBaseConfig.maxHelpCount;var vipLv=UserVip.ins().lv;if(vipLv>0){var cfg=GlobalConfig.VipConfig[vipLv];if(cfg&&cfg.teamCount){maxAwardCount+=cfg.teamCount}}var hasPrivi=Recharge.ins().franchise>0;if(hasPrivi){maxAwardCount+=GlobalConfig.PrivilegeData.addTeamfbCount}return maxAwardCount};UserFb.prototype.isAutoPkBoss=function(){var view=ViewManager.ins().getView(UIView2);if(view&&view.autoPkBoss){return view.autoPkBoss.selected}else{return false}};UserFb.prototype.isInTeamScene=function(){if(GameMap.fbType==UserFb.FB_TEAM||GameMap.fbType==UserFb.FB_TYPE_KF_ARENA||GameMap.fbType==UserFb.FB_TYPE_XIANMO){return true}return false};UserFb.prototype.getFbChName=function(id){if(id===void 0){id=1}var name="";var b=Math.floor(id/100);if(b>0){name+=i18n("UserFb_3"+b)+i18n("UserFb_41")}var s=Math.floor(id%100/10);var g=id%10;if(s>0){name+=i18n("UserFb_3"+s)+i18n("UserFb_40");if(g>0){name+=i18n("UserFb_3"+g)}}else{if(g>0){if(name.length>0){name+=i18n("UserFb_42")}name+=i18n("UserFb_3"+g)}}name=i18n("UserFb_43",name);return name};UserFb.FB_TYPE_GUANQIABOSS=1;UserFb.FB_TYPE_ZHENGBA=11;UserFb.FB_TYPE_CITY=20;UserFb.FB_TYPE_TIAOZHAN=9;UserFb.FB_TYPE_ZHUANSHENGBOSS=10;UserFb.FB_TYPE_ALLHUMENBOSS=7;UserFb.FB_TYPE_PERSONAL=6;UserFb.FB_TYPE_HOMEBOSS=17;UserFb.FB_TYPE_MATERIAL=2;UserFb.FB_TYPE_EXP=16;UserFb.FB_TYPE_GUILD_BOSS=15;UserFb.FB_TYPE_GUILD_WAR=14;UserFb.FB_TYPE_MIJING=21;UserFb.FB_ID_JINGYAN=3005;UserFb.FB_ID_MINE=99999;UserFb.FB_TYPE_GUIDEBOSS=18;UserFb.FB_TYPE_NEW_WORLD_BOSS=19;UserFb.FB_TYPE_XIANMO=22;UserFb.FB_TYPE_LIEYAN=23;UserFb.FB_TYPE_YUNDIAN=25;UserFb.FB_TYPE_GOD_WEAPON=26;UserFb.FB_TYPE_GOD_WEAPON_TOP=27;UserFb.FB_TYPE_PEAKED=30;UserFb.FB_TYPE_DARK_BOSS=36;UserFb.FB_TYPE_HIDE_BOSS=37;UserFb.FB_TYPE_HUN_SHOU=38;UserFb.FB_TEAM=35;UserFb.FB_TYPE_FIRE_RING=24;UserFb.FB_TYPE_PEAK=30;UserFb.FB_TYPE_GUARD_WEAPON=29;UserFb.FB_TYPE_LABA=31;UserFb.FB_TYPE_KF_BOSS=32;UserFb.FB_TYPE_DEVILDOM_BOSS=39;UserFb.FB_TYPE_KF_ARENA=40;UserFb.FB_TYPE_HARD_FB=42;UserFb.AUTO_GUANQIA=11;UserFb.TEAM_FB_WIN_REFLASH_PANEL="TEAM_FB_WIN_REFLASH_PANEL";UserFb.TF_SIMLPE_HEIGHT=149;UserFb.TF_EXPAND_HEIGHT=298;return UserFb}(BaseSystem);__reflect(UserFb.prototype,"UserFb");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userfb=UserFb.ins.bind(UserFb)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var EquipPos;(function(EquipPos){EquipPos[EquipPos["WEAPON"]=0]="WEAPON";EquipPos[EquipPos["HEAD"]=1]="HEAD";EquipPos[EquipPos["CLOTHES"]=2]="CLOTHES";EquipPos[EquipPos["NECKLACE"]=3]="NECKLACE";EquipPos[EquipPos["Wrist"]=4]="Wrist";EquipPos[EquipPos["BRACELET"]=5]="BRACELET";EquipPos[EquipPos["RING"]=6]="RING";EquipPos[EquipPos["SHOE"]=7]="SHOE";EquipPos[EquipPos["DZI"]=8]="DZI";EquipPos[EquipPos["HAT"]=9]="HAT";EquipPos[EquipPos["VIZARD"]=10]="VIZARD";EquipPos[EquipPos["CLOAK"]=11]="CLOAK";EquipPos[EquipPos["SHIELD"]=12]="SHIELD";EquipPos[EquipPos["MAX"]=13]="MAX"})(EquipPos||(EquipPos={}));window["EquipPos"]=EquipPos;var FuliActBtnRenderer=function(_super){__extends(FuliActBtnRenderer,_super);function FuliActBtnRenderer(){var _this=_super.call(this)||this;_this.skinName="ActBtnSkin";DisplayUtils.removeFromParent(_this.mc);_this.mc=null;return _this}FuliActBtnRenderer.prototype.dataChanged=function(){var config=this.data;this.iconDisplay.source=config.icon;var isShowEff=false;isShowEff=FuliActBtnRenderer.canGet(config.type);this.setRedPoint(isShowEff);switch(config.type){case 1:break;case 2:break;case 3:break;case 4:break;case 5:if(this.selected){Notice.ins().setNotice(2,"",false)}break;case 6:break;case 7:break;case 8:break;case 9:break;case 10:break;case 11:break;case 12:break;case 13:break;case 14:break}};FuliActBtnRenderer.prototype.setRedPoint=function(isShowEff){if(isShowEff){if(!this.mc){this.mc=new MovieClip;this.mc.x=45;this.mc.y=49}this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1);this.eff.addChild(this.mc)}else{DisplayUtils.removeFromParent(this.mc);this.mc=null}this.redPoint.visible=isShowEff};FuliActBtnRenderer.canGet=function(type){switch(type){case 1:return DailyCheckIn.ins().showRedPoint();case 2:return Activity.ins().getSevenDayStast();case 3:return false;case 4:return Recharge.ins().franchise&&Recharge.ins().franchiseget?true:false;case 5:return Notice.ins().hasNewNotice;case 6:return false;case 7:return LevelupRewardsSys.ins().isEnableGetRewards();case 8:return UserFuLiHongbao.ins().isShowRedPoint();case 9:return TimeCardMgr.ins().hasCanGetReward();case 10:return UserVip.ins().hasVipDailyReward();case 11:return TrainGift.ins().hasRedPoint;case 13:return BaoZang.ins().chapterCanGet();case 14:return BaoZang.ins().fuwentaCanGet();default:return false}};return FuliActBtnRenderer}(BaseItemRender);__reflect(FuliActBtnRenderer.prototype,"FuliActBtnRenderer");var ViewManager=function(_super){__extends(ViewManager,_super);function ViewManager(){var _this=_super.call(this)||this;_this.filters=["TipsView","UIView1_1","GameSceneView","ChatMainUI","PlayFunView"];_this.closeTopFilters=[];_this.viewListener={};_this.allViewListener=[];_this.viewHistory=[];_this._regesterInfo={};_this._views={};_this._hCode2Key={};_this._opens=[];_this._constView=["GameSceneView","ChatMainUI","UIView2","TipsView","PlayFunView"];return _this}ViewManager.ins=function(){return _super.ins.call(this)};ViewManager.prototype.clear=function(){this.closeAll();this._views={}};ViewManager.prototype.reg=function(viewClass,layer){if(viewClass==null){return}var keys=egret.getQualifiedClassName(viewClass);if(this._regesterInfo[keys]){return}this._regesterInfo[keys]=[viewClass,layer]};ViewManager.prototype.destroy=function(hCode){var keys=this._hCode2Key[hCode];delete this._views[keys];delete this._hCode2Key[hCode]};ViewManager.prototype.getKey=function(nameOrClass){var key="";if(typeof nameOrClass=="string")key=nameOrClass;else if(typeof nameOrClass=="function")key=egret.getQualifiedClassName(nameOrClass);else if(nameOrClass instanceof BaseEuiView){var keys=Object.keys(this._views);for(var i=0,len=keys.length;i<len;i++){var tempKey=keys[i];if(this._views[tempKey]==nameOrClass){key=tempKey;break}}}else debug.log(i18n("ViewManager_0")+nameOrClass);return key};ViewManager.prototype.viewOpenCheck=function(key){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}var result=true;var info=this._regesterInfo[key];if(info!=null){var c=info[0];var f=c["openCheck"];if(f!=null){result=f.apply(void 0,param)}}return result};ViewManager.prototype.open=function(nameOrClass){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}var key=this.getKey(nameOrClass);if(!this.viewOpenCheck.apply(this,[key].concat(param))){return null}var view=this.openEasy(key,param);if(this.filters.indexOf(key)==-1){debug.log(i18n("ViewManager_1")+key)}if(view){this.checkOpenView(view);this.setUIEff(key)}else{}this.addViewHistory(key,param);return view};ViewManager.prototype.setUIEff=function(className){if(className){var view=this.getView(className);if(view){view.playUIEff()}}};ViewManager.prototype.openEasy=function(nameOrClass,param){if(param===void 0){param=null}var keys=this.getKey(nameOrClass);var view=this._views[keys];var info=this._regesterInfo[keys];if(!view){if(!false&&Assert(info,"ViewManager.openEasy class "+keys+" is null!!")){return}view=new info[0];this._views[keys]=view;this._hCode2Key[view.hashCode]=keys}if(view==null){Log.trace("UI_"+keys+i18n("ViewManager_4"));return null}if(view.exclusionWins){for(var _i=0,_a=view.exclusionWins;_i<_a.length;_i++){var exclusionWin=_a[_i];if(exclusionWin){this.closeEasy(exclusionWin)}}}if(view.isShow()||view.isInit()){view.addToParent(info[1]);view.open.apply(view,param)}else{EasyLoading.ins().showLoading();view.loadResource(function(){view.addToParent(info[1]);view.setVisible(false)}.bind(this),function(){view.initUI();view.initData();view.open.apply(view,param);view.setVisible(true);EasyLoading.ins().hideLoading()}.bind(this))}var index=this._opens.indexOf(keys);if(index>=0){this._opens.splice(index,1)}this._opens.push(keys);return view};ViewManager.prototype.checkOpenView=function(view){if(view.isTopLevel&&view.parent!=LayerManager.UI_Popup){SoundUtil.ins().playEffect(SoundUtil.WINDOW);GameLogic.ins().postViewOpen(1,view.needBg);this.closeEasy(ChatMainUI);this.closeEasy(ChatWin)}if(view.isPlayOpenSound&&view.parent==LayerManager.UI_Popup){SoundUtil.ins().playEffect(SoundUtil.WINDOW)}};ViewManager.prototype.close=function(nameOrClass){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}var key=this.getKey(nameOrClass);this.closeEx(key,param);this.removeViewHistory(nameOrClass)};ViewManager.prototype.closeEx=function(className){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}if(className){var view=this.getView(className);if(view){var self_2=this;view.closeEx(function(){var view=self_2.closeEasy(className,param);if(view){self_2.checkCloseView()}else{}})}}};ViewManager.prototype.closeLastTopView=function(){var len=this._opens.length;for(var k=len-1;k>=0;k--){var win=this.getView(this._opens[k]);if(win&&win.isTopLevel){var view=ViewManager.ins().getView(RoleWin);if(win instanceof RoleWin&&view.getWingPanelInfo()){view.doOpenHintWin(2)}else{this.close(win)}break}}};ViewManager.prototype.closeEasy=function(nameOrClass){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}if(!this.isShow(nameOrClass)){return null}var key=this.getKey(nameOrClass);var view=this.getView(key);if(view){var viewIndex=this._opens.indexOf(key);if(viewIndex>=0){this._opens.splice(viewIndex,1)}view.close.apply(view,param);view.$onClose.apply(view);view.removeFromParent()}return view};ViewManager.prototype.checkCloseView=function(){var hasTopLevelWin=false;for(var _i=0,_a=this._opens;_i<_a.length;_i++){var key=_a[_i];var win=this.getView(key);if(win&&win.isTopLevel){hasTopLevelWin=true;break}}if(!hasTopLevelWin){SoundUtil.WINDOW_OPEN=false;GameLogic.ins().postViewOpen(0,false);if(SceneManager.ins().getSceneName()==SceneManager.MAIN){if(!this.isShow(GameSceneView))this.openEasy(GameSceneView);if(!this.isShow(ChatMainUI))this.openEasy(ChatMainUI)}}};Object.defineProperty(ViewManager,"gamescene",{get:function(){return ViewManager.ins().getView(GameSceneView)},enumerable:true,configurable:true});ViewManager.prototype.getView=function(nameOrClass){var keys=this.getKey(nameOrClass);return this._views[keys]};ViewManager.prototype.closeAll=function(){while(this._opens.length){this.closeEasy(this._opens[0],[])}this.destroyAllNotShowView();this.checkCloseView()};ViewManager.prototype.closeTopLevel=function(){var filter=this.closeTopFilters;this.closeTopFilters=[];for(var i=this._opens.length-1;i>=0;i--){var keys=this._opens[i];if(filter.indexOf(keys)>=0){continue}var view=this.getView(keys);var key=1e6;if(!isNaN(parseInt(keys))){key=parseInt(keys)}if(!view)continue;if(view.isTopLevel)this.closeEasy(keys,[])}this.checkCloseView()};ViewManager.prototype.openNum=function(){return this._opens.length};ViewManager.prototype.isShow=function(nameOrClass){return this._opens.indexOf(this.getKey(nameOrClass))>=0};ViewManager.prototype.hasTopView=function(){for(var _i=0,_a=this._opens;_i<_a.length;_i++){var key=_a[_i];var win=this.getView(key);if(win&&win.isTopLevel){return true}}return false};ViewManager.prototype.destroyAllNotShowView=function(){for(var code in this._hCode2Key){var keys=this._hCode2Key[code];if(this._constView.indexOf(keys)==-1&&this._opens.indexOf(keys)==-1){var win=this.getView(keys);if(win&&win.destoryView){win.destoryView(false)}}}};ViewManager.prototype.addViewListener=function(view,cb,obj){var key=this.getKey(view);if(!(key in this.viewListener))this.viewListener[key]=[];this.viewListener[key].push({cb:cb,obj:obj})};ViewManager.prototype.addAllViewListener=function(cb,obj){this.allViewListener.push({cb:cb,obj:obj})};ViewManager.prototype.removeViewListener=function(view,cb,obj){var key=this.getKey(view);if(this.viewListener[key]){for(var i=0;i<this.viewListener[key].length;){var t=this.viewListener[key][i];if(t.cb==cb&&t.obj==obj){this.viewListener[key].splice(i,1)}else{i++}}}};ViewManager.prototype.removeAllViewListener=function(cb,obj){for(var i=0;i<this.allViewListener.length;){var t=this.allViewListener[i];if(t.cb==cb&&t.obj==obj){this.allViewListener.splice(i,1)}else{i++}}};ViewManager.prototype.dispatchViewEvent=function(view){var key=this.getKey(view);if(this.viewListener[key]){for(var i in this.viewListener[key]){var t=this.viewListener[key][i];t.cb.apply(t.obj)}}for(var j in this.allViewListener[key]){var t=this.allViewListener[j];t.cb.apply(t.obj,key)}};ViewManager.prototype.addViewHistory=function(view,params){var key=this.getKey(view);if(!this._regesterInfo[key])return;if(this._regesterInfo[key][1]!=LayerManager.UI_Main&&this._regesterInfo[key][1]!=LayerManager.UI_Popup)return;this.viewHistory.push({view:key,params:params});this.dispatchViewEvent(key)};ViewManager.prototype.removeViewHistory=function(view){var key=this.getKey(view);if(!this._regesterInfo[key])return;if(this._regesterInfo[key][1]!=LayerManager.UI_Main&&this._regesterInfo[key][1]!=LayerManager.UI_Popup)return;for(var i=this.viewHistory.length-1;i>=0;i--){if(this.viewHistory[i].view!=key)continue;this.viewHistory.splice(i,1)}var curHistory=this.getCurrentHistory();if(curHistory){this.dispatchViewEvent(curHistory.view)}};ViewManager.prototype.getCurrentHistory=function(){return this.viewHistory.length>0?this.viewHistory[this.viewHistory.length-1]:null};return ViewManager}(BaseClass);__reflect(ViewManager.prototype,"ViewManager");var GwFubenView=function(_super){__extends(GwFubenView,_super);function GwFubenView(){return _super.call(this)||this}GwFubenView.prototype.childrenCreated=function(){this._ary=new eui.ArrayCollection;this.checkRank.touchEnabled=true;this.checkRank.textFlow=(new egret.HtmlTextParser).parser(i18n("GwFubenView_0"))};GwFubenView.prototype.open=function(){this.addTouchEvent(this.checkRank,this.touchHandler);this.addTouchEvent(this.challenge,this.touchHandler);this.observe(GodWeaponCC.ins().postFubenInfo,this.updateView);this.observe(GodWeaponCC.ins().postRankInfo,this.updateRank);this.observe(UserBag.ins().postItemCountChange,this.useToItem);this.list.dataProvider=this._ary;this.list.itemRenderer=GwFubenGridRender;this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);GodWeaponCC.ins().requestFubenInfo()};GwFubenView.prototype.updateView=function(){GodWeaponCC.ins().requestRanInfo();this._ary.replaceAll(GodWeaponCC.ins().fubenInfoData.listData);var freeNum=GlobalConfig.GodWeaponBaseConfig.freeCount;var leftNum=GodWeaponCC.ins().fubenInfoData.hadChallengeNum;this.countText.text=i18n("GwFubenView_3",leftNum);this.list.selectedIndex=0;this._selectData=this.list.selectedItem;if(GodWeaponCC.ins().fubenInfoData.hadChallengeNum>0){this.rpImg.visible=true}else{this.rpImg.visible=false}this.updateRaidUi()};GwFubenView.prototype.updateRaidUi=function(){var canRaid=this._selectData.curPoint==1;this.challenge.label=canRaid?i18n("GwFubenView_16"):i18n("GwFubenView_17");this.raidHint.visible=!canRaid};GwFubenView.prototype.updateRank=function(){var ary=GodWeaponCC.ins().rankInfoDataAry;var len=ary.length;if(len==0){this.rank.visible=false}else{this.rank.visible=true}var data;for(var i=0;i<3;i++){data=ary[i];if(data){this.getRankImg(i+1).visible=true;this.getPlayName(i+1).visible=true;this.getPlayRank(i+1).visible=true;this.getPlayTime(i+1).visible=true;this.getPlayName(i+1).text=data.nameStr;this.getPlayRank(i+1).text=i18n("GwFubenView_4",data.floorNum);this.getPlayTime(i+1).text=data.getgetTimeStr()}else{this.getPlayName(i+1).visible=false;this.getPlayRank(i+1).visible=false;this.getPlayTime(i+1).visible=false;this.getRankImg(i+1).visible=false}}};GwFubenView.prototype.useToItem=function(){if(this._isUser){this._isUser=false;if(this._selectData){GodWeaponCC.ins().joinFuben(this._selectData.gridNum)}}};GwFubenView.prototype.getRankImg=function(index){return this["rank"+index+"Img"]};GwFubenView.prototype.getPlayName=function(index){return this["player"+index+"Name"]};GwFubenView.prototype.getPlayRank=function(index){return this["player"+index+"Rank"]};GwFubenView.prototype.getPlayTime=function(index){return this["player"+index+"Time"]};GwFubenView.prototype.close=function(){this._selectData=null;this.removeTouchEvent(this.checkRank,this.touchHandler);this.removeTouchEvent(this.challenge,this.touchHandler);this.removeObserve();this.list.dataProvider=null};GwFubenView.prototype.touchHandler=function(e){if(e.target==this.challenge){if(!this.showTips())return;if(this._selectData){GodWeaponCC.ins().joinFuben(this._selectData.gridNum)}}else if(e.target==this.checkRank){ViewManager.ins().open(GwMijingRankView)}};GwFubenView.prototype.onTouchList=function(e){this._selectData=this.list.selectedItem;this.updateRaidUi()};GwFubenView.prototype.showTips=function(){var count=GodWeaponCC.ins().fubenInfoData.hadChallengeNum;if(count>0){return true}var tipText="";var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.GodWeaponBaseConfig.fubenItem);if(item){tipText=i18n("GwFubenView_5",item.itemConfig.name);WarnWin.show(tipText,function(){this._isUser=true;UserBag.ins().sendUseItem(item.configID,1)},this)}else{UserTips.ins().showTips(i18n("GwFubenView_6"))}return false};return GwFubenView}(BaseView);__reflect(GwFubenView.prototype,"GwFubenView");var GwFubenGridRender=function(_super){__extends(GwFubenGridRender,_super);function GwFubenGridRender(){return _super.call(this)||this}GwFubenGridRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this._ary=new eui.ArrayCollection;this.list.dataProvider=this._ary;this.list.itemRenderer=MijingItemBase};GwFubenGridRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);if(!this.data){return}this._thisData=this.data;this.storeyCount.text=i18n("GwFubenView_12",this._thisData.gridNum);var ary=this._thisData.config.award[1].concat();ary=ary.concat(this._thisData.config.firstAward.concat());var newAry=[];for(var i=0;i<ary.length;i++){var data=new MijinglistData;data.data=ary[i];data.index=i+1;data.start=this._thisData.config.award[1].length;data.floorNum=this._thisData.gridNum;newAry.push(data)}this._ary.replaceAll(newAry);if(this._thisData.curPoint!=0){this.rankImg.visible=true;this.rankbg.visible=true;this.rankImg.source="godweapon_rank"+this._thisData.curPoint}else{this.rankImg.visible=false;this.rankbg.visible=false}this.choose.visible=this.selected;this.rank.visible=!this.selected};GwFubenGridRender.prototype.invalidateState=function(){_super.prototype.invalidateState.call(this);this.choose.visible=this.selected;this.rank.visible=!this.selected};return GwFubenGridRender}(BaseItemRender);__reflect(GwFubenGridRender.prototype,"GwFubenGridRender");var MijingItemBase=function(_super){__extends(MijingItemBase,_super);function MijingItemBase(){var _this=_super.call(this)||this;_this.init();return _this}MijingItemBase.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};MijingItemBase.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);if(!this.data){return}this._thisdata=this.data;this.itemIcon.imgJob.visible=false;if(this._thisdata.data.type==0){this.itemIcon.imgIcon.source=RewardData.getCurrencyRes(this._thisdata.data.id);var type=1;switch(this._thisdata.data.id){case MoneyConst.yuanbao:type=5;break;case MoneyConst.gold:type=0;break;case MoneyConst.soul:type=2;break;case MoneyConst.piece:type=2;this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[this._thisdata.data.id];break;case MoneyConst.godweaponExp:type=2;break;default:break}var count=this._thisdata.data.count;count!=undefined&&count>1?this.setCount(count+""):this.setCount("");if(this._thisdata.index<=this._thisdata.start){this.nameTxt.text=RewardData.getCurrencyName(this._thisdata.data.id);this.itemIcon.imgBg.source="quality"+type;this.nameTxt.textColor=ItemBase.QUALITY_COLOR[type];this.nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[type]}else{this.nameTxt.text=i18n("GwFubenView_13");var data=GodWeaponCC.ins().fubenInfoData;this.getImg.visible=false;for(var i=0;i<data.listData.length;i++){if(this._thisdata.floorNum==data.listData[i].gridNum){if(data.listData[i].curPoint==1){this.getImg.visible=true}break}}if(this._thisdata.floorNum<=10){this.nameTxt.textColor=ItemBase.QUALITY_COLOR[3];this.nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[3];this.itemIcon.imgBg.source="quality"+3}else{this.nameTxt.textColor=ItemBase.QUALITY_COLOR[4];this.nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[4];this.itemIcon.imgBg.source="quality"+4}}}else{this.itemConfig=GlobalConfig.ItemConfig[this._thisdata.data.id];if(!this.itemConfig)return;var type=ItemConfig.getQuality(this.itemConfig);this.nameTxt.textColor=ItemBase.QUALITY_COLOR[type];this.nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[type];this.itemIcon.imgBg.source="quality"+type;var count=this._thisdata.data.count;count>1?this.setCount(count+""):this.setCount("");this.itemIcon.imgIcon.source=this.itemConfig.icon+"_png";if(this._thisdata.index<=this._thisdata.start){this.nameTxt.text=this.itemConfig.name}else{this.nameTxt.text=i18n("GwFubenView_14");var data=GodWeaponCC.ins().fubenInfoData;this.getImg.visible=false;for(var i=0;i<data.listData.length;i++){if(this._thisdata.floorNum==data.listData[i].gridNum){if(data.listData[i].curPoint==1){this.getImg.visible=true}break}}}}};MijingItemBase.prototype.setCount=function(str){if(str.length>4){var wNum=Math.floor(Number(str)/1e3);str=wNum/10+i18n("GwFubenView_15")}this.count.text=str};MijingItemBase.prototype.onClick=function(){this.showDetail()};MijingItemBase.prototype.showDetail=function(){if(this._thisdata.data.type!=0){ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this._thisdata.data.count)}};return MijingItemBase}(BaseItemRender);__reflect(MijingItemBase.prototype,"MijingItemBase");var MijinglistData=function(){function MijinglistData(){}return MijinglistData}();__reflect(MijinglistData.prototype,"MijinglistData");var MovieClip=function(_super){__extends(MovieClip,_super);function MovieClip(){var _this=_super.call(this)||this;_this.rate=1;_this.pixelHitTest=false;_this._mcFactory=new egret.MovieClipDataFactory;_this.$hitTest=function(stageX,stageY){var values=this.$DisplayObject;if(!values||!this.$renderNode||!this.$visible||values[0]==0||values[1]==0){return null}var m=this.$getInvertedConcatenatedMatrix();if(m.a==0&&m.b==0&&m.c==0&&m.d==0){return null}var bounds=this.$getContentBounds();var localX=m.a*stageX+m.c*stageY+m.tx;var localY=m.b*stageX+m.d*stageY+m.ty;if(bounds.contains(localX,localY)){if(!this.$children){var rect=this.$scrollRect?this.$scrollRect:this.$maskRect;if(rect&&!rect.contains(localX,localY)){return null}if(this.$mask&&!this.$mask.$hitTest(stageX,stageY)){return null}if(this.pixelHitTest&&this instanceof MovieClip&&!this.hitTestPoint(stageX,stageY,true)){return null}}return this}return null};return _this}MovieClip.prototype.checkResName=function(name){if(name==null||name==""){try{var a=null;a.a=0}catch(e){var request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;request.open(LoginMgr.preUrl+"login.php",egret.HttpMethod.POST);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var msg={stack:e.stack};var params="type=client_source_log&msg="+encodeURIComponent(JSON.stringify(msg,undefined,""));request.send(params);this["___curReq"]=request}}};MovieClip.prototype.playFileRes=function(name,resName,playCount,compFun,remove){var _this=this;if(playCount===void 0){playCount=1}if(compFun===void 0){compFun=null}if(remove===void 0){remove=true}this.checkResName(name);this.time=egret.getTimer();this._compFun=compFun;this.playCount=playCount;this.remove=remove;TimerManager.ins().remove(this.playComp,this);if(this.texture&&this.texture.bitmapData==null){}else if(this.name==name){this.createBody();return}this.name=name;if(this.texture){MovieClip.removeDisplayObject(this,this.texture.bitmapData)}this.jsonData=null;this.texture=null;RES.getResByUrl(this.name+".json",function(data,url){if(_this.name+".json"!=url||!data)return;_this.jsonData=data;_this.createBody()},this,RES.ResourceItem.TYPE_JSON);RES.getResAsync(resName,function(data){if(data==null){console.error(resName+" not found!")}else{this.texture=data;if(this.stage){MovieClip.addDisplayObject(this,this.texture.bitmapData)}this.createBody()}},this)};MovieClip.prototype.playFileRes2=function(name,resJson,resName,playCount,compFun,remove){var _this=this;if(playCount===void 0){playCount=1}if(compFun===void 0){compFun=null}if(remove===void 0){remove=true}this.checkResName(name);this.time=egret.getTimer();this._compFun=compFun;this.playCount=playCount;this.remove=remove;TimerManager.ins().remove(this.playComp,this);if(this.texture&&this.texture.bitmapData==null){}else if(this.name==name){this.createBody();return}this.name=name;if(this.texture){MovieClip.removeDisplayObject(this,this.texture.bitmapData)}this.jsonData=null;this.texture=null;RES.getResAsync(resJson,function(data,url){if(_this.name!=name||!data)return;_this.jsonData=data;_this.createBody()},this);RES.getResAsync(resName,function(data,url){if(_this.name!=name||!data)return;_this.texture=data;if(_this.stage){MovieClip.addDisplayObject(_this,_this.texture.bitmapData)}_this.createBody()},this)};MovieClip.prototype.playFile=function(name,playCount,compFun,remove,loadedFun){var _this=this;if(playCount===void 0){playCount=1}if(compFun===void 0){compFun=null}if(remove===void 0){remove=true}if(loadedFun===void 0){loadedFun=null}this.checkResName(name);if(window["isIOS_AppStore"]==true){if(StageUtils.ins().getStage()){if(window["movieClipEui"]==null){var mce=new eui.Component;mce.scaleX=0;mce.scaleY=0;window["movieClipEui"]=mce;StageUtils.ins().getStage().addChild(window["movieClipEui"]);window["movieClipEui"].visible=false}if(window["mc_"+name]==null){StageUtils.ins().getStage().addChild(window["movieClipEui"]);window["mc_"+name]=new MovieClip;window["movieClipEui"].addChild(window["mc_"+name]);window["mc_"+name].playFile(name);setInterval(function(_name){if(window["mc_"+_name].parent==window["movieClipEui"]){window["movieClipEui"].removeChild(window["mc_"+_name])}window["mc_"+_name]=new MovieClip;window["movieClipEui"].addChild(window["mc_"+_name]);window["mc_"+_name].playFile(_name)},1500,name)}}}this.time=egret.getTimer();this._compFun=compFun;this.playCount=playCount;this.remove=remove;this._loadedFun=loadedFun;TimerManager.ins().remove(this.playComp,this);if(this.texture&&this.texture.bitmapData==null){}else if(this.name==name){this.createBody();return}this.name=name;if(this.texture){MovieClip.removeDisplayObject(this,this.texture.bitmapData)}this.jsonData=null;this.texture=null;RES.getResByUrl(this.name+".json",function(data,url){if(_this.name+".json"!=url||!data)return;_this.jsonData=data;_this.createBody()},this,RES.ResourceItem.TYPE_JSON);RES.getResByUrl(this.name+".png",function(data,url){if(_this.name+".png"!=url||!data)return;_this.texture=data;if(_this.stage){MovieClip.addDisplayObject(_this,_this.texture.bitmapData)}_this.createBody()},this,RES.ResourceItem.TYPE_IMAGE)};MovieClip.prototype.$onAddToStage=function(stage,nestLevel){_super.prototype.$onAddToStage.call(this,stage,nestLevel);if(this.texture){MovieClip.addDisplayObject(this,this.texture.bitmapData)}};MovieClip.prototype.$onRemoveFromStage=function(){_super.prototype.$onRemoveFromStage.call(this);if(this.texture){MovieClip.removeDisplayObject(this,this.texture.bitmapData)}this.removeEventListener(egret.Event.CHANGE,null,null)};MovieClip.prototype.adaptI18NRes=function(tempName){var lang=ResVersionManager.ins().lang;var data=this.jsonData;if(data&&data.mc&&lang!=null&&lang!=""){for(var key in data.mc){if(key==tempName+lang){return key}}}return tempName};MovieClip.prototype.createBody=function(){if(!this.jsonData||!this.texture)return;if(this.stage&&this._loadedFun){this._loadedFun()}this._mcFactory.clearCache();this._mcFactory.mcDataSet=this.jsonData;this._mcFactory.texture=this.texture;var temp=this.name.split("/");var tempName=temp.pop();tempName=this.adaptI18NRes(tempName);this.movieClipData=this._mcFactory.generateMovieClipData(tempName);if(!(this.name in MovieClip.originalRate)){MovieClip.originalRate[this.name]=this.movieClipData.frameRate}this.frameRate=MovieClip.originalRate[this.name]*this.rate>>0;this.gotoAndPlay(1,this.playCount);this.visible=true;if(this.playCount>0){var tempTime=egret.getTimer()-this.time;tempTime=this.playTime*this.playCount-tempTime;if(tempTime>0)TimerManager.ins().doTimer(tempTime,1,this.playComp,this);else this.playComp()}this.dispatchEventWith(egret.Event.CHANGE)};MovieClip.prototype.playComp=function(){if(this.stage&&this._compFun)this._compFun();if(this.remove)DisplayUtils.removeFromParent(this)};Object.defineProperty(MovieClip.prototype,"playTime",{get:function(){if(!this.movieClipData)return 0;return 1/this.frameRate*this.totalFrames*1e3},enumerable:true,configurable:true});MovieClip.prototype.clearComFun=function(){this._compFun=null;this._loadedFun=null};MovieClip.prototype.dispose=function(){this.stop();this.resetMovieClip();this.clearComFun();TimerManager.ins().removeAll(this)};MovieClip.prototype.destroy=function(){DisplayUtils.removeFromParent(this);this.dispose();ObjectPool.push(this)};MovieClip.prototype.resetMovieClip=function(){var mc=this;mc.rotation=0;mc.scaleX=1;mc.scaleY=1;mc.alpha=1;mc.anchorOffsetX=0;mc.anchorOffsetY=0;mc.x=0;mc.y=0;mc.rate=1;if(mc.$renderNode){mc.$renderNode.cleanBeforeRender()}mc._mcFactory.clearCache();mc._mcFactory.mcDataSet=null;mc._mcFactory.texture=null;mc.name=null;mc.jsonData=null;mc.filters=null;var bitmapData=mc.texture;if(bitmapData){MovieClip.removeDisplayObject(mc,bitmapData.bitmapData)}mc.texture=null;mc.remove=false;egret.Tween.removeTweens(mc)};MovieClip.addDisplayObject=function(displayObject,bitmapData){if(!bitmapData)return;var hashCode=bitmapData.hashCode;if(!MovieClip.displayList[hashCode]){MovieClip.displayList[hashCode]=[displayObject];return}var tempList=MovieClip.displayList[hashCode];if(tempList.indexOf(displayObject)<0){tempList.push(displayObject)}};MovieClip.removeDisplayObject=function(displayObject,bitmapData){if(!bitmapData)return;var hashCode=bitmapData.hashCode;if(!MovieClip.displayList[hashCode]){return}var tempList=MovieClip.displayList[hashCode];var index=tempList.indexOf(displayObject);if(index>=0){tempList.splice(index,1)}if(tempList.length==0){delete MovieClip.displayList[hashCode];ResourceMgr.ins().disposeResTime(hashCode)}};MovieClip.originalRate={};MovieClip.displayList=egret.createMap();return MovieClip}(egret.MovieClip);__reflect(MovieClip.prototype,"MovieClip");var __old_MovieClipConstructFrame=MovieClip.prototype["constructFrame"];window["__old_MovieClipConstructFrame"]=__old_MovieClipConstructFrame;MovieClip.prototype["constructFrame"]=function(){try{__old_MovieClipConstructFrame.apply(this)}catch(e){console.log("[ERROR] constructFrame, this.name = "+this.name)}};var LoadingView=function(_super){__extends(LoadingView,_super);function LoadingView(){var _this=_super.call(this)||this;_this.init();return _this}LoadingView.prototype.init=function(){this.text=new eui.Label;this.text.text=i18n("LoadingViewBase_0");this.addChild(this.text)};LoadingView.prototype.setProgress=function(current,total){this.text.text=i18n("LoadingViewBase_1")+current+"/"+total};return LoadingView}(BaseEuiView);__reflect(LoadingView.prototype,"LoadingView");var RuleIconBase=function(_super){__extends(RuleIconBase,_super);function RuleIconBase(id,tar){if(tar===void 0){tar=null}var _this=_super.call(this)||this;_this.effX=38;_this.effY=45;_this.btnEffX=38;_this.btnEffY=45;_this.isShow=false;_this.isDelayUpdateShow=false;_this.isDelayUpdate=false;_this.icon="";_this.id=id;_this.tar=tar;return _this}RuleIconBase.prototype.getTar=function(){if(this.tar)return this.tar;return this.createTar()};RuleIconBase.prototype.createTar=function(){var config=this.getConfig();var cls=config.iconCls=="eui.Button"?eui.Button:egret.getDefinitionByName(config.iconCls);var tar=new cls;if(config.iconSkin)tar.skinName=config.iconSkin;if(config.icon)tar.icon=config.icon;if(config.iconParam){for(var key in config.iconParam)tar[key]=config.iconParam[key]}this.tar=tar;return tar};RuleIconBase.prototype.getConfig=function(){return GlobalConfig.PlayFunConfig[this.id]};RuleIconBase.prototype.delayUpdateShow=function(){if(!this.isDelayUpdateShow){this.isDelayUpdateShow=true;TimerManager.ins().doTimer(100,1,this.updateShow,this)}};RuleIconBase.prototype.updateShow=function(){this.isDelayUpdateShow=false;RuleIconBase.updateShow(this)};RuleIconBase.prototype.delayUpdate=function(){if(!this.isDelayUpdate){this.isDelayUpdate=true;TimerManager.ins().doTimer(100,1,this.update,this)}};RuleIconBase.prototype.update=function(){this.isDelayUpdate=false;RuleIconBase.update(this)};RuleIconBase.prototype.checkShowIcon=function(){return true};RuleIconBase.prototype.checkShowRedPoint=function(){return 0};RuleIconBase.prototype.checkShowLeftTip=function(){return false};RuleIconBase.prototype.getEffName=function(redPointNum){return null};RuleIconBase.prototype.getBtnEffName=function(){return null};RuleIconBase.prototype.getEffTopName=function(){return null};RuleIconBase.prototype.getLeftTipName=function(){return""};RuleIconBase.prototype.getEffLayer=function(){return 0};RuleIconBase.prototype.getBtnEffLayer=function(){return 9};RuleIconBase.prototype.getTopEffLayer=function(){return 10};RuleIconBase.prototype.setTimeBgVisible=function(b){if(b===void 0){b=false}if(this.tar&&this.tar["timeBg"]){this.tar["timeBg"].visible=b}};RuleIconBase.prototype.tapExecute=function(){};RuleIconBase.prototype.addShowEvents=function(){if(!this.showMessage)return;for(var _i=0,_a=this.showMessage;_i<_a.length;_i++){var fun=_a[_i];MessageCenter.addListener(fun,this.delayUpdateShow,this)}};RuleIconBase.prototype.addRedEvents=function(){if(!this.updateMessage)return;for(var _i=0,_a=this.updateMessage;_i<_a.length;_i++){var fun=_a[_i];MessageCenter.addListener(fun,this.delayUpdate,this)}};RuleIconBase.prototype.removeRedEvents=function(){if(!this.updateMessage)return;for(var _i=0,_a=this.updateMessage;_i<_a.length;_i++){var fun=_a[_i];MessageCenter.ins().removeListener(fun.funcallname,this.delayUpdate,this)}};RuleIconBase.prototype.removeEvents=function(){MessageCenter.ins().removeAll(this)};return RuleIconBase}(egret.HashObject);__reflect(RuleIconBase.prototype,"RuleIconBase");var RankDataBase=function(){function RankDataBase(){}RankDataBase.prototype.parser=function(bytes,items){var _this=this;items.forEach(function(key){_this[key]=bytes[RankDataType.readFunc[key]]()})};return RankDataBase}();__reflect(RankDataBase.prototype,"RankDataBase");var ClientSet;(function(ClientSet){ClientSet[ClientSet["guidePart"]=0]="guidePart";ClientSet[ClientSet["guideStep"]=1]="guideStep";ClientSet[ClientSet["expFirst"]=2]="expFirst";ClientSet[ClientSet["headRed"]=3]="headRed";ClientSet[ClientSet["diedFirstTime"]=4]="diedFirstTime";ClientSet[ClientSet["recharge1"]=5]="recharge1";ClientSet[ClientSet["vip"]=6]="vip";ClientSet[ClientSet["role"]=7]="role";ClientSet[ClientSet["FB"]=8]="FB";ClientSet[ClientSet["recharge2"]=9]="recharge2";ClientSet[ClientSet["diedFirstTime2"]=10]="diedFirstTime2";ClientSet[ClientSet["mijiRedPoint"]=11]="mijiRedPoint";ClientSet[ClientSet["firstMonthCard"]=12]="firstMonthCard";ClientSet[ClientSet["firstrecharge1"]=13]="firstrecharge1";ClientSet[ClientSet["firstClickTreasure"]=14]="firstClickTreasure";ClientSet[ClientSet["autoHeji"]=15]="autoHeji";ClientSet[ClientSet["dcMc"]=16]="dcMc";ClientSet[ClientSet["showAllShape"]=17]="showAllShape";ClientSet[ClientSet["showAllDress"]=18]="showAllDress"})(ClientSet||(ClientSet={}));window["ClientSet"]=ClientSet;var Setting=function(_super){__extends(Setting,_super);function Setting(){var _this=_super.call(this)||this;_this.map={};_this.sysId=PackageID.Default;_this.regNetMsg(19,_this.parser);return _this}Object.defineProperty(Setting,"currPart",{get:function(){return Setting.ins().getValue(ClientSet.guidePart)},enumerable:true,configurable:true});Object.defineProperty(Setting,"currStep",{get:function(){return Setting.ins().getValue(ClientSet.guideStep)},enumerable:true,configurable:true});Setting.ins=function(){return _super.ins.call(this)};Setting.prototype.parser=function(bytes){var len=bytes.readShort();for(var i=0;i<len;i++){this.map[bytes.readInt()]=bytes.readInt()}GuideUtils.ins().init();this.postInitSetting()};Setting.prototype.postInitSetting=function(){return true};Setting.prototype.sendSave=function(key,value){var bytes=this.getBytes(19);bytes.writeInt(key);bytes.writeInt(value);this.sendToServer(bytes);this.map[key]=value};Setting.prototype.setValue=function(key,value){this.sendSave(key,value)};Setting.prototype.getValue=function(key,def){if(def===void 0){def=0}return this.map[key]==undefined?def:this.map[key]};return Setting}(BaseSystem);__reflect(Setting.prototype,"Setting");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.setting=Setting.ins.bind(Setting)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SevenDayItemRender=function(_super){__extends(SevenDayItemRender,_super);function SevenDayItemRender(){var _this=_super.call(this)||this;_this.skinName="act14item";return _this}SevenDayItemRender.prototype.dataChanged=function(){var index=this.data;var config=GlobalConfig.LoginRewardsConfig[index];var currDay=Activity.ins().dayNum;var flag=(Activity.ins().isAwards>>config.day&1)==1;if(flag){this.select.visible=false;this.checkedMask.visible=this.checked.visible=true}else{this.checkedMask.visible=this.checked.visible=false}var arr=[];for(var i=0;i<config.rewards.length;i++){var reward=config.rewards[i];if(reward.job){var mjob=SubRoles.ins().getFirstJob();if(mjob==reward.job){arr.push(reward)}}else{arr.push(reward)}}this.item.data=arr[0]};SevenDayItemRender.prototype.setSelectImg=function(boo){this.select.visible=boo};return SevenDayItemRender}(BaseItemRender);__reflect(SevenDayItemRender.prototype,"SevenDayItemRender");var ShenshouEquipItem=function(_super){__extends(ShenshouEquipItem,_super);function ShenshouEquipItem(){var _this=_super.call(this)||this;_this.equipName=["",i18n("ShenshouEquipItem_0"),i18n("ShenshouEquipItem_1"),i18n("ShenshouEquipItem_2"),i18n("ShenshouEquipItem_3"),i18n("ShenshouEquipItem_4")];_this.qualityName=[i18n("ShenshouEquipItem_5"),i18n("ShenshouEquipItem_6"),i18n("ShenshouEquipItem_7"),i18n("ShenshouEquipItem_8"),i18n("ShenshouEquipItem_9"),i18n("ShenshouEquipItem_10"),i18n("ShenshouEquipItem_11"),i18n("ShenshouEquipItem_12"),i18n("ShenshouEquipItem_13")];_this.qualityObj=[0,0,2,2,2,3,3,3,4];_this.touchChildren=false;_this.touchChildren=false;return _this}ShenshouEquipItem.prototype.setPosData=function(shoushenId,pos){var quality=GlobalConfig.ShenShouBase[shoushenId].minLevel[pos-1];this.imgBg.source="quality0";this.nameTxt.text=this.qualityName[quality]+this.equipName[pos];this.nameTxt.textColor=ItemBase.QUALITY_COLOR[0];this.nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[0];this.imgIcon.source="ss_equip"+(pos-1);this.equipLv.text="";this.data=null};ShenshouEquipItem.prototype.dataChanged=function(){if(!isNaN(this.data)&&this.data){this.itemConfig=GlobalConfig.ItemConfig[this.data];this.nameTxt.text=this.itemConfig.name;this.nameTxt.textColor=ItemConfig.getQualityColor(this.itemConfig);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(this.itemConfig);this.imgBg.source="quality"+ItemConfig.getQuality(this.itemConfig);this.imgIcon.source=this.itemConfig.icon+"_png";var lv=ShenshouModel.ins().getEquipLv(this.itemConfig.id)-1;this.equipLv.text=lv>0?"+"+lv:""}};return ShenshouEquipItem}(BaseItemRender);__reflect(ShenshouEquipItem.prototype,"ShenshouEquipItem");var Shop=function(_super){__extends(Shop,_super);function Shop(){var _this=_super.call(this)||this;_this.shopData=new ShopData;_this.sysId=PackageID.Shop;_this.regNetMsg(1,_this.postUpdateShopData);_this.regNetMsg(2,_this.postBuyResult);_this.regNetMsg(3,_this.postBuyCount);_this.regNetMsg(4,_this.refreshGoodsSuccess);_this.regNetMsg(5,_this.postRefreshIntegrationSucc);_this.regNetMsg(6,_this.updateMedalMessage);_this.regNetMsg(7,_this.postUpdateBuyMedal);_this.regNetMsg(8,_this.updateSSMessage);_this.regNetMsg(9,_this.postUpdateBuySS);return _this}Shop.ins=function(){return _super.ins.call(this)};Shop.prototype.sendBuy=function(shopType,arr){var bytes=this.getBytes(2);bytes.writeInt(shopType);bytes.writeInt(arr.length);this.shopBuyArr=[];for(var i=0;i<arr.length;i++){bytes.writeInt(arr[i][0]);bytes.writeInt(arr[i][1]);var isc=GlobalConfig.ItemStoreConfig[arr[i][0]];if(isc&&isc.itemId==ItemConst.GOLD_BRICK){var tmp={id:ItemConst.GOLD_BRICK,count:arr[i][1]};this.shopBuyArr.push(tmp)}}this.sendToServer(bytes)};Shop.prototype.sendRefreshShop=function(){var bytes=this.getBytes(3);this.sendToServer(bytes)};Shop.prototype.postUpdateShopData=function(bytes){Shop.ins().shopData.parser(bytes)};Shop.prototype.postBuyResult=function(bytes){var result=bytes.readInt();return result};Shop.prototype.postBuyCount=function(bytes){Shop.ins().shopData.parserBuyCount(bytes)};Shop.prototype.refreshGoodsSuccess=function(bytes){this.postRefreshGoodsSuccess(true)};Shop.prototype.postRefreshGoodsSuccess=function(bo){return bo};Shop.prototype.postRefreshIntegrationSucc=function(bytes){var result=bytes.readBoolean();var num=bytes.readInt();return[result,Shop.ins().shopData.point]};Shop.prototype.sendIntegrationShop=function(index){var bytes=this.getBytes(5);bytes.writeInt(index);this.sendToServer(bytes)};Shop.prototype.sendMedalMessage=function(){var bytes=this.getBytes(6);this.sendToServer(bytes)};Shop.prototype.updateMedalMessage=function(bytes){var len=bytes.readInt();this.medalData=new FeatsStoreData(len,bytes);Shop.ins().postRefresMedalMessage()};Shop.prototype.postRefresMedalMessage=function(){};Shop.prototype.sendBuyMedal=function(id,num){var bytes=this.getBytes(7);bytes.writeInt(id);bytes.writeInt(num);this.sendToServer(bytes)};Shop.prototype.postUpdateBuyMedal=function(bytes){var _index=bytes.readInt();var _exchangeCount=bytes.readInt();return[_index,_exchangeCount]};Shop.openBuyGoldWin=function(showTips){if(showTips===void 0){showTips=true}var goodsId=Shop.ins().shopData.getGoodsIdByItemId(200164);if(Shop.ins().shopData.checkBuyGoodsId(goodsId,showTips)){ViewManager.ins().open(BuyWin,goodsId);return true}return false};Shop.prototype.sendSSMessage=function(){var bytes=this.getBytes(8);this.sendToServer(bytes)};Shop.prototype.updateSSMessage=function(bytes){var len=bytes.readInt();this.ssData=new SsStoreData(len,bytes);Shop.ins().postRefresSsMessage()};Shop.prototype.sendBuySS=function(id,num){var bytes=this.getBytes(9);bytes.writeInt(id);bytes.writeInt(num);this.sendToServer(bytes)};Shop.prototype.postUpdateBuySS=function(bytes){var _index=bytes.readInt();var _exchangeCount=bytes.readInt();return[_index,_exchangeCount]};Shop.prototype.postRefresSsMessage=function(){};return Shop}(BaseSystem);__reflect(Shop.prototype,"Shop");var ShopData=function(){function ShopData(){this.shopEquipData=[];this.hadBuyCount=[]}Object.defineProperty(ShopData.prototype,"refushTime",{get:function(){return this._refushTime},set:function(value){this._refushTime=value;TimerManager.ins().removeAll(this);if(value>0){TimerManager.ins().doTimer(1e3,value,this.enterTime,this)}},enumerable:true,configurable:true});ShopData.prototype.parser=function(bytes){this.shopEquipData.length=0;this.refushTime=bytes.readInt();this.point=bytes.readInt();this.times=bytes.readInt();var num=bytes.readInt();for(var i=0;i<num;i++){var s=new ShopEquipData;s.parser(bytes);this.shopEquipData.push(s)}};ShopData.prototype.parserBuyCount=function(bytes){var count=bytes.readShort();this.hadBuyCount.length=0;for(var i=0;i<count;i++){var data=new ShopHadBuyData;data.parser(bytes);this.hadBuyCount.push(data)}};ShopData.prototype.enterTime=function(){if(this._refushTime<=0)this._refushTime=0;else this._refushTime--};ShopData.prototype.getHadBuyCountItem=function(itemId){for(var _i=0,_a=this.hadBuyCount;_i<_a.length;_i++){var item=_a[_i];if(item.itemId==itemId){return item}}return null};ShopData.prototype.getHadBuyCount=function(itemId){var item=this.getHadBuyCountItem(itemId);if(item)return item.count;return 0};ShopData.prototype.getShopEquipDataLength=function(){var result=0;if(this.shopEquipData!=null){result=this.shopEquipData.length}return result};ShopData.prototype.getShopEquipDataByIndex=function(index){var result=null;if(this.shopEquipData!=null){if(index>=0&&index<this.shopEquipData.length){result=this.shopEquipData[index]}}return result};ShopData.prototype.getShopEquipDataById=function(id){for(var _i=0,_a=this.shopEquipData;_i<_a.length;_i++){var item=_a[_i];if(item.id==id){return item}}return null};ShopData.prototype.checkBuyGoodsId=function(goodsId,showTips){if(showTips===void 0){showTips=true}var shopItem=GlobalConfig.ItemStoreConfig[goodsId];if(shopItem){if(shopItem.viplv&&UserVip.ins().lv<shopItem.viplv){if(showTips)UserTips.ins().showTips(i18n("Shop_0",shopItem.viplv));return false}if(shopItem.vipLimit){var total=shopItem.vipLimit[UserVip.ins().lv];var buyCount=this.getHadBuyCount(shopItem.itemId);if(buyCount>=total){if(showTips)UserTips.ins().showTips(i18n("Shop_1"));return false}}}return true};ShopData.prototype.getGoodsIdByItemId=function(itemId){for(var goodsId in GlobalConfig.ItemStoreConfig){if(GlobalConfig.ItemStoreConfig[goodsId].itemId==itemId){return parseInt(goodsId)}}return 0};return ShopData}();__reflect(ShopData.prototype,"ShopData");var ShopEquipData=function(){function ShopEquipData(){}ShopEquipData.prototype.parser=function(bytes){this.id=bytes.readInt();this.costType=bytes.readInt();this.costNum=bytes.readInt();this.discountType=bytes.readInt();this.item=new ItemData;this.item.parser(bytes)};ShopEquipData.discountDic={0:{discount:1,res:""},1:{discount:.8,res:"shangzk8"},2:{discount:.5,res:"shangzk5"}};return ShopEquipData}();__reflect(ShopEquipData.prototype,"ShopEquipData");var ShopHadBuyData=function(){function ShopHadBuyData(){}ShopHadBuyData.prototype.parser=function(bytes){this.itemId=bytes.readInt();this.count=bytes.readInt()};return ShopHadBuyData}();__reflect(ShopHadBuyData.prototype,"ShopHadBuyData");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.shop=Shop.ins.bind(Shop)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SpecialRing=function(_super){__extends(SpecialRing,_super);function SpecialRing(){var _this=_super.call(this)||this;_this.mainHandler=[];_this.ringList=[];_this.loginDayCount=0;_this.ringActiNum=0;_this.specialRingHandler=[];_this.ringsConfig=[];_this.moneyOpenGrid=0;_this.openItemNum=0;_this.abilityIds=[];_this.skillLvDic={};_this.sysId=PackageID.Ring;_this.regNetMsg(1,_this.postRingUpdate);_this.regNetMsg(2,_this.postActiveRing);_this.regNetMsg(4,_this.postGetSpicelRingInfo);_this.regNetMsg(3,_this.postSpicelRingUpdate);_this.regNetMsg(5,_this.postSRStairUp);_this.regNetMsg(6,_this.postSRStairUp);_this.regNetMsg(7,_this.postUnLock);_this.regNetMsg(8,_this.postSkillInfo);_this.regNetMsg(9,_this.postRingAbility);_this.regNetMsg(11,_this.postGetOpenItemNum);_this.observe(GameLogic.ins().postEnterMap,_this.createRingAvatar);return _this}SpecialRing.prototype.postRingAbility=function(bytes){var count=bytes.readShort();for(var i=0;i<count;i++){var id=bytes.readShort();var lv=bytes.readShort();this.abilityIds[id]=lv}if(GameMap.fbType==0){var cfg=this.getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(cfg){var stage=this.getRingStair(cfg.level);if(stage>=2){if(this.specialRingHandler[SpecialRing.FIRE_RING_ID]>0){EntityManager.ins().removeByHandle(this.specialRingHandler[SpecialRing.FIRE_RING_ID])}SpecialRing.ins().createRingMonster(SpecialRing.FIRE_RING_ID)}}}var dp=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID];for(var id in dp){if(dp[id][1]){var item=UserBag.ins().getBagItemById(dp[id][1].itemId);if(item)item.setCanbeUsed()}}UserBag.ins().postHasItemCanUse()};SpecialRing.prototype.createRingAvatar=function(){if(GameMap.fbType==0){var cfg=this.getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(cfg){var stage=this.getRingStair(cfg.level);if(stage>=2)SpecialRing.ins().createRingMonster(SpecialRing.FIRE_RING_ID)}}};SpecialRing.prototype.sendUpGrade=function(index,roleID){var bytes=this.getBytes(1);bytes.writeShort(index);bytes.writeShort(roleID);this.sendToServer(bytes)};SpecialRing.prototype.postRingUpdate=function(bytes){var ringIndex=bytes.readShort();var roleIndex=bytes.readShort();var ringLv=bytes.readShort();SubRoles.ins().getSubRoleByIndex(roleIndex).setExRingsData(ringIndex,ringLv);return true};SpecialRing.prototype.sendActiveRing=function(index,useGameGold){if(useGameGold===void 0){useGameGold=0}var bytes=this.getBytes(2);bytes.writeShort(index);bytes.writeByte(useGameGold);this.sendToServer(bytes)};SpecialRing.prototype.postActiveRing=function(bytes){var sRingIndex=bytes.readShort();var sRingLv=bytes.readShort();var sExp=bytes.readInt();var fight=bytes.readByte();var specialRing=this.getSpecialRingDataById(sRingIndex);specialRing.level=sRingLv;specialRing.exp=sExp;specialRing.fight=fight;this.ringActiNum++;if(sRingIndex==SpecialRing.FIRE_RING_ID){this.updateGrid()}return[sRingIndex,0]};SpecialRing.prototype.postSRStairUp=function(bytes){var sRingIndex=bytes.readShort();var sRingLv=bytes.readShort();var sExp=bytes.readInt();var fight=bytes.readByte();var specialRing=this.getSpecialRingDataById(sRingIndex);specialRing.level=sRingLv;specialRing.exp=sExp;specialRing.fight=fight;this.createRingAvatar();this.updateGrid();return[sRingIndex,0]};SpecialRing.prototype.sendSpicelRingUpdate=function(index){var bytes=this.getBytes(3);bytes.writeShort(index);this.sendToServer(bytes)};SpecialRing.prototype.postSpicelRingUpdate=function(bytes){var sRingIndex=bytes.readShort();var sRingLv=bytes.readShort();var sExp=bytes.readInt();var specialRing=this.getSpecialRingDataById(sRingIndex);var isCrit=0;isCrit=bytes.readByte();var fight=bytes.readByte();specialRing.level=sRingLv;specialRing.exp=sExp;specialRing.fight=fight;return[sRingIndex,isCrit]};SpecialRing.prototype.postGetSpicelRingInfo=function(bytes){this.loginDayCount=bytes.readInt();var ringCount=bytes.readShort();this.ringList=[];this.ringActiNum=0;for(var i=0;i<ringCount;i++){var specialRing_1=new SpecialRingData;specialRing_1.parser(bytes);this.ringList.push(specialRing_1);if(specialRing_1.level>0)this.ringActiNum++}if(GameMap.fbType==0){GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_FIND_ENMENY)}this.createRingAvatar();return true};SpecialRing.prototype.isFireRing=function(handler){return this.specialRingHandler[SpecialRing.FIRE_RING_ID]==handler};SpecialRing.prototype.createRingMonster=function(id){if(!this.ringList||this.ringList.length<=0)return;var config=GlobalConfig.ActorExRingConfig[id];var data=this.getSpecialRingDataById(id);if(data.level<config.showMonsterLv)return;var monId=config.monsterId;var abilityId=this.getAbilityID();if(abilityId){var cfg=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID][abilityId][this.abilityIds[abilityId]];if(cfg)monId+=cfg.monId}if(!EntityManager.ins().getEntityByHandle(this.specialRingHandler[id])){var role=EntityManager.ins().getNoDieRole();if(role){var m=UserFb.createModel(GlobalConfig.MonstersConfig[monId]);m.setAtt(AttributeType.atMoveSpeed,SpecialRing.FIRE_RING_MOVING_SPEED);m.x=role.x;m.y=role.y;m.masterHandle=Actor.handle;this.specialRingHandler[id]=m.handle=egret.getTimer();m.lyMarkLv=LyMark.ins().lyMarkLv;m.lyMarkSkills=LyMark.ins().skills;var monster=GameLogic.ins().createEntityByModel(m,Team.My);monster.AI_STATE=AI_State.Stand}}};SpecialRing.prototype.sendRingLevelUp=function(index){var bytes=this.getBytes(5);bytes.writeShort(index);this.sendToServer(bytes)};SpecialRing.prototype.sendRingFight=function(index,state){var bytes=this.getBytes(6);bytes.writeShort(index);bytes.writeByte(state);this.sendToServer(bytes)};SpecialRing.prototype.sendGetOpenItemNum=function(){var bytes=this.getBytes(11);this.sendToServer(bytes)};SpecialRing.prototype.postGetOpenItemNum=function(bytes){this.openItemNum=bytes.readInt();return this.openItemNum};SpecialRing.prototype.checkOperation=function(){var bool=this.checkHaveUpRing();if(!bool&&this.isFireRingFuse()){bool=this.isCanStudySkill()||this.isCanUpgradeSkill()}return bool};SpecialRing.prototype.checkHaveUpRing=function(){if(!SpecialRing.ins().checkRingOpen())return false;var len=this.ringList.length;for(var i=0;i<len;i++){var data=this.ringList[i];var flag=this.checkRedPoint(data.id,data.level);if(flag)return flag}return false};SpecialRing.prototype.checkRingOpen=function(){var openGuanqia=GlobalConfig.OpenSystemConfig[SystemType.RING].opencheck;var guanqia=UserFb.ins().guanqiaIDFast;return guanqia>=openGuanqia};SpecialRing.prototype.checkRedPoint=function(id,level){if(level>0){return this.checkCanUpdate(id,level)}else{return this.checkCanActive(id)}};SpecialRing.prototype.checkCanUpdate=function(id,level){var result=false;if(id==SpecialRing.FIRE_RING_ID&&this.isFireRingFuse()){var config=GlobalConfig.ActorExRingConfig[id];if(this.getRingConfigById(id,level+1)){if(level%11==0){result=true}else{var config_3=this.getRingConfigById(id,level);var count=UserBag.ins().getBagGoodsCountById(0,config_3.costItem);result=config_3.cost<=count}}}return result};SpecialRing.prototype.checkCanActive=function(id){var config=GlobalConfig.ActorExRingConfig[id];var canActive=false;if(id==SpecialRing.FIRE_RING_ID){if(!this.isFireRingActivate()){canActive=this.isFireRingCanActivate()}}else{var lvl=this.getSpecialRingDataById(id).level;if(lvl==0){canActive=this.openItemNum>=config.openItem.count}}return canActive};SpecialRing.prototype.canGradeupRing=function(type){var boolList=[false,false,false];var len=SubRoles.ins().subRolesLen;var lv=0;var config;var costNum=0;var itemNum=0;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);lv=role.getExRingsData(type);config=GlobalConfig["ExRing"+type+"Config"][lv];costNum=config.cost;if(costNum){itemNum=UserBag.ins().getBagGoodsCountById(0,GlobalConfig.ExRingConfig[type].costItem);boolList[i]=itemNum>=costNum}else{boolList[i]=false}}return boolList};SpecialRing.prototype.getRingConfigById=function(id,level){if(this.ringsConfig.length==0){this.initConfig()}if(this.ringsConfig[id]&&this.ringsConfig[id][level])return this.ringsConfig[id][level];return null};SpecialRing.prototype.initConfig=function(){this.ringsConfig=[];var config=GlobalConfig.ActorExRingConfig;for(var k in config){this.ringsConfig[config[k].id]=GlobalConfig["ActorExRing"+k+"Config"]}};SpecialRing.prototype.getRingStair=function(level){var stair=0;stair=Math.ceil(level/(SpecialRing.perStar+1));return stair};SpecialRing.prototype.getRingStar=function(level){if(level<1){return 0}return(level-1)%(SpecialRing.perStar+1)};SpecialRing.prototype.hasHanlder=function(handler){for(var i=0;i<this.mainHandler.length;i++){if(handler==this.mainHandler[i]){return true}}this.mainHandler.push(handler);return false};SpecialRing.prototype.delHanlder=function(handler){for(var i=0;i<this.mainHandler.length;i++){if(handler==this.mainHandler[i]){this.mainHandler.splice(i,1);return}}};SpecialRing.prototype.getSpecialRingDataById=function(id){for(var i=0;i<this.ringList.length;i++){if(this.ringList[i].id==id){return this.ringList[i]}}return null};SpecialRing.prototype.isFireRingFuse=function(){var isFuse=false;var ringData=this.getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(ringData&&ringData.level>=1){isFuse=true}return isFuse};SpecialRing.prototype.isFireRingActivate=function(){var isActivate=false;var ringData=this.getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(ringData&&ringData.isUnLock){isActivate=true}return isActivate};SpecialRing.prototype.isFireRingCanActivate=function(){var canActivate=true;for(var _i=0,_a=this.ringList;_i<_a.length;_i++){var ring=_a[_i];if(ring.order!=6&&ring.level<=0){canActivate=false;break}}return canActivate};SpecialRing.prototype.requestDeblock=function(ringId){var bytes=this.getBytes(7);bytes.writeShort(ringId);this.sendToServer(bytes)};SpecialRing.prototype.postUnLock=function(bytes){var ringId=bytes.readShort();var lvl=bytes.readShort();var exp=bytes.readInt();var isFight=bytes.readByte();var isUnlock=bytes.readByte();for(var i=0;i<this.ringList.length;i++){if(this.ringList[i].id==ringId){this.ringList[i].level=lvl;this.ringList[i].exp=exp;this.ringList[i].fight=isFight;this.ringList[i].isUnLock=isUnlock;break}}return isUnlock==1};SpecialRing.prototype.requestOpenGrid=function(){var bytes=this.getBytes(8);this.sendToServer(bytes)};SpecialRing.prototype.requestLearnSkill=function(skillId,position){var bytes=this.getBytes(9);bytes.writeShort(skillId);bytes.writeShort(position);this.sendToServer(bytes)};SpecialRing.prototype.requestUpgradeSkill=function(position){var bytes=this.getBytes(10);bytes.writeShort(position);this.sendToServer(bytes)};SpecialRing.prototype.postSkillInfo=function(bytes){this.initSkill();this.moneyOpenGrid=bytes.readShort();this.updateGrid();var count=bytes.readShort();for(var i=0;i<count;i++){var ring_1=new RingSkillInfo;ring_1.position=bytes.readShort();ring_1.skillId=bytes.readShort();ring_1.skillLvl=bytes.readShort();this.updateSkillInfo(ring_1)}};SpecialRing.prototype.updateGrid=function(){var cfg=this.getSpecialRingDataById(SpecialRing.FIRE_RING_ID);var openCount=0;if(cfg.level>0){openCount=this.moneyOpenGrid+this.getRingConfigById(SpecialRing.FIRE_RING_ID,cfg.level).freeSkillGrid}this.updateGridOpen(openCount)};SpecialRing.prototype.updateGridOpen=function(num){for(var i=1;i<=num;i++){var ring_2=this.skillInfo[i-1];ring_2.isOpen=true}};SpecialRing.prototype.updateSkillInfo=function(skill){var count=this.skillInfo.length;for(var i=0;i<count;i++){var ring_3=this.skillInfo[i];if(ring_3.position==skill.position){ring_3.skillId=skill.skillId;ring_3.skillLvl=skill.skillLvl}}};SpecialRing.prototype.initSkill=function(){if(!this.skillInfo){this.skillInfo=[];for(var i=1;i<9;i++){var ring_4=new RingSkillInfo;ring_4.position=i;this.skillInfo.push(ring_4)}}};SpecialRing.prototype.getCanStudyBook=function(){var ary=[];if(!this.skillInfo)return ary;var count=this.skillInfo.length;var filter=[];var filterSkill=[];for(var i=0;i<count;i++){var ring_5=this.skillInfo[i];if(ring_5.skillId>0){filterSkill.push(ring_5.skillId)}}var books=this.getActorExRingBookConfigByLvl(1);var len=books.length;for(var j=0;j<len;j++){var cfg=books[j];if(filterSkill.indexOf(cfg.id)<0){var num=UserBag.ins().getBagGoodsCountById(0,cfg.itemId);if(num>=cfg.num){var info=new RewardData;info.id=cfg.itemId;info.count=num;info.type=1;ary.push(info)}}}return ary};SpecialRing.prototype.isBookCanStudy=function(itemId){var ary=[];var count=this.skillInfo.length;var filter=[];var filterSkill=[];for(var i=0;i<count;i++){var ring_6=this.skillInfo[i];if(ring_6.skillId>0){filterSkill.push(ring_6.skillId)}}var books=this.getActorExRingBookConfigByLvl(1);var len=books.length;for(var j=0;j<len;j++){var cfg=books[j];if(cfg.itemId==itemId&&filterSkill.indexOf(cfg.id)<0){var num=UserBag.ins().getBagGoodsCountById(0,cfg.itemId);if(num>=cfg.num){return true}}}return false};SpecialRing.prototype.getStudyBook=function(){var ary=[];var filter=[];var books=this.getActorExRingBookConfigByLvl(1);var len=books.length;for(var j=0;j<len;j++){var cfg=books[j];var num=UserBag.ins().getBagGoodsCountById(0,cfg.itemId);var info=new RewardData;info.id=cfg.itemId;info.count=num;info.type=1;ary.push(info)}return ary};SpecialRing.prototype.getFirstStudyBookIndex=function(){var books=this.getActorExRingBookConfigByLvl(1);var len=books.length;for(var j=0;j<len;j++){var cfg=books[j];if(this.isBookCanStudy(cfg.itemId)){return j}}return 0};SpecialRing.prototype.isCanStudySkill=function(){var ary=this.getCanStudyBook();var canStudy=false;if(ary!=undefined&&ary.length>0&&this.isHaveFreeGrid()){canStudy=true}return canStudy};SpecialRing.prototype.isHaveFreeGrid=function(){var count=this.skillInfo.length;for(var i=0;i<count;i++){var ring_7=this.skillInfo[i];if(ring_7.skillId==0&&ring_7.isOpen){return true}}return false};SpecialRing.prototype.isCanUpgradeSkill=function(){var ary=[];if(!this.skillInfo)return false;var count=this.skillInfo.length;for(var i=0;i<count;i++){var ring_8=this.skillInfo[i];if(ring_8.skillId>0&&ring_8.skillLvl<this.getSkillMaxLvl(ring_8.skillId)){var cfg=this.getActorExRingBookConfig(ring_8.skillId,ring_8.skillLvl);var num=UserBag.ins().getBagGoodsCountById(0,cfg.itemId);if(num>=cfg.num){return true}}}return false};SpecialRing.prototype.canUseSpecialRingItem=function(){var id=GlobalConfig.ActorExRingCommon.ExRingItem;var isHave=UserBag.ins().getBagGoodsCountById(0,id);var canUse=this.checkCanUseByItem(id);return isHave>0&&canUse?true:false};SpecialRing.prototype.fireRingRedPoint=function(){return UserFb.ins().fbRings.challengeTime>0||UserFb.ins().fbRings.canTakeAward};SpecialRing.prototype.getActorExRingBookConfig=function(skillId,skillLvl){var cfg;for(var i in GlobalConfig.ActorExRingBookConfig){for(var j in GlobalConfig.ActorExRingBookConfig[i]){if(i==skillId.toString()&&j==skillLvl.toString()){cfg=GlobalConfig.ActorExRingBookConfig[i][j];break}}}return cfg};SpecialRing.prototype.getActorExRingBookConfigByLvl=function(skillLvl){var ary=[];var filter=[];for(var i in GlobalConfig.ActorExRingBookConfig){for(var j in GlobalConfig.ActorExRingBookConfig[i]){if(j==skillLvl.toString()){if(filter.indexOf(GlobalConfig.ActorExRingBookConfig[i][j].itemId)<0){filter.push(GlobalConfig.ActorExRingBookConfig[i][j].itemId);ary.push(GlobalConfig.ActorExRingBookConfig[i][j])}break}}}return ary};SpecialRing.prototype.getSkillIdByItemId=function(itemId){var skillId;for(var i in GlobalConfig.ActorExRingBookConfig){for(var j in GlobalConfig.ActorExRingBookConfig[i]){if(GlobalConfig.ActorExRingBookConfig[i][j].itemId==itemId){skillId=parseInt(i);return skillId}}}return 0};SpecialRing.prototype.getSkillMaxLvl=function(skillId){var count=0;if(this.skillLvDic[skillId]!=undefined){count=this.skillLvDic[skillId]}else{for(var i in GlobalConfig.ActorExRingBookConfig){if(i==skillId.toString()){for(var j in GlobalConfig.ActorExRingBookConfig[i]){count++}}}this.skillLvDic[skillId]=count}return count};SpecialRing.prototype.getNextStageSkillName=function(ringLvl){var skillName;for(var i in GlobalConfig.ActorExRingAbilityConfig){var cfg=GlobalConfig.ActorExRingAbilityConfig[i];if(cfg&&cfg.ringLv==ringLvl){skillName=cfg.abilityName;break}}return skillName};SpecialRing.prototype.getUnLockStage=function(id){var cfg=GlobalConfig.ActorExRingAbilityConfig[id];var lvl=cfg.ringLv;var desc;switch(lvl){case 1:desc=i18n("SpecialRing_0");break;case 5:desc=i18n("SpecialRing_1");break;case 10:desc=i18n("SpecialRing_2");break;case 20:desc=i18n("SpecialRing_3");break;case 40:desc=i18n("SpecialRing_4");break;case 60:desc=i18n("SpecialRing_5");break;case 80:desc=i18n("SpecialRing_6");break}return desc};SpecialRing.prototype.getRingSkill=function(){if(!this.skillInfo)return 0;var count=this.skillInfo.length;var lvl=0;for(var i=0;i<count;i++){var data=this.skillInfo[i];if(data.skillId==7){lvl=data.skillLvl;break}}var ringLvl=this.getSpecialRingDataById(7).level;var skillId=this.getRingConfigById(7,ringLvl).summonerSkillId;if(lvl>0&&skillId){var remainder=skillId%10;remainder+=lvl;if(remainder>9)remainder=9;var prefix=Math.floor(skillId/10);skillId=prefix*10+remainder}return skillId};SpecialRing.prototype.getCanUpgradeStars=function(materialsCount){var lvl=this.getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level;var star=0;while(true){lvl++;var cfg=GlobalConfig.ActorExRing7Config[lvl];if(!cfg){return star}else{materialsCount-=cfg.cost;if(materialsCount>=0){star++}else{return star}}}};SpecialRing.prototype.getAbilityID=function(index){if(index===void 0){index=0}var ix=0;for(var id in this.abilityIds){if(ix==index){return+id}ix++}return 0};SpecialRing.prototype.getAbilityIdByItemId=function(itemId){var dp=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID];for(var id in dp){if(dp[id][1].itemId=itemId)return+id}return 0};SpecialRing.prototype.getMaxAbilityLvByItemId=function(itemId){var dp=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID];for(var id in dp){if(dp[id][1].itemId=itemId)return CommonUtils.getObjectLength(dp[id])}return 0};SpecialRing.prototype.checkCanUseByItem=function(itemId){var id=this.getAbilityIdByItemId(itemId);var maxLv=this.getMaxAbilityLvByItemId(itemId);if(id&&this.abilityIds[id]>=maxLv){return false}return true};SpecialRing.ins=function(){return _super.ins.call(this)};SpecialRing.perStar=10;SpecialRing.FIRE_RING_ID=7;SpecialRing.FIRE_RING_MOVING_SPEED=3750;SpecialRing.GRID_OPEN_LEVEL=20;return SpecialRing}(BaseSystem);__reflect(SpecialRing.prototype,"SpecialRing");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.specialRing=SpecialRing.ins.bind(SpecialRing)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ItemRenderer=eui.ItemRenderer;window["ItemRenderer"]=ItemRenderer;var FireRingSkillItem=function(_super){__extends(FireRingSkillItem,_super);function FireRingSkillItem(){var _this=_super.call(this)||this;TimerManager.ins().doNext(function(){var shape=new egret.Shape;shape.graphics.beginFill(65280);shape.graphics.drawRoundRect(0,0,_this.width,_this.height,1,1);shape.graphics.endFill();shape.alpha=0;_this.addChild(shape)},_this);return _this}FireRingSkillItem.prototype.dataChanged=function(){var _this=this;var data=this.data;if(data.isOpen){if(data.skillId){this.currentState="learn";var cfg=SpecialRing.ins().getActorExRingBookConfig(data.skillId,data.skillLvl);this.skillImg.source=cfg.skillIcon;var level=i18n("Level_0");this.skillLv.text=""+data.skillLvl+level;this.skillName.text=cfg.skillName;var num=UserBag.ins().getBagGoodsCountById(0,cfg.itemId);this.redpoint.visible=num>=cfg.num&&data.skillLvl<SpecialRing.ins().getSkillMaxLvl(data.skillId)}else{this.currentState="unlearn";this.redpoint.visible=SpecialRing.ins().isCanStudySkill()}}else{this.currentState="lock";var lvl=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level;var stage=SpecialRing.ins().getRingStair(lvl);if(stage<SpecialRing.GRID_OPEN_LEVEL){TimerManager.ins().doNext(function(){_this.skillName.text=i18n("FireRingSkillItem_0",SpecialRing.GRID_OPEN_LEVEL)},this);this.price.visible=false}else{this.price.visible=true;TimerManager.ins().doNext(function(){_this.skillName.text=i18n("FireRingSkillItem_1")},this);var data_1=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];this.price.setPrice(data_1.skillGridYb)}}this.select.visible=this.selected};FireRingSkillItem.prototype.setSelect=function(isSelect){this.select.visible=isSelect};return FireRingSkillItem}(ItemRenderer);__reflect(FireRingSkillItem.prototype,"FireRingSkillItem");var TargetMemberHeadRender=function(_super){__extends(TargetMemberHeadRender,_super);function TargetMemberHeadRender(){var _this=_super.call(this)||this;_this.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);TimerManager.ins().doTimer(500,1,_this.startSetRelive,_this);return _this}TargetMemberHeadRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);this.removeAttEffect();this.setNameColor()};TargetMemberHeadRender.prototype.onTap=function(e){TimerManager.ins().remove(this.isShowReliveTip,this);if(KfArenaSys.ins().isKFArena&&KfArenaSys.ins().getReadyTime()>0){UserTips.ins().showTips(i18n("TargetMemberHeadRender_6")+KfArenaSys.ins().getReadyTime()+i18n("TargetMemberHeadRender_0"));return}if(!isNaN(this.data)){this.showEffect();SysSetting.ins().setValue("mapClickTx",0);SysSetting.ins().setValue("mapClickTy",0);if(KFBossSys.ins().flagHandle==parseInt(this.data)){if(KFBossSys.ins().flagCD-egret.getTimer()>0){UserTips.ins().showTips(i18n("TargetMemberHeadRender_1",ColorUtil.RED_COLOR_N))}else{TargetListCC.ins().isStopAutoAttack=true;KFBossSys.ins().sendCollectFlag()}TargetListCC.ins().lastAttackHandle=TargetListCC.INITE_HANDLE}else if(KfArenaSys.ins().flagHandle==parseInt(this.data)){if(KfArenaSys.ins().flagCD-egret.getTimer()>0){UserTips.ins().showTips(i18n("TargetMemberHeadRender_2",ColorUtil.RED_COLOR_N))}else{TargetListCC.ins().isStopAutoAttack=true;KfArenaSys.ins().sendCollectFlag()}TargetListCC.ins().lastAttackHandle=TargetListCC.INITE_HANDLE}else{var charSource=EntityManager.ins().getEntityByHandle(this.data)||EntityManager.ins().getEntityBymasterhHandle(this.data);var hpInfo=TargetListCC.ins().getCharRolesHpByHandle(this.data);if(charSource){charSource._hpBar.maximum=charSource._hpBar.maximum>0?charSource._hpBar.maximum:1;var value=charSource.getHP()/charSource._hpBar.maximum*100;if(hpInfo.maximum>0&&hpInfo.curHp>0){value=hpInfo.curHp/hpInfo.maximum*100}if(value<=0){UserTips.ins().showTips(i18n("TargetMemberHeadRender_3",ColorUtil.RED_COLOR_N));console.log("======hp:",value,"getHP():",charSource.getHP(),"maximum:",charSource._hpBar.maximum*100);return}var camp=charSource.infoModel.camp;if(TargetListCC.ins().isInMyCamp(camp,this.data)){UserTips.ins().showTips(i18n("TargetMemberHeadRender_4",ColorUtil.GREEN_COLOR_N))}else if(TargetListCC.ins().canAttackHandles.indexOf(this.data)>-1){if(KfArenaSys.ins().isKFArena){if(!TimerManager.ins().isExists(this.isShowReliveTip,this)){TimerManager.ins().doTimer(500,0,this.isShowReliveTip,this)}}KfArenaSys.ins().isStopCollectFlag=true;TargetListCC.ins().isStopAutoAttack=false;TargetListCC.ins().lastAttackHandle=this.data;TargetListCC.ins().lastAttackIndex=this.itemIndex;GameLogic.ins().postChangeAttrPoint(this.data)}}}}};TargetMemberHeadRender.prototype.isShowReliveTip=function(){if(!KfArenaSys.ins().isKFArena){TimerManager.ins().remove(this.isShowReliveTip,this);return}this.relive.visible=false;this.onAutoAttackReliveEnemy()};TargetMemberHeadRender.prototype.onAutoAttackReliveEnemy=function(){if(!KfArenaSys.ins().isCollecting(Actor.handle)&&!TargetListCC.ins().isStopAutoAttack&&TargetListCC.ins().lastAttackHandle==this.data){GameLogic.ins().postChangeAttrPoint(this.data)}};TargetMemberHeadRender.prototype.setNameColor=function(){if(!isNaN(this.data)){if(this.isPlayerHead()){if(TargetListCC.ins().canAttackHandles.indexOf(this.data)>-1){this.roleName.textColor=KfArenaSys.enemyColor}else{this.roleName.textColor=KfArenaSys.teamColor}}}};TargetMemberHeadRender.prototype.startSetRelive=function(){if(!isNaN(this.data)){if(this.isPlayerHead()){if(TargetListCC.ins().canAttackHandles.indexOf(this.data)>-1){if(!TimerManager.ins().isExists(this.isShowReliveTip,this))TimerManager.ins().doTimer(500,0,this.isShowReliveTip,this)}}}};TargetMemberHeadRender.prototype.isPlayerHead=function(){if(!this.data)return false;if(KFBossSys.ins().flagHandle==parseInt(this.data)||KfArenaSys.ins().flagHandle==parseInt(this.data)){return false}return true};return TargetMemberHeadRender}(WorldBossHeadRender);__reflect(TargetMemberHeadRender.prototype,"TargetMemberHeadRender");var TipsItem=function(_super){__extends(TipsItem,_super);function TipsItem(){var _this=_super.call(this)||this;_this.index=0;_this.skinName="TipsSkin";return _this}TipsItem.prototype.setIndex=function(value){this.index=value};Object.defineProperty(TipsItem.prototype,"labelText",{get:function(){return this._labelText},set:function(value){this._labelText=value;this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText);this.bg.width=this.lab.width;this.bg.visible=false;this.lab.alpha=1;this.bg.y=0;this.lab.verticalCenter=-1;if(!this.addToEvent){this.addToEvent=true;TimerManager.ins().doTimer(1200,1,this.removeFromParent,this)}},enumerable:true,configurable:true});TipsItem.prototype.removeFromParent=function(){this.addToEvent=false;DisplayUtils.removeFromParent(this);egret.Tween.removeTweens(this);ObjectPool.push(this)};TipsItem.prototype.setSkinName=function(skinName){if(skinName===void 0){skinName="TipsSkin"}if(this.skinName!=skinName){this.skinName=skinName}};return TipsItem}(BaseView);__reflect(TipsItem.prototype,"TipsItem");var ChapterHardFirstConfig=function(){function ChapterHardFirstConfig(){}return ChapterHardFirstConfig}();__reflect(ChapterHardFirstConfig.prototype,"ChapterHardFirstConfig");var SoundBg=function(_super){__extends(SoundBg,_super);function SoundBg(){var _this=_super.call(this)||this;_this._currBg="";return _this}SoundBg.prototype.stop=function(){if(this._currSoundChannel){this.removeSoundChannel(this._currSoundChannel)}this._currSoundChannel=null;this._currSound=null;this._currBg=""};SoundBg.prototype.play=function(effectName){if(this._currBg==effectName)return;this.stop();this._currBg=effectName;var sound=this.getSound(effectName);if(sound){this.playSound(sound)}};SoundBg.prototype.touchPlay=function(){if(this._currSoundChannel&&this._currSound){var pos=this._currSoundChannel.position;this.removeSoundChannel(this._currSoundChannel);this._currSoundChannel=this._currSound.play(pos,1);this.addSoundChannel(this._currSoundChannel)}};SoundBg.prototype.playSound=function(sound){if(ChannelMgr.ins().main_channel=="0"){return}this._currSound=sound;this._currSoundChannel=this._currSound.play(0,1);this.addSoundChannel(this._currSoundChannel)};SoundBg.prototype.onSoundComplete=function(){if(this._currSoundChannel)this.removeSoundChannel(this._currSoundChannel);this.playSound(this._currSound)};SoundBg.prototype.addSoundChannel=function(channel){channel.volume=this._volume;channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this)};SoundBg.prototype.removeSoundChannel=function(channel){channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this);channel.stop()};SoundBg.prototype.setVolume=function(volume){this._volume=volume;if(this._currSoundChannel){this._currSoundChannel.volume=this._volume}};SoundBg.prototype.loadedPlay=function(key){if(this._currBg==key){var sound=RES.getRes(key);if(!sound){return}this.playSound(sound)}};SoundBg.prototype.checkCanClear=function(key){return this._currBg!=key};return SoundBg}(BaseSound);__reflect(SoundBg.prototype,"SoundBg");var SoundEffects=function(_super){__extends(SoundEffects,_super);function SoundEffects(){var _this=_super.call(this)||this;_this.__uacp=null;_this.lastPlayId=0;_this.playStates={};TimerManager.ins().doTimer(1*60*1e3,0,_this.deletePlayStates,_this);return _this}SoundEffects.prototype.useAudioContextPlayer=function(){if(this.__uacp===null){var agent=navigator.userAgent.toLowerCase();var isAndroid=agent.indexOf("android")!=-1;this.__uacp=(ChannelMgr.ins().isYouTuoBangChannel()||ChannelMgr.ins().is1758Channel()||ChannelMgr.ins().isZiXiaChannel()||ChannelMgr.ins().is511WanChannel()||ChannelMgr.ins().isHuanYouChannel2()||ChannelMgr.ins().isHuanYouChannel()||ChannelMgr.ins().isQuickH5SDKChannel()||ChannelMgr.ins().isFKYLCChannel()||ChannelMgr.ins().isAWYCChannel())&&isAndroid&&AudioContextPlayer.ins().audioCtx&&AudioContextPlayer.ins().audioCtx.resume&&AudioContextPlayer.ins().audioCtx.createAnalyser&&AudioContextPlayer.ins().audioCtx.createGain&&AudioContextPlayer.ins().audioCtx.createBufferSource}return this.__uacp};SoundEffects.prototype.play=function(effectName,times){if(times===void 0){times=1}if(this.useAudioContextPlayer()){var u=effectName;var i=u.lastIndexOf("_");u="resource/sound/"+u.substr(0,i)+"."+u.substr(i+1);u=RES.$getVirtualUrl(u);return AudioContextPlayer.ins().play(u)}else{var curPlayId=this.lastPlayId+1;this.lastPlayId=curPlayId;var sound=RES.getRes(effectName);if(sound){if(this._cache[effectName]){this._cache[effectName]=egret.getTimer()}var channel=this.playSound(sound,times);this.playStates[curPlayId]={channel:channel,stopped:false,times:times,playTime:egret.getTimer()}}else{if(this._loadingCache.indexOf(effectName)!=-1){return null}this._loadingCache.push(effectName);this.playStates[curPlayId]={channel:null,stopped:false,times:times,playTime:egret.getTimer()};var self=this;RES.getResAsync(effectName,function(data,key){self.onSoundLoaded(data,key,times,curPlayId)},this)}return curPlayId}};SoundEffects.prototype.onSoundLoaded=function(data,key,times,curPlayId){var index=this._loadingCache.indexOf(key);if(index!=-1){this._loadingCache.splice(index,1);this._cache[key]=egret.getTimer();var s=RES.getRes(key);if(!s){return}if(this.playStates[curPlayId]&&!this.playStates[curPlayId].stopped){var channel=this.playSound(s,times);this.playStates[curPlayId].channel=channel}}};SoundEffects.prototype.stop=function(playId){if(playId==null){return}if(this.useAudioContextPlayer()){var ps=AudioContextPlayer.ins().playStates[playId];if(ps){try{ps.channel.stop()}catch(e){}delete AudioContextPlayer.ins().playStates[playId]}}else{ps=this.playStates[playId];if(ps){try{ps.channel.stop()}catch(e){}delete this.playStates[playId]}}};SoundEffects.prototype.deletePlayStates=function(){var now=egret.getTimer();var playStates=this.playStates;var toDelete=[];for(var k in playStates){var ps=playStates[k];if(ps.times!=0&&now-ps.playTime>SoundManager.CLEAR_TIME){toDelete.push(k)}}for(var _i=0,toDelete_1=toDelete;_i<toDelete_1.length;_i++){var delKey=toDelete_1[_i];delete playStates[delKey]}};SoundEffects.prototype.stopChannels=function(){var playStates;if(this.useAudioContextPlayer()){if(AudioContextPlayer.ins().playStates){playStates=AudioContextPlayer.ins().playStates}}else{if(this.playStates){playStates=this.playStates}}if(playStates){for(var playId in playStates){this.stop(playId)}}};SoundEffects.prototype.playSound=function(sound,times){if(times===void 0){times=1}try{var channel=sound.play(0,times);channel.volume=this._volume;return channel}catch(e){}};SoundEffects.prototype.setVolume=function(volume){this._volume=volume};SoundEffects.prototype.loadedPlay=function(key){var sound=RES.getRes(key);if(!sound){return}this.playSound(sound)};return SoundEffects}(BaseSound);__reflect(SoundEffects.prototype,"SoundEffects");var SoundManager=function(_super){__extends(SoundManager,_super);function SoundManager(){var _this=_super.call(this)||this;_this.screenVisibility=true;_this.bgOn=true;_this.effectOn=true;_this.bgVolume=.5;_this.effectVolume=.5;_this.bg=new SoundBg;_this.bg.setVolume(_this.bgVolume);_this.effect=new SoundEffects;_this.effect.setVolume(_this.effectVolume);var self=_this;window["visibilitychangeFunc"]=function(f){self.screenVisibility=f==1?true:false;console.log("screenVisibility : "+self.screenVisibility);if(self.bgOn&&!f){self.stopBg()}if(self.bgOn&&f){self.playBg(self.currBg)}};return _this}SoundManager.ins=function(){return _super.ins.call(this)};SoundManager.prototype.playEffect=function(effectName,times){if(times===void 0){times=1}if(!this.effectOn)return;if(ChannelMgr.ins().isNoSoundChannel()){return}if(!this.screenVisibility){return}this.playEffectImpl(effectName,times)};SoundManager.prototype.playEffectImpl=function(effectName,times){if(times===void 0){times=1}var agent=navigator.userAgent.toLowerCase();if(Recharge.ins().plat=="and"||agent.indexOf("android")!=-1){effectName=effectName.replace("_mp3","_ogg")}return this.effect.play(effectName,times)};SoundManager.prototype.stopEffect=function(id){this.effect.stop(id)};SoundManager.prototype.stopChannels=function(){this.effect.stopChannels()};SoundManager.prototype.playBg=function(bgName){this.currBg=bgName;if(!this.bgOn)return;if(ChannelMgr.ins().isNoSoundChannel()){return}if(!this.screenVisibility){return}this.bg.play(bgName)};SoundManager.prototype.stopBg=function(){this.bg.stop()};SoundManager.prototype.touchBg=function(){if(egret.Capabilities.isMobile&&egret.Capabilities.os=="iOS"){this.bg.touchPlay()}};SoundManager.prototype.setEffectOn=function($isOn){this.effectOn=$isOn};SoundManager.prototype.setBgOn=function($isOn){this.bgOn=$isOn;if(!this.bgOn){this.stopBg()}else{if(this.currBg){this.playBg(this.currBg)}}};SoundManager.prototype.setBgVolume=function(volume){volume=Math.min(volume,1);volume=Math.max(volume,0);this.bgVolume=volume;this.bg.setVolume(this.bgVolume)};SoundManager.prototype.getBgVolume=function(){return this.bgVolume};SoundManager.prototype.setEffectVolume=function(volume){volume=Math.min(volume,1);volume=Math.max(volume,0);this.effectVolume=volume;this.effect.setVolume(this.effectVolume)};SoundManager.prototype.getEffectVolume=function(){return this.effectVolume};SoundManager.CLEAR_TIME=3*60*1e3;return SoundManager}(BaseClass);__reflect(SoundManager.prototype,"SoundManager");var Algorithm=function(){function Algorithm(){}Algorithm.sortAsc=function(b1,b2){if(b1<b2)return-1;else if(b1>b2)return 1;else return 0};Algorithm.sortAscAttr=function(obj1,obj2,attr){var result;if(attr==undefined){result=Algorithm.sortAsc(obj1,obj2)}else{var attr1=obj1[attr];var attr2=obj2[attr];if(attr1<attr2){result=-1}else if(attr1>attr2){result=1}else{result=0}}return result};Algorithm.sortDesc=function(b1,b2){if(b1>b2)return-1;else if(b1<b2)return 1;else return 0};Algorithm.sortDescAttr=function(obj1,obj2,attr){var result;if(attr==undefined){result=Algorithm.sortDesc(obj1,obj2)}else{var attr1=obj1[attr];var attr2=obj2[attr];if(attr1>attr2){result=-1}else if(attr1<attr2){result=1}else{result=0}}return result};Algorithm.binSearch=function(tab,item,binFunc){if(binFunc===void 0){binFunc=null}if(!tab||tab.length==0)return 0;if(!binFunc)binFunc=Algorithm.sortAsc;var low=0;var high=tab.length-1;while(low<=high){var mid=high+low>>1;var val=tab[mid];if(binFunc(val,item)<=0){low=mid+1}else{high=mid-1}}return low};Algorithm.test=function(){var arr=[];var MAX=10;for(var i=0;i<MAX;i++){var r=Math.floor(Math.random()*1e5);var index=Algorithm.binSearch(arr,r);arr.splice(index,0,r)}if(arr.length!=MAX)debug.log("test fail!count is "+arr.length+", except:"+MAX);for(var _i=0,arr_2=arr;_i<arr_2.length;_i++){var val=arr_2[_i];debug.log(val)}for(var i=0;i<arr.length-1;i++){if(arr[i]>arr[i+1]){debug.log("test fail!index:"+i);break}}};return Algorithm}();__reflect(Algorithm.prototype,"Algorithm");var AppDotUp=function(){function AppDotUp(){}AppDotUp.Ins=function(){this._ins=this._ins||new AppDotUp;return this._ins};AppDotUp.prototype.PostAppDot=function(type,mainChannel,subChannel,phoneUUID,phoneModel,loginName,serverID,serverName,roleID,roleName,platId){var params=this.FinalParam0(type,mainChannel,subChannel,phoneUUID,phoneModel,loginName,serverID,serverName,roleID,roleName,platId);var request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;request.open(LoginMgr.preUrl+"login.php",egret.HttpMethod.POST);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.send(params);request.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this);request.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this);request.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)};AppDotUp.prototype.FinalParam0=function(type,mainChannel,subChannel,phoneUUID,phoneModel,loginName,serverID,serverName,roleID,roleName,platId){var dtEventTime=this.getDtEventTime();var finalplatId=this.getPlatId(platId);var param0="type=account_flow&msg=AccountFlow|"+dtEventTime+"|"+type+"|"+mainChannel+"|"+subChannel+"|"+phoneUUID+"|"+phoneModel+"|"+loginName+"|"+serverID+"|"+serverName+"|"+roleID+"|"+roleName+"|"+finalplatId;return param0};AppDotUp.prototype.getDtEventTime=function(){var curDate=new Date;var year=curDate.getFullYear();var month=curDate.getMonth()+1;var month1=month>=1&&month<=9?"0"+month:""+month;var day=curDate.getDate()>=0&&curDate.getDate()<=9?"0"+curDate.getDate():""+curDate.getDate();var hour=curDate.getHours()>=0&&curDate.getHours()<=9?"0"+curDate.getHours():""+curDate.getHours();var minute=curDate.getMinutes()>=0&&curDate.getMinutes()<=9?"0"+curDate.getMinutes():""+curDate.getMinutes();var second=curDate.getSeconds()>=0&&curDate.getSeconds()<=9?"0"+curDate.getSeconds():""+curDate.getSeconds();return year+"-"+month1+"-"+day+" "+hour+":"+minute+":"+second};AppDotUp.prototype.getPlatId=function(platId){var platId0="102";if(platId==DEVICE_OS.IOS)platId0="104";if(platId==DEVICE_OS.ANDROID)platId0="102";return platId0};AppDotUp.prototype.onPostComplete=function(){console.log("====PostAppDot,onPostComplete")};AppDotUp.prototype.onPostIOError=function(){console.log("====PostAppDot,onPostIOError")};AppDotUp.prototype.onPostProgress=function(){};return AppDotUp}();__reflect(AppDotUp.prototype,"AppDotUp");var AverageUtils=function(){function AverageUtils($maxNum){if($maxNum===void 0){$maxNum=10}this.nums=[];this.numsLen=0;this.numSum=0;this.maxNum=$maxNum}AverageUtils.prototype.push=function(value){if(this.numsLen>this.maxNum){this.numsLen--;this.numSum-=this.nums.shift()}this.nums.push(value);this.numSum+=value;this.numsLen++};AverageUtils.prototype.getValue=function(){return this.numSum/this.numsLen};AverageUtils.prototype.clear=function(){this.nums.splice(0);this.numsLen=0;this.numSum=0};return AverageUtils}();__reflect(AverageUtils.prototype,"AverageUtils");var BitStorer=function(){function BitStorer(length,fixed){if(length===void 0){length=0}if(fixed===void 0){fixed=true}this._length=length;this._storer=[]}Object.defineProperty(BitStorer.prototype,"length",{get:function(){return this._length},set:function(value){this._storer.length=value>>5},enumerable:true,configurable:true});Object.defineProperty(BitStorer.prototype,"numDirtyBits",{get:function(){var c,i,b=this._length;for(i=0;i<b;i++){if(this._storer[i>>5]&1<<i%32){c++}}return c},enumerable:true,configurable:true});Object.defineProperty(BitStorer.prototype,"dirtyBits",{get:function(){var v=[];var i;for(i=this._length-1;i>-1;i--){if(this._storer[i>>5]&1<<i%32){v[v.length]=i}}return v},enumerable:true,configurable:true});BitStorer.prototype.store=function(bytes){var i,n,b;b=this._length>>3;if(b>bytes.bytesAvailable)b=bytes.bytesAvailable;for(i=0;i<b;i++){if(i&&i%4==0){this._storer[(i>>2)-1]=n;n=0}n|=(bytes.readByte()&255)<<(i%4<<3)}if(b%4)this._storer[b>>2]=n};BitStorer.prototype.toByteArray=function(bytes,offset){if(bytes===void 0){bytes=null}if(offset===void 0){offset=0}if(!bytes)bytes=new egret.ByteArray;bytes.position=offset;var b=this._storer.length;var n;for(var i=0;i<b;i++){n=this._storer[i];for(var j=0;j<32;j+=8){bytes.writeByte(n>>j&255)}}return bytes};BitStorer.prototype.setBit=function(bit,value){if(value&1)this._storer[bit>>5]|=1<<bit%32;else this._storer[bit>>5]&=~(1<<bit%32)};BitStorer.prototype.getBit=function(bit){return this._storer[bit%this._length>>5]>>bit%32&1};return BitStorer}();__reflect(BitStorer.prototype,"BitStorer");var ColorUtil=function(){function ColorUtil(){}ColorUtil.mergeARGB=function($a,$r,$g,$b){return $a<<24|$r<<16|$g<<8|$b};ColorUtil.getChannel=function($argb,$channel){switch($channel){case this.ALPHA:return $argb>>24&255;case this.RED_COLOR_N:return $argb>>16&255;case this.GREEN_COLOR_N:return $argb>>8&255;case this.BLUE:return $argb&255}return 0};ColorUtil.numberToString=function($number,$prefix){if($prefix===void 0){$prefix="#"}return $prefix+$number.toString(16)};ColorUtil.ALPHA=4080082432;ColorUtil.BLUE=255;ColorUtil.NORMAL_COLOR=13746831;ColorUtil.RED_COLOR_N=15937822;ColorUtil.GREEN_COLOR_N=242004;ColorUtil.GRAY_COLOR2=4679029;ColorUtil.WHITE_COLOR2=298564;ColorUtil.BLUE_COLOR_N=4740980;ColorUtil.WHITE_COLOR="#D1C28F";ColorUtil.RED_COLOR="#F3311E";ColorUtil.GREEN_COLOR="#03B154";ColorUtil.GRAY_COLOR="#8B898B";ColorUtil.BLUE_COLOR="#485774";ColorUtil.COLOR_STR=["白色","绿色","紫色","橙色","红色","金色"];ColorUtil.ROLENAME_COLOR_YELLOW=16764427;ColorUtil.ROLENAME_COLOR_GREEN=242004;ColorUtil.ROLENAME_COLOR_NORMAL=242004;ColorUtil.HUNT_ITEMLIST_NAME="#fef2ad";ColorUtil.UI_ITEMNUMBER_BULE="#4A85A8";ColorUtil.UI_ITEMNUMBER_BULE_N=4883880;ColorUtil.JUEWEI_COLOR=["#e2dfd4","#03b154","#81adff","#e27dff","#ff9649","#fc5959","#ffd93f","#ffff00"];return ColorUtil}();__reflect(ColorUtil.prototype,"ColorUtil");var CommonUtils=function(_super){__extends(CommonUtils,_super);function CommonUtils(){return _super!==null&&_super.apply(this,arguments)||this}CommonUtils.addLableStrokeColor=function(lable,color,width){lable.strokeColor=color;lable.stroke=width};CommonUtils.getObjectLength=function(list){var num=0;for(var i in list){num++}return num};CommonUtils.getObjectByAttr=function(list,attrName,attrValue){for(var i in list){if(list[i][attrName]==attrValue){return list[i]}}return null};CommonUtils.getObjectByUnionAttr=function(list,attrValue,attrValue1){for(var i in list){if(i==attrValue.toString()){for(var j in list[i]){if(j==attrValue1.toString()){return list[i][j]}}}}return null};CommonUtils.copyDataHandler=function(obj){var newObj;if(obj instanceof Array){newObj=[]}else if(obj instanceof Object){newObj={}}else{return obj}var keys=Object.keys(obj);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];newObj[key]=this.copyDataHandler(obj[key])}return newObj};CommonUtils.objectToArray=function(obj){if(obj instanceof Object){obj=this.copyDataHandler(obj);var newArr=[];var keys=Object.keys(obj);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];if(obj[key])newArr.push(obj[key])}return newArr}else{return obj}};CommonUtils.lock=function(){StageUtils.ins().getStage().touchEnabled=StageUtils.ins().getStage().touchChildren=false};CommonUtils.unlock=function(){StageUtils.ins().getStage().touchEnabled=StageUtils.ins().getStage().touchChildren=true};CommonUtils.labelIsOverLenght=function(label,num){label.text=this.overLength(num)};CommonUtils.overLength=function(num){var str=null;if(num<1e5){str=Math.floor(num)+""}else if(num>1e8){num=num/1e8;num=Math.floor(num*10)/10;str=num+i18n("CommonUtils_0")}else{num=num/1e4;num=Math.floor(num*10)/10;str=num+i18n("CommonUtils_1")}return str};CommonUtils.overLength2=function(num){var str=null;if(num<1e4){str=Math.floor(num)+""}else if(num>1e8){num=num/1e8;num=Math.floor(num*10)/10;str=num+i18n("CommonUtils_0")}else{num=num/1e4;num=Math.floor(num*10)/10;str=num+i18n("CommonUtils_1")}return str};CommonUtils.overLengthChange=function(num){var str=null;if(num<1e4){str=Math.floor(num)+""}else if(num>1e8){num=num/1e8;num=Math.floor(num*10)/10;str=num+i18n("CommonUtils_2")}else{num=num/1e4;num=Math.floor(num*10)/10;str=num+i18n("CommonUtils_3")}return str};return CommonUtils}(BaseClass);__reflect(CommonUtils.prototype,"CommonUtils");var DateStyle=function(_super){__extends(DateStyle,_super);function DateStyle(format,from,to,isFormatNum){var _this=_super.call(this)||this;_this.format=[];_this.from=0;_this.to=0;_this.isFormatNum=false;_this.format=format;_this.from=from;_this.to=to;_this.isFormatNum=isFormatNum;return _this}return DateStyle}(BaseClass);__reflect(DateStyle.prototype,"DateStyle");var DateUtils=function(){function DateUtils(){}Object.defineProperty(DateUtils,"FORMAT_1",{get:function(){var _FORMAT_1=this._FORMAT_1;if(_FORMAT_1==null){_FORMAT_1=[i18n("DateUtils_0"),i18n("DateUtils_1"),i18n("DateUtils_2"),i18n("DateUtils_3"),i18n("DateUtils_4"),i18n("DateUtils_5")];this._FORMAT_1=_FORMAT_1}return _FORMAT_1},enumerable:true,configurable:true});Object.defineProperty(DateUtils,"WEEK_CN",{get:function(){var _WEEK_CN=this._WEEK_CN;if(_WEEK_CN==null){_WEEK_CN=[i18n("DateUtils_6"),i18n("DateUtils_7"),i18n("DateUtils_8"),i18n("DateUtils_9"),i18n("DateUtils_10"),i18n("DateUtils_11"),i18n("DateUtils_12")];this._WEEK_CN=_WEEK_CN}return _WEEK_CN},enumerable:true,configurable:true});Object.defineProperty(DateUtils,"STYLE_1",{get:function(){var _STYLE_1=this._STYLE_1;if(_STYLE_1==null){_STYLE_1=new DateStyle(DateUtils.FORMAT_1,DateUtils.TO_SECOND,DateUtils.TO_HOUR,false);this._STYLE_1=_STYLE_1}return _STYLE_1},enumerable:true,configurable:true});Object.defineProperty(DateUtils,"STYLE_2",{get:function(){var _STYLE_2=this._STYLE_2;if(_STYLE_2==null){_STYLE_2=new DateStyle(DateUtils.FORMAT_1,DateUtils.TO_SECOND,DateUtils.TO_DAY,false);this._STYLE_2=_STYLE_2}return _STYLE_2},enumerable:true,configurable:true});Object.defineProperty(DateUtils,"STYLE_3",{get:function(){var _STYLE_3=this._STYLE_3;if(_STYLE_3==null){_STYLE_3=new DateStyle(DateUtils.FORMAT_2,DateUtils.TO_SECOND,DateUtils.TO_HOUR,true);this._STYLE_3=_STYLE_3}return _STYLE_3},enumerable:true,configurable:true});Object.defineProperty(DateUtils,"STYLE_4",{get:function(){var _STYLE_4=this._STYLE_4;if(_STYLE_4==null){_STYLE_4=new DateStyle(DateUtils.FORMAT_1,DateUtils.TO_SECOND,DateUtils.TO_MINUTE,true);this._STYLE_4=_STYLE_4}return _STYLE_4},enumerable:true,configurable:true});DateUtils.getFormatTimeByStyle=function(second,style){if(style===void 0){style=DateUtils.STYLE_1}if(second<0){second=0;debug.log(i18n("DateUtils_13")+second)}if(style.from>style.to){debug.log(i18n("DateUtils_14"));return""}second=second>>0;var result="";for(var i=style.to;i>=style.from;i--){var time=second/this.mul[i];var timeStr="";if(i!=style.to){time=time%this.mod[i]}if(style.isFormatNum&&time<10){timeStr="0"+(time>>0).toString()}else{timeStr=(time>>0).toString()}if(style.format!=DateUtils.FORMAT_2||i!=style.from){result+=timeStr+style.format[i]}else{result+=timeStr}}return result};DateUtils.getFormatTimeByStyle1=function(ms,style){if(style===void 0){style=DateUtils.STYLE_1}return this.getFormatTimeByStyle(ms/this.MS_PER_SECOND)};DateUtils.formatMiniDateTime=function(mdt){return DateUtils.MINI_DATE_TIME_BASE+(mdt&2147483647)*DateUtils.MS_PER_SECOND};DateUtils.formatServerTime=function(time){return(time-DateUtils.MINI_DATE_TIME_BASE)/DateUtils.MS_PER_SECOND};DateUtils.getFormatBySecond=function(second,type,showLength){if(type===void 0){type=1}if(showLength===void 0){showLength=2}var str="";var ms=second*1e3;switch(type){case this.TIME_FORMAT_1:str=this.format_1(ms);break;case this.TIME_FORMAT_2:str=this.format_2(ms);break;case this.TIME_FORMAT_3:str=this.format_3(ms);break;case this.TIME_FORMAT_4:str=this.format_4(ms);break;case this.TIME_FORMAT_5:str=this.format_5(ms,showLength);break;case this.TIME_FORMAT_6:str=this.format_6(ms);break;case this.TIME_FORMAT_7:str=this.format_7(ms);break;case this.TIME_FORMAT_8:str=this.format_8(ms);break;case this.TIME_FORMAT_9:str=this.format_9(ms);break;case this.TIME_FORMAT_10:str=this.format_10(ms);break;case this.TIME_FORMAT_11:str=this.format_11(ms);break;case this.TIME_FORMAT_12:str=this.format_12(ms);break;case this.TIME_FORMAT_13:str=this.format_13(ms);break;case this.TIME_FORMAT_14:str=this.format_14(ms);break;case this.TIME_FORMAT_15:str=this.format_15(ms);break;case this.TIME_FORMAT_16:str=this.format_16(ms);break;case this.TIME_FORMAT_17:str=this.format_17(ms);break;case this.TIME_FORMAT_18:str=this.format_18(ms);break}return str};DateUtils.getRenainSecond=function(ms){var tmpDate=ms?new Date(ms):new Date;var ptime=DateUtils.getTodayZeroSecond(tmpDate)+60*60*24-tmpDate.getTime()/1e3;return ptime.toFixed(0)};DateUtils.getTodayPassedSecond=function(){var st=DateUtils.formatServerTime(GameServer.serverTime);var sec=st%(24*3600);return sec};DateUtils.getTodayZeroSecond=function(tdate){var tmpDate=tdate?tdate:new Date;return parseInt((new Date(tmpDate.getFullYear(),tmpDate.getMonth(),tmpDate.getDate()).getTime()/1e3).toFixed(0))};DateUtils.showWeekFirstDay=function(){var Nowdate=new Date;var day=Nowdate.getDay();day=day?day:7;var WeekFirstDay=new Date(Nowdate-(day-1)*864e5);return WeekFirstDay};DateUtils.showWeekLastDay=function(){var Nowdate=new Date;var WeekFirstDay=DateUtils.showWeekFirstDay();var WeekLastDay=new Date((WeekFirstDay/1e3+6*86400)*1e3);return WeekLastDay};DateUtils.calcWeekFirstDay=function(){var Nowdate=new Date;var curDay=Nowdate.getDay();curDay=curDay>0?curDay:7;var difday=7-curDay;var hours=Nowdate.getHours();var minutes=Nowdate.getMinutes();var seconds=Nowdate.getSeconds();var sum=difday*86400*1e3+86400*1e3-(hours*3600*1e3+minutes*60*1e3+seconds*1e3);return new Date(sum)};DateUtils.format_1=function(ms){var n=0;var result="##:##:##";n=Math.floor(ms/DateUtils.MS_PER_HOUR);result=result.replace("##",DateUtils.formatTimeNum(n));if(n)ms-=n*DateUtils.MS_PER_HOUR;n=Math.floor(ms/DateUtils.MS_PER_MINUTE);result=result.replace("##",DateUtils.formatTimeNum(n));if(n)ms-=n*DateUtils.MS_PER_MINUTE;n=Math.floor(ms/1e3);result=result.replace("##",DateUtils.formatTimeNum(n));return result};DateUtils.format_2=function(ms){var date=new Date(ms);var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var hours=date.getHours();var minute=date.getMinutes();var second=date.getSeconds();return year+"-"+month+"-"+day+" "+hours+":"+minute+":"+second};DateUtils.format_3=function(ms){var str=this.format_1(ms);var strArr=str.split(":");return strArr[1]+":"+strArr[2]};DateUtils.format_4=function(ms){if(ms<this.MS_PER_HOUR){return Math.floor(ms/this.MS_PER_MINUTE)+i18n("DateUtils_15")}else if(ms<this.MS_PER_DAY){return Math.floor(ms/this.MS_PER_HOUR)+i18n("DateUtils_16")}else{return Math.floor(ms/this.MS_PER_DAY)+i18n("DateUtils_17")}};DateUtils.format_5=function(ms,showLength){if(showLength===void 0){showLength=2}var result="";var unitStr=[i18n("DateUtils_18"),i18n("DateUtils_19"),i18n("DateUtils_20"),i18n("DateUtils_21")];var arr=[];var d=Math.floor(ms/this.MS_PER_DAY);arr.push(d);ms-=d*this.MS_PER_DAY;var h=Math.floor(ms/this.MS_PER_HOUR);arr.push(h);ms-=h*this.MS_PER_HOUR;var m=Math.floor(ms/this.MS_PER_MINUTE);arr.push(m);ms-=m*this.MS_PER_MINUTE;var s=Math.floor(ms/1e3);arr.push(s);for(var k in arr){if(arr[k]>0){result+=this.formatTimeNum(arr[k],Number(k))+unitStr[k];showLength--;if(showLength<=0)break}}return result};DateUtils.format_6=function(ms){var date=new Date(ms);var hours=date.getHours();var minute=date.getMinutes();var second=date.getSeconds();return this.formatTimeNum(hours)+":"+this.formatTimeNum(minute)+":"+this.formatTimeNum(second)};DateUtils.format_7=function(ms){if(ms<this.MS_PER_HOUR){return i18n("DateUtils_22")}else if(ms<this.MS_PER_DAY){return Math.floor(ms/this.MS_PER_HOUR)+i18n("DateUtils_23")}else{return Math.floor(ms/this.MS_PER_DAY)+i18n("DateUtils_24")}};DateUtils.format_8=function(time){var date=new Date(time);var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var hours=date.getHours();var minute=date.getMinutes();return year+"-"+month+"-"+day+" "+hours+":"+minute};DateUtils.format_9=function(ms){var h=Math.floor(ms/this.MS_PER_HOUR);ms-=h*this.MS_PER_HOUR;var m=Math.floor(ms/this.MS_PER_MINUTE);ms-=m*this.MS_PER_MINUTE;var s=Math.floor(ms/1e3);return h+i18n("DateUtils_25")+m+i18n("DateUtils_26")+s+i18n("DateUtils_27")};DateUtils.format_10=function(ms){var m=Math.floor(ms/this.MS_PER_MINUTE);ms-=m*this.MS_PER_MINUTE;var s=Math.floor(ms/1e3);return m+i18n("DateUtils_28")+s+i18n("DateUtils_29")};DateUtils.format_11=function(ms){var h=Math.floor(ms/this.MS_PER_HOUR);ms-=h*this.MS_PER_HOUR;var m=Math.floor(ms/this.MS_PER_MINUTE);ms-=m*this.MS_PER_MINUTE;var s=Math.floor(ms/1e3);return h+i18n("DateUtils_30")+m+i18n("DateUtils_31")+s+i18n("DateUtils_32")};DateUtils.format_12=function(ms){var h=Math.floor(ms/this.MS_PER_HOUR);ms-=h*this.MS_PER_HOUR;var m=Math.floor(ms/this.MS_PER_MINUTE);ms-=m*this.MS_PER_MINUTE;var s=Math.floor(ms/1e3);return DateUtils.formatTimeNum(h)+":"+DateUtils.formatTimeNum(m)+":"+DateUtils.formatTimeNum(s)};DateUtils.format_13=function(time){var date=new Date(time);var year=date.getFullYear();var month=date.getMonth()+1;var week=date.getDay();var day=date.getDate();var hours=date.getHours();var minute=date.getMinutes();return month+i18n("DateUtils_33")+day+i18n("DateUtils_34")+this.WEEK_CN[week]+") "+DateUtils.formatTimeNum(hours)+":"+DateUtils.formatTimeNum(minute)};DateUtils.format_14=function(time){var date=new Date(time);var hours=date.getHours();var minute=date.getMinutes();return hours+i18n("DateUtils_35")+minute+i18n("DateUtils_36")};DateUtils.format_15=function(time){var date=new Date(time);var month=date.getMonth()+1;var day=date.getDate();var hours=date.getHours();var minute=date.getMinutes();return DateUtils.formatTimeNum(month)+"-"+DateUtils.formatTimeNum(day)+" "+DateUtils.formatTimeNum(hours)+":"+DateUtils.formatTimeNum(minute)};DateUtils.format_16=function(time){var date=new Date(time);var year=date.getFullYear();var month=date.getMonth()+1;var week=date.getDay();var day=date.getDate();var hours=date.getHours();var minute=date.getMinutes();return month+i18n("DateUtils_33")+day+i18n("DateUtils_43")};DateUtils.format_17=function(time){var date=new Date(time);var hours=date.getHours();var minute=date.getMinutes();var second=date.getSeconds();return DateUtils.formatTimeNum(hours)+":"+DateUtils.formatTimeNum(minute)+":"+DateUtils.formatTimeNum(second)};DateUtils.format_18=function(time){var date=new Date(time);var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var hours=date.getHours();var minute=date.getMinutes();var second=date.getSeconds();return year+DateUtils.formatTimeNum(month)+DateUtils.formatTimeNum(day)+DateUtils.formatTimeNum(hours)+DateUtils.formatTimeNum(minute)+DateUtils.formatTimeNum(second)};DateUtils.formatTimeNum=function(t,k){return t>=10?t.toString():k==0?t.toString():"0"+t};DateUtils.checkTime=function(time,days){var currentDate=(new Date).getTime();var t=time>currentDate+days*this.MS_PER_DAY;return t};DateUtils.formatFullTime=function(time){var format;var date=new Date(time);var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var weekDay=date.getDay();var hour=date.getHours();var hourStr;if(hour<10){hourStr="0"+hour}else{hourStr=hour.toString()}var min=date.getMinutes();var minStr;if(min<10){minStr="0"+min}else{minStr=min.toString()}var weekDayStr;switch(weekDay){case 1:weekDayStr=i18n("DateUtils_37");break;case 2:weekDayStr=i18n("DateUtils_38");break;case 3:weekDayStr=i18n("DateUtils_39");break;case 4:weekDayStr=i18n("DateUtils_40");break;case 5:weekDayStr=i18n("DateUtils_41");break;case 6:weekDayStr=i18n("DateUtils_42");break;case 0:weekDayStr=i18n("DateUtils_43");break}format=year+i18n("DateUtils_44")+month+i18n("DateUtils_45")+day+i18n("DateUtils_46")+weekDayStr+"） "+hourStr+":"+minStr;return format};DateUtils.formatStrTimeToMs=function(str){var date=new Date;var strList=str.split(".");date.setFullYear(strList[0]);date.setMonth(+strList[1]-1);var strL2=strList[2].split("-");date.setDate(strL2[0]);var strL3=strL2[1].split(":");date.setHours(strL3[0]);date.setMinutes(strL3[1]);date.setSeconds(0);return date.getTime()};DateUtils.TIME_FORMAT_1=1;DateUtils.TIME_FORMAT_2=2;DateUtils.TIME_FORMAT_3=3;DateUtils.TIME_FORMAT_4=4;DateUtils.TIME_FORMAT_5=5;DateUtils.TIME_FORMAT_6=6;DateUtils.TIME_FORMAT_7=7;DateUtils.TIME_FORMAT_8=8;DateUtils.TIME_FORMAT_9=9;DateUtils.TIME_FORMAT_10=10;DateUtils.TIME_FORMAT_11=11;DateUtils.TIME_FORMAT_12=12;DateUtils.TIME_FORMAT_13=13;DateUtils.TIME_FORMAT_14=14;DateUtils.TIME_FORMAT_15=15;DateUtils.TIME_FORMAT_16=16;DateUtils.TIME_FORMAT_17=17;DateUtils.TIME_FORMAT_18=18;DateUtils.MS_PER_SECOND=1e3;DateUtils.MS_PER_MINUTE=60*1e3;DateUtils.MS_PER_HOUR=60*60*1e3;DateUtils.MS_PER_DAY=24*60*60*1e3;DateUtils.SECOND_PER_HOUR=3600;DateUtils.SECOND_PER_DAY=86400;DateUtils.SECOND_PER_MONTH=2592e3;DateUtils.SECOND_PER_YEAR=31104e3;DateUtils.DAYS_PER_WEEK=7;DateUtils.YEAR_PER_YEAR=1;DateUtils.MONTH_PER_YEAR=12;DateUtils.DAYS_PER_MONTH=30;DateUtils.HOURS_PER_DAY=24;DateUtils.MUNITE_PER_HOUR=60;DateUtils.SECOND_PER_MUNITE=60;DateUtils.SECOND_PER_SECOND=1;DateUtils.SECOND_2010=1262275200;DateUtils.mod=[DateUtils.SECOND_PER_MUNITE,DateUtils.MUNITE_PER_HOUR,DateUtils.HOURS_PER_DAY,DateUtils.DAYS_PER_MONTH,DateUtils.MONTH_PER_YEAR,DateUtils.YEAR_PER_YEAR];DateUtils.mul=[DateUtils.SECOND_PER_SECOND,DateUtils.SECOND_PER_MUNITE,DateUtils.SECOND_PER_HOUR,DateUtils.SECOND_PER_DAY,DateUtils.SECOND_PER_MONTH,DateUtils.SECOND_PER_YEAR];DateUtils.MINI_DATE_TIME_BASE=Date.UTC(2010,0)+(new Date).getTimezoneOffset()*DateUtils.MS_PER_MINUTE;DateUtils.TIME_ZONE_OFFSET=8*DateUtils.MS_PER_HOUR;DateUtils.TO_SECOND=0;DateUtils.TO_MINUTE=1;DateUtils.TO_HOUR=2;DateUtils.TO_DAY=3;DateUtils.TO_MONTH=4;DateUtils.TO_YEAR=5;DateUtils.FORMAT_2=[":",":",":",":",":",":"];return DateUtils}();__reflect(DateUtils.prototype,"DateUtils");var DebugUtils=function(){function DebugUtils(){}DebugUtils.isOpen=function(flag){this._isOpen=flag};Object.defineProperty(DebugUtils,"isDebug",{get:function(){return window["isDebug"]?window["isDebug"]:false},enumerable:true,configurable:true});DebugUtils.log=function(msg){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}if(DebugUtils.isDebug){egret.log(msg,param)}};DebugUtils.warn=function(msg){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}if(DebugUtils.isDebug){egret.warn(msg,param)}};DebugUtils.error=function(msg){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}egret.error(msg,param)};DebugUtils.start=function(key){if(!this._isOpen){return}this._startTimes[key]=egret.getTimer()};DebugUtils.stop=function(key){if(!this._isOpen){return 0}if(!this._startTimes[key]){return 0}var cha=egret.getTimer()-this._startTimes[key];if(cha>this._threshold){Log.trace(key+": "+cha)}return cha};DebugUtils.setThreshold=function(value){this._threshold=value};DebugUtils._startTimes={};DebugUtils._threshold=3;return DebugUtils}();__reflect(DebugUtils.prototype,"DebugUtils");var debug=window["debug"]={log:DebugUtils.log,warn:DebugUtils.warn,error:DebugUtils.error};var DeviceUtils=function(){function DeviceUtils(){}Object.defineProperty(DeviceUtils,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"IsMobile",{get:function(){return egret.Capabilities.isMobile},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"IsPC",{get:function(){return!egret.Capabilities.isMobile},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"IsQQBrowser",{get:function(){return this.IsHtml5&&navigator.userAgent.indexOf("MQQBrowser")!=-1},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"IsIEBrowser",{get:function(){return this.IsHtml5&&navigator.userAgent.indexOf("MSIE")!=-1},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"IsFirefoxBrowser",{get:function(){return this.IsHtml5&&navigator.userAgent.indexOf("Firefox")!=-1},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"IsChromeBrowser",{get:function(){return this.IsHtml5&&navigator.userAgent.indexOf("Chrome")!=-1},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"IsSafariBrowser",{get:function(){return this.IsHtml5&&navigator.userAgent.indexOf("Safari")!=-1},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"IsOperaBrowser",{get:function(){return this.IsHtml5&&navigator.userAgent.indexOf("Opera")!=-1},enumerable:true,configurable:true});Object.defineProperty(DeviceUtils,"deviceOS",{get:function(){var curOS=-1;if(egret.Capabilities.os=="iOS"){curOS=DEVICE_OS.IOS}else if(egret.Capabilities.os=="Android"){curOS=DEVICE_OS.ANDROID}return curOS},enumerable:true,configurable:true});return DeviceUtils}();__reflect(DeviceUtils.prototype,"DeviceUtils");var DEVICE_OS;(function(DEVICE_OS){DEVICE_OS[DEVICE_OS["IOS"]=0]="IOS";DEVICE_OS[DEVICE_OS["ANDROID"]=1]="ANDROID"})(DEVICE_OS||(DEVICE_OS={}));window["DEVICE_OS"]=DEVICE_OS;var DirUtil=function(){function DirUtil(){}DirUtil.get8DirBy2Point=function(p1,p2){var angle=MathUtils.getAngle(MathUtils.getRadian2(p1.x,p1.y,p2.x,p2.y));return this.angle2dir(angle)};DirUtil.get4DirBy2Point=function(p1,p2){return p1.x<p2.x?p1.y<p2.y?3:1:p1.y<p2.y?5:7};DirUtil.dir2angle=function(dir){dir*=45;dir-=90;return dir};DirUtil.angle2dir=function(angle){if(angle<-90)angle+=360;return Math.round((angle+90)/45)%8};DirUtil.dirOpposit=function(dir){return dir<4?dir+4:dir-4};DirUtil.get5DirBy8Dir=function(dir8){return dir8-this.isScaleX(dir8)};DirUtil.isScaleX=function(dir8){var td=2*(dir8-4);if(td<0)td=0;return td};DirUtil.getGridByDir=function(dir,pos,p){if(pos===void 0){pos=1}if(p===void 0){p={x:0,y:0}}var angle=this.dir2angle(this.dirOpposit(dir));return MathUtils.getDirMove(angle,pos*GameMap.CELL_SIZE,p.x,p.y)};return DirUtil}();__reflect(DirUtil.prototype,"DirUtil");var DisplayUtils=function(){function DisplayUtils(){}DisplayUtils.setShakeOn=function($on){this.openShake=$on};DisplayUtils.createBitmap=function(resName){var result=new egret.Bitmap;var texture=RES.getRes(resName);result.texture=texture;return result};DisplayUtils.createEuiImage=function(resName){var result=new eui.Image;var texture=RES.getRes(resName);result.source=texture;return result};DisplayUtils.removeFromParent=function(child){if(!child||child.parent==null)return;child.parent.removeChild(child)};DisplayUtils.shakeIt=function(target,range,duration,times,condition){if(times===void 0){times=1}if(condition===void 0){condition=function(){return true}}if(!this.openShake||!target||times<1||!condition())return;var shakeSet=[{anchorOffsetX:0,anchorOffsetY:-range},{anchorOffsetX:0,anchorOffsetY:+range},{anchorOffsetX:0,anchorOffsetY:0}];var delay=duration/shakeSet.length;egret.Tween.get(target).to(shakeSet[0],delay).to(shakeSet[1],delay).to(shakeSet[2],delay).call(function(){DisplayUtils.shakeIt(target,range,duration,--times)},this)};DisplayUtils.shakeItHeji=function(target,range,duration,times,condition){if(times===void 0){times=1}if(condition===void 0){condition=function(){return true}}if(!this.openShake||!target||times<1||!condition())return;var shakeSet=[{anchorOffsetX:+range*.1,anchorOffsetY:+range},{anchorOffsetX:-range*.1,anchorOffsetY:-range},{anchorOffsetX:+range*.1,anchorOffsetY:+range},{anchorOffsetX:-range*.1,anchorOffsetY:-range},{anchorOffsetX:(+range>>1)*.1,anchorOffsetY:+range>>1},{anchorOffsetX:(-range>>1)*.1,anchorOffsetY:-range>>1},{anchorOffsetX:(+range>>2)*.1,anchorOffsetY:+range>>2},{anchorOffsetX:0,anchorOffsetY:0}];var delay=duration/shakeSet.length;egret.Tween.get(target).to(shakeSet[0],delay).to(shakeSet[1],delay).to(shakeSet[2],delay).to(shakeSet[3],delay).to(shakeSet[4],delay).to(shakeSet[5],delay).to(shakeSet[6],delay).to(shakeSet[7],delay).call(function(){DisplayUtils.shakeIt(target,range,duration,--times)},this)};DisplayUtils.shakeItEntity=function(target,range,duration,times,condition){var _this=this;if(times===void 0){times=1}if(condition===void 0){condition=function(){return true}}if(!this.openShake||!target||times<1||!condition())return;var shakeSet=[{anchorOffsetX:0,anchorOffsetY:-range},{anchorOffsetX:-range,anchorOffsetY:0},{anchorOffsetX:range,anchorOffsetY:0},{anchorOffsetX:0,anchorOffsetY:range},{anchorOffsetX:0,anchorOffsetY:0}];var delay=duration/5;egret.Tween.get(target).to(shakeSet[0],delay).to(shakeSet[1],delay).to(shakeSet[2],delay).to(shakeSet[3],delay).to(shakeSet[4],delay).call(function(){_this.shakeIt(target,range,duration,--times)},this)};DisplayUtils.drawCir=function(shape,radius,angle,anticlockwise){if(shape==null){shape=new egret.Shape}function changeGraphics(){shape.graphics.clear();shape.graphics.beginFill(65535,1);shape.graphics.moveTo(0,0);shape.graphics.lineTo(radius,0);shape.graphics.drawArc(0,0,radius,0,angle*Math.PI/180,anticlockwise);shape.graphics.lineTo(0,0);shape.graphics.endFill()}changeGraphics();return shape};DisplayUtils.drawrect=function(shape,width,height,anticlockwise){if(shape==null){shape=new egret.Shape}function changeGraphics(){shape.graphics.clear();shape.graphics.beginFill(65535,1);shape.graphics.drawRect(0,0,width,height);shape.graphics.endFill()}changeGraphics();return shape};DisplayUtils.getEffectPath=function(effectName){return RES_DIR_EFF+effectName};DisplayUtils.scrollerToBottom=function(scroller){scroller.viewport.validateNow();if(scroller.viewport.contentHeight>scroller.height){scroller.viewport.scrollV=scroller.viewport.contentHeight-scroller.height}};DisplayUtils.openShake=true;DisplayUtils.shakingList={};return DisplayUtils}();__reflect(DisplayUtils.prototype,"DisplayUtils");var EmbededWebPage=function(_super){__extends(EmbededWebPage,_super);function EmbededWebPage(){var _this=_super.call(this)||this;_this.checkUrlTimerKey=-1;return _this}EmbededWebPage.getAgentInfo=function(){var _AgentInfo={platform:"",deviceType:"",OSname:"",browserName:"",browserVer:"",adaptType:0,_init:function(){_AgentInfo.setDeviceAndOS();_AgentInfo.setBrowser()},setDeviceAndOS:function(){var name="unknown";var platform="android";if(window.navigator.userAgent.indexOf("Android")!=-1){name="Android";platform="android"}else if(window.navigator.userAgent.indexOf("iPhone")!=-1){name="iPhone";platform="ios"}else if(window.navigator.userAgent.indexOf("SymbianOS")!=-1){name="SymbianOS";platform="symbian"}else if(window.navigator.userAgent.indexOf("Windows Phone")!=-1){name="Windows Phone";platform="winphone"}else if(window.navigator.userAgent.indexOf("iPad")!=-1){name="iPad";platform="ios"}else if(window.navigator.userAgent.indexOf("iPod")!=-1){name="iPod";platform="ios"}if(name!="unknown"){_AgentInfo.OSname=name;_AgentInfo.deviceType="mobile";_AgentInfo.platform=platform;return}if(window.navigator.userAgent.indexOf("Windows NT 10.0")!=-1){name="Windows 10";platform="win"}else if(window.navigator.userAgent.indexOf("Windows NT 6.2")!=-1){name="Windows 8";platform="win"}else if(window.navigator.userAgent.indexOf("Windows NT 6.1")!=-1){name="Windows 7";platform="win"}else if(window.navigator.userAgent.indexOf("Windows NT 6.0")!=-1){name="Windows Vista";platform="win"}else if(window.navigator.userAgent.indexOf("Windows NT 5.1")!=-1){name="Windows XP";platform="win"}else if(window.navigator.userAgent.indexOf("Windows NT 5.0")!=-1){name="Windows 2000";platform="win"}else if(window.navigator.userAgent.indexOf("Mac")!=-1){name="Mac/iOS";platform="mac"}else if(window.navigator.userAgent.indexOf("X11")!=-1){name="UNIX";platform="unix"}else if(window.navigator.userAgent.indexOf("Linux")!=-1){name="Linux";platform="linux"}_AgentInfo.OSname=name;_AgentInfo.deviceType="pc";_AgentInfo.platform=platform},setBrowser:function(){var nAgt=navigator.userAgent;var browserName=navigator.appName;var fullVersion=""+parseFloat(navigator.appVersion);var majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if((verOffset=nAgt.indexOf("Opera"))!=-1){browserName="Opera";fullVersion=nAgt.substring(verOffset+6);if((verOffset=nAgt.indexOf("Version"))!=-1)fullVersion=nAgt.substring(verOffset+8)}else if(nAgt.indexOf("Trident")!=-1){if((verOffset=nAgt.indexOf("MSIE"))!=-1){fullVersion=nAgt.substring(verOffset+5)}else{fullVersion="11.0"}if(fullVersion=="5"){fullVersion="11.0"}browserName="IE"}else if((verOffset=nAgt.indexOf("Chrome"))!=-1){browserName="Chrome";fullVersion=nAgt.substring(verOffset+7)}else if((verOffset=nAgt.indexOf("Safari"))!=-1){browserName="Safari";fullVersion=nAgt.substring(verOffset+7);if((verOffset=nAgt.indexOf("Version"))!=-1)fullVersion=nAgt.substring(verOffset+8)}else if((verOffset=nAgt.indexOf("Firefox"))!=-1){browserName="Firefox";fullVersion=nAgt.substring(verOffset+8)}else if((nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))){browserName=nAgt.substring(nameOffset,verOffset);fullVersion=nAgt.substring(verOffset+1);if(browserName.toLowerCase()==browserName.toUpperCase()){browserName=navigator.appName}}if((ix=fullVersion.indexOf(";"))!=-1)fullVersion=fullVersion.substring(0,ix);if((ix=fullVersion.indexOf(" "))!=-1)fullVersion=fullVersion.substring(0,ix);majorVersion=parseInt(""+fullVersion,10);if(isNaN(majorVersion)){fullVersion=""+parseFloat(navigator.appVersion);majorVersion=parseInt(navigator.appVersion,10)}_AgentInfo.browserName=browserName;_AgentInfo.browserVer=fullVersion},isMobile:function(){if(_AgentInfo.deviceType=="mobile"){return true}return false},setAdaptType:function(){if(screen.width<=374){_AgentInfo.adaptType=0}else if(screen.width<=413){_AgentInfo.adaptType=1}else{_AgentInfo.adaptType=2}}};_AgentInfo._init();return _AgentInfo};EmbededWebPage.prototype.popIFrame=function(url,params){var w="100%",h="70%",x="0%",y="15%";var self=this;var bg=document.createElement("div");bg.id="CQIFrameBg";bg.style.backgroundColor="Black";bg.style.display="block";bg.style.zIndex="3";bg.style.position="absolute";bg.style.left="0%";bg.style.top="0%";bg.style.width="100%";bg.style.height="100%";bg.style.filter="Alpha(Opacity=30)";bg.style.opacity="0.4";document.body.appendChild(bg);var iframe=document.createElement("iframe");iframe.width=w;iframe.height=h;iframe.id="CQIFrame";iframe.name="CQIFrame";iframe.style.position="absolute";iframe.style.zIndex="4";iframe.style.left=x;iframe.style.top=y;iframe.frameBorder="no";iframe.marginHeight="0";iframe.marginWidth="0";document.body.appendChild(iframe);var form=document.createElement("form");form.id="CQForm";form.method="POST";form.action=url;form.target="CQIFrame";form.style.display="hidden";if(params!=null){for(var k in params){var v=params[k];var input=document.createElement("input");input.type="hidden";input.name=k;input.value=v;form.appendChild(input)}}document.body.appendChild(form);form.submit();var normalizedWidth=document.body.clientWidth;if(document.body.clientWidth/document.body.clientHeight>580/930){normalizedWidth=document.body.clientHeight*580/930}var normalizedHeight=normalizedWidth*930/580;var btnwPercent=normalizedWidth*.1/document.body.clientWidth;var btnhPercent=normalizedWidth*.1/document.body.clientHeight;var closeBtn=document.createElement("div");closeBtn.id="CQIFrameCloseBtn";closeBtn.style.backgroundColor="#a995b4";closeBtn.style.display="block";closeBtn.style.zIndex="3";closeBtn.style.position="absolute";closeBtn.style.left=""+(1-btnwPercent)*100+"%";closeBtn.style.top=""+(.15-btnhPercent)*100+"%";closeBtn.style.width=""+btnwPercent*100+"%";closeBtn.style.height=""+btnhPercent*100+"%";closeBtn.style.borderRadius=""+Math.floor(normalizedWidth*.02+.5)+"px";closeBtn.style.color="White";closeBtn.style.textAlign="center";closeBtn.style.lineHeight=""+Math.floor(normalizedWidth*.1+.5)+"px";closeBtn.innerText="✕";closeBtn.style.fontSize=""+Math.floor(normalizedWidth*.07+.5)+"px";document.body.appendChild(closeBtn);var closeIFrame=function(){iframe.parentNode.removeChild(iframe);bg.parentNode.removeChild(bg);form.parentNode.removeChild(form);closeBtn.parentNode.removeChild(closeBtn);self.closeIFrame=null;egret.clearTimeout(self.checkUrlTimerKey)};self.closeIFrame=closeIFrame;bg.onclick=function(){closeIFrame()};closeBtn.onclick=function(){closeIFrame()}};Object.defineProperty(EmbededWebPage,"instance",{get:function(){if(this.s_instance==null){this.s_instance=new EmbededWebPage}return this.s_instance},enumerable:true,configurable:true});return EmbededWebPage}(egret.EventDispatcher);__reflect(EmbededWebPage.prototype,"EmbededWebPage");var FilterUtil=function(){function FilterUtil(){}Object.defineProperty(FilterUtil,"grayFilter",{get:function(){return new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])},enumerable:true,configurable:true});Object.defineProperty(FilterUtil,"grayFilter1",{get:function(){return new egret.ColorMatrixFilter([.3086,.5,.082,0,0,.3086,.5,.082,0,0,.3086,.5,.082,0,0,0,0,0,1,0])},enumerable:true,configurable:true});Object.defineProperty(FilterUtil,"ARRAY_GRAY_FILTER",{get:function(){return[FilterUtil.grayFilter1]},enumerable:true,configurable:true});Object.defineProperty(FilterUtil,"greenFilter",{get:function(){return new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,100,0,0,1,0,0,0,0,0,1,0])},enumerable:true,configurable:true});Object.defineProperty(FilterUtil,"greenFilter1",{get:function(){return new egret.ColorMatrixFilter([.1,0,0,0,0,0,.80078125,0,0,20,0,0,-1,0,0,0,0,0,1,0])},enumerable:true,configurable:true});Object.defineProperty(FilterUtil,"ARRAY_GREEN_FILTER",{get:function(){return[FilterUtil.greenFilter1]},enumerable:true,configurable:true});Object.defineProperty(FilterUtil,"blurFilter",{get:function(){return new egret.BlurFilter(10,10,2)},enumerable:true,configurable:true});Object.defineProperty(FilterUtil,"ARRAY_BLUR_FILTER",{get:function(){return[FilterUtil.blurFilter]},enumerable:true,configurable:true});return FilterUtil}();__reflect(FilterUtil.prototype,"FilterUtil");var FixUtil=function(){function FixUtil(){}FixUtil.fixAll=function(){FixUtil.fixEXMLParser();FixUtil.fixComponentSkinName();FixUtil.fixRemoveDisplayObject();FixUtil.fixRESLoadPriority()};FixUtil.popMaxPriorityItem=function(list){var maxPriority=-9999;var maxItem=null;var maxIdx=0;for(var i=list.length-1;i>=0;--i){var item=list[i];var priority=FixUtil.getItemPriority(item);if(priority>maxPriority){maxPriority=priority;maxItem=item;maxIdx=i}}list.splice(maxIdx,1);return maxItem};FixUtil.getItemPriority=function(item){var cachedPriority=item["__cachedPri"];if(cachedPriority!=null){return cachedPriority}var priority=0;var itemUrl=item.url;var fileCached=window["smallGameFileCached"];if(typeof fileCached!="undefined"){if(fileCached(itemUrl)){priority=99;item["__cachedPri"]=priority;return priority}}for(var _i=0,_a=FixUtil.priorityCfgs;_i<_a.length;_i++){var cfg=_a[_i];var preffix=cfg[0];var suffix=cfg[1];var pri=cfg[2];if(preffix!=null&&itemUrl.length>=preffix.length&&itemUrl.indexOf(preffix)!=0){continue}if(suffix!=null&&itemUrl.length>=suffix.length&&itemUrl.lastIndexOf(suffix)!=itemUrl.length-suffix.length){continue}priority=pri;break}item["__cachedPri"]=priority;return priority};FixUtil.fixRESLoadPriority=function(){var getOneResourceItem=function(){if(this.failedList.length>0){var now=egret.getTimer();var failedList=this.failedList;for(var i=0,c=failedList.length;i<c;++i){var failedItem=failedList[i];if(failedItem.retryTick<=now){failedList.splice(i,1);return failedItem}}}var maxPriority=Number.NEGATIVE_INFINITY;for(var p in this.priorityQueue){maxPriority=Math.max(maxPriority,p)}var queue=this.priorityQueue[maxPriority];if(!queue||queue.length==0){if(this.lazyLoadList.length==0)return null;return FixUtil.popMaxPriorityItem(this.lazyLoadList)}var length=queue.length;var list;for(var i=0;i<length;i++){if(this.queueIndex>=length)this.queueIndex=0;list=this.itemListDic[queue[this.queueIndex]];if(list.length>0)break;this.queueIndex++}if(list.length==0)return null;return list.shift()};RES.ResourceLoader.prototype["getOneResourceItem"]=getOneResourceItem;var noResObj={};var old_onItemComplete=RES.ResourceLoader.prototype["onItemComplete"];var retryAfterTicks=[1,1,1,2,2,2,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20];var onItemComplete=function(resItem){this.maxRetryTimes=retryAfterTicks.length;var groupName=resItem.groupName;if(!resItem.loaded){var times=this.retryTimesDic[resItem.name]||1;if(times==1){var opuis=AutoTestMgr.ins().getOperatableTopUIs();var __opuis_name="";for(var _i=0,opuis_1=opuis;_i<opuis_1.length;_i++){var opui=opuis_1[_i];__opuis_name+="-"+opui["__class__"]}resItem["__opuis_name"]=__opuis_name}if(times<=this.maxRetryTimes){resItem.retryTick=egret.getTimer()+1e3*retryAfterTicks[times-1]}if(times==this.maxRetryTimes){var request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;request.open(LoginMgr.preUrl+"login.php",egret.HttpMethod.POST);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var params="type=client_source_log&msg="+resItem.name+(resItem["__opuis_name"]||"");request.send(params);noResObj["curReq"]=request}}old_onItemComplete.apply(this,[resItem])};RES.ResourceLoader.prototype["onItemComplete"]=onItemComplete;var old_next=RES.ResourceLoader.prototype["next"];var next=function(){old_next.apply(this);if(this.loadingCount<this.thread){if(this.failedList.length>0){TimerManager.ins().doTimer(200,1,this.next,this)}}};RES.ResourceLoader.prototype["next"]=next};FixUtil.fixRemoveDisplayObject=function(){var removeDisplayObject=function(displayObject,bitmapData){if(!bitmapData)return;var hashCode;if(bitmapData.bitmapData&&bitmapData.bitmapData.hashCode){hashCode=bitmapData.bitmapData.hashCode}else{hashCode=bitmapData.hashCode}if(!hashCode){return}if(!egret.BitmapData["_displayList"][hashCode]){return}var tempList=egret.BitmapData["_displayList"][hashCode];var index=tempList.indexOf(displayObject);if(index>=0){tempList.splice(index,1)}if(tempList.length==0){ResourceMgr.ins().disposeResTime(hashCode)}};egret.BitmapData.$removeDisplayObject=removeDisplayObject};FixUtil.parseSkinName=function(skinName){var exmlsDic=FixUtil.exmlsDic;if(exmlsDic&&exmlsDic.hasOwnProperty(skinName)){var obj=exmlsDic[skinName];delete exmlsDic[skinName];EXML.$parseURLContent(obj.path,obj.content)}};FixUtil.fixComponentSkinName=function(){var $parseSkinName=eui.Component.prototype.$parseSkinName;eui.Component.prototype.$parseSkinName=function(){var skinName=this.skinName;if(typeof skinName=="string"){FixUtil.parseSkinName(skinName)}$parseSkinName.call(this)}};FixUtil.fixLoadThm=function(){var exmlsDic=FixUtil.exmlsDic={};var setSkinClassName=function(path,content){var match=content.match(/ class="([^"]*)"/i);if(false&&exmlsDic[match[1]]){alert(i18n("FixUtil_0",exmlsDic[match[1]].path,path))}exmlsDic[match[1]]={path:path,content:content}};eui.Theme.prototype["onConfigLoaded"]=function(str){var data;if(typeof str=="string"){try{data=JSON.parse(str)}catch(e){egret.$error(3e3)}}else{data=str}if(!data){alert(i18n("FixUtil_1")+this.$configURL);return}if(data&&data.skins){var skinMap=this.skinMap;var skins=data.skins;var keys=Object.keys(skins);var length_27=keys.length;for(var i=0;i<length_27;i++){var key=keys[i];if(!skinMap[key]){this.mapSkin(key,skins[key])}}}if(data.styles){this.$styles=data.styles}var paths=data.paths;for(var path in paths){EXML.update(path,paths[path])}if(!data.exmls||data.exmls.length==0){this.onLoaded()}else if(data.exmls[0]["gjs"]){data.exmls.forEach(function(exml){return EXML.$parseURLContentAsJs(exml.path,exml.gjs,exml.className)});this.onLoaded()}else if(data.exmls[0]["content"]){data.exmls.forEach(function(exml){return EXML.$parseURLContent(exml.path,exml.content)});this.onLoaded()}else{EXML.$loadAll(data.exmls,this.onLoaded,this,true)}}};FixUtil.preParserExml=function(){var prelist=["skins.ButtonSkin","skins.CheckBoxSkin","skins.HScrollBarSkin","skins.HSliderSkin","skins.ItemRendererSkin","skins.PanelSkin","skins.ProgressBarSkin","skins.RadioButtonSkin","skins.ScrollerSkin","skins.TextInputSkin","skins.ToggleSwitchSkin","skins.VScrollBarSkin","skins.VSliderSkin","PlayFunSkin","UIView2Skin","GameFightSceneSkin"];for(var _i=0,prelist_1=prelist;_i<prelist_1.length;_i++){var skinName=prelist_1[_i];FixUtil.parseSkinName(skinName)}};FixUtil.fixEXMLParser=function(){var EXMLParser=eui.sys.EXMLParser;EXMLParser.prototype["getClassNameOfNode1"]=function(node){if(node.attributes&&node.attributes["className"]){var Cls=egret.getDefinitionByName(node.attributes["className"]);if(Cls){if(node.parent&&node.parent.localName=="ViewStack"){if(node.attributes["skinName"]){this.addInitSkin(Cls,node.attributes["skinName"]);delete node.attributes["skinName"]}}return node.attributes["className"]}}return this["getClassNameOfNode"](node)};EXMLParser.prototype["addInitSkin"]=function(cls,skinName){var proto=cls.prototype;if(!proto.__skinName_1){proto.__skinName_1=skinName;var close_2=proto.close;if(close_2){proto.close_1=close_2;proto.close=function(){if(this.skinName){this.close_1()}};close_2=null}var open_2=proto.open;if(open_2){proto.open_1=open_2;proto.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(false){if(!this.skinName){this.$initSkin()}else if(!this.$isInitSkin){var clsName=egret.getQualifiedClassName(this);console.log(i18n("FixUtil_2",clsName))}}else{if(!this.$isInitSkin){this.$initSkin()}}this.open_1.apply(this,param)};open_2=null}var childrenCreated=proto.childrenCreated;if(childrenCreated){proto.childrenCreated_1=childrenCreated;proto.childrenCreated=function(){};childrenCreated=null}var initSkin=proto["$initSkin"];if(false&&initSkin){console.log(i18n("FixUtil_3"))}proto["$initSkin"]=function(){this.skinName=this.__skinName_1;this.$isInitSkin=true;this.childrenCreated_1()}}};EXMLParser.prototype["createFuncForNode"]=function(node){var className=node.localName;var isBasicType=this.isBasicTypeData(className);if(isBasicType)return this.createBasicTypeForNode(node);var moduleName=this.getClassNameOfNode1(node);var func=new eui.sys.EXFunction;var tailName="_i";var id=node.attributes.id;func.name=id+tailName;this.currentClass.addFunction(func);var cb=new eui.sys.EXCodeBlock;func.codeBlock=cb;var varName="t";if(className=="Object"){cb.addVar(varName,"{}")}else{cb.addVar(varName,"new "+moduleName+"()")}var containsId=!!this.currentClass.getVariableByName(id);if(containsId){cb.addAssignment("this."+id,varName)}this.addAttributesToCodeBlock(cb,varName,node);this.initlizeChildNode(node,cb,varName);var delayAssignments=this.delayAssignmentDic[id];if(delayAssignments){var length_2=delayAssignments.length;for(var i=0;i<length_2;i++){var codeBlock=delayAssignments[i];cb.concat(codeBlock)}}cb.addReturn(varName);return"this."+func.name+"()"};var formatValue=EXMLParser.prototype["formatValue"];EXMLParser.prototype["formatValue"]=function(key,value,node){if(key=="itemRendererSkinName"){return this["formatString"](value)}return formatValue.call(this,key,value,node)};var innerClassCount=1;EXMLParser.prototype.parse=function(text){if(false){if(!text){egret.$error(1003,"text")}}var xmlData=null;if(false){try{xmlData=egret.XML.parse(text)}catch(e){egret.$error(2002,text+"\n"+e.message)}}else{xmlData=egret.XML.parse(text)}var hasClass=false;var className="";if(xmlData.attributes["class"]){className=xmlData.attributes["class"];delete xmlData.attributes["class"];hasClass=!!className}else{className="$exmlClass_"+innerClassCount++}var exClass=this.parseClass(xmlData,className);var code=exClass.toCode();var clazz=null;var geval=eval;if(false){try{clazz=geval(code)}catch(e){egret.log(code);return null}}else{clazz=geval(code)}if(hasClass&&clazz){egret.registerClass(clazz,className);var paths=className.split(".");var length_3=paths.length;var definition=__global;for(var i=0;i<length_3-1;i++){var path=paths[i];definition=definition[path]||(definition[path]={})}if(definition[paths[length_3-1]]){}else{definition[paths[length_3-1]]=clazz}}xmlData=undefined;className=undefined;code=undefined;exClass=undefined;geval=undefined;text=undefined;return clazz};EXMLParser=undefined};FixUtil.priorityCfgs=[["resource/map/","small.jpg",5],["resource/res/skill/",".json",5],["resource/image/public/zjmIcon/",null,4],["resource/image/public/zjm.json",null,3],["resource/image/public/zjm.png",null,3],["resource/image/public/zjm2.json",null,3],["resource/image/public/zjm2.png",null,3],["resource/res/body/",null,2],["resource/res/monster/",null,1]];return FixUtil}();__reflect(FixUtil.prototype,"FixUtil");var FrameRateAdapter=function(){function FrameRateAdapter(){}FrameRateAdapter.init=function(){if(this.inited){return}this.inited=true;var stage=StageUtils.ins().getStage();stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this);stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);TimerManager.ins().doTimer(1e3,0,this.onTimer,this)};FrameRateAdapter.setIsFast=function(fast){if(this.isFast!=fast){StageUtils.ins().setFrameRate(fast?30:15);this.isFast=fast;console.log("isFast = "+fast.toString());var self=this;LoginMgr.getItem("LYTJ_FRAMERATE_SHOWN",function(v){if(!fast){if(v!="1"){WarnWin.show(i18n("FrameRateAdpater_0"),function(){},this,undefined,undefined,"sure");LoginMgr.setItem("LYTJ_FRAMERATE_SHOWN","1")}else{UserTips.ins().showTips(i18n("FrameRateAdpater_1"))}}else{UserTips.ins().showTips(i18n("FrameRateAdpater_2"))}})}};FrameRateAdapter.onTimer=function(){this.secondsLeft--;if(this.secondsLeft<=0){this.secondsLeft=0;this.setIsFast(false)}};FrameRateAdapter.onTouch=function(){this.secondsLeft=this.HOLD_SECONDS;this.setIsFast(true)};FrameRateAdapter.HOLD_SECONDS=60;FrameRateAdapter.secondsLeft=60;FrameRateAdapter.isFast=true;FrameRateAdapter.inited=false;return FrameRateAdapter}();__reflect(FrameRateAdapter.prototype,"FrameRateAdapter");var deepCopy=window["deepCopy"]=function(o,copyProto){if(o instanceof Array){var n=[];for(var i=0;i<o.length;++i){n[i]=deepCopy(o[i])}return n}else if(o instanceof Object){var nn={};for(var ii in o){nn[ii]=deepCopy(o[ii])}if(copyProto){nn["__proto__"]=o["__proto__"]}return nn}else{return o}};var getFullDateString=window["getFullDateString"]=function(sec){var curDate=sec!=null?new Date(sec*1e3):new Date;var month=curDate.getMonth()>=0&&curDate.getMonth()<=8?"0"+(curDate.getMonth()+1).toString():""+(curDate.getMonth()+1).toString();var day=curDate.getDate()>=1&&curDate.getDate()<=9?"0"+curDate.getDate():""+curDate.getDate();return""+curDate.getFullYear()+"年"+month+"月"+day+"日"};var stringToNum=window["stringToNum"]=function(str){if(str===void 0){str=""}if(str==""||str=="0"||!str){return 0}else{return Number(str)}};var formatFloat=window["formatFloat"]=function(f,digit){var m=Math.pow(10,digit);return Math.round(f*m)/m};var copyToClipboard=window["copyToClipboard"]=function(str){if(window["isIOS_AppStore"]==true){egret.ExternalInterface.call("AppStoreVer_copyToClipboard",str)}else{if(JsNativeCallMgr.hasMethod("copyToClipboard")){JsNativeCallMgr.callMethod("copyToClipboard",function(){},str)}else{var input=document.createElement("input");input.value=str;document.body.appendChild(input);input.select();input.setSelectionRange(0,input.value.length),document.execCommand("Copy");document.body.removeChild(input)}}UserTips.ins().showTips("已复制至剪切板")};var channelLogout=window["channelLogout"]=function(){if(JsNativeCallMgr.hasMethod("channelLogout")){JsNativeCallMgr.callMethod("channelLogout",function(){})}console.log("已退出登录")};var UUID="";window["UUID"]=UUID;var LoginName="";window["LoginName"]=LoginName;var GetPhone_UUID=window["GetPhone_UUID"]=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if(window["isIOS_AppStore"]==true){if(UUID==""){egret.ExternalInterface.call("GetPhone_UUID","");egret.ExternalInterface.addCallback("GetPhone_UUIDCallback",function(ret){console.log("--------------------UUID--------------");console.log(ret);UUID=uuid})}return UUID}var uuid="0";if(JsNativeCallMgr.hasMethod("getPhone_UUID")){JsNativeCallMgr.callMethod.apply(JsNativeCallMgr,["getPhone_UUID",function(ret){uuid=ret}].concat(args))}UUID=uuid;return uuid};var GetLoginName=window["GetLoginName"]=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var loginName="0";if(JsNativeCallMgr.hasMethod("getLoginName")){JsNativeCallMgr.callMethod.apply(JsNativeCallMgr,["getLoginName",function(ret){loginName=ret}].concat(args))}var channel=window["GetChannel"]()||"";var c=channel.split("_");if(c[0]=="20106"){LoginName=loginName;return loginName}LoginName=LoginMgr.ins().userName;return LoginName};window["GetUrl"]=function GetUrl(url){if(url===void 0){url=null}if(!url){if(document&&document.location){url=document.location.toString()}}if(window["OPEN_DATA"]&&window["OPEN_DATA"].appurl){url=window["OPEN_DATA"].appurl}return url};window["GetUrlParam"]=function GetUrlParam(paraName,url){if(url===void 0){url=""}url=GetUrl(url);var arrObj=url.split("?");if(arrObj.length>1){var arrPara=arrObj[1].split("&");var arr;for(var i=0;i<arrPara.length;i++){arr=arrPara[i].split("=");if(arr!=null&&arr[0]==paraName){return arr[1]}}return""}else{return""}};window["GetUrlChannel"]=function GetUrlChannel(){if(window["isSmallGame"]){var c=window["GetChannel"]();return c}var wlmzchannel=GetUrlParam("wlmzchannel");if(wlmzchannel){return wlmzchannel}return GetUrlParam("channel")};window["showFadeOutTips"]=function showFadeOutTips(bg,label,text,y){if(text===void 0){text=""}if(y===void 0){y=256}if(!bg){return}bg.visible=true;bg.y=y;label.text=text;var t=egret.Tween.get(bg);t.to({y:y-45},600).wait(1500).call(function(){bg.visible=false},this)};window["fixIOSKeyboardBugs"]=function fixIOSKeyboardBugs(){RES.SoundAnalyzer.prototype["onLoadFinish"]=function(event){var sound=event.$target;sound.removeEventListener(egret.Event.COMPLETE,this.onLoadFinish,this);sound.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this);var data=this.resItemDic[sound.$hashCode];delete this.resItemDic[sound.$hashCode];if(!data){return}var resItem=data.item;var compFunc=data.func;resItem.loaded=event.$type==egret.Event.COMPLETE;if(resItem.loaded){this.analyzeData(resItem,sound)}compFunc.call(data.thisObject,resItem)};RES.AnimationAnalyzer.prototype["onLoadFinish"]=function(event){var request=event.target;var data=this.resItemDic[request.$hashCode];delete this.resItemDic[request.hashCode];if(!data){return}var resItem=data.item;var compFunc=data.func;resItem.loaded=event.type==egret.Event.COMPLETE;if(resItem.loaded){if(request instanceof egret.HttpRequest){resItem.loaded=false;var imageUrl=this.analyzeConfig(resItem,request.response);if(imageUrl){this.loadImage(imageUrl,data);this.recycler.push(request);return}}else{this.analyzeBitmap(resItem,request.data)}}if(request instanceof egret.HttpRequest){this.recycler.push(request)}else{this.recyclerIamge.push(request)}compFunc.call(data.thisObject,resItem)};RES.BinAnalyzer.prototype["onLoadFinish"]=function(event){var request=event.target;var data=this.resItemDic[request.hashCode];if(!data){return}delete this.resItemDic[request.hashCode];var resItem=data.item;var compFunc=data.func;resItem.loaded=event.type==egret.Event.COMPLETE;if(resItem.loaded){this.analyzeData(resItem,request.response)}this.recycler.push(request);compFunc.call(data.thisObject,resItem)};RES.SheetAnalyzer.prototype["onLoadFinish"]=function(event){var request=event.target;var data=this.resItemDic[request.$hashCode];delete this.resItemDic[request.hashCode];var resItem=data.item;var compFunc=data.func;resItem.loaded=event.type==egret.Event.COMPLETE;if(resItem.loaded){if(request instanceof egret.HttpRequest){resItem.loaded=false;var imageUrl=this.analyzeConfig(resItem,request.response);if(imageUrl){this.loadImage(imageUrl,data);this.recycler.push(request);return}}else{var texture=new egret.Texture;texture._setBitmapData(request.data);this.analyzeBitmap(resItem,texture)}}if(request instanceof egret.HttpRequest){this.recycler.push(request)}else{this.recyclerIamge.push(request)}compFunc.call(data.thisObject,resItem)};RES.ImageAnalyzer.prototype["onLoadFinish"]=function(event){var request=event.$target;var data=this.resItemDic[request.$hashCode];delete this.resItemDic[request.$hashCode];var resItem=data.item;var compFunc=data.func;resItem.loaded=event.$type==egret.Event.COMPLETE;if(resItem.loaded){var texture=new egret.Texture;texture._setBitmapData(request.data);this.analyzeData(resItem,texture)}this.recycler.push(request);compFunc.call(data.thisObject,resItem)};egret.web["WebImageLoader"].prototype.onBlobLoaded=function(event){if(!this||!this.request||!this.request.response){return}var blob=this.request.response;this.request=undefined;var winURL=window["URL"]||window["webkitURL"];this.loadImage(winURL.createObjectURL(blob))}};window["imageToMc"]=function imageToMc(img,source,mcParentNode,_body,RES_DIR,noMc,noImg){if(_body===void 0){_body=null}if(RES_DIR===void 0){RES_DIR=RES_DIR_ROLE}if(noMc===void 0){noMc=false}if(noImg===void 0){noImg=true}mcParentNode.removeChildren();if(!source){return null}if(!noImg){img.source=source+"_png"}if(noMc){return null}var mc=new MovieClip;mcParentNode.addChild(mc);mc.playFile(RES_DIR+source,-1,null,true,function(){img.source="";if(_body){mc.addEventListener(egret.Event.CHANGE,function(){mc.removeEventListener(egret.Event.CHANGE,null,null);mc.gotoAndPlay(_body.currentFrame,-1)},null);_body.addEventListener(egret.Event.CHANGE,function(){mc.gotoAndPlay(_body.currentFrame,-1)},null)}});return mc};window["getDefaultBody"]=function getDefaultBody(job){if(job===void 0){job=1}var res="body000_0";switch(job){case 1:res="body000_0";break;case 2:res="body001_1";break;case 3:res="body300_1";break}return res};var jieStrMap=window["jieStrMap"]={1:"一阶",2:"二阶",3:"三阶",4:"四阶",5:"五阶",6:"六阶",7:"七阶",8:"八阶",9:"九阶",10:"十阶"};window["numToJie"]=function numToJie(level){var jieStr="";if(level<1){return}if(level>10){level=10}jieStr=jieStrMap[level];return jieStr};window["getZhuangbanById"]=function getZhuangbanById(id){for(var k in GlobalConfig.ZhuangBanId){if(GlobalConfig.ZhuangBanId[k].id==id)return GlobalConfig.ZhuangBanId[k]}return null};window["getSwordMcById"]=function getSwordMcById(skinId){var cfg=GlobalConfig.SwordSkinConfig[skinId];var appearance=cfg["appearance"];return appearance||""};var headMap=window["headMap"]={1:"yuanhead10",2:"yuanhead21",3:"yuanhead31"};window["iconByJob"]=function iconByJob(job){if(job===void 0){job=1}return headMap[job.toString()]||headMap["1"]};var sexMap=window["sexMap"]={1:0,2:1,3:1};window["sexByJob"]=function sexByJob(job){if(job===void 0){job=1}return sexMap[job.toString()]||sexMap["1"]};window["attr2column"]=function attr2column(attr,space){if(space===void 0){space=8}var attrlines=attr.split("\n");var str="";for(var i=0,c=attrlines.length;i<c;++i){var line=attrlines[i];str+=line;if(i==c-1){}else if(i%2==1){str+="\n"}else{for(var j=0;j<space;j++){str+=" "}}}return str};window["isArray"]=function isArray(obj){if(Array.isArray){return Array.isArray(obj)}else{return obj instanceof Array}};window["getRotation"]=function getRotation(x1,y1,x2,y2){if(x2-x1==0){if(y2<y1){return-90}return 90}if(y2-y1==0){if(x2<x1){return 180}return 0}var tan=(y2-y1)/(x2-x1);var angle=Math.atan(tan)*180/Math.PI;if(x2<x1){angle+=180}return angle};window["getRandom"]=function getRandom(){var r=Math.random();var a=Math.random();return r>.5?a:-a};var JsNativeCallMgr=function(){function JsNativeCallMgr(){}JsNativeCallMgr.initWK=function(){if(!this.wkInited){this.wkInited=true;if(typeof window!="undefined"&&typeof window["webkit"]!="undefined"&&typeof window["webkit"]["messageHandlers"]!="undefined"){this.messageHandlers=window["webkit"].messageHandlers;window["JsNativeCallMgr_methodCallback"]=JsNativeCallMgr.methodCallback}}};JsNativeCallMgr.hasMethod=function(method){this.initWK();if(typeof Js2JavaInterface!="undefined"){if(typeof Js2JavaInterface[method]!="undefined"&&Js2JavaInterface[method]!=null){return true}}else if(this.messageHandlers!=null){if(typeof this.messageHandlers[method]!="undefined"&&this.messageHandlers[method]!=null){return true}}return false};JsNativeCallMgr.callMethod=function(method,cb){var args=[];for(var _i=2;_i<arguments.length;_i++){args[_i-2]=arguments[_i]}this.initWK();if(typeof Js2JavaInterface!="undefined"){if(typeof Js2JavaInterface[method]!="undefined"&&Js2JavaInterface[method]!=null){var func=Js2JavaInterface[method];var ret=func.apply(Js2JavaInterface,args);cb(ret)}}else if(this.messageHandlers!=null){if(typeof this.messageHandlers[method]!="undefined"&&this.messageHandlers[method]!=null){if(this.pendingCBs[method]==null){this.pendingCBs[method]=[]}this.pendingCBs[method].push(cb);this.messageHandlers[method].postMessage({args:args})}}return false};JsNativeCallMgr.methodCallback=function(method,ret){if(JsNativeCallMgr.pendingCBs[method]!=null){var cb=JsNativeCallMgr.pendingCBs[method].shift();cb(ret)}};JsNativeCallMgr.wkInited=false;JsNativeCallMgr.messageHandlers=null;JsNativeCallMgr.pendingCBs={};return JsNativeCallMgr}();__reflect(JsNativeCallMgr.prototype,"JsNativeCallMgr");var i18nMap=null;window["i18nMap"]=i18nMap;window["i18n"]=function i18n(key){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}if(key in i18nMap){var str=i18nMap[key];if(args.length>0){for(var i=0;i<args.length;i++){if(args[i]==undefined){return""}else{var reg=new RegExp("(\\${["+i+"]})","g");str=str.replace(reg,args[i])}}}return str}else{return"No such key:"+key}};window["angleF3PB"]=function angleF3PB(AX,AY,BX,BY,CX,CY){var ABX=AX-BX;var ABY=AY-BY;var ACX=AX-CX;var ACY=AY-CY;var BCX=BX-CX;var BCY=BY-CY;var AB2=ABX*ABX+ABY*ABY;var AC2=ACX*ACX+ACY*ACY;var BC2=BCX*BCX+BCY*BCY;var AB=Math.sqrt(AB2);var AC=Math.sqrt(AC2);var cosA=(AB2+AC2-BC2)/(2*AB*AC);return cosA};window["angleFrom3Point"]=function angleFrom3Point(x1,y1,x2,y2,x3,y3){var c=angleF3PB(x1,y1,x2,y2,x3,y3);var angle=Math.acos(c);return angle};window["calc_distance_point_to_point"]=function calc_distance_point_to_point(A,B){var dx=A.x-B.x;var dy=A.y-B.y;return Math.sqrt(dx*dx+dy*dy)};window["calc_distance_point_to_line"]=function calc_distance_point_to_line(A,B,P){var dist=0;var side=calc_distance_point_to_point(A,B);if(side!=0){var area=Math.abs(P.x*(A.y-B.y)+A.x*(B.y-P.y)+B.x*(P.y-A.y));dist=area/side}else{dist=calc_distance_point_to_point(A,P)}return dist};window["check_affect_object_in_rect"]=function check_affect_object_in_rect(my_pos,ta_pos,obj_pos,off_pos,affect_range_ex){var rect_width=affect_range_ex.f*GameMap.CELL_SIZE;var rect_length=affect_range_ex.d*GameMap.CELL_SIZE;var rect_half_width=rect_width*.5;var rect_half_length=rect_length*.5;var cur_x=my_pos.x+off_pos.x;var cur_y=my_pos.y+off_pos.y;var pos_A={x:cur_x,y:cur_y};var pos_B=ta_pos;var pos_P=obj_pos;var dist_obj_to_line_AB=calc_distance_point_to_line(pos_A,pos_B,pos_P);if(dist_obj_to_line_AB>rect_half_width){return false}var dist_AB=calc_distance_point_to_point(pos_A,pos_B);var scale=rect_length/dist_AB;var pos_D={x:pos_A.x+scale*(pos_B.x-pos_A.x),y:pos_A.y+scale*(pos_B.y-pos_A.y)};var pos_E={x:.5*(pos_A.x+pos_D.x+pos_A.y-pos_D.y),y:.5*(pos_A.y+pos_D.y+pos_D.x-pos_A.x)};var pos_F={x:.5*(pos_A.x+pos_D.x+pos_D.y-pos_A.y),y:.5*(pos_A.y+pos_D.y+pos_A.x-pos_D.x)};var dist_obj_to_line_EF=calc_distance_point_to_line(pos_E,pos_F,pos_P);if(dist_obj_to_line_EF>rect_half_length){return false}return true};window["initFrontBackFunc"]=function initFrontBackFunc(){window["frontCallbackFunc"]=function(){var gameSvr=GameServer.ins();var bytes=gameSvr.getBytes(253);gameSvr.sendToServer(bytes)};egret.ExternalInterface.addCallback("frontCallbackFunc",window["frontCallbackFunc"]);window["backCallbackFunc"]=function(){var gameSvr=GameServer.ins();var bytes=gameSvr.getBytes(254);gameSvr.sendToServer(bytes)};egret.ExternalInterface.addCallback("backCallbackFunc",window["backCallbackFunc"])};window["pointInRect"]=function pointInRect(mx,my,ax,ay,bx,by,cx,cy){var abx=bx-ax;var aby=by-ay;var amx=mx-ax;var amy=my-ay;var bcx=cx-bx;var bcy=cy-by;var bmx=mx-bx;var bmy=my-by;var abam=abx*amx+aby*amy;var abab=abx*abx+aby*aby;var bcbm=bcx*bmx+bcy*bmy;var bcbc=bcx*bcx+bcy*bcy;var inside=0<=abam&&abam<=abab&&0<=bcbm&&bcbm<=bcbc;return inside};window["playAnimation"]=function playAnimation(target,isLoop){if(isLoop){for(var key in target.items){target.items[key].props={loop:true}}}target.play()};window["longTouch"]=function longTouch(btn,callback,interval){if(interval===void 0){interval=500}var isLoop=false;var loopTimer=function(){isLoop=true;TimerManager.ins().doTimer(interval,0,function(){if(callback){callback(isLoop)}},btn)};var startTimer=function(){isLoop=false;if(callback){callback(isLoop)}TimerManager.ins().doTimer(interval,1,function(){loopTimer()},btn)};var stopTimer=function(){TimerManager.ins().removeAll(btn)};var removeListener=function(){btn.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,startTimer,btn);btn.removeEventListener(egret.TouchEvent.TOUCH_END,stopTimer,btn)};var stopAll=function(){stopTimer();removeListener()};stopAll();btn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,startTimer,btn);btn.addEventListener(egret.TouchEvent.TOUCH_END,stopTimer,btn);return stopAll};window["fixJob"]=function fixJob(job){if(job==undefined||job==null){return 1}var j=Math.min(3,job);j=Math.max(1,j);return j};window["fixSex"]=function fixSex(sex){if(sex==undefined||sex==null){return 0}var s=Math.min(1,sex);s=Math.max(0,s);return s};var GlobalFun=function(){function GlobalFun(){}GlobalFun.checkMoney=function(num,moneyType,noTips,backFun){if(moneyType===void 0){moneyType=MoneyConst.yuanbao}if(noTips===void 0){noTips=""}switch(moneyType){case MoneyConst.gold:if(Actor.gold>=num)return true;if(noTips=="")noTips=i18n("GlobalFun_0");UserTips.ins().showTips(noTips);break;case MoneyConst.yuanbao:if(Actor.yb>=num)return true;if(noTips=="")noTips=i18n("GlobalFun_1");UserTips.ins().showTips(noTips);if(!ChannelMgr.ins().isRechargeHidden()){if(!KFServerSys.ins().isKF){var w=WarnWin.show(i18n("GlobalFun_2"),null,null,function(){Recharge.ins().tryShowChargeFirstWin();if(backFun&&typeof backFun=="function")backFun()});w.setBtnLabel(i18n("GlobalFun_3"),i18n("GlobalFun_4"))}}default:debug.log(i18n("GlobalFun_5"),moneyType);return false}return false};return GlobalFun}();__reflect(GlobalFun.prototype,"GlobalFun");var KeyboardUtils=function(_super){__extends(KeyboardUtils,_super);function KeyboardUtils(){var _this=_super.call(this)||this;_this.key_ups=new Array;_this.key_downs=new Array;var __th_at=GetUrlParam("__th_at");var autoTest=__th_at=="1"||__th_at=="2";if(DeviceUtils.IsHtml5&&LocationProperty.isLocation||autoTest){var self_3=_this;document.addEventListener("keyup",function(e){for(var i=0,len=self_3.key_ups.length;i<len;i++){var func=self_3.key_ups[i][0];var target=self_3.key_ups[i][1];if(target){func.call(target,e["keyCode"])}else{func(e["keyCode"])}}});document.addEventListener("keydown",function(e){for(var i=0,len=self_3.key_downs.length;i<len;i++){var func=self_3.key_downs[i][0];var target=self_3.key_downs[i][1];if(target){func.call(target,e["keyCode"])}else{func(e["keyCode"])}}})}return _this}KeyboardUtils.ins=function(){return _super.ins.call(this)};KeyboardUtils.prototype.addKeyUp=function(callback,target){this.key_ups.push([callback,target])};KeyboardUtils.prototype.addKeyDown=function(callback,target){this.key_downs.push([callback,target])};KeyboardUtils.prototype.removeKeyUp=function(callback,target){for(var i=0;i<this.key_ups.length;i++){if(this.key_ups[i][0]==callback&&this.key_ups[i][1]==target){this.key_ups.splice(i,1);i--}}};KeyboardUtils.prototype.removeKeyDown=function(callback,target){for(var i=0;i<this.key_downs.length;i++){if(this.key_downs[i][0]==callback&&this.key_downs[i][1]==target){this.key_downs.splice(i,1);i--}}};return KeyboardUtils}(BaseClass);__reflect(KeyboardUtils.prototype,"KeyboardUtils");var KeyCode=function(){function KeyCode(){}KeyCode.KC_1=49;KeyCode.KC_2=50;KeyCode.KC_3=51;KeyCode.KC_4=52;KeyCode.KC_5=53;KeyCode.KC_6=54;KeyCode.KC_7=55;KeyCode.KC_8=56;KeyCode.KC_9=57;KeyCode.KC_0=48;KeyCode.KC_A=65;KeyCode.KC_B=66;KeyCode.KC_C=67;KeyCode.KC_D=68;KeyCode.KC_E=69;KeyCode.KC_F=70;KeyCode.KC_G=71;KeyCode.KC_H=72;KeyCode.KC_I=73;KeyCode.KC_J=74;KeyCode.KC_K=75;KeyCode.KC_L=76;KeyCode.KC_M=77;KeyCode.KC_N=78;KeyCode.KC_O=79;KeyCode.KC_P=80;KeyCode.KC_Q=81;KeyCode.KC_R=82;KeyCode.KC_S=83;KeyCode.KC_T=84;KeyCode.KC_U=85;KeyCode.KC_V=86;KeyCode.KC_W=87;KeyCode.KC_X=88;KeyCode.KC_Y=89;KeyCode.KC_Z=90;KeyCode.KC_F1=112;KeyCode.KC_F2=113;KeyCode.KC_F3=114;KeyCode.KC_F4=115;KeyCode.KC_F5=116;KeyCode.KC_F6=117;KeyCode.KC_F7=118;KeyCode.KC_F8=119;KeyCode.KC_F9=120;KeyCode.KC_F10=121;KeyCode.KC_F11=122;KeyCode.KC_F12=123;KeyCode.KC_F13=124;KeyCode.KC_F14=125;KeyCode.KC_F15=126;KeyCode.KC_NUMPAD_0=96;KeyCode.KC_NUMPAD_1=97;KeyCode.KC_NUMPAD_2=98;KeyCode.KC_NUMPAD_3=99;KeyCode.KC_NUMPAD_4=100;KeyCode.KC_NUMPAD_5=101;KeyCode.KC_NUMPAD_6=102;KeyCode.KC_NUMPAD_7=103;KeyCode.KC_NUMPAD_8=104;KeyCode.KC_NUMPAD_9=105;KeyCode.KC_NUMPAD_MULTIPLY=106;KeyCode.KC_NUMPAD_ADD=107;KeyCode.KC_NUMPAD_ENTER=108;KeyCode.KC_NUMPAD_SUBTRACT=109;KeyCode.KC_NUMPAD_DECIMAL=110;KeyCode.KC_NUMPAD_DIVIDE=111;KeyCode.KC_BACKSPACE=8;KeyCode.KC_TAB=9;KeyCode.KC_ENTER=13;KeyCode.KC_SHIFT=16;KeyCode.KC_CONTROL=17;KeyCode.KC_ESCAPE=27;KeyCode.KC_SPACE=32;KeyCode.KC_WINDOWS=91;KeyCode.KC_MENU=93;KeyCode.KC_CAPS_LOCK=20;KeyCode.KC_NUM_LOCK=144;KeyCode.KC_SCROLL_LOCK=145;KeyCode.KC_PAUSE=19;KeyCode.KC_PAGE_UP=33;KeyCode.KC_PAGE_DOWN=34;KeyCode.KC_END=35;KeyCode.KC_HOME=36;KeyCode.KC_INSERT=45;KeyCode.KC_DELETE=46;KeyCode.KC_LEFT=37;KeyCode.KC_UP=38;KeyCode.KC_RIGHT=39;KeyCode.KC_DOWN=40;KeyCode.KC_SEMICOLON_COLON=186;KeyCode.KC_EQUAL_PLUS=187;KeyCode.KC_MINUS_UNDERLINE=189;KeyCode.KC_SLASH_QUESTIONMARK=191;KeyCode.KC_SPECIALCOMMA_EARTHWORM=192;KeyCode.KC_LEFT_BRACKET_BRACE=219;KeyCode.KC_BACKSLASH_VERTICALBAR=220;KeyCode.KC_RIGHT_BRACKET_BRACE=221;KeyCode.KC_QUOTE=222;KeyCode.KC_COMMA=188;KeyCode.KC_PERIOD=190;return KeyCode}();__reflect(KeyCode.prototype,"KeyCode");var LocationProperty=function(){function LocationProperty(){}LocationProperty.init=function(){this.urlParam={};var str=window["paraUrl"];if(str){var whIndex=str.indexOf("?");if(whIndex!=-1){var param=str.slice(whIndex+1).split("&");var strArr=void 0;for(var i=0;i<param.length;i++){strArr=param[i].split("=");this.urlParam[strArr[0]]=strArr[1]}}}var rv=LocationProperty.ver_res;if(rv){RES_RESOURCE+=rv;RES_DIR+=rv;MAP_DIR+=rv}RES_RESOURCE+="/";RES_DIR+="/";MAP_DIR+="/";LocationProperty.pf=DeviceUtils.deviceOS==DEVICE_OS.ANDROID?"1":"0";LocationProperty.pfid=ChannelMgr.ins().main_channel;LocationProperty.appid=ChannelMgr.ins().main_channel};Object.defineProperty(LocationProperty,"resAdd",{get:function(){return this.urlParam["hosts"]||""},set:function(str){this.urlParam["hosts"]=str},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"accountUserID",{get:function(){return this.urlParam["accuid"]},set:function(str){this.urlParam["accuid"]=str},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"openID",{get:function(){return this.urlParam["user"]},set:function(str){this.urlParam["user"]=str},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"srvid",{get:function(){return parseInt(this.urlParam["srvid"])||2},set:function(v){this.urlParam["srvid"]=v},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"isCreated",{get:function(){return this.urlParam["isCreated"]},set:function(v){this.urlParam["isCreated"]=v},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"srvName",{get:function(){return this.urlParam["srvName"]},set:function(v){this.urlParam["srvName"]=v},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"serverIP",{get:function(){return this.urlParam["srvaddr"]||"192.168.2.130"},set:function(str){this.urlParam["srvaddr"]=str},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"serverPort",{get:function(){return this.urlParam["srvport"]||9002},set:function(v){this.urlParam["srvport"]=v},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"password",{get:function(){return this.urlParam["spverify"]},set:function(v){this.urlParam["spverify"]=v},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"openKey",{get:function(){return this.urlParam["openkey"]},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"zoneId",{get:function(){return this.urlParam["zoneid"]},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"serverID",{get:function(){return this.urlParam["serverid"]},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"appid",{get:function(){return this.urlParam["appid"]||"0"},set:function(str){this.urlParam["appid"]=str},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"app_openid",{get:function(){return this.urlParam["app_openid"]||""},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"isSubscribe",{get:function(){return this.urlParam["isSubscribe"]},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"nickName",{get:function(){var str=this.urlParam["nickName"]||"";try{return str.length?decodeURIComponent(str):str}catch(e){return str}},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"callUrl",{get:function(){var str=this.urlParam["callUrl"]||"";return str.length?decodeURIComponent(str):str},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"gifi",{get:function(){return this.urlParam["gifi"]},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"roleCount",{get:function(){return parseInt(this.urlParam["roleCount"])},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"isnew",{get:function(){return parseInt(this.urlParam["isnew"])},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"login_ip",{get:function(){return this.urlParam["login_ip"]},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"is_attention",{get:function(){return this.urlParam["is_attention"]},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"isShowShare",{get:function(){return window["isShowShare"]},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"v",{get:function(){return parseInt(this.urlParam["v"])},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"isYelloVip",{get:function(){return parseInt(this.urlParam["isYelloVip"])},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"isYelloYearVip",{get:function(){return parseInt(this.urlParam["isYelloYearVip"])},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"yelloVipLevel",{get:function(){return parseInt(this.urlParam["yelloVipLevel"])},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"isYelloHighVip",{get:function(){return parseInt(this.urlParam["isYelloHighVip"])},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"logurl",{get:function(){return decodeURIComponent(this.urlParam["logurl"])},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"isFirstLoad",{get:function(){return!LocationProperty.isLocation&&LocationProperty.roleCount==0},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"loadurl",{get:function(){return decodeURIComponent(this.urlParam["loadurl"])},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"pfid",{get:function(){return this.urlParam["pfid"]||"0"},set:function(str){this.urlParam["pfid"]=str},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"pf",{get:function(){return this.urlParam["pf"]||"101"},set:function(str){this.urlParam["pf"]=str},enumerable:true,configurable:true});Object.defineProperty(LocationProperty,"ver_res",{get:function(){return this.urlParam["ver_res"]?parseInt(this.urlParam["ver_res"]):0},enumerable:true,configurable:true});LocationProperty.isCanLogin=function(){return this.openID!=null&&this.password!=null&&this.srvid!=null&&this.serverIP!=null&&this.serverPort!=null};Object.defineProperty(LocationProperty,"isLocation",{get:function(){return location.href.indexOf("192.168.1")>=0||location.href.indexOf("127.0.0.1")>=0||location.href.indexOf("localhost")>=0||location.href.indexOf("10.10.1")>=0||location.href.indexOf("10.10.4")>=0},enumerable:true,configurable:true});LocationProperty.setLoadProgress=function(n,str){window["loadProgress"]=[n,str]};return LocationProperty}();__reflect(LocationProperty.prototype,"LocationProperty");window["shareCallback"]=function shareCallback(){UserTips.ins().showTips(i18n("LocationProperty_0"));PfActivity.ins().sendWeiXinInviteGift();ViewManager.ins().close(YqWin)};window["isFocusCallback"]=function isFocusCallback(code){PfActivity.ins().postGuanZhu(+code)};window["isShareCallback"]=function isShareCallback(code){PfActivity.ins().postShare(+code)};var Log=function(){function Log(){}Log.trace=function(){var optionalParams=[];for(var _i=0;_i<arguments.length;_i++){optionalParams[_i]=arguments[_i]}if(DebugUtils.isDebug){optionalParams[0]="[DebugLog]"+optionalParams[0];debug.log.apply(console,optionalParams)}};return Log}();__reflect(Log.prototype,"Log");var MathUtils=function(){function MathUtils(){}MathUtils.getAngle=function(radian){return 180*radian/Math.PI};MathUtils.getRadian=function(angle){return angle/180*Math.PI};MathUtils.getRadian2=function(p1X,p1Y,p2X,p2Y){var xdis=p2X-p1X;var ydis=p2Y-p1Y;return Math.atan2(ydis,xdis)};MathUtils.getDistance=function(p1X,p1Y,p2X,p2Y){var disX=p2X-p1X;var disY=p2Y-p1Y;var disQ=disX*disX+disY*disY;return Math.sqrt(disQ)};MathUtils.getDistanceByObject=function(s,t){return this.getDistance(s.x,s.y,t.x,t.y)};MathUtils.getDistanceX2ByObject=function(s,t){var disX=s.x-t.x;var disY=s.y-t.y;return disX*disX+disY*disY};MathUtils.getDirMove=function(angle,distance,offsetX,offsetY){if(offsetX===void 0){offsetX=0}if(offsetY===void 0){offsetY=0}var radian=this.getRadian(angle);var p={x:0,y:0};p.x=Math.cos(radian)*distance+offsetX;p.y=Math.sin(radian)*distance+offsetY;return p};MathUtils.limit=function($from,$end){$from=Math.min($from,$end);$end=Math.max($from,$end);var range=$end-$from;return $from+Math.random()*range};MathUtils.limitInteger=function($from,$end){return Math.round(this.limit($from,$end))};MathUtils.randomArray=function(arr){var index=Math.floor(Math.random()*arr.length);return arr[index]};MathUtils.toInteger=function(value){return value>>0};return MathUtils}();__reflect(MathUtils.prototype,"MathUtils");var md5_lytj=function(){function md5_lytj(){}md5_lytj.hex_md5=function(s){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(s)))};md5_lytj.b64_md5=function(s){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(s)))};md5_lytj.any_md5=function(s,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(s)),e)};md5_lytj.hex_hmac_md5=function(k,d){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(k),this.str2rstr_utf8(d)))};md5_lytj.b64_hmac_md5=function(k,d){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(k),this.str2rstr_utf8(d)))};md5_lytj.any_hmac_md5=function(k,d,e){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(k),this.str2rstr_utf8(d)),e)};md5_lytj.md5_vm_test=function(){return this.hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"};md5_lytj.rstr_md5=function(s){return this.binl2rstr(this.binl_md5(this.rstr2binl(s),s.length*8))};md5_lytj.rstr_hmac_md5=function(key,data){var bkey=this.rstr2binl(key);if(bkey.length>16)bkey=this.binl_md5(bkey,key.length*8);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=this.binl_md5(ipad.concat(this.rstr2binl(data)),512+data.length*8);return this.binl2rstr(this.binl_md5(opad.concat(hash),512+128))};md5_lytj.rstr2hex=function(input){try{this.hexcase}catch(e){this.hexcase=0}var hex_tab=this.hexcase?"0123456789ABCDEF":"0123456789abcdef";var output="";var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output};md5_lytj.rstr2b64=function(input){try{this.b64pad}catch(e){this.b64pad=""}var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var output="";var len=input.length;for(var i=0;i<len;i+=3){var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(var j=0;j<4;j++){if(i*8+j*6>input.length*8)output+=this.b64pad;else output+=tab.charAt(triplet>>>6*(3-j)&63)}}return output};md5_lytj.rstr2any=function(input,encoding){var divisor=encoding.length;var i,j,q,x,quotient;var dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++){dividend[i]=input.charCodeAt(i*2)<<8|input.charCodeAt(i*2+1)}var full_length=Math.ceil(input.length*8/(Math.log(encoding.length)/Math.log(2)));var remainders=Array(full_length);for(j=0;j<full_length;j++){quotient=Array();x=0;for(i=0;i<dividend.length;i++){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(quotient.length>0||q>0)quotient[quotient.length]=q}remainders[j]=x;dividend=quotient}var output="";for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);return output};md5_lytj.str2rstr_utf8=function(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);i++}if(x<=127)output+=String.fromCharCode(x);else if(x<=2047)output+=String.fromCharCode(192|x>>>6&31,128|x&63);else if(x<=65535)output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|x&63);else if(x<=2097151)output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|x&63)}return output};md5_lytj.str2rstr_utf16le=function(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)&255,input.charCodeAt(i)>>>8&255);return output};md5_lytj.str2rstr_utf16be=function(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,input.charCodeAt(i)&255);return output};md5_lytj.rstr2binl=function(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<input.length*8;i+=8)output[i>>5]|=(input.charCodeAt(i/8)&255)<<i%32;return output};md5_lytj.binl2rstr=function(input){var output="";for(var i=0;i<input.length*32;i+=8)output+=String.fromCharCode(input[i>>5]>>>i%32&255);return output};md5_lytj.binl_md5=function(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=this.md5_ff(a,b,c,d,x[i+0],7,-680876936);d=this.md5_ff(d,a,b,c,x[i+1],12,-389564586);c=this.md5_ff(c,d,a,b,x[i+2],17,606105819);b=this.md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=this.md5_ff(a,b,c,d,x[i+4],7,-176418897);d=this.md5_ff(d,a,b,c,x[i+5],12,1200080426);c=this.md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=this.md5_ff(b,c,d,a,x[i+7],22,-45705983);a=this.md5_ff(a,b,c,d,x[i+8],7,1770035416);d=this.md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=this.md5_ff(c,d,a,b,x[i+10],17,-42063);b=this.md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=this.md5_ff(a,b,c,d,x[i+12],7,1804603682);d=this.md5_ff(d,a,b,c,x[i+13],12,-40341101);c=this.md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=this.md5_ff(b,c,d,a,x[i+15],22,1236535329);a=this.md5_gg(a,b,c,d,x[i+1],5,-165796510);d=this.md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=this.md5_gg(c,d,a,b,x[i+11],14,643717713);b=this.md5_gg(b,c,d,a,x[i+0],20,-373897302);a=this.md5_gg(a,b,c,d,x[i+5],5,-701558691);d=this.md5_gg(d,a,b,c,x[i+10],9,38016083);c=this.md5_gg(c,d,a,b,x[i+15],14,-660478335);b=this.md5_gg(b,c,d,a,x[i+4],20,-405537848);a=this.md5_gg(a,b,c,d,x[i+9],5,568446438);d=this.md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=this.md5_gg(c,d,a,b,x[i+3],14,-187363961);b=this.md5_gg(b,c,d,a,x[i+8],20,1163531501);a=this.md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=this.md5_gg(d,a,b,c,x[i+2],9,-51403784);c=this.md5_gg(c,d,a,b,x[i+7],14,1735328473);b=this.md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=this.md5_hh(a,b,c,d,x[i+5],4,-378558);d=this.md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=this.md5_hh(c,d,a,b,x[i+11],16,1839030562);b=this.md5_hh(b,c,d,a,x[i+14],23,-35309556);a=this.md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=this.md5_hh(d,a,b,c,x[i+4],11,1272893353);c=this.md5_hh(c,d,a,b,x[i+7],16,-155497632);b=this.md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=this.md5_hh(a,b,c,d,x[i+13],4,681279174);d=this.md5_hh(d,a,b,c,x[i+0],11,-358537222);c=this.md5_hh(c,d,a,b,x[i+3],16,-722521979);b=this.md5_hh(b,c,d,a,x[i+6],23,76029189);a=this.md5_hh(a,b,c,d,x[i+9],4,-640364487);d=this.md5_hh(d,a,b,c,x[i+12],11,-421815835);c=this.md5_hh(c,d,a,b,x[i+15],16,530742520);b=this.md5_hh(b,c,d,a,x[i+2],23,-995338651);a=this.md5_ii(a,b,c,d,x[i+0],6,-198630844);d=this.md5_ii(d,a,b,c,x[i+7],10,1126891415);c=this.md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=this.md5_ii(b,c,d,a,x[i+5],21,-57434055);a=this.md5_ii(a,b,c,d,x[i+12],6,1700485571);d=this.md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=this.md5_ii(c,d,a,b,x[i+10],15,-1051523);b=this.md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=this.md5_ii(a,b,c,d,x[i+8],6,1873313359);d=this.md5_ii(d,a,b,c,x[i+15],10,-30611744);c=this.md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=this.md5_ii(b,c,d,a,x[i+13],21,1309151649);a=this.md5_ii(a,b,c,d,x[i+4],6,-145523070);d=this.md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=this.md5_ii(c,d,a,b,x[i+2],15,718787259);b=this.md5_ii(b,c,d,a,x[i+9],21,-343485551);a=this.safe_add(a,olda);b=this.safe_add(b,oldb);c=this.safe_add(c,oldc);d=this.safe_add(d,oldd)}return[a,b,c,d]};md5_lytj.md5_cmn=function(q,a,b,x,s,t){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(a,q),this.safe_add(x,t)),s),b)};md5_lytj.md5_ff=function(a,b,c,d,x,s,t){return this.md5_cmn(b&c|~b&d,a,b,x,s,t)};md5_lytj.md5_gg=function(a,b,c,d,x,s,t){return this.md5_cmn(b&d|c&~d,a,b,x,s,t)};md5_lytj.md5_hh=function(a,b,c,d,x,s,t){return this.md5_cmn(b^c^d,a,b,x,s,t)};md5_lytj.md5_ii=function(a,b,c,d,x,s,t){return this.md5_cmn(c^(b|~d),a,b,x,s,t)};md5_lytj.safe_add=function(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535};md5_lytj.bit_rol=function(num,cnt){return num<<cnt|num>>>32-cnt};md5_lytj.hexcase=0;md5_lytj.b64pad="";return md5_lytj}();__reflect(md5_lytj.prototype,"md5_lytj");var PageArray=function(){function PageArray(source,size){if(size===void 0){size=20}this.dataSource=source;this.size=size;this.currentPage=0;this.setPageData()}Object.defineProperty(PageArray.prototype,"length",{get:function(){return this.dataSource.length},enumerable:true,configurable:true});PageArray.prototype.setPageData=function(){this.pageData=[];var index=this.currentPage*this.size;var nextIndex=(this.currentPage+1)*this.size;var min=Math.min(this.length,nextIndex);for(var i=index;i<min;i++){this.pageData.push(this.dataSource[i])}};PageArray.prototype.getDataSource=function(){return this.dataSource};Object.defineProperty(PageArray.prototype,"totalPage",{get:function(){return Math.ceil(this.length/this.size)},enumerable:true,configurable:true});PageArray.prototype.havePre=function(){return this.currentPage!=0};PageArray.prototype.haveNext=function(){return this.currentPage<this.totalPage-1};PageArray.prototype.prev=function(){this.currentPage--;this.setPageData()};PageArray.prototype.next=function(){this.currentPage++;this.setPageData()};PageArray.prototype.first=function(){this.currentPage=0;this.setPageData()};PageArray.prototype.last=function(){this.currentPage=this.totalPage-1;this.setPageData()};PageArray.prototype.gotoPage=function(index){if(this.totalPage<index){return}else{this.currentPage=index-1;this.setPageData()}};return PageArray}();__reflect(PageArray.prototype,"PageArray");var RegExpUtil=function(){function RegExpUtil(){}RegExpUtil.LINE_BREAK=/\r+/g;RegExpUtil.BLANK_REG=/[\s\\]/g;RegExpUtil.ARGB_COLOR=/[a-fA-F0-9]{8}/;RegExpUtil.HTML=/<[^>]+>/g;RegExpUtil.DELETE_SPACE=/\s/g;RegExpUtil.REPLACE_STRING=/%s/g;RegExpUtil.NumericExp=/^\d+$/;RegExpUtil.NonNumericExp=/\D/;RegExpUtil.ActorNameExp=/^([\u4e00-\u9fa5]?\w?[^>|!@#$%&*\^\?]){1,48}$/;return RegExpUtil}();__reflect(RegExpUtil.prototype,"RegExpUtil");var ResourceUtils=function(_super){__extends(ResourceUtils,_super);function ResourceUtils(){var _this=_super.call(this)||this;_this._groupIndex=0;_this._configs=new Array;_this._groups={};_this._urlResorce={};RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,_this.onResourceLoadComplete,_this);RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,_this.onResourceLoadProgress,_this);RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,_this.onResourceLoadError,_this);RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,_this.onItemLoadError,_this);return _this}ResourceUtils.ins=function(){return _super.ins.call(this)};ResourceUtils.prototype.addConfig=function(jsonPath,filePath){this._configs.push([jsonPath,filePath])};ResourceUtils.prototype.loadConfig=function($onConfigComplete,$onConfigCompleteTarget){this._onConfigComplete=$onConfigComplete;this._onConfigCompleteTarget=$onConfigCompleteTarget;this.loadNextConfig()};ResourceUtils.prototype.loadNextConfig=function(){if(this._configs.length==0){this._onConfigComplete.call(this._onConfigCompleteTarget);this._onConfigComplete=null;this._onConfigCompleteTarget=null;return}var arr=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this);RES.loadConfig(arr[0],arr[1])};ResourceUtils.prototype.onConfigCompleteHandle=function(event){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this);this.loadNextConfig()};ResourceUtils.prototype.loadGroup=function($groupName,$onResourceLoadComplete,$onResourceLoadProgress,$onResourceLoadTarget){this._groups[$groupName]=[$onResourceLoadComplete,$onResourceLoadProgress,$onResourceLoadTarget];RES.loadGroup($groupName)};ResourceUtils.prototype.loadGroups=function($groupName,$subGroups,$onResourceLoadComplete,$onResourceLoadProgress,$onResourceLoadTarget){RES.createGroup($groupName,$subGroups,true);this.loadGroup($groupName,$onResourceLoadComplete,$onResourceLoadProgress,$onResourceLoadTarget)};ResourceUtils.prototype.pilfererLoadGroup=function($groupName,$subGroups){if($subGroups===void 0){$subGroups=null}var useGroupName="pilferer_"+$groupName;if(!$subGroups){$subGroups=[$groupName]}RES.createGroup(useGroupName,$subGroups,true);RES.loadGroup(useGroupName,-1)};ResourceUtils.prototype.onResourceLoadComplete=function(event){var groupName=event.groupName;if(this._groups[groupName]){var loadComplete=this._groups[groupName][0];var loadCompleteTarget=this._groups[groupName][2];if(loadComplete!=null){loadComplete.call(loadCompleteTarget)}this._groups[groupName]=null;delete this._groups[groupName]}};ResourceUtils.prototype.onResourceLoadProgress=function(event){var groupName=event.groupName;if(this._groups[groupName]){var loadProgress=this._groups[groupName][1];var loadProgressTarget=this._groups[groupName][2];if(loadProgress!=null){loadProgress.call(loadProgressTarget,event.itemsLoaded,event.itemsTotal)}}};ResourceUtils.prototype.onResourceLoadError=function(event){Log.trace(event.groupName+" res group load failed");if(event.groupName=="realpreload2"){GameApp.ins().preload_load_count+=1;if(GameApp.ins().preload_load_count==1){Assert(false,event.groupName+" load failed count = "+GameApp.ins().preload_load_count)}if(GameApp.ins().preload_load_count<3){RES.loadGroup(event.groupName)}else{console.error(event.groupName+" res group load failed")}return}this.onResourceLoadComplete(event)};ResourceUtils.prototype.onItemLoadError=function(event){console.error("Url:"+event.resItem.url+" :333333 has failed to load")};ResourceUtils.prototype.loadResource=function($resources,$groups,$onResourceLoadComplete,$onResourceLoadProgress,$onResourceLoadTarget){if($resources===void 0){$resources=[]}if($groups===void 0){$groups=[]}if($onResourceLoadComplete===void 0){$onResourceLoadComplete=null}if($onResourceLoadProgress===void 0){$onResourceLoadProgress=null}if($onResourceLoadTarget===void 0){$onResourceLoadTarget=null}var needLoadArr=$resources.concat($groups);var groupName="loadGroup"+this._groupIndex++;RES.createGroup(groupName,needLoadArr,true);this._groups[groupName]=[$onResourceLoadComplete,$onResourceLoadProgress,$onResourceLoadTarget];RES.loadGroup(groupName)};ResourceUtils.prototype.loadUrlResource=function(url,type,compFun,thisObj){var _this=this;if(this._urlResorce[url]==null){this._urlResorce[url]={data:null,compFun:compFun,thisObj:thisObj};RES.getResByUrl(url,function(data){_this._urlResorce[url]["data"]=data;if(compFun!=null)compFun.apply(_this._urlResorce[url]["thisObj"])},this,type)}else if(compFun!=null)compFun.apply(thisObj)};ResourceUtils.prototype.getUrlResource=function(url){if(this._urlResorce[url]==null){debug.log("Res not loaded");return null}return this._urlResorce[url]["data"]};return ResourceUtils}(BaseClass);__reflect(ResourceUtils.prototype,"ResourceUtils");var FullDisplayUILayer=function(_super){__extends(FullDisplayUILayer,_super);function FullDisplayUILayer(){var _this=_super.call(this)||this;_this.addEventListener(egret.Event.ADDED_TO_STAGE,_this.onAddToStage,_this);_this.addEventListener(egret.Event.REMOVED_FROM_STAGE,_this.onRemoveFromStage,_this);return _this}FullDisplayUILayer.prototype.onAddToStage=function(event){this.$stage.addEventListener(egret.Event.RESIZE,this.onResize,this);this.onResize()};FullDisplayUILayer.prototype.onRemoveFromStage=function(event){this.$stage.removeEventListener(egret.Event.RESIZE,this.onResize,this)};FullDisplayUILayer.prototype.onResize=function(event){if(window["isSmallGame"]){this.onResizeWxGame()}else{this.onResizeNormal()}};FullDisplayUILayer.prototype.onResizeWxGame=function(){var stage=this.$stage;var w=stage.$stageWidth;var h=stage.$stageHeight;var cw=580;var ch=930;if(w/h>cw/ch){cw=Math.floor(ch*w/h)}else{ch=Math.floor(cw*h/w);var bh2w=.09;var w2h0=9/16;var w2h1=1/2;var topF=0;var w2h=w/h;var bh2h=bh2w*w2h;if(w2h>=w2h0){topF=0}else if(w2h<w2h0&&w2h>w2h1){topF=0+bh2h*(w2h-w2h0)/(w2h1-w2h0)}else{topF=bh2h}ch=Math.floor(cw*((h-topF*h*2)/w))}var bottomb=(h-ch)/2;var y=(h-ch)/2;try{var env=window["wx"];if(typeof env=="undefined"){env=window["qq"]}var mbb=env.getMenuButtonBoundingClientRect();var res=env.getSystemInfoSync();var upb=h*mbb.bottom/res.windowHeight;if(y<upb){y=upb;ch=h-upb-bottomb}}catch(e){}this.$setY(y);this.$setWidth(cw);this.$setHeight(ch)};FullDisplayUILayer.prototype.onResizeNormal=function(){var stage=this.$stage;var w=stage.$stageWidth;var h=stage.$stageHeight;var cw=580;var ch=930;if(w/h>cw/ch){cw=Math.floor(ch*w/h)}else{ch=Math.floor(cw*h/w);var bh2w=.09;var w2h0=9/16;var w2h1=1/2;var topF=0;var w2h=w/h;var bh2h=bh2w*w2h;if(w2h>=w2h0){topF=0}else if(w2h<w2h0&&w2h>w2h1){topF=0+bh2h*(w2h-w2h0)/(w2h1-w2h0)}else{topF=bh2h}ch=Math.floor(cw*((h-topF*h*2)/w))}this.$setY((h-ch)/2);this.$setWidth(cw);this.$setHeight(ch)};return FullDisplayUILayer}(eui.Group);__reflect(FullDisplayUILayer.prototype,"FullDisplayUILayer");var StageUtils=function(_super){__extends(StageUtils,_super);function StageUtils(){var _this=_super.call(this)||this;if(StageUtils._uiStage==null){StageUtils._uiStage=new FullDisplayUILayer;StageUtils._uiStage.touchEnabled=false;StageUtils._uiStage.percentHeight=100;StageUtils._uiStage.percentWidth=100;_this.getStage().addChild(StageUtils._uiStage)}return _this}StageUtils.ins=function(){return _super.ins.call(this)};StageUtils.prototype.getHeight=function(){return this.getStage().stageHeight};StageUtils.prototype.getWidth=function(){return this.getStage().stageWidth};StageUtils.prototype.setTouchChildren=function(value){this.getStage().touchChildren=value};StageUtils.prototype.setMaxTouches=function(value){this.getStage().maxTouches=value};StageUtils.prototype.setFrameRate=function(value){this.getStage().frameRate=value};StageUtils.prototype.setScaleMode=function(value){this.getStage().scaleMode=value};StageUtils.prototype.getStage=function(){return egret.MainContext.instance.stage};StageUtils.prototype.getUIStage=function(){return StageUtils._uiStage};return StageUtils}(BaseClass);__reflect(StageUtils.prototype,"StageUtils");var StringUtils=function(){function StringUtils(){}StringUtils.trimSpace=function(str){return str.replace(/^\s*(.*?)[\s\n]*$/g,"$1")};StringUtils.getStringLength=function(str){var strArr=str.split("");var length=0;for(var i=0;i<strArr.length;i++){var s=strArr[i];if(this.isChinese(s)){length+=2}else{length+=1}}return length};StringUtils.isChinese=function(str){var reg=/^[\u4E00-\u9FA5]+$/;if(!reg.test(str)){return true}return false};StringUtils.strByteLen=function(str){var byteLen=0;var strLen=str.length;for(var i=0;i<strLen;i++){byteLen+=str.charCodeAt(i)>=127?2:1}return byteLen};StringUtils.complementByChar=function(str,length,char,ignoreHtml){if(char===void 0){char=" "}if(ignoreHtml===void 0){ignoreHtml=true}var byteLen=this.strByteLen(ignoreHtml?str.replace(StringUtils.HTML,""):str);return str+this.repeatStr(char,length-byteLen)};StringUtils.repeatStr=function(str,count){var s="";for(var i=0;i<count;i++){s+=str}return s};StringUtils.addColor=function(content,color){var colorStr;if(typeof color=="string")colorStr=String(color);else if(typeof color=="number")colorStr=Number(color).toString(10);return'<font color="'+colorStr+'">'+content+"</font>"};StringUtils.addColor1=function(content,color){var obj=new Object;obj["style"]=new Object;obj["text"]=content;obj["textColor"]=Number(color).toString(16);return obj};StringUtils.substitute=function(str){var rest=[];for(var _i=1;_i<arguments.length;_i++){rest[_i-1]=arguments[_i]}var reg=RegExpUtil.REPLACE_STRING;var replaceReg=str.match(reg);if(replaceReg&&replaceReg.length){var len=replaceReg.length;for(var t_i=0;t_i<len;t_i++){str=str.replace(replaceReg[t_i],rest[t_i])}}return str};StringUtils.replaceStr=function(src,tar,des){if(src.indexOf(tar)==-1)return src;var list=src.split(tar);return list[0]+des+list[1]};StringUtils.replaceStrColor=function(src,color){var tci=src.indexOf("0x");var tci2=tci;var arghr2="";var arghr3="";while(tci2!=-1){arghr2=src.substring(tci,tci+8);src=src.replace(arghr2,color);tci+=8;arghr3=src.substring(tci);tci2=arghr3.indexOf("0x");tci=tci+tci2}return src};StringUtils.replace=function(str){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}for(var i=0;i<args.length;i++){str=str.replace("%s",args[i]+"")}return str};StringUtils.getStrByRegExp=function(src,reg){if(reg===void 0){reg=/\d+/g}var newStrlist=[];var newStr=src.replace(reg,function(){newStrlist.push(arguments[0]);if(typeof arguments[0]=="number")return arguments[0].toString();else return arguments[0]});return newStrlist};StringUtils.ChineseToNumber=function(chnStr){var rtn=0;var section=0;var number=0;var secUnit=false;var str=chnStr.split("");for(var i=0;i<str.length;i++){var num=StringUtils.chnNumCharCN[str[i]];if(typeof num!=="undefined"){number=num;if(i===str.length-1){section+=number}}else{var unit=StringUtils.chnNameValueCN[str[i]].value;secUnit=StringUtils.chnNameValueCN[str[i]].secUnit;if(secUnit){section=(section+number)*unit;rtn+=section;section=0}else{section+=number*unit}number=0}}return rtn+section};StringUtils.NumberToChinese=function(num){var unitPos=0;var strIns="",chnStr="";var needZero=false;var chnNumChar=StringUtils.chnNumChar;var chnUnitSection=StringUtils.chnUnitSection;if(num===0){return chnNumChar[0]}while(num>0){var section=num%1e4;if(needZero){chnStr=chnNumChar[0]+chnStr}strIns=StringUtils.SectionToChinese(section);strIns+=section!==0?chnUnitSection[unitPos]:chnUnitSection[0];chnStr=strIns+chnStr;needZero=section<1e3&&section>0;num=Math.floor(num/1e4);unitPos++}return chnStr};StringUtils.SectionToChinese=function(section){var strIns="",chnStr="";var unitPos=0;var zero=true;var chnNumChar=StringUtils.chnNumChar;var chnUnitChar=StringUtils.chnUnitChar;while(section>0){var v=section%10;if(v===0){if(!zero){zero=true;chnStr=chnNumChar[v]+chnStr}}else{zero=false;strIns=chnNumChar[v];strIns+=chnUnitChar[unitPos];chnStr=strIns+chnStr}unitPos++;section=Math.floor(section/10)}return chnStr};StringUtils.getTextWidth=function(text,fontsize,fontFamily){var canvas=this.tCanvas||(this.tCanvas=document.createElement("canvas"));var context=canvas.getContext("2d");context.font=fontsize+"px "+fontFamily;var metrics=context.measureText(text);return Math.floor(metrics.width)};StringUtils.HTML=/<[^>]+>/g;StringUtils.chnNumCharCN={"零":0,"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9};StringUtils.chnNameValueCN={"十":{value:10,secUnit:false},"百":{value:100,secUnit:false},"千":{value:1e3,secUnit:false},"万":{value:1e4,secUnit:true},"亿":{value:1e8,secUnit:true}};StringUtils.chnNumChar=["零","一","二","三","四","五","六","七","八","九"];StringUtils.chnUnitSection=["","万","亿","万亿","亿亿"];StringUtils.chnUnitChar=["","十","百","千"];StringUtils.tCanvas=null;return StringUtils}();__reflect(StringUtils.prototype,"StringUtils");var TextFlowMaker=function(){function TextFlowMaker(){}TextFlowMaker.generateTextFlow=function(sourceText,isNotice){if(isNotice===void 0){isNotice=false}if(!sourceText){return(new egret.HtmlTextParser).parser("")}var textArr=sourceText.split("|");var str="";var result;for(var i=0,len=textArr.length;i<len;i++){str+=TextFlowMaker.getSingleTextFlow1(textArr[i],isNotice)}try{result=(new egret.HtmlTextParser).parser(str)}catch(e){console.log(i18n("TextFlowMaker_22"));return(new egret.HtmlTextParser).parser("")}return result};TextFlowMaker.generateTextFlow1=function(sourceText){if(!sourceText){return(new egret.HtmlTextParser).parser("")}var textArr=sourceText.split("|");var result=[];for(var i=0,len=textArr.length;i<len;i++){var ele=TextFlowMaker.getSingleTextFlow(textArr[i]);if(ele.text&&ele.text!="")result.push(ele)}return result};TextFlowMaker.getSingleTextFlow1=function(text,isNotice){if(isNotice===void 0){isNotice=false}var arrText=text.split("&T:",2);if(arrText.length==2){var str="<font";var textArr=arrText[0].split("&");var tempArr=void 0;var t=void 0;var underline=false;for(var i=0,len=textArr.length;i<len;i++){tempArr=textArr[i].split(":");switch(tempArr[0]){case TextFlowMaker.STYLE_SIZE:str+=' size="'+Math.floor(+tempArr[1])+'"';break;case TextFlowMaker.STYLE_COLOR:str+=' color="'+Math.floor(+tempArr[1])+'"';break;case TextFlowMaker.UNDERLINE_TEXT:underline=true;break}}if(underline){str+="><u>"+arrText[1]+"</u></font>"}else{str+=">"+arrText[1]+"</font>"}return str}else{if(isNotice){return"<font color=0x405573 size=20 >"+text+"</font>"}else{return'<font" >'+text+"</font>"}}};TextFlowMaker.getSingleTextFlow=function(text){var arrText=text.split("&T:",2);var textFlow={style:{}};if(arrText.length==2){var style=arrText[0];var textArr=text.split("&");var tempArr=void 0;for(var i=0,len=textArr.length;i<len;i++){tempArr=textArr[i].split(":");switch(tempArr[0]){case TextFlowMaker.STYLE_SIZE:textFlow.style.size=+tempArr[1];break;case TextFlowMaker.STYLE_COLOR:textFlow.style.textColor=+tempArr[1];break;case TextFlowMaker.UNDERLINE_TEXT:textFlow.style.underline=true;break;case TextFlowMaker.BOLD:textFlow.style.bold=true;break;case TextFlowMaker.EVENT:textFlow.style.href="event:"+tempArr[1];break}}textFlow.text=arrText[1]}else{textFlow.text=text}return textFlow};TextFlowMaker.getCStr=function(num){if(TextFlowMaker.numberList[num]){return TextFlowMaker.numberList[num]}else{return""}};TextFlowMaker.STYLE_COLOR="C";TextFlowMaker.STYLE_SIZE="S";TextFlowMaker.PROP_TEXT="T";TextFlowMaker.UNDERLINE_TEXT="U";TextFlowMaker.EVENT="E";TextFlowMaker.BOLD="B";TextFlowMaker.numberList=["零","一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十"];return TextFlowMaker}();__reflect(TextFlowMaker.prototype,"TextFlowMaker");var uint64=function(){function uint64(v){this._lowUint=0;this._highUint=0;this.value=v}uint64.prototype.isEqual=function(target){if(!target)return false;return this._lowUint==target._lowUint&&this._highUint==target._highUint};uint64.prototype.isGreaterThan=function(target){if(target instanceof uint64)return this._highUint>target._highUint||this._highUint==target._highUint&&this._lowUint>target._lowUint;else{var u64=new uint64;if(typeof target=="string"){u64.value=target;return this.isGreaterThanOrEqual(u64)}if(typeof target=="number"){u64.value=target.toString();return this.isGreaterThanOrEqual(u64)}}};uint64.prototype.isGreaterThanOrEqual=function(target){if(target instanceof uint64)return this._highUint>target._highUint||this._highUint==target._highUint&&this._lowUint>=target._lowUint;else{var u64=new uint64;if(typeof target=="string"){u64.value=target;return this.isGreaterThanOrEqual(u64)}if(typeof target=="number"){u64.value=target.toString();return this.isGreaterThanOrEqual(u64)}}};Object.defineProperty(uint64.prototype,"isZero",{get:function(){return this._lowUint==0&&this._highUint==0},enumerable:true,configurable:true});Object.defineProperty(uint64.prototype,"isGreaterThanZero",{get:function(){return this._lowUint>0||this._highUint>0},enumerable:true,configurable:true});uint64.prototype.writeByte=function(b){b.writeUnsignedInt(this._lowUint);b.writeUnsignedInt(this._highUint)};uint64.prototype.setValue=function(lowerUint,higherUint){if(lowerUint===void 0){lowerUint=0}if(higherUint===void 0){higherUint=0}this._lowUint=lowerUint;this._highUint=higherUint};Object.defineProperty(uint64.prototype,"value",{set:function(v){if(v instanceof egret.ByteArray){this._lowUint=v.readUnsignedInt();this._highUint=v.readUnsignedInt()}else if(typeof v=="string"){uint64.stringToUint64(v,10,this)}},enumerable:true,configurable:true});Object.defineProperty(uint64.prototype,"valueByString",{set:function(value){var num=0},enumerable:true,configurable:true});uint64.prototype.leftMove=function(num,result){if(result===void 0){result=null}result=result||this;var bitMask=uint64.LeftMoveMask[num];var lowUintMaskNum=bitMask&this._lowUint;lowUintMaskNum=lowUintMaskNum>>>32-num;result._lowUint=this._lowUint<<num;result._highUint=this._highUint<<num;result._highUint=result._highUint|lowUintMaskNum};uint64.prototype.add=function(value,result){if(result===void 0){result=null}result=result||this;var num=this._lowUint+value._lowUint;result._highUint=this._highUint+value._highUint;if(num>=uint64.MaxLowUint){result._highUint++;result._lowUint=num-uint64.MaxLowUint}else{result._lowUint=num}};uint64.prototype.subtraction=function(value,result){if(result===void 0){result=null}result=result||this;var num=this._lowUint-value._lowUint;result._highUint=this._highUint-value._highUint;if(num<0){result._highUint--;result._lowUint=num+uint64.MaxLowUint}else{result._lowUint=num}};uint64.prototype.scale=function(value,result){if(result===void 0){result=null}result=result||this;var num=this._lowUint*value;result._highUint=this._highUint*value;result._highUint+=Math.floor(Math.abs(num/uint64.MaxLowUint));result._lowUint=num%uint64.MaxLowUint};uint64.prototype.toString=function(radix){if(radix===void 0){radix=10}var result="";var lowUint=this._lowUint;var highUint=this._highUint;var highRemain;var lowRemain;var tempNum;while(highUint!=0||lowUint!=0){highRemain=highUint%radix;tempNum=highRemain*uint64.MaxLowUint+lowUint;lowRemain=tempNum%radix;result=lowRemain+result;highUint=(highUint-highRemain)/radix;lowUint=(tempNum-lowRemain)/radix}return result.length?result:"0"};uint64.stringToUint64=function(value,radix,result){if(radix===void 0){radix=10}if(result===void 0){result=null}result=result||new uint64;var lowUint=0;var highUint=0;var tempNum;var len=value.length;var char;for(var i=0;i<len;i++){char=parseInt(value.charAt(i));tempNum=lowUint*radix+char;highUint=highUint*radix+Math.floor(tempNum/uint64.MaxLowUint);lowUint=tempNum%uint64.MaxLowUint}result.setValue(lowUint,highUint);return result};uint64.LeftMoveMask=[0,2147483648,1073741824,536870912,268435456,134217728,67108864,33554432,16777216,8388608,4194304,2097152,1048576,524288,262144,131072,65536,32768,16384,8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1];uint64.MaxLowUint=4294967295+1;return uint64}();__reflect(uint64.prototype,"uint64");var WatcherUtil=function(){function WatcherUtil(){}WatcherUtil.removeFromArrayCollection=function(dataPro){if(dataPro&&dataPro.source&&dataPro.source.length){WatcherUtil.removeFromArray(dataPro.source)}};WatcherUtil.removeFromArray=function(dataPro){if(!dataPro)return;for(var _i=0,dataPro_1=dataPro;_i<dataPro_1.length;_i++){var source=dataPro_1[_i];WatcherUtil.removeFromObject(source)}};WatcherUtil.removeFromObject=function(obj){if(obj instanceof egret.EventDispatcher){var event_1=obj.$getEventMap();var list=event_1[eui.PropertyEvent.PROPERTY_CHANGE];if(list){for(var index=list.length-1;index>=0;index--){var obj_1=list[index];if(obj_1.thisObject instanceof eui.Watcher){obj_1.thisObject.unwatch();list.splice(index,1)}}}}else{var listeners=obj["__listeners__"];if(listeners&&listeners.length){for(var i=0;i<listeners.length;i+=2){var target=listeners[i+1];if(target instanceof eui.Watcher){target.unwatch();i-=2}}}}};return WatcherUtil}();__reflect(WatcherUtil.prototype,"WatcherUtil");var AssetAdapter=function(){function AssetAdapter(){}AssetAdapter.prototype.getAsset=function(source,compFunc,thisObject){function onGetRes(data){compFunc.call(thisObject,data,source)}if(RES.hasRes(source)){var data=RES.getRes(source);if(data){onGetRes(data)}else{RES.getResAsync(source,onGetRes,this)}}else{RES.getResByUrl(source,onGetRes,this,RES.ResourceItem.TYPE_IMAGE)}};return AssetAdapter}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var DelayOptManager=function(_super){__extends(DelayOptManager,_super);function DelayOptManager(){var _this=_super.call(this)||this;_this.TIME_THRESHOLD=2;_this._delayOpts=[];egret.startTick(_this.runCachedFun,_this);return _this}DelayOptManager.ins=function(){return _super.ins.call(this)};DelayOptManager.prototype.addDelayOptFunction=function(thisObj,fun,funPara,callBack,para){this._delayOpts.push({fun:fun,funPara:funPara,thisObj:thisObj,callBack:callBack,para:para})};DelayOptManager.prototype.clear=function(){this._delayOpts.length=0};DelayOptManager.prototype.runCachedFun=function(time){if(this._delayOpts.length==0){return false}var timeFlag=egret.getTimer();var funObj;while(this._delayOpts.length){funObj=this._delayOpts.shift();if(funObj.funPara)funObj.fun.call(funObj.thisObj,funObj.funPara);else funObj.fun.call(funObj.thisObj);if(funObj.callBack){if(funObj.para!=undefined)funObj.callBack.call(funObj.thisObj,funObj.para);else funObj.callBack()}if(egret.getTimer()-timeFlag>this.TIME_THRESHOLD)break}return false};return DelayOptManager}(BaseClass);__reflect(DelayOptManager.prototype,"DelayOptManager");var FrameTick=function(){function FrameTick(){this.list=[]}FrameTick.prototype.tick=function(idx){this.list[idx]=TimerManager.ins().getFrameId()};FrameTick.prototype.isTick=function(idx){return this.list[idx]==TimerManager.ins().getFrameId()};FrameTick.prototype.checkAndTick=function(idx){if(this.isTick(idx)){return true}else{this.tick(idx);return false}};return FrameTick}();__reflect(FrameTick.prototype,"FrameTick");var BaseSpriteView=function(_super){__extends(BaseSpriteView,_super);function BaseSpriteView($parent){var _this=_super.call(this)||this;_this._resources=null;_this._myParent=$parent;_this._isInit=false;StageUtils.ins().getStage().addEventListener(egret.Event.RESIZE,_this.onResize,_this);return _this}BaseSpriteView.prototype.setResources=function(resources){this._resources=resources};Object.defineProperty(BaseSpriteView.prototype,"myParent",{get:function(){return this._myParent},enumerable:true,configurable:true});BaseSpriteView.prototype.isInit=function(){return this._isInit};BaseSpriteView.prototype.isShow=function(){return this.stage!=null&&this.visible};BaseSpriteView.prototype.addToParent=function(){this._myParent.addChild(this)};BaseSpriteView.prototype.removeFromParent=function(){DisplayUtils.removeFromParent(this)};BaseSpriteView.prototype.initUI=function(){this._isInit=true};BaseSpriteView.prototype.initData=function(){};BaseSpriteView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};BaseSpriteView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};BaseSpriteView.prototype.destroy=function(){this._myParent=null;this._resources=null;StageUtils.ins().getStage().removeEventListener(egret.Event.RESIZE,this.onResize,this)};BaseSpriteView.prototype.onResize=function(){};BaseSpriteView.prototype.loadResource=function(loadComplete,initComplete){if(this._resources&&this._resources.length>0){ResourceUtils.ins().loadResource(this._resources,[],function(){loadComplete();initComplete()},null,this)}else{loadComplete();initComplete()}};BaseSpriteView.prototype.setVisible=function(value){this.visible=value};BaseSpriteView.openCheck=function(){return true};return BaseSpriteView}(egret.DisplayObjectContainer);__reflect(BaseSpriteView.prototype,"BaseSpriteView",["IBaseView"]);var IOS_AppStore_LocalRes=function(){function IOS_AppStore_LocalRes(){}IOS_AppStore_LocalRes.isLocalRes=function(url){if(window["isIOS_AppStore"]==true){return true}return false};return IOS_AppStore_LocalRes}();__reflect(IOS_AppStore_LocalRes.prototype,"IOS_AppStore_LocalRes");var GameApp=function(_super){__extends(GameApp,_super);function GameApp(){var _this=_super.call(this)||this;_this.preload_load_count=0;_this.map_load_count=0;return _this}GameApp.downloadRes=function(url,callback){if(url=="realpreloadmap"){RES.loadGroup(url)}else{RES.getResByUrl(url,callback,this)}};GameApp.startGameResPreload=function(){if(this.gameResPreloading){return}this.gameResPreloading=true;var reslist=["realpreloadmap","resource/map/map001/small.jpg","resource/map/maps.json"];var loaded=0;var downloadFromList=function(list){if(loaded<list.length&&GameApp.gameResPreloading){GameApp.downloadRes(list[loaded],function(){downloadFromList(list)});loaded+=1}};for(var i=0;i<3;++i){downloadFromList(reslist)}};GameApp.stopGameResPreload=function(){this.gameResPreloading=false};GameApp.ins=function(){return _super.ins.call(this)};GameApp.prototype.load=function(){ViewManager.ins().open(ConnectingWin);window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["GameApp_loadStart",Date.now()]);if(LocationProperty.isFirstLoad){ResourceUtils.ins().loadGroup("firstLoad",this.complete,this.progress,this)}else{var lang=window["wlmzlang"]||"";ResourceUtils.ins().loadGroups("realpreload2",["realpreload","config"+lang],this.complete,this.progress,this)}};GameApp.prototype.complete=function(){var _this=this;window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["GameApp_complete",Date.now()]);RES.getResByUrl(MAP_DIR+"maps.json",function(data){window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["GameApp_mapsJson",Date.now()]);_this.map_load_count+=1;if(Assert(data,i18n("GameApp_0",_this.map_load_count))){if(_this.map_load_count<3){_this.complete()}else{alert(i18n("GameApp_1"))}return}Assert(_this.map_load_count==1,i18n("GameApp_2",_this.map_load_count));ReportData.getIns().report("loaded",ReportData.LOAD);for(var i_2 in GameSystem){GameSystem[i_2]()}GlobalConfig.init();GameMap.init(data);RoleMgr.ins().connectServer();eui.Label.default_fontFamily=i18n("GameApp_4");RoleAI.ins().init();window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["GameApp_mapsJson2",Date.now()]);var logTimes=[];var llogs=window["lauchLogs"];for(var i=0,c=llogs.length;i<c-1;++i){logTimes.push([llogs[i+1][0],llogs[i+1][1]-llogs[i][1]])}logTimes.sort(function(a,b){return b[1]-a[1]});var sLogTimes="";for(var _i=0,logTimes_1=logTimes;_i<logTimes_1.length;_i++){var lt=logTimes_1[_i];sLogTimes+=lt[0]+" = "+lt[1]+"\n"}if(LocationProperty.isFirstLoad){var lang=window["wlmzlang"]||"";ResourceUtils.ins().loadGroups("realpreload2",["realpreload","config"+lang],GameApp.ins().doPerLoadComplete,GameApp.ins().postPerLoadProgress,_this)}},this)};GameApp.prototype.progress=function(itemsLoaded,itemsTotal){};GameApp.prototype.postPerLoadProgress=function(itemsLoaded,itemsTotal){return[itemsLoaded,itemsTotal]};GameApp.prototype.doPerLoadComplete=function(){GlobalConfig.init();this.postPerLoadComplete();window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["GameAppdoPerLoadComplete",Date.now()])};GameApp.prototype.postPerLoadComplete=function(){};GameApp.prototype.postLoginInit=function(){};GameApp.prototype.postZeroInit=function(){};GameApp.gameResPreloading=false;return GameApp}(BaseClass);__reflect(GameApp.prototype,"GameApp");MessageCenter.compile(GameApp);var AIUtil=function(_super){__extends(AIUtil,_super);function AIUtil(){return _super!==null&&_super.apply(this,arguments)||this}AIUtil.ins=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}return _super.ins.call(this,args)};AIUtil.prototype.userSkill=function(self,enemy,skill,hitFun){if(hitFun===void 0){hitFun=null}if(self!=enemy){self.dir=DirUtil.get8DirBy2Point(self,enemy)}if(!skill)return false;GameLogic.ins().playSkillEff(skill,self,[enemy],hitFun);if(!SoundUtil.WINDOW_OPEN&&skill.sound&&self.team==Team.My){SoundUtil.ins().playEffect(skill.sound)}return true};AIUtil.prototype.hram=function(self,enemy,type,damage){if(damage===void 0){damage=0}enemy.hram(damage);GameLogic.ins().postEntityHpChange(enemy,self,type,damage);if(enemy.getHP()<=0){if(this.relive(enemy)){return}}};AIUtil.prototype.relive=function(enemy){if(enemy instanceof CharRole&&!enemy.hasBuff(52001)){var stunp=enemy.infoModel.attributeExData[ExAttributeType.eatGodBlessProbability];var r=Math.random();if(r<stunp/1e4){enemy.reset();enemy.removeAllBuff();r=enemy.infoModel.getAtt(AttributeType.atMaxHp)*enemy.infoModel.attributeExData[ExAttributeType.eatGodBlessRate]/1e4;enemy.hram(r);return true}}return false};AIUtil.dead=function(target,callback){if(callback===void 0){callback=null}target.AI_STATE=AI_State.Die;var em=EntityManager.ins();em.removeByHandle(target.infoModel.handle,false,GameMap.fbType==UserFb.FB_TYPE_EXP);TimerManager.ins().doTimer(5e3,1,function(){DisplayUtils.removeFromParent(target);if(callback){callback()}},this)};return AIUtil}(BaseClass);__reflect(AIUtil.prototype,"AIUtil");var ExSkillAiLogic=function(_super){__extends(ExSkillAiLogic,_super);function ExSkillAiLogic(){var _this=_super.call(this)||this;_this.ZL_SKILL_DEVIL=0;_this.ZL_SKILL_EXPLOSION=1;_this.ZL_SKILL_KILL=2;_this.ZL_SKILL_SACRIFICE=3;_this.ZL_SKILL_RELIEF=4;_this.ZL_SKILL_ANGER=5;_this.ZL_H_SKILL_DETER=6;_this.ZL_H_SKILL_ANTICIPATI=7;_this.ZL_SKILL_REMEDY=8;_this.ZL_SKILL_RENJIA=9;_this.MAX=10;_this.triggerInterval={};return _this}ExSkillAiLogic.ins=function(){return _super.ins.call(this)};ExSkillAiLogic.prototype.checkWarSpiritBubbleTrigger=function(){if(ZhanLingModel.ins().ZhanLingOpen()){for(var key in GlobalConfig.ZhanLingBase){var base=GlobalConfig.ZhanLingBase[key];var zlData=ZhanLingModel.ins().getZhanLingDataById(base.id);if(!zlData)continue;switch(base.talent){case this.ZL_SKILL_DEVIL:if(!GlobalConfig.ZhanLingLevel[base.id][zlData.level])break;var talentLv=GlobalConfig.ZhanLingLevel[base.id][zlData.level].talentLevel;var dp=GlobalConfig.ZhanLingTalent[base.talent][talentLv];if(dp){if(GameLogic.triggerValue(dp.rate)){UserSkill.ins().postShowSkillWord(dp.showWords);for(var i=0;i<SubRoles.ins().subRolesLen;i++){var myChar=EntityManager.ins().getMainRole(i);if(myChar){var buff=EntityBuff.createBuff(dp.effId,myChar);myChar.addBuff(buff)}}}}break;case this.ZL_SKILL_REMEDY:talentLv=ZhanLingModel.ins().getZhanLingDataByTalentLv(base.id);dp=GlobalConfig.ZhanLingTalent[base.talent][talentLv];if(GameLogic.triggerValue(dp.rate)){for(var i=0;i<SubRoles.ins().subRolesLen;i++){var myChar=EntityManager.ins().getMainRole(i);if(myChar){var buff=EntityBuff.createBuff(dp.effId,myChar);myChar.addBuff(buff)}}}break}}}};ExSkillAiLogic.prototype.checkHJTrigger=function(source,targets){if(ZhanLingModel.ins().ZhanLingOpen()){if(!source||!targets[0])return;var hp=source.getHP();var maxHp=source.infoModel.getAtt(AttributeType.atMaxHp);var isTrigger=false;var isAttacck=source.infoModel.team==Team.My&&source instanceof CharRole;for(var key in GlobalConfig.ZhanLingBase){var base=GlobalConfig.ZhanLingBase[key];var zlData=ZhanLingModel.ins().getZhanLingDataById(base.id);if(!zlData)continue;switch(base.talent){case this.ZL_H_SKILL_DETER:if(isAttacck){var talentLv=ZhanLingModel.ins().getZhanLingDataByTalentLv(base.id);var dp_1=GlobalConfig.ZhanLingTalent[base.talent][talentLv];if(!dp_1)break;for(var i=0;i<SubRoles.ins().subRolesLen;i++){var myChar=EntityManager.ins().getMainRole(i);if(myChar){var _loop_2=function(passive){if(!passive.type||passive.type==myChar.infoModel.job){var skillDp=new SkillData(passive.id);this_2.intervalDoFun(source.infoModel.handle+passive.id+base.talent,skillDp.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(source,passive.id,true)})}};var this_2=this;for(var _i=0,_a=dp_1.passive;_i<_a.length;_i++){var passive=_a[_i];_loop_2(passive)}}}}break;case this.ZL_H_SKILL_ANTICIPATI:var dp=GlobalConfig.ZhanLingTalent[base.talent][1];if(GameLogic.triggerValue(dp.rate)){}break}}}};ExSkillAiLogic.prototype.checkDieTrigger=function(source,targets){if(ZhanLingModel.ins().ZhanLingOpen()){if(!source||!targets[0])return;var hp=source.getHP();var maxHp=source.infoModel.getAtt(AttributeType.atMaxHp);var isTrigger=false;var isAttacck=source.infoModel.team==Team.My&&source instanceof CharRole;for(var key in GlobalConfig.ZhanLingBase){var base=GlobalConfig.ZhanLingBase[key];var zlData=ZhanLingModel.ins().getZhanLingDataById(base.id);if(!zlData)continue;var talentLv=ZhanLingModel.ins().getZhanLingDataByTalentLv(base.id);var dp=GlobalConfig.ZhanLingTalent[base.talent][talentLv];if(!dp)continue;switch(base.talent){case this.ZL_SKILL_KILL:if(isAttacck){for(var i=0;i<SubRoles.ins().subRolesLen;i++){var myChar=EntityManager.ins().getMainRole(i);if(myChar&&myChar.infoModel.handle!=source.infoModel.handle){var _loop_3=function(passive){if(!passive.type||passive.type==myChar.infoModel.job){var skillDp=new SkillData(passive.id);this_3.intervalDoFun(source.infoModel.handle+passive.id+base.id,skillDp.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(source,passive.id,true)})}};var this_3=this;for(var _i=0,_a=dp.passive;_i<_a.length;_i++){var passive=_a[_i];_loop_3(passive)}}}}break;case this.ZL_SKILL_EXPLOSION:if(!isAttacck&&targets[0]&&targets[0].infoModel.team==Team.My){for(var _b=0,_c=dp.passive;_b<_c.length;_b++){var passive=_c[_b];if(!passive.type||targets[0].infoModel.job==passive.type){var skillDp=new SkillData(passive.id);for(var i=0;i<SubRoles.ins().subRolesLen;i++){var myChar=EntityManager.ins().getMainRole(i);if(!myChar||myChar.infoModel.handle==targets[0].infoModel.handle)break;var skillDp_1=new SkillData(passive.id);if(skillDp_1.tarEff&&skillDp_1.tarEff.length>0){for(var _d=0,_e=skillDp_1.tarEff;_d<_e.length;_d++){var effid=_e[_d];var buff=EntityBuff.createBuff(effid,myChar);myChar.addBuff(buff)}}}}}}break;case this.ZL_SKILL_SACRIFICE:if(!isAttacck&&targets[0]&&targets[0].infoModel.team==Team.My&&targets[0].infoModel.job==JobConst.ZhanShi){var _loop_4=function(passive){if(!passive.type||passive.type==source.infoModel.job){var skillDp=new SkillData(passive.id);this_4.intervalDoFun(source.infoModel.handle+passive.id+base.id,skillDp.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(source,passive.id,true)})}};var this_4=this;for(var _f=0,_g=dp.passive;_f<_g.length;_f++){var passive=_g[_f];_loop_4(passive)}}break;case this.ZL_SKILL_ANGER:if(!isAttacck&&targets[0]&&targets[0].infoModel.team==Team.My&&targets[0].infoModel.job==JobConst.FaShi){var _loop_5=function(passive){if(!passive.type||passive.type==source.infoModel.job){var skillDp=new SkillData(passive.id);this_5.intervalDoFun(source.infoModel.handle+passive.id+base.id,skillDp.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(source,passive.id,true)})}};var this_5=this;for(var _h=0,_j=dp.passive;_h<_j.length;_h++){var passive=_j[_h];_loop_5(passive)}}break}}}};ExSkillAiLogic.prototype.checkHPTrigger=function(target,sourceTarget){if(ZhanLingModel.ins().ZhanLingOpen()){if(!target||!sourceTarget)return;var hp=target.getHP();var maxHp=target.infoModel.getAtt(AttributeType.atMaxHp);var isTrigger=false;var isAttacck=target.infoModel.team==Team.My&&target instanceof CharRole;var _loop_6=function(key){var base=GlobalConfig.ZhanLingBase[key];var zlData=ZhanLingModel.ins().getZhanLingDataById(base.id);if(!zlData)return"continue";switch(base.talent){case this_6.ZL_SKILL_RELIEF:break;case this_6.ZL_SKILL_RENJIA:if(isAttacck){var id=0;var skillList=ZhanLingModel.ins().getZhanLingDataBySkill(id);var zlDt=ZhanLingModel.ins().getZhanLingDataById(id);var passiveId_1=0;for(var k in skillList){if(zlDt.level>=skillList[k].open){if(skillList[k].id==1){passiveId_1=GlobalConfig.ZhanLingSkill[skillList[k].id].passive}else if(skillList[k].id==4){passiveId_1=GlobalConfig.ZhanLingSkill[skillList[k].id].passivePlus}}}if(passiveId_1>0){var skillDp=new SkillData(passiveId_1);if(hp/maxHp<skillDp.config.passive.p1/1e4){this_6.intervalDoFun(target.infoModel.handle+passiveId_1+id,skillDp.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(target,passiveId_1,true)})}}}break}};var this_6=this;for(var key in GlobalConfig.ZhanLingBase){_loop_6(key)}}};ExSkillAiLogic.prototype.intervalDoFun=function(indx,cd,fun){if(this.triggerInterval[indx]==undefined)this.triggerInterval[indx]=egret.getTimer();if(egret.getTimer()-this.triggerInterval[indx]>=0){fun()}this.triggerInterval[indx]=egret.getTimer()+cd};return ExSkillAiLogic}(BaseClass);__reflect(ExSkillAiLogic.prototype,"ExSkillAiLogic");var RoleAI=function(_super){__extends(RoleAI,_super);function RoleAI(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.aiList={};_this.zhanlingTime=0;_this.zhanlingdelayTime=0;_this.isFindDrop=false;_this.inStoryMode=false;_this.storyModeTime=0;_this.dieTimes={};_this.isLog=false;return _this}RoleAI.ins=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}return _super.ins.call(this,args)};RoleAI.prototype.init=function(){this.stop();this.skillCD={};this.attrCD={};this.attrValue={};this.inited=true};RoleAI.prototype.setStoryMode=function(storyMode){if(!this.inStoryMode&&storyMode){this.storyModeTime=egret.getTimer()}this.inStoryMode=storyMode;var list=this.aiList;for(var i in list){var selfTarget=list[i];selfTarget.visible=!storyMode}var trailings=GameSceneView.instance.map.trailings;for(var k in trailings){var trailing=trailings[k];trailing.visible=!storyMode}if(!storyMode){GameSceneView.instance.map.onExitStoryMode()}};RoleAI.prototype.start=function(){this.isStartAtk=false;GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_FIND_ENMENY);this.teamAction={};if(this.starting)return;if(!this.inited)this.init();this.addAITimer()};RoleAI.prototype.togglePause=function(){};RoleAI.prototype.stop=function(){if(this.inited){this.stopAITimer()}this.skillCD={};for(var handle in this.curSkill){if(this.curSkill[handle])ObjectPool.push(this.curSkill[handle])}this.curSkill={};this.curTarget={};this.lastTarget={};this.skillCastType={};this.skillTargetType={};this.hashHpObj={};this.attrCD={};this.attrValue={}};RoleAI.prototype.clearTarget=function(target){if(target&&target.infoModel){var handle=target.infoModel.handle;delete this.skillCD[handle];var skill=this.curSkill[handle];if(skill){ObjectPool.push(skill)}delete this.curSkill[handle];delete this.curTarget[handle];delete this.lastTarget[handle];delete this.skillCastType[handle];delete this.skillTargetType[handle];for(var key in this.curTarget){if(this.curTarget[key]==target){delete this.curTarget[key]}}for(var key in this.lastTarget){if(key+""==handle+""){delete this.lastTarget[key]}}}};RoleAI.prototype.clearAIList=function(){this.aiList={}};RoleAI.prototype.clear=function(){this.stop();this.clearAIList();this.isFindDrop=false;TimerManager.ins().removeAll(this);ShapeShiftingMgr.ins().postShapeEndClient(true,null)};RoleAI.prototype.destruct=function(){this.skillCD={};this.stop()};Object.defineProperty(RoleAI.prototype,"starting",{get:function(){return TimerManager.ins().isExists(this.startAI,this)},enumerable:true,configurable:true});RoleAI.prototype.canAddToAi=function(){if(GameMap.sceneInMain())return true;return false};RoleAI.prototype.add=function(char){this.aiList[char.infoModel.handle]=char};RoleAI.prototype.remove=function(char){delete this.aiList[char.infoModel.handle]};RoleAI.prototype.getAIList=function(){return this.aiList};RoleAI.prototype.endMyShape=function(b){if(b===void 0){b=false}TimerManager.ins().remove(this.endMyShape,this);if(b){TimerManager.ins().remove(this.beforeEndMyShape,this)}ShapeShiftingMgr.ins().postShapeEndClient(true,null)};RoleAI.prototype.beforeEndMyShape=function(){TimerManager.ins().remove(this.beforeEndMyShape,this);var noDieRoleIdx=EntityManager.ins().getNoDieRoleIndex();var fadeOutEffSkill=GlobalConfig.ShapeShiftingBaseConfig.fadeOutEffSkill;for(var i=noDieRoleIdx;i<3;i++){var role=EntityManager.ins().getMainRole(i);if(role){var skillData=new SkillData(fadeOutEffSkill);this.useSkill(role,role,skillData)}}};RoleAI.prototype.endFakerShape=function(b){if(b===void 0){b=false}TimerManager.ins().remove(this.endFakerShape,this);if(b){TimerManager.ins().remove(this.beforeEndFakerShape,this)}ShapeShiftingMgr.ins().postShapeEndClient(false,HejiUseMgr.ins().getShapeInfo())};RoleAI.prototype.beforeEndFakerShape=function(){TimerManager.ins().remove(this.beforeEndFakerShape,this);var shapeInfo=HejiUseMgr.ins().getShapeInfo();var fadeOutEffSkill=GlobalConfig.ShapeShiftingBaseConfig.fadeOutEffSkill;for(var handle in shapeInfo){if(handle){var role=EntityManager.ins().getEntityByHandle(handle);if(role){this.useSkill(role,role,new SkillData(fadeOutEffSkill))}}}};RoleAI.prototype.checkNotDelDie=function(){var lastDieTimes=this.dieTimes;this.dieTimes={};var list=this.aiList;var toDeletes=[];for(var i in list){var t=list[i];if(t.AI_STATE==AI_State.Die){var hashHandle=t.hashCode.toString()+"_"+t.infoModel.handle;var thisTimes=1;if(hashHandle in lastDieTimes){var lastTimes=lastDieTimes[hashHandle];thisTimes=lastTimes+1;this.dieTimes[hashHandle]=thisTimes}else{this.dieTimes[hashHandle]=thisTimes}if(thisTimes*RoleAI.AI_UPDATE_TIME>=2e3){toDeletes.push([i,t])}}}var myCount=EntityManager.ins().getTeamCount(Team.My);for(var _i=0,toDeletes_1=toDeletes;_i<toDeletes_1.length;_i++){var it=toDeletes_1[_i];var i=it[0];var t=it[1];t.deadDelay();this.clearTarget(t);if(t instanceof CharMonster&&!(t instanceof CharRole)){t.destruct()}else{DisplayUtils.removeFromParent(t)}delete this.aiList[i];if(myCount>0&&t.team==Team.WillEntity){if(GameMap.sceneInMine()){MineFight.ins().fightEnd(true)}else{EncounterFight.ins().sendFightResult(1)}}}};RoleAI.prototype.startAI=function(){if(this.inStoryMode){return}this.checkNotDelDie();var list=this.aiList;var jobNames=["0",i18n("RoleAI_3"),i18n("RoleAI_4"),i18n("RoleAI_5")];var master=EntityManager.ins().getNoDieRole();var poxIndex=0;var entityMgr=EntityManager.ins();var _loop_7=function(i){var selfTarget=list[i];var target;var isRole=selfTarget instanceof CharRole;var handle=selfTarget.infoModel.handle;var jobName=isRole?jobNames[selfTarget.infoModel.job]:"";target=this_7.curTarget[handle];if(target&&entityMgr.getEntityByHandle(target.infoModel.handle)==null){delete this_7.curTarget[handle]}var selfBuffList=selfTarget.buffList;var isCannotHit=false;for(var groupID in selfBuffList){if(selfTarget.AI_STATE==AI_State.Die)break;var buff=selfBuffList[groupID];if(buff.effConfig.type==SkillEffType.AddBlood||buff.effConfig.type==SkillEffType.AdditionalDamage){if(buff.isExecute()){buff.step++;var d=this_7.hramedDie(selfTarget,buff.value);if(d){selfTarget.AI_STATE=AI_State.Die}this_7.showHram(d,DamageTypes.HIT,selfTarget,buff.source,buff.value,i18n("RoleAI_7")+buff.effConfig.id);if(buff.step>=buff.count)selfTarget.removeBuff(buff)}}if(buff.canRemove()){selfTarget.removeBuff(buff)}else if(buff.isCanotHit()){isCannotHit=true}}if(isCannotHit)return"continue";if(selfTarget.AI_STATE==AI_State.Die)return"continue";if(selfTarget.isHardStraight){return"continue"}if(selfTarget.infoModel.team==Team.My&&UserSkill.ins().hejiLevel>0&&UserSkill.ins().hejiEnable&&selfTarget.infoModel instanceof Role){if(master&&selfTarget.infoModel.handle==master.infoModel.handle){target=this_7.curTarget[handle];var skill=UserSkill.ins().getHejiSkillId();if(UserSkill.ins().fieldUse&&skill.id!=0&&target&&target.team!=Team.My&&target.AI_STATE!=AI_State.Die){var tempArr=EntityManager.ins().screeningTargetByPos(selfTarget,false,skill.affectCount,skill.castRange,this_7.aiList);if(tempArr.length){if(ShapeShiftingMgr.ins().getIsInShape()==true){UserTips.ins().showTips(i18n("RoleAI_8"));return{value:void 0}}self=this_7;fubenID=GameMap.fubenID;var last_1=Encounter.ins().isEncounter();setTimeout(function(){var fubenID2=GameMap.fubenID;if(fubenID!=fubenID2){console.log(i18n("RoleAI_9"));self.endMyShape(true);return}var cur=Encounter.ins().isEncounter();if(last_1!=cur){self.endMyShape(true);return}TimerManager.ins().remove(self.endMyShape,self);TimerManager.ins().remove(self.beforeEndMyShape,self);ShapeShiftingMgr.ins().postShapeStartClient(true,null);var time=GlobalConfig.ShapeShiftingBaseConfig.time||15;var fadeOutEffSecond=GlobalConfig.ShapeShiftingBaseConfig.fadeOutEffSecond;TimerManager.ins().doTimer(time*1e3,1,self.endMyShape,self);TimerManager.ins().doTimer((time-fadeOutEffSecond)*1e3,1,self.beforeEndMyShape,self);var noDieRoleIdx=EntityManager.ins().getNoDieRoleIndex();for(var i=noDieRoleIdx;i<3;i++){var enterSkill=ShapeShiftingMgr.ins().getEnterSkillData(i+1);if(enterSkill){var role=EntityManager.ins().getMainRole(i);if(role){self.useSkill(role,target,enterSkill)}}}},1500);this_7.useSkill(selfTarget,target,skill);ExSkillAiLogic.ins().checkHJTrigger(selfTarget,[target]);UserSkill.ins().fieldUse=false;var config=GlobalConfig.EffectsConfig[skill.selfEff[0]]?GlobalConfig.EffectsConfig[skill.selfEff[0]]:null;if(config){var len=SubRoles.ins().subRolesLen;for(var i_3=0;i_3<len;i_3++){var roleData=EntityManager.ins().getMainRole(i_3);if(roleData){var buff=ObjectPool.pop("EntityBuff");buff.effConfig=config;buff.addTime=egret.getTimer();buff.endTime=buff.addTime+config.duration;buff.count=config.duration/config.interval>>0;buff.step=0;buff.source=roleData;roleData.addBuff(buff);roleData.stopMove();if(roleData!=master){roleData.playAction(EntityAction.STAND)}roleData.AI_STATE=AI_State.Stand}}}return"continue"}}}}else if(selfTarget.infoModel.team==Team.WillEntity&&HejiUseMgr.ins().canUse()){target=this_7.curTarget[handle];var enemyMaster=HejiUseMgr.ins().getMaster();if(target&&target.team==Team.My&&enemyMaster==selfTarget){var skill=HejiUseMgr.ins().getSkillData();if(skill&&target.AI_STATE!=AI_State.Die){var tempArr=EntityManager.ins().screeningTargetByPos(selfTarget,false,skill.affectCount,skill.castRange,this_7.aiList);if(tempArr.length){self=this_7;last=Encounter.ins().isEncounter();setTimeout(function(){var cur=Encounter.ins().isEncounter();if(last!=cur){self.endFakerShape(true);return}TimerManager.ins().remove(self.endFakerShape,self);TimerManager.ins().remove(self.beforeEndFakerShape,self);var shapeInfo=HejiUseMgr.ins().getShapeInfo();ShapeShiftingMgr.ins().postShapeStartClient(false,shapeInfo);var time=GlobalConfig.ShapeShiftingBaseConfig.time||15;var fadeOutEffSecond=GlobalConfig.ShapeShiftingBaseConfig.fadeOutEffSecond;TimerManager.ins().doTimer(time*1e3,1,self.endFakerShape,self);TimerManager.ins().doTimer((time-fadeOutEffSecond)*1e3,1,self.beforeEndFakerShape,self);for(var handle in shapeInfo){var shapeId=shapeInfo[handle];var enterSkill=GlobalConfig.ShapeShiftingPropConfig[shapeId][0].enterskill;if(enterSkill&&handle){var role=EntityManager.ins().getEntityByHandle(handle);if(role){self.useSkill(role,target,new SkillData(enterSkill))}}}},1500);this_7.useSkill(selfTarget,target,skill);HejiUseMgr.ins().useSuccess();var config=GlobalConfig.EffectsConfig[skill.selfEff[0]]?GlobalConfig.EffectsConfig[skill.selfEff[0]]:null;if(config){var roles=HejiUseMgr.ins().getRoles();var len=roles.length;for(var i_4=0;i_4<len;i_4++){var roleData=EntityManager.ins().getEntityByHandle(roles[i_4].handle);if(roleData){var buff=ObjectPool.pop("EntityBuff");buff.effConfig=config;buff.addTime=egret.getTimer();buff.endTime=buff.addTime+config.duration;buff.count=config.duration/config.interval>>0;buff.step=0;buff.source=roleData;roleData.addBuff(buff);roleData.stopMove();if(roleData!=enemyMaster){roleData.playAction(EntityAction.STAND)}roleData.AI_STATE=AI_State.Stand}}}return"continue"}}}}if(!list[handle])return"continue";if(isRole){if(selfTarget.publicCD&&egret.getTimer()-selfTarget.publicCD<=800)return"continue"}else{if(selfTarget.publicCD&&egret.getTimer()-selfTarget.publicCD<=800)return"continue"}if(RoleAI.ins().isFindDrop&&selfTarget.team==Team.My){if(master&&selfTarget.infoModel.handle==master.infoModel.handle){return"continue"}}switch(selfTarget.AI_STATE){case AI_State.Stand:this_7.screeningSkill(handle);var isNoUseSkill=false;var isFollowMaster=false;if(!this_7.curSkill[handle]){isNoUseSkill=true}if(!isNoUseSkill&&this_7.checkCanScreeningTarget(selfTarget,this_7.curSkill[handle],this_7.curTarget[handle])){if(selfTarget.team==Team.WillEntity){this_7.screeningTarget(selfTarget,9)}else{this_7.screeningTarget(selfTarget)}}if(selfTarget.team==Team.My&&selfTarget!=master&&master){if(MathUtils.getDistance(selfTarget.x,selfTarget.y,master.x,master.y)>250){var masterTarget=this_7.curTarget[master.infoModel.handle];if(masterTarget&&masterTarget.AI_STATE!=AI_State.Die){if(this_7.curSkill[handle]&&this_7.curSkill[handle].targetType==TargetType.Enemy&&masterTarget.team!=Team.My){this_7.curTarget[handle]=masterTarget}else{isFollowMaster=true}}else{isFollowMaster=true}}}if(isNoUseSkill||isFollowMaster){if(selfTarget.team==Team.My&&selfTarget!=master&&master){var selfMaster=master;if(selfTarget.infoModel.masterHandle){var ms=EntityManager.ins().getEntityByHandle(selfTarget.infoModel.masterHandle);if(ms){selfMaster=ms}}var count=EntityManager.ins().getTeamCount(Team.My);var dirs=[1,-1];if(count==2){dirs=[0]}var p=DirUtil.getGridByDir(selfMaster.dir+dirs[poxIndex]!=null?dirs[poxIndex]:0);poxIndex+=1;GameMap.moveEntity(selfTarget,selfMaster.x+p.x,selfMaster.y+p.y)}return"continue"}if(!this_7.curTarget[handle]){return"continue"}if(this_7.tryUseSkill(selfTarget)){selfTarget.AI_STATE=AI_State.Atk}else{if(selfTarget.team==Team.My||selfTarget.team==Team.WillEntity||selfTarget.team==Team.Faker||this_7.teamAction[selfTarget.team]){toX=this_7.curTarget[handle].x;toY=this_7.curTarget[handle].y;GameMap.moveEntity(selfTarget,toX,toY);selfTarget.moveTo.x=toX;selfTarget.moveTo.y=toY;selfTarget.AI_STATE=AI_State.Run}}break;case AI_State.Run:if(selfTarget.isJumping()){return"continue"}target=this_7.curTarget[handle];if(selfTarget.team==Team.My)UserFb.ins().canChallengGuanQia=true;if(!target||target.AI_STATE==AI_State.Die){selfTarget.stopMove();selfTarget.playAction(EntityAction.STAND);selfTarget.AI_STATE=AI_State.Stand;delete this_7.curTarget[handle];return"continue"}else{if(selfTarget.team==Team.Faker){var wildData=Encounter.ins().wildPersonList[selfTarget.infoModel.masterHandle];if(!wildData)return"continue";var killNum=EncounterModel.countKillNumByMarster(selfTarget.infoModel.masterHandle);var juli=MathUtils.getDistance(selfTarget.x,selfTarget.y,wildData.backX,wildData.backY);if(wildData&&wildData.actionType==1&&killNum>=wildData.killNum){if(juli<10){EntityManager.ins().removeByHandle(selfTarget.infoModel.masterHandle);Encounter.ins().RunAwary(selfTarget.infoModel.masterHandle);Encounter.ins().sendCleanWildPeople(wildData.index)}else{GameMap.moveEntity(selfTarget,wildData.backX,wildData.backY)}return"continue"}}if(!selfTarget.isJumping()&&this_7.tryUseSkill(selfTarget)){selfTarget.stopMove();selfTarget.AI_STATE=AI_State.Atk}if(selfTarget.action==EntityAction.STAND){selfTarget.AI_STATE=AI_State.Stand}}break;case AI_State.Atk:if(!this_7.isStartAtk)GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_HOOK);this_7.isStartAtk=true;target=this_7.curTarget[handle];if(!target||target.AI_STATE==AI_State.Die){selfTarget.AI_STATE=AI_State.Stand;delete this_7.curTarget[handle];return"continue"}this_7.teamAction[target.team]=true;if(selfTarget.atking)return"continue";var skill=this_7.curSkill[handle];if(!skill)return"continue";this_7.skillCD[handle][skill.id]=egret.getTimer();this_7.skillCastType[handle]=skill.castType;this_7.skillTargetType[handle]=skill.targetType;selfTarget.atking=true;if(selfTarget.team==Team.My)UserFb.ins().canChallengGuanQia=false;selfTarget.publicCD=egret.getTimer();GameLogic.skyBallCheck(selfTarget);this_7.useSkill(selfTarget,target,skill);delete this_7.curSkill[handle];break;case AI_State.Patrol:var configID=selfTarget.infoModel.configID;var config=UserFb.ins().guanqiaMonster[configID];if(selfTarget.infoModel.isWander&&config.attrange){this_7.screeningTarget(selfTarget,config.attrange);if(this_7.curTarget[selfTarget.infoModel.handle]){selfTarget.AI_STATE=AI_State.Stand}else{selfTarget.startPatrol()}}else{selfTarget.startPatrol()}break}};var this_7=this,self,fubenID,self,last,toX,toY;for(var i in list){var state_1=_loop_7(i);if(typeof state_1==="object")return state_1.value}};RoleAI.prototype.checkShowZhanling=function(){this.zhanlingTime=egret.getTimer();if(!GameMap.sceneInMain())return;var skinId=ZhanLingModel.ins().ZhanLingSkinId;if(ZhanLingModel.ins().getZhanLingDataById(0)){var role=EntityManager.ins().getNoDieRole();if(role){var lv=ZhanLingModel.ins().getZhanLingDataById(0).level;role.showZhanling(skinId,lv);ExSkillAiLogic.ins().checkWarSpiritBubbleTrigger()}}};RoleAI.prototype.checkCanScreeningTarget=function(selfTarget,skill,curTarget){if(!curTarget||!curTarget.parent||curTarget.AI_STATE==AI_State.Die){return true}var handle=selfTarget.infoModel.handle;if(this.skillCastType[handle]==undefined&&this.skillTargetType[handle]==undefined){return true}if(this.skillCastType[handle]!=skill.castType||this.skillTargetType[handle]!=skill.targetType){return true}return false};RoleAI.prototype.getTargetMonsterPoint=function(selfTarget,target){if(selfTarget.x==target.x){return target}var k=(target.y-selfTarget.y)/(target.x-selfTarget.x);var x=target.x,y=target.y;var fixMax=60;var fixMin=20;if(Math.abs(k)<=1){if(k<0){y+=Math.floor(fixMax*Math.random())}else{y-=Math.floor(fixMax*Math.random())}x+=Math.floor(fixMin*Math.random())}else{if(k<0){x+=Math.floor(fixMax*Math.random())}else{x-=Math.floor(fixMax*Math.random())}y+=Math.floor(fixMin*Math.random())}return{x:x,y:y}};RoleAI.prototype.useUnitionSkill=function(){};RoleAI.prototype.useSkill=function(selfTarget,target,skill){var _this=this;var skillEff=skill.tarEff&&skill.tarEff.length>0?GlobalConfig.EffectsConfig[skill.tarEff[0]]:null;var selfSkillEff=skill.selfEff?GlobalConfig.EffectsConfig[skill.selfEff[0]]:null;var pTarget=skill.castType==castType.Self?selfTarget:target;var targetArr;var critAdd=0;var ImbaData;var gwSkillConfig;var gwSkills;var isYlBullet=false;var selfInfo=selfTarget.infoModel;if(selfTarget.team==Team.My){ImbaData=Artifact.ins().getReviseBySkill(skill.id);if(ImbaData){critAdd=ImbaData.crit}gwSkills=GodWeaponCC.ins().getReviseBySkill(skill.id);if(gwSkills){gwSkillConfig=gwSkills[0]}if(gwSkillConfig){critAdd=gwSkillConfig.crit}}var affectCount=skill.affectCount;if(ImbaData&&ImbaData.affectCount){affectCount+=ImbaData.affectCount}if(gwSkillConfig&&gwSkillConfig.affectCount){affectCount+=gwSkillConfig.affectCount}if(skill.castType==castType.SelfHpLess){targetArr=EntityManager.ins().screeningTargetByPos(selfTarget,true,0,Number.MAX_VALUE,this.aiList);for(var m=0;m<targetArr.length;m++){if(targetArr[m].isCanAddBlood){targetArr[0]=targetArr[m];if(!targetArr[0]){console.log("RoleAI.ts 778 target == null; skillid = "+skill.id)}break}}}else{if(skill.castType!=castType.Other&&skill.targetType==TargetType.Enemy){targetArr=EntityManager.ins().screeningTargetByPos(pTarget,false,affectCount,skill.affectRange,this.aiList,skill.affectRangeEx,selfTarget)}else{targetArr=affectCount>1?EntityManager.ins().screeningTargetByPos(pTarget,pTarget.team==target.team,affectCount,skill.affectRange,this.aiList,skill.affectRangeEx,selfTarget):[target]}if(targetArr.length==0){targetArr=[target];if(!targetArr[0]){console.log("RoleAI.ts 795 target == null; skillid = "+skill.id)}}}if(skill.preId&&GlobalConfig.FlameStamp.skillId.indexOf(skill.preId)>=0){isYlBullet=true}var hasCrit=false;var len=targetArr.length=Math.min(targetArr.length,affectCount);var hitTargetInfo=[];for(var j=0;j<len;j++){var ttarget=targetArr[j];var tarInfo=ttarget.infoModel;var isSiZhou=false;var isMainTar=j==0;if(ttarget.team!=selfTarget.team){var effBuff=void 0;if(GameLogic.triggerAttr(selfTarget,AttributeType.atStunPower)||skill.id==90005){effBuff=ObjectPool.pop("EntityBuff");effBuff.effConfig=GlobalConfig.EffectsConfig[51001];effBuff.value=selfInfo.getAtt(AttributeType.atStunTime);effBuff.addTime=egret.getTimer();effBuff.endTime=effBuff.addTime+effBuff.value;ttarget.addBuff(effBuff);ttarget.stopMove();ttarget.AI_STATE=AI_State.Stand}if(GameLogic.triggerExAttr(selfTarget,ExAttributeType.eatDeathCurseProbability)){effBuff=ObjectPool.pop("EntityBuff");effBuff.effConfig=GlobalConfig.EffectsConfig[52001];effBuff.addTime=egret.getTimer();effBuff.endTime=effBuff.effConfig.args.d?selfInfo.attributeExData[ExAttributeType.eatDeathCurseTime]:effBuff.effConfig.duration;ttarget.addBuff(effBuff);selfTarget.addPaoPao(3);isSiZhou=true}if(GameLogic.triggerExAttr(selfTarget,ExAttributeType.eatAttackAddHpProbability)){}}var isHeji=UserSkill.ins().isHejiSkill(skill.configID);var isCrit=false;var isLucky=false;var isMultipleCrit=false;var isMiss=false;var isWeishe=false;var isZhuiMing=false;var isZhiMing=false;var isGongMing=void 0;var isHearth=void 0;var hramValue=0;if(skill.calcType!=3){isMiss=GameLogic.triggerMiss(selfTarget,ttarget)}if(isMiss){hramValue=0}else{hramValue=this.damageBaseCalculation(selfTarget,ttarget,skill);if(skill.calcType!=3){isMultipleCrit=GameLogic.triggerExAttr(selfTarget,ExAttributeType.eatMultipleCrit);if(isMultipleCrit){hramValue=hramValue*(selfInfo.getExAtt(ExAttributeType.eatMultipleCritCoeff)/1e4);hramValue+=selfInfo.getExAtt(ExAttributeType.atMultipleCritHurt);selfTarget.addPaoPao(21)}isCrit=GameLogic.triggerCrit(selfTarget,ttarget,critAdd);var useSkyBall=selfTarget.hasBuff(SkillConst.EFF_SKY_BALL);if(useSkyBall){selfTarget.addPaoPao(6);isCrit=true}var addDamage=0;var addPer=1;if(isCrit){hasCrit=true;var critDamage=selfInfo.getAtt(AttributeType.atCritEnhance);if(gwSkillConfig&&gwSkillConfig.critDamage){critDamage+=gwSkillConfig.critDamage}var critHp=selfInfo.getExAtt(ExAttributeType.eatCritHpLt);if(tarInfo.getAtt(AttributeType.atHp)/tarInfo.getAtt(AttributeType.atMaxHp)<=critHp/1e4){critDamage+=selfInfo.getExAtt(ExAttributeType.eatCritHpLtAddDamage)}addPer+=critDamage/1e4;addDamage+=selfInfo.getAtt(AttributeType.atCritHurt)}var exAttr={};exAttr[AttributeType.atDeadLyPro]=GameLogic.calculateRealAttribute(selfTarget,AttributeType.atDeadLyPro,selfTarget);isZhiMing=GameLogic.triggerAttr(selfTarget,AttributeType.atDeadLyPro,exAttr);if(isZhiMing){addPer+=.5+(selfInfo.getAtt(AttributeType.atDeadLyMaster)-tarInfo.getAtt(AttributeType.atDeadLyResist))/1e4}exAttr={};exAttr[AttributeType.atHunGuPro]=GameLogic.calculateRealAttribute(selfTarget,AttributeType.atHunGuPro,selfTarget);isGongMing=this.tryTriggerHungu(selfTarget);if(isGongMing){addPer+=selfInfo.getAtt(AttributeType.atHunGuHurt)/1e4}isHearth=this.tryTriggerHeart(selfTarget);if(isHearth){addPer+=selfInfo.getAtt(AttributeType.atHearthHurt)/1e4;addDamage+=selfInfo.getAtt(AttributeType.atHearthDamege)}hramValue=hramValue*addPer+addDamage;if(isSiZhou)hramValue=hramValue*(1+selfInfo.attributeExData[ExAttributeType.eatDeathCurseDamageIncrease]/1e4);if(!isMainTar&&skill.targetType==TargetType.Enemy){if(tarInfo.type==EntityType.Role){hramValue=hramValue*(skill.herdPlayerRate/100)}else{hramValue=hramValue*(skill.herdMonRate/100)}}if(selfTarget.isMy&&selfInfo.type==EntityType.Role&&target.infoModel.type==EntityType.Role){if(Encounter.ins().isEncounter()){if(EncounterFight.ins().getIsWeiShe(selfTarget.isMy))isWeishe=true}else if(MineFight.ins().isFighting){if(MineFight.ins().getIsWeiShe(selfTarget.isMy))isWeishe=true}}hramValue=this.damageBuff(selfTarget,ttarget,hramValue);hramValue=hramValue+selfInfo.getAtt(AttributeType.atHolyDamege)*(1+selfInfo.getAtt(AttributeType.atHolyMaster)/1e4-tarInfo.getAtt(AttributeType.atHolyResist)/1e4);isZhuiMing=GameLogic.triggerAttr(selfTarget,AttributeType.atZhuiMingPro);if(isZhuiMing){hramValue+=selfInfo.getAtt(AttributeType.atZhuiMingVal)}hramValue=hramValue*(1-selfInfo.getAtt(AttributeType.neigongAbsorbHurt)/1e4)}hramValue=hramValue>>0;if(selfTarget.team==ttarget.team&&hramValue>0){hramValue=0}}if(!(ttarget instanceof CharRole)){if(ttarget.AI_STATE==AI_State.Patrol){ttarget.stopMove();ttarget.playAction(EntityAction.STAND);ttarget.AI_STATE=AI_State.Stand}}if(ttarget instanceof CharRole){if(skill.calcType==1||skill.calcType==5){var cur_np=ttarget.infoModel.getAtt(AttributeType.cruNeiGong);if(cur_np!=0&&hramValue>0){var my_atNeiGongDamageAbsorb=ttarget.infoModel.getAtt(AttributeType.neigongAbsorbHurt);var damage_absorb_np=hramValue*my_atNeiGongDamageAbsorb/1e4;var change_np=Math.min(cur_np,damage_absorb_np);hramValue=hramValue-change_np;ttarget.infoModel.setAtt(AttributeType.cruNeiGong,cur_np-change_np);ttarget.updateNeiGong();console.log("DoDamageResult ChangeNp:%s",-change_np)}}}var isDie=this.hramedDie(ttarget,hramValue);if(isDie){ttarget.AI_STATE=AI_State.Die;ExSkillAiLogic.ins().checkDieTrigger(selfTarget,[ttarget])}var damageType=0;if(selfTarget.team==Team.My){if(isHeji){damageType=DamageTypes.Heji}else if(isMiss){damageType=DamageTypes.Dodge}else{if(isLucky){damageType|=DamageTypes.Lucky}if(isCrit){damageType|=DamageTypes.CRIT}}if(isWeishe)damageType|=DamageTypes.Deter;if(isZhuiMing)damageType|=DamageTypes.ZhuiMing;if(isZhiMing)damageType|=DamageTypes.ZhiMing}if(selfTarget.team!=ttarget.team&&skill.calcType==5){var h5=hramValue/5>>0;var h1=h5*MathUtils.limit(0,.05)>>0;var h2=h5*MathUtils.limit(0,.05)>>0;var hits=[h5-h1,h5+h1,h5-h2,h5+h2,hramValue-4*h5];var hitInfo=[];for(var i=0;i<hits.length;i++){hitInfo.push({isDie:isDie,damageType:DamageTypes.Fujia,ttarget:ttarget,hramValue:hits[i]})}hitTargetInfo.push(hitInfo)}else{hitTargetInfo.push([{isDie:isDie,damageType:damageType,ttarget:ttarget,hramValue:hramValue}]);if(selfTarget.team!=ttarget.team&&GameLogic.triggerAttr(selfTarget,AttributeType.atAttPerDamPan)){isDie=this.hramedDie(ttarget,hramValue>>1);selfTarget.addPaoPao(20);var targetInfo=hitTargetInfo[hitTargetInfo.length-1];targetInfo.push({isDie:isDie,damageType:DamageTypes.Fujia,ttarget:ttarget,hramValue:hramValue>>1})}}ttarget.myKill=ttarget.myKill||selfTarget.isMy;if(selfTarget.isMy||selfTarget.team==Team.WillEntity){ttarget.showBlood(true);ttarget.showName(true)}if(ttarget.isMy){selfTarget.showBlood(true);selfTarget.showName(true)}}var fbType=GameMap.fbType;var fbId=GameMap.fubenID;var hitTime=0;GameLogic.ins().playSkillEff(skill,selfTarget,targetArr,function(probability){if(GameMap.fbType!=fbType||fbId!=GameMap.fubenID)return;var pType=0;for(var i in targetArr){var ttarget=targetArr[i];var ttInfo=ttarget.infoModel;var lastHitTargetInfo=hitTargetInfo[i][hitTargetInfo[i].length-1];lastHitTargetInfo.isDie=lastHitTargetInfo.ttarget.getRealHp()<=0||lastHitTargetInfo.ttarget.getHP()<=0;var targetIsDie=hitTargetInfo[i][hitTargetInfo[i].length-1].isDie;if(pTarget==ttarget){pType=hitTargetInfo[i][0].damageType}var hramValue=0;for(var j=0;j<hitTargetInfo[i].length;j++){var targetInfo=hitTargetInfo[i][j];hramValue+=targetInfo.hramValue;_this.showHram(targetInfo.isDie,targetInfo.damageType,ttarget,selfTarget,targetInfo.hramValue,skill.name)}if(selfTarget.team==Team.My&&ttarget.team==Team.WillEntity&&EncounterFight.ins().willEntityFightTeam!=Team.My){EncounterFight.ins().willEntityFightTeam=Team.My;var willList=EntityManager.ins().getEntityByTeam(Team.WillEntity);for(var _i=0,willList_1=willList;_i<willList_1.length;_i++){var char=willList_1[_i];_this.curTarget[char.infoModel.handle]=null;_this.lastTarget[char.infoModel.handle]=null}}ttarget.shakeIt();if(!targetIsDie){var tarEff=skill.tarEff;if(pTarget!=ttarget&&ttarget.infoModel.type==EntityType.Role){tarEff=skill.otarEff||tarEff}for(var k=0;tarEff&&k<tarEff.length;k++){var args=_this.getArgs(tarEff[k],ImbaData,gwSkillConfig);var buff=EntityBuff.createBuff(tarEff[k],selfTarget,args);ttarget.addBuff(buff)}if(ImbaData){_this.addTargetReviseSkillEffect(ttarget,selfTarget,ImbaData)}if(gwSkillConfig){_this.addTargetReviseSkillEffect(ttarget,selfTarget,gwSkillConfig)}if(gwSkills&&gwSkills[1]){_this.addTargetReviseSkillEffect(ttarget,selfTarget,gwSkills[1])}if(ttarget instanceof CharRole){_this.tryUseWingSkill(ttarget,skill,true)}_this.tryUsePassiveSkill(selfTarget,ttarget,true,hitTargetInfo[i][0].damageType);_this.tryUseWeaponSkill(ttarget,skill,true);_this.tryTriggerMijiBuqu(ttarget)}_this.showBuffHarm(selfTarget,ttarget,skill,hramValue)}if(selfSkillEff){for(var k=0;skill.selfEff&&k<skill.selfEff.length;k++){var args=_this.getArgs(skill.selfEff[k],ImbaData,gwSkillConfig);var buff=EntityBuff.createBuff(skill.selfEff[k],selfTarget,args);selfTarget.addBuff(buff)}}if(ImbaData){_this.addSelfReviseSkillEffect(selfTarget,ImbaData)}if(gwSkillConfig){_this.addSelfReviseSkillEffect(selfTarget,gwSkillConfig)}if(gwSkills&&gwSkills[1]){_this.addSelfReviseSkillEffect(selfTarget,gwSkills[1])}if(selfTarget instanceof CharRole){_this.tryUseWingSkill(selfTarget,skill,false)}_this.tryUsePassiveSkill(selfTarget,pTarget,false,pType);_this.tryTriggerHeirloomSkill(selfTarget,targetArr,hitTargetInfo);if(isYlBullet){_this.tryUseYlPassiveSkill(selfTarget,pTarget,skill)}if(skill.configID==80002){_this.petTryUsePassiveSkill(selfTarget,false)}if(skill.otherSkills){var skills=skill.otherSkills.concat();var skillData=new SkillData(skills[hitTime]);skillData.preId=skill.configID;_this.useSkill(selfTarget,target,skillData);hitTime+=1;return}});if(!SoundUtil.WINDOW_OPEN&&skill.sound&&selfTarget.team==Team.My){SoundUtil.ins().playEffect(skill.sound)}selfTarget.AI_STATE=AI_State.Stand;selfTarget.atking=false;if(hasCrit&&selfInfo.getExAtt(ExAttributeType.eatMiJiZHDamPer)){this.checkTriggerAttr(selfTarget,1,ExAttributeType.eatMiJiZHTime,1)}this.repel(selfTarget,target,skill)};RoleAI.prototype.repel=function(selfTarget,target,skill){if(skill&&skill.repelDistance){target.stopMove();target.playAction(EntityAction.STAND);var h=target.infoModel.handle;delete this.curTarget[h];var jd=MathUtils.getAngle(MathUtils.getRadian2(selfTarget.x,selfTarget.y,target.x,target.y));var p=MathUtils.getDirMove(jd,skill.repelDistance);p.x=target.x+p.x;p.y=target.y+p.y;var data=BresenhamLine.isAbleToThrough(GameMap.point2Grip(target.x),GameMap.point2Grip(target.y),GameMap.point2Grip(p.x),GameMap.point2Grip(p.y));if(data[0]==0){if(data[1]>3){debug.error(i18n("RoleAI_13",data[2],data[3]),p)}if(GameMap.point2Grip(target.x)==data[2]&&GameMap.point2Grip(target.y)==data[3]){p.x=target.x;p.y=target.y}else{p.x=GameMap.grip2Point(data[2]);p.y=GameMap.grip2Point(data[3])}}p.x=Math.max(Math.min(p.x,GameMap.MAX_WIDTH),0);p.y=Math.max(Math.min(p.y,GameMap.MAX_HEIGHT),0);var xbX=p.x-target.x;var xbY=p.y-target.y;var time=Math.sqrt(xbX*xbX+xbY*xbY)/(selfTarget.moveSpeed/1e3);var holdTime=skill.tarEff&&skill.tarEff[0]?GlobalConfig.EffectsConfig[skill.tarEff[0]].duration:0;target.addHardStraight(holdTime);if(time>0){var t=egret.Tween.get(target.moveTweenObj);t.to({x:p.x,y:p.y},time)}if(skill.teleport==1){if(skill&&skill.actionType!="")selfTarget.playAction(skill.actionType);selfTarget.stopMove();if(time>0){var t=egret.Tween.get(selfTarget.moveTweenObj);t.to({x:selfTarget.x-(target.x-p.x),y:selfTarget.y-(target.y-p.y)},time).call(function(){selfTarget.stopMove();selfTarget.resetStand()});selfTarget.addHardStraight(time)}}}};RoleAI.prototype.checkTriggerAttr=function(selfTarget,type,attrType,per,exValue){if(per===void 0){per=1}if(exValue===void 0){exValue=0}if(Math.random()<per){var selfInfo=selfTarget.infoModel;var handle=selfInfo.handle;var obj=this.attrCD[handle]=this.attrCD[handle]||{};var key=type+"_"+attrType;var value=exValue?exValue:type==0?selfInfo.getAtt(attrType):selfInfo.getExAtt(attrType);var lastTime=obj[key]||0;var curTimer=egret.getTimer();if(lastTime&&curTimer-lastTime<value){return}obj[key]=curTimer;var attrValue=this.attrValue[handle]=this.attrValue[handle]||{};attrValue[key]=1}};RoleAI.prototype.getIsTriggerAttr=function(selfTarget,type,attrType,def){if(def===void 0){def=0}var selfInfo=selfTarget.infoModel;var attrValue=this.attrValue[selfInfo.handle];if(attrValue){var key=type+"_"+attrType;var last=attrValue[key];attrValue[key]=def;return last}return 0};RoleAI.prototype.addSelfReviseSkillEffect=function(selfTarget,ImbaData){if(ImbaData.selfEff){for(var k in ImbaData.selfEff){var config=GlobalConfig.EffectsConfig[ImbaData.selfEff[k]]?GlobalConfig.EffectsConfig[ImbaData.selfEff[k]]:null;if(config){var args=this.getArgs(ImbaData.selfEff[k],ImbaData,null);var buff=EntityBuff.createBuff(ImbaData.selfEff[k],selfTarget,args);selfTarget.addBuff(buff)}}}};RoleAI.prototype.addTargetReviseSkillEffect=function(target,source,ImbaData){if(ImbaData.targetEff){for(var k in ImbaData.targetEff){var config=GlobalConfig.EffectsConfig[ImbaData.targetEff[k]]?GlobalConfig.EffectsConfig[ImbaData.targetEff[k]]:null;if(config){var args=this.getArgs(ImbaData.targetEff[k],ImbaData,null);var buff=EntityBuff.createBuff(ImbaData.targetEff[k],source,args);target.addBuff(buff)}}}};RoleAI.prototype.tryUsePassiveSkill=function(selfTarget,target,isBeEffect,_type){if(isBeEffect===void 0){isBeEffect=false}if(_type===void 0){_type=0}var selfTar=isBeEffect?target:selfTarget;var pTarget=isBeEffect?selfTarget:target;if(selfTar instanceof CharRole){var canUseSkill=this.getCanUseSkillList(selfTar,false);if(!canUseSkill||canUseSkill.length==0)return;var skills=[];for(var _i=0,canUseSkill_1=canUseSkill;_i<canUseSkill_1.length;_i++){var skill=canUseSkill_1[_i];var passive=skill.config.passive;if(passive.p1){if(selfTar.infoModel.getAtt(AttributeType.atHp)/selfTar.infoModel.getAtt(AttributeType.atMaxHp)>passive.p1/1e4){continue}}switch(passive.cond){case 0:if(!isBeEffect){if(GameLogic.triggerValue(passive.rate)){skills.push(skill)}}break;case 1:if(isBeEffect){if(GameLogic.triggerValue(passive.rate)){skills.push(skill)}}break;case 2:if(!isBeEffect&&(_type&DamageTypes.CRIT)==DamageTypes.CRIT){if(GameLogic.triggerValue(passive.rate)){skills.push(skill)}}break;case 3:if(isBeEffect&&(_type&DamageTypes.CRIT)==DamageTypes.CRIT){if(GameLogic.triggerValue(passive.rate)){skills.push(skill)}}break}}if(!skills.length)return;for(var _a=0,skills_1=skills;_a<skills_1.length;_a++){var skillData=skills_1[_a];var tar=void 0;if(skillData.targetType!=TargetType.Enemy){tar=selfTar}else{if(pTarget&&pTarget.infoModel.getAtt(AttributeType.atHp)>0){tar=pTarget}else{var monsters=EntityManager.ins().screeningTargetByPos(selfTar,false,0,skillData.affectRange,this.aiList);tar=monsters&&monsters[0]}}if(tar){var handle=selfTar.infoModel.handle;this.skillCD[handle]=this.skillCD[handle]||{};this.skillCD[handle][skillData.id]=egret.getTimer();this.useSkill(selfTar,tar,skillData)}}}};RoleAI.prototype.tryUseWarSpiritSkill=function(selfTarget,skillId,isBeEffect){var skillData=ObjectPool.pop("SkillData");skillData.configID=skillId;var tar;if(skillData.targetType!=TargetType.Enemy){tar=selfTarget}else{var monsters=EntityManager.ins().screeningTargetByPos(selfTarget,false,0,skillData.affectRange,this.aiList);tar=monsters[0]}if(tar){var handle=selfTarget.infoModel.handle;this.skillCD[handle]=this.skillCD[handle]||{};this.skillCD[handle][skillData.id]=egret.getTimer();this.useSkill(selfTarget,tar,skillData)}};RoleAI.prototype.tryUseWingSkill=function(selfTarget,skill,isBeEffect){var wingSkills=this.checkWingEffect(selfTarget,skill,isBeEffect);if(wingSkills.length){for(var _i=0,wingSkills_1=wingSkills;_i<wingSkills_1.length;_i++){var skillId=wingSkills_1[_i];var skillData=ObjectPool.pop("SkillData");skillData.configID=skillId;var tar=void 0;if(skillData.targetType!=TargetType.Enemy){tar=selfTarget}else{var monsters=EntityManager.ins().screeningTargetByPos(selfTarget,false,0,skillData.affectRange,this.aiList);tar=monsters[0]}if(tar){var handle=selfTarget.infoModel.handle;this.skillCD[handle]=this.skillCD[handle]||{};this.skillCD[handle][skillData.id]=egret.getTimer();this.useSkill(selfTarget,tar,skillData)}}}};RoleAI.prototype.checkWingEffect=function(selfTarget,skill,isBeEffect){if(isBeEffect===void 0){isBeEffect=false}var wingSkill=selfTarget.infoModel.wingSkillData;var triggerSkills=[];if(skill.isPassive){return triggerSkills}var skillCD=this.skillCD[selfTarget.infoModel.handle];for(var _i=0,wingSkill_1=wingSkill;_i<wingSkill_1.length;_i++){var skillId=wingSkill_1[_i];var skillConfig=ObjectPool.pop("SkillData");skillConfig.configID=skillId;if(skillCD&&skillCD[skillConfig.id]&&egret.getTimer()-skillCD[skillConfig.id]<skillConfig.cd){continue}if(skillConfig.config.passive.cond==0&&!isBeEffect){if(GameLogic.triggerValue(skillConfig.config.passive.rate)){triggerSkills.push(skillId)}}else if(skillConfig.config.passive.cond==1&&isBeEffect){if(GameLogic.triggerValue(skillConfig.config.passive.rate)){triggerSkills.push(skillId)}}}return triggerSkills};RoleAI.prototype.tryUseYlPassiveSkill=function(selfTarget,target,skill){var info=selfTarget.infoModel;if(info.lyMarkLv&&info.lyMarkSkills){for(var i=0;i<info.lyMarkSkills.length;i++){var lv=info.lyMarkSkills[i]||0;if(lv){var config=GlobalConfig.FlameStampEffect[i+1][lv];if(config.effId){var effConfig=GlobalConfig.EffectsConfig[config.effId];if(effConfig.probabilityBuff){if(GameLogic.triggerValue(effConfig.probabilityBuff)){var buff=EntityBuff.createBuff(config.effId,selfTarget);target.addBuff(buff)}}}if(config.selfEffId){var effConfig=GlobalConfig.EffectsConfig[config.selfEffId];if(effConfig.probabilityBuff){if(GameLogic.triggerValue(effConfig.probabilityBuff)){var buff=EntityBuff.createBuff(config.selfEffId,selfTarget);selfTarget.addBuff(buff)}}}}}}};RoleAI.prototype.tryTriggerHeirloomSkill=function(selfTarget,tempArr,hitTargetInfo){var buff80004=null;var _bfCurse=80004;var shixueId=6666601;var isTriggerShiXue=-1;var shixueValue=0;var selfHandle=selfTarget.infoModel.handle;for(var i in tempArr){var ttarget=tempArr[i];var tarHandle=ttarget.infoModel.handle;if(selfTarget.team!=ttarget.team){if(isTriggerShiXue==-1){isTriggerShiXue=0;if(!this.skillCD[selfHandle]||!this.skillCD[selfHandle][shixueId]||egret.getTimer()-this.skillCD[selfHandle][shixueId]>=5e3){if(GameLogic.triggerAttr(selfTarget,AttributeType.atVamirePro)){isTriggerShiXue=1;this.skillCD[selfHandle]=this.skillCD[selfHandle]||{};this.skillCD[selfHandle][shixueId]=egret.getTimer()}}}if(ttarget instanceof CharRole&&!selfTarget.hasBuff(_bfCurse)&&!buff80004){if(!this.skillCD[tarHandle]||!this.skillCD[tarHandle][_bfCurse]||egret.getTimer()-this.skillCD[tarHandle][_bfCurse]>=5e3){if(GameLogic.triggerAttr(ttarget,AttributeType.atCursePro)){var lv=ttarget.infoModel.heirloom.getInfoBySolt(2).lv;var buffId=[80004,80005,80006,80007][lv-1];buff80004=ObjectPool.pop("EntityBuff");buff80004.effConfig=GlobalConfig.EffectsConfig[buffId];buff80004.addTime=egret.getTimer();if(buff80004.effConfig){buff80004.value=buff80004.effConfig.args.a;buff80004.endTime=buff80004.addTime+buff80004.effConfig.duration}selfTarget.addBuff(buff80004);ttarget.addPaoPao(13);this.skillCD[tarHandle]=this.skillCD[tarHandle]||{};this.skillCD[tarHandle][_bfCurse]=egret.getTimer()}}}}}if(isTriggerShiXue==1){selfTarget.addPaoPao(14);for(var _i=0,hitTargetInfo_1=hitTargetInfo;_i<hitTargetInfo_1.length;_i++){var info=hitTargetInfo_1[_i];if(shixueValue==0){shixueValue=Math.floor(selfTarget.infoModel.getAtt(AttributeType.atVamirePen)/1e4*info[0].hramValue)}}var die=this.hramedDie(selfTarget,-shixueValue);this.showHram(die,1,selfTarget,selfTarget,-shixueValue)}};RoleAI.prototype.tryUseWeaponSkill=function(target,skill,isBeHit){if(target.AI_STATE==AI_State.Die)return;if(target.getRealHp()<=0)return;if(isBeHit){var isAddHpPro=GameLogic.triggerAttr(target,AttributeType.atBeAttAddHpPro);if(isAddHpPro){target.addPaoPao(16);var addHp=target.infoModel.getAtt(AttributeType.atBeAttAddHpVal);var die=this.hramedDie(target,-addHp);this.showHram(die,1,target,target,-addHp)}if(target.infoModel.getAtt(AttributeType.atHpLtAddBuff)&&target.infoModel.getAtt(AttributeType.atHp)/target.infoModel.getAtt(AttributeType.atMaxHp)<target.infoModel.getAtt(AttributeType.atHpLtAddBuff)/1e4){var skillCD=this.skillCD[target.infoModel.handle];var effConfig=GlobalConfig.EffectsConfig[target.infoModel.getExAtt(ExAttributeType.eatHpLtAddBuffId)];if(skillCD&&skillCD[ExAttributeType.eatHpLtAddBuffId]&&egret.getTimer()-skillCD[ExAttributeType.eatHpLtAddBuffId]<target.infoModel.getExAtt(ExAttributeType.eatHpLtAddBuffCd)){return}target.addPaoPao(18);var buff=ObjectPool.pop("EntityBuff");buff.effConfig=effConfig;buff.value=buff.effConfig.args.a;buff.addTime=egret.getTimer();buff.endTime=buff.addTime+buff.effConfig.duration;target.addBuff(buff);this.skillCD[target.infoModel.handle]=this.skillCD[target.infoModel.handle]||{};this.skillCD[target.infoModel.handle][ExAttributeType.eatHpLtAddBuffId]=egret.getTimer()}}};RoleAI.prototype.tryTriggerMijiBuqu=function(ttarget){var ttInfo=ttarget.infoModel;if(!ttInfo.getExAtt(ExAttributeType.eatMiJiBQBuffId))return;if(ttInfo.getAtt(AttributeType.atHp)/ttInfo.getAtt(AttributeType.atMaxHp)*1e4<ttInfo.getExAtt(ExAttributeType.eatMiJiBQHpPer)){this.checkTriggerAttr(ttarget,1,ExAttributeType.eatMiJiBQHpTime,1);var isTrigger=this.getIsTriggerAttr(ttarget,1,ExAttributeType.eatMiJiBQHpTime);if(isTrigger){var buff=EntityBuff.createBuff(ttInfo.getExAtt(ExAttributeType.eatMiJiBQBuffId),ttarget);ttarget.addBuff(buff);ttarget.addPaoPao(23)}}};RoleAI.prototype.tryTriggerHungu=function(ttarget){var ttInfo=ttarget.infoModel;var per=ttInfo.getAtt(AttributeType.atHunGuPro);if(!per)return;this.checkTriggerAttr(ttarget,0,AttributeType.atHunGuCd,per/1e4);var isTrigger=this.getIsTriggerAttr(ttarget,0,AttributeType.atHunGuCd);if(isTrigger){BubbleFactory.ins().playBubbleEffect(24)}return isTrigger};RoleAI.prototype.tryTriggerHeart=function(ttarget){var ttInfo=ttarget.infoModel;if(!ttInfo.getAtt(AttributeType.atHearthCount))return;this.checkTriggerAttr(ttarget,0,AttributeType.atHearthCount,1,8e3);var isTrigger=this.getIsTriggerAttr(ttarget,0,AttributeType.atHearthCount);if(isTrigger){BubbleFactory.ins().playBubbleEffect(25)}return isTrigger};RoleAI.prototype.petTryUsePassiveSkill=function(selfTarget,isBeEffect){if(isBeEffect===void 0){isBeEffect=true}var masterHandle=selfTarget.infoModel.masterHandle;var role=EntityManager.ins().getEntityByHandle(masterHandle);if(role&&role.infoModel&&role.infoModel.getExAtt(ExAttributeType.eatPetSkillLevel)){var skillId=36e3+role.infoModel.getExAtt(ExAttributeType.eatPetSkillLevel);var canUseSkill=[new SkillData(skillId)];var skills=[];for(var _i=0,canUseSkill_2=canUseSkill;_i<canUseSkill_2.length;_i++){var skill=canUseSkill_2[_i];if(skill.config.passive.cond==0&&!isBeEffect){if(GameLogic.triggerValue(skill.config.passive.rate)){skills.push(skill)}}else if(skill.config.passive.cond==1&&isBeEffect){if(GameLogic.triggerValue(skill.config.passive.rate)){skills.push(skill)}}}if(!skills.length)return;for(var _a=0,skills_2=skills;_a<skills_2.length;_a++){var skillData=skills_2[_a];var tar=void 0;if(skillData.targetType!=TargetType.Enemy){tar=selfTarget}else{var monsters=EntityManager.ins().screeningTargetByPos(selfTarget,false,0,skillData.affectRange,this.aiList);tar=monsters[0]}if(tar){var handle=selfTarget.infoModel.handle;this.skillCD[handle]=this.skillCD[handle]||{};this.skillCD[handle][skillData.id]=egret.getTimer();this.useSkill(selfTarget,tar,skillData)}}}};RoleAI.prototype.showBuffHarm=function(selfTarget,target,skill,hramValue){var addValue=GameLogic.calculateRealAttribute(target,AttributeType.atAddEnemyHp,selfTarget);if(addValue>0){addValue=-addValue;if(selfTarget instanceof CharRole){var die=this.hramedDie(selfTarget,addValue);this.showHram(die,DamageTypes.BLANK,selfTarget,selfTarget,addValue)}}var atHurtMyself=GameLogic.calculateRealAttribute(selfTarget,AttributeType.atHurtMyself,target);if(atHurtMyself){var value=Math.floor(hramValue*atHurtMyself/1e4);var isDie=this.hramedDie(selfTarget,value);this.showHram(isDie,DamageTypes.BLANK,selfTarget,target,value)}};RoleAI.prototype.hramedDie=function(t,v){var value=t.infoModel.getAtt(AttributeType.atHp)-v;if(v<0){var maxValue=t.infoModel.getAtt(AttributeType.atMaxHp);value=value>maxValue?maxValue:value}t.infoModel.setAtt(AttributeType.atHp,value);if(t.getHP()<=0||t.infoModel.getAtt(AttributeType.atHp)<=0){return true}return false};RoleAI.prototype.showHram=function(isDie,damageType,target,sourceTarget,hramValue,logStr){var _this=this;if(logStr===void 0){logStr=""}if(!target||!target.infoModel)return;this.trace(target.infoModel.handle+i18n("RoleAI_16")+hramValue+i18n("RoleAI_17")+target.getHP()+"\t--"+logStr);target._hpBar.value=target.infoModel.getAtt(AttributeType.atHp);GameLogic.ins().postEntityHpChange(target,sourceTarget,damageType,hramValue);if(isDie){target.removeAllFilters();target.stopMove();target.playAction(EntityAction.HIT);if(target.myKill&&!(target instanceof CharRole)){var hadSend=false;var data=UserTask.ins().taskTrace;if(data){var config=UserTask.ins().getAchieveConfById(data.id);if(config&&config.type==RoleAI.SEND_TASK_TYPE){hadSend=true;UserFb.ins().sendKillMonster(target.infoModel.configID)}}if(!hadSend){UserFb.ins().sendKillMonster(target.infoModel.configID)}}if(!target.hasBuff(52001)&&GameLogic.triggerExAttr(target,ExAttributeType.eatGodBlessProbability)){target.AI_STATE=AI_State.Stand;target.removeAllBuff();var r=target.infoModel.getAtt(AttributeType.atMaxHp)*target.infoModel.attributeExData[ExAttributeType.eatGodBlessRate]/1e4;target.infoModel.setAtt(AttributeType.atHp,r);target._hpBar.value=target.infoModel.getAtt(AttributeType.atHp);this.trace(i18n("RoleAI_20")+target.getHP());target.addPaoPao(7)}else{this.trace(target.infoModel.handle+i18n("RoleAI_21"));if(sourceTarget&&sourceTarget.team==Team.My){this.checkPlayDieSound(target)}if(GameMap.fbType==0&&target.infoModel.type==EntityType.Role&&target.infoModel.team==Team.My&&!EncounterFight.ins().isEncountering){console.error("错误：关卡挂机中 本机玩家死亡！！！")}if(target.onDeadCalled){return}target.onDeadCalled=true;TimerManager.ins().doTimer(120,1,function(){_this.trace(target.infoModel.handle+i18n("RoleAI_22"));EntityManager.ins().removeByHandle(target.infoModel.handle,false,target.myKill&&target.infoModel.type==EntityType.Monster);if(target.infoModel.type==EntityType.Role){var enti=EntityManager.ins().getEntityBymasterhHandle(target.infoModel.masterHandle);if(!enti){var list=EntityManager.ins().getMasterList(target.infoModel.masterHandle);if(list&&list.length){for(var _i=0,list_1=list;_i<list_1.length;_i++){var en=list_1[_i];EntityManager.ins().removeByHandle(en.infoModel.handle)}}}}delete _this.hashHpObj[target.hashCode];target.onDead(function(){target.deadDelay();_this.clearTarget(target);var t=egret.Tween.get(target.dieTweenObj);t.wait(300).to({alpha:0},1e3).call(function(){if(target instanceof CharMonster&&!(target instanceof CharRole)){target.destruct()}else{DisplayUtils.removeFromParent(target)}})},sourceTarget);if(target.team==Team.Monster){var count=EntityManager.ins().getTeamCount(Team.Monster);if(count<=UserFb.ins().rCount){GameLogic.ins().createGuanqiaMonster(false)}}_this.checkAIend(sourceTarget,target)},this);if(target.team==Team.Monster){var count=EntityManager.ins().getTeamCount(Team.Monster);if(count<=UserFb.ins().rCount){GameLogic.ins().createGuanqiaMonster(false)}if(sourceTarget.team==Team.My){var master=EntityManager.ins().getNoDieRole();var isElite_1=target.infoModel.configID==UserFb.ins().eliteMonsterId;if(master&&(isElite_1||sourceTarget.infoModel.handle==master.infoModel.handle)&&GameMap.fubenID==0){var x_Grid=Math.floor(target.x/GameMap.CELL_SIZE);var y_Grid=Math.floor(target.y/GameMap.CELL_SIZE);var itemData=void 0;if(!isElite_1){itemData=UserFb.ins().getRewardsPop();UserFb.ins().rewards=[]}else{itemData=UserFb.ins().eliteRewards.shift()}if(itemData&&itemData.length>0){var maxDropNum=DropHelp.getMaxDropNum();for(var j=0;j<itemData.length&&j<maxDropNum;j++){Encounter.ins().postCreateDrop(x_Grid,y_Grid,itemData[j].drops[0])}var callback=function(){UserFb.ins().sendGetReward(isElite_1)};DropHelp.addCompleteFunc(callback,this);DropHelp.start()}if(UserFb.ins().exp>0&&(!itemData||itemData.length==0)){UserFb.ins().sendGetReward(isElite_1);UserFb.ins().exp=0}}var nextList=EntityManager.ins().screeningTargetByPos(sourceTarget,false,0,Number.MAX_VALUE,this.aiList);if(!nextList||nextList.length==0){var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var _i=0,mylist_1=mylist;_i<mylist_1.length;_i++){var char=mylist_1[_i];char.playAction(EntityAction.STAND)}}}for(var handle in this.curTarget){if(this.curTarget[handle]==target){var char=EntityManager.ins().getEntityByHandle(handle);if(char&&char.infoModel){++char.infoModel.killNum}break}}if(sourceTarget.team==Team.Faker){var wildData=Encounter.ins().wildPersonList[sourceTarget.infoModel.masterHandle];var killNum=EncounterModel.countKillNumByMarster(sourceTarget.infoModel.masterHandle);if(wildData&&wildData.actionType==1&&killNum>=wildData.killNum){GameMap.moveEntity(sourceTarget,wildData.backX,wildData.backY)}}}}}else{if(target.AI_STATE!=AI_State.Die&&hramValue>0){}ExSkillAiLogic.ins().checkHPTrigger(target,sourceTarget)}};RoleAI.prototype.checkAIend=function(st,t){var count=EntityManager.ins().getTeamCount(t.team);if(count==0){switch(st.team){case Team.My:switch(t.team){case Team.Monster:this.trace(i18n("RoleAI_23"));break;case Team.WillBoss:Encounter.ins().sendResult(true);this.trace(i18n("RoleAI_24"));break;case Team.WillEntity:this.trace(i18n("RoleAI_25"));if(EntityManager.ins().getTeamCount(Team.My)){if(GameMap.sceneInMine()){MineFight.ins().fightEnd(true)}else{EncounterFight.ins().sendFightResult(1)}}else{return}break;case Team.Faker:var wildData_1=Encounter.ins().wildPersonList[t.infoModel.masterHandle];if(wildData_1)Encounter.ins().sendWildPeopleResult(wildData_1.index,1);break}if(Encounter.ins().isGuiding){Encounter.ins().isGuiding=false;Encounter.ins().postEncounterDataChange()}EntityManager.ins().resetRole();break;case Team.WillBoss:Encounter.ins().sendResult(false);this.trace(i18n("RoleAI_26"));break;case Team.WillEntity:this.trace(i18n("RoleAI_27"));if(EntityManager.ins().getTeamCount(Team.WillEntity)){if(GameMap.sceneInMine()){MineFight.ins().fightEnd(false)}else{EncounterFight.ins().sendFightResult(0)}}else{return}break;case Team.Faker:var wildData=Encounter.ins().wildPersonList[st.infoModel.masterHandle];Encounter.ins().sendWildPeopleResult(wildData.index,0);break;case Team.Monster:if(t.team==Team.My){EntityManager.ins().resetRole()}break}if(!(st.team==Team.Monster&&t.team==Team.Faker)){this.getPickAI()}}};RoleAI.prototype.checkPlayDieSound=function(monster){var configID=monster.infoModel?monster.infoModel.configID:0;var config;if(!SoundUtil.WINDOW_OPEN&&configID){config=UserFb.ins().guanqiaMonster[configID];if(config){if(config.sound){SoundUtil.ins().playEffect(config.sound)}}else{config=GlobalConfig.MonstersConfig[configID];if(config){if(config.sound){SoundUtil.ins().playEffect(config.sound)}}}}};RoleAI.prototype.getPickAI=function(){if(this.inited&&!Encounter.ins().isEncounter()){this.stopAITimer()}};RoleAI.prototype.getTeamCount=function(t){var count=0;for(var handle in this.aiList){var tar=this.aiList[handle];if(tar.team==t)count+=1}return count};RoleAI.prototype.stopAITimer=function(){TimerManager.ins().remove(this.startAI,this);TimerManager.ins().remove(this.startZhanLing,this)};RoleAI.prototype.addAITimer=function(){if(!TimerManager.ins().isExists(this.startAI,this)){TimerManager.ins().doTimer(RoleAI.AI_UPDATE_TIME,0,this.startAI,this);this.addZhanLingTimer()}};RoleAI.prototype.addZhanLingTimer=function(){this.zhanlingTime=egret.getTimer();this.zhanlingdelayTime=egret.getTimer();TimerManager.ins().doTimer(1e3,0,this.startZhanLing,this)};RoleAI.prototype.getArgs=function(id,imbaData,gwSKill){var skillEff=GlobalConfig.EffectsConfig[id];var addA=0,addC=0,addTime=0;if(imbaData){if(imbaData.args){for(var _i=0,_a=imbaData.args;_i<_a.length;_i++){var arg=_a[_i];if(arg.type==8&&arg.vals[0]==skillEff.group){addA+=arg.vals[2]||0;addC+=arg.vals[4]||0;addTime+=arg.vals[1]||0}if(arg.type==6){addA+=arg.vals[0]||0}}}}if(gwSKill){if(gwSKill.args){for(var _b=0,_c=gwSKill.args;_b<_c.length;_b++){var arg=_c[_b];if(arg.type==8&&arg.vals[0]==skillEff.group){addA+=arg.vals[2]||0;addC+=arg.vals[4]||0;addTime+=arg.vals[1]||0}if(arg.type==6){addA+=arg.vals[0]||0}}}}return{a:addA,b:0,c:addC,time:addTime}};RoleAI.prototype.skillEffValue=function(selfTarget,skillEff,args){var effValue=0;var addA=0;var addC=0;if(args){addA=args.a||0;addC=args.c||0}if(skillEff){if(skillEff.args){switch(skillEff.type){case SkillEffType.AdditionalDamage:effValue=selfTarget.infoModel.getAtt(skillEff.args.b)*(skillEff.args.a+addA)+(skillEff.args.c||0)+addC;break;case SkillEffType.AddBlood:effValue=selfTarget.infoModel.getAtt(skillEff.args.b)*(skillEff.args.a+addA)+(skillEff.args.c||0)+addC;effValue=-effValue;break;case SkillEffType.AdditionalAttributes:case SkillEffType.HostAddAttributes:effValue=selfTarget.infoModel.getAtt(skillEff.args.b)*(skillEff.args.a+addA)+(skillEff.args.c||0)+addC;break;case SkillEffType.AdditionalState:if(skillEff.args.i==2){effValue=selfTarget.infoModel.getAtt(skillEff.args.b)*(skillEff.args.a+addA)+(skillEff.args.c||0)+addC}else{var value=!skillEff.args.c?1+addC:(skillEff.args.c||0)+addC;effValue=selfTarget.infoModel.getAtt(skillEff.args.b)*value}break}}effValue=effValue>>0}return effValue};RoleAI.prototype.checkTeamDistan=function(selfTarget,master,range){if(range===void 0){range=5}var xb=MathUtils.getDistance(selfTarget.x,selfTarget.y,master.x,master.y);return xb<range*GameMap.CELL_SIZE};RoleAI.prototype.tryUseSkill=function(selfTarget){var hCode=selfTarget.infoModel.handle;var skill=this.curSkill[hCode];var target=this.curTarget[hCode];if(!skill){return false}var xb=MathUtils.getDistance(selfTarget.x,selfTarget.y,target.x,target.y);return xb<skill.castRange*GameMap.CELL_SIZE};RoleAI.prototype.screeningSkill=function(hCode){var selfTarget=this.aiList[hCode];var isRole=selfTarget instanceof CharRole;this.skillCD[hCode]=this.skillCD[hCode]||{};if(selfTarget.team==Team.My){var master=EntityManager.ins().getNoDieRole();if(master&&master!=selfTarget&&!this.checkTeamDistan(selfTarget,master,10)){this.curSkill[hCode]=null;return}}var mSkill=this.curSkill[hCode];if(mSkill&&egret.getTimer()-this.skillCD[hCode][mSkill.id]<mSkill.cd){this.curSkill[hCode]=null}if(this.curSkill[hCode]){return}var canUseSkill=this.getCanUseSkillList(selfTarget);if(!canUseSkill)return;var skillEff;var skillIndex=0;var skill=canUseSkill[skillIndex];skillEff=skill&&skill.tarEff?GlobalConfig.EffectsConfig[skill.tarEff[0]]:null;if(skillEff&&skillEff.type==SkillEffType.Summon){if(selfTarget.hasBuff(skillEff.group))skill=canUseSkill[++skillIndex]}skillEff=skill&&skill.tarEff?GlobalConfig.EffectsConfig[skill.tarEff[0]]:null;if(skillEff&&skillEff.type==SkillEffType.AddBlood){if(!EntityManager.ins().checkCanAddBlood(selfTarget.team))skill=canUseSkill[++skillIndex]}if(skill&&skill.id==25e3){var tar=this.curTarget[selfTarget.infoModel.handle];if(!tar||tar.AI_STATE==AI_State.Die)tar=selfTarget;if(Encounter.ins().isEncounter()||MineFight.ins().isFighting||!EntityManager.ins().checkCount(tar,skill.affectRange,2,tar.team!=selfTarget.team))skill=canUseSkill[++skillIndex]}if(skill&&skill.id==13e3){if(Encounter.ins().isEncounter()||MineFight.ins().isFighting||!EntityManager.ins().checkCount(selfTarget,skill.affectRange,2))skill=canUseSkill[++skillIndex]}this.curSkill[hCode]=skill};RoleAI.prototype.getCanUseSkillList=function(selfTarget,isActive){if(isActive===void 0){isActive=true}var skills=[];if(selfTarget instanceof CharRole&&selfTarget.infoModel){if(Assert(selfTarget.infoModel.skillsData,i18n("RoleAI_28",selfTarget.isMy,GameMap.fbType,GameMap.fubenID))){return}skills=selfTarget.infoModel.skillsData.concat();if(selfTarget.team==Team.My){var gwSkills=GodWeaponCC.ins().getJobGWNewSkill(selfTarget.infoModel.job);if(gwSkills){skills=skills.concat(gwSkills)}var roleId_1=selfTarget.infoModel.index;var jadeData=JadeNew.ins().getJadeDataByID(roleId_1);if(jadeData)skills=skills.concat(jadeData.getSkillList())}else{var jadeData=selfTarget.infoModel.jadeData;if(jadeData)skills=skills.concat(jadeData.getSkillList())}skills=skills.concat(ExtremeEquipModel.ins().getZhiZunSkills(selfTarget.infoModel));var roleId=selfTarget.infoModel.index;var model=selfTarget.infoModel;var isMy=model.checkHandleIsMy(model.handle);if(isMy){if(ShapeShiftingMgr.ins().skillList[roleId]){skills=skills.concat(ShapeShiftingMgr.ins().skillList[roleId].passiveList);if(ShapeShiftingMgr.ins().getIsInShape(roleId)){var temp=ShapeShiftingMgr.ins().skillList[roleId].activeList.concat(ShapeShiftingMgr.ins().skillList[roleId].passiveList);skills=temp}}else{if(selfTarget.infoModel.skillsDataSsPassive.length>0){skills=skills.concat(selfTarget.infoModel.skillsDataSsPassive);if(ShapeShiftingMgr.ins().getIsInShape(selfTarget.infoModel.index)){var temp=selfTarget.infoModel.skillsDataSsActive.concat(selfTarget.infoModel.skillsDataSsPassive);skills=temp}}}}else{if(selfTarget.infoModel.skillsDataSsPassive.length>0){skills=skills.concat(selfTarget.infoModel.skillsDataSsPassive);if(ShapeShiftingMgr.ins().othersShapeShiftingInfo[selfTarget.infoModel.handle]){var temp=selfTarget.infoModel.skillsDataSsActive.concat(selfTarget.infoModel.skillsDataSsPassive);skills=temp}}}}else{if(selfTarget.team==Team.My){if(SpecialRing.ins().isFireRing(selfTarget.infoModel.handle)){var skillId=SpecialRing.ins().getRingSkill();if(skillId){var skillData=ObjectPool.pop("SkillData");skillData.configID=skillId;skills.push(skillData)}skillId=LyMark.ins().getCurSkillID();if(skillId){var skillData=ObjectPool.pop("SkillData");skillData.specialCD=LyMark.ins().getCurSkillCD();skillData.configID=skillId;skills.push(skillData)}}else{var skillData=ObjectPool.pop("SkillData");skillData.configID=80001;var gwSkills=GodWeaponCC.ins().getReviseBySkill(35e3);if(gwSkills&&gwSkills.length){skillData.configID=80002}skills.push(skillData)}}else{var skillData=ObjectPool.pop("SkillData");skillData.configID=50001;skills.push(skillData)}}if(!skills||skills.length==0)return;var hCode=selfTarget.infoModel.handle;this.skillCD[hCode]=this.skillCD[hCode]||{};var len=skills.length;if(len==0)return;var canUseSkill=[];for(var i=0;i<len;i++){if(!skills[i].canUse)continue;if(isActive==skills[i].isPassive)continue;var reduceCD=0;if(selfTarget.team==Team.My){var imbaData=Artifact.ins().getReviseBySkill(skills[i].id);if(imbaData&&imbaData.cd){reduceCD+=imbaData.cd}var gwSkills=GodWeaponCC.ins().getReviseBySkill(skills[i].id);var gwSkill=void 0;if(gwSkills){gwSkill=gwSkills[0]}if(gwSkill&&gwSkill.cd){reduceCD+=gwSkill.cd}}if(egret.getTimer()-this.skillCD[hCode][skills[i].id]<skills[i].cd-reduceCD)continue;canUseSkill.push(skills[i])}canUseSkill.sort(this.sortFunc);return canUseSkill};RoleAI.prototype.damageBaseCalculation=function(selfTarget,target,skill){var defAttrValue=0;var defValue=0;var damage=0;var buff;var sJob=JobConst.None;var tJob=JobConst.None;var selfIsActor=false;var targetIsActor=false;var selfInfo=selfTarget.infoModel;var attArga=0;var attArgb=0;var attArgc=0;var toMonAdd=0;var addValue=0;if(selfTarget.team==Team.My){var imbaData=Artifact.ins().getReviseBySkill(skill.id);if(imbaData){attArga=imbaData.a||0;attArgb=imbaData.b||0;toMonAdd=imbaData.d||0;if(imbaData.selfEff){for(var k in imbaData.selfEff){buff=selfTarget.buffList[imbaData.selfEff[k]];if(buff&&buff.effConfig.type==3){addValue+=buff.value}}}}var gwSkills=GodWeaponCC.ins().getReviseBySkill(skill.id);var gwSkill=void 0;if(gwSkills){gwSkill=gwSkills[0]}if(gwSkill){attArga+=gwSkill.a||0;attArgb+=gwSkill.b||0;toMonAdd+=gwSkill.d||0;if(gwSkill.selfEff){for(var k in gwSkill.selfEff){buff=selfTarget.buffList[gwSkill.selfEff[k]];if(buff&&buff.effConfig.type==3){addValue+=buff.value}}}}}if(skill.preId&&GlobalConfig.FlameStamp.skillId.indexOf(skill.preId)>=0){var lv=selfInfo.lyMarkLv||0;if(lv){var config=GlobalConfig.FlameStampLevel[lv];if(config){attArga+=config.bulletDamage.a;attArgb+=config.bulletDamage.b}}var lySkills=selfInfo.lyMarkSkills||[];lv=lySkills[7-1]||0;if(lv){var config=GlobalConfig.FlameStampEffect[7][lv];if(config.bulletDamage){attArga+=config.bulletDamage.a||0;attArgb+=config.bulletDamage.b||0}}}if(selfTarget instanceof CharRole){selfIsActor=true}else{selfIsActor=false}if(target instanceof CharRole){targetIsActor=true}else{targetIsActor=false}if(selfIsActor&&sJob){if(sJob==JobConst.ZhanShi){defAttrValue=GameLogic.calculateRealAttribute(target,AttributeType.atDef,selfTarget)}else{defAttrValue=GameLogic.calculateRealAttribute(target,AttributeType.atRes,selfTarget)}}else{defAttrValue=GameLogic.calculateRealAttribute(target,AttributeType.atDef,selfTarget)}defValue=defAttrValue*(1-selfInfo.getAtt(AttributeType.atPenetrate)/1e4);if(skill.calcType==3){if(skill.args){var attack=0;if(selfTarget.team==Team.My){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var roleData=SubRoles.ins().getSubRoleByIndex(i);if(roleData)attack+=roleData.getAtt(AttributeType.atAttack)}}else if(selfTarget.team==Team.WillEntity){var roles=HejiUseMgr.ins().getRoles();var len=roles.length;for(var i=0;i<len;i++){var roleData=roles[i];if(roleData)attack+=roleData.getAtt(AttributeType.atAttack)}}attack=Math.max(attack-defValue,.05*attack);var argb=!skill.args.b?0+attArgb:skill.args.b+attArgb;damage=attack*(skill.args.a+attArga)+argb+attArgc;damage=Math.max(damage,.05*attack);if(target instanceof CharRole){damage=Math.floor(damage*(1+selfInfo.getExAtt(ExAttributeType.eatTogetherHitRoleDamageInc)/1e4))}else{damage=Math.floor(damage*(1+selfInfo.getExAtt(ExAttributeType.eatTogetherHitMonDamageInc)/1e4))}damage=Math.floor(damage*(1-selfInfo.getExAtt(ExAttributeType.eatTogetherHitFree)/1e4));var damageAddRate=GameLogic.calculateRealAttribute(selfTarget,AttributeType.atRoleDamageEnhance,selfTarget);damageAddRate-=GameLogic.calculateRealAttribute(target,AttributeType.atRoleDamageReduction,selfTarget);damageAddRate-=GameLogic.calculateRealAttribute(target,AttributeType.atDamageReduction,selfTarget);damage=Math.floor(damage*(1+damageAddRate/1e4));damage=damage+selfInfo.getAtt(AttributeType.atTogetherHolyDamege)*(1+selfInfo.getAtt(AttributeType.atTogetherHolyMaster)/1e4-target.infoModel.getAtt(AttributeType.atTogetherHolyResist)/1e4)}}else{if(skill.targetType==TargetType.Enemy){if(skill.args){var exArg=0;var skillBaseId=Math.floor(skill.id/1e3)%100;for(var i=0;i<skillConst.baseSkillIndex.length;i++){if(skillBaseId==skillConst.baseSkillIndex[i])exArg=selfInfo.attributeExData[ExAttributeType.eatBaseSkillExArg]}var attack=selfInfo.getAtt(AttributeType.atAttack);var tempAttack=GameLogic.calculateRealAttribute(selfTarget,AttributeType.atAttack,selfTarget);if(skill.configID==80002){var add=this.gePetSkillAdd(selfTarget);tempAttack+=Math.floor(attack*add/1e4)}var isAddDamPro=GameLogic.triggerAttr(selfTarget,AttributeType.atAttAddDamPro);var addDamProVal=0;if(isAddDamPro){addDamProVal=selfInfo.getAtt(AttributeType.atAttAddDamVal);selfTarget.addPaoPao(15)}var addDamPen=0;if(target.hasBuff(51001)&&selfInfo.getAtt(AttributeType.atAttMbAddDamPen)){addDamPen=selfInfo.getAtt(AttributeType.atAttMbAddDamPen);selfTarget.addPaoPao(17)}var hpAddDamPen=0;if(selfInfo.getAtt(AttributeType.atAttHpLtPenAddDam)&&target.infoModel.getAtt(AttributeType.atHp)/target.infoModel.getAtt(AttributeType.atMaxHp)<selfInfo.getAtt(AttributeType.atAttHpLtPenAddDam)/1e4){hpAddDamPen=selfInfo.getAtt(AttributeType.atAttHpLtAddDamPen);if(!this.hashHpObj[target.hashCode]){selfTarget.addPaoPao(19);this.hashHpObj[target.hashCode]=1}}var weishe=0;if(selfInfo.type==EntityType.Role&&target.infoModel.type==EntityType.Role){if(Encounter.ins().isEncounter()){weishe=EncounterFight.ins().getWeiSheHurt(selfTarget.isMy)}else if(MineFight.ins().isFighting){weishe=MineFight.ins().getWeiSheHurt(selfTarget.isMy)}}var mijiAdd=0;if(selfInfo.getExAtt(ExAttributeType.eatMiJiKNHpPer)){var hpPer=selfInfo.getAtt(AttributeType.atHp)/selfInfo.getAtt(AttributeType.atMaxHp)*1e4;if(hpPer<selfInfo.getExAtt(ExAttributeType.eatMiJiKNHpPer)){mijiAdd=Math.floor((selfInfo.getExAtt(ExAttributeType.eatMiJiKNHpPer)-hpPer)/selfInfo.getExAtt(ExAttributeType.eatMiJiKNHpSubPer))*selfInfo.getExAtt(ExAttributeType.eatMiJiKNDamPer)}}if(selfInfo.getExAtt(ExAttributeType.eatMiJiZHDamPer)&&this.getIsTriggerAttr(selfTarget,1,ExAttributeType.eatMiJiZHTime)){mijiAdd+=selfInfo.getExAtt(ExAttributeType.eatMiJiZHDamPer)}var argb=!skill.args.b?0+attArgb:skill.args.b+attArgb;if(targetIsActor&&skill.args.c){attArgc+=skill.args.c*target.infoModel.getAtt(AttributeType.atHp)}tempAttack=Math.max(tempAttack-defValue,.05*tempAttack);damage=tempAttack*(skill.args.a+exArg+attArga)+argb+attArgc+addDamProVal;damage=Math.floor(damage*(1+(toMonAdd+addDamPen+hpAddDamPen+weishe+mijiAdd)/1e4));var damageAddRate=GameLogic.calculateRealAttribute(selfTarget,AttributeType.atRoleDamageEnhance,selfTarget);damageAddRate-=GameLogic.calculateRealAttribute(target,AttributeType.atRoleDamageReduction,selfTarget);damageAddRate-=GameLogic.calculateRealAttribute(target,AttributeType.atDamageReduction,selfTarget);damage=Math.floor(damage*(1+damageAddRate/1e4));damage=Math.max(damage,.05*attack)}}}var ranNumber=(105-Math.random()*10)/100;damage*=ranNumber;return Math.floor(damage)};RoleAI.prototype.gePetSkillAdd=function(selfTarget){var masterHandle=selfTarget.infoModel.masterHandle;var master=EntityManager.ins().getEntityByHandle(masterHandle);if(master&&master.infoModel&&master.infoModel.getExAtt(ExAttributeType.eatPetAttackInc)){var add=master.infoModel.getExAtt(ExAttributeType.eatPetAttackInc);var dieCount=0;var teamCount=EntityManager.ins().getTeamCount(selfTarget.team);if(selfTarget.team==Team.My){dieCount=SubRoles.ins().subRolesLen+1-teamCount}else if(selfTarget.team==Team.WillEntity){if(Encounter.ins().isEncounter()){dieCount=EncounterFight.ins().getRoles().length+1-teamCount}else if(MineFight.ins().isFighting){dieCount=MineFight.ins().getRoles().length+1-teamCount}}return add*dieCount}return 0};RoleAI.prototype.damageBuff=function(selfTarget,target,damage){if(selfTarget instanceof CharMonster){if(selfTarget.team==Team.Monster||selfTarget.team==Team.WillBoss){if(selfTarget.infoModel.name!=i18n("RoleAI_29")){damage=0}}}var buff=target.buffList[19001];if(buff){var skillEff=buff.effConfig;var dxValue=Math.floor(damage*skillEff.args.a);buff.value-=dxValue;if(buff.value<=0){target.removeBuff(buff)}damage=damage-dxValue+(buff.value<0?-buff.value:0)}buff=target.buffList[60002];if(buff){var skillEff=buff.effConfig;var dxValue=Math.floor(damage*(skillEff.args.c/1e4));damage=damage-dxValue}buff=target.buffList[60004];if(buff){damage=0}if(target instanceof CharRole&&target.infoModel&&target.infoModel.exRingsData&&target.infoModel.exRingsData[1]==1){var mp=target.infoModel.getAtt(AttributeType.atMp);if(mp>0){var oldMp=mp-damage;target.infoModel.setAtt(AttributeType.atMp,oldMp>0?oldMp:0);damage=damage-mp>=0?damage-mp:0}}buff=target.buffList[80001];if(buff&&damage>0){damage-=buff.value;damage=damage>0?damage:0}return damage};RoleAI.prototype.sortFunc=function(a,b){var job=a.job;var conf=GlobalConfig.SkillsSorderConfig[job];if(!conf)return 0;var arr=conf.skillorder;var ap=arr.length;var bp=arr.length;for(var i in arr){if(arr[i]==a.id)ap=+i;if(arr[i]==b.id)bp=+i}if(ap>bp)return 1;if(ap<bp)return-1;return 0};RoleAI.prototype.screeningTarget=function(selfTarget,range,isSameTeam){if(range===void 0){range=Number.MAX_VALUE}if(isSameTeam===void 0){isSameTeam=false}var hCode=selfTarget.infoModel.handle;var skill=this.curSkill[hCode];var targetType=0;if(skill)targetType=skill.targetType;if(!isSameTeam){isSameTeam=targetType==TargetType.Friendly}if(!isSameTeam){if(this.lastTarget[hCode]){var monster=EntityManager.ins().getEntityByHandle(this.lastTarget[hCode]);if(monster&&monster.parent&&monster.AI_STATE!=AI_State.Die){this.curTarget[hCode]=monster;return}}}var tempArr=EntityManager.ins().screeningTargetByPos(selfTarget,isSameTeam,0,range,this.aiList);switch(selfTarget.team){case Team.My:var charMonster=this.checkMySubInList(tempArr,false,Team.Faker);this.curTarget[hCode]=charMonster;break;case Team.Faker:var monster=this.checkMySubInList(tempArr);this.curTarget[hCode]=monster;break;default:this.curTarget[hCode]=tempArr?tempArr[0]:null}if(!isSameTeam&&this.curTarget[hCode]){this.lastTarget[hCode]=this.curTarget[hCode].infoModel.handle}};RoleAI.prototype.checkMySubInList=function(list,isSameTeam,team){if(isSameTeam===void 0){isSameTeam=false}if(team===void 0){team=Team.My}for(var i=0;i<list.length;i++){if(isSameTeam){if(list[i].team==team)return list[i]}else{if(list[i].team!=team)return list[i]}}return null};RoleAI.prototype.trace=function(str){if(this.isLog)console.warn(str)};RoleAI.prototype.startZhanLing=function(){if(this.zhanlingdelayTime&&egret.getTimer()-this.zhanlingdelayTime>GlobalConfig.ZhanLingConfig.delayTime){this.zhanlingdelayTime=0;this.checkShowZhanling()}if(egret.getTimer()-this.zhanlingTime>1e4){this.checkShowZhanling()}};RoleAI.AI_UPDATE_TIME=100;RoleAI.SEND_TASK_TYPE=68;return RoleAI}(BaseClass);__reflect(RoleAI.prototype,"RoleAI");var Team;(function(Team){Team[Team["My"]=0]="My";Team[Team["Monster"]=1]="Monster";Team[Team["WillEntity"]=2]="WillEntity";Team[Team["WillBoss"]=3]="WillBoss";Team[Team["NotAtk"]=4]="NotAtk";Team[Team["Faker"]=5]="Faker"})(Team||(Team={}));window["Team"]=Team;var TargetType;(function(TargetType){TargetType[TargetType["Friendly"]=1]="Friendly";TargetType[TargetType["Enemy"]=2]="Enemy";TargetType[TargetType["My"]=3]="My"})(TargetType||(TargetType={}));window["TargetType"]=TargetType;var AI_State;(function(AI_State){AI_State[AI_State["Stand"]=0]="Stand";AI_State[AI_State["Run"]=1]="Run";AI_State[AI_State["Atk"]=2]="Atk";AI_State[AI_State["Die"]=3]="Die";AI_State[AI_State["Patrol"]=4]="Patrol"})(AI_State||(AI_State={}));window["AI_State"]=AI_State;var AttributeData=function(){function AttributeData(type,value){if(type===void 0){type=0}if(value===void 0){value=0}this.type=type;this.value=value}AttributeData.AttrAddition=function(attr1,attr2){if(!attr1||attr1.length<=0)return attr2?attr2.concat():null;if(!attr2||attr2.length<=0)return attr1?attr1.concat():null;var attr=attr1.concat(attr2);var newObj=[];var len=attr.length;var obj=new Object;for(var i=0;i<len;i++){if(obj[attr[i].type]==undefined)obj[attr[i].type]=0;obj[attr[i].type]+=attr[i].value}for(var key in obj)newObj.push(new AttributeData(+key,+obj[key]));return newObj};AttributeData.AttrDel=function(attr1,attr2){var attr=[];for(var i=0;i<attr1.length;i++){var attrData=new AttributeData;attrData.type=attr1[i].type!=0?attr1[i].type:attr2[i].type;attrData.value=attr1[i].value-attr2[i].value;attr.push(attrData)}return attr};AttributeData.AttrMultiply=function(attr1,attr2){var attr=[];for(var i=0;i<attr1.length;i++){var attrData=new AttributeData;attrData.type=attr1[i].type!=0?attr1[i].type:attr2[i].type;attrData.value=attr1[i].value*(1+attr2[i].value/1e4);attr.push(attrData)}return attr};AttributeData.transformAttr=function(attrObj){var attrList=[];for(var key in attrObj){var attr=new AttributeData;attr.type=attrObj[key].type;attr.value=attrObj[key].value;attrList.push(attr)}for(var i=0;i<attrList.length-1;i++){for(var j=0;j<attrList.length-i-1;j++){if(attrList[j]<attrList[j+1]){var temp=attrList[j+1];attrList[j+1]=attrList[j];attrList[j]=temp}}}return attrList};AttributeData.getAttStr=function(att,intervals,newline,sign,isInserte,isShowAttName,info,endSign,twoColumn,typeColor,valueColor,showSpecial){if(intervals===void 0){intervals=4}if(newline===void 0){newline=1}if(sign===void 0){sign="+"}if(isInserte===void 0){isInserte=false}if(isShowAttName===void 0){isShowAttName=true}if(twoColumn===void 0){twoColumn=false}if(typeColor===void 0){typeColor=-1}if(valueColor===void 0){valueColor=-1}if(showSpecial===void 0){showSpecial=false}var str="";var space=0;if(att instanceof AttributeData)return this.getAttStrByType(att,intervals,sign,isInserte,isShowAttName,twoColumn,typeColor,valueColor);else if(att instanceof Array){var atts=att;var len=atts.length-1;for(var i=0;i<atts.length;i++){if(atts[i].type==0)continue;if(!showSpecial){if(atts[i].type==AttributeType.atHpEx||atts[i].type==AttributeType.atAtkEx||atts[i].type==AttributeType.atDamageReduction||atts[i].type==AttributeType.atDefEx||atts[i].type==AttributeType.atResEx){space=-1;continue}}str+=this.getAttStrByType(atts[i],intervals,sign,isInserte,isShowAttName,twoColumn,typeColor,valueColor);if(info&&info.attr_add){str+="+"+Math.floor(atts[i].value*(info.attr_add/100))}if(endSign)str+=endSign;if(twoColumn){if(i%2==1){for(var j=0;j<newline;j++)str+="\n"}}else{if(i<len+space){for(var j=0;j<newline;j++)str+="\n"}}}}else{var objAtts=[];for(var k in this.translate){if(isNaN(att[k]))continue;var a=new AttributeData;a.type=parseInt(this.translate[k]);a.value=att[k];objAtts.push(a)}return this.getAttStr(objAtts,intervals,newline,sign,isInserte)}if(space<0){var index=str.lastIndexOf("\n");str=str.substring(0,index)}return str};AttributeData.getAttStr1=function(att,format){var str="";for(var i=0;i<att.length;i++){str+=this.getAttStrByType1(att[i],format);if(i<att.length-1){str+=StringUtils.repeatStr("\n",format.emptyLine+1)}}return str};AttributeData.getAttStrByType1=function(att,format){var typeName=AttributeData.getAttrStrByType(att.type);var type=att.type;var sign=format.sign;var valueStr="";if(type==AttributeType.atCrit)valueStr=att.value/100+"%";else if(type==AttributeType.atTogetherHolyDamege||type==AttributeType.atHolyDamege)valueStr=att.value.toString();else if(type>=AttributeType.atHpEx)if(type==AttributeType.atStunTime)valueStr=att.value/1e3+i18n("AttributeData_0");else if(type==AttributeType.atAtkEx)valueStr=att.value/100+"%";else if(type==AttributeType.atCritHurt)valueStr=(att.value>>0)+"";else valueStr=(att.value/100>>0)+"%";else valueStr=att.value.toString();var str=StringUtils.addColor(typeName+format.sign,format.wordColor);if(format.isShowAttName)str=StringUtils.complementByChar(str,format.intervals);var result=str+StringUtils.addColor(valueStr,format.attrColor);return result};AttributeData.getAttStrByType=function(att,interval,sign,isInserte,isShowAttName,twoColumn,typeColor,valueColor){if(interval===void 0){interval=4}if(sign===void 0){sign="+"}if(isInserte===void 0){isInserte=true}if(isShowAttName===void 0){isShowAttName=true}if(twoColumn===void 0){twoColumn=false}if(typeColor===void 0){typeColor=-1}if(valueColor===void 0){valueColor=-1}var str="";if(isShowAttName){if(isInserte){if(twoColumn){str=AttributeData.getAttrStrByType(att.type)}else{str=StringUtils.complementByChar(AttributeData.getAttrStrByType(att.type),interval*8)}}else{str=AttributeData.getAttrStrByType(att.type)}}if(typeColor>-1){str=i18n("AttributeData_111",typeColor,str+sign)}else{str=str+sign}switch(att.type){case AttributeType.atCrit:case AttributeType.atZhuiMingPro:var v=att.value/100+"%";if(valueColor>-1){str+=i18n("AttributeData_111",valueColor,v)}else{str+=v}break;case AttributeType.atStunTime:v=att.value/1e3+i18n("AttributeData_1");if(valueColor>-1){str+=i18n("AttributeData_111",valueColor,v)}else{str+=v}break;case AttributeType.atJob1HpEx:case AttributeType.atJob2HpEx:case AttributeType.atJob3HpEx:case AttributeType.atHp:case AttributeType.atMp:case AttributeType.atMaxHp:case AttributeType.atMaxMp:case AttributeType.atAttack:case AttributeType.atDef:case AttributeType.atRes:case AttributeType.atTough:case AttributeType.atMoveSpeed:case AttributeType.atAttackSpeed:case AttributeType.maxNeiGong:case AttributeType.atNeiGongRestore:case AttributeType.atJob1AtkEx:case AttributeType.atJob2AtkEx:case AttributeType.atJob3AtkEx:case AttributeType.atJob1DefEx:case AttributeType.atJob2DefEx:case AttributeType.atJob3DefEx:case AttributeType.atJob1ResEx:case AttributeType.atJob2ResEx:case AttributeType.atJob3ResEx:case AttributeType.atHolyDamege:case AttributeType.atTogetherHolyDamege:case AttributeType.atZhuiMingVal:case AttributeType.atCritHurt:case AttributeType.atHuiXinDamage:case AttributeType.atDeadLyHurt:case AttributeType.atDeadLyHurtResist:case AttributeType.atCritHurtResist:case AttributeType.atHearthDamege:v=att.value.toString();if(valueColor>-1){str+=i18n("AttributeData_111",valueColor,v)}else{str+=v}break;default:v=(att.value/100).toFixed(1)+"%";if(valueColor>-1){str+=i18n("AttributeData_111",valueColor,v)}else{str+=v}}if(att.type==AttributeType.atYuPeiDeterDam)str=i18n("AttributeData_108",str);if(isInserte&&twoColumn){str=StringUtils.complementByChar(str,interval*8)}return str};AttributeData.getExtAttStrByType=function(att,interval,sign,isInserte,isShowAttName){if(interval===void 0){interval=4}if(sign===void 0){sign="+"}if(isInserte===void 0){isInserte=false}if(isShowAttName===void 0){isShowAttName=true}var str="";if(isShowAttName)str=StringUtils.complementByChar(AttributeData.getExtAttrStrByType(att.type),interval*8);if(att.type==ExAttributeType.eatGodBlessRate||att.type==ExAttributeType.eatGodBlessProbability||att.type==ExAttributeType.eatAttackAddHpProbability||att.type==ExAttributeType.eatDeathCurseProbability||att.type==ExAttributeType.eatAddWarriorDamageInc||att.type==ExAttributeType.eatAddMageDamageInc||att.type==ExAttributeType.eatAddTaoistDamageInc||att.type==ExAttributeType.eatAddToTaoistDamageInc||att.type==ExAttributeType.eatSubWarriorDamageInc||att.type==ExAttributeType.eatSubMageDamageInc||att.type==ExAttributeType.eatSubTaoistDamageInc||att.type==ExAttributeType.eatTogetherHitFree||att.type==ExAttributeType.eatMiss||att.type==ExAttributeType.eatTogetherHitMonDamageInc||att.type==ExAttributeType.eatTogetherHitRoleDamageInc||att.type==ExAttributeType.eatAddToWarriorDamageInc||att.type==ExAttributeType.eatAddToMageDamageInc||att.type==ExAttributeType.eatAddToMageDamageInc||att.type==ExAttributeType.eatDeathCurseDamageIncrease)str+=sign+att.value/100+"%";else if(att.type==ExAttributeType.eatDeathCurseTime){str+=sign+att.value/1e3+i18n("AttributeData_2")}else if(att.type==ExAttributeType.eatIgnoreReflect){str+=""}else str+=sign+att.value;return str};AttributeData.inserteBlank=function(str,blankNum,location){if(location===void 0){location=1}var strLen=str.length;var blank="";while(blankNum--){blank+=" "}var nStr="";switch(location){case 0:nStr=blank+str;break;case 1:nStr=str.slice(0,strLen/2)+blank+str.slice(strLen/2);break;case 2:nStr=str+blank;break}return nStr};AttributeData.getAttrInfoByItemData=function(data){var config=GlobalConfig.EquipConfig[data.configID];var attrStr="";var type=0;for(var k in this.translate){if(config[k]<=0)continue;for(var i=0;i<data.att.length;i++){type=data.att[i].type;if(this.translate[k]==type){attrStr+=AttributeData.getAttrStrByType(type)+": ";attrStr+=config[k]+" +"+data.att[i].value+"\n"}}}return attrStr};AttributeData.getAttrStrByType=function(type){var str="";switch(type){case AttributeType.atHp:str=i18n("AttributeData_3");break;case AttributeType.atMp:str=i18n("AttributeData_4");break;case AttributeType.atMaxHp:str=i18n("AttributeData_5");break;case AttributeType.atMaxMp:str=i18n("AttributeData_6");break;case AttributeType.atAttack:str=i18n("AttributeData_7");break;case AttributeType.atDef:str=i18n("AttributeData_8");break;case AttributeType.atRes:str=i18n("AttributeData_9");break;case AttributeType.atCrit:str=i18n("AttributeData_10");break;case AttributeType.atTough:str=i18n("AttributeData_11");break;case AttributeType.atMoveSpeed:str=i18n("AttributeData_12");break;case AttributeType.atAttackSpeed:str=i18n("AttributeData_13");break;case AttributeType.atHpEx:str=i18n("AttributeData_14");break;case AttributeType.atAtkEx:str=i18n("AttributeData_15");break;case AttributeType.atStunPower:str=i18n("AttributeData_16");break;case AttributeType.atStunRes:str=i18n("AttributeData_17");break;case AttributeType.atStunTime:str=i18n("AttributeData_18");break;case AttributeType.atDamageReduction:str=i18n("AttributeData_19");break;case AttributeType.atCritHurt:str=i18n("AttributeData_20");break;case AttributeType.atRegeneration:str=i18n("AttributeData_21");break;case AttributeType.atPenetrate:str=i18n("AttributeData_22");break;case AttributeType.atCritEnhance:str=i18n("AttributeData_23");break;case AttributeType.atRoleDamageEnhance:str=i18n("AttributeData_24");break;case AttributeType.atRoleDamageReduction:str=i18n("AttributeData_25");break;case AttributeType.atDefEx:str=i18n("AttributeData_26");break;case AttributeType.atResEx:str=i18n("AttributeData_27");break;case AttributeType.atJob1HpEx:str=i18n("AttributeData_28");break;case AttributeType.atJob2HpEx:str=i18n("AttributeData_29");break;case AttributeType.atJob3HpEx:str=i18n("AttributeData_30");break;case AttributeType.atNeiGongRestore:str=i18n("AttributeData_31");break;case AttributeType.cruNeiGong:str=i18n("AttributeData_32");break;case AttributeType.maxNeiGong:str=i18n("AttributeData_33");break;case AttributeType.neigongAbsorbHurt:str=i18n("AttributeData_34");break;case AttributeType.atJob1AtkEx:str=i18n("AttributeData_35");break;case AttributeType.atJob2AtkEx:str=i18n("AttributeData_36");break;case AttributeType.atJob3AtkEx:str=i18n("AttributeData_37");break;case AttributeType.atJob1DefEx:str=i18n("AttributeData_38");break;case AttributeType.atJob2DefEx:str=i18n("AttributeData_39");break;case AttributeType.atJob3DefEx:str=i18n("AttributeData_40");break;case AttributeType.atJob1ResEx:str=i18n("AttributeData_41");break;case AttributeType.atJob2ResEx:str=i18n("AttributeData_42");break;case AttributeType.atJob3ResEx:str=i18n("AttributeData_43");break;case AttributeType.atYuPeiDeterDam:str=i18n("AttributeData_44");break;case AttributeType.atCritEnhanceResist:str=i18n("AttributeData_45");break;case AttributeType.atHolyDamege:str=i18n("AttributeData_46");break;case AttributeType.atHolyMaster:str=i18n("AttributeData_47");break;case AttributeType.atHolyResist:str=i18n("AttributeData_48");break;case AttributeType.atTogetherHolyDamege:str=i18n("AttributeData_49");break;case AttributeType.atZhuiMingVal:str=i18n("AttributeData_50");break;case AttributeType.atHuiXinDamage:str=i18n("AttributeData_51");break;case AttributeType.atNeiGongEx:str=i18n("AttributeData_52");break;case AttributeType.atDeadLyPro:str=i18n("AttributeData_53");break;case AttributeType.atDeadLyMaster:str=i18n("AttributeData_54");break;case AttributeType.atDeadLyResist:str=i18n("AttributeData_55");break;case AttributeType.atBladeMailPer:str=i18n("AttributeData_56");break;case AttributeType.atDefPen:str=i18n("AttributeData_57");break;case AttributeType.atResPen:str=i18n("AttributeData_58");break;case AttributeType.atDeadLyHurt:str=i18n("AttributeData_59");break;case AttributeType.atDeadLyHurtResist:str=i18n("AttributeData_60");break;case AttributeType.atCritHurtResist:str=i18n("AttributeData_61");break;case AttributeType.atHearthDamege:str=i18n("AttributeData_62");break;default:}return str};AttributeData.getExtAttrStrByType=function(type){var str="";switch(type){case ExAttributeType.eatReflectProbability:str=i18n("AttributeData_63");break;case ExAttributeType.eatReflectRate:str=i18n("AttributeData_64");break;case ExAttributeType.eatIgnoreReflect:str=i18n("AttributeData_65");break;case ExAttributeType.eatGodBlessProbability:str=i18n("AttributeData_66");break;case ExAttributeType.eatGodBlessRate:str=i18n("AttributeData_67");break;case ExAttributeType.eatDeathCurseProbability:str=i18n("AttributeData_68");break;case ExAttributeType.eatDeathCurseDamageIncrease:str=i18n("AttributeData_69");break;case ExAttributeType.eatDeathCurseTime:str=i18n("AttributeData_70");break;case ExAttributeType.eatAllCrit:str=i18n("AttributeData_71");break;case ExAttributeType.eatAllCritTime:str=i18n("AttributeData_72");break;case ExAttributeType.eatBeHitTimesDodge:str=i18n("AttributeData_73");break;case ExAttributeType.eatAttackTimesCrit:str=i18n("AttributeData_74");break;case ExAttributeType.eatAttackAddHpProbability:str=i18n("AttributeData_75");break;case ExAttributeType.eatAttackAddHpValue:str=i18n("AttributeData_76");break;case ExAttributeType.eatAddToWarriorDamageInc:str=i18n("AttributeData_77");break;case ExAttributeType.eatAddToMageDamageInc:str=i18n("AttributeData_78");break;case ExAttributeType.eatAddToTaoistDamageInc:str=i18n("AttributeData_79");break;case ExAttributeType.eatSubWarriorDamageInc:str=i18n("AttributeData_80");break;case ExAttributeType.eatSubMageDamageInc:str=i18n("AttributeData_81");break;case ExAttributeType.eatSubTaoistDamageInc:str=i18n("AttributeData_82");break;case ExAttributeType.eatTogetherHitFree:str=i18n("AttributeData_83");break;case ExAttributeType.eatTogetherHitMonDamageInc:str=i18n("AttributeData_84");break;case ExAttributeType.eatTogetherHitRoleDamageInc:str=i18n("AttributeData_85");break;case ExAttributeType.eatTogetherHitCdSub:str=i18n("AttributeData_86");break;case ExAttributeType.eatAdditionalHarm:str=i18n("AttributeData_87");break;case ExAttributeType.eatReductionHarm:str=i18n("AttributeData_88");break;case ExAttributeType.eatMiss:str=i18n("AttributeData_89");break;case ExAttributeType.eatBaseSkillExArg:str=i18n("AttributeData_90");break;case ExAttributeType.eatMultipleCrit:str=i18n("AttributeData_91");break;case ExAttributeType.eatMultipleCritCoeff:str=i18n("AttributeData_92");break;case ExAttributeType.atMultipleCritHurt:str=i18n("AttributeData_93");break;case ExAttributeType.eatAddWarriorDamageInc:str=i18n("AttributeData_94");break;case ExAttributeType.eatAddMageDamageInc:str=i18n("AttributeData_95");break;case ExAttributeType.eatAddTaoistDamageInc:str=i18n("AttributeData_96");break;case ExAttributeType.eatMultipleCritTime:str=i18n("AttributeData_97");break;case ExAttributeType.eatAttackAddHpTime:str=i18n("AttributeData_98");break;case ExAttributeType.eatHit:str=i18n("AttributeData_99");break;default:}return str};AttributeData.getExAttrNameByAttrbute=function(att,showValue,sign,valueColor){if(showValue===void 0){showValue=false}if(sign===void 0){sign="："}if(valueColor===void 0){valueColor=undefined}var str=AttributeData.getExtAttrStrByType(att.type);var value="";if(showValue){switch(att.type){case ExAttributeType.eatAddWarriorDamageInc:case ExAttributeType.eatAddMageDamageInc:case ExAttributeType.eatAddTaoistDamageInc:case ExAttributeType.eatSubWarriorDamageInc:case ExAttributeType.eatSubMageDamageInc:case ExAttributeType.eatSubTaoistDamageInc:case ExAttributeType.eatTogetherHitFree:case ExAttributeType.eatTogetherHitMonDamageInc:case ExAttributeType.eatTogetherHitRoleDamageInc:case ExAttributeType.eatAllCrit:case ExAttributeType.eatHit:case ExAttributeType.eatMiss:value=att.value/100+"%";break;default:value+=att.value}}if(valueColor!=undefined){str=i18n("AttributeData_109",str,sign,valueColor,value)}else{str+=sign+value}return str};AttributeData.getEEquipAttrStrByType=function(type){var str="";switch(type){case EquipAddAttrType.EquipSlotType_Weapon:str=i18n("AttributeData_100");break;case EquipAddAttrType.EquipSlotType_Helmet:str=i18n("AttributeData_101");break;case EquipAddAttrType.EquipSlotType_Coat:str=i18n("AttributeData_102");break;case EquipAddAttrType.EquipSlotType_Necklace:str=i18n("AttributeData_103");break;case EquipAddAttrType.EquipSlotType_Accessory1:str=i18n("AttributeData_104");break;case EquipAddAttrType.EquipSlotType_Accessory2:str=i18n("AttributeData_105");break;case EquipAddAttrType.EquipSlotType_Ring1:str=i18n("AttributeData_106");break;case EquipAddAttrType.EquipSlotType_Ring2:str=i18n("AttributeData_107");break}return str};AttributeData.getAttrStrAdd=function(attrbute,viplv){var attr=[];if(UserVip.ins().lv>=viplv){var num_1=GlobalConfig.VipConfig[viplv].attrAddition["percent"];num_1=num_1?num_1:0;attrbute.forEach(function(element){var attrdata=new AttributeData;attrdata.type=element.type;attrdata.value=element.value*(100+num_1)/100>>0;attr.push(attrdata)})}else attr=attrbute;return attr};AttributeData.getAttrStarAdd=function(attrbute,count){var attr=[];attrbute.forEach(function(element){var attrdata=new AttributeData;attrdata.type=element.type;attrdata.value=element.value*count>>0;attr.push(attrdata)});return attr};AttributeData.getAttrNameByAttrbute=function(att,showValue,sign,isInserte,valueColor){if(showValue===void 0){showValue=false}if(sign===void 0){sign="："}if(isInserte===void 0){isInserte=false}if(valueColor===void 0){valueColor=undefined}var str=AttributeData.getAttrStrByType(att.type);if(isInserte)str=AttributeData.inserteBlank(str,7);var value="";if(showValue){switch(att.type){case AttributeType.atCrit:case AttributeType.atTough:value=att.value/100+"%";break;default:value=att.value+""}}if(valueColor!=undefined){str=i18n("AttributeData_110",str,sign,valueColor,value)}else{str+=sign+value}return str};AttributeData.getPercentAttr=function(arrAttr,percent){var newarrAttr=[];for(var i=0;i<arrAttr.length;i++){var attrData=new AttributeData;attrData.type=arrAttr[i].type;attrData.value=Math.floor(arrAttr[i].value*(1+percent));newarrAttr.push(attrData)}return newarrAttr};AttributeData.getPowerBy=function(arrAttr){if(!arrAttr)return 0;var power=0;return power};AttributeData.sortAttribute=function(a,b){return Algorithm.sortAsc(a.type,b.type)};AttributeData.copyAttrbute=function(attr){var att=new AttributeData;att.type=attr.type;att.value=attr.value;return att};AttributeData.addAttrToList=function(list,ele){if(!list[ele.type]){var newAttr=new AttributeData;newAttr.type=ele.type;newAttr.value=0;list[ele.type]=newAttr}var listItem=list[ele.type];listItem.value+=ele.value};AttributeData.FILTER_EXTDATA_ID=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,35,37,38,39];AttributeData.FILTER_BASE_DATA_ID=[18,20];AttributeData.translate={hp:AttributeType.atMaxHp,atk:AttributeType.atAttack,def:AttributeType.atDef,res:AttributeType.atRes,crit:AttributeType.atCrit,tough:AttributeType.atTough};AttributeData.exRelate={2:AttributeType.atHpEx,4:AttributeType.atAtkEx,5:AttributeType.atDefEx,6:AttributeType.atResEx};return AttributeData}();__reflect(AttributeData.prototype,"AttributeData");var AttributeFormat=function(){function AttributeFormat(){this.intervals=4;this.emptyLine=0;this.sign="+";this.spaceCount=0;this.isShowAttName=1;this.wordColor=AttributeFormat.DEFAULT_COLOR;this.attrColor=AttributeFormat.DEFAULT_COLOR}AttributeFormat.getFormat=function(intervals,emptyLine,sign,spaceCount,isShowAttName,wordColor,attrColor){if(intervals===void 0){intervals=4}if(emptyLine===void 0){emptyLine=0}if(sign===void 0){sign="+"}if(spaceCount===void 0){spaceCount=0}if(isShowAttName===void 0){isShowAttName=1}if(wordColor===void 0){wordColor=this.DEFAULT_COLOR}if(attrColor===void 0){attrColor=this.DEFAULT_COLOR}var format=new AttributeFormat;format.intervals=intervals;format.emptyLine=emptyLine;format.sign=sign;format.spaceCount=spaceCount;format.isShowAttName=isShowAttName;format.wordColor=wordColor;format.attrColor=attrColor;return format};AttributeFormat.FORMAT_1=function(){return this.getFormat(0,0,"：")};AttributeFormat.FORMAT_2=function(){var format=this.FORMAT_1();format.attrColor=242004;return format};AttributeFormat.DEFAULT_COLOR=14668213;return AttributeFormat}();__reflect(AttributeFormat.prototype,"AttributeFormat");var DebugPlatform=function(){function DebugPlatform(){}DebugPlatform.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,{nickName:"username"}]})})};DebugPlatform.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})};return DebugPlatform}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]);if(!window.platform){window.platform=new DebugPlatform}var ObjectPool=function(){function ObjectPool(){this._objs=new Array}ObjectPool.prototype.pushObj=function(obj){this._objs.push(obj)};ObjectPool.prototype.popObj=function(){if(this._objs.length>0){return this._objs.pop()}else{return null}};ObjectPool.prototype.clear=function(){while(this._objs.length>0){this._objs.pop()}};ObjectPool.pop=function(refKey){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}if(!ObjectPool._content[refKey]){ObjectPool._content[refKey]=[]}var list=ObjectPool._content[refKey];if(list.length){var i=list.pop();return i}else{var classZ=egret.getDefinitionByName(refKey);var argsLen=args.length;var obj=void 0;if(argsLen==0){obj=new classZ}else if(argsLen==1){obj=new classZ(args[0])}else if(argsLen==2){obj=new classZ(args[0],args[1])}else if(argsLen==3){obj=new classZ(args[0],args[1],args[2])}else if(argsLen==4){obj=new classZ(args[0],args[1],args[2],args[3])}else if(argsLen==5){obj=new classZ(args[0],args[1],args[2],args[3],args[4])}obj.ObjectPoolKey=refKey;return obj}};ObjectPool.popWithExtraKey=function(refKey,extraKey){if(!ObjectPool._content[refKey]){ObjectPool._content[refKey]=[]}var obj;var list=ObjectPool._content[refKey];if(list.length){for(var i=0;i<list.length;i++){if(list[i].extraKey==extraKey){obj=list[i];list.splice(i,1);break}}}if(!obj){var classZ=egret.getDefinitionByName(refKey);obj=new classZ(extraKey);obj.extraKey=extraKey;obj.ObjectPoolKey=refKey}return obj};ObjectPool.push=function(obj){if(obj==null){return false}var refKey=obj.ObjectPoolKey;if(!ObjectPool._content[refKey]||ObjectPool._content[refKey].indexOf(obj)>-1){return false}ObjectPool._content[refKey].push(obj);return true};ObjectPool.clear=function(){ObjectPool._content={}};ObjectPool.clearClass=function(refKey,clearFuncName){if(clearFuncName===void 0){clearFuncName=null}var list=ObjectPool._content[refKey];while(list&&list.length){var obj=list.pop();if(clearFuncName){obj[clearFuncName]()}obj=null}ObjectPool._content[refKey]=null;delete ObjectPool._content[refKey]};ObjectPool.dealFunc=function(refKey,dealFuncName){var list=ObjectPool._content[refKey];if(list==null){return}var i=0;var len=list.length;for(i;i<len;i++){list[i][dealFuncName]()}};ObjectPool._content={};return ObjectPool}();__reflect(ObjectPool.prototype,"ObjectPool");var Bezier=function(){function Bezier(fp,ep){this._fromPoint=fp;this._toPoint=ep}Bezier.pop=function(fp,ep){var bezier=null;if(this._pool.length){bezier=this._pool.pop();bezier.fromPoint=fp;bezier.toPoint=ep}else{bezier=new Bezier(fp,ep)}return bezier};Bezier.push=function(bezier){if(bezier){bezier.display=null;bezier.ease=null;bezier.fromPoint=null;bezier.toPoint=null;bezier.centerPoint=null;this._pool.push(bezier)}};Object.defineProperty(Bezier.prototype,"fromPoint",{set:function(value){this._fromPoint=value},enumerable:true,configurable:true});Object.defineProperty(Bezier.prototype,"toPoint",{set:function(value){this._toPoint=value},enumerable:true,configurable:true});Object.defineProperty(Bezier.prototype,"display",{set:function(value){this._display=value},enumerable:true,configurable:true});Object.defineProperty(Bezier.prototype,"ease",{set:function(value){this._ease=value},enumerable:true,configurable:true});Object.defineProperty(Bezier.prototype,"centerPoint",{set:function(value){this._centerPoint=value},enumerable:true,configurable:true});Bezier.prototype.start=function(time,callback,callObj,delay){var _this=this;if(delay===void 0){delay=0}egret.Tween.get(this).wait(delay).to({factor:1},time,this._ease).call(function(){egret.Tween.removeTweens(_this);if(callback){callback.call(callObj)}})};Object.defineProperty(Bezier.prototype,"factor",{get:function(){return 0},set:function(value){this._display.x=(1-value)*(1-value)*this._fromPoint.x+2*value*(1-value)*this._centerPoint.x+value*value*this._toPoint.x;this._display.y=(1-value)*(1-value)*this._fromPoint.y+2*value*(1-value)*this._centerPoint.y+value*value*this._toPoint.y},enumerable:true,configurable:true});Bezier._pool=[];return Bezier}();__reflect(Bezier.prototype,"Bezier");var EntityHideBody=function(_super){__extends(EntityHideBody,_super);function EntityHideBody(){var _this=_super.call(this)||this;_this.isOpen=false;_this.isShow=false;_this.showHandles=[];_this.showNum=10;_this.storageKey="hide_fbtype_";_this.lastAtkHandle=0;_this.lastFbID=0;_this.observe(GameLogic.ins().postRemoveEntity,_this.onRemoveEntity);_this.observe(GameLogic.ins().postAtkTarget,_this.onChangeTarget);_this.observe(UserBoss.ins().postRemainTime,_this.onRoleDie);_this.observe(CityCC.ins().postRemainTime,_this.onRoleDie);_this.observe(DevildomSys.ins().postRevive,_this.onRoleDie);_this.observe(KFBossSys.ins().postRevive,_this.onRoleDie);return _this}EntityHideBody.ins=function(){return _super.ins.call(this)};EntityHideBody.prototype.changeScene=function(){if(this.lastFbID!=GameMap.fubenID){this.lastFbID=GameMap.fubenID;this.isOpen=this.getIsOpen();this.showHandles.length=0;this.lastAtkHandle=0;if(this.isOpen){var b=SysSetting.ins().getItem(this.storageKey+GameMap.fbType);if(b==undefined||b==null){this.isShow=false;this.setShowState(this.isShow)}else{this.isShow=!SysSetting.ins().getBool(this.storageKey+GameMap.fbType)}}if(this.isOpen){var view=ViewManager.ins().open(ShieldWin);if(GameMap.fubenID==50002){view.setBtnBottom(200)}else{view.setBtnBottom(140)}}else{ViewManager.ins().close(ShieldWin)}}};EntityHideBody.prototype.onCreateEntity=function(model){if(!this.isOpen)return;if(model.isMy||model.type!=EntityType.Role&&model.type!=EntityType.LadderPlayer)return;if(this.updateShowHandles(model.masterHandle,true)){this.sendHandlesToServer()}};EntityHideBody.prototype.setShowState=function(isShow){this.isShow=isShow;this.showOrHideEntitys(this.isShow);this.sendHandlesToServer();SysSetting.ins().setBool(this.storageKey+GameMap.fbType,!isShow)};EntityHideBody.prototype.checkIsShowBody=function(handle){if(!this.isOpen)return true;if(!this.isShow)return false;var masterHandle=EntityManager.ins().getRootMasterHandle(handle);if(!masterHandle)return true;return this.showHandles.indexOf(masterHandle)>=0};EntityHideBody.prototype.onRemoveEntity=function(_a){var handle=_a[0],entity=_a[1];if(!this.isOpen)return;if(entity.isMy||!(entity instanceof CharRole))return;if(this.updateShowHandles(entity.infoModel.masterHandle,false)){this.sendHandlesToServer();this.searchNewHandle()}};EntityHideBody.prototype.updateShowHandles=function(masterHandle,isAdd){if(isAdd&&this.showHandles.length>=this.showNum)return false;var index=this.showHandles.indexOf(masterHandle);if(isAdd){if(index==-1){this.showHandles.push(masterHandle);return true}}else{if(index>=0){this.showHandles.splice(index,1);return true}}return false};EntityHideBody.prototype.onChangeTarget=function(){if(!this.isOpen)return;if(GameLogic.ins().currAttackHandle==this.lastAtkHandle)return;var ms=GameLogic.ins().currAttackHandle;var old=this.lastAtkHandle;this.lastAtkHandle=ms;if(!this.isShow){if(old)this.hideEntity(old);if(ms)this.showEntity(ms);this.sendHandlesToServer()}if(!ms)return;if(this.showHandles.indexOf(ms)>=0)return;if(this.showHandles.length>=this.showNum){var masterHandle=this.showHandles.shift();this.hideEntity(masterHandle)}this.showHandles.push(ms);this.showEntity(ms);this.sendHandlesToServer()};EntityHideBody.prototype.onRoleDie=function(){if(!this.isOpen)return;var old=this.lastAtkHandle;this.lastAtkHandle=0;if(!this.isShow){if(old){this.hideEntity(old);this.sendHandlesToServer()}}};EntityHideBody.prototype.searchNewHandle=function(){var entityList=EntityManager.ins().getAllEntity();for(var i in entityList){var info=entityList[i].infoModel;if(info&&!info.isMy&&info.type==EntityType.Role){if(this.updateShowHandles(info.masterHandle,true)){this.showEntity(info.masterHandle);break}}}};EntityHideBody.prototype.showOrHideEntitys=function(isShow){var msList=this.showHandles;for(var _i=0,msList_1=msList;_i<msList_1.length;_i++){var ms=msList_1[_i];isShow?this.showEntity(ms):this.hideEntity(ms)}};EntityHideBody.prototype.showEntity=function(masterHandle){var list=EntityManager.ins().getEntityRelationHandle(masterHandle);for(var _i=0,list_2=list;_i<list_2.length;_i++){var char=list_2[_i];char.showBodyContainer()}};EntityHideBody.prototype.hideEntity=function(masterHandle){var list=EntityManager.ins().getEntityRelationHandle(masterHandle);for(var _i=0,list_3=list;_i<list_3.length;_i++){var char=list_3[_i];char.hideBodyContainer()}};EntityHideBody.prototype.sendHandlesToServer=function(){var msList=this.isShow?this.showHandles:this.lastAtkHandle?[this.lastAtkHandle]:[];GameLogic.ins().sendGetOtherAttr(msList)};EntityHideBody.prototype.getIsOpen=function(){return!!GlobalConfig.ScenesConfig[GameMap.mapID].hideBodyEff};__decorate([callDelay(200)],EntityHideBody.prototype,"sendHandlesToServer",null);return EntityHideBody}(BaseSystem);__reflect(EntityHideBody.prototype,"EntityHideBody");var EntityManager=function(_super){__extends(EntityManager,_super);function EntityManager(){var _this=_super.call(this)||this;_this.entityList={};_this.entityListSkill=[];_this.transferList={};_this.mineList={};_this._masterList={};_this.distances=[];_this.listCount=[];return _this}EntityManager.ins=function(){return _super.ins.call(this)};EntityManager.prototype.getAllEntity=function(){return this.entityList};EntityManager.prototype.resetRole=function(){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var model=SubRoles.ins().getSubRoleByIndex(i);model.name=Actor.myName;if(!this.getEntityByHandle(model.handle)){model.setPos(DropHelp.tempDropPoint.x*GameMap.CELL_SIZE,DropHelp.tempDropPoint.y*GameMap.CELL_SIZE);debug.log(i18n("EntityManager_0"));model.setAtt(AttributeType.atHp,model.getAtt(AttributeType.atMaxHp));model.setAtt(AttributeType.atMp,model.getAtt(AttributeType.atMaxMp));GameLogic.ins().createEntityByModel(model,Team.My)}else{var char=this.getEntityByHandle(model.handle);char.infoModel.setAtt(AttributeType.atHp,model.getAtt(AttributeType.atMaxHp));char.infoModel.setAtt(AttributeType.atMp,model.getAtt(AttributeType.atMaxMp));char.updateBlood(true)}}};EntityManager.prototype.addList=function(char){if(!char.infoModel.handle)char.infoModel.handle=char.hashCode;if(this.entityList[char.infoModel.handle]==char){return}this.entityList[char.infoModel.handle]=char;if(char.infoModel.masterHandle){var msth=char.infoModel.masterHandle;if(!this._masterList[msth])this._masterList[msth]=[];this._masterList[msth].push(char)}if(char.infoModel.type==EntityType.Mine){this.mineList[char.infoModel.index]=char}var count=this.listCount[char.team]||0;this.listCount[char.team]=++count};EntityManager.prototype.addTransfer=function(char){this.transferList[char.infoModel.configID]=char;SkillEffPlayer.bottomLayer.addChild(char)};EntityManager.prototype.removeTransferById=function(configID){var char=this.transferList[configID];if(char){delete this.transferList[configID];DisplayUtils.removeFromParent(char)}};EntityManager.prototype.getTransferById=function(configID){return this.transferList[configID]};EntityManager.prototype.getMineByIndex=function(index){return this.mineList[index]};EntityManager.prototype.removeMineByIndex=function(index){var char=this.mineList[index];if(char){delete this.mineList[index];if(char.infoModel){this.removeByHandle(char.infoModel.handle)}}};EntityManager.prototype.createEntity=function(model,param){switch(model.type){case EntityType.Role:case EntityType.LadderPlayer:{var roleModel=model;if(param&&param[0]!=null){roleModel.team=param[0]}else{if(model.masterHandle&&model.masterHandle==Actor.handle){roleModel.team=Team.My}else{roleModel.team=Team.WillEntity;if(this.entityList[roleModel.handle]!=null){this.entityList[roleModel.handle].destroy();delete this.entityList[roleModel.handle]}}}var role=ObjectPool.pop("CharRole");role.reset();if(roleModel.masterHandle==Actor.handle){var index=void 0;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(i==roleModel.configID){index=i;break}}if(SubRoles.ins().getSubRoleByIndex(index)){roleModel=SubRoles.ins().getSubRoleByIndex(index).mergeData(roleModel)}}role.infoModel=roleModel;role.x=roleModel.x;role.y=roleModel.y;this.addList(role);if(RoleAI.ins().canAddToAi())RoleAI.ins().add(role);var isShowBody=true;if(roleModel.team!=Team.My){if(!EntityShowMgr.ins().checkShowHandle(roleModel.masterHandle)){role.hideBodyContainer();role.updateModel();return null}isShowBody=EntityHideBody.ins().checkIsShowBody(roleModel.masterHandle)}isShowBody?role.showBodyContainer():role.hideBodyContainer();role.updateModel();return role}case EntityType.Monster:case EntityType.CollectionMonst:{if(param&&param[0]!=null){model.team=param[0]}else{if(model.masterHandle&&model.masterHandle!=0){if(model.isMy)model.team=Team.My;else model.team=Team.WillEntity}else model.team=Team.Monster}var monster=ObjectPool.pop("CharMonster");monster.reset();monster.infoModel=model;monster.x=model.x;monster.y=model.y;this.addList(monster);if(RoleAI.ins().canAddToAi())RoleAI.ins().add(monster);var isShowBody=true;if(monster.team!=Team.My&&model.masterHandle){var rootMasterHandle=this.getRootMasterHandle(model.masterHandle);var masters=this.getMasterList(rootMasterHandle);if(masters){for(var _i=0,masters_1=masters;_i<masters_1.length;_i++){var master=masters_1[_i];if(monster!=master&&!master.parent){monster.hideBodyContainer();monster.updateModel();return null}}}if(model.team==Team.WillEntity){isShowBody=EntityHideBody.ins().checkIsShowBody(model.masterHandle)}}isShowBody?monster.showBodyContainer():monster.hideBodyContainer();if(!isShowBody){}monster.updateModel();return monster}case EntityType.DropItem:{var charItem=ObjectPool.pop("CharItem2");charItem.setData(model.itemData);charItem.x=model.x;charItem.y=model.y;charItem.infoModel=model;this.addList(charItem);charItem.addRoatEffect();charItem.addFloatEffect();return charItem}case EntityType.Transfer:{GameMap.hasTransfer=true;var transfer=ObjectPool.pop("CharTransfer");transfer.infoModel=model;this.addTransfer(transfer);transfer.updateModel();return transfer}case EntityType.Npc:{var npc=ObjectPool.pop("CharNpc");npc.infoModel=model;this.addList(npc);npc.updateModel();return npc}case EntityType.Mine:{var miner=ObjectPool.pop("CharMiner");miner.infoModel=model;this.addList(miner);miner.updateModel();return miner}}return null};EntityManager.prototype.removeAll=function(){var entityHandles=[];for(var i in this.entityList){entityHandles.push(i)}for(var _i=0,entityHandles_1=entityHandles;_i<entityHandles_1.length;_i++){var i=entityHandles_1[_i];this.removeByHandle(i)}var transferHandles=[];for(var i in this.transferList){transferHandles.push(i)}for(var _a=0,transferHandles_1=transferHandles;_a<transferHandles_1.length;_a++){var i=transferHandles_1[_a];this.removeTransferById(i)}EncounterFight.ins().stop(true);this.entityList={};this._masterList={};this.transferList={};this.listCount=[]};EntityManager.prototype.hideOtherEntity=function(b){this.isHideOther=b;for(var i in this.entityList){if(this.entityList[i].team!=Team.WillEntity)continue;if(b)DisplayUtils.removeFromParent(this.entityList[i]);else GameLogic.ins().addEntity(this.entityList[i])}};EntityManager.prototype.getEntityRelationHandle=function(handle){var masterHandle=this.getRootMasterHandle(handle);var masters=this.getMasterList(masterHandle);var list=[].concat(masters||[]);for(var _i=0,list_4=list;_i<list_4.length;_i++){var char=list_4[_i];var model=char.infoModel;if(!model)continue;if(model.job==JobConst.DaoShi){var l=this.getMasterList(model.handle);if(l){list=list.concat(l)}break}}return list};EntityManager.prototype.removeByHandle=function(handle,removeDisplay,expEffect){if(removeDisplay===void 0){removeDisplay=true}if(expEffect===void 0){expEffect=false}var entity=this.entityList[handle];if(!entity)return;if(entity.removeTimers!=null){entity.removeTimers()}var isRole=entity instanceof CharRole;var msth=entity.infoModel.masterHandle;if(msth){var arr=this._masterList[msth];for(var i=0;arr&&i<arr.length;i++){if(arr[i]==entity){arr.splice(i,1);break}}if(arr&&arr.length==0)delete this._masterList[msth]}delete this.entityList[handle];for(var i in this.entityList){if(this.entityList[i].infoModel.masterHandle&&this.entityList[i].infoModel.masterHandle==handle)this.removeByHandle(this.entityList[i].infoModel.handle)}var count=this.listCount[entity.team]||0;this.listCount[entity.team]=--count;if(entity instanceof CharMonster){entity.stopMove();entity.removeAllFilters()}egret.Tween.removeTweens(entity);if(removeDisplay){DisplayUtils.removeFromParent(entity);if(entity instanceof CharMonster&&!(entity instanceof CharRole)){entity.destroy()}}RoleAI.ins().remove(entity);DropHelp.tempDropPoint.x=Math.floor(entity.x/GameMap.CELL_SIZE);DropHelp.tempDropPoint.y=Math.floor(entity.y/GameMap.CELL_SIZE);if((GameMap.sceneInMain()||GameMap.fbType==UserFb.FB_TYPE_EXP)&&entity.infoModel.type==EntityType.Monster&&expEffect){GameLogic.ins().postExpMc(entity)}if(entity.infoModel.type==EntityType.Mine){delete this.mineList[entity.infoModel.index];entity.destruct()}return entity};EntityManager.prototype.getEntityByHandle=function(handle){return this.entityList[handle]};EntityManager.prototype.getMasterList=function(masterHandle){return this._masterList[masterHandle]};Object.defineProperty(EntityManager.prototype,"masterList",{get:function(){return this._masterList},enumerable:true,configurable:true});EntityManager.prototype.getRootMasterHandle=function(handle){var target=EntityManager.ins().getEntityByHandle(handle);if(target&&target.infoModel&&target.infoModel.masterHandle>0&&target.infoModel.masterHandle!=handle){return this.getRootMasterHandle(target.infoModel.masterHandle)}else{return handle}};EntityManager.prototype.getMainRole=function(index){var subRole=SubRoles.ins().getSubRoleByIndex(index);if(subRole!=null&&subRole.handle!=null){return this.getEntityByHandle(subRole.handle)}return null};EntityManager.prototype.getJobMainRole=function(index){var i=0;var role;for(var k in SubRoles.ins().jobDic){if(i==index){role=SubRoles.ins().jobDic[k];break}i++}return this.getEntityByHandle(role.handle)};EntityManager.prototype.getNoDieRoleIndex=function(){var len=SubRoles.ins().subRolesLen;var role;for(var k=0;k<len;k++){role=EntityManager.ins().getJobMainRole(k);if(role&&role.getHP()>0&&role.visible)return k}return-1};EntityManager.prototype.getNoDieRole=function(){var len=SubRoles.ins().subRolesLen;var role;for(var k=0;k<len;k++){role=EntityManager.ins().getJobMainRole(k);if(role&&role.getHP()>0&&role.visible){return role}}return null};EntityManager.prototype.getMyOtherRolePos=function(){var selfMaster=this.getNoDieRole();var mylist=this.getEntityByTeam(Team.My);var poxIndex=0;var pos={};for(var i in mylist){var selfTarget=mylist[i];if(selfTarget==selfMaster){continue}var count=mylist.length;var dirs=[1,-1];if(count==2){dirs=[0]}var p=DirUtil.getGridByDir(selfMaster.dir+dirs[poxIndex]!=null?dirs[poxIndex]:0);poxIndex+=1;pos[selfTarget.infoModel.handle]={x:selfMaster.x+p.x,y:selfMaster.y+p.y}}pos[selfMaster.infoModel.handle]={x:selfMaster.x,y:selfMaster.y};return pos};EntityManager.prototype.sortSubRole=function(a,b){return Algorithm.sortAsc(a.infoModel.job,b.infoModel.job)};EntityManager.prototype.getTeamCount=function(t){if(MineFight.ins().isFighting||Encounter.ins().isEncounter())return RoleAI.ins().getTeamCount(t);return this.listCount[t]||0};EntityManager.prototype.checkCount=function(target,range,count,sameTeam){if(count===void 0){count=1}if(sameTeam===void 0){sameTeam=false}var total=0;for(var i in this.entityList){var element=this.entityList[i];if((!sameTeam&&element.team!=target.team||sameTeam&&element.team==target.team)&&MathUtils.getDistanceX2ByObject(target,element)<=Math.pow(range*GameMap.CELL_SIZE,2)){total++;if(total>=count)break}}return total>=count};EntityManager.prototype.checkCanAddBlood=function(t){var isCan=false;for(var j in this.entityList){if(this.entityList[j].team==t&&this.entityList[j].isCanAddBlood){isCan=true}}return isCan};EntityManager.prototype.getEntityBymasterhHandle=function(handle){for(var i in this.entityList){if(this.entityList[i].infoModel&&this.entityList[i].infoModel.masterHandle&&this.entityList[i].infoModel.masterHandle==handle){if(this.entityList[i].infoModel.type!=EntityType.Monster)return this.entityList[i]}}return null};EntityManager.prototype.getEntitysBymasterhHandle=function(handle,type){if(type===void 0){type=-1}var list=[];for(var i in this.entityList){if(list.length>=3)return list;if(this.entityList[i].infoModel&&this.entityList[i].infoModel.masterHandle&&this.entityList[i].infoModel.masterHandle==handle){if(type==-1||type==this.entityList[i].infoModel.type)list.push(this.entityList[i])}}return list};EntityManager.prototype.getEntityByTeam=function(team){if(team===void 0){team=Team.My}var list=[];for(var i in this.entityList){if(this.entityList[i].infoModel&&this.entityList[i].infoModel.team==team){list.push(this.entityList[i])}}return list};EntityManager.prototype.getEntityByMonsterId=function(monsterId){var list=[];for(var i in this.entityList){if(this.entityList[i].infoModel&&this.entityList[i].infoModel.configID==monsterId){list.push(this.entityList[i])}}return list};EntityManager.prototype.screeningTargetByMap=function(selfTarget,target,maxNum,areaId){var areaConfig;if(ErrorLog.Assert(areaConfig,"SkillCastRangeConf no such areaId:"+areaId)){return this.screeningTargetByPos(selfTarget,false,maxNum,Number.MAX_VALUE)}var position=GameMap.getTargetIndex(selfTarget,target,areaConfig.width,areaConfig.height);var hId=areaConfig.range[position];var hAreaConfig;if(!hAreaConfig){return this.screeningTargetByPos(selfTarget,false,maxNum,Number.MAX_VALUE)}var points=[];for(var i=0;i<hAreaConfig.range.length;i++){var point=GameMap.getPoint(hAreaConfig.range[i],hAreaConfig.width,hAreaConfig.height);points.push(point)}points.push(new egret.Point(0,0));var list=GameMap.getIncludeElement(selfTarget,points,this.entityList);return this.screeningTargetByPos(selfTarget,false,maxNum,Number.MAX_VALUE,list)};EntityManager.prototype.screeningTargetByPos=function(selfTarget,sameTeam,maxNum,range,list,rangeEx,spellCaster,KillAll){if(sameTeam===void 0){sameTeam=false}if(maxNum===void 0){maxNum=0}if(range===void 0){range=Number.MAX_VALUE}if(list===void 0){list=this.entityList}if(KillAll===void 0){KillAll=false}var disFun=MathUtils.getDistanceX2ByObject;var range2=range!=null?range:0;var CELL_SIZE=GameMap.CELL_SIZE;if(range!=Number.MAX_VALUE){range2=range*CELL_SIZE*(range*CELL_SIZE)}var inFB=UserFb.ins().checkInFB(true);var checkInRange=null;if(rangeEx==null){checkInRange=function(element){var dis2=disFun(selfTarget,element);if(inFB){var monster_id=element.infoModel.configID;var cfg=GlobalConfig.MonstersConfig[monster_id];var r=cfg&&cfg.radius||10;var s_dis2=dis2==0?0:Math.sqrt(dis2);var s_range2=range2==0?0:Math.sqrt(range2);s_dis2=s_dis2-10-r;if(s_dis2>s_range2){return-1}return Math.pow(s_dis2,2)}if(dis2>range2){return-1}return dis2}}else{var x1=spellCaster.x;var y1=spellCaster.y;var x2=selfTarget.x;var y2=selfTarget.y;var f=rangeEx.f;var d=rangeEx.d;var d2=d*CELL_SIZE*(d*CELL_SIZE);if(rangeEx.t==1){var fAngle=f*Math.PI*.5;var fAngle0=Math.cos(fAngle);checkInRange=function(element){var dis2=disFun(spellCaster,element);if(dis2>d2){return-1}var x3=element.x;var y3=element.y;var angle0=angleF3PB(x1,y1,x2,y2,x3,y3);if(angle0<fAngle0){return-1}return dis2}}else{var dx1=x2-x1,dy1=y2-y1;var ddis2=dx1*dx1+dy1*dy1;if(ddis2>0){var ddis=Math.sqrt(ddis2);dx1=dx1/ddis;dy1=dy1/ddis}else{dx1=1;dy1=0}var dx21=dy1*CELL_SIZE*f*.5,dy21=-dx1*CELL_SIZE*f*.5;var x4=x1+dx1*d*CELL_SIZE;var y4=y1+dy1*d*CELL_SIZE;var px1=x1+dx21,py1=y1+dy21;var px2=x1-dx21,py2=y1-dy21;var px3=x4+dx21,py3=y4+dy21;var px4=x4-dx21,py4=y4-dy21;checkInRange=function(element){var x3=element.x;var y3=element.y;var inRect=pointInRect(x3,y3,px1,py1,px2,py2,px4,py4);var dis2=disFun(spellCaster,element);if(inRect){return dis2}else{return-1}}}}this.distances.length=0;for(var i in list){var element=list[i];if(!KillAll){if(sameTeam&&element.team!=selfTarget.team)continue;if(!sameTeam&&element.team==selfTarget.team)continue;if(selfTarget.team==Team.My&&element.team==Team.Faker)continue;if(selfTarget.team==Team.Faker&&element.team!=Team.Monster&&element.team!=Team.Faker)continue;if(!(element instanceof CharRole)&&element.team!=Team.Monster&&element.team!=Team.WillBoss)continue;if(element.AI_STATE==AI_State.Die)continue;if(Encounter.ins().isEncounter()){if(Team.My==selfTarget.team){if(Team.WillEntity==element.team&&!sameTeam){if(!Encounter.ins().checkIsEncounter(EncounterFight.ins().encounterIndex,element.infoModel))continue}else if(Team.My==element.team&&sameTeam){}else{continue}}else if(Team.WillEntity==selfTarget.team){if(sameTeam&&Team.WillEntity==element.team){}else if(!sameTeam&&EncounterFight.ins().willEntityFightTeam==element.team){}else{continue}}else{}}else{var infoModel=element.infoModel;var me=selfTarget.infoModel;if(!sameTeam&&infoModel instanceof Role&&me instanceof Role){if(infoModel.camp!=undefined&&me.camp!=undefined&&infoModel.camp==me.camp){continue}}}}var priority=checkInRange(element);if(priority>=0){this.distances.push({priority:priority,target:element})}}this.distances.sort(this.sortFunc);var tempArr=[];var len=0;if(maxNum&&!KillAll)len=Math.min(this.distances.length,maxNum);else len=this.distances.length;for(var j=0;j<len;j++){tempArr[j]=this.distances[j].target}return tempArr};EntityManager.prototype.sortFunc=function(a,b){if(a.priority>b.priority)return 1;if(a.priority<b.priority)return-1;return 0};EntityManager.CHAR_DEFAULT_HEIGHT=157;EntityManager.CHAR_DEFAULT_TYPEFACE=146;return EntityManager}(BaseClass);__reflect(EntityManager.prototype,"EntityManager");var RenderTextureManager=function(_super){__extends(RenderTextureManager,_super);function RenderTextureManager(){var _this=_super.call(this)||this;_this._pool=[];_this._useNum=0;if(_this.isLowerQQBrowser()){_this._maxNum=18}else{_this._maxNum=-1}return _this}RenderTextureManager.prototype.isLowerQQBrowser=function(){if(DeviceUtils.IsQQBrowser){var arr=["2013022","Lenovo A630t","SM-G3818","vivo X3t","GT-I9100"];var lower=false;for(var i=0,len=arr.length;i<len;i++){if(navigator.userAgent.indexOf(arr[i])!=-1){lower=true;break}}return lower}return false};RenderTextureManager.prototype.pop=function(){var result=this._pool.pop();if(!result){if(this._maxNum==-1||this._useNum<this._maxNum){result=new egret.RenderTexture;this._useNum++}}return result};RenderTextureManager.prototype.push=function(texture){var exists=false;for(var i=0,len=this._pool.length;i<len;i++){if(this._pool[i]==texture){exists=true;break}}if(!exists){this._pool.push(texture)}};return RenderTextureManager}(BaseClass);__reflect(RenderTextureManager.prototype,"RenderTextureManager");var EntityShowMgr=function(_super){__extends(EntityShowMgr,_super);function EntityShowMgr(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.MAX_SHOW_NUM=3;_this.MAX_EFFECT_NUM=3;_this.isOpen=false;return _this}EntityShowMgr.ins=function(){return _super.ins.call(this)};EntityShowMgr.prototype.changeScene=function(){this.isOpen=!EntityHideBody.ins().isOpen;if(GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS||GameMap.fbType==UserFb.FB_TYPE_KF_ARENA){this.MAX_SHOW_NUM=5}else{this.MAX_SHOW_NUM=3}};EntityShowMgr.prototype.hideFurtherOtherRole=function(){if(this.countShowNum()<this.MAX_SHOW_NUM){return}var role=EntityManager.ins().getNoDieRole();if(!role)return;var dis=0;var handle;var maxDis=StageUtils.ins().getHeight()>>1;var maxDis2=maxDis*maxDis;var entityList=EntityManager.ins().getAllEntity();for(var i in entityList){var entity=entityList[i];if(entity.parent&&entity.infoModel&&entity.team!=Team.My&&entity.infoModel.type==EntityType.Role){var d=MathUtils.getDistanceX2ByObject(role,entity);if(d>maxDis2){handle=entity.infoModel.handle;break}else if(d>dis){dis=d;handle=entity.infoModel.handle}}}this.hideByHandle(handle)};EntityShowMgr.prototype.showNearSomeOne=function(){if(!this.isOpen)return;if(this.countShowNum()>=this.MAX_SHOW_NUM){return}var role=EntityManager.ins().getNoDieRole();if(!role)return;var dis=Number.MAX_VALUE;var handle;var maxDis=StageUtils.ins().getWidth()>>1;var maxDis2=maxDis*maxDis;var entityList=EntityManager.ins().getAllEntity();for(var i in entityList){var entity=entityList[i];if(!entity.parent&&entity.infoModel&&entity.team!=Team.My&&entity.infoModel.type==EntityType.Role){var d=MathUtils.getDistanceX2ByObject(role,entity);if(d<maxDis2){handle=entity.infoModel.handle;break}else if(d<dis){dis=d;handle=entity.infoModel.handle}}}this.showByHandle(handle)};EntityShowMgr.prototype.showHideSomeOne=function(handle){if(!this.isOpen)return;this.hideFurtherOtherRole();this.showByHandle(handle)};EntityShowMgr.prototype.hideByHandle=function(handle){if(GameLogic.ins().currAttackHandle==handle||this.countShowNum()<this.MAX_SHOW_NUM){return}var list=EntityManager.ins().getEntityRelationHandle(handle);for(var _i=0,list_5=list;_i<list_5.length;_i++){var char=list_5[_i];DisplayUtils.removeFromParent(char);char.hideBodyContainer()}};EntityShowMgr.prototype.showByHandle=function(handle){if(!this.isOpen)return;if(this.countShowNum()>=this.MAX_SHOW_NUM){return}var list=EntityManager.ins().getEntityRelationHandle(handle);for(var _i=0,list_6=list;_i<list_6.length;_i++){var char=list_6[_i];GameLogic.ins().addEntity(char);char.showBodyContainer()}};EntityShowMgr.prototype.checkShowSkillEffect=function(){if(this.countShowNum()<this.MAX_EFFECT_NUM){return true}return false};EntityShowMgr.prototype.checkShowHandle=function(handle){if(!this.isOpen)return true;var ins=EntityManager.ins();var masterHandle=ins.getRootMasterHandle(handle);if(!masterHandle)return true;if(this.countShowNum()>=this.MAX_SHOW_NUM){if(ins.masterList[masterHandle]&&ins.masterList[masterHandle].length&&ins.masterList[masterHandle][0].parent){return true}return false}return true};EntityShowMgr.prototype.countShowNum=function(){var showNum=0;if(EntityHideBody.ins().isOpen){return showNum}var masterList=EntityManager.ins().masterList;for(var k in masterList){var masters=masterList[k];if(masters&&masters.length){if(masters[0].parent&&masters[0].team!=Team.My&&masters[0].infoModel&&masters[0].infoModel.type==EntityType.Role){showNum+=1}}}return showNum};return EntityShowMgr}(BaseClass);__reflect(EntityShowMgr.prototype,"EntityShowMgr");var EntityType;(function(EntityType){EntityType[EntityType["Actor"]=0]="Actor";EntityType[EntityType["Role"]=1]="Role";EntityType[EntityType["Monster"]=2]="Monster";EntityType[EntityType["Snpc"]=3]="Snpc";EntityType[EntityType["LadderPlayer"]=4]="LadderPlayer";EntityType[EntityType["CollectionMonst"]=5]="CollectionMonst";EntityType[EntityType["DropItem"]=6]="DropItem";EntityType[EntityType["Npc"]=100]="Npc";EntityType[EntityType["Transfer"]=101]="Transfer";EntityType[EntityType["Mine"]=102]="Mine"})(EntityType||(EntityType={}));window["EntityType"]=EntityType;var ErrorLog=function(){function ErrorLog(){this.stackObj={stack:""}}ErrorLog.ins=function(){this._ins=this._ins||new ErrorLog;return this._ins};ErrorLog.prototype.show=function(str){if(Recharge.ins().plat!="dev"){return}var tapFun=function(){DisplayUtils.removeFromParent(this);this.removeTouchEvent(this["notBtn"],tapFun)};var view=new BaseView;view.skinName="ErrorSkin";view["notBtn"].addEventListener(egret.TouchEvent.TOUCH_TAP,tapFun,view);view["lab"].text=str;StageUtils.ins().getUIStage().addChild(view)};ErrorLog.Assert=function(expr,msg){if(expr)return false;msg+=ErrorLog.ins().getErrorStackInfo();if(LocationProperty.isLocation){ErrorLog.ins().show(msg)}if(ErrorLog.httpLog&&!LocationProperty.isLocation&&ReportData){ReportData.getIns().report(""+msg,ReportData.ERROR)}else{console.log(msg)}return true};ErrorLog.prototype.getErrorStackInfo=function(){var info="";try{Error["captureStackTrace"](this.stackObj,ErrorLog.Assert);info="----"+this.stackObj.stack;this.stackObj.stack=""}catch(e){info=""}return info};ErrorLog.httpLog=true;return ErrorLog}();__reflect(ErrorLog.prototype,"ErrorLog");var Assert=ErrorLog.Assert;window["Assert"]=Assert;var ErrorCapturer=function(){function ErrorCapturer(){}ErrorCapturer.captureError=function(errorMessage,errorStack,inTryCatch){console.error(errorMessage,errorStack);var errMd5=md5_lytj.hex_md5(errorMessage+errorStack).toLowerCase();if(!(errMd5 in ErrorCapturer.allError)){ErrorCapturer.allError[errMd5]=true;var jsonErrorReport={};jsonErrorReport["appname"]="lytj";jsonErrorReport["appver"]=GetUrl();jsonErrorReport["uid"]=LocationProperty.accountUserID;jsonErrorReport["client_id"]="";jsonErrorReport["msg"]=errorMessage;jsonErrorReport["stack_js"]=errorStack;jsonErrorReport["stack_hashcode"]=errMd5;var strJsonErrorReport=JSON.stringify(jsonErrorReport);var getTimeString=function(){var curDate=new Date;var month=curDate.getMonth()>=1&&curDate.getMonth()<=9?"0"+curDate.getMonth():""+curDate.getMonth();var day=curDate.getDate()>=1&&curDate.getDate()<=9?"0"+curDate.getDate():""+curDate.getDate();var hour=curDate.getHours()>=1&&curDate.getHours()<=9?"0"+curDate.getHours():""+curDate.getHours();var minute=curDate.getMinutes()>=1&&curDate.getMinutes()<=9?"0"+curDate.getMinutes():""+curDate.getMinutes();var second=curDate.getSeconds()>=1&&curDate.getSeconds()<=9?"0"+curDate.getSeconds():""+curDate.getSeconds();return""+curDate.getFullYear()+month+day+hour+minute+second};var xmlHttpRequest=new XMLHttpRequest;xmlHttpRequest.open("POST","https://iosupload.lkgame.com/upload/jsonPost2?json="+getTimeString()+"_"+errMd5+strJsonErrorReport,true);xmlHttpRequest.setRequestHeader("Content-Type","text/plain");xmlHttpRequest.send("")}return true};ErrorCapturer.hookTryCatches=function(){};ErrorCapturer.init=function(){ErrorCapturer.hookTryCatches();window.onerror=function(message,filename,lineno,colno,error){ErrorCapturer.captureError(message.toString(),error?error.stack?error.stack.toString():"":"",false);return true}};ErrorCapturer.allError={};return ErrorCapturer}();__reflect(ErrorCapturer.prototype,"ErrorCapturer");window["initErrorLog"]=function initErrorLog(){if(ChannelMgr.ins().isDev()){window.onerror=function(){var info=[];for(var _i=0;_i<arguments.length;_i++){info[_i]=arguments[_i]}var funName="";var callPos="";console.log("[OS] = "+egret.Capabilities.os);console.log(info);if(egret.Capabilities.os=="iOS"){if(info[4]&&info[4].stack){callPos=info[4].stack.toString()}}else{if(info[4]&&info[4].stack){var list=info[4].stack.split("at ");if(list[1]!=null){funName=list[1].split(" ")[0];for(var i=2;i<list.length;i++){var arr=list[i].split("/");callPos+=arr[arr.length-1]}}}}var str=i18n("ErrorLog_0");var resultStr=i18n("ErrorLog_1",info[0])+i18n("ErrorLog_6",info[2],info[3]?info[3]+i18n("ErrorLog_2"):str)+i18n("ErrorLog_4",funName)+i18n("ErrorLog_5",callPos);if(resultStr.indexOf(str)>=0)return;alert(resultStr);egret.ExternalInterface.call("LOG",resultStr);if(!LocationProperty.isLocation&&ReportData)ReportData.getIns().report(""+resultStr,ReportData.ERROR);if(window["getClientVersion"]){window["getClientVersion"](function(ver){var v=parseInt(ver)||0;if(v===LocationProperty.v||v===0){}else{ChannelMgr.ins().reload()}})}}}else{ErrorCapturer.init()}};var ProgressBarEff=function(_super){__extends(ProgressBarEff,_super);function ProgressBarEff(){var _this=_super.call(this)||this;_this.isFisrt=true;_this.maxValue=0;_this.value=0;_this.isPlayMc=true;_this.group=new eui.Group;_this.bgmc=new MovieClip;_this.xianmc=new MovieClip;_this.bordermc=new MovieClip;_this.lbvalue=new eui.Label;_this.offSetX=23;_this.mcWidth=453;_this.bgWidth=493;_this.bgimg=new eui.Image;_this.oldMaxValue=0;_this.oldValue=0;_this.iniUi();return _this}ProgressBarEff.prototype.iniUi=function(){this.touchEnabled=this.touchChildren=false;this.group.x=35;this.group.y=22;this.group.width=0;this.group.height=50;this.group.scrollEnabled=true;this.bgmc.playFile(RES_DIR_EFF+"jindutiaoeff",-1);this.bgmc.x=0;this.bgmc.y=2;this.group.addChild(this.bgmc);this.addChild(this.group);this.xianmc.playFile(RES_DIR_EFF+"jindutiaotoueff",-1);this.xianmc.x=this.group.x+this.group.width-this.offSetX;this.xianmc.y=10;this.xianmc.scrollRect=new egret.Rectangle(0,0,24,39);this.addChild(this.xianmc);this.bgimg.x=14;this.bgimg.y=13;this.bgimg.source="jingyantiao1";this.bgimg.scale9Grid=new egret.Rectangle(54,0,0,37);this.bgimg.width=this.bgWidth;this.addChild(this.bgimg);this.lbvalue.x=this.bgimg.x+(this.bgimg.width-200)/2;this.lbvalue.y=22;this.lbvalue.size=16;this.lbvalue.width=200;this.lbvalue.textAlign="center";this.lbvalue.textColor=16708269;this.lbvalue.stroke=1;this.lbvalue.strokeColor=8277546;this.lbvalue.fontFamily=i18n("ProgressBarEff_0");this.addChild(this.lbvalue)};ProgressBarEff.prototype.setData=function(value,maxValue){this.value=value;this.maxValue=maxValue;this.setui()};ProgressBarEff.prototype.setWidth=function(value){this.bgWidth=value;this.bgimg.width=this.bgWidth;this.lbvalue.x=this.bgimg.x+(this.bgimg.width-200)/2;var scale=value/ProgressBarEff.DEFAULT_WIDTH;this.bgmc.scaleX=scale;this.mcWidth=ProgressBarEff.DEFAULT_MC_WIDTH*scale};ProgressBarEff.prototype.setValue=function(value){this.value=value;this.setui()};ProgressBarEff.prototype.getValue=function(){return this.value};ProgressBarEff.prototype.getMaxValue=function(){return this.maxValue};ProgressBarEff.prototype.reset=function(){this.isFisrt=true;this.oldValue=this.oldMaxValue=this.value=this.maxValue=0};ProgressBarEff.prototype.setMaxValue=function(maxValue){this.maxValue=maxValue;this.setui()};ProgressBarEff.prototype.setui=function(){var _this=this;egret.Tween.removeTweens(this.group);var t=this;if(this.maxValue==0){this.value=100;this.maxValue=100;this.lbvalue.visible=false}else{this.lbvalue.visible=true}if((this.maxValue>this.oldMaxValue&&this.oldMaxValue!=0||this.maxValue==0||this.value<this.oldValue)&&!this.isFisrt){var w=this.oldMaxValue/this.oldMaxValue*this.mcWidth;var w2=this.value/this.oldMaxValue*this.mcWidth;var timer_1=30;var curX_1=this.group.x;var curCurWidth_1=this.group.width;var t1=egret.Tween.get(this.group,{onChange:function(){if(_this.group.width>=_this.mcWidth-3||_this.group.width<3){_this.xianmc.visible=false}else{_this.xianmc.visible=true}_this.xianmc.x=curX_1+curCurWidth_1-_this.offSetX}});t1.to({width:w},150+timer_1).call(function(){var t2=egret.Tween.get(_this.group);var w1=_this.value/_this.maxValue*_this.mcWidth;_this.group.width=0;_this.oldValue=_this.value;_this.oldMaxValue=_this.maxValue;t2.to({width:w1},150+timer_1).call(function(){_this.xianmc.x=_this.group.x+w1-_this.offSetX})})}else{this.oldValue=this.value;var width=0;if(this.value<=0){width=0}else{var newVal=this.value>this.maxValue?this.maxValue:this.value;width=newVal/this.maxValue*this.mcWidth}var t1=egret.Tween.get(this.group,{onChange:function(){if(_this.group.width>=_this.mcWidth-3||_this.group.width<3){_this.xianmc.visible=false}else{_this.xianmc.visible=true}_this.xianmc.x=_this.group.x+_this.group.width-_this.offSetX}});t1.to({width:width},200).call(function(){_this.oldMaxValue=_this.maxValue})}this.lbvalue.text=this.value+"/"+this.maxValue;if(this.isFisrt){this.isFisrt=false;return}};ProgressBarEff.prototype.max=function(){this.maxValue=0;this.setui();this.lbvalue.visible=true;this.lbvalue.text=""};ProgressBarEff.prototype.setLbValueText=function(text){this.setui();this.lbvalue.visible=true;this.lbvalue.text=text};ProgressBarEff.DEFAULT_WIDTH=493;ProgressBarEff.DEFAULT_MC_WIDTH=453;return ProgressBarEff}(egret.DisplayObjectContainer);__reflect(ProgressBarEff.prototype,"ProgressBarEff");var ResultManager=function(_super){__extends(ResultManager,_super);function ResultManager(){return _super.call(this)||this}ResultManager.ins=function(){return _super.ins.call(this)};ResultManager.prototype.create=function(fb){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}var fbType=fb?fb:GameMap.fbType;(_a=AutoTestMgr.ins()).onFbResult.apply(_a,[fbType].concat(param));switch(fbType){case UserFb.FB_TYPE_PERSONAL:case UserFb.FB_TYPE_GUARD_WEAPON:(_b=ViewManager.ins()).open.apply(_b,[PersonalResultWin].concat(param));break;case UserFb.FB_TYPE_TIAOZHAN:(_c=ViewManager.ins()).open.apply(_c,[TongResultWin].concat(param));break;case UserFb.FB_TYPE_FIRE_RING:case UserFb.FB_TYPE_MATERIAL:if(fbType==UserFb.FB_TYPE_FIRE_RING&&param!=undefined&&param[0]!=undefined&&param[0]==0){Activity.ins().removeEvent()}(_d=ViewManager.ins()).open.apply(_d,[MaterialResultWin].concat(param));break;case UserFb.FB_TYPE_NEW_WORLD_BOSS:ViewManager.ins().open(NewWorldBossResultPanel);break;case UserFb.FB_TYPE_CITY:ViewManager.ins().open(CityResultWin,param[1],param[4]);break;case UserFb.FB_TYPE_ALLHUMENBOSS:case UserFb.FB_TYPE_ZHUANSHENGBOSS:case UserFb.FB_TYPE_HOMEBOSS:case UserFb.FB_TYPE_LABA:case UserFb.FB_TYPE_DARK_BOSS:case UserFb.FB_TYPE_HIDE_BOSS:ViewManager.ins().open(BossResultWin,param[1],param[4]);break;case UserFb.FB_TYPE_GOD_WEAPON:case UserFb.FB_TYPE_GOD_WEAPON_TOP:break;case UserFb.FB_TYPE_KF_BOSS:ViewManager.ins().open(KFBossResultWin,param[0],param[1],param[2]);break;case UserFb.FB_TYPE_HARD_FB:(_e=ViewManager.ins()).open.apply(_e,[HardFbResultWin].concat(param));break;default:(_f=ViewManager.ins()).open.apply(_f,[ResultWin].concat(param));break}var _a,_b,_c,_d,_e,_f};return ResultManager}(BaseClass);__reflect(ResultManager.prototype,"ResultManager");var ResourceMgr=function(_super){__extends(ResourceMgr,_super);function ResourceMgr(){var _this=_super.call(this)||this;_this.isFirstEnter=true;_this.resDisTime={};_this.destroyResCalledNum=0;_this.destroyUIResCalledNum=0;_this.isDelayDestroy=false;_this.calcPaths={"resource/eui_skins/":1,"resource/image/":1,"resource/loginAni/":1,"resource/map/":1,"resource/skins/":1,"resource/res/body/":1,"resource/res/city/":1,"resource/res/dbRes/":1,"resource/res/eff/":1,"resource/res/expression/":1,"resource/res/feijian/":1,"resource/res/monster/":1,"resource/res/role/":1,"resource/res/skill/":1,"resource/res/skilleff/":1,"resource/res/sq/":1,"resource/res/warspirit/":1,"resource/res/weapon/":1,"resource/res/wing/":1,"resource/res/xianyueff/":1};_this.observe(GameLogic.ins().postEnterMap,_this.destroy);return _this}ResourceMgr.ins=function(){return _super.ins.call(this)};ResourceMgr.prototype.start=function(){var clearInterval=5*60*1e3;if(egret.Capabilities.isMobile&&egret.Capabilities.os=="iOS"&&!window["isSmallGame"]){clearInterval=20*1e3}TimerManager.ins().doTimer(clearInterval,0,this.destroy,this)};ResourceMgr.prototype.destroy=function(){if(!this.isFirstEnter){var loadedImgSize=this.checkBitmapSize();var clearThreshold=400*1024*1024;if(egret.Capabilities.isMobile&&egret.Capabilities.os=="iOS"&&!window["isSmallGame"]){clearThreshold=250*1024*1024}if(loadedImgSize>=clearThreshold){for(var i=0;i<4;++i){TimerManager.ins().doTimer(3e3*(i+1),1,this.destroyRes,this)}}}else{this.isFirstEnter=false;this.start()}};ResourceMgr.prototype.destroyWin=function(){};ResourceMgr.prototype.disposeResTime=function(hashCode){this.resDisTime[hashCode]=egret.getTimer()};ResourceMgr.prototype.destroyRes=function(){for(var i=0;i<5;++i){TimerManager.ins().doTimer(3e3+500*(i+1),1,this.destroyResImpl,this)}};ResourceMgr.prototype.destroyResImpl=function(){this.destroyResCalledNum+=1;var baseAnalyzer=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE);var fileDic=baseAnalyzer["fileDic"];var t=egret.getTimer();for(var key in fileDic){if(key.indexOf(RES_DIR)<0)continue;var texture=fileDic[key];if(this.checkMcCanDestroy(texture.bitmapData)&&this.checkCanDestroy(texture)){RES.destroyRes(key)}if(egret.getTimer()-t>3){break}}};ResourceMgr.prototype.destroyUIRes=function(){for(var i=0;i<5;++i){TimerManager.ins().doTimer(3e3+500*(i+1),1,this.destroyUIResImpl,this)}};ResourceMgr.prototype.destroyUIResImpl=function(){this.destroyUIResCalledNum+=1;var baseAnalyzer=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE);var fileDic=baseAnalyzer["fileDic"];var baseJson=RES.getAnalyzer(RES.ResourceItem.TYPE_JSON);var resConfig=baseJson["resourceConfig"];var t=egret.getTimer();for(var key in fileDic){var json=resConfig.getRawResourceItem(key);if(json&&json.url.indexOf("image/public/")>=0){continue}if(key.indexOf(MAP_DIR)>=0||key.indexOf(RES_DIR)>=0&&key.indexOf(RES_DIR_EFF)<0)continue;var texture=fileDic[key];if(this.checkCanDestroy(texture)&&this.checkMcCanDestroy(texture.bitmapData)){RES.destroyRes(key)}if(egret.getTimer()-t>3){break}}};ResourceMgr.prototype.checkBitmapSize=function(){var baseAnalyzer=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE);var fileDic=baseAnalyzer["fileDic"];var bit=0;for(var key in fileDic){var texture=baseAnalyzer.getRes(key);bit+=texture.bitmapData.width*texture.bitmapData.height*4}return bit};ResourceMgr.prototype.calcResSize=function(){var baseJson=RES.getAnalyzer(RES.ResourceItem.TYPE_JSON);var resConfig=baseJson["resourceConfig"];var keyMap=resConfig["keyMap"];var baseAnalyzer=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE);var fileDic=baseAnalyzer["fileDic"];var sum={};var allBytes=0;for(var key in fileDic){var path=key;if(key in keyMap){var info=keyMap[key];path=info.url;if(info.type!="image"){console.log(key,info)}}var texture=baseAnalyzer.getRes(key);for(var calcPath in this.calcPaths){if(path.indexOf(calcPath)==0){if(!(calcPath in sum)){sum[calcPath]=0}var bytes=texture.bitmapData.width*texture.bitmapData.height*4;sum[calcPath]+=bytes;allBytes+=bytes}}}var sumarr=[];for(var calcPath in sum){sumarr.push([calcPath,sum[calcPath]])}sumarr=sumarr.sort(function(a,b){return b[1]-a[1]});console.log("=============== loaded path texture bytes");console.log("all = "+Math.floor(allBytes/1e6)+"M");for(var _i=0,sumarr_1=sumarr;_i<sumarr_1.length;_i++){var sume=sumarr_1[_i];var pc=""+sume[1]*100/allBytes;console.log(sume[0],pc.substr(0,Math.min(5,pc.length))+"%",sume[1])}};ResourceMgr.prototype.checkCanDestroy=function(bitmapData){var hashCode;if(bitmapData.bitmapData&&bitmapData.bitmapData.hashCode){hashCode=bitmapData.bitmapData.hashCode}else{hashCode=bitmapData.hashCode}if(!hashCode){return false}var arr=egret.BitmapData["_displayList"][hashCode];if(!arr||!arr.length){if(!this.resDisTime[hashCode])return true;if(egret.getTimer()-this.resDisTime[hashCode]>2500){delete egret.BitmapData["_displayList"][hashCode];delete this.resDisTime[hashCode];return true}}return false};ResourceMgr.prototype.checkMcCanDestroy=function(bitmapData){if(!bitmapData)return false;var hashCode=bitmapData.hashCode;var arr=MovieClip.displayList[hashCode];if(!arr||!arr.length){if(!this.resDisTime[hashCode])return true;if(egret.getTimer()-this.resDisTime[hashCode]>2500){delete MovieClip.displayList[hashCode];delete this.resDisTime[hashCode];return true}}return false};ResourceMgr.prototype.reloadContainer=function(obj,checkHadLoaded){if(checkHadLoaded===void 0){checkHadLoaded=true}var num=obj.numChildren;for(var i=0;i<num;i++){var img=obj.getChildAt(i);if(img instanceof eui.Image){this.reloadImg(img,checkHadLoaded)}else if(img instanceof egret.DisplayObjectContainer){this.reloadContainer(img,checkHadLoaded)}}};ResourceMgr.prototype.reloadImg=function(image,checkHadLoaded){if(checkHadLoaded===void 0){checkHadLoaded=true}var source=image.source;if(source){if(checkHadLoaded){if(image.$bitmapData||image.texture&&image.texture.bitmapData)return}image.source=null;image.source=source}};return ResourceMgr}(BaseSystem);__reflect(ResourceMgr.prototype,"ResourceMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.resourceMgr=ResourceMgr.ins.bind(ResourceMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UIAnimation=function(){function UIAnimation(){}UIAnimation.setAnimation=function(eobj,aniType,others){if(!UIAnimation.checkObj(eobj)){if(others&&typeof others.func=="function")others.func();return}var obj;var className=egret.getQualifiedClassName(eobj);switch(className){case"eui.Button":obj=eobj;break;case"eui.ToggleButton":obj=eobj;break;case"eui.Image":obj=eobj;break;case"eui.Group":obj=eobj;break;case"eui.Rect":obj=eobj;break;case"BaseComponent":obj=eobj;break;case"eui.TabBar":obj=eobj;break;default:obj=eobj;break}if(!obj)return;egret.Tween.removeTweens(obj);var sx=NaN;var sxleft=NaN;var sxhro=NaN;var sxright=NaN;var sxscaleX=NaN;var ex=NaN;var exleft=NaN;var exhro=NaN;var exright=NaN;var exscaleX=NaN;var sy=NaN;var sytop=NaN;var syver=NaN;var sybot=NaN;var syscaleY=NaN;var ey=NaN;var eytop=NaN;var eyver=NaN;var eybot=NaN;var eyscaleY=NaN;var salpha=NaN;var ealpha=NaN;switch(aniType){case UIAnimation.ANITYPE_FADEIN_LEFT_HOR:if(!isNaN(obj.left)){sxleft=obj.left-UIAnimation.diff;exleft=obj.left}if(!isNaN(obj.horizontalCenter)){sxhro=obj.horizontalCenter-UIAnimation.diff;exhro=obj.horizontalCenter}if(!isNaN(obj.right)){sxright=obj.right+UIAnimation.diff;exright=obj.right}if(!isNaN(obj.alpha)){salpha=0;ealpha=obj.alpha}if(!isNaN(obj.x)){sx=obj.x-UIAnimation.diff;ex=obj.x}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_FADEIN_RIGHT_HOR:if(!isNaN(obj.left)){sxleft=obj.left+UIAnimation.diff;exleft=obj.left}if(!isNaN(obj.horizontalCenter)){sxhro=obj.horizontalCenter+UIAnimation.diff;exhro=obj.horizontalCenter}if(!isNaN(obj.right)){sxright=obj.right-UIAnimation.diff;exright=obj.right}if(!isNaN(obj.alpha)){salpha=0;ealpha=obj.alpha}if(!isNaN(obj.x)){sx=obj.x+UIAnimation.diff;ex=obj.x}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_FADEIN_UP_VER:if(!isNaN(obj.top)){sytop=obj.top-UIAnimation.diff;eytop=obj.top}if(!isNaN(obj.verticalCenter)){syver=obj.verticalCenter-UIAnimation.diff;eyver=obj.verticalCenter}if(!isNaN(obj.bottom)){sybot=obj.bottom+UIAnimation.diff;eybot=obj.bottom}if(!isNaN(obj.alpha)){salpha=0;ealpha=obj.alpha}if(!isNaN(obj.y)){sy=obj.y-UIAnimation.diff;ey=obj.y}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_FADEIN_DOWN_VER:if(!isNaN(obj.top)){sytop=obj.top+UIAnimation.diff;eytop=obj.top}if(!isNaN(obj.verticalCenter)){syver=obj.verticalCenter+UIAnimation.diff;eyver=obj.verticalCenter}if(!isNaN(obj.bottom)){sybot=obj.bottom-UIAnimation.diff;eybot=obj.bottom}if(!isNaN(obj.alpha)){salpha=0;ealpha=obj.alpha}if(!isNaN(obj.y)){sy=obj.y+UIAnimation.diff;ey=obj.y}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_IN_LEFT_HOR:if(!isNaN(obj.left)){sxleft=obj.left-obj.width;exleft=obj.left}if(!isNaN(obj.horizontalCenter)){sxhro=obj.horizontalCenter-obj.width;exhro=obj.horizontalCenter}if(!isNaN(obj.right)){sxright=obj.right+obj.width;exright=obj.right}if(!isNaN(obj.alpha)){salpha=0;ealpha=obj.alpha}if(!isNaN(obj.x)){sx=obj.x-obj.width;ex=obj.x}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_IN_RIGHT_HOR:if(!isNaN(obj.left)){sxleft=obj.left+obj.width;exleft=obj.left}if(!isNaN(obj.horizontalCenter)){sxhro=obj.horizontalCenter+obj.width*UIAnimation.hroWidh;exhro=obj.horizontalCenter}if(!isNaN(obj.right)){sxright=obj.right-obj.width*UIAnimation.hroWidh;exright=obj.right}if(!isNaN(obj.alpha)){salpha=0;ealpha=obj.alpha}if(!isNaN(obj.x)){sx=obj.x+obj.width*UIAnimation.hroWidh;ex=obj.x}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_IN_UP_VER:if(!isNaN(obj.top)){sytop=obj.top-obj.height;eytop=obj.top}if(!isNaN(obj.verticalCenter)){syver=obj.verticalCenter-obj.height;eyver=obj.verticalCenter}if(!isNaN(obj.bottom)){sybot=obj.bottom+obj.height;eybot=obj.bottom}if(!isNaN(obj.alpha)){salpha=0;ealpha=obj.alpha}if(!isNaN(obj.y)){sy=obj.y-obj.height;ey=obj.y}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_IN_DOWN_VER:if(!isNaN(obj.top)){sytop=obj.top+obj.height;eytop=obj.top}if(!isNaN(obj.verticalCenter)){syver=obj.verticalCenter+obj.height;eyver=obj.verticalCenter}if(!isNaN(obj.bottom)){sybot=obj.bottom-obj.height;eybot=obj.bottom}if(!isNaN(obj.alpha)){salpha=0;ealpha=obj.alpha}if(!isNaN(obj.y)){sy=obj.y+obj.height;ey=obj.y}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_OUT_LEFT_HOR:if(!isNaN(obj.left)){sxleft=obj.left;exleft=obj.left-obj.width}if(!isNaN(obj.horizontalCenter)){sxhro=obj.horizontalCenter;exhro=obj.horizontalCenter-obj.width}if(!isNaN(obj.right)){sxright=obj.right;exright=obj.right+obj.width}if(!isNaN(obj.alpha)){salpha=obj.alpha;ealpha=0}if(!isNaN(obj.x)){sx=obj.x;ex=obj.x-obj.width}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_OUT_RIGHT_HOR:if(!isNaN(obj.left)){sxleft=obj.left+obj.width;exleft=obj.left}if(!isNaN(obj.horizontalCenter)){sxhro=obj.horizontalCenter;exhro=obj.horizontalCenter+obj.width*UIAnimation.hroWidh}if(!isNaN(obj.right)){sxright=obj.right;exright=obj.right-obj.width*UIAnimation.hroWidh}if(!isNaN(obj.alpha)){salpha=obj.alpha;ealpha=0}if(!isNaN(obj.x)){sx=obj.x;ex=obj.x+obj.width*UIAnimation.hroWidh}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_OUT_UP_VER:if(!isNaN(obj.top)){sytop=obj.top;eytop=obj.top-obj.height}if(!isNaN(obj.verticalCenter)){syver=obj.verticalCenter;eyver=obj.verticalCenter-obj.height}if(!isNaN(obj.bottom)){sybot=obj.bottom;eybot=obj.bottom+obj.height}if(!isNaN(obj.alpha)){salpha=obj.alpha;ealpha=0}if(!isNaN(obj.y)){sy=obj.y;ey=obj.y-obj.height}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_OUT_DOWN_VER:if(!isNaN(obj.top)){sytop=obj.top;eytop=obj.top+obj.height}if(!isNaN(obj.verticalCenter)){syver=obj.verticalCenter;eyver=obj.verticalCenter+obj.height}if(!isNaN(obj.bottom)){sybot=obj.bottom;eybot=obj.bottom-obj.height}if(!isNaN(obj.alpha)){salpha=obj.alpha;ealpha=0}if(!isNaN(obj.y)){sy=obj.y;ey=obj.y+obj.height}if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_IN_SCALE_VER:if(!isNaN(obj.scaleX)){sxscaleX=.5;exscaleX=obj.scaleX}if(!isNaN(obj.scaleY)){syscaleY=.5;eyscaleY=obj.scaleY}break;case UIAnimation.ANITYPE_OUT_SCALE_VER:if(!isNaN(obj.scaleX)){sxscaleX=obj.scaleX;exscaleX=0}if(!isNaN(obj.scaleY)){syscaleY=obj.scaleY;eyscaleY=0}break}sx=sx?sx:obj.x;sxleft=sxleft?sxleft:obj.left;sxhro=sxhro?sxhro:obj.horizontalCenter;sxright=sxright?sxright:obj.right;sxscaleX=sxscaleX?sxscaleX:obj.scaleX;ex=ex?ex:obj.x;exleft=exleft?exleft:obj.left;exhro=exhro?exhro:obj.horizontalCenter;exright=exright?exright:obj.right;exscaleX=exscaleX==0?exscaleX:obj.scaleX;sy=sy?sy:obj.y;sytop=sytop?sytop:obj.top;syver=syver?syver:obj.verticalCenter;sybot=sybot?sybot:obj.bottom;syscaleY=syscaleY?syscaleY:obj.scaleY;ey=ey?ey:obj.y;eytop=eytop?eytop:obj.top;eyver=eyver?eyver:obj.verticalCenter;eybot=eybot?eybot:obj.bottom;eyscaleY=eyscaleY==0?eyscaleY:obj.scaleY;salpha=salpha==0?salpha:obj.alpha;ealpha=ealpha==0?ealpha:1;UIAnimation.aniStartEUI(obj,{sx:sx,sxleft:sxleft,sxhro:sxhro,sxright:sxright,ex:ex,exleft:exleft,exhro:exhro,exright:exright,sy:sy,sytop:sytop,syver:syver,sybot:sybot,ey:ey,eytop:eytop,eyver:eyver,eybot:eybot,salpha:salpha,ealpha:ealpha,sxscaleX:sxscaleX,exscaleX:exscaleX,syscaleY:syscaleY,eyscaleY:eyscaleY},others)};UIAnimation.aniStartEUI=function(obj,dir,others){obj.scaleX=dir.sxscaleX;obj.scaleY=dir.syscaleY;var tw=egret.Tween.get(obj);var t=others?others.time?others.time:UIAnimation.time:UIAnimation.time;var ease=others?others.ease?others.ease:UIAnimation.Egret_Ease:UIAnimation.Egret_Ease;tw.to({scaleX:dir.exscaleX,scaleY:dir.eyscaleY},t,ease).call(function(){obj.scaleX=dir.exscaleX;obj.scaleY=dir.eyscaleY;UIAnimation.cleanObj(obj);egret.Tween.removeTweens(obj);if(others&&typeof others.func=="function")others.func()})};UIAnimation.checkObj=function(obj){if(UIAnimation.aniMap[obj.hashCode])return false;UIAnimation.aniMap[obj.hashCode]=obj;return true};UIAnimation.cleanObj=function(obj){if(UIAnimation.aniMap[obj.hashCode])delete UIAnimation.aniMap[obj.hashCode]};UIAnimation.ANITYPE_FADEIN_LEFT_HOR=1;UIAnimation.ANITYPE_FADEIN_RIGHT_HOR=2;UIAnimation.ANITYPE_FADEIN_UP_VER=3;UIAnimation.ANITYPE_FADEIN_DOWN_VER=4;UIAnimation.ANITYPE_IN_LEFT_HOR=5;UIAnimation.ANITYPE_IN_RIGHT_HOR=6;UIAnimation.ANITYPE_IN_UP_VER=7;UIAnimation.ANITYPE_IN_DOWN_VER=8;UIAnimation.ANITYPE_OUT_LEFT_HOR=9;UIAnimation.ANITYPE_OUT_RIGHT_HOR=10;UIAnimation.ANITYPE_OUT_UP_VER=11;UIAnimation.ANITYPE_OUT_DOWN_VER=12;UIAnimation.ANITYPE_IN_SCALE_VER=13;UIAnimation.ANITYPE_OUT_SCALE_VER=14;UIAnimation.diff=50;UIAnimation.time=200;UIAnimation.Egret_Ease=egret.Ease.backInOut;UIAnimation.aniMap={};UIAnimation.hroWidh=1.5;return UIAnimation}();__reflect(UIAnimation.prototype,"UIAnimation");var ActivityBtnConfig=function(){function ActivityBtnConfig(){}return ActivityBtnConfig}();__reflect(ActivityBtnConfig.prototype,"ActivityBtnConfig");var ActivityType10Config=function(){function ActivityType10Config(){}return ActivityType10Config}();__reflect(ActivityType10Config.prototype,"ActivityType10Config");var ActivityType11_1Config=function(){function ActivityType11_1Config(){}return ActivityType11_1Config}();__reflect(ActivityType11_1Config.prototype,"ActivityType11_1Config");var ActivityType11_2Config=function(){function ActivityType11_2Config(){this.rate=1}return ActivityType11_2Config}();__reflect(ActivityType11_2Config.prototype,"ActivityType11_2Config");var ActivityType12Config=function(){function ActivityType12Config(){}return ActivityType12Config}();__reflect(ActivityType12Config.prototype,"ActivityType12Config");var ActivityType19Config=function(){function ActivityType19Config(){}return ActivityType19Config}();__reflect(ActivityType19Config.prototype,"ActivityType19Config");var ResVersionManager=function(_super){__extends(ResVersionManager,_super);function ResVersionManager(){var _this=_super.call(this)||this;_this.res_loadByVersion();_this.resVersionData=window["verData"];var lang=window["wlmzlang"]||"";_this.lang=lang;_this.resrepOn=lang!="";return _this}ResVersionManager.ins=function(){return _super.ins.call(this)};ResVersionManager.prototype.has=function(url){return this.resVersionData.hasOwnProperty(url)};ResVersionManager.prototype.getDir=function(url){return this.resVersionData[url]};ResVersionManager.prototype.hasVer=function(){return!isNaN(LocationProperty.v)};ResVersionManager.prototype.res_loadByVersion=function(){var mgr=this;RES.web.Html5VersionController.prototype.getVirtualUrl=function(url){if(IOS_AppStore_LocalRes.isLocalRes(url)==true){return url}if(url.indexOf("https://")==0||url.indexOf("http://")==0){return url}if(mgr.resrepOn){var resrep=mgr.resrep;if(resrep){if(url in resrep){var p=url.lastIndexOf(".");if(p>=0){url=url.substr(0,p)+mgr.lang+url.substr(p)}}}}var manager=ResVersionManager.ins();if(manager.hasVer()){var norUrl=url.replace("%40","@");if(manager.has(norUrl)){var dir=manager.getDir(norUrl);url=""+LocationProperty.resAdd+dir+"/"+url}else url=LocationProperty.resAdd+"0/"+url}else url=""+LocationProperty.resAdd+url;return url}};ResVersionManager.prototype.loadConfig=function(complateFunc,complateFuncTarget){this.complateFunc=complateFunc;this.complateFuncTarget=complateFuncTarget;if(this.resVersionData){this.complateFunc.call(this.complateFuncTarget);return}if(this.hasVer()){var request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;var respHandler=function(evt){switch(evt.type){case egret.Event.COMPLETE:this.resVersionData=JSON.parse(evt.currentTarget.response);this.complateFunc.call(this.complateFuncTarget);break;case egret.IOErrorEvent.IO_ERROR:debug.log("respHandler io error");break}};request.once(egret.Event.COMPLETE,respHandler,this);request.once(egret.IOErrorEvent.IO_ERROR,respHandler,this);var verUrl=""+LocationProperty.resAdd+LocationProperty.v+"/"+LocationProperty.v+".json";request.open(verUrl,egret.HttpMethod.GET);request.send();return}this.complateFunc.call(this.complateFuncTarget)};return ResVersionManager}(BaseClass);__reflect(ResVersionManager.prototype,"ResVersionManager");var ActivityType20Config=function(){function ActivityType20Config(){}return ActivityType20Config}();__reflect(ActivityType20Config.prototype,"ActivityType20Config");var ActivityType22_1Config=function(){function ActivityType22_1Config(){}return ActivityType22_1Config}();__reflect(ActivityType22_1Config.prototype,"ActivityType22_1Config");var ActivityType22_3Config=function(){function ActivityType22_3Config(){}return ActivityType22_3Config}();__reflect(ActivityType22_3Config.prototype,"ActivityType22_3Config");var ActivityType27Config=function(){function ActivityType27Config(){}return ActivityType27Config}();__reflect(ActivityType27Config.prototype,"ActivityType27Config");var TimerManager=function(_super){__extends(TimerManager,_super);function TimerManager(){var _this=_super.call(this)||this;_this.currHandler=null;_this._handlers=[];_this.nexthandles=null;_this._currTime=egret.getTimer();_this._currFrame=0;egret.startTick(_this.onEnterFrame,_this);return _this}TimerManager.ins=function(){return _super.ins.call(this)};TimerManager.prototype.getFrameId=function(){return this._currFrame};TimerManager.prototype.getCurrTime=function(){return this._currTime};TimerManager.binFunc=function(b1,b2){if(b1.exeTime>b2.exeTime)return-1;else if(b1.exeTime<b2.exeTime)return 1;else return 0};TimerManager.DeleteHandle=function(handler){handler.clear();ObjectPool.push(handler)};TimerManager.prototype.onEnterFrame=function(time){this._currFrame++;this._currTime=egret.getTimer();var currTime=0;var nexthandles=this.nexthandles;this.nexthandles=null;if(nexthandles&&nexthandles.length>0){for(var _i=0,nexthandles_1=nexthandles;_i<nexthandles_1.length;_i++){var handler_1=nexthandles_1[_i];handler_1.method.call(handler_1.methodObj);TimerManager.DeleteHandle(handler_1)}nexthandles=null}if(this._handlers.length<=0)return false;var handler=this._handlers[this._handlers.length-1];while(handler.exeTime<=this._currTime){this.currHandler=handler=this._handlers.pop();handler.method.call(handler.methodObj);currTime=egret.getTimer();handler.exeTime=currTime+handler.delay;var repeat=handler.forever;if(!repeat){if(handler.repeatCount>1){handler.repeatCount--;repeat=true}else{if(handler.onFinish){handler.onFinish.apply(handler.finishObj)}}}if(repeat){var index=Algorithm.binSearch(this._handlers,handler,TimerManager.binFunc);this._handlers.splice(index,0,handler)}else{TimerManager.DeleteHandle(handler)}if(currTime-this._currTime>5)break;if(this._handlers.length<=0)break;else handler=this._handlers[this._handlers.length-1]}this.currHandler=null;return false};TimerManager.prototype.create=function(startTime,delay,repeat,method,methodObj,onFinish,fobj){if(delay<0||repeat<0||method==null){return}var handler=ObjectPool.pop("TimerHandler");handler.forever=repeat==0;handler.repeatCount=repeat;handler.delay=delay;handler.method=method;handler.methodObj=methodObj;handler.onFinish=onFinish;handler.finishObj=fobj;handler.exeTime=startTime+this._currTime;var index=Algorithm.binSearch(this._handlers,handler,TimerManager.binFunc);this._handlers.splice(index,0,handler)};TimerManager.prototype.doTimer=function(delay,repeat,method,methodObj,onFinish,fobj){if(onFinish===void 0){onFinish=null}if(fobj===void 0){fobj=null}if(!isNaN(delay)){this.create(delay,delay,repeat,method,methodObj,onFinish,fobj)}else{console.error("TimerManager.doTimer delay===NaN!");console.trace()}};TimerManager.prototype.doTimerDelay=function(startTime,delay,repeat,method,methodObj,onFinish,fobj){if(onFinish===void 0){onFinish=null}if(fobj===void 0){fobj=null}if(!isNaN(startTime)&&!isNaN(delay)){this.create(startTime,delay,repeat,method,methodObj,onFinish,fobj)}else{console.error("TimerManager.doTimer startTime or delay===NaN!");console.trace()}};TimerManager.prototype.doNext=function(method,methodObj){var handler=ObjectPool.pop("TimerHandler");handler.method=method;handler.methodObj=methodObj;if(!this.nexthandles)this.nexthandles=[];this.nexthandles.push(handler)};TimerManager.prototype.remove=function(method,methodObj){var currHandler=this.currHandler;if(currHandler&&currHandler.method==method&&currHandler.methodObj==methodObj){currHandler.forever=false;currHandler.repeatCount=0}for(var i=this._handlers.length-1;i>=0;i--){var handler=this._handlers[i];if(handler.method==method&&handler.methodObj==methodObj){this._handlers.splice(i,1);TimerManager.DeleteHandle(handler)}}};TimerManager.prototype.removeAll=function(methodObj){var currHandler=this.currHandler;if(currHandler&&currHandler.methodObj==methodObj){currHandler.forever=false;currHandler.repeatCount=0}for(var i=this._handlers.length-1;i>=0;i--){var handler=this._handlers[i];if(handler.methodObj==methodObj){this._handlers.splice(i,1);TimerManager.DeleteHandle(handler)}}};TimerManager.prototype.isExists=function(method,methodObj){for(var _i=0,_a=this._handlers;_i<_a.length;_i++){var handler=_a[_i];if(handler.method==method&&handler.methodObj==methodObj){return true}}return false};return TimerManager}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function TimerHandler(){this.delay=0;this.forever=false;this.repeatCount=0;this.exeTime=0}TimerHandler.prototype.clear=function(){this.method=null;this.methodObj=null;this.onFinish=null;this.finishObj=null;this.forever=false};return TimerHandler}();__reflect(TimerHandler.prototype,"TimerHandler");var ActivityType28_2Config=function(){function ActivityType28_2Config(){}return ActivityType28_2Config}();__reflect(ActivityType28_2Config.prototype,"ActivityType28_2Config");var ActivityType28_3Config=function(){function ActivityType28_3Config(){}return ActivityType28_3Config}();__reflect(ActivityType28_3Config.prototype,"ActivityType28_3Config");var ActivityType29_1Config=function(){function ActivityType29_1Config(){}return ActivityType29_1Config}();__reflect(ActivityType29_1Config.prototype,"ActivityType29_1Config");var ActivityType29_2Config=function(){function ActivityType29_2Config(){}return ActivityType29_2Config}();__reflect(ActivityType29_2Config.prototype,"ActivityType29_2Config");var ActivityType2Config=function(){function ActivityType2Config(){}return ActivityType2Config}();__reflect(ActivityType2Config.prototype,"ActivityType2Config");var ActivityType3Config=function(){function ActivityType3Config(){this.day=1}return ActivityType3Config}();__reflect(ActivityType3Config.prototype,"ActivityType3Config");var ActivityType4Config=function(){function ActivityType4Config(){}return ActivityType4Config}();__reflect(ActivityType4Config.prototype,"ActivityType4Config");var ActivityType5Config=function(){function ActivityType5Config(){}return ActivityType5Config}();__reflect(ActivityType5Config.prototype,"ActivityType5Config");var ActivityType6Config=function(){function ActivityType6Config(){}return ActivityType6Config}();__reflect(ActivityType6Config.prototype,"ActivityType6Config");var ActivityType7Config=function(){function ActivityType7Config(){}return ActivityType7Config}();__reflect(ActivityType7Config.prototype,"ActivityType7Config");var ActivityType8Config=function(){function ActivityType8Config(){}return ActivityType8Config}();__reflect(ActivityType8Config.prototype,"ActivityType8Config");var g_terms=window["g_terms"]={DisplayPolicyWin_3:"《网络游戏用户隐私权保护政策》",DisplayPolicyWin_0:"\n　　根据法律、法规的相关规定，为保障网络游戏用户（下称“用户”）的隐私权，规范对网络游戏用户个人信息的利用，特制定本政策（简称“隐私条款”）。\n　　请用户仔细阅读以下全部内容。如用户不同意本政策的任意内容，请不要注册或使用我司的服务。如用户通过进入注册程序并勾选“我同意网络游戏用户隐私权保护和个人信息利用政策”，即表示用户与桂林我司科技股份有限公司已达成协议，自愿接受本政策的所有内容。此后，||S:18&B:1&T:用户不得以未阅读本政策的内容作任何形式的抗辩。|\n\n一、尊重用户个人隐私是我司的一项基本政策。“隐私”是指用户在注册我司账号时提供给我司的用户个人身份信息，包括用户注册资料中的姓名、个人有效身份证件号码、联系方式、家庭住址等。我司一贯积极地采取技术与管理等合理措施保障用户账号的安全、有效；我司将善意使用收集的信息，采取各项有效且必要的措施以保护用户的隐私安全，并使用商业上合理的安全技术措施来保护用户的隐私不被未经授权的访问、使用或泄漏。\n\n|S:18&B:1&T:二、因业务所需，我司承诺将善意保护、使用其个人信息，我司将不会向任何其他方公开或共享用户注册资料的中的姓名、个人有效身份证件号码、联系方式、家庭住址等个人身份信息，但下列情况除外：|\n2.1 用户或用户监护人授权我司披露的；\n2.2 有关法律要求我司披露的；\n2.3 司法机关或行政机关基于法定程序要求我司提供的；\n2.4 我司为了维护自己合法权益而向用户提起诉讼或者仲裁时；\n2.5 应用户监护人的合法要求而提供用户个人身份信息时。\n\n|S:18&B:1&T:三、我们收集的信息|\n　　在您使用我公司游戏服务服务的过程中，我公司游戏服务会按照如下方式收集您在使用服务时主动提供的或因为使用服务而产生的信息，用以向您提供、优化我们的服务以及保障您的账户安全：\n3.1 当您注册或使用我公司游戏服务服务时，我们会收集您的手机号信息、网络身份标识信息及个人常用设备信息，用于标记您为我公司游戏服务的用户。如果您使用微信或QQ关联登录我公司游戏服务，我们会收集您微信或QQ的唯一标识、头像、昵称，用于保存您的登录信息，以便您在不同设备登录。\n　　为了更好地向您提供游戏服务，改善游戏体验，我们可对您QQ帐号、微信账号或游戏账号中的昵称、头像以及在我公司游戏服务中的相关操作信息、游戏信息等信息（以下称“该等信息”。该等信息具体包括但不限于您的登录状态、对战信息/状态、成就信息等）进行使用，并可向您本人或其他用户或好友展示该等信息。我们可能会视游戏产品具体情况为您提供相关权限，以便您可以对是否展示前述相关信息进行相应设置。\n3.2 为满足相关法律法规政策及相关主管部门的要求，我公司游戏服务用户需进行实名认证以继续使用和享受我公司游戏服务。我们会在获得您同意或您主动提供的情况下收集您的实名身份信息，该信息属于敏感信息，拒绝提供实名身份信息可能会导致您无法登陆我公司游戏服务或在使用我公司游戏服务过程中受到相应限制。\n3.3 为保障您正常使用我们的服务，维护游戏基础功能的正常运行，优化游戏产品性能，提升您的游戏体验并保障您的账号安全，我们会收集您的设备ID、设备名称、设备类型和版本、系统版本、IP地址、MAC地址、应用ID、网络类型等信息。\n3.4 当您使用我公司游戏服务服务时，我们会收集您的游戏日志信息，例如登录日志、物品日志、游戏对局信息、交友记录等，以便您能够在客户端查看您的游戏历史记录，同时用于游戏运营统计分析、客服投诉处理及其他游戏安全分析，并为提升您的游戏体验，我们可能把前述信息同步至该游戏后续版本或您正在使用的我们提供的其他产品中。\n3.5 如您使用小米、魅族、华为等品牌手机，我公司游戏服务接入的上述手机厂商Push SDK需要收集手机唯一标识信息（例如IMEI），并可能会收集您的手机型号、系统类型、系统版本、设备屏幕尺寸等参数用于实现我公司游戏服务产品和活动等信息的推送，具体情况请参见SDK运营方的隐私政策或相关声明。\n3.6 当您使用我公司游戏服务产品的消费功能时，我们会收集您的充值记录、消费记录等信息，以便您查询您的交易记录，同时尽最大程度保护您的虚拟物品安全。充值记录、消费记录属于敏感信息，收集上述信息为实现我公司游戏服务产品的消费功能所必须，否则将无法完成交易。\n3.7 为保障您的游戏账号安全，营造公平、健康及安全的游戏环境，我们会收集您的游戏识别信息、硬件及操作系统信息、进程及游戏崩溃记录等信息，以用于打击破坏游戏公平环境或干扰、破坏游戏服务正常进行的行为（如用于检测盗版、扫描外挂、防止作弊等）。\n3.8 当您在游戏中通过文字、图片、语音、视频及其他方式与其他玩家进行互动，我们可能会收集并保存您发送的上述信息内容用于过滤色情、暴力、政治、辱骂、恶意广告等不当内容，以此净化游戏环境，维护健康的上网环境。\n3.9 如您希望通过语音、视频与其他游戏玩家互动、参与直播，在您授权同意后，游戏会访问您的麦克风、摄像头，为您提供语音聊天、直播互动等功能。\n3.10 如您希望与附近的游戏玩家互动，在您授权同意后，我们会收集您的地理位置信息，用于寻找附近的游戏玩家，以便您与附近的玩家匹配、组队等。地理位置信息属于敏感信息，拒绝提供该信息只会导致您无法实现与附近的游戏玩家互动，但不影响您正常使用我公司游戏服务的其他功能，您也可以随时取消您的地理位置信息授权。\n3.11 根据相关法律法规及国家标准，以下情形中，我们可能会收集、使用您的相关个人信息无需征求您的授权同意：\n1） 与国家安全、国防安全等国家利益直接相关的；与公共安全、公共卫生、公共知情等重大公共利益直接相关的；\n2） 与犯罪侦查、起诉、审判和判决执行等直接相关的；\n3） 出于维护您或其他个人的生命、财产、声誉等重大合法权益但又很难得到本人同意的；\n4） 所收集的个人信息是您自行向社会公众公开的；\n5） 从合法公开披露的信息中收集个人信息的，如合法的新闻报道、政府信息公开等渠道；\n6） 根据您要求签订和履行合同所必需的；\n7） 用于维护所提供的产品或服务的安全稳定运行所必需的，例如发现、处置产品或服务的故障；\n8） 为开展合法的新闻报道所必需的；\n9） 出于公共利益开展统计或学术研究所必要，且其对外提供学术研究或描述的结果时，对结果中所包含的个人信息进行去标识化处理的；\n10） 法律法规规定的其他情形。\n3.12 请您理解，我们向您提供的功能和服务是不断更新和发展的，如果某一功能或服务未在前述说明中且收集了您的信息，我们会通过页面提示、交互流程、网站公告等方式另行向您说明信息收集的内容、范围和目的，以征得您的同意。\n　　目前，除了向第三方调研机构收集游戏调研信息，以帮助我们改进游戏产品以及提供个性化服务之外，我们不会主动从腾讯集团外的第三方获取您的个人信息。如未来为业务发展需要从腾讯集团外的第三方间接获取您的个人信息，我们会在获取前向您明示您个人信息的来源、类型及使用范围，如我公司游戏服务开展业务需进行的个人信息处理活动超出您原本向腾讯集团外的第三方提供个人信息时的授权同意范围，我们将在处理您的该等个人信息前，征得您的明示同意；此外，我们也将会严格遵守相关法律法规的规定，并要求该第三方保障其提供的信息的合法性。\n　　\n|S:18&B:1&T:四、我们存储的信息|\n4.1 信息存储的方式和期限\n　　我们会通过安全的方式存储您的信息，包括本地存储（例如利用APP进行数据缓存）、数据库和服务器日志。\n　　一般情况下，我们只会在为实现服务目的所必需的时间内或法律法规规定的条件下存储您的个人信息。\n4.2 信息存储的地域\n　　我们会按照法律法规规定，将境内收集的用户个人信息存储于中国境内。\n4.3 产品或服务停止运营时的通知\n　　当我们的产品或服务发生停止运营的情况时，我们将根据相关法律法规规定进行公告通知，并依法保障您的合法权益。\n　　\n|S:18&B:1&T:五、我们如何使用信息|\n　　我们严格遵守法律法规的规定以及与用户的约定，按照本指引及《我公司游戏服务许可及服务协议》、《老K隐私政策》所述使用收集的信息，以向您提供更为优质的服务。\n5.1 信息使用规则\n　　我们会按照如下规则使用收集的信息：\n1）我们会根据我们收集的信息向您提供各项功能与服务，包括基础游戏功能、玩家互动功能、直播功能、消费功能等；\n2）我们会根据您的游戏等级、偏好、习惯、消费等特征为您提供个性化服务，包括基于特征标签进行间接人群画像并向您推荐您可能感兴趣的活动、比赛、促销等推广内容。\n3）我们会根据您使用我公司游戏服务产品的频率和情况、故障信息、性能信息等分析我们产品的运行情况，以确保服务的安全性，并优化我们的产品，提高我们的服务质量。我们不会将我们存储在分析软件中的信息与您提供的个人身份信息相结合。\n5.2 定向推送活动的规则\n　　我们会根据您的游戏等级、偏好、习惯、消费等特征为您提供个性化的推广内容，例如向您推荐您可能喜欢的游戏皮肤。我们可能会视游戏产品具体情况为您提供相关权限，以便您可以通过相关设置降低推荐内容与您的相关性/退出此类个性化推送。\n5.3 告知变动目的后征得同意的方式\n　　我们将会在本指引所涵盖的用途内使用收集的信息。如我们使用您的个人信息，超出了与收集时所声称的目的及具有直接或合理关联的范围，我们将在使用您的个人信息前，再次向您告知并征得您的明示同意。\n　　\n|S:18&B:1&T:六、您的权利|\n6.1 在您使用我公司游戏服务服务期间，我们可能会视游戏产品具体情况为您提供相应的操作设置，以便您可以查询、删除、更正或撤回您的相关个人信息，您可参考相应游戏产品的具体指引进行操作。此外，我们还设置了投诉举报渠道，您的意见将会得到及时的处理。\n　　注：当您是使用关联的QQ号码或微信帐号作为游戏账号登录相关游戏。如您需要注销游戏账号的，则需要注销QQ或微信账号。QQ、微信账号的注销，请在微信、QQ上根据其指引进行注销。\n　　\n|S:18&B:1&T:七、变更|\n　　我们可能会适时对本指引进行修订。当本指引的条款发生变更时，我们会在版本更新时以适当的方式向您提示变更后的指引。请您仔细阅读变更后的隐私保护指引或指引内容，您继续使用我公司游戏服务表示您同意我们按照更新后的隐私保护指引收集、处理或使用您的个人信息。\n　　\n|S:18&B:1&T:八、其他|\n　　特别提示：本政策仅适用于使用我公司的网络游戏用户，若本政策与《服务条款》中相关条款不一致的，以本政策约定为准。\n　　\n|S:18&B:1&T:九、联系我们|\n　　当您有其他的投诉、建议、未成年人个人信息相关问题时，请通过客服与我们联系，3296341288@qq.com。我们将尽快审核所涉问题，并在验证您的用户身份后的十五天内予以回复。\n\n本声明自更新之日起生效\n广州掌中互娱网络科技有限公司\n最近的更新日期：2020 年 12 月 15 日",DisplayPolicyWin_2:"《服务条款与用户守则》",DisplayPolicyWin_11:'\n|S:22&B:1&T:服务条款|\n|S:18&B:1&T:      欢迎使用桂林力港网络科技股份有限公司(下称"力港网络")提供的计算机游戏软件和网络在线游戏服务。根据《网络出版服务管理规定》及文化部制定的《网络游戏服务格式化协议必备条款》(下称"必备条款")等相关规定，为了保障用户的合法权益，特制定本《力港武林盟主》服务条款。请您在参与《力港武林盟主》游戏前，详细阅读本《服务条款》的所有内容。这些条款可由力港网络随时更新，《力港武林盟主》服务条款发生相应修改，力港网络将会在官网页面、产品内相关的邮件通知、公告位置上进行提示。修改后的力港网络一旦在相关位置上公布，即生效且代替原来的服务协议，原来的服务协议失效。|\n      【注意】请游戏用户仔细阅读以下全部内容。如用户不同意本服务条款任意内容，请不要使用本游戏服务。当用户使用本游戏服务进行游戏时，则应视为用户已经详细阅读并同意本条款的内容，且同意遵守本协议的规定。此后，用户不得以未阅读本服务条款内容作任何形式的抗辩。\n      如果用户未满18周岁，请在法定监护人的陪同下阅读本协议，并特别注意未成年人使用条款。如用户为未成年人法定监护人，希望合理设定孩子娱乐时间，培养孩子健康游戏习惯。\n|S:18&B:1&T:※第一部分 释义|\n|S:18&B:1&T:※第二部分 用户账号注册、使用与保管|\n|S:18&B:1&T:※第三部分 用户信息的保护|\n|S:18&B:1&T:※第四部分 力港网络的义务|\n|S:18&B:1&T:※第五部分 用户的义务|\n|S:18&B:1&T:※第六部分 服务的中断、中止、终止|\n|S:18&B:1&T:※第七部分 责任限制|\n|S:18&B:1&T:※第八部分 信息的储存和安全及信息发布的限制|\n|S:18&B:1&T:※第九部分 条款修改|\n|S:18&B:1&T:※第十部分 知识产权|\n|S:18&B:1&T:※第十一部分 关于活动和游戏版本变动的说明|\n|S:18&B:1&T:※第十二部分 通知|\n|S:18&B:1&T:※第十三部分 授权|\n|S:18&B:1&T:※第十四部分 纠纷|\n|S:18&B:1&T:※第十五部分 条款说明|\n\n|S:18&B:1&T:第一部分 释义|\n|S:18&B:1&T:      本服务条款系由游戏用户与力港网络就所属的游戏《力港武林盟主》所订立的相关权利义务协议规范。因此，请于申请注册成为《力港武林盟主》用户前，明确地详细阅读本服务条款的所有内容，当您点选【同意】键或执行《力港武林盟主》线上游戏即视为同意接受本服务条款的所有规范内容并受其约束。|\n      本服务条款所指线上游戏是指用户需要通过计算机等电子设备与服务器联机才可以执行的，由力港网络所全权运营的网络游戏《力港武林盟主》，《力港武林盟主》包括但不限于：一个或多个单独的计算机程序，其名称或标题为：《力港武林盟主》以及相关的书面文档、图片文件、影片、用户手册（载明软件程序的安装与应用方法）以及与《力港武林盟主》相关的说明书、商标、标识以及任何其他的美术作品；以上统称为《力港武林盟主》。\n\n|S:18&B:1&T:第二部分、用户账号注册、使用与保管|\n|S:18&B:1&T:      1.账号注册|\n|S:18&B:1&T:      (1)用户承诺以其真实身份并经实名注册成为力港网络游戏产品的用户，并保证所提供的个人身份资料信息真实、完整、有效，依据法律规定和必备条款约定对所提供的信息承担相应的法律责任。|\n       (2)用户以其真实身份注册成为力港网络用户后，需要修改所提供的个人身份资料信息的，经核对用户真实身份信息，力港网络可视实际情况为玩家提供该项服务。如用户注册信息填写不真实，力港网络有权拒绝为玩家提供该项服务。\n      2.用户账号使用与保管\n      (1)为了满足法律法规和监管规定的实名制要求，用户在使用手机号码或微信账号作为游戏账号登录时，力港网络需要对用户的游戏账号进行实名核验。根据必备条款的约定，力港网络有权审查用户注册所提供的身份信息是否真实、有效，并应积极地采取技术与管理等合理措施保障用户账号的安全、有效；如游戏用户未按照注册提示的要求填写真实、有效的身份信息，则力港网络可以对该游戏账号进行锁定审核处理；用户有义务妥善保管其账号及密码，并正确、安全地使用其账号及密码。力港网络应积极地采取技术与管理等合理措施保障用户账号的安全，但力港网络不保证这些保障措施可以完全杜绝游戏账号被他人窃取或丢失的风险。\n      (2)力港网络会按照国家相关要求将用户的实名注册信息（包括相关实名认证及年龄情况等）运用于防沉迷系统之中，即力港网络可能会根据用户的实名注册信息判断用户是否年满18周岁、用户提交的实名身份信息是否规范或实名验证是否通过等，从而决定是否对用户的游戏账号予以防沉迷限制。\n      (3)用户同意：用户注册账号的所有权归力港网络所有，用户享有注册账号的使用权。用户对登录后所持账号产生的行为依法享有权利和承担责任。\n      (4)用户应妥善保管游戏账号及密码，用户发现其账号或密码被他人非法使用或有使用异常的情况的，应及时通知力港网络，用户可凭与其注册身份信息相一致的个人有效身份信息，通知力港网络采取措施暂停该账号的登录和使用。\n|S:18&B:1&T:      (5)用户没有提供其个人有效身份证件或者用户提供的个人有效身份证件与所注册的身份信息不一致的，力港网络有权拒绝用户上述请求。|\n      (6)用户为了维护其合法权益，向力港网络提供与所注册账号的身份信息相一致的个人有效身份信息时，力港网络应当为用户提供账号注册人证明、原始注册信息等必要的协助和支持，并根据需要向有关行政机关和司法机关提供相关证据信息资料。\n      (7)用户注册的账号如果长时间不登录，力港网络有权按照下列方式对用户的注册账号进行处理：',DisplayPolicyWin_12:"\n      (7.1)用户注册《力港武林盟主》账号后，如果出现该账号连续180天不曾登录（仅包括在游戏官网及客户端的登录记录）|S:18&B:1&T:将被视为“用户主动放弃账号使用权”|，力港网络有权自满第180天当天的24时起，采取措施终止向用户继续提供该款游戏的服务（包括但不限于：清除该账号的积分、等级、游戏金币等信息；删除该账号的注册信息、角色信息等一切相关信息），且不对因此所导致的任何损失负责。\n      (7.2)用户注册《力港武林盟主》账号后，如果出现连续360天不曾登录（仅包括在游戏官网及客户端的登录记录），将被|S:18&B:1&T:视为“用户主动放弃账号使用权”|，力港网络有权自满第360天当天的24时起，采取措施终止向用户继续提供该款游戏的服务（包括但不限于：清除该账号的积分、等级、游戏金币等信息；删除该账号的注册信息、角色信息等一切相关信息），且不对因此所导致的任何损失负责。\n      (7.3)用户注册《力港武林盟主》账号后，如果出现连续540天不曾登录（仅包括在游戏官网及客户端的登录记录），|S:18&B:1&T:将直接视为用户主动放弃账号使用权，并放弃账号下相关的虚拟货币、游戏道具及增值服务等|，力港网络有权自满第540天当天的24时起，采取措施终止向用户继续提供该款游戏的服务（包括但不限于：清除该账号的积分、等级、游戏金币等信息；删除该账号的注册信息、角色信息等一切相关信息），且不对因此所导致的任何损失负责。\n\n|S:18&B:1&T:第三部分、用户信息的保护|\n      1.玩家注册账号成为力港网络用户时使用的身份信息及个人资料，力港网络保障用户的隐私权，规范对用户个人信息的管理，按照国家有关信息安全的规定采取必要措施保护用户的个人信息资料的安全。\n|S:18&B:1&T:      2、未经用户许可力港网络不得向任何第三方提供、公开或共享用户注册资料中的姓名、个人有效身份证件号码、联系方式、家庭住址等个人身份信息，但下列情况除外：|\n|S:18&B:1&T:      (1)用户或用户监护人授权力港网络披露的；|\n|S:18&B:1&T:      (2)有关法律要求力港网络披露的；|\n|S:18&B:1&T:      (3)司法机关或行政机关基于法定程序要求力港网络提供的；|\n|S:18&B:1&T:      (4) 力港网络为了维护自己合法权益而向用户提起诉讼或者仲裁时；|\n|S:18&B:1&T:      (5)应用户监护人的合法要求而提供用户个人身份信息时。|\n为保障用户的隐私权，规范对用户个人信息的管理，力港网络按照国家有关信息安全的规定保存用户注册信息，并且制定了|S:18&B:1&T:《网络游戏用户隐私权保护政策》|来保障用户个人的信息及隐私，请用户详细阅读该政策的内容。\n\n|S:18&B:1&T:第四部分、力港网络的义务 |\n      1.力港网络通过国际互联网络为用户提供游戏服务。\n      2.力港网络保存用户游戏虚拟货币的充值记录，保存期限自用户最后一次接受充值服务之日起180日。\n      3.力港网络仅仅发行虚拟货币，不提供任何形式的在游戏客户端以及相关网站上交易虚拟货币的业务。|S:18&B:1&T:力港网络禁止虚拟货币在用户账户之间的转移。 | \n      4.在使用力港网络游戏虚拟货币的过程中，用户有权向力港网络要求协助用户调取游戏虚拟货币充值记录和使用记录，力港网络应当先要求用户提供并核实与其注册身份信息相一致的个人有效身份信息，力港网络核实用户所提供的个人有效身份信息与所注册的身份信息相一致的，应当予以协助提供。用户没有提供其个人有效身份证件或者用户提供的个人有效身份证件与所注册的身份信息不一致的，力港网络有权拒绝用户上述请求。\n      5.力港网络提倡适度游戏、健康生活的理念。在用户出现沉迷游戏的情况(包括但不限于用户因游戏消耗问题而多次向客服申诉且经客服劝阻无效时），力港网络有权采取措施限制用户参与游戏：包括但不限于限制用户充值额度等。\n\n|S:18&B:1&T:第五部分、用户的义务|\n      1.用户应自行配备上网的所需设备，包括但不限于电脑、调制解调器或其他必备上网装置。\n      2.用户自行负担上网所支付的与此服务相关的电话费用、网络使用等费用。\n      3.用户同意，用户提供的真实准确的个人资料作为认定用户与账号的关联性以及用户身份的唯一证据。\n      4.用户应遵守本条款、客户服务专区服务条款以及其他在《力港武林盟主》游戏官方网站公布的实施细则、公告等。\n      5.用户应遵守中华人民共和国相关法律法规(如果用户是中华人民共和国境外的使用者，应遵守所属国家或地区的法律法规)。\n|S:18&B:1&T:      6.用户应当自行承担其所发布的信息内容所涉及的责任。特别地，用户不得发布下列内容：|\n|S:18&B:1&T:      ⑴反对中华人民共和国宪法所确定的基本原则的；|\n|S:18&B:1&T:      ⑵危害国家安全，泄露国家秘密，颠覆国家政权，破坏国家统一的；|\n|S:18&B:1&T:      ⑶损害国家荣誉和利益的；|\n",DisplayPolicyWin_13:"|S:18&B:1&T:      ⑷煽动民族仇恨、民族歧视，破坏民族团结的；|\n|S:18&B:1&T:      ⑸破坏国家宗教政策，宣扬邪教和封建迷信的；|\n|S:18&B:1&T:      ⑹散布谣言，扰乱社会秩序，破坏社会稳定的；|\n|S:18&B:1&T:      ⑺散布淫秽、色情、赌博、暴力、凶杀、恐怖或者教唆犯罪的；|\n|S:18&B:1&T:      ⑻侮辱或者诽谤他人，侵害他人合法权益的；|\n|S:18&B:1&T:      ⑼宣扬、教唆使用外挂、私服以及木马的相关内容的；|\n|S:18&B:1&T:      ⑽发布任何经力港网络合理判断为不妥当或者力港网络未认可的软件、文件、广告等在内的文字、主页地址或者链接的；|\n|S:18&B:1&T:      ⑾含有中华人民共和国法律、行政法规禁止的其他内容的。|\n|S:18&B:1&T:      7.用户不得通过不正当的手段或其他不公平的手段使用力港网络的软件和服务或参与力港网络活动。用户不得干扰力港网络正常地提供软件和服务，包括但不限于：攻击、侵入力港网络的网站服务器或使网站服务器过载；破解、修改力港网络提供的客户端程序；攻击、侵入力港网络的游戏服务器或游戏服务器端程序或使游戏服务器过载；制作、发布、传播、使用任何形式的妨碍游戏公平性的辅助工具或程序(包括但不限于“外挂”)；利用程序的漏洞和错误(Bug)破坏游戏的正常进行或传播该漏洞或错误(Bug)；不合理地干扰或阻碍他人使用力港网络所提供的软件和服务。|\n      8.用户同意以游戏程序中的监测数据作为判断用户是否有通过使用外挂程序等方法进行的游戏作弊行为的依据。\n      9.如果力港网络发现用户数据异常，力港网络有权采取相应措施：包括但不限于对游戏帐号的冻结、封停、终止直至删除，以及对涉及使用外挂的游戏角色的隔离、封停和删除；对涉及使用外挂的游戏角色拥有的虚拟物品进行冻结或收回。基于上述行为而被力港网络冻结、终止、删除《力港武林盟主》的帐号、游戏角色、虚拟物品或采取其他限制措施的用户，无权因此要求力港网络承担任何责任。\n      10.游戏账号、游戏币及其他游戏道具等是力港网络游戏服务的一部分，力港网络在此许可用户依本协议而获得其使用权。用户购买、使用游戏币及其他游戏道具等应遵循本协议、游戏具体规则的要求；同时，游戏币及其他游戏道具等可能受到一定有效期限的限制，即用户在规定的有效期内未使用，除不可抗力或可归责于力港网络的原因外，一旦有效期届满，将会自动失效。\n为更好地向用户提供力港网络游戏服务，力港网络有权对游戏相关内容（包括但不限于游戏道具的设计、性能及相关数值设置等）作出调整、更新或优化。\n      11.力港网络未授权用户从任何第三方通过购买、接受赠与或者其他的方式获得游戏账号、游戏道具、游戏币及其他游戏服务。力港网络不对第三方交易行为（第三方交易，是指用户从第三方通过购买、接受赠与或者其他的方式获得游戏账号、游戏道具、游戏币及其他游戏服务的行为）负责，并且不受理因任何第三方交易发生纠纷而带来的申诉。\n      12.用户不得利用《力港武林盟主》的任何内容牟取非法利益，包括但不限于充当游戏道具交易中介收取中介费，私自与他人进行游戏账号、游戏道具、游戏币买卖等行为；否则，力港网络有权同时采取以下措施：对相应账号进行倒扣数值、暂时隔离、永久隔离、强制离线、封停账号、删除档案、清空账号财产等处理；情节严重的，力港网络保留追究用户法律责任的权利。\n      13.对于被认定违反游戏正常秩序而进行处理的游戏账号，拥有账号使用权的用户有权向力港网络进行申述，要求重新审核，但申述时需提供与账号注册时填写的身份信息一致的身份证明，如无法提供，则力港网络有权拒绝玩家申述，不予处理。\n      14.力港网络将按照相关法律法规和本协议的规定，采取切实有效的措施保护未成年人在使用力港网络游戏服务过程中的合法权益，包括可能采取技术措施、禁止未成年人接触不适宜的游戏或者游戏功能、限制未成年人的游戏时间、预防未成年人沉迷网络。作为游戏规则的一部分，力港网络还将在适当位置发布力港网络游戏用户指引和警示说明，包括游戏内容介绍、正确使用游戏的方法以及防止危害发生的方法。所有未成年人用户都应在法定监护人的指导下仔细阅读并遵照执行这些指引和说明；其他玩家在使用力港网络游戏服务的过程中应避免发布、产生任何有损未成年人身心健康的内容，共同营造健康游戏环境。\n      15.如出现以下情形之一的，力港网络有权将用户的游戏账号纳入相应的防沉迷系统，采取相应的防沉迷措施：\n（1）系统判断用户未满18周岁的；\n（2）用户提交的实名身份信息不规范的；\n（3）用户实名验证未通过的；\n（4）游客模式登录的；\n（5）其他国家法律法规政策要求或力港网络有合理理由认为需要纳入防沉迷系统的情形的。\n      16.对纳入相应防沉迷系统的游戏账号，我们有权依据国家有关法律法规及政策规定、本协议其他条款规定、力港网络游戏运营策略或根据用户法定监护人的合理要求采取以下一种或多种措施：\n（1）将与用户游戏相关的信息（包括但不限于用户游戏账号的登录信息、充值流水信息等）提供给用户的法定监护人，使得用户法定监护人可及时或同步了解用户游戏情况；\n（2）限制用户游戏账号的消费额度；\n（3）采取技术措施屏蔽某些游戏或游戏的某些功能，或限定用户游戏时间或游戏时长；\n（4）注销或删除用户游戏账号及游戏数据等相关信息；\n（5）用户法定监护人要求采取的，或力港网络认为可采取的其他合理措施，以限制或禁止用户使用力港网络游戏；\n（6）国家法律法规或政策要求的相关措施。\n\n|S:18&B:1&T:第六部分、服务的中断、中止、终止|\n      1.对用户服务的中止与终止\n      ⑴ 用户有发布违法信息、严重违背社会公德、以及其他违反法律禁止性规定的行为，力港网络应当立即终止对用户提供服务。\n      ⑵ 用户在接受力港网络服务时实施不正当行为的，力港网络有权终止对用户提供服务。该不正当行为的具体情形应当在|S:18&B:1&T:本《服务条款》、或《用户守则》|有明确约定或属于力港网络事先明确告知的应被终止服务的禁止性行为，否则，力港网络不得终止对用户提供服务。\n      ⑶ 用户提供虚假注册身份信息，或实施违反本协议的行为，力港网络有权中止对用户提供全部或部分服务；力港网络采取中止措施应当通知用户并告知中止期间，中止期间应该是合理的，中止期间届满力港网络应当及时恢复对用户的服务。\n      2.对《力港武林盟主》游戏服务器运营的中断、中止与终止\n      ⑴为了游戏服务器的正常运行，力港网络需要定期对游戏服务器进行停机维护或针对突发事件进行紧急停机维护；因上述情况而造成的正常服务中断、中止，用户应该予以理解，力港网络则有义务尽力避免服务中断并将中断时间限制在最短时间内；\n|S:18&B:1&T:      发生下列情形之一时，力港网络有权终止或中断游戏服务器所提供之全部或部分服务，对因此而产生的不便或损失，力港网络对用户或第三人均不承担任何责任：|\n      ①定期检查或施工，更新软硬件等，力港网络有权暂停服务，但力港网络会尽快完成维护、更新工作；\n      ②服务器遭受损害，无法正常运作；\n      ③突发性的软硬件设备与电子通信设备故障；\n      ④网络提供商线路或其他故障；\n      ⑤在紧急情况之下依照法律的规定或为用户及第三者之人身安全导致的；\n      ⑥第三方原因或其他不可抗力的情形。\n      ⑵力港网络保留在其认为有必要的情况下终止或部分终止运营《力港武林盟主》的权利，终止前将提前60天予以公告。\n      如果力港网络自行决定终止我们的服务和产品的运营，我们将依据法律法规的规定提前60日予以公告，同时，用户尚未使用的虚拟货币及尚未失效的游戏服务，将按用户购买时的比例，以法定货币退还给用户或以其他方式进行退换。相关法律法规的规定发生变更的，力港网络将按当时有效的规定执行。\n\n|S:18&B:1&T:第七部分、责任限制|\n      1.对于力港网络的产品和服务，力港网络仅作下述有限保证：\n         (1) 力港网络所提供的产品和服务能基本符合力港网络正式公布的要求；\n         (2) 力港网络所提供的相关产品和服务基本与力港网络正式公布的服务承诺相符；    \n         (3) 力港网络仅在商业上允许的合理范围内尽力解决力港网络在提供产品和服务过程中所遇到的问题。",DisplayPolicyWin_14:"\n      2.在任何情况下，力港网络不对因不可抗力导致的用户在使用力港网络游戏服务过程中遭受的损失承担责任。该等不可抗力事件包括但不限于国家法律、法规、政策及国家机关的命令及其他政府行为或者其它的诸如地震、水灾、雪灾、火灾、海啸、台风、罢工、战争等不可预测、不可避免且不可克服的事件。\n|S:18&B:1&T:      3.力港网络可独立决定随时变更、终止、中止用户对任何本游戏服务的使用，无须向用户发出任何提前通知，但根据法律法规或用户与力港网络的约定需要提前通知的除外。若因用户的行为违反法律法规的规定或本协议的规定，力港网络根据相关规定终止、中止用户使用本游戏服务，则力港网络无须向用户承担任何责任，且有权要求用户承担相应的责任。|\n      4.本游戏可能因游戏软件BUG、版本更新缺陷、第三方病毒攻击或其他任何因素导致用户的游戏道具、游戏装备及游戏金币等账号数据发生异常。在数据异常的原因未得到查明前，力港网络有权暂时冻结该游戏账号；若查明数据异常为非正常游戏行为，力港网络有权恢复游戏账号数据至异常发生前的原始状态（包括向第三方追回被转移数据），且力港网络无须向用户承担任何责任。\n      5.第三方在本游戏中投放的广告、链接或者其它形式的推广内容，均是由其自行提供的，用户应当自行判断其真实性，力港网络对其推广内容不作任何明示或者默示的担保。\n      6.不同操作系统之间存在不互通的客观情况，该客观情况并非力港网络造成，由此可能导致用户在某一操作系统中的充值和游戏数据不能转移到另一操作系统中。由于用户在不同系统进行切换造成的充值损失和游戏数据丢失风险应由用户自行承担。\n      7.本游戏中可能会设置强制对战区域或玩法，如果用户不同意强制对战，请不要进入该游戏或游戏区域；用户的进入，将被视为同意该玩法并接受相应后果。\n|S:18&B:1&T:      8.用户在《力港武林盟主》游戏中、官方论坛上所表达的观点、建议和其它内容均为用户其本人看法，不代表力港网络的观点，用户不得发布任何违反国家法律法规规定或本《服务条款》的内容，一经发现，可视情况予以责令删除、词语屏蔽、封号、限制游戏等措施。|\n\n|S:18&B:1&T:第八部分、信息的储存和安全及信息发布的限制|\n      1.力港网络对本条款下所提供的服务将尽力维护其安全性及方便性，但对服务中出现的信息(包括但不限于用户发布的信息)删除或储存失败不承担任何责任。另外我们保留判定用户的行为是否符合本条款的要求的权利，如果用户违背了本条款的规定，力港网络有权中断依据本条款对用户提供的服务。\n\n|S:18&B:1&T:第九部分、条款修改|\n|S:18&B:1&T:      1.力港网络有权出于对力港网络自身、用户的需要和市场的变化考虑修改本条款。本条款一旦发生变动，力港网络将提前在《力港武林盟主》游戏里或官方网站的重要页面上进行提示，敬请定期查询。用户如继续使用本条款涉及的服务，则视为对修改内容的同意；用户在不同意修改内容的情况下，有权停止使用本条款涉及的服务。|\n\n|S:18&B:1&T:第十部分、知识产权|\n      1.《力港武林盟主》游戏软件及官方网站上所有的作品及资料，其著作权、专利权、商标专用权及其它知识产权，均为力港网络所有，除非事先经力港网络合法授权，任何人皆不得擅自以任何形式使用，否则力港网络有权立即终止向用户提供软件和服务，并依法追究其法律责任，赔偿力港网络的一切损失。此外，除用户的姓名、身份证号、电话号码等个人身份数据信息外，用户参加游戏过程中产生并储存于力港网络服务器中的任何数据信息，包括但不限于帐号数据信息、角色数据信息、等级及虚拟物品数据信息(包括但不限于游戏币、道具)等的知识产权及所有权均属于力港网络，用户在按照本条款正常使用《力港武林盟主》软件及服务的过程中对属于其用户帐号的数据信息享有有限使用权。\n      2.为避免争议，本条款涉及到的有关技术方面的问题，用户同意以力港网络服务器所储存的数据作为判断标准。力港网络保证该数据的真实性。\n|S:18&B:1&T:      3.《力港武林盟主》游戏软件的内容及程序的知识产权均为力港网络所有，未经力港网络授权，任何人不得复制、反编译(de-compile)、反汇编(disassemble)任何功能或程序，不得对任何功能或程序进行反向工程(reverse engineering)。也不得利用《力港武林盟主》的任何内容而牟取商业利益。|\n\n|S:18&B:1&T:第十一部分、关于活动和游戏版本变动的说明|\n      1.为了提高用户对游戏的参与热情，力港网络会不定期进行相应的活动，关于活动的内容，时间和具体细则均以官方相关公告内容为准。\n      2.为增加并丰富游戏的内容，力港网络会不定期更新、调整或改变游戏版本或任何部分或全部游戏功能。发生变动后，一切游戏内的操作、内容、设定、规定将以官方相关公告为准。\n      3.版本及功能的更迭、变换并不影响力港网络与用户之间适用本《服务条款》，双方的权利义务的规范仍按本《服务条款》的约定执行。\n",DisplayPolicyWin_15:'\n|S:18&B:1&T:第十二部分、通知的方式和途径|\n      1.力港网络所有发给用户的通知可通过重要页面的公告或手机短息或电子邮件或常规的信件传送。同时，用户在此授权力港网络可以向其手机或电子邮箱发送商业信息。\n\n|S:18&B:1&T:第十三部分、授权|\n      1.用户原创作品上载、传送、输入或以其他方式提供至《力港武林盟主》游戏官方网站或论坛时，无论是用户原创或是用户得到著作权人授权转载的作品，用户上载的行为即意味着用户或用户代理的著作权人授权力港网络对上载作品享有不可撤销的永久的使用权和收益权。但用户或原著作权人仍保有上载作品的著作权。\n\n|S:18&B:1&T:第十四部分、纠纷|\n      1.本条款适用中华人民共和国的法律，并且排除一切冲突法规定的适用。\n      2.如双方就本条款内容或其执行发生任何纠纷，双方应尽量友好协商解决；协商不成时，用户和力港网络一致同意将纠纷交由|S:18&B:1&T:桂林市秀峰区人民法院|管辖。\n\n|S:18&B:1&T:第十五部分、条款说明|\n|S:18&B:1&T:      1.用户如对本条款有任何疑问，请登录《力港武林盟主》游戏，在游戏聊天界面-客服处咨询和反馈。|\n\n|S:22&B:1&T:用户守则|\n|S:18&B:1&T:前言|\n      欢迎您选择享受力港网络提供的游戏服务！我公司将遵循国家对网络游戏运营管理的相关规定，提倡"保护未成年人健康、创建绿色网游环境"的口号，努力为您提供更优质的服务。同时，请玩家在申请《力港武林盟主》账号时填写您真实的姓名及证件号码等相关个人信息，以便更好地体验力港网络带给您的游戏服务。\n\n|S:18&B:1&T:游戏管理规则|\n      为了维护良好的游戏环境，力港网络要求《力港武林盟主》玩家必须遵守以下规则。请仔细阅读以下游戏管理规则|S:18&B:1&T:(特别是黑色加粗字体加下划线标注的内容)，如果您不同意以下任何一点，请立即停止使用《力港武林盟主》软件。|\n\n|S:18&B:1&T:一、游戏惩罚概述|\n      不以规矩，无以成方圆。\n      良好的秩序是一切美好事物的基础。我们所做的一切，均是为了维护游戏世界的和谐与公平。但真正的秩序，应源于每个人的习惯。我们真诚希望能有那样一天——我们不必再用游戏惩罚去约束大家的行为。\n      若玩家违反本用户守则的规定，玩家可能遭受以下一项或几项惩罚。\n      警告——警告即是对游戏用户的提醒，使其警示，它仅仅是针对轻微违反游戏政策而做出的教育导向，它是用于正常管理游戏运行的一种方式。\n      禁言——关闭违规玩家的部分或全部聊天频道，强制暂停玩家角色的线上对话功能，使玩家角色无法与其他玩家对话，直到此次处罚到期或是取消。\n      暂时隔离——将违规玩家的游戏角色转移到特殊游戏场景，限制其局部游戏操作，直到此次处罚到期或是取消。\n      永久隔离——将违规玩家的游戏角色永久转移到特殊游戏场景，并限制其局部游戏操作。\n      暂时禁止登录——暂时禁止违规玩家游戏账号或游戏角色登录游戏，直到此次处罚到期或是取消。\n      强制离线——强制让违规玩家离开当前游戏，结束玩家当前游戏程序的执行。\n      封停账号——暂停或永久终止违规玩家游戏账号登录游戏的权利。\n      删除档案——将违规玩家在游戏世界中的档案删除，不让该角色再出现在游戏世界。\n      收回游戏虚拟物品——对于玩家因欺诈或其他违规行为而获取的游戏虚拟物品，包括但不限于游戏虚拟物品进行收回。\n      解散组织——解散玩家成立的帮派、公会等组织。\n      倒扣数值——针对游戏角色游戏数值进行扣除，包括但不限于游戏角色等级、金币、经验等。\n      暂时限制游戏行为——在一定时间内对游戏角色的角色升级、比赛、PK等部分游戏行为做出限制。\n      清空账号财产——对于玩家私下进行账号买卖，道具交易或其他违规行为而获取的游戏虚拟财产，包括但不限于将游戏虚拟财产进行清空。\n      承担法律责任——对于玩家的不当行为对他人或者力港网络的合法权益技造成损害或者与现行法律规定相违背的，违规玩家要依法承担相应的民事、行政或刑事责任。\n\n|S:18&B:1&T:二、关于作弊|\n      用户在游戏中串通作弊、利用作弊软件和游戏漏洞作弊等不正当手段获得利益、以及为了自己获得利益而损害他人利益的行为都被《力港武林盟主》视为"作弊行为"。包括但不限于如下行为：\n      串通作弊——指利用电话、QQ等其他非游戏内的通讯方式相互联合作弊，游戏中有2至3位用户合伙串通、骗取第3方乃至第4方利益（金币等虚拟财富）的行为。\n      公开买卖游戏虚拟财富——指游戏中发现有用户公开叫卖、叫买或买卖金币等虚拟财富的行为。\n      非正常金币——指用户在游戏中利用程序漏洞获得不正当金币的行为。\n      作弊软件——指任何用户不得利用游戏、网站等相关漏洞，通过非法软件为自己获得利益而损害他人利益的行为，造成游戏内不正常现象发生，破坏游戏平衡性的程序软件。\n      盗号、盗取虚拟财富——指用户利用非法软件盗取其他用户账号或虚拟财富。\n\n|S:18&B:1&T:三、关于违规|\n      用户在游戏中违反游戏规则，违反用户守则和服务条款中约定的任意条款，包括但不限于如下行为：\n      恶意耗时——指任何用户在游戏中故意拖延游戏时间构成损害其他用户利益，同时破坏游戏平衡性的行为。\n      不文明聊天或刷屏——指任何用户在公共聊天频道重复发言，恶意刷屏，在游戏中辱骂脏话，使用不雅的文字，侮辱、毁谤他人，或语带威胁，做有违社会善良风俗等情形。\n',DisplayPolicyWin_16:"      违规用户名或昵称——指用户注册侮辱性账号来攻击其他用户，或使用违规用户名或昵称，来侮辱、毁谤他人，或语带威胁，有违社会善良风俗等用户名或昵称。\n      胡乱举报玩家——指用户三次以上（含三次）恶意举报同一正常玩家的不正当行为。\n|S:18&B:1&T:      刷号——指同一用户（使用身份证号码或手机号码、邮箱进行注册的用户）使用超过3个账号在同一比赛活动或者游戏房间中进行游戏，影响赛事或游戏的公平性。|\n      账号、道具买卖——擅自与其他用户进行游戏虚拟货币、游戏币及其他游戏道具等交易，或从第三方通过购买、接受赠与或者其他式获得游戏虚拟货币、游戏币及其他游戏道具或游戏服务。以及在未经力港网络授权或认可的折扣渠道进行游戏充值、进行折扣游戏道具交易（例如在非力港网络官方渠道低价购买折扣道具）或委托未获力港网络授权或认可的第三方代为充值，或者使用未经力港网络授权或认可的第三方软件充值。\n\n|S:18&B:1&T:四、作弊违规处罚条例|\n      任何用户，只要被发现有作弊违规的数据记录或作弊违规的行为，视情节轻重按以下规定进行处罚：\n      “不文明聊天或刷屏”账号——第一次警告禁言24小时，第二次冻结账号7天，第三次或情节恶劣者冻结账号一个月处理，屡教不改者，清空虚拟财富并且永久性封号。\n      “恶意耗时”账号处罚——第一次给予警告，第二次冻结账号七天。\n      “串通作弊”账号处罚——首次违规账号追回不正当收益并冻结账号七天；再犯者清空虚拟财富并且永久性封号。\n      “非正常金币”账号处罚——清空虚拟财富并且永久性封号。\n      “违规用户名或昵称”账号处罚——违规用户名或昵称一经发现冻结账号一个月、并由官方取消原用户名或昵称，再犯者，清空虚拟财富并且永久性封号。\n      “公开买卖游戏虚拟财富”账号处罚——首次给予警告冻结账号七天，再犯者清空虚拟财富并且永久性封号。\n      “盗号、盗取虚拟财富”账号处罚——经查证属实盗取其它玩家账号者，对盗窃者金币清零并且永久性封号。将金币等虚拟财富转移至其他账号，官方将根据这些账号的共性（注册信息，游戏记录，金币去向，等其他游戏数据）封停所有参与转移金币等虚拟财富的账号。\n      “作弊软件”账号处罚——清空虚拟财富并且永久性封号。\n      胡乱举报玩家——首次违规账号给与警告冻结账号七天处理；再犯者冻结账号一个月处理。\n      对于在《力港武林盟主》游戏中查处的作弊行为，如果同一个游戏账号被发现两次或两次以上进行以上违规行为的，将进行封号并永不给予解封。如有情节严重者将没收其虚拟财富、实行清空金币、封停账号，情节恶劣者将封停相关IP禁止登录游戏。\n      上述各条处理办法之间互不相抵，可各自执行。\n\n|S:18&B:1&T:五.处罚的依据|\n      任何用户，只要被发现有作弊违规数据记录或作弊违规行为，不论是哪种作弊行为，均按本条例相关规定进行处罚，处罚依据有以下几种：\n      “游戏截图”不作为处罚的唯一依据。\n      发现游戏数据异常，官方将根据账号之间的共性（注册信息，游戏记录，金币等虚拟财富去向，等其他游戏数据），对作弊账号根据本条例处罚。\n      串通作弊的作弊行为，因为较难区分是出牌错误，还是新手或者是其他问题，投诉用户一般需要提供连续截图做为证据，一旦查实，作弊账号将根据本条例处罚。\n      对于有争议投诉，我们将通过“作弊的判定”中的条款进行核实审查。\n      通过“作弊的判定”中的条款被判为作弊违规的玩家，官方不提供游戏后台数据。\n      受处罚账号可以通过官方公布的相关联系方式查询处罚原因。\n\n|S:18&B:1&T:六、作弊处罚通知|\n      《力港武林盟主》对作弊违规用户的账号处罚后，将通过游戏内邮件、官方网站、官方论坛等发布公告为主要通知方式，《力港武林盟主》不会在处罚前通知用户的义务，个别通知将以用户在登录时予以提示和说明。\n\n|S:18&B:1&T:七、违规账号具体处理形式|\n      （一）账号封停7天——包括但不限于如下行为：\n      1.在公共对话框重复发言，恶意刷屏骂人的，情节较轻者\n      2.投诉者参与对骂的投诉，情节较轻者\n      3.投诉者为先骂人者，使用小号，先骂人者无任何当事理由的对骂投诉者很可能被判断为恶意挑衅行为（后骂人者）\n      4.发表一切反动或政治敏感话题，情节较轻者\n      5.首次互通消息（指的是在游戏中向其他用户发布有可能影响牌局结果的消息的行为）者\n      6.用带有脏话、不雅的文字、讥讽、侮辱、诽谤他人或带有威胁、挑衅等有违社会善良风俗等语句者，情节较轻者\n      7.首次串通作弊者\n      8.使用多个小号恶意挑衅其他用户的，一经查实，将封闭其注册者所拥有的所有账号\n      9.发布有损力港网络和《力港武林盟主》游戏声誉或商业利益的文章，情节较轻者\n      10.多次恶意耗时（故意拖延游戏时间构成损害其他用户利益的行为）者，游戏等级下降两级\n      11.首次在论坛中发布任何威胁、恐吓、漫骂、不雅、庸俗、亵渎、色情、淫秽、非法、反动、前后矛盾、攻击性、伤害性、骚扰性、诽谤性、辱骂性的或侵害他人知识产权的文字。情节较轻者\n      12.胡乱举报玩家：首次三次以上（含三次）恶意举报同一正常玩家的不正当行为。\n\n      （二）、账号封停一个月——包括但不限于：\n      1.用户利用其它方式获得不正当利益、以及为了自己获得利益而损害他人利益的行为，经查证属实的，均可认定为作弊行为，情节较轻者\n      2.用户游戏数据异常，或游戏金币流动金额较大且无合理理由的，一律按作弊处理。\n      3.关于作弊的虚假投诉，恶意举报等恶意投诉行为，也属于严重作弊行为。与事实严重不符，恶意举报行为既被视为恶意投诉者\n      4.胡乱举报玩家：再次三次以上（含三次）恶意举报同一正常玩家的不正当行为。\n      5.首次使用第三方软件（用非老软件或者程序，直接从游戏的数据文件或游戏程序本身中提取出一些数据供自己使用，或修改游戏程序在内存中映像的指令、指令顺序或数据，或拦截游戏客户端向外发送或接收的数据资料.）\n\n      （三）、账号封停一年半，包括但不限于：\n      1. 多次恶意耗时，故意损害其他玩家利益者，并且屡教不改，金币等虚拟财富清零\n      2.在论坛上发布任何教唆他人从事违法行为，发布助长国内不利条件和涉及国家安全的文字，发布任何对论坛氛围有负面影响及带有个人恩怨性质的文章\n      3.发布明显力港网络或与《力港武林盟主》游戏运营管理相抵触的文章者\n\n      （四）、账号封停永久，包括但不限于：\n      1. 经常不文明聊天或随意刷屏者\n      2.再次串通作弊者，虚拟财富清零\n      3.非“正常金币”（用户在游戏中利用程序漏洞获得不正当金币的行为）获得者，清空虚拟财富\n      4.再次使用违规昵称，清空虚拟财富\n      5.违规用户名，清空虚拟财富\n      6.使用作弊软件，清空虚拟财富\n      7.盗用别的玩家账号恶意给自己账号刷金币者，封停账号，清空盗用者的虚拟财富\n      8.公开买卖游戏虚拟财富（如金币等），清空虚拟财富\n      9.对恶意扰乱他人游戏，破坏游戏平衡性，利用BUG谋取私利的玩家\n      10.冒充官方工作人员账号，在游戏中散布虚假信息、诈骗等行为\n      11.论坛中宣传非法网站，宣传或使用个人服务器、木马、外挂、病毒，垃圾广告等信息，及下载等内容,情节严重者\n      12.充当游戏账号、道具交易中介收取中介费，或私自与他人进行游戏账号、游戏道具、游戏币等交易的\n      力港网络依据本协议对用户的游戏账号采取封号处理措施的，具体封号期间由力港网络根据以上违规行为情节而定。\n      用户知悉并同意：（1）在封号期间，用户游戏账号中的游戏虚拟货币、游戏币及其他游戏道具可能都将无法使用；（2）如前述游戏虚拟货币、游戏币及其他游戏道具存在一定有效期，该有效期可能会在封号期间过期，用户游戏账号解封后，用户将无法使用该等已过期的游戏虚拟货币、游戏币及其他游戏道具。\n\n|S:18&B:1&T:八、附则|\n      本条例的修改权归力港网络所有。修改本条例时，将以公告的方式通知用户，而不另对用户进行个别通知。若用户不同意修改的内容，可停止使用《力港武林盟主》的服务，力港网络不承担退费、赔偿或者补偿等任何形式的责任。若用户继续使用《力港武林盟主》的服务，即视为用户已接受力港网络所修改的内容,并且不得据此要求任何赔偿和补偿。\n\n|S:18&B:1&T:声明|\n      力港网络郑重声明，出现以上违规账号形行一经审核确认，都将一律按照以上形式处理，情节严重者，我们将对任何恶意破坏游戏秩序的行为采取一切必要手段，甚至通过法律手段进行严厉打击，坚决捍卫广大游戏用户的正当权利。\n      如果您违反论坛管理制度，力港网络的相关工作人员有权在不需要解释的任何的情况下将其屏蔽论坛发言权、封闭您的账号、乃至删除您的账号的权利。\n      封闭账号处罚意味着封闭账号相关所有功能以及相关所有游戏资料，包括金币、经验等级等，因违反《力港武林盟主》任何管理规定被处罚而导致的金币等游戏各种资料的损失，力港网络一律不予以补偿。\n      对于任何一种违规行为，力港网络视情节轻重，有权在第一次查出其违规行为时，对其进行以下处理：还原游戏资料、没收其金币等虚拟财富、封闭其账号、删除其账号、屏蔽其计算机并保留提交公安机关协助受理用户追诉权利。"};var g_terms_20122=window["g_terms_20122"]={g_terms_20122_0:"《用户协议》",g_terms_20122_1:"\n前言\n\n欢迎来到本游戏，为了保障您的合法权益，请您在使用本游戏或接受本游戏及相关服务前，请详细阅读用户协议的所有内容，特别是其中免除或者限制我方责任的条款（该等条款通常含有“不负任何责任”、“无义务”、“不保证”等词汇）、限制用户权利的条款（该等条款通常含有“不得”、“不应”、“无权”等词汇）、管辖和法律适用条款，这些条款应在中国法律所允许的范围内最大程度地适用，该类条款通常以粗体或其他颜色字体标示。本游戏官方将努力为玩家提供更优质的服务。\n\n一、重要须知\n\n1、您确认您是具备完全民事权利能力和完全民事行为能力的自然人，有能力签署并遵守本协议，并对您注册和使用本游戏账号的全部行为独立承担法律责任。\n2、一旦您注册本游戏账号，即表示：您具备前述主体资格，您将被视为具备完全民事权利能力和完全民事行为能力的自然人，您在本游戏内的一切行为将需要承担法律责任。\n3、如果您是未成年人，或不具备前述主体资格，在决定使用本游戏之前，您应该和您父母或者监护人一起详细阅读本协议，特别是关于未成年人的使用条款，以确保他们理解协议的内容后确认是否同意注册使用我方的提供的游戏服务、向我方支付费用的行为，以及对本协议的全部条款同意后，方可使用我方提供的游戏服务。\n4、在您进入游戏后，即代表您默认同意本协议的任何条款。\n如用户不同意本协议的任何条款，则不得安装、使用本游戏软件，不得享用本游戏服务。用户一旦点击“接受”（或其他具有同样含义的词或动作，如“同意”或勾选、进入游戏等）并注册、开始使用及/或继续使用本游戏服务，即视为用户同意并已经接受本协议中全部条款。此后您不得以未阅读/未同意本协议内容或类似理由提出任何形式的抗辩。此外，依据本协议第六条，我方有权不时对本协议进行修改与更新，请用户留意查看本协议的最新版本。\n\n二、账号的使用规则\n\n1、本游戏账号和账号信息的所有权归本游戏官方所有，您作为初始申请注册人享有对本游戏账号的使用权，您不得以任何方式将您的本游戏账号提供给他人使用，包括但不限于出售、赠予、转让、出租，也不得将本游戏账号用于商业用途。\n2、您在注册或使用本游戏账号的过程中，需遵守本协议的约定和相关法律法规的要求，不得发布含有以下内容的信息或从事相关违法行为：\n（1）违反宪法确定的基本原则的。\n（2）危害国家统一、主权和领土完整的。\n（3）泄露国家秘密、危害国家安全或损害国家荣誉和利益的。\n（4）煽动民族仇恨、民族歧视，破坏民族团结的；\n（5）破坏国家宗教政策，宣扬邪教和封建迷信的；\n（6）散布谣言，扰乱社会秩序，破坏社会稳定的；\n（7）散布淫秽、色情、赌博、暴力、凶杀、恐怖或者教唆犯罪的；\n（8）侮辱或者诽谤他人，侵害他人合法权益的；\n（9）含有法律、行政法规禁止的其他内容的。\n（10）违反人文道德、风俗习惯的。（如：在游戏内恶意刷屏和辱骂他人。）\n（11）任何形式的未经本游戏运营团队允许的广告。\n（12）煽动玩家，造谣生事。\n若您注册或使用本游戏账号违反本协议的约定、相关法律法规的规定，或对本游戏造成损害的，本游戏官方有权视情形对您的游戏账号进行制裁。\n制裁规则：\n（1）禁言：即对违规玩家进行禁言。\n（2）封号：即封禁违规玩家的帐号。\n（3）封禁IP：即封禁违规玩家的ip。\n3、用户对于我方帐号及密码的保管以及使用该帐号和密码所进行的一切行为负有完全的责任。为保障用户账号安全、维护游戏内秩序，禁止将我方帐号或密码销售、转让或出借、共享给他人使用，否则，我方有权中止或终止该账号使用我方的任何服务。本游戏官方将积极采取技术与管理等合理措施保障您的游戏账号的安全、有效。您有义务妥善保管账号及密码，并正确、安全的使用账号及密码，您对登录后所持本游戏账号产生的行为依法享有权利和承担责任。若您未尽上述义务导致账号密码遗失、账号被盗等情形而给您和他人的民事权利造成损害的，应当自行承担由此产生的法律责任，我方均不承担任何责任。\n4、若您发现您的账号或密码被他人非法使用或存在使用异常的情况，您应当及时通知本游戏官方，并告知本游戏需要采取的措施。在此情况下，您需要提供与注册身份信息相一致的个人有效身份信息。若经本游戏官方核实信息一致，本游戏官方将采取相应的措施，但您应自行承担或赔偿您因此受到的、或给他人造成的损失（如导致账户内虚拟物品或虚拟货币的使用期限届满等）。若您没有提供个人有效身份证件或者提供的个人有效身份证件与所注册的身份信息不一致，本游戏官方有权拒绝您的上述请求，由此给您或他人造成的损失，由您自行承担。\n\n三、帐号注册信息\n\n1. 提供注册信息\n（1）在申请我方帐号时（或注册后补充信息时），用户应当向我方提供最新、详细及真实准确的个人信息。用户在此承诺：用户以其真实身份注册成为我方的用户，并保证所提供的个人身份资料信息真实、完整、有效，依据法律规定和必备条款约定对所提供的信息承担相应的法律责任。\n（2）所有由用户提供的个人注册信息将可能被我方用来作为认定我方帐号的关联性以及辨别用户身份的依据。用户同意应我方的要求，随时提供该等信息的证明材料，以便我方核实用户身份。\n（3）如果用户提供给我方的信息不准确，或不真实，或不合法有效，或已变更而未及时更新，或有任何误导之嫌，我方有权中止或终止该用户使用我方的任何服务。我方有权审查您注册所提供的身份信息是否真实、有效，并应积极地采取技术与管理等合理措施保障用户帐号的安全、有效；用户有义务妥善保管其帐号及密码，并正确、安全地使用其帐号及密码。任何一方未尽上述义务导致帐号密码遗失、帐号被盗等情形而给对方或他人的权利造成损害的，应当承担由此产生的法律责任。\n",g_terms_20122_2:"2.  用户同意，其与我方帐号相关的一切资料、数据和记录（包括但不限于登录记录、登录后行为记录、点卡信息等）均以我方系统记录的数据为准。\n\n四、用户的基本权利\n\n1. 用户有权在使用本游戏服务期间监督我方及我方的工作人员是否按照我方所公布的标准向用户提供服务，也可以随时向本游戏官方提出有关的意见和建议。\n2. 如果用户不同意本协议条款，或对我方后来修改、更新的条款有异议，或对我方所提供的服务不满意，用户可以随时选择停止使用本游戏。如果用户选择停止使用本游戏，我方不再对用户承担任何义务和责任。\n\n五、用户行为守则\n\n1. 用户同意按照本协议的规定规范自己的行为，从而接受并使用本游戏服务。用户对登录后其所持帐号产生的行为依法享有权利和承担责任。用户进一步同意，在违反这些规则时，按照本协议相关条款的规定承担违规后果和违约责任。\n2. 用户在使用我方帐号期间，须遵守与互联网信息发布相关的法律、法规及通常适用的互联网一般道德和礼仪的规范，用户将自行承担用户所发布的信息内容的责任。用户发布的各类信息，不得包含以下内容：\n（1）违背宪法所确定的基本原则的；\n（2）危害国家安全，泄露国家秘密，颠覆国家政权，破坏国家统一的；\n（3）损害国家荣誉和利益的；\n（4）煽动民族仇恨、民族歧视，破坏民族团结的；\n（5）破坏国家宗教政策，宣扬邪教和封建迷信的；\n（6）散布谣言，扰乱社会秩序，破坏社会稳定的；\n（7）传播淫秽、色情、赌博、暴力、凶杀、恐怖信息或者教唆犯罪的；\n（8）侮辱、诽谤或恶意用言语攻击他人，侵害他人合法权益的；\n（9）侵犯任何第三者的知识产权，版权或公众／私人权利的；\n（10）违反人文道德、风俗习惯的（如：在游戏内恶意刷屏和辱骂他人）；\n（11）破坏游戏正常秩序的；\n（12）任何形式的未经本游戏运营团队允许的广告；\n（13）含有法律、行政法规禁止的其他内容的。\n3. 用户的我方帐号名称及游戏中的人物、帮派等名称应当遵守合法、健康的原则，不允许使用包括但不限于涉及种族、宗教、政治、国家领导人、淫秽、低俗、诽谤、恐吓、欺诈性的、攻击性的、污辱性的、可能引起误会的、违禁药品等违反法律法规的名称。\n4. 用户应当对自己在游戏中的言行负责，尤其不得：\n（1）通过任何方式、行为散布或传播低俗、不雅信息；\n（2）通过任何方式、行为冒充平台或游戏系统向其他用户散布或传播虚假信息；\n（3）通过任何方式或途径引起纷争；\n（4）通过任何方式、行为散布或传播、使用私服、木马、外挂、病毒及此类信息；\n（5）通过任何方式、行为散布或传播代练的信息；\n（6）通过任何方式、行为传播或进行除我方提供的交易途径之外的游戏帐号、虚拟货币、虚拟道具的线下交易；\n（7）大量传播相同的、类似的短语或无意义的文字，或者任何与我方平台及其游戏无关的信息；\n（8）宣扬、鼓动任何游戏虚拟世界之外的暴力行为；\n（9）泄露其它用户、非用户或我方平台员工的任何游戏世界和现实世界信息；\n（10）宣传或发布违法信息、违反社会公德的信息，或不利于精神文明建设的信息，包括但不限于色情、赌博、邪教、恐怖主义等内容；\n（11）其他不符合法律法规、社会公德或游戏规则的言论或行为。\n5. 用户不得干扰、阻碍我方正常地提供游戏服务，尤其不得：\n（1）攻击、侵入我方的网站服务器或使网站服务器过载；\n（2）破解、修改我方提供的客户端程序；\n（3）攻击、侵入我方的游戏服务器或游戏服务器端程序或使游戏服务器过载；\n（4）不合理地干扰或阻碍他人使用我方所提供的服务；\n（5）利用程序的漏洞和错误（Bug）破坏游戏的正常进行或传播该漏洞或错误（Bug）；\n（6）直接或间接利用游戏Bug（包括游戏系统、程序、设定等方面存在的漏洞或不合理的现象）、程序漏洞获利或扰乱游戏秩序，或者利用Bug、漏洞达到个人目的；\n（7）制作、使用、发布、传播任何形式的妨碍游戏公平性的辅助工具或程序（指用于在游戏中获取优势，但不属于我方平台或各游戏软件的一部分的任何文件或程序），包括作弊性质的外挂以及相关辅助性质的外挂等（包括但不限于自动打怪、自动练级、自动吃药、自动完成任务、加速性质或超出游戏设定范围等操作）；\n（8）不得修改客户端程序，使之改变或者新增或者减少我方平台所预先设定的功能，或者导致客户端向服务器发送的数据出现异常的一切行为。\n6. 用户不得扰乱游戏秩序，尤其不得：\n（1）长时间停留在特殊地点或敏感地区（包括但不限于活动报名人、“移民使者”、传送人、传送点等处），干扰其他用户游戏；\n（2）进行恶意PK、清场、敲诈、勒索等行为；\n（3）扬言进行或煽动其他用户或非用户参与非正常游戏内容的行为（包括但不限于游行、聚众闹事等）；\n（4）以相似昵称的人物冒充他人好友、冒充NPC或官方角色等方式在游戏内外进行欺诈。\n7. 用户可以与游戏管理员（以下称为“GM”）进行交流，但在与GM交流时，不得做出以下行为：\n（1）冒充系统或GM；\n（2）欺骗或试图欺骗GM，包括但不限于误导GM、拒绝提供信息、提供虚假信息以及任何试图“诈骗”GM的行为；\n（3）违反或忽视GM做出的提示。在游戏中，为了确保大多数用户的共同利益，维护正常的游戏秩序，GM可能会提示用户执行某些操作或停止执行某些操作，用户不得忽视或阻挠该项工作的进行；\n（4）干扰GM工作。干扰GM工作包括但不限于：向GM索取任何游戏虚拟物品（包括但不限于虚拟货币、游戏道具等），频繁呼叫GM或发送无实质性内容的请求，反复向GM发送已解答或解决问题的帮助请求；\n",g_terms_20122_3:"（5）辱骂、威胁或恶意攻击GM。\n8. 用户必须保管好自己的帐号和密码，由于用户的原因导致帐号和密码泄密而造成的后果均将由用户自行承担。\n9. 用户仅能以个人身份使用本游戏服务，用户不能利用我方所提供的游戏服务从事商业目的的活动，也不能利用本游戏服务进行销售或其他商业目的的活动。\n10. 除非获得我方的书面许可，否则，用户不得利用我方的任何服务及其任何内容牟取商业利益，包括但不限于充当游戏道具交易中介收取中介费，以营利为目的销售游戏道具等。\n11. 用户不得利用我方提供的服务从事以下活动：\n（1）未经允许，进入计算机信息网络或者使用计算机信息网络资源的；\n（2）未经允许，对计算机信息网络功能进行删除、修改或者增加的；\n（3）未经允许，对进入计算机信息网络中存储、处理或者传输的数据和应用程序进行删除、修改或者增加的；\n（4）故意制作、传播计算机病毒等破坏性程序的；\n（5）窃取他人虚拟财产、虚拟物品、个人信息的；\n（6）其他危害计算机信息网络安全的行为。\n12. 用户同意以游戏程序中的监测数据作为判断用户是否有通过使用外挂程序等方法进行的游戏作弊行为的依据。使用外挂进行游戏者，本游戏官方有权长期封禁其帐号。\n13.若用户冒充官方人员或游戏币商人在游戏中行骗者，发布虚假信息者，本游戏官方有权长期封禁其帐号。\n13. 如果我方发现用户行为或者数据异常，可以观察及记录该用户行为，并以观察和记录的结果作为判断用户是否实施了违反本协议用户行为守则的依据。\n14. 若用户注册或使用本游戏账号违反本协议的约定、相关法律法规的规定，或对本游戏造成损害的，本游戏官方有权视情形向该用户施加以下一项或若干项违规后果，该用户应承担该等不利后果：\n（1）禁言：即对违规玩家进行禁言；\n（2）封号：即封禁违规玩家的帐号；\n（3）封禁IP：即封禁违规玩家的ip；\n（4）承担法律责任：违规用户的不当行为对他人或者我方造成损害，或者与现行法律规定相违背的，违规用户应依法承担相应的民事、行政和／或刑事责任，例如，用户在进行游戏过程中侵犯第三方知识产权或其他权利而导致被权利人索赔的，由用户自行承担责任。\n15．若用户实施违反本条所述用户行为守则的行为，我方还有权要求违规用户向我方承担违约责任，包括但不限于恢复原状，消除影响，对给我方造成的直接及间接损失或额外的成本支出进行赔偿，以及在我方首先承担了因违规用户行为导致的行政处罚或侵权损害赔偿责任后，由我方向违规用户追偿。\n16.用户在此明确同意并保证：用户因违反本协议第五条而被我方采取相应措施处理的，用户不得要求任何形式的赔偿或补偿。\n\n六、条款的修改和变更\n\n1. 为了向用户及时、更好地提供服务，基于对我方本身、用户及市场状况不断变化的考虑，我方保留随时修改、新增、删除本协议条款的权利。若用户不同意我方所修改、新增、删除的内容，可立即停止使用我方所提供的服务。若用户继续使用我方提供的服务，则视同用户同意并接受本协议条款修改、新增、删除后的内容，且不得因此而要求任何补偿或赔偿。\n2. 未经我方事先书面同意，用户不得转让其在本协议项下的权利或义务。我方有权通过我方的子公司或其他关联公司行使其在本协议项下的权利或履行本协议项下的义务。\n\n七、游戏管理\n\n1. 游戏信息转移。我方有权根据服务的提供状况，安排拆分或合并游戏服务器。在对用户游戏权益没有重大影响的情况下，我方有权将用户在游戏中的人物信息、角色档案转移到其它游戏服务器。\n2.若我方发现同一IP在短时间内进行多帐号注册或登录以至被系统判定为异常注册/登录时，我方有权长期锁定所有该IP在该时间段内注册或登录的帐号。\n3.在现有的技术条件下，我方将尽合理的商业努力并根据有关监管部门的要求开发并维护“未成年人家长监护系统”、“游戏防沉迷系统”与实名认证系统，按“现状”提供给用户使用。由于技术不可避免的局限性以及系统运作各环节受外界的影响，我方不保证各系统不存在任何漏洞，不保证各系统能随时正常运作，亦不保证监护或认证效果完全正确真实或满足用户的需求。我方不提供任何适用法律明确规定之外的明示或默示担保，不对此承担任何责任。\n4.因游戏软件缺陷、版本更新缺陷、第三方病毒攻击或其他因素导致您的游戏角色、游戏道具、游戏装备及游戏币等账号数据发生异常。在数据异常的原因未得到查明前，我们有权暂时冻结该游戏账号；若查明数据异常为非正常游戏行为，我们有权回复游戏账号至异常发生前的原始状态（包括向第三方追回被转移的数据）且无须向您承担任何责任。\n\n八、资费政策\n\n1. 我方有权决定我方所提供的游戏服务的资费标准和收费方式，我方可能按照我方所提供的游戏服务的不同阶段确定不同的资费标准和收费方式。另外，我方也可能不时地修改我方的资费政策，请用户及时查看游戏界面信息做出的说明，用户有义务在选择前仔细阅读，并在点击购买前确认您需支付的费用，一旦用户选择购买相关虚拟物品使用权或者接受相关服务，则表明您已经充分理解并接受相应的收费方式和资费标准。\n2. 除非法律另有明文规定或我方明确规定，否则用户不得要求我方返还用户已经支付予我方的任何资费（以下简称“退款”），无论该等资费是否已被消费。我方在本游戏服务提供过程中赠送的充值金额、虚拟货币、虚拟道具等，不予退款或变现。请您在购买付费的虚拟物品及服务前审慎考虑。\n3.除非有相反证据证明，用户的任何充值行为都是其真实意思表达，用户不得以操作失误为由请求返还充值。\n\n九、虚拟物品\n\n",g_terms_20122_4:"1. 我方提供游戏服务中的各种虚拟物品，不限于金币、银两、道具、装备等，其所有权归我方或其合作方所有所有。用户只能在合乎法律和游戏规则的情况下拥有对虚拟物品的使用权。用户一旦购买了虚拟道具的使用权，将视为已经进入消费过程，不得以任何理由要求退还。\n2. 除服务器大规模断线外，由于地方网络问题、用户操作问题等非我方原因造成的角色被删或回档、虚拟物品或金钱的损失，我方无需承担任何责任。\n3. 鉴于网上交易的复杂性，我方禁止用户进行账号或游戏虚拟物品买卖线下交易及线下交易相关行为。我方反对用户自行进行账号或虚拟物品买卖线下交易及线下交易相关行为（包括但不限于参与线下交易、协助线下交易者操作及转移账号或游戏虚拟物品等一系列行为），并且不保护线下交易产生的任何交易结果，用户之间进行线下交易行为发生的任何问题、纠纷，包括但不限于被虚假交易信息诈骗金钱或者游戏虚拟物品的，均与我方无关，用户将自行负责，我方不负责赔偿或追回因受骗造成的损失。\n4.我方不认可用户线下交易所产生的交易结果，用户通过线下交易所获得的游戏虚拟物品将被认定为来源不符合游戏规则。我方有权按照本协议第六条的约定，对线下交易及线下交易相关行为涉及的游戏虚拟物品、游戏角色与我方帐号采取相应的措施。\n\n十、服务方式、内容的变动与个人资料转移\n\n1. 我方将尽力持续地向用户提供本游戏服务，但是我方并不排除我方可能会停止本游戏服务的可能性，也不排除任何改变游戏服务或其他网络服务的服务方式、服务内容的可能性。\n2. 为增加并丰富本游戏服务的内容，游戏在运行时可能不定期更新并调整其包含的功能。\n3. 如果我方停止本游戏服务，我方将会事先通知用户，并尽力寻找适当的服务提供者以接替我方继续提供游戏服务。\n4. 在本条第3款所述情况下，我方可能会将用户的个人资料（包括有关的帐号和密码信息及个人资料）转移给该继续提供服务的一方，也可能根据需要，永久封存原有资料以推行新的游戏方式。用户在此同意我方有权做此转移和提供，并且同意在我方完成转移和提供之后，我方将不再对用户原有资料承担任何义务和责任。但是，我方并不保证我方届时一定能够找到适当的服务提供者或服务方式以代替我方继续提供服务，也不保证我方找到的服务提供者所提供的服务或者改变的游戏方式能够满足用户的要求。\n\n十一、服务中断或终止\n\n1. 如发生下列任何一种情形，我方有权随时中断或终止向用户提供本协议项下的游戏服务和其他网络服务，对于因而产生的不便和损失，我方不承担任何责任：\n（1）用户提供的个人资料不真实；\n（2）用户违反本协议中规定的用户行为准则。\n2. 在下列情况下，我方有权注销用户创造的角色，并删除该角色的所有记录，并不对因此导致的任何责任损失负责：\n（1）用户注册的游戏角色未达到一定游戏要求，并且在该角色所关联的游戏分区中可用游戏点数或游戏时间为零的情况下，连续一定时间未通过该角色登录过该游戏；\n（2）用户自行删除的角色，自删除之日起一定时间内没有恢复的；\n（3）用户在注册帐号后连续6个月的时间没有使用过此帐号的（包括使用此帐号登录游戏、登录网站或充值），自满第6个月当天24小时起，我方有权采取措施终止向用户提供游戏服务（包括但不限于：取消该游戏的剩余游戏时间、游戏金币、游戏物品；删除该游戏的注册信息、角色信息等一切相关信息）。\n3. 为了保障游戏和服务器的正常运行，我方需要定期或不定期对游戏及服务器进行停机维护，或针对突发事件进行紧急停机维护。因上述情况而造成的正常服务中断、中止，用户予以理解并同意，我方则有义务尽力避免服务中断并将中断时间限制在最短时间内。\n4. 发生下列情形之一时，我方有权不经提前通知，终止或中断游戏服务器所提供之全部或部分服务，对因此而产生的不便或损失，我方对用户或第三人均不承担任何责任：\n（1）定期检查或施工，更新软硬件等；\n（2）服务器遭受损害，无法正常运作；\n（3）突发性的软硬件设备与电子通信设备故障；\n（4）网络提供商线路或其他故障；\n（5）在紧急情况之下依照法律的规定或为用户及第三者之人身安全；\n（6）第三方原因或其他不可抗力的情形。\n5. 不管本游戏由于任何原因终止，用户应游戏公告或通知的时间内采取相应的措施处理游戏及游戏平台上的虚拟物品。用户不得因终止服务而要求我方承担除用户已经购买但尚未使用的游戏虚拟货币以外任何形式的赔偿或补偿责任，包括但不限于因不再能继续使用游戏帐号、游戏内虚拟物品等而要求的赔偿；未在公告或通知的时间内对虚拟物品进行处理的，我方将清除相关记录，不再接受虚拟物品处理请求，用户应自行承担虚拟物品处理不及时造成的损失。\n\n十二、有限保证及免责声明\n\n1. 对于本游戏服务，我方仅作本条所述有限保证，该有限保证取代任何文档、包装、或其他资料中的任何其他明示或默示的保证（若有）。\n2.  如有系统故障、安全漏洞（Security Vulnerability）、程序缺陷（Bug）、程序出错等问题，我方有权把游戏的资料还原到一定日期，以维护游戏之平衡。用户不得因此要求补偿或赔偿。\n3. 在适用法律允许的最大范围内，我方对用户因使用我方的游戏服务引起的任何间接、偶然、意外、特殊或继起的损害（包括但不限于人身伤害、隐私泄漏、因未能履行包括诚信或合理谨慎在内的任何责任、因过失和因任何其他金钱上的损失或其他损失而造成的损害赔偿）不负责任，这些损害可能来自：用户或他人不正当使用本游戏服务、在网上购买商品或类似服务、在网上进行交易、非法使用服务或用户传送的信息有所变动。\n",g_terms_20122_5:"4. 我方对本协议项下涉及的境内外基础电信运营商的固定及移动通信网络的故障，各类技术缺陷、覆盖范围限制、不可抗力、计算机病毒、黑客攻击、用户所在位置、用户关机、合作方因素、他人故意或过失行为或其他非我方技术能力范围内的原因造成的服务中断、用户发送的数据或短信息的内容丢失、出现乱码、错误接收、无法接收、迟延接收等，均不承担责任。\n5. 由于用户个人失误、错误或不当操作导致的任何后果，由用户自行承担责任，我方不予任何赔偿或补偿。\n6.游戏不保证各系统不存在任何漏洞，不保证各系统能随时正常运作。当系统漏洞导致用户的权益受损时，我方有义务采取补救措施，用户不得依此为由要求我方赔偿或补偿。\n\n十三、如何联系我们\n\n（1）如您对本协议或游戏相关的事宜有任何问题（包括问题咨询、投诉等），我们专门为您提供了多种反馈通道，希望为您提供满意的解决方案：\n在线客服/其他在线意见反馈通道：您可与我们游戏内显示的在线客服联系或者在线提交意见反馈\n客服电话：020-84781291\n\n十四、其他约定\n\n1. 本协议的订立、效力、解释、履行及争议解决适用中华人民共和国法律。如果本协议的任何内容与法律相抵触，应以法律规定为准。\n2. 本协议的任何条款部分或全部无效的，不影响其它条款的效力。\n3. 就本协议产生的争议及纠纷，用户与我方应友好协商解决。如出现纠纷，协商不成的，您和我们一致同意将纠纷交由广州市番禺区所在地有管辖权人民法院管辖。",g_terms_20122_6:"《隐私政策》",g_terms_20122_7:"\n我们非常重视用户的隐私和个人信息保护。您在使用我们的产品与/或服务时，我们可能会收集和使用您的相关信息。我们希望通过《隐私政策》（以下简称“本政策”）向您说明我们在收集和使用您相关个人信息时对应的处理规则等相关事宜，以便更好地保障您的权益。\n\n在使用我们的各项服务前，请您务必仔细阅读并透彻理解本政策，特别是以粗体/红色字体标识的条款，您应重点阅读，在确认充分理解并同意后再开始使用。如果您不同意本政策的内容，将可能导致我们的产品和服务无法正常运行，或者无法达到我们拟达到的服务效果，您应立即停止访问/使用我们的产品与/或服务。若您阅读并点击同意本隐私政策，即表示您同意我们按本政策所述目的和方式来收集、使用、储存、分享、转让和公开披露您的个人信息。\n\n请注意，本游戏可能适时对本协议进行修改与更新，您同意将随时留意查看本协议的最新版本。请在使用我们的产品（或服务）前，仔细阅读并了解本《隐私政策》，以确保对本《隐私政策》的最新版本始终保持了解。\n版本更新时间：2020年7月1日\n\n如果您有任何疑问、意见或建议，请通过以下联系方式与我们联系：\n客服：020-84781291\n地址：广州市番禺区青蓝街道小谷围街28号\n本政策将帮助您了解以下内容：\n一、我们如何收集和使用您的个人信息\n二、我们如何使用Cookie及同类技术\n三、我们如何共享、转让、公开披露您的个人信息\n四、我们如何保护您的个人信息\n五、您的权利\n六、我们如何处理未成年人的个人信息\n七、本政策可能变更\n八、如何联系我们\n\n一、我们如何收集和使用您的个人信息\n我们收集您提供给我们的部分或全部信息，以及您使用网站和应用程序的数据，主要是为了提高您和其他用户您的使用体验。\n\n（一）您须授权我们收集和使用您个人信息的情形\n我们的产品与/或服务包括一些核心功能，这些功能包含了享受网络游戏服务所必须的功能及保障交易安全所必须的功能。我们可能会收集、保存和使用下列与您有关的信息才能实现上述这些功能。如果您不提供相关信息，您将无法享受我们提供的产品与/或服务。这些信息包括：\n\n  1、帮助您注册账户和登录所需要的信息\n当您使用账号注册功能时，您需要按照我们的指引完成一系列注册程序，在您成为注册用户后，我们将为您提供专属于注册用户的产品与/或服务。在此过程中，您需要提供给我们一些单独或者结合识别您的用户身份的信息，包括：手机号码、验证码匹配结果，并创建您的帐号、用户名和密码。我们收集这些信息是用以完成注册程序、为您持续稳定提供服务，并保护您的账号安全。您应知悉，手机号码和验证码匹配结果属于您的个人敏感信息，我们收集该类信息是为了满足相关法律法规的要求，如您拒绝提供可能导致您无法使用我们的此功能，请您谨慎考虑后再提供。\n需要说明的是，如您使用第三方平台的账号登录的，我们将根据您的授权获取该第三方账号下的相关信息（包括：昵称、头像，具体以您的授权内容为准）以及身份验证信息（个人敏感信息）。我们收集这些信息是用于为您提供账号登录服务以及保障您的账号安全，防范安全风险。如您拒绝授权此类信息的，您将无法使用第三方平台的账号登录我们平台，但不影响我们为您提供的其他产品和服务的正常使用。您知悉并同意，对于您在使用产品与/或服务的过程中提供的您的一种或多种联系方式（例如：电子邮箱、联系电话、传真号码、联系地址），我们在运营中可能会向其中的一种或多种发送多类通知，用于用户消息告知、身份验证、安全验证等用途；此外，我们也可能会将在前述过程中收集的手机号码、电子邮箱通过短信、电话、邮件的方式用作向您提供您可能感兴趣的活动等商业性信息的用途，但请您放心，如您不愿接受该商业性信息，您可以通过手机短信、电子邮件中提供的退订方式进行退订，也可以直接与我们联系进行退订。\n\n  2、玩家使用游戏过程中需要收集的信息\n在您使用极致游戏服务时，我们会收集您的游戏日志信息，包括登录日志、物品日志、充值日志、绑定信息变更日志、虚拟币变更日志等，以便您能够查看您的游戏历史记录，同时用于游戏运营统计分析、客服投诉处理及其他游戏安全分析。为了提升您的游戏体验。\n\n  3、实现游戏正常运行所需要的信息\n为了保障您能正常使用我们的服务、维护游戏基础功能的正常运行、对游戏产品性能进行优化，提升您的游戏体验并保障您的账号安全，我们会收集您的IP地址、设备ID、设备型号、操作系统类型、操作系统及版本、设备MAC地址、软件列表唯一设备识别码（如IMEI/androidID/IDFA/IDFV等在内的描述个人常用设备基本情况的信息）、网络类型、设备语言等信息。\n\n  4、支付结算。\n为便于您在支付相关订单时，综合判断您账户及交易风险、进行身份验证、检测及防范安全事件。我们会收集您的充值记录、消费记录等信息。充值记录、消费记录属于敏感信息，出于实现游戏产品的消费功能，必须收集上述信息，否则无法完成充值。\n\n  5、安全保障\n我们会将您的部分个人常用设备信息用于身份验证、安全防范、诈骗监测、存档备份等用途。例如，唯一设备码用于安全防范、用户标识，个人上网记录用于安全防范、诈骗监测。\n当您使用我们的客户服务时，我们可能会保存您的通信/通话记录和内容或您留下的联系方式等信息，以便与您联系或帮助您解决问题，或记录相关问题的处理方案及结果。\n\n  6、为维护健康网络环境所需要收集的信息\n当您在游戏中以文字、图片、语音、视频及其他方式与其他玩家进行互动时，我们可能会收集并保存您发送的上述信息内容用于过滤色情、暴力、政治、辱骂、恶意广告等不当内容，以净化游戏环境，维护健康的上网环境。\n\n",g_terms_20122_8:"7、有关个人敏感信息的提示\n以上由您提供或我们收集您的信息中，可能包含您的个人敏感信息，例如银行账号、交易和消费记录、虚拟财产信息、系统帐号、邮箱地址及其有关的密码、电话号码、网页浏览记录、位置信息。请您谨慎并留意个人敏感信息，您同意您的个人敏感信息我们可以按本政策所述的目的和方式来处理。\n\n二、我们如何使用Cookie和同类技术\n（一）我们或我们的第三方合作伙伴（如有）可能通过Cookies、日志文件（log files）、网络信标（web beacons）、或其他同类追踪技术获取和使用您的信息，这些信息将可能被存储为日志信息。\n（二）我们使用的Cookies或同类技术，可能用于以下用途：\n（1）记住您的身份：我们使用Cookies或同类技术，能帮助更快捷便利的辨认您的注册用户的身份，或保存您向我们提供有关您的喜好或其他信助于我们辨认您作为我们的注册用户的身份等\n（2）分析您的服务使用情况。我们使用Cookies或同类技术，能帮助我们分析您的服务使用内容以及习惯偏好；\n（3）广告的优化处理。我们使用Cookies或同类技术，能帮助我们根据您的偏好和习惯，提供您可能感兴趣的广告推送。\n（三）我们不会将Cookie用于本政策所述目的之外的任何用途。\n（四）如您不希望使用Cookies或同类技术，或不希望我们能通过Cookies或同类技术获取和使用您的信息，您可根据自己的偏好通过浏览器或其他方式设置管理或删除Cookie或同类技术。一旦您禁止或拒绝使用Cookies或同类技术，可能因此影响您使用产品及服务的体验，我们有可能无法为您提供符合您使用偏好和特性的服务内容。\n\n三、我们可能分享、转让和公开披露个人信息的情形\n\n（一）分享\n\n1、一般情况，我们不会与本游戏之外的任何第三方分享您的个人信息，但以下情况除外：\n（1）事先获得您明确的同意或授权；\n（2）根据适用的法律法规、法律程序的要求、强制性的行政或司法要求所必须的情况下进行提供；\n（3）在法律法规允许的范围内，为维护关联方或合作伙伴、您或其他玩家或社会公众利益、财产或安全免遭损害而有必要提供；\n（4）只有共享您的个人信息，才能实现我们的产品与/或服务的核心功能或提供您需要的服务；\n（5）应您需求为您处理您与他人的纠纷或争议；\n（6）符合与您签署的相关协议（包括在线签署的电子协议以及相应的平台规则）或其他的法律文件约定所提供；\n（7）基于学术研究而使用；\n（8）基于符合法律法规的社会公共利益而使用。\n2、我们可能会将您的个人信息与我们的关联方共享。但我们只会共享必要的个人信息，且受本隐私政策中所声明目的的约束。我们的关联方如要改变个人信息的处理目的，将再次征求您的授权同意。\n3、我们可能会向合作伙伴等第三方共享您的订单信息、账户信息、设备信息以及位置信息，以保障为您提供的服务顺利完成。但我们仅会出于合法、正当、必要、特定、明确的目的共享您的个人信息，并且只会共享提供服务所必要的个人信息。我们的合作伙伴无权将共享的个人信息用于任何其他用途。\n4、履行我们在本《隐私政策》或我们与您达成的其他协议中的义务和行使我们的权利。\n\n（二）转让\n\n我们不会将您的个人信息转让给任何公司、组织和个人，但以下情况除外：\n1、在获取明确同意的情况下转让：获得您的明确同意后，我们会向其他方转让您的个人信息；\n2、在涉及合并、收购或破产清算时，如涉及到个人信息转让，我们将通过推送通知、公告或其他方式另行告知您相关情形，按照法律法规所要求的标准继续保护或要求新的管理者按照本政策继续保护您的个人信息。\n3、部分场景下，您可以使用相同的账号及密码在其他第三方平台登录、使用，以获得更好的游戏体验。为提供此项服务，我们可能需要向第三方传送您的个人信息及游戏信息，我们将按照法律法规所要求的标准继续保护或要求新的管理者按照本政策继续保护您的个人信息。\n\n（三）公开披露\n\n我们仅会在以下情况下，公开披露您的个人信息：\n1、获得您明确同意后；\n2、与国家安全、国防安全有关的；\n3、与公共安全、公共卫生、重大公共利益有关的；\n4、与犯罪侦查、起诉、审判和判决执行等有关的；\n5、出于维护信息主体或其他个人的生命、财产等重大合法权益但又很难得到您本人同意的；\n6、所收集的信息是您自行向社会公众公开的；\n7、从合法公开披露的信息中收集信息的，如合法的新闻报道、政府信息公开等渠道；\n8、根据您的要求签订合同所必需的；\n9、用于维护本游戏服务的安全稳定运行所必需的，例如发现、处置产品或服务的故障；\n10、为合法的新闻报道所必需的；\n11、学术研究机构基于公共利益开展统计或学术研究所必要，且对外提供学术研究或描述的结果时，对结果中所包含的信息进行去标识化处理的；\n12、法律法规规定的其他情形。\n\n四、我们如何储存和保护个人信息\n\n我们仅在本政策所述目的所必需期间和法律法规要求的最短时限内储存您的个人信息。如我们终止服务或运营，我们将及时停止继续收集您个人信息的活动，同时会遵守相关法律法规要求提前向您通知，并在终止服务或运营后对您的个人信息进行删除或匿名化处理，但法律法规或监管部门另有规定的除外。\n（一）信息的储存\n1、信息存储的方式和期限\n我们会通过安全的方式存储您的信息，包括本地存储、数据库等。\n一般情况下，我们只会在为实现服务目的所必需的时间内或法律法规规定的条件下存储您的个人信息。\n2、信息存储的地域\n我们会依据法律法规的规定，将中华人民共和国境内（以下简称“中国”）收集和/或产生的用户个人信息存储于中国境内，但以下情形除外\n",g_terms_20122_9:"（1）法律法规有明确规定；\n（2）获得您的授权同意；\n（3）您使用的产品、服务涉及跨境，需要向境外提供您的个人信息的。\n3、产品或服务停止运营时的通知\n当我们的产品或服务发生停止运营的情况时，我们将根据相关法律法规规定进行公告通知，并依法保障您的合法权益。\n（二）信息的保护\n1、我们将采用严格的安全制度以及行业通行的安全技术和程序来确保您的个人信息不丢失、泄露、毁损或被未经授权的访问、使用。\n2、用户个人信息被加密储存在服务器中，并通过数据隔离技术进行存储。\n3、与全体员工及服务外包人员签署保密协议，并严格按照工作职责分配数据访问权限。如果未能履行这些协议内容或义务，可能会被追究法律责任或被中止与我们的合作关系。\n4、我们会举办安全和隐私保护培训课程，加强员工对于保护个人信息重要性的认识。\n\n五、您的权利\n\n本游戏会尽力维护个人信息的准确和完整，并及时进行更新，前提是您应确保提交的所有个人信息都准确无误。\n\n1、个人信息的访问、更新和删除；\n\n1、访问您的个人信息\n（1）您有权访问您的个人信息，法律法规规定的例外情况除外。您可以通过以下方式自行访问您的个人信息：\n账户信息—如果您希望访问或编辑您的账户中的个人基本资料信息，您可以通过登录您的账号执行此类操作。\n清除数据—您可以登录账号通过浏览器或设备软件应用的“设置”下的清除数据以及输入记录、Cookies、账号密码、历史记录和缓存文件。\n（2）如果您无法通过上述路径访问该等个人信息，您可以随时通过我们客服与我们取得联系。我们将在15个工作日内回复您的访问请求。\n2、更正或补充您的个人信息\n当您发现我们处理的关于您的个人信息有错误时，您有权要求我们做出更正或补充。您可以通过上述第1条中列明的方式提出更正或补充申请。\n3、删除您的个人信息\n（1）您可以通过上述第1条中列明的方式删除您的部分个人信息。\n（2）在符合下述第三条【联系与咨询】条件中，您可以联系我们的客服进行删除您的绑定信息（如手机、实名认证）等\n\n2、您可以选择是否披露信息\n\n有些信息是使用本公司服务所必需的，但大多数其他信息的提供决定权由您掌握。您可以通过删除信息、关闭设备功能等方式改变您授权我们继续收集信息的范围或撤回您的授权。\n\n3、联系与咨询\n\n在访问、更正、更新、改变和删除前述信息时，我们可能会要求您进行身份验证，以保障信息安全。如您需要，您可以通过联系客服。我们会在合理的期限内答复您的请求。同时请您理解，由于技术所限、法律或监管要求，如果我们有合理依据认为这些请求存在欺骗性、无法实行或损害他人隐私权，我们则会拒绝处理请求。\n\n4、授权的撤销\n\n当适用的法律要求的情况下，或极致游戏基于您的同意处理您的个人信息时，您还有权随时撤销您的同意。但撤销同意不会影响撤销前我们基于您的同意处理您个人信息的合法性及效力，也不影响我们基于其他适当的正当性基础处理您的个人信息。\n\n六、我们如何处理未成年人的个人信息\n\n我们的产品、网站和服务主要面向成人。本游戏遵从国家政策，如果没有父母或监护人的同意，未成年人不得创建自己的用户账户。对于经父母或监护人同意而收集未成年人个人信息的情况，我们只会在受到法律的允许、父母或监护人明确同意或者保护未成年人所必要的情况下使用或公开披露此信息。\n我们倡导，任何未成年人参加网上活动应事先取得父母或其他监护人（以下简称监护人）的同意。\n\n七、通知与变更\n\n为了给您提供良好的用户体验，我们可能会适时对本隐私政策进行修订。当本隐私政策的条款发生变更时，我们将在本政策生效前以公告、推送通知或其他适当的方式向您提示变更后的隐私政策。请您仔细阅读变更后的本隐私政策，您继续使用我们的服务表示您同意我们按照更新后的隐私政策收集、处理或使用您的个人信息。\n\n八、如何联系我们\n如您有关于网络信息安全的投诉和举报，或您对本政策的隐私措施、您的信息的相关事宜有任何问题、意见或建议，请您及时与我方联系，客服电话：020-84781291。\n本协议条款的生效、履行、解释及争议的解决均适用中华人民共和国法律，如出现纠纷，您和我们一致同意将纠纷交由广州市番禺区人民法院管辖。本协议条款因与中华人民共和国现行法律相抵触而导致部分无效，不影响其他部分的效力。"};var ActorExRing2Config=function(){function ActorExRing2Config(){this.level=0;this.costItem=0;this.cost=0;this.upPower=0;this.addPower=0;this.bjRate=0;this.bjAddPower=0;this.attrAward=[];this.extAttrAward=[];this.judgeup=0;this.SpecialRingSkin=""}return ActorExRing2Config}();__reflect(ActorExRing2Config.prototype,"ActorExRing2Config");var ActorExRing3Config=function(){function ActorExRing3Config(){this.level=0;this.costItem=0;this.cost=0;this.upPower=0;this.addPower=0;this.bjRate=0;this.bjAddPower=0;this.attrAward=[];this.extAttrAward=[];this.judgeup=0;this.SpecialRingSkin=""}return ActorExRing3Config}();__reflect(ActorExRing3Config.prototype,"ActorExRing3Config");var ActorExRing4Config=function(){function ActorExRing4Config(){this.level=0;this.costItem=0;this.cost=0;this.upPower=0;this.addPower=0;this.bjRate=0;this.bjAddPower=0;this.attrAward=[];this.extAttrAward=[];this.judgeup=0;this.SpecialRingSkin=""}return ActorExRing4Config}();__reflect(ActorExRing4Config.prototype,"ActorExRing4Config");var ActorExRing5Config=function(){function ActorExRing5Config(){this.level=0;this.costItem=0;this.cost=0;this.upPower=0;this.addPower=0;this.bjRate=0;this.bjAddPower=0;this.attrAward=[];this.extAttrAward=[];this.judgeup=0;this.SpecialRingSkin=""}return ActorExRing5Config}();__reflect(ActorExRing5Config.prototype,"ActorExRing5Config");var ActorExRing6Config=function(){function ActorExRing6Config(){this.level=0;this.costItem=0;this.cost=0;this.upPower=0;this.addPower=0;this.bjRate=0;this.bjAddPower=0;this.attrAward=[];this.extAttrAward=[];this.judgeup=0;this.SpecialRingSkin=""}return ActorExRing6Config}();__reflect(ActorExRing6Config.prototype,"ActorExRing6Config");var ActorExRing7Config=function(){function ActorExRing7Config(){this.level=0;this.costItem=0;this.cost=0;this.upPower=0;this.addPower=0;this.bjRate=0;this.bjAddPower=0;this.attrAward=[];this.extAttrAward=[];this.judgeup=0;this.SpecialRingSkin="";this.summonerSkillId=0;this.summonerAttr=[]}return ActorExRing7Config}();__reflect(ActorExRing7Config.prototype,"ActorExRing7Config");var ActorExRingAbilityConfig=function(){function ActorExRingAbilityConfig(){this.id=0;this.ringLv=0;this.abilityName="";this.abilityDesc="";this.abilityIcon=""}return ActorExRingAbilityConfig}();__reflect(ActorExRingAbilityConfig.prototype,"ActorExRingAbilityConfig");var ActorExRingBookConfig=function(){function ActorExRingBookConfig(){this.id=0;this.level=0;this.itemId=0;this.num=0;this.attr=[];this.bookAttrPer=[];this.skillName="";this.skillDesc="";this.skillIcon="";this.exPower=0}return ActorExRingBookConfig}();__reflect(ActorExRingBookConfig.prototype,"ActorExRingBookConfig");var ActorExRingCommon=function(){function ActorExRingCommon(){this.MaxOutNum=[];this.actImbaId=0}return ActorExRingCommon}();__reflect(ActorExRingCommon.prototype,"ActorExRingCommon");var ActorExRingConfig=function(){function ActorExRingConfig(){this.id=0;this.openLv=0;this.openVip=0;this.openYb=0;this.name="";this.effid=0;this.explain="";this.mtCombat=0;this.needLevel=0;this.needZs=0;this.monsterId=0;this.order=0;this.icon="";this.avatarFileName=0;this.wexplain="";this.useYb=0;this.skillGridYb=0}return ActorExRingConfig}();__reflect(ActorExRingConfig.prototype,"ActorExRingConfig");var ActorExRingItemConfig=function(){function ActorExRingItemConfig(){}return ActorExRingItemConfig}();__reflect(ActorExRingItemConfig.prototype,"ActorExRingItemConfig");var AdRewardConfig=function(){function AdRewardConfig(){}return AdRewardConfig}();__reflect(AdRewardConfig.prototype,"AdRewardConfig");var AdvanceTitleBaseconfig=function(){function AdvanceTitleBaseconfig(){}return AdvanceTitleBaseconfig}();__reflect(AdvanceTitleBaseconfig.prototype,"AdvanceTitleBaseconfig");var AfterLoginInvestConfig=function(){function AfterLoginInvestConfig(){}return AfterLoginInvestConfig}();__reflect(AfterLoginInvestConfig.prototype,"AfterLoginInvestConfig");var AllWorldConfig=function(){function AllWorldConfig(){}return AllWorldConfig}();__reflect(AllWorldConfig.prototype,"AllWorldConfig");var ArtifactsRankConfig=function(){function ArtifactsRankConfig(){}return ArtifactsRankConfig}();__reflect(ArtifactsRankConfig.prototype,"ArtifactsRankConfig");var AttrPowerConfig=function(){function AttrPowerConfig(){}return AttrPowerConfig}();__reflect(AttrPowerConfig.prototype,"AttrPowerConfig");var AuctionConfig=function(){function AuctionConfig(){}return AuctionConfig}();__reflect(AuctionConfig.prototype,"AuctionConfig");var AuctionItem=function(){function AuctionItem(){}return AuctionItem}();__reflect(AuctionItem.prototype,"AuctionItem");var BagBaseConfig=function(){function BagBaseConfig(){}return BagBaseConfig}();__reflect(BagBaseConfig.prototype,"BagBaseConfig");var BagExpandConfig=function(){function BagExpandConfig(){}return BagExpandConfig}();__reflect(BagExpandConfig.prototype,"BagExpandConfig");var BaoZangBaseConfig=function(){function BaoZangBaseConfig(){}return BaoZangBaseConfig}();__reflect(BaoZangBaseConfig.prototype,"BaoZangBaseConfig");var BaoZangChapterConfig=function(){function BaoZangChapterConfig(){}return BaoZangChapterConfig}();__reflect(BaoZangChapterConfig.prototype,"BaoZangChapterConfig");var BaoZangChapterFuliConfig=function(){function BaoZangChapterFuliConfig(){}return BaoZangChapterFuliConfig}();__reflect(BaoZangChapterFuliConfig.prototype,"BaoZangChapterFuliConfig");var BaoZangFuwentaConfig=function(){function BaoZangFuwentaConfig(){}return BaoZangFuwentaConfig}();__reflect(BaoZangFuwentaConfig.prototype,"BaoZangFuwentaConfig");var BaoZangFuwentaFuliConfig=function(){function BaoZangFuwentaFuliConfig(){}return BaoZangFuwentaFuliConfig}();__reflect(BaoZangFuwentaFuliConfig.prototype,"BaoZangFuwentaFuliConfig");var BattleGroundConfig=function(){function BattleGroundConfig(){}return BattleGroundConfig}();__reflect(BattleGroundConfig.prototype,"BattleGroundConfig");var BigExpressionConf=function(){function BigExpressionConf(){}return BigExpressionConf}();__reflect(BigExpressionConf.prototype,"BigExpressionConf");var BonusConfig=function(){function BonusConfig(){this.isOpen=0}return BonusConfig}();__reflect(BonusConfig.prototype,"BonusConfig");var BookListConfig=function(){function BookListConfig(){}return BookListConfig}();__reflect(BookListConfig.prototype,"BookListConfig");var BossHomeBaseConfig=function(){function BossHomeBaseConfig(){this.id=0;this.dpsRankReward=[]}return BossHomeBaseConfig}();__reflect(BossHomeBaseConfig.prototype,"BossHomeBaseConfig");var BossHomeConfig=function(){function BossHomeConfig(){this.id=0;this.vip=0;this.boss=[];this.icon=[]}return BossHomeConfig}();__reflect(BossHomeConfig.prototype,"BossHomeConfig");var BubbleConfig=function(){function BubbleConfig(){this.bubbleid=0;this.news="";this.type=0}return BubbleConfig}();__reflect(BubbleConfig.prototype,"BubbleConfig");var CampBattleConfig=function(){function CampBattleConfig(){}return CampBattleConfig}();__reflect(CampBattleConfig.prototype,"CampBattleConfig");var CampBattlePersonalAwardConfig=function(){function CampBattlePersonalAwardConfig(){}return CampBattlePersonalAwardConfig}();__reflect(CampBattlePersonalAwardConfig.prototype,"CampBattlePersonalAwardConfig");var CampBattlePersonalRankAwardConfig=function(){function CampBattlePersonalRankAwardConfig(){}return CampBattlePersonalRankAwardConfig}();__reflect(CampBattlePersonalRankAwardConfig.prototype,"CampBattlePersonalRankAwardConfig");var CardConfig=function(){function CardConfig(){}return CardConfig}();__reflect(CardConfig.prototype,"CardConfig");var ChapterHardBaseConfig=function(){function ChapterHardBaseConfig(){}return ChapterHardBaseConfig}();__reflect(ChapterHardBaseConfig.prototype,"ChapterHardBaseConfig");var ChapterHardConfig=function(){function ChapterHardConfig(){}return ChapterHardConfig}();__reflect(ChapterHardConfig.prototype,"ChapterHardConfig");var Main=function(_super){__extends(Main,_super);function Main(){var _this=_super.call(this)||this;_this.i18nOK=false;_this.configOK=false;_this.g=[];_this.touchEnabled=false;if(!window["isSmallGame"]){fixIOSKeyboardBugs()}var oldConsoleLog=console.log;AutoTestMgr.ins().regEventListeners();LoginMgr.ins();ChannelMgr.ins().getChannel(function(){});Recharge.ins().getPlatformID(function(platID){if(platID==Recharge.platIds["as"]){if(ChannelMgr.ins().isYaoShengChannel()){ChannelMgr.ins().extractChannels("10035,1,104")}else{ChannelMgr.ins().extractChannels("20102,1,104")}}});function dotCur(){var uuid=GetPhone_UUID();GetLoginName();var channel=window["GetChannel"]()||"0_1";var c=channel.split("_");AppDotUp.Ins().PostAppDot("4",c[0],c[1],UUID,"",LoginName,"","","","",DeviceUtils.deviceOS)}if(window["isIOS_AppStore"]==true){var il_1=setInterval(function(){var uuid=GetPhone_UUID();if(uuid!=null&&uuid!=""){dotCur();clearInterval(il_1)}},100)}else{dotCur()}_this.addEventListener(egret.Event.ADDED_TO_STAGE,_this._onAddToStage,_this);window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["MainConstructor",Date.now()]);StageUtils.ins().getStage().addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){setTimeout(function(){document.body.scrollTop=document.body.scrollHeight},300)},_this);if(window["isIOS_AppStore"]==true){StageUtils.ins().getStage().frameRate=30}return _this}Main.prototype._onAddToStage=function(event){window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["Main_onAddToStage",Date.now()]);this.removeEventListener(egret.Event.ADDED_TO_STAGE,this._onAddToStage,this);this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter);this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter);if(window["isIOS_AppStore"]==true){RES.setMaxLoadingThread(16);RES.setMaxRetryTimes(6)}else{RES.setMaxLoadingThread(4)}if(window["isIOS_AppStore"]==true){StageUtils.ins().setScaleMode(egret.StageScaleMode.EXACT_FIT);StageUtils.ins().getStage().orientation=egret.OrientationMode.PORTRAIT}else{if(DeviceUtils.IsPC){StageUtils.ins().setScaleMode(egret.StageScaleMode.SHOW_ALL);StageUtils.ins().getStage().orientation=egret.OrientationMode.AUTO}if(navigator.userAgent.indexOf("iPad")!=-1){StageUtils.ins().getStage().orientation=egret.OrientationMode.AUTO}}SoundManager.ins().setEffectOn(SysSetting.ins().getBool(SysSetting.SOUND_EFFECT));LocationProperty.init();FixUtil.fixAll();LoadingTimeoutMgr.ins().beginStep(LoadingTimeoutMgr.STEPID_LOAD_RESOURCE);egret.ImageLoader.crossOrigin="anonymous";ResVersionManager.ins().loadConfig(this.loadResVersionComplete,this);LocationProperty.setLoadProgress(80,"Loading...")};Main.prototype.loadResVersionComplete=function(){var _this=this;window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["Main_loadResVersionComplete",Date.now()]);LocationProperty.setLoadProgress(80,"Loading texts...");var lang=window["wlmzlang"]||"";RES.getResByUrl("resource/i18n/i18n"+lang+".json",function(data){i18nMap=data;_this.onI18NComplete()},this);ResourceUtils.ins().addConfig(RES_RESOURCE+"default.res.json",""+RES_RESOURCE);ResourceUtils.ins().loadConfig(this.onConfigComplete,this)};Main.prototype.onI18NComplete=function(){this.i18nOK=true;this.checkLoadTheme()};Main.prototype.onConfigComplete=function(){this.configOK=true;this.checkLoadTheme()};Main.prototype.checkLoadTheme=function(){if(this.i18nOK&&this.configOK){this.loadTheme()}};Main.prototype.loadTheme=function(){LoginMgr.ins().checkEnv();LoginMgr.ins().getSession();window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["Main_onConfigComplete",Date.now()]);LocationProperty.setLoadProgress(81,i18n("Main_1"));var self=this;setTimeout(function(){LocationProperty.setLoadProgress(82,i18n("Main_2"));var theme=new eui.Theme(RES_RESOURCE+"default.thm.json",self.stage);theme.addEventListener(eui.UIEvent.COMPLETE,self.onThemeLoadComplete,self)},1)};Main.prototype.onThemeLoadComplete=function(){window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["Main_onThemeLoadComplete",Date.now()]);LocationProperty.setLoadProgress(84,i18n("Main_3"));if(ResVersionManager.ins().resrepOn){ResourceUtils.ins().loadGroup("resrep",this.completeResRep,this.progressResRep,this)}else{this.loadRes()}};Main.prototype.progressResRep=function(){};Main.prototype.completeResRep=function(){var resrepStr=RES.getRes("resrep_txt");if(resrepStr.indexOf("\r\n")>=0){console.error("i18n/resrep.txt检测到\\r\\n；应该用\\n作为换行符！")}var lines=resrepStr.split("\n");var resrep={};for(var _i=0,lines_1=lines;_i<lines_1.length;_i++){var line=lines_1[_i];if(line!=null&&line!=""){resrep[line]=true}}ResVersionManager.ins().resrep=resrep;this.loadRes()};Main.prototype.loadRes=function(){if(LocationProperty.isFirstLoad){ResourceUtils.ins().loadGroup("firstLoad",this.complete,this.progress,this)}else{if(ChannelMgr.ins().isWXSmallGameChannel()){var lang=window["wlmzlang"]||"";this.g=["realpreload"];for(var i=0;i<10;i++){this.g.push("config"+lang+i)}ResourceUtils.ins().loadGroups("wxgameJson",[this.g[0]],this.complete2,this.progress2,this)}else{var lang=window["wlmzlang"]||"";ResourceUtils.ins().loadGroups("realpreload2",["realpreload","config"+lang],this.complete,this.progress,this)}}};Main.prototype.progress2=function(itemsLoaded,itemsTotal){var p=itemsLoaded/itemsTotal;if(this.g.length==0){LocationProperty.setLoadProgress(100,i18n("Main_5"))}else{LocationProperty.setLoadProgress(84+(100-84)*Math.min(1,(10-this.g.length)/10*p),i18n("Main_4"))}};Main.prototype.complete2=function(){if(this.g.length>0){this.g.splice(0,1)}if(this.g.length>0){ResourceUtils.ins().loadGroups(this.g[0],[this.g[0]],this.complete2,this.progress2,this)}else{this.complete()}};Main.prototype.progress=function(itemsLoaded,itemsTotal){if(window["isSmallGame"]){var p=itemsLoaded/itemsTotal;if(p>.75){LocationProperty.setLoadProgress(100,i18n("Main_5"))}else{LocationProperty.setLoadProgress(84+(100-84)*(itemsLoaded/itemsTotal),i18n("Main_4"))}}else{LocationProperty.setLoadProgress(84+(88-84)*(itemsLoaded/itemsTotal),i18n("Main_4"))}};Main.prototype.complete=function(){LoadingTimeoutMgr.ins().endStep(LoadingTimeoutMgr.STEPID_LOAD_RESOURCE);if(!window["isSmallGame"]){LocationProperty.setLoadProgress(90,i18n("Main_5"))}var channel=window["GetChannel"]()||"0_1";var c=channel.split("_");AppDotUp.Ins().PostAppDot("5",c[0],c[1],UUID,"",LoginName,"","","","",DeviceUtils.deviceOS);window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["Main_groupResComplete",Date.now()]);window["gameLoaded"]=true;var self=this;setTimeout(function(){self.startGame()},200)};Main.prototype.startGame=function(){ViewManager.ins().reg(LoginWin,this);ViewManager.ins().reg(ModifyPwdWin,this);ViewManager.ins().reg(ConnectingWin,this);ViewManager.ins().reg(LoginFailedWin,this);ViewManager.ins().reg(RegisterWin,this);ViewManager.ins().reg(StartGameWin,this);ViewManager.ins().reg(NoticeWin,this);ViewManager.ins().reg(SelectServerWin,this);ViewManager.ins().reg(SaveNewCountWin,this);ViewManager.ins().reg(SubmitIDWin,this);ViewManager.ins().reg(DisplayPolicyWin,this);LoginMgr.onResLoaded();SoundUtil.ins().addActivateListenter(this.stage)};Main.closesocket=function(){GameSocket.ins().close()};Main.reposUI=function(v){};return Main}(eui.UILayer);__reflect(Main.prototype,"Main");window["lauchLogs"]=window["lauchLogs"]||[];window["lauchLogs"].push(["loadScript",Date.now()]);var ChaptersGiftConfig=function(){function ChaptersGiftConfig(){}return ChaptersGiftConfig}();__reflect(ChaptersGiftConfig.prototype,"ChaptersGiftConfig");var ChaptersRewardConfig=function(){function ChaptersRewardConfig(){}return ChaptersRewardConfig}();__reflect(ChaptersRewardConfig.prototype,"ChaptersRewardConfig");var ChongZhiBaseConfig=function(){function ChongZhiBaseConfig(){}return ChongZhiBaseConfig}();__reflect(ChongZhiBaseConfig.prototype,"ChongZhiBaseConfig");var ChongZhiConfig=function(){function ChongZhiConfig(){}return ChongZhiConfig}();__reflect(ChongZhiConfig.prototype,"ChongZhiConfig");var ClientGlobalConfig=function(){function ClientGlobalConfig(){}return ClientGlobalConfig}();__reflect(ClientGlobalConfig.prototype,"ClientGlobalConfig");var KfArenaPeakAwards=function(){function KfArenaPeakAwards(){}return KfArenaPeakAwards}();__reflect(KfArenaPeakAwards.prototype,"KfArenaPeakAwards");var KfArenaEveryDayAwards=function(){function KfArenaEveryDayAwards(){}return KfArenaEveryDayAwards}();__reflect(KfArenaEveryDayAwards.prototype,"KfArenaEveryDayAwards");var KfArenaFinalAwards=function(){function KfArenaFinalAwards(){}return KfArenaFinalAwards}();__reflect(KfArenaFinalAwards.prototype,"KfArenaFinalAwards");var KfArenaMailData=function(){function KfArenaMailData(){}return KfArenaMailData}();__reflect(KfArenaMailData.prototype,"KfArenaMailData");var KfArenaPeakInfo=function(){function KfArenaPeakInfo(){}return KfArenaPeakInfo}();__reflect(KfArenaPeakInfo.prototype,"KfArenaPeakInfo");var KfArenaRankAwardInfo=function(){function KfArenaRankAwardInfo(){}return KfArenaRankAwardInfo}();__reflect(KfArenaRankAwardInfo.prototype,"KfArenaRankAwardInfo");var CustomServiceBaseConfig=function(){function CustomServiceBaseConfig(){}return CustomServiceBaseConfig}();__reflect(CustomServiceBaseConfig.prototype,"CustomServiceBaseConfig");var CustomServiceProblemConfig=function(){function CustomServiceProblemConfig(){}return CustomServiceProblemConfig}();__reflect(CustomServiceProblemConfig.prototype,"CustomServiceProblemConfig");var DailyAwardConfig=function(){function DailyAwardConfig(){}return DailyAwardConfig}();__reflect(DailyAwardConfig.prototype,"DailyAwardConfig");var DailyConfig=function(){function DailyConfig(){}return DailyConfig}();__reflect(DailyConfig.prototype,"DailyConfig");var DailyFubenConfig=function(){function DailyFubenConfig(){this.ybRec=0;this.monthcard=0;this.privilege=0;this.specialCard=0;this.sweepLevel=0}return DailyFubenConfig}();__reflect(DailyFubenConfig.prototype,"DailyFubenConfig");var DailyRecharge4Config=function(){function DailyRecharge4Config(){}return DailyRecharge4Config}();__reflect(DailyRecharge4Config.prototype,"DailyRecharge4Config");var DailyRedEnvelope=function(){function DailyRedEnvelope(){}return DailyRedEnvelope}();__reflect(DailyRedEnvelope.prototype,"DailyRedEnvelope");var DeathgainWayConfig=function(){function DeathgainWayConfig(){}return DeathgainWayConfig}();__reflect(DeathgainWayConfig.prototype,"DeathgainWayConfig");var DeathGuideConfig=function(){function DeathGuideConfig(){}return DeathGuideConfig}();__reflect(DeathGuideConfig.prototype,"DeathGuideConfig");var DecomposeConfig=function(){function DecomposeConfig(){}return DecomposeConfig}();__reflect(DecomposeConfig.prototype,"DecomposeConfig");var DefineEff=function(){function DefineEff(){this.effid=0;this.souce=""}return DefineEff}();__reflect(DefineEff.prototype,"DefineEff");var DressCollectionConfig=function(){function DressCollectionConfig(){}return DressCollectionConfig}();__reflect(DressCollectionConfig.prototype,"DressCollectionConfig");var EffectConfig=function(){function EffectConfig(){}return EffectConfig}();__reflect(EffectConfig.prototype,"EffectConfig");var EffectsConfig=function(){function EffectsConfig(){}EffectsConfig.isAddBuff=function(config){return config.type==SkillEffType.AdditionalState||config.type==SkillEffType.AdditionalDamage||config.type==SkillEffType.AdditionalAttributes||config.type==SkillEffType.Summon};return EffectsConfig}();__reflect(EffectsConfig.prototype,"EffectsConfig");var EnhanceAttrConfig=function(){function EnhanceAttrConfig(){}return EnhanceAttrConfig}();__reflect(EnhanceAttrConfig.prototype,"EnhanceAttrConfig");var EnhanceCostConfig=function(){function EnhanceCostConfig(){}return EnhanceCostConfig}();__reflect(EnhanceCostConfig.prototype,"EnhanceCostConfig");var EquipConfig=function(){function EquipConfig(){this.stoneId=0;this.stoneNum=0;this.moneyNum=0;this.equipRate=0;this.moneyType=0;this.exPower=0}return EquipConfig}();__reflect(EquipConfig.prototype,"EquipConfig");var EquipItemConfig=function(){function EquipItemConfig(){}return EquipItemConfig}();__reflect(EquipItemConfig.prototype,"EquipItemConfig");var EquipPointBasicConfig=function(){function EquipPointBasicConfig(){}return EquipPointBasicConfig}();__reflect(EquipPointBasicConfig.prototype,"EquipPointBasicConfig");var EquipPointConstConfig=function(){function EquipPointConstConfig(){}return EquipPointConstConfig}();__reflect(EquipPointConstConfig.prototype,"EquipPointConstConfig");var EquipPointGrowUpConfig=function(){function EquipPointGrowUpConfig(){}return EquipPointGrowUpConfig}();__reflect(EquipPointGrowUpConfig.prototype,"EquipPointGrowUpConfig");var EquipPointRankConfig=function(){function EquipPointRankConfig(){}return EquipPointRankConfig}();__reflect(EquipPointRankConfig.prototype,"EquipPointRankConfig");var EquipPointResolveConfig=function(){function EquipPointResolveConfig(){}return EquipPointResolveConfig}();__reflect(EquipPointResolveConfig.prototype,"EquipPointResolveConfig");var EquipWithEffConfig=function(){function EquipWithEffConfig(){}return EquipWithEffConfig}();__reflect(EquipWithEffConfig.prototype,"EquipWithEffConfig");var EscortBaseConfig=function(){function EscortBaseConfig(){}return EscortBaseConfig}();__reflect(EscortBaseConfig.prototype,"EscortBaseConfig");var EscortGoddessConfig=function(){function EscortGoddessConfig(){}return EscortGoddessConfig}();__reflect(EscortGoddessConfig.prototype,"EscortGoddessConfig");var EscortRewardsConfig=function(){function EscortRewardsConfig(){}return EscortRewardsConfig}();__reflect(EscortRewardsConfig.prototype,"EscortRewardsConfig");var ExpConfig=function(){function ExpConfig(){}return ExpConfig}();__reflect(ExpConfig.prototype,"ExpConfig");var Keyboard=function(){function Keyboard(){}Keyboard.LEFT=37;Keyboard.UP=38;Keyboard.RIGHT=39;Keyboard.DOWN=40;Keyboard.KC_1=49;Keyboard.KC_2=50;Keyboard.KC_3=51;Keyboard.KC_4=52;Keyboard.KC_5=53;Keyboard.KC_6=54;Keyboard.KC_7=55;Keyboard.KC_8=56;Keyboard.KC_9=57;Keyboard.KC_0=48;Keyboard.A=65;Keyboard.B=66;Keyboard.C=67;Keyboard.D=68;Keyboard.E=69;Keyboard.F=70;Keyboard.G=71;Keyboard.H=72;Keyboard.I=73;Keyboard.J=74;Keyboard.K=75;Keyboard.L=76;Keyboard.M=77;Keyboard.N=78;Keyboard.O=79;Keyboard.P=80;Keyboard.Q=81;Keyboard.R=82;Keyboard.S=83;Keyboard.T=84;Keyboard.U=85;Keyboard.V=86;Keyboard.W=87;Keyboard.X=88;Keyboard.Y=89;Keyboard.Z=90;Keyboard.SPACE=32;Keyboard.BRACE_L=219;Keyboard.BACKSLASH=220;Keyboard.BRACE_R=221;Keyboard.BACK_QUOTE=192;Keyboard.ENTER=13;Keyboard.KC_BACKSPACE=8;Keyboard.KC_TAB=9;Keyboard.KC_ENTER=13;Keyboard.KC_SHIFT=16;Keyboard.KC_CONTROL=17;Keyboard.KC_ESCAPE=27;Keyboard.KC_SPACE=32;Keyboard.KC_WINDOWS=91;Keyboard.KC_MENU=93;return Keyboard}();__reflect(Keyboard.prototype,"Keyboard");var ExRing1Config=function(_super){__extends(ExRing1Config,_super);function ExRing1Config(){return _super!==null&&_super.apply(this,arguments)||this}return ExRing1Config}(ExRing0Config);__reflect(ExRing1Config.prototype,"ExRing1Config");var BitmapNumber=function(_super){__extends(BitmapNumber,_super);function BitmapNumber(){var _this=_super.call(this)||this;_this._imgPool=[];_this._containerPool=[];return _this}BitmapNumber.ins=function(){return _super.ins.call(this)};BitmapNumber.prototype.createNumPic=function(num,type,offset,offsetY){if(offset===void 0){offset=0}if(offsetY===void 0){offsetY=0}var container=this.getContainer();var numStr=num.toString();var index=0;var tempBm;for(index;index<numStr.length;index++){tempBm=this.getSingleNumPic(numStr.charAt(index),type);container.addChild(tempBm)}this.repositionNumPic(container,offset,offsetY);return container};BitmapNumber.prototype.desstroyNumPic=function(picContainer){this.clearContainer(picContainer);if(picContainer.parent)picContainer.parent.removeChild(picContainer);this._containerPool.push(picContainer)};BitmapNumber.prototype.changeNum=function(picContainer,num,type,offset,offsetY){if(offset===void 0){offset=0}if(offsetY===void 0){offsetY=0}var numStr=num.toString();if(!picContainer.numChildren){return}if(picContainer.numChildren>numStr.length){while(picContainer.numChildren>numStr.length){this.recycleBM(picContainer.getChildAt(picContainer.numChildren-1))}}var index=0;var tempStr;for(index;index<numStr.length;index++){if(index>=picContainer.numChildren)picContainer.addChild(this.getBitmap());tempStr=numStr.charAt(index);tempStr=tempStr=="."?"dot":tempStr;picContainer.getChildAt(index).texture=this.getTexture(tempStr,type)}this.repositionNumPic(picContainer,offset,offsetY)};BitmapNumber.prototype.repositionNumPic=function(container,offset,offsetY){if(offset===void 0){offset=0}if(offsetY===void 0){offsetY=0}var index=0;var lastX=0;var temp;for(index;index<container.numChildren;index++){temp=container.getChildAt(index);temp.x=lastX-offset;lastX=temp.x+temp.width}};BitmapNumber.prototype.clearContainer=function(picContainer){while(picContainer.numChildren){this.recycleBM(picContainer.getChildAt(picContainer.numChildren-1))}};BitmapNumber.prototype.recycleBM=function(bm){if(bm&&bm.parent){bm.parent.removeChild(bm);bm.texture=null;this._imgPool.push(bm)}};BitmapNumber.prototype.getContainer=function(){if(this._containerPool.length)return this._containerPool.shift();return new egret.DisplayObjectContainer};BitmapNumber.prototype.getSingleNumPic=function(num,type){if(num==".")num="dot";var bm=this.getBitmap();bm.texture=this.getTexture(num,type);return bm};BitmapNumber.prototype.getTexture=function(num,type){return RES.getRes(type+num+"_png")};BitmapNumber.prototype.getBitmap=function(){if(this._imgPool.length)return this._imgPool.shift();return new egret.Bitmap};return BitmapNumber}(BaseClass);__reflect(BitmapNumber.prototype,"BitmapNumber");var ExRingConfig=function(){function ExRingConfig(){}return ExRingConfig}();__reflect(ExRingConfig.prototype,"ExRingConfig");var ExRingExtendAttrConfig=function(_super){__extends(ExRingExtendAttrConfig,_super);function ExRingExtendAttrConfig(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.summonerSkillId=0;_this.summonerAiId=0;return _this}return ExRingExtendAttrConfig}(ExRingAttrConfig);__reflect(ExRingExtendAttrConfig.prototype,"ExRingExtendAttrConfig");var FbChallengeBaseConfig=function(){function FbChallengeBaseConfig(){}return FbChallengeBaseConfig}();__reflect(FbChallengeBaseConfig.prototype,"FbChallengeBaseConfig");var FbChallengeConfig=function(){function FbChallengeConfig(){this.id=0;this.group=0;this.layer=0;this.zsLevelLimit=0;this.levelLimit=0;this.fbId=0;this.describe="";this.showIcon=0;this.equipPos=0;this.passReward=[];this.dayReward=0;this.lotteryCount=0;this.clearRewardBuff1=[];this.clearRewardBuff2=[];this.clearRewardBuff3=[];this.clearRewardBuffShow1=0;this.clearRewardBuffShow2=0;this.clearRewardBuffShow3=0;this.dayRewardBuff=[];this.dayRewardBuffShow=0}return FbChallengeConfig}();__reflect(FbChallengeConfig.prototype,"FbChallengeConfig");var FbChallengeLotteryConfig=function(){function FbChallengeLotteryConfig(){this.group=[]}return FbChallengeLotteryConfig}();__reflect(FbChallengeLotteryConfig.prototype,"FbChallengeLotteryConfig");var FbChNameConfig=function(){function FbChNameConfig(){this.group=0;this.name=""}return FbChNameConfig}();__reflect(FbChNameConfig.prototype,"FbChNameConfig");var FeatsStore=function(){function FeatsStore(){}return FeatsStore}();__reflect(FeatsStore.prototype,"FeatsStore");var FieldBossConfig=function(){function FieldBossConfig(){}return FieldBossConfig}();__reflect(FieldBossConfig.prototype,"FieldBossConfig");var FirstRechargeAwardsConfig=function(){function FirstRechargeAwardsConfig(){}return FirstRechargeAwardsConfig}();__reflect(FirstRechargeAwardsConfig.prototype,"FirstRechargeAwardsConfig");var FirstRechargeConfig=function(){function FirstRechargeConfig(){}return FirstRechargeConfig}();__reflect(FirstRechargeConfig.prototype,"FirstRechargeConfig");var FlameStamp=function(){function FlameStamp(){}return FlameStamp}();__reflect(FlameStamp.prototype,"FlameStamp");var FlameStampEffect=function(){function FlameStampEffect(){this.reloadTime=0;this.exPower=0}return FlameStampEffect}();__reflect(FlameStampEffect.prototype,"FlameStampEffect");var FlameStampLevel=function(){function FlameStampLevel(){}return FlameStampLevel}();__reflect(FlameStampLevel.prototype,"FlameStampLevel");var FlameStampMat=function(){function FlameStampMat(){}return FlameStampMat}();__reflect(FlameStampMat.prototype,"FlameStampMat");var ForgeIndexConfig=function(){function ForgeIndexConfig(){}return ForgeIndexConfig}();__reflect(ForgeIndexConfig.prototype,"ForgeIndexConfig");var FriendLimit=function(){function FriendLimit(){this.sysLv=50;this.chatLv=50;this.friendListLen=50;this.chatsListLen=50;this.applyListLen=50;this.blacklistLen=50;this.contentLimit=50}return FriendLimit}();__reflect(FriendLimit.prototype,"FriendLimit");var FsFbConfig=function(){function FsFbConfig(){}return FsFbConfig}();__reflect(FsFbConfig.prototype,"FsFbConfig");var FuLiBtnConfig=function(){function FuLiBtnConfig(){}return FuLiBtnConfig}();__reflect(FuLiBtnConfig.prototype,"FuLiBtnConfig");var FuncNoticeConfig=function(){function FuncNoticeConfig(){}return FuncNoticeConfig}();__reflect(FuncNoticeConfig.prototype,"FuncNoticeConfig");var FuwenTreasureConfig=function(){function FuwenTreasureConfig(){this.huntOnce=500;this.huntTenth=4980}return FuwenTreasureConfig}();__reflect(FuwenTreasureConfig.prototype,"FuwenTreasureConfig");var FuwenTreasureLevelConfig=function(){function FuwenTreasureLevelConfig(){}return FuwenTreasureLevelConfig}();__reflect(FuwenTreasureLevelConfig.prototype,"FuwenTreasureLevelConfig");var FuwenTreasureRewardConfig=function(){function FuwenTreasureRewardConfig(){}return FuwenTreasureRewardConfig}();__reflect(FuwenTreasureRewardConfig.prototype,"FuwenTreasureRewardConfig");var GainItemConfig=function(){function GainItemConfig(){}return GainItemConfig}();__reflect(GainItemConfig.prototype,"GainItemConfig");var GainWay=function(_super){__extends(GainWay,_super);function GainWay(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(GainWay.prototype,"gainName",{get:function(){return this[0]},enumerable:true,configurable:true});Object.defineProperty(GainWay.prototype,"winName",{get:function(){return this[1]?this[1]:undefined},enumerable:true,configurable:true});Object.defineProperty(GainWay.prototype,"page",{get:function(){return this[2]?this[2]:0},enumerable:true,configurable:true});return GainWay}(Array);__reflect(GainWay.prototype,"GainWay");var GGWWaveConf=function(){function GGWWaveConf(){}return GGWWaveConf}();__reflect(GGWWaveConf.prototype,"GGWWaveConf");var GiftRebateConfig=function(){function GiftRebateConfig(){}return GiftRebateConfig}();__reflect(GiftRebateConfig.prototype,"GiftRebateConfig");var GlobalConfig=function(){function GlobalConfig(){}GlobalConfig.getConfig=function(){var config={};for(var i=0;i<GlobalConfig.count;i++){var content=RES.getRes(GlobalConfig.configResName(i));var cfg=JSON.parse(content);for(var name in cfg){if(!config[name]){config[name]=cfg[name]}else{var v=cfg[name];for(var k in v){config[name][k]=v[k]}}}}return config};GlobalConfig.init=function(){var self=this;if(self.config)return;var config=self.config=GlobalConfig.getConfig();if(!config){return}var parseKeys=function(obj,proto,key){if(key==0){obj.__proto__=proto}else{for(var i_5 in obj){parseKeys(obj[i_5],proto,key-1)}}};var _loop_8=function(key){var value=config[key];var objCls=egret.getDefinitionByName(key);if(objCls){var objKey_1="_obj"+key;self[objKey_1]=new objCls;var boolKey_1="_bool"+key;self[boolKey_1]=false;var newKey_1="_"+key+"_";Object.defineProperty(self,key,{get:function(){var obj=self[newKey_1];if(self[boolKey_1]){return obj}var proto=self[objKey_1];parseKeys(obj,proto,GlobalConfig.keys[key]||0);self[boolKey_1]=true;return obj},set:function(val){self[newKey_1]=val}})}self[key]=value};for(var key in config){_loop_8(key)}for(var i=0;i<GlobalConfig.count;i++){RES.destroyRes(GlobalConfig.configResName(i))}ChannelCfgOverwrite.overwriteCfgs()};GlobalConfig.loadPreConfig=function(){GlobalConfig.preConfig=GlobalConfig.getConfig()};GlobalConfig.configResName=function(i){if(i===void 0){i=0}var lang=window["wlmzlang"]||"";return"config"+lang+i+"_txt"};GlobalConfig.getConfigByName=function(name){var config;if(GlobalConfig[name]){config=GlobalConfig[name]}else{if(this.preConfig){config=this.preConfig[name]}else{console.log("GlobalConfig getConfigByName ,this.preConfig is null ")}}return config};GlobalConfig.count=10;GlobalConfig.keys={InstanceBaseConfig:0,RongLuExpConfig:1,PlayFunConfig:1,HunGuConf:0,HunGuEquip:1,HunYuEquip:2,HunGuSuit:3,ShenShouConfig:0,ShenShouBase:1,ShenShouEquip:1,ShenShouSkill:1,TeamFuBenBaseConfig:0,TeamFuBenConfig:1,FlameStamp:0,CrossBossConfig:1,CrossBossBase:0,ZhanLingConfig:0,ZhanLingBase:1,ZhanLingLevel:2,ZhanLingEquip:1,ZhanLingSuit:1,ZhanLingTalent:2,ZhanLingSkill:1,SDKConfig:0,FlameStampLevel:1,PActivity2Config:2,FlameStampEffect:2,FlameStampMat:1,PActivity3Config:2,PActivityBtnConfig:1,PActivityConfig:1,WeaponSoulItemAttr:1,WeaponSoulBaseConfig:0,PrivilegeData:0,ActivityType10Config:2,PunchEquipMasterConfig:1,PunchEquipConfig:2,ActivityType9Config:2,ActivityType28_1Config:2,SuperVipConfig:1,GodWeaponTaskConfig:2,ActorExRingFubenConfig:0,TrainDayAwardConfig:2,ActivityType5Config:2,ItemComposeConfig:1,LoopRechargeConfig:2,MultiDayRechargeConfig:1,CampBattleConfig:0,ChongZhiBaseConfig:0,CampBattlePersonalAwardConfig:1,CampBattlePersonalRankAwardConfig:1,GodWingLevelConfig:2,MonsterTitleConf:1,FbChallengeLotteryConfig:1,LoginActivateConfig:0,GodWingSuitConfig:1,GodWingItemConfig:1,NewWorldBossRankConfig:2,NewWorldBossAttrConfig:1,NewWorldBossBaseConfig:0,MailIdConfig:1,CityBaseConfig:0,CityBossConfig:1,LevelMailConfig:1,LoginDayMailConfig:0,GuildBonFireConfig:1,ActivityType4Config:2,VipGiftConfig:1,ActivityType3Config:2,RechargeDaysAwardsConfig:1,RechargeItemsConfig:1,WeaponSoulSuit:2,WeaponSoulPosConfig:2,WeaponSoulConfig:1,KuangYuanConfig:1,NpcBaseConfig:1,CaiKuangConfig:0,RichManRoundAwardConfig:1,RichManGridConfig:1,RichManBaseConfig:0,FuwenTreasureRewardConfig:1,MonsterSpeakConfig:2,LeadFubenBaseConfig:0,GuanYinAwardConfig:1,MonthCardConfig:0,ItemGiftConfig:1,HeirloomEquipConfig:2,HeirloomEquipItemConfig:1,HeirloomEquipFireConfig:1,HeirloomEquipSetConfig:1,ItemDescConfig:1,DailyRechargeConfig:2,FirstRechargeConfig:1,ExpFubenBaseConfig:0,ExpFubenConfig:1,ExpFbMonsterConfig:1,ImbaSkillReviseConfig:1,HintConfig:1,SkillsSorderConfig:1,SkillsDescConfig:1,ScenesConfig:1,YouDangConfig:1,BossHomeConfig:1,OpenSystemConfig:1,LoongSoulBaseConfig:0,DeathgainWayConfig:1,DeathGuideConfig:1,TrainBaseConfig:0,StoneOpenConfig:1,WorldBossKillMsgConfig:1,MonstershpConfig:1,MonthSignVipConfig:1,MonthSignDaysConfig:1,MonthSignBaseConfig:0,MonthSignConfig:1,BookListConfig:1,DecomposeConfig:1,SuitConfig:2,CardConfig:2,MijiBaseConfig:1,TreasureBoxRateConfig:1,TreasureBoxGridConfig:1,TreasureBoxConfig:1,TreasureBoxBaseConfig:0,TianTiConstConfig:0,TianTiDanConfig:2,TianTiRankAwardConfig:1,NeiGongBaseConfig:0,NeiGongStageConfig:2,FuwenTreasureConfig:0,FuwenTreasureLevelConfig:1,FbChallengeConfig:1,RuneConverConfig:1,RuneBaseConfig:1,RuneLockPosConfig:1,RuneNameConfig:1,RuneOtherConfig:0,RuneAttrTypeConfig:1,RuneComposeConfig:1,TogetherHitEquipPageConfig:1,TogetherHitEquipQmConfig:3,TogetherHitEquipExchangeConfig:1,TogetherHitConfig:1,LimitTimeTaskConfig:1,LimitTimeConfig:1,BubbleConfig:1,DefineEff:1,ActorExRingConfig:1,ActorExRingBookConfig:2,ActorExRing2Config:1,ActorExRing3Config:1,ActorExRing4Config:1,ActorExRing5Config:1,ActorExRing6Config:1,ActorExRing7Config:1,ActorExRingAbilityConfig:1,ActorExRingItemConfig:3,MonstersConfig:1,ExpConfig:1,ItemConfig:1,EquipConfig:1,SkillsConfig:1,SkirmishRewardConfig:1,SkirmishBaseConfig:0,EffectsConfig:1,ChaptersRewardConfig:1,WorldRewardConfig:1,WingLevelConfig:1,WingCommonConfig:0,DailyFubenConfig:1,DailyConfig:1,DailyAwardConfig:1,ImbaJigsawConf:1,ImbaConf:1,AchievementTaskConfig:1,ZhuanShengConfig:0,ZhuanShengLevelConfig:1,JingMaiStageConfig:1,JingMaiLevelConfig:1,JingMaiCommonConfig:0,SkillsUpgradeConfig:1,SkillsOpenConfig:1,ZhuanShengExpConfig:1,NewRoleConfig:1,ForgeIndexConfig:1,StoneLevelCostConfig:1,StoneLevelConfig:1,ZhulingAttrConfig:1,ZhulingCostConfig:1,EnhanceAttrConfig:1,EnhanceCostConfig:1,LegendLevelupConfig:1,LegendComposeConfig:1,ExRingConfig:1,ExRing0Config:1,ExRing1Config:1,EquipItemConfig:1,ItemStoreConfig:1,StoreCommonConfig:0,IntegralStore:1,TreasureOverViewConfig:1,EffectConfig:1,VipConfig:1,ShieldConfig:1,ShieldStageConfig:1,LoongSoulConfig:1,LoongSoulStageConfig:1,TreasureHuntConfig:0,TreasureHuntPoolConfig:1,TreasureHuntPoolHefuConfig:1,SkirmishRankConfig:1,GainItemConfig:1,BagBaseConfig:0,BagExpandConfig:1,WorldBossConfig:1,WorldBossBaseConfig:0,ServerTips:1,AttrPowerConfig:1,TrainLevelConfig:1,LoginRewardsConfig:1,ActivityType1Config:2,ActivityType2Config:2,ActivityType6Config:2,ActivityType8Config:2,ActivityType7Config:2,ActivityConfig:1,ActivityBtnConfig:1,SkillPowerConfig:1,KnighthoodConfig:1,KnighthoodBasicConfig:0,ChongZhi1Config:3,ChongZhi2Config:3,FuncNoticeConfig:1,RefinesystemExpConfig:1,VipGridConfig:1,OtherBoss1Config:1,EquipPointConstConfig:0,EquipPointBasicConfig:1,EquipPointGrowUpConfig:2,EquipPointRankConfig:2,EquipPointResolveConfig:1,WanBaGiftbagBasic:1,HelpInfoConfig:1,ClientGlobalConfig:0,CashCowBoxConfig:1,CashCowLimitConfig:1,CashCowBasicConfig:1,CashCowAmplitudeConfig:1,GuildConfig:0,GuildCommonSkillConfig:2,GuildPracticeSkillConfig:2,GuildCreateConfig:1,GuildDonateConfig:1,GuildLevelConfig:2,GuildTaskConfig:1,WelfareConfig:1,OtherBoss2Config:1,MiJiGridConfig:1,MiJiSkillConfig:1,TitleConf:1,TrainLevelAwardConfig:1,WelcomeConfig:0,WeiXiGuanZhuConst:0,GuildBattleLevel:1,GuildBattleConst:0,GuildBattleDayAward:1,GuildBattleDistributionAward:2,GuildBattlePersonalAward:1,GuildBattlePersonalRankAward:1,GuildStoreConfig:0,FriendLimit:0,ZhuangBanId:1,ZhuangBanConfig:0,ZhuangBanTrial:2,FeatsStore:1,ShapeShiftingStoreConfig:1,ShapeShiftingRandomStoreConfig:1,GuildBossConfig:0,GuildBossInfoConfig:1,GuildBossHpAwardsConfig:2,GuildBossRankConfig:1,AllWorldConfig:1,GuideConfig:2,TogerherHitBaseConfig:0,ActorExRingCommon:0,HeirloomTreasureConfig:0,HeirloomTreasureRewardConfig:1,ShapeShiftingTreasureConfig:0,ShapeShiftingTreasureRewardConfig:1,TreasureRewardConfig:1,OptionalGiftConfig:1,GodweaponItemConfig:1,GodWeaponLineConfig:2,GodWeaponLevelConfig:1,GodWeaponBaseConfig:0,GodWeaponFubenConfig:1,GWSkillReviseConfig:1,MoneyConfig:1,FbChallengeBaseConfig:0,YuPeiConfig:1,YuPeiBasicConfig:0,PassionPointConfig:0,BattleGroundConfig:0,PassionPointAwardConfig:1,RoleConfig:2,NewFuncNoticeConfig:1,ReincarnationBase:0,ReincarnationExchange:1,ReincarnationLevel:1,ReincarnateSpirit:2,ReincarnateSuit:1,ReincarnateEquip:1,EquipWithEffConfig:1,PrestigeBase:0,PrestigeLevel:1,ActivityType11_1Config:2,ActivityType11_2Config:2,ReincarnateEquipCompose:1,SpecialEquipsConfig:1,ReincarnationSoulLevel:3,ReincarnationDemonLevel:2,ReincarnationLinkLevel:3,PeakRaceBase:0,PeakRaceTime:1,PeakRaceCrossTime:1,ActivityType19Config:2,ActivityType18Config:2,HeartMethodStarConfig:1,GuardGodWeaponConf:0,GGWWaveConf:2,JadePlateBaseConfig:0,JadePlateLevelConfig:1,HeartMethodBaseConfig:0,HeartMethodConfig:1,HeartMethodPosConfig:3,HeartMethodLevelConfig:2,HeartMethodStageConfig:2,HeartMethodSuitConfig:2,ZhiZunEquipLevel:2,ZhiZunLinkLevel:3,ZhuangBanLevelUp:2,ActivityType20Config:2,PActivityType1Config:2,PActivityType9Config:2,ActivityType12Config:2,ActivityType28_2Config:1,ActivityType28_3Config:1,DevilBossBase:0,DevilBossConfig:1,CrossArenaBase:0,CrossArenaScore:1,SwordSkinConfig:1,SwordSkinGiftConfig:1,SwordSkinLevelConfig:2,ShapeShiftingConfig:1,ShapeShiftingBaseConfig:0,ShapeShiftingGiftConfig:1,ShapeShiftingLevelConfig:3,ShapeShiftingPropConfig:2,ShapeShiftingTaskConfig:2,ShapeShiftingTaskAwardsConfig:2,DressCollectionConfig:1,MarryBaseConfig:0,MarryMessageConfig:1,MarryProposalConfig:1,MarryLevelupConfig:1,MarryEquipLevelupConfig:2,MarryTitleAttrsConfig:1,MarryRankConfig:2,MarryLoginChestAward:1,MarryTask:2,FirstRechargeAwardsConfig:2,DailyRecharge4Config:1,PeachStoreConfig:1,QzoneShareConfig:1,RollMapStoreConfig:1,RollMapRankAwardConfig:1,RollMapGridConfig:1,SmallGameBaseConfig:0,AdRewardConfig:2,LoginRebateConfig:1,GiftRebateConfig:1,InviteGiftConfig:1,InviteClickGiftConfig:1,InviteFriendGiftConfig:1,ActivityType29_1Config:2,ActivityType29_2Config:1};return GlobalConfig}();__reflect(GlobalConfig.prototype,"GlobalConfig");var GodWingItemConfig=function(){function GodWingItemConfig(){}return GodWingItemConfig}();__reflect(GodWingItemConfig.prototype,"GodWingItemConfig");var GodWingLevelConfig=function(){function GodWingLevelConfig(){}return GodWingLevelConfig}();__reflect(GodWingLevelConfig.prototype,"GodWingLevelConfig");var GodWingSuitConfig=function(){function GodWingSuitConfig(){}return GodWingSuitConfig}();__reflect(GodWingSuitConfig.prototype,"GodWingSuitConfig");var GuanYinAwardConfig=function(){function GuanYinAwardConfig(){this.level=0}return GuanYinAwardConfig}();__reflect(GuanYinAwardConfig.prototype,"GuanYinAwardConfig");var GuardGodWeaponConf=function(){function GuardGodWeaponConf(){}return GuardGodWeaponConf}();__reflect(GuardGodWeaponConf.prototype,"GuardGodWeaponConf");var GuideCondition=function(){function GuideCondition(){}return GuideCondition}();__reflect(GuideCondition.prototype,"GuideCondition");var GuildActivityConfig=function(){function GuildActivityConfig(){}return GuildActivityConfig}();__reflect(GuildActivityConfig.prototype,"GuildActivityConfig");var GuildBattleConst=function(){function GuildBattleConst(){}return GuildBattleConst}();__reflect(GuildBattleConst.prototype,"GuildBattleConst");var GuildBattleDayAward=function(){function GuildBattleDayAward(){}return GuildBattleDayAward}();__reflect(GuildBattleDayAward.prototype,"GuildBattleDayAward");var GuildBattleDistributionAward=function(){function GuildBattleDistributionAward(){}return GuildBattleDistributionAward}();__reflect(GuildBattleDistributionAward.prototype,"GuildBattleDistributionAward");var GuildBattleLevel=function(){function GuildBattleLevel(){}return GuildBattleLevel}();__reflect(GuildBattleLevel.prototype,"GuildBattleLevel");var GuildBattlePersonalAward=function(){function GuildBattlePersonalAward(){}return GuildBattlePersonalAward}();__reflect(GuildBattlePersonalAward.prototype,"GuildBattlePersonalAward");var GuildBattlePersonalRankAward=function(){function GuildBattlePersonalRankAward(){}return GuildBattlePersonalRankAward}();__reflect(GuildBattlePersonalRankAward.prototype,"GuildBattlePersonalRankAward");var GuildBossConfig=function(){function GuildBossConfig(){this.dayTimes=0;this.notOpenDayOfWeek=0;this.effid=0;this.radisLv=0}return GuildBossConfig}();__reflect(GuildBossConfig.prototype,"GuildBossConfig");var GuildBossHpAwardsConfig=function(){function GuildBossHpAwardsConfig(){this.srank=0;this.erank=0;this.mail_head="";this.mail_content=""}return GuildBossHpAwardsConfig}();__reflect(GuildBossHpAwardsConfig.prototype,"GuildBossHpAwardsConfig");var GuildBossInfoConfig=function(){function GuildBossInfoConfig(){this.id=0;this.fbId=0;this.enterAwards=0}return GuildBossInfoConfig}();__reflect(GuildBossInfoConfig.prototype,"GuildBossInfoConfig");var GuildBossRankConfig=function(){function GuildBossRankConfig(){}return GuildBossRankConfig}();__reflect(GuildBossRankConfig.prototype,"GuildBossRankConfig");var GuildCommonSkillConfig=function(){function GuildCommonSkillConfig(){}return GuildCommonSkillConfig}();__reflect(GuildCommonSkillConfig.prototype,"GuildCommonSkillConfig");var GuildConfig=function(){function GuildConfig(){}return GuildConfig}();__reflect(GuildConfig.prototype,"GuildConfig");var GuildCreateConfig=function(){function GuildCreateConfig(){}return GuildCreateConfig}();__reflect(GuildCreateConfig.prototype,"GuildCreateConfig");var GuildDonateConfig=function(){function GuildDonateConfig(){}return GuildDonateConfig}();__reflect(GuildDonateConfig.prototype,"GuildDonateConfig");var GuildLevelConfig=function(){function GuildLevelConfig(){}return GuildLevelConfig}();__reflect(GuildLevelConfig.prototype,"GuildLevelConfig");var GuildPracticeSkillConfig=function(){function GuildPracticeSkillConfig(){}return GuildPracticeSkillConfig}();__reflect(GuildPracticeSkillConfig.prototype,"GuildPracticeSkillConfig");var GuildStoreConfig=function(){function GuildStoreConfig(){}return GuildStoreConfig}();__reflect(GuildStoreConfig.prototype,"GuildStoreConfig");var GuildTaskConfig=function(){function GuildTaskConfig(){}return GuildTaskConfig}();__reflect(GuildTaskConfig.prototype,"GuildTaskConfig");var HeartMethodBaseConfig=function(){function HeartMethodBaseConfig(){this.serverDay=0;this.zsLv=0;this.starMax=0}return HeartMethodBaseConfig}();__reflect(HeartMethodBaseConfig.prototype,"HeartMethodBaseConfig");var HeartMethodConfig=function(){function HeartMethodConfig(){this.id=0}return HeartMethodConfig}();__reflect(HeartMethodConfig.prototype,"HeartMethodConfig");var HeartMethodLevelConfig=function(){function HeartMethodLevelConfig(){}return HeartMethodLevelConfig}();__reflect(HeartMethodLevelConfig.prototype,"HeartMethodLevelConfig");var HeartMethodPosConfig=function(){function HeartMethodPosConfig(){}return HeartMethodPosConfig}();__reflect(HeartMethodPosConfig.prototype,"HeartMethodPosConfig");var HeartMethodStageConfig=function(){function HeartMethodStageConfig(){}return HeartMethodStageConfig}();__reflect(HeartMethodStageConfig.prototype,"HeartMethodStageConfig");var HeartMethodStarConfig=function(){function HeartMethodStarConfig(){}return HeartMethodStarConfig}();__reflect(HeartMethodStarConfig.prototype,"HeartMethodStarConfig");var HeartMethodSuitConfig=function(){function HeartMethodSuitConfig(){}return HeartMethodSuitConfig}();__reflect(HeartMethodSuitConfig.prototype,"HeartMethodSuitConfig");var HeirloomEquipConfig=function(){function HeirloomEquipConfig(){}return HeirloomEquipConfig}();__reflect(HeirloomEquipConfig.prototype,"HeirloomEquipConfig");var HeirloomEquipFireConfig=function(){function HeirloomEquipFireConfig(){}return HeirloomEquipFireConfig}();__reflect(HeirloomEquipFireConfig.prototype,"HeirloomEquipFireConfig");var HeirloomEquipItemConfig=function(){function HeirloomEquipItemConfig(){}return HeirloomEquipItemConfig}();__reflect(HeirloomEquipItemConfig.prototype,"HeirloomEquipItemConfig");var HeirloomEquipSetConfig=function(){function HeirloomEquipSetConfig(){}return HeirloomEquipSetConfig}();__reflect(HeirloomEquipSetConfig.prototype,"HeirloomEquipSetConfig");var HeirloomTreasureConfig=function(){function HeirloomTreasureConfig(){}return HeirloomTreasureConfig}();__reflect(HeirloomTreasureConfig.prototype,"HeirloomTreasureConfig");var HeirloomTreasureRewardConfig=function(){function HeirloomTreasureRewardConfig(){}return HeirloomTreasureRewardConfig}();__reflect(HeirloomTreasureRewardConfig.prototype,"HeirloomTreasureRewardConfig");var HelpInfoConfig=function(){function HelpInfoConfig(){}return HelpInfoConfig}();__reflect(HelpInfoConfig.prototype,"HelpInfoConfig");var HintConfig=function(){function HintConfig(){}return HintConfig}();__reflect(HintConfig.prototype,"HintConfig");var HunGuConf=function(){function HunGuConf(){this.openzhuanshenglv=0;this.openserverday=0;this.showzhuanshenglv=0;this.equipCount=0;this.hunyuCount=0}return HunGuConf}();__reflect(HunGuConf.prototype,"HunGuConf");var HunGuEquip=function(){function HunGuEquip(){this.id=0;this.stage=0}return HunGuEquip}();__reflect(HunGuEquip.prototype,"HunGuEquip");var HunGuSuit=function(){function HunGuSuit(){this.id=0;this.count=0;this.stage=0;this.expower=0;this.specialAttrs=0}return HunGuSuit}();__reflect(HunGuSuit.prototype,"HunGuSuit");var HunYuEquip=function(){function HunYuEquip(){this.id=0;this.level=0}return HunYuEquip}();__reflect(HunYuEquip.prototype,"HunYuEquip");var ImbaConf=function(){function ImbaConf(){}return ImbaConf}();__reflect(ImbaConf.prototype,"ImbaConf");var ImbaJigsawConf=function(){function ImbaJigsawConf(){}return ImbaJigsawConf}();__reflect(ImbaJigsawConf.prototype,"ImbaJigsawConf");var ImbaSkillReviseConfig=function(){function ImbaSkillReviseConfig(){this.id=0;this.skill=0;this.imba_id=0;this.a=0;this.b=0;this.cd=0;this.d=0;this.crit=0;this.affectCount=0;this.selfEff=[];this.targetEff=[];this.args={}}return ImbaSkillReviseConfig}();__reflect(ImbaSkillReviseConfig.prototype,"ImbaSkillReviseConfig");var InstanceBaseConfig=function(){function InstanceBaseConfig(){}return InstanceBaseConfig}();__reflect(InstanceBaseConfig.prototype,"InstanceBaseConfig");var InstanceConfig=function(){function InstanceConfig(){this.fbid=0;this.type=0}return InstanceConfig}();__reflect(InstanceConfig.prototype,"InstanceConfig");var IntegralStore=function(){function IntegralStore(){}return IntegralStore}();__reflect(IntegralStore.prototype,"IntegralStore");var InvestBaseConfig=function(){function InvestBaseConfig(){}return InvestBaseConfig}();__reflect(InvestBaseConfig.prototype,"InvestBaseConfig");var InvestBtnConfig=function(){function InvestBtnConfig(){}return InvestBtnConfig}();__reflect(InvestBtnConfig.prototype,"InvestBtnConfig");var InviteClickGiftConfig=function(){function InviteClickGiftConfig(){}return InviteClickGiftConfig}();__reflect(InviteClickGiftConfig.prototype,"InviteClickGiftConfig");var InviteFriendGiftConfig=function(){function InviteFriendGiftConfig(){}return InviteFriendGiftConfig}();__reflect(InviteFriendGiftConfig.prototype,"InviteFriendGiftConfig");var InviteGiftConfig=function(){function InviteGiftConfig(){}return InviteGiftConfig}();__reflect(InviteGiftConfig.prototype,"InviteGiftConfig");var ItemConfig=function(){function ItemConfig(){this.bagType=0}ItemConfig.calculateBagItemScore=function(item){var transfrom={hp:2,atk:4,def:5,res:6};var EquipConfig=GlobalConfig.getConfigByName("EquipConfig");var AttrPowerConfig=GlobalConfig.getConfigByName("AttrPowerConfig");var equipConfig=EquipConfig[item.itemConfig.id];var powerConfig=AttrPowerConfig;var allPower=0;if(!equipConfig){return-1}var attr=item.att;var value=0;if(attr){for(var k in transfrom){value=0;if(!equipConfig[k])continue;for(var index=0;index<attr.length;index++){if(attr[index].type==transfrom[k]){value=equipConfig[k]+attr[index].value;break}}allPower+=(value==undefined?0:value)*powerConfig[transfrom[k]].power}}else{for(var j in transfrom){value=equipConfig[j];if(!value)continue;var type=Role.getAttrTypeByName(j);allPower+=value*powerConfig[type].power}}var expower=0;if(equipConfig.baseAttr1){expower+=UserBag.getAttrPower([equipConfig.baseAttr1])}if(equipConfig.baseAttr2){expower+=UserBag.getAttrPower([equipConfig.baseAttr2])}if(equipConfig.exPower){expower+=equipConfig.exPower}return Math.floor(allPower/100)+Math.floor(expower)};ItemConfig.pointCalNumber=function(item){var itemId=item.id;if(ItemConfig.itemPoints[itemId]!=undefined){return ItemConfig.itemPoints[itemId]}var transfrom={hp:2,atk:4,def:5,res:6};var EquipConfig=GlobalConfig.getConfigByName("EquipConfig");var AttrPowerConfig=GlobalConfig.getConfigByName("AttrPowerConfig");var equipConfig=EquipConfig[itemId];var powerConfig=AttrPowerConfig;var allPower=0;for(var i in transfrom){var _type=transfrom[i];var value=equipConfig[i];if(value){var conf=powerConfig[_type];allPower+=value*conf.power}}ItemConfig.itemPoints[itemId]=Math.floor(allPower/100);return ItemConfig.itemPoints[itemId]};ItemConfig.getBaseAttrData=function(item){var EquipConfig=GlobalConfig.getConfigByName("EquipConfig");var equipConfig=EquipConfig[item.id];var transfrom={hp:2,atk:4,def:5,res:6};var otherBaseType=[AttributeType.atHolyDamege];var baseAttr=[];for(var i in transfrom){if(equipConfig[i]){baseAttr.push(new AttributeData(transfrom[i],equipConfig[i]))}}if(equipConfig.baseAttr1){if(otherBaseType.indexOf(equipConfig.baseAttr1.type)>=0)baseAttr.push(new AttributeData(equipConfig.baseAttr1.type,equipConfig.baseAttr1.value))}if(equipConfig.baseAttr2){if(otherBaseType.indexOf(equipConfig.baseAttr2.type)>=0)baseAttr.push(new AttributeData(equipConfig.baseAttr2.type,equipConfig.baseAttr2.value))}return baseAttr};ItemConfig.calculateRelatePower=function(attrs,role){var totalPower=0;if(!attrs||!role)return totalPower;for(var _i=0,attrs_1=attrs;_i<attrs_1.length;_i++){var attr=attrs_1[_i];totalPower+=ItemConfig.relatePower(attr,role)}return totalPower};ItemConfig.relatePower=function(attr,role){var totalPower=0;var AttrPowerConfig=GlobalConfig.getConfigByName("AttrPowerConfig");var powerConfig=AttrPowerConfig;var config=powerConfig[attr.type];if(config&&config.relate_type){var value=role.getAtt(config.relate_type);var ex_type=AttributeData.exRelate[config.relate_type];if(ex_type){var ex_value=role.getAtt(ex_type);if(ex_value){value=Math.floor(value/(1+ex_value/1e4))}}totalPower+=Math.floor(attr.value*value*config.relate_power/100)}return totalPower};ItemConfig.getQuality=function(config){if(!config)return 0;var ItemDescConfig=GlobalConfig.getConfigByName("ItemDescConfig");if(ItemDescConfig[config.descIndex])return ItemDescConfig[config.descIndex].quality;return 0};ItemConfig.getQualityColor=function(config){return ItemBase.QUALITY_COLOR[this.getQuality(config)]};ItemConfig.getQualityStrokeColor=function(config){return ItemBase.QUALITY_STROKE_COLOR[this.getQuality(config)]};ItemConfig.getType=function(config){if(!config)return 0;var ItemDescConfig=GlobalConfig.getConfigByName("ItemDescConfig");if(ItemDescConfig[config.descIndex])return ItemDescConfig[config.descIndex].type;return 0};ItemConfig.getSubType=function(config){if(!config)return 0;var ItemDescConfig=GlobalConfig.getConfigByName("ItemDescConfig");if(ItemDescConfig[config.descIndex])return ItemDescConfig[config.descIndex].subType;return 0};ItemConfig.getJob=function(config){if(!config)return 0;var ItemDescConfig=GlobalConfig.getConfigByName("ItemDescConfig");if(ItemDescConfig[config.descIndex])return ItemDescConfig[config.descIndex].job;return 0};ItemConfig.isEquip=function(config){var type=this.getType(config);switch(type){case ItemType.TYPE_0:case ItemType.TYPE_4:case ItemType.TYPE_11:return true}return false};ItemConfig.itemPoints={};return ItemConfig}();__reflect(ItemConfig.prototype,"ItemConfig");var ItemExchangeConfig=function(){function ItemExchangeConfig(){}return ItemExchangeConfig}();__reflect(ItemExchangeConfig.prototype,"ItemExchangeConfig");var ItemGiftConfig=function(){function ItemGiftConfig(){}return ItemGiftConfig}();__reflect(ItemGiftConfig.prototype,"ItemGiftConfig");var ItemStoreConfig=function(){function ItemStoreConfig(){}ItemStoreConfig.getStoreByItemID=function(id){var arr=GlobalConfig.ItemStoreConfig;for(var i in arr){var element=arr[i];if(element.itemId==id)return element}return null};return ItemStoreConfig}();__reflect(ItemStoreConfig.prototype,"ItemStoreConfig");var JadePlateBaseConfig=function(){function JadePlateBaseConfig(){}return JadePlateBaseConfig}();__reflect(JadePlateBaseConfig.prototype,"JadePlateBaseConfig");var JadePlateLevelConfig=function(){function JadePlateLevelConfig(){}return JadePlateLevelConfig}();__reflect(JadePlateLevelConfig.prototype,"JadePlateLevelConfig");var JingMaiCommonConfig=function(){function JingMaiCommonConfig(){}return JingMaiCommonConfig}();__reflect(JingMaiCommonConfig.prototype,"JingMaiCommonConfig");var JingMaiLevelConfig=function(){function JingMaiLevelConfig(){}return JingMaiLevelConfig}();__reflect(JingMaiLevelConfig.prototype,"JingMaiLevelConfig");var JingMaiStageConfig=function(){function JingMaiStageConfig(){}return JingMaiStageConfig}();__reflect(JingMaiStageConfig.prototype,"JingMaiStageConfig");var KnighthoodBasicConfig=function(){function KnighthoodBasicConfig(){this.perLevel=0;this.actImbaId=0}return KnighthoodBasicConfig}();__reflect(KnighthoodBasicConfig.prototype,"KnighthoodBasicConfig");var KnighthoodConfig=function(){function KnighthoodConfig(){this.effid=0}return KnighthoodConfig}();__reflect(KnighthoodConfig.prototype,"KnighthoodConfig");var TaskIdConfig=function(){function TaskIdConfig(){this.achieveId=0;this.taskId=0}return TaskIdConfig}();__reflect(TaskIdConfig.prototype,"TaskIdConfig");var KnighthoodStageConfig=function(){function KnighthoodStageConfig(){this.stage=0;this.type=""}return KnighthoodStageConfig}();__reflect(KnighthoodStageConfig.prototype,"KnighthoodStageConfig");var KuangDiTuConfig=function(){function KuangDiTuConfig(){}return KuangDiTuConfig}();__reflect(KuangDiTuConfig.prototype,"KuangDiTuConfig");var LegendComposeConfig=function(){function LegendComposeConfig(){}return LegendComposeConfig}();__reflect(LegendComposeConfig.prototype,"LegendComposeConfig");var LegendLevelupConfig=function(){function LegendLevelupConfig(){}return LegendLevelupConfig}();__reflect(LegendLevelupConfig.prototype,"LegendLevelupConfig");var LevelInvestConfig=function(){function LevelInvestConfig(){}return LevelInvestConfig}();__reflect(LevelInvestConfig.prototype,"LevelInvestConfig");var LevelupRewards=function(){function LevelupRewards(){}return LevelupRewards}();__reflect(LevelupRewards.prototype,"LevelupRewards");var LimitTimeConfig=function(){function LimitTimeConfig(){this.id=0;this.time=0;this.openLevel=0;this.openZhuan=0}return LimitTimeConfig}();__reflect(LimitTimeConfig.prototype,"LimitTimeConfig");var LimitTimeTaskConfig=function(){function LimitTimeTaskConfig(){this.id=0;this.name="";this.desc="";this.target=0;this.control=0}return LimitTimeTaskConfig}();__reflect(LimitTimeTaskConfig.prototype,"LimitTimeTaskConfig");var LoginActivateConfig=function(){function LoginActivateConfig(){}return LoginActivateConfig}();__reflect(LoginActivateConfig.prototype,"LoginActivateConfig");var LoginInvestConfig=function(){function LoginInvestConfig(){}return LoginInvestConfig}();__reflect(LoginInvestConfig.prototype,"LoginInvestConfig");var LoginRebateConfig=function(){function LoginRebateConfig(){}return LoginRebateConfig}();__reflect(LoginRebateConfig.prototype,"LoginRebateConfig");var LoginRewardsConfig=function(){function LoginRewardsConfig(){}return LoginRewardsConfig}();__reflect(LoginRewardsConfig.prototype,"LoginRewardsConfig");var LoongSoulBaseConfig=function(){function LoongSoulBaseConfig(){this.openlv=0}return LoongSoulBaseConfig}();__reflect(LoongSoulBaseConfig.prototype,"LoongSoulBaseConfig");var LoongSoulConfig=function(){function LoongSoulConfig(){}return LoongSoulConfig}();__reflect(LoongSoulConfig.prototype,"LoongSoulConfig");var LoongSoulStageConfig=function(){function LoongSoulStageConfig(){this.stage=0;this.icon="";this.normalCost=0;this.attr=[];this.normalCostTip=0}return LoongSoulStageConfig}();__reflect(LoongSoulStageConfig.prototype,"LoongSoulStageConfig");var MarryBaseConfig=function(){function MarryBaseConfig(){}return MarryBaseConfig}();__reflect(MarryBaseConfig.prototype,"MarryBaseConfig");var MarryEquipLevelupConfig=function(){function MarryEquipLevelupConfig(){}return MarryEquipLevelupConfig}();__reflect(MarryEquipLevelupConfig.prototype,"MarryEquipLevelupConfig");var MarryLevelupConfig=function(){function MarryLevelupConfig(){}return MarryLevelupConfig}();__reflect(MarryLevelupConfig.prototype,"MarryLevelupConfig");var MarryLoginChestAward=function(){function MarryLoginChestAward(){}return MarryLoginChestAward}();__reflect(MarryLoginChestAward.prototype,"MarryLoginChestAward");var MarryMessageConfig=function(){function MarryMessageConfig(){}return MarryMessageConfig}();__reflect(MarryMessageConfig.prototype,"MarryMessageConfig");var MarryProposalConfig=function(){function MarryProposalConfig(){}return MarryProposalConfig}();__reflect(MarryProposalConfig.prototype,"MarryProposalConfig");var MarryRankConfig=function(){function MarryRankConfig(){}return MarryRankConfig}();__reflect(MarryRankConfig.prototype,"MarryRankConfig");var MarryTask=function(){function MarryTask(){}return MarryTask}();__reflect(MarryTask.prototype,"MarryTask");var MarryTitleAttrsConfig=function(){function MarryTitleAttrsConfig(){}return MarryTitleAttrsConfig}();__reflect(MarryTitleAttrsConfig.prototype,"MarryTitleAttrsConfig");var MijiBaseConfig=function(){function MijiBaseConfig(){}return MijiBaseConfig}();__reflect(MijiBaseConfig.prototype,"MijiBaseConfig");var MiJiGridConfig=function(){function MiJiGridConfig(){}return MiJiGridConfig}();__reflect(MiJiGridConfig.prototype,"MiJiGridConfig");var MiJiNewLevelAdditionConfig=function(){function MiJiNewLevelAdditionConfig(){}return MiJiNewLevelAdditionConfig}();__reflect(MiJiNewLevelAdditionConfig.prototype,"MiJiNewLevelAdditionConfig");var MiJiSkillConfig=function(){function MiJiSkillConfig(){}MiJiSkillConfig.getSkillIDByItem=function(itemID){var arr=GlobalConfig.MiJiSkillConfig;for(var i in arr){if(arr[i].item==itemID)return arr[i].id}return-1};return MiJiSkillConfig}();__reflect(MiJiSkillConfig.prototype,"MiJiSkillConfig");var MoneyConfig=function(){function MoneyConfig(){}return MoneyConfig}();__reflect(MoneyConfig.prototype,"MoneyConfig");var MonstersConfig=function(){function MonstersConfig(){this.attrange=0;this.wanderrange=0;this.dirNum=2}return MonstersConfig}();__reflect(MonstersConfig.prototype,"MonstersConfig");var MonsterType;(function(MonsterType){MonsterType[MonsterType["Monster"]=0]="Monster";MonsterType[MonsterType["Boss"]=1]="Boss";MonsterType[MonsterType["Summon"]=3]="Summon";MonsterType[MonsterType["Ring"]=4]="Ring"})(MonsterType||(MonsterType={}));window["MonsterType"]=MonsterType;var MonstershpConfig=function(){function MonstershpConfig(){this.hp=0;this.typeface=0}return MonstershpConfig}();__reflect(MonstershpConfig.prototype,"MonstershpConfig");var MonthCardConfig=function(){function MonthCardConfig(){this.monthCardMoney=0;this.privilegeMoney=0;this.expFubenPrecent=0;this.neiGongGoldPrecent=0;this.sweepPrecent=0}return MonthCardConfig}();__reflect(MonthCardConfig.prototype,"MonthCardConfig");var MonthSignBaseConfig=function(){function MonthSignBaseConfig(){this.openLevel=0}return MonthSignBaseConfig}();__reflect(MonthSignBaseConfig.prototype,"MonthSignBaseConfig");var MonthSignConfig=function(){function MonthSignConfig(){this.month=0;this.day=0;this.rewards=null;this.dayLabel=0;this.vipLabel=0}return MonthSignConfig}();__reflect(MonthSignConfig.prototype,"MonthSignConfig");var MonthSignDaysConfig=function(){function MonthSignDaysConfig(){this.days=0;this.rewards=null}return MonthSignDaysConfig}();__reflect(MonthSignDaysConfig.prototype,"MonthSignDaysConfig");var MonthSignVipConfig=function(){function MonthSignVipConfig(){this.vipLevel=0;this.complementTimes=0}return MonthSignVipConfig}();__reflect(MonthSignVipConfig.prototype,"MonthSignVipConfig");var MorshipConfig=function(){function MorshipConfig(){}return MorshipConfig}();__reflect(MorshipConfig.prototype,"MorshipConfig");var NeiGongBaseConfig=function(){function NeiGongBaseConfig(){this.openLevel=10;this.maxLevel=20;this.maxStage=0;this.levelPerStage=0;this.openGuanqia=10}return NeiGongBaseConfig}();__reflect(NeiGongBaseConfig.prototype,"NeiGongBaseConfig");var NeiGongStageConfig=function(){function NeiGongStageConfig(){this.stage=0;this.level=0;this.totalExp=0;this.costMoney=0;this.addExp=0;this.attribute=[];this.tips=0}return NeiGongStageConfig}();__reflect(NeiGongStageConfig.prototype,"NeiGongStageConfig");var NewFuncNoticeConfig=function(){function NewFuncNoticeConfig(){}return NewFuncNoticeConfig}();__reflect(NewFuncNoticeConfig.prototype,"NewFuncNoticeConfig");var NewRoleConfig=function(){function NewRoleConfig(){}return NewRoleConfig}();__reflect(NewRoleConfig.prototype,"NewRoleConfig");var OnlineAccrueRewardConfig=function(){function OnlineAccrueRewardConfig(){}return OnlineAccrueRewardConfig}();__reflect(OnlineAccrueRewardConfig.prototype,"OnlineAccrueRewardConfig");var OnlineRewardsConfig=function(){function OnlineRewardsConfig(){}return OnlineRewardsConfig}();__reflect(OnlineRewardsConfig.prototype,"OnlineRewardsConfig");var OpenSystemConfig=function(){function OpenSystemConfig(){this.id=0;this.openzs=0;this.openlevel=0;this.opencheck=0}return OpenSystemConfig}();__reflect(OpenSystemConfig.prototype,"OpenSystemConfig");var OptionalGiftConfig=function(){function OptionalGiftConfig(){}return OptionalGiftConfig}();__reflect(OptionalGiftConfig.prototype,"OptionalGiftConfig");var OtherBoss1Config=function(){function OtherBoss1Config(){}return OtherBoss1Config}();__reflect(OtherBoss1Config.prototype,"OtherBoss1Config");var OtherBoss2Config=function(){function OtherBoss2Config(){}return OtherBoss2Config}();__reflect(OtherBoss2Config.prototype,"OtherBoss2Config");var PActivity1Config=function(_super){__extends(PActivity1Config,_super);function PActivity1Config(){return _super!==null&&_super.apply(this,arguments)||this}return PActivity1Config}(ActivityType1Config);__reflect(PActivity1Config.prototype,"PActivity1Config");var PActivity28_1Config=function(_super){__extends(PActivity28_1Config,_super);function PActivity28_1Config(){return _super!==null&&_super.apply(this,arguments)||this}return PActivity28_1Config}(ActivityType28_1Config);__reflect(PActivity28_1Config.prototype,"PActivity28_1Config");var PActivity2Config=function(){function PActivity2Config(){}return PActivity2Config}();__reflect(PActivity2Config.prototype,"PActivity2Config");var PActivity3Config=function(){function PActivity3Config(){this.day=1}return PActivity3Config}();__reflect(PActivity3Config.prototype,"PActivity3Config");var PActivity9Config=function(_super){__extends(PActivity9Config,_super);function PActivity9Config(){return _super!==null&&_super.apply(this,arguments)||this}return PActivity9Config}(ActivityType9Config);__reflect(PActivity9Config.prototype,"PActivity9Config");var PActivityBtnConfig=function(){function PActivityBtnConfig(){}return PActivityBtnConfig}();__reflect(PActivityBtnConfig.prototype,"PActivityBtnConfig");var PActivityConfig=function(){function PActivityConfig(){}return PActivityConfig}();__reflect(PActivityConfig.prototype,"PActivityConfig");var PassionPointAwardConfig=function(){function PassionPointAwardConfig(){}return PassionPointAwardConfig}();__reflect(PassionPointAwardConfig.prototype,"PassionPointAwardConfig");var PassionPointConfig=function(){function PassionPointConfig(){}return PassionPointConfig}();__reflect(PassionPointConfig.prototype,"PassionPointConfig");var PayItemsConfig=function(){function PayItemsConfig(){}return PayItemsConfig}();__reflect(PayItemsConfig.prototype,"PayItemsConfig");var PeachBaseConfig=function(){function PeachBaseConfig(){}return PeachBaseConfig}();__reflect(PeachBaseConfig.prototype,"PeachBaseConfig");var PeakRaceCrossTime=function(){function PeakRaceCrossTime(){}return PeakRaceCrossTime}();__reflect(PeakRaceCrossTime.prototype,"PeakRaceCrossTime");var PeakRaceTime=function(){function PeakRaceTime(){}return PeakRaceTime}();__reflect(PeakRaceTime.prototype,"PeakRaceTime");var PlayFunConfig=function(){function PlayFunConfig(){this.pos=1;this.iconCls="eui.Button";this.iconSkin="MainButtonSkin"}return PlayFunConfig}();__reflect(PlayFunConfig.prototype,"PlayFunConfig");var PrestigeBase=function(){function PrestigeBase(){}return PrestigeBase}();__reflect(PrestigeBase.prototype,"PrestigeBase");var PrestigeLevel=function(){function PrestigeLevel(){}return PrestigeLevel}();__reflect(PrestigeLevel.prototype,"PrestigeLevel");var PrivilegeData=function(){function PrivilegeData(){this.priviMoney=0;this.priviCardDays=0}return PrivilegeData}();__reflect(PrivilegeData.prototype,"PrivilegeData");var PromoteConfig=function(){function PromoteConfig(){}return PromoteConfig}();__reflect(PromoteConfig.prototype,"PromoteConfig");var PromoterLevelConfig=function(){function PromoterLevelConfig(){}return PromoterLevelConfig}();__reflect(PromoterLevelConfig.prototype,"PromoterLevelConfig");var PublicBossBaseConfig=function(){function PublicBossBaseConfig(){}return PublicBossBaseConfig}();__reflect(PublicBossBaseConfig.prototype,"PublicBossBaseConfig");var PublicBossConfig=function(){function PublicBossConfig(){this.rewardsDesc=""}return PublicBossConfig}();__reflect(PublicBossConfig.prototype,"PublicBossConfig");var PunchEquipConfig=function(){function PunchEquipConfig(){}return PunchEquipConfig}();__reflect(PunchEquipConfig.prototype,"PunchEquipConfig");var PunchEquipMasterConfig=function(){function PunchEquipMasterConfig(){}return PunchEquipMasterConfig}();__reflect(PunchEquipMasterConfig.prototype,"PunchEquipMasterConfig");var QDaTingDailyGiftconfig=function(){function QDaTingDailyGiftconfig(){}return QDaTingDailyGiftconfig}();__reflect(QDaTingDailyGiftconfig.prototype,"QDaTingDailyGiftconfig");var QDaTingLevelGiftconfig=function(){function QDaTingLevelGiftconfig(){}return QDaTingLevelGiftconfig}();__reflect(QDaTingLevelGiftconfig.prototype,"QDaTingLevelGiftconfig");var QDaTingNewGiftconfig=function(){function QDaTingNewGiftconfig(){}return QDaTingNewGiftconfig}();__reflect(QDaTingNewGiftconfig.prototype,"QDaTingNewGiftconfig");var QDaTVipDailyGiftconfig=function(){function QDaTVipDailyGiftconfig(){}return QDaTVipDailyGiftconfig}();__reflect(QDaTVipDailyGiftconfig.prototype,"QDaTVipDailyGiftconfig");var QDaTVipLevelGiftconfig=function(){function QDaTVipLevelGiftconfig(){}return QDaTVipLevelGiftconfig}();__reflect(QDaTVipLevelGiftconfig.prototype,"QDaTVipLevelGiftconfig");var QDaTVipNewGiftconfig=function(){function QDaTVipNewGiftconfig(){}return QDaTVipNewGiftconfig}();__reflect(QDaTVipNewGiftconfig.prototype,"QDaTVipNewGiftconfig");var QzoneDailyGiftconfig=function(){function QzoneDailyGiftconfig(){}return QzoneDailyGiftconfig}();__reflect(QzoneDailyGiftconfig.prototype,"QzoneDailyGiftconfig");var QzoneLevelGiftconfig=function(){function QzoneLevelGiftconfig(){}return QzoneLevelGiftconfig}();__reflect(QzoneLevelGiftconfig.prototype,"QzoneLevelGiftconfig");var QzoneNewGiftconfig=function(){function QzoneNewGiftconfig(){}return QzoneNewGiftconfig}();__reflect(QzoneNewGiftconfig.prototype,"QzoneNewGiftconfig");var QzoneShareConfig=function(){function QzoneShareConfig(){}return QzoneShareConfig}();__reflect(QzoneShareConfig.prototype,"QzoneShareConfig");var QzoneTeqGiftconfig=function(){function QzoneTeqGiftconfig(){}return QzoneTeqGiftconfig}();__reflect(QzoneTeqGiftconfig.prototype,"QzoneTeqGiftconfig");var QzVipDailyGiftconfig=function(){function QzVipDailyGiftconfig(){}return QzVipDailyGiftconfig}();__reflect(QzVipDailyGiftconfig.prototype,"QzVipDailyGiftconfig");var QzVipLevelGiftconfig=function(){function QzVipLevelGiftconfig(){}return QzVipLevelGiftconfig}();__reflect(QzVipLevelGiftconfig.prototype,"QzVipLevelGiftconfig");var QzVipNewGiftconfig=function(){function QzVipNewGiftconfig(){}return QzVipNewGiftconfig}();__reflect(QzVipNewGiftconfig.prototype,"QzVipNewGiftconfig");var RefinesystemExpConfig=function(){function RefinesystemExpConfig(){}return RefinesystemExpConfig}();__reflect(RefinesystemExpConfig.prototype,"RefinesystemExpConfig");var ReincarnateEquip=function(){function ReincarnateEquip(){}return ReincarnateEquip}();__reflect(ReincarnateEquip.prototype,"ReincarnateEquip");var ReincarnateEquipCompose=function(){function ReincarnateEquipCompose(){}return ReincarnateEquipCompose}();__reflect(ReincarnateEquipCompose.prototype,"ReincarnateEquipCompose");var ReincarnateSpirit=function(){function ReincarnateSpirit(){}return ReincarnateSpirit}();__reflect(ReincarnateSpirit.prototype,"ReincarnateSpirit");var ReincarnateSuit=function(){function ReincarnateSuit(){}return ReincarnateSuit}();__reflect(ReincarnateSuit.prototype,"ReincarnateSuit");var ReincarnationBase=function(){function ReincarnationBase(){}return ReincarnationBase}();__reflect(ReincarnationBase.prototype,"ReincarnationBase");var ReincarnationExchange=function(){function ReincarnationExchange(){}return ReincarnationExchange}();__reflect(ReincarnationExchange.prototype,"ReincarnationExchange");var ReincarnationLevel=function(){function ReincarnationLevel(){}return ReincarnationLevel}();__reflect(ReincarnationLevel.prototype,"ReincarnationLevel");var RobberfbConfig=function(){function RobberfbConfig(){}return RobberfbConfig}();__reflect(RobberfbConfig.prototype,"RobberfbConfig");var RoleConfig=function(){function RoleConfig(){this.level=0;this.job=0;this.hp=0;this.mp=0;this.atk=0;this.def=0;this.res=0;this.crit=0;this.tough=0;this.as=0;this.ms=0;this.acrit=0}return RoleConfig}();__reflect(RoleConfig.prototype,"RoleConfig");var RollMapBaseConfig=function(){function RollMapBaseConfig(){}return RollMapBaseConfig}();__reflect(RollMapBaseConfig.prototype,"RollMapBaseConfig");var RollMapGridConfig=function(){function RollMapGridConfig(){}return RollMapGridConfig}();__reflect(RollMapGridConfig.prototype,"RollMapGridConfig");var RollMapRankAwardConfig=function(){function RollMapRankAwardConfig(){}return RollMapRankAwardConfig}();__reflect(RollMapRankAwardConfig.prototype,"RollMapRankAwardConfig");var RongLuExpConfig=function(){function RongLuExpConfig(){}return RongLuExpConfig}();__reflect(RongLuExpConfig.prototype,"RongLuExpConfig");var RongLuLevelConfig=function(){function RongLuLevelConfig(){}return RongLuLevelConfig}();__reflect(RongLuLevelConfig.prototype,"RongLuLevelConfig");var RuneAttrTypeConfig=function(){function RuneAttrTypeConfig(){this.type=0}return RuneAttrTypeConfig}();__reflect(RuneAttrTypeConfig.prototype,"RuneAttrTypeConfig");var RuneBaseConfig=function(){function RuneBaseConfig(){this.id=0;this.type=0;this.expend=0;this.gain=0;this.chip=0;this.attr=[];this.equipAttr=[];this.exAttr=[];this.specialAttr=[];this.specialDesc=null;this.power=0}return RuneBaseConfig}();__reflect(RuneBaseConfig.prototype,"RuneBaseConfig");var RuneComposeConfig=function(){function RuneComposeConfig(){}return RuneComposeConfig}();__reflect(RuneComposeConfig.prototype,"RuneComposeConfig");var RuneConverConfig=function(){function RuneConverConfig(){this.id=0;this.checkpoint=0;this.conversion=0}return RuneConverConfig}();__reflect(RuneConverConfig.prototype,"RuneConverConfig");var RuneLockPosConfig=function(){function RuneLockPosConfig(){this.pos=0;this.lockLv=0}return RuneLockPosConfig}();__reflect(RuneLockPosConfig.prototype,"RuneLockPosConfig");var RuneNameConfig=function(){function RuneNameConfig(){this.type=0;this.runeName=""}return RuneNameConfig}();__reflect(RuneNameConfig.prototype,"RuneNameConfig");var RuneOtherConfig=function(){function RuneOtherConfig(){this.zsLevel=0;this.maxEquip=0;this.maxQuality=0;this.maxDecompose=5}return RuneOtherConfig}();__reflect(RuneOtherConfig.prototype,"RuneOtherConfig");var ScenesConfig=function(){function ScenesConfig(){this.turn=0;this.autoPunch=0}return ScenesConfig}();__reflect(ScenesConfig.prototype,"ScenesConfig");var ServerTips=function(){function ServerTips(){}return ServerTips}();__reflect(ServerTips.prototype,"ServerTips");var ShapeShiftingBaseConfig=function(){function ShapeShiftingBaseConfig(){}return ShapeShiftingBaseConfig}();__reflect(ShapeShiftingBaseConfig.prototype,"ShapeShiftingBaseConfig");var ShapeShiftingConfig=function(){function ShapeShiftingConfig(){}return ShapeShiftingConfig}();__reflect(ShapeShiftingConfig.prototype,"ShapeShiftingConfig");var ShapeShiftingGiftConfig=function(){function ShapeShiftingGiftConfig(){}return ShapeShiftingGiftConfig}();__reflect(ShapeShiftingGiftConfig.prototype,"ShapeShiftingGiftConfig");var ShapeShiftingLevelConfig=function(){function ShapeShiftingLevelConfig(){}return ShapeShiftingLevelConfig}();__reflect(ShapeShiftingLevelConfig.prototype,"ShapeShiftingLevelConfig");var ShapeShiftingPropConfig=function(){function ShapeShiftingPropConfig(){}return ShapeShiftingPropConfig}();__reflect(ShapeShiftingPropConfig.prototype,"ShapeShiftingPropConfig");var ShapeShiftingRandomStoreConfig=function(){function ShapeShiftingRandomStoreConfig(){this.origPrice=0}return ShapeShiftingRandomStoreConfig}();__reflect(ShapeShiftingRandomStoreConfig.prototype,"ShapeShiftingRandomStoreConfig");var ShapeShiftingStoreConfig=function(){function ShapeShiftingStoreConfig(){}return ShapeShiftingStoreConfig}();__reflect(ShapeShiftingStoreConfig.prototype,"ShapeShiftingStoreConfig");var ShapeShiftingTaskAwardsConfig=function(){function ShapeShiftingTaskAwardsConfig(){}return ShapeShiftingTaskAwardsConfig}();__reflect(ShapeShiftingTaskAwardsConfig.prototype,"ShapeShiftingTaskAwardsConfig");var ShapeShiftingTaskConfig=function(){function ShapeShiftingTaskConfig(){}return ShapeShiftingTaskConfig}();__reflect(ShapeShiftingTaskConfig.prototype,"ShapeShiftingTaskConfig");var ShapeShiftingTreasureConfig=function(){function ShapeShiftingTreasureConfig(){}return ShapeShiftingTreasureConfig}();__reflect(ShapeShiftingTreasureConfig.prototype,"ShapeShiftingTreasureConfig");var ShapeShiftingTreasureRewardConfig=function(){function ShapeShiftingTreasureRewardConfig(){}return ShapeShiftingTreasureRewardConfig}();__reflect(ShapeShiftingTreasureRewardConfig.prototype,"ShapeShiftingTreasureRewardConfig");var ShenShouBase=function(){function ShenShouBase(){}return ShenShouBase}();__reflect(ShenShouBase.prototype,"ShenShouBase");var ShieldConfig=function(){function ShieldConfig(){}return ShieldConfig}();__reflect(ShieldConfig.prototype,"ShieldConfig");var ShieldStageConfig=function(){function ShieldStageConfig(){this.stage=0;this.icon="";this.normalCost=0;this.attr=[];this.normalCostTip=0}return ShieldStageConfig}();__reflect(ShieldStageConfig.prototype,"ShieldStageConfig");var StoreCommonConfig=function(){function StoreCommonConfig(){}return StoreCommonConfig}();__reflect(StoreCommonConfig.prototype,"StoreCommonConfig");var ShoppingGiftConfig=function(){function ShoppingGiftConfig(){}return ShoppingGiftConfig}();__reflect(ShoppingGiftConfig.prototype,"ShoppingGiftConfig");var SkillPowerConfig=function(){function SkillPowerConfig(){}return SkillPowerConfig}();__reflect(SkillPowerConfig.prototype,"SkillPowerConfig");var SkillsOpenConfig=function(){function SkillsOpenConfig(){}return SkillsOpenConfig}();__reflect(SkillsOpenConfig.prototype,"SkillsOpenConfig");var SkillsUpgradeConfig=function(){function SkillsUpgradeConfig(){}return SkillsUpgradeConfig}();__reflect(SkillsUpgradeConfig.prototype,"SkillsUpgradeConfig");var SkirmishBaseConfig=function(){function SkirmishBaseConfig(){}return SkirmishBaseConfig}();__reflect(SkirmishBaseConfig.prototype,"SkirmishBaseConfig");var SkirmishRankConfig=function(){function SkirmishRankConfig(){}return SkirmishRankConfig}();__reflect(SkirmishRankConfig.prototype,"SkirmishRankConfig");var SkirmishRewardConfig=function(){function SkirmishRewardConfig(){}return SkirmishRewardConfig}();__reflect(SkirmishRewardConfig.prototype,"SkirmishRewardConfig");var SmallExpressionConf=function(){function SmallExpressionConf(){}return SmallExpressionConf}();__reflect(SmallExpressionConf.prototype,"SmallExpressionConf");var SmallGameBaseConfig=function(){function SmallGameBaseConfig(){}return SmallGameBaseConfig}();__reflect(SmallGameBaseConfig.prototype,"SmallGameBaseConfig");var SpecialEquipsConfig=function(){function SpecialEquipsConfig(){}return SpecialEquipsConfig}();__reflect(SpecialEquipsConfig.prototype,"SpecialEquipsConfig");var FitleStyle;(function(FitleStyle){FitleStyle[FitleStyle["fj"]=1]="fj";FitleStyle[FitleStyle["hc"]=2]="hc"})(FitleStyle||(FitleStyle={}));window["FitleStyle"]=FitleStyle;var StoneLevelConfig=function(){function StoneLevelConfig(){}return StoneLevelConfig}();__reflect(StoneLevelConfig.prototype,"StoneLevelConfig");var StoneLevelCostConfig=function(){function StoneLevelCostConfig(){}return StoneLevelCostConfig}();__reflect(StoneLevelCostConfig.prototype,"StoneLevelCostConfig");var StoneOpenConfig=function(){function StoneOpenConfig(){}return StoneOpenConfig}();__reflect(StoneOpenConfig.prototype,"StoneOpenConfig");var StrategyConfig=function(){function StrategyConfig(){}return StrategyConfig}();__reflect(StrategyConfig.prototype,"StrategyConfig");var StrategyRewardConfig=function(){function StrategyRewardConfig(){}return StrategyRewardConfig}();__reflect(StrategyRewardConfig.prototype,"StrategyRewardConfig");var StrengthLvZhanLiConfig=function(){function StrengthLvZhanLiConfig(){}return StrengthLvZhanLiConfig}();__reflect(StrengthLvZhanLiConfig.prototype,"StrengthLvZhanLiConfig");var StrengthRoleTaskConfig=function(){function StrengthRoleTaskConfig(){}return StrengthRoleTaskConfig}();__reflect(StrengthRoleTaskConfig.prototype,"StrengthRoleTaskConfig");var StrengthTargetIconConfig=function(){function StrengthTargetIconConfig(){}return StrengthTargetIconConfig}();__reflect(StrengthTargetIconConfig.prototype,"StrengthTargetIconConfig");var SuitConfig=function(){function SuitConfig(){}return SuitConfig}();__reflect(SuitConfig.prototype,"SuitConfig");var SwordSkinConfig=function(){function SwordSkinConfig(){}return SwordSkinConfig}();__reflect(SwordSkinConfig.prototype,"SwordSkinConfig");var SwordSkinGiftConfig=function(){function SwordSkinGiftConfig(){}return SwordSkinGiftConfig}();__reflect(SwordSkinGiftConfig.prototype,"SwordSkinGiftConfig");var SwordSkinLevelConfig=function(){function SwordSkinLevelConfig(){}return SwordSkinLevelConfig}();__reflect(SwordSkinLevelConfig.prototype,"SwordSkinLevelConfig");var SystemTaskConfig=function(){function SystemTaskConfig(){}return SystemTaskConfig}();__reflect(SystemTaskConfig.prototype,"SystemTaskConfig");var TeamFuBenBaseConfig=function(){function TeamFuBenBaseConfig(){}return TeamFuBenBaseConfig}();__reflect(TeamFuBenBaseConfig.prototype,"TeamFuBenBaseConfig");var TeamFuBenConfig=function(){function TeamFuBenConfig(){}return TeamFuBenConfig}();__reflect(TeamFuBenConfig.prototype,"TeamFuBenConfig");var TeamFuBenGuideConfig=function(){function TeamFuBenGuideConfig(){}return TeamFuBenGuideConfig}();__reflect(TeamFuBenGuideConfig.prototype,"TeamFuBenGuideConfig");var TGuideBaseConfig=function(){function TGuideBaseConfig(){}return TGuideBaseConfig}();__reflect(TGuideBaseConfig.prototype,"TGuideBaseConfig");var TGuideDetailConfig=function(){function TGuideDetailConfig(){}return TGuideDetailConfig}();__reflect(TGuideDetailConfig.prototype,"TGuideDetailConfig");var TianTiConstConfig=function(){function TianTiConstConfig(){}return TianTiConstConfig}();__reflect(TianTiConstConfig.prototype,"TianTiConstConfig");var TianTiDanConfig=function(){function TianTiDanConfig(){}return TianTiDanConfig}();__reflect(TianTiDanConfig.prototype,"TianTiDanConfig");var TicketChainConfig=function(){function TicketChainConfig(){}return TicketChainConfig}();__reflect(TicketChainConfig.prototype,"TicketChainConfig");var TicketDaoHangLvConfig=function(){function TicketDaoHangLvConfig(){}return TicketDaoHangLvConfig}();__reflect(TicketDaoHangLvConfig.prototype,"TicketDaoHangLvConfig");var TicketItemConfig=function(){function TicketItemConfig(){}return TicketItemConfig}();__reflect(TicketItemConfig.prototype,"TicketItemConfig");var TicketLingShiTreasureConfig=function(){function TicketLingShiTreasureConfig(){}return TicketLingShiTreasureConfig}();__reflect(TicketLingShiTreasureConfig.prototype,"TicketLingShiTreasureConfig");var TicketLingShiTreasureRewardConfig=function(){function TicketLingShiTreasureRewardConfig(){}return TicketLingShiTreasureRewardConfig}();__reflect(TicketLingShiTreasureRewardConfig.prototype,"TicketLingShiTreasureRewardConfig");var TicketPageTitles=function(){function TicketPageTitles(){}return TicketPageTitles}();__reflect(TicketPageTitles.prototype,"TicketPageTitles");var TicketPeriodRewardConfig=function(){function TicketPeriodRewardConfig(){}return TicketPeriodRewardConfig}();__reflect(TicketPeriodRewardConfig.prototype,"TicketPeriodRewardConfig");var TicketRewardConfig=function(){function TicketRewardConfig(){}return TicketRewardConfig}();__reflect(TicketRewardConfig.prototype,"TicketRewardConfig");var TimeCardBaseConfig=function(){function TimeCardBaseConfig(){}return TimeCardBaseConfig}();__reflect(TimeCardBaseConfig.prototype,"TimeCardBaseConfig");var TimeCardRewardConfig=function(){function TimeCardRewardConfig(){}return TimeCardRewardConfig}();__reflect(TimeCardRewardConfig.prototype,"TimeCardRewardConfig");var TimeCardTypeConfig=function(){function TimeCardTypeConfig(){}return TimeCardTypeConfig}();__reflect(TimeCardTypeConfig.prototype,"TimeCardTypeConfig");var TitleConf=function(){function TitleConf(){}return TitleConf}();__reflect(TitleConf.prototype,"TitleConf");var TogerherHitBaseConfig=function(){function TogerherHitBaseConfig(){}return TogerherHitBaseConfig}();__reflect(TogerherHitBaseConfig.prototype,"TogerherHitBaseConfig");var TogetherHitConfig=function(){function TogetherHitConfig(){this.level=0}return TogetherHitConfig}();__reflect(TogetherHitConfig.prototype,"TogetherHitConfig");var TogetherHitEquipExchangeConfig=function(){function TogetherHitEquipExchangeConfig(){this.id=0;this.exchangeAmount=0;this.level=0;this.zsLevel=0}return TogetherHitEquipExchangeConfig}();__reflect(TogetherHitEquipExchangeConfig.prototype,"TogetherHitEquipExchangeConfig");var TogetherHitEquipPageConfig=function(){function TogetherHitEquipPageConfig(){this.name=0;this.icon=""}return TogetherHitEquipPageConfig}();__reflect(TogetherHitEquipPageConfig.prototype,"TogetherHitEquipPageConfig");var TogetherHitEquipQmConfig=function(){function TogetherHitEquipQmConfig(){this.num=0;this.lv=0;this.zslv=0;this.desc=""}return TogetherHitEquipQmConfig}();__reflect(TogetherHitEquipQmConfig.prototype,"TogetherHitEquipQmConfig");var TrainBaseConfig=function(){function TrainBaseConfig(){}return TrainBaseConfig}();__reflect(TrainBaseConfig.prototype,"TrainBaseConfig");var TrainDayAwardConfig=function(){function TrainDayAwardConfig(){}return TrainDayAwardConfig}();__reflect(TrainDayAwardConfig.prototype,"TrainDayAwardConfig");var TrainLevelAwardConfig=function(){function TrainLevelAwardConfig(){}return TrainLevelAwardConfig}();__reflect(TrainLevelAwardConfig.prototype,"TrainLevelAwardConfig");var TrainLevelConfig=function(){function TrainLevelConfig(){this.trainName="";this.img=""}return TrainLevelConfig}();__reflect(TrainLevelConfig.prototype,"TrainLevelConfig");var TreasureBoxBaseConfig=function(){function TreasureBoxBaseConfig(){this.moneyCoefficient=3;this.getItemguide=0}return TreasureBoxBaseConfig}();__reflect(TreasureBoxBaseConfig.prototype,"TreasureBoxBaseConfig");var TreasureBoxConfig=function(){function TreasureBoxConfig(){}return TreasureBoxConfig}();__reflect(TreasureBoxConfig.prototype,"TreasureBoxConfig");var TreasureBoxGridConfig=function(){function TreasureBoxGridConfig(){}return TreasureBoxGridConfig}();__reflect(TreasureBoxGridConfig.prototype,"TreasureBoxGridConfig");var TreasureHuntConfig=function(){function TreasureHuntConfig(){}return TreasureHuntConfig}();__reflect(TreasureHuntConfig.prototype,"TreasureHuntConfig");var TreasureHuntPoolConfig=function(){function TreasureHuntPoolConfig(){}return TreasureHuntPoolConfig}();__reflect(TreasureHuntPoolConfig.prototype,"TreasureHuntPoolConfig");var TreasureHuntPoolHefuConfig=function(){function TreasureHuntPoolHefuConfig(){}return TreasureHuntPoolHefuConfig}();__reflect(TreasureHuntPoolHefuConfig.prototype,"TreasureHuntPoolHefuConfig");var TreasureRewardConfig=function(){function TreasureRewardConfig(){}return TreasureRewardConfig}();__reflect(TreasureRewardConfig.prototype,"TreasureRewardConfig");var TupoAttrConfig=function(){function TupoAttrConfig(){}return TupoAttrConfig}();__reflect(TupoAttrConfig.prototype,"TupoAttrConfig");var TupoCostConfig=function(){function TupoCostConfig(){}return TupoCostConfig}();__reflect(TupoCostConfig.prototype,"TupoCostConfig");var UpdateRemindConfig=function(){function UpdateRemindConfig(){}return UpdateRemindConfig}();__reflect(UpdateRemindConfig.prototype,"UpdateRemindConfig");var VipConfig=function(){function VipConfig(){this.boss1buy=0;this.boss2buy=0}return VipConfig}();__reflect(VipConfig.prototype,"VipConfig");var VipGridConfig=function(){function VipGridConfig(){}return VipGridConfig}();__reflect(VipGridConfig.prototype,"VipGridConfig");var WanBaGiftbagBasic=function(){function WanBaGiftbagBasic(){}return WanBaGiftbagBasic}();__reflect(WanBaGiftbagBasic.prototype,"WanBaGiftbagBasic");var WeaponSoulBaseConfig=function(){function WeaponSoulBaseConfig(){this.maxItemNum=0;this.itemid=0}return WeaponSoulBaseConfig}();__reflect(WeaponSoulBaseConfig.prototype,"WeaponSoulBaseConfig");var WeaponSoulConfig=function(){function WeaponSoulConfig(){this.id=1;this.name="";this.actcond=[];this.inside=[];this.outside=[];this.pic=[];this.icon=""}return WeaponSoulConfig}();__reflect(WeaponSoulConfig.prototype,"WeaponSoulConfig");var WeaponSoulItemAttr=function(){function WeaponSoulItemAttr(){this.id=0;this.attr=[]}return WeaponSoulItemAttr}();__reflect(WeaponSoulItemAttr.prototype,"WeaponSoulItemAttr");var WeaponSoulPosConfig=function(){function WeaponSoulPosConfig(){this.id=0;this.level=0;this.costItem=0;this.costNum=0;this.showlv=0}return WeaponSoulPosConfig}();__reflect(WeaponSoulPosConfig.prototype,"WeaponSoulPosConfig");var WeaponSoulSuit=function(){function WeaponSoulSuit(){this.id=0;this.level=0;this.attr=[];this.ex_attr=[];this.skillname="";this.skillicon="";this.skilldesc=""}return WeaponSoulSuit}();__reflect(WeaponSoulSuit.prototype,"WeaponSoulSuit");var WingCommonConfig=function(){function WingCommonConfig(){}return WingCommonConfig}();__reflect(WingCommonConfig.prototype,"WingCommonConfig");var WingLevelConfig=function(){function WingLevelConfig(){this.exp=0;this.pasSkillId=0}return WingLevelConfig}();__reflect(WingLevelConfig.prototype,"WingLevelConfig");var WingStarConfig=function(){function WingStarConfig(){}return WingStarConfig}();__reflect(WingStarConfig.prototype,"WingStarConfig");var WinOpenConfig=function(){function WinOpenConfig(){}return WinOpenConfig}();__reflect(WinOpenConfig.prototype,"WinOpenConfig");var WorldBossBaseConfig=function(){function WorldBossBaseConfig(){this.refreshHour=0;this.refreshMinute=0;this.levelUpTime=0;this.challengeCd=[];this.rebornCd=[];this.convertRate=0;this.maxGold=0;this.clearCdCost=[];this.lotteryTime=0;this.dayCount=[];this.buyCountPrice=[];this.rebornItem=0}return WorldBossBaseConfig}();__reflect(WorldBossBaseConfig.prototype,"WorldBossBaseConfig");var WorldBossConfig=function(){function WorldBossConfig(){this.zsLevel=0;this.level=0;this.fbid=0;this.bossId=0;this.shield=0;this.joinReward=0;this.shieldReward=0;this.belongReward=0;this.killReward=0;this.vip=0;this.samsaraLv=0}return WorldBossConfig}();__reflect(WorldBossConfig.prototype,"WorldBossConfig");var WorldBossKillMsgConfig=function(){function WorldBossKillMsgConfig(){this.msg="";this.id=0}return WorldBossKillMsgConfig}();__reflect(WorldBossKillMsgConfig.prototype,"WorldBossKillMsgConfig");var WorldRewardConfig=function(){function WorldRewardConfig(){}return WorldRewardConfig}();__reflect(WorldRewardConfig.prototype,"WorldRewardConfig");var XianyuUnlockBase=function(){function XianyuUnlockBase(){}return XianyuUnlockBase}();__reflect(XianyuUnlockBase.prototype,"XianyuUnlockBase");var XueyuStageConfig=function(){function XueyuStageConfig(){this.stage=0;this.icon="";this.normalCost=0;this.attr=[];this.normalCostTip=0}return XueyuStageConfig}();__reflect(XueyuStageConfig.prototype,"XueyuStageConfig");var YouDangConfig=function(){function YouDangConfig(){}return YouDangConfig}();__reflect(YouDangConfig.prototype,"YouDangConfig");var YuPeiBasicConfig=function(){function YuPeiBasicConfig(){}return YuPeiBasicConfig}();__reflect(YuPeiBasicConfig.prototype,"YuPeiBasicConfig");var YuPeiConfig=function(){function YuPeiConfig(){}return YuPeiConfig}();__reflect(YuPeiConfig.prototype,"YuPeiConfig");var ZhanLingBase=function(){function ZhanLingBase(){}return ZhanLingBase}();__reflect(ZhanLingBase.prototype,"ZhanLingBase");var ZhanLingBox=function(){function ZhanLingBox(){}return ZhanLingBox}();__reflect(ZhanLingBox.prototype,"ZhanLingBox");var ZhanLingConfig=function(){function ZhanLingConfig(){}return ZhanLingConfig}();__reflect(ZhanLingConfig.prototype,"ZhanLingConfig");var ZhanLingEquip=function(){function ZhanLingEquip(){}return ZhanLingEquip}();__reflect(ZhanLingEquip.prototype,"ZhanLingEquip");var ZhanLingID=function(){function ZhanLingID(){}return ZhanLingID}();__reflect(ZhanLingID.prototype,"ZhanLingID");var ZhanLingLevel=function(){function ZhanLingLevel(){}return ZhanLingLevel}();__reflect(ZhanLingLevel.prototype,"ZhanLingLevel");var ZhanLingSkill=function(){function ZhanLingSkill(){}return ZhanLingSkill}();__reflect(ZhanLingSkill.prototype,"ZhanLingSkill");var ZhanLingStage=function(){function ZhanLingStage(){}return ZhanLingStage}();__reflect(ZhanLingStage.prototype,"ZhanLingStage");var ZhanLingSuit=function(){function ZhanLingSuit(){}return ZhanLingSuit}();__reflect(ZhanLingSuit.prototype,"ZhanLingSuit");var ZhanLingTalent=function(){function ZhanLingTalent(){}return ZhanLingTalent}();__reflect(ZhanLingTalent.prototype,"ZhanLingTalent");var ZhiZunEquipLevel=function(){function ZhiZunEquipLevel(){this.ex_power=0}return ZhiZunEquipLevel}();__reflect(ZhiZunEquipLevel.prototype,"ZhiZunEquipLevel");var ZhiZunLinkLevel=function(){function ZhiZunLinkLevel(){this.ex_power=0}return ZhiZunLinkLevel}();__reflect(ZhiZunLinkLevel.prototype,"ZhiZunLinkLevel");var ZhuangBanConfig=function(){function ZhuangBanConfig(){}return ZhuangBanConfig}();__reflect(ZhuangBanConfig.prototype,"ZhuangBanConfig");var ZhuangBanId=function(){function ZhuangBanId(){this.isShow=1}return ZhuangBanId}();__reflect(ZhuangBanId.prototype,"ZhuangBanId");var ZhuangBanTrial=function(){function ZhuangBanTrial(){}return ZhuangBanTrial}();__reflect(ZhuangBanTrial.prototype,"ZhuangBanTrial");var ZhuanShengConfig=function(){function ZhuanShengConfig(){}return ZhuanShengConfig}();__reflect(ZhuanShengConfig.prototype,"ZhuanShengConfig");var ZhuanShengExpConfig=function(){function ZhuanShengExpConfig(){}return ZhuanShengExpConfig}();__reflect(ZhuanShengExpConfig.prototype,"ZhuanShengExpConfig");var ZhuanShengLevelConfig=function(){function ZhuanShengLevelConfig(){}return ZhuanShengLevelConfig}();__reflect(ZhuanShengLevelConfig.prototype,"ZhuanShengLevelConfig");var ZhulingAttrConfig=function(){function ZhulingAttrConfig(){}return ZhulingAttrConfig}();__reflect(ZhulingAttrConfig.prototype,"ZhulingAttrConfig");var ZhulingCostConfig=function(){function ZhulingCostConfig(){this.level=1;this.itemId=1;this.count=1}return ZhulingCostConfig}();__reflect(ZhulingCostConfig.prototype,"ZhulingCostConfig");var ItemConst;(function(ItemConst){ItemConst.RENAME=450001;ItemConst.EXP_ITEM=200137;ItemConst.GUANYIN_ITEM=600005;ItemConst.LEVELUP_ITEM=200155;ItemConst.GOLD_BRICK=200164;ItemConst.TREASURE_ITEM=200165;ItemConst.TREASURE_RUNE=200166;ItemConst.PUBLICBOSS=200156;ItemConst.WORLDBOSS=200157;ItemConst.FIRE_FB=202e3;ItemConst.GODWING_ITEM=601e3;ItemConst.THANKS_ITEM=0;ItemConst.SHENYUBOSS=200995;ItemConst.WEIWANG_ITEM=200318;ItemConst.GODWEAPON_ITEM=200333;ItemConst.JINGJIN=200332})(ItemConst||(ItemConst={}));window["ItemConst"]=ItemConst;var ItemType;(function(ItemType){ItemType[ItemType["TYPE_0"]=0]="TYPE_0";ItemType[ItemType["TYPE_1"]=1]="TYPE_1";ItemType[ItemType["TYPE_2"]=2]="TYPE_2";ItemType[ItemType["TYPE_3"]=3]="TYPE_3";ItemType[ItemType["TYPE_4"]=4]="TYPE_4";ItemType[ItemType["TYPE_5"]=5]="TYPE_5";ItemType[ItemType["TYPE_6"]=6]="TYPE_6";ItemType[ItemType["TYPE_7"]=7]="TYPE_7";ItemType[ItemType["TYPE_8"]=8]="TYPE_8";ItemType[ItemType["TYPE_9"]=9]="TYPE_9";ItemType[ItemType["TYPE_10"]=10]="TYPE_10";ItemType[ItemType["TYPE_11"]=11]="TYPE_11";ItemType[ItemType["TYPE_12"]=12]="TYPE_12";ItemType[ItemType["TYPE_13"]=13]="TYPE_13";ItemType[ItemType["TYPE_14"]=14]="TYPE_14";ItemType[ItemType["TYPE_15"]=15]="TYPE_15";ItemType[ItemType["TYPE_16"]=16]="TYPE_16";ItemType[ItemType["TYPE_17"]=17]="TYPE_17";ItemType[ItemType["TYPE_18"]=18]="TYPE_18";ItemType[ItemType["TYPE_19"]=19]="TYPE_19";ItemType[ItemType["TYPE_20"]=20]="TYPE_20";ItemType[ItemType["TYPE_21"]=21]="TYPE_21";ItemType[ItemType["TYPE_22"]=22]="TYPE_22";ItemType[ItemType["TYPE_23"]=23]="TYPE_23";ItemType[ItemType["TYPE_24"]=24]="TYPE_24";ItemType[ItemType["TYPE_25"]=25]="TYPE_25";ItemType[ItemType["TYPE_26"]=26]="TYPE_26";ItemType[ItemType["TYPE_27"]=27]="TYPE_27";ItemType[ItemType["TYPE_28"]=28]="TYPE_28"})(ItemType||(ItemType={}));window["ItemType"]=ItemType;var JobConst;(function(JobConst){JobConst[JobConst["None"]=0]="None";JobConst[JobConst["ZhanShi"]=1]="ZhanShi";JobConst[JobConst["FaShi"]=2]="FaShi";JobConst[JobConst["DaoShi"]=3]="DaoShi"})(JobConst||(JobConst={}));window["JobConst"]=JobConst;var MoneyConst;(function(MoneyConst){MoneyConst[MoneyConst["exp"]=0]="exp";MoneyConst[MoneyConst["gold"]=1]="gold";MoneyConst[MoneyConst["yuanbao"]=2]="yuanbao";MoneyConst[MoneyConst["fame"]=3]="fame";MoneyConst[MoneyConst["soul"]=4]="soul";MoneyConst[MoneyConst["wing"]=5]="wing";MoneyConst[MoneyConst["feat"]=7]="feat";MoneyConst[MoneyConst["rune"]=9]="rune";MoneyConst[MoneyConst["piece"]=10]="piece";MoneyConst[MoneyConst["punch1"]=11]="punch1";MoneyConst[MoneyConst["punch2"]=12]="punch2";MoneyConst[MoneyConst["godweaponExp"]=13]="godweaponExp";MoneyConst[MoneyConst["weiWang"]=14]="weiWang";MoneyConst[MoneyConst["chip"]=15]="chip";MoneyConst[MoneyConst["shoushenExp"]=16]="shoushenExp";MoneyConst[MoneyConst["ssChip"]=17]="ssChip";MoneyConst[MoneyConst["lingShi"]=18]="lingShi";MoneyConst[MoneyConst["ssExp"]=19]="ssExp";MoneyConst[MoneyConst["daoheng"]=20]="daoheng"})(MoneyConst||(MoneyConst={}));window["MoneyConst"]=MoneyConst;var skillConst=function(){function skillConst(){}skillConst.baseSkillIndex=[11,21,31];return skillConst}();__reflect(skillConst.prototype,"skillConst");var SkillEffNumType;(function(SkillEffNumType){SkillEffNumType[SkillEffNumType["Single"]=0]="Single";SkillEffNumType[SkillEffNumType["All"]=1]="All";SkillEffNumType[SkillEffNumType["NoEff"]=2]="NoEff";SkillEffNumType[SkillEffNumType["SelfAndTarget"]=3]="SelfAndTarget"})(SkillEffNumType||(SkillEffNumType={}));window["SkillEffNumType"]=SkillEffNumType;var castType;(function(castType){castType[castType["Friend"]=1]="Friend";castType[castType["Other"]=2]="Other";castType[castType["Self"]=3]="Self";castType[castType["SelfHpLess"]=4]="SelfHpLess"})(castType||(castType={}));window["castType"]=castType;var SystemType;(function(SystemType){SystemType[SystemType["FIRSTCHARGE"]=1]="FIRSTCHARGE";SystemType[SystemType["ACTIVITY"]=2]="ACTIVITY";SystemType[SystemType["RANK"]=3]="RANK";SystemType[SystemType["MALL"]=4]="MALL";SystemType[SystemType["FULI"]=5]="FULI";SystemType[SystemType["MONTHCARD"]=6]="MONTHCARD";SystemType[SystemType["TREASURE"]=7]="TREASURE";SystemType[SystemType["WORLDMAP"]=8]="WORLDMAP";SystemType[SystemType["RING"]=9]="RING";SystemType[SystemType["MIJI"]=10]="MIJI";SystemType[SystemType["BOSS"]=11]="BOSS";SystemType[SystemType["FB"]=12]="FB";SystemType[SystemType["ONEKEY"]=13]="ONEKEY";SystemType[SystemType["CHALLENGE"]=14]="CHALLENGE";SystemType[SystemType["SHENQIGUIDE"]=15]="SHENQIGUIDE";SystemType[SystemType["BOOK"]=16]="BOOK";SystemType[SystemType["WEAPONS"]=17]="WEAPONS";SystemType[SystemType["GUILD"]=18]="GUILD";SystemType[SystemType["VIPGIFT"]=19]="VIPGIFT";SystemType[SystemType["LIMITTASK"]=20]="LIMITTASK";SystemType[SystemType["FOCUS"]=21]="FOCUS";SystemType[SystemType["SHARE"]=22]="SHARE";SystemType[SystemType["FENGCE"]=23]="FENGCE";SystemType[SystemType["DAILYGIFT"]=24]="DAILYGIFT";SystemType[SystemType["QUICKDROP"]=25]="QUICKDROP";SystemType[SystemType["MABI"]=26]="MABI";SystemType[SystemType["NEWEQUIP"]=27]="NEWEQUIP";SystemType[SystemType["CITYMONSTER"]=28]="CITYMONSTER";SystemType[SystemType["DOUBLEELEVEN"]=29]="DOUBLEELEVEN";SystemType[SystemType["GODWEAPON"]=30]="GODWEAPON";SystemType[SystemType["SUPERVIP"]=31]="SUPERVIP";SystemType[SystemType["CITY"]=32]="CITY";SystemType[SystemType["THANKS"]=33]="THANKS";SystemType[SystemType["HFACTIVITY"]=34]="HFACTIVITY";SystemType[SystemType["DOUBLE_TWELVE"]=35]="DOUBLE_TWELVE";SystemType[SystemType["DOUBLE_TWELVE_RECHARGE"]=36]="DOUBLE_TWELVE_RECHARGE";SystemType[SystemType["BATTLE"]=37]="BATTLE";SystemType[SystemType["PAODIAN"]=38]="PAODIAN";SystemType[SystemType["CHRISTMAS"]=39]="CHRISTMAS";SystemType[SystemType["NEWYEAR"]=40]="NEWYEAR";SystemType[SystemType["HAPPYSEVENDAY"]=41]="HAPPYSEVENDAY";SystemType[SystemType["CELEBRATION"]=42]="CELEBRATION";SystemType[SystemType["CHAT"]=43]="CHAT";SystemType[SystemType["ZHIZUN"]=44]="ZHIZUN";SystemType[SystemType["LABA"]=45]="LABA";SystemType[SystemType["SPRINGBEGIN"]=46]="SPRINGBEGIN";SystemType[SystemType["ZHANLING"]=47]="ZHANLING";SystemType[SystemType["XIAONIAN"]=48]="XIAONIAN";SystemType[SystemType["SPRINGFESTIVAL"]=49]="SPRINGFESTIVAL";SystemType[SystemType["SPRINGEIGHTDAY"]=50]="SPRINGEIGHTDAY";SystemType[SystemType["KAIMENHONG"]=51]="KAIMENHONG";SystemType[SystemType["SANBA"]=52]="SANBA";SystemType[SystemType["LONGTAITOU"]=53]="LONGTAITOU";SystemType[SystemType["VERSIONCEL"]=54]="VERSIONCEL";SystemType[SystemType["DUANWU"]=55]="DUANWU";SystemType[SystemType["CONSUMREWARD"]=56]="CONSUMREWARD";SystemType[SystemType["CHAOZHIHOUHUI"]=57]="CHAOZHIHOUHUI";SystemType[SystemType["ZEROPURCHASE"]=58]="ZEROPURCHASE";SystemType[SystemType["HEIRLOOM"]=59]="HEIRLOOM";SystemType[SystemType["XIANGOUSHANGDIAN"]=60]="XIANGOUSHANGDIAN";SystemType[SystemType["CHONGBANG"]=61]="CHONGBANG";SystemType[SystemType["TIMECARD"]=62]="TIMECARD";SystemType[SystemType["BattleGround"]=88]="BattleGround"})(SystemType||(SystemType={}));window["SystemType"]=SystemType;var BossUIBtnItem=function(_super){__extends(BossUIBtnItem,_super);function BossUIBtnItem(){var _this=_super.call(this)||this;_this.skinName="worldBossAtbtn";return _this}Object.defineProperty(BossUIBtnItem.prototype,"className",{get:function(){return this._className},set:function(v){this._className=v},enumerable:true,configurable:true});return BossUIBtnItem}(eui.Component);__reflect(BossUIBtnItem.prototype,"BossUIBtnItem");var DefeatItem=function(_super){__extends(DefeatItem,_super);function DefeatItem(){var _this=_super.call(this)||this;_this.skinName="DefeatItemSkin";_this.init();return _this}DefeatItem.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);var str="|U&S:"+this.jump.size+"&C:"+this.jump.textColor+"&T:"+this.jump.text+"|";this.jump.textFlow=TextFlowMaker.generateTextFlow1(str)};DefeatItem.prototype.onClick=function(e){switch(e.target){case this.openRole0:case this.jump:this.showDetail();break}};DefeatItem.prototype.showDetail=function(){if(this.cfg){if(ViewManager.ins().isShow(MaterialResultWin)){ViewManager.ins().close(MaterialResultWin)}else if(ViewManager.ins().isShow(TongResultWin)){ViewManager.ins().close(TongResultWin)}else if(ViewManager.ins().isShow(CityResultWin)){ViewManager.ins().close(CityResultWin)}else if(ViewManager.ins().isShow(NewWorldBossResultPanel)){ViewManager.ins().close(NewWorldBossResultPanel)}else if(ViewManager.ins().isShow(BossResultWin)){ViewManager.ins().close(BossResultWin)}else if(ViewManager.ins().isShow(PersonalResultWin)){ViewManager.ins().close(PersonalResultWin)}else if(ViewManager.ins().isShow(HardFbResultWin)){ViewManager.ins().close(HardFbResultWin)}else{ViewManager.ins().close(ResultWin)}if(this.cfg.gainWay[1]=="VipWin"){ViewManager.ins().open(this.cfg.gainWay[1],UserVip.ins().lv+1)}else{ViewManager.ins().open(this.cfg.gainWay[1],this.cfg.gainWay[2])}}};DefeatItem.prototype.dataChanged=function(){if(!isNaN(this.data)){this.cfg=null;var cfg=void 0;for(var i in GlobalConfig.DeathgainWayConfig){cfg=GlobalConfig.DeathgainWayConfig[i];if(cfg.level==this.data){this.cfg=cfg;break}}var roleId=16;var vipId=20;var strengthId=22;if(this.cfg){if(this.cfg.level==14){var rch=Recharge.ins().getRechargeData(0);if(rch.num&&rch.num!=2){this.cfg=GlobalConfig.DeathgainWayConfig[vipId]}}this.icon.scaleX=this.icon.scaleY=1;this.icon.y=3;var level=this.cfg.level;if(level==vipId){this.icon.scaleX=this.icon.scaleY=.8}else if(level==roleId){this.icon.scaleX=this.icon.scaleY=1}else if(level==strengthId){this.icon.scaleX=this.icon.scaleY=1;this.icon.y=-32}this.icon.source=this.cfg.itemId;this.iconName.text=this.cfg.gainWay[0];var count=void 0;var len=void 0;var b=false;var head="siwangyd";this.desc.visible=false;this.up.visible=this.desc.visible}if(this.data==roleId||this.data==strengthId){if(!this.mc)this.mc=new MovieClip;if(!this.mc.parent){this.jump.parent.addChild(this.mc);this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.mc.touchEnabled=false}this.mc.x=this.jump.x+18;this.mc.y=this.jump.y+9;this.mc.scaleX=this.mc.scaleY=.4}}};DefeatItem.prototype.and=function(list){for(var k in list){if(list[k]==true)return true}return false};return DefeatItem}(BaseItemRender);__reflect(DefeatItem.prototype,"DefeatItem");var DropDown=function(_super){__extends(DropDown,_super);function DropDown(){return _super.call(this)||this}DropDown.prototype.childrenCreated=function(){this.init()};DropDown.prototype.init=function(){this.touchEnabled=true;this.currentState="up";this.addChangeEvent(this.list,this.listSelect);this.addTouchEvent(this,this.onTap);this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this);this.dataPro=new eui.ArrayCollection;this.list.itemRenderer=DropDownListItem;this.list.dataProvider=this.dataPro};DropDown.prototype.listSelect=function(e){this.value.text=this.list.selectedItem.name};DropDown.prototype.removeStage=function(e){if(this.stage)this.removeTouchEvent(this.stage,this.onTap)};DropDown.prototype.onTap=function(e){this.currentState=this.currentState=="up"?"down":"up";e.stopPropagation();if(this.stage){if(this.currentState=="down")this.addTouchEvent(this.stage,this.onTap);else this.removeTouchEvent(this.stage,this.onTap)}};DropDown.prototype.setData=function(data){this.dataPro.replaceAll(data)};DropDown.prototype.setSelectedIndex=function(value){this.list.selectedIndex=value};DropDown.prototype.getSelectedIndex=function(){return this.list.selectedIndex};DropDown.prototype.setLabel=function(str){this.value.text=str};DropDown.prototype.getLabel=function(){return this.value.text};DropDown.prototype.setEnabled=function(b){this.list.touchEnabled=b;this.list.touchChildren=b};DropDown.prototype.getEnabled=function(){return this.list.touchEnabled};DropDown.prototype.destructor=function(){this.list.removeEventListener(egret.Event.CHANGE,this.listSelect,this);this.removeTouchEvent(this,this.onTap);this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this);this.removeStage()};return DropDown}(BaseComponent);__reflect(DropDown.prototype,"DropDown");var DropDownListItem=function(_super){__extends(DropDownListItem,_super);function DropDownListItem(){return _super.call(this)||this}DropDownListItem.prototype.dataChanged=function(){this.nameLbl.text=this.data.name};return DropDownListItem}(BaseItemRender);__reflect(DropDownListItem.prototype,"DropDownListItem");var EncounterInfoItem=function(_super){__extends(EncounterInfoItem,_super);function EncounterInfoItem(){var _this=_super.call(this)||this;_this.skinName="ZaoYuInfoItem";return _this}EncounterInfoItem.prototype.createChildren=function(){_super.prototype.createChildren.call(this);this.nameTxt.text="";this.moneyTxt.text="";this.expTxt.text="";this.soulTxt.text="";this.challengeBtn.touchChildren=false};EncounterInfoItem.prototype.updateTime=function(){};EncounterInfoItem.prototype.dataChanged=function(){if(this.data){var data=this.data;this.currentState="have";var lv=data.zsLv>0?data.zsLv*1e3:Math.min(data.lv,80);var config=GlobalConfig.SkirmishRewardConfig[lv];this.nameTxt.text=""+data.name;var zhuanStr=data.zsLv?i18n("EncounterInfoItem_2",data.zsLv):"";this.nameTxt0.text=i18n("EncounterInfoItem_3",zhuanStr,data.lv);this.moneyTxt.text=config.rewards.gold+"";this.expTxt.text=config.rewards.exp+"";this.soulTxt.text=config.rewards.essence+"";var job=fixJob(data.subRole[0].job);var sex=fixSex(data.subRole[0].sex);this.face.source="head_"+job+sex;this.headBG.source="touxiangkuang"+sex;if(EncounterFight.ins().encounterIndex!=data.index)this.challengeBtn.label=i18n("EncounterInfoItem_4");else this.challengeBtn.label=i18n("EncounterInfoItem_5")}else{this.currentState="none";this.nameTxt0.text=i18n("EncounterInfoItem_6")}};return EncounterInfoItem}(BaseItemRender);__reflect(EncounterInfoItem.prototype,"EncounterInfoItem");var EquipTipsBase=function(_super){__extends(EquipTipsBase,_super);function EquipTipsBase(){var _this=_super.call(this)||this;_this.skinName="UsualEquipTipsSkin";return _this}EquipTipsBase.prototype.otherClose=function(e){ViewManager.ins().close(this)};EquipTipsBase.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.func)this.removeEventListener(egret.TouchEvent.TOUCH_END,this.func,this)};EquipTipsBase.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.itemType=param[0];this.id=param[1];this.sco=param[2];this.power=param[3];this.desc=param[4];this.attrs=param[5];this.func=param[6];if(this.func){this.addEventListener(egret.TouchEvent.TOUCH_END,this.func,this)}else{this.setHideButton()}var itemConfig=GlobalConfig.ItemConfig[this.id];this.itemIcon.setData(itemConfig);var q=ItemConfig.getQuality(itemConfig);this.quali.source=q>0?"quali"+q:"";this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1(i18n("EquipTipsBase_1",ItemConfig.getQualityColor(itemConfig),itemConfig.name));this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.score.text=i18n("EquipTipsBase_0",this.sco);this.typeName.textFlow=TextFlowMaker.generateTextFlow1(this.desc.left);this.typeValue.textFlow=TextFlowMaker.generateTextFlow1(this.desc.right);this.powerPanel.setPower(this.power);for(var i=0;i<this.attrs.length;i++){var equip=new EquipTipsItemBase;equip.data={title:this.attrs[i].title,attributeData:this.attrs[i].attr,colorName:this.attrs[i].colorName,colorValue:this.attrs[i].colorValue,others:this.attrs[i].others};this.content.addChild(equip)}};EquipTipsBase.prototype.setHideButton=function(){this.changeBtn.visible=false};return EquipTipsBase}(BaseEuiView);__reflect(EquipTipsBase.prototype,"EquipTipsBase");ViewManager.ins().reg(EquipTipsBase,LayerManager.UI_Popup);var EquipTipsItemBase=function(_super){__extends(EquipTipsItemBase,_super);function EquipTipsItemBase(){var _this=_super.call(this)||this;_this.skinName="UsualEquipTipsItemSkin";return _this}EquipTipsItemBase.prototype.dataChanged=function(){if(!this.data)return;var title=this.data.title;var colorName=this.data.colorName;var colorValue=this.data.colorValue;var colorTitle=this.data.titleColor;var attrs=this.data.attributeData;var others=this.data.others;var attrName="";var attrValue="";if(!others||!others.suitdesc){DisplayUtils.removeFromParent(this.desc1)}for(var i=0;i<attrs.length;i++){attrName+=AttributeData.getAttrStrByType(attrs[i].type)+": \n";if(attrs[i].type==AttributeType.atMaxHp||attrs[i].type==AttributeType.atAttack||attrs[i].type==AttributeType.atDef||attrs[i].type==AttributeType.atRes){attrValue+=attrs[i].value}else{attrValue+=attrs[i].value/100+"%"}attrValue+="\n"}if(attrName){var index=attrName.lastIndexOf("\n");attrName=attrName.substring(0,index)}if(attrValue){var index=attrValue.lastIndexOf("\n");attrValue=attrValue.substring(0,index)}if(others&&others.exdesc){var str=others.exdesc.split("+");attrName+="\n"+str[0]+":";attrValue+="\n"+str[1]}this.attrType.textFlow=TextFlowMaker.generateTextFlow1(colorTitle?i18n("EquipTipsItemBase_0",colorTitle,title):""+title);this.attrName.textFlow=TextFlowMaker.generateTextFlow1(colorName?i18n("EquipTipsItemBase_1",colorName,attrName):""+attrName);this.attrValue.textFlow=TextFlowMaker.generateTextFlow1(colorValue?i18n("EquipTipsItemBase_2",colorValue,attrValue):""+attrValue);if(this.desc1&&this.desc1.parent){this.suit.textFlow=TextFlowMaker.generateTextFlow1(others.suitdesc)}};return EquipTipsItemBase}(BaseItemRender);__reflect(EquipTipsItemBase.prototype,"EquipTipsItemBase");var euiextension;(function(euiextension){var DropDownList=function(_super){__extends(DropDownList,_super);function DropDownList(){var _this=_super.call(this)||this;_this.btnBg=new egret.Shape;_this.btnBg.touchEnabled=true;_this.btnBg.graphics.beginFill(0);_this.btnBg.graphics.drawRect(0,0,480,410);_this.btnBg.alpha=.6;_this.addChild(_this.btnBg);var labelIP=new eui.Label;labelIP.textColor=16777215;labelIP.size=24;labelIP.y=20;labelIP.text=i18n("euiextension_0");_this.addChild(labelIP);_this.listIP=new eui.List;_this.listIP.y=50;_this.listIP.itemRenderer=IPItemRenderer;_this.scrollerIP=new eui.Scroller;_this.scrollerIP.y=_this.listIP.y;_this.scrollerIP.height=400;_this.scrollerIP.viewport=_this.listIP;_this.scrollerIP.bounces=false;_this.addChild(_this.scrollerIP);var labelRes=new eui.Label;labelRes.textColor=16777215;labelRes.size=24;labelRes.x=250;labelRes.y=20;labelRes.text=i18n("euiextension_1");_this.addChild(labelRes);_this.listRES=new eui.List;_this.listRES.x=labelRes.x;_this.listRES.y=50;_this.listRES.itemRenderer=IPItemRenderer;_this.scrollerRES=new eui.Scroller;_this.scrollerRES.x=_this.listRES.x;_this.scrollerRES.y=_this.listRES.y;_this.scrollerRES.height=_this.scrollerIP.height;_this.scrollerRES.viewport=_this.listRES;_this.scrollerRES.bounces=false;_this.addChild(_this.scrollerRES);_this.addChangeEvent(_this.listIP,_this.setSelectIP);_this.addChangeEvent(_this.listRES,_this.setSelectRES);return _this}DropDownList.prototype.setDataIP=function(data){this.listIP.dataProvider=new eui.ArrayCollection(data);var index=parseInt(egret.localStorage.getItem("listIP"))||0;this.listIP.selectedIndex=index>data.length?0:index;this.setSelectIP()};DropDownList.prototype.setDataRES=function(data){this.listRES.dataProvider=new eui.ArrayCollection(data);var index=parseInt(egret.localStorage.getItem("listRES"))||0;this.listRES.selectedIndex=index>data.length?0:index;this.setSelectRES()};DropDownList.prototype.destructor=function(){this.listIP.removeEventListener(egret.Event.CHANGE,this.setSelectIP,this);this.listRES.removeEventListener(egret.Event.CHANGE,this.setSelectRES,this)};DropDownList.prototype.setSelectIP=function(){var param=this.listIP.selectedItem.split("|");LocationProperty.srvid=parseInt(param[1]);var param1=param[2].split(":");LocationProperty.serverIP=param1[0];LocationProperty.serverPort=parseInt(param1[1]);egret.localStorage.setItem("listIP",this.listIP.selectedIndex.toString())};DropDownList.prototype.setSelectRES=function(){LocationProperty.resAdd=this.listRES.selectedItem.split("=")[1];egret.localStorage.setItem("listRES",this.listRES.selectedIndex.toString())};return DropDownList}(BaseView);euiextension.DropDownList=DropDownList;__reflect(DropDownList.prototype,"euiextension.DropDownList");var IPItemRenderer=function(_super){__extends(IPItemRenderer,_super);function IPItemRenderer(){var _this=_super.call(this)||this;var exmlText='<?xml version="1.0" encoding="utf-8" ?><e:Skin xmlns:e="http://ns.egret.com/eui"></e:Skin>';_this.skinName=exmlText;_this.label=new eui.Label;_this.label.textColor=242004;_this.label.size=12;_this.label.y=10;_this.addChild(_this.label);_this.height=23;return _this}IPItemRenderer.prototype.dataChanged=function(){this.label.text=this.data};Object.defineProperty(IPItemRenderer.prototype,"selected",{set:function(value){if(this["_selected"]==value)return;this["_selected"]=value;this.invalidateState();if(value)this.label.textColor=15937822;else this.label.textColor=242004},enumerable:true,configurable:true});return IPItemRenderer}(BaseItemRender);__reflect(IPItemRenderer.prototype,"IPItemRenderer")})(euiextension||(euiextension={}));window["euiextension"]=euiextension;var FbItem=function(_super){__extends(FbItem,_super);function FbItem(){var _this=_super.call(this)||this;_this.isDouble=0;_this.skinName="DailyFbItemSkin";return _this}FbItem.prototype.createChildren=function(){_super.prototype.createChildren.call(this);this.item.isShowName(false);this.starValue=0;this.bar.value=0};FbItem.prototype.starSaoDang=function(isDouble){if(isDouble===void 0){isDouble=0}this.isDouble=isDouble;TimerManager.ins().doTimer(50,20,this.refushBar,this,this.overPlay,this);this.bar.value=0;this.barGaroup.visible=true;if(this.isDouble){this.doublePrice.visible=false;this.barGaroup.x=this.doublePrice.x}else{this.price.visible=false;this.barGaroup.x=this.price.x}this.bar.labelFunction=function(){return i18n("FbItem_0")}};FbItem.prototype.refushBar=function(){if(this.isDouble){this.doubleChallengeBtn.enabled=false}else{this.challengeBtn.enabled=false}this.starValue+=7;this.bar.value=this.starValue};FbItem.prototype.overPlay=function(){if(this.starValue!=0){this.barGaroup.visible=false;if(this.isDouble){this.doublePrice.visible=true;this.doubleChallengeBtn.enabled=true}else{this.price.visible=true;this.challengeBtn.enabled=true}this.starValue=0;this.bar.value=0;UserFb.ins().sendAddCount(this.data,this.isDouble)}};FbItem.prototype.dataChanged=function(){this.challengeBtn["data"]=this.data;this.doubleChallengeBtn["data"]=this.data;this.bg.source=this.data+"bg";var config=GlobalConfig.DailyFubenConfig[this.data];this.item.data=config.showItem;if(config.zsLevel>0){var str=config.zsLevel+i18n("FbItem_1");var flag=UserZs.ins().lv>=config.zsLevel;if(config.id==GlobalConfig.ZhanLingConfig.fbIndex){str=i18n("FbItem_2")+GlobalConfig.ZhanLingConfig.openserverday+i18n("FbItem_3")+config.zsLevel+i18n("FbItem_4");flag=UserZs.ins().lv>=config.zsLevel&&GameServer.serverOpenDay+1>=GlobalConfig.ZhanLingConfig.openserverday}this.levelRequire.text=flag?"":str;this.currentState=flag?"canChallenge":"noChallenge"}else{this.levelRequire.text=config.levelLimit+i18n("FbItem_5");this.currentState=Actor.level>=config.levelLimit?"canChallenge":"noChallenge"}this.levelRequire.visible=true;this.SpecialTips.visible=false;this.monthCardBtn.visible=false;this.monthCardBtn.name="monthCardBtn";this.monthCardBtn.textFlow=TextFlowMaker.generateTextFlow1("|U&T:前往");var fbInfos=UserFb.ins().getFbDataById(this.data);var count=fbInfos.getCount();var color=count>0?"#40D016":"#DFD1B5";this.redPoint.visible=count>0;var resetCount=fbInfos.getResetCount();if(count>0)this.count.textFlow=(new egret.HtmlTextParser).parser(i18n("FbItem_6",color));else{this.count.textFlow=(new egret.HtmlTextParser).parser(i18n("FbItem_7",color,resetCount));this.redPoint.visible=DieGuide.ins().dieFbRedPoint(resetCount,this.data)}this.price.visible=count==0&&this.currentState=="canChallenge";if(Recharge.ins().franchise&&fbInfos.isPass){this.challengeBtn.label=count?i18n("FbItem_8"):i18n("FbItem_9");if(this.data==3001&&count>0){this.monthCardBtn.visible=false;this.SpecialTips.visible=false}}else{if(UserZs.ins().lv*1e3>=config.sweepLevel&&fbInfos.isPass)this.challengeBtn.label=count?i18n("FbItem_10"):i18n("FbItem_11");else this.challengeBtn.label=count?i18n("FbItem_12"):i18n("FbItem_13");if(this.data==3001&&count>0){this.monthCardBtn.visible=true;this.SpecialTips.visible=true}}this.challengeBtn.name=count?"":"add";this.challengeBtn.enabled=true;this.doublePrice.visible=this.doubleChallengeBtn.visible=false;this.doubleChallengeBtn.name="double";var colorMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];this.challengeBtn.filters=[];var nextCount=fbInfos.getNextVip();var price=0;var doublePrice=0;var discount=GlobalConfig.MonthCardConfig.sweepPrecent/100;var addValue=Recharge.ins().monthDay>0?1-discount:1;if(count==0){if(resetCount<=0){switch(nextCount){case-1:this.count.text=i18n("FbItem_14");this.challengeBtn.visible=false;this.price.visible=false;this.doublePrice.visible=false;this.levelRequire.visible=false;break;default:if(UserVip.ins().lv<nextCount){this.count.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor("尊者"+nextCount,16317955)+i18n("FbItem_15"));this.challengeBtn.filters=[new egret.ColorMatrixFilter(colorMatrix)];this.doubleChallengeBtn.enabled=this.challengeBtn.enabled=false}else{this.count.text=i18n("FbItem_16",nextCount);this.doubleChallengeBtn.enabled=this.challengeBtn.enabled=true}break}}price=Math.floor(config.buyPrice[fbInfos.vipBuyCount]*addValue);this.price.setPrice(price);if(resetCount>0&&config.buyDoublePrice){if(Actor.level>=config.levelLimit)this.doublePrice.visible=this.doubleChallengeBtn.visible=true;if(config.buyDoublePrice){doublePrice=config.buyDoublePrice[fbInfos.vipBuyCount]*addValue;this.doublePrice.setPrice(doublePrice)}}}else{if(this.currentState=="canChallenge"){this.challengeBtn.visible=true}}};return FbItem}(BaseItemRender);__reflect(FbItem.prototype,"FbItem");var ForgeZhuItem=function(_super){__extends(ForgeZhuItem,_super);function ForgeZhuItem(){var _this=_super.call(this)||this;_this.skinName="CastingZBItemSkin";return _this}ForgeZhuItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.init()};ForgeZhuItem.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);this.bitmapNum=BitmapNumber.ins().createNumPic(0,"lv_");this.addChild(this.bitmapNum);this.bitmapNum.x=this.num0.x;this.bitmapNum.y=this.num0.y;this.lockbitmapNum=BitmapNumber.ins().createNumPic(0,"lvk_");this.unlock1.addChild(this.lockbitmapNum);this.lockbitmapNum.anchorOffsetX=this.lockbitmapNum.width/2;this.lockbitmapNum.anchorOffsetX=this.lockbitmapNum.height/2;this.lockbitmapNum.x=this.unlock1.x;this.lockbitmapNum.y=this.unlock1.y-10;this.unlock.addChild(this.lockbitmapNum);this.itemIcon.imgJob.visible=false};ForgeZhuItem.prototype.onClick=function(e){};ForgeZhuItem.prototype.hideAdd=function(){this.add.visible=false;this.bitmapNum.visible=false};ForgeZhuItem.prototype.updateItem=function(item,pos,lv,itemNum,isZZ){if(isZZ===void 0){isZZ=true}this.add.visible=lv>0?true:false;var openConfig=GlobalConfig.StoneOpenConfig[pos];if(Actor.level>=openConfig.openLv){var costConfig=UserForge.ins().getStoneLevelCostConfigByLv(lv+1);var cost=0;if(costConfig){cost=costConfig.soulNum}var colorStr="";var isCost=itemNum>=cost?true:false;this.state.visible=isCost;if(lv>=80){this.state.visible=false}BitmapNumber.ins().changeNum(this.bitmapNum,lv,"lv_");if(item){this.setItemImg(item.icon+"_png")}else{this.setItemImg("xb_"+(pos+10).toString())}this.unlock.visible=false;this.lockbitmapNum.visible=false}else{this.state.visible=false;this.unlock.visible=true;this.lockbitmapNum.visible=true;this.add.visible=false;this.setItemImg("xb_"+(pos+10));BitmapNumber.ins().changeNum(this.lockbitmapNum,openConfig.openLv,"lvk_");if(Math.floor(openConfig.openLv/100)!=0||openConfig.openLv==100){this.lockbitmapNum.x=this.unlock1.x-10}else{this.lockbitmapNum.x=this.unlock1.x-5}}this.bitmapNum.visible=this.add.visible;if(!isZZ)this.state.visible=false};ForgeZhuItem.prototype.setItemImg=function(str){this.itemIcon.imgIcon.source=str};ForgeZhuItem.prototype.setItemData=function(item){this.setItemImg(item.icon.toString()+"_png")};ForgeZhuItem.prototype.dataChanged=function(){this.updateItem(this.data.item,this.data.pos,this.data.lv,this.data.itemNum)};return ForgeZhuItem}(BaseItemRender);__reflect(ForgeZhuItem.prototype,"ForgeZhuItem");var GuanqiaBossHead=function(_super){__extends(GuanqiaBossHead,_super);function GuanqiaBossHead(){return _super.call(this)||this}GuanqiaBossHead.prototype.childrenCreated=function(){this.init()};GuanqiaBossHead.prototype.init=function(){this._isSelect=false;this._isFrameBig=false;this.imgSelect.visible=false;this.imgFrameBig.visible=false;this.imgFrameLittle.visible=true};GuanqiaBossHead.prototype.setHeadSource=function(str){this.imgHead.source=str};GuanqiaBossHead.prototype.setGray=function(value){var colorMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];this.imgHead.filters=value?[new egret.ColorMatrixFilter(colorMatrix)]:[]};GuanqiaBossHead.prototype.setFrameBig=function(value){if(value==this._isFrameBig)return;this._isFrameBig=value;this.imgFrameBig.visible=value;this.imgFrameLittle.visible=!value};GuanqiaBossHead.prototype.getFrameBig=function(){return this._isFrameBig};GuanqiaBossHead.prototype.setSelect=function(value){if(value==this._isSelect)return;this.imgSelect.visible=value;this._isSelect=value};GuanqiaBossHead.prototype.getSelect=function(){return this._isSelect};return GuanqiaBossHead}(BaseComponent);__reflect(GuanqiaBossHead.prototype,"GuanqiaBossHead");var GuanQiaEfficiencyPanel=function(_super){__extends(GuanQiaEfficiencyPanel,_super);function GuanQiaEfficiencyPanel(){var _this=_super.call(this)||this;_this.name=i18n("GuanQiaEfficiencyPanel_0");return _this}GuanQiaEfficiencyPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.init()};GuanQiaEfficiencyPanel.prototype.init=function(){this.initMap()};GuanQiaEfficiencyPanel.prototype.initMap=function(){this.boxs=[];this.maps=[];this.items=[];for(var i=0;i<GuanQiaEfficiencyPanel.MAP_COUNT;i++){this["item"+i].visible=false}for(var i=0;i<GuanQiaEfficiencyPanel.MAP_COUNT;i++){var item=this["item"+i];var config=GlobalConfig.WorldRewardConfig[i+1];var lastConfig=GlobalConfig.WorldRewardConfig[i];var laseLevel=i==0?0:lastConfig.needLevel+1;item.touchChildren=true;item.visible=config!=undefined;item.nameTxt.text=config?""+config.name:"";item.levelLabel.text=i18n("GuanQiaEfficiencyPanel_1",laseLevel,config.needLevel);this.items[i]=item;this.boxs[i]=item.box;this.maps[i]=this["map"+i]}};GuanQiaEfficiencyPanel.prototype.open=function(){for(var _i=0,_a=this.boxs;_i<_a.length;_i++){var box=_a[_i];this.addTouchEvent(box,this.onTouchTap)}this.addTouchEvent(this.leftArrow,this.onTouchArrow);this.addTouchEvent(this.rightArrow,this.onTouchArrow);this.observe(UserFb.ins().postGuanqiaWroldReward,this.upDateGuanqiaWroldReward);var isTow=UserFb.ins().worldReward>GuanQiaEfficiencyPanel.MAP_ONE_COUNT-1;this.currentState=isTow?"map1":"map0";this.rightArrow.visible=isTow;this.update()};GuanQiaEfficiencyPanel.prototype.close=function(){for(var _i=0,_a=this.boxs;_i<_a.length;_i++){var box=_a[_i];this.removeTouchEvent(box,this.onTouchTap)}this.removeTouchEvent(this.leftArrow,this.onTouchArrow);this.removeTouchEvent(this.rightArrow,this.onTouchArrow);this.removeObserve()};GuanQiaEfficiencyPanel.prototype.onTouchTap=function(e){var pass=this.boxs.indexOf(e.currentTarget)+1;ViewManager.ins().open(GuanQiaWorldRewardWin,pass)};GuanQiaEfficiencyPanel.prototype.onTouchArrow=function(event){this.currentState=event.currentTarget==this.leftArrow?"map0":"map1";this.update()};GuanQiaEfficiencyPanel.prototype.upDateGuanqiaWroldReward=function(){this.update()};GuanQiaEfficiencyPanel.prototype.update=function(){var i=this.currentState=="map0"?0:GuanQiaEfficiencyPanel.MAP_TWO_COUNT-1;var len=this.currentState=="map0"?GuanQiaEfficiencyPanel.MAP_ONE_COUNT:this.items.length;var index=UserFb.ins().worldReward;for(;i<len;i++){var item_1=this.items[i];var map=this.maps[i];if(!item_1||!map)continue;item_1.visible=i<=index;map.visible=i<=index;item_1.barGroup.visible=false;item_1.box.visible=item_1.levelLabel.visible=item_1.redPointBox.visible=UserFb.ins().isReceiveBox(i+1)}var item=this.items[index];var config=GlobalConfig.WorldRewardConfig[UserFb.ins().worldReward+1];var preConfig=GlobalConfig.WorldRewardConfig[UserFb.ins().worldReward];if(config&&item){item.box.visible=true;item.barGroup.visible=true;item.levelLabel.visible=true;item.bar.value=UserFb.ins().guanqiaReward-(preConfig?preConfig.needLevel:0)-1;item.bar.maximum=preConfig?config.needLevel-preConfig.needLevel:config.needLevel}};GuanQiaEfficiencyPanel.MAP_COUNT=15;GuanQiaEfficiencyPanel.MAP_ONE_COUNT=7;GuanQiaEfficiencyPanel.MAP_TWO_COUNT=8;return GuanQiaEfficiencyPanel}(BaseComponent);__reflect(GuanQiaEfficiencyPanel.prototype,"GuanQiaEfficiencyPanel");var GuanQiaMapItem=function(_super){__extends(GuanQiaMapItem,_super);function GuanQiaMapItem(){var _this=_super.call(this)||this;_this.skinName="CheckItemSkin";return _this}return GuanQiaMapItem}(BaseComponent);__reflect(GuanQiaMapItem.prototype,"GuanQiaMapItem");var GuanQiaRewardPanel=function(_super){__extends(GuanQiaRewardPanel,_super);function GuanQiaRewardPanel(){var _this=_super.call(this)||this;_this.boxPass=0;return _this}GuanQiaRewardPanel.prototype.childrenCreated=function(){this.init()};GuanQiaRewardPanel.prototype.init=function(){this.reward=[];for(var i=0;i<5;i++){this.reward[i]=this["item"+i]}var str=i18n("GuanQiaRewardPanel_0");this.seeRank.textFlow=(new egret.HtmlTextParser).parser(str);this.bar.value=0;this.award.visible=false;this.challengeBtn.visible=true;this.mapImage.touchEnabled=true;this.bar.slideDuration=0;this.headGroup.removeChildren()};GuanQiaRewardPanel.prototype.open=function(){this.addTouchEvent(this.challengeBtn,this.onTouchTap);this.addTouchEvent(this.seeRank,this.onTouchTap);this.addTouchEvent(this.getawardBtn,this.onTouchTap);this.addTouchEvent(this.mapImage,this.onTouchTap);this.observe(GameLogic.ins().postEnterMap,this.upDataGuanqia);this.observe(UserFb.ins().postZhangJieAwardChange,this.upDataGuanqia);this.observe(UserFb.ins().postGuanqiaWroldReward,this.upDateGuanqiaWroldReward);this.observe(Rank.ins().postRankingData,this.updataFirstThree);Rank.ins().sendGetRankingData(RankDataType.TYPE_PASS);this.upDateGuanqiaWroldReward();this.update()};GuanQiaRewardPanel.prototype.close=function(){this.removeTouchEvent(this.challengeBtn,this.onTouchTap);this.removeTouchEvent(this.seeRank,this.onTouchTap);this.removeTouchEvent(this.getawardBtn,this.onTouchTap);this.removeTouchEvent(this.mapImage,this.onTouchTap);this.removeObserve()};GuanQiaRewardPanel.prototype.onTouchTap=function(e){switch(e.currentTarget){case this.challengeBtn:UserFb.ins().autoPk();break;case this.getawardBtn:var config=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward];var awards=config.rewards;var num=0;for(var i=0;i<awards.length;i++){if(awards[i].type==1&&awards[i].id<2e5)num++}if(UserBag.ins().getSurplusCount()>=num)UserFb.ins().sendGetAward();else UserTips.ins().showTips(i18n("GuanQiaRewardPanel_1"));break;case this.seeRank:if(Rank.ins().rankModel[RankDataType.TYPE_PASS]&&Rank.ins().rankModel[RankDataType.TYPE_PASS].getDataList().length>0){ViewManager.ins().open(FbAndLevelsRankWin,RankDataType.TYPE_PASS)}else{UserTips.ins().showTips(i18n("GuanQiaRewardPanel_2"))}break;case this.mapImage:ViewManager.ins().open(GuanQiaWorldRewardWin,UserFb.ins().getWorldGuanQiaBox());break}};GuanQiaRewardPanel.prototype.upDataGuanqia=function(){this.update()};GuanQiaRewardPanel.prototype.upDateGuanqiaWroldReward=function(){this.boxPass=UserFb.ins().getWorldGuanQia();this.redPointBox.visible=UserFb.ins().isReceiveBox(this.boxPass)};GuanQiaRewardPanel.prototype.update=function(){var guanqiaID=UserFb.ins().guanqiaID;var config=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward];var preConfig=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward-1];if(!config){config=preConfig;this.award.visible=false;this.info.visible=true;this.goldTxt0.text="";this.expTxt0.text="";this.goldTxt1.text="";this.expTxt1.text=""}else{this.bar.maximum=preConfig?config.needLevel-preConfig.needLevel:config.needLevel;this.bar.value=guanqiaID-(preConfig?preConfig.needLevel:0)-1;this.award.visible=this.bar.value==this.bar.maximum;this.info.visible=!this["award"].visible;this.goldTxt0.text=UserFb.ins().goldEff+i18n("GuanQiaRewardPanel_3");this.expTxt0.text=UserFb.ins().expEff+i18n("GuanQiaRewardPanel_4");this.goldTxt1.text="";this.expTxt1.text=""}this.mapNameTxt.text=i18n("GuanQiaRewardPanel_5",config.id,config.name);this.specialItem.data=config.rewards[0];this.specialItem1.data=config.rewards[0];if(this.specialItem1.getText()==i18n("GuanQiaRewardPanel_6")){this.labelInfo.text=i18n("GuanQiaRewardPanel_7")}else if(this.specialItem1.getText()==i18n("GuanQiaRewardPanel_8")){this.labelInfo.text=i18n("GuanQiaRewardPanel_9")}else{this.labelInfo.text=""}this.desc.text=i18n("GuanQiaRewardPanel_10",config.name);this.rewardDesc.text=i18n("GuanQiaRewardPanel_11",config.name);this.updateChallenge();this.updataFirstThree(Rank.ins().rankModel[RankDataType.TYPE_PASS]);this.showChallengeGuide()};GuanQiaRewardPanel.prototype.updateChallenge=function(){this.needWave.visible=false;if(UserFb.ins().guanqiaID>=UserFb.ins().maxLen){this.challengeBtn.visible=false;this.needWave.visible=true;this.needWave.text=i18n("GuanQiaRewardPanel_12")}};GuanQiaRewardPanel.prototype.showChallengeGuide=function(){if(UserFb.ins().guanqiaID<=1&&UserFb.ins().isShowBossPK()&&!UserFb.ins().bossIsChallenged){}};GuanQiaRewardPanel.prototype.updataFirstThree=function(rankModel){if(!rankModel){this.name0.text=this.name1.text=this.name2.text=i18n("GuanQiaRewardPanel_13");this.harm0.text=this.harm1.text=this.harm2.text="0";return}if(rankModel.type!=RankDataType.TYPE_PASS)return;for(var i=0;i<4;i++){if(i==3){this["rank"+i].text=0<rankModel.selfPos&&rankModel.selfPos<=1e3?rankModel.selfPos+"":i18n("GuanQiaRewardPanel_14");this["harm"+i].text=UserFb.ins().guanqiaID+i18n("GuanQiaRewardPanel_15");return}var data=rankModel.getDataList(i);if(data){this["name"+i].text=data[RankDataType.DATA_PLAYER];this["harm"+i].text=data[RankDataType.DATA_COUNT]+i18n("GuanQiaRewardPanel_16")}else{this["name"+i].text=i18n("GuanQiaRewardPanel_17");this["harm"+i].text="0"}}};return GuanQiaRewardPanel}(BaseComponent);__reflect(GuanQiaRewardPanel.prototype,"GuanQiaRewardPanel");var GuildInfoPanel=function(_super){__extends(GuildInfoPanel,_super);function GuildInfoPanel(){var _this=_super.call(this)||this;_this.isInit=false;_this.userGuild=Guild.ins();return _this}GuildInfoPanel.prototype.childrenCreated=function(){this.init()};GuildInfoPanel.prototype.init=function(){this.initUI()};GuildInfoPanel.prototype.initUI=function(){this.checkJoin.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.checkJoin.text+"</u></a>");this.checkJoin.touchEnabled=true;this.list.itemRenderer=GuildMemberItem1Render;this.eff=new MovieClip;this.eff.x=this.checkJoin.x+40;this.eff.y=this.checkJoin.y+10;this.isInit=true};GuildInfoPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!this.isInit)this.initUI();this.addTouchEvent(this.checkJoin,this.onLinkApply);this.addTouchEvent(this.cityBtn,this.onTap);this.addTouchEvent(this.conBtn,this.onTap);this.addTouchEvent(this.rename,this.onTap);this.observe(Guild.ins().postGuildInfo,this.updateGuild);this.observe(Guild.ins().postMyGuildInfo,this.updateMyInfo);this.observe(Guild.ins().postChangeNotice,this.updateGuild);this.observe(Guild.ins().postGuildMoney,this.updateGuild);this.observe(Guild.ins().postApplyInfos,this.updateApplys);this.observe(Guild.ins().postJoinGuild,this.updateApplys);this.observe(Guild.ins().postGuildMembers,this.updateMember);this.updateApplys();this.updateMyInfo();this.updateGuild();this.updateMember()};GuildInfoPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.conBtn:ViewManager.ins().open(GuildConWin);break;case this.cityBtn:ViewManager.ins().open(GuildNoticeWin);break;case this.rename:ViewManager.ins().open(GuildChangeNameView);break}};GuildInfoPanel.prototype.updateMyInfo=function(){this.myCon.text=this.userGuild.myCon+"";this.checkJoin.visible=this.userGuild.myOffice>=GuildOffice.GUILD_FUBANGZHU;this.cityBtn.visible=this.userGuild.myOffice>=GuildOffice.GUILD_FUBANGZHU};GuildInfoPanel.prototype.updateGuild=function(){var c=this.guildName.text!=this.userGuild.guildName;this.guildName.text=this.userGuild.guildName;if(c){this.checkScrollName()}this.guildLevel.text=this.userGuild.guildLv.toString();this.guildMoney.text=this.userGuild.money.toString();this.notice.text=this.userGuild.notice;this.rename.visible=Guild.ins().changeNameNum&&this.userGuild.myOffice>=GuildOffice.GUILD_BANGZHU};GuildInfoPanel.prototype.checkScrollName=function(){var len=this.userGuild.guildName.length;if(len<5){this.stopScroll();return}this.startScroll()};GuildInfoPanel.prototype.stopScroll=function(){TimerManager.ins().remove(this.scrollName,this);this.guildName.x=0;egret.Tween.removeTweens(this.guildName)};GuildInfoPanel.prototype.startScroll=function(){this.scrollName();TimerManager.ins().doTimer(4500,0,this.scrollName,this)};GuildInfoPanel.prototype.scrollName=function(){this.guildName.x=this.guildName.width;var t=egret.Tween.get(this.guildName);var d=this.guildName.width/120*4500;t.to({x:-this.guildName.width},d)};GuildInfoPanel.prototype.updateMember=function(){var gc=GlobalConfig.GuildConfig;var commentLv=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_COMMENT-1)||0;var exmember=commentLv?GlobalConfig.GuildConfig.affairMember[commentLv-1]:0;this.guildMember.text=this.userGuild.getMemberNum()+"/"+(gc.maxMember[Guild.ins().guildLv-1]+exmember);this.list.dataProvider=new eui.ArrayCollection(this.userGuild.getGuildMembers(1))};GuildInfoPanel.prototype.onLinkApply=function(){ViewManager.ins().open(GuildApplyListWin)};GuildInfoPanel.prototype.updateApplys=function(){if(this.userGuild.hasApplys()){this.checkJoin.parent.addChildAt(this.eff,this.getChildIndex(this.checkJoin));this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);this.eff.scaleX=.7;this.eff.scaleY=.7}else DisplayUtils.removeFromParent(this.eff)};return GuildInfoPanel}(BaseComponent);__reflect(GuildInfoPanel.prototype,"GuildInfoPanel");var GuildListPanel=function(_super){__extends(GuildListPanel,_super);function GuildListPanel(){return _super.call(this)||this}GuildListPanel.prototype.childrenCreated=function(){this.init()};GuildListPanel.prototype.init=function(){this.list.itemRenderer=GuildListItem2Render};GuildListPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Guild.ins().postGuildList,this.updateList);this.updateList();this.pageChange(0)};GuildListPanel.prototype.pageChange=function(page){if(this.curPage!=page&&page>=0&&page<Guild.ins().pageMax){this.curPage=page;Guild.ins().sendGuildList(this.curPage,6)}};GuildListPanel.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(Guild.ins().guildListInfos)};return GuildListPanel}(BaseComponent);__reflect(GuildListPanel.prototype,"GuildListPanel");var GuildManagePanel=function(_super){__extends(GuildManagePanel,_super);function GuildManagePanel(){return _super.call(this)||this}GuildManagePanel.prototype.childrenCreated=function(){this.init()};GuildManagePanel.prototype.init=function(){this.buildList.itemRenderer=GuildBuildItemRender;this.messageList.itemRenderer=GuildEventItenRender};GuildManagePanel.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var rtn=Guild.ins().guildID!=0;if(!rtn){UserTips.ins().showTips(i18n("GuildManagePanel_0"))}return rtn};GuildManagePanel.prototype.open=function(){this.addTouchEvent(this.buildList,this.onListTouch);this.observe(Guild.ins().postUpBuilding,this.updateList);this.observe(Guild.ins().postManageList,this.update);this.observe(Guild.ins().postGuildMoney,this.update);Guild.ins().sendManageList();this.updateList()};GuildManagePanel.prototype.close=function(){this.removeTouchEvent(this.buildList,this.onListTouch);this.removeObserve()};GuildManagePanel.prototype.update=function(){this.messageList.dataProvider=new eui.ArrayCollection(Guild.ins().records)};GuildManagePanel.prototype.updateList=function(){this.index=this.buildScroller.viewport.scrollV;this.buildList.dataProvider=new eui.ArrayCollection([GuildBuilding.GUILD_HALL,GuildBuilding.GUILD_LIANGONGFANG,GuildBuilding.GUILD_COMMENT,GuildBuilding.GUILD_SHOP]);this.refushBar()};GuildManagePanel.prototype.refushBar=function(){TimerManager.ins().remove(this.refushBarList,this);TimerManager.ins().doTimer(100,1,this.refushBarList,this)};GuildManagePanel.prototype.refushBarList=function(){TimerManager.ins().remove(this.refushBarList,this);this.buildScroller.viewport.scrollV=this.index};GuildManagePanel.prototype.onListTouch=function(e){if(e.target instanceof eui.Button){var item=e.target.parent;item.onTap(e.target)}};return GuildManagePanel}(BaseComponent);__reflect(GuildManagePanel.prototype,"GuildManagePanel");var GuildMemberPanel=function(_super){__extends(GuildMemberPanel,_super);function GuildMemberPanel(){return _super.call(this)||this}GuildMemberPanel.prototype.childrenCreated=function(){this.init()};GuildMemberPanel.prototype.init=function(){this.list.itemRenderer=GuildMemberItem2Render;this.dataArr=new eui.ArrayCollection;this.list.dataProvider=this.dataArr};GuildMemberPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.quitBtn,this.onTap);this.addTouchEvent(this.list,this.onListTouch);this.observe(Guild.ins().postMyGuildInfo,this.updateMyInfo);this.observe(Guild.ins().postGuildMembers,this.updateMember);this.updateMyInfo();this.updateMember()};GuildMemberPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.quitBtn,this.onTap);this.removeTouchEvent(this.list,this.onListTouch);this.removeObserve()};GuildMemberPanel.prototype.onListTouch=function(e){if(e.target instanceof eui.Button){var item=e.target.parent.parent;item.onTap(e.target)}};GuildMemberPanel.prototype.updateMember=function(){var listData=Guild.ins().getGuildMembers(1);this.dataArr.replaceAll(listData)};GuildMemberPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.quitBtn:if(GuildWar.ins().getModel().isWatStart){WarnWin.show(i18n("GuildMemberPanel_0"),function(){},this);return}if(Guild.ins().myOffice==GuildOffice.GUILD_BANGZHU){if(Guild.ins().getMemberNum()>1){WarnWin.show(i18n("GuildMemberPanel_1"),function(){},this);return}}WarnWin.show(i18n("GuildMemberPanel_2"),function(){Guild.ins().sendQuitGuild()},this,null,null,"normal","center");break}};GuildMemberPanel.prototype.updateMyInfo=function(){this.office.text=GuildLanguage.guildOffice[Guild.ins().myOffice];this.totalCon.text=Guild.ins().myTotalCon+""};return GuildMemberPanel}(BaseComponent);__reflect(GuildMemberPanel.prototype,"GuildMemberPanel");var GuildTaskPanel=function(_super){__extends(GuildTaskPanel,_super);function GuildTaskPanel(){return _super.call(this)||this}GuildTaskPanel.prototype.childrenCreated=function(){this.init()};GuildTaskPanel.prototype.init=function(){this.list.itemRenderer=GuildTaskItemRender};GuildTaskPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.list,this.onListTouch);this.list.dataProvider=Guild.ins().guildTaskInfos};GuildTaskPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.list,this.onListTouch);this.removeObserve()};GuildTaskPanel.prototype.onLink=function(){ViewManager.ins().open(VipWin)};GuildTaskPanel.prototype.onListTouch=function(e){if(e.target instanceof eui.Button){var item=e.target.parent.parent;item.onTap(e.target)}};return GuildTaskPanel}(BaseComponent);__reflect(GuildTaskPanel.prototype,"GuildTaskPanel");var GwBossRemindItem=function(_super){__extends(GwBossRemindItem,_super);function GwBossRemindItem(){var _this=_super.call(this)||this;_this._move=false;_this._lastX=0;_this._lastY=0;return _this}GwBossRemindItem.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)};GwBossRemindItem.prototype.onTouchBegin1=function(e){this._lastX=e.stageX;this._lastY=e.stageY;this._lastSelect=this.checkBoxs.selected;this._move=false;if(this.$stage){this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this);this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this)}};GwBossRemindItem.prototype.onTouchMove1=function(e){if(MathUtils.getDistance(this._lastX,this._lastY,e.stageX,e.stageY)>20){this._move=true}};GwBossRemindItem.prototype.onTouchEnd1=function(){if(this._move){this.checkBoxs.selected=this._lastSelect;this._move=false}if(this.$stage){this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this);this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this)}};GwBossRemindItem.prototype.dataChanged=function(){var model=this.data;var config=GlobalConfig.WorldBossConfig[model.id];var roleLv=UserZs.ins().lv*1e3+Actor.level;var bossLv=config.zsLevel[0]*1e3+config.level;var canChallenge=roleLv>=bossLv;var desc;if(config.samsaraLv>0){desc=config.showName}else{if(config.zsLevel[0]>0){desc=i18n("GwBossRemindItem_0",config.zsLevel[0],config.zsLevel[1])}else{desc=i18n("GwBossRemindItem_1",config.level)}}this.checkBoxs.visible=canChallenge;if(canChallenge){this.checkBoxs.selected=UserBoss.ins().getBossRemindByIndex(model.id)}this.txt.visible=!canChallenge;this.checkBoxs.name=model.id+"";var boss=GlobalConfig.MonstersConfig[config.bossId];this.bossName.text=boss.name;this.levelShow.text=desc};return GwBossRemindItem}(BaseItemRender);__reflect(GwBossRemindItem.prototype,"GwBossRemindItem");var HeirloomItem=function(_super){__extends(HeirloomItem,_super);function HeirloomItem(){var _this=_super.call(this)||this;_this.skinName="heirloomItemSkin";return _this}HeirloomItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.init()};HeirloomItem.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};HeirloomItem.prototype.dataChanged=function(){this.clear();if(!this.data)return;if(this.data.icon){this.lv.visible=this.lvBg.visible=false}var info=this.data.info;this.itemIcon.setData(info,this.data.pos,this.data.icon,this.data.uplevel);this.lv.visible=info?true:false;if(!this.data.icon){if(info&&info.lv>0){this.lv.visible=true;this.lv.source="heir_0"+info.lv}else{this.lv.visible=false}this.lvBg.visible=this.lv.visible}else{this.lvBg.visible=this.lv.visible=false;this.skillname=this.data.skillname;this.skilldesc=this.data.skilldesc;this.equipName.visible=false}if(info.name)this.equipName.text=info.name;if(this.data.uplevel)this.setUpEff()};HeirloomItem.prototype.cleanEff=function(){this.itemIcon.cleanEff()};HeirloomItem.prototype.setTipsVisible=function(){this.itemIcon.imgRect.visible=false;this.equipName.visible=false};HeirloomItem.prototype.clear=function(){this.cleanEff()};HeirloomItem.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};HeirloomItem.prototype.onClick=function(){};HeirloomItem.prototype.setSelectIconVisible=function(v){this.selectIcon.visible=v};HeirloomItem.prototype.setUpEff=function(){if(this.upEffect==null){this.upEffect=new MovieClip;this.upEffect.x=this.itemIcon.x+this.itemIcon.width/2;this.upEffect.y=this.itemIcon.y+this.itemIcon.height/2;this.addChild(this.upEffect)}this.upEffect.playFile(RES_DIR_EFF+"promoteeff",1)};HeirloomItem.QUALITY_COLOR=[14868436,242004,13779707,16741647,15937822,16767295];return HeirloomItem}(BaseItemRender);__reflect(HeirloomItem.prototype,"HeirloomItem");var HeirloomItemIcon=function(_super){__extends(HeirloomItemIcon,_super);function HeirloomItemIcon(){var _this=_super.call(this)||this;_this.skinName="heirloomItemIcon";_this.imgRect.visible=true;return _this}HeirloomItemIcon.prototype.setSkillData=function(icon){this.imgRect.visible=false;this.imgIcon.source=icon};HeirloomItemIcon.prototype.setData=function(info,pos,icon,uplevel){if(uplevel===void 0){uplevel=false}this.imgRect.visible=true;if(info!=null){if(icon||info.icon)this.imgIcon.source=(icon?icon:info.icon)+"_png";if(info.lv>0&&!icon){this.imgRect.visible=false;if(this.effect==null){this.effect=new MovieClip;this.effect.x=this.imgBg.x+this.imgBg.width/2;this.effect.y=this.imgBg.y+this.imgBg.height/2-10;this.addChildAt(this.effect,this.getChildIndex(this.imgIcon)+1)}this.effect.playFile(RES_DIR_EFF+"quaeff6",-1);return}}if(!icon){var config=GlobalConfig.HeirloomEquipConfig[pos+1][1];this.imgIcon.source=config.icon+"_png"}else{if(info.lv>0)this.imgRect.visible=false;else this.imgRect.visible=true}};HeirloomItemIcon.prototype.cleanEff=function(){DisplayUtils.removeFromParent(this.effect);this.effect=null};HeirloomItemIcon.prototype.setUpEff=function(){if(this.upEffect==null){this.upEffect=new MovieClip;this.upEffect.x=this.imgBg.x+this.imgBg.width/2;this.upEffect.y=this.imgBg.y+this.imgBg.height/2-10;this.addChild(this.upEffect)}this.upEffect.playFile(RES_DIR_EFF+"promoteeff",1)};HeirloomItemIcon.prototype.resumePlay=function(e){this.effect.play(-1)};return HeirloomItemIcon}(BaseComponent);__reflect(HeirloomItemIcon.prototype,"HeirloomItemIcon");var HejiPanel=function(_super){__extends(HejiPanel,_super);function HejiPanel(){var _this=_super.call(this)||this;_this.otherWhite="#D1C28F";_this.colorBlue="#485774";_this.colorGray="#A0A2A5";_this.otherBlueN=4740980;_this.colorGrayN=4473140;_this.unActTextArr=[i18n("HejiPanel_8"),i18n("HejiPanel_9"),i18n("HejiPanel_10")];_this.jobId=0;return _this}HejiPanel.prototype.childrenCreated=function(){this.init()};HejiPanel.prototype.init=function(){this.HejiSkillMc1=new MovieClip;this.HejiSkillMc1Group.addChild(this.HejiSkillMc1);for(var i=0;i<8;i++){this["HejiSkillMc2_"+i]=new MovieClip;this["HejiSkillMc2Group"+i].addChild(this["HejiSkillMc2_"+i])}this.preViewText.textFlow=(new egret.HtmlTextParser).parser("<font color = '#23C42A'><u>"+this.preViewText.text+"</u></font>");this.effArr=[];for(var i=0;i<8;i++){this["itemEff"+i]=new MovieClip;this["itemEff"+i].x=177;this["itemEff"+i].y=174;this["itemEff"+i].rotation=i*45;this["itemEff"+i].touchEnabled=false;this.effArr.push(this["itemEff"+i])}var mcMap={1:"skill401",2:"skill405_0",3:"skill406_0"};var tMap={1:"skill404_0",2:"skill405",3:"skill406"};this.jobId=SubRoles.ins().getSubRoleByIndex(0).job;this.mcSkillID=mcMap[this.jobId];var num=403+this.jobId;this.targetSkillID=tMap[this.jobId]};HejiPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.UplevelBtn1,this.onClick);this.addTouchEvent(this.AttrBtn,this.onClick);this.addTouchEvent(this.punchtogether1,this.onClick);this.addTouchEvent(this.preViewText,this.onClick);this.addTouchEvent(this.skillitem,this.onClick);this.addTouchEvent(this.clickGroup,this.onClick);this.addTouchEvent(this.fenjieBtn,this.onClick);this.addTouchEvent(this.turnPunchForge,this.onClick);this.observe(UserSkill.ins().postHejiUpdate,this.setData);this.observe(UserSkill.ins().postHejiEquipChange,this.setData);this.observe(Actor.ins().postUpdateTogeatter,this.setData);this.observe(Actor.ins().postUpdateTogeatter,this.setRedPoint);this.observe(UserFb.ins().postGuanKaIdChange,this.setRedPoint);this.observe(UserBag.ins().postItemAdd,this.addItem);this.observe(UserBag.ins().postItemDel,this.setRedPoint);this.resetData();this.setData();this.setRedPoint()};HejiPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.UplevelBtn1,this.onClick);this.removeTouchEvent(this.AttrBtn,this.onClick);this.removeTouchEvent(this.punchtogether1,this.onClick);this.removeTouchEvent(this.skillitem,this.onClick);this.removeTouchEvent(this.preViewText,this.onClick);this.removeTouchEvent(this.fenjieBtn,this.onClick);this.removeTouchEvent(this.turnPunchForge,this.onClick);this.removeAllEffect();this.removePunchEffect();this.removeObserve();TimerManager.ins().removeAll(this);this.PunchForge.visible=false;this.PunchForge.close();ViewManager.ins().close(ShapeShiftingWin);ViewManager.ins().close(ShapeShiftingWearWin)};HejiPanel.prototype.resetData=function(){this.validateNow();for(var i=1;i<9;i++){this["item"+i].data=null}};HejiPanel.prototype.addItem=function(){this.refushPanelInfo();this.setRedPoint()};HejiPanel.prototype.onClick=function(e){switch(e.currentTarget){case this.UplevelBtn1:if(UserFb.ins().guanqiaID<UserSkill.ACTIVE_LEVEL){UserTips.ins().showTips(i18n("HejiPanel_11",UserSkill.ACTIVE_LEVEL))}else{this.Activation.visible=UserSkill.ins().hejiLevel>0?false:true;UserSkill.ins().sendGrewUpHejiSkill()}break;case this.AttrBtn:ViewManager.ins().open(PunchEquipAttrWin);break;case this.punchtogether1:ViewManager.ins().open(PunchExchangeWin);break;case this.skillitem:ViewManager.ins().open(PunchSkillTipsWin);break;case this.preViewText:ViewManager.ins().open(PunchExtShowWin);break;case this.fenjieBtn:ViewManager.ins().open(PunchResWin,0);break;case this.turnPunchForge:this.Activation.visible=false;this.Punchpre.visible=false;this.Punch.visible=false;this.PunchForge.visible=true;this.PunchForge.open();break}};HejiPanel.prototype.showActive=function(map){var isAct=map.isAct;if(isAct){var config=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel];var skid=config.skill_id;var img=skid[0].toString();RewardWin.showAct(0,i18n("HejiPanel_12"),"j"+img+"_png")}};HejiPanel.prototype.setRedPoint=function(){this.redPointEx.visible=UserSkill.ins().canExchange();this.redPointSo.visible=UserSkill.ins().canSolve();this.redPointAct.visible=UserSkill.ins().canAcitve();this.redPointPf.visible=UserSkill.ins().getPunchForge().getRedPoint()};HejiPanel.prototype.playSkillAnmi=function(){var _this=this;var t=egret.Tween.get(this.Punchpre);if(!this.HejiSkillMc1.parent)this.HejiSkillMc1Group.addChild(this.HejiSkillMc1);this.HejiSkillMc1.playFile(""+RES_DIR_SKILLEFF+this.mcSkillID,1,null,true);var _loop_9=function(i){if(i==0){t.wait(900).call(function(){if(!_this["HejiSkillMc2_"+i].parent)_this["HejiSkillMc2Group"+i].addChild(_this["HejiSkillMc2_"+i]);_this["HejiSkillMc2_"+i].playFile(""+RES_DIR_SKILLEFF+_this.targetSkillID,1,null,true)},this_8)}else{t.wait(100).call(function(){if(!_this["HejiSkillMc2_"+i].parent)_this["HejiSkillMc2Group"+i].addChild(_this["HejiSkillMc2_"+i]);_this["HejiSkillMc2_"+i].playFile(""+RES_DIR_SKILLEFF+_this.targetSkillID,1,null,true)},this_8)}};var this_8=this;for(var i=0;i<8;i++){_loop_9(i)}};HejiPanel.prototype.setData=function(){var len=SubRoles.ins().subRolesLen;if(UserSkill.ins().hejiLevel<=0){this.Activation.visible=true;this.Punchpre.visible=false;this.Punch.visible=false;this.PunchForge.visible=false;this.activeTipsTxt.text=i18n("HejiPanel_13",UserSkill.ACTIVE_LEVEL);return}else{if(Actor.level>=UserSkill.HEJI_SHOW_LEVEL){if(this.PunchForge.visible){this.Punch.visible=false}else{this.Punch.visible=true;this.PunchForge.visible=false}this.Activation.visible=false;this.Punchpre.visible=false;this.setPunchView();this.setPunch2View();this.refushPanelInfo();this.checkShowEff()}else{this.setPunchpreView()}}};HejiPanel.prototype.setPunchpreView=function(){TimerManager.ins().remove(this.playSkillAnmi,this);this.Activation.visible=false;this.Punch.visible=false;this.Punchpre.visible=true;this.PunchForge.visible=false;this.skillName.source="8000"+this.jobId+"_png";var config=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel];var curSkill=new SkillData(config.skill_id[this.jobId-1]);this.skillIcon.source=curSkill.id+"_png";TimerManager.ins().doTimer(3e3,0,this.playSkillAnmi,this);this.playSkillAnmi()};HejiPanel.prototype.checkShowEff=function(){var equipList=UserSkill.ins().equipListData;var num=-1;var len=equipList.length;if(equipList&&equipList.length!=8)return;for(var i=0;i<len;i++){var item=equipList[i];if(item&&item.itemConfig){if(num==-1){num=(item.itemConfig.zsLevel||0)*1e4+item.itemConfig.level}else{var tempLv=(item.itemConfig.zsLevel||0)*1e4+item.itemConfig.level;if(num!=tempLv){this.removeAllEffect();return}}}else{return}}this.playAllEffect()};HejiPanel.prototype.setPunch2View=function(){var config=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel];var curSkill=new SkillData(config.skill_id[this.jobId-1]);this.skillitem.setData(curSkill)};HejiPanel.prototype.destructor=function(){};HejiPanel.prototype.updateRedPoint=function(isOpens){};HejiPanel.prototype.refushPanelInfo=function(){var attData=[];for(var i=1;i<9;i++){this["item"+i].data=i-1;var item=UserSkill.ins().equipListData[i-1];if(attData.length==0){attData=item.att}else{attData=AttributeData.AttrAddition(attData,item.att)}}this.powerPanel.setPower(this.countAllAttNum());this.validateNow();this.updateForge()};HejiPanel.prototype.refushOne=function(index){this["item"+(index+1)].data=index;if(ViewManager.ins().isShow(PunchEquipChooseWin))ViewManager.ins().close(PunchEquipChooseWin);this.powerPanel.setPower(this.countAllAttNum())};HejiPanel.prototype.countAllAttNum=function(){var equipList=UserSkill.ins().equipListData;var num=0;var len=equipList.length;if(equipList&&equipList.length<=0)return 0;for(var i=0;i<len;i++){var item=equipList[i];if(item&&item.configID){num+=item.point}}return num*SubRoles.ins().subRolesLen};HejiPanel.prototype.playAllEffect=function(){for(var i=0;i<this.effArr.length;i++){if(!this.effArr[i].parent){this.effArr[i].playFile(RES_DIR_EFF+"hejizbjihuoeff",-1);this.EffectGroup.addChild(this["itemEff"+i])}}};HejiPanel.prototype.removeAllEffect=function(){for(var i=0;i<this.effArr.length;i++){if(this.effArr[i].parent){DisplayUtils.removeFromParent(this["itemEff"+i])}}};HejiPanel.prototype.removePunchEffect=function(){for(var i=0;i<8;i++){DisplayUtils.removeFromParent(this["HejiSkillMc2_"+i])}};HejiPanel.prototype.setPunchView=function(){var config=UserSkill.ins().qimingAttrDic;var zsLv=0;var lv=0;var nextZslv=0;var nextLv=0;var currConfig;var nextConfig;var string1="";var string2="";var color1="";var color2="";this.currText3.text="";this.currText5.text="";this.currText8.text="";this.nextText1.text="";this.nextText2.text="";this.nextText3.text="";var currCount=0;var nextCount=0;if(config&&CommonUtils.getObjectLength(config)>0){for(var k in config){for(var i in config[k]){zsLv=config[k][i].zslv;lv=config[k][i].lv}}nextZslv=zsLv+1;nextLv=80;currConfig=GlobalConfig.TogetherHitEquipQmConfig[zsLv][lv];this.paserText("currText",currConfig,config[zsLv*1e4+lv])}else{this.currTitleText.text=i18n("HejiPanel_14");this.currText0.text="";this.currText3.text="";this.currText5.text="";this.currText8.text="";zsLv=0;lv=60;nextZslv=1;nextLv=80;currConfig=GlobalConfig.TogetherHitEquipQmConfig[zsLv][lv];this.paserText("currText",currConfig)}for(var j=0;j<UserSkill.ins().equipListData.length;j++){var item=UserSkill.ins().equipListData[j].itemConfig;if(item){var zsLevel=item.zsLevel?item.zsLevel:0;var level=item.level?item.level:1;if(zsLevel>=zsLv&&level>=lv){color1=this.colorBlue;currCount++}else{color1=this.colorGray}if(zsLevel>=nextZslv&&level>=nextLv){color2=this.colorBlue;nextCount++}else{color2=this.colorGray}}else{color1=color2=this.colorGray}string1+="<font color="+color1+">"+Role.hejiPosName[j]+"  </font>"}this.currTitleText.text=zsLv>0?i18n("HejiPanel_15",zsLv,currCount):i18n("HejiPanel_16",lv,currCount);this.currText0.textFlow=(new egret.HtmlTextParser).parser(string1);this.preViewText.x=this.currTitleText.x+this.currTitleText.textWidth+10};HejiPanel.prototype.paserText=function(labName,config,comparePareConfig){if(comparePareConfig===void 0){comparePareConfig=null}var attrs={};var equipListData=UserSkill.ins().equipListData;var sum=0;var colorMap={};for(var k in equipListData){if(equipListData[k].configID!=0){var item=equipListData[k].itemConfig;var lv=(item.zsLevel||0)*1e4+item.level;if(!attrs[lv])attrs[lv]=0;attrs[lv]+=1;sum++;colorMap[lv]=ItemConfig.getQualityColor(item)}}var preSum=0;for(var index in attrs){preSum=attrs[index];attrs[index]=sum;sum-=preSum}var descArr={};var cfg=GlobalConfig.TogetherHitEquipQmConfig;for(var zslv in cfg){for(var lv in cfg[zslv]){for(var i in attrs){if(Number(i)==Number(zslv)*1e4+Number(lv)){var tf=void 0;for(var j in cfg[zslv][lv]){var str="";if(attrs[i]>=Number(j)){if(Number(zslv)){str=i18n("HejiPanel_17",colorMap[i],zslv,j,this.otherBlueN,cfg[zslv][lv][j].desc)}else{str=i18n("HejiPanel_18",colorMap[i],lv,j,this.otherBlueN,cfg[zslv][lv][j].desc)}descArr[j]=str;tf=TextFlowMaker.generateTextFlow1(str)}else{if(!descArr[j]){var minCfg=GlobalConfig.TogetherHitEquipQmConfig;for(var c1 in minCfg){for(var c2 in minCfg[c1]){str=i18n("HejiPanel_19",colorMap[i],c2,j,this.otherBlueN,cfg[c1][c2][j].desc);tf=TextFlowMaker.generateTextFlow1(str);for(var _i=0,tf_1=tf;_i<tf_1.length;_i++){var f=tf_1[_i];if(f.style){delete f.style.textColor}}this[""+labName+j].textColor=this.colorGrayN;break}break}}}if(str)this[""+labName+j].textFlow=tf}break}}break}}};HejiPanel.prototype.updateForge=function(){this.turnPunchForge.visible=UserSkill.ins().getPunchForge().isShowPunchEquipForge()};return HejiPanel}(BaseView);__reflect(HejiPanel.prototype,"HejiPanel");var HejiProgressItem=function(_super){__extends(HejiProgressItem,_super);function HejiProgressItem(){var _this=_super.call(this)||this;_this.skinName="PunchItemSkin";return _this}HejiProgressItem.prototype.dataChanged=function(){var curPro=UserSkill.ins().hejiProgressList[this.itemIndex];if(!curPro)return;this.descLab.text=this.data.j+"";this.nameLab.text=this.data.t+"";this.label0.text="("+curPro.progress+"/"+this.data.v+")";this.goBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this)};return HejiProgressItem}(BaseItemRender);__reflect(HejiProgressItem.prototype,"HejiProgressItem");var HomeBossRemindItem=function(_super){__extends(HomeBossRemindItem,_super);function HomeBossRemindItem(){var _this=_super.call(this)||this;_this._move=false;return _this}HomeBossRemindItem.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)};HomeBossRemindItem.prototype.onTouchBegin1=function(e){this._lastSelect=this.checkBoxs.selected;this._move=false;if(this.$stage){this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this);this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this)}};HomeBossRemindItem.prototype.onTouchMove1=function(){this._move=true};HomeBossRemindItem.prototype.onTouchEnd1=function(){if(this._move){this.checkBoxs.selected=this._lastSelect;this._move=false}if(this.$stage){this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this);this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this)}};HomeBossRemindItem.prototype.dataChanged=function(){var model=this.data;var config=GlobalConfig.WorldBossConfig[model.id];var levelConfig;for(var k in GlobalConfig.BossHomeConfig){if(GlobalConfig.BossHomeConfig[k].boss.lastIndexOf(model.id)!=-1){levelConfig=GlobalConfig.BossHomeConfig[k];break}}var canChallenge=false;if(levelConfig){if(config.zsLevel>0){canChallenge=UserZs.ins().lv>=config.zsLevel}else{canChallenge=Actor.level>=config.level}if(!canChallenge)this.txt.text=i18n("HomeBossRemindItem_0");this.levelShow.text=config.zsLevel>0?config.zsLevel+i18n("HomeBossRemindItem_1"):config.level+i18n("HomeBossRemindItem_2")}else{canChallenge=false;this.levelShow.text="";this.txt.text=i18n("HomeBossRemindItem_3")}this.checkBoxs.visible=canChallenge;if(canChallenge){this.checkBoxs.selected=UserBoss.ins().getBossRemindByIndex(model.id)}this.txt.visible=!this.checkBoxs.visible;this.checkBoxs.name=model.id+"";var boss=GlobalConfig.MonstersConfig[config.bossId];this.bossName.text=boss.name};return HomeBossRemindItem}(BaseItemRender);__reflect(HomeBossRemindItem.prototype,"HomeBossRemindItem");var HonorMarketItemRenderer=function(_super){__extends(HonorMarketItemRenderer,_super);function HonorMarketItemRenderer(){var _this=_super.call(this)||this;_this.goodsID=0;_this.skinName="HonorMarketItemSkin";_this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onClick,_this);_this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.showTip,_this);_this.itemIcon.imgJob.visible=false;return _this}HonorMarketItemRenderer.prototype.dataChanged=function(){var shopItem=this.data;if(!shopItem||!(shopItem instanceof FeatsStore))return;this.goodsID=shopItem.goods[0].id;var itemConfig=GlobalConfig.ItemConfig[this.goodsID];if(!itemConfig)return;this.isShowTips=false;if(shopItem.shopType==FEATS_SHOP_TYPE.Money){this.money.text=shopItem.costMoney.count+"";this.moneyIcon.source="ZSchip"}else if(shopItem.shopType==FEATS_SHOP_TYPE.Item){this.money.text=shopItem.costItem.count+"";this.moneyIcon.source="204076_png"}this.itemName.text=itemConfig.name;this.itemName.textColor=ItemConfig.getQualityColor(itemConfig);this.itemName.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.num.text=shopItem.goods[0].count+"";if(this.itemIcon&&this.itemIcon.setData){this.itemIcon.setData(itemConfig)}if(shopItem.use)this.usage.text="（"+shopItem.use+"）";if(shopItem.buyType==FEATS_TYPE.forever){this.myTimes.visible=true;var myCount=Shop.ins().medalData.exchangeCount[shopItem.index];myCount=myCount?myCount:0;var textcolor=this.myTimes.textColor;var colorStr=void 0;var str="";if(shopItem.daycount){if(myCount>=shopItem.daycount){colorStr=ColorUtil.RED_COLOR_N;str=i18n("HonorMarketItemRenderer_0",colorStr,myCount,shopItem.daycount)}else{colorStr=ColorUtil.GREEN_COLOR_N;str=i18n("HonorMarketItemRenderer_1",colorStr,myCount,textcolor,shopItem.daycount)}}this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(str)}else if(shopItem.buyType==FEATS_TYPE.infinite){this.myTimes.visible=false}else if(shopItem.buyType==FEATS_TYPE.day){this.myTimes.visible=true;var myCount=Shop.ins().medalData.exchangeCount[shopItem.index];myCount=myCount?myCount:0;var textcolor=this.myTimes.textColor;var colorStr=void 0;var str="";if(shopItem.daycount){if(myCount>=shopItem.daycount){colorStr=ColorUtil.RED_COLOR_N;str=i18n("HonorMarketItemRenderer_2",colorStr,myCount,shopItem.daycount);this.isShowTips=true}else{colorStr=ColorUtil.GREEN_COLOR_N;str=i18n("HonorMarketItemRenderer_3",colorStr,myCount,textcolor,shopItem.daycount)}}this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(str)}};HonorMarketItemRenderer.prototype.onClick=function(){if(this.isShowTips){UserTips.ins().showTips(i18n("HonorMarketItemRenderer_4",16711680));return}if(this.data.shopType==FEATS_SHOP_TYPE.Money){ViewManager.ins().open(BuyWin,this.data.index,2)}else if(this.data.shopType==FEATS_SHOP_TYPE.Item){ViewManager.ins().open(BuyWin,this.data.index,3)}};HonorMarketItemRenderer.prototype.showTip=function(){var items=GlobalConfig.FeatsStore;var configID;for(var k in items){if(items[k].goods[0].id==this.goodsID){configID=items[k].goods[0].id}}if(configID==undefined){new Error(i18n("HonorMarketItemRenderer_5"))}var itemConfig=GlobalConfig.ItemConfig[configID];var shopItem=this.data;ViewManager.ins().open(ItemDetailedWin,0,itemConfig.id,shopItem.goods[0].count)};return HonorMarketItemRenderer}(BaseItemRender);__reflect(HonorMarketItemRenderer.prototype,"HonorMarketItemRenderer");var DragonBones=function(_super){__extends(DragonBones,_super);function DragonBones(res,texNum,compFunc,actionArray,isLoop,imgType,needBody,onLoaded,imgPre){if(res===void 0){res="juqin01"}if(texNum===void 0){texNum=2}if(compFunc===void 0){compFunc=null}if(actionArray===void 0){actionArray=["01xianhe_renwuani_once"]}if(isLoop===void 0){isLoop=true}if(imgType===void 0){imgType="_png"}if(needBody===void 0){needBody=false}if(onLoaded===void 0){onLoaded=null}if(imgPre===void 0){imgPre=""}var _this=_super.call(this)||this;_this.needBody=false;_this.skeletonData=undefined;_this.textures=[];_this.sid=0;_this.res=res;_this.texNum=texNum;_this.compFunc=compFunc;_this.isLoop=isLoop;_this.actionArray=actionArray;_this.imgType=imgType;_this.imgPre=imgPre;_this.needBody=needBody;_this.onLoaded=onLoaded;_this.addEventListener(egret.Event.ADDED_TO_STAGE,_this.onAddToStage,_this);_this.addEventListener(egret.Event.REMOVED_FROM_STAGE,_this.onRemoveFromStage,_this);return _this}DragonBones.prototype.onAddToStage=function(event){DragonBones.cnt++;this.createAni()};DragonBones.prototype.removeEvent=function(){if(this.armatureDisplay){this.armatureDisplay.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onNextMovieClip,this)}this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this);this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this)};DragonBones.prototype.onRemoveFromStage=function(event){DragonBones.cnt--;this.removeEvent();if(this.armature){this.armature.dispose()}DragonBones.body=null;dragonBones.WorldClock.clock.remove(this.armature)};DragonBones.prototype.loadTexture=function(i){var self=this;var textureDataName;var textureName;if(this.texNum>1){if(this.imgPre){textureName=this.res+"_"+this.imgPre+"_tex_"+i+this.imgType;textureDataName=this.res+"_"+this.imgPre+"_tex_"+i+"_json"}else{textureName=this.res+"_tex_"+i+this.imgType;textureDataName=this.res+"_tex_"+i+"_json"}var img=new eui.Image(textureName);img.visible=false;this.addChild(img)}else{if(this.imgPre){textureName=this.res+"_"+this.imgPre+"_tex"+this.imgType;textureDataName=this.res+"_"+this.imgPre+"_tex_json"}else{textureName=this.res+"_tex"+this.imgType;textureDataName=this.res+"_tex_json"}img=new eui.Image(textureName);img.visible=false;this.addChild(img)}this.textures[i]={texture:null,textureData:null};RES.getResAsync(textureDataName,function(data,key){self.textures[i].textureData=data;self.checkLoaded()},this);RES.getResAsync(textureName,function(data,key){self.textures[i].texture=data;self.checkLoaded()},this)};DragonBones.prototype.checkLoaded=function(){this.loadedNum+=1;if(this.loadedNum==this.toLoadNum){var self=this;setTimeout(function(){self.startPlay()},10)}};DragonBones.prototype.createAni=function(){this.container=new egret.DisplayObjectContainer;this.addChild(this.container);this.toLoadNum=this.texNum*2+1;this.loadedNum=0;this.textures=[];var self=this;var skeletonDataName=this.res+"_ske_json";RES.getResAsync(skeletonDataName,function(data,key){self.skeletonData=data;self.checkLoaded()},this);for(var i=0;i<this.texNum;++i){this.loadTexture(i)}if(DragonBones.tickerInited==false){egret.startTick(DragonBones.onTicker,DragonBones);DragonBones.tickerInited=true}};DragonBones.onTicker=function(timeStamp){if(this.cnt>0){if(!this._time){this._time=timeStamp}var now=timeStamp;var pass=now-this._time;this._time=now;dragonBones.WorldClock.clock.advanceTime(pass/1e3);DragonBones.setBodyPos()}else{egret.stopTick(DragonBones.onTicker,DragonBones);DragonBones.tickerInited=false}return false};DragonBones.prototype.getResMc=function(fileName,state,dir){var mc=new MovieClip;if(!fileName)return;mc.scaleX=dir>4?-1:1;var td=2*(dir-4);if(td<0)td=0;var resDir=dir-td;var s=fileName+"_"+resDir+state;mc.playFile(s,-1,null,false);return mc};DragonBones.prototype.startPlay=function(){var factory=new dragonBones.EgretFactory;if(!this.skeletonData||this.textures.length==0){return}var dragonBonesData=dragonBones.DataParser.parseDragonBonesData(this.skeletonData);factory.addDragonBonesData(dragonBonesData);for(var _i=0,_a=this.textures;_i<_a.length;_i++){var tex=_a[_i];if(!tex){return}if(!tex.textureData){return}if(!tex.texture){return}factory.addTextureAtlasData(factory.parseTextureAtlasData(tex.textureData,tex.texture))}this.armature=factory.buildArmature("Armature");this.armatureDisplay=this.armature.getDisplay();dragonBones.WorldClock.clock.add(this.armature);this.container.addChild(this.armatureDisplay);this.armatureDisplay.x=0;this.armatureDisplay.y=0;this.actionFlag=0;if(this.needBody){DragonBones.xianhe_renwu=this.armature.getBone("xianhe_renwu");DragonBones.body=new eui.Group;DragonBones.xianhe_renwu.armature.getDisplay().addChild(DragonBones.body);DragonBones.setBodyPos();var bodyMc=EntityManager.ins().getMainRole(0).getBodyMC("f",1);DragonBones.body.addChild(bodyMc);var job=SubRoles.ins().getSubRoleByIndex(0).job;var weaponMc=this.getResMc(RES_DIR_WEAPON+"weapon"+job+"04_0","f",1);DragonBones.body.addChild(weaponMc);var bodyLoaded=false;var weaponLoaded=false;weaponMc.addEventListener(egret.Event.CHANGE,function(){weaponLoaded=true;weaponMc.removeEventListener(egret.Event.CHANGE,null,null);if(bodyLoaded){weaponMc.gotoAndPlay(bodyMc.currentFrame,-1)}},null);bodyMc.addEventListener(egret.Event.CHANGE,function(){bodyLoaded=true;bodyMc.removeEventListener(egret.Event.CHANGE,null,null);if(weaponLoaded){weaponMc.gotoAndPlay(bodyMc.currentFrame,-1)}},null)}this.playActionArray(this.actionArray,this.isLoop,this.compFunc);if(this.onLoaded){this.onLoaded()}};DragonBones.setBodyPos=function(){if(!this.body){return}this.body.x=DragonBones.xianhe_renwu.global.x;this.body.y=DragonBones.xianhe_renwu.global.y};DragonBones.prototype.playActionArray=function(actionArray,isLoop,compFunc){if(isLoop===void 0){isLoop=false}if(compFunc===void 0){compFunc=null}this.sid=0;if(!actionArray){return}if(actionArray.length<1){return}this.actionArray=actionArray;this.isLoop=isLoop;this.compFunc=compFunc;var times=1;if(this.actionArray.length==1){times=isLoop?0:1}if(this.armatureDisplay){this.armatureDisplay.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onNextMovieClip,this);this.armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onNextMovieClip,this)}if(this.armature&&this.armature.animation){this.armature.animation.play(this.actionArray[0],times)}};DragonBones.prototype.onNextMovieClip=function(){this.sid++;if(this.sid>=this.actionArray.length){if(this.compFunc){this.compFunc()}return}var times=1;if(this.sid==this.actionArray.length-1){if(this.isLoop){times=0}}this.armature.animation.play(this.actionArray[this.sid],times)};DragonBones.cnt=0;DragonBones.tickerInited=false;DragonBones.body=null;return DragonBones}(egret.DisplayObjectContainer);__reflect(DragonBones.prototype,"DragonBones");var ItemBaseDaTHighVip=function(_super){__extends(ItemBaseDaTHighVip,_super);function ItemBaseDaTHighVip(){var _this=_super.call(this)||this;_this.isShowName(false);_this.setDatHighVip(true);return _this}return ItemBaseDaTHighVip}(ItemBase);__reflect(ItemBaseDaTHighVip.prototype,"ItemBaseDaTHighVip");var ItemBaseDaTYearVip=function(_super){__extends(ItemBaseDaTYearVip,_super);function ItemBaseDaTYearVip(){var _this=_super.call(this)||this;_this.isShowName(false);_this.setDatYearVip(true);return _this}return ItemBaseDaTYearVip}(ItemBase);__reflect(ItemBaseDaTYearVip.prototype,"ItemBaseDaTYearVip");var ItemBaseNoName=function(_super){__extends(ItemBaseNoName,_super);function ItemBaseNoName(){var _this=_super.call(this)||this;_this.isShowName(false);return _this}return ItemBaseNoName}(ItemBase);__reflect(ItemBaseNoName.prototype,"ItemBaseNoName");var ItemBaseNoTap=function(_super){__extends(ItemBaseNoTap,_super);function ItemBaseNoTap(){return _super.call(this)||this}ItemBaseNoTap.prototype.onClick=function(){};return ItemBaseNoTap}(ItemBase);__reflect(ItemBaseNoTap.prototype,"ItemBaseNoTap");var ItemBaseQzVip=function(_super){__extends(ItemBaseQzVip,_super);function ItemBaseQzVip(){var _this=_super.call(this)||this;_this.isShowName(false);_this.setQzVip(true);return _this}return ItemBaseQzVip}(ItemBase);__reflect(ItemBaseQzVip.prototype,"ItemBaseQzVip");var ItemBaseVip=function(_super){__extends(ItemBaseVip,_super);function ItemBaseVip(){var _this=_super.call(this)||this;_this.isShowName(false);_this.setVip(true);return _this}return ItemBaseVip}(ItemBase);__reflect(ItemBaseVip.prototype,"ItemBaseVip");var ItemIcon=function(_super){__extends(ItemIcon,_super);function ItemIcon(){var _this=_super.call(this)||this;_this.skinName="ItemIconSkin";return _this}ItemIcon.prototype.setSoul=function(isSoul){this.tag.visible=isSoul};ItemIcon.prototype.setData=function(config){this.config=config;if(config!=null){this.setIconfix(config);this.imgIcon.source=config.icon+"_png";this.imgBg.source="quality"+ItemConfig.getQuality(config);var type=ItemConfig.getType(config);var job=ItemConfig.getJob(config);this.imgJob.source=(type==0||type==4)&&job&&this.imgJob.visible?"job"+job+"Item":"";var ClientGlobalConfig_1=GlobalConfig.getConfigByName("ClientGlobalConfig");if(ClientGlobalConfig_1.effectItems.indexOf&&ClientGlobalConfig_1.effectItems.indexOf(config.id)>=0){if(this.effect==null){this.effect=new MovieClip;this.effect.x=35;this.effect.y=35;this.addChildAt(this.effect,2);this.effect.addEventListener(egret.Event.ADDED_TO_STAGE,this.resumePlay,this)}this.effect.playFile(RES_DIR_EFF+"quality_0"+ItemConfig.getQuality(config))}else if(this.effect!=null){}}else{this.imgIcon.source="";this.imgBg.source="quality0";this.imgJob.source="";if(this.effect!=null){}}};ItemIcon.prototype.setIconfix=function(config){switch(config.id){case 200136:config.icon=200136;break}};ItemIcon.prototype.resumePlay=function(e){this.effect.play(-1)};ItemIcon.prototype.setActived=function(b){this.actived.visible=b};ItemIcon.prototype.setImgBg1=function(res){this.imgBg1.visible=true;this.imgBg.visible=!this.imgBg1.visible;if(res)this.imgBg1.source=res};return ItemIcon}(BaseComponent);__reflect(ItemIcon.prototype,"ItemIcon");var shop=GameSystem.shop;window["shop"]=shop;var ItemShopItemRenderer=function(_super){__extends(ItemShopItemRenderer,_super);function ItemShopItemRenderer(){var _this=_super.call(this)||this;_this.goodsID=0;_this.skinName="ItemShopItem";_this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.showTip,_this);_this.itemIcon.imgJob.visible=false;return _this}ItemShopItemRenderer.prototype.dataChanged=function(){var shopItem=this.data;var itemConfig=GlobalConfig.ItemConfig[shopItem.itemId];this.goodsID=shopItem.id;var costStr="";if(shopItem.price>1e5){costStr=Math.floor(shopItem.price/1e4)+i18n("ItemShopItemRenderer_0")}else{costStr=shopItem.price+""}this.money.text=costStr;this.itemName.text=itemConfig.name;this.itemName.textColor=ItemConfig.getQualityColor(itemConfig);this.itemName.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.used.text="（"+shopItem.use+"）";this.used.x=this.itemName.x+this.itemName.width;if(shopItem.viplv&&UserVip.ins().lv<shopItem.viplv){this.num.visible=true;this.num.text=i18n("ItemShopItemRenderer_1",shopItem.viplv)}else if(shopItem.vipLimit){var hadBuyItem=Shop.ins().shopData.getHadBuyCountItem(shopItem.itemId);var hadBuyCount=0;if(hadBuyItem){hadBuyCount=hadBuyItem.count}var total=shopItem.vipLimit[UserVip.ins().lv];this.num.text=i18n("ItemShopItemRenderer_2",total-hadBuyCount);this.num.visible=true}else{this.num.visible=false}if(this.itemIcon&&this.itemIcon.setData){this.itemIcon.setData(itemConfig)}};ItemShopItemRenderer.prototype.showTip=function(){var items=GlobalConfig.ItemStoreConfig;var configID;for(var k in items){if(items[k].id==this.goodsID){configID=items[k].itemId}}if(configID==undefined){new Error(i18n("ItemShopItemRenderer_3"))}var itemConfig=GlobalConfig.ItemConfig[configID];ViewManager.ins().open(ItemDetailedWin,0,itemConfig.id,1)};return ItemShopItemRenderer}(BaseItemRender);__reflect(ItemShopItemRenderer.prototype,"ItemShopItemRenderer");var ItemStage=function(_super){__extends(ItemStage,_super);function ItemStage(){var _this=_super.call(this)||this;_this.skinName="LvSkin";return _this}ItemStage.prototype.convert=function(strNum){for(var i=0;i<strNum.length;i++){strNum[i]=StringUtils.NumberToChinese(Number(strNum[i]))}return strNum};ItemStage.prototype.dataChanged=function(){if(!this.data||!(typeof this.data=="string"))return;var strNum=StringUtils.getStrByRegExp(this.data);var strChn=StringUtils.getStrByRegExp(this.data,/[\u4E00-\u9FA5]+/g);var stage="";var tempF=[];var tempA=[];var tempFindex=this.data.indexOf(strNum[0]);var tempAindex=this.data.indexOf(strChn[0]);if(tempFindex>=0&&tempAindex>=0){if(tempFindex<tempAindex){tempF=this.convert(strNum);tempA=strChn}else{tempF=strChn;tempA=this.convert(strNum)}}else{if(tempFindex==-1){tempF=strChn}else{tempF=this.convert(strNum)}}for(var i=0;i<tempF.length;i++){stage+=tempF[i];if(tempA[i]){stage+=tempA[i]}}this.lv0.text=stage};ItemStage.prototype.destruct=function(){};return ItemStage}(BaseItemRender);__reflect(ItemStage.prototype,"ItemStage");var JingMaiPanel=function(_super){__extends(JingMaiPanel,_super);function JingMaiPanel(){var _this=_super.call(this)||this;_this.cursorLocation=[[132,131],[92,186],[165,177],[138,252],[84,231],[96,316],[152,339],[126,431]];_this.curRole=0;_this.canClick=true;_this.name=i18n("JingMaiPanel_0");return _this}JingMaiPanel.prototype.childrenCreated=function(){this.init()};JingMaiPanel.prototype.init=function(){this.danItemID=GlobalConfig.JingMaiCommonConfig.levelItemid;this.cursor=new MovieClip;this.cursor.visible=false};JingMaiPanel.prototype.open=function(){this.addTouchEvent(this.boostBtn,this.onTap);this.addTouchEvent(this.bigUpLevelBtn,this.onTap);this.observe(UserJingMai.ins().postUpdate,this.setForgeData);this.observe(UserBag.ins().postItemAdd,this.setForgeData);this.cursor.playFile(RES_DIR_EFF+"jingmaiCursor",-1);this.setForgeData(false);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.xueWei)};JingMaiPanel.prototype.close=function(){this.removeTouchEvent(this.boostBtn,this.onTap);this.removeTouchEvent(this.bigUpLevelBtn,this.onTap);this.canClick=true;this.removeObserve();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};JingMaiPanel.prototype.onTap=function(e){var _this=this;switch(e.currentTarget){case this.boostBtn:var config=GlobalConfig.JingMaiLevelConfig[this._data.level];if(!this.canClick)return;if(this._data.level%10==0&&this._data.level/10>this._data.stage&&this._data.level!=0){this.canClick=false;this.showUpgradeEffect();TimerManager.ins().doTimer(1e3,1,function(){UserJingMai.ins().sendUpgrade(_this.curRole);SoundUtil.ins().playEffect(SoundUtil.SKILL_UP);_this.canClick=true},this)}else{if(UserBag.ins().getBagGoodsCountById(0,config.itemId)>=config.count){UserJingMai.ins().sendBoost(this.curRole);SoundUtil.ins().playEffect(SoundUtil.SKILL_UP)}else{UserWarn.ins().setBuyGoodsWarn(config.itemId)}}break;case this.bigUpLevelBtn:var itemName=GlobalConfig.ItemConfig[this.danItemID].name;WarnWin.show(i18n("JingMaiPanel_1")+itemName+i18n("JingMaiPanel_2")+GlobalConfig.JingMaiCommonConfig.levelItemidStage+i18n("JingMaiPanel_3")+GlobalConfig.JingMaiCommonConfig.levelItemChange+i18n("JingMaiPanel_4")+GlobalConfig.ItemConfig[GlobalConfig.JingMaiCommonConfig.itemid].name,function(){UserJingMai.ins().sendBigUpLevel(_this.curRole)},this);break}};JingMaiPanel.prototype.showLight=function(lv,flag){};JingMaiPanel.prototype.showUpgradeEffect=function(){for(var i=0;i<=9;i++){this["jinmai_"+i].setLights(4)}};JingMaiPanel.prototype.setForgeData=function(levelUp){if(levelUp===void 0){levelUp=true}this._data=SubRoles.ins().getSubRoleByIndex(this.curRole).jingMaiData;var stagesConfig=GlobalConfig.JingMaiStageConfig[this._data.stage];var lvConfig=GlobalConfig.JingMaiLevelConfig[this._data.level];this.jinmaiStage.setValue(stagesConfig.level);this.jinMaiName.text=stagesConfig.name;this.attr.text=AttributeData.getAttStr(AttributeData.AttrAddition(stagesConfig.attr,lvConfig.attr),.75);this._totalPower=UserBag.getAttrPower(AttributeData.AttrAddition(stagesConfig.attr,lvConfig.attr));this.powerPanel.setPower(this._totalPower);var flag=this._data.level/10-stagesConfig.stage;if(stagesConfig.stage<GlobalConfig.JingMaiCommonConfig.stageMax){var nextStagesConfig=void 0;var nextLvConfig=void 0;var count_1=UserBag.ins().getBagGoodsCountById(0,lvConfig.itemId);this.redPoint0.visible=count_1>=lvConfig.count;if(this._data.level>0&&this._data.level%10==0&&flag){nextStagesConfig=GlobalConfig.JingMaiStageConfig[this._data.stage+1];nextLvConfig=lvConfig}else{nextStagesConfig=stagesConfig;nextLvConfig=GlobalConfig.JingMaiLevelConfig[this._data.level+1]}if(this.nextAttr.visible==false){this.nextAttr.visible=true;this.countLabel.x=2;this.countLabel.y=497}this.nextAttr.text=AttributeData.getAttStr(AttributeData.AttrAddition(nextStagesConfig.attr,nextLvConfig.attr),0,1,"+",false,true);this.boostBtn.visible=true;if(this._data.level>0&&this._data.level%10==0&&flag){this.boostBtn.label=i18n("JingMaiPanel_5");this.countLabel.text=i18n("JingMaiPanel_6");this.cursor.visible=false}else{this.boostBtn.label=i18n("JingMaiPanel_7");var colorStr="";if(count_1>=lvConfig.count)colorStr=i18n("JingMaiPanel_10");else colorStr=i18n("JingMaiPanel_11");this.countLabel.textFlow=TextFlowMaker.generateTextFlow(i18n("JingMaiPanel_8")+colorStr+count_1+"|/"+lvConfig.count)}this.cursor.x=this.cursorLocation[this._data.level%8][0];this.cursor.y=this.cursorLocation[this._data.level%8][1];this.showLight(this._data.level,flag)}else{this.nextAttr.visible=false;this.boostBtn.visible=false;this.countLabel.x=this.nextAttr.x-60;this.countLabel.y=this.nextAttr.y;this.redPoint0.visible=false;if(this.cursor.parent){this.removeChild(this.cursor)}this.countLabel.text=i18n("JingMaiPanel_9")}for(var i=0;i<9;i++){this["nadis"+i].source="jingmailine"+(flag==1||i+1<this._data.level%10?"1":"2")}var hasGuang=true;var jmItem;for(var i=0;i<=9;i++){jmItem=this["jinmai_"+i];jmItem.item.visible=flag==1||i+1<=this._data.level%10?true:false;jmItem.bgImg.visible=!jmItem.item.visible;if(jmItem.item.visible){jmItem.setLights(2)}else{if(levelUp&&hasGuang&&i-1>=0){this["jinmai_"+(i-1)].setLights(3)}jmItem.setLights(hasGuang?1:0);hasGuang=false}}var count=UserBag.ins().getBagGoodsCountById(0,this.danItemID);if(this.bigUpLevelBtn["redPoint"]){this.bigUpLevelBtn["redPoint"].visible=count>0}if(this.bigUpLevelBtn["txt"]){this.bigUpLevelBtn["txt"].text=count}};return JingMaiPanel}(BaseView);__reflect(JingMaiPanel.prototype,"JingMaiPanel");var JimMaiItem=function(_super){__extends(JimMaiItem,_super);function JimMaiItem(){var _this=_super.call(this)||this;_this.skinName="JinMaiItemSkin";_this.guang.visible=false;return _this}JimMaiItem.prototype.setLights=function(type){var _this=this;if(type==0&&this.mc){this.mc.stop();this.mc.visible=false;return}if(this.mc==null){this.mc=new MovieClip;this.mc.x=this.mc.y=20;this.addChild(this.mc)}this.mc.visible=true;if(!this.mc.parent)this.addChild(this.mc);if(type==1)this.mc.playFile(RES_DIR_EFF+"bally1",-1);else if(type==2)this.mc.playFile(RES_DIR_EFF+"bally2",-1);else if(type==3){var t=egret.Tween.get(this);this.mc.playFile(RES_DIR_EFF+"bally3",1,null,false);t.wait(800).call(function(){_this.mc.playFile(RES_DIR_EFF+"bally2",-1)})}else if(type==4)this.mc.playFile(RES_DIR_EFF+"bally3",1,function(){DisplayUtils.removeFromParent(_this.mc);_this.mc=null},true)};return JimMaiItem}(BaseComponent);__reflect(JimMaiItem.prototype,"JimMaiItem");var LadderStarListView=function(_super){__extends(LadderStarListView,_super);function LadderStarListView(){return _super.call(this)||this}LadderStarListView.prototype.childrenCreated=function(){this.init()};LadderStarListView.prototype.init=function(){this.skinName="LadderSratListSkin";this.level.anchorOffsetX=10;this.level.anchorOffsetY=14;this.level.x=100;this.level.y=141};LadderStarListView.prototype.setLvAndRank=function(info){if(info==undefined){this.dwImg.source="ladder_rank_0";this.level.source=null;return}this.dwImg.source="ladder_rank_"+info.level;if(info.level>=4||info.showDan<=0||info.showDan>5){this.level.source=null}else{this.level.source="laddergradnum_"+info.showDan}};LadderStarListView.prototype.updataStarInfo=function(info,change){if(change===void 0){change=true}if(info){this.len=Ladder.ins().getStatuByLevel(info.level);for(var i=1;i<=5;i++){this["star"+i].currentState=i>info.showStar?"black":"light"}}else{this.len=0}this.currentState=this.len+"";this.setLvAndRank(info)};LadderStarListView.prototype.upStarStatu=function(index,num,light){var _this=this;if(light===void 0){light=false}var times=num;var _index=light?index:index-1;var self=this;if(_index<=0){_index=1}if(this.mc==undefined){this.mc=new MovieClip}var item=this["star"+_index];this.mc.x=item.x+22;this.mc.y=item.y+22;this.addChild(this.mc);var len=this.len;if(light){--times;this.mc.playFile(RES_DIR_EFF+"addstar",1,function(){if(self.getChildIndex(self.mc)!=-1)self.removeChild(self.mc);item.currentState="light";if(len==_index)item.currentState="black";if(times>0&&_index<_this.len){_this.upStarStatu(++_index,times,light)}})}else{--times;--_index;this.mc.playFile(RES_DIR_EFF+"minusstar",1,function(){if(self.getChildIndex(self.mc)!=-1)self.removeChild(self.mc);item.currentState="black";if(_index==0){var win=ViewManager.ins().getView(LadderResultWin);if(win&&win.isShow())win.cheackIsChangeLevel(times);_this.upSign=false}});times=0}if(light&&_index==this.len){var win=ViewManager.ins().getView(LadderResultWin);if(win&&win.isShow())win.cheackIsChangeLevel(times);this.upSign=true}};LadderStarListView.prototype.showLvUp=function(currentLv){this.numLevel=currentLv};LadderStarListView.prototype.showRankUp=function(currentRank){this.numRank=currentRank;this.rankMc=new MovieClip;this.rankMc.x=100;this.rankMc.y=99;this.rankMc.playFile(RES_DIR_EFF+"ladderlvup",1,this.RankChangeCallback.bind(this));this.addChild(this.rankMc)};LadderStarListView.prototype.showLvDown=function(currentLv){this.numLevel=currentLv;this.level.source="laddergradnum_"+this.numLevel};LadderStarListView.prototype.RankChangeCallback=function(){this.dwImg.source="ladder_rank_"+this.numRank;var tw=egret.Tween.get(this.dwImg);this.dwImg.alpha=0;tw.to({alpha:1},700)};return LadderStarListView}(BaseComponent);__reflect(LadderStarListView.prototype,"LadderStarListView");var LadderStarView=function(_super){__extends(LadderStarView,_super);function LadderStarView(){return _super.call(this)||this}LadderStarView.prototype.childrenCreated=function(){};return LadderStarView}(BaseComponent);__reflect(LadderStarView.prototype,"LadderStarView");var LevelImage=function(_super){__extends(LevelImage,_super);function LevelImage(){var _this=_super.call(this)||this;_this._value=1;_this.skinName="jiejiSkin";return _this}LevelImage.prototype.getValue=function(){return this._value};LevelImage.prototype.setValue=function(val){if(val<=0)val=1;this._value=val;var str=val+"";if(val<=10){this.currentState="1";this.num1.source="jieji0"+str+"_png"}else if(val<=20||val%10==0){this.currentState="2";if(str.charAt(0)=="1"){this.num21.source="jieji010_png";this.num22.source="jieji0"+str.charAt(1)+"_png"}else{this.num21.source="jieji0"+str.charAt(0)+"_png";this.num22.source="jieji010_png"}}else if(val<100){this.currentState="3";this.num31.source="jieji0"+str.charAt(0)+"_png";this.num32.source="jieji010_png";this.num33.source="jieji0"+str.charAt(1)+"_png"}};return LevelImage}(BaseComponent);__reflect(LevelImage.prototype,"LevelImage");var MijiItem=function(_super){__extends(MijiItem,_super);function MijiItem(){var _this=_super.call(this)||this;_this.addImgEnabled=true;_this.curRole=0;_this.curGrid=0;_this.xianyu_name_alpha=0;_this.UnlockType={zslevel:1,viplevel:2,chapter:3,marriage:4,prop:5};_this.skinName="MijiItemSkin";return _this}MijiItem.prototype.showName=function(){this.xianyu_name_alpha=1};MijiItem.prototype.dataChanged=function(){this.addImg.visible=false;this.itemLock.visible=false;this.unlearn.visible=false;this.redPoint.visible=false;this.xianyu_name.text="";if(this.data==null){this.lock.visible=true;this.icon.source="";this.setUnlearn(false)}else if(this.data instanceof ItemData){this.lock.visible=false;this.icon.source=this.data.itemConfig.icon+"_png";this.xianyu_name.text=UserMiji.ins().showXianyuName?this.data.itemConfig.name:"";this.xianyu_name.alpha=this.xianyu_name_alpha;this.count.text=this.data.count+"";this.count2.text=this.data.count+"";this.icon.visible=true}else if(!isNaN(this.data.id)||!isNaN(this.data)){var b=!isNaN(this.data.id);this.lock.visible=false;this.count.text="";this.count2.text="";var id=void 0;if(b){this.itemLock.visible=this.data.isLocked;id=this.data.id}else{id=this.data}if(GlobalConfig.MiJiSkillConfig[id]){var itemId=GlobalConfig.MiJiSkillConfig[id].item;var cfg=GlobalConfig.ItemConfig[itemId];if(cfg)this.icon.source=cfg.icon+"_png";this.xianyu_name.text=UserMiji.ins().showXianyuName?cfg.name:"";this.xianyu_name.alpha=this.xianyu_name_alpha;this.icon.visible=true}else{this.icon.source="";this.addImg.visible=this.addImgEnabled;this.redPoint.visible=this.addImgEnabled&&UserMiji.ins().isMjiSum(this.curRole,this.curGrid)}}this.select.visible=false};MijiItem.prototype.setCountLabel=function(index){var cfg=GlobalConfig.XianyuUnlockBase[this.curRole+1][index+1];this.setCountLabel1(cfg);this.setCountLabel2(cfg);if(cfg.type2!=cfg.type){this.count2.visible=true;this.count.x=21}else{this.count2.visible=false;this.count.x=-8;this.count.horizontalCenter=4}this.count.visible=true};MijiItem.prototype.setCountLabel1=function(cfg){if(cfg.type==this.UnlockType.zslevel){this.count.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+cfg.type_value+i18n("MijiItem_1"))}else if(cfg.type==this.UnlockType.viplevel){this.count.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+i18n("MijiItem_7")+cfg.type_value+i18n("MijiItem_2"))}else if(cfg.type==this.UnlockType.chapter){this.count.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+i18n("MijiItem_3")+cfg.type_value+i18n("MijiItem_4"))}else if(cfg.type==this.UnlockType.marriage){this.count.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+i18n("MijiItem_5"))}else if(cfg.type==this.UnlockType.prop){this.count.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+i18n("MijiItem_6"))}};MijiItem.prototype.setCountLabel2=function(cfg){if(cfg.type2==this.UnlockType.zslevel){this.count2.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+cfg.type_value2+i18n("MijiItem_9")+i18n("MijiItem_8"))}else if(cfg.type2==this.UnlockType.viplevel){this.count2.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+i18n("MijiItem_7")+cfg.type_value2+i18n("MijiItem_8"))}else if(cfg.type2==this.UnlockType.chapter){this.count2.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+i18n("MijiItem_3")+cfg.type_value2+i18n("MijiItem_8"))}else if(cfg.type2==this.UnlockType.marriage){this.count2.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+i18n("MijiItem_5")+i18n("MijiItem_8"))}else if(cfg.type2==this.UnlockType.prop){this.count2.textFlow=(new egret.HtmlTextParser).parser("<font color = '#EFCB15'>"+i18n("MijiItem_6")+i18n("MijiItem_8"))}};MijiItem.prototype.showSelect=function(){this.lock.visible=false;this.icon.source="";this.addImg.visible=false;this.select.visible=true};MijiItem.prototype.hideRedPoint=function(){this.redPoint.visible=false};MijiItem.prototype.setSelected=function(bool){this.select.visible=bool};MijiItem.prototype.setUnlearn=function(b){this.unlearn.visible=b};MijiItem.prototype.setCurRole=function(roleID){if(roleID===void 0){roleID=0}this.curRole=roleID};MijiItem.prototype.setCurGrid=function(gridID){if(gridID===void 0){gridID=0}this.curGrid=gridID};return MijiItem}(BaseItemRender);__reflect(MijiItem.prototype,"MijiItem");var MijiPanel=function(_super){__extends(MijiPanel,_super);function MijiPanel(){var _this=_super.call(this)||this;_this.GRIDNUMBER=10;_this.isTween=false;_this.curRole=0;return _this}MijiPanel.prototype.childrenCreated=function(){this.init()};MijiPanel.prototype.init=function(){this.curRole=0;this.mijiBtn8.visible=false;this.mijiBtn9.visible=false;this.mijiBtns=[this.mijiBtn0,this.mijiBtn1,this.mijiBtn2,this.mijiBtn3,this.mijiBtn4,this.mijiBtn5,this.mijiBtn6,this.mijiBtn7,this.mijiBtn8,this.mijiBtn9];for(var i=0;i<this.GRIDNUMBER;i++){this.mijiBtns[i].showName()}this.eff=new MovieClip;this.eff.playFile(RES_DIR_EFF+"chargeff1");this.eff.x=278;this.eff.y=500;this.eff.scaleX=.7;this.btnGiveLock.visible=!UserMiji.ins().canGive();this.labelGiveInfo.text=i18n("MijiPanel_25")+GlobalConfig.MijiBaseConfig.sendGiftVipLevel+i18n("MijiPanel_1");this.labelGiveInfo.visible=!UserMiji.ins().canGive();this.setBtnNameState();LoginMgr.ins().addEventListener(LoginMgr.EVENT_SHOW_XIANYU_NAME,this.showXianyuNameStateChange,this)};MijiPanel.prototype.showXianyuNameStateChange=function(){for(var i=0;i<this.GRIDNUMBER;i++){this.mijiBtns[i].dataChanged()}};MijiPanel.prototype.setBtnNameState=function(){this.showName.visible=UserMiji.ins().showXianyuName==true?true:false;this.hideName.visible=UserMiji.ins().showXianyuName==true?false:true};MijiPanel.prototype.destructor=function(){};MijiPanel.prototype.setCurRole=function(roleId){if(this.curRole!=roleId){UserMiji.ins().sendAdditionUpdate(this.curRole);this.curRole=roleId;if(this.isTween){this.isTween=false;for(var i=0;i<10;i++){egret.Tween.removeTweens(this["imageMax_"+(i+1)])}}}};MijiPanel.prototype.setData=function(){var ins=UserMiji.ins();var showSetCount=true;for(var i=0;i<this.GRIDNUMBER;i++){this["imageMax_"+(i+1)].visible=false;var numList=void 0;if(ErrorLog.Assert(ins.miji,"MijiPanel   data.miji is null")){this.mijiBtns[i].data=null}else{numList=ins.miji[this.curRole];if(ErrorLog.Assert(numList,"MijiPanel   numList "+"is null  roleId = "+this.curRole)){this.mijiBtns[i].data=null}else{var isLiang=!numList[i]?false:numList[i].id==0?false:true;this["imageMax_"+(i+1)].visible=isLiang;this.mijiBtns[i].setCurRole(this.curRole);this.mijiBtns[i].setCurGrid(i);this.mijiBtns[i].data=!numList[i]?null:numList[i];if(!numList[i]){this.mijiBtns[i].setCountLabel(i);showSetCount=false}}}}};MijiPanel.prototype.updateEff=function(){if(!this.select.visible){this.playEff()}else{DisplayUtils.removeFromParent(this.mc)}};MijiPanel.prototype.playEff=function(){if(!this.mc)this.mc=new MovieClip;if(!this.mc.parent){this.btnAct.addChildAt(this.mc,1);this.mc.x=this.getBtn.x+this.getBtn.width/2;this.mc.y=this.getBtn.y+this.getBtn.height/2}this.mc.playFile(RES_DIR_EFF+"chargeff1",-1)};MijiPanel.prototype.playArrow=function(){if(!this._arrow)this._arrow=new GuideArrow2(true);if(!this._arrow.parent)this.arrow.addChild(this._arrow);this._arrow.x=0;this._arrow.setTips(i18n("MijiPanel_2"));this._arrow.setDirection(0)};MijiPanel.prototype.stopArrow=function(){if(this._arrow)this._arrow.removeTweens();DisplayUtils.removeFromParent(this._arrow);this._arrow=null};MijiPanel.prototype.setOpenDesc=function(){var config=GlobalConfig.MiJiGridConfig[UserMiji.ins().grid[this.curRole]+1];if(config){}else{this.curZsLv.visible=false}};MijiPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setOpenDesc();this.setData();this.addTouchEvent(this.getBtn,this.onTap);this.addTouchEvent(this.change,this.onTap);this.addTouchEvent(this.mijitujian,this.onTap);this.addTouchEvent(this.all,this.onTap);this.addTouchEvent(this.btnLock,this.onTap);this.addTouchEvent(this.select,this.showLevelInfo);this.addTouchEvent(this.btnGive,this.onBtnGive);this.addTouchEvent(this.btnName,this.onTap);for(var a in this.mijiBtns){this.addTouchEvent(this.mijiBtns[a],this.onTap)}this.observe(UserMiji.ins().postMijiData,this.updateRedPoint);this.observe(UserMiji.ins().postSelectedMiji,this.selectMijiItem);this.observe(UserMiji.ins().postMijiLockInfo,this.setData);this.observe(UserMiji.ins().postAdditionUpdate,this.additionUpdate);this.observe(UserMiji.ins().postSetMiji,this.onSetMiji);this.observe(UserMiji.ins().postUnsetMiji,this.onUnsetMiji);this.labelLevel.visible=false;this.labelLevelAward.visible=false;this.labelLevelDesc.visible=false;UserMiji.ins().sendAdditionUpdate(this.curRole);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.xianYu)};MijiPanel.prototype.close=function(){for(var a in this.mijiBtns){this.removeTouchEvent(this.mijiBtns[a],this.onTap)}this.removeTouchEvent(this.getBtn,this.onTap);this.removeTouchEvent(this.change,this.onTap);this.removeTouchEvent(this.mijitujian,this.onTap);this.removeTouchEvent(this.all,this.onTap);this.removeTouchEvent(this.btnLock,this.onTap);this.removeTouchEvent(this.select,this.showLevelInfo);this.removeTouchEvent(this.btnGive,this.onBtnGive);this.removeObserve();DisplayUtils.removeFromParent(this.mc);this.stopArrow();LoginMgr.ins().removeEventListener(LoginMgr.EVENT_SHOW_XIANYU_NAME,this.showXianyuNameStateChange,this);GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};MijiPanel.prototype.onBtnGive=function(){if(UserMiji.ins().canGive()){ViewManager.ins().open(MijiGiveWin)}else{WarnWin.show(i18n("MijiPanel_25")+GlobalConfig.MijiBaseConfig.sendGiftVipLevel.toString()+i18n("MijiPanel_4"),function(){ViewManager.ins().open(VipWin)},this)}};MijiPanel.prototype.showLevelInfo=function(){ViewManager.ins().open(MijiLevelTipWin,UserMiji.ins().minNewLevel)};MijiPanel.prototype.onUnsetMiji=function(params){var roleid=params[0];var grid=params[1];var ok=params[2];if(roleid!=this.curRole){return}if(ok==0){UserTips.ins().showTips(i18n("MijiPanel_5"))}else{this["imageMax_"+(grid+1)].visible=false;this.mijiBtns[grid].showSelect();this.setData();UserTips.ins().showTips(i18n("MijiPanel_7"));var mijiRedPoint=Setting.ins().getValue(ClientSet.mijiRedPoint);if(!mijiRedPoint)Setting.ins().setValue(ClientSet.mijiRedPoint,1)}this.updateEff()};MijiPanel.prototype.onSetMiji=function(params){var _this=this;var roleid=params[0];var grid=params[1];var id=params[2];var ok=params[3];if(roleid!=this.curRole){return}if(ok==0){this.learnUpdateEffect(grid,false,function(){var mc=ObjectPool.pop("MovieClip");mc.scaleX=mc.scaleY=1;mc.rotation=0;mc.x=mc.y=36;mc.playFile(RES_DIR_EFF+"faileff",1,function(){ObjectPool.push(mc)});_this.mijiBtns[grid].addChild(mc);UserTips.ins().showTips(i18n("MijiPanel_8"))})}else{var callback=function(){TimerManager.ins().doTimer(500,1,function(){var mc=ObjectPool.pop("MovieClip");mc.scaleX=mc.scaleY=1;mc.rotation=0;mc.x=mc.y=36;mc.playFile(RES_DIR_EFF+"successeff",1,function(){ObjectPool.push(mc)});_this.mijiBtns[grid].addChild(mc);_this.mijiBtns[grid].showSelect();_this.setData();_this.mijiBtns[grid].hideRedPoint();UserTips.ins().showTips(i18n("MijiPanel_10"));var mijiRedPoint=Setting.ins().getValue(ClientSet.mijiRedPoint);if(!mijiRedPoint)Setting.ins().setValue(ClientSet.mijiRedPoint,1)},_this)};this.learnUpdateEffect2(grid,true,callback)}this.updateEff()};MijiPanel.prototype.learnUpdateEffect2=function(index,isSuss,fun){var _this=this;if(index>10)return;this.isTween=true;var len=10*3+index+1;var i=len-1;var num=i;var time=150*i;var closeTime=150;if(i>7&&i<16){num=i-10;time=150*i}else if(i>15&&i<24){num=i-10*2;time=150*i+100*(i-15);closeTime=250}else if(i>23){num=i-10*3;time=150*i+200*(i-23)+650;closeTime=350}var tw=egret.Tween.get(this["imageMax_"+(num+1)]);this["imageMax_"+(num+1)].visible=true;tw.to({visible:true},150).call(function(){for(var i_6=0;i_6<10;i_6++){egret.Tween.removeTweens(_this["imageMax_"+(i_6+1)]);_this.isTween=false}fun()})};MijiPanel.prototype.additionUpdate=function(params){var roldid=params[0];var canEnhance=params[1];var minNewLevel=params[2];var exPower=params[3];if(roldid==this.curRole){if(canEnhance){this.setLevelAward(minNewLevel.toString()+i18n("MijiPanel_11"),false)}else{this.setLevelAward("",true)}}this.powerPanel.setPower(exPower)};MijiPanel.prototype.refreshLevel=function(){};MijiPanel.prototype.setLevelAward=function(levelStr,showDesc){this.labelLevel.text=levelStr;this.labelLevel.visible=!showDesc;this.labelLevelAward.visible=!showDesc;this.labelLevelDesc.visible=showDesc};MijiPanel.prototype.selectMijiItem=function(itemObj){};MijiPanel.prototype.onBagUseMiji=function(itemId){this.playEff();this.playArrow()};MijiPanel.prototype.learnUpdate=function(para){var _this=this;var index=para[0];var id=para[1];var oldID=para[2];var isSuss=para[3];if(isSuss==1){this.learnUpdateEffect(index,false,function(){var mc=ObjectPool.pop("MovieClip");mc.scaleX=mc.scaleY=1;mc.rotation=0;mc.x=mc.y=36;mc.playFile(RES_DIR_EFF+"faileff",1,function(){ObjectPool.push(mc)});_this.mijiBtns[index].addChild(mc);UserTips.ins().showTips(i18n("MijiPanel_12"))})}else{var callback=function(){TimerManager.ins().doTimer(500,1,function(){var mc=ObjectPool.pop("MovieClip");mc.scaleX=mc.scaleY=1;mc.rotation=0;mc.x=mc.y=36;mc.playFile(RES_DIR_EFF+"successeff",1,function(){ObjectPool.push(mc)});_this.mijiBtns[index].addChild(mc);_this.mijiBtns[index].showSelect();_this.setData();var tempName=oldID?",["+GlobalConfig.ItemConfig[GlobalConfig.MiJiSkillConfig[oldID].item].name+i18n("MijiPanel_13"):"";UserTips.ins().showTips(i18n("MijiPanel_14")+tempName);var mijiRedPoint=Setting.ins().getValue(ClientSet.mijiRedPoint);if(!mijiRedPoint)Setting.ins().setValue(ClientSet.mijiRedPoint,1)},_this)};if(id-oldID==1){callback()}else{this.learnUpdateEffect(index,true,callback)}}this.updateEff()};MijiPanel.prototype.learnUpdateEffect=function(index,isSuss,fun){var _this=this;this.isTween=true;var len=10*3+index+1;var _loop_10=function(i){var num=i;var time=150*i;var closeTime=150;if(i>7&&i<16){num=i-10;time=150*i}else if(i>15&&i<24){num=i-10*2;time=150*i+100*(i-15);closeTime=250}else if(i>23){num=i-10*3;time=150*i+200*(i-23)+650;closeTime=350}var tw=egret.Tween.get(this_9["imageMax_"+(num+1)]);tw.to({},time).call(function(){var tw=egret.Tween.get(_this["imageMax_"+(num+1)]);_this["imageMax_"+(num+1)].visible=true;if(i==len-1)tw.to({visible:true},150).call(function(){for(var i_7=0;i_7<10;i_7++){egret.Tween.removeTweens(_this["imageMax_"+(i_7+1)]);_this.isTween=false}fun()});else tw.to({visible:false},closeTime)})};var this_9=this;for(var i=0;i<len;i++){_loop_10(i)}};MijiPanel.prototype.updateRedPoint=function(){this.setOpenDesc();this.setData()};MijiPanel.prototype.onTap=function(e){var ins=UserMiji.ins();switch(e.target){case this.getBtn:DisplayUtils.removeFromParent(this.mc);this.stopArrow();break;case this.change:ViewManager.ins().open(MijiZhWin);break;case this.mijitujian:ViewManager.ins().open(MiJiTujianWin);break;case this.all:ViewManager.ins().open(MijiLookWin);break;case this.btnLock:ViewManager.ins().open(MijiLockWin,this.curRole);break;case this.btnName:UserMiji.ins().setShowState(!UserMiji.ins().showXianyuName);this.setBtnNameState();break;default:var i=this.mijiBtns.indexOf(e.target.parent);if(i==10){if(!ins.grid[this.curRole]){UserTips.ins().showTips(i18n("MijiPanel_22"));return}ViewManager.ins().open(MijiLearnWin,this.curRole,i);return}if(!this.mijiBtns[i]||this.mijiBtns[i].data&&!this.mijiBtns[i].data.id){ViewManager.ins().open(MijiLearnWin,this.curRole,i);return}if(!ins.miji[this.curRole][i]){UserTips.ins().showTips(i18n("MijiPanel_23"));return}ViewManager.ins().open(MijiTipWin,this.mijiBtns[i].data,this.curRole,i);break}};return MijiPanel}(BaseView);__reflect(MijiPanel.prototype,"MijiPanel");var PersonalBossPanel=function(_super){__extends(PersonalBossPanel,_super);function PersonalBossPanel(){var _this=_super.call(this)||this;_this.canPlayNum=1;return _this}PersonalBossPanel.prototype.childrenCreated=function(){this.init()};PersonalBossPanel.prototype.init=function(){this.list.itemRenderer=PersonalBossItem;this.rewardList.itemRenderer=ItemBase;this.bossImage=new MovieClip;this.bossImage.scaleX=-1;this.bossImage.scaleY=1;this.bossImage.x=78;this.bossImage.y=165;this.bossDiMc=new MovieClip;this.bossDiGroup.addChild(this.bossDiMc);this.bossDiMc.playFile(RES_DIR_EFF+"bossdz_eff",-1);this.listData=new eui.ArrayCollection;this.list.dataProvider=this.listData};PersonalBossPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.tempArrData=[];var arr=UserBoss.ins().getListData();var canPlayArr=arr[0],canNotPlayArr=arr[1],dieArr=arr[2];this.tempArrData=canPlayArr.concat(canNotPlayArr,dieArr);this.bossGroup.addChild(this.bossImage);this.tempIndex=0;this.addTouchEvent(this.challengeBtn,this.onTap);this.listData.replaceAll(this.tempArrData);this.list.scrollV=0;this.list.selectedIndex=0;var index=0;if(param[0])index=this.getIdFromBossId(param[0],canPlayArr);this.currData=this.list.dataProvider.getItemAt(index);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this);if(canPlayArr.length==0)this.canPlayNum=0;this.setWin()};PersonalBossPanel.prototype.getIdFromBossId=function(bossId,canPlayArr){for(var i=0;i<canPlayArr.length;i++){if(canPlayArr[i].bossId==bossId){this.list.selectedIndex=i;return i}}return 0};PersonalBossPanel.prototype.onClickMenu=function(e){this.list.selectedIndex=e.itemIndex;this.currData=this.list.dataProvider.getItemAt(e.itemIndex);this.setWin()};PersonalBossPanel.prototype.setWin=function(){this.config=this.currData;var bossBaseConfig=GlobalConfig.MonstersConfig[this.config.bossId];var lvStr;if(!this.config.levelLimit&&!this.config.zsLevel)lvStr=i18n("PersonalBossPanel_0",bossBaseConfig.level);else lvStr=this.config.zsLevel>0?i18n("PersonalBossPanel_1",this.config.zsLevel):i18n("PersonalBossPanel_2",this.config.levelLimit);this.nameTxt.text=bossBaseConfig.name+"("+lvStr+")";var str=i18n("PersonalBossPanel_3");this.rewardList.dataProvider=new eui.ArrayCollection(this.config.showItem);if(this.currData.roleName!=""){str=this.currData.roleName;if(this.currData.guildName!="")str=str+"("+this.currData.guildName+")"}if(this.config.monthcard&&!Recharge.ins().monthDay){this.stateImage.source=""}else if(this.config.specialCard&&!Recharge.ins().franchise){this.stateImage.source=""}else{if(this.config.zsLevel<=UserZs.ins().lv&&this.config.levelLimit<=Actor.level){if(UserFb.ins().getFbDataById(this.currData.id).getCount()>0){this.stateImage.source="zdbosskejisha"}else{this.stateImage.source="zdbossyijisha"}}else{this.stateImage.source=""}}var roleLv=UserZs.ins().lv*1e3+Actor.level;var bossLv=this.config.zsLevel*1e3+this.config.levelLimit;var showChallenge;if(this.config.monthcard){if(Recharge.ins().monthDay<=0){this.canChallengeTxt.text=i18n("PersonalBossPanel_4");showChallenge=false}else{this.canChallengeTxt.text="";showChallenge=true}}else if(this.config.specialCard){if(!Recharge.ins().franchise){this.canChallengeTxt.text=i18n("PersonalBossPanel_5");showChallenge=false}else{this.canChallengeTxt.text="";showChallenge=true}}else if(this.config.privilege){if(!Recharge.ins().getIsForeve()){this.canChallengeTxt.text=i18n("PersonalBossPanel_6");showChallenge=false}else{this.canChallengeTxt.text="";showChallenge=true}}else{showChallenge=roleLv>=bossLv;this.canChallengeTxt.text=this.config.zsLevel>0?i18n("PersonalBossPanel_7",this.config.zsLevel):i18n("PersonalBossPanel_8",this.config.levelLimit)}this.challengeBtn.visible=showChallenge;this.canChallengeTxt.visible=!showChallenge;if(this.canPlayNum==0){showChallenge=false;this.canChallengeTxt.visible=false;this.challengeBtn.visible=false}this.bossImage.playFile(RES_DIR_MONSTER+("monster"+bossBaseConfig.avatar+"_3s"),-1);this.btnLabel()};PersonalBossPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.challengeBtn:if(UserFb.ins().checkInFB())return;if(this.config.zsLevel<=UserZs.ins().lv&&this.config.levelLimit<=Actor.level){if(UserFb.ins().getFbDataById(this.currData.id).getCount()<=0){UserTips.ins().showTips(i18n("PersonalBossPanel_9"));return}var isPass=UserFb.ins().fbModel[this.config.id].isPass;if(Recharge.ins().franchise&&isPass){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin)}else{UserFb.ins().sendChallenge(this.config.id)}ViewManager.ins().close(LimitTaskView)}else{if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin)}else{UserFb.ins().sendChallenge(this.currData.id)}ViewManager.ins().close(LimitTaskView)}}else{UserTips.ins().showTips(i18n("PersonalBossPanel_13"))}break}};PersonalBossPanel.prototype.setOneData=function(){};PersonalBossPanel.prototype.close=function(){TimerManager.ins().remove(this.setOneData,this);this.tempArrData=null};PersonalBossPanel.prototype.sortFun=function(config1,config2){var count1=UserFb.ins().getFbDataById(config1.id).getCount();var count2=UserFb.ins().getFbDataById(config2.id).getCount();if(count1>count2)return-1;if(count1<count2)return 1;if(config1.zsLevel<config2.zsLevel)return-1;if(config1.zsLevel>config2.zsLevel)return 1;if(config1.levelLimit<config2.levelLimit)return-1;if(config1.levelLimit>config2.levelLimit)return 1;return 0};PersonalBossPanel.prototype.btnLabel=function(){var isPass=UserFb.ins().fbModel[this.config.id].isPass;if(Recharge.ins().franchise&&isPass){this.challengeBtn.label=i18n("PersonalBossPanel_14")}else if(UserZs.ins().lv*1e3>=this.config.sweepLevel&&isPass){this.challengeBtn.label=i18n("PersonalBossPanel_15")}else{this.challengeBtn.label=i18n("PersonalBossPanel_16")}};return PersonalBossPanel}(BaseView);__reflect(PersonalBossPanel.prototype,"PersonalBossPanel");var PersonRewardRenderer=function(_super){__extends(PersonRewardRenderer,_super);function PersonRewardRenderer(){var _this=_super.call(this)||this;_this.skinName="PersonRewardRendererSkin";_this.itemList.itemRenderer=ItemBase;return _this}PersonRewardRenderer.prototype.dataChanged=function(){this.desc.text=+this.data.integral+"";this.itemList.dataProvider=new eui.ArrayCollection(this.data.award)};return PersonRewardRenderer}(BaseItemRender);__reflect(PersonRewardRenderer.prototype,"PersonRewardRenderer");var PowerPanel=function(_super){__extends(PowerPanel,_super);function PowerPanel(){var _this=_super.call(this)||this;_this.showBg=true;_this.imgWidth=72;return _this}PowerPanel.prototype.childrenCreated=function(){this.init()};PowerPanel.prototype.init=function(){this.playFlameMC();this.totalPower=BitmapNumber.ins().createNumPic(0,"8",5);this.totalPower.x=150;this.totalPower.y=30;this.addChild(this.totalPower);this.initPos()};PowerPanel.prototype.setPower=function(value){this.power=value;BitmapNumber.ins().changeNum(this.totalPower,value,"8",5);this.initPos()};PowerPanel.prototype.initPos=function(){if(!this.showBg)return;if(this.totalPower.width/2>0)this.totalPower.x=200-this.totalPower.width/2};PowerPanel.prototype.setBgVis=function(bool){this.bgImg.visible=bool;this.flameGroup.visible=bool;this.showBg=bool};PowerPanel.prototype.setMcVisible=function(bool){this.flameGroup.visible=bool;this.powerImg.visible=!bool};PowerPanel.prototype.playFlameMC=function(){if(this.flameMC){this.flameMC.play(-1)}else{this.flameMC=new MovieClip;this.flameMC.x=86;this.flameMC.y=28;this.flameMC.playFile(RES_DIR_EFF+"zhanduolibeijing",-1);this.flameGroup.addChild(this.flameMC)}};PowerPanel.prototype.destructor=function(){DisplayUtils.removeFromParent(this)};return PowerPanel}(BaseView);__reflect(PowerPanel.prototype,"PowerPanel");var PriceIcon=function(_super){__extends(PriceIcon,_super);function PriceIcon(){var _this=_super.call(this)||this;_this.skinName="PriceIconSkin";return _this}PriceIcon.prototype.childrenCreated=function(){};PriceIcon.prototype.getPrice=function(){return this._price};PriceIcon.prototype.setPrice=function(value,value2){if(value2===void 0){value2=-1}if(value==this._price&&value2==-1)return;this._price=value;if(value2>=0){var colorStr="";if(value2>=value)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;this.priceLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+value2+'</font><font color="#ffffff">/'+value+"</font> ")}else{this.priceLabel.text=""+this._price}};PriceIcon.prototype.setText=function(str){this.priceLabel.textFlow=(new egret.HtmlTextParser).parser(str)};PriceIcon.prototype.setData=function(data){var str="";if(data){var awards=data;if(awards.type==0){switch(awards.id){case MoneyConst.exp:str="exp_png";break;case MoneyConst.gold:str="szjinbi";break;case MoneyConst.yuanbao:str="szyuanbao";break;case MoneyConst.fame:str="fame";break;case MoneyConst.soul:str="soul";break;case MoneyConst.wing:str="yumao_png";break;case MoneyConst.piece:str="500008_png";break}}else if(awards.type==1){switch(awards.id){case 200001:str="yumao_png";break;case 200002:str="forge";break;case 200003:str="gem";break;case 200004:str="spirit";break;case 200005:str="vigor";break;case 200006:str="shield";break}}this._type=awards.id;this.setPrice(awards.count)}else if(data){var itemData=data;switch(itemData.itemConfig.id){case 200001:str="yumao_png";break;case 200002:str="szyuanbao";break;case 200003:str="szyuanbao";break;case 200004:str="szyuanbao";break;case 200005:str="szyuanbao";break;case 200006:str="szyuanbao";break}this._type=itemData.itemConfig.id;this.setPrice(itemData.count)}this.iconImg.source=str};PriceIcon.prototype.getType=function(){return this._type};PriceIcon.prototype.setType=function(value){if(this._type==value)return;this._type=value;var str="";switch(this._type){case MoneyConst.exp:str="exp";break;case MoneyConst.gold:str="szjinbi";break;case MoneyConst.yuanbao:str="szyuanbao";break;case MoneyConst.fame:str="fame";break;case MoneyConst.soul:str="soul";break;case MoneyConst.wing:str="yumao_png";break}this.iconImg.source=str};Object.defineProperty(PriceIcon.prototype,"labelColor",{get:function(){return this._labelColor},set:function(value){if(this._labelColor!=value){this._labelColor=value;this.priceLabel.textColor=this._labelColor}},enumerable:true,configurable:true});return PriceIcon}(BaseComponent);__reflect(PriceIcon.prototype,"PriceIcon");var PropGainTipsWin=function(_super){__extends(PropGainTipsWin,_super);function PropGainTipsWin(){return _super.call(this)||this}PropGainTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="PropGainTipsSkin";this.itemIcon.imgJob.visible=false;this.gainList.itemRenderer=GainGoodsNoSkinItem};PropGainTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var type=param[0];var id=param[1];var num=param[2];this.id=id;this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.addTouchEndEvent(this,this.otherClose);this.setData(type,id,num)};PropGainTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};PropGainTipsWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};PropGainTipsWin.prototype.onTouchList=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){var isShow=true;if(item[1]=="Recharge2Win"){var rdata=Recharge.ins().getRechargeData(0);if(!rdata||!rdata.num){isShow=false;ViewManager.ins().open(Recharge1Win)}}if(isShow)GameGuider.guidance(item[1],item[2],item[3]);ViewManager.ins().close(ShopGoodsWarn);ViewManager.ins().close(BookUpWin);ViewManager.ins().close(WeaponPanel);ViewManager.ins().close(WeaponSoulBreakWin);if(item[1]!="HeirloomCom")ViewManager.ins().close(HeirloomCom);if(item[1]=="LadderWin")ViewManager.ins().close(ForgeWin);if(item[1]=="PlayFunView"){ViewManager.ins().close(ShopWin)}}};PropGainTipsWin.prototype.setData=function(type,id,num){var numStr="";if(num==undefined){var data=UserBag.ins().getBagGoodsByTypeAndId(type,id);numStr=data?data.count+"":"0"}else numStr=num+"";var config=GlobalConfig.ItemConfig[id];this.nameLabel.text=config.name;this.nameLabel.textColor=ItemConfig.getQualityColor(config);this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(config);this.itemIcon.setData(config);this.lv.text=(config.level||1)+i18n("PropGainTipsWin_0");this.num.text=numStr;var str=UserMiji.ins().replaceDec(config.desc,this.id);this.description0.textFlow=TextFlowMaker.generateTextFlow(str);if(ItemConfig.getType(config)==2){var sID=MiJiSkillConfig.getSkillIDByItem(config.id);var powertext=this.CalcMijiPower(sID)+GlobalConfig.MiJiSkillConfig[sID].power;this.power.text=i18n("PropGainTipsWin_2")+powertext;this.labelLV.visible=this.lv.visible=false}else{this.power.text="";this.labelLV.visible=this.lv.visible=true}var gainConfig=GlobalConfig.GainItemConfig[id];if(gainConfig){this.gainList.dataProvider=new eui.ArrayCollection(gainConfig.gainWay)}else{this.gainList.dataProvider=new eui.ArrayCollection([])}};PropGainTipsWin.prototype.CalcMijiPower=function(mijiId){var old_id=mijiId%1e3;var mijiAttrType=Math.floor(old_id/10);var mod=old_id%10;var powerConfig=GlobalConfig.AttrPowerConfig;var config=null;var config2=null;var val=null;var val2=null;var mijiAttrpower=0;switch(mijiAttrType){case 1:config=powerConfig[AttributeType.atMaxHp];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 2:config=powerConfig[AttributeType.atAttack];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 3:config=powerConfig[AttributeType.atDef];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;config2=powerConfig[AttributeType.atRes];val2=GlobalConfig.MiJiSkillConfig[mijiId].p2;val=val+val2;break;case 4:config=powerConfig[AttributeType.atCrit];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 5:config=powerConfig[AttributeType.atDamageReduction];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 6:config=powerConfig[AttributeType.atCritEnhance];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 7:config=powerConfig[AttributeType.atPenetrate];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 9:config=powerConfig[AttributeType.atAtkEx];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 12:config=powerConfig[AttributeType.atRegeneration];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break}if(val&&config){mijiAttrpower=val*config.power/100}return mijiAttrpower};return PropGainTipsWin}(BaseEuiView);__reflect(PropGainTipsWin.prototype,"PropGainTipsWin");ViewManager.ins().reg(PropGainTipsWin,LayerManager.UI_Popup);var PubBossRemindItem=function(_super){__extends(PubBossRemindItem,_super);function PubBossRemindItem(){var _this=_super.call(this)||this;_this._move=false;_this._lastX=0;_this._lastY=0;return _this}PubBossRemindItem.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)};PubBossRemindItem.prototype.onTouchBegin1=function(e){this._lastX=e.stageX;this._lastY=e.stageY;this._lastSelect=this.checkBoxs.selected;this._move=false;if(this.$stage){this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this);this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this)}};PubBossRemindItem.prototype.onTouchMove1=function(e){if(MathUtils.getDistance(this._lastX,this._lastY,e.stageX,e.stageY)>20){this._move=true}};PubBossRemindItem.prototype.onTouchEnd1=function(){if(this._move){this.checkBoxs.selected=this._lastSelect;this.checkBoxs.label=this.checkBoxs.selected?i18n("PubBossRemindItem_3"):i18n("PubBossRemindItem_2");this._move=false}if(this.$stage){this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this);this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this)}};PubBossRemindItem.prototype.dataChanged=function(){var model=this.data;var config=GlobalConfig.WorldBossConfig[model.id];var canChallenge=UserBoss.isCanChallenge(config);var desc;if(config.samsaraLv>0){desc=config.showName}else{if(config.zsLevel>0){desc=i18n("PubBossRemindItem_0",config.zsLevel)}else{desc=i18n("PubBossRemindItem_1",config.level)}}this.checkBoxs.visible=canChallenge;if(canChallenge){this.checkBoxs.selected=UserBoss.ins().getBossRemindByIndex(model.id);this.checkBoxs.label=this.checkBoxs.selected?i18n("PubBossRemindItem_3"):i18n("PubBossRemindItem_2")}this.txt.visible=!canChallenge;this.checkBoxs.name=model.id+"";var boss=GlobalConfig.MonstersConfig[config.bossId];this.bossName.text=boss.name;this.levelShow.text=desc};return PubBossRemindItem}(BaseItemRender);__reflect(PubBossRemindItem.prototype,"PubBossRemindItem");var PunchEquipItem=function(_super){__extends(PunchEquipItem,_super);function PunchEquipItem(){var _this=_super.call(this)||this;_this.wearData=null;_this.skinName="PunchEquipItemSkin";return _this}PunchEquipItem.prototype.dataChanged=function(){this.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var data=UserSkill.ins().equipListData[this.data];this.wearData=UserSkill.ins().getWearEquipsData(this.data);this.img.source="";this.addBtn.visible=true;if(data&&data.itemConfig){var subType=ItemConfig.getSubType(data.itemConfig);this.img.source=""+(data.itemConfig.zsLevel||0)+(data.itemConfig.level||1)+"_"+(subType+1)+"_png";this.redPoint.visible=UserSkill.ins().checkIsHaveBestEquip(subType)}else{this.img.source="";this.redPoint.visible=UserSkill.ins().checkIsHaveBestEquip(this.data)}this.touchChildren=true;this.touchEnabled=false;this.img.touchEnabled=false;this.redPoint.touchEnabled=false};PunchEquipItem.prototype.destruct=function(){this.addBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};PunchEquipItem.prototype.onTap=function(){if(this.wearData&&this.wearData.configID!=0)ViewManager.ins().open(HejiEquipTipsWin,this.wearData,true);else ViewManager.ins().open(HejiEquipTipsWin,this.data,true)};return PunchEquipItem}(BaseComponent);__reflect(PunchEquipItem.prototype,"PunchEquipItem");var PunchEquipItemBase=function(_super){__extends(PunchEquipItemBase,_super);function PunchEquipItemBase(){var _this=_super.call(this)||this;_this.skinName="PunchEquipItemSkin";return _this}PunchEquipItemBase.prototype.dataChanged=function(){this.validateNow();this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var award=this.data;var data=this.wearData=new ItemData;data.configID=award.id;this.addBtn.visible=false;this.redPoint.visible=false;this.img.source="";if(data&&data.itemConfig){this.img.source=""+(data.itemConfig.zsLevel||0)+data.itemConfig.level+"_"+(ItemConfig.getSubType(data.itemConfig)+1)+"_png"}else{this.img.source=""}};PunchEquipItemBase.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};PunchEquipItemBase.prototype.onTap=function(){if(this.wearData&&this.wearData.configID!=0)ViewManager.ins().open(HejiEquipTipsWin,this.wearData,true);else ViewManager.ins().open(PunchEquipChooseWin,this.data,0)};return PunchEquipItemBase}(BaseComponent);__reflect(PunchEquipItemBase.prototype,"PunchEquipItemBase");var PunchEquipPanel=function(_super){__extends(PunchEquipPanel,_super);function PunchEquipPanel(){var _this=_super.call(this)||this;_this.selectIndex=0;_this.skinName="PunchEquip";_this.isTopLevel=true;return _this}PunchEquipPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};PunchEquipPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(UserSkill.ins().postHejiEquipChange,this.refushPanelInfo);this.refushPanelInfo();this.reufshRolePoint()};PunchEquipPanel.prototype.refushPanelInfo=function(){var attData=[];for(var i=1;i<9;i++){this["item"+i].data=i-1;var item=UserSkill.ins().equipListData[i-1];if(attData.length==0){attData=item.att}else{attData=AttributeData.AttrAddition(attData,item.att)}}this.powerPanel.setPower(998);this.attrsText.text=AttributeData.getAttStr(attData)};PunchEquipPanel.prototype.refushOne=function(index){this["item"+(index+1)].data=index;if(ViewManager.ins().isShow(PunchEquipChooseWin))ViewManager.ins().close(PunchEquipChooseWin);this.powerPanel.setPower(998)};PunchEquipPanel.prototype.reufshRolePoint=function(){};PunchEquipPanel.prototype.countAllAttNum=function(){var num=0;return num};PunchEquipPanel.prototype.onTap=function(event){this.selectIndex=0;switch(event.target){default:break}};return PunchEquipPanel}(BaseEuiView);__reflect(PunchEquipPanel.prototype,"PunchEquipPanel");ViewManager.ins().reg(PunchEquipPanel,LayerManager.UI_Main);var RankItemRenderer=function(_super){__extends(RankItemRenderer,_super);function RankItemRenderer(){var _this=_super.call(this)||this;_this.touchEnabled=true;_this.touchChildren=false;return _this}RankItemRenderer.prototype.dataChanged=function(){if(this.data!=null){this.hideInfoUI();if(this.data[RankDataType.DATA_POS]==2){this.t3.source="rankcolor_1";this.t1.source="paihang2";this.pos.visible=false;this.t1.visible=true}else if(this.data[RankDataType.DATA_POS]==3){this.t3.source="rankcolor_2";this.t1.source="paihang3";this.pos.visible=false;this.t1.visible=true}else if(this.data[RankDataType.DATA_POS]==4){this.t3.source="rankcolor_3";this.t1.source="";this.pos.visible=true;this.t1.visible=false}else{this.t3.source="bantoutiaobg";this.pos.visible=true;this.t1.visible=false}this.setItemInfo()}this.visible=this.data!=null};RankItemRenderer.prototype.hideInfoUI=function(){this.t10.visible=false;this.vip.visible=false;this.level.visible=false;this.power.visible=false;this.weiwang.visible=false};RankItemRenderer.prototype.setItemInfo=function(){if(!this.data)return;this.pos.text=this.data.pos+"";this.player.text=this.data.player;this.vip.visible=false;var type=Rank.ins().curType;this.vipGroup.removeChildren();if(type==RankDataType.TYPE_POWER){this.t10.visible=false;if(this.data.vip>0){this.viplevel.visible=true;this.vipGroup.visible=true;this.viplevel.text="v";this.vipNum=BitmapNumber.ins().createNumPic(this.data.vip,"zv0",8);this.vipNum.scaleX=this.vipNum.scaleX=1.1;this.vipNum.x=this.data.vip>=10?2:8;this.vipNum.y=0;this.vipGroup.addChild(this.vipNum)}else{this.viplevel.visible=false;this.vipGroup.visible=false}this.power.visible=true;this.power.text=this.data.power}else if(type==RankDataType.TYPE_LEVEL){this.level.visible=true;if(this.data.vip>0){this.viplevel.visible=true;this.vipGroup.visible=true;this.viplevel.text="v";this.vipNum=BitmapNumber.ins().createNumPic(this.data.vip,"zv0",8);this.vipNum.scaleX=this.vipNum.scaleX=1.1;this.vipNum.x=this.data.vip>=10?2:8;this.vipNum.y=0;this.vipGroup.addChild(this.vipNum)}else{this.viplevel.visible=false;this.vipGroup.visible=false}var zhuan="";if(this.data.zhuan)zhuan=this.data.zhuan+i18n("RankItemRenderer_0");this.level.text=zhuan+this.data.level+i18n("RankItemRenderer_1")}else if(type==RankDataType.TYPE_SKIRMISH){this.power.visible=true;this.power.text=i18n("RankItemRenderer_2")+this.data.count;if(this.data.vip>0){this.viplevel.visible=true;this.vipGroup.visible=true;this.viplevel.text="v";this.vipNum=BitmapNumber.ins().createNumPic(this.data.vip,"zv0",8);this.vipNum.scaleX=this.vipNum.scaleX=1.1;this.vipNum.x=this.data.vip>=10?2:8;this.vipNum.y=0;this.vipGroup.addChild(this.vipNum)}else{this.viplevel.visible=false;this.vipGroup.visible=false}}else if(type==RankDataType.TYPE_LILIAN){this.power.visible=true;var cfg=GlobalConfig.TrainLevelConfig[this.data.count];this.power.text=i18n("RankItemRenderer_3",cfg.trainlevel,cfg.trainName);if(this.data.vip>0){this.viplevel.visible=true;this.vipGroup.visible=true;this.viplevel.text="v";this.vipNum=BitmapNumber.ins().createNumPic(this.data.vip,"zv0",8);this.vipNum.scaleX=this.vipNum.scaleX=1.1;this.vipNum.x=this.data.vip>=10?2:8;this.vipNum.y=0;this.vipGroup.addChild(this.vipNum)}else{this.viplevel.visible=false;this.vipGroup.visible=false}}else if(type==RankDataType.TYPE_WEIWANG){this.weiwang.source=WeiWangCC.ins().getWeiWangCfg(this.data.weiWang).res;this.weiwang.visible=true;if(this.data.viplevel>0){this.viplevel.visible=true;this.vipGroup.visible=true;this.viplevel.text="v";this.vipNum=BitmapNumber.ins().createNumPic(this.data.viplevel,"zv0",8);this.vipNum.scaleX=this.vipNum.scaleX=1.1;this.vipNum.x=this.data.viplevel>=10?2:8;this.vipNum.y=0;this.vipGroup.addChild(this.vipNum)}else{this.viplevel.visible=false;this.vipGroup.visible=false}}else if(type==RankDataType.TYPE_XUNZHANG){this.power.visible=true;var cfg1=GlobalConfig.KnighthoodConfig[this.data.count];this.power.text=cfg1.type;if(this.data.vip>0){this.viplevel.visible=true;this.vipGroup.visible=true;this.viplevel.text="v";this.vipNum=BitmapNumber.ins().createNumPic(this.data.vip,"zv0",8);this.vipNum.scaleX=this.vipNum.scaleX=1.1;this.vipNum.x=this.data.vip>=10?2:8;this.vipNum.y=0;this.vipGroup.addChild(this.vipNum)}else{this.viplevel.visible=false;this.vipGroup.visible=false}}};return RankItemRenderer}(BaseItemRender);__reflect(RankItemRenderer.prototype,"RankItemRenderer");var RankItemRenderer1=function(_super){__extends(RankItemRenderer1,_super);function RankItemRenderer1(){var _this=_super.call(this)||this;_this.touchEnabled=true;_this.touchChildren=false;return _this}RankItemRenderer1.prototype.dataChanged=function(){if(this.data!=null){this.pos.text=this.data.rank+"";this.player.text=this.data.roleName+"";this.num.text=CommonUtils.overLength(this.data.value)}};return RankItemRenderer1}(BaseItemRender);__reflect(RankItemRenderer1.prototype,"RankItemRenderer1");var RedBagRenderer=function(_super){__extends(RedBagRenderer,_super);function RedBagRenderer(){var _this=_super.call(this)||this;_this.skinName="RedBagRendererSkin";return _this}RedBagRenderer.prototype.dataChanged=function(){this.num.text=this.data.robNum;this.nameLabel.text=this.data.robName};return RedBagRenderer}(BaseItemRender);__reflect(RedBagRenderer.prototype,"RedBagRenderer");var RoleInfoItem=function(_super){__extends(RoleInfoItem,_super);function RoleInfoItem(){var _this=_super.call(this)||this;_this.skinName="RoleInfoItemSkin";_this.iconMc=new MovieClip;_this.iconMc.x=30;_this.iconMc.y=30;_this.iconMc.scaleX=_this.iconMc.scaleY=.35;return _this}RoleInfoItem.prototype.getImgSource=function(){return this._imgSource};RoleInfoItem.prototype.setImgSource=function(value,isAct){var effSoure=value?"hushen":"mabi";this.iconMc.playFile(RES_DIR_EFF+effSoure,-1);if(this.iconMc&&!this.iconMc.parent)this.addChild(this.iconMc);var filter=isAct?[]:FilterUtil.ARRAY_GRAY_FILTER;this.iconMc.filters=filter};RoleInfoItem.prototype.getLv=function(){return this._lv};RoleInfoItem.prototype.setLv=function(value){if(this._lv!=value){this._lv=value;if(this._lv==0)this.lvTxt.text="";else this.lvTxt.text="+"+this._lv}};RoleInfoItem.prototype.getNameTxt=function(){return this.labelDisplay.text};RoleInfoItem.prototype.setNameTxt=function(value){if(this._imgSource!=value){this.labelDisplay.text=value}};RoleInfoItem.prototype.setBgValue=function(value){this.bgImg.source=value};RoleInfoItem.prototype.getRedPointVisibel=function(){return this.redPoint.visible};RoleInfoItem.prototype.setRedPointVisibel=function(value){this.redPoint.visible=value};RoleInfoItem.prototype.destory=function(){this.iconMc.filters=null;DisplayUtils.removeFromParent(this.iconMc);this.iconMc.filters=null};return RoleInfoItem}(BaseView);__reflect(RoleInfoItem.prototype,"RoleInfoItem");var RoleInfoPanel=function(_super){__extends(RoleInfoPanel,_super);function RoleInfoPanel(){var _this=_super.call(this)||this;_this.beforeIndex=-1;_this.name=i18n("RoleInfoPanel_0");return _this}RoleInfoPanel.prototype.childrenCreated=function(){this.init()};RoleInfoPanel.prototype.init=function(){this.touchEnabled=false;this.touchChildren=true;this.groupRole.touchEnabled=false;this.groupRoleNext.touchEnabled=false;this.groupRole.touchChildren=false;this.groupRoleNext.touchChildren=false;this.equips=[];for(var i=0;i<EquipPos.MAX;i++){this.equips[i]=this["item"+i];this.equips[i].touchEnabled=true;this.equips[i].isShowJob(false);this.equips[i].isShowTips(false);this["redPoint"+i].touchEnabled=false}this.eff=new MovieClip;this.eff.x=this.oneKeyChange.width/2;this.eff.y=this.oneKeyChange.height/2;this.eff.scaleX=1;this.eff.scaleY=1;this.eff.touchEnabled=false;this.suitEff=new MovieClip;this.suitEff3=new MovieClip;this.suitEff2=new MovieClip;this.suitEff4=new MovieClip;this.suitEff5=new MovieClip;this.suitEff6=new MovieClip;this.suitEff7=new MovieClip;this.suitEff8=new MovieClip;this.suitEff9=new MovieClip;this.suitEff10=new MovieClip;this.dizuo.verticalCenter=215.5+Math.max((StageUtils.ins().getHeight()-750)/4-62,0)};RoleInfoPanel.prototype.clear=function(){this.beforeIndex=-1};RoleInfoPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.shuzhuang,this.onClick);this.addTouchEvent(this.bless0,this.onClick);this.addTouchEvent(this.oneKeyChange,this.onClick);this.addTouchEvent(this.roleInfoItem0,this.onClick);this.addTouchEvent(this.roleInfoItem1,this.onClick);this.addTouchEvent(this.shenlu,this.onClick);this.addTouchEvent(this.orange,this.onClick);this.addTouchEvent(this.heirloom,this.onClick);this.addTouchEvent(this.rune,this.onClick);this.observe(UserEquip.ins().postEquipChange,this.updataEquip);this.observe(UserEquip.ins().postAddSpirit,this.updataEquip);this.observe(UserEquip.ins().postAddSoul,this.updataEquip);this.observe(SpecialRing.ins().postRingUpdate,this.updateRing);this.observe(UserForge.ins().postForgeTips,this.delayRedPoint);this.observe(GameLogic.ins().postRuneExchange,this.delayRedPoint);this.observe(GameLogic.ins().postRuneShatter,this.delayRedPoint);this.observe(Rune.ins().postInlayResult,this.delayRedPoint);this.observe(UserBag.ins().postHuntStore,this.delayRedPoint);this.observe(Dress.ins().postChangeWing,this.setWing);this.observe(LongHun.ins().postDateUpdate,this.updateLoongSoul);this.observe(LongHun.ins().postStageActive,this.updateLoongSoul);this.observe(ShenshouRedpoint.ins().postRedPoint,this.updateLoongSoul);this.observe(Dress.ins().postDressInfo,this.setFashionRetPoint);this.observe(Dress.ins().postBuyParts,this.setFashionRetPoint);this.observe(UserBag.ins().postItemAdd,this.setFashionRetPoint);this.observe(UserBag.ins().postItemDel,this.setFashionRetPoint);this.observe(UserBag.ins().postItemCountChange,this.setFashionRetPoint);this.observe(DressCollectionMgr.ins().postDressCollectionInfo,this.setFashionRetPoint);this.observe(SpecialRing.ins().postActiveRing,this.delayRedPoint);this.observe(UserFb.ins().postFbRingInfo,this.delayRedPoint);this.observe(Heirloom.ins().postHeirloomInfo,this.setRoleEff);this.observe(Weapons.ins().postWeaponsUse,this.setRoleEff);this.observe(UserBag.ins().postItemAdd,this.delayRedPoint);this.observe(UserBag.ins().postItemDel,this.delayRedPoint);this.observe(UserBag.ins().postItemChange,this.delayRedPoint);this.observe(UserBag.ins().postItemCountChange,this.delayRedPoint);this.observe(UserFb.ins().postFbRingInfo,this.delayRedPoint);this.observe(Actor.ins().postLevelChange,this.delayRedPoint);this.observe(JadeNew.ins().postJadeData,this.delayRedPoint);this.observe(LyMark.ins().postMarkData,this.delayRedPoint);this.updateRing();this.updateLoongSoul();this.setRetPoint();this.updataEquip(false);this.setFashionRetPoint();this.clearChangeEff();if(this.beforeIndex!=-1){this.roleChange(this.beforeIndex,this.curRole)}else{this.setRole(this.curRole,this.bodyImg,this.weaponImg,this.bodyMc,this.weaponMc,true);this.setSuit(this.curRole,this.suitEff,this.suitEffGroup);this.setWeaponsSuit(this.curRole,"sef",this.soulEff,this.suitEff2);this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)}this.beforeIndex=this.curRole;this.setSuitEquips()};RoleInfoPanel.prototype.close=function(){DisplayUtils.removeFromParent(this.eff);DisplayUtils.removeFromParent(this.suitEff);DisplayUtils.removeFromParent(this.suitEff2);DisplayUtils.removeFromParent(this.suitEff3);DisplayUtils.removeFromParent(this.suitEff4);DisplayUtils.removeFromParent(this.suitEff5);DisplayUtils.removeFromParent(this.suitEff6);DisplayUtils.removeFromParent(this.suitEff7);DisplayUtils.removeFromParent(this.suitEff8);DisplayUtils.removeFromParent(this.suitEff9);DisplayUtils.removeFromParent(this.suitEff10);this.roleInfoItem0.destory();this.roleInfoItem1.destory();if(this._body){this._body.removeEventListener(egret.Event.CHANGE,null,null)}ViewManager.ins().close(FireRingWin);ViewManager.ins().close(RingInfoView);ViewManager.ins().close(AdvanEquipWin);ViewManager.ins().close(HeirloomWin);ViewManager.ins().close(TreasureWin);ViewManager.ins().close(RuneWin);ViewManager.ins().close(DressWin)};RoleInfoPanel.prototype.clearChangeEff=function(){egret.Tween.removeTweens(this.groupRole);egret.Tween.removeTweens(this.groupRoleNext);this.groupRole.x=0;this.groupRoleNext.x=580;this.groupRole.alpha=1;this.groupRoleNext.alpha=0;this.groupRoleNext.visible=false;this.setRole(this.curRole,this.bodyImg,this.weaponImg,this.bodyMc,this.weaponMc,true);this.setSuit(this.curRole,this.suitEff,this.suitEffGroup);this.setWeaponsSuit(this.curRole,"sef",this.soulEff,this.suitEff2);this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)};RoleInfoPanel.prototype.roleChange=function(beforeIndex,nextIndex){if(beforeIndex==nextIndex){this.clearChangeEff();return}this.groupRoleNext.visible=true;this.setRole(beforeIndex,this.bodyImg,this.weaponImg,this.bodyMc,this.weaponMc);this.setRole(nextIndex,this.nextBodyImg,this.nextWeaponImg,this.nextBodyMc,this.nextWeaponMc);this.setWing(beforeIndex,this.wingImg,this.wingMc);this.setWing(nextIndex,this.nextWingImg,this.nextWingMc);this.setSuit(beforeIndex,this.suitEff,this.suitEffGroup);this.setSuit(nextIndex,this.suitEff3,this.suitEff1Group);this.setWeaponsSuit(beforeIndex,"sef",this.soulEff,this.suitEff2);this.setWeaponsSuit(nextIndex,"nsef",this.nsoulEff,this.suitEff4);this.setWeaponEffect(beforeIndex,"bodyEffect",this.bodyEff,this.suitEff7,2);this.setWeaponEffect(nextIndex,"nbodyEffect",this.nbodyEff,this.suitEff8,2);var t=egret.Tween.get(this.groupRole);var t2=egret.Tween.get(this.groupRoleNext);if(beforeIndex<nextIndex){this.groupRoleNext.x=580;t.to({x:-580,alpha:0},600);t2.to({x:0,alpha:1},600).call(this.clearChangeEff,this)}else{this.groupRoleNext.x=-580;t.to({x:580,alpha:0},600);t2.to({x:0,alpha:1},600).call(this.clearChangeEff,this)}};RoleInfoPanel.prototype.updateLoongSoul=function(){this.redPointShenlu.visible=LongHun.ins().canShowRedPointInAll()||JadeNew.ins().checkRed()||ShenshouRedpoint.ins().redpoint};RoleInfoPanel.prototype.updateRing=function(){var ringModel=SubRoles.ins().getSubRoleByIndex(this.curRole).exRingsData;if(ringModel[0]>0){this.roleInfoItem0.setImgSource(0,1);this.roleInfoItem0.setLv(0);this.roleInfoItem0.setNameTxt(i18n("RoleInfoPanel_1"));this.roleInfoItem0.setBgValue("quality4");this.roleInfoItem0.setRedPointVisibel(false)}else{this.roleInfoItem0.setImgSource(0,0);this.roleInfoItem0.setLv(0);this.roleInfoItem0.setNameTxt(i18n("RoleInfoPanel_2"));this.roleInfoItem0.setBgValue("quality0")}if(ringModel[1]>0){this.roleInfoItem1.setImgSource(1,1);this.roleInfoItem1.setLv(0);this.roleInfoItem1.setNameTxt(i18n("RoleInfoPanel_3"));this.roleInfoItem1.setBgValue("quality4");this.roleInfoItem1.setRedPointVisibel(false)}else{this.roleInfoItem1.setImgSource(1,0);this.roleInfoItem1.setLv(0);this.roleInfoItem1.setNameTxt(i18n("RoleInfoPanel_4"));this.roleInfoItem1.setBgValue("quality0")}};RoleInfoPanel.prototype.updataEquip=function(delay){if(delay===void 0){delay=true}var model=SubRoles.ins().getSubRoleByIndex(this.curRole);this.setEquip(model);if(delay){TimerManager.ins().doTimer(300,1,this.onDelayReflash,this)}else{this.onDelayReflash()}this.setSuitEquips()};RoleInfoPanel.prototype.onDelayReflash=function(){UserRole.ins().setCanChange()};RoleInfoPanel.prototype.setEquip=function(role){if(!role)return;var len=role.getEquipLen();this.weaponImg.source="";for(var i=0;i<len;i++){var element=role.getEquipByIndex(i);this.equips[i].setModel(role);this.equips[i].setCurRole(this.curRole);this.equips[i].setIndex(i);this.equips[i].data=element.item;if(element.item.configID==0){this.equips[i].setItemImg(i>EquipPos.MAX?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[i]);this.equips[i].isShowTips(false);this.addTouchEvent(this.equips[i],this.onClick)}else{this.equips[i].isShowTips(true);this.removeTouchEvent(this.equips[i],this.onClick)}}this.setRole(this.curRole,this.bodyImg,this.weaponImg,this.bodyMc,this.weaponMc,true);this.setSuit(this.curRole,this.suitEff,this.suitEffGroup);this.setWeaponsSuit(this.curRole,"sef",this.soulEff,this.suitEff2);this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)};RoleInfoPanel.prototype.setRole=function(index,imgBody,imgWeapon,bodyMc,weaponMc,wing){if(wing===void 0){wing=false}imgBody.source=null;imgWeapon.source=null;var role=SubRoles.ins().getSubRoleByIndex(index);var id=role.getEquipByIndex(0).item.configID;var zb=role.zhuangbei;var bodyId=zb[0];var weaponId=zb[1];var weaponConf=role.getEquipByIndex(0);var weaponConfId=weaponConf.item.configID;var bodyConf=role.getEquipByIndex(2);var bodyConfId=bodyConf.item.configID;var bodyRes;var isHaveBody;if(bodyConfId>0){var fileName=GlobalConfig.EquipConfig[bodyConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}if(fileName.indexOf("903")>0){bodyRes=fileName+"_"+role.sex+"_c"}else{bodyRes=fileName+"_c"}isHaveBody=true}if(!isHaveBody){bodyRes=getDefaultBody(role.job)+"_c"}if(bodyId>0){bodyRes=getZhuangbanById(bodyId).res+"_c"}this._body=imageToMc(imgBody,bodyRes,bodyMc);var weaponRes;if(weaponConfId>0){var fileName=GlobalConfig.EquipConfig[weaponConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1)fileName=fileName.replace("[job]",role.job+"");weaponRes=fileName+"_"+role.sex+"_c"}if(weaponId>0){weaponRes=getZhuangbanById(weaponId).res+"_"+role.sex+"_c"}imageToMc(imgWeapon,weaponRes,weaponMc,this._body);if(wing){this.setWing(this.curRole,this.wingImg,this.wingMc)}};RoleInfoPanel.prototype.setRoleEff=function(){this.setSuit(this.curRole,this.suitEff,this.suitEffGroup);this.setWeaponsSuit(this.curRole,"sef",this.soulEff,this.suitEff2);this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)};RoleInfoPanel.prototype.setSuit=function(roleId,suitEff,suitEffGroup){DisplayUtils.removeFromParent(suitEff);var role=SubRoles.ins().getSubRoleByIndex(roleId);var cfg=role.heirloom.getSuitConfig(role);if(cfg){if(!suitEff.parent)suitEffGroup.addChild(suitEff);var suitConfig=GlobalConfig.HeirloomEquipSetConfig[cfg.lv];suitEff.playFile(RES_DIR_EFF+suitConfig.neff,-1)}};RoleInfoPanel.prototype.setWeaponsSuit=function(roleId,jobImage,soulEffGroup,suitEff){var role=SubRoles.ins().getSubRoleByIndex(roleId);suitEff.x=this[jobImage+role.job].x;suitEff.y=this[jobImage+role.job].y;suitEff.rotation=this[jobImage+role.job].rotation;DisplayUtils.removeFromParent(suitEff);var wid=role.weapons.weaponsId;var hideWeapons=role.hideWeapons();if(!hideWeapons&&wid){if(!suitEff.parent)soulEffGroup.addChild(suitEff);var suitConfig=GlobalConfig.WeaponSoulConfig[wid];suitEff.playFile(RES_DIR_EFF+suitConfig.inside[role.job-1],-1)}};RoleInfoPanel.prototype.setWeaponEffect=function(roleId,jobImage,soulEffGroup,suitEff,pos){if(pos===void 0){pos=0}var role=SubRoles.ins().getSubRoleByIndex(roleId);var id=role.getEquipByIndex(pos).item.configID;var cfg=GlobalConfig.EquipWithEffConfig[id+"_"+role.sex];DisplayUtils.removeFromParent(suitEff);var zb=role.zhuangbei;var eff=suitEff;if(eff==this.suitEff5){if(role.sex==0)DisplayUtils.removeFromParent(this.suitEff9);else eff=this.suitEff9}else if(eff==this.suitEff6){if(role.sex==0)DisplayUtils.removeFromParent(this.suitEff10);else eff=this.suitEff10}if(cfg&&(pos==0&&zb[1]<=0||pos==2&&zb[0]<=0)){eff.x=this[jobImage+role.sex].x+cfg.offX;eff.y=this[jobImage+role.sex].y+cfg.offY;eff.rotation=this[jobImage+role.sex].rotation;eff.scaleX=eff.scaleY=cfg.scaling;eff.playFile(RES_DIR_EFF+cfg.inShowEff,-1);soulEffGroup.addChild(eff)}else DisplayUtils.removeFromParent(eff)};RoleInfoPanel.prototype.setFashionRetPoint=function(){if(this.fashionPoint){this.fashionPoint.visible=Dress.ins().redPoint()||SwordSkinMgr.ins().showRedPoint()}};RoleInfoPanel.prototype.onClick=function(e){switch(e.currentTarget){case this.oneKeyChange:UserRole.ins().checkHaveCan(true,this.curRole);this.setCanChange();SoundUtil.ins().playEffect(SoundUtil.EQUIP);SoundUtil.ins().playEffect(SoundUtil.EQUIP);break;case this.roleInfoItem0:ViewManager.ins().open(SpecialRingWin,0,this.curRole);break;case this.roleInfoItem1:ViewManager.ins().open(SpecialRingWin,1,this.curRole);break;case this.shuzhuang:ViewManager.ins().open(DressWin,this.curRole);break;case this.shenlu:ViewManager.ins().open(TreasureWin,0,this.curRole);break;case this.orange:ViewManager.ins().open(AdvanEquipWin,0,0);this.setRetPoint();break;case this.heirloom:ViewManager.ins().open(HeirloomWin,this.curRole);break;case this.rune:ViewManager.ins().open(RuneWin,this.curRole);break;case this.bless0:if(SpecialRing.ins().isFireRingFuse()){ViewManager.ins().open(FireRingWin)}else if(SpecialRing.ins().checkRingOpen()){ViewManager.ins().open(RingInfoView)}else{UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.RING))}break;default:var index=this.equips.indexOf(e.currentTarget);if(index>=0){if(index>8){}else{ViewManager.ins().open(RoleChooseEquipWin,this.curRole,index)}}break}};RoleInfoPanel.prototype.setWing=function(index,wingImg,wingMc){if(index===void 0){index=this.curRole}if(wingImg===void 0){wingImg=this.wingImg}if(wingMc===void 0){wingMc=this.wingMc}wingImg.source=null;var wingdata=SubRoles.ins().getSubRoleByIndex(index).wingsData;var id=SubRoles.ins().getSubRoleByIndex(index).zhuangbei[2];var source="";if(id>0){source=GlobalConfig.ZhuangBanId[id].res}else if(wingdata.openStatus){source=GlobalConfig.WingLevelConfig[wingdata.lv].appearance}else{source=""}imageToMc(wingImg,source,wingMc,this._body,RES_DIR_ROLE,false,true)};RoleInfoPanel.prototype.delayRedPoint=function(){if(!TimerManager.ins().isExists(this.setRetPoint,this))TimerManager.ins().doTimer(60,1,this.setRetPoint,this)};RoleInfoPanel.prototype.setRetPoint=function(){for(var i=0;i<2;i++){var role=SubRoles.ins().getSubRoleByIndex(this.curRole);var flag=UserRole.ins().roleHintCheck(role,i);this["roleInfoItem"+i].setRedPointVisibel(flag)}var bool=false;var len=SubRoles.ins().subRolesLen;for(var a=0;a<len;a++){var model=SubRoles.ins().getSubRoleByIndex(a);for(var i=0;i<8;i++){bool=UserEquip.ins().setOrangeEquipItemState(i,model);if(!bool&&i<2)bool=UserEquip.ins().setLegendEquipItemState(i>0?2:0,model);if(bool){var b=UserBag.ins().checkEqRedPoint(i,model);bool=b!=null?b:bool}var s=UserEquip.ins().posState[i];if(s==2){bool=true}if(bool)break}if(bool)break}if(!bool)bool=UserEquip.ins().checkRedPointEx(5,this.curRole);if(!bool)bool=UserBag.ins().getLegendHasResolve();if(!bool){var itemData=UserBag.ins().getLegendOutEquips();bool=itemData.length>0}if(!bool){bool=Boolean(UserBag.ins().getHuntGoods(0).length)}if(!bool){bool=ExtremeEquipModel.ins().getRedPoint()}this.orangeRedPoint.visible=bool;this.heirloomRedPoint.visible=Heirloom.ins().checkRedPoint();this.updateLoongSoul();this.ringRedPoint.visible=OpenSystem.ins().checkSysOpen(SystemType.RING)&&(SpecialRing.ins().canUseSpecialRingItem()||SpecialRing.ins().checkHaveUpRing()||SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||LyMark.ins().checkRed()||SwordSkinMgr.ins().showRedPoint());this.zwRedPoint.visible=RuneRedPointMgr.ins().checkAllSituation(false);this.setCanChange()};RoleInfoPanel.prototype.setSamsaraRedPoint=function(){if(SamsaraModel.ins().isOpen()){for(var i=EquipPos.HAT;i<EquipPos.MAX;i++){var img=this["redPoint"+i];var role=SubRoles.ins().getSubRoleByIndex(this.curRole);var data=role.getEquipByIndex(i);if(data.soulLv>0){this["item"+i].setSoul(true)}else{this["item"+i].setSoul(false)}if(!img.visible)img.visible=SamsaraModel.ins().checkEquipPosCanAddSpirit(role,i)||SamsaraModel.ins().checkUpgradeSoul(role,i)}}for(var i=9;i<13;i++){this["item"+i].visible=SamsaraModel.ins().isOpen()}};RoleInfoPanel.prototype.setCanChange=function(data){var d=data?data[this.curRole]?data[this.curRole]:[]:UserRole.ins().canChangeEquips[this.curRole];var h=false;var n=this.equips.length;DisplayUtils.removeFromParent(this.eff);for(var i=0;i<n;i++){this["redPoint"+i].visible=d[i]?d[i]:false;if(!h)h=d[i]?d[i]:false}this.updateOneKey(h);this.setSamsaraRedPoint()};RoleInfoPanel.prototype.updateOneKey=function(v){if(!OpenSystem.ins().checkSysOpen(SystemType.ONEKEY)){this.oneKeyChange.visible=false;return}if(GuideUtils.ins().curCfg&&GuideUtils.ins().curCfg.guideId==1){this.oneKeyChange.visible=false;return}this.oneKeyChange.visible=v;if(this.oneKeyChange.visible){this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.eff.parent)this.effGroup.addChild(this.eff)}else{DisplayUtils.removeFromParent(this.eff)}};RoleInfoPanel.prototype.getEquipItem=function(pos){return this.equips[pos]};RoleInfoPanel.prototype.setSuitEquips=function(){var role=SubRoles.ins().getSubRoleByIndex(this.curRole);for(var i=0;i<UserEquip.FOEGE_MAX;i++){var eq=this.equips[i];var info=role.heirloom.getInfoBySolt(i);if(eq&&info.lv>0){eq.setItemHeirloomBgImg(true,info.image)}else{eq.setItemHeirloomBgImg(false)}}};__decorate([callLater],RoleInfoPanel.prototype,"updataEquip",null);return RoleInfoPanel}(BaseView);__reflect(RoleInfoPanel.prototype,"RoleInfoPanel");var RoleItem=function(_super){__extends(RoleItem,_super);function RoleItem(){var _this=_super.call(this)||this;_this._curRole=-1;_this._index=-1;_this.showTip=true;return _this}RoleItem.prototype.init=function(){_super.prototype.init.call(this);this.boostLv=new eui.Label;this.boostLv.x=20;this.boostLv.y=45;this.boostLv.textColor=16360197;this.zhulingLv=new eui.Label;this.zhulingLv.x=2;this.zhulingLv.y=45;this.zhulingLv.textColor=4046335;this.tupoLv=new eui.Label;this.tupoLv.x=10;this.tupoLv.y=-5;this.tupoLv.textColor=15333897;this.boostLv.size=this.zhulingLv.size=this.tupoLv.size=16;this.boostLv.width=this.zhulingLv.width=this.tupoLv.width=41;this.boostLv.stroke=this.zhulingLv.stroke=this.tupoLv.stroke=1;this.boostLv.strokeColor=this.zhulingLv.strokeColor=this.tupoLv.strokeColor=0;this.boostLv.textAlign=this.tupoLv.textAlign="right";this.addChild(this.boostLv);this.addChild(this.zhulingLv);this.addChild(this.tupoLv);this.mc=new MovieClip;this.mc.x=46;this.mc.y=43};RoleItem.prototype.dataChanged=function(){this.playEff();_super.prototype.dataChanged.call(this);var itemConfig=this.data.itemConfig;this.bless.visible=false;if(itemConfig){var equipsDatas=this._wings?this._model.wingsData.equipdata:this._model.equipsData;var equipsData=void 0;for(var i=0;i<equipsDatas.length;i++){if(this.data.handle==equipsDatas[i].item.handle){equipsData=equipsDatas[i];break}}if(!this._wings){this.boostLv.text=equipsData.strengthen>0?"+"+equipsData.strengthen:"";this.zhulingLv.text=equipsData.zhuling>0?equipsData.zhuling+"":"";this.tupoLv.text=equipsData.tupo>0?equipsData.tupo+i18n("RoleItem_1"):"";this.bless.visible=equipsData.bless>0;if(ItemConfig.getSubType(itemConfig)==ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]){this.nameTxt.text=UserBag.ins().getGuanyinLevel(itemConfig)}}}this.getItemIcon().extreme.visible=false;if(this._curRole>=0&&this._index>=EquipPos.WEAPON&&this._index<=EquipPos.SHOE){if(!this.getItemIcon().extreme.visible)this.getItemIcon().extreme.visible=ExtremeEquipModel.ins().getZhiZunLvByRoleID(this._model,this._index)>0}this._lastData=this.data;this._lastModel=this._model};RoleItem.prototype.clear=function(){_super.prototype.clear.call(this);this.boostLv.text=this.zhulingLv.text=this.tupoLv.text="";this.playEff()};RoleItem.prototype.isShowTips=function(value){this.showTip=value};RoleItem.prototype.openEquipsTips=function(){if(!this.showTip)return;if(this._index>EquipPos.DZI){ViewManager.ins().open(SamsaraEquipTips,this._curRole,this._lastModel,this._index)}else{ViewManager.ins().open(EquipDetailedWin,1,this.data.handle,this.itemConfig.id,this.data,this._model,this._curRole,this._index)}};RoleItem.prototype.showPower=function(){this.openEquipsTips()};RoleItem.prototype.setModel=function(value){this._model=value};RoleItem.prototype.getModel=function(){return this._model};RoleItem.prototype.setCurRole=function(value){this._curRole=value};RoleItem.prototype.getCurRole=function(){return this._curRole};RoleItem.prototype.setIndex=function(value){this._index=value};RoleItem.prototype.getIndex=function(){return this._index};RoleItem.prototype.setWings=function(value){this._wings=value};RoleItem.prototype.getWings=function(){return this._wings};RoleItem.prototype.playEff=function(){if(this._lastData){if(this._lastData!=this.data&&this._model==this._lastModel){this.mc.playFile(RES_DIR_EFF+"forgeSuccess",1);this.addChild(this.mc)}}};return RoleItem}(ItemBase);__reflect(RoleItem.prototype,"RoleItem");var RoleItemRenderer=function(_super){__extends(RoleItemRenderer,_super);function RoleItemRenderer(){var _this=_super.call(this)||this;_this.index=0;_this.skinName="RoleShowSkin";_this.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.showRole,_this);_this.suitEff=new MovieClip;_this.suitEff.x=_this.suitImg.x;_this.suitEff.y=_this.suitImg.y;_this.suitEff2=new MovieClip;_this.suitEff5=new MovieClip;_this.suitEff7=new MovieClip;_this.suitEff9=new MovieClip;return _this}RoleItemRenderer.prototype.dataChanged=function(){if(!this.data||!this.data.otherPlayerData||!(this.data.otherPlayerData instanceof OtherPlayerData)){this["bodyImg"].source="body00_png";this["weaponImg"].source="";this["wingImg"].source="";if(this.suitEff)DisplayUtils.removeFromParent(this.suitEff);if(this.suitEff2)DisplayUtils.removeFromParent(this.suitEff2);if(this.suitEff5)DisplayUtils.removeFromParent(this.suitEff5);if(this.suitEff7)DisplayUtils.removeFromParent(this.suitEff7);return}var otherPlayerData=this.data.otherPlayerData;var role=otherPlayerData.roleData[this.index];if(role){this.setWing(role.index,this.wingImg);this.setRole(role.index,this.bodyImg,this.weaponImg,this.bodyMc,this.weaponMc);this.setRoleEff(role.index)}};RoleItemRenderer.prototype.setRole=function(index,imgBody,imgWeapon,bodyMc,weaponMc){imgBody.source=null;imgWeapon.source=null;var role=this.data.otherPlayerData.roleData[index];var id=role.getEquipByIndex(0).item.configID;var zb=role.zhuangbei;var isHaveBody;var bodyId=zb[0];var weaponId=zb[1];var weaponConf=role.getEquipByIndex(0);var weaponConfId=weaponConf.item.configID;var bodyConf=role.getEquipByIndex(2);var bodyConfId=bodyConf.item.configID;var bodyRes;if(bodyConfId>0){var fileName=GlobalConfig.EquipConfig[bodyConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}if(fileName.indexOf("903")>0){bodyRes=fileName+"_"+role.sex+"_c"}else{bodyRes=fileName+"_c"}isHaveBody=true}if(!isHaveBody){bodyRes=getDefaultBody(role.job)+"_c"}if(bodyId>0){bodyRes=getZhuangbanById(bodyId).res+"_c"}this._body=imageToMc(imgBody,bodyRes,bodyMc);var weaponRes;if(weaponConfId>0){var fileName=GlobalConfig.EquipConfig[weaponConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}weaponRes=fileName+"_"+role.sex+"_c"}if(weaponId>0){weaponRes=getZhuangbanById(weaponId).res+"_"+role.sex+"_c"}imageToMc(imgWeapon,weaponRes,weaponMc,this._body)};RoleItemRenderer.prototype.setWing=function(index,wingImg){if(index===void 0){index=0}if(wingImg===void 0){wingImg=this.wingImg}var wingRes="";var role=this.data.otherPlayerData.roleData[index];var wingdata=role.wingsData;var id=role.zhuangbei[2];if(id>0)wingRes=GlobalConfig.ZhuangBanId[id].res;else if(wingdata.openStatus){wingRes=GlobalConfig.WingLevelConfig[wingdata.lv].appearance}else{wingRes=""}imageToMc(wingImg,wingRes,this.wingMc,this._body)};RoleItemRenderer.prototype.setRoleEff=function(roleIndex){this.setSuit(roleIndex,this.suitImg,this.suitEff);this.setWeaponsSuit(roleIndex,"sef",this.soulEff,this.suitEff2);this.setWeaponEffect(roleIndex,"bodyEffect",this.bodyEff,this.suitEff7,2)};RoleItemRenderer.prototype.showRole=function(e){if(!this.data||!this.data.otherPlayerData){return}ViewManager.ins().open(RRoleWin,this.data.otherPlayerData);var view=ViewManager.ins().open(RRoleWin,this.data.otherPlayerData);view.hideEx(2)};RoleItemRenderer.prototype.setSuit=function(roleId,suitImg,suitEff){DisplayUtils.removeFromParent(suitEff);var role=this.data.otherPlayerData.roleData[roleId];var cfg=role.heirloom.getSuitConfig(role);if(cfg){if(!suitEff.parent)suitImg.parent.addChildAt(suitEff,suitImg.parent.getChildIndex(suitImg));var suitConfig=GlobalConfig.HeirloomEquipSetConfig[cfg.lv];suitEff.playFile(RES_DIR_EFF+suitConfig.neff,-1)}};RoleItemRenderer.prototype.setWeaponsSuit=function(roleId,jobImage,soulEffGroup,suitEff){var role=this.data.otherPlayerData.roleData[roleId];suitEff.x=this[jobImage+role.job].x;suitEff.y=this[jobImage+role.job].y;suitEff.rotation=this[jobImage+role.job].rotation;DisplayUtils.removeFromParent(suitEff);var wid=role.weapons.weaponsId;var hideWeapons=role.hideWeapons();if(!hideWeapons&&wid){if(!suitEff.parent)soulEffGroup.addChild(suitEff);var suitConfig=GlobalConfig.WeaponSoulConfig[wid];suitEff.playFile(RES_DIR_EFF+suitConfig.inside[role.job-1],-1)}};RoleItemRenderer.prototype.setWeaponEffect=function(roleId,jobImage,soulEffGroup,suitEff,pos){if(pos===void 0){pos=0}var role=this.data.otherPlayerData.roleData[roleId];var id=role.getEquipByIndex(pos).item.configID;var cfg=GlobalConfig.EquipWithEffConfig[id+"_"+role.sex];DisplayUtils.removeFromParent(suitEff);var zb=role.zhuangbei;var eff=suitEff;if(eff==this.suitEff5){if(role.sex==0)DisplayUtils.removeFromParent(this.suitEff9);else eff=this.suitEff9}if(cfg&&(pos==0&&zb[1]<=0||pos==2&&zb[0]<=0)){eff.x=this[jobImage+role.sex].x+cfg.offX;eff.y=this[jobImage+role.sex].y+cfg.offY;eff.rotation=this[jobImage+role.sex].rotation;eff.scaleX=eff.scaleY=cfg.scaling;eff.playFile(RES_DIR_EFF+cfg.inShowEff,-1);soulEffGroup.addChild(eff)}else DisplayUtils.removeFromParent(eff)};return RoleItemRenderer}(BaseItemRender);__reflect(RoleItemRenderer.prototype,"RoleItemRenderer");var RoleSelectPanel=function(_super){__extends(RoleSelectPanel,_super);function RoleSelectPanel(){var _this=_super.call(this)||this;_this._curRole=0;_this.lastX=0;_this.isTouchBegin=false;_this.rolesLength=1;_this.rspInited=false;_this.initMc();return _this}RoleSelectPanel.prototype.$onRemoveFromStage=function(){_super.prototype.$onRemoveFromStage.call(this);this.destructor()};RoleSelectPanel.prototype.childrenCreated=function(){this.init();this.onAdd()};RoleSelectPanel.prototype.initMc=function(){this.roleMovie=[];for(var i=0;i<2;i++){var mc=new MovieClip;mc.x=38;mc.y=38;mc.touchEnabled=false;this.roleMovie.push(mc)}};RoleSelectPanel.prototype.init=function(){if(!this.rspInited){this.rspInited=true;this.roles=[this.role0,this.role1,this.role2];for(var i=0;i<2;i++){var mc=this.roleMovie[i];this.roles[i+1].addChild(mc)}}this.showNormalPower()};RoleSelectPanel.prototype.onAdd=function(){this.destructor();this.parent.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.parent.addEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this);this.addTouchEvent(this.recharge,this.onBtnClick);this.addTouchEvent(this.recharge0,this.onBtnClick);this.addTouchEvent(this,this.onClick);this.addTouchEvent(this.juesexiangxi,this.onClick);this.observe(GameLogic.ins().postSubRoleChange,this.updateRole);this.observe(Actor.ins().postLevelChange,this.updateRole);this.observe(UserVip.ins().postUpdateVipData,this.updateRole);this.observe(UserZs.ins().postZsData,this.updateRole);this.observe(Actor.ins().postGoldChange,this.initData);this.observe(Actor.ins().postYbChange,this.initData);this.init();this.setCurRole(this._curRole);this.updateRole();this.initData()};RoleSelectPanel.prototype.initData=function(){CommonUtils.labelIsOverLenght(this.goldTxt,Actor.gold);CommonUtils.labelIsOverLenght(this.ybTxt,Actor.yb)};RoleSelectPanel.prototype.getCurRole=function(){return this._curRole};RoleSelectPanel.prototype.showNormalPower=function(){this.juesexiangxi.visible=true;this.getPowerFunc=function(i){var model=SubRoles.ins().getSubRoleByIndex(i);if(model){return model.power}else{return 0}}};RoleSelectPanel.prototype.showOtherPower=function(func){if(func){this.getPowerFunc=func;this.juesexiangxi.visible=true}};RoleSelectPanel.prototype.setCurRole=function(value){this._curRole=value;for(var i=0;i<this.roles.length;i++){var element=this.roles[i];element.selected=i==value}this.dispatchEventWith(egret.Event.CHANGE,false,this._curRole);this.refreshPower(value)};RoleSelectPanel.prototype.refreshPower=function(value){var power=this.getPowerFunc(value);this.powerPanel.setPower(power)};RoleSelectPanel.prototype.onBtnClick=function(e){switch(e.currentTarget){case this.recharge0:Recharge.ins().tryShowChargeFirstWin();break;case this.recharge:Shop.openBuyGoldWin();break}};RoleSelectPanel.prototype.onClick=function(e){var index=this.roles.indexOf(e.target);if(index>-1)this.changeRole(index);switch(e.currentTarget){case this.juesexiangxi:ViewManager.ins().open(RoleAttrWin,this._curRole);break}};RoleSelectPanel.prototype.onMove=function(e){if(!this.headGroup.visible||!this.parent||!this.parent.touchEnabled)return;if(this.isPass())return;switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this.lastX=e.stageX;this.isTouchBegin=true;break;case egret.TouchEvent.TOUCH_END:if(!this.isTouchBegin)break;this.isTouchBegin=false;var Index=this._curRole;if(this.lastX-e.stageX>=100){Index++;if(Index>this.rolesLength)Index=0;this.changeRole(Index)}else if(this.lastX-e.stageX<=-100){Index--;if(Index<0)Index=this.rolesLength;this.changeRole(Index)}break}};RoleSelectPanel.prototype.isPass=function(){var forgwin=ViewManager.ins().getView(ForgeWin);if(forgwin&&forgwin.isNotMove)return true;var advanequipwin=ViewManager.ins().getView(AdvanEquipWin);if(advanequipwin&&advanequipwin.isNotMove)return true;var swordskinwin=ViewManager.ins().getView(SwordSkinWin);if(swordskinwin&&swordskinwin.isNotMove)return true;var dresscollectionwin=ViewManager.ins().getView(DressCollectionWin);if(dresscollectionwin&&dresscollectionwin.isNotMove)return true;var strengthWin=ViewManager.ins().getView(StrengthWin);if(strengthWin&&strengthWin.isNotMove)return true;var dressWin=ViewManager.ins().getView(DressWin);if(dressWin&&dressWin.isNotMove)return true;return false};RoleSelectPanel.prototype.changeRole=function(value){var model=SubRoles.ins().getSubRoleByIndex(value);if(model){this.setCurRole(value)}else{ViewManager.ins().open(NewRoleWin);if(!Assert(this.roles[value],"RoleSelectPanel changeRole value:"+value)){this.roles[value].selected=false}}};RoleSelectPanel.prototype.updateRole=function(){var role;var roleData;var len=this.roles.length;this.rolesLength=SubRoles.ins().subRolesLen-1;for(var i=0;i<len;i++){role=this.roles[i];roleData=SubRoles.ins().getSubRoleByIndex(i);if(roleData){role["jobImg"].visible=true;role["jobImg"].source="job"+roleData.job+"Item";role["stageImg"].visible=false;role["stageImg"].source="";role["lockImg"].visible=true;role.icon="yuanhead"+roleData.job+roleData.sex;if(this.roleMovie[i-1])DisplayUtils.removeFromParent(this.roleMovie[i-1])}else{var config=GlobalConfig.NewRoleConfig[i];if(!config){var parName=egret.getQualifiedClassName(this.parent);Assert(false,i18n("RoleSelectPanel_1",i,parName));continue}role["jobImg"].visible=false;role["stageImg"].visible=true;role["lockImg"].visible=true;if(config.zsLevel){if(UserZs.ins().lv<config.zsLevel){role["stageImg"].source="toujiesuo"+config.zsLevel;role["lockImg"].visible=false}else{role["stageImg"].source="toujiesuo"}}else{if(Actor.level<config.level){role["stageImg"].source="toujiesuo"+config.level;role["lockImg"].visible=false}else{role["stageImg"].source="toujiesuo"}}if(config.vip&&UserVip.ins().lv>=config.vip){role["stageImg"].source="toujiesuo"}role.icon=""}if(this.roleMovie[i-1]&&role["stageImg"].source=="toujiesuo"&&role["stageImg"].visible){this.roleMovie[i-1].playFile(RES_DIR_EFF+"juesejiesuo",-1);this.showRedPoint(i,true)}}};RoleSelectPanel.prototype.showRedPoint=function(index,b){if(this.roles==null)return;this.roles[index]["redPoint"].visible=b};RoleSelectPanel.prototype.clearRedPoint=function(){for(var i=0;i<this.roles.length;i++){this.roles[i]["redPoint"].visible=false}};RoleSelectPanel.prototype.setState=function(state){if(state===void 0){state="yhead"}this.currentState=state};RoleSelectPanel.prototype.destructor=function(){if(this.parent){this.parent.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.parent.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)}};return RoleSelectPanel}(BaseView);__reflect(RoleSelectPanel.prototype,"RoleSelectPanel");var ShapeShiftingMarketItemRenderer=function(_super){__extends(ShapeShiftingMarketItemRenderer,_super);function ShapeShiftingMarketItemRenderer(){var _this=_super.call(this)||this;_this.goodsID=0;_this.skinName="HonorMarketItemSkin";_this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onClick,_this);_this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.showTip,_this);_this.itemIcon.imgJob.visible=false;return _this}ShapeShiftingMarketItemRenderer.prototype.dataChanged=function(){var shopItem=this.data;if(!shopItem||!(shopItem instanceof ShapeShiftingStoreConfig))return;this.goodsID=shopItem.goods[0].id;var itemConfig=GlobalConfig.ItemConfig[this.goodsID];if(!itemConfig)return;this.isShowTips=false;this.money.text=shopItem.costMoney.count+"";this.moneyIcon.source="ZSbschip";this.itemName.text=itemConfig.name;this.itemName.textColor=ItemConfig.getQualityColor(itemConfig);this.itemName.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.num.text=shopItem.goods[0].count+"";if(this.itemIcon&&this.itemIcon.setData){this.itemIcon.setData(itemConfig)}this.usage.text="";if(shopItem.buyType==FEATS_TYPE.forever){this.myTimes.visible=true;var myCount=Shop.ins().ssData.exchangeCount[shopItem.id];myCount=myCount?myCount:0;var textcolor=this.myTimes.textColor;var colorStr=void 0;var str="";if(shopItem.dayCount){if(myCount>=shopItem.dayCount){colorStr=ColorUtil.RED_COLOR_N;str=i18n("ShapeShiftingMarketItemRenderer_0",colorStr,myCount,shopItem.dayCount)}else{colorStr=ColorUtil.GREEN_COLOR_N;str=i18n("ShapeShiftingMarketItemRenderer_1",colorStr,myCount,textcolor,shopItem.dayCount)}}this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(str)}else if(shopItem.buyType==FEATS_TYPE.infinite){this.myTimes.visible=false}else if(shopItem.buyType==FEATS_TYPE.day){this.myTimes.visible=true;var myCount=Shop.ins().ssData.exchangeCount[shopItem.id];myCount=myCount?myCount:0;var textcolor=this.myTimes.textColor;var colorStr=void 0;var str="";if(shopItem.dayCount){if(myCount>=shopItem.dayCount){colorStr=ColorUtil.RED_COLOR_N;str=i18n("ShapeShiftingMarketItemRenderer_2",colorStr,myCount,shopItem.dayCount);this.isShowTips=true}else{colorStr=ColorUtil.GREEN_COLOR_N;str=i18n("ShapeShiftingMarketItemRenderer_3",colorStr,myCount,textcolor,shopItem.dayCount)}}this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(str)}};ShapeShiftingMarketItemRenderer.prototype.onClick=function(){if(this.isShowTips){UserTips.ins().showTips(i18n("ShapeShiftingMarketItemRenderer_4",16711680));return}ViewManager.ins().open(BuyWin,this.data.id,4)};ShapeShiftingMarketItemRenderer.prototype.showTip=function(){var items=GlobalConfig.ShapeShiftingStoreConfig;var configID;for(var k in items){if(items[k].goods[0].id==this.goodsID){configID=items[k].goods[0].id}}if(configID==undefined){new Error(i18n("ShapeShiftingMarketItemRenderer_5"))}var itemConfig=GlobalConfig.ItemConfig[configID];var shopItem=this.data;ViewManager.ins().open(ItemDetailedWin,0,itemConfig.id,shopItem.goods[0].count)};return ShapeShiftingMarketItemRenderer}(BaseItemRender);__reflect(ShapeShiftingMarketItemRenderer.prototype,"ShapeShiftingMarketItemRenderer");var ShapeShiftingRandomStoreItemRenderer=function(_super){__extends(ShapeShiftingRandomStoreItemRenderer,_super);function ShapeShiftingRandomStoreItemRenderer(){var _this=_super.call(this)||this;_this.goodsID=0;_this.skinName="ShapeShiftingRandomStoreItemSkin";_this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onClick,_this);_this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.showTip,_this);_this.itemIcon.imgJob.visible=false;return _this}ShapeShiftingRandomStoreItemRenderer.prototype.dataChanged=function(){var shopItem=this.data;this.goodsID=shopItem.goods[0].id;var itemConfig=GlobalConfig.ItemConfig[this.goodsID];if(!itemConfig)return;this.money.text=shopItem.costMoney.count+"";var type=shopItem.costMoney.type;this.moneyIcon.source=type==17?"ZSbschip":"ZScoin";var discountImg=shopItem.discountImg;this.imgDiscount.source=discountImg;var origPrice=shopItem.origPrice;this.origGroup.visible=origPrice?true:false;this.origPrice.text=origPrice.toString();this.itemName.text=itemConfig.name;this.itemName.textColor=ItemConfig.getQualityColor(itemConfig);this.itemName.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.num.text=shopItem.goods[0].count+"";if(this.itemIcon&&this.itemIcon.setData){this.itemIcon.setData(itemConfig)}};ShapeShiftingRandomStoreItemRenderer.prototype.onClick=function(){ShapeShiftingMgr.ins().sendBuyReq(this.data.idx)};ShapeShiftingRandomStoreItemRenderer.prototype.showTip=function(){var items=GlobalConfig.ShapeShiftingRandomStoreConfig;var configID;for(var k in items){if(items[k].goods[0].id==this.goodsID){configID=items[k].goods[0].id}}if(configID==undefined){new Error(i18n("ShapeShiftingRandomStoreItemRenderer_0"))}var itemConfig=GlobalConfig.ItemConfig[configID];var shopItem=this.data;ViewManager.ins().open(ItemDetailedWin,0,itemConfig.id,shopItem.goods[0].count)};return ShapeShiftingRandomStoreItemRenderer}(BaseItemRender);__reflect(ShapeShiftingRandomStoreItemRenderer.prototype,"ShapeShiftingRandomStoreItemRenderer");var SkillPanel=function(_super){__extends(SkillPanel,_super);function SkillPanel(){var _this=_super.call(this)||this;_this.curRole=0;_this.curIndex=0;return _this}SkillPanel.prototype.init=function(){this.curRole=0};SkillPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.all,this.onAllUpgrade);for(var i=0;i<5;i++){var skillItem=this["skillItem"+(i+1)];this.addTouchEvent(skillItem,this.onSelect);this.addTouchEvent(skillItem["grewUpAllBtn"],this.onSingleUpgrade)}this.observe(UserSkill.ins().postSkillUpgradeAll,this.grewupAllSkillCB);this.updateAllSkillItemAndDesc()};SkillPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.all,this.onAllUpgrade);for(var i=0;i<5;i++){var skillItem=this["skillItem"+(i+1)];this.removeTouchEvent(skillItem,this.onSelect);this.removeTouchEvent(skillItem["grewUpAllBtn"],this.onSingleUpgrade)}this.removeObserve();DisplayUtils.removeFromParent(this.mc);this.mc=null};SkillPanel.prototype.showHint=function(){var str;if(Actor.level>=80){str=i18n("SkillPanel_0")}else{str=i18n("SkillPanel_1")}UserTips.ins().showTips(str)};SkillPanel.prototype.onSelect=function(e){var level=UserSkill.ins().getSkillLimitLevel();switch(e.currentTarget){case this.skillItem1:if(level<GlobalConfig.SkillsOpenConfig[1].level)return;this.curIndex=0;break;case this.skillItem2:if(level<GlobalConfig.SkillsOpenConfig[2].level)return;this.curIndex=1;break;case this.skillItem3:if(level<GlobalConfig.SkillsOpenConfig[3].level)return;this.curIndex=2;break;case this.skillItem4:if(level<GlobalConfig.SkillsOpenConfig[4].level)return;this.curIndex=3;break;case this.skillItem5:if(level<GlobalConfig.SkillsOpenConfig[5].level)return;this.curIndex=4;break}this.setSkillItem()};SkillPanel.prototype.onSingleUpgrade=function(e){switch(e.currentTarget.parent){case this.skillItem1:this.onSendUpgrade(0);this.curIndex=0;break;case this.skillItem2:this.onSendUpgrade(1);this.curIndex=1;break;case this.skillItem3:this.onSendUpgrade(2);this.curIndex=2;break;case this.skillItem4:this.onSendUpgrade(3);this.curIndex=3;break;case this.skillItem5:this.onSendUpgrade(4);this.curIndex=4;break}SoundUtil.ins().playEffect(SoundUtil.SKILL_UP);this.setSkillItem()};SkillPanel.prototype.onAllUpgrade=function(e){this.onSendUpgrade(0,true);SoundUtil.ins().playEffect(SoundUtil.SKILL_UP);this.setSkillItem()};SkillPanel.prototype.onSendUpgrade=function(skillIndex,isAll){if(isAll===void 0){isAll=false}UserSkill.ins().sendGrewUpAllSkill(this.curRole,isAll,skillIndex)};SkillPanel.prototype.updateAllSkillItemAndDesc=function(){DisplayUtils.removeFromParent(this.mc);this.mc=null;this.updateAllSkillItem();this.setSkillItem()};SkillPanel.prototype.updateAllSkillItem=function(){this.isUpGrade=false;this.all.currentState="up";for(var i=0;i<5;i++){var skillItem=this["skillItem"+(i+1)];var role=SubRoles.ins().getSubRoleByIndex(this.curRole);if(!role)return;var skillLevel=role.skillsData[i];if(skillLevel.lv<=0){if(UserSkill.ins().getSkillLimitLevel()>=GlobalConfig.SkillsOpenConfig[i+1].level){skillItem["lock"].textColor=64865;skillItem["lock"].text=i18n("SkillPanel_2")}else{skillItem["lock"].textColor=16317955;skillItem["lock"].text=GlobalConfig.SkillsOpenConfig[i+1].level+i18n("SkillPanel_3")}skillItem["lock"].visible=true;skillItem["lv"].text="";skillItem["costAll"].visible=false;skillItem["coinIcon1"].visible=false;skillItem["grewUpAllBtn"].visible=false}else{skillItem["lock"].visible=false;skillItem["lv"].text=skillLevel.lv+i18n("Level_0")+"";skillItem["costAll"].visible=true;skillItem["coinIcon1"].visible=true;skillItem["grewUpAllBtn"].visible=true;this.setCost(skillItem,i,skillLevel.lv)}skillItem["icon"].source=skillLevel.icon;skillItem["skillName"].text=skillLevel.name+"";skillItem["skillDesc"].textFlow=TextFlowMaker.generateTextFlow1(skillLevel.desc+"")}if(this.all.visible&&this.isUpGrade){if(!this.mc){this.mc=new MovieClip;this.mc.x=this.all.width/2;this.mc.y=this.all.height/2;this.all.addChild(this.mc);this.mc.playFile(RES_DIR_EFF+"chargeff1",-1)}}if(!this.isUpGrade)this.all.currentState="disabled"};SkillPanel.prototype.setCost=function(item,index,lv){var costNum=GlobalConfig.SkillsUpgradeConfig[lv].cost;var roleLevel=Actor.level;var coin=Actor.gold;item["costAll"].visible=item["coinIcon1"].visible=true;if(lv>=UserSkill.ins().getSkillLimitLevel()){item["grewUpAllBtn"].enabled=false;var skillLevel=SubRoles.ins().getSubRoleByIndex(this.curRole).skillsData[this.curIndex];if(skillLevel.lv>=UserSkill.MAX_LEVEL){item["grewUpAllBtn"].labelDisplay.text=i18n("SkillPanel_4");item["costAll"].visible=item["coinIcon1"].visible=false}else{var ins=UserZs.ins();if(lv>=80){item["grewUpAllBtn"].labelDisplay.text=ins.lv+1+i18n("SkillPanel_5")}else{item["grewUpAllBtn"].labelDisplay.text=roleLevel+1+i18n("SkillPanel_6")}}if(costNum<=coin){item["costAll"].textColor=5375653;item["costAll"].text=costNum}else{item["costAll"].textColor=15937822;item["costAll"].text=costNum}}else{var costAllNum=UserSkill.ins().getSingleSkillGrewUpCost(this.curRole,index);item["grewUpAllBtn"].labelDisplay.text=i18n("SkillPanel_7");if(costAllNum>0){this.isUpGrade=true;item["costAll"].textColor=5375653;item["costAll"].text=costAllNum;item["grewUpAllBtn"].enabled=true}else{item["costAll"].textColor=15937822;item["costAll"].text=costNum;item["grewUpAllBtn"].enabled=false}}};SkillPanel.prototype.setSkillItem=function(){for(var i=0;i<5;i++){var skillItem=this["skillItem"+(i+1)];skillItem["select"].visible=i==this.curIndex}};SkillPanel.prototype.setRoleId=function(id){this.curRole=id;this.updateAllSkillItemAndDesc()};SkillPanel.prototype.grewupAllSkillCB=function(upData){var old=upData[0];if(upData[1]!=this.curRole)return;var role=SubRoles.ins().getSubRoleByIndex(this.curRole);for(var i=0;i<old.length;i++){if(old[i].lv&&old[i].lv<role.skillsData[i].lv){this.grewupTip(old[i],role.skillsData[i],i)}}this.updateAllSkillItemAndDesc();DisplayUtils.removeFromParent(this.mc);this.mc=null};SkillPanel.prototype.grewupTip=function(skillold,skill,compIndex){var str="";var label=new eui.Label;label.size=20;label.textColor=2149168;var addAttack;if(skill.args){if(skillold.args){addAttack=skill.args.b-skillold.args.b;str=i18n("SkillPanel_8",skill.name,addAttack)}else{Assert(false,i18n("SkillPanel_9",skill.id,skill.lv,skillold.id,skillold.lv))}}else{if(skillold.tarEff&&skill.tarEff&&skillold.tarEff.length>0&&skill.tarEff.length>0){var effectsCfg=GlobalConfig.EffectsConfig[skillold.tarEff[0]];var nextEffectsCfg=GlobalConfig.EffectsConfig[skill.tarEff[0]];var sId=Math.floor(skill.id/1e3);switch(sId){case SHORT_SKILLID.MAGIC:addAttack=Math.ceil((nextEffectsCfg.args.d-effectsCfg.args.d)*1e3)/10;str=i18n("SkillPanel_10",skill.name,addAttack);break;case SHORT_SKILLID.CURE:addAttack=nextEffectsCfg.args.c-effectsCfg.args.c;str=i18n("SkillPanel_11",skill.name,addAttack);break;case SHORT_SKILLID.POISONING:addAttack=nextEffectsCfg.args.c-effectsCfg.args.c;str=i18n("SkillPanel_12",skill.name,addAttack);break;case SHORT_SKILLID.ARMOR:addAttack=nextEffectsCfg.args.c-effectsCfg.args.c;str=i18n("SkillPanel_13",skill.name,addAttack);break;case SHORT_SKILLID.SUMMON:addAttack=nextEffectsCfg.args.a-effectsCfg.args.a;str=i18n("SkillPanel_14",addAttack);break}addAttack=nextEffectsCfg.args.d-effectsCfg.args.d}else if(skill.tarEff){Assert(false,i18n("SkillPanel_15",skill.id,skill.lv,skillold.id,skillold.lv))}}var skillItem=this["skillItem"+(compIndex+1)];label.text=str;var x=skillItem.width/2-label.textWidth/2;var y=skillItem.height/4;label.x=x;label.y=y;skillItem.addChild(label);var mc=new MovieClip;mc.x=65;mc.y=y+20;mc.playFile(RES_DIR_EFF+"forgeSuccess",1);skillItem.addChild(mc);var t=egret.Tween.get(label);t.to({y:label.y-45},600).wait(1e3).call(function(){label.parent.removeChild(label)},this)};return SkillPanel}(BaseView);__reflect(SkillPanel.prototype,"SkillPanel");var SmeltEquipNormalPanel=function(_super){__extends(SmeltEquipNormalPanel,_super);function SmeltEquipNormalPanel(){var _this=_super.call(this)||this;_this.viewIndex=0;_this.clickedSmelt=false;_this.name=i18n("SmeltEquipNormalPanel_0");return _this}SmeltEquipNormalPanel.prototype.childrenCreated=function(){this.init()};SmeltEquipNormalPanel.prototype.init=function(){this.smeltEquips=[];this.smeltEquips.length=9;this.itemList.itemRenderer=SmeltEquipItem;this.dataInfo=new eui.ArrayCollection(this.smeltEquips);this.itemList.dataProvider=this.dataInfo;this.eff=new MovieClip;this.eff.x=78;this.eff.y=30;this.eff.scaleX=1;this.eff.scaleY=1;this.eff.touchEnabled=false};SmeltEquipNormalPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.smeltBtn,this.onTap);this.addTouchEvent(this.itemList,this.onTap);this.addTouchEvent(this.smeltLable,this.onTap);this.addTouchEvent(this.backbtn,this.onTap);this.addTouchEvent(this.CardBtn,this.onTap);this.addTouchEvent(this.vipBtn,this.onTap);TimerManager.ins().doTimer(100,1,this.setItemData,this);this.observe(UserEquip.ins().postSmeltEquipComplete,this.smeltComplete);this.observe(UserEquip.ins().postEquipCheckList,this.setItemList);this.observe(UserEquip.ins().postSmeltEquipComplete,this.smeltShowTips);this.autoBtn.addEventListener(egret.Event.CHANGE,this.setAuto,this);UserEquip.ins().clearRecycle()};SmeltEquipNormalPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.smeltBtn,this.onTap);this.removeTouchEvent(this.itemList,this.onTap);this.removeTouchEvent(this.smeltLable,this.onTap);this.removeTouchEvent(this.backbtn,this.onTap);this.removeObserve();DisplayUtils.removeFromParent(this.eff);TimerManager.ins().remove(this.AutoSmeltEquip,this);if(this.clickedSmelt){UserEquip.ins().showRecycle()}};SmeltEquipNormalPanel.prototype.smeltShowTips=function(itemList){for(var i=0;i<itemList.length;i++){var idata=itemList[i];var equipConfig=GlobalConfig.EquipConfig[idata.itemId];if(equipConfig){var itemConfig=GlobalConfig.ItemConfig[equipConfig.id];if(itemConfig){var quality=ItemConfig.getQualityColor(itemConfig);var str=i18n("SmeltEquipNormalPanel_1")+i18n("SmeltEquipNormalPanel_11")+quality+"&T:"+itemConfig.name+" x "+idata.count+"|";var p=this.smeltBtn.localToGlobal();UserTips.ins().showEverTips({str:str,x:p.x-25,y:p.y-45})}}}};SmeltEquipNormalPanel.prototype.smeltComplete=function(){var n=this.itemList.numChildren;while(n--){this.itemList.getChildAt(n).playEff()}this.setItemData()};SmeltEquipNormalPanel.prototype.setItemData=function(){this.smeltEquips=UserBag.ins().getOutEquips(false);this.dataInfo.replaceAll(this.smeltEquips);if(this.smeltBtn.label!=i18n("SmeltEquipNormalPanel_2")){this.setBtnLabel()}};SmeltEquipNormalPanel.prototype.setItemList=function(list){this.dataInfo.replaceAll(list);this.itemList.dataProvider=this.dataInfo};SmeltEquipNormalPanel.prototype.getGuildButton=function(){this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.eff.parent)this.btnGroup.addChild(this.eff);return this.smeltBtn};SmeltEquipNormalPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.CardBtn:break;case this.vipBtn:ViewManager.ins().close(SmeltEquipTotalWin);ViewManager.ins().open(VipWin);break;case this.smeltBtn:TimerManager.ins().doTimer(1e3,1,UIView2.instance.checkGuanqiaBagFull,UIView2.instance);TimerManager.ins().doTimer(5e3,1,UIView2.instance.checkGuanqiaBagFull,UIView2.instance);if(UserZs.ins().lv>=GlobalConfig.PrivilegeData.openzslevel){if(this.smeltBtn.label==i18n("SmeltEquipNormalPanel_3")){this.setBtnLabel();TimerManager.ins().remove(this.AutoSmeltEquip,this)}else{if(!TimerManager.ins().isExists(this.AutoSmeltEquip,this)){this.smeltBtn.label=i18n("SmeltEquipNormalPanel_4");this.AutoSmeltEquipAll();this.clickedSmelt=true}}}else{DisplayUtils.removeFromParent(this.eff);var b=UserEquip.ins().sendSmeltEquip(this.viewIndex,this.smeltEquips);if(b){SoundUtil.ins().playEffect(SoundUtil.SMELT)}this.clickedSmelt=true}break;case this.itemList:var item=e.target;if(item&&item.data){var i=this.smeltEquips.indexOf(item.data);if(i>=0){this.smeltEquips.splice(i,1);item.data=null}}break;case this.smeltLable:break;case this.backbtn:ViewManager.ins().close(SmeltEquipTotalWin);break}};SmeltEquipNormalPanel.prototype.AutoSmeltEquip=function(){DisplayUtils.removeFromParent(this.eff);var b=UserEquip.ins().sendSmeltEquip(this.viewIndex,this.smeltEquips);if(b){SoundUtil.ins().playEffect(SoundUtil.SMELT)}else{this.setBtnLabel();TimerManager.ins().remove(this.AutoSmeltEquip,this)}};SmeltEquipNormalPanel.prototype.AutoSmeltEquipAll=function(){DisplayUtils.removeFromParent(this.eff);UserBag.ins().sendSmeltAll();var eq=UserBag.ins().getOutEquips(true);if(eq.length>0){SoundUtil.ins().playEffect(SoundUtil.SMELT)}else{this.setBtnLabel();TimerManager.ins().remove(this.AutoSmeltEquip,this)}};SmeltEquipNormalPanel.prototype.setBtnLabel=function(){this.smeltBtn.label=UserZs.ins().lv>=GlobalConfig.PrivilegeData.openzslevel?i18n("SmeltEquipNormalPanel_6"):i18n("SmeltEquipNormalPanel_7");this.allMeltCond.visible=UserZs.ins().lv>=GlobalConfig.PrivilegeData.openzslevel?false:true;this.autoMeltCond.visible=UserBag.canAutoMelt?false:true;this.autoBtn.selected=UserBag.auto_smelt==1?true:false;this.limitTxt.text="尊者"+GlobalConfig.PrivilegeData.autoSmelt+i18n("SmeltEquipNormalPanel_8")};SmeltEquipNormalPanel.prototype.setAuto=function(){var self=this;if(!UserBag.canAutoMelt){var str="尊者"+GlobalConfig.PrivilegeData.autoSmelt+i18n("SmeltEquipNormalPanel_9");UserTips.ins().showTips(str);this.autoBtn.selected=false;return}if(this.autoBtn.selected){UserBag.auto_smelt=1;UserEquip.ins().sendAutoSmeltFlag(UserBag.auto_smelt)}else{UserBag.auto_smelt=0;UserEquip.ins().sendAutoSmeltFlag(UserBag.auto_smelt)}};return SmeltEquipNormalPanel}(BaseComponent);__reflect(SmeltEquipNormalPanel.prototype,"SmeltEquipNormalPanel");var SmeltItemList=function(_super){__extends(SmeltItemList,_super);function SmeltItemList(){var _this=_super.call(this)||this;_this.touchChildren=false;return _this}SmeltItemList.prototype.dataChanged=function(){if(this.data instanceof RewardData){this.itemConfig=GlobalConfig.ItemConfig[this.data.id];this.num=this.data.count;this.itemIcon.setData(this.itemConfig);this.setCount(this.num+"");this.nameTxt.text=this.itemConfig.name}};return SmeltItemList}(ItemBase);__reflect(SmeltItemList.prototype,"SmeltItemList");var SmeltItemNormalPanel=function(_super){__extends(SmeltItemNormalPanel,_super);function SmeltItemNormalPanel(){return _super.call(this)||this}SmeltItemNormalPanel.prototype.childrenCreated=function(){this.init()};SmeltItemNormalPanel.prototype.init=function(){this.itemDataList=[];this.selectList=[];this.smeltEquips=[];this.smeltEquips.length=9;this.itemList.itemRenderer=SmeltEquipItem;this.getItemList.itemRenderer=SmeltItemList;this.dataInfo=new eui.ArrayCollection(this.smeltEquips);this.itemList.dataProvider=this.dataInfo;this.getItemCollection=new eui.ArrayCollection;this.getItemList.dataProvider=this.getItemCollection};SmeltItemNormalPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.itemDataList=param[0];this.addTouchEvent(this.smeltBtn,this.onTap);this.addTouchEvent(this.itemList,this.onTap);this.addTouchEvent(this.backbtn,this.onTap);this.setItemData();this.observe(UserForge.ins().postMeltItem,this.smeltComplete)};SmeltItemNormalPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};SmeltItemNormalPanel.prototype.smeltComplete=function(){for(var i=0;i<this.selectList.length;i++){for(var j=0;j<this.itemList.numElements;j++){var item=this.itemList.dataProvider.getItemAt(j);if(item.handle==this.selectList[i].handle){var render=this.itemList.getVirtualElementAt(j);this.itemList.removeChild(render);if(this.itemDataList[j])this.itemDataList.splice(j,1);break}}}this.selectList=[];SoundUtil.ins().playEffect(SoundUtil.SMELT);this.setItemData()};SmeltItemNormalPanel.prototype.setItemData=function(){this.smeltEquips=this.updateList();this.dataInfo.replaceAll(this.smeltEquips);this.updateFJlist()};SmeltItemNormalPanel.prototype.updateList=function(){var list=[];for(var i=0;i<this.smeltEquips.length;i++){if(this.itemDataList[i])list.push(this.itemDataList[i]);else break}return list};SmeltItemNormalPanel.prototype.updateFJlist=function(){var list=[];for(var i in this.selectList){var cfg=GlobalConfig.RongLuExpConfig[this.selectList[i].configID];var ishave=false;LIST:for(var j in list){for(var r in cfg.reward){if(list[j].id==cfg.reward[r].id){list[j].count+=cfg.reward[r].count*this.selectList[i].count;ishave=true;break LIST}}}if(!ishave){var rewardData=new RewardData;rewardData.type=cfg.reward[i].type;rewardData.id=cfg.reward[i].id;rewardData.count=cfg.reward[i].count*this.selectList[i].count;list.push(rewardData)}}this.getItemCollection.replaceAll(list)};SmeltItemNormalPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.smeltBtn:if(this.selectList.length<=0){UserTips.ins().showTips(i18n("SmeltItemNormalPanel_0"));return}UserForge.ins().sendMeltItem(this.selectList);break;case this.itemList:var item=e.target;if(item&&item.data){var idx=this.selectList.indexOf(item.data);if(idx==-1){item.selectFrame.visible=true;this.selectList.push(item.data)}else{item.selectFrame.visible=false;this.selectList.splice(idx,1)}}this.updateFJlist();break;case this.backbtn:ViewManager.ins().close(SmeltItemTotalWin);break}};return SmeltItemNormalPanel}(BaseComponent);__reflect(SmeltItemNormalPanel.prototype,"SmeltItemNormalPanel");var SmeltItemTotalWin=function(_super){__extends(SmeltItemTotalWin,_super);function SmeltItemTotalWin(){var _this=_super.call(this)||this;_this.skinName="hunguRongluSkin";_this.isTopLevel=true;return _this}SmeltItemTotalWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};SmeltItemTotalWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.equip.open(param[0]);this.addTouchEvent(this.bgClose,this.onTap)};SmeltItemTotalWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.equip.close()};SmeltItemTotalWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break}};return SmeltItemTotalWin}(BaseEuiView);__reflect(SmeltItemTotalWin.prototype,"SmeltItemTotalWin");ViewManager.ins().reg(SmeltItemTotalWin,LayerManager.UI_Popup);var WingAttrWin=function(_super){__extends(WingAttrWin,_super);function WingAttrWin(){return _super.call(this)||this}WingAttrWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WingAttrSkin"};WingAttrWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curRole=param[0];this.setRoleAttr(this.curRole);this.addTouchEndEvent(this,this.otherClose);this.addTouchEvent(this.closeBtn,this.onClose)};WingAttrWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this);this.removeTouchEvent(this.closeBtn,this.onClose)};WingAttrWin.prototype.onClose=function(e){ViewManager.ins().close(this)};WingAttrWin.prototype.otherClose=function(e){if(e.target==this.bg||e.target instanceof eui.Button)return;ViewManager.ins().close(this)};WingAttrWin.prototype.setRoleAttr=function(roleId){this.wingsData=SubRoles.ins().getSubRoleByIndex(roleId).wingsData;var config=GlobalConfig.WingLevelConfig[this.wingsData.lv];this.attr.text=AttributeData.getAttStr(config.attr,1)};return WingAttrWin}(BaseEuiView);__reflect(WingAttrWin.prototype,"WingAttrWin");ViewManager.ins().reg(WingAttrWin,LayerManager.UI_Main);var WingEquipItemrender=function(_super){__extends(WingEquipItemrender,_super);function WingEquipItemrender(){var _this=_super.call(this)||this;_this.skinName="WingEquipItemSkin";_this.addEventListener(egret.TouchEvent.TOUCH_END,_this.onClick,_this);return _this}WingEquipItemrender.prototype.dataChanged=function(){var model=this.data;var curRole=model["curRole"];var itemData=model["data"];this.role=SubRoles.ins().getSubRoleByIndex(curRole);this.itemConfig=itemData.itemConfig;this.item0.setData(itemData.itemConfig);this.equipXuqiu.text=i18n("WingEquipItemrender_0",this.itemConfig.level+1);this.equipXuqiu.textColor=15937822;this.equipName.text=itemData.itemConfig.name;this.score.text=i18n("WingEquipItemrender_1",itemData.point)};WingEquipItemrender.prototype.descut=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};WingEquipItemrender.prototype.onClick=function(){this.openEquipsTips()};WingEquipItemrender.prototype.openEquipsTips=function(){ViewManager.ins().open(EquipDetailedWin,1,this.data.data.handle,this.itemConfig.id,this.data.data,this.role)};return WingEquipItemrender}(BaseItemRender);__reflect(WingEquipItemrender.prototype,"WingEquipItemrender");var WingPanel=function(_super){__extends(WingPanel,_super);function WingPanel(){var _this=_super.call(this)||this;_this.curRole=0;_this._lastLv=0;_this._isAutoUp=false;_this.barbc=new ProgressBarEff;_this.currViewNum=0;_this.lastTimeDown=0;_this.waitToChange=false;_this.rapetNum=0;return _this}WingPanel.prototype.childrenCreated=function(){this.init()};WingPanel.prototype.init=function(){this.boostPrice1.setType(MoneyConst.wing);this.barbc.setWidth(480);this.barbc.x=10;this.barbc.y=-15;this.expGroup.addChild(this.barbc);this.mc=new MovieClip;this.mc.x=214;this.mc.y=245;this.wingImg.touchEnabled=false;this.wingMc.touchEnabled=false;this.reliveEff=new MovieClip;this.reliveEff.x=100;this.reliveEff.y=35;this.reliveEff.scaleX=1.3;this.reliveEff.scaleY=1.1;this.reliveEff.touchEnabled=false;this.skillIconArr=[];for(var i=0;i<5;i++){this.skillIconArr[i]=this["itemicon"+i]}this.danItemID=GlobalConfig.WingCommonConfig.levelItemid};WingPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.openStatusBtn,this.onTap);this.addTouchEvent(this.boostBtn1,this.onTap);this.addTouchEvent(this.checkBoxs,this.isShowUpGradeBtn);this.addTouchEvent(this.rightBtn,this.onTap);this.addTouchEvent(this.leftBtn,this.onTap);this.addTouchEvent(this.bigUpLevelBtn,this.onTap);this.addTouchEvent(this.boostBtn0,this.onTap);this.addTouchEvent(this.shenyu,this.onTap);this.addTouchEvent(this.feishengBtn,this.onTap);this.addTouchEvent(this.zizhiBtn,this.onTap);for(var i=0;i<5;i++){this.addTouchEvent(this.skillIconArr[i],this.skillItemClick)}this.observe(Wing.ins().postBoost,this.showBoost);this.observe(Wing.ins().postWingUpgrade,this.updateLevel);this.observe(Wing.ins().postActivate,this.setWingData);this.observe(Wing.ins().postWingEquip,this.setWingData);this.observe(Wing.ins().postWingTime,this.setTimeDown);this.observe(UserBag.ins().postItemChange,this.isShowUpGradeBtn);this.observe(UserBag.ins().postItemAdd,this.isShowUpGradeBtn);this.observe(UserBag.ins().postItemDel,this.isShowUpGradeBtn);this.observe(GodWingRedPoint.ins().postGodWingRedPoint,this.updateRedPoint);this.observe(Wing.ins().postUseDanSuccess,this.setWingData);this.barbc.reset();this.setWingData();this.updateLevel(true);this.updateRedPoint();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.wing);if(this._wingsData.clearTime>0&&!Wing.ins().showOnce[this.curRole]){Wing.ins().showOnce[this.curRole]=true}};WingPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.openStatusBtn,this.onTap);this.removeTouchEvent(this.boostBtn1,this.onTap);this.removeTouchEvent(this.checkBoxs,this.isShowUpGradeBtn);this.removeTouchEvent(this.rightBtn,this.onTap);this.removeTouchEvent(this.leftBtn,this.onTap);this.removeTouchEvent(this.boostBtn0,this.onTap);this.removeTouchEvent(this.bigUpLevelBtn,this.onTap);this.removeTouchEvent(this.shenyu,this.onTap);this.removeTouchEvent(this.feishengBtn,this.onTap);this.removeTouchEvent(this.zizhiBtn,this.onTap);for(var i=0;i<5;i++){this.removeTouchEvent(this.skillIconArr[i],this.skillItemClick)}TimerManager.ins().remove(this.autoUpStar,this);this.removeObserve();if(this._isAutoUp){this.stopAutoUp()}TimerManager.ins().remove(this.refushTimeLabel,this);GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};WingPanel.prototype.updateLevel=function(isFirst){if(isFirst===void 0){isFirst=false}var wingSkills=SubRoles.ins().getSubRoleByIndex(this.curRole).wingSkillData;var curIndex=0;for(var i=0;i<5;i++){if(wingSkills[i]&&wingSkills[i]>0){this.skillIconArr[i].data=wingSkills[i];this["openTxt"+i].text="";curIndex=i+1}else{var level=Wing.ins().getLevelBySkill(i);this["openTxt"+i].text=i18n("WingPanel_0",level+1);var cfg=GlobalConfig.WingLevelConfig[level];if(cfg&&cfg.pasSkillId){this.skillIconArr[i].data=cfg.pasSkillId;this.skillIconArr[i].blackImg.visible=true}}}if(curIndex<5){var icon=void 0;var wingConfig=GlobalConfig.WingLevelConfig;var idx=0;for(var k in wingConfig){var cfg=wingConfig[k];if(cfg&&cfg.pasSkillId){icon=cfg.pasSkillId;if(idx==curIndex)break;idx++}}if(icon){this.skillIconArr[curIndex].data=icon;this.skillIconArr[curIndex].blackImg.visible=true}}if(this._isAutoUp){this.stopAutoUp()}this.setWingData(isFirst)};WingPanel.prototype.updateDans=function(){this.redPoint1.visible=Wing.ins().canUseFlyUpByRoleID(this.curRole);this.redPoint2.visible=Wing.ins().canUseAptitudeByRoleID(this.curRole)};WingPanel.prototype.onTap=function(e){var _this=this;switch(e.currentTarget){case this.openStatusBtn:if(Actor.level>=GlobalConfig.WingCommonConfig.openLevel)this.showOpenMovie();else{UserTips.ins().showTips(i18n("WingPanel_1"))}break;case this.boostBtn1:if(this._isAutoUp){this.stopAutoUp()}this.autoUpStar();break;case this.rightBtn:this.currViewNum++;this.setSeeBtnStatu();this.setWingView(this.currViewNum);break;case this.leftBtn:this.currViewNum--;this.setSeeBtnStatu();this.setWingView(this.currViewNum);break;case this.boostBtn0:if(this.boostBtn0.label==i18n("WingPanel_2")){if(this._isAutoUp){this.stopAutoUp()}}else{this._isAutoUp=true;this.boostBtn0.label=i18n("WingPanel_3");TimerManager.ins().doTimer(150,0,this.autoUpStar,this)}break;case this.bigUpLevelBtn:var itemName=GlobalConfig.ItemConfig[this.danItemID].name;WarnWin.show(i18n("WingPanel_4",itemName,GlobalConfig.ItemConfig[this.danItemID].desc),function(){Wing.ins().sendBigUpLevel(_this.curRole)},this);break;case this.shenyu:ViewManager.ins().open(GodWingWin);break;case this.feishengBtn:ViewManager.ins().open(WingFeishengTipsWin,this.curRole);break;case this.zizhiBtn:ViewManager.ins().open(WingZizhiTipsWin,this.curRole);break}};WingPanel.prototype.skillItemClick=function(e){var index=this.skillIconArr.indexOf(e.currentTarget);if(index>=0){if(!this.skillIconArr[index].skillIcon.visible)return;ViewManager.ins().open(WingSkillTipPanel,Wing.ins().getWingSkillByIndex(index))}};WingPanel.prototype.stopAutoUp=function(){this._isAutoUp=false;this.boostBtn0.label=i18n("WingPanel_5");TimerManager.ins().remove(this.autoUpStar,this)};WingPanel.prototype.autoUpStar=function(){var config=GlobalConfig.WingLevelConfig[this._wingsData.lv];var count=UserBag.ins().getBagGoodsCountById(0,config.itemId);if(count>=config.itemNum){Wing.ins().sendBoost(this.curRole,0)}else if(this.checkBoxs.selected){if(Actor.yb>=config.itemNum*config.itemPrice){Wing.ins().sendBoost(this.curRole,1)}else{this.stopAutoUp();if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("WingPanel_6"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("WingPanel_7"))}}else{this.stopAutoUp();UserTips.ins().showTips(i18n("WingPanel_8"))}};WingPanel.prototype.notOpenStatus=function(){this.expGroup.visible=false;this.skillGroup.visible=false;this.barbc.visible=false;this.boostBtn0.visible=false;this.boostBtn1.visible=false;this.boostPrice1.visible=false;this.powerPanel.visible=false;this.openStatusBtn.visible=true;this.rightBtn.visible=false;this.leftBtn.visible=false;this.jihuo.visible=false;this.weijihuo.visible=true;this.wing.visible=true;this.dor1.x=0;this.dor2.x=526;this.shan.visible=false;var flag=GlobalConfig.WingCommonConfig.openLevel>Actor.level;this.jihuolv.visible=flag;this.jihuolv.text=i18n("WingPanel_9",GlobalConfig.WingCommonConfig.openLevel);this.bigUpLevelBtn.visible=this.redPoint.visible=false;if(!flag){this.reliveEff.playFile(RES_DIR_EFF+"chargeff1",-1);this.openStatusBtn.addChild(this.reliveEff)}};WingPanel.prototype.openStatusOpen=function(){this.skillGroup.visible=true;this.openStatusBtn.visible=false;this.barbc.visible=true;this.boostBtn0.visible=true;this.boostBtn1.visible=true;this.rightBtn.visible=true;this.leftBtn.visible=true;this.jihuo.visible=true;this.weijihuo.visible=false;this.bigUpLevelBtn.visible=true;var count=UserBag.ins().getBagGoodsCountById(0,this.danItemID);if(this._wingsData.lv>=Wing.WingMaxLv){this.arrows.visible=false;this.nextAttrLabel.text="";this.attrLabel.horizontalCenter=0;this.expGroup.visible=false;this.maxInfo.visible=true}else{this.arrows.visible=true;this.attrLabel.horizontalCenter=-100;this.expGroup.visible=true;this.maxInfo.visible=false}this.redPoint.visible=this.bigUpLevelBtn.visible&&this._wingsData.lv==Wing.WingExpRedPoint;this.shenyu.visible=GameServer.serverOpenDay+1>=GlobalConfig.WingCommonConfig.openDay?true:false};WingPanel.prototype.showBoost=function(param){var _this=this;var crit=param[0];var addExp=param[1];var label=new eui.Label;label.size=20;var str="";label.textColor=16317955;label.strokeColor=4331069;label.stroke=2;str=i18n("WingPanel_10");label.x=200;label.y=326;label.text=str+addExp;this.addChild(label);var t=egret.Tween.get(label);t.to({y:label.y-45},500).call(function(){_this.removeChild(label)},this);if(crit&&(crit==2||crit==5)){var img_1=new eui.Image("xn_wingup"+crit);img_1.horizontalCenter=0;img_1.verticalCenter=0;img_1.scaleX=img_1.scaleY=.5;var t_1=egret.Tween.get(img_1);t_1.to({scaleX:1.5,scaleY:1.5,alpha:0},500).call(function(){DisplayUtils.removeFromParent(img_1)},this);this.actEff.addChild(img_1)}this.expBarChange();this.updateAtt();this.isShowUpGradeBtn()};WingPanel.prototype.setWingView=function(lv){this.updateDans();if(lv>Wing.WingMaxLv||lv<0){return}var tempConfig=GlobalConfig.WingLevelConfig[lv];var wingRes=tempConfig.appearance;imageToMc(this.wingImg,wingRes,this.wingMc,null);this.nameTxt.text=tempConfig.name};WingPanel.prototype.setWingData=function(isFirst){if(isFirst===void 0){isFirst=false}this._wingsData=SubRoles.ins().getSubRoleByIndex(this.curRole).wingsData;var wingRes=this._wingsData.getImgSource();imageToMc(this.wingImg,wingRes,this.wingMc,null);this.currViewNum=this._wingsData.lv;this.setSeeBtnStatu();var cfg=GlobalConfig.WingLevelConfig[this._wingsData.lv];this.nameTxt.text=cfg.name;this.updateDans();if(this._wingsData.openStatus){this.openStatusOpen()}else{this.notOpenStatus();return}this.expBarChange(isFirst);this.updateAtt();this.isShowUpGradeBtn();this.setTimeDown();if(this._lastLv==0)this._lastLv=this._wingsData.lv;if(this._lastLv!=this._wingsData.lv){this._lastLv=this._wingsData.lv}};WingPanel.prototype.setSeeBtnStatu=function(){if(this.currViewNum>=Wing.WingMaxLv||this.currViewNum>=this._wingsData.lv+1){this.rightBtn.enabled=false;this.leftBtn.enabled=true}else if(this.currViewNum<=0){this.leftBtn.enabled=false;this.rightBtn.enabled=true}else{this.leftBtn.enabled=true;this.rightBtn.enabled=true}};WingPanel.prototype.setTimeDown=function(){var config=GlobalConfig.WingLevelConfig[this._wingsData.lv];if(!config){return}TimerManager.ins().remove(this.refushTimeLabel,this);if(config.clearTime){this.clearGroup.visible=true;if(this._wingsData.clearTime>0){this.lastTime.text=i18n("WingPanel_13");this.lastTimeDown=Math.floor((DateUtils.formatMiniDateTime(this._wingsData.clearTime)-GameServer.serverTime)/1e3);this.lastTimeDown=Math.max(0,this.lastTimeDown);this.timeLabel.text=DateUtils.getFormatBySecond(this.lastTimeDown,1);TimerManager.ins().remove(this.refushTimeLabel,this);TimerManager.ins().doTimer(1e3,this.lastTimeDown,this.refushTimeLabel,this)}else{this.lastTime.text="";this.timeLabel.text="";TimerManager.ins().remove(this.refushTimeLabel,this)}}else{this.clearGroup.visible=false}this.noclean.visible=!this.clearGroup.visible};WingPanel.prototype.refushTimeLabel=function(){if(this.lastTimeDown>0){--this.lastTimeDown;this.timeLabel.text=DateUtils.getFormatBySecond(this.lastTimeDown,1)}};WingPanel.prototype.getPower=function(){return this._totalPower||0};WingPanel.prototype.updateAtt=function(){var config=GlobalConfig.WingLevelConfig[this._wingsData.lv];var nextLvConfig=GlobalConfig.WingLevelConfig[this._wingsData.lv+1];var power=0;this._totalPower=UserBag.getAttrPower(config.attr);var addAttrs=WingPanel.getDanAttrs(this._wingsData.lv,this.curRole);this._totalPower+=UserBag.getAttrPower(addAttrs);this.attrLabel.text=AttributeData.getAttStr(AttributeData.AttrAddition(addAttrs,config.attr),1);if(this._wingsData&&this._wingsData.exp&&nextLvConfig){var tempAttr=[];var attr=nextLvConfig.attr;var configPercent=GlobalConfig.WingCommonConfig.tempattr?GlobalConfig.WingCommonConfig.tempattr:1;for(var index=0;index<attr.length;index++){var attrs=new AttributeData;attrs.type=attr[index].type;attrs.value=Math.ceil(this._wingsData.exp/config.exp*(configPercent*attr[index].value));tempAttr.push(attrs)}this.attrTempLabel.text=AttributeData.getAttStr(tempAttr,1,1,i18n("WingPanel_14"),false,false,null,"）");power=UserBag.getAttrPower(tempAttr);this.attrGroup.horizontalCenter=-143}else{this.attrTempLabel.text="";this.attrGroup.horizontalCenter=-100}this._totalPower=this._totalPower+power;this.powerPanel.setPower(this._totalPower);if(this._wingsData.lv<Wing.WingMaxLv){this.nextAttrLabel.text=AttributeData.getAttStr(AttributeData.AttrAddition(addAttrs,nextLvConfig.attr),1)}};WingPanel.getDanAttrs=function(lv,curRole){var role=SubRoles.ins().getSubRoleByIndex(curRole);var config=GlobalConfig.WingLevelConfig[lv];var len=config.attr.length;var pAttr=[];for(var i=0;i<len;i++)pAttr.push(new AttributeData(config.attr[i].type,Math.floor(config.attr[i].value*GlobalConfig.WingCommonConfig.flyPill/1e4*role.wingsData.flyUpDan)));var attrs=GlobalConfig.WingCommonConfig.attrPill;len=attrs.length;for(var i=0;i<len;i++)pAttr.push(new AttributeData(attrs[i].type,attrs[i].value*role.wingsData.aptitudeDan));attrs=GlobalConfig.WingCommonConfig.flyPillAttr;len=attrs.length;for(var i=0;i<len;i++)pAttr.push(new AttributeData(attrs[i].type,attrs[i].value*role.wingsData.flyUpDan));return pAttr};WingPanel.prototype.expBarChange=function(isFirst){if(isFirst===void 0){isFirst=false}if(isFirst){if(!this.waitToChange){this.waitToChange=true;this._expBarChange()}TimerManager.ins().doTimer(2e3,1,this.openChange,this)}else{this._expBarChange()}};WingPanel.prototype._expBarChange=function(){var starConfig=GlobalConfig.WingLevelConfig[this._wingsData.lv];if(!starConfig)return;var maxExp=starConfig.exp;if(this.barbc.getMaxValue()!=maxExp){this.barbc.setData(this._wingsData.exp,maxExp)}else{this.barbc.setValue(this._wingsData.exp)}};WingPanel.prototype.openChange=function(){TimerManager.ins().remove(this.openChange,this);this.waitToChange=false};WingPanel.prototype.isShowUpGradeBtn=function(){this.updateDans();if(this._wingsData.lv>=Wing.WingMaxLv){return}var config=GlobalConfig.WingLevelConfig[this._wingsData.lv];var count=UserBag.ins().getBagGoodsCountById(0,this.danItemID);if(this._wingsData.lv>=Wing.WingMaxLv){this.boostBtn1.visible=false;this.boostPrice1.visible=false;this.bigUpLevelBtn.visible=false}else{this.boostBtn1.visible=true;this.boostPrice1.visible=true;this.bigUpLevelBtn.visible=count>0;var itemData=UserBag.ins().getBagItemById(config.itemId);if(itemData){if(itemData.count<config.itemNum&&this.checkBoxs.selected){this.boostPrice1.setType(MoneyConst.yuanbao);this.boostPrice1.setPrice(config.itemPrice*config.itemNum,Actor.yb)}else{this.boostPrice1.setType(MoneyConst.wing);this.boostPrice1.setPrice(config.itemNum,itemData.count)}}else{if(this.checkBoxs.selected){this.boostPrice1.setType(MoneyConst.yuanbao);this.boostPrice1.setPrice(config.itemPrice*config.itemNum,Actor.yb)}else{this.boostPrice1.setType(MoneyConst.wing);this.boostPrice1.setPrice(config.itemNum,0)}}}this.redPoint.visible=this.bigUpLevelBtn.visible&&this._wingsData.lv==Wing.WingExpRedPoint};WingPanel.prototype.showOpenMovie=function(){var _this=this;StageUtils.ins().setTouchChildren(false);DisplayUtils.removeFromParent(this.reliveEff);this.openStatusBtn.visible=false;if(!this.flyUpEffect){this.flyUpEffect=new MovieClip1;var p_1=this.flyUpEffect.localToGlobal();p_1.x=265;p_1.y=400;this.flyUpEffect.globalToLocal(p_1.x,p_1.y,p_1);this.flyUpEffect.x=p_1.x;this.flyUpEffect.y=p_1.y}this.wingeff.addChild(this.flyUpEffect);this.flyUpEffect.playFile(RES_DIR_EFF+"functionopeneff",-1);var masksp=new egret.Sprite;var square=new egret.Shape;square.graphics.beginFill(16777215);square.graphics.drawRect(0,0,640,640);square.graphics.endFill();masksp.anchorOffsetX=0;masksp.anchorOffsetY=0;var p=masksp.localToGlobal();p.x=0;p.y=640;masksp.globalToLocal(p.x,p.y,p);masksp.x=p.x;masksp.y=p.y;masksp.addChild(square);this.wingeff.addChild(masksp);this.flyUpEffect.mask=masksp;var tween0=egret.Tween.get(masksp);tween0.to({y:0},1500).call(function(){egret.Tween.removeTweens(_this.flyUpEffect);_this.flyUpEffect.visible=false;_this.wingeff.removeChild(masksp);_this.wingeff.removeChild(_this.flyUpEffect);_this.flowReckEffect()})};WingPanel.prototype.flowReckEffect=function(){var _this=this;if(!this.openEffect){this.openEffect=new MovieClip}this.openEffectGroup.addChild(this.openEffect);this.openEffect.playFile(RES_DIR_EFF+"wingstart",1);TimerManager.ins().doTimer(500,1,function(){_this.shan.visible=true;_this.openEffect.scaleX+=1;_this.openEffect.scaleY+=1;var tween0=egret.Tween.get(_this.openEffect,{loop:false,onChange:function(){var tween1=egret.Tween.get(_this.dor1);var tween2=egret.Tween.get(_this.dor2);var tween3=egret.Tween.get(_this.shan);tween1.to({x:-263},500);tween2.to({x:526+263},500).call(function(){Wing.ins().sendActivate(_this.curRole)},_this);_this.wing.visible=false;tween3.to({alpha:0},500);DisplayUtils.removeFromParent(_this.openEffect)}})},this)};WingPanel.prototype.updateRedPoint=function(){if(this._wingsData.openStatus){this.redPoint0.visible=GodWingRedPoint.ins().getGodWingRedPoint()}else{this.redPoint0.visible=false}};return WingPanel}(BaseView);__reflect(WingPanel.prototype,"WingPanel");var ZhuzaiEquipAdvancePanel=function(_super){__extends(ZhuzaiEquipAdvancePanel,_super);function ZhuzaiEquipAdvancePanel(){return _super.call(this)||this}ZhuzaiEquipAdvancePanel.prototype.childrenCreated=function(){};ZhuzaiEquipAdvancePanel.prototype.initUI=function(){this.tab=[];for(var i=0;i<4;i++)this.tab.push(this["tab"+i]);this.link.textFlow=(new egret.HtmlTextParser).parser(i18n("ZhuzaiEquipAdvancePanel_0"));this.totalPower=BitmapNumber.ins().createNumPic(0,"1");this.totalPower.x=185;this.totalPower.y=128;this.addChild(this.totalPower);this.tab[0].selected=true;this.selectIndex=0;this.inited=true};ZhuzaiEquipAdvancePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!this.inited)this.initUI();this.roleSelectPanel.getCurRole=param&&param.length?param[0]:0;this.setEquipPoint();this.setSelect(param&&param.length?param[1]:0);this.addTouchEvent(this.link,this.onClick);this.addTouchEvent(this.upgradeBtn0,this.onClick);this.addChangeEvent(this.roleSelectPanel,this.onChange);for(var i=0;this.tab&&i<this.tab.length;i++){this.addTouchEvent(this.tab[i],this.onClick)}this.observe(ZhuzaiEquip.ins().postZhuZaiData,this.update)};ZhuzaiEquipAdvancePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.link,this.onClick);this.removeTouchEvent(this.upgradeBtn0,this.onClick);this.roleSelectPanel.removeEventListener(egret.Event.CHANGE,this.onChange,this);for(var i=0;this.tab&&i<this.tab.length;i++){this.removeTouchEvent(this.tab[i],this.onClick)}this.removeObserve()};ZhuzaiEquipAdvancePanel.prototype.update=function(){this.setEquipPoint();this.setData()};ZhuzaiEquipAdvancePanel.prototype.onChange=function(e){this.parent.parent.selectRole=this.roleSelectPanel.getCurRole();this.update()};ZhuzaiEquipAdvancePanel.prototype.setData=function(){var index=this.selectIndex+1;var roleIndex=this.roleSelectPanel.getCurRole();var role=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole());var zhuzaiData=role.getZhuZaiDataByIndex(this.selectIndex);var lv=zhuzaiData.lv;if(lv==0){this.currentState="not";this.totalPower.visible=false;return}this.totalPower.visible=true;var config=GlobalConfig.EquipPointGrowUpConfig[index][lv];var nextConfig=GlobalConfig.EquipPointGrowUpConfig[index][lv+GlobalConfig.EquipPointConstConfig.rankGrowUp];this.curAtt.text=AttributeData.getAttStr(config.attrs,1);if(nextConfig)this.nextAtt.text=AttributeData.getAttStr(nextConfig.attrs,1);var role1=SubRoles.ins().getSubRoleByIndex(roleIndex);var zhuzaiData1=role1.getZhuZaiDataByIndex(this.selectIndex);var rank=zhuzaiData1.rank;var rankConfig=GlobalConfig.EquipPointRankConfig[index][rank];this.currentState=rankConfig?"normal":"max";if(rankConfig){var itemID=rankConfig.rankUpItem.id;var count=UserBag.ins().getBagGoodsCountById(0,itemID);this.useTxt0.text=count+" / "+rankConfig.rankUpItem.count;this.useTxt0.textColor=count<rankConfig.rankUpItem.count?15937822:3066402;this.countTxt0.text=i18n("ZhuzaiEquipAdvancePanel_1")+GlobalConfig.ItemConfig[itemID].name+"：";this.useTxt1.text=rankConfig.rankUpProbability/100+"%"}BitmapNumber.ins().changeNum(this.totalPower,UserBag.getAttrPower(config.attrs),"1")};ZhuzaiEquipAdvancePanel.prototype.setEquipPoint=function(){var config=GlobalConfig.EquipPointBasicConfig;var i=0;for(i=0;i<this.tab.length;i++){var role=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole());var zhuzaiData=role.getZhuZaiDataByIndex(i);this.tab[i].icon="zzequip_"+(i+1)+GlobalConfig.EquipPointGrowUpConfig[i+1][zhuzaiData.lv].rank;if(zhuzaiData.growupID){this.tab[i].label=config[i+1].name;this.tab[i]["lvTxt"].text="+"+zhuzaiData.growupID}else{this.tab[i].label=(config[i+1].activationLevel/1e3>>0)+i18n("ZhuzaiEquipAdvancePanel_2");this.tab[i]["lvTxt"].text=""}this.tab[i]["redPoint"].visible=zhuzaiData.canAdvance()}var len=SubRoles.ins().subRolesLen;for(i=0;i<len;i++){this.roleSelectPanel.showRedPoint(i,ZhuzaiEquip.ins().canAdvance(i))}};ZhuzaiEquipAdvancePanel.prototype.setSelect=function(v){for(var i=0;i<this.tab.length;i++){if(i!=v)this.tab[i].selected=false}this.tab[v].selected=true;this.selectIndex=v;this.parent.parent.select=v;this.setData()};ZhuzaiEquipAdvancePanel.prototype.onClick=function(e){var index=this.tab.indexOf(e.currentTarget);if(index>=0){this.setSelect(index);return}var role=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole());var zhuzaiData=role.getZhuZaiDataByIndex(this.selectIndex);var lv=zhuzaiData.rank;var config=GlobalConfig.EquipPointRankConfig[this.selectIndex+1][lv];var itemID=config.rankUpItem.id;switch(e.currentTarget){case this.link:UserWarn.ins().setBuyGoodsWarn(itemID,config.rankUpItem.count);break;case this.upgradeBtn0:if(UserBag.ins().getBagGoodsCountById(0,itemID)<config.rankUpItem.count){UserTips.ins().showTips(i18n("ZhuzaiEquipAdvancePanel_3"));return}ZhuzaiEquip.ins().sendShengjie(this.roleSelectPanel.getCurRole(),this.selectIndex+1);break}};return ZhuzaiEquipAdvancePanel}(BaseComponent);__reflect(ZhuzaiEquipAdvancePanel.prototype,"ZhuzaiEquipAdvancePanel");var ZhuZaiEquipGrowPanel=function(_super){__extends(ZhuZaiEquipGrowPanel,_super);function ZhuZaiEquipGrowPanel(){return _super.call(this)||this}ZhuZaiEquipGrowPanel.prototype.childrenCreated=function(){};ZhuZaiEquipGrowPanel.prototype.initUI=function(){this.tab=[];for(var i=0;i<4;i++)this.tab.push(this["tab"+i]);this.link.textFlow=(new egret.HtmlTextParser).parser(i18n("ZhuZaiEquipGrowPanel_0"));this.totalPower=BitmapNumber.ins().createNumPic(0,"1");this.totalPower.x=185;this.totalPower.y=128;this.addChild(this.totalPower);this.tab[0].selected=true;this.selectIndex=0;this.star=new StarList(5,0);this.star.x=150;this.star.y=290;this.addChild(this.star);this.inited=true};ZhuZaiEquipGrowPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!this.inited)this.initUI();this.roleSelectPanel.getCurRole=param&&param.length?param[0]:0;this.setEquipPoint();this.setSelect(param&&param.length?param[1]:0);this.addTouchEvent(this.link,this.onClick);this.addTouchEvent(this.upgradeBtn0,this.onClick);this.addChangeEvent(this.roleSelectPanel,this.onChange);for(var i=0;i<this.tab.length;i++){this.addTouchEvent(this.tab[i],this.onClick)}this.observe(ZhuzaiEquip.ins().postZhuZaiData,this.update)};ZhuZaiEquipGrowPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.link,this.onClick);this.removeTouchEvent(this.upgradeBtn0,this.onClick);this.roleSelectPanel.removeEventListener(egret.Event.CHANGE,this.onChange,this);for(var i=0;this.tab&&i<this.tab.length;i++){this.removeTouchEvent(this.tab[i],this.onClick)}this.removeObserve()};ZhuZaiEquipGrowPanel.prototype.update=function(){this.setEquipPoint();this.setData()};ZhuZaiEquipGrowPanel.prototype.onChange=function(e){this.parent.parent.selectRole=this.roleSelectPanel.getCurRole();this.update()};ZhuZaiEquipGrowPanel.prototype.setData=function(){var index=this.selectIndex+1;var roleIndex=this.roleSelectPanel.getCurRole();var role=SubRoles.ins().getSubRoleByIndex(roleIndex);var data=role.getZhuZaiDataByIndex(this.selectIndex);var lv=data.lv;var config=GlobalConfig.EquipPointGrowUpConfig[index][lv];var nextConfig=GlobalConfig.EquipPointGrowUpConfig[index][lv+1];var needLv=config.needLevel;this.useTxt.text=(needLv/1e3>>0)+i18n("ZhuZaiEquipGrowPanel_1");var l=UserZs.ins().lv*1e3+Actor.level;this.useTxt.textColor=l<needLv?15937822:3066402;this.currentState=data.isMaxLevel()?"max":"normal";this.curAtt.text=AttributeData.getAttStr(config.attrs,1);if(nextConfig)this.nextAtt.text=AttributeData.getAttStr(nextConfig.attrs,1);var itemID=config.growUpItem.id;var count=UserBag.ins().getBagGoodsCountById(0,itemID);this.useTxt0.text=count+" / "+config.growUpItem.count;this.useTxt0.textColor=count<config.growUpItem.count?15937822:3066402;this.countTxt0.text=i18n("ZhuZaiEquipGrowPanel_2")+GlobalConfig.ItemConfig[itemID].name+"：";this.useTxt1.text=config.growUpProbability/100+"%";this.star.setStarNum(config.star);this.upgradeBtn0.label=config.growUpItem.count?lv?i18n("ZhuZaiEquipGrowPanel_3"):i18n("ZhuZaiEquipGrowPanel_4"):i18n("ZhuZaiEquipGrowPanel_5");BitmapNumber.ins().changeNum(this.totalPower,UserBag.getAttrPower(config.attrs),"1")};ZhuZaiEquipGrowPanel.prototype.setEquipPoint=function(){var config=GlobalConfig.EquipPointBasicConfig;var i=0;for(i=0;i<this.tab.length;i++){var role=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole());var zhuzaiData=role.getZhuZaiDataByIndex(i);this.tab[i].icon="zzequip_"+(i+1)+GlobalConfig.EquipPointGrowUpConfig[i+1][zhuzaiData.lv].rank;if(zhuzaiData.growupID){this.tab[i].label=config[i+1].name;this.tab[i]["lvTxt"].text="+"+zhuzaiData.growupID}else{this.tab[i].label=(config[i+1].activationLevel/1e3>>0)+i18n("ZhuZaiEquipGrowPanel_6");this.tab[i]["lvTxt"].text=""}this.tab[i]["redPoint"].visible=zhuzaiData.canLevelup()}var len=SubRoles.ins().subRolesLen;for(i=0;i<len;i++){this.roleSelectPanel.showRedPoint(i,ZhuzaiEquip.ins().canLevelup(i))}};ZhuZaiEquipGrowPanel.prototype.setSelect=function(v){for(var i=0;i<this.tab.length;i++){if(i!=v)this.tab[i].selected=false}this.tab[v].selected=true;this.selectIndex=v;this.parent.parent.select=v;this.setData()};ZhuZaiEquipGrowPanel.prototype.onClick=function(e){var index=this.tab.indexOf(e.currentTarget);if(index>=0){this.setSelect(index);return}var role=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole());var zhuzaiData=role.getZhuZaiDataByIndex(this.selectIndex);var lv=zhuzaiData.lv;var config=GlobalConfig.EquipPointGrowUpConfig[this.selectIndex+1][lv];var itemID=config.growUpItem.id;switch(e.currentTarget){case this.link:UserWarn.ins().setBuyGoodsWarn(itemID,config.growUpItem.count);break;case this.upgradeBtn0:var needZs=config.needLevel/1e3>>0;var needLv=config.needLevel%1e3;if(needZs&&UserZs.ins().lv<needZs||Actor.level<needLv){UserTips.ins().showTips(i18n("ZhuZaiEquipGrowPanel_7"));return}if(UserBag.ins().getBagGoodsCountById(0,itemID)<config.growUpItem.count){UserTips.ins().showTips(i18n("ZhuZaiEquipGrowPanel_8"));return}ZhuzaiEquip.ins().sendGrow(this.roleSelectPanel.getCurRole(),this.selectIndex+1);break}};return ZhuZaiEquipGrowPanel}(BaseComponent);__reflect(ZhuZaiEquipGrowPanel.prototype,"ZhuZaiEquipGrowPanel");var ZhuZaiFenjiePanel=function(_super){__extends(ZhuZaiFenjiePanel,_super);function ZhuZaiFenjiePanel(){return _super.call(this)||this}ZhuZaiFenjiePanel.prototype.childrenCreated=function(){};ZhuZaiFenjiePanel.prototype.initUI=function(){this.list.dataProvider=new eui.ArrayCollection([]);this.useTxt0.text="";this.countTxt.text="";this.inited=true};ZhuZaiFenjiePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!this.inited)this.initUI();this.startSetBagData();this.addTouchEvent(this.btn,this.onTap);this.observe(UserBag.ins().postItemDel,this.startSetBagData)};ZhuZaiFenjiePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.btn,this.onTap);this.removeObserve()};ZhuZaiFenjiePanel.prototype.startSetBagData=function(){TimerManager.ins().doTimer(100,1,this.setBagData,this)};ZhuZaiFenjiePanel.prototype.setBagData=function(){var result=[];var config=GlobalConfig.EquipPointResolveConfig;var item;var sum=0;var i;for(i in config){item=UserBag.ins().getBagItemById(config[i].itemId);if(item){result.push(item);sum+=item.count*config[i].materials[0].count}}this.countTxt.text=i18n("ZhuZaiFenjiePanel_0")+GlobalConfig.ItemConfig[config[i].materials[0].id].name+"：";this.useTxt0.text=sum+"";this.list.dataProvider=new eui.ArrayCollection(result)};ZhuZaiFenjiePanel.prototype.onTap=function(){ZhuzaiEquip.ins().sendFenjie()};return ZhuZaiFenjiePanel}(BaseComponent);__reflect(ZhuZaiFenjiePanel.prototype,"ZhuZaiFenjiePanel");var ZsPanel=function(_super){__extends(ZsPanel,_super);function ZsPanel(){var _this=_super.call(this)||this;_this.lastZsLevel=-1;return _this}ZsPanel.prototype.childrenCreated=function(){this.init()};ZsPanel.prototype.init=function(){this.link.textFlow=(new egret.HtmlTextParser).parser(i18n("ZsPanel_0"));this.eff=new MovieClip;this.eff.x=420;this.eff.y=100;this.eff.touchEnabled=false;this.eff.scaleX=.6;this.eff.scaleY=.5;this.upLevelEff=new MovieClip;this.upLevelEff.x=284;this.upLevelEff.y=314;this.upLevelEff.scaleX=this.upLevelEff.scaleY=2;this.upLevelEff.touchEnabled=false;this.maxGroup.touchEnabled=false;this.bgMc=new MovieClip;this.bgMc.x=0;this.bgMc.y=0;this.bgMc.touchEnabled=false;this.bgMcGroup.addChild(this.bgMc);this.bgMc.playFile(RES_DIR_EFF+"zs0",-1)};ZsPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addEvents();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.zs)};ZsPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEvent();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};ZsPanel.prototype.addEvents=function(){this.addTouchEvent(this.getBtn,this.onTap);this.addTouchEvent(this.link,this.onTap);this.observe(UserZs.ins().postZsData,this.setData);this.observe(Actor.ins().postLevelChange,this.setData);this.observe(EscortMgr.ins().postStatus,this.setData);this.observe(EscortMgr.ins().postStartEscort,this.setData);this.observe(EscortMgr.ins().postEndTimeReached,this.setData);this.observe(EscortMgr.ins().postBuyEscort,this.setData)};ZsPanel.prototype.removeEvent=function(){this.removeTouchEvent(this.getBtn,this.onTap);this.removeTouchEvent(this.link,this.onTap);DisplayUtils.removeFromParent(this.eff);DisplayUtils.removeFromParent(this.upLevelEff);this.removeObserve()};ZsPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.getBtn:var ins=UserZs.ins();var config=GlobalConfig.ZhuanShengLevelConfig[ins.lv+1];if(ins.exp<config.exp){UserTips.ins().showTips(i18n("ZsPanel_1"));return}UserZs.ins().sendZsUpgrade();break;case this.link:ViewManager.ins().open(GainZsWin);break}};ZsPanel.prototype.setData=function(){this.curAtt.lineSpacing=5;this.nextAtt.lineSpacing=5;var ins=UserZs.ins();this.redPoint.visible=ins.canUpgrade();this.curZsLv.text=i18n("ZsPanel_2",ins.lv);this.haveTxt.text=ins.exp+"";var config=GlobalConfig.ZhuanShengLevelConfig[ins.lv];this.curAtt.text=AttributeData.getAttStr(config,1);var objAtts=[];for(var k in AttributeData.translate){if(isNaN(config[k]))continue;var a=new AttributeData;a.type=parseInt(AttributeData.translate[k]);a.value=config[k];objAtts.push(a)}var len=SubRoles.ins().subRolesLen;this._totalPower=UserBag.getAttrPower(objAtts)*len;this.powerPanel.setPower(this._totalPower);var nextAttConfig=GlobalConfig.ZhuanShengLevelConfig[ins.lv+1];if(nextAttConfig){this.nextAtt.text=AttributeData.getAttStr(nextAttConfig,1);this.useTxt.text=nextAttConfig.exp+"";this.maxGroup.visible=false;this.normalGroup.visible=true}else{var currAttConfig=GlobalConfig.ZhuanShengLevelConfig[ins.lv];this.group.visible=false;this.curAtt.horizontalCenter=0;this.maxTxt.visible=true;this.arrowImg.visible=false;this.nextAtt.visible=false;this.normalGroup.visible=false;this.maxGroup.visible=true;var count=0;var maxCount=4;for(var i=0;i<objAtts.length;i++){if(i>=4)break;this["attr"+i].text=AttributeData.getAttStr(objAtts[i],.5)}}if(this.lastZsLevel!=-1&&this.lastZsLevel!=ins.lv){if(!this.upLevelEff.parent)this.mainGroup.addChild(this.upLevelEff);this.upLevelEff.playFile(RES_DIR_EFF+"zhuanshengeff",1)}else{DisplayUtils.removeFromParent(this.upLevelEff)}this.lastZsLevel=ins.lv;if(ins.canGet()&&nextAttConfig){if(!this.eff.parent)this.group.addChild(this.eff);this.eff.playFile(RES_DIR_EFF+"chargeff1",-1)}else DisplayUtils.removeFromParent(this.eff)};return ZsPanel}(BaseView);__reflect(ZsPanel.prototype,"ZsPanel");var HotspotBitmap=function(_super){__extends(HotspotBitmap,_super);function HotspotBitmap(){var _this=_super.call(this)||this;_this._hotspot=[];_this.touchEnabled=true;_this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,_this.onTouch,_this);return _this}HotspotBitmap.prototype.addHotspotArea=function(rect,callBack,thisObj,para){this._hotspot.push({rect:rect,callBack:callBack,thisObj:thisObj,para:para})};HotspotBitmap.prototype.onTouch=function(e){var x=e.localX;var y=e.localY;var tempObj;for(var i=0;i<this._hotspot.length;i++){tempObj=this._hotspot[i];if(tempObj.rect.contains(x,y)){if(tempObj.para)tempObj.callBack.call(tempObj.thisObj,tempObj.para);else tempObj.callBack.call(tempObj.thisObj)}}};return HotspotBitmap}(egret.Bitmap);__reflect(HotspotBitmap.prototype,"HotspotBitmap");var ThemeAdapter=function(){function ThemeAdapter(){}ThemeAdapter.prototype.getTheme=function(url,onSuccess,onError,thisObject){var _this=this;function onResGet(e){onSuccess.call(thisObject,e)}function onResError(e){if(e.resItem.url==url){RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,onResError,null);onError.call(thisObject)}}if(typeof generateEUI!=="undefined"){egret.callLater(function(){onSuccess.call(thisObject,generateEUI)},this)}else if(typeof generateEUI2!=="undefined"){RES.getResByUrl("resource/gameEui.json",function(data,url){window["JSONParseClass"]["setData"](data);egret.callLater(function(){onSuccess.call(thisObject,generateEUI2)},_this)},this,RES.ResourceItem.TYPE_JSON)}else if(typeof generateJSON!=="undefined"){if(url.indexOf(".exml")>-1){var dataPath=url.split("/");dataPath.pop();var dirPath=dataPath.join("/")+"_EUI.json";if(!generateJSON.paths[url]){RES.getResByUrl(dirPath,function(data){window["JSONParseClass"]["setData"](data);egret.callLater(function(){onSuccess.call(thisObject,generateJSON.paths[url])},_this)},this,RES.ResourceItem.TYPE_JSON)}else{egret.callLater(function(){onSuccess.call(thisObject,generateJSON.paths[url])},this)}}else{egret.callLater(function(){onSuccess.call(thisObject,generateJSON)},this)}}else{RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,onResError,null);RES.getResByUrl(url,onResGet,this,RES.ResourceItem.TYPE_TEXT)}};return ThemeAdapter}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var CharEncounter=function(_super){__extends(CharEncounter,_super);function CharEncounter(){var _this=_super.call(this)||this;_this.lastRunTime=0;_this.atkTime=-1500;_this.atkCount=0;_this.posCount=0;_this.touchEnabled=false;_this._role=new CharRole;_this._role.touchEnabled=true;_this._monster=new CharMonster;_this._monster.x=_this.x+30;_this._monster.y=_this.y+30;_this._role.x=_this.x;_this._role.y=_this.y;return _this}CharEncounter.prototype.autoAtk=function(){var _this=this;this.atkTime=egret.getTimer();this._role.stopMove();this.atkCount++;this._monster.dir=DirUtil.get8DirBy2Point(this._monster,this._role);this._role.AI_STATE=AI_State.Atk;var currTime=egret.getTimer();var inSleep=currTime-this.lastRunTime>2e3;this.lastRunTime=currTime;if(inSleep)return;var roleModel=this._role.infoModel;if(roleModel==undefined){Log.trace(i18n("CharEncounter_0"));return}this.skillData=SkillData.getSkillByJob(roleModel.job);if(Math.random()*10>9&&this.atkCount>2){this.killMonster()}else{GameLogic.ins().playSkillEff(this.skillData,this._role,[this._monster]);this._monster.playAction(EntityAction.ATTACK);TimerManager.ins().doTimer(500,1,function(){_this._monster.playAction(EntityAction.STAND)},this)}};CharEncounter.prototype.showPk=function(){this._role.dir=3;this._monster.y=this.y+30;this._monster.x=this.x+30;this.x=this._role.x;this.y=this._role.y;this._role.stopMove();TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1500,0,this.waitAtk,this)};CharEncounter.prototype.waitAtk=function(){var _this=this;var roleModel=this._role.infoModel;if(roleModel==undefined){Log.trace(i18n("CharEncounter_1"));return}GameLogic.ins().playSkillEff(this.skillData,this._role,[this._monster]);this._monster.playAction(EntityAction.ATTACK);TimerManager.ins().doTimer(500,1,function(){_this._monster.playAction(EntityAction.STAND)},this)};CharEncounter.prototype.runToNewMonster=function(){if(this._role&&this._role.infoModel){this._monster.visible=true;this._role.infoModel.setAtt(AttributeType.atMoveSpeed,3e3);GameMap.moveEntity(this._role,this._monster.x,this._monster.y);this._role.AI_STATE=AI_State.Run}};CharEncounter.prototype.killMonster=function(){if(!this._monster)return;this._role.AI_STATE=AI_State.Stand;this.posCount++;this._monster.visible=false;var len=UserFb.ins().encounterPos.length;var ran=Math.floor(Math.random()*len);var index=UserFb.ins().encounterPos.splice(ran,1);this.atkCount=0;UserFb.ins().encounterPos.push(this.posIndex);this.posIndex=index[0];var point=UserFb.ins().zyPos[index[0]];this._monster.x=point.x*GameMap.CELL_SIZE;this._monster.y=point.y*GameMap.CELL_SIZE;this._monster.playAction(EntityAction.STAND);this.atkTime=-1500};CharEncounter.prototype.reach=function(){var dis=MathUtils.getDistance(this._monster.x,this._monster.y,this._role.x,this._role.y);return dis<100};CharEncounter.prototype.AI=function(){switch(this._role.AI_STATE){case AI_State.Atk:if(egret.getTimer()-this.atkTime>1500)this.autoAtk();break;case AI_State.Stand:this.runToNewMonster();break;case AI_State.Run:if(this.reach())this.autoAtk();else this.runToNewMonster();break}};CharEncounter.prototype.onTap=function(e){if(EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval){UserTips.ins().showTips(i18n("CharEncounter_2"));return}};CharEncounter.prototype.reset=function(){GameLogic.ins().addEntity(this._monster);GameLogic.ins().addEntity(this._role);this.atkCount=0;this._role.AI_STATE=AI_State.Stand;this._role.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTap,this);TimerManager.ins().doTimer(100,0,this.AI,this)};CharEncounter.prototype.destruct=function(){this._role.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTap,this);this._role.playAction(EntityAction.STAND);this._monster.playAction(EntityAction.STAND);TimerManager.ins().removeAll(this);DisplayUtils.removeFromParent(this);DisplayUtils.removeFromParent(this._role);DisplayUtils.removeFromParent(this._monster);UserFb.ins().encounterPos.push(this.posIndex);ObjectPool.push(this)};CharEncounter.prototype.setData=function(model){this.infoModel=model;if(UserFb.ins().guanqiaID>-1){}this._role.infoModel=model.subRole[0];this._role.playAction(EntityAction.STAND);this._role.updateBlood(true);this._role.showBlood(true);this._role.updateNeiGong();this._role.updateModel();this._role.setCharName(this.infoModel.name)};CharEncounter.prototype.setPosition=function(x,y){this.x=this._role.x=x;this.y=this._role.y=y;this._monster.x=this.x+30;this._monster.y=this.y+30};return CharEncounter}(egret.DisplayObjectContainer);__reflect(CharEncounter.prototype,"CharEncounter",["IChar"]);var MovieClip1=function(_super){__extends(MovieClip1,_super);function MovieClip1(){var _this=_super.call(this)||this;_this.movieClip=null;_this.shapeFileMask=null;_this.movieClip=new MovieClip;_this.addChild(_this.movieClip);if(window["isIOS_AppStore"]==true){var _This_1=_this;_This_1["movieClip_Width"]=0;_This_1["movieClip_Height"]=0;_This_1["aboutMaskUpdate"]=function(){if(_This_1.mask!=null&&_This_1.stage!=null){var shape=_This_1.shapeFileMask;if(shape){if(_This_1["movieClip_Width"]+2<_This_1.movieClip.width||_This_1["movieClip_Height"]+2<_This_1.movieClip.height){_This_1["movieClip_Width"]=_This_1.movieClip.width+2;_This_1["movieClip_Height"]=_This_1.movieClip.height+2;shape.graphics.clear();shape.graphics.beginFill(16777215,1);shape.graphics.drawRect(0,0,_This_1.movieClip.width,_This_1.movieClip.height);shape.anchorOffsetX=_This_1.movieClip.width/2;shape.anchorOffsetY=_This_1.movieClip.height/2;shape.graphics.endFill()}}}else{_This_1["delMaskListener"]()}};_This_1["isMask_Listenering"]=false;_This_1["addMaskListener"]=function(){if(_This_1["isMask_Listenering"]==false){_This_1.addEventListener(egret.Event.ENTER_FRAME,_This_1["aboutMaskUpdate"],_This_1);_This_1["isMask_Listenering"]=true;if(_This_1.shapeFileMask==null){_This_1.shapeFileMask=new egret.Shape;_This_1.shapeFileMask.alpha=0;_This_1.addChild(_This_1.shapeFileMask);_This_1.addChild(_This_1.movieClip);_This_1["movieClip_Width"]=0;_This_1["movieClip_Height"]=0}}};_This_1["delMaskListener"]=function(){if(_This_1["isMask_Listenering"]==true){_This_1.removeEventListener(egret.Event.ENTER_FRAME,_This_1["aboutMaskUpdate"],_This_1);_This_1["isMask_Listenering"]=false;if(_This_1.shapeFileMask!=null){_This_1.removeChild(_This_1.shapeFileMask);_This_1.shapeFileMask=null}}};_This_1["delMaskListener_last"]=function(){if(_This_1["isMask_Listenering"]==true){_This_1.removeEventListener(egret.Event.ENTER_FRAME,_This_1["aboutMaskUpdate"],_This_1);_This_1["isMask_Listenering"]=false;if(_This_1.shapeFileMask!=null){_This_1.removeChild(_This_1.shapeFileMask);_This_1.shapeFileMask=null}}};_This_1["movieClip_old_mask_set"]=_This_1["__lookupSetter__"]("mask");_This_1["movieClip_old_mask_get"]=_This_1["__lookupGetter__"]("mask");Object.defineProperty(_This_1,"mask",{get:function(){return this["movieClip_old_mask_get"]()},set:function(value){if(value==null){_This_1["delMaskListener"]()}else{_This_1["addMaskListener"]()}this["movieClip_old_mask_set"](value)}});_This_1["movieClip_old_last_set"]=_This_1["__lookupSetter__"]("lastmask");_This_1["movieClip_old_last_get"]=_This_1["__lookupGetter__"]("lastmask");Object.defineProperty(_This_1,"lastmask",{get:function(){return this["movieClip_old_mask_get"]()},set:function(value){if(value==null){_This_1["delMaskListener"]()}else{_This_1["addMaskListener"]()}this["movieClip_old_mask_set"](value)}});_This_1.addEventListener(egret.Event.ADDED_TO_STAGE,function(){_This_1["addMaskListener"]()},_This_1);_This_1.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){_This_1["delMaskListener"]()},_This_1)}return _this}MovieClip1.prototype.playFile=function(name,playCount,compFun,remove,loadedFun){if(playCount===void 0){playCount=1}if(compFun===void 0){compFun=null}if(remove===void 0){remove=true}if(loadedFun===void 0){loadedFun=null}this.movieClip.playFile(name,playCount,compFun,remove,loadedFun)};MovieClip1.prototype.gotoAndPlay=function(frame,playTimes){this.movieClip.gotoAndPlay(frame,playTimes)};MovieClip1.prototype.stop=function(){this.movieClip.stop()};MovieClip1.prototype.destroy=function(){this.movieClip.destroy()};Object.defineProperty(MovieClip1.prototype,"currentFrame",{get:function(){return this.movieClip.currentFrame},enumerable:true,configurable:true});Object.defineProperty(MovieClip1.prototype,"isPlaying",{get:function(){return this.movieClip.isPlaying},enumerable:true,configurable:true});Object.defineProperty(MovieClip1.prototype,"rate",{get:function(){return this.movieClip.rate},set:function(value){this.movieClip.rate=value},enumerable:true,configurable:true});Object.defineProperty(MovieClip1.prototype,"offsetPoint",{get:function(){return this.movieClip["offsetPoint"]},set:function(offsetPoint){this.movieClip["offsetPoint"]=offsetPoint},enumerable:true,configurable:true});MovieClip1.prototype.playFileRes=function(name,resName,playCount,compFun,remove){if(playCount===void 0){playCount=1}if(compFun===void 0){compFun=null}if(remove===void 0){remove=true}this.movieClip.playFileRes(name,resName,playCount,compFun,remove)};MovieClip1.prototype.dispose=function(){this.movieClip.dispose()};MovieClip1.prototype.play=function(playTimes){this.movieClip.play(playTimes)};MovieClip1.prototype.gotoAndStop=function(frame){this.movieClip.gotoAndStop(frame)};MovieClip1.prototype.clearComFun=function(){this.movieClip.clearComFun()};Object.defineProperty(MovieClip1.prototype,"$texture",{get:function(){return this.movieClip.$texture},set:function(t){this.movieClip.$texture=t},enumerable:true,configurable:true});Object.defineProperty(MovieClip1,"displayList",{get:function(){return MovieClip.displayList},enumerable:true,configurable:true});return MovieClip1}(eui.Component);__reflect(MovieClip1.prototype,"MovieClip1");var CharItem=function(_super){__extends(CharItem,_super);function CharItem(){var _this=_super.call(this)||this;_this.touchEnabled=false;_this.touchChildren=false;_this._itemImg=new eui.Image;_this._itemImg.x=-56*.6>>1;_this._itemImg.y=-56*.6>>1;_this._itemImg.scaleX=_this._itemImg.scaleY=.6;_this.addChild(_this._itemImg);_this._roatImg=new eui.Image("point3");_this._roatImg.anchorOffsetX=5;_this._roatImg.anchorOffsetY=5;_this._roatImg.alpha=0;_this.addChild(_this._roatImg);_this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){_this.removeRoatEffect()},_this);return _this}CharItem.prototype.setData=function(item){if(item.type){this._itemImg.source=GlobalConfig.ItemConfig[item.id].icon+"_png"}else{if(item.id==MoneyConst.gold){this._itemImg.source="icgoods117_png"}else if(item.id==MoneyConst.yuanbao){this._itemImg.source="icgoods121_png"}else if(item.id==MoneyConst.soul){this._itemImg.source="200136_png"}else if(item.id==MoneyConst.rune){this._itemImg.source="500007_png"}}};CharItem.prototype.addRoatEffect=function(){this.removeRoatEffect();var t=egret.Tween.get(this._roatImg,{loop:true});t.to({alpha:1},200).to({rotation:90},1e3).to({alpha:0},200).wait(300)};CharItem.prototype.removeRoatEffect=function(){this._roatImg.alpha=0;this._roatImg.rotation=0;egret.Tween.removeTweens(this._roatImg)};return CharItem}(egret.DisplayObjectContainer);__reflect(CharItem.prototype,"CharItem");var CharItem2=function(_super){__extends(CharItem2,_super);function CharItem2(){var _this=_super.call(this)||this;_this.touchEnabled=false;_this.touchChildren=false;_this.item=new CharItem;_this.itemName=new CharItemName;_this.InitIconMC();return _this}CharItem2.prototype.InitIconMC=function(){this.iconMc=new MovieClip;this.iconMc.scaleX=.7;this.iconMc.scaleY=.7;this.iconMc.alpha=.8;var posY=this.item.y;this.iconMc.y=posY-260};Object.defineProperty(CharItem2.prototype,"infoModel",{get:function(){return this._infoModel},set:function(model){this._infoModel=model},enumerable:true,configurable:true});CharItem2.prototype.setData=function(item){this.id=item.id;this.count=item.count;this.item.setData(item);this.itemName.setData(item);this.itemConfig=GlobalConfig.ItemConfig[item.id];this.itemQuality=ItemConfig.getQuality(this.itemConfig);this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this)};CharItem2.prototype.isRedEquip=function(){if(this.itemQuality==4)return true;else return false};CharItem2.prototype.setItemParent=function(parent){this._itemParent=parent;this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this);this._itemParent.addChild(this)};CharItem2.prototype.addRoatEffect=function(){this.item.addRoatEffect()};CharItem2.prototype.addRedEquipEffect=function(effSoure){if(effSoure===void 0){effSoure="equiplighteff"}this.removeRedEquipEffect();this.iconMc.playFile(RES_DIR_EFF+effSoure,1);this.item.addChild(this.iconMc)};CharItem2.prototype.removeRedEquipEffect=function(){DisplayUtils.removeFromParent(this.iconMc)};CharItem2.prototype.removeRoatEffect=function(){this.item.removeRoatEffect()};CharItem2.prototype.addFloatEffect=function(){egret.Tween.removeTweens(this.item);var t=egret.Tween.get(this.item);var posY=this.item.y;this.item.y-=100;t.to({y:posY},500,egret.Ease.bounceOut)};CharItem2.prototype.onAdd=function(e){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);ResourceMgr.ins().reloadContainer(this.item);if(this._itemParent){this._itemParent.addChild(this.item);this._itemParent.addChild(this.itemName)}else{DropHelp.dropContainer.addChild(this.item);DropHelp.dropNameContainer.addChild(this.itemName)}};CharItem2.prototype.onRemove=function(e){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);if(this.item.parent){this.item.parent.removeChild(this.item)}if(this.itemName.parent){this.itemName.parent.removeChild(this.itemName)}this.removeRoatEffect();this.removeRedEquipEffect()};Object.defineProperty(CharItem2.prototype,"x",{get:function(){return egret.superGetter(CharItem2,this,"x")},set:function(_x){egret.superSetter(CharItem2,this,"x",_x);this.itemName.x=_x;this.item.x=_x},enumerable:true,configurable:true});Object.defineProperty(CharItem2.prototype,"y",{get:function(){return egret.superGetter(CharItem2,this,"y")},set:function(_y){egret.superSetter(CharItem2,this,"y",_y);this.itemName.y=_y;this.item.y=_y},enumerable:true,configurable:true});Object.defineProperty(CharItem2.prototype,"team",{get:function(){return this.infoModel.team},enumerable:true,configurable:true});CharItem2.prototype.reset=function(){this.item.scaleX=1;this.item.scaleY=1;this.itemName.scaleX=1;this.itemName.scaleY=1};CharItem2.prototype.destruct=function(){this.item.scaleX=1;this.item.scaleY=1;this.itemName.scaleX=1;this.itemName.scaleY=1;this._itemParent=null;this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this)};return CharItem2}(egret.DisplayObjectContainer);__reflect(CharItem2.prototype,"CharItem2",["IChar"]);var CharItemName=function(_super){__extends(CharItemName,_super);function CharItemName(){var _this=_super.call(this)||this;_this.touchEnabled=false;_this.touchChildren=false;_this._nameTxt=new eui.Label;_this._nameTxt.stroke=1;_this._nameTxt.strokeColor=0;_this._nameTxt.size=14;_this._nameTxt.y=-25;_this._nameTxt.width=120;_this._nameTxt.x=-60;_this._nameTxt.textAlign=egret.HorizontalAlign.CENTER;_this.addChild(_this._nameTxt);return _this}CharItemName.prototype.setData=function(item){if(item.type){if(item.id==500007){this._nameTxt.text=""+item.count}else{var itemName=GlobalConfig.ItemConfig[item.id].name;if(item.count>1){this._nameTxt.text=item.count+itemName}else{this._nameTxt.text=itemName}}this._nameTxt.textColor=ItemConfig.getQualityColor(GlobalConfig.ItemConfig[item.id]);this._nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(GlobalConfig.ItemConfig[item.id])}else{if(item.id==MoneyConst.gold){this._nameTxt.text=""+item.count;this._nameTxt.textColor=ItemBase.QUALITY_COLOR[0];this._nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[0]}else if(item.id==MoneyConst.yuanbao){this._nameTxt.text=i18n("CharItemName_1");this._nameTxt.textColor=ItemBase.QUALITY_COLOR[5];this._nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[5]}else if(item.id==MoneyConst.soul){this._nameTxt.text=i18n("CharItemName_3",item.count);this._nameTxt.textColor=ItemBase.QUALITY_COLOR[2];this._nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[2]}else if(item.id==MoneyConst.rune){this._nameTxt.text=i18n("CharItemName_4",item.count);this._nameTxt.textColor=ItemBase.QUALITY_COLOR[1];this._nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[1]}}};return CharItemName}(egret.DisplayObjectContainer);__reflect(CharItemName.prototype,"CharItemName");var CharMiner=function(_super){__extends(CharMiner,_super);function CharMiner(){var _this=_super.call(this)||this;_this.npcHead.currentState=_this.npcHead.states[1];return _this}Object.defineProperty(CharMiner.prototype,"infoModel",{get:function(){return this._infoModel},set:function(model){this._infoModel=model},enumerable:true,configurable:true});CharMiner.prototype.updateModel=function(){_super.prototype.updateModel.call(this);var config=GlobalConfig.KuangYuanConfig[this.infoModel.configID];this.npcHead.nameTxt.text=this.infoModel.name+i18n("CharMiner_0");this.npcHead.nameTxt.textColor=config.color;this.updateTime();this.updateTitleState()};CharMiner.prototype.updateTime=function(){var sec=Math.floor((this.infoModel.endTime-GameServer.serverTime)/1e3);if(sec>=0){this.npcHead.timeTxt.text=DateUtils.getFormatBySecond(sec,DateUtils.TIME_FORMAT_3)}else{MineData.ins().remove(this.infoModel.index)}this.playAction(EntityAction.ATTACK,function(){})};CharMiner.prototype.updateTitleState=function(){this.npcHead.updateState(this.infoModel)};CharMiner.prototype.destruct=function(){this.destroy();ObjectPool.push(this)};return CharMiner}(CharNpc);__reflect(CharMiner.prototype,"CharMiner");var CharModel=function(_super){__extends(CharModel,_super);function CharModel(){return _super!==null&&_super.apply(this,arguments)||this}CharModel.prototype.parserItemData=function(bytes){this.itemData=new RewardData;this.itemData.parser(bytes)};return CharModel}(EntityModel);__reflect(CharModel.prototype,"CharModel");var SkillEffNewPlayer=function(){function SkillEffNewPlayer(){}Object.defineProperty(SkillEffNewPlayer,"urlSkill",{get:function(){return""+RES_DIR_SKILL},enumerable:true,configurable:true});Object.defineProperty(SkillEffNewPlayer,"urlSkillEff",{get:function(){return""+RES_DIR_SKILLEFF},enumerable:true,configurable:true});SkillEffNewPlayer.updateSkill=function(param,now){switch(param.config.multiType){case 1:return SkillEffNewPlayer.updateSkill1(param,now);case 2:return SkillEffNewPlayer.updateSkill2(param,now);case 3:return SkillEffNewPlayer.updateSkill3(param,now);case 4:return SkillEffNewPlayer.updateSkill4(param,now);case 5:return SkillEffNewPlayer.updateSkill5(param,now)}return false};SkillEffNewPlayer.createMc=function(x,y,rate,rotation,scaleX,scaleY,alpha,anchorOffsetX,anchorOffsetY){if(x===void 0){x=0}if(y===void 0){y=0}if(rate===void 0){rate=1}if(rotation===void 0){rotation=0}if(scaleX===void 0){scaleX=1}if(scaleY===void 0){scaleY=1}if(alpha===void 0){alpha=1}if(anchorOffsetX===void 0){anchorOffsetX=0}if(anchorOffsetY===void 0){anchorOffsetY=0}var mc=ObjectPool.pop("MovieClip");mc.x=x;mc.y=y;mc.rate=rate;mc.rotation=rotation;mc.scaleX=scaleX;mc.scaleY=scaleY;mc.alpha=alpha;mc.anchorOffsetX=anchorOffsetX;mc.anchorOffsetY=anchorOffsetY;return mc};SkillEffNewPlayer.updateSkill1=function(param,now){var _this=this;var ret=true;var config=param.config;var f=(now-(param.t0+config.delay))/config.time;if(f<0){return true}if(f>1){ret=false}var d=1/(config.count-1);var sc=Math.floor(f/d)+1;if(param.count<sc){var dc=sc-param.count;var _loop_11=function(i){var offzetX=0;var offzetY=param.config.offzetY;var ox=0;var oy=0;if(config.regular>0){var angle=2*Math.PI/config.count*(config.count-param.count-i)+Math.PI;var dis=config.radius;offzetX=offzetX+dis*Math.sin(angle);offzetY=offzetY+dis*Math.cos(angle)}else{var angle=Math.random()*2*Math.PI;var dis=Math.pow(Math.random(),.5)*config.radius;offzetX=offzetX+dis*Math.sin(angle);offzetY=offzetY+dis*Math.cos(angle)}if(param.config.castType==3){ox=param.source.x+offzetX;oy=param.source.y+offzetY;var mc_1=this_10.createMc(ox,oy);var fileName=SkillEffPlayer.urlSkillEff+config.effectId;mc_1.playFile(fileName,1,function(){_this.removeMC(mc_1)});var n=param.count+i;if(config.effectIdLayer>=1){if(config.layer[n]&&config.layer[n]>=1){this_10.layerTop.addChild(mc_1)}else{if(offzetY>=0){this_10.layerTop.addChild(mc_1)}else{if(param.source&&param.source.parent){param.source.parent.addChildAt(mc_1,1)}else{SkillEffPlayer.bottomLayer.addChild(mc_1)}}}}else{if(param.source&&param.source.parent){param.source.parent.addChildAt(mc_1,1)}else{SkillEffPlayer.bottomLayer.addChild(mc_1)}}mc_1.rotation=n*param.config.rotation}else{var all=config.all;var c=1;if(all>0){c=param.target.length}var _loop_12=function(){var xx=param.target[j].dieX?param.target[j].dieX:param.target[j].x;var yy=param.target[j].dieY?param.target[j].dieY:param.target[j].y;ox=param.target[j].x+offzetX;oy=param.target[j].y+offzetY;var mc=this_10.createMc(ox,oy);var fileName=SkillEffPlayer.urlSkillEff+config.effectId;mc.playFile(fileName,1,function(){_this.removeMC(mc)});if(config.effectIdLayer>=1){this_10.layerTop.addChild(mc)}else{if(param.target[j]&&param.target[j].parent){param.target[j].parent.addChildAt(mc,1)}else{SkillEffPlayer.bottomLayer.addChild(mc)}}mc.rotation=(param.count+i)*param.config.rotation};for(var j=0;j<c;j++){_loop_12()}}};var this_10=this;for(var i=0;i<dc;i++){_loop_11(i)}if(!param.hitFunCalled&&param.hitFun){param.hitFun(1);param.hitFunCalled=true}param.count=sc}if(!param.eff2Played&&config.effectId2){var mc_2=this.createMc(param.source.x,param.source.y);var fileName=SkillEffPlayer.urlSkillEff+config.effectId2;mc_2.playFile(fileName,1,function(){_this.removeMC(mc_2)});if(config.effectId2Layer>=1){if(param.source&&param.source.parent){param.source.parent.addChildAt(mc_2,1e3)}else{this.layerTop.addChild(mc_2)}}else{if(param.source&&param.source.parent){param.source.parent.addChildAt(mc_2,1)}else{SkillEffPlayer.bottomLayer.addChild(mc_2)}}param.eff2Played=true}var model=param.source.infoModel;var isMy=model.checkHandleIsMy(param.source.infoModel.handle);if(config.shake&&config.shake>0&&(isMy||GameLogic.ins().inSkillPreview)){setTimeout(function(){GameLogic.ins().shakeMapView2();param.shake=true},config.shakeDelay)}return ret};SkillEffNewPlayer.updateSkill2=function(param,now){var _this=this;var ret=true;var config=param.config;if(param.particles==null&&now>=param.t0+config.delay){var p_2=new EffParticle;param.sourceX=param.source.x;param.sourceY=param.source.y;var r=getRotation(param.sourceX,param.sourceY,param.target[0].x,param.target[0].y);var mc=this.createMc(param.sourceX,param.sourceY,1,r);var fileName=SkillEffPlayer.urlSkillEff+config.effectId1;mc.playFile(fileName,-1);this.layerTop.addChild(mc);p_2.t0=now;p_2.mc=mc;param.particles=[p_2];if(!param.eff2Played&&config.effectId4){var mc_3=this.createMc(param.source.x,param.source.y);var fileName_1=SkillEffPlayer.urlSkillEff+config.effectId4;mc_3.playFile(fileName_1,1,function(){_this.removeMC(mc_3)});if(config.effectId4Layer>0){if(param.source&&param.source.parent){param.source.parent.addChildAt(mc_3,1e3)}else{this.layerTop.addChild(mc_3)}}else{if(param.source&&param.source.parent){param.source.parent.addChildAt(mc_3,1)}else{SkillEffPlayer.bottomLayer.addChild(mc_3)}}param.eff2Played=true}}var x1=param.sourceX;var x2=param.target[0].x;var y1=param.sourceY;var y2=param.target[0].y;var dis=Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2));var t=dis/config.speed*1e3;if(t<=0){t=.001}var f=(now-(param.t0+config.delay))/t;if(f<0){return true}if(f>1){ret=false}var hh=dis*config.curveH*(1-Math.pow(2*(f-.5),2));var h1=param.source.myHeight*.5;var h2=param.target[0].myHeight*.5;var h=h1+(h2-h1)*f+hh;var ox=x1+f*(x2-x1);var oy=y1+f*(y2-y1)-h;ox=ox+f*param.tx;oy=oy+f*param.ty;var p=param.particles[0];p.mc.x=ox;p.mc.y=oy;if(ret==false){var p_3=param.particles[0];this.removeMC(p_3.mc);if(config.effectId3!=null&&config.effectId3!=""){var mc_4=this.createMc(ox,oy);var fileName=SkillEffPlayer.urlSkillEff+config.effectId3;mc_4.playFile(fileName,1,function(){_this.removeMC(mc_4)});this.layerTop.addChild(mc_4)}if(!param.hitFunCalled&&param.hitFun){param.hitFun(1);param.hitFunCalled=true}}var count=Math.floor(t/config.interval);var d=1/(count-1);var sc=Math.floor(f/d);if(param.count<sc&&config.effectId2!=null&&config.effectId2!=""){var mc_5=this.createMc(ox,oy);var fileName=SkillEffPlayer.urlSkillEff+config.effectId2;mc_5.playFile(fileName,1,function(){_this.removeMC(mc_5)});this.layerTop.addChild(mc_5);param.count=sc}return ret};SkillEffNewPlayer.updateSkill3=function(param,now){var ret=true;var config=param.config;var f=(now-(param.t0+config.delay))/config.time;if(f<0){return true}if(f>1){ret=false}var d=1/(config.count-1);var sc=Math.floor(f/d)+1;if(param.count<sc){var dc=sc-param.count;for(var i=0;i<dc;i++){var param1=new EffNewParam;param1.source=param.source;param1.target=param.target;param1.hitFun=param.count==1?param.hitFun:null;param1.config=SkillEffNewConfig.copyConfig(param.config);param1.config.multiType=2;param1.t0=egret.getTimer();var angle=Math.random()*2*Math.PI;var dis=Math.pow(Math.random(),.5)*config.radiusTarget;param1.tx=dis*Math.sin(angle);param1.ty=dis*Math.cos(angle);this.playConfig(param1)}param.count=sc}return ret};SkillEffNewPlayer.updateSkill4=function(param,now){var ret=true;var config=param.config;var count=param.count;if(count>=config.count){ret=false;return ret}if(!param.t0){param.t0=now}if(now-param.t0<config.delay){return ret}var castType=config.castType;var target=param.source;if(castType!=3){target=param.target[0]}var dir=target.dir;var radius=config.d*GameMap.CELL_SIZE;var getRotation=function(x,y){var mx=Math.abs(x);var my=Math.abs(y);var angle=Math.atan(mx/my)/Math.PI*180;if(x>0&&y>0){angle=180-angle}if(x<0&&y>0){angle=180+angle}if(x<0&&y<0){angle=360-angle}return angle};var getPos=function(arr){var x=getRandom()*radius;var y=getRandom()*radius;if(x*x+y*y>radius*radius){return getPos(arr)}var rotation=getRotation(x,y);var r1=(-180*config.f/2+360+target.dir*360/8)%360;var r2=(180*config.f/2+target.dir*360/8)%360;if(r1>r2){if(rotation<r1&&rotation>r2){return getPos(arr)}}if(r1<r2){if(rotation<r1||rotation>r2){return getPos(arr)}}for(var _i=0,arr_3=arr;_i<arr_3.length;_i++){var p=arr_3[_i];if((p.x-x)*(p.x-x)+(p.y-y)*(p.y-y)<config.dis*config.dis){return getPos(arr)}}var pos={x:x,y:y};arr.push(pos);return pos};var dirPos=param.config.dirPos;var point=getPos(param.pos4);var ox=target.x+point.x;var oy=target.y+point.y;if(dirPos){ox+=dirPos[dir]&&dirPos[dir].x||0;oy+=dirPos[dir]&&dirPos[dir].y||0}var mc=this.createMc(ox,oy);var fileName=SkillEffPlayer.urlSkillEff+config.effectId;var delay=(point.x*point.x+point.y*point.y)/(radius*radius)*config.time;var self=this;setTimeout(function(){mc.playFile(fileName,1,function(){self.removeMC(mc)});SkillEffPlayer.topLayer.addChildAt(mc,10)},delay);param.count+=1;return ret};SkillEffNewPlayer.updateSkill5=function(param,now){var _this=this;var ret=true;var config=param.config;if(param.sourceX==undefined||param.sourceX==null){param.sourceX=param.source.x;param.sourceY=param.source.y;param.dir=param.source.dir}var x1=param.sourceX;var y1=param.sourceY;var dir=param.dir;var offzet=config.offzet[dir]||0;if(!param.targetPos){param.targetPos=SkillEffNewPlayer.getTarPos(x1,y1,dir,config.f,config.d);param.targetPos2=SkillEffNewPlayer.getTarPos(x1,y1,dir,config.f,config.d,offzet)}var tPos=param.targetPos;var tPos2=param.targetPos2;var x2=tPos.x;var y2=tPos.y;var dis=calc_distance_point_to_point({x:x1,y:y1},tPos);var t=(dis-offzet)/config.speed*1e3;if(t<=0){t=.001}if(param.particles==null&&now>=param.t0+config.delay){var p_4=new EffParticle;var scaleX=1*(config.isDir?DirUtil.isScaleX(dir)?-1:1:1);var mc=this.createMc(param.sourceX,param.sourceY,1,0,scaleX);var fileName=SkillEffPlayer.urlSkillEff+config.effectId+(config.isDir?DirUtil.get5DirBy8Dir(dir):"");mc.playFile(fileName,-1);this.layerTop.addChild(mc);p_4.t0=now;p_4.mc=mc;param.particles=[p_4];var dx1=x2-x1,dy1=y2-y1;var ddis2=dx1*dx1+dy1*dy1;if(ddis2>0){var ddis=Math.sqrt(ddis2);dx1=dx1/ddis;dy1=dy1/ddis}else{dx1=1;dy1=0}var dx21=dy1*GameMap.CELL_SIZE*config.f*.5,dy21=-dx1*GameMap.CELL_SIZE*config.f*.5;var px1=x1+dx21,py1=y1+dy21;var px2=x1-dx21,py2=y1-dy21;var A=new egret.Point(px1,py1);var B=new egret.Point(px2,py2);var targets=param.targets;for(var _i=0,targets_1=targets;_i<targets_1.length;_i++){var v=targets_1[_i];var par=new EffParticle;var mc_6=this.createMc(0,0,1,0);par.t0=now;par.mc=mc_6;mc_6.visible=false;var P=new egret.Point(v.x,v.y);var dis2=calc_distance_point_to_line(A,B,P);par.delay=Math.max(0,(dis2-offzet)/config.speed*1e3);v.addChild(mc_6);param.particles.push(par)}}var f=(now-(param.t0+config.delay))/t;if(f<0){return true}var p=param.particles[0];if(f>1){p.played=true;if(!param.hitFunCalled&&param.hitFun){param.hitFun(1);param.hitFunCalled=true}this.removeMC(p.mc)}else{var ox=x1+f*(tPos2.x-x1);var oy=y1+f*(tPos2.y-y1);ox=ox+f*param.tx;oy=oy+f*param.ty;p.mc.x=ox;p.mc.y=oy}var _loop_13=function(){var p_5=param.particles[i];if(!p_5.played&&now>=p_5.t0+p_5.delay+config.delay){p_5.mc.visible=true;var fileName=SkillEffPlayer.urlSkillEff+config.effectId1;p_5.mc.playFile(fileName,1,function(){_this.removeMC(p_5.mc)});p_5.played=true}};for(var i=1;i<param.particles.length;i++){_loop_13()}var playAll=true;for(var i=0;i<param.particles.length;i++){var p_6=param.particles[i];if(!p_6.played){playAll=false}}ret=!playAll;return ret};SkillEffNewPlayer.getTarPos=function(sourceX,sourceY,dir,f,d,offzet){if(offzet===void 0){offzet=0}var tx,ty;var dis=MathUtils.getDistance(0,0,f*GameMap.CELL_SIZE,d*GameMap.CELL_SIZE);var ox=(dis-offzet)*Math.cos(45/180*Math.PI);var oy=(dis-offzet)*Math.sin(45/180*Math.PI);switch(dir){case 0:tx=sourceX;ty=sourceY-d*GameMap.CELL_SIZE+offzet;break;case 1:tx=sourceX+ox;ty=sourceY-oy;break;case 2:tx=sourceX+d*GameMap.CELL_SIZE-offzet;ty=sourceY;break;case 3:tx=sourceX+ox;ty=sourceY+oy;break;case 4:tx=sourceX;ty=sourceY+d*GameMap.CELL_SIZE-offzet;break;case 5:tx=sourceX-ox;ty=sourceY+oy;break;case 6:tx=sourceX-d*GameMap.CELL_SIZE+offzet;ty=sourceY;break;case 7:tx=sourceX-ox;ty=sourceY-oy;break}return{x:tx,y:ty}};SkillEffNewPlayer.playConfig=function(param){var now=egret.getTimer();SkillEffNewPlayer.skills.push(param);SkillEffNewPlayer.updateSkill(param,now);if(!this.enterFrameReg){this.layerTop.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this);this.enterFrameReg=true}};SkillEffNewPlayer.onEnterFrame=function(){var skillPlayed=[];var now=egret.getTimer();for(var i=0;i<this.skills.length;i++){var skill=this.skills[i];var ret=this.updateSkill(skill,now);if(!ret){skillPlayed.push(i)}}for(var i=skillPlayed.length-1;i>=0;i--){var idx=skillPlayed[i];this.skills.splice(idx,1)}if(this.skills.length<1){this.layerTop.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this);this.enterFrameReg=false}};SkillEffNewPlayer.playCoinAni=function(target){if(!target||!target.parent){return}var pt=target.parent.localToGlobal(target.x,target.y);MainAniMgr.ins().playExplode(RES_DIR_EFF+"yuanbaofly_eff",60,pt.x,pt.y,.7)};SkillEffNewPlayer.play=function(skillId,source,target,hitFun,targets){var _this=this;if(target===void 0){target=[]}if(hitFun===void 0){hitFun=null}if(targets===void 0){targets=[]}if(!SysSetting.ins().getBool(SysSetting.SHOW_SKILL_EFF)){if(hitFun){TimerManager.ins().doTimer(500,1,hitFun.bind(null,1),this)}return}var url=""+this.urlRoot+this.urlSkill+skillId+".json";RES.getResByUrl(url,function(config){if(!config){console.log(i18n("SkillEffNewPlayer_0",skillId));return}config=SkillEffNewConfig.initValue(config);var param=new EffNewParam;param.source=source;param.target=target;param.hitFun=hitFun;param.config=config;param.targets=targets;param.t0=egret.getTimer();_this.playConfig(param)},this,RES.ResourceItem.TYPE_JSON)};SkillEffNewPlayer.removeMC=function(mc){mc.destroy()};SkillEffNewPlayer.urlRoot="";SkillEffNewPlayer.skills=[];SkillEffNewPlayer.effParticles=[];SkillEffNewPlayer.enterFrameReg=false;return SkillEffNewPlayer}();__reflect(SkillEffNewPlayer.prototype,"SkillEffNewPlayer");var EffParticle=function(){function EffParticle(){this.delay=0;this.played=false}return EffParticle}();__reflect(EffParticle.prototype,"EffParticle");var EffNewParam=function(){function EffNewParam(){this.count=0;this.tx=0;this.ty=0;this.hitFunCalled=false;this.eff2Played=false;this.shake=false;this.pos4=[]}return EffNewParam}();__reflect(EffNewParam.prototype,"EffNewParam");var SkillEffNewConfig=function(){function SkillEffNewConfig(){this.multiType=0;this.castType=2;this.all=0;this.effectId="";this.effectIdLayer=1;this.layer=[];this.effectId1="";this.effectId2="";this.effectId2Layer=0;this.effectId3="";this.effectId4="";this.effectId4Layer=0;this.radius=290;this.count=1;this.time=2e3;this.delay=400;this.offzetY=0;this.speed=500;this.interval=50;this.curveH=.5;this.radiusTarget=0;this.rotation=0;this.shake=0;this.shakeDelay=0;this.regular=0;this.f=.5;this.d=4;this.dis=90;this.isDir=0;this.offzet=[]}SkillEffNewConfig.initValue=function(config){config["__proto__"]=this.o;return config};SkillEffNewConfig.copyConfig=function(config){var res=new SkillEffNewConfig;for(var k in config){res[k]=config[k]}return res};SkillEffNewConfig.o=new SkillEffNewConfig;return SkillEffNewConfig}();__reflect(SkillEffNewConfig.prototype,"SkillEffNewConfig");var SkillEffPlayer=function(){function SkillEffPlayer(){}Object.defineProperty(SkillEffPlayer,"urlSkill",{get:function(){return""+RES_DIR_SKILL},enumerable:true,configurable:true});Object.defineProperty(SkillEffPlayer,"urlSkillEff",{get:function(){return""+RES_DIR_SKILLEFF},enumerable:true,configurable:true});SkillEffPlayer.playConfigs=function(configs,param,source){var _this=this;if(!this.setTimeout){console.warn(i18n("SkillEffPlayer_0"));return}var hit=false;var _loop_14=function(i){var config=configs[i];config=SkillEffConfig.initValue(config);this_11.setTimeout(config.delay/param.rate,function(){if(config.type>50){var typeFun_1=_this["type"+config.type];if(typeFun_1){typeFun_1.call(_this,param,config)}return}var model=source.infoModel;var isMy=model.checkHandleIsMy(source.infoModel.handle);if(config.shake&&config.shake>0&&(isMy||GameLogic.ins().inSkillPreview)){setTimeout(function(){GameLogic.ins().shakeMapView2()},config.shakeDelay)}var layer=config.layer;var mc;mc=ObjectPool.pop("MovieClip");mc.rate=config.playSpeed*(config.isRate?param.rate:1);var fileName=SkillEffPlayer.urlSkillEff+config.effectId+(config.isDir?DirUtil.get5DirBy8Dir(param.initParam.dir):"");var s=fileName+param.append;mc.playFile(s,config.playCount,function(){_this.removeMC(mc)});mc.x=config.x;mc.y=config.y;if(param.offset){mc.x+=param.offset.x;mc.y+=param.offset.y}if(typeof config.rotation=="string"){var str=config.rotation+"";var rots=str.split("|");var rotMin=+rots[0];var rotMax=+rots[1]-+rots[0];mc.rotation=Math.random()*rotMax+rotMin}else{mc.rotation=config.rotation}mc.scaleX=config.scaleX*(config.isDir?DirUtil.isScaleX(param.initParam.dir)?-1:1:1);mc.scaleY=config.scaleY;if(param.scale){mc.scaleX*=param.scale;mc.scaleY*=param.scale}mc.alpha=config.alpha;mc.anchorOffsetX=config.cx;mc.anchorOffsetY=config.cy;if(config.dirPos.length&&config.dirPos[param.initParam.dir]){var dirPos=config.dirPos[param.initParam.dir];if(!isNaN(dirPos.x))mc.x+=dirPos.x;if(!isNaN(dirPos.y))mc.y+=dirPos.y;if(!isNaN(dirPos.layer))layer=dirPos.layer;if(!isNaN(dirPos.rotation))mc.rotation+=dirPos.rotation;if(!isNaN(dirPos.scaleX))mc.scaleX=dirPos.scaleX;if(!isNaN(dirPos.scaleY))mc.scaleY=dirPos.scaleY;if(!isNaN(dirPos.cx))mc.anchorOffsetX=dirPos.cx;if(!isNaN(dirPos.cy))mc.anchorOffsetY=dirPos.cy}if(config.isRot&&param.target){var targetXY=config.isInit?{x:param.initParam.tar[0].x,y:param.initParam.tar[0].y}:param.target[0];var angle=MathUtils.getAngle(MathUtils.getRadian2(param.source.x,param.source.y,targetXY.x,targetXY.y));mc.rotation=angle+mc.rotation}param.mc=mc;var layerFun=_this["layer"+layer];if(layerFun){layerFun.call(_this,param)}var typeFun=_this["type"+config.type];if(typeFun){typeFun.call(_this,param,config)}if(config.tween.length>0&&mc){var tw=egret.Tween.get(mc);for(var j=0;j<config.tween.length;j+=2){var to=config.tween[j];tw.to(to,config.tween[j+1].time)}}},this_11)};var this_11=this;for(var i=0;i<configs.length;i++){_loop_14(i)}};SkillEffPlayer.play=function(skillId,source,target,hitFun,rate,offset,append,scale,targets){var _this=this;if(target===void 0){target=[]}if(hitFun===void 0){hitFun=null}if(rate===void 0){rate=1}if(offset===void 0){offset=null}if(append===void 0){append=""}if(scale===void 0){scale=undefined}if(targets===void 0){targets=[]}if(!SysSetting.ins().getBool(SysSetting.SHOW_SKILL_EFF)){if(hitFun){TimerManager.ins().doTimer(500,1,hitFun.bind(null,1),this)}return}var url=""+this.urlRoot+this.urlSkill+skillId+".json";RES.getResByUrl(url,function(configs){if(!configs){console.log(i18n("SkillEffPlayer_1",skillId));return}if(!isArray(configs)){if(configs.sourceId&&configs.sourceId!=""){SkillEffPlayer.play(configs.sourceId,source,target,hitFun,1,null,"",undefined,targets)}if(configs.targetId&&configs.targetId!=""){SkillEffPlayer.play(configs.targetId,source,target,hitFun,1,null,"",undefined,targets)}if(!configs.sourceId&&!configs.targetId){SkillEffNewPlayer.play(skillId,source,target,hitFun,targets)}return}var param=new EffParam;param.initParam={dir:source.dir,x:source.x,y:source.y,tar:[]};for(var i=0;target&&i<target.length;i++){if(!target[i]){if(hitFun){TimerManager.ins().doTimer(500,1,hitFun.bind(null,1),_this)}console.log("SkillEffPlayer.ts target["+i+"] == null; skillId = "+skillId);return}param.initParam.tar.push({dir:target[i].dir,x:target[i].x,y:target[i].y})}param.source=source;param.target=target;param.hitFun=hitFun;param.rate=rate;param.offset=offset;param.append=append;param.scale=scale;param.targets=targets;_this.playConfigs(configs,param,source);HejiMoreEffPlayer.ins().checkForPlayMore(configs,source,target,rate)},this,RES.ResourceItem.TYPE_JSON)};SkillEffPlayer.type1=function(param,config){var _this=this;var target=param.target;var source=param.source;var mc=param.mc;var hitFun=param.hitFun;var targetXY=config.isInit?{x:param.initParam.tar[0].x,y:param.initParam.tar[0].y}:target[0];var jl=config.dis||MathUtils.getDistanceByObject(source,targetXY);if(config.sDis)jl+=config.sDis;var angle=MathUtils.getAngle(MathUtils.getRadian2(source.x,source.y,targetXY.x,targetXY.y))+config.range;if(config.sDis){var p2=MathUtils.getDirMove(angle,config.sDis);if(mc){mc.x+=p2.x;mc.y+=p2.y}}if(mc){var p1=MathUtils.getDirMove(angle,jl,mc.x,mc.y);var t=egret.Tween.get(mc);t.to({x:p1.x,y:p1.y},jl/config.moveSpeed*1e3).call(function(){_this.removeMC(mc);if(config.hit&&hitFun)hitFun(config.probability);if(config.exEff)_this.play(config.exEff,source,target,hitFun,1,null,param.append,undefined,param.targets)})}else{if(config.hit&&hitFun)hitFun(config.probability)}};SkillEffPlayer.removeMC=function(mc){if(mc){mc.destroy()}};SkillEffPlayer.type96=function(param,config){if(!this.shake){console.warn(i18n("SkillEffPlayer_2"));return}var source=param.source;this.shake(source,config.range,config.time,config.playCount,config.probability)};SkillEffPlayer.type97=function(param,config){var target=param.target;var source=param.source;if(GameMap.fbType!=0)return;target[0].stopMove();var isMainRole=target[0]==EntityManager.ins().getNoDieRole();var jl=config.dis||MathUtils.getDistanceByObject(source,target[0]);var angle=MathUtils.getAngle(MathUtils.getRadian2(source.x,source.y,target[0].x,target[0].y));var p=MathUtils.getDirMove(angle,jl,target[0].x,target[0].y);var data=BresenhamLine.isAbleToThrough(GameMap.point2Grip(target[0].x),GameMap.point2Grip(target[0].y),GameMap.point2Grip(p.x),GameMap.point2Grip(p.y));if(data[0]==0){if(GameMap.point2Grip(target[0].x)==data[2]&&GameMap.point2Grip(target[0].y)==data[3]){p.x=target[0].x;p.y=target[0].y}else{p.x=GameMap.grip2Point(data[2]);p.y=GameMap.grip2Point(data[3])}}p.x=Math.max(Math.min(p.x,GameMap.MAX_WIDTH),0);p.y=Math.max(Math.min(p.y,GameMap.MAX_HEIGHT),0);jl=MathUtils.getDistanceByObject(target[0],p);if(jl<=0)return;var t=egret.Tween.get(target[0].moveTweenObj);t.to({x:p.x,y:p.y},jl/config.moveSpeed*1e3)};SkillEffPlayer.type98=function(param,config){var target=param.target;var source=param.source;if(GameMap.fbType!=0)return;source.stopMove();var isMainRole=source==EntityManager.ins().getNoDieRole();var jl=config.dis||MathUtils.getDistanceByObject(source,target[0]);var angle=MathUtils.getAngle(MathUtils.getRadian2(source.x,source.y,target[0].x,target[0].y));var p=MathUtils.getDirMove(angle,jl,target[0].x,target[0].y);var data=BresenhamLine.isAbleToThrough(GameMap.point2Grip(target[0].x),GameMap.point2Grip(target[0].y),GameMap.point2Grip(p.x),GameMap.point2Grip(p.y));if(data[0]==0){if(GameMap.point2Grip(target[0].x)==data[2]&&GameMap.point2Grip(target[0].y)==data[3]){p.x=target[0].x;p.y=target[0].y}else{p.x=GameMap.grip2Point(data[2]);p.y=GameMap.grip2Point(data[3])}}p.x=Math.max(Math.min(p.x,GameMap.MAX_WIDTH),0);p.y=Math.max(Math.min(p.y,GameMap.MAX_HEIGHT),0);jl=MathUtils.getDistanceByObject(target[0],p);if(jl<=0)return;p=MathUtils.getDirMove(angle,jl,source.x,source.y);var t=egret.Tween.get(source.moveTweenObj);t.to({x:p.x,y:p.y},jl/config.moveSpeed*1e3)};SkillEffPlayer.type99=function(param,config){var hitFun=param.hitFun;if(hitFun)hitFun(config.probability)};SkillEffPlayer.layer0=function(param){var source=param.source;var mc=param.mc;if(mc){mc.x+=source.x;mc.y+=source.y;if(!this.bottomLayer){console.warn(i18n("SkillEffPlayer_3"));return}this.bottomLayer.addChild(mc)}};SkillEffPlayer.layer1=function(param){var source=param.source;var mc=param.mc;if(mc){source.addChildAt(mc,0)}};SkillEffPlayer.layer2=function(param){var source=param.source;var mc=param.mc;if(mc){source.addChild(mc)}};SkillEffPlayer.layer3=function(param){var source=param.source;var mc=param.mc;if(mc){mc.x+=source.x;mc.y+=source.y;if(!this.topLayer){console.warn(i18n("SkillEffPlayer_4"));return}this.topLayer.addChild(mc)}};SkillEffPlayer.layer4=function(param){var target=param.target;var mc=param.mc;if(mc){mc.x+=target[0].x;mc.y+=target[0].y;if(!this.bottomLayer){console.warn(i18n("SkillEffPlayer_5"));return}this.bottomLayer.addChild(mc)}};SkillEffPlayer.layer5=function(param){var target=param.target;var mc=param.mc;if(mc){target[0].addChildAt(mc,0)}};SkillEffPlayer.layer6=function(param){var target=param.target;var mc=param.mc;if(mc){target[0].addChild(mc)}};SkillEffPlayer.layer7=function(param){var target=param.target;var mc=param.mc;if(mc){mc.x+=target[0].x;mc.y+=target[0].y;if(!this.topLayer){console.warn(i18n("SkillEffPlayer_6"));return}this.topLayer.addChild(mc)}};SkillEffPlayer.layer8=function(param){if(!this.fixedLayer){console.warn(i18n("SkillEffPlayer_7"));return}if(param.mc){this.fixedLayer.addChild(param.mc)}};SkillEffPlayer.layer9=function(param){var source=param.source;var mc=param.mc;if(mc){mc.x+=source.x;mc.y+=source.y;if(!this.topLayer){console.warn(i18n("SkillEffPlayer_4"));return}this.topLayer.addChildAt(mc,20)}};SkillEffPlayer.urlRoot="";return SkillEffPlayer}();__reflect(SkillEffPlayer.prototype,"SkillEffPlayer");var EffParam=function(){function EffParam(){this.append="";this.rate=1;this.targets=[]}return EffParam}();__reflect(EffParam.prototype,"EffParam");var SkillEffConfig=function(){function SkillEffConfig(){this.type=0;this.delay=0;this.layer=3;this.x=0;this.y=0;this.effectId=0;this.playSpeed=1;this.scaleX=1;this.scaleY=1;this.rotation=0;this.isDir=0;this.moveSpeed=100;this.playCount=1;this.dis=0;this.sDis=0;this.alpha=1;this.isRot=0;this.hit=0;this.cx=0;this.cy=0;this.range=0;this.time=0;this.isRate=0;this.isInit=0;this.probability=1;this.exEff="";this.dirPos=[];this.tween=[];this.shake=0;this.shakeDelay=0}SkillEffConfig.initValue=function(config){config["__proto__"]=this.o;return config};SkillEffConfig.o=new SkillEffConfig;return SkillEffConfig}();__reflect(SkillEffConfig.prototype,"SkillEffConfig");var CharRole=function(_super){__extends(CharRole,_super);function CharRole(){var _this=_super.call(this)||this;_this.ringMc=[];_this.zhanLingAttack=false;_this.touchEnabled=false;_this.touchChildren=false;_this.AI_STATE=AI_State.Stand;LoadingTimeoutMgr.ins().endStep(LoadingTimeoutMgr.STEPID_CREATE_ROLES);_this.neigongBar=new eui.ProgressBar;_this.neigongBar.skinName="bloodyelskin";_this.neigongBar.anchorOffsetY=-5;_this.neigongBar.labelDisplay.visible=false;_this.neigongBar.labelFunction=function(){return""};_this.titleContainer.addChild(_this.neigongBar);_this.neigongBar.anchorOffsetX=Math.floor(_this.neigongBar.width>>1);_this._nameTxt.textColor=16777215;_this._nameGroup.visible=true;_this._lilianTitle=new eui.Image;_this._lilianTitle.scaleX=.5;_this._lilianTitle.scaleY=.5;_this._lilianTitle.bottom=-1;_this._nameGroup.addChild(_this._lilianTitle);return _this}CharRole.prototype.createTweenObj=function(){var self=this;this.dieTweenObj={set alpha(al){self.alpha=al},get alpha(){return self.alpha}};this.moveTweenObj={set x(x){self.x=x>>0;self.moveCamera()},set y(y){self.y=y>>0;self.moveCamera()},get x(){return self.x},get y(){return self.y}}};CharRole.prototype.setWeaponFileName=function(name){this.addMc(CharMcOrder.WEAPON,RES_DIR_WEAPON+name)};CharRole.prototype.setWingFileName=function(name){this.addMc(CharMcOrder.WING,RES_DIR_WING+name)};CharRole.prototype.setHeirloomFileName=function(name){this.addMc(CharMcOrder.HEIR,RES_DIR_EFF+name)};CharRole.prototype.setSoulFileName=function(name){this.addMc(CharMcOrder.SOUL,RES_DIR_WEAPON+name)};CharRole.prototype.setXianYuEffct=function(data,name,i,isMy){var p=this.addMc(CharMcOrder.XIANYU,"");var eff=new XianYuEffecWin(data,name,i,isMy);if(p instanceof eui.Group){p.removeChildren();eff.x=-eff.width/2;eff.y=-eff.height/2;p.addChild(eff)}};CharRole.prototype.loadOther=function(mcType){if(this.action==EntityAction.DIE){if(mcType!=CharMcOrder.BODY&&mcType!=CharMcOrder.WEAPON){var mc=this.getMc(mcType);if(mc)mc.visible=false;return}}else{var mc=this.getMc(mcType);if(mc)mc.visible=true}if(mcType==CharMcOrder.ZHANLING&&(this.zhanLingAttack||this._state==EntityAction.ATTACK))return;_super.prototype.loadOther.call(this,mcType)};CharRole.prototype.playBody=function(e){_super.prototype.playBody.call(this,e);if(this.ringMc&&this.ringMc.length>0){this.updateRingMC()}};CharRole.prototype.getResDir=function(mcType){if(mcType==CharMcOrder.ZHANLING)return 3;var td=2*(this._dir-4);if(td<0)td=0;return this._dir-td};CharRole.prototype.updateBlood=function(force){var _this=this;if(force===void 0){force=false}_super.prototype.updateBlood.call(this,force);if(this._hpBar.value<=0){this.onDead(function(){_this.deadDelay()})}};CharRole.prototype.updateModel=function(){_super.prototype.updateModel.call(this)};CharRole.prototype.parseModel=function(){var model=this.infoModel;this.setBarColor();this.setCharName(model.guildAndName);this.setLilian(model.lilianUrl);this.updateBlood(true);this.updateNeiGong();var id=model.getEquipByIndex(0).item.configID;var hideWeapons=model.hideWeapons();if(model.zhuangbei[1]>0){var fileName=GlobalConfig.ZhuangBanId[model.zhuangbei[1]].res;this.setWeaponFileName(fileName+"_"+model.sex)}else if(id>0){if(GlobalConfig.EquipConfig[id]){var fileName=GlobalConfig.EquipConfig[id].appearance;this.setWeaponFileName(fileName+"_"+model.sex)}}if(model.zhuangbei[2]>0){var fileName=GlobalConfig.ZhuangBanId[model.zhuangbei[2]].res;this.setWingFileName(fileName)}else if(model.wingsData.openStatus){if(GlobalConfig.WingLevelConfig[model.wingsData.lv])this.setWingFileName(GlobalConfig.WingLevelConfig[model.wingsData.lv].appearance)}if(model.heirloom){var suitConfig=model.heirloom.getSuitConfig(model);if(suitConfig&&suitConfig.weff){this.setHeirloomFileName(suitConfig.weff)}}if(!hideWeapons&&model.weapons&&model.weapons.weaponsId>0){var fileName=GlobalConfig.WeaponSoulConfig[model.weapons.weaponsId].outside[model.job-1];this.setSoulFileName(fileName)}id=model.equipsData[2].item.configID;if(model.zhuangbei[0]>0){var fileName=GlobalConfig.ZhuangBanId[model.zhuangbei[0]].res;this.initBody(RES_DIR_BODY+fileName)}else if(id>0){if(GlobalConfig.EquipConfig[id]){var fileName=GlobalConfig.EquipConfig[id].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",model.job+"")}if(fileName.indexOf("903")>0){fileName=fileName+"_"+model.sex}else{}this.initBody(RES_DIR_BODY+fileName)}}else{this.initBody(RES_DIR_BODY+getDefaultBody(model.job))}this.updateTitle();if(this.getIsShowBody()&&model.isMy&&SubRoles.ins().isFirstJob(model.job))this.setAdvanceTitle();else this.removeAdvanceTitle()};CharRole.prototype.setAdvanceTitle=function(){var model=this.infoModel;this.removeAdvanceTitle();if(SubRoles.ins().isFirstJob(model.job)){for(var i in GlobalConfig.AdvanceTitleBaseconfig){var config=GlobalConfig.AdvanceTitleBaseconfig[i];if(config.openLevel){if(Actor.level>=config.openLevel&&Actor.level<config.endLevel){this.addAdvanceTitle(config)}}else{if(config.openCheck&&config.endCheck){if(UserFb.ins().guanqiaID>config.openCheck&&UserFb.ins().guanqiaID<=config.endCheck){this.addAdvanceTitle(config)}}else{if(UserFb.ins().guanqiaID>config.openCheck&&config.endLevel&&Actor.level<config.endLevel){this.addAdvanceTitle(config)}}}}}};CharRole.prototype.addAdvanceTitle=function(config){if(this._titleMc==null&&this._title==null){if(this.advanceTitle==null){this.advanceTitle=new eui.Image;this.titleContainer.addChild(this.advanceTitle)}this.advanceTitle.anchorOffsetX=175;this.advanceTitle.anchorOffsetY=150}else{if(this.advanceTitle==null){this.advanceTitle=new eui.Image;this.titleContainer.addChild(this.advanceTitle)}this.advanceTitle.anchorOffsetX=175;this.advanceTitle.anchorOffsetY=230}this.advanceTitle.source=config.source};CharRole.prototype.removeAdvanceTitle=function(){if(this.advanceTitle)this.advanceTitle.source=""};CharRole.prototype.setHeirloomSuitEff=function(){var model=this.infoModel;if(model==undefined){return}if(model.heirloom){var suitConfig=model.heirloom.getSuitConfig(model);if(suitConfig&&suitConfig.weff){this.setHeirloomFileName(suitConfig.weff)}}};CharRole.prototype.addBuff=function(buff){if(buff.effConfig&&buff.effConfig.group==25001&&this.hasBuff(25001)){return}_super.prototype.addBuff.call(this,buff);var config=buff.effConfig;if(!config)return;if(GameMap.fubenID==0){switch(config.type){case SkillEffType.Summon:var m=void 0;if(this.team==Team.My){var tempData=Artifact.ins().getReviseBySkill(35001);var gwSkills=GodWeaponCC.ins().getReviseBySkill(35001);var gwSkill=void 0;if(gwSkills)gwSkill=gwSkills[0];var monsterId=config.args.a;if(tempData&&tempData.args&&tempData.args[0]){monsterId+=tempData.args[0].vals[2]}if(gwSkill&&gwSkill.args&&gwSkill.args[0]){monsterId+=gwSkill.args[0].vals[2]}if(buff.effConfig.group==25001){var list=RoleAI.ins().getAIList();for(var id in list){var monster=list[id];var im=monster.infoModel;if(im.team==Team.My&&im.configID==monsterId){return}}}m=UserFb.createModel(GlobalConfig.MonstersConfig[monsterId]);m.x=this.x;m.y=this.y;m.masterHandle=this.infoModel.handle;m.setAtt(AttributeType.atMoveSpeed,this.infoModel.getAtt(AttributeType.atMoveSpeed));var attValue=0;var baseValue=m.getAtt(AttributeType.atAttack);if(tempData&&tempData.args&&tempData.args[0]){var times=tempData.args[0].vals[3]?tempData.args[0].vals[3]:1;attValue+=this.infoModel.getAtt(AttributeType.atAttack)*times}if(gwSkill&&gwSkill.args&&gwSkill.args[0]){var times=gwSkill.args[0].vals[3]?gwSkill.args[0].vals[3]:1;attValue+=this.infoModel.getAtt(AttributeType.atAttack)*times}m.setAtt(AttributeType.atAttack,(attValue>>0)+baseValue)}else{m=UserFb.createModel(GlobalConfig.MonstersConfig[config.args.a]);m.x=this.x;m.y=this.y;m.masterHandle=this.infoModel.handle;m.setAtt(AttributeType.atMoveSpeed,this.infoModel.getAtt(AttributeType.atMoveSpeed))}m.isMy=m.checkHandleIsMy(m.masterHandle);GameLogic.ins().createEntityByModel(m,this.team);break}}};CharRole.prototype.updateNeiGong=function(){if(!this.infoModel)return;var maxValue=this.infoModel.getAtt(AttributeType.maxNeiGong);this.neigongBar.visible=this.checkNeigongVisible();this.neigongBar.maximum=maxValue;this.neigongBar.value=this.infoModel.getAtt(AttributeType.cruNeiGong);if(this.neigongBar.visible){this.showName(this.neigongBar.visible);this.showBlood(this.neigongBar.visible)}};CharRole.prototype.checkNeigongVisible=function(){var maxValue=this.infoModel.getAtt(AttributeType.maxNeiGong);return maxValue!=0&&this._state!=EntityAction.DIE};CharRole.prototype.updateTitle=function(){var model=this.infoModel;var title=model.title;this.removeTitle();if(this.getIsShowBody()&&title>0){var config=GlobalConfig.TitleConf[title];if(config){if(config.img){if(this._title==null){this._title=new eui.Image;this._title.anchorOffsetX=230>>1;this._title.anchorOffsetY=100;this.titleContainer.addChild(this._title)}this._title.source=config.img}else if(config.eff){if(this._titleMc==null){this._titleMc=ObjectPool.pop("MovieClip");this._titleMc.anchorOffsetX=0;this._titleMc.anchorOffsetY=80;this.titleContainer.addChild(this._titleMc)}var eff=RES_DIR_EFF+config.eff;this.playFile(this._titleMc,eff)}}}if(this.getIsShowBody()&&model.isMy)this.setAdvanceTitle()};CharRole.prototype.updateRingMC=function(){for(var i in this.ringMc){if(this.ringMc[i]){if(this.ringMc[i].parent==null){this.addChild(this.ringMc[i])}this.ringMc[i].setEffectXY(this.dir)}}};CharRole.prototype.setCharName=function(str){_super.prototype.setCharName.call(this,str);this._lilianTitle.x=(this._nameGroup.width>>1)+(this._nameTxt.width>>1)-6;this._nameGroup.visible=true};CharRole.prototype.setLilian=function(url){this._lilianTitle.source=url};Object.defineProperty(CharRole.prototype,"infoModel",{get:function(){return this._infoModel},set:function(model){if(model){this._infoModel=model;this.checkShapeShifting()}else{Log.trace(i18n("CharRole_1"))}},enumerable:true,configurable:true});CharRole.prototype.autoAddBlood=function(){if(this.action==EntityAction.DIE){egret.clearTimeout(this.timeID);return}if(this.getRealHp()<this.infoModel.getAtt(AttributeType.atMaxHp)){var value=-this.infoModel.getAtt(AttributeType.atRegeneration);this.hram(value);var curHp=this.infoModel.getAtt(AttributeType.atHp)-value;var maxHp=this.infoModel.getAtt(AttributeType.atMaxHp);this.infoModel.setAtt(AttributeType.atHp,curHp>maxHp?maxHp:curHp);GameLogic.ins().postEntityHpChange(this,null,DamageTypes.HIT,value)}TimerManager.ins().doTimer(1e3,1,this.autoAddBlood,this)};CharRole.prototype.showNeigong=function(b){this.neigongBar.visible=b&&this.checkNeigongVisible()};CharRole.prototype.showZhanling=function(id,lv){var config=GlobalConfig.ZhanLingLevel[0][lv];if(!config.talentLevel)return;config=GlobalConfig.ZhanLingLevel[id][lv];if(Assert(config,i18n("CharRole_2",id,lv)))return;var fileName=config.appearance;this.addMc(CharMcOrder.ZHANLING,RES_DIR_MONSTER+fileName);var mc=this.getMc(CharMcOrder.ZHANLING);var anchorOffset=GlobalConfig.ZhanLingConfig.anchorOffset||[];mc.anchorOffsetX=anchorOffset[0]||0;mc.anchorOffsetY=anchorOffset[1]||0;TimerManager.ins().remove(this.playZhanLingAttack,this);TimerManager.ins().doTimer(200,1,this.playZhanLingAttack,this);TimerManager.ins().remove(this.hideZhanling,this);TimerManager.ins().doTimer(3e3,1,this.hideZhanling,this)};CharRole.prototype.playZhanLingAttack=function(){var _this=this;var mcType=CharMcOrder.ZHANLING;var mc=this.getMc(mcType);if(mc){mc.scaleX=this.getScaleX(this._dir);var s=this.getFileName(mcType)+"_"+this.getResDir(mcType)+EntityAction.ATTACK;this.zhanLingAttack=true;mc.playFile(s,1,function(){_this.zhanLingAttack=false;var src=_this.getFileName(mcType)+"_"+_this.getResDir(mcType)+EntityAction.STAND;mc.playFile(src,-1,null,false)},false)}};CharRole.prototype.hideZhanling=function(){var _this=this;var mc=this.getMc(CharMcOrder.ZHANLING);if(mc){egret.Tween.get(mc).to({alpha:0},GlobalConfig.ZhanLingConfig.disappearTime||1500).call(function(){_this.removeMc(CharMcOrder.ZHANLING)})}};CharRole.prototype.reset=function(){_super.prototype.reset.call(this);this.zhanLingAttack=false;this.AI_STATE=AI_State.Stand};CharRole.prototype.destruct=function(){_super.prototype.destruct.call(this);this.AI_STATE=AI_State.Stand;this._hpBar.visible=this._nameGroup.visible=true;this._nameTxt.textColor=16777215;for(var i in this.ringMc){if(this.ringMc[i]){this.ringMc[i].reset();this.ringMc[i]=null;delete this.ringMc[i]}}};CharRole.prototype.deadDelay=function(){this._hpBar.slideDuration=0;this._hpBar.value=0;this.neigongBar.slideDuration=0;this.neigongBar.value=this.neigongBar.maximum;this.stopMove();this.removeHardStraight();this.removeAllBuff();this.hideZhanling();this.neigongBar.visible=false;if(this._title)this._title.source="";this._hpBar.visible=this._nameGroup.visible=false;this.atking=false;TimerManager.ins().removeAll(this)};Object.defineProperty(CharRole.prototype,"nameVisible",{get:function(){return this._nameGroup.visible},enumerable:true,configurable:true});CharRole.prototype.showNameAndHp=function(){this._hpBar.visible=this._nameGroup.visible=true};CharRole.prototype.showBodyContainer=function(){if(this.isShowBody)return;_super.prototype.showBodyContainer.call(this);this.neigongBar.alpha=1};CharRole.prototype.hideBodyContainer=function(){if(!this.isShowBody)return;_super.prototype.hideBodyContainer.call(this);this.neigongBar.alpha=0};CharRole.prototype.moveCamera=function(){if(this==EntityManager.ins().getNoDieRole()){GameLogic.ins().postMoveCamera();var sefety="sefety";var xy={x:GameMap.point2Grip(this.x),y:GameMap.point2Grip(this.y)};if(!this[sefety]&&GameMap.checkSafety(xy)){UserTips.ins().showCenterTips(i18n("CharRole_4"));this[sefety]=true}else if(this[sefety]&&!GameMap.checkSafety(xy)){UserTips.ins().showCenterTips(i18n("CharRole_5"));this[sefety]=false}}};CharRole.prototype.isSafety=function(){var xy={x:GameMap.point2Grip(this.x),y:GameMap.point2Grip(this.y)};return GameMap.checkSafety(xy)};CharRole.prototype.onDead=function(callBack){this.stopMove();this.playAction(EntityAction.DIE,callBack)};CharRole.prototype.stopMove=function(){_super.prototype.stopMove.call(this);if(this==EntityManager.ins().getNoDieRole()){SoundUtil.ins().stopRun();GameLogic.ins().postAdjustMapPos()}};__decorate([callLater],CharRole.prototype,"moveCamera",null);return CharRole}(CharMonster);__reflect(CharRole.prototype,"CharRole");var CharTransfer=function(_super){__extends(CharTransfer,_super);function CharTransfer(){var _this=_super.call(this)||this;_this.hasDir=[];_this.touchEnabled=true;_this.transferName=new TransferNameHead;_this.transferName.anchorOffsetX=40;_this.transferName.anchorOffsetY=21;_this.titleContainer.addChild(_this.transferName);_this.titleContainer.anchorOffsetY=80;return _this}Object.defineProperty(CharTransfer.prototype,"infoModel",{get:function(){return this._infoModel},set:function(model){this._infoModel=model},enumerable:true,configurable:true});CharTransfer.prototype.updateModel=function(){this.x=this.infoModel.x;this.y=this.infoModel.y;this.transferName.updateModel(this.infoModel);this.addMc(CharMcOrder.BODY,this.infoModel.avatarFileName)};return CharTransfer}(CharEffect);__reflect(CharTransfer.prototype,"CharTransfer");var GuideArrow=function(_super){__extends(GuideArrow,_super);function GuideArrow(){var _this=_super.call(this)||this;_this.skinName="guideArrowSkin";return _this}GuideArrow.prototype.update=function(){var curCfg=GuideUtils.ins().curCfg;if(!curCfg)return;if(!curCfg.tips||curCfg.tips==""){this.visible=false;return}egret.Tween.removeTweens(this.parent);this.visible=true;if(curCfg.direction==1){this.currentState="right";this.x=40;egret.Tween.get(this.fingerL,{loop:true}).to({x:-25-40,y:-55+40},1e3).to({x:-25-40,y:-55+40},200).to({x:-25,y:-55},800)}else{this.x=5;this.currentState="left";egret.Tween.get(this.fingerR,{loop:true}).to({x:175+40,y:-55+40},1e3).to({x:175+40,y:-55+40},200).to({x:175,y:-55},800)}this.lab.text=curCfg.tips};GuideArrow.prototype.close=function(){if(this.parent)egret.Tween.removeTweens(this.parent)};return GuideArrow}(BaseEuiView);__reflect(GuideArrow.prototype,"GuideArrow");var EntityBuff=function(){function EntityBuff(){this.multRate=1}EntityBuff.prototype.dispose=function(){this.source=null;this.hostsHandle=null;this.multRate=1};EntityBuff.createBuff=function(id,selfTarget,args){var config=GlobalConfig.EffectsConfig[id];Assert(config,i18n("EntityBuff_0",id));var effValue=RoleAI.ins().skillEffValue(selfTarget,config,args);var addTime=args?args.time||0:0;return EntityBuff.createBaseBuff(id,selfTarget,effValue,config.duration+addTime)};EntityBuff.createBaseBuff=function(id,selfTarget,value,duration){var config=GlobalConfig.EffectsConfig[id];Assert(config,i18n("EntityBuff_1",id));var buff=ObjectPool.pop("EntityBuff");buff.effConfig=config;buff.value=value;buff.addTime=egret.getTimer();buff.endTime=buff.addTime+(duration?duration:config.duration);buff.count=(duration?duration:config.duration)/config.interval>>0;buff.step=0;buff.source=selfTarget;if(config.type==SkillEffType.HostAddAttributes){if(buff.hostsHandle==null){buff.hostsHandle=[]}var mh=EntityManager.ins().getRootMasterHandle(selfTarget.infoModel.handle);if(buff.hostsHandle.indexOf(mh)<0){buff.hostsHandle.push(mh)}}return buff};EntityBuff.prototype.isExecute=function(){return egret.getTimer()-this.addTime>this.step*this.effConfig.interval};EntityBuff.prototype.canRemove=function(){return this.effConfig.type!=SkillEffType.Summon&&egret.getTimer()>=this.endTime};EntityBuff.prototype.isCanotHit=function(){return this.effConfig.type==SkillEffType.AdditionalState&&this.effConfig&&this.effConfig.args&&this.effConfig.args.i==1};return EntityBuff}();__reflect(EntityBuff.prototype,"EntityBuff");var EntityFilter;(function(EntityFilter){EntityFilter[EntityFilter["no"]=0]="no";EntityFilter[EntityFilter["hard"]=1]="hard";EntityFilter[EntityFilter["poison"]=2]="poison"})(EntityFilter||(EntityFilter={}));window["EntityFilter"]=EntityFilter;var EntityFilterUtil=function(){function EntityFilterUtil(){}Object.defineProperty(EntityFilterUtil,"buffFilter",{get:function(){return{1:{filters:FilterUtil.ARRAY_GRAY_FILTER},2:{filters:FilterUtil.ARRAY_GREEN_FILTER}}},enumerable:true,configurable:true});EntityFilterUtil.getEntityFilter=function(groupID){var filter=EntityFilter.no;if(EntityFilterUtil.isHard(groupID)){filter=EntityFilter.hard}else if(EntityFilterUtil.isPoison(groupID)){filter=EntityFilter.poison}return filter};EntityFilterUtil.isHard=function(groupID){return groupID==51001||groupID==150065};EntityFilterUtil.isPoison=function(groupID){return groupID==23001||groupID==61001||groupID==150071};return EntityFilterUtil}();__reflect(EntityFilterUtil.prototype,"EntityFilterUtil");var MineModel=function(_super){__extends(MineModel,_super);function MineModel(){var _this=_super.call(this)||this;_this.type=EntityType.Mine;return _this}Object.defineProperty(MineModel.prototype,"npcConfig",{get:function(){var conf=GlobalConfig.KuangYuanConfig[this.configID];return GlobalConfig.NpcBaseConfig[conf.npcId]},enumerable:true,configurable:true});MineModel.prototype.parser=function(bytes){this.index=bytes.readByte();this.actorID=bytes.readInt();this.name=bytes.readString();this.power=bytes.readInt();this.guildName=bytes.readString();this.configID=bytes.readUnsignedByte();this.startTime=DateUtils.formatMiniDateTime(bytes.readInt());this.endTime=DateUtils.formatMiniDateTime(bytes.readInt());this.isBeFight=bytes.readBoolean();var len=bytes.readByte();this.beFightActorID=[];for(var i=0;i<len;i++){this.beFightActorID[i]=bytes.readInt()}};return MineModel}(NpcModel);__reflect(MineModel.prototype,"MineModel");var MineNpcHead=function(_super){__extends(MineNpcHead,_super);function MineNpcHead(){var _this=_super.call(this)||this;_this.states=["none","mine"];_this.skinName="MineNpcHeadSkin";_this.contentGroup.touchEnabled=false;_this.touchEnabled=false;return _this}MineNpcHead.prototype.updateModel=function(info){var config=info.npcConfig;if(config&&config.title){this.titleGroup.visible=true}else{this.titleGroup.visible=false}this.titleImg.source=config?config.title:"";this.icon.source=config?config.headIcon:""};MineNpcHead.prototype.updateState=function(info){if(info.isBeFight){this.setState(1)}else if(MineData.ins().getIsCanAtk(info)){this.setState(2)}else{this.setState(0)}};MineNpcHead.prototype.setState=function(state){if(state==1){this.workerState.source=""}else if(state==2){this.workerState.source="jingji_json.kuanggong_title"}else{this.workerState.source=""}this.setEff(state)};MineNpcHead.prototype.setEff=function(state){if(state==1){var eff=this.getEff();eff.playFile(RES_DIR_EFF+"fighting",-1);eff.x=this.stateGroup.width>>1;eff.y=-20;this.stateGroup.addChild(eff)}else{if(this.eff){DisplayUtils.removeFromParent(this.eff);this.eff.dispose()}}};MineNpcHead.prototype.getEff=function(){if(!this.eff){this.eff=new MovieClip}return this.eff};return MineNpcHead}(BaseComponent);__reflect(MineNpcHead.prototype,"MineNpcHead");var GuideMaskBackgroud=function(_super){__extends(GuideMaskBackgroud,_super);function GuideMaskBackgroud(){var _this=_super.call(this)||this;_this._stageWidth=0;_this._stageHeight=0;_this._bgs=new Array;_this.touchEnabled=true;return _this}GuideMaskBackgroud.prototype.init=function(stageWidth,stageHeight){this._stageWidth=stageWidth;this._stageHeight=stageHeight};GuideMaskBackgroud.prototype.draw=function(deductRec){this.cacheAsBitmap=false;this._deductRec=deductRec;this.removeAllChild();var minX=Math.max(deductRec.x,0);var minY=Math.max(deductRec.y,0);var maxX=Math.min(deductRec.x+deductRec.width,this._stageWidth);var maxY=Math.min(deductRec.y+deductRec.height,this._stageHeight);this.addBg(0,0,this._stageWidth,minY);this.addBg(0,minY,minX,deductRec.height);this.addBg(maxX,minY,this._stageWidth-maxX,deductRec.height);this.addBg(0,maxY,this._stageWidth,this._stageHeight-maxY);this.width=this._stageWidth;this.height=this._stageHeight;if(!window["isSmallGame"]){this.cacheAsBitmap=true}};GuideMaskBackgroud.prototype.destroy=function(){this.removeChildren();this._bgs=[]};GuideMaskBackgroud.prototype.removeAllChild=function(){while(this.numChildren){var bg=this.removeChildAt(0);this._bgs.push(bg)}};GuideMaskBackgroud.prototype.addBg=function($x,$y,$w,$h){var bg;if(this._bgs.length){bg=this._bgs.pop();bg.graphics.clear()}else{bg=new egret.Shape}bg.graphics.beginFill(0,.5);bg.graphics.drawRect($x,$y,$w,$h);bg.graphics.endFill();this.addChild(bg)};GuideMaskBackgroud.prototype.hitTest=function(x,y,ignoreTouchEnabled){if(this._deductRec&&this._deductRec.contains(x,y)){return null}else{return this}};return GuideMaskBackgroud}(egret.Sprite);__reflect(GuideMaskBackgroud.prototype,"GuideMaskBackgroud");var PaoPaoView=function(_super){__extends(PaoPaoView,_super);function PaoPaoView(){var _this=_super.call(this)||this;_this.jobText=[16146438,16146438,2933496,14831353];_this.skinName="paopaoSkin";return _this}PaoPaoView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.x=-this.width/2;this.visible=false};PaoPaoView.prototype.setSpeak=function(id,job){if(job===void 0){job=1}TimerManager.ins().removeAll(this);this.start();this.nameTxt.textColor=this.jobText[job];var bubble=BubbleFactory.ins().playBubbleEffect(id);if(!bubble)return;this.nameTxt.text=bubble;this.nameTxt.x=-this.nameTxt.textWidth>>1;this.visible=true};PaoPaoView.prototype.start=function(){TimerManager.ins().doTimer(1e3,1,this.destruct,this)};PaoPaoView.prototype.destruct=function(){if(this.parent){this.visible=false}};return PaoPaoView}(BaseView);__reflect(PaoPaoView.prototype,"PaoPaoView");var Role=function(_super){__extends(Role,_super);function Role(){var _this=_super.call(this)||this;_this.runeDatas=[];_this.wingSkillData=[];_this.lilianLv=0;_this._mbRing=0;_this.hsRing=0;_this.type=EntityType.Role;return _this}Object.defineProperty(Role,"jobNumberToName",{get:function(){var _jobNumberToName=this._jobNumberToName;if(_jobNumberToName==null){_jobNumberToName={0:i18n("Role_0"),1:i18n("Role_1"),2:i18n("Role_2"),3:i18n("Role_3")};this._jobNumberToName=_jobNumberToName}return _jobNumberToName},enumerable:true,configurable:true});Role.getAttrTypeByName=function(attrName){return this.translate[attrName]};Role.getJobNameByJob=function(type){return this.jobNumberToName[type]};Object.defineProperty(Role,"typeNumberToName",{get:function(){var _typeNumberToName=this._typeNumberToName;if(_typeNumberToName==null){_typeNumberToName=[i18n("Role_4"),i18n("Role_5"),i18n("Role_6"),i18n("Role_7"),i18n("Role_8"),i18n("Role_9"),i18n("Role_10"),i18n("Role_11"),i18n("Role_12"),i18n("Role_13"),i18n("Role_14"),i18n("Role_15"),i18n("Role_16")];this._typeNumberToName=_typeNumberToName}return _typeNumberToName},enumerable:true,configurable:true});Object.defineProperty(Role,"hejiPosName",{get:function(){var _hejiPosName=this._hejiPosName;if(_hejiPosName==null){_hejiPosName=[i18n("Role_17"),i18n("Role_18"),i18n("Role_19"),i18n("Role_20"),i18n("Role_21"),i18n("Role_22"),i18n("Role_23"),i18n("Role_24")];this._hejiPosName=_hejiPosName}return _hejiPosName},enumerable:true,configurable:true});Role.getHejiEquipNameByType=function(type){return this.hejiPosName[type]};Role.getEquipNameByType=function(type){return this.typeNumberToName[type]};Object.defineProperty(Role,"typeEquipWingToName",{get:function(){var _typeEquipWingToName=this._typeEquipWingToName;if(_typeEquipWingToName==null){_typeEquipWingToName=[i18n("Role_25"),i18n("Role_26"),i18n("Role_27"),i18n("Role_28")];this._typeEquipWingToName=_typeEquipWingToName}return _typeEquipWingToName},enumerable:true,configurable:true});Role.getWingEquipNameByType=function(type){return this.typeEquipWingToName[type]};Role.getAllForgeLevelByType=function(packageID){var sumlevel=0;var len=SubRoles.ins().subRolesLen;for(var r=0;r<len;r++){var eqdata=SubRoles.ins().getSubRoleByIndex(r).equipsData;for(var i=0;i<UserEquip.FOEGE_MAX;i++){switch(packageID){case PackageID.strongthen:sumlevel+=eqdata[i].strengthen;break;case PackageID.Gem:sumlevel+=eqdata[i].gem;break;case PackageID.Zhuling:sumlevel+=eqdata[i].zhuling;break}}}return sumlevel};Role.getAllZSLevel=function(){var sumlevel=0;var len=SubRoles.ins().subRolesLen;for(var r=0;r<len;r++){var eqdata=SubRoles.ins().getSubRoleByIndex(r).equipsData;for(var i=0;i<UserEquip.FOEGE_MAX;i++){var configID=eqdata[i].item.configID;var curItemData=GlobalConfig.ItemConfig[configID];if(curItemData&&ItemConfig.getQuality(curItemData)==4&&curItemData.zsLevel){sumlevel+=curItemData.zsLevel}}}return sumlevel};Role.prototype.parser=function(bytes){this.title=bytes.readInt();this.index=bytes.readInt();this.job=bytes.readInt();this.sex=bytes.readInt();this.power=bytes.readDouble();this.skillsData=[];this.skillsDataSsActive=[];this.skillsDataSsPassive=[];var i;for(i=0;i<5;i++){var lv=bytes.readInt();this.skillsData.push(SkillData.getSkillByJob(this.job,i+1,lv))}for(i=0;i<5;i++){bytes.readInt()}this.yuanshengData=[];this.yuanshenLv=bytes.readInt();for(i=0;i<6;i++){this.yuanshengData.push(bytes.readBoolean())}this.equipsData=[];var equip;for(i=0;i<EquipPos.MAX;i++){equip=new EquipsData;equip.parser(bytes);this.equipsData.push(equip)}this.exRingsData=[];for(i=0;i<4;i++){this.exRingsData.push(bytes.readInt())}this.wingsData=new WingsData;this.wingsData.parser(bytes);this.jingMaiData=new JingMaiData;this.jingMaiData.parser(bytes);this.loongSoulData=new LongHunData;this.loongSoulData.parser(bytes);this.parserRune(bytes);this.parserhHeirloom(bytes);this.parserhWeapons(bytes);var len=bytes.readInt();for(i=0;i<len;i++){var id=bytes.readInt();var data=new SkillData(id);this.skillsDataSsActive.push(data)}len=bytes.readInt();for(i=0;i<len;i++){var id=bytes.readInt();var data=new SkillData(id);this.skillsDataSsPassive.push(data)}this.parserAtt(bytes);this.parserExAtt(bytes);this.parseJadeData(bytes);this.parserZhuangbei(bytes);this.setWingSkill()};Role.prototype.parserhWeapons=function(bytes){if(!this.weapons)this.weapons=new WeaponsData;this.weapons.weaponsId=bytes.readInt()};Role.prototype.parserhHeirloom=function(bytes){if(!this.heirloom)this.heirloom=new HeirloomData;this.heirloom.parser(bytes)};Role.prototype.setWingSkill=function(){this.wingSkillData=[];for(var j=0;j<this.wingsData.lv+1;j++){var tData=GlobalConfig.WingLevelConfig[j];if(tData&&tData.pasSkillId){this.wingSkillData.push(tData.pasSkillId)}}};Role.prototype.parserModel=function(bytes){var len=bytes.readShort();this.zhuZaiData=[];for(var j=0;j<len;j++){var data=new ZhuZaiData;data.parser(bytes);this.zhuZaiData[data.id-1]=data}};Role.prototype.parseJadeData=function(bytes){if(!this.jadeData)this.jadeData=new JadeDataNew;this.jadeData.parserOther(bytes)};Role.prototype.parserZhuangbei=function(bytes){this.zhuangbei=[];for(var i=0;i<3;i++){this.zhuangbei.push(bytes.readInt())}};Role.prototype.parserRune=function(bytes){var num=10;var rd=null;this.runeDatas=[];for(var i=0;i<num;i++){rd=new ItemData;rd.parser(bytes);this.runeDatas.push(rd)}};Role.prototype.parseForgeChange=function(bytes,packageID){var index=bytes.readInt();switch(packageID){case PackageID.strongthen:this.equipsData[index].strengthen=bytes.readInt();break;case PackageID.Gem:this.equipsData[index].gem=bytes.readInt();break;case PackageID.Zhuling:this.equipsData[index].zhuling=bytes.readInt();break;case PackageID.Tupo:this.equipsData[index].tupo=bytes.readInt();break;case 1100:this.equipsData[index].bless=bytes.readInt();break}return index};Role.prototype.parserExAtt=function(bytes){var count=bytes.readShort();for(var i=0;i<count;i++){this.attributeExData[i]=bytes.readInt()}};Role.prototype.parserOtherRole=function(bytes,isHuman){this.parserAtt(bytes);this.parserExAtt(bytes);this._name=bytes.readString();if(isHuman)this._servId=bytes.readInt();this.job=bytes.readByte();this.sex=bytes.readByte();this._lv=bytes.readInt();this.equipsData=[];this.equipsData[2]=new EquipsData;this.equipsData[2].item=new ItemData;this.equipsData[2].item.configID=bytes.readInt();this.equipsData[0]=new EquipsData;this.equipsData[0].item=new ItemData;this.equipsData[0].item.configID=bytes.readInt();this.wingsData=new WingsData;this.wingsData.lv=bytes.readInt();this.wingsData.openStatus=bytes.readInt();this.title=bytes.readInt();this.guildID=bytes.readInt();this.guildName=bytes.readString();this.parserZhuangbei(bytes);this.lilianLv=bytes.readInt();this.weaponsId=bytes.readShort();this.parserhHeirloom(bytes);this.camp=bytes.readShort();this.flySwordAct=bytes.readByte();this.flySwordSkinId=bytes.readShort()};Object.defineProperty(Role.prototype,"mbRing",{get:function(){return this._mbRing},set:function(value){this._mbRing=value},enumerable:true,configurable:true});Role.prototype.getMinEquipIndexByType=function(type){var index=0;var min=Number.MAX_VALUE;var lv=0;var num=ForgeConst.CAN_FORGE_EQUIP.length;for(var n=0;n<num;++n){var i=ForgeConst.CAN_FORGE_EQUIP[n];switch(type){case ForgeWin.Page_Select_Boost:lv=this.equipsData[i].strengthen;break;case ForgeWin.Page_Select_Gem:lv=this.equipsData[i].gem;var openConfig=GlobalConfig.StoneOpenConfig[i];if(Actor.level<openConfig.openLv)continue;break;case ForgeWin.Page_Select_ZhuLing:lv=this.equipsData[i].zhuling;break;case 3:lv=this.equipsData[i].tupo;break}if(min>lv){min=lv;index=i}}return index};Role.prototype.getEquipForgeTotalLv=function(type){var totalLv=0;var n=ForgeConst.CAN_FORGE_EQUIP.length;while(n--){var i=ForgeConst.CAN_FORGE_EQUIP[n];switch(type){case ForgeWin.Page_Select_Boost:totalLv+=this.getEquipByIndex(i).strengthen;break;case ForgeWin.Page_Select_Gem:totalLv+=this.getEquipByIndex(i).gem;break;case ForgeWin.Page_Select_ZhuLing:totalLv+=this.getEquipByIndex(i).zhuling;break;case 3:totalLv+=this.getEquipByIndex(i).tupo;break}}return totalLv};Role.prototype.getEquipForgeLv=function(solt,type){var lv=0;switch(type){case ForgeWin.Page_Select_Boost:lv+=this.getEquipByIndex(solt).strengthen;break;case ForgeWin.Page_Select_Gem:lv+=this.getEquipByIndex(solt).gem;break;case ForgeWin.Page_Select_ZhuLing:lv+=this.getEquipByIndex(solt).zhuling;break;case 3:lv+=this.getEquipByIndex(solt).tupo;break}return lv};Role.prototype.getAllHeirloomPower=function(){var total=0;for(var i=0;i<8;i++)total+=this.getHeirloomSlotPower(i);return total};Role.prototype.getHeirloomSlotPower=function(solt){var info=this.heirloom.getInfoBySolt(solt);var power=UserBag.getAttrPower(info.attr)||0;var add_attr=info.attr_add;var forgePower=0;var equipData=this.getEquipByIndex(solt);if(equipData.item.itemConfig){forgePower+=equipData.item.point;for(var i=0;i<3;i++){var lv=this.getEquipForgeLv(solt,i);var config=UserForge.ins().getForgeConfigByPos(solt,lv,i);forgePower+=UserBag.getAttrPower(config.attr)||0}}var totalPower=power+Math.floor(forgePower*(add_attr/100));return totalPower};Role.prototype.getCurSkillIDs=function(){var data=[];for(var i=0;i<this.skillsData.length;i++){data.push(this.skillsData[i].lv1ConfigID)}return data};Role.prototype.mergeData=function(data){this.masterHandle=data.masterHandle;this.handle=data.handle;this.type=data.type;this.x=data.x;this.y=data.y;this.attributeData=data.attributeData;this.attributeExData=data.attributeExData;this.team=data.team;this.lilianLv=data.lilianLv;this.name=data.name;this.guildID=data.guildID;this.guildName=data.guildName;this.isMy=data.isMy;this.title=data.title;if(data instanceof Role){this.warLevel=data.warLevel;this.mbRing=data.mbRing;this.hsRing=data.hsRing}return this};Role.prototype.getEquipDataByPos=function(pos){if(this.equipsData&&this.equipsData[pos]){return this.equipsData[pos]}return null};Role.prototype.getForgeTotalPower=function(type){var totalPower=0;var n=ForgeConst.CAN_FORGE_EQUIP.length;while(n--){var i=ForgeConst.CAN_FORGE_EQUIP[n];var lv=void 0;switch(type){case ForgeWin.Page_Select_Boost:lv=this.equipsData[i].strengthen;break;case ForgeWin.Page_Select_ZhuLing:lv=this.equipsData[i].zhuling;break;case ForgeWin.Page_Select_Gem:lv=this.equipsData[i].gem;break;case 3:lv=this.equipsData[i].tupo;break}if(lv>0){var forgeConfig=UserForge.ins().getForgeConfigByPos(i,lv,type);totalPower+=Math.floor(UserBag.getAttrPower(forgeConfig.attr))}}return totalPower};Role.prototype.getWeaponTotalPower=function(id){var totalPower=0;var attr=[];if(id>0){var wsconfig=GlobalConfig.WeaponSoulConfig[id];for(var i=0;i<wsconfig.actcond.length;i++){var slot=wsconfig.actcond[i];var winfo=this.weapons.getSlotByInfo(slot);if(winfo){for(var j=0;j<winfo.attr.length;j++){var at=new AttributeData;at.type=winfo.attr[j].type;at.value=winfo.attr[j].value;attr.push(at)}}}}else{var infodata=this.weapons.getInfoData();for(var k in infodata){var wsinfo=infodata[k];for(var w in wsinfo){var info=wsinfo[w];if(info&&info.level){for(var j=0;j<info.attr.length;j++){var at=new AttributeData;var tmp=info.attr[j];at.type=tmp.type;at.value=tmp.value;attr.push(at)}}}}}var index=this.weapons.flexibleCount?this.weapons.flexibleCount-1:0;var config=GlobalConfig.WeaponSoulItemAttr[index];if(attr.length&&config){for(var i=0;i<config.attr.length;i++){var isHave=false;for(var j=0;j<attr.length;j++){if(attr[j].type==config.attr[i].type){isHave=true;attr[j].value+=config.attr[i].value;break}}if(!isHave){var at=new AttributeData;var tmp=config.attr[i];at.type=tmp.type;at.value=tmp.value;attr.push(at)}}}totalPower+=Math.floor(UserBag.getAttrPower(attr));return totalPower};Object.defineProperty(Role.prototype,"name",{get:function(){return this._name},set:function(str){this._name=str},enumerable:true,configurable:true});Object.defineProperty(Role.prototype,"servId",{get:function(){return this._servId},enumerable:true,configurable:true});Role.prototype.getNameWithServer2=function(){return this._servId&&KFServerSys.ins().isKF?this.name+("\nS"+this._servId):this.name};Object.defineProperty(Role.prototype,"guildAndName",{get:function(){var nameStr=this.getNameWithServer();var isMy=this.checkHandleIsMy(this.handle);var arenaColor=this.camp>0&&KfArenaSys.ins().isKFArena?this.camp!=BattleCC.ins().camp?"#FFFFFF":isMy?"#00FF00":"#FFFFFF":null;var campColor=this.camp>0&&BattleCC.ins().isBattle()?this.camp==1?"#FFFFFF":"#FFFF00":null;var guildColor=this.guildID==GuildWar.ins().getModel().winGuildInfo.guildId?"#ffb243":this.guildID==Guild.ins().guildID?"#dd49ac":"#2CC2F8";var str=this.guildID==0||this.guildID==undefined?"":"<font color="+guildColor+">"+this.guildName+"</font>"+"\n";var a=this.camp>0&&KfArenaSys.ins().isKFArena?this.camp!=BattleCC.ins().camp?"白":this.isMy?"绿":"白":null;var c=this.camp>0&&BattleCC.ins().isBattle()?this.camp==1?"白":"黄":null;if(arenaColor){str+="<font color="+arenaColor+">"+nameStr+"</font>"}else if(campColor){str+="<font color="+campColor+">"+nameStr+"</font>"}else if(isMy){str+="<font color="+65280+">"+nameStr+"</font>"}else if(this.team==Team.WillEntity){str+="<font color="+16777215+">"+nameStr+"</font>"}else{str+="<font color="+16777215+">"+nameStr+"</font>"}if(this.lilianLv>0){var config=GlobalConfig.TrainLevelConfig[this.lilianLv];if(config.type>1){var color=ColorUtil.JUEWEI_COLOR[config.type-1]||ColorUtil.JUEWEI_COLOR[ColorUtil.JUEWEI_COLOR.length-1];str+=" <font color="+color+">["+config.trainName+"]</font>"}}return str},enumerable:true,configurable:true});Object.defineProperty(Role.prototype,"lilianUrl",{get:function(){return""},enumerable:true,configurable:true});Object.defineProperty(Role.prototype,"lv",{get:function(){return this._lv},enumerable:true,configurable:true});Role.prototype.getZhuZaiDataByIndex=function(index){return this.zhuZaiData[index]};Role.prototype.getEquipByIndex=function(index){return this.equipsData[index]};Role.prototype.hideWeapons=function(){var role=SubRoles.ins().getSubRoleByIndex(this.index);if(role){var zb=role.zhuangbei;if(zb){var weaponId=zb[1];if(weaponId){return false}}}var id=this.getEquipByIndex(0).item.configID;return GlobalConfig.EquipConfig[id]&&GlobalConfig.EquipConfig[id].noWSoulEff>=1};Role.prototype.getEquipLen=function(){return this.equipsData.length};Role.prototype.getExRingsData=function(index){return this.exRingsData[index]};Role.prototype.setExRingsData=function(index,value){this.exRingsData[index]=value};Role.prototype.setZhuZaiData=function(index,value){this.zhuZaiData[index]=value};Role.translate={hp:AttributeType.atMaxHp,atk:AttributeType.atAttack,def:AttributeType.atDef,res:AttributeType.atRes,crit:AttributeType.atCrit,tough:AttributeType.atTough};return Role}(EntityModel);__reflect(Role.prototype,"Role");var SubRoles=function(_super){__extends(SubRoles,_super);function SubRoles(){var _this=_super.call(this)||this;_this.roles=[];_this.jobDic=[];_this.observe(Guild.ins().postQuitGuild,_this.setGuildName);_this.observe(Guild.ins().postGuildInfo,_this.setGuildName);_this.observe(LiLian.ins().postLilianData,_this.updateName);_this.init();return _this}SubRoles.ins=function(){return _super.ins.call(this)};SubRoles.prototype.init=function(){this.roles=[];this.jobDic=[]};SubRoles.prototype.doSubRole=function(bytes){var count=bytes.readShort();var roleLen=SubRoles.ins().subRolesLen;for(var i=0;i<count;i++){var model=this.roles[i];if(!model)model=new Role;model.parser(bytes);if(!this.roles[i]){this.roles.push(model)}if(!this.jobDic[model.job]){this.jobDic[model.job]=model}}LoadingTimeoutMgr.ins().endStep(LoadingTimeoutMgr.STEPID_GET_ROLES_LIST);LoadingTimeoutMgr.ins().beginStep(LoadingTimeoutMgr.STEPID_CREATE_ROLES);if(roleLen&&roleLen<this.roles.length){UserTips.ins().showTips(i18n("SubRoles_0"))}};SubRoles.prototype.doSubRoleAtt=function(bytes){var roleID=bytes.readInt();var power=0;var len=this.roles.length;var temp=0;for(var i=0;i<len;i++){var model=this.getSubRoleByIndex(i);if(model.index==roleID){model.parserAtt(bytes,true);temp=bytes.readDouble();if(temp!=0){model.power=temp}}power+=model.power}Actor.ins().postPowerChange(power,temp);if(GodWeaponCC.ins().gwshowTips){if(GodWeaponCC.ins().roleshowTips)GodWeaponCC.ins().roleshowTips--;if(GodWeaponCC.ins().roleshowTips<=0){GodWeaponCC.ins().roleshowTips=0;GodWeaponCC.ins().gwshowTips=false}}if(Actor.ins().isFirstEnter&&ChannelMgr.ins().isDiMaiChannel()){ChannelMgr.ins().channelReport(3,"1605000706");Actor.ins().isFirstEnter=false}if(Actor.ins().isFirstEnter&&ChannelMgr.ins().isWXSmallGameChannel()){ChannelMgr.ins().channelReport(3);Actor.ins().isFirstEnter=false}};SubRoles.prototype.doSubRoleExtAtt=function(bytes){var roleID=bytes.readInt();var len=this.roles.length;for(var i=0;i<len;i++){var model=this.getSubRoleByIndex(i);if(model.index==roleID){model.parserExtAtt(bytes,true)}}};SubRoles.prototype.getSubRoleByIndex=function(index){return this.roles[index]};SubRoles.prototype.getFirstJob=function(){var role=SubRoles.ins().getSubRoleByIndex(0);var job=role.job;return job||1};SubRoles.prototype.isFirstJob=function(job){var role=SubRoles.ins().getSubRoleByIndex(0);if(role.job==job)return true;return false};SubRoles.prototype.getSubRoleByJob=function(jobId){var len=this.roles.length;for(var i=0;i<len;i++){var model=this.getSubRoleByIndex(i);if(model.job==jobId){return this.roles[i]}}return null};Object.defineProperty(SubRoles.prototype,"subRolesLen",{get:function(){return this.roles.length},enumerable:true,configurable:true});SubRoles.prototype.resetRolesModel=function(){this.roles.length=0};SubRoles.prototype.updateName=function(){var len=this.subRolesLen;for(var i=0;i<len;i++){var entity=EntityManager.ins().getMainRole(i);if(entity){var model=this.getSubRoleByIndex(i);entity.setCharName(model.guildAndName);entity.setLilian(model.lilianUrl)}}};SubRoles.prototype.setGuildName=function(arr){var id=arr[0],name=arr[1];var len=this.subRolesLen;for(var i=0;i<len;i++){this.roles[i].guildName=name;this.roles[i].guildID=id}this.updateName()};SubRoles.prototype.getIsMyPlayer=function(han){for(var k in this.roles){if(this.roles[k].handle==han){return true}}return false};SubRoles.prototype.isLockRole=function(){var len=3;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(!role){var config=GlobalConfig.NewRoleConfig[i];if(!config)continue;if(config.zsLevel){if(UserZs.ins().lv>=config.zsLevel){return true}}else{if(Actor.level>=config.level){return true}}if(config.vip&&UserVip.ins().lv>=config.vip){return true}}}return false};SubRoles.prototype.getTotalPower=function(){var totalPower=0;var len=this.subRolesLen;for(var i=0;i<len;++i){var model=this.getSubRoleByIndex(i);totalPower+=model.power}return totalPower};SubRoles.MAX_ROLES=3;return SubRoles}(BaseSystem);__reflect(SubRoles.prototype,"SubRoles");var TransferModel=function(_super){__extends(TransferModel,_super);function TransferModel(){var _this=_super.call(this)||this;_this.type=EntityType.Transfer;return _this}Object.defineProperty(TransferModel.prototype,"avatarFileName",{get:function(){return RES_DIR_EFF+"movestand"},enumerable:true,configurable:true});return TransferModel}(NpcModel);__reflect(TransferModel.prototype,"TransferModel");var TransferNameHead=function(_super){__extends(TransferNameHead,_super);function TransferNameHead(){var _this=_super.call(this)||this;_this.configID=-1;_this.skinName="Trans";return _this}TransferNameHead.prototype.updateModel=function(info){if(info.index){this.visible=true;this.num.text=info.index+"";this.configID=info.configID}else{this.visible=false}};return TransferNameHead}(BaseComponent);__reflect(TransferNameHead.prototype,"TransferNameHead");var GameMap=function(){function GameMap(){}GameMap.init=function(data){this.grid=this.grid||new MapGrid;this.aStar=this.aStar||new AStar;this.mapZip=data};GameMap.update=function(){};GameMap.moveEntity=function(entity,endX,endY,isStraightLine,isDrop){if(isStraightLine===void 0){isStraightLine=false}if(isDrop===void 0){isDrop=false}if(entity.isJumping()&&!RoleAI.ins().isFindDrop){var self=this;entity.onJumpFinish=function(){self.moveEntityImpl(entity,endX,endY,isStraightLine,isDrop)}}else{this.moveEntityImpl(entity,endX,endY,isStraightLine,isDrop)}};GameMap.moveEntityImpl=function(entity,endX,endY,isStraightLine,isDrop){if(isStraightLine===void 0){isStraightLine=false}if(isDrop===void 0){isDrop=false}var size=GameMap.CELL_SIZE;var sx=Math.floor(entity.x/size);var sy=Math.floor(entity.y/size);var path;var tx=Math.floor(endX/size);var ty=Math.floor(endY/size);if(isDrop){if(isStraightLine){tx=endX;ty=endY}path=[new AStarNode(tx,ty,DirUtil.get8DirBy2Point({x:entity.x,y:entity.y},{x:endX,y:endY}))]}else{var isPlayerChar=entity.team==Team.My||entity.team==Team.Faker;path=this.aStar.getPatch(sx,sy,tx,ty,isDrop||!isPlayerChar);if(!path){return}}GameLogic.ins().postMoveEntity(entity,path,!isStraightLine)};GameMap.getPatch=function(fromX,fromY,targetX,targetY){var path=this.aStar.getPatch(fromX,fromY,targetX,targetY,false);return path};GameMap.myMoveTo=function(tx,ty,fun,funThis){var len=SubRoles.ins().subRolesLen;var char;for(var i=0;i<len;i++){char=EntityManager.ins().getMainRole(i);if(char)this.moveEntity(char,tx,ty)}var tempFunc=function(){var isCom=true;for(var i=0;i<len;i++){char=EntityManager.ins().getMainRole(i);if(char&&char.action==EntityAction.RUN){if(MathUtils.getDistance(char.x,char.y,tx,ty)<100){char.stopMove();char.playAction(EntityAction.STAND)}isCom=false}}if(isCom){TimerManager.ins().remove(tempFunc,this);fun&&fun.call(funThis)}};TimerManager.ins().doTimer(500,0,tempFunc,this)};GameMap.moveTo=function(endX,endY){var size=GameMap.CELL_SIZE;var tx=Math.floor(endX/size);var ty=Math.floor(endY/size);var txInPixel=tx*size+size/2;var tyInPixel=ty*size+size/2;GameLogic.ins().sendEntityMove(Actor.handle,txInPixel,tyInPixel);SysSetting.ins().setValue("mapClickTx",tx);SysSetting.ins().setValue("mapClickTy",ty);return true};GameMap.checkWalkable=function(x,y){var rtn=false;var node=this.grid.getNode(x,y);if(!node){debug.log(i18n("GameMap_2")+this.mapID+i18n("GameMap_3")+this._fubenID+i18n("GameMap_4")+x+","+y+i18n("GameMap_5"))}else{rtn=node.walkable}return rtn};GameMap.checkAlpha=function(x,y){var rtn=false;var node=this.grid.getNode(x,y);if(!node){debug.log(i18n("GameMap_6")+this.mapID+i18n("GameMap_7")+this._fubenID+i18n("GameMap_8")+x+","+y+i18n("GameMap_9"))}else{rtn=node.hidden}return rtn};GameMap.parser=function(bytes){this.lastFbId=this.fubenID;this.fubenID=bytes.readInt();this.mapID=bytes.readInt();this.mapX=bytes.readShort();this.mapY=bytes.readShort();this.lastFbTyp=this.fbType;this.fbType=bytes.readByte();this.fbName=bytes.readString();this.fbDesc=bytes.readString();var mapName=this.getFileName();var mapInfo=this.mapZip[mapName];this.CELL_SIZE=mapInfo.title_wh;this.MAX_HEIGHT=mapInfo.pixHeight;this.MAX_WIDTH=mapInfo.pixWidth;this.COL=mapInfo.maxX;this.ROW=mapInfo.maxY;this.grid.initMapInfo(mapInfo,GameMap.getTurn());this.aStar.initFromMap(this.grid);this.SafetyZone={};var cfg=GlobalConfig.ScenesConfig[this.mapID];for(var i=0;cfg.area&&i<cfg.area.length;i++){var area=cfg.area[i];var attr=area.attr;for(var j=0;j<attr.length;j++){switch(attr[j].type){case 0:this.safetyCalculate(area);break}}}};GameMap.safetyCalculate=function(area){var p=area.grids;var left=Number.MAX_VALUE;var top=Number.MAX_VALUE;var right=Number.MIN_VALUE;var botton=Number.MIN_VALUE;var isHas=false;for(var i=0;i<p.length;i++){var p1=p[i];var p2=i+1==p.length?p[0]:p[i+1];var ps=BresenhamLine.tileLine(p1.x,p1.y,p2.x,p2.y);for(var k=0;k<ps.length;k+=2){var x=ps[k];var y=ps[k+1];this.SafetyZone[y*GameMap.CELL_SIZE+x]={x:x,y:y};isHas=true}left=Math.min(p1.x,left);right=Math.max(p1.x,right);top=Math.min(p1.y,top);botton=Math.max(p1.y,botton)}if(isHas){for(var i=top;i<=botton;i++){var start=void 0;var end=void 0;for(var j=left;j<=right;j++){if(this.SafetyZone[i*GameMap.CELL_SIZE+j]){start=j;break}}for(var j=right;j>=left;j--){if(this.SafetyZone[i*GameMap.CELL_SIZE+j]){end=j;break}}if(!isNaN(start)&&!isNaN(end)){for(var j=start+1;j<=end;j++){this.SafetyZone[i*GameMap.CELL_SIZE+j]={x:i,y:j}}}}}};GameMap.checkSafety=function(xy){return!!this.SafetyZone[xy.y*GameMap.CELL_SIZE+xy.x]};Object.defineProperty(GameMap,"fubenID",{get:function(){return this._fubenID},set:function(value){this._fubenID=value;if(value>0){GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_HOOK)}},enumerable:true,configurable:true});GameMap.sceneInMain=function(){return GameMap.fbType==0&&GameMap.fubenID==0};GameMap.sceneInMine=function(){return GameMap.fbType==0&&GameMap.fubenID!=0};GameMap.canStartAI=function(){return GameMap.fbType==0};GameMap.getFileName=function(){var cfg=GlobalConfig.ScenesConfig[this.mapID];return cfg?cfg.mapfilename:null};GameMap.getTurn=function(){return GlobalConfig.ScenesConfig[this.mapID].turn};GameMap.autoPunch=function(){return GlobalConfig.ScenesConfig[this.mapID].autoPunch==1};GameMap.getRectangle=function(target,x,y){var _x=target.x+(x-.5)*GameMap.CELL_SIZE;var _y=target.y+(y-.5)*GameMap.CELL_SIZE;return new egret.Rectangle(_x,_y,GameMap.CELL_SIZE,GameMap.CELL_SIZE)};GameMap.getIncludeElement=function(target,points,charList){var list=[];for(var k in points){var re=GameMap.getRectangle(target,points[k].x,points[k].y);for(var p in charList){var char=charList[p];if(char.x>=re.x&&char.y>=re.y&&char.x<re.x+re.width&&char.y<re.y+re.height){list.push(char)}}}return list};GameMap.getPoint=function(index,w,h){var y=Math.floor(index/w)-Math.floor(h/2);var x=Math.floor(index%w)-Math.floor(w/2);return new egret.Point(x,y)};GameMap.getTargetIndex=function(sour,target,width,height){var aX=target.x-sour.x+GameMap.CELL_SIZE*(width/2);var aY=target.y-sour.y+GameMap.CELL_SIZE*(height/2);var x=Math.floor(aX/GameMap.CELL_SIZE);var y=Math.floor(aY/GameMap.CELL_SIZE);return width*y+x};GameMap.checkWalkableByPixel=function(x,y){var mapX=Math.floor(x/GameMap.CELL_SIZE);var mapY=Math.floor(y/GameMap.CELL_SIZE);return GameMap.checkWalkable(mapX,mapY)};GameMap.getPosRange=function(px,py,range){var _x=MathUtils.limitInteger(-range,+range);var _y=MathUtils.limitInteger(-range,+range);if(+_x!=+range){_y=Math.random()<.5?-range:range}var count=0;var i=_x,j=_y;while(true){var walk=GameMap.checkWalkable(px+i,py+j);if(walk){return[px+i,py+j]}if(i==range&&j<range){j+=1}else if(j==range&&i>-range){i-=1}else if(i==-range&&j>-range){j-=1}else if(j==-range&&i<range){i+=1}if(i==_x&&j==_y){if(_x==range){i=_x=range+1}if(_x==-range){i=_x=-range-1}if(_y==range){j=_y=range+1}if(_y==-range){j=_y=-range-1}range+=1}count+=1;if(count>100){break}}return[px,py]};GameMap.getPosRangeByDir=function(px,py,dir,range){var _px=px,_py=py;if(dir>=0&&dir<=1||dir==7){_py-=range}if(dir>=3&&dir<=5){_py+=range}if(dir>=1&&dir<=3){_px+=range}if(dir>=5&&dir<=7){_px-=range}return[_px,_py,GameMap.checkWalkable(_px,_py)]};GameMap.getPosRangeRandom=function(x,y,dir,range){if(range===void 0){range=1}var px=GameMap.point2Grip(x);var py=GameMap.point2Grip(y);var arr=[dir];var random=Math.random();if(random>.66){dir=dir-1<0?7:dir-1;arr.unshift(dir);if(random>.8){arr.push((dir+2)%8)}else{arr.splice(1,0,(dir+2)%8)}}else if(random>.33){dir=dir+1>7?0:dir+1;arr.unshift(dir);if(random>.5){arr.push((dir-2+8)%8)}else{arr.splice(1,0,(dir-2+8)%8)}}var isGetPoint=false;var pos;for(var i=0;i<arr.length;i++){pos=GameMap.getPosRangeByDir(px,py,arr[i],range);if(pos[2]){isGetPoint=true;break}}if(!isGetPoint){pos=GameMap.getPosRange(px,py,range)}return pos};GameMap.point2Grip=function(x){return Math.floor(x/GameMap.CELL_SIZE)};GameMap.grip2Point=function(px){return px*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1)};GameMap.hasTransfer=false;GameMap.fbType=0;GameMap.lastFbTyp=0;GameMap.lastFbId=0;return GameMap}();__reflect(GameMap.prototype,"GameMap");var MapView=function(_super){__extends(MapView,_super);function MapView(){var _this=_super.call(this)||this;_this.moveObjDic={};_this.lastStoryTime=0;_this.trailings={};_this.trailingId=0;_this.touchEnabled=true;_this.touchChildren=true;_this.addEventListener(egret.TouchEvent.TOUCH_TAP,MapView.onGridClick,MapView);egret.startTick(_this.onEnterFrame,_this);return _this}MapView.prototype.initMap=function(){var _this=this;this._stepIndex={};this._mapImage=new MapViewBg;this.addChildAt(this._mapImage,0);this._dropLayer=new egret.DisplayObjectContainer;this.addChildAt(this._dropLayer,10);this._effBottomLayer=new egret.DisplayObjectContainer;this.addChildAt(this._effBottomLayer,20);this._entityLayer=new egret.DisplayObjectContainer;this.addChildAt(this._entityLayer,30);this._dropNameLayer=new egret.DisplayObjectContainer;this.addChildAt(this._dropNameLayer,40);this._effTopLayer=new egret.DisplayObjectContainer;this.addChildAt(this._effTopLayer,50);this._effNewTopLayer=new egret.DisplayObjectContainer;this.addChildAt(this._effNewTopLayer,60);this._bloodLayer=new BloodView;this.addChildAt(this._bloodLayer,70);SkillEffPlayer.bottomLayer=this._effBottomLayer;SkillEffPlayer.topLayer=this._effTopLayer;SkillEffPlayer.setTimeout=function(time,fun,funThis){TimerManager.ins().doTimer(time,1,fun,funThis)};SkillEffPlayer.shake=function(e,range,time,count,probability){probability=probability||1;if(e==EntityManager.ins().getMainRole(0)&&Math.random()<probability){DisplayUtils.shakeIt(_this._mapImage,range,time,count)}};SkillEffNewPlayer.layerTop=this._effNewTopLayer;DropHelp.init(this._dropLayer,this._dropNameLayer);TimerManager.ins().doTimer(500,0,this.sortEntity,this)};MapView.prototype.sortEntity=function(){this._entityLayer.$children.sort(this.sortF)};MapView.prototype.sortF=function(d1,d2){if(d1.weight>d2.weight){return 1}else if(d1.weight<d2.weight){return-1}else{return 0}};MapView.prototype.addEntity=function(entity){this._entityLayer.addChild(entity)};MapView.prototype.moveEntity=function(param){var entity=param[0];var path=param[1];var isGrip=param[2]==undefined?true:!!param[2];if(path&&path.length){this._stepIndex[entity.hashCode]=path.length-1;this.moveNextStep(entity,path,isGrip)}else{entity.playAction(EntityAction.STAND)}};MapView.moveComplete=function(e){return e};MapView.prototype.moveNextStep=function(entity,path,isGrid){if(isGrid===void 0){isGrid=true}entity.stopMove();if(entity.action==EntityAction.DIE)return;if(this._stepIndex[entity.hashCode]<0){delete this._stepIndex[entity.hashCode];entity.playAction(EntityAction.STAND);MapView.moveComplete(entity);return}var node=path[this._stepIndex[entity.hashCode]];var nextPoint={x:0,y:0};var dir=node.nDir;if(isGrid){nextPoint.x=GameMap.grip2Point(node.nX);nextPoint.y=GameMap.grip2Point(node.nY)}else{nextPoint.x=node.nX;nextPoint.y=node.nY}if(entity instanceof CharRole||entity.infoModel.dirNum!=2){dir=DirUtil.get8DirBy2Point(entity,nextPoint)}else{dir=DirUtil.get4DirBy2Point(entity,nextPoint)}entity.dir=dir;var speed=1;var trailing=false;var isJump=false;var specifiedFrame=undefined;var specifiedAct=undefined;if(AStar.isSprint(node.nDir)&&!entity["lastSprinted"]){specifiedAct="f";speed=AStar.SPRINT_SPEED;trailing=true;entity["lastSprinted"]=true}else{entity["lastSprinted"]=false}if(AStar.isJump(node.nDir)&&entity.infoModel.team!=Team.WillEntity){specifiedAct="j";speed=AStar.JUMP_SPEED;trailing=true;entity["lastSprinted"]=true;isJump=true}entity.playAction(EntityAction.RUN,undefined,specifiedFrame,specifiedAct);this.moveToPoint(entity,nextPoint,node,path,isGrid,speed,trailing,isJump)};MapView.prototype.moveToPoint=function(entity,nextPoint,node,path,isGrid,speed,trailing,isJump){if(trailing===void 0){trailing=false}if(isJump===void 0){isJump=false}var curTime=egret.getTimer();var obj=this.moveObjDic[entity.hashCode];var timeGap=0;if(obj&&curTime>obj.total){timeGap=obj.total-curTime}entity.canMove=true;var vec={x:nextPoint.x-entity.x,y:nextPoint.y-entity.y};var xb=Math.sqrt(vec.x*vec.x+vec.y*vec.y);var isMainRole=entity==EntityManager.ins().getNoDieRole();var realSpeed=speed;if(node.endTimer!=null){var preferedMoveSpeed=xb/(node.endTimer-curTime-timeGap);var preferedSpeed=preferedMoveSpeed/(entity.moveSpeed/1e3);var minF=.01;var maxF=100;if(preferedSpeed<speed*minF){preferedSpeed=speed*minF}if(preferedSpeed>speed*maxF){preferedSpeed=speed*maxF}realSpeed=preferedSpeed}var moveSpeed=entity.moveSpeed/1e3*realSpeed;var total=xb/moveSpeed;vec.x=vec.x/total;vec.y=vec.y/total;entity["plainY"]=entity.y;var newObj={entity:entity,endPoint:nextPoint,vec:vec,path:path,isGrid:isGrid,time:curTime+timeGap,total:curTime+total+timeGap,isMainRole:isMainRole,trailing:trailing,trailCD:0,isJump:isJump,t0:curTime+timeGap,t:total,jumpHeight:xb*.6};entity.jumping=isJump;entity.onJumpFinish=null;this.moveObjDic[entity.hashCode]=newObj;if(timeGap<0){this.moveObj(newObj,curTime)}if(isMainRole)SoundUtil.ins().playRun()};MapView.prototype.onExitStoryMode=function(){var storyModeTime=RoleAI.ins().storyModeTime;if(storyModeTime>0){RoleAI.ins().storyModeTime=0;var now=egret.getTimer();var dt=now-storyModeTime;var trailings=this.trailings;for(var trailingKey in trailings){var trailing=trailings[trailingKey];trailing["trailTime"]+=dt}for(var hashCode in this.moveObjDic){var obj=this.moveObjDic[hashCode];obj.time+=dt;obj.total+=dt;obj.t0+=dt}}};MapView.prototype.onEnterFrame=function(dt){var inStoryMode=RoleAI.ins().inStoryMode;for(var hashCode in this.moveObjDic){var obj=this.moveObjDic[hashCode];if(!inStoryMode||NewStoryMgr.ins().isStoryEntity(obj.entity)){if(!obj.entity.canMove){var entity=obj.entity;var moveObj=this.moveObjDic[hashCode];if(moveObj.isJump){entity.x=moveObj.endPoint.x;entity.y=moveObj.endPoint.y}entity.jumping=false;if(entity.onJumpFinish){entity.onJumpFinish();entity.onJumpFinish=null}delete this.moveObjDic[hashCode]}else{this.moveObj(this.moveObjDic[hashCode],egret.getTimer())}}}if(inStoryMode){return}var trailings=this.trailings;var curTime=egret.getTimer();for(var trailingKey in trailings){var trailing=trailings[trailingKey];var rt=trailing["trailDuration"]-(curTime-trailing["trailTime"]);if(rt<0){if(trailing.parent!=null){trailing.parent.removeChild(trailing)}delete trailings[trailingKey]}else{trailing.alpha=rt/MapView.TRAILING_TIME}}return false};MapView.prototype.moveObj=function(obj,curTime){var entity=obj.entity;if(curTime>=obj.total){entity.x=obj.endPoint.x;entity.y=obj.endPoint.y;entity.jumping=false;if(entity.onJumpFinish){entity.onJumpFinish();entity.onJumpFinish=null}this.onChange(obj);this.onComplete(obj)}else{var time=curTime-obj.time;var addX=obj.vec.x*time;var addY=obj.vec.y*time;var jumpY=0;if(obj.isJump){var f=(curTime-obj.t0)/obj.t;if(f<0){f=0}if(f>1){f=1}if(obj.entity.hasFlySword()){var p=.3;var hf=.7;if(f<p){jumpY=-(1-(f*.5/p-.5)*(f*.5/p-.5)*4)*obj.jumpHeight*hf}else if(f>1-p){jumpY=-(1-(.5+(f-(1-p))*.5/p-.5)*(.5+(f-(1-p))*.5/p-.5)*4)*obj.jumpHeight*hf}else{jumpY=-obj.jumpHeight*hf}}else{jumpY=-(1-(f-.5)*(f-.5)*4)*obj.jumpHeight}}obj.time=curTime;entity.x+=addX;entity["plainY"]+=addY;entity.y=entity["plainY"]+jumpY;if(obj.trailing){obj.trailCD-=time;if(obj.trailCD<=0){this.addTrailing(obj,obj.entity.hasFlySword()?MapView.TRAILING_TIME*2:MapView.TRAILING_TIME);obj.trailCD+=80;if(obj.trailCD<40){obj.trailCD=40}}}this.onChange(obj)}};MapView.prototype.addTrailing=function(obj,duration){if(duration===void 0){duration=MapView.TRAILING_TIME}if(obj.entity&&obj.entity.visible){var img=obj.entity.copyImage();img["trailTime"]=egret.getTimer();img["trailDuration"]=duration;img.visible=obj.entity.isShowBody;this.trailings[this.trailingId]=img;this.trailingId+=1;if(obj.entity.parent){obj.entity.parent.addChildAt(img,0)}}};MapView.prototype.onChange=function(obj){var entity=obj.entity;var sx=GameMap.point2Grip(entity.x);var sy=GameMap.point2Grip(entity.y);entity.alpha=GameMap.checkAlpha(sx,sy)?.7:1;if(obj.isMainRole){this.lookAt(entity.x,entity.y)}};MapView.prototype.onComplete=function(obj){var hashCode=obj.entity.hashCode;this._stepIndex[hashCode]--;if(this._stepIndex[hashCode]<0){delete this.moveObjDic[hashCode]}this.moveNextStep(obj.entity,obj.path,obj.isGrid)};MapView.onGridClick=function(e){return{target:e.target,x:e.stageX-e.currentTarget.x,y:e.stageY-e.currentTarget.y}};MapView.prototype.lookAt=function(x,y,force){if(force===void 0){force=false}var sw=StageUtils.ins().getWidth();var sh=StageUtils.ins().getHeight();var fun=this.minValue;this.x=fun(x*this.scaleX,sw,GameMap.MAX_WIDTH);this.y=fun(y*this.scaleY,sh,GameMap.MAX_HEIGHT,60);this._mapImage.updateHDMap({x:fun(x,sw/this.scaleX,GameMap.MAX_WIDTH),y:fun(y,sh/this.scaleY,GameMap.MAX_HEIGHT,60)},force)};MapView.prototype.minValue=function(tx,stw,mv,offset){if(offset===void 0){offset=0}return-Math.min(Math.max(tx-offset-(stw>>1),0),mv-stw)};MapView.prototype.changeMap=function(){if(MapView.DRAW_GRID)this.drawGrid();else if(this._shapeContainer&&this._shapeContainer.parent)this.removeChild(this._shapeContainer);egret.Tween.removeTweens(this);egret.Tween.removeTweens(this._mapImage);this._mapImage.initThumbnail(GameMap.MAX_WIDTH,GameMap.MAX_HEIGHT,GameMap.getFileName(),GameMap.getTurn());var sc=GlobalConfig.ScenesConfig[GameMap.mapID];for(var i=0;sc.effPos&&i<sc.effPos.length;i++){var effPos=sc.effPos[i];var len=effPos.pos.length;for(var j=0;j<len;j++){var ep=effPos.pos[j];var mc=ObjectPool.pop("MovieClip");mc.playFile(RES_DIR_EFF+effPos.eff,-1);mc.x=ep.x;mc.y=ep.y;this._effBottomLayer.addChild(mc)}}this.createNpc();this.addEvent();this.lookAt(GameMap.mapX,GameMap.mapY,true)};MapView.prototype.addEvent=function(){var _this=this;MessageCenter.ins().removeAll(this);MessageCenter.addListener(GameLogic.ins().postMoveEntity,this.moveEntity,this);MessageCenter.addListener(GameLogic.ins().postMoveCamera,function(_a){var x=_a[0],y=_a[1],mapId=_a[2],fbId=_a[3];if(mapId==GameMap.mapID&&fbId==GameMap.fubenID){_this.lookAt(x,y)}},this);MessageCenter.addListener(GameLogic.ins().postAdjustMapPos,this.adjustMapPos,this)};MapView.prototype.adjustMapPos=function(){this.x=this.x>>0;this.y=this.y>>0};MapView.prototype.createNpc=function(){var sc=GlobalConfig.ScenesConfig[GameMap.mapID];if(sc.npc){for(var i=0;i<sc.npc.length;i++){var npcModel=new NpcModel;npcModel.configID=sc.npc[i].id;npcModel.x=sc.npc[i].x*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);npcModel.y=sc.npc[i].y*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);npcModel.dir=sc.npc[i].d;GameLogic.ins().createEntityByModel(npcModel)}}};MapView.prototype.drawGrid=function(){var rect=this._shape||new egret.Shape;this._shapeContainer=this._shapeContainer||new egret.DisplayObjectContainer;if(!window["isSmallGame"]){this._shapeContainer.cacheAsBitmap=true}this._shapeContainer.touchEnabled=false;this._shapeContainer.touchChildren=false;rect.graphics.clear();rect.graphics.lineStyle(.1);var maxX=GameMap.COL;var maxY=GameMap.ROW;for(var i=0;i<maxX;i++){for(var j=0;j<maxY;j++){if(GameMap.checkAlpha(i,j))rect.graphics.beginFill(242004,.3);else if(GameMap.checkWalkable(i,j))rect.graphics.beginFill(13421772,.3);else rect.graphics.beginFill(15937822,.3);rect.graphics.drawRect(i*GameMap.CELL_SIZE,j*GameMap.CELL_SIZE,GameMap.CELL_SIZE,GameMap.CELL_SIZE);rect.graphics.endFill();var text=new eui.Label;text.size=12;text.text=i+","+j;text.x=i*GameMap.CELL_SIZE;text.y=j*GameMap.CELL_SIZE;this._shapeContainer.addChild(text)}}this._shapeContainer.addChild(rect);this.addChild(this._shapeContainer);this._shape=rect};MapView.prototype.clearAllLayer=function(){this._effBottomLayer.removeChildren();this._effTopLayer.removeChildren();this._bloodLayer.removeChildren();this._entityLayer.removeChildren()};MapView.DRAW_GRID=false;MapView.TRAILING_TIME=350;__decorate([post],MapView,"moveComplete",null);__decorate([post],MapView,"onGridClick",null);return MapView}(egret.DisplayObjectContainer);__reflect(MapView.prototype,"MapView");var MapViewBg=function(_super){__extends(MapViewBg,_super);function MapViewBg(){var _this=_super.call(this)||this;_this._shape=new egret.Shape;_this.lastUpdateX=0;_this.lastUpdateY=0;_this.turn=0;_this.shape=[];_this.touchChildren=false;_this.touchEnabled=false;var s=new eui.Image;_this.addChild(s);_this.thumbnail=s;_this.thumbnail.addEventListener(egret.Event.COMPLETE,_this.onThumbnailComplete,_this);_this._imageList=[];_this.showImages=[];_this._poolImages=[];_this._fileDic={};return _this}MapViewBg.prototype.destructor=function(){this.thumbnail.removeEventListener(egret.Event.COMPLETE,this.onThumbnailComplete,this);this.removeChildren();this._imageList.length=0};MapViewBg.prototype.onThumbnailComplete=function(e){this.isThumbnailComplete=true;if(e.target&&e.target.name==this.mapName)this.updateHDMap({x:this.lastUpdateX,y:this.lastUpdateY},true)};MapViewBg.prototype.initThumbnail=function(w,h,fName,turn){if(this.mapName!=fName){this.isThumbnailComplete=false}if(this.mapName!=fName||this.turn!=turn){this.clearHDMap()}if(this.mapName!=fName){this.destroyFile()}this.mapName=fName;this.turn=turn;this.thumbnail.width=w;this.thumbnail.height=h;this.thumbnail.source=""+MAP_DIR+this.mapName+"/small.jpg";this.thumbnail.scaleX=turn?-1:1;this.thumbnail.x=turn?w:0;this.thumbnail.name=this.mapName;var imgSize=256;this.maxImagX=Math.floor(w/imgSize);this.maxImagY=Math.floor(h/imgSize);this.updateHDMap({x:this.lastUpdateX,y:this.lastUpdateY},true)};MapViewBg.prototype.clearHDMap=function(){this._imageList=[];this.showImages=[];this.removeChildren();this.addChild(this.thumbnail)};MapViewBg.prototype.destroyFile=function(){var baseAnalyzer=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE);for(var url in this._fileDic){baseAnalyzer.destroyRes(url)}this._fileDic={}};MapViewBg.prototype.getImage=function(){return this._poolImages.pop()||new eui.Image};MapViewBg.prototype.updateHDMap=function(p,force){if(force===void 0){force=false}var imgSize=256;if(force||Math.abs(this.lastUpdateX-p.x)>imgSize/4||Math.abs(this.lastUpdateY-p.y)>imgSize/4||this.lastUpdateX==0){this.lastUpdateX=p.x;this.lastUpdateY=p.y;if(!this.isThumbnailComplete)return;var shows=[];var ww=StageUtils.ins().getWidth();var hh=StageUtils.ins().getHeight();var imgX=Math.max(Math.floor(-p.x/imgSize)-1,0);var imgY=Math.max(Math.floor(-p.y/imgSize)-1,0);var imgXCount=imgX+Math.floor(ww/imgSize)+2;var imgYCount=imgY+Math.floor(hh/imgSize)+2;if(this.turn){for(var i=imgX;i<=imgXCount&&i<this.maxImagX;i++){var index=this.maxImagX-i>0?this.maxImagX-i-1:0;for(var j=imgY;j<=imgYCount&&j<this.maxImagY;j++){this._imageList[j]=this._imageList[j]||[];if(!this._imageList[j][index]){var sourceName=""+MAP_DIR+this.mapName+"/image/"+j+"_"+index+".jpg";this._fileDic[sourceName]=1;var s=this.getImage();s.source=sourceName;s.name=sourceName;s.scaleX=-1;s.x=(i+1)*imgSize;s.y=j*imgSize;this.addChild(s);this._imageList[j][index]=s}else{if(!this._imageList[j][index].parent){this.addChild(this._imageList[j][index])}}shows.push(this._imageList[j][index])}}}else{for(var i=imgX;i<=imgXCount&&i<this.maxImagX;i++){for(var j=imgY;j<=imgYCount&&j<this.maxImagY;j++){this._imageList[j]=this._imageList[j]||[];if(!this._imageList[j][i]){var sourceName=""+MAP_DIR+this.mapName+"/image/"+j+"_"+i+".jpg";this._fileDic[sourceName]=1;var s=this.getImage();s.source=sourceName;s.name=sourceName;s.x=i*imgSize;s.y=j*imgSize;this.addChild(s);this._imageList[j][i]=s}else{if(!this._imageList[j][i].parent){this.addChild(this._imageList[j][i])}}shows.push(this._imageList[j][i])}}}var len=this.showImages.length;for(var i=len-1;i>=0;i--){if(shows.indexOf(this.showImages[i])>=0)continue;DisplayUtils.removeFromParent(this.showImages[i])}this.showImages=shows}};MapViewBg.prototype.drawGrid=function(s,e){this.clearDrawGrid();this.shapeContainer=this.shapeContainer||new egret.DisplayObjectContainer;if(!window["isSmallGame"]){this.shapeContainer.cacheAsBitmap=true}this.shapeContainer.touchEnabled=false;this.shapeContainer.touchChildren=false;for(var i=s.x;i<e.x;i++){for(var j=s.y;j<e.y;j++){var index=i*e.x+j;var rect=this.shape[index];if(!rect)rect=this.shape[index]=new egret.Shape;rect.graphics.lineStyle(1,16777215);if(GameMap.checkAlpha(i,j)){rect.graphics.beginFill(255,.8)}else if(GameMap.checkWalkable(i,j)){rect.graphics.beginFill(65280,.8)}else{rect.graphics.beginFill(16711680,.8)}rect.graphics.drawRect(0,0,GameMap.CELL_SIZE,GameMap.CELL_SIZE);rect.graphics.endFill();rect.x=i*GameMap.CELL_SIZE;rect.y=j*GameMap.CELL_SIZE;var text=new eui.Label;text.size=12;text.text=i+","+j;text.x=i*GameMap.CELL_SIZE;text.y=j*GameMap.CELL_SIZE;text.name="label"+i+","+j;this.shapeContainer.addChild(text);this.shapeContainer.addChild(rect)}}this.addChild(this.shapeContainer)};MapViewBg.prototype.clearDrawGrid=function(){if(this.shapeContainer&&this.shape){while(this.shapeContainer.numChildren>0){this.shapeContainer.removeChildAt(0)}this.shape.length=0}};return MapViewBg}(egret.DisplayObjectContainer);__reflect(MapViewBg.prototype,"MapViewBg");var GameGuider=function(){function GameGuider(){}GameGuider.taskGuidance=function(id,taskType){var config;switch(taskType){case 0:config=GlobalConfig.DailyConfig[id];break;case 1:config=UserTask.ins().getAchieveConfById(id);Hint.ins().postAchievementBef(config);break}switch(config.control){case GuideType.OpenWin:if(config.control==GuideType.OpenWin&&config.controlTarget!=null&&config.controlTarget[0]=="LadderWin"&&Encounter.ins().isEncounter()){UserTips.ins().showTips(i18n("GameGuider_0"));return}if(id==100082&&String(config.controlTarget[0])=="LimitTaskView"){if(UserTask.ins().limitTaskEndTime>0&&UserTask.ins().limitTaskState!=0&&UserTask.ins().limitTaskEndTime>0&&UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3)>0){GameGuider.guidance(config.controlTarget[0],config.controlTarget[1])}else{GameGuider.guidance("RoleWin",1)}}else{GameGuider.guidance(config.controlTarget[0],config.controlTarget[1])}break;case GuideType.ChallengeBoss:this.challengeBoss();if(taskType==1){var cfg=config;Hint.ins().postKillBoss(cfg)}break;case GuideType.ArtifactGuide:Artifact.ins().setGuide();break;case GuideType.AtkMonster:RoleAI.ins().stop();var index=config.controlTarget[0];var x=UserFb.ins().rPos[index][0].x*GameMap.CELL_SIZE;var y=UserFb.ins().rPos[index][0].y*GameMap.CELL_SIZE;this.tempMainRole=EntityManager.ins().getNoDieRole();GameMap.moveEntity(this.tempMainRole,x,y);TimerManager.ins().doTimer(500,0,this.guideFun,this);break;case GuideType.AutoPk:UserFb.ins().setAutoPk();break;case GuideType.KillDeer:break;case GuideType.GuideFb:if(Encounter.ins().isEncounter()){UserTips.ins().showTips(i18n("GameGuider_2"));return}if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}UserFb.ins().sendIntoGuideFb(config.controlTarget[1]);break}};GameGuider.guideFun=function(){if(this.tempMainRole.action==EntityAction.STAND){RoleAI.ins().start();TimerManager.ins().remove(this.guideFun,this)}};GameGuider.guidance=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var tparam=param[1]!=-1?param[1]:null;if(param[0]=="VipGift"){param[0]="VipGiftWin";console.log("GameGuider guidance param[0] = "+param[0])}ViewManager.ins().open(param[0],tparam,param[2])};GameGuider.challengeBoss=function(func){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}if(UserFb.ins().currentEnergy>=UserFb.ins().energy){if(func&&typeof func=="function")func();UserFb.ins().autoPk()}else{}};GameGuider.startTaskEffect=function(){if(!this.taskEffect){this.taskEffect=new TaskEffectView}this.taskEffect.start()};GameGuider.stopTaskEffect=function(){if(this.taskEffect){this.taskEffect.stop()}};return GameGuider}();__reflect(GameGuider.prototype,"GameGuider");var GuideType;(function(GuideType){GuideType[GuideType["OpenWin"]=1]="OpenWin";GuideType[GuideType["ChallengeBoss"]=2]="ChallengeBoss";GuideType[GuideType["ArtifactGuide"]=3]="ArtifactGuide";GuideType[GuideType["AtkMonster"]=4]="AtkMonster";GuideType[GuideType["AutoPk"]=5]="AutoPk";GuideType[GuideType["KillDeer"]=6]="KillDeer";GuideType[GuideType["GuideFb"]=7]="GuideFb"})(GuideType||(GuideType={}));window["GuideType"]=GuideType;var Activationtongyong=function(_super){__extends(Activationtongyong,_super);function Activationtongyong(){var _this=_super.call(this)||this;_this.skinName="activationtongyong";_this.isTopLevel=true;_this.bgClose.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);_this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);return _this}Activationtongyong.prototype.onTap=function(e){switch(e.currentTarget){case this.okBtn:case this.bgClose:ViewManager.ins().close(Activationtongyong);break}};Activationtongyong.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var type=param[0];var name=param[1];var source=param[2];var play=param[3];this.closeFunc=param[4];var effmc=param[5];var zlmodel=param[6];var feijianModel=param[7];var sqmc=param[8];var wingmc=param[9];var resDir=param[10];this.title.source=type?"tongyongjihuochenggongp3":"tongyongjihuochenggongp2";var rxa=RegExpUtil.NonNumericExp.exec(name);if(!rxa)this.itemname.text=name;else{var num="";var oth="";for(var i=0;i<name.length;i++){if(i>=rxa.index){oth+=name[i]}else{num+=name[i]}}var str="";if(Number(num)/10>=1){str=num}else{str=" "+num}this.itemname.text=str+oth}this.img.source=source;if(effmc){if(!this.imgEff)this.imgEff=new MovieClip;if(!this.imgEff.parent)this.imgMc.addChild(this.imgEff);this.imgEff.playFile(resDir+effmc,-1);this.playGetEff(this.huodeMc)}else if(sqmc){if(!this.sqEff)this.sqEff=new MovieClip;if(!this.sqEff.parent)this.sqMc.addChild(this.sqEff);this.sqEff.playFile(resDir+sqmc,-1);this.playGetEff(this.sqMc)}else if(wingmc){if(!this.wingEff)this.wingEff=new MovieClip;if(!this.wingEff.parent)this.wingMc.addChild(this.wingEff);this.wingEff.playFile(resDir+wingmc,-1);this.playGetEff(this.wingMc2)}else if(zlmodel){if(!this.zlEff)this.zlEff=new MovieClip;if(!this.zlEff.parent)this.zlMc.addChild(this.zlEff);this.zlEff.playFile(resDir+zlmodel,-1);this.playGetEff(this.huodeMc)}else if(feijianModel){if(!this.feijianEff)this.feijianEff=new MovieClip;if(!this.feijianEff.parent)this.feijianMc.addChild(this.feijianEff);this.feijianEff.playFile(resDir+feijianModel,-1);this.playGetEff(this.feijianMc)}else{this.playGetEff(this.huodeMc)}this.playAnimaiton(play)};Activationtongyong.prototype.playGetEff=function(huodeMC){var huodeEff=this.huodeEff;if(!huodeEff)huodeEff=new MovieClip;if(!huodeEff.parent)huodeMC.addChild(huodeEff);TimerManager.ins().doTimer(300,1,function(){huodeEff.playFile(RES_DIR_EFF+"huodealleff",1)},this)};Activationtongyong.prototype.close=function(){egret.Tween.removeTweens(this.title);egret.Tween.removeTweens(this.titleBg);egret.Tween.removeTweens(this.img);egret.Tween.removeTweens(this.imgMc);egret.Tween.removeTweens(this.zlMc);egret.Tween.removeTweens(this.feijianMc);egret.Tween.removeTweens(this.tielian);egret.Tween.removeTweens(this.imgAct);if(this.closeFunc)this.closeFunc.apply(null);this.closeFunc=null;DisplayUtils.removeFromParent(this.zlEff);DisplayUtils.removeFromParent(this.imgEff);DisplayUtils.removeFromParent(this.mc);TimerManager.ins().removeAll(this);this.zlEff=null;this.imgEff=null;this.mc=null};Activationtongyong.prototype.playAnimaiton=function(play){var _this=this;var tlpos=this.tlpos=this.tlpos||[this.tielian.x,this.tielian.y];var lbgpos=this.lbgpos=this.lbgpos||[this.lbg.x,this.lbg.y];var rbgpos=this.rbgpos=this.rbgpos||[this.rbg.x,this.rbg.y];var titleScale=this.titleScale=this.titleScale||[this.title.scaleX,this.title.scaleY];var tbgScale=this.tbgScale=this.tbgScale||[this.titleBg.scaleX,this.titleBg.scaleY];var imgScale=this.imgScale=this.imgScale||[this.img.scaleX,this.img.scaleY];var imgMcScale=[0,0];if(this.imgEff)imgMcScale=this.imgMcScale=this.imgMcScale||[this.imgMc.scaleX,this.imgMc.scaleY];else if(this.zlEff)imgMcScale=this.imgMcScale=this.imgMcScale||[this.zlMc.scaleX,this.zlMc.scaleY];else if(this.feijianEff)imgMcScale=this.imgMcScale=this.imgMcScale||[this.feijianMc.scaleX,this.feijianMc.scaleY];this.bg.visible=false;this.itemname.visible=false;this.leftBg.visible=false;this.buttonBg.visible=false;this.title.scaleX=0;this.title.scaleY=0;this.titleBg.scaleX=0;this.titleBg.scaleY=0;this.img.scaleX=0;this.img.scaleY=0;this.imgMc.scaleX=0;this.imgMc.scaleY=0;this.tielian.y=-this.tielian.height*2;var speed=1;var t1=egret.Tween.get(this.tielian);t1.to({y:tlpos[1]+50},200*speed).to({y:tlpos[1]},100*speed).call(function(){_this.bg.visible=true;var t2=egret.Tween.get(_this.title);var t3=egret.Tween.get(_this.titleBg);var t4=egret.Tween.get(_this.img);var t5=egret.Tween.get(_this.imgMc);t2.to({scaleX:titleScale[0],scaleY:titleScale[1]},500*speed);t3.to({scaleX:tbgScale[0],scaleY:tbgScale[1]},500*speed);t5.to({scaleX:imgMcScale[0],scaleY:imgMcScale[1]},500*speed);t4.to({scaleX:imgScale[0],scaleY:imgScale[1]},500*speed).wait(500).call(function(){_this.itemname.visible=true;_this.leftBg.visible=true;_this.buttonBg.visible=true;_this.showPanel(play);_this.artifactTween()})});this.lbg.y=-this.tielian.height;this.rbg.y=-this.tielian.height;var tl=egret.Tween.get(this.lbg);tl.to({y:lbgpos[1]+50},200*speed).to({y:lbgpos[1]},100*speed);var tr=egret.Tween.get(this.rbg);tr.to({y:rbgpos[1]+50},200*speed).to({y:rbgpos[1]},100*speed)};Activationtongyong.prototype.showPanel=function(play){if(play){this.mc=new MovieClip;this.mc.anchorOffsetX=this.Groupeff.anchorOffsetX;this.mc.anchorOffsetY=this.Groupeff.anchorOffsetY;this.Groupeff.addChild(this.mc);this.mc.playFile(RES_DIR_EFF+"artifacteff",-1)}};Activationtongyong.prototype.artifactTween=function(){var t=egret.Tween.get(this.imgAct,{loop:true});t.to({y:this.imgAct.y-20},1e3).to({y:this.imgAct.y},1e3)};Activationtongyong.show=function(type,name,source,play,func,effmc,zlmodel,feijianModel,sqmc,wingmc,resDir){if(play===void 0){play=true}if(func===void 0){func=null}if(resDir===void 0){resDir=RES_DIR_EFF}ViewManager.ins().open(Activationtongyong,type,name,source,play,func,effmc,zlmodel,feijianModel,sqmc,wingmc,resDir);StageUtils.ins().setTouchChildren(true)};return Activationtongyong}(BaseEuiView);__reflect(Activationtongyong.prototype,"Activationtongyong");ViewManager.ins().reg(Activationtongyong,LayerManager.UI_Main);var Activity=function(_super){__extends(Activity,_super);function Activity(){var _this=_super.call(this)||this;_this.activityData={};_this.doubleElevenData={};_this.doubleElevenIDs=[130,150,151,152,153,156];_this.doubleElevenSpecialIDs=[150,151,152,153];_this.doubleTwelveData={};_this.doubleTwelveIDAry=[221,222,223,224];_this.doubleTwelveRechargeData={};_this.doubleTwelveRechargeIDAry=[225,226,227];_this.duanwuID=[4001,4002];_this.hfLoginID=157;_this.geLoginID=210;_this.palyEffList=[];_this.rankInfoList=[];_this.indexCurrDabiao=0;_this.nextDayState=0;_this.hfLoginDay=1;_this.geLoginDay=1;_this.firstRedpointlocal="_ActfirstRedpointlocal_";_this.rechargeId=[13,14,172,173,174,331,332,342,5102,4144,4155,10002,10003,10005,10008,10017];_this.springId=4501;_this.showLogo=false;_this.isSuccee=false;_this.activityRecycleYbSum=0;_this.sysId=PackageID.Activity;_this.regNetMsg(1,_this.doActivityData);_this.regNetMsg(2,_this.postRewardResult);_this.regNetMsg(3,_this.doDaBiaoInfo);_this.regNetMsg(4,_this.postIsGetAwards);_this.regNetMsg(5,_this.doRewardStatu);_this.regNetMsg(6,_this.postEnvelopeData);_this.regNetMsg(7,_this.postChangePage);_this.regNetMsg(8,_this.postRedEnvelopeData);_this.regNetMsg(11,_this.doSevenDayData);_this.regNetMsg(12,_this.doChangeSevenDayData);_this.regNetMsg(21,_this.doNextDayLoginData);_this.regNetMsg(20,_this.doNextDayLoginReward);_this.regNetMsg(22,_this.postKuaFuRank);_this.regNetMsg(23,_this.postFirstHongBaoGot);_this.regNetMsg(24,_this.postActFirstRechargeReward);_this.regNetMsg(25,_this.postActHuiShou);_this.regNetMsg(255,_this.postError);return _this}Activity.ins=function(){return _super.ins.call(this)};Activity.prototype.initLogin=function(){};Activity.prototype.initZero=function(){if(this.activityData){for(var id in this.activityData){var activityId=+id;if(activityId<1e4){var config=GlobalConfig.ActivityConfig[id];if(config){this.sendChangePage(activityId)}}}}};Activity.prototype.initZeroEvent=function(){Activity.ins().setfirstShowRedPointById(Activity.ins().duanwuID[0],"Unonclicked");var activity=Activity.ins().getActivityDataById(Activity.ins().duanwuID[0]);if(activity)activity.canReward()};Activity.prototype.getActivityDataById=function(id){return this.activityData[id]};Activity.prototype.getDoubleElevenDataByID=function(id){return this.doubleElevenData[id]};Activity.prototype.getPalyEffListById=function(id){return this.palyEffList[id]};Activity.prototype.setPalyEffListById=function(id,value){this.palyEffList[id]=value};Activity.prototype.getfirstShowRedPointById=function(id){var t=true;LoginMgr.getItem(this.firstRedpointlocal+id,function(str){if(str){if(str=="onclicked")t=false}});return t};Activity.prototype.setfirstShowRedPointById=function(id,value){LoginMgr.setItem(this.firstRedpointlocal+id,value)};Activity.prototype.getrankInfoListByIndex=function(index){return this.rankInfoList[index]};Activity.prototype.doActivityData=function(bytes){this.activityData={};var count=bytes.readShort();var hasFirstRecharge=false;for(var i=0;i<count;i++){var activityData=ActivityDataFactory.create(bytes);if(activityData){var id=activityData.id;if(this.doubleElevenIDs.indexOf(id)!=-1){this.doubleElevenData[id]=activityData}else if(this.doubleTwelveIDAry.indexOf(id)!=-1){this.doubleTwelveData[id]=activityData}else if(this.doubleTwelveRechargeIDAry.indexOf(id)!=-1){this.doubleTwelveRechargeData[id]=activityData}else{this.activityData[id]=activityData}if(activityData.pageStyle==ActivityPageStyle.ACTIVITY_FIRST_RECHAGE){if(activityData.isOpenActivity()&&!activityData.getHide()){hasFirstRecharge=true}}}}this.postActivityIsGetAwards();ActivityDataFactory.createEx();this.checkSpecials();this.checkActivityTimer();FirstRank.ins().sendGetRankData();if(hasFirstRecharge){this.postActivityFirstRecharge()}this.levelChange()};Activity.prototype.levelChange=function(){if(!this.showLogo){this.checkDay()}};Activity.prototype.checkDay=function(){var self=this;var today=(new Date).getDay().toString();LoginMgr.getItem("spring_act_day",function(v){if(v&&v!=""){if(v!=today){SysSetting.ins().setBool(SysSetting.SPRING_ACT_WIN,false);LoginMgr.setItem("spring_act_day",today)}else{}}else{SysSetting.ins().setBool(SysSetting.SPRING_ACT_WIN,false);LoginMgr.setItem("spring_act_day",today)}self.checkShowLogo()})};Activity.prototype.checkShowLogo=function(){var b=SysSetting.ins().getBool(SysSetting.SPRING_ACT_WIN);var data=Activity.ins().getActivityDataById(this.springId);if(!data){return}if(!b&&data.isOpenActivity()&&OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY)){ViewManager.ins().open(SpringTurntableLogo,this.springId);this.showLogo=true}};Activity.prototype.postActivityFirstRecharge=function(){};Activity.prototype.checkSpecials=function(){if(TimerManager.ins().isExists(this.checkSpecials,this))TimerManager.ins().remove(this.checkSpecials,this);this.postSpecials();var data;for(var key in this.doubleElevenData){if(this.doubleElevenSpecialIDs.indexOf(Number(key))!=-1){data=this.doubleElevenData[key];if(!data.isSpecialOpen()&&data.getSpecialOpenLeftTime()){TimerManager.ins().doTimer(data.getSpecialOpenLeftTime()*1e3,1,this.checkSpecials,this);return}}}};Activity.prototype.postSpecials=function(){};Activity.prototype.postActivityIsGetAwards=function(){};Activity.prototype.postRewardResult=function(bytes){this.isSuccee=bytes.readBoolean();var activityID=bytes.readInt();if(this.doubleElevenIDs.indexOf(activityID)!=-1){this.getDoubleElevenDataByID(activityID).update(bytes)}else if(this.doubleTwelveRechargeIDAry.indexOf(activityID)!=-1){this.doubleTwelveRechargeData[activityID].update(bytes)}else if(this.doubleTwelveIDAry.indexOf(activityID)!=-1){this.doubleTwelveData[activityID].update(bytes)}else{this.getActivityDataById(activityID).update(bytes)}this.postActivityPanel(activityID);this.postActivityIsGetAwards();this.postShowReward(activityID);return activityID};Activity.prototype.postActivityPanel=function(activityId){return activityId};Activity.prototype.postHuntResult=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}return params};Activity.prototype.sendReward=function(actID,rewardID,param1,param2){var bytes=this.getBytes(2);var cfg=GlobalConfig.ActivityConfig[actID];if(cfg&&cfg.activityType==ActivityDataFactory.ACTIVITY_TYPE_9){if(rewardID){bytes.writeInt(actID);bytes.writeShort(rewardID)}else{bytes.writeInt(actID);bytes.writeShort(rewardID);bytes.writeByte(param1)}}else if(cfg&&cfg.activityType==ActivityDataFactory.ACTIVITY_TYPE_28){if(rewardID){bytes.writeInt(actID);bytes.writeShort(rewardID)}else{bytes.writeInt(actID);bytes.writeShort(rewardID);bytes.writeByte(param1)}}else if(cfg&&cfg.activityType==ActivityDataFactory.ACTIVITY_TYPE_11){bytes.writeInt(actID);bytes.writeShort(rewardID);bytes.writeShort(param1)}else if(cfg&&cfg.activityType==ActivityDataFactory.ACTIVITY_TYPE_22){bytes.writeInt(actID);bytes.writeShort(rewardID);bytes.writeShort(param1);bytes.writeInt(param2)}else if(cfg&&cfg.activityType==ActivityDataFactory.ACTIVITY_TYPE_12){if(param1==EnvelopeType.SEND){bytes.writeInt(actID);bytes.writeShort(rewardID);bytes.writeShort(param1);if(!param2)param2="";bytes.writeString(param2)}else if(param1==EnvelopeType.GET){bytes.writeInt(actID);bytes.writeUnsignedShort(rewardID);bytes.writeShort(param1);if(!param2)param2="";bytes.writeString(param2)}}else if(cfg&&cfg.activityType==ActivityDataFactory.ACTIVITY_TYPE_2){bytes.writeInt(actID);bytes.writeShort(rewardID);var p1=param1?param1:0;bytes.writeShort(p1)}else{bytes.writeInt(actID);bytes.writeShort(rewardID)}this.sendToServer(bytes)};Activity.prototype.sendLianxuReward=function(actId){var bytes=this.getBytes(13);bytes.writeInt(actId);this.sendToServer(bytes)};Activity.prototype.doRewardStatu=function(bytes){var activityId=bytes.readInt();var data=this.getActivityDataById(activityId);if(data){if(data.id==this.hfLoginID){data.updateData(bytes);this.hfLoginDay=data.logTime}else if(data.id==this.geLoginID){data.updateData(bytes);this.geLoginDay=data.logTime}else{data.updateData(bytes)}}else{data=new ActivityType5Data(null);this.activityData[activityId]=data;data.updateData(bytes)}this.postActivityIsGetAwards()};Activity.prototype.postChangePage=function(bytes){var activityData=ActivityDataFactory.create(bytes);if(activityData){if(this.doubleElevenIDs.indexOf(activityData.id)!=-1){this.doubleElevenData[activityData.id]=activityData}else if(this.doubleTwelveRechargeIDAry.indexOf(activityData.id)!=-1){this.doubleTwelveRechargeData[activityData.id]=activityData}else if(this.doubleTwelveIDAry.indexOf(activityData.id)!=-1){this.doubleTwelveData[activityData.id]=activityData}else{this.activityData[activityData.id]=activityData}}this.postActivityIsGetAwards();return activityData?activityData.id:0};Activity.prototype.sendChangePage=function(actId){var bytes=this.getBytes(7);bytes.writeInt(actId);this.sendToServer(bytes)};Activity.prototype.doDaBiaoInfo=function(bytes){this.dabiaoDecode(bytes);this.postGetDaBiaoInfo()};Activity.prototype.postGetDaBiaoInfo=function(){};Activity.prototype.doNextDayLoginData=function(bytes){this.nextDayState=bytes.readShort();debug.log(this.nextDayState);this.initZeroEvent()};Activity.prototype.doNextDayLoginReward=function(bytes){var state=bytes.readShort();if(state){this.nextDayState=2;UserTips.ins().showTips(StringUtils.addColor(i18n("Activity_0"),15937822))}};Activity.prototype.sendNextDayReward=function(){var bytes=this.getBytes(20);this.sendToServer(bytes)};Activity.prototype.sendDabiaoInfo=function(dabiao){var bytes=this.getBytes(3);bytes.writeInt(dabiao);this.sendToServer(bytes)};Activity.prototype.sendGetDabiaoReward=function(dabiao){var bytes=this.getBytes(4);bytes.writeInt(dabiao);this.sendToServer(bytes)};Activity.prototype.postIsGetAwards=function(bytes){this.isGetAward=bytes.readBoolean()};Activity.prototype.sendGetSevenDayAwards=function(day){var bytes=this.getBytes(12);bytes.writeShort(day);this.sendToServer(bytes)};Activity.prototype.doSevenDayData=function(bytes){this.dayNum=bytes.readShort();this.isAwards=bytes.readInt();this.postSevendayIsAwards()};Activity.prototype.doChangeSevenDayData=function(bytes){var flag=bytes.readBoolean();if(flag){var changeDay=bytes.readShort();this.isAwards=bytes.readInt();this.postSevendayAwardCallback()}else{UserTips.ins().showTips(i18n("Activity_1"))}this.postSevendayIsAwards()};Activity.prototype.postSevendayAwardCallback=function(){};Activity.prototype.postSevendayIsAwards=function(){};Activity.prototype.postNextDayInfo=function(){};Activity.prototype.getSevenDayStast=function(){var day=DateUtils.DAYS_PER_WEEK;if(this.dayNum>14)day=14;else day=this.dayNum;for(var i=1;i<=day;i++){var config=GlobalConfig.LoginRewardsConfig[i];if(config){if(this.dayNum>=config.day){if((this.isAwards>>config.day&1)==0)return true}}}return false};Activity.prototype.checkNoticeRed=function(){var cfgs=GlobalConfig.WelfareConfig;var cfg=null;for(var k in cfgs){if(cfgs[k].type==5){cfg=cfgs[k]}}var activity=Activity.ins().getActivityDataById(cfg.activityId?cfg.activityId:0);return activity&&activity.canReward()};Activity.prototype.getSevenDayLogIsVisible=function(){return(this.isAwards>>14&1)==0};Activity.prototype.getbtnInfo=function(str){var config=GlobalConfig.ActivityBtnConfig;if(config[str]){return config[str]}return null};Activity.prototype.isShowRedPointByBtnInfo=function(abc){var result=false;result=this.isFirstShow(abc)||this.checkAcCanGet(abc.id+"");return result};Activity.prototype.isFirstShow=function(abc){return this.getfirstShowRedPointById(abc.id)};Activity.prototype.checkAcCanGet=function(index){if(this.doubleElevenIDs.indexOf(Number(index))!=-1){if(this.doubleElevenSpecialIDs.indexOf(Number(index))!=-1){var specialData;var len=this.doubleElevenSpecialIDs.length;for(var i=0;i<len;i++){specialData=this.doubleElevenData[this.doubleElevenSpecialIDs[i]];if(specialData.isSpecialOpen()&&specialData.canReward())return true}}else{var doubleData=this.doubleElevenData[Number(index)];if(doubleData.isOpenActivity()&&doubleData.canReward())return true}return false}if(this.doubleTwelveIDAry.indexOf(Number(index))!=-1){for(var i_8 in this.doubleTwelveData){if(i_8==index&&this.doubleTwelveData[i_8].isOpenActivity()&&this.doubleTwelveData[i_8].type==9){for(var j=0;j<3;j++){if(Activity.ins().isGetRollReward(this.doubleTwelveData[i_8].id,j))return true}}return false}}var data=this.activityData;for(var k in data){if(k==index&&data[k].isOpenActivity()&&data[k].canReward()&&data[k].specialState()){return true}}return false};Activity.prototype.checkOtherCharge2CanGet=function(){var rechargeData=Recharge.ins().getRechargeData(1);var config=GlobalConfig.ChongZhi2Config[rechargeData.day/7>=1?2:1][rechargeData.day%7];for(var k in config){if((rechargeData.isAwards>>config[k].index&1)==0&&rechargeData.num>=config[k].pay){return true}}return false};Activity.prototype.dabiaoDecode=function(bytes){this.isDaBiao=bytes.readBoolean();this.indexCurrDabiao=Math.max(bytes.readInt()-1,0);var rankType=bytes.readShort();if(rankType==RankDataType.TYPE_LEVEL){bytes.readInt();bytes.readInt()}else if(rankType==RankDataType.TYPE_BAOSHI){this.myDabiaoInfo=bytes.readInt()}else if(rankType==RankDataType.TYPE_ZHANLING){var zj=bytes.readInt();var zx=bytes.readInt();this.myDabiaoInfo=[zj,zx]}else if(rankType==RankDataType.TYPE_LONGHUN){this.myDabiaoInfo=bytes.readInt()}else if(rankType==RankDataType.TYPE_XIAOFEI){this.myDabiaoInfo=bytes.readInt();this.myPaiming=bytes.readInt()}else if(rankType==RankDataType.TYPE_HF_XIAOFEI){this.myDabiaoInfo=bytes.readInt();this.myPaiming=bytes.readInt()}else if(rankType==RankDataType.TYPE_XIANYU){this.myDabiaoInfo=bytes.readInt();this.myPaiming=bytes.readInt()}else{this.myDabiaoInfo=bytes.readDouble()}var len=bytes.readShort();var data;this.rankInfoList=[];for(var i=0;i<len;i++){if(!this.rankInfoList[i]){this.rankInfoList.push(new DabiaoData)}data=this.rankInfoList[i];data.prase(bytes,rankType)}};Activity.prototype.getisCangetDabiao3=function(id){var activityData=Activity.ins().getActivityDataById(id);if(activityData.canOnlyReward){activityData.canOnlyReward();return activityData.btn1||activityData.btn2}else{return this.checkAcCanGet(id+"")}};Activity.prototype.getisCanBuyXianGou=function(actId){var rtn=false;var configList=GlobalConfig.ActivityType2Config[actId];if(configList){for(var i=0;i<configList.length;i++){rtn=this.getisCanBuyXianGouItem(actId,i);if(rtn)break}}return rtn};Activity.prototype.getisCanBuyXianGouItem=function(actId,itemId){var rtn=false;var activityData=Activity.ins().activityData[actId];var configList=GlobalConfig.ActivityType2Config[actId];if(activityData&&configList){var config=configList[itemId];var buyData=activityData.buyData[itemId]||0;if(config&&buyData){var myMoney=config.currencyType==1?Actor.gold:Actor.yb;var a=config.currencyType==1;var b=parseInt(myMoney+"")>=config.price;var c=config.count-buyData>0;rtn=a&&b&&c}}return rtn};Activity.prototype.isDoubleElevenCanGet=function(){var data=this.doubleElevenData;for(var k in data){if(data[k].isSpecialOpen()&&data[k].canReward()){return true}}return false};Activity.prototype.IsHefuXunBaoTimer=function(){if(!GameServer._serverHeZeroTime)return false;var startTime=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);var endTime=startTime+GlobalConfig.TreasureHuntConfig.hefuDay*24*60*60*1e3;var curTime=GameServer.serverTime;if(curTime>=startTime&&curTime<=endTime){return true}return false};Activity.prototype.IsBossScoreTitle=function(id,title){var actconfig=GlobalConfig.ActivityType7Config[id];var actdata=Activity.ins().getActivityDataById(id);for(var k in actconfig){var cfg=actconfig[k];if(cfg.title==title){if(this.getIsBuy(cfg)&&actdata.bossScore>=cfg.score){return true}}}return false};Activity.prototype.getIsBuy=function(config){if(config){var activityData=Activity.ins().getActivityDataById(config.Id);if(config.count&&activityData.personalRewardsSum[config.index]>=config.count){return false}if(config.scount&&activityData.worldRewardsSum[config.index]>=config.scount){return false}return true}};Activity.prototype.getType7RedPoint=function(activityID){var itemData;var config=GlobalConfig.ActivityType7Config[activityID];var actdata=Activity.ins().getActivityDataById(activityID);if(config[1].showType==ActivityType7Data.TYPE_LABA){for(var i in config){var state=actdata.getExchange(config[i].index);if(state==Activity.CanGet)return true}}else{for(var i in config){if(Activity.ins().getIsBuy(config[i])){if(config[i].itemId){itemData=UserBag.ins().getBagItemById(config[i].itemId);if(itemData&&itemData.count>=config[i].itemCount)return true}else if(actdata.bossScore>=config[i].score)return true}}}return false};Activity.prototype.getCurrentRingAwardIndex=function(record){var index=1;if(record>0){while((record>>index&1)!=0){index++}}return index};Activity.prototype.getRingAward=function(index){for(var i in GlobalConfig.ActivityType8Config){var cfg=GlobalConfig.ActivityType8Config[i][1];if(cfg.showType==ActivityType8Data.TYPE_RING){for(var j in GlobalConfig.ActivityType8Config[i]){if(j==index.toString()){return GlobalConfig.ActivityType8Config[i][j]}}}}return null};Activity.prototype.getLastRingAward=function(){var lastCfg;for(var i in GlobalConfig.ActivityType8Config){var cfg=GlobalConfig.ActivityType8Config[i][1];if(cfg.showType==ActivityType8Data.TYPE_RING){for(var j in GlobalConfig.ActivityType8Config[i]){lastCfg=GlobalConfig.ActivityType8Config[i][j]}}}return lastCfg};Activity.prototype.addEvent=function(){MessageCenter.addListener(GameLogic.ins().postEnterMap,this.openRingActivity,this)};Activity.prototype.removeEvent=function(){MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap["funcallname"],this.openRingActivity,this)};Activity.prototype.openRingActivity=function(){if(GameMap.fbType==0){MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap["funcallname"],this.openRingActivity,this);ViewManager.ins().open(ActivityWin,201);Activity.ins().sendChangePage(201)}};Activity.prototype.getType8RedPoint=function(activityID){var isRedPoint=false;var data=Activity.ins().activityData[activityID];if(data&&data.record==0){isRedPoint=true}return isRedPoint};Activity.prototype.getType9RedPoint=function(activityID){var isRedPoint=false;var data=Activity.ins().activityData[activityID];if(this.getRollSum(activityID)){isRedPoint=true}else{var config=GlobalConfig.ActivityType9Config[activityID];if(Assert(config,"ActivityType9Config is null!! activityId:"+activityID)){return false}for(var i in config[0].reward){if(this.isGetRollReward(activityID,+i)){isRedPoint=true;break}}}return isRedPoint};Activity.prototype.getType28RedPoint=function(activityID){var isRedPoint=false;var data=Activity.ins().activityData[activityID];if(this.getRollSum28(activityID)){isRedPoint=true}else{isRedPoint=this.getType28ScoreRedPoint(activityID)}return isRedPoint};Activity.prototype.getType28ScoreRedPoint=function(activityID){var isRedPoint=false;var config=GlobalConfig.ActivityType28_3Config;for(var i in config){var c=config[i];if(this.isGetScoreReward28(activityID,c.id)){isRedPoint=true;break}}return isRedPoint};Activity.prototype.getType10RedPoint=function(activityID){var data=Activity.ins().activityData[activityID];var config=GlobalConfig.ActivityType10Config[activityID][data.getLevel()];if(!config)return false;if(data.yb>=config.recharge&&Actor.yb>=config.yuanBao)return true;return false};Activity.prototype.getType17RedPoint=function(activityID){var data=Activity.ins().activityData[activityID];var config=GlobalConfig.ActivityType17_2Config[activityID];if(!config)return false;if(data.score>=config.score)return true;return false};Activity.prototype.isGetRollReward=function(activityID,id){var data=Activity.ins().activityData[activityID];if(!data){data=Activity.ins().doubleTwelveData[activityID]}var config=GlobalConfig.ActivityType9Config[activityID];if(config&&config[0]){if(config[0].reward[id].times&&data.count>=config[0].reward[id].times&&!(data.record>>id+1&1)){return true}}return false};Activity.prototype.getRollSum=function(activityID){var config=GlobalConfig.ActivityType9Config[activityID];if(config&&config[0]){var itemData=UserBag.ins().getBagItemById(config[0].item);if(itemData){return true}}return false};Activity.prototype.getIsRollTen=function(activityID){var config=GlobalConfig.ActivityType9Config[activityID][0];if(config){var sum=0;if(config.item){var item=UserBag.ins().getBagItemById(config.item);if(item){sum+=item.count}if(sum>=10)return true}sum=10-sum;if(config.yb){if(Actor.yb>=config.yb*sum)return true}}return false};Activity.prototype.isGetScoreReward28=function(activityID,id){var state=this.getScoreReward28State(activityID,id);return state==1};Activity.prototype.getScoreReward28State=function(activityID,id){var state=0;var data=Activity.ins().activityData[activityID];var gotArr=data.gotArr||[];var got=gotArr.indexOf(id)>-1;if(got){state=2}else{var cfg=GlobalConfig.ActivityType28_3Config[id];if(!cfg){return state}var target=cfg.score;var score=data.score||0;if(score>=target){state=1}else{state=0}}return state};Activity.prototype.getCurShowScoreId=function(activityID){var cfg=GlobalConfig.ActivityType28_3Config;var found=-1;for(var i in cfg){var c=cfg[i];var id=c.id;var state=this.getScoreReward28State(activityID,id);if(state==1){found=id}}if(found>-1){return found}else{var data=Activity.ins().activityData[activityID];for(var i in cfg){var c=cfg[i];var id=c.id;var state=this.getScoreReward28State(activityID,id);if(state==0){found=id;return found}}}return 1};Activity.prototype.getRollSum28=function(activityID){var config=GlobalConfig.ActivityType28_1Config[activityID];if(config&&config[0]){var itemData=UserBag.ins().getBagItemById(config[0].item);if(itemData){return true}}return false};Activity.prototype.getIsRollTen28=function(activityID){var config=GlobalConfig.ActivityType28_1Config[activityID][0];if(config){var sum=0;if(config.item){var item=UserBag.ins().getBagItemById(config.item);if(item){sum+=item.count}if(sum>=10)return true}sum=10-sum;if(config.yb){if(Actor.yb>=config.yb*sum)return true}}return false};Activity.prototype.postError=function(bytes){var error_code=bytes.readShort();var error_info=bytes.readString();if(error_code!=0){UserTips.ins().showCenterTips(error_info)}};Activity.prototype.postKuaFuRank=function(bytes){var id=bytes.readInt();var len=bytes.readInt();var actData=Activity.ins().getActivityDataById(id);if(actData)actData.CleanRandData();for(var i=0;i<len;i++){var rankData=new KuaFuRankData;rankData.actorId=bytes.readInt();rankData.rmb=bytes.readInt();rankData.rank=bytes.readInt();rankData.serverId=bytes.readInt();rankData.roleName=bytes.readString();rankData.job=bytes.readInt();rankData.sex=bytes.readInt();if(actData)actData.SetRankData(rankData)}var mycost=bytes.readInt();if(actData)actData.mycost=mycost};Activity.prototype.postFirstHongBaoGot=function(bytes){this.hongBaoFirstGot=bytes.readInt()};Activity.prototype.postActFirstRechargeReward=function(bytes){var actId=bytes.readInt();var isMail=bytes.readShort();var actConfig=GlobalConfig.ActivityType26Config[actId]["1"];if(actConfig!=null){WarnWin.show(isMail==1?actConfig.yjts:actConfig.bbts,function(){},this,undefined,undefined,"sure")}};Activity.prototype.postActHuiShou=function(bytes){var actId=bytes.readInt();var equipCount=bytes.readInt();var ybCount=bytes.readInt();this.activityRecycleYbSum+=ybCount};Activity.prototype.sendKuaFuRank=function(actId){var bytes=this.getBytes(22);bytes.writeInt(actId);this.sendToServer(bytes)};Activity.prototype.checkLabaBossData=function(){for(var k in Activity.ins().activityData){if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.LABA){continue}if(Activity.ins().activityData[k].type==ActivityDataFactory.ACTIVITY_TYPE_20&&Activity.ins().getActivityDataById(+k).isOpenActivity()){var id=Activity.ins().activityData[k].id;var activityData=Activity.ins().getActivityDataById(id);return activityData}}return null};Activity.prototype.getConfig22_3=function(id){var items=GlobalConfig.ActivityType22_3Config[id];var config;var obj;for(var key in items){obj=items[key];for(var key2 in obj){if(obj[key2].low<=UserZs.ins().lv&&UserZs.ins().lv<=obj[key2].high)return obj[key2]}}return null};Activity.prototype.sendEnvelopeData=function(id,eid){var bytes=this.getBytes(6);bytes.writeInt(id);bytes.writeUnsignedShort(eid);this.sendToServer(bytes)};Activity.prototype.postEnvelopeData=function(bytes){var id=bytes.readInt();var isSuccess=bytes.readByte();if(isSuccess){var eId=bytes.readUnsignedShort();var job=bytes.readShort();var sex=bytes.readShort();var index=bytes.readShort();var serverId=bytes.readInt();var name_3=bytes.readString();var desc=bytes.readString();var eld=new EnvelopeData;eld.id=id;eld.eId=eId;eld.job=job;eld.sex=sex;eld.index=index;eld.serverId=serverId;eld.name=name_3;eld.desc=desc;this.postEnvelopeDataCall(eld);return}this.postEnvelopeDataCall(null)};Activity.prototype.postEnvelopeDataCall=function(eld){return eld};Activity.prototype.postRedEnvelopeData=function(bytes){var id=bytes.readInt();if(this.activityData[id]&&this.activityData[id]instanceof ActivityType12Data){var actData=this.activityData[id];var control=bytes.readShort();var len=bytes.readShort();if(control==1){if(len){var reld=new RedEnvelope;reld.id=bytes.readUnsignedShort();reld.timer=bytes.readInt();actData.envelopeData.push(reld)}}else{var arr=[];for(var i=0;i<len;i++){var reld=new RedEnvelope;reld.id=bytes.readUnsignedShort();reld.timer=bytes.readInt();arr.push(reld)}actData.envelopeData=arr}}};Activity.prototype.checkActivityTimer=function(){for(var k in this.activityData){if(this.activityData[k]instanceof ActivityType12Data){if(!TimerManager.ins().isExists(this.ActivityTimerSecond1,this))TimerManager.ins().doTimer(1e3,0,this.ActivityTimerSecond1,this);break}}};Activity.prototype.postGetRedEnvelope=function(id,eid,yb,gold,arr,isSucceed){return[id,eid,yb,gold,arr,isSucceed]};Activity.prototype.ActivityTimerSecond1=function(){for(var i=0;i<this._actTimeSecond1.length;){var id=this._actTimeSecond1[i];if(this.activityData[id]){if(!this.activityData[id].isOpenActivity()){if(this.activityData[id]instanceof ActivityType12Data){var actData=this.activityData[id];actData.clearAll()}this._actTimeSecond1.splice(i,1);continue}if(this.activityData[id]instanceof ActivityType12Data){var actData=this.activityData[id];actData.checkClear()}}i++}};Object.defineProperty(Activity.prototype,"activityTimers",{get:function(){this._actTimeSecond1=this._actTimeSecond1?this._actTimeSecond1:[];return this._actTimeSecond1},enumerable:true,configurable:true});Activity.prototype.postShowReward=function(actID){return actID};Activity.prototype.updateActivity=function(actID){if(!this.fns[actID]){this.fns[actID]=function(){var act=Activity.ins().getActivityDataById(actID);if(!act||!act.isOpenActivity())return;Activity.ins().sendChangePage(actID)}}return this.fns[actID]};Object.defineProperty(Activity.prototype,"fns",{get:function(){return Activity._fns},enumerable:true,configurable:true});Activity.NotReached=0;Activity.CanGet=1;Activity.Geted=2;Activity.NOKILL=0;Activity.KILL=1;Activity._fns={};return Activity}(BaseSystem);__reflect(Activity.prototype,"Activity");var DabiaoData=function(){function DabiaoData(){}DabiaoData.prototype.prase=function(bytes,rankType){if(rankType==RankDataType.TYPE_XIAOFEI||rankType==RankDataType.TYPE_HF_XIAOFEI||rankType==RankDataType.TYPE_XIANYU){this.rankIndex=bytes.readShort();this.id=bytes.readInt();this.name=bytes.readString();this.numType=bytes.readInt();return}this.rankIndex=bytes.readShort();this.id=bytes.readInt();this.name=bytes.readString();this.level=bytes.readShort();this.zsLevel=bytes.readShort();this.monthCard=bytes.readShort();this.vipLv=bytes.readShort();if(RankDataType.TYPE_LEVEL!=rankType){if(rankType==RankDataType.TYPE_BAOSHI||rankType==RankDataType.TYPE_LONGHUN){this.numType=bytes.readInt()}else if(rankType==RankDataType.TYPE_ZHANLING){var zj=bytes.readInt();var zx=bytes.readInt();this.numType=[zj,zx]}else{this.numType=bytes.readDouble()}}};return DabiaoData}();__reflect(DabiaoData.prototype,"DabiaoData");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.activity=Activity.ins.bind(Activity)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ActivityBtnType=function(){function ActivityBtnType(){}ActivityBtnType.LEI_JI_1=1;ActivityBtnType.DA_BIAO=2;ActivityBtnType.CHONG_JI=3;ActivityBtnType.LEI_JI_2=4;ActivityBtnType.XIAN_GOU=5;ActivityBtnType.QI_XI_XIAN_GOU=6;ActivityBtnType.TE_HUI_1=7;ActivityBtnType.LEI_JI_3=8;ActivityBtnType.TE_HUI_2=9;ActivityBtnType.LEI_JI_4=10;ActivityBtnType.TE_HUI_3=11;ActivityBtnType.ZHONG_QIU=12;ActivityBtnType.SHENG_XIA=13;ActivityBtnType.GUO_QING_LEI_JI=14;ActivityBtnType.GUO_QING_DENG_LU=15;ActivityBtnType.GUO_QING_XIAN_GOU=16;ActivityBtnType.LEI_JI_DAYS42=10002;ActivityBtnType.LEI_JI_EVERYDAY=10003;ActivityBtnType.THREE_HEROES=10004;ActivityBtnType.HEFU_XUNBAO=10005;ActivityBtnType.HEFU_BOSS=10006;ActivityBtnType.HEFU_JZLC=10007;ActivityBtnType.HEFU_CZZS=10008;ActivityBtnType.SANRI_RECHARGE=10017;return ActivityBtnType}();__reflect(ActivityBtnType.prototype,"ActivityBtnType");var HBSystem=function(_super){__extends(HBSystem,_super);function HBSystem(){var _this=_super.call(this)||this;_this.observe(Activity.ins().postGetRedEnvelope,_this.showHongBaoTips);_this.observe(Activity.ins().postRewardResult,_this.ActRewardResult);_this.observe(Activity.ins().postEnvelopeDataCall,_this.showEnvelope);_this.observe(Activity.ins().postRedEnvelopeData,_this.updateHongBao);return _this}HBSystem.ins=function(){return _super.ins.call(this)};HBSystem.prototype.updateHongBao=function(){var view=ViewManager.ins().getView(PlayFunView);if(!view||!view.hongbao)return;if(view.hongbao.numElements>0)return;for(var i=0;i<Activity.ins().activityTimers.length;i++){var actId=Activity.ins().activityTimers[i];if(Activity.ins().activityData[actId]){if(Activity.ins().activityData[actId]instanceof ActivityType12Data){var actData=Activity.ins().activityData[actId];if(!actData.envelopeData.length)continue;for(var j=actData.envelopeData.length-1;j>=0;){j=actData.envelopeData.length-1;if(!actData.envelopeData[j]){actData.envelopeData.splice(i,1);continue}var eId=actData.envelopeData[j].id;if(!actData.envelopeData[j].isOverTimer()){var isOpen=OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY);if(Activity.ins().hongBaoFirstGot==1&&!isOpen){return}var item=new HongBaoShowItem;item.data={actId:actId,eId:eId,redEnvelope:actData.envelopeData[j]};view.hongbao.addChild(item);Activity.ins().hongBaoFirstGot=1;break}else{actData.popEnvelope(eId)}}}}}};HBSystem.prototype.showHongBaoTips=function(param){var actId=param[0];var eId=param[1];var yb=param[2];var gold=param[3];var arr=param[4];var isSucceed=param[5];var actData=Activity.ins().activityData[actId];if(actData){if(yb){var reward=new RewardData;reward.type=0;reward.id=MoneyConst.yuanbao;reward.count=yb;UserTips.ins().showGoodRewardTips(reward)}if(eId)actData.popEnvelope(eId);this.HongBaoResultAni(arr,isSucceed)}};HBSystem.prototype.HongBaoResultAni=function(arr,isSucceed){var view=ViewManager.ins().getView(PlayFunView);if(!view||!view.hongbao)return;var item=view.hongbao.getChildAt(1);if(item){item.playAni(arr,this.updateHongBao,this,isSucceed)}};HBSystem.prototype.ActRewardResult=function(activityID){if(Activity.ins().activityTimers.indexOf(activityID)==-1)return;if(Activity.ins().activityData[activityID]){if(Activity.ins().activityData[activityID]instanceof ActivityType12Data){if(!Activity.ins().isSuccee){if(Activity.ins().activityData[activityID].isOpenActivity())UserTips.ins().showTips(i18n("HBSystem_0"));else UserTips.ins().showTips(i18n("HBSystem_1"))}}}};HBSystem.prototype.showEnvelope=function(eld){var view=ViewManager.ins().getView(PlayFunView);if(!view||!view.hongbao)return;if(!eld){UserTips.ins().showTips(i18n("HBSystem_2"));view.hongbao.removeChildren();this.updateHongBao();return}if(Activity.ins().activityData[eld.id]){if(Activity.ins().activityData[eld.id]instanceof ActivityType12Data){var item=new HongBaoOpenItem;if(!eld.desc){eld.desc=GlobalConfig.ActivityType12Config[eld.id][eld.index].blessWord}item.data={actId:eld.id,eId:eld.eId,job:eld.job,sex:eld.sex,name:eld.name,text:eld.desc,index:eld.index};view.hongbao.addChildAt(item,1)}}};return HBSystem}(BaseSystem);__reflect(HBSystem.prototype,"HBSystem");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.hbsystem=HBSystem.ins.bind(HBSystem)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ThreeHeroes=function(_super){__extends(ThreeHeroes,_super);function ThreeHeroes(){var _this=_super.call(this)||this;_this.sysId=PackageID.ThreeHeroes;_this.regNetMsg(1,_this.doGotAward);_this.regNetMsg(2,_this.doAwardInfo);return _this}ThreeHeroes.ins=function(){return _super.ins.call(this)};ThreeHeroes.prototype.doGotAward=function(bytes){if(bytes.readByte()>0){this.awardState=ThreeHeroes.Geted;this.postInfoChange()}};ThreeHeroes.prototype.doAwardInfo=function(bytes){var state=bytes.readBoolean();this.loginDays=bytes.readShort();this.showIcon3DaysLater=bytes.readBoolean();ActivityDataFactory.createEx();var data=Activity.ins().activityData[ActivityBtnType.THREE_HEROES];if(data){var beganTime=Math.floor((data.startTime-GameServer.serverTime)/1e3);var endedTime=Math.floor((data.endTime-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){if(UserVip.ins().lv>=GlobalConfig.LoginActivateConfig.vipLevel)this.awardState=ThreeHeroes.Active;else this.awardState=ThreeHeroes.NotActive;MessageCenter.addListener(UserVip.ins().postUpdateVipData,this.updateStateByVip,this);MessageCenter.addListener(UserVip.ins().postUpdataExp,this.updateStateByVip,this)}else{if(this.showIcon3DaysLater){if(this.loginDays>=GlobalConfig.LoginActivateConfig.loginDays)this.awardState=ThreeHeroes.CanGet;else this.awardState=ThreeHeroes.Active}else this.awardState=state?ThreeHeroes.Geted:ThreeHeroes.NotActive;MessageCenter.ins().removeAll(this)}}Activity.ins().postActivityIsGetAwards();this.postInfoChange()};ThreeHeroes.prototype.updateStateByVip=function(){var data=Activity.ins().activityData[ActivityBtnType.THREE_HEROES];if(data){var beganTime=Math.floor((data.startTime-GameServer.serverTime)/1e3);var endedTime=Math.floor((data.endTime-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){if(UserVip.ins().lv>=GlobalConfig.LoginActivateConfig.vipLevel)this.awardState=ThreeHeroes.Active;else this.awardState=ThreeHeroes.NotActive}}this.postInfoChange()};ThreeHeroes.prototype.sendReward=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};ThreeHeroes.prototype.postInfoChange=function(){};ThreeHeroes.NotActive=0;ThreeHeroes.Active=1;ThreeHeroes.CanGet=2;ThreeHeroes.Geted=3;return ThreeHeroes}(BaseSystem);__reflect(ThreeHeroes.prototype,"ThreeHeroes");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.threeHeros=ThreeHeroes.ins.bind(ThreeHeroes)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GuideUtils=function(_super){__extends(GuideUtils,_super);function GuideUtils(){var _this=_super.call(this)||this;_this.step=0;_this.part=0;_this.wrongCount=0;_this.maxWrongCount=2;return _this}GuideUtils.ins=function(){return _super.ins.call(this)};GuideUtils.prototype.init=function(){if(this.isInit)return;this.isInit=true;if(Setting.currPart==0){this.part=1;this.step=1}else{this.part=Setting.currPart;this.step=Setting.currStep}this.cfg=[];var temp;for(var i in GlobalConfig.GuideConfig){temp=[];for(var j in GlobalConfig.GuideConfig[i]){temp.push(GlobalConfig.GuideConfig[i][j])}this.cfg.push(temp)}if(this.part<=this.cfg.length){var len=this.cfg[this.part-1].length-1;this.overs=this.cfg[this.part-1][len].overs}if(this.part<=this.cfg.length){MessageCenter.addListener(UserTask.ins().postUpdteTaskTrace,this.updateByTask,this)}};GuideUtils.prototype.updateByTask=function(){this.guideOver();this.update(1)};GuideUtils.prototype.updateByClick=function(){this.update(2)};GuideUtils.prototype.updateByAppear=function(){this.update(3)};GuideUtils.prototype.canShow=function(){if(Assert(this.cfg,i18n("GuideUtils_0"))){return false}if(this.part>this.cfg.length){MessageCenter.ins().removeAll(this);return false}if(this.view&&this.view.parent)return false;return true};GuideUtils.prototype.checkShow=function(){if(!this.curCfg)return false;try{var displayObject=this.getDisplayObj(this.part,this.step);if(!displayObject){return false}}catch(e){return false}return true};GuideUtils.prototype.addTimeHandler=function(){if(!TimerManager.ins().isExists(this.timeHandler,this)){TimerManager.ins().doTimer(50,0,this.timeHandler,this)}};GuideUtils.prototype.removeTimeHandler=function(){TimerManager.ins().remove(this.timeHandler,this)};GuideUtils.prototype.timeHandler=function(){if(this.canShow()){if(this.checkShow()){this.show(this.part,this.step)}}else{this.removeTimeHandler()}};GuideUtils.prototype.guideOver=function(){var data=UserTask.ins().taskTrace;if(this.overs&&data&&data.state==0){var len=this.overs.length;for(var i=0;i<len;i++){var over=this.overs[i];if(over.type==1&&over.value==data.id){this.readyForNext();this.close();return}}}};GuideUtils.prototype.update=function(type){if(type===void 0){type=0}if(this.canShow()==false)return;this.curCfg=this.cfg[this.part-1][this.step-1];if(!this.curCfg||!this.curCfg.start)return;if(type==1){if(this.curCfg.start.type==1){var data=UserTask.ins().taskTrace;if(data.id==this.curCfg.start.value)if(data.state==0)GuideUtils.ins().show(this.part,this.step)}else if(this.curCfg.start.type==3){var data=UserTask.ins().taskTrace;if(data.id==this.curCfg.start.value&&data.state==1)GuideUtils.ins().show(this.part,this.step)}}else if(type==2){if(this.curCfg.start.type==2){var data=UserTask.ins().taskTrace;if(data.id==this.curCfg.start.value&&data.state==0)GuideUtils.ins().show(this.part,this.step)}}else if(type==3){if(this.curCfg.start.type==4){GuideUtils.ins().show(this.part,this.step)}}};GuideUtils.prototype.show=function(part,step){var _this=this;this.part=part;this.step=step;var cfg=this.cfg[this.part-1];if(cfg){this.curCfg=this.cfg[this.part-1][this.step-1]}else{this.curCfg=null}if(!this.curCfg){this.readyForNext();this.close();return}if(!this.checkShow()){this.close();this.addTimeHandler();return}if(this.view==null){this.view=new GuideView}this.view.clickCD=true;if(!this.view.hasEventListener(egret.Event.CHANGE))this.view.addEventListener(egret.Event.CHANGE,this.next,this);this.save();var displayObject;try{displayObject=this.getDisplayObj(part,step)}catch(e){if(this.wrongCount>=this.maxWrongCount){this.close();return}else{this.wrongCount++;this.view.close();console.log(i18n("GuideUtils_2",part,step));TimerManager.ins().doTimer(300,1,function(){_this.show(part,step-1)},this);return}}if(displayObject){console.log(i18n("GuideUtils_3",part,step));TimerManager.ins().doNext(function(){_this.view.show(displayObject);StageUtils.ins().getStage().addChild(_this.view)},this)}else{this.readyForNext();this.close()}};GuideUtils.prototype.clickOut=function(){if(this.curCfg&&this.curCfg.type==1){this.readyForNext();this.close()}};GuideUtils.prototype.readyForNext=function(){this.part++;this.step=1;if(this.part<=this.cfg.length){var len=this.cfg[this.part-1].length-1;this.overs=this.cfg[this.part-1][len].overs}else this.overs=null;this.curCfg=null};GuideUtils.prototype.close=function(){if(this.view){DisplayUtils.removeFromParent(this.view);this.view.close();this.view.removeEventListener(egret.Event.CHANGE,this.next,this);this.wrongCount=0}this.removeTimeHandler()};GuideUtils.prototype.next=function(){var _this=this;TimerManager.ins().doNext(function(){_this.show(_this.part,_this.step+1)},this)};GuideUtils.prototype.save=function(){if(this.step==1){Setting.ins().setValue(ClientSet.guidePart,this.part+1);Setting.ins().setValue(ClientSet.guideStep,1)}};GuideUtils.prototype.myparse=function(v,s){if(v==null){return null}if(Number(s)==Number(s)){return Number(s)}var fields=[];var C_DOT=".".charCodeAt(0);var C_LP="(".charCodeAt(0);var C_RP=")".charCodeAt(0);var C_S=",".charCodeAt(0);var i0=0;var curf=null;var curp=null;for(var i=0,ci=s.length;i<ci;++i){var c=s.charCodeAt(i);if(c==C_DOT){if(curf==null&&i0<i){curf=s.substr(i0,i-i0)}if(curf!=null){fields.push({f:curf,p:curp});curf=null;curp=null}i0=i+1}else if(c==C_LP){curf=s.substr(i0,i-i0);for(var j=i+1;j<ci;++j){if(s.charCodeAt(j)==C_RP){if(j==i+1){curp=[]}else{curp=[this.myparse(window,s.substr(i+1,j-i-1))]}i=j;break}}}}if(curf==null&&i0<s.length){curf=s.substr(i0)}if(curf!=null){fields.push({f:curf,p:curp});curf=null;curp=null}for(var _i=0,fields_1=fields;_i<fields_1.length;_i++){var field=fields_1[_i];if(field.p==null){v=v[field.f]}else{v=v[field.f].apply(v,field.p)}}return v};GuideUtils.prototype.getDisplayObj=function(part,step){var displayObject;var cfg;if(this.cfg[part-1]&&step<=this.cfg[part-1].length){cfg=this.cfg[part-1][step-1];var v=ViewManager.ins().getView(cfg.view);displayObject=this.myparse(v,cfg.target)}return displayObject};return GuideUtils}(BaseClass);__reflect(GuideUtils.prototype,"GuideUtils");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.guideUtils=GuideUtils.ins.bind(GuideUtils)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ActivityDataFactory=function(){function ActivityDataFactory(){}ActivityDataFactory.create=function(bytes){var id=bytes.readInt();var startTime=bytes.readInt();var endTime=bytes.readInt();var type=bytes.readShort();var len=bytes.readInt();console.log("activity type = "+type);var data;switch(type){case ActivityDataFactory.ACTIVITY_TYPE_1:data=new ActivityType1Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_2:data=new ActivityType2Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_3:data=new ActivityType3Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_4:data=new ActivityType4Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_5:data=Activity.ins().getActivityDataById(id);if(!data)data=new ActivityType5Data(bytes);else data.updateRecord(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_6:data=new ActivityType6Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_7:data=new ActivityType7Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_8:data=new ActivityType8Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_9:data=new ActivityType9Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_10:data=new ActivityType10Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_11:data=new ActivityType11Data(bytes,id,startTime,endTime);break;case ActivityDataFactory.ACTIVITY_TYPE_12:if(!Activity.ins().activityData[id])data=new ActivityType12Data(bytes,id);else{data=Activity.ins().activityData[id];data.init(bytes,id)}break;case ActivityDataFactory.ACTIVITY_TYPE_17:data=new ActivityType17Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_18:data=new ActivityType18Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_19:data=new ActivityType19Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_20:data=new ActivityType20Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_21:data=new ActivityType21Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_22:data=new ActivityType22Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_23:data=new ActivityType23Data(bytes);console.log("ACTIVITY_TYPE_23 = "+type);break;case ActivityDataFactory.ACTIVITY_TYPE_24:data=new ActivityType24Data(bytes);console.log("ACTIVITY_TYPE_24 = "+type);break;case ActivityDataFactory.ACTIVITY_TYPE_25:data=new ActivityType25Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_26:data=new ActivityType26Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_27:data=new ActivityType27Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_28:data=new ActivityType28_1Data(bytes);break;case ActivityDataFactory.ACTIVITY_TYPE_29:data=Activity.ins().getActivityDataById(id);if(!data)data=new ActivityType29Data(bytes);else data.updateRecord(bytes);break;default:{debug.log(i18n("ActivityDataFactory_0")+type);for(var i=0;i<len;i++){bytes.readByte()}return null}}if(!data)return null;data.id=id;data.startTime=startTime;data.endTime=endTime;data.type=type;data.activityType=ActivityType.Normal;var cfg=GlobalConfig.ActivityConfig[id];if(cfg){data.timeType=cfg.timeType;data.pageStyle=cfg.pageStyle;data.pageSkin=cfg.pageSkin}return data};ActivityDataFactory.createEx=function(){var data;var actConfig=GlobalConfig.ActivityBtnConfig;var serverZeroTime=DateUtils.formatMiniDateTime(GameServer._serverZeroTime);var serverHeZeroTime=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);for(var k in actConfig){var cfg=actConfig[k];var curhefuCount=cfg.hfTimes?cfg.hfTimes:0;var timeType=cfg.timeType?cfg.timeType:0;if(timeType&&timeType==ActivityDataFactory.TimeType_Total&&(curhefuCount&&curhefuCount!=GameServer._hefuCount))continue;if(cfg.id>1e4){data=new ActivityType0Data(null);data.id=cfg.id;data.type=cfg.type;data.activityType=ActivityType.Normal;data.timeType=cfg.timeType;if(cfg.pageStyle)data.pageStyle=cfg.pageStyle;if(cfg.relyOn){data.relyOn=cfg.relyOn;for(var i=0;i<cfg.relyOn.length;i++){if(Activity.ins().activityData[cfg.relyOn[i]]){data.startTime=DateUtils.formatMiniDateTime(Activity.ins().activityData[cfg.relyOn[i]].startTime);data.endTime=DateUtils.formatMiniDateTime(Activity.ins().activityData[cfg.relyOn[i]].endTime);break}}}else if(cfg.timeType==ActivityDataFactory.TimeType_Normal){var arr=cfg.startTime.split("-");var openDay=+arr[0];var openTime=arr[1].split(":");var startDate=new Date(serverZeroTime);startDate.setDate(startDate.getDate()+openDay);startDate.setHours(+openTime[0],+openTime[1],0,0);data.startTime=startDate.getTime();if(cfg.endTime){arr=cfg.endTime.split("-");var endDay=+arr[0];var endTime=arr[1].split(":");var endDate=new Date(serverZeroTime);endDate.setDate(endDate.getDate()+endDay);endDate.setHours(+endTime[0],+endTime[1],0,0);data.endTime=endDate.getTime()}else{data.endTime=GameServer.serverTime+30*24*60*60*1e3}}else if(cfg.timeType==ActivityDataFactory.TimeType_Fixed){data.startTime=new Date(cfg.startTime).getTime();data.endTime=new Date(cfg.endTime).getTime()}else if(cfg.timeType==ActivityDataFactory.TimeType_Total){var arr=[];var endDay=DateUtils.DAYS_PER_WEEK;if(cfg.endTime){arr=cfg.endTime.split("-");endDay=+arr[0]}switch(cfg.id){case ActivityBtnType.HEFU_XUNBAO:data.startTime=serverHeZeroTime;data.endTime=serverHeZeroTime+GlobalConfig.TreasureHuntConfig.hefuDay*24*60*60*1e3;break;case ActivityBtnType.HEFU_BOSS:case ActivityBtnType.HEFU_JZLC:case ActivityBtnType.HEFU_CZZS:data.startTime=serverHeZeroTime;data.endTime=serverHeZeroTime+endDay*DateUtils.SECOND_PER_DAY*1e3;break}}else{data.startTime=serverZeroTime;data.endTime=GameServer.serverTime+30*24*60*60*1e3}var endedTime=Math.floor((data.endTime-GameServer.serverTime)/1e3);if(endedTime>0){Activity.ins().activityData[cfg.id]=data}else{if(cfg.id==ActivityBtnType.THREE_HEROES){if(ThreeHeroes.ins().showIcon3DaysLater)Activity.ins().activityData[cfg.id]=data}}}}};ActivityDataFactory.TimeType_Normal=0;ActivityDataFactory.TimeType_Fixed=1;ActivityDataFactory.TimeType_Total=2;ActivityDataFactory.ACTIVITY_TYPE_1=1;ActivityDataFactory.ACTIVITY_TYPE_2=2;ActivityDataFactory.ACTIVITY_TYPE_3=3;ActivityDataFactory.ACTIVITY_TYPE_4=4;ActivityDataFactory.ACTIVITY_TYPE_5=5;ActivityDataFactory.ACTIVITY_TYPE_6=6;ActivityDataFactory.ACTIVITY_TYPE_7=7;ActivityDataFactory.ACTIVITY_TYPE_8=8;ActivityDataFactory.ACTIVITY_TYPE_9=9;ActivityDataFactory.ACTIVITY_TYPE_10=10;ActivityDataFactory.ACTIVITY_TYPE_11=11;ActivityDataFactory.ACTIVITY_TYPE_12=12;ActivityDataFactory.ACTIVITY_TYPE_17=17;ActivityDataFactory.ACTIVITY_TYPE_18=18;ActivityDataFactory.ACTIVITY_TYPE_19=19;ActivityDataFactory.ACTIVITY_TYPE_20=20;ActivityDataFactory.ACTIVITY_TYPE_21=21;ActivityDataFactory.ACTIVITY_TYPE_22=22;ActivityDataFactory.ACTIVITY_TYPE_23=23;ActivityDataFactory.ACTIVITY_TYPE_24=24;ActivityDataFactory.ACTIVITY_TYPE_25=25;ActivityDataFactory.ACTIVITY_TYPE_26=26;ActivityDataFactory.ACTIVITY_TYPE_27=27;ActivityDataFactory.ACTIVITY_TYPE_28=28;ActivityDataFactory.ACTIVITY_TYPE_29=29;return ActivityDataFactory}();__reflect(ActivityDataFactory.prototype,"ActivityDataFactory");var ActivityPageStyle;(function(ActivityPageStyle){ActivityPageStyle[ActivityPageStyle["THANKS"]=1]="THANKS";ActivityPageStyle[ActivityPageStyle["NEWYEAR"]=2]="NEWYEAR";ActivityPageStyle[ActivityPageStyle["CHRISTMAS"]=3]="CHRISTMAS";ActivityPageStyle[ActivityPageStyle["HAPPYSEVENDAY"]=4]="HAPPYSEVENDAY";ActivityPageStyle[ActivityPageStyle["TOTALRECHARGE"]=5]="TOTALRECHARGE";ActivityPageStyle[ActivityPageStyle["CELEBRATION"]=6]="CELEBRATION";ActivityPageStyle[ActivityPageStyle["LABA"]=7]="LABA";ActivityPageStyle[ActivityPageStyle["YBZHUANPAN"]=8]="YBZHUANPAN";ActivityPageStyle[ActivityPageStyle["ZHANLING"]=9]="ZHANLING";ActivityPageStyle[ActivityPageStyle["SPRINGBEGIN"]=10]="SPRINGBEGIN";ActivityPageStyle[ActivityPageStyle["XIAONIAN"]=11]="XIAONIAN";ActivityPageStyle[ActivityPageStyle["SPRINGFESTIVAL"]=12]="SPRINGFESTIVAL";ActivityPageStyle[ActivityPageStyle["SPRINGEIGHTDAY"]=13]="SPRINGEIGHTDAY";ActivityPageStyle[ActivityPageStyle["KAIMENHONG"]=14]="KAIMENHONG";ActivityPageStyle[ActivityPageStyle["SANBA"]=15]="SANBA";ActivityPageStyle[ActivityPageStyle["LONGTAITOU"]=16]="LONGTAITOU";ActivityPageStyle[ActivityPageStyle["VERSIONCELE"]=17]="VERSIONCELE";ActivityPageStyle[ActivityPageStyle["DUANWU"]=18]="DUANWU";ActivityPageStyle[ActivityPageStyle["CONSUMREWARD"]=19]="CONSUMREWARD";ActivityPageStyle[ActivityPageStyle["ACTIVITY_FIRST_RECHAGE"]=20]="ACTIVITY_FIRST_RECHAGE"})(ActivityPageStyle||(ActivityPageStyle={}));window["ActivityPageStyle"]=ActivityPageStyle;var ActivityType0Data=function(_super){__extends(ActivityType0Data,_super);function ActivityType0Data(bytes){return _super.call(this,bytes)||this}ActivityType0Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes)};ActivityType0Data.prototype.specialState=function(){var hefuTime=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);var timeS;var date;var timeE;var dateE;if(this.id==ActivityBtnType.HEFU_BOSS){var openTime=[0,1,3,5];for(var i=0;i<openTime.length;i++){timeS=hefuTime+openTime[i]*DateUtils.MS_PER_DAY;date=new Date(timeS);date.setHours(20,30,0);timeE=hefuTime+(openTime[i]+1)*DateUtils.MS_PER_DAY;dateE=new Date(timeE);if(GameServer.serverTime>=date.getTime()&&GameServer.serverTime<dateE.getTime()){var cof=GlobalConfig.CityBossConfig[i+1];if(!cof){return false}var killBossId=cof.killBossId;var obj=CityCC.ins().bossKillNumData;if(obj&&obj[killBossId]!=undefined&&obj[killBossId][1]!=1){return true}}}return false}else if(this.id==ActivityBtnType.HEFU_JZLC){var openTime=GlobalConfig.GuildBattleConst.hefuOpen;if(!openTime){return false}if(GuildWar.ins().getModel().isWatStart){return true}return false}return true};ActivityType0Data.prototype.canReward=function(){if(this.id==ActivityBtnType.LEI_JI_DAYS42){return Recharge.ins().rechargeTotal.hasGetDays.length<Recharge.ins().rechargeTotal.totalDay}else if(this.id==ActivityBtnType.LEI_JI_EVERYDAY){var data=Recharge.ins().getRechargeData(0);var configs=Recharge.ins().getCurRechargeConfig();for(var k in configs){var config=configs[k];if(data.curDayPay>=config.pay){var state=data.isAwards>>config.index&1;if(!state){return true}}}}else if(this.id==ActivityBtnType.THREE_HEROES)return ThreeHeroes.ins().awardState==ThreeHeroes.CanGet;else if(this.id==ActivityBtnType.HEFU_JZLC||this.id==ActivityBtnType.HEFU_BOSS){return true}else if(this.id==ActivityBtnType.SANRI_RECHARGE){var confing=GlobalConfig.MultiDayRechargeConfig;for(var i in confing){var conf=confing[i];if(Recharge.ins().mDayNum==parseInt(i)&&Recharge.ins().mRecNum>=conf.num&&Recharge.ins().mReward==0){return true}}}var aCon=GlobalConfig.ActivityBtnConfig[this.id];if(aCon&&aCon.jump&&aCon.jump[0]==StatePageSysType.RING){if(LyMark.ins().checkOpen()){if(!LyMark.ins().isMax){var cfg=GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv];var itemData=UserBag.ins().getBagItemById(cfg.costItem);var count=itemData?itemData.count:0;return count>=cfg.costCount}}}return false};ActivityType0Data.prototype.getHide=function(){if(this.isHide)return this.isHide;if(this.id==ActivityBtnType.LEI_JI_DAYS42){if(Recharge.ins().rechargeTotal.hasGetDays.length>=CommonUtils.getObjectLength(GlobalConfig.RechargeDaysAwardsConfig)){this.isHide=true}}else if(this.id==ActivityBtnType.THREE_HEROES)this.isHide=!this.isOpenActivity();else if(this.id==ActivityBtnType.HEFU_BOSS){var openTime=[0,1,3,5];var cof=GlobalConfig.CityBossConfig[openTime.length];if(cof){var killBossId=cof.killBossId;var obj=CityCC.ins().bossKillNumData;if(obj&&obj[killBossId]!=undefined&&obj[killBossId][1]>=1){this.isHide=true}}}else if(this.id==ActivityBtnType.HEFU_JZLC){var hefuTime=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);var openTime=GlobalConfig.GuildBattleConst.hefuOpen;var i=openTime.length-1;var timeE=hefuTime+openTime[i].day*DateUtils.MS_PER_DAY;var dateE=new Date(timeE);dateE.setHours(0,0,0);if(GameServer.serverTime>dateE.getTime()){return true}}return this.isHide};ActivityType0Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((this.startTime-GameServer.serverTime)/1e3);var endedTime=Math.floor((this.endTime-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}else if(this.id==ActivityBtnType.THREE_HEROES)return ThreeHeroes.ins().showIcon3DaysLater;return false};return ActivityType0Data}(ActivityBaseData);__reflect(ActivityType0Data.prototype,"ActivityType0Data");var StatePageSysType;(function(StatePageSysType){StatePageSysType[StatePageSysType["WING"]=1]="WING";StatePageSysType[StatePageSysType["RING"]=2]="RING"})(StatePageSysType||(StatePageSysType={}));window["StatePageSysType"]=StatePageSysType;var ActivityType10Data=function(_super){__extends(ActivityType10Data,_super);function ActivityType10Data(bytes){var _this=_super.call(this,bytes)||this;_this.update(bytes);return _this}ActivityType10Data.prototype.update=function(bytes){this.record=bytes.readInt();this.yb=bytes.readInt();this.index=bytes.readInt();this.state=bytes.readByte();var len=bytes.readByte();this.noticeArr=[];for(var i=0;i<len;i++){this.noticeArr.push({name:bytes.readString(),multiple:bytes.readDouble(),yb:bytes.readInt()})}this.noticeArr.reverse()};ActivityType10Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType10Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType10Data.prototype.checkRedPoint=function(){return Activity.ins().getType10RedPoint(this.id)};ActivityType10Data.prototype.getLeftTime=function(){if(this.endTime){var leftTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(leftTime<0){leftTime=0}return leftTime}return 0};ActivityType10Data.prototype.getRemainTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc;if(beganTime>=0){desc=i18n("ActivityType10Data_0")}else if(endedTime<=0){desc=i18n("ActivityType10Data_1")}else{desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}return desc};ActivityType10Data.prototype.getLevel=function(){var config=GlobalConfig.ActivityType10Config[this.id];var len=Object.keys(config).length;var level=this.record+1;if(this.record>=len)level=0;return level};ActivityType10Data.prototype.getCondition=function(lv){var config=GlobalConfig.ActivityType10Config[this.id][lv];if(!config)return false;if(this.yb>=config.recharge){return true}return false};return ActivityType10Data}(ActivityBaseData);__reflect(ActivityType10Data.prototype,"ActivityType10Data");var ActivityType11Data=function(_super){__extends(ActivityType11Data,_super);function ActivityType11Data(bytes,id,startTime,endTime){var _this=_super.call(this,bytes)||this;_this._rewardInfo=0;_this.id=id;_this.startTime=startTime;_this.endTime=endTime;_this.update(bytes);return _this}ActivityType11Data.prototype.update=function(bytes){this._rewardInfo=bytes.readInt();var len=bytes.readShort();this._achieveInfo=[];this._achieveInfo.length=Object.keys(GlobalConfig.ActivityType11_2Config[this.id]).length;var i;for(i=0;i<len;i++)this._achieveInfo[bytes.readShort()-1]={times:bytes.readInt(),isGot:bytes.readBoolean()};len=this._achieveInfo.length;var conf;this._hiScore=0;var curDay=this.getCurDay();for(i=0;i<len;i++){if(!this._achieveInfo[i])this._achieveInfo[i]={times:0,isGot:false};conf=GlobalConfig.ActivityType11_2Config[this.id][i+1];if(!conf.day||curDay>=conf.day)this._hiScore+=Math.floor(this._achieveInfo[i].times/conf.target)*conf.score}};Object.defineProperty(ActivityType11Data.prototype,"rewardInfo",{get:function(){return this._rewardInfo},enumerable:true,configurable:true});Object.defineProperty(ActivityType11Data.prototype,"hiScore",{get:function(){return this._hiScore},enumerable:true,configurable:true});Object.defineProperty(ActivityType11Data.prototype,"achieveInfo",{get:function(){return this._achieveInfo},enumerable:true,configurable:true});ActivityType11Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType11Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0)return true;return false};ActivityType11Data.prototype.checkRedPoint=function(){var cfg=GlobalConfig.ActivityConfig[this.id];if(cfg.pageStyle==ActivityPageStyle.HAPPYSEVENDAY||cfg.pageStyle==ActivityPageStyle.SPRINGEIGHTDAY||cfg.pageStyle==ActivityPageStyle.VERSIONCELE){var len=Object.keys(GlobalConfig.ActivityType11_2Config[this.id]).length;var conf=void 0;var achieve=void 0;var curDay=this.getCurDay();for(var i=1;i<=len;i++){conf=GlobalConfig.ActivityType11_2Config[this.id][i];achieve=this.achieveInfo[conf.index-1];if(curDay>=conf.day&&!achieve.isGot&&achieve.times>=conf.dayLimit)return true}}else{if(this.checkPhaseAward())return true}if(cfg.pageStyle==ActivityPageStyle.VERSIONCELE){if(ActivityType11Data.FIRST_OPEN_SHOP)return true;if(this.checkPhaseAward())return true;var id=0;for(var k in Activity.ins().activityData){var ac=Activity.ins().activityData[k];if(!ac)continue;if(ac.pageStyle==ActivityPageStyle.VERSIONCELE&&ac.type==ActivityDataFactory.ACTIVITY_TYPE_22&&Activity.ins().getActivityDataById(+k).isOpenActivity()&&!Activity.ins().getActivityDataById(+k).getHide()){id=ac.id;if(ac.refreshFree)return true;break}}}return false};ActivityType11Data.prototype.checkPhaseAward=function(){var len=Object.keys(GlobalConfig.ActivityType11_1Config[this.id]).length;for(var i=1;i<=len;i++){if((this._rewardInfo>>i&1)<=0&&this._hiScore>=GlobalConfig.ActivityType11_1Config[this.id][i].score)return true}return false};ActivityType11Data.prototype.getRemainTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc;if(beganTime>=0){desc=i18n("ActivityType11Data_0")}else if(endedTime<=0){desc=i18n("ActivityType11Data_1")}else{desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}return desc};ActivityType11Data.prototype.getCurDay=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc;if(beganTime>=0)return 0;else if(endedTime<=0)return 0;else return Math.ceil(Math.abs(beganTime)/(24*3600))};ActivityType11Data.FIRST_OPEN_SHOP=true;return ActivityType11Data}(ActivityBaseData);__reflect(ActivityType11Data.prototype,"ActivityType11Data");var ActivityType12Data=function(_super){__extends(ActivityType12Data,_super);function ActivityType12Data(bytes,id){var _this=_super.call(this,bytes)||this;_this.envelopeSum=ActivityType12Data.maxEnvelope;_this.SecondCount=0;_this.init(bytes,id);return _this}ActivityType12Data.prototype.init=function(bytes,id){this.score=bytes.readInt();var len=bytes.readShort();this.logs=[];for(var i=0;i<len;i++){var index=bytes.readShort();var name_4=bytes.readString();var serverId=bytes.readInt();this.logs.push({name:name_4,serverId:serverId,index:index})}if(Activity.ins().activityTimers.indexOf(id)==-1)Activity.ins().activityTimers.push(id)};ActivityType12Data.prototype.update=function(bytes){var eId=bytes.readShort();var type=bytes.readShort();if(type==1&&!Activity.ins().isSuccee)this.CheckWordisCanSend();else{var yb=bytes.readInt();var gold=bytes.readInt();var len=bytes.readShort();var arr=[];var role=SubRoles.ins().getSubRoleByIndex(0);arr.push({job:role.job,sex:role.sex,name:Actor.myName,yb:yb,gold:gold});for(var i=0;i<len;i++){var job=bytes.readShort();var sex=bytes.readShort();var otherName=bytes.readString();var otherYB=bytes.readInt();if(Actor.myName!=otherName)arr.push({job:job,sex:sex,name:otherName,yb:otherYB,gold:0})}Activity.ins().postGetRedEnvelope(this.id,eId,yb,gold,arr,Activity.ins().isSuccee)}};ActivityType12Data.prototype.CheckWordisCanSend=function(){UserTips.ins().showCenterTips(i18n("Chat_9"))};Object.defineProperty(ActivityType12Data.prototype,"envelopeData",{get:function(){this._envelopeData=this._envelopeData?this._envelopeData:[];return this._envelopeData},set:function(value){value.sort(this.sortTimer);this._envelopeData=value},enumerable:true,configurable:true});ActivityType12Data.prototype.sortTimer=function(a,b){if(a.timer<b.timer)return-1;else return 1};ActivityType12Data.prototype.checkClear=function(){if(this.envelopeData.length>=this.envelopeSum){this.SecondCount=0;this.clearEnvelopeData();if(this.envelopeSum>ActivityType12Data.maxEnvelope){this.envelopeSum=this.envelopeData.length+ActivityType12Data.maxEnvelope}}else if(this.SecondCount>10&&this.envelopeSum>ActivityType12Data.maxEnvelope){this.SecondCount=0;this.envelopeSum=ActivityType12Data.maxEnvelope}else if(this.SecondCount>60&&this.envelopeData.length<ActivityType12Data.maxEnvelope){this.SecondCount=0;this.clearEnvelopeData()}this.SecondCount++};ActivityType12Data.prototype.clearEnvelopeData=function(){for(var i=0;i<this.envelopeData.length;){if(!this.envelopeData[i]||this.envelopeData[i].isOverTimer()){this.envelopeData.splice(i,1)}i++}};ActivityType12Data.prototype.clearAll=function(){this.envelopeData=[];this.envelopeSum=ActivityType12Data.maxEnvelope};ActivityType12Data.prototype.popEnvelope=function(eId){for(var i=0;i<this.envelopeData.length;){if(!this.envelopeData[i]||this.envelopeData[i].id==eId){this.envelopeData.splice(i,1);break}i++}};ActivityType12Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType12Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0)return true;return false};ActivityType12Data.prototype.checkRedPoint=function(){var config=GlobalConfig.ActivityType12Config[this.id];for(var k in config){if(this.score>=config[k].score)return true}return false};ActivityType12Data.prototype.getRemainTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc;if(beganTime>=0){desc=i18n("ActivityType12Data_0")}else if(endedTime<=0){desc=i18n("ActivityType12Data_1")}else{desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}return desc};ActivityType12Data.maxEnvelope=10;return ActivityType12Data}(ActivityBaseData);__reflect(ActivityType12Data.prototype,"ActivityType12Data");var RedEnvelope=function(){function RedEnvelope(){this.id=0;this.timer=0}RedEnvelope.prototype.isOverTimer=function(){var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.timer)-GameServer.serverTime)/1e3);return endedTime<=0?true:false};return RedEnvelope}();__reflect(RedEnvelope.prototype,"RedEnvelope");var EnvelopeData=function(){function EnvelopeData(){this.id=0;this.eId=0;this.job=0;this.sex=0;this.index=0;this.serverId=0;this.name="";this.desc=""}return EnvelopeData}();__reflect(EnvelopeData.prototype,"EnvelopeData");var EnvelopeType;(function(EnvelopeType){EnvelopeType[EnvelopeType["SEND"]=1]="SEND";EnvelopeType[EnvelopeType["GET"]=2]="GET"})(EnvelopeType||(EnvelopeType={}));window["EnvelopeType"]=EnvelopeType;var ActivityType17Data=function(_super){__extends(ActivityType17Data,_super);function ActivityType17Data(bytes){var _this=_super.call(this,bytes)||this;_this.noticeArr=[];_this.actStar=[];_this.awardIndex=0;var num=bytes.readShort();for(var i=1;i<=num;i++){_this.actStar[i]=bytes.readShort()}var len=bytes.readShort();_this.noticeArr=[];for(var i=0;i<len;i++){_this.noticeArr.push({name:bytes.readString(),index:bytes.readByte()})}_this.noticeArr.reverse();_this.score=bytes.readInt();_this.curRecharge=bytes.readInt();_this.overDay=bytes.readInt();_this.recrod=bytes.readInt();return _this}ActivityType17Data.prototype.update=function(bytes){this.awardIndex=bytes.readShort();this.recrod=bytes.readInt()};ActivityType17Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType17Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType17Data.prototype.checkRedPoint=function(){return Activity.ins().getType17RedPoint(this.id)};return ActivityType17Data}(ActivityBaseData);__reflect(ActivityType17Data.prototype,"ActivityType17Data");var ActivityType18Data=function(_super){__extends(ActivityType18Data,_super);function ActivityType18Data(bytes){var _this=_super.call(this,bytes)||this;_this.num=0;_this.init(bytes);return _this}ActivityType18Data.prototype.init=function(bytes){this.num=bytes.readInt();this.recrod=bytes.readInt();var len=bytes.readShort();if(this.logs)this.logs.length=0;else this.logs=[];for(var i=0;i<len;i++){var data=[bytes.readString(),bytes.readInt()];this.logs.push(data)}this.logs=this.logs.reverse();if(this.bestlogs)this.bestlogs.length=0;else this.bestlogs=[];len=bytes.readShort();for(var i=0;i<len;i++){var data=[bytes.readString(),bytes.readInt()];this.bestlogs.push(data)}};ActivityType18Data.prototype.update=function(bytes){var index=bytes.readShort();this.num=bytes.readInt();this.recrod=bytes.readInt();var num=bytes.readShort();var arr=[];for(var i=0;i<num;i++)arr[i]=[bytes.readInt(),bytes.readShort()];var type=0;if(index==2)type=1;if(ViewManager.ins().isShow(HuntResultWin))Activity.ins().postHuntResult(type,arr,3,this.id);else{ViewManager.ins().open(HuntResultWin,type,arr,2,this.id);Activity.ins().postHuntResult(type,arr,3,this.id)}};ActivityType18Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0)return true;return false};ActivityType18Data.prototype.getLeftTime=function(){var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(endedTime<0)endedTime=0;return endedTime};ActivityType18Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType18Data.prototype.getStateByIndex=function(index){var state=this.recrod>>index&1;if(state==0){var config=GlobalConfig.ActivityType18Config[this.id][index];if(config&&config.dbCount&&config.dbCount<=this.num)state=2}return state};ActivityType18Data.prototype.checkRedPoint=function(){var config=GlobalConfig.ActivityType18Config[this.id];for(var i in config){if(config[i].dbCount&&this.num>=config[i].dbCount&&(this.recrod>>config[i].index&1)==0){return true}}return false};return ActivityType18Data}(ActivityBaseData);__reflect(ActivityType18Data.prototype,"ActivityType18Data");var ActivityType19Data=function(_super){__extends(ActivityType19Data,_super);function ActivityType19Data(bytes){var _this=_super.call(this,bytes)||this;_this.awardIndex=0;_this._data={};_this._list=[];return _this}ActivityType19Data.prototype.CleanRandData=function(){this._data={};this._list=[]};ActivityType19Data.prototype.SetRankData=function(value){this._list[value.rank-1]=value;this._data[value.actorId]=value};ActivityType19Data.prototype.GetRankData=function(){return this._data};ActivityType19Data.prototype.GetRankList=function(){return this._list};ActivityType19Data.prototype.update=function(bytes){};ActivityType19Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType19Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType19Data.prototype.getleftTime=function(){if(!this.isOpenActivity()){return 0}var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return endedTime};ActivityType19Data.prototype.checkRedPoint=function(){var config=GlobalConfig.ActivityType19Config[this.id][1];if(config.activityID){var act1=Activity.ins().getActivityDataById(config.activityID);if(act1&&act1.canReward())return true}return false};return ActivityType19Data}(ActivityBaseData);__reflect(ActivityType19Data.prototype,"ActivityType19Data");var GuideView=function(_super){__extends(GuideView,_super);function GuideView(){var _this=_super.call(this)||this;_this.rect=new egret.Rectangle(1,1,1,1);_this.infoGroup=new eui.Group;_this.infoGroup.touchEnabled=false;_this.infoGroup.touchChildren=false;_this.addChild(_this.infoGroup);_this.mc=new MovieClip;_this.infoGroup.addChild(_this.mc);_this.arrowGroup=new eui.Group;_this.infoGroup.addChild(_this.arrowGroup);_this.arrow=new GuideArrow;_this.arrowGroup.addChild(_this.arrow);_this.arrow.x=40;_this.arrow.y=20;return _this}GuideView.prototype.show=function(obj){_super.prototype.show.call(this,obj);this.arrow.update();this.mc.playFile(RES_DIR_EFF+"guideff",-1)};GuideView.prototype.close=function(){_super.prototype.close.call(this);this.arrow.close()};return GuideView}(GuideViewBase);__reflect(GuideView.prototype,"GuideView");var ActivityType20Data=function(_super){__extends(ActivityType20Data,_super);function ActivityType20Data(bytes){var _this=_super.call(this,bytes)||this;_this.update(bytes);return _this}ActivityType20Data.prototype.update=function(bytes){this.index=bytes.readInt()||1;this.timer=bytes.readInt();if(this.timer)this.timer=Math.floor(DateUtils.formatMiniDateTime(this.timer)/DateUtils.MS_PER_SECOND);this.isGoIn=bytes.readByte()};ActivityType20Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType20Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType20Data.prototype.getleftTime=function(){if(!this.isOpenActivity()){return 0}var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return endedTime};ActivityType20Data.prototype.checkRedPoint=function(){if(this.IsEnd())return false;var startTime=this.getStartTimer();var endTime=this.getEndTimer();var curTime=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);if(curTime<startTime||curTime>=endTime)return false;return true};ActivityType20Data.prototype.IsEnd=function(){var endTimer=this.getEndTimer();var endDate=new Date(endTimer*DateUtils.MS_PER_SECOND);var curDate=new Date(GameServer.serverTime);if(curDate.getDate()!=endDate.getDate())return true;return false};ActivityType20Data.prototype.go2BossFb=function(){return this.isGoIn};ActivityType20Data.prototype.getReadyTimer=function(){var config=GlobalConfig.ActivityType20Config[this.id][this.index];return this.timer-config.duration-config.enterTime};ActivityType20Data.prototype.getStartTimer=function(){var config=GlobalConfig.ActivityType20Config[this.id][this.index];return this.timer-config.duration};ActivityType20Data.prototype.getEndTimer=function(){return this.timer};ActivityType20Data.prototype.getResidueTimer=function(){if(this.IsEnd())return 0;var startTimer=this.getStartTimer();var endTimer=this.getEndTimer();var curTimer=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);if(curTimer>=startTimer&&curTimer<endTimer)return endTimer-curTimer;return endTimer-curTimer};ActivityType20Data.prototype.getResidueStartTimer=function(){if(this.IsEnd())return 0;var startTimer=this.getStartTimer();var curTimer=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);if(curTimer>=startTimer)return 0;return startTimer-curTimer};ActivityType20Data.prototype.getDateTime=function(str){var arr=str.split(/[-,.,:]/g);var date=new Date(+arr[0],+arr[1]-1,+arr[2],+arr[3]||0,+arr[4]||0);return date};return ActivityType20Data}(ActivityBaseData);__reflect(ActivityType20Data.prototype,"ActivityType20Data");var LBBossRankData=function(){function LBBossRankData(){this.rank=0;this.name="";this.damage=0}return LBBossRankData}();__reflect(LBBossRankData.prototype,"LBBossRankData");var ActivityType21Data=function(_super){__extends(ActivityType21Data,_super);function ActivityType21Data(bytes){return _super.call(this,bytes)||this}ActivityType21Data.prototype.update=function(bytes){};ActivityType21Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType21Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType21Data.prototype.getleftTime=function(){if(!this.isOpenActivity()){return 0}var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return endedTime};ActivityType21Data.prototype.checkRedPoint=function(){return false};return ActivityType21Data}(ActivityBaseData);__reflect(ActivityType21Data.prototype,"ActivityType21Data");var ActivityType22Data=function(_super){__extends(ActivityType22Data,_super);function ActivityType22Data(bytes){var _this=_super.call(this,bytes)||this;_this._refreshTime=0;_this.update(bytes);return _this}ActivityType22Data.prototype.update=function(bytes){this.tScore=bytes.readInt();this.refreshFree=bytes.readByte()==1;this._refreshTime=bytes.readInt();this._oldTimer=egret.getTimer();var len=bytes.readShort();this.shopItems=[];this.shopItems.length=len;for(var i=0;i<len;i++){this.shopItems[i]=new SpringBeginShopVo;this.shopItems[i].parser(bytes)}len=bytes.readShort();this.scoreItems=[];this.scoreItems.length=len;for(var i=0;i<len;i++){this.scoreItems[i]=new SpringBeginShopVo;this.scoreItems[i].parser2(bytes)}this.limitItems=[];len=bytes.readShort();var vo;for(var i=0;i<len;i++){vo=new SpringBeginShopVo;vo.parser3(bytes);this.limitItems.push(vo)}};ActivityType22Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType22Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType22Data.prototype.getleftTime=function(){if(!this.isOpenActivity()){return 0}var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return endedTime};ActivityType22Data.prototype.checkRedPoint=function(){if(this.refreshFree)return true;var config=Activity.ins().getConfig22_3(this.id);if(config&&this.tScore>=config.score)return true;var itemData=UserBag.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.id][1].freshItem);if(itemData&&itemData.count>0)return true;return false};ActivityType22Data.prototype.getRemainTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc;if(beganTime>=0){desc=i18n("ActivityType22Data_0")}else if(endedTime<=0){desc=i18n("ActivityType22Data_1")}else{desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}return desc};ActivityType22Data.prototype.getRefreshTime=function(){return this._refreshTime-(egret.getTimer()-this._oldTimer)/1e3};return ActivityType22Data}(ActivityBaseData);__reflect(ActivityType22Data.prototype,"ActivityType22Data");var ActivityType23Data=function(_super){__extends(ActivityType23Data,_super);function ActivityType23Data(bytes){var _this=_super.call(this,bytes)||this;_this.buyTimesData=[];_this.initBuyData(bytes);return _this}ActivityType23Data.prototype.initBuyData=function(bytes){var count=bytes.readInt();for(var i=1;i<=count;i++){this.buyTimesData[i]=bytes.readInt()}};ActivityType23Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);var idx=bytes.readShort();var count=bytes.readInt();this.buyTimesData[idx]=count};ActivityType23Data.prototype.getLeftTime=function(){if(this.endTime){var end_time=DateUtils.formatMiniDateTime(this.endTime);var leftTime=Math.floor((end_time-GameServer.serverTime)/1e3);if(leftTime<0){leftTime=0}return leftTime}var actConfig=GlobalConfig.ActivityConfig[this.id];var day=0;var endDay=0;if(actConfig.timeType==0){var time=+actConfig.startTime.split("-")[0];endDay=+actConfig.endTime.split("-")[0]-time;day=GameServer.serverOpenDay-time}else if(actConfig.timeType==1){var time=GameServer.serverTime;var openTime=new Date(actConfig.startTime).getTime();var endTime=new Date(actConfig.endTime).getTime();day=Math.floor((time-openTime)/1e3/3600/24);endDay=Math.round((endTime-openTime)/1e3/3600/24)}else if(actConfig.timeType==2){var time=+actConfig.startTime.split("-")[0];endDay=+actConfig.endTime.split("-")[0]-time;var farTime=Math.floor((GameServer.serverTime-DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime))/1e3/3600/24);day=farTime-time}var curDate=new Date(GameServer.serverTime);var leftDay=endDay-day;if(leftDay<=0)return 0;var endDate=new Date(GameServer.serverTime);endDate.setDate(curDate.getDate()+leftDay);endDate.setHours(0,0,0,0);return Math.floor((endDate.getTime()-GameServer.serverTime)/1e3)};return ActivityType23Data}(ActivityBaseData);__reflect(ActivityType23Data.prototype,"ActivityType23Data");var ActivityType24Data=function(_super){__extends(ActivityType24Data,_super);function ActivityType24Data(bytes){var _this=_super.call(this,bytes)||this;_this.stateData=[];_this.initGetStateData(bytes);return _this}ActivityType24Data.prototype.initGetStateData=function(bytes){var count=bytes.readInt();for(var i=1;i<=count;i++){this.stateData[i]=bytes.readInt()}};ActivityType24Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes)};ActivityType24Data.prototype.getLeftTime=function(){if(this.endTime){var end_time=DateUtils.formatMiniDateTime(this.endTime);var leftTime=Math.floor((end_time-GameServer.serverTime)/1e3);if(leftTime<0){leftTime=0}return leftTime}var actConfig=GlobalConfig.ActivityConfig[this.id];var day=0;var endDay=0;if(actConfig.timeType==0){var time=+actConfig.startTime.split("-")[0];endDay=+actConfig.endTime.split("-")[0]-time;day=GameServer.serverOpenDay-time}else if(actConfig.timeType==1){var time=GameServer.serverTime;var openTime=new Date(actConfig.startTime).getTime();var endTime=new Date(actConfig.endTime).getTime();day=Math.floor((time-openTime)/1e3/3600/24);endDay=Math.round((endTime-openTime)/1e3/3600/24)}else if(actConfig.timeType==2){var time=+actConfig.startTime.split("-")[0];endDay=+actConfig.endTime.split("-")[0]-time;var farTime=Math.floor((GameServer.serverTime-DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime))/1e3/3600/24);day=farTime-time}var curDate=new Date(GameServer.serverTime);var leftDay=endDay-day;if(leftDay<=0)return 0;var endDate=new Date(GameServer.serverTime);endDate.setDate(curDate.getDate()+leftDay);endDate.setHours(0,0,0,0);return Math.floor((endDate.getTime()-GameServer.serverTime)/1e3)};ActivityType24Data.prototype.canReward=function(){return false};ActivityType24Data.prototype.isOpenActivity=function(){return this.getLeftTime()>0};Object.defineProperty(ActivityType24Data.prototype,"mapping",{get:function(){return ActivityType24Data._mapping},enumerable:true,configurable:true});ActivityType24Data.prototype.checkState=function(index){if(index<=0||index>=this.stateData.length||typeof this.stateData[index]!="number")return 0;var type=GlobalConfig.ActivityType24Config[this.id][index].type;var fn=this.mapping[this.id]&&this.mapping[this.id][type]?this.mapping[this.id][type]:undefined;var state=this.stateData[index]||0;return fn?fn(state,index,this.stateData):state};ActivityType24Data._mapping={};return ActivityType24Data}(ActivityBaseData);__reflect(ActivityType24Data.prototype,"ActivityType24Data");var ActivityType25Data=function(_super){__extends(ActivityType25Data,_super);function ActivityType25Data(bytes){var _this=_super.call(this,bytes)||this;_this.update(bytes);return _this}ActivityType25Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes)};ActivityType25Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};return ActivityType25Data}(ActivityBaseData);__reflect(ActivityType25Data.prototype,"ActivityType25Data");var ActivityType26Data=function(_super){__extends(ActivityType26Data,_super);function ActivityType26Data(bytes){var _this=_super.call(this,bytes)||this;_this.update(bytes);return _this}ActivityType26Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);this.first_recharge=bytes.readShort();this.activity_first_recharge=bytes.readShort()};ActivityType26Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};return ActivityType26Data}(ActivityBaseData);__reflect(ActivityType26Data.prototype,"ActivityType26Data");var ActivityType27Data=function(_super){__extends(ActivityType27Data,_super);function ActivityType27Data(bytes){var _this=_super.call(this,bytes)||this;_this.boss={};_this.day=0;_this.initData(bytes);return _this}ActivityType27Data.prototype.initData=function(bytes){var len=bytes.readInt();for(var i=0;i<len;i++){var index=bytes.readInt();this.boss[index]=bytes.readInt()}this.day=bytes.readInt()};ActivityType27Data.prototype.sumTime=function(){return parseInt(GlobalConfig.ActivityConfig[this.id].endTime)-parseInt(GlobalConfig.ActivityConfig[this.id].startTime)};ActivityType27Data.prototype.isOpenActivity=function(){return this.day-1>=parseInt(GlobalConfig.ActivityConfig[this.id].startTime)&&this.day-1<parseInt(GlobalConfig.ActivityConfig[this.id].endTime)};ActivityType27Data.prototype.canReward=function(){var cfg=this.getConfig();for(var k in cfg){if(cfg[k].day==this.day&&this.boss[cfg[k].index]!=ActivityType27Data.TYPE.done){return true}}return false};ActivityType27Data.prototype.getConfig=function(){return GlobalConfig.ActivityType27Config[this.id]};ActivityType27Data.prototype.getBossState=function(index){return this.boss[index]};ActivityType27Data.prototype.update=function(bytes){var index=bytes.readInt();var cfg=this.getConfig();for(var k in cfg){if(cfg[k].index==index){if(Activity.ins().isSuccee){ResultManager.ins().create(UserFb.FB_TYPE_PERSONAL,1,cfg[k].reward)}else{ResultManager.ins().create(UserFb.FB_TYPE_PERSONAL,0)}}}};ActivityType27Data.TYPE={close:0,open:1,done:2};return ActivityType27Data}(ActivityBaseData);__reflect(ActivityType27Data.prototype,"ActivityType27Data");var Version;(function(Version){Version.BUILD_NUMBER=""})(Version||(Version={}));window["Version"]=Version;var ActivityType29Data=function(_super){__extends(ActivityType29Data,_super);function ActivityType29Data(bytes){var _this=this;if(!bytes)return;_this=_super.call(this,bytes)||this;_this.updateRecord(bytes);return _this}ActivityType29Data.prototype.updateRecord=function(bytes){var len=bytes.readInt();this.states=[];for(var i=0;i<len;i++){var k=bytes.readInt();var s=bytes.readByte();this.states[k]=s}this.passed_days=bytes.readInt();this.resign_count=bytes.readInt();this.sign_count=bytes.readInt()};ActivityType29Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes)};ActivityType29Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType29Data.prototype.canReward=function(index){if(index===void 0){index=0}if(index==0){index=this.passed_days}return false};ActivityType29Data.prototype.checkOneDayStatu=function(index){if(index===void 0){index=0}if(index==0){index=this.passed_days}return false};ActivityType29Data.prototype.getCurDay=function(){var day=this.passed_days;return day};return ActivityType29Data}(ActivityBaseData);__reflect(ActivityType29Data.prototype,"ActivityType29Data");var checkInType;(function(checkInType){checkInType[checkInType["NONE"]=0]="NONE";checkInType[checkInType["CAN_SIGN"]=1]="CAN_SIGN";checkInType[checkInType["SIGN"]=2]="SIGN";checkInType[checkInType["CAN_RESIGN"]=3]="CAN_RESIGN";checkInType[checkInType["RESIGN"]=4]="RESIGN"})(checkInType||(checkInType={}));window["checkInType"]=checkInType;var ActivityType2Data=function(_super){__extends(ActivityType2Data,_super);function ActivityType2Data(bytes){var _this=_super.call(this,bytes)||this;_this.buyData=[];_this.serverBuyData=[];_this.areaBuyData=[];_this.areabuyReward=[];_this.initBuyData(bytes);return _this}ActivityType2Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);var id=bytes.readShort();var count=bytes.readInt();this.buyData[id]=count;this.serverBuyData[id]=bytes.readInt();this.areaBuyData[id]=bytes.readInt();this.areabuyReward[id]=bytes.readInt();for(var j=0;j<=count;j++){this.areaBuyData[j]=Math.max(this.areaBuyData[j],this.buyData[j])}};ActivityType2Data.prototype.initBuyData=function(bytes){var count=bytes.readShort();for(var i=1;i<=count;i++){this.buyData[i]=bytes.readShort();this.serverBuyData[i]=bytes.readShort();this.areaBuyData[i]=bytes.readInt();this.areabuyReward[i]=bytes.readInt()}for(var j=0;j<=count;j++){this.areaBuyData[j]=Math.max(this.areaBuyData[j],this.buyData[j])}this.sumRMB=bytes.readInt()};ActivityType2Data.prototype.canReward=function(){if(Actor.level<ActivityType2Data.LimitLevel)return false;var activityData;if(Activity.ins().doubleElevenIDs.indexOf(this.id)!=-1)activityData=Activity.ins().getDoubleElevenDataByID(this.id);else activityData=Activity.ins().getActivityDataById(this.id);var config=GlobalConfig.ActivityType2Config[this.id];var serverBuy=false;for(var i in config){var cfd=config[i];var isBuy=activityData.buyData[cfd.index]>=cfd.count?true:false;serverBuy=this.serverBuyData[cfd.index]>=cfd.scount?true:false;if(!isBuy&&activityData.sumRMB>=cfd.needRecharge&&Actor.yb>=cfd.price&&UserVip.ins().lv>=cfd.vip&&!serverBuy){return true}else{if(isBuy&&cfd.countReward){for(var j in cfd.countReward){if(this.getAreaReward(cfd.index,Number(j)+1)){return true}}}}}return false};ActivityType2Data.prototype.isSpecialOpen=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var config=GlobalConfig.ActivityType2Config[this.id][1];var hours=Number(config.limitTime[0]);var minutes=Number(config.limitTime[1]);if(beganTime+hours*3600+minutes*60<0&&endedTime>0){return true}return false};ActivityType2Data.prototype.getSpecialStrikeTimes=function(){var config=GlobalConfig.ActivityType2Config[this.id][1];var hours=Number(config.limitTime[0]);var minutes=Number(config.limitTime[1]);var times=(GameServer.serverTime-DateUtils.formatMiniDateTime(this.startTime)-hours*36e5-minutes*6e4)/1e3/240;return times>0?times:0};ActivityType2Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType2Data.prototype.getHide=function(){if(this.isHide)return this.isHide;var config=GlobalConfig.ActivityType2Config[this.id];for(var i=1;i<this.buyData.length;i++){var cfd=config[i];if(this.buyData[i]<cfd.count){this.isHide=false;return this.isHide}}this.isHide=true;return this.isHide};ActivityType2Data.prototype.getLeftTime=function(){if(this.endTime){var end_time=DateUtils.formatMiniDateTime(this.endTime)/1e3;var leftTime=Math.floor((end_time-GameServer.serverTime)/1e3);if(leftTime<0){leftTime=0}return leftTime}var actConfig=GlobalConfig.ActivityConfig[this.id];var day=0;var endDay=0;if(actConfig.timeType==0){var time=+actConfig.startTime.split("-")[0];endDay=+actConfig.endTime.split("-")[0]-time;day=GameServer.serverOpenDay-time}else if(actConfig.timeType==1){var time=GameServer.serverTime;var openTime=new Date(actConfig.startTime).getTime();var endTime=new Date(actConfig.endTime).getTime();day=Math.floor((time-openTime)/1e3/3600/24);endDay=Math.round((endTime-openTime)/1e3/3600/24)}else if(actConfig.timeType==2){var time=+actConfig.startTime.split("-")[0];endDay=+actConfig.endTime.split("-")[0]-time;var farTime=Math.floor((GameServer.serverTime-DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime))/1e3/3600/24);day=farTime-time}var curDate=new Date(GameServer.serverTime);var leftDay=endDay-day;if(leftDay<=0)return 0;var endDate=new Date(GameServer.serverTime);endDate.setDate(curDate.getDate()+leftDay);endDate.setHours(0,0,0,0);return Math.floor((endDate.getTime()-GameServer.serverTime)/1e3)};ActivityType2Data.prototype.getSpecialOpenLeftTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var config=GlobalConfig.ActivityType2Config[this.id][1];var hours=Number(config.limitTime[0]);var minutes=Number(config.limitTime[1]);beganTime+=hours*3600+minutes*60;if(beganTime<0&&endedTime>0)return beganTime;return 0};ActivityType2Data.prototype.getAreaReward=function(index,zqindex){var config=GlobalConfig.ActivityType2Config[this.id][index];if(this.buyData[index]&&this.buyData[index]>=config.count){if((this.areabuyReward[index]>>zqindex&1)>0){return Activity.Geted}else{if(this.areaBuyData[index]>=config.countReward[zqindex-1].count){return Activity.CanGet}}}return Activity.NotReached};ActivityType2Data.LimitLevel=50;return ActivityType2Data}(ActivityBaseData);__reflect(ActivityType2Data.prototype,"ActivityType2Data");var ActivityType3Data=function(_super){__extends(ActivityType3Data,_super);function ActivityType3Data(bytes){var _this=_super.call(this,bytes)||this;_this.dabiao=[];_this.chongzhiNum=0;_this.chongzhiTotal=0;_this.btn1=false;_this.btn2=false;_this.image1=false;_this.image2=false;_this.updateData(bytes);_this.recrod=bytes.readInt();return _this}ActivityType3Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);var rewardID=bytes.readShort();this.recrod=bytes.readInt()};ActivityType3Data.prototype.openDay=function(){var configs=GlobalConfig["ActivityType3Config"][this.id];if(configs&&configs[0]){return configs[0].day}return 7};ActivityType3Data.prototype.canReward=function(){var configs=GlobalConfig["ActivityType3Config"][this.id];var records=this.recrod;var curIndex=-1;var i=0;for(var k in configs){var record=records>>configs[k].index&1;if(configs[k].type==1){if(this.dabiao[i]>=configs[k].day){if(record==0)return true}}else if(configs[k].type==2&&configs[k].val<=this.chongzhiTotal){if(record==0)return true}else if(configs[k].type==3&&configs[k].val<=this.chongzhiNum){if(curIndex==-1){curIndex=this.getCurIndex(3)}if(curIndex==configs[k].index&&record==0)return true}i++}return this.canRewardEx()};ActivityType3Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType3Data.prototype.updateData=function(bytes){var num=bytes.readShort();this.dabiao=[];for(var i=0;i<num;i++){this.dabiao.push(bytes.readShort())}this.chongzhiNum=bytes.readInt();this.chongzhiTotal=bytes.readInt()};Object.defineProperty(ActivityType3Data.prototype,"day7text",{get:function(){var configs=GlobalConfig["ActivityType3Config"][this.id];for(var k in configs){if(configs[k].type==1){this.rewards1=configs[k].rewards;this._day7text=i18n("ActivityType3Data_0","<font color='#ffff00'>"+configs[k].day+"</font>","<font color='#ffff00'>"+configs[k].val+"</font>")}}return this._day7text},enumerable:true,configurable:true});Object.defineProperty(ActivityType3Data.prototype,"totaltext",{get:function(){var configs=GlobalConfig["ActivityType3Config"][this.id];for(var k in configs){if(configs[k].type==2){this.maxTotal=configs[k].val;this.rewards2=configs[k].rewards;this._totaltext=i18n("ActivityType3Data_1","<font color='#ffff00'>"+configs[k].val+"</font>")}}return this._totaltext},enumerable:true,configurable:true});ActivityType3Data.prototype.canOnlyReward=function(){var configs=GlobalConfig["ActivityType3Config"][this.id];var records=this.recrod;this.btn1=false;this.btn2=false;this.image1=false;this.image2=false;for(var k in configs){var record=records>>configs[k].index&1;if(configs[k].type==1&&this.dabiao){if(this.dabiao[0]>=configs[k].day){if(record==0)this.btn1=true;if(record==1)this.image1=true}}if(configs[k].type==2&&configs[k].val<=this.chongzhiTotal){if(record==0)this.btn2=true;if(record==1)this.image2=true}}};ActivityType3Data.prototype.getDateTime=function(str){var arr=str.split(/[-,.,:]/g);var date=new Date(+arr[0],+arr[1]-1,+arr[2],+arr[3]||0,+arr[4]||0);return date.getTime()};ActivityType3Data.prototype.isOverTimer=function(index){var curday=this.curOpenDay();var config=GlobalConfig.ActivityType3Config[this.id][index];var record=this.recrod>>config.index&1;if(curday+1>config.day&&record!=Activity.Geted)return true;return false};ActivityType3Data.prototype.curOpenDay=function(){var actConfig=GlobalConfig.ActivityConfig[this.id];var day=0;if(actConfig.timeType==0){var time=+actConfig.startTime.split("-")[0];day=GameServer.serverOpenDay-time}else if(actConfig.timeType==1){var time=GameServer.serverTime;var openTime=this.getDateTime(actConfig.startTime);var endTime=this.getDateTime(actConfig.endTime);day=Math.floor((time-openTime)/1e3/3600/24)}else if(actConfig.timeType==2){var time=+actConfig.startTime.split("-")[0];var openTime=Math.floor((GameServer.serverTime-DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime))/1e3/3600/24);day=openTime-time}return day};ActivityType3Data.prototype.getCurIndex=function(type){var actConfig=GlobalConfig.ActivityConfig[this.id];var type3Config=GlobalConfig.ActivityType3Config[this.id];var day=this.curOpenDay();var types={};for(var t in type3Config){types[type3Config[t].type]=1}var keys=Object.keys(types);if(keys.length==1||type==undefined){type=+keys[0]}var configArr=[];var i;for(i in type3Config){if(type3Config[i].type==type){configArr.push(type3Config[i])}}configArr.sort(function(a,b){if(a.day<b.day)return-1;return 1});for(var _i=0,configArr_1=configArr;_i<configArr_1.length;_i++){var conf=configArr_1[_i];i=conf.index;if(type==1||type==2){if(day<conf.day){return+i}}else if(type==3){if(day<conf.day){return+i}}}return+i};ActivityType3Data.prototype.getLeftTime=function(){if(this.endTime){var leftTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(leftTime<0){leftTime=0}return leftTime}return 0};ActivityType3Data.prototype.getRewardStateById=function(index){var config=GlobalConfig.ActivityType3Config[this.id][index];switch(config.showType){case Show3Type.TYPE6:case Show3Type.TYPE8:case Show3Type.TYPE9:if(this.chongzhiTotal<config.val)return Activity.NotReached;break;case Show3Type.TYPE7:if(this.dabiao[index-1]<config.day)return Activity.NotReached;break}var record=this.recrod>>config.index&1;return record?Activity.Geted:Activity.CanGet};ActivityType3Data.prototype.canRewardEx=function(){var config=GlobalConfig.ActivityType3Config[this.id];if(config&&config[1]&&config[1].activityID){for(var i=0;i<config[1].activityID.length;i++){var actData=Activity.ins().getActivityDataById(config[1].activityID[i]);if(actData&&actData.canReward())return true}}return false};return ActivityType3Data}(ActivityBaseData);__reflect(ActivityType3Data.prototype,"ActivityType3Data");var Show3Type;(function(Show3Type){Show3Type[Show3Type["TYPE1"]=1]="TYPE1";Show3Type[Show3Type["TYPE2"]=2]="TYPE2";Show3Type[Show3Type["TYPE3"]=3]="TYPE3";Show3Type[Show3Type["TYPE4"]=4]="TYPE4";Show3Type[Show3Type["TYPE5"]=5]="TYPE5";Show3Type[Show3Type["TYPE6"]=6]="TYPE6";Show3Type[Show3Type["TYPE7"]=7]="TYPE7";Show3Type[Show3Type["TYPE8"]=8]="TYPE8";Show3Type[Show3Type["TYPE9"]=9]="TYPE9";Show3Type[Show3Type["TYPE10"]=10]="TYPE10"})(Show3Type||(Show3Type={}));window["Show3Type"]=Show3Type;var ActivityType4Data=function(_super){__extends(ActivityType4Data,_super);function ActivityType4Data(bytes){return _super.call(this,bytes)||this}ActivityType4Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes)};ActivityType4Data.prototype.updateData=function(bytes){};ActivityType4Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType4Data.prototype.getCostRank=function(rankdata,curIndex){if(!rankdata)return 0;var rank=0;var value=rankdata.numType;var config=GlobalConfig.ActivityType4Config[this.id];while(config[curIndex.idx]){if(value>=config[curIndex.idx].value){rank=config[curIndex.idx].ranking;curIndex.idx++;if(rankdata.rankIndex==Activity.ins().myPaiming)this.myPaiming=rank;break}curIndex.idx++}return rank};return ActivityType4Data}(ActivityBaseData);__reflect(ActivityType4Data.prototype,"ActivityType4Data");var ActivityType5Data=function(_super){__extends(ActivityType5Data,_super);function ActivityType5Data(bytes){var _this=this;if(!bytes)return;_this=_super.call(this,bytes)||this;_this.recrod=bytes.readInt();return _this}ActivityType5Data.prototype.updateRecord=function(bytes){this.recrod=bytes.readInt()};ActivityType5Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);var short=bytes.readShort();this.recrod=bytes.readInt()};ActivityType5Data.prototype.updateData=function(bytes){this.logTime=bytes.readInt()};ActivityType5Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType5Data.prototype.canReward=function(index){if(index===void 0){index=0}if(index==0){index=this.logTime}var configs=GlobalConfig["ActivityType5Config"][this.id];for(var k in configs){var statu=this.recrod>>configs[k].index&1;if(statu==0&&configs[k].day<=this.logTime){return true}}return false};ActivityType5Data.prototype.checkOneDayStatu=function(index){if(index===void 0){index=0}if(index==0){index=this.logTime}var configs=GlobalConfig["ActivityType5Config"][this.id];var statu=this.recrod>>index&1;if(statu==0){return true}return false};ActivityType5Data.prototype.getCurDay=function(){var day=this.logTime;if(this.id==157){day=Activity.ins().hfLoginDay}else if(this.id==210){day=Activity.ins().geLoginDay}return day};return ActivityType5Data}(ActivityBaseData);__reflect(ActivityType5Data.prototype,"ActivityType5Data");var ActivityType6Data=function(_super){__extends(ActivityType6Data,_super);function ActivityType6Data(bytes){var _this=_super.call(this,bytes)||this;_this.rewardsBossSum=[];_this.initBuyData(bytes);return _this}ActivityType6Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);var id=bytes.readShort();this.record=bytes.readInt()};ActivityType6Data.prototype.initBuyData=function(bytes){this.record=bytes.readInt();var len=bytes.readShort();for(var i=1;i<=len;i++)this.rewardsBossSum[i]=bytes.readShort()};ActivityType6Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType6Data.prototype.getBossGroup=function(bossRecord,config){var bossIndex=this.getBossGroupIndex(bossRecord,config);for(var i=0;i<bossIndex.length;i++){if(!bossIndex[i])return Activity.NOKILL}return Activity.KILL};ActivityType6Data.prototype.getBossGroupIndex=function(bossRecord,config){var bossIndex=[];var tmpRecord=bossRecord<<1;for(var i=1;i<=3;i++){var record=Math.floor(tmpRecord/Math.pow(2,i))%2;bossIndex.push(record)}return bossIndex};ActivityType6Data.prototype.getBossGroupGiftIndex=function(config){var record=Math.floor(this.record/Math.pow(2,config.index))%2;return record?Activity.Geted:Activity.CanGet};ActivityType6Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType6Data.prototype.checkRedPoint=function(){var config=GlobalConfig.ActivityType6Config[this.id];var i=1;for(var k in config){var record=this.getBossGroupGiftIndex(config[k]);var bossRecord=this.getBossGroup(this.rewardsBossSum[i],config[k]);if(bossRecord==Activity.KILL&&record==Activity.CanGet){return true}i++}return false};ActivityType6Data.prototype.getHide=function(){if(this.isHide)return this.isHide;var rec=this.record>>1;var tmplist=GlobalConfig.ActivityType6Config[this.id];var tlist=Object.keys(tmplist);if(rec>=Math.pow(2,tlist.length)-1){this.isHide=true;return this.isHide}this.isHide=false;return this.isHide};return ActivityType6Data}(ActivityBaseData);__reflect(ActivityType6Data.prototype,"ActivityType6Data");var ActivityType7Data=function(_super){__extends(ActivityType7Data,_super);function ActivityType7Data(bytes){var _this=_super.call(this,bytes)||this;_this.personalRewardsSum=[];_this.worldRewardsSum=[];_this.exchange=[];_this.initBuyData(bytes);return _this}ActivityType7Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);var id=bytes.readShort();var count=bytes.readShort();this.personalRewardsSum[id]=count;this.worldRewardsSum[id]=bytes.readShort();this.exchange[id]=bytes.readShort()};ActivityType7Data.prototype.initBuyData=function(bytes){var len=bytes.readShort();for(var i=1;i<=len;i++){this.personalRewardsSum[i]=bytes.readShort();this.worldRewardsSum[i]=bytes.readShort();this.exchange[i]=bytes.readShort()}this.bossScore=bytes.readInt()};ActivityType7Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType7Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType7Data.prototype.checkRedPoint=function(){return Activity.ins().getType7RedPoint(this.id)};ActivityType7Data.prototype.getAwardState=function(index){var config=GlobalConfig.ActivityType7Config[this.id][index];var record=this.personalRewardsSum[config.index]>=config.count;return record?Activity.Geted:this.bossScore>=config.score?Activity.CanGet:Activity.NotReached};ActivityType7Data.prototype.getExchange=function(index){var actdata=Activity.ins().getActivityDataById(this.id);var config=GlobalConfig.ActivityType7Config[this.id][index];if(!config.items)return Activity.NotReached;var isget=Activity.CanGet;var worldRewards=actdata.worldRewardsSum[index];var exchange=actdata.exchange[index];var personalRewards=actdata.personalRewardsSum[index];for(var k in config.items){var itemData=UserBag.ins().getBagItemById(config.items[k].id);var count=itemData?itemData.count:0;if(count<config.items[k].count){isget=Activity.NotReached;break}}if(isget!=Activity.NotReached){if(config.scount){if(worldRewards>=config.scount){isget=Activity.Geted}}if(config.count){if(personalRewards>=config.count){isget=Activity.Geted}}if(config.dailyCount){if(exchange>=config.dailyCount){isget=Activity.Geted}}}return isget};ActivityType7Data.prototype.getLeftTime=function(){if(this.endTime){var leftTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(leftTime<0){leftTime=0}return leftTime}return 0};ActivityType7Data.TYPE_RING=1;ActivityType7Data.TYPE_HEFUBOSS=2;ActivityType7Data.TYPE_CELEBREATE=5;ActivityType7Data.TYPE_LABA=6;return ActivityType7Data}(ActivityBaseData);__reflect(ActivityType7Data.prototype,"ActivityType7Data");var ActivityType8Data=function(_super){__extends(ActivityType8Data,_super);function ActivityType8Data(bytes){var _this=_super.call(this,bytes)||this;_this.update(bytes);return _this}ActivityType8Data.prototype.update=function(bytes){this.record=bytes.readInt()};ActivityType8Data.prototype.canReward=function(){return this.checkRedPoint()};ActivityType8Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};ActivityType8Data.prototype.checkRedPoint=function(){return Activity.ins().getType8RedPoint(this.id)};ActivityType8Data.prototype.getRemainTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);var desc;if(beganTime>=0){desc=i18n("ActivityType8Data_0")}else if(endedTime<=0){desc=i18n("ActivityType8Data_1")}else{desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}return desc};ActivityType8Data.TYPE_RING=1;return ActivityType8Data}(ActivityBaseData);__reflect(ActivityType8Data.prototype,"ActivityType8Data");var EasyLoading=function(_super){__extends(EasyLoading,_super);function EasyLoading(){var _this=_super.call(this)||this;_this.content=null;_this.speed=1/(1e3/60);_this.networkConnected=false;_this.lastFT=null;_this.init();return _this}EasyLoading.ins=function(){return _super.ins.call(this)};EasyLoading.prototype.init=function(){this.content=new egret.Sprite;this.content.graphics.beginFill(0,.2);this.content.graphics.drawRect(0,0,StageUtils.ins().getWidth(),StageUtils.ins().getHeight());this.content.graphics.endFill();this.content.touchEnabled=true;this.uiImageContainer=new egret.DisplayObjectContainer;this.uiImageContainer.x=this.content.width*.5;this.uiImageContainer.y=this.content.height*.5;this.content.addChild(this.uiImageContainer);this.uiImage=new egret.Bitmap;this.uiImageContainer.addChild(this.uiImage);this.textContainer=new egret.DisplayObjectContainer;this.textContainer.x=this.content.width*.5;this.textContainer.y=this.content.height*.5;this.content.addChild(this.textContainer);this.label=new eui.Label;this.label.textAlign="center";this.label.verticalAlign="middle";this.label.textColor=16777215;this.label.size=24;this.label.width=100;this.label.height=40;this.label.x=-this.label.width/2;this.label.y=-this.label.height/2;this.textContainer.addChild(this.label);this.loadReel();GameSocket.ins().setOnClose(this.showNetworkLoading,this);GameSocket.ins().setOnConnected(this.hideNetworkLoading,this)};EasyLoading.prototype.loadReel=function(){var self=this;RES.getResByUrl(RES_DIR+"load_Reel.png",function(texture){var img=self.uiImage;img.texture=texture;img.x=-img.width*.5;img.y=-img.height*.5},this,RES.ResourceItem.TYPE_IMAGE)};EasyLoading.prototype.showNetworkLoading=function(){this.networkConnected=false;this.showLoading(-1,i18n("EasyLoading_0"));var self=this;GameSceneView.playCloudAni(false)};EasyLoading.prototype.hideNetworkLoading=function(){this.networkConnected=true;this.hideLoading()};EasyLoading.prototype.showLoading=function(autoHideSec,text){if(autoHideSec===void 0){autoHideSec=-1}if(text===void 0){text=""}StageUtils.ins().getStage().addChild(this.content);this.loadReel();egret.startTick(this.enterFrame,this);var self=this;if(autoHideSec>0){TimerManager.ins().doTimer(autoHideSec*1e3,1,this.hideLoading,this)}this.label.text=text};EasyLoading.prototype.hideLoading=function(){if(this.content&&this.content.parent){StageUtils.ins().getStage().removeChild(this.content);this.uiImageContainer.rotation=0}egret.stopTick(this.enterFrame,this);TimerManager.ins().remove(this.hideLoading,this)};EasyLoading.prototype.enterFrame=function(time){var dt=33;var curT=egret.getTimer();if(this.lastFT!=null){dt=curT-this.lastFT}this.lastFT=curT;this.uiImageContainer.rotation+=dt*1;return false};return EasyLoading}(BaseClass);__reflect(EasyLoading.prototype,"EasyLoading");var RewardData=function(){function RewardData(){}Object.defineProperty(RewardData,"CURRENCY_NAME",{get:function(){var _CURRENCY_NAMES=this._CURRENCY_NAMES;if(_CURRENCY_NAMES==null){_CURRENCY_NAMES={0:i18n("RewardData_0"),1:i18n("RewardData_1"),2:i18n("RewardData_2"),3:i18n("RewardData_3"),4:i18n("RewardData_4"),5:i18n("RewardData_5"),6:i18n("RewardData_6"),7:i18n("RewardData_7"),8:i18n("RewardData_8"),9:i18n("RewardData_9"),10:i18n("RewardData_10"),11:i18n("RewardData_11"),12:i18n("RewardData_12"),13:i18n("RewardData_13"),14:i18n("RewardData_14"),15:i18n("RewardData_15"),16:i18n("RewardData_16"),17:i18n("RewardData_17"),18:i18n("RewardData_19"),19:i18n("RewardData_20"),20:i18n("RewardData_21"),99:i18n("RewardData_18")};this._CURRENCY_NAMES=_CURRENCY_NAMES}return _CURRENCY_NAMES},enumerable:true,configurable:true});RewardData.prototype.parser=function(bytes){this.type=bytes.readInt();this.id=bytes.readInt();this.count=bytes.readInt()};RewardData.getCurrencyName=function(v){return RewardData.CURRENCY_NAME[v]};RewardData.getCurrencyRes=function(v){return RewardData.CURRENCY_RES[v]};RewardData.CURRENCY_RES={1:"ZSgold",2:"ZScoin",3:"ZSshengwang",4:"ZSlingpo",0:"result_json.ZSexp",5:"ZSguildgx",6:"ZSguildfund",8:"ZSchengjiu",99:"ZScoin",7:"ZShonor",9:"500007_png",10:"500008_png",11:"hejisuipian",12:"hejisuipian1",13:"ZSexp",14:"ZSprestige",15:"ZSchip",16:"SSExp",17:"ZSbschip",18:"lingshi",19:"ZSsjexp",20:"ZSdaoheng"};return RewardData}();__reflect(RewardData.prototype,"RewardData");var RewardDataCurrency;(function(RewardDataCurrency){RewardDataCurrency[RewardDataCurrency["Exp"]=0]="Exp";RewardDataCurrency[RewardDataCurrency["Glod"]=1]="Glod";RewardDataCurrency[RewardDataCurrency["Yb"]=2]="Yb";RewardDataCurrency[RewardDataCurrency["Shengwang"]=3]="Shengwang";RewardDataCurrency[RewardDataCurrency["Lingpo"]=4]="Lingpo";RewardDataCurrency[RewardDataCurrency["GuildContribute"]=5]="GuildContribute";RewardDataCurrency[RewardDataCurrency["GuildGold"]=6]="GuildGold";RewardDataCurrency[RewardDataCurrency["Feats"]=7]="Feats";RewardDataCurrency[RewardDataCurrency["Recharge"]=99]="Recharge"})(RewardDataCurrency||(RewardDataCurrency={}));window["RewardDataCurrency"]=RewardDataCurrency;var SpringBeginShopVo=function(){function SpringBeginShopVo(){this.discount=0}SpringBeginShopVo.prototype.parser=function(bytes){this.id=bytes.readInt();this.itemID=bytes.readInt();this.itemCount=bytes.readShort();this.price=bytes.readInt();this.discount=bytes.readByte();this.state=bytes.readByte();this.buyCount=bytes.readByte();this.buyMax=bytes.readByte();this.materialNum=bytes.readShort()};SpringBeginShopVo.prototype.parser2=function(bytes){this.id=bytes.readInt();this.itemID=bytes.readInt();this.itemCount=bytes.readShort();this.score=bytes.readInt()};SpringBeginShopVo.prototype.parser3=function(bytes){this.itemID=bytes.readInt();this.buyCount=bytes.readByte();this.buyMax=bytes.readByte()};return SpringBeginShopVo}();__reflect(SpringBeginShopVo.prototype,"SpringBeginShopVo");var ActivityBtnRenderer=function(_super){__extends(ActivityBtnRenderer,_super);function ActivityBtnRenderer(){var _this=_super.call(this)||this;_this.skinName="ActBtnSkin";return _this}ActivityBtnRenderer.prototype.dataChanged=function(){var abc;var ins;if(this.data instanceof ActivityBtnConfig){abc=this.data;ins=Activity.ins()}else if(this.data instanceof PActivityBtnConfig){abc=this.data;ins=PActivity.ins()}if(abc!=null){this.iconDisplay.source=abc.icon;this.redPoint.visible=ins.isShowRedPointByBtnInfo(abc);if(abc.light&&!ins.getPalyEffListById(abc.id)){if(!this.mc){this.mc=new MovieClip;this.mc.x=45;this.mc.y=48}this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1);this.addChild(this.mc)}else{DisplayUtils.removeFromParent(this.mc)}}else{this.iconDisplay.source=""}};return ActivityBtnRenderer}(FuliActBtnRenderer);__reflect(ActivityBtnRenderer.prototype,"ActivityBtnRenderer");var MergeJsonAnalyzer=function(_super){__extends(MergeJsonAnalyzer,_super);function MergeJsonAnalyzer(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.mergeJsons=["MergeConfig_json"];return _this}MergeJsonAnalyzer.prototype.analyzeData=function(resItem,data){var name=resItem.name;if(this.fileDic[name]||!data){return}try{var jsonData=data;if(typeof data=="string"){jsonData=JSON.parse(data)}if(this.mergeJsons.indexOf(name)!=-1){for(var key in jsonData){this.fileDic[key]=jsonData[key]}}else{this.fileDic[name]=jsonData}}catch(e){egret.$warn(1017,resItem.url,data)}};return MergeJsonAnalyzer}(RES.JsonAnalyzer);__reflect(MergeJsonAnalyzer.prototype,"MergeJsonAnalyzer");var ActivityRewardTipWin=function(_super){__extends(ActivityRewardTipWin,_super);function ActivityRewardTipWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="ActivityRewardTipSkin";return _this}ActivityRewardTipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var data=param[0];if(data.length==1){this.skinName="ActivityRewardTipSkin1"}else if(data.length<=4){this.skinName="ActivityRewardTipSkin2"}else{this.skinName="ActivityRewardTipSkin"}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.btnSure,this.onClose);var list=this.listItem;list.itemRenderer=ItemBase;var dataProvider=new ArrayCollection;list.dataProvider=dataProvider;dataProvider.replaceAll(data)};ActivityRewardTipWin.prototype.onClose=function(){this.close()};ActivityRewardTipWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeTouchEvent(this.btnSure,this.onClose);ViewManager.ins().close(this)};return ActivityRewardTipWin}(BaseEuiView);__reflect(ActivityRewardTipWin.prototype,"ActivityRewardTipWin");ViewManager.ins().reg(ActivityRewardTipWin,LayerManager.UI_Popup);var ActivityType1ItemRenderer=function(_super){__extends(ActivityType1ItemRenderer,_super);function ActivityType1ItemRenderer(){var _this=_super.call(this)||this;_this.skinName="ActLevelSonSkin";_this.list.itemRenderer=ItemBase;_this.rewardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.reward,_this);return _this}ActivityType1ItemRenderer.prototype.dataChanged=function(){var config=this.data;var data=Activity.ins().getActivityDataById(config.Id);if(config.zslevel>0){this.level.source="level_"+(8+config.zslevel)}else{this.level.source="level_"+config.level/10}this.currentState=data.getRewardStateById(config.index-1)+"";this.list.dataProvider=new eui.ArrayCollection(config.rewards)};ActivityType1ItemRenderer.prototype.reward=function(e){var config=this.data;if(UserBag.ins().getSurplusCount()<1&&this.data.index==13){UserTips.ins().showTips(i18n("ActivityType1ItemRenderer_2"))}else{Activity.ins().sendReward(config.Id,config.index)}};return ActivityType1ItemRenderer}(BaseItemRender);__reflect(ActivityType1ItemRenderer.prototype,"ActivityType1ItemRenderer");var ActivityType1Panel=function(_super){__extends(ActivityType1Panel,_super);function ActivityType1Panel(){var _this=_super.call(this)||this;_this.skinName="ActLevelSkin";_this.list.itemRenderer=ActivityType1ItemRenderer;return _this}ActivityType1Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.listData=new eui.ArrayCollection;this.list.dataProvider=this.listData};ActivityType1Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateData()};ActivityType1Panel.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.date.text=i18n("ActivityType1Panel_0")}else if(endedTime<=0){this.date.text=i18n("ActivityType1Panel_1")}else{this.date.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc;var listData=GlobalConfig.ActivityType1Config[activityData.id].slice();listData.sort(this.sortFunc);this.listData.replaceAll(listData)};ActivityType1Panel.prototype.sortFunc=function(aConfig,bConfig){var activityData=Activity.ins().getActivityDataById(aConfig.Id);var aState=activityData.getRewardStateById(aConfig.index-1);var bState=activityData.getRewardStateById(bConfig.index-1);if(aState<bState)return-1;if(aState>bState)return 1;if(aConfig.zslevel<bConfig.zslevel)return-1;if(aConfig.zslevel>bConfig.zslevel)return 1;if(aConfig.level<bConfig.level)return-1;if(aConfig.level>bConfig.level)return 1;return 0};return ActivityType1Panel}(ActivityPanel);__reflect(ActivityType1Panel.prototype,"ActivityType1Panel");var ActivityType2Panel=function(_super){__extends(ActivityType2Panel,_super);function ActivityType2Panel(){var _this=_super.call(this)||this;_this.type2PanelList=[];return _this}ActivityType2Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};ActivityType2Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var config=GlobalConfig.ActivityConfig[this.activityID];switch(config.openType){case 1:if(!this.type2PanelList[this.activityID+""]){this.type2PanelList[this.activityID+""]=new Activity2Panel2;this.type2PanelList[this.activityID+""].activityID=this.activityID}break;case 2:if(!this.type2PanelList[this.activityID+""]){this.type2PanelList[this.activityID+""]=new Activity2Panel1;this.type2PanelList[this.activityID+""].activityID=this.activityID}break;default:break}this.cruPanel=this.type2PanelList[this.activityID+""];this.cruPanel.open();this.addChild(this.cruPanel)};ActivityType2Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};ActivityType2Panel.prototype.updateData=function(){this.cruPanel.updateData()};return ActivityType2Panel}(ActivityPanel);__reflect(ActivityType2Panel.prototype,"ActivityType2Panel");var ActivityType3Panel=function(_super){__extends(ActivityType3Panel,_super);function ActivityType3Panel(){var _this=_super.call(this)||this;_this.initUI();return _this}ActivityType3Panel.prototype.initUI=function(){this.skinName="MoneyActSkin";this.list.itemRenderer=ItemBase;this.list1.itemRenderer=ItemBase};ActivityType3Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.suerBtn,this.reward);this.addTouchEvent(this.suerBtn0,this.reward);Activity.ins().sendLianxuReward(this.activityID);this.updateData()};ActivityType3Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.suerBtn,this.reward);this.removeTouchEvent(this.suerBtn0,this.reward)};ActivityType3Panel.prototype.updateData=function(){this.sureImg.visible=false;this.sureImg0.visible=false;this.activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.date.text=i18n("ActivityType3Panel_0")}else if(endedTime<=0){this.date.text=i18n("ActivityType3Panel_1")}else{this.date.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.label.textFlow=(new egret.HtmlTextParser).parser(this.activityData.day7text);this.label1.textFlow=(new egret.HtmlTextParser).parser(this.activityData.totaltext);if(this.activityData.chongzhiTotal>this.activityData.maxTotal){this.activityData.chongzhiTotal=this.activityData.maxTotal}this.label2.text=i18n("ActivityType3Panel_2",this.activityData.dabiao?this.activityData.dabiao[0]:0,this.activityData.openDay());this.label3.text=i18n("ActivityType3Panel_3",this.activityData.chongzhiTotal,this.activityData.maxTotal);this.list.dataProvider=new eui.ArrayCollection(this.activityData.rewards1);this.list1.dataProvider=new eui.ArrayCollection(this.activityData.rewards2);this.activityData.canOnlyReward();if(this.activityData.btn1){this.mc1=this.mc1||new MovieClip;this.mc1.x=50;this.mc1.y=19;this.mc1.playFile(RES_DIR_EFF+"normalbtn",-1);this.suerBtn.addChild(this.mc1)}else if(this.mc1){DisplayUtils.removeFromParent(this.mc1)}if(this.activityData.btn2){this.mc2=this.mc2||new MovieClip;this.mc2.x=50;this.mc2.y=19;this.mc2.playFile(RES_DIR_EFF+"normalbtn",-1);this.suerBtn0.addChild(this.mc2)}else if(this.mc2){DisplayUtils.removeFromParent(this.mc2)}this.sureImg0.visible=this.activityData.image1;this.sureImg.visible=this.activityData.image2;this.suerBtn.visible=!this.activityData.image1;this.suerBtn0.visible=!this.activityData.image2};ActivityType3Panel.prototype.reward=function(e){switch(e.currentTarget){case this.suerBtn:if(this.activityData.btn1){if(UserBag.ins().getSurplusCount()>=1){Activity.ins().sendReward(this.activityData.id,1)}else{UserTips.ins().showTips(i18n("ActivityType3Panel_4"))}}else UserTips.ins().showTips(i18n("ActivityType3Panel_5"));break;case this.suerBtn0:if(this.activityData.btn2){if(UserBag.ins().getSurplusCount()>=1){Activity.ins().sendReward(this.activityData.id,2)}else{UserTips.ins().showTips(i18n("ActivityType3Panel_6"))}}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("ActivityType3Panel_7"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("ActivityType3Panel_8"))}break}};return ActivityType3Panel}(ActivityPanel);__reflect(ActivityType3Panel.prototype,"ActivityType3Panel");var ActivityType4ItemRenderer=function(_super){__extends(ActivityType4ItemRenderer,_super);function ActivityType4ItemRenderer(){var _this=_super.call(this)||this;_this.skinName="ActraceSkinson";_this.list.itemRenderer=ItemBase;return _this}ActivityType4ItemRenderer.prototype.dataChanged=function(){var config=this.data;if(this.data.ranking>0){this.rankImg.source="rankDabiao_"+this.data.ranking}else{this.rankImg.source="rankDabiao_"+this.data.rankType+"_"+this.data.ranking}this.list.dataProvider=new eui.ArrayCollection(config.rewards);var rankData=Activity.ins().getrankInfoListByIndex(this.itemIndex);if(rankData){this.y=21;this.rankName.text=rankData.name;this.value.visible=true;var str=void 0;switch(this.data.rankType){case RankDataType.TYPE_LEVEL:if(rankData.zsLevel>0){str=rankData.zsLevel+i18n("ActivityType4ItemRenderer_0")+rankData.level+i18n("ActivityType4ItemRenderer_1")}else{str=rankData.level+i18n("ActivityType4ItemRenderer_2")}break;case RankDataType.TYPE_POWER:case RankDataType.TYPE_WING:case RankDataType.TYPE_JOB_ZS:case RankDataType.TYPE_JOB_FS:case RankDataType.TYPE_JOB_DS:str=CommonUtils.overLength(rankData.numType);break;case RankDataType.TYPE_BAOSHI:str=rankData.numType+i18n("ActivityType4ItemRenderer_3");break}this.value.text=str}else{this.y=33;this.rankName.text=i18n("ActivityType4ItemRenderer_4");this.value.visible=false}};return ActivityType4ItemRenderer}(BaseItemRender);__reflect(ActivityType4ItemRenderer.prototype,"ActivityType4ItemRenderer");var ActivityType4Panel=function(_super){__extends(ActivityType4Panel,_super);function ActivityType4Panel(){var _this=_super.call(this)||this;_this.skinName="ActRaceSkin";_this.list.itemRenderer=ActivityType4ItemRenderer;_this.list1.itemRenderer=ItemBase;return _this}ActivityType4Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.listData=new eui.ArrayCollection;this.list.dataProvider=this.listData};ActivityType4Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateData();this.addTouchEvent(this.getReward,this.onClick);if(this.btn_showRank){this.addTouchEvent(this.btn_showRank,this.onClick)}if(this.btn_showRank0){this.addTouchEvent(this.btn_showRank0,this.onClick)}if(this.group_Rank){this.group_Rank.visible=false}if(this.btn_showRank&&this.group_Rank){this.btn_showRank.label=this.group_Rank.visible?i18n("ActivityType4Panel_0"):i18n("ActivityType4Panel_1")}};ActivityType4Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}debug.log("close");this.removeTouchEvent(this.getReward,this.onClick);if(this.btn_showRank){this.removeTouchEvent(this.btn_showRank,this.onClick)}if(this.btn_showRank0){this.removeTouchEvent(this.btn_showRank0,this.onClick)}this.removeObserve()};ActivityType4Panel.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.date.text=i18n("ActivityType4Panel_2")}else if(endedTime<=0){this.date.text=i18n("ActivityType4Panel_3")}else{var day=Math.floor(endedTime/(3600*24));var hour=Math.floor(endedTime%(3600*24)/3600);var minu=Math.floor(endedTime%3600/60);this.date.text=day+i18n("ActivityType4Panel_4")+hour+i18n("ActivityType4Panel_5")+minu+i18n("ActivityType4Panel_6")}this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc;var listData=this.getDataList(activityData.id);this.listData.replaceAll(listData);var rewards=this.getCurRewards();this.list1.dataProvider=new eui.ArrayCollection(rewards);this.refushBtnStatu();for(var i=0;i<4;i++){var actConfig=listData[i];var rankData=Activity.ins().getrankInfoListByIndex[i];var idx=i+1;var list_item=this["list_item"+idx];var label_nname=this["label_nname"+idx];var label_value=this["label_value"+idx];var sName=i18n("ActivityType4Panel_7");var sValue="";if(rankData){sName=rankData.name;switch(actConfig.rankType){case RankDataType.TYPE_LEVEL:if(rankData.zsLevel>0){sValue=rankData.zsLevel+i18n("ActivityType4Panel_8")+rankData.level+i18n("ActivityType4Panel_9")}else{sValue=rankData.level+i18n("ActivityType4Panel_10")}break;case RankDataType.TYPE_POWER:sValue=CommonUtils.overLength(rankData.numType);break;case RankDataType.TYPE_WING:sValue=CommonUtils.overLength(rankData.numType);break;case RankDataType.TYPE_JOB_ZS:sValue=CommonUtils.overLength(rankData.numType);break;case RankDataType.TYPE_JOB_FS:sValue=CommonUtils.overLength(rankData.numType);break;case RankDataType.TYPE_JOB_DS:sValue=CommonUtils.overLength(rankData.numType);break;case RankDataType.TYPE_BAOSHI:sValue=rankData.numType+i18n("ActivityType4Panel_11");break;case RankDataType.TYPE_ZHANLING:sValue=rankData.numType[0]+i18n("ActivityType4Panel_12")+rankData.numType[1]+i18n("ActivityType4Panel_13");break;case RankDataType.TYPE_LONGHUN:sValue=rankData.numType+i18n("ActivityType4Panel_14");break;case RankDataType.TYPE_XIAOFEI:sValue=rankData.numType+i18n("ActivityType4Panel_15");break}}if(list_item){list_item.itemRenderer=ItemBase;list_item.dataProvider=new eui.ArrayCollection(actConfig.rewards)}if(label_nname){label_nname.text=sName}if(label_value){label_value.text=sValue}}};ActivityType4Panel.prototype.refushBtnStatu=function(){for(var k in Activity.ins().activityData){var _data=Activity.ins().activityData[k];if(_data&&_data.type==4&&_data.isOpenActivity()){Activity.ins().sendDabiaoInfo(_data.id)}}var model=Activity.ins();var rewardStatus=this.getCurStatus();var curValue=this.getCurValue();switch(rewardStatus){case 0:this.dabiaoImg.visible=false;this.getReward.visible=false;this.rankName.visible=true;this.rankDesc.visible=true;this.rankName.text=Actor.myName;break;case 1:this.rankName.visible=false;this.rankDesc.visible=false;this.dabiaoImg.visible=false;this.getReward.visible=true;break;case 2:this.rankName.visible=false;this.rankDesc.visible=false;this.dabiaoImg.visible=true;this.getReward.visible=false;break;default:debug.log(i18n("ActivityType4Panel_16")+rewardStatus)}switch(this.dabiao.rankType){case RankDataType.TYPE_LEVEL:if(UserZs.ins().lv>0){this.rankDesc.text=UserZs.ins().lv+i18n("ActivityType4Panel_17")+Actor.level+i18n("ActivityType4Panel_18")}else{this.rankDesc.text=Actor.level+i18n("ActivityType4Panel_19")}var zs=Math.floor(curValue/1e3);var lv=curValue%1e3;if(this.label_DabiaoTarget)this.label_DabiaoTarget.text=i18n("ActivityType4Panel_20")+(zs?zs+i18n("ActivityType4Panel_21"):"")+(lv+i18n("ActivityType4Panel_22"));break;case RankDataType.TYPE_POWER:case RankDataType.TYPE_WING:case RankDataType.TYPE_JOB_ZS:case RankDataType.TYPE_JOB_FS:case RankDataType.TYPE_JOB_DS:this.rankDesc.text=CommonUtils.overLength(Activity.ins().myDabiaoInfo);if(this.label_DabiaoTarget)this.label_DabiaoTarget.text=i18n("ActivityType4Panel_23")+curValue;break;case RankDataType.TYPE_BAOSHI:this.rankDesc.text=Activity.ins().myDabiaoInfo+i18n("ActivityType4Panel_24");if(this.label_DabiaoTarget)this.label_DabiaoTarget.text=i18n("ActivityType4Panel_25")+curValue;break;case RankDataType.TYPE_ZHANLING:var tgZj=Math.floor(curValue/1e3);var tgZx=curValue%1e3;var myZj=Activity.ins().myDabiaoInfo[0];var myZx=Activity.ins().myDabiaoInfo[1];this.rankDesc.text=myZj+i18n("ActivityType4Panel_26")+myZx+i18n("ActivityType4Panel_27");if(this.label_DabiaoTarget)this.label_DabiaoTarget.text=i18n("ActivityType4Panel_28")+(tgZj?tgZj+i18n("ActivityType4Panel_29"):"")+(tgZx+i18n("ActivityType4Panel_30"));break;case RankDataType.TYPE_LONGHUN:this.rankDesc.text=Activity.ins().myDabiaoInfo+i18n("ActivityType4Panel_31");if(this.label_DabiaoTarget)this.label_DabiaoTarget.text=i18n("ActivityType4Panel_32")+curValue;break;case RankDataType.TYPE_XIAOFEI:this.rankDesc.text=Activity.ins().myDabiaoInfo+i18n("ActivityType4Panel_33");if(this.label_DabiaoTarget)this.label_DabiaoTarget.text=i18n("ActivityType4Panel_34")+curValue+i18n("ActivityType4Panel_35");break}};ActivityType4Panel.prototype.getDataList=function(id){var config=GlobalConfig["ActivityType4Panel"][id];var list=[];for(var k in config){if(config[k].ranking==0)this.dabiao=config[k];else list.push(config[k])}return list};ActivityType4Panel.prototype.onClick=function(e){switch(e.currentTarget){case this.getReward:Activity.ins().sendGetDabiaoReward(this.activityID);break;case this.btn_showRank:case this.btn_showRank0:if(this.group_Rank){this.group_Rank.visible=!this.group_Rank.visible;if(this.btn_showRank){this.btn_showRank.label=this.group_Rank.visible?i18n("ActivityType4Panel_36"):i18n("ActivityType4Panel_37")}}break}};ActivityType4Panel.prototype.getCurValue=function(){var rtn=0;return rtn};ActivityType4Panel.prototype.getCurRewards=function(){var rtn=[];return rtn};ActivityType4Panel.prototype.getCurStatus=function(){var rtn=0;return rtn};return ActivityType4Panel}(ActivityPanel);__reflect(ActivityType4Panel.prototype,"ActivityType4Panel");var ActivityType5Panel=function(_super){__extends(ActivityType5Panel,_super);function ActivityType5Panel(){var _this=_super.call(this)||this;_this.rewardIndex=-1;_this.btnMax=0;return _this}ActivityType5Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.refushSkin()};ActivityType5Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.refushSkin();this.updateData();this.addTouchEvent(this.sureBtn1,this.onClick);this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);for(var i=1;i<=this.btnMax;i++){this.addTouchEvent(this["btn"+i],this.onClick)}};ActivityType5Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}debug.log("close");this.removeTouchEvent(this.sureBtn1,this.onClick);for(var i=1;i<=this.btnMax;i++){this.removeTouchEvent(this["btn"+i],this.onClick)}this.removeObserve()};ActivityType5Panel.prototype.refushSkin=function(){if(this.activityBtnType==ActivityBtnType.ZHONG_QIU){this.btnMax=7;this.skinName="ActMidLogSkin"}else if(this.activityBtnType==ActivityBtnType.SHENG_XIA){this.btnMax=5;this.skinName="SunmerLogSkin"}else{this.btnMax=10;this.skinName="ActNatLogSkin"}this.list1.itemRenderer=ItemBase};ActivityType5Panel.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.date.text=i18n("ActivityType5Panel_0")}else if(endedTime<=0){this.date.text=i18n("ActivityType5Panel_1")}else{this.date.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc;this.refushBtnReward()};ActivityType5Panel.prototype.refushBtnReward=function(index){if(index===void 0){index=0}var activityData=Activity.ins().getActivityDataById(this.activityID);if(index==0){index=activityData.logTime;if(!activityData.logTime){index=1}}this.rewardIndex=index;var config=GlobalConfig["ActivityType5Config"][this.activityID][this.rewardIndex-1+""];this.list1.dataProvider=new eui.ArrayCollection(config.rewards);if(this.selectBtn){this.selectBtn.currentState="up"}this.selectBtn=this["btn"+index];this.selectBtn.currentState="down";if(index<=activityData.logTime){if(activityData.checkOneDayStatu(index)){this.sign.visible=false;this.sureBtn1.visible=true}else{this.sign.visible=true;this.sureBtn1.visible=false}}else{this.sign.visible=false;this.sureBtn1.visible=false}};ActivityType5Panel.prototype.onClick=function(e){switch(e.currentTarget){case this.sureBtn1:Activity.ins().sendReward(this.activityID,this.rewardIndex);break;case this.btn1:this.refushBtnReward(1);break;case this.btn2:this.refushBtnReward(2);break;case this.btn3:this.refushBtnReward(3);break;case this.btn4:this.refushBtnReward(4);break;case this.btn5:this.refushBtnReward(5);break;case this.btn6:this.refushBtnReward(6);break;case this.btn7:this.refushBtnReward(7);break;case this.btn8:this.refushBtnReward(8);break;case this.btn9:this.refushBtnReward(9);break;case this.btn10:this.refushBtnReward(10);break}};return ActivityType5Panel}(ActivityPanel);__reflect(ActivityType5Panel.prototype,"ActivityType5Panel");var ActivityWin=function(_super){__extends(ActivityWin,_super);function ActivityWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.ActBtnMark=[];_this.helpId=54;_this.skinName="ActivityWinSkin";_this.isTopLevel=true;_this.selectIndex=0;_this.menuList.itemRenderer=ActivityBtnRenderer;_this.dataArr=new eui.ArrayCollection;_this.menuList.dataProvider=_this.dataArr;return _this}ActivityWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};ActivityWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};ActivityWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ACTIVITY));return false}if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ACTIVITY));return false}var actId=param[0];if(actId==Activity.ins().springId){if(!Activity.ins().getActivityDataById(actId)||!Activity.ins().getActivityDataById(actId).isOpenActivity()){UserTips.ins().showTips(i18n("ActivityWin_0"));return false}}else{if(actId!=undefined){if(!Activity.ins().getActivityDataById(actId)||!Activity.ins().getActivityDataById(actId).isOpenActivity()||!PActivity.ins().getActivityDataById(actId)||!PActivity.ins().getActivityDataById(actId).isOpenActivity()){UserTips.ins().showTips(i18n("ActivityWin_0"));return false}}}var sum=Object.keys(Activity.ins().activityData);var psum=Object.keys(PActivity.ins().activityData);if(!sum.length&&!psum.length){UserTips.ins().showTips(i18n("ActivityWin_1"));return false}for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k]||Activity.ins().activityData[k].pageStyle||Activity.ins().activityData[k].timeType==ActivityDataFactory.TimeType_Total){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}for(var k in PActivity.ins().activityData){if(PActivity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("ActivityWin_2"));return false};ActivityWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.addTouchEvent(this.help,this.onTouchBtn);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postMuchDayRecReward,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.observe(Activity.ins().postChangePage,this.ChangePageCallBack);this.observe(PActivity.ins().postActivityPanel,this.updatePanel);this.observe(PActivity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(PActivity.ins().postChangePage,this.ChangePageCallBack);this.addChangeEvent(this.menuScroller,this.onChange)};ActivityWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};ActivityWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr)};ActivityWin.prototype.updateView=function(){var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];this.ActBtnMark=[];i=0;for(var k in Activity.ins().activityData){if(k=="8501"||k=="8601"){var kk=1}if(!Activity.ins().activityData[k]||Activity.ins().activityData[k].pageStyle||Activity.ins().activityData[k].timeType==ActivityDataFactory.TimeType_Total){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(data&&data.activityType&&data.activityType==ActivityType.Nesting)continue;if(!ErrorLog.Assert(data,"ActivityWin  data   "+k)){this._datas.push(data);this.ActBtnMark.push(Activity.ins().isShowRedPointByBtnInfo(data))}}}for(var k in PActivity.ins().activityData){if(PActivity.ins().getActivityDataById(+k).isOpenActivity()){var data=PActivity.ins().getbtnInfo(k);if(data&&data.activityType&&data.activityType==ActivityType.Nesting)continue;if(!ErrorLog.Assert(data,"PActivityWin  data   "+k)){this._datas.push(data);this.ActBtnMark.push(PActivity.ins().isShowRedPointByBtnInfo(data))}}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var type=this._datas[k].type;var isshowInthisWin=true;if(GlobalConfig.FirstRankConfig[id]){isshowInthisWin=false;console.log("111===ActityWin skip Panel title = "+this._datas[k].title+" id = "+id);continue}for(var k_1 in GlobalConfig.FirstRankConfig){if(id==GlobalConfig.FirstRankConfig[k_1].packId||id==GlobalConfig.FirstRankConfig[k_1].rewardActId){isshowInthisWin=false;console.log("222=== id = "+id+"   packId:"+GlobalConfig.FirstRankConfig[k_1].packId+"   rewardActId:"+GlobalConfig.FirstRankConfig[k_1].rewardActId);break}}if(!isshowInthisWin)continue;var rechargeId=Activity.ins().rechargeId;var act=void 0;if(this._datas[k]&&this._datas[k].activityType==ActivityType.Normal){act=Activity.ins().getActivityDataById(+id)}else if(this._datas[k]&&this._datas[k].activityType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(+id)}if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,act.activityType);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);if(ChannelMgr.ins().isRechargeHidden()){if(rechargeId.indexOf(id)<0){this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}else{this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}}this.dataArr.replaceAll(this.BtnArr);this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}if(GameServer.serverOpenDay<7){this.title.source="biaoti_kaifuhuodong";this.title.x=120}else{this.title.source="biaoti_huodong";this.title.x=148}};ActivityWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};ActivityWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};ActivityWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;this.help.visible=false;var config;var actType=this.activityPanelList[selectedIndex].activityType;if(actType==ActivityType.Normal){Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);Activity.ins().setfirstShowRedPointById(this.activityPanelList[selectedIndex].activityID,"onclicked");config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID]}else if(actType==ActivityType.Personal){PActivity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);PActivity.ins().setfirstShowRedPointById(this.activityPanelList[selectedIndex].activityID,"onclicked");config=GlobalConfig.PActivityConfig[this.activityPanelList[this.selectIndex].activityID]}if(config){if(config.activityType==ActivityDataFactory.ACTIVITY_TYPE_9){this.help.visible=true;this.helpId=54}if(config.activityType==ActivityDataFactory.ACTIVITY_TYPE_28){this.help.visible=true;this.helpId=70}}this.refushRedPoint()};ActivityWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=void 0;var actType=this.activityPanelList[this.selectIndex].activityType;if(actType==ActivityType.Normal)config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];else if(actType==ActivityType.Personal)config=GlobalConfig.PActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){if(config.activityType==ActivityDataFactory.ACTIVITY_TYPE_3||config.activityType==ActivityDataFactory.ACTIVITY_TYPE_9||config.activityType==ActivityDataFactory.ACTIVITY_TYPE_19||config.activityType==ActivityDataFactory.ACTIVITY_TYPE_28){this.setOpenIndex(this.selectIndex)}else{if(actType==ActivityType.Normal)Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID);else if(actType==ActivityType.Personal)PActivity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID)}}}};ActivityWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};ActivityWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}if(this.leftBtn.visible)this.leftRed.visible=this.getRedMark();else this.leftRed.visible=false;if(this.rightBtn.visible)this.rightRed.visible=this.getRedMark();else this.rightRed.visible=false};ActivityWin.prototype.getRedMark=function(){for(var k in this.ActBtnMark){if(this.ActBtnMark[k]==true)return true}return false};ActivityWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[this.helpId].text);break}this.onChange()};ActivityWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else{if(a.activityType>b.activityType)return 1;else return-1}};return ActivityWin}(BaseEuiView);__reflect(ActivityWin.prototype,"ActivityWin");ViewManager.ins().reg(ActivityWin,LayerManager.UI_Main);var DoubleTwelveModel=function(_super){__extends(DoubleTwelveModel,_super);function DoubleTwelveModel(){return _super!==null&&_super.apply(this,arguments)||this}DoubleTwelveModel.ins=function(){return _super.ins.call(this)};DoubleTwelveModel.prototype.getNeedRecharge=function(activityId){var data=Activity.ins().doubleTwelveRechargeData[activityId];var cfg=GlobalConfig.ActivityType3Config[activityId][1];return Math.max(0,cfg.val-data.chongzhiTotal)};return DoubleTwelveModel}(BaseClass);__reflect(DoubleTwelveModel.prototype,"DoubleTwelveModel");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.doubleTwelveModel=DoubleTwelveModel.ins.bind(DoubleTwelveModel)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var cc_launchX=180;window["cc_launchX"]=cc_launchX;var cc_launchY=500;window["cc_launchY"]=cc_launchY;var cc_firstX=0;window["cc_firstX"]=cc_firstX;var cc_firstY=0;window["cc_firstY"]=cc_firstY;var cc_distantX=77;window["cc_distantX"]=cc_distantX;var cc_distantY=93;window["cc_distantY"]=cc_distantY;var cc_depotX=320;window["cc_depotX"]=cc_depotX;var cc_depotY=620;window["cc_depotY"]=cc_depotY;var cwaitTime=50;window["cwaitTime"]=cwaitTime;var LuckyResultWin=function(_super){__extends(LuckyResultWin,_super);function LuckyResultWin(){var _this=_super.call(this)||this;_this.arr=[];_this.items=[];_this.type=0;return _this}LuckyResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="HuntResult";this.isTopLevel=true};LuckyResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.buyBtn,this.buy);this.addTouchEvent(this.rectBg,this.closeWin);this.addTouchEvent(this.closeBtn,this.closeWin);this.observe(Activity.ins().postRewardResult,this.updateView);this.activityID=param[0];this.indexs=param[1];this.activityType=param[2]||9;this.updateView()};LuckyResultWin.prototype.closeWin=function(){ViewManager.ins().close(LuckyResultWin)};LuckyResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buyBtn,this.buy);this.removeTouchEvent(this.rectBg,this.closeWin);this.removeTouchEvent(this.closeBtn,this.closeWin);this.removeObserve()};LuckyResultWin.prototype.updateView=function(){this.canClicck=true;this.zwHunt.visible=true;var config1;if(GlobalConfig.PActivityBtnConfig[this.activityID]){config1=GlobalConfig.PActivityType9Config}else{config1=GlobalConfig.ActivityType9Config}if(this.activityType==28){if(GlobalConfig.PActivityBtnConfig[this.activityID]){config1=GlobalConfig.PActivityType28_1Config}else{config1=GlobalConfig.ActivityType28_1Config}}var config2=config1[this.activityID];this.arr=[];for(var i=0;i<this.indexs.length;i++){if(!this.indexs[i])continue;for(var j=0;j<config2[this.indexs[i]].reward.length;j++){this.arr.push(config2[this.indexs[i]].reward[j])}}this.title.text=i18n("LuckyResultWin_0");this.buyBtn.labelDisplay.text=i18n("LuckyResultWin_1");this.yb=config2[0].yb*10;this.zw.text=this.yb+"";var itemcfg=GlobalConfig.ItemConfig[config2[0].item];this.icon.source=itemcfg?itemcfg.icon+"_png":null;this.itemId=config2[0].item;this.updateDesc();this.playResult();this.zwNum2.text="/10）"};LuckyResultWin.prototype.updateDesc=function(){var item=UserBag.ins().getBagItemById(this.itemId);var colorStr=ColorUtil.UI_ITEMNUMBER_BULE;var sum=0;var maxsum=10;if(item){sum=item.count;if(item.count>=maxsum){colorStr=ColorUtil.GREEN_COLOR}else{colorStr=ColorUtil.RED_COLOR}}this.zwNum1.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+sum+"</font> ")};LuckyResultWin.prototype.playResult=function(fun){var _this=this;this.releaseAllItem();var count=this.arr.length;var needNoticeItems=[];for(var i=0;i<count;i++){this.items[i]=this.createItem(this.arr[i]);var cfg=GlobalConfig.ItemConfig[this.arr[i].id];if(cfg&&cfg.needNotice){needNoticeItems.push(cfg)}var t=egret.Tween.get(this.items[i]);this.items[i].x=i%5*cc_distantX+cc_firstX;this.items[i].y=Math.floor(i/5)*cc_distantY+cc_firstY;this.items[i].alpha=0;t.wait(i*cwaitTime).to({alpha:1},200).call(function(){count--;if(count==0){if(fun!=undefined){fun()}_this.canClicck=true}})}if(needNoticeItems.length>0){ViewManager.ins().open(HuntResultNoticeWin,needNoticeItems)}};LuckyResultWin.prototype.playGet=function(fun){var _this=this;var count=this.arr.length;for(var i=0;i<count;i++){if(!this.items[i])continue;var t=egret.Tween.get(this.items[i]);t.to({y:cc_depotY,x:cc_depotX,scaleX:0,scaleY:0},300-Math.floor(i/5)*50).call(function(){count--;if(count==0){if(fun!=undefined){fun()}_this.releaseAllItem()}})}};LuckyResultWin.prototype.createItem=function(data){var item=new ItemBase;this.listCon.addChild(item);var cfg=GlobalConfig.ItemConfig[data.id];if(cfg){item.num=data.count;item.data=data}else{item.data={type:0,count:data.count,id:data.id}}item.x=cc_launchX;item.y=cc_launchY;return item};LuckyResultWin.prototype.releaseAllItem=function(){for(var k in this.items){this.items[k].destruct();this.listCon.removeChild(this.items[k])}this.items=[]};LuckyResultWin.prototype.buy=function(e){if(!this.canClicck){return}if(GlobalConfig.PActivityBtnConfig[this.activityID]){this.ins=PActivity.ins();this.config1=GlobalConfig.PActivityType9Config;if(this.activityType==28){this.config1=GlobalConfig.PActivityType28_1Config}}else{this.ins=Activity.ins();this.config1=GlobalConfig.ActivityType9Config;if(this.activityType==28){this.config1=GlobalConfig.ActivityType28_1Config}}var config=this.config1[this.activityID][0];var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,config.item);if(item&&item.count){this.ins.sendReward(this.activityID,2)}else{var times=10;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-10",this.huntWarnFun.bind(this),i18n("LuckyResultWin_2",config.yb*times,GlobalConfig.ItemConfig[config.item].name,times))}};LuckyResultWin.prototype.huntWarnFun=function(){var config=this.config1[this.activityID][0];if(Actor.yb>=config.yb*10){this.ins.sendReward(this.activityID,2)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("LuckyResultWin_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("LuckyResultWin_4"))}};return LuckyResultWin}(BaseEuiView);__reflect(LuckyResultWin.prototype,"LuckyResultWin");ViewManager.ins().reg(LuckyResultWin,LayerManager.UI_Main);var NoticeListRenderer=function(_super){__extends(NoticeListRenderer,_super);function NoticeListRenderer(){var _this=_super.call(this)||this;_this.job=["",i18n("NoticeListRenderer_0"),i18n("NoticeListRenderer_1"),i18n("NoticeListRenderer_2")];_this.skinName="HuntListRendererSkin";return _this}NoticeListRenderer.prototype.dataChanged=function(){var str="";this.activityID=this.data.activityID;this.activityType=this.data.activityType;this.actType=this.data.actType;switch(this.activityType){case ActivityDataFactory.ACTIVITY_TYPE_17:var actDatas=GlobalConfig.ActivityType17_3Config[this.activityID];var awards=actDatas[CommonUtils.getObjectLength(actDatas)].group;var item=GlobalConfig.ItemConfig[awards[this.data.index-1].id];var cstr=ItemConfig.getQualityColor(item);var nstr=item.name;str=i18n("NoticeListRenderer_3",this.data.name,cstr,nstr,awards[this.data.index-1].count);break;case ActivityDataFactory.ACTIVITY_TYPE_28:var name_5=this.data.name;var index=this.data.index;var config=void 0;if(this.actType==ActivityType.Normal){config=GlobalConfig.ActivityType28_1Config[this.activityID][index]}else if(this.actType==ActivityType.Personal){config=GlobalConfig.PActivityType28_1Config[this.activityID][index]}if(config){var nstr_1="";var cstr_1=ColorUtil.NORMAL_COLOR;if(!config.reward[0].type){var type=1;switch(config.reward[0].id){case MoneyConst.yuanbao:type=5;break;case MoneyConst.gold:type=0;break;case MoneyConst.soul:type=2;break;case MoneyConst.piece:type=2;break;case MoneyConst.godweaponExp:type=2;break;default:break}nstr_1=RewardData.getCurrencyName(config.reward[0].id);cstr_1=ItemBase.QUALITY_COLOR[type];str="<font color = '#15F2B9'>"+name_5+i18n("NoticeListRenderer_4")+cstr_1+"'>"+nstr_1+"</font>"}else{var item_2=GlobalConfig.ItemConfig[config.reward[0].id];nstr_1=item_2.name;cstr_1=ItemConfig.getQualityColor(item_2);var itemtype=ItemConfig.getType(item_2);if(itemtype==0){if(item_2){if(item_2.zsLevel>0){nstr_1+="("+item_2.zsLevel+i18n("NoticeListRenderer_5")}else{nstr_1+="("+item_2.level+i18n("NoticeListRenderer_6")}nstr_1+=this.job[ItemConfig.getJob(item_2)]+")"}}str="<font color = '#15F2B9'>"+name_5+"</font> "+(this.data.des?this.data.des:i18n("NoticeListRenderer_7"))+" <font color='"+cstr_1+"'>"+nstr_1+"</font>"}}break;default:name_5=this.data.name;index=this.data.index;var config9=void 0;if(this.actType==ActivityType.Normal){config9=GlobalConfig.ActivityType9Config[this.activityID][index]}else if(this.actType==ActivityType.Personal){config9=GlobalConfig.PActivityType9Config[this.activityID][index]}if(config){var nstr_2="";var cstr_2=ColorUtil.NORMAL_COLOR;if(!config.reward[0].type){var type=1;switch(config.reward[0].id){case MoneyConst.yuanbao:type=5;break;case MoneyConst.gold:type=0;break;case MoneyConst.soul:type=2;break;case MoneyConst.piece:type=2;break;case MoneyConst.godweaponExp:type=2;break;default:break}nstr_2=RewardData.getCurrencyName(config.reward[0].id);cstr_2=ItemBase.QUALITY_COLOR[type];str="<font color = '#12b2ff'>"+name_5+i18n("NoticeListRenderer_4")+cstr_2+"'>"+nstr_2+"</font>"}else{var item_3=GlobalConfig.ItemConfig[config.reward[0].id];nstr_2=item_3.name;cstr_2=ItemConfig.getQualityColor(item_3);var itemtype=ItemConfig.getType(item_3);if(itemtype==0){if(item_3){if(item_3.zsLevel>0){nstr_2+="("+item_3.zsLevel+i18n("NoticeListRenderer_5")}else{nstr_2+="("+item_3.level+i18n("NoticeListRenderer_6")}nstr_2+=this.job[ItemConfig.getJob(item_3)]+")"}}str="<font color = '#12b2ff'>"+name_5+"</font> "+(this.data.des?this.data.des:i18n("NoticeListRenderer_7"))+" <font color='"+cstr_2+"'>"+nstr_2+"</font>"}}}this.showText.textFlow=TextFlowMaker.generateTextFlow(str)};NoticeListRenderer.QUALITY_COLOR=["#e2dfd4","#03b154","#d242fb","#ff750f","#f3311e","#ffd93f"];return NoticeListRenderer}(BaseItemRender);__reflect(NoticeListRenderer.prototype,"NoticeListRenderer");var NoticeYBListRenderer=function(_super){__extends(NoticeYBListRenderer,_super);function NoticeYBListRenderer(){var _this=_super.call(this)||this;_this.skinName="HuntListRendererSkin";return _this}NoticeYBListRenderer.prototype.dataChanged=function(){var name=this.data.name;this.activityID=this.data.activityID;var multiple=this.data.multiple;var yb=this.data.yb;var str="";var nstr="";var cstr=ColorUtil.NORMAL_COLOR;var type=5;nstr=RewardData.getCurrencyName(2);cstr=16711680;str="<font color = '#16b2ff'>"+name+i18n("NoticeYBListRenderer_0")+cstr+"'>"+multiple+i18n("NoticeYBListRenderer_1")+cstr+"'>"+(""+yb)+i18n("NoticeYBListRenderer_2");this.showText.textFlow=TextFlowMaker.generateTextFlow(str)};return NoticeYBListRenderer}(BaseItemRender);__reflect(NoticeYBListRenderer.prototype,"NoticeYBListRenderer");var SpringTurntableLogo=function(_super){__extends(SpringTurntableLogo,_super);function SpringTurntableLogo(){var _this=_super.call(this)||this;_this.skinName="toAct28Skin";_this.isTopLevel=true;return _this}SpringTurntableLogo.prototype.initUI=function(){_super.prototype.initUI.call(this);this.rewards.itemRenderer=ItemBase};SpringTurntableLogo.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.activityID=param[0];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.bgClose,this.onClick);this.addTouchEvent(this.btnGo,this.onClick);this.addTouchEvent(this.cbCheck,this.onClick);this.updateView()};SpringTurntableLogo.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this);this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.bgClose,this.onClick);this.removeTouchEvent(this.btnGo,this.onClick);this.removeTouchEvent(this.cbCheck,this.onClick)};SpringTurntableLogo.prototype.updateView=function(){var cfg=GlobalConfig.ActivityType28_1Config[this.activityID][0];var advertisingId=cfg.advertisingId;this.rewards.dataProvider=new eui.ArrayCollection(advertisingId);var shapeId=44;var name=GlobalConfig.ShapeShiftingConfig[shapeId].name;this.shapeName.text=name;var mc=new MovieClip;mc.playFile(RES_DIR_EFF+"sjbs_ssrziff",-1);this.mcGroup.addChild(mc);this.setAuto()};SpringTurntableLogo.prototype.setAuto=function(){this.cbCheck.selected=SysSetting.ins().getBool(SysSetting.SPRING_ACT_WIN)};SpringTurntableLogo.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.btnGo:ViewManager.ins().closeTopLevel();ViewManager.ins().open(ActivityWin,this.activityID);break;case this.cbCheck:SysSetting.ins().setBool(SysSetting.SPRING_ACT_WIN,e.currentTarget.selected);break}};return SpringTurntableLogo}(BaseEuiView);__reflect(SpringTurntableLogo.prototype,"SpringTurntableLogo");ViewManager.ins().reg(SpringTurntableLogo,LayerManager.UI_Popup);var SpringTurntableRankItemRender=function(_super){__extends(SpringTurntableRankItemRender,_super);function SpringTurntableRankItemRender(){var _this=_super.call(this)||this;_this.skinName="SpringTurntableRankItemSkin";return _this}SpringTurntableRankItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBaseNoName};SpringTurntableRankItemRender.prototype.dataChanged=function(){if(!this.data){return}var data=this.data;var rank=data.pos;if(rank<=3){this.rankImg.source="paihang"+rank;this.rank.visible=false}else{this.rankImg.source="";this.rank.visible=true;this.rank.text=rank+""}this.nickname.text=data.player;if(data.value>-1){this.score.text=data.value.toString()}else{this.score.text=""}var cfg=GlobalConfig.ActivityType28_2Config;var arr=cfg&&cfg[rank]&&cfg[rank].award||[];this.reward.dataProvider=new ArrayCollection(arr)};return SpringTurntableRankItemRender}(BaseItemRender);__reflect(SpringTurntableRankItemRender.prototype,"SpringTurntableRankItemRender");var SpringTurntableRankWin=function(_super){__extends(SpringTurntableRankWin,_super);function SpringTurntableRankWin(){var _this=_super.call(this)||this;_this.rank=-1;_this.value=0;_this.skinName="SpringTurntableRankWinSkin";_this.isTopLevel=true;return _this}SpringTurntableRankWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.list.itemRenderer=SpringTurntableRankItemRender};SpringTurntableRankWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.activityID=param[0];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.help,this.onTouchBtn);this.observe(Rank.ins().postRankingData,this.updateRank);this.updateView();Rank.ins().sendGetRankingData(RankDataType.TYPE_SPRING_TURNTABLE);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.target.text=GlobalConfig.ActivityType28_1Config[this.activityID][0].rank_cond.toString();var data=Activity.ins().activityData[this.activityID];this.value=data.score;this.myValue.text=this.value.toString()};SpringTurntableRankWin.prototype.updateRank=function(rankModel){if(rankModel&&rankModel.type!=RankDataType.TYPE_SPRING_TURNTABLE)return;var ranks=rankModel?rankModel.getDataList():[];for(var i=0;i<ranks.length;i++){var data_2=ranks[i];var id=data_2.id;if(id==Actor.actorID){this.rank=data_2.pos;this.value=data_2.value;break}}var len=CommonUtils.getObjectLength(GlobalConfig.ActivityType28_2Config);if(ranks.length<len){for(var i=Math.max(0,ranks.length);i<len;i++){var data=new RankDataSpring;data.pos=ranks.length+1;data.player="";data.value=-1;ranks.push(data)}}this.list.dataProvider=new ArrayCollection(ranks);this.myRank.text=this.rank>0?this.rank.toString():i18n("RankingWin_0");this.myValue.text=this.value.toString()};SpringTurntableRankWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this)};SpringTurntableRankWin.prototype.updateView=function(){if(GameServer.serverOpenDay<7){this.title.source="biaoti_kaifuhuodong";this.title.x=120}else{this.title.source="biaoti_huodong";this.title.x=148}this.setTime()};SpringTurntableRankWin.prototype.setTime=function(){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(data)this.actTime.text=data.getRemainTime()};SpringTurntableRankWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};SpringTurntableRankWin.prototype.onTouchBtn=function(e){switch(e.target){case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[62].text);break}};return SpringTurntableRankWin}(BaseEuiView);__reflect(SpringTurntableRankWin.prototype,"SpringTurntableRankWin");ViewManager.ins().reg(SpringTurntableRankWin,LayerManager.UI_Main);var SpringTurntableRewardWin=function(_super){__extends(SpringTurntableRewardWin,_super);function SpringTurntableRewardWin(){var _this=_super.call(this)||this;_this.index=0;_this.len=1;_this.skinName="SpringTurntableRewardWinSkin";_this.isTopLevel=true;return _this}SpringTurntableRewardWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};SpringTurntableRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.activityID=param[0];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.arrowright,this.onClick);this.addTouchEvent(this.arrowleft,this.onClick);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateView()};SpringTurntableRewardWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this);this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.arrowright,this.onClick);this.removeTouchEvent(this.arrowleft,this.onClick)};SpringTurntableRewardWin.prototype.updateView=function(){var cfg=GlobalConfig.ActivityType28_1Config[this.activityID][0];if(!cfg){return}this.len=cfg.aniRes.length;this.index=0;this.onChangePage()};SpringTurntableRewardWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.arrowleft:if(this.index>0){this.index-=1;this.onChangePage()}break;case this.arrowright:if(this.index<this.len-1){this.index+=1;this.onChangePage()}break}};SpringTurntableRewardWin.prototype.onChangePage=function(){this.arrowleft.visible=this.index>=1;this.arrowright.visible=this.index<this.len-1;var cfg=GlobalConfig.ActivityType28_1Config[this.activityID][0];if(!cfg){return}var res=cfg.aniRes[this.index].res;var x=cfg.aniRes[this.index].x;var y=cfg.aniRes[this.index].y;if(!this.mc){var mc=new MovieClip;this.mcGroup.addChild(mc);this.mc=mc}this.mc.playFile(res,-1);this.mc.x=x;this.mc.y=y};SpringTurntableRewardWin.prototype.setTime=function(){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(data)this.actTime.text=data.getRemainTime()};return SpringTurntableRewardWin}(BaseEuiView);__reflect(SpringTurntableRewardWin.prototype,"SpringTurntableRewardWin");ViewManager.ins().reg(SpringTurntableRewardWin,LayerManager.UI_Main);var SpringTurntableScoreItemRender=function(_super){__extends(SpringTurntableScoreItemRender,_super);function SpringTurntableScoreItemRender(){var _this=_super.call(this)||this;_this.state=0;_this.skinName="SpringTurntableScoreItemSkin";return _this}SpringTurntableScoreItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName;this.init();this.setMC()};SpringTurntableScoreItemRender.prototype.init=function(){this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this)};SpringTurntableScoreItemRender.prototype.dataChanged=function(){this.id=this.data.id;this.activityID=this.data.activityID;var cfg=GlobalConfig.ActivityType28_3Config[this.id];if(!cfg){return}var data=Activity.ins().activityData[this.activityID];var score=cfg.score;this.tar.text=score.toString();this.tar2.text=score.toString();var cur=data.score||0;this.cur.text=cur.toString();this.state=Activity.ins().getScoreReward28State(this.activityID,this.id);this.btnGet.enabled=false;if(this.state==2){this.btnGet.label=i18n("SpringTurntableScoreItemRender_2")}else if(this.state==1){this.btnGet.enabled=true;this.btnGet.label=i18n("SpringTurntableScoreItemRender_1")}else{this.btnGet.label=i18n("SpringTurntableScoreItemRender_0")}this.eff.visible=this.redPoint.visible=this.state==1;var rewards=cfg.award;this.list.dataProvider=new eui.ArrayCollection(rewards)};SpringTurntableScoreItemRender.prototype.onTap=function(e){switch(e.currentTarget){case this.btnGet:if(this.state==1){Activity.ins().sendReward(this.activityID,0,this.id)}break}};SpringTurntableScoreItemRender.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=51;this.mc.y=20;this.mc.width=102;this.mc.height=46;this.mc.scaleX=.66;this.mc.scaleY=.78;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.eff.addChild(this.mc)}};return SpringTurntableScoreItemRender}(BaseItemRender);__reflect(SpringTurntableScoreItemRender.prototype,"SpringTurntableScoreItemRender");var SpringTurntableScoreWin=function(_super){__extends(SpringTurntableScoreWin,_super);function SpringTurntableScoreWin(){var _this=_super.call(this)||this;_this.skinName="SpringTurntableScoreWinSkin";_this.isTopLevel=true;return _this}SpringTurntableScoreWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.list.itemRenderer=SpringTurntableScoreItemRender};SpringTurntableScoreWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.activityID=param[0];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}this.addTouchEvent(this.closeBtn,this.onClick);this.observe(ins.postActivityIsGetAwards,this.updateView);this.updateView()};SpringTurntableScoreWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this)};SpringTurntableScoreWin.prototype.updateView=function(){var cfg=GlobalConfig.ActivityType28_3Config;var arr=[];for(var i in cfg){var state=Activity.ins().getScoreReward28State(this.activityID,cfg[i].id);var data={activityID:this.activityID,id:cfg[i].id,state:state};arr.push(data)}arr.sort(this.sortFunc);this.list.dataProvider=new eui.ArrayCollection(arr)};SpringTurntableScoreWin.prototype.sortFunc=function(a,b){if(a.state==2&&b.state!=2){return 1}if(a.state!=2&&b.state==2){return-1}return 0};SpringTurntableScoreWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};return SpringTurntableScoreWin}(BaseEuiView);__reflect(SpringTurntableScoreWin.prototype,"SpringTurntableScoreWin");ViewManager.ins().reg(SpringTurntableScoreWin,LayerManager.UI_Main);var ThanksGivingWin=function(_super){__extends(ThanksGivingWin,_super);function ThanksGivingWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.skinName="ActivityWinSkin";_this.isTopLevel=true;_this.selectIndex=0;return _this}ThanksGivingWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.menuList.itemRenderer=ActivityBtnRenderer};ThanksGivingWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};ThanksGivingWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.THANKS)continue;if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("ThanksGivingWin_0"));return false};ThanksGivingWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.closeBtn0,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.observe(Activity.ins().postChangePage,this.ChangePageCallBack);this.addChangeEvent(this.menuScroller,this.onChange)};ThanksGivingWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.closeBtn0,this.onClick);this.menuList.removeEventListener(egret.Event.CHANGE,this.onClickMenu,this);this.removeTouchEvent(this.leftBtn,this.onTouchBtn);this.removeTouchEvent(this.rightBtn,this.onTouchBtn);this.menuScroller.removeEventListener(egret.Event.CHANGE,this.onChange,this);this.removeObserve();TimerManager.ins().removeAll(this);for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};ThanksGivingWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};ThanksGivingWin.prototype.updateView=function(){var index=0;var i=0;for(var i_9=0;i_9<this.viewStack.numElements;i_9++){ObjectPool.push(this.viewStack.getElementAt(i_9))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.THANKS){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(!ErrorLog.Assert(data,"ThanksGivingWin  data   "+k))this._datas.push(data)}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=void 0;if(this._datas[k].activityType==ActivityType.Normal){act=Activity.ins().getActivityDataById(+id)}else if(this._datas[k].activityType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(+id)}if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,act.activityType);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}this.title.source="biaoti_ganen"};ThanksGivingWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};ThanksGivingWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};ThanksGivingWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);this.refushRedPoint()};ThanksGivingWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){if(config.activityType==3){this.setOpenIndex(this.selectIndex)}else{Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID)}}}};ThanksGivingWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};ThanksGivingWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}this.leftRed.visible=this.leftBtn.visible;this.rightRed.visible=this.rightBtn.visible};ThanksGivingWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};ThanksGivingWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return ThanksGivingWin}(BaseEuiView);__reflect(ThanksGivingWin.prototype,"ThanksGivingWin");ViewManager.ins().reg(ThanksGivingWin,LayerManager.UI_Main);var TotalRechargeWin=function(_super){__extends(TotalRechargeWin,_super);function TotalRechargeWin(){var _this=_super.call(this)||this;_this.skinName="DTRechargeSkin";_this.isTopLevel=true;return _this}TotalRechargeWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.list.itemRenderer=DoubleTwelveRechargeItem;this.addTouchEvent(this.closeBtn,this.closeWin);this.addTouchEvent(this.bgClose,this.closeWin);this.addTouchEvent(this.chooseBtn0,this.onSelect);this.addTouchEvent(this.chooseBtn1,this.onSelect);this.addTouchEvent(this.chooseBtn2,this.onSelect);this.addTouchEvent(this.rechargeBtn,this.onRecharge);this.observe(Recharge.ins().postUpdateRecharge,this.update);this.observe(Recharge.ins().postUpdateRechargeEx,this.update);this.observe(Activity.ins().postChangePage,this.update);this.observe(Activity.ins().postRewardResult,this.update);this.observe(Activity.ins().postActivityIsGetAwards,this.update);this.updateView()};TotalRechargeWin.prototype.onRecharge=function(e){if(this.recharge.visible){Recharge.ins().tryShowChargeFirstWin()}else{Activity.ins().sendReward(this._activityId,this._index)}};TotalRechargeWin.prototype.update=function(){TimerManager.ins().remove(this.updateView,this);TimerManager.ins().doTimer(80,1,this.updateView,this)};TotalRechargeWin.prototype.getActivityId=function(){var datas=Activity.ins().activityData;for(var i in datas){if(datas[i].pageStyle==ActivityPageStyle.TOTALRECHARGE){if(Activity.ins().getActivityDataById(datas[i].id).isOpenActivity()&&!Activity.ins().getActivityDataById(datas[i].id).getHide()){return datas[i].id}}}return 0};TotalRechargeWin.prototype.updateView=function(){var id=this.getActivityId();this._activityId=id;var data=Activity.ins().getActivityDataById(id);var time=data.getLeftTime();var timedesc=Math.floor(time*1e3/DateUtils.MS_PER_DAY);var desc;if(timedesc==0){timedesc=Math.floor(time*1e3/(DateUtils.MS_PER_DAY/24));desc=i18n("TotalRechargeWin_0",timedesc)}else{desc=i18n("TotalRechargeWin_1",timedesc)}this.limitTime.text=i18n("TotalRechargeWin_2",desc);for(var i=1;i<=3;i++){this.setText(i)}var selectId=1;var configs=GlobalConfig.ActivityType3Config[id];for(var i=1;i<=3;i++){var config=configs[i];if(config.val>data.chongzhiTotal||(data.recrod>>config.index&1)==0){selectId=i;break}}this.selectActivity(selectId)};TotalRechargeWin.prototype.selectBtn=function(index){this.select0.visible=false;this.select1.visible=false;this.select2.visible=false;this["select"+index].visible=true};TotalRechargeWin.prototype.selectActivity=function(index){var activityId=this._activityId;this._index=index;var data=Activity.ins().getActivityDataById(activityId);var config=GlobalConfig.ActivityType3Config[activityId][index];var needMoney=Math.max(0,config.val-data.chongzhiTotal);this.rechargeCount.text=needMoney.toString();if((data.recrod>>index&1)==1){this.btn.visible=false;this.get.visible=false;this.recharge.visible=false}else{this.btn.visible=true;if(needMoney>0){this.recharge.visible=true;this.get.visible=false}else{this.recharge.visible=false;this.get.visible=true}}this.list.dataProvider=new ArrayCollection(config.rewards);this.selectBtn(index-1)};TotalRechargeWin.prototype.setText=function(index){var id=this._activityId;var cfg=GlobalConfig.ActivityType3Config[id][index];var val=cfg.val;if(val>=1e4){val=Math.floor(val/1e4);this["unit"+(index-1)].source="dt_wan"}else{val=Math.floor(val/1e3);this["unit"+(index-1)].source="dt_qian"}this["count"+(index-1)].text=val.toString()};TotalRechargeWin.prototype.onSelect=function(e){var btn=e.currentTarget;var index=1;if(btn==this.chooseBtn0){index=1}else if(btn==this.chooseBtn1){index=2}else{index=3}this.selectActivity(index)};TotalRechargeWin.prototype.closeWin=function(){ViewManager.ins().close(this)};return TotalRechargeWin}(BaseEuiView);__reflect(TotalRechargeWin.prototype,"TotalRechargeWin");ViewManager.ins().reg(TotalRechargeWin,LayerManager.UI_Popup);var YBZhuanPanWin=function(_super){__extends(YBZhuanPanWin,_super);function YBZhuanPanWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.skinName="CEYBZhuanPanSkin";_this.isTopLevel=true;_this.selectIndex=0;return _this}YBZhuanPanWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this._pageStyle=ActivityPageStyle.YBZHUANPAN;this.menuList.itemRenderer=ActivityBtnRenderer};YBZhuanPanWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};YBZhuanPanWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.YBZHUANPAN)continue;if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("YBZhuanPanWin_0"));return false};YBZhuanPanWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint)};YBZhuanPanWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};YBZhuanPanWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};YBZhuanPanWin.prototype.updateView=function(){var index=0;var i=0;for(var i_10=0;i_10<this.viewStack.numElements;i_10++){ObjectPool.push(this.viewStack.getElementAt(i_10))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=this._pageStyle){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(data.activityType&&data.activityType==ActivityType.Nesting)continue;if(!ErrorLog.Assert(data,"ybzhuanpan  data   "+k))this._datas.push(data)}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,act.activityType);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};YBZhuanPanWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};YBZhuanPanWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};YBZhuanPanWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);this.refushRedPoint()};YBZhuanPanWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){if(config.activityType==3){this.setOpenIndex(this.selectIndex)}else{this.setOpenIndex(this.selectIndex)}}}};YBZhuanPanWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};YBZhuanPanWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return YBZhuanPanWin}(BaseEuiView);__reflect(YBZhuanPanWin.prototype,"YBZhuanPanWin");ViewManager.ins().reg(YBZhuanPanWin,LayerManager.UI_Main);var CelebrationItem=function(_super){__extends(CelebrationItem,_super);function CelebrationItem(){var _this=_super.call(this)||this;_this.skinName="CERechargeItemSkin";return _this}CelebrationItem.prototype.destruct=function(){};CelebrationItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};CelebrationItem.prototype.dataChanged=function(){if(!this.data)return;var item=this.data;var actData=Activity.ins().getActivityDataById(item.config.Id);var state=actData.getRewardStateById(item.config.index);this.redPoint.visible=false;this.already.visible=false;var color=13746831;this.ball.source=item.config.expAttr[0];if(state==Activity.Geted){this.already.visible=true;color=65280;this.ball.source=item.config.expAttr[1]}else if(state==Activity.CanGet){color=65280;this.redPoint.visible=true}else{color=16711680}this.now.textFlow=TextFlowMaker.generateTextFlow1(i18n("CelebrationItem_0",color,Math.floor(item.curCost/100)));this.target.text=Math.floor(item.config.val/100)+"";this.ball0.visible=false};CelebrationItem.prototype.setSelect=function(s){this.ball0.visible=s};return CelebrationItem}(BaseItemRender);__reflect(CelebrationItem.prototype,"CelebrationItem");var CelebrationWin=function(_super){__extends(CelebrationWin,_super);function CelebrationWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.skinName="celebrationWin";_this.isTopLevel=true;_this.selectIndex=0;return _this}CelebrationWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this._pageStyle=ActivityPageStyle.CELEBRATION;this.menuList.itemRenderer=ActivityBtnRenderer};CelebrationWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};CelebrationWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var k in Activity.ins().activityData){if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.CELEBRATION)continue;if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("CelebrationWin_0"));return false};CelebrationWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.addChangeEvent(this.menuScroller,this.onChange)};CelebrationWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};CelebrationWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};CelebrationWin.prototype.updateView=function(){var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(Activity.ins().activityData[k].pageStyle!=this._pageStyle){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(!ErrorLog.Assert(data,"christmas  data   "+k))this._datas.push(data)}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,ActivityType.Normal);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};CelebrationWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};CelebrationWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};CelebrationWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);this.refushRedPoint()};CelebrationWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){this.setOpenIndex(this.selectIndex)}}};CelebrationWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};CelebrationWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}this.leftRed.visible=this.leftBtn.visible;this.rightRed.visible=this.rightBtn.visible};CelebrationWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};CelebrationWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return CelebrationWin}(BaseEuiView);__reflect(CelebrationWin.prototype,"CelebrationWin");ViewManager.ins().reg(CelebrationWin,LayerManager.UI_Main);var CELog=function(_super){__extends(CELog,_super);function CELog(){return _super!==null&&_super.apply(this,arguments)||this}return CELog}(BaseEuiView);__reflect(CELog.prototype,"CELog");var CDLog=function(_super){__extends(CDLog,_super);function CDLog(){return _super!==null&&_super.apply(this,arguments)||this}return CDLog}(BaseEuiView);__reflect(CDLog.prototype,"CDLog");var ChristmasDayWin=function(_super){__extends(ChristmasDayWin,_super);function ChristmasDayWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.skinName="christmasDayWin";_this.isTopLevel=true;_this.selectIndex=0;return _this}ChristmasDayWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this._pageStyle=ActivityPageStyle.CHRISTMAS;this.menuList.itemRenderer=ActivityBtnRenderer};ChristmasDayWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};ChristmasDayWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var k in Activity.ins().activityData){if(Activity.ins().activityData[k]&&Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.CHRISTMAS)continue;if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("ChristmasDayWin_0"));return false};ChristmasDayWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.closeBtn0,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.addChangeEvent(this.menuScroller,this.onChange)};ChristmasDayWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};ChristmasDayWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};ChristmasDayWin.prototype.updateView=function(){var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(Activity.ins().activityData[k]&&Activity.ins().activityData[k].pageStyle!=this._pageStyle){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(!ErrorLog.Assert(data,"christmas  data   "+k))this._datas.push(data)}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,act.activityType);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};ChristmasDayWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};ChristmasDayWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};ChristmasDayWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);this.refushRedPoint()};ChristmasDayWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){if(config.activityType==3){this.setOpenIndex(this.selectIndex)}else{this.setOpenIndex(this.selectIndex)}}}};ChristmasDayWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};ChristmasDayWin.prototype.onChange=function(){};ChristmasDayWin.prototype.onTouchBtn=function(e){};ChristmasDayWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return ChristmasDayWin}(BaseEuiView);__reflect(ChristmasDayWin.prototype,"ChristmasDayWin");ViewManager.ins().reg(ChristmasDayWin,LayerManager.UI_Main);var ChristmasRechargeItem=function(_super){__extends(ChristmasRechargeItem,_super);function ChristmasRechargeItem(){return _super.call(this)||this}ChristmasRechargeItem.prototype.dataChanged=function(){var config;var actData;if(this.data instanceof ActivityType3Config){config=this.data;actData=Activity.ins().getActivityDataById(config.Id)}else if(this.data instanceof PActivity3Config){config=this.data;actData=PActivity.ins().getActivityDataById(config.Id)}this.reward.data=config.rewards[0];this.reward.hideName();this.schedule.textFlow=TextFlowMaker.generateTextFlow1(i18n("ChristmasRechargeItem_0",Math.floor(actData.chongzhiTotal/100),Math.floor(config.val/100)));var state=actData.getRewardStateById(config.index);if(state==Activity.Geted){this.lingqu.visible=true;this.redPoint.visible=false;this.reward.touchEnabled=true;this.reward.touchChildren=true;this.ball.source="cd_treeitembg2"}else if(state==Activity.CanGet){this.lingqu.visible=false;this.redPoint.visible=true;this.reward.touchEnabled=false;this.reward.touchChildren=false;this.ball.source="cd_treeitembg2"}else{this.lingqu.visible=false;this.redPoint.visible=false;this.reward.touchEnabled=true;this.reward.touchChildren=true;this.ball.source="cd_treeitembg1"}};return ChristmasRechargeItem}(BaseItemRender);__reflect(ChristmasRechargeItem.prototype,"ChristmasRechargeItem");var ChritmasSnowMainItem=function(_super){__extends(ChritmasSnowMainItem,_super);function ChritmasSnowMainItem(){var _this=_super.call(this)||this;_this.states=["lingqu","normal","done"];_this.skinName="snowManItemSkin";return _this}ChritmasSnowMainItem.prototype.childrenCreated=function(){this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};ChritmasSnowMainItem.prototype.onTap=function(e){var config=this.data;Activity.ins().sendReward(config.Id,config.index)};ChritmasSnowMainItem.prototype.dataChanged=function(){var config=this.data;var data=Activity.ins().getActivityDataById(config.Id);var state=data.getAwardState(config.index);if(state==Activity.Geted)this.currentState=this.states[2];else if(state==Activity.CanGet)this.currentState=this.states[0];else{this.currentState=this.states[1];this.schedule.textFlow=TextFlowMaker.generateTextFlow1(i18n("ChritmasSnowMainItem_0",config.score))}this.reward.data=config.rewards[0];this.reward.hideName()};return ChritmasSnowMainItem}(BaseItemRender);__reflect(ChritmasSnowMainItem.prototype,"ChritmasSnowMainItem");var DailyGiftItemRender=function(_super){__extends(DailyGiftItemRender,_super);function DailyGiftItemRender(){var _this=_super.call(this)||this;_this._state=0;_this._activityID=0;_this._subRmb=0;_this.skinName="DEDailyGiftItemSkin";return _this}DailyGiftItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase;this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};DailyGiftItemRender.prototype.dataChanged=function(){this._config=this.data[0];this._state=this.data[1];this._activityID=this.data[3];this._subRmb=this.data[4];this.showDisCountNum(this._config.discount);this.vipLv.text=this._config.vip+"";this.vip.visible=this._config.vip>0;this.original.text=this._config.originalPrice+"";this.now.text=this._config.price+"";var colorStr=this.data[2]?65280:16711680;this.times.textFlow=TextFlowMaker.generateTextFlow1(i18n("DailyGiftItemRender_0",colorStr,this.data[2],this._config.count));this.reward.dataProvider=new eui.ArrayCollection(this._config.rewards);this.redPoint.visible=this._state==1&&Actor.yb>=this._config.price&&this._subRmb>=this._config.needRecharge&&UserVip.ins().lv>=this._config.vip;this.get.enabled=this._state==1;this.get.visible=this._state!=2;this.already.visible=this._state==2};DailyGiftItemRender.prototype.showDisCountNum=function(discount){if(discount%10==0){this.discountNum.text=discount/10+""}else{this.discountNum.text=(discount/10).toFixed(1)}};DailyGiftItemRender.prototype.onTap=function(e){if(UserVip.ins().lv<this._config.vip){var warnWin=WarnWin.show(i18n("DailyGiftItemRender_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("DailyGiftItemRender_2"));return}else if(Actor.yb<this._config.price){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("DailyGiftItemRender_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("DailyGiftItemRender_4"))}else if(this._subRmb<this._config.needRecharge)UserTips.ins().showTips(i18n("DailyGiftItemRender_5"));else Activity.ins().sendReward(this._activityID,this._config.index)};DailyGiftItemRender.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};return DailyGiftItemRender}(BaseItemRender);__reflect(DailyGiftItemRender.prototype,"DailyGiftItemRender");var DailyGiftPanel=function(_super){__extends(DailyGiftPanel,_super);function DailyGiftPanel(){var _this=_super.call(this)||this;_this._time=0;return _this}DailyGiftPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.gift.itemRenderer=DailyGiftItemRender;this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc};DailyGiftPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(Activity.ins().postActivityIsGetAwards,this.update);this.observe(UserVip.ins().postUpdateVipData,this.update);this.observe(UserVip.ins().postUpdataExp,this.update);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.update()};DailyGiftPanel.prototype.update=function(){var data=Activity.ins().getDoubleElevenDataByID(this.activityID);var configs=GlobalConfig.ActivityType2Config[this.activityID];var config;var datas=[];var i=0;var state=0;var leftTimes=0;for(var k in configs){config=configs[k];state=data.buyData[i+1]>=config.count?2:1;leftTimes=config.count-data.buyData[i+1];if(leftTimes<0)leftTimes=0;datas[i]=[config,state,leftTimes,this.activityID,data.sumRMB];i++}datas.sort(this.sort);this.gift.dataProvider=new eui.ArrayCollection(datas);this._time=data.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)};DailyGiftPanel.prototype.sort=function(a,b){if(a[1]==1&&b[1]!=1)return-1;if(a[1]==2&&b[1]!=2)return 1;if(a[0].index<b[0].index)return-1;if(a[0].index>b[0].index)return 1;return 0};DailyGiftPanel.prototype.close=function(){this.removeObserve();TimerManager.ins().removeAll(this)};DailyGiftPanel.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)}};return DailyGiftPanel}(BaseView);__reflect(DailyGiftPanel.prototype,"DailyGiftPanel");var DoubleEleventWin=function(_super){__extends(DoubleEleventWin,_super);function DoubleEleventWin(){var _this=_super.call(this)||this;_this._selectIndex=0;_this.skinName="doubleElevenWin";_this.isTopLevel=true;_this.DETimeBuySkin.activityIDs=[150,151,152,153];_this.DEFanliSkin.activityID=156;_this.DEDailyGiftSkin.activityID=130;_this._panels=[_this.DETimeBuySkin,_this.DEFanliSkin,_this.DEDailyGiftSkin];return _this}DoubleEleventWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);var datas=[];var btnNames=[];var data;var ids=[150,156,130];for(var k_2 in Activity.ins().doubleElevenData){data=Activity.ins().getbtnInfo(k_2);if(btnNames.indexOf(data.icon)==-1){datas.push(data);btnNames.push(data.icon)}}btnNames.length=0;btnNames=null;var panels=[];datas.sort(this.sort);for(var k in datas){data=datas[k];panels.push(this._panels[ids.indexOf(data.id)])}this.BtnArr=datas;this.dataArr=new eui.ArrayCollection;this.dataArr.source=this.BtnArr;this.menuList.itemRenderer=ActivityBtnRenderer;this.menuList.dataProvider=this.dataArr;this._panels=panels;this.viewStack.removeChildren();var len=panels.length;for(var i=0;i<len;i++)this.viewStack.addChild(this._panels[i]);this._panels[this._selectIndex].open();this.menuList.selectedIndex=this._selectIndex;this.viewStack.selectedIndex=this._selectIndex;Activity.ins().setPalyEffListById(this._panels[this._selectIndex].activityID,true);this.viewStack.validateNow();this.menuList.validateNow()};DoubleEleventWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.observe(Actor.ins().postYbChange,this.refushRedPoint);this.observe(Actor.ins().postLevelChange,this.refushRedPoint);this.refushRedPoint()};DoubleEleventWin.prototype.close=function(){for(var i=0;i<this.viewStack.numChildren;i++){this.viewStack.getChildAt(i)["close"]()}};DoubleEleventWin.prototype.onTap=function(e){ViewManager.ins().close(this)};DoubleEleventWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};DoubleEleventWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};DoubleEleventWin.prototype.onClickMenu=function(e){if(this._selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this._panels[this._selectIndex].close()}this._selectIndex=e.currentTarget.selectedIndex;this._panels[this._selectIndex].open();this.viewStack.selectedIndex=this._selectIndex;Activity.ins().setPalyEffListById(this._panels[this._selectIndex].activityID,true)};return DoubleEleventWin}(BaseEuiView);__reflect(DoubleEleventWin.prototype,"DoubleEleventWin");ViewManager.ins().reg(DoubleEleventWin,LayerManager.UI_Main);var FanLinPanel=function(_super){__extends(FanLinPanel,_super);function FanLinPanel(){var _this=_super.call(this)||this;_this._time=0;_this._stateList=[];return _this}FanLinPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc};FanLinPanel.prototype.open=function(){var arges=[];for(var _i=0;_i<arguments.length;_i++){arges[_i]=arguments[_i]}this.addTouchEvent(this.pay0,this.onPay0);this.addTouchEvent(this.pay1,this.onPay1);this.observe(Activity.ins().postActivityIsGetAwards,this.update);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.update()};FanLinPanel.prototype.update=function(){var data=Activity.ins().getDoubleElevenDataByID(this.activityID);var configs=GlobalConfig.ActivityType3Config[this.activityID];var config;var state=0;var btns=[this.pay0,this.pay1];var btn;var i=0;for(var k in configs){config=configs[k];state=data.recrod>>config.index&1?2:data.chongzhiNum>=config.val?1:0;btn=btns[i];if(state==2)btn.label=i18n("FanLinPanel_0");else if(state==1)btn.label=i18n("FanLinPanel_1");else btn.label=i18n("FanLinPanel_2")+config.val/100;btn.enabled=state!=2;this._stateList[i]=state;this["redPoint"+i].visible=state==1;i++}this._time=data.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)};FanLinPanel.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this.pay0,this.onPay0);this.removeTouchEvent(this.pay1,this.onPay1);TimerManager.ins().removeAll(this)};FanLinPanel.prototype.onPay0=function(e){this.onPay(0)};FanLinPanel.prototype.onPay1=function(e){this.onPay(1)};FanLinPanel.prototype.onPay=function(index){var state=this._stateList[index];if(state==0){Recharge.ins().tryShowChargeFirstWin()}else if(state==1)Activity.ins().sendReward(this.activityID,index+1)};FanLinPanel.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)}};return FanLinPanel}(BaseView);__reflect(FanLinPanel.prototype,"FanLinPanel");var TimeBuyItemRender=function(_super){__extends(TimeBuyItemRender,_super);function TimeBuyItemRender(){var _this=_super.call(this)||this;_this._state=0;_this._activityID=0;_this.skinName="DETimeBuyItemSkin";return _this}TimeBuyItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase;this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};TimeBuyItemRender.prototype.dataChanged=function(){this._config=this.data[0];this._state=this.data[1];this._activityID=this.data[3];this.showDisCountNum(this._config.discount);this.priceLabel.text=this._config.price+"";var colorStr=this.data[2]?65280:16711680;this.times.textFlow=TextFlowMaker.generateTextFlow1(i18n("TimeBuyItemRender_0",colorStr,this.data[2],this._config.count));this.reward.dataProvider=new eui.ArrayCollection(this._config.rewards);this.stock.text=this.data[4];this.redPoint.visible=this._state==1&&Actor.yb>=this._config.price;this.get.enabled=this._state==1;this.get.visible=this._state!=2;this.already.visible=this._state==2};TimeBuyItemRender.prototype.showDisCountNum=function(discount){if(discount%10==0){this.discountNum.text=discount/10+""}else{this.discountNum.text=(discount/10).toFixed(1)}};TimeBuyItemRender.prototype.onTap=function(e){if(Actor.yb<this._config.price){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("TimeBuyItemRender_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("TimeBuyItemRender_2"))}else Activity.ins().sendReward(this._activityID,this._config.index)};TimeBuyItemRender.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};return TimeBuyItemRender}(BaseItemRender);__reflect(TimeBuyItemRender.prototype,"TimeBuyItemRender");var TimeBuyPanel=function(_super){__extends(TimeBuyPanel,_super);function TimeBuyPanel(){var _this=_super.call(this)||this;_this._time=0;_this._selectIndex=0;_this._openLeftTime=0;_this._arrayCollect=new eui.ArrayCollection;return _this}TimeBuyPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.gift.itemRenderer=TimeBuyItemRender;this.gift.dataProvider=this._arrayCollect;this.actDesc.text=GlobalConfig.ActivityConfig[this.activityIDs[0]].desc};TimeBuyPanel.prototype.open=function(){var arges=[];for(var _i=0;_i<arguments.length;_i++){arges[_i]=arguments[_i]}this.observe(Activity.ins().postActivityIsGetAwards,this.update);this.addTouchEvent(this,this.onTop);TimerManager.ins().doTimer(1e3,0,this.setTime,this);TimerManager.ins().doTimer(3e4,0,this.getServerTimes,this);this.update();this.getServerTimes()};TimeBuyPanel.prototype.getServerTimes=function(){var len=this.activityIDs.length;for(var i=0;i<len;i++)Activity.ins().sendChangePage(this.activityIDs[i])};TimeBuyPanel.prototype.update=function(){var len=this.activityIDs.length;var data;var config;var leftTime=0;this._openLeftTime=0;for(var i=0;i<len;i++){config=GlobalConfig.ActivityType2Config[this.activityIDs[i]][1];data=Activity.ins().getDoubleElevenDataByID(this.activityIDs[i]);this["timeItem"+i].setData(config,data?data.isSpecialOpen():false);this["timeItem"+i].setSelected(false);this["timeItem"+i].setRedPoint(data&&data.isSpecialOpen()&&data.canReward());this["timeItem"+i].name=i;leftTime=data?data.getSpecialOpenLeftTime():0;if(leftTime>0&&this._openLeftTime==0)this._openLeftTime=leftTime;if(this._openLeftTime>0&&leftTime>0&&leftTime<this._openLeftTime)this._openLeftTime=leftTime}this._time=data?data.getLeftTime():0;this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4);this.updateSelected()};TimeBuyPanel.prototype.updateSelected=function(){this["timeItem"+this._selectIndex].setSelected(true);var configs=GlobalConfig.ActivityType2Config[this.activityIDs[this._selectIndex]];var data=Activity.ins().getDoubleElevenDataByID(this.activityIDs[this._selectIndex]);var config;var datas=[];var i=0;var state=0;var lv=UserVip.ins().lv;var leftTimes=0;var fake=0;var scount=0;for(var k in configs){config=configs[k];state=data?data.buyData[i+1]>=config.count?2:data.isSpecialOpen()&&data.serverBuyData[i+1]<config.scount?1:0:0;leftTimes=data?config.count-data.buyData[i+1]:0;if(leftTimes<0)leftTimes=0;scount=data?config.scount-data.serverBuyData[i+1]:0;fake=data?Math.floor(Math.max(Math.min(scount/config.scount*config.shamScount,config.shamScount-data.getSpecialStrikeTimes()),0)):0;if(scount<=5&&fake>5)fake=5;if(scount==0)fake=0;datas[i]=[config,state,leftTimes,this.activityIDs[this._selectIndex],scount+fake];i++}datas.sort(this.sort);this._arrayCollect.source=datas};TimeBuyPanel.prototype.sort=function(a,b){if(a[1]==1)return-1;if(b[1]==1)return 1;if(a[0].index<b[0].index)return-1;if(a[0].index>b[0].index)return 1;return 0};TimeBuyPanel.prototype.close=function(){TimerManager.ins().removeAll(this);this.removeTouchEvent(this,this.onTop);this.removeObserve()};TimeBuyPanel.prototype.onTop=function(e){switch(e.target){case this.timeItem0:case this.timeItem1:case this.timeItem2:case this.timeItem3:this["timeItem"+this._selectIndex].setSelected(false);this._selectIndex=Number(e.target.name);this.updateSelected();break}};TimeBuyPanel.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)}if(this._openLeftTime>0){this._openLeftTime--;if(this._openLeftTime==0)this.update()}};return TimeBuyPanel}(BaseView);__reflect(TimeBuyPanel.prototype,"TimeBuyPanel");var TimeBuyTab=function(_super){__extends(TimeBuyTab,_super);function TimeBuyTab(){var _this=_super.call(this)||this;_this.skinName="DETimeBuyTabSkin";_this.touchChildren=false;_this.touchEnabled=true;return _this}TimeBuyTab.prototype.setData=function(config,isOpen){this.time.text=config.limitTime[0]+":"+(config.limitTime[1]<10?config.limitTime[1]+"0":config.limitTime[1]);this._isOpen=isOpen;this.setSelected(false)};TimeBuyTab.prototype.setSelected=function(selected){if(selected)this.currentState=this._isOpen?"intimeselect":"outtimeselect";else this.currentState=this._isOpen?"intime":"outtime"};TimeBuyTab.prototype.setRedPoint=function(show){this.redPoint.visible=show};return TimeBuyTab}(BaseComponent);__reflect(TimeBuyTab.prototype,"TimeBuyTab");var DoubleTwelveRechargeItem=function(_super){__extends(DoubleTwelveRechargeItem,_super);function DoubleTwelveRechargeItem(){return _super!==null&&_super.apply(this,arguments)||this}DoubleTwelveRechargeItem.prototype.dataChanged=function(){this.item.isShowName(false);this.item.data=this.data;if(this.data.type==0){var type=1;switch(this.data.id){case MoneyConst.yuanbao:type=5;break;case MoneyConst.gold:type=0;break;case MoneyConst.soul:type=2;break;case MoneyConst.piece:type=2;break;case MoneyConst.godweaponExp:type=2;break;default:break}this.nameTxt.text=RewardData.getCurrencyName(this.data.id);this.nameTxt.textColor=ItemBase.QUALITY_COLOR[type];this.nameTxt.strokeColor=ItemBase.QUALITY_STROKE_COLOR[type]}else{var item=GlobalConfig.ItemConfig[this.data.id];this.nameTxt.text=item.name;this.nameTxt.textColor=ItemConfig.getQualityColor(item);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(item)}};return DoubleTwelveRechargeItem}(ItemRenderer);__reflect(DoubleTwelveRechargeItem.prototype,"DoubleTwelveRechargeItem");var DoubleTwelveRechargeWin=function(_super){__extends(DoubleTwelveRechargeWin,_super);function DoubleTwelveRechargeWin(){var _this=_super.call(this)||this;_this.skinName="DTRechargeSkin";_this.isTopLevel=true;return _this}DoubleTwelveRechargeWin.prototype.open=function(){var _this=this;var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.list.itemRenderer=DoubleTwelveRechargeItem;this.addTouchEvent(this.closeBtn,this.closeWin);this.addTouchEvent(this.bgClose,this.closeWin);this.addTouchEvent(this.chooseBtn0,this.onSelect);this.addTouchEvent(this.chooseBtn1,this.onSelect);this.addTouchEvent(this.chooseBtn2,this.onSelect);this.addTouchEvent(this.rechargeBtn,this.onRecharge);this.observe(Recharge.ins().postUpdateRecharge,this.updateView);this.observe(Recharge.ins().postUpdateRechargeEx,this.updateView);this.observe(Activity.ins().postChangePage,this.updateView);this.observe(Activity.ins().postRewardResult,this.updateView);this.observe(Activity.ins().postActivityIsGetAwards,this.updateView);TimerManager.ins().doNext(function(){_this.updateView()},this)};DoubleTwelveRechargeWin.prototype.onRecharge=function(e){var id=this.idAry[this.selectIndex];if(this.recharge.visible){Recharge.ins().tryShowChargeFirstWin()}else{Activity.ins().sendReward(id,1)}};DoubleTwelveRechargeWin.prototype.updateView=function(){this.idAry=Activity.ins().doubleTwelveRechargeIDAry;var data=Activity.ins().doubleTwelveRechargeData[this.idAry[0]];var time=data.getLeftTime();var timedesc=Math.floor(time*1e3/DateUtils.MS_PER_DAY);var desc;if(timedesc==0){timedesc=Math.floor(time*1e3/(DateUtils.MS_PER_DAY/24));desc=i18n("DoubleTwelveRechargeWin_0",timedesc)}else{desc=i18n("DoubleTwelveRechargeWin_1",timedesc)}this.limitTime.text=i18n("DoubleTwelveRechargeWin_2",desc);for(var i=0;i<3;i++){this.setText(i)}if(this.selectIndex){this.selectActivity(this.selectIndex)}else{this.selectActivity(0)}};DoubleTwelveRechargeWin.prototype.selectBtn=function(index){this.select0.visible=false;this.select1.visible=false;this.select2.visible=false;this["select"+index].visible=true};DoubleTwelveRechargeWin.prototype.selectActivity=function(index){this.selectIndex=index;var activityId=this.idAry[index];var data=Activity.ins().doubleTwelveRechargeData[activityId];var needMoney=DoubleTwelveModel.ins().getNeedRecharge(activityId);this.rechargeCount.text=needMoney.toString();if(data.recrod>0){this.btn.visible=false}else{this.btn.visible=true;if(needMoney>0){this.recharge.visible=true;this.get.visible=false}else{this.recharge.visible=false;this.get.visible=true}}var cfg=GlobalConfig.ActivityType3Config[activityId][1];this.list.dataProvider=new ArrayCollection(cfg.rewards);this.selectBtn(index)};DoubleTwelveRechargeWin.prototype.setText=function(index){var id=this.idAry[index];var cfg=GlobalConfig.ActivityType3Config[id][1];var val=cfg.val;if(index==0){val=Math.floor(val/1e3)}else{val=Math.floor(val/1e4)}this["count"+index].text=val.toString()};DoubleTwelveRechargeWin.prototype.onSelect=function(e){var btn=e.target;var index=0;if(btn==this.chooseBtn0){index=0}else if(btn==this.chooseBtn1){index=1}else{index=2}this.selectActivity(index)};DoubleTwelveRechargeWin.prototype.closeWin=function(){ViewManager.ins().close(this)};return DoubleTwelveRechargeWin}(BaseEuiView);__reflect(DoubleTwelveRechargeWin.prototype,"DoubleTwelveRechargeWin");ViewManager.ins().reg(DoubleTwelveRechargeWin,LayerManager.UI_Popup);var DoubleTwelveWin=function(_super){__extends(DoubleTwelveWin,_super);function DoubleTwelveWin(){var _this=_super.call(this)||this;_this.skinName="doubleTwelveWin";_this.isTopLevel=true;return _this}DoubleTwelveWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.menuList.itemRenderer=ActivityBtnRenderer;this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.closeBtn,this.closeWin);this.observe(Activity.ins().postChangePage,this.updateView);this.observe(Activity.ins().postRewardResult,this.updateView);this.observe(Activity.ins().postActivityIsGetAwards,this.updateView);this.updateView()};DoubleTwelveWin.prototype.close=function(){for(var i=0;i<this.viewStack.numChildren;i++){this.viewStack.getChildAt(i)["close"]()}};DoubleTwelveWin.prototype.updateView=function(){var btnIcons=[];for(var i in Activity.ins().doubleTwelveData){var data=Activity.ins().getbtnInfo(i);var activity=Activity.ins().doubleTwelveData[i];if(activity.isOpenActivity()){btnIcons.push(data);if(activity.type==2){this.DTDailyGiftSkin.activityID=activity.id}else{this.DTLuckyTurntableSkin.activityID=activity.id}}}btnIcons.sort(function(obj1,obj2){return Algorithm.sortAscAttr(obj1,obj2,"sort")});this.menuList.dataProvider=new ArrayCollection(btnIcons);this.panels=[this.DTDailyGiftSkin,this.DTLuckyTurntableSkin];if(!this.selectIndex){this.selectIndex=0}this.viewStack.selectedIndex=this.selectIndex;this.panels[this.selectIndex].open()};DoubleTwelveWin.prototype.closeWin=function(e){ViewManager.ins().close(DoubleTwelveWin)};DoubleTwelveWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this.panels[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;this.viewStack.selectedIndex=this.selectIndex;this.panels[this.selectIndex].open();Activity.ins().setPalyEffListById(this.panels[this.selectIndex].activityID,true)};return DoubleTwelveWin}(BaseEuiView);__reflect(DoubleTwelveWin.prototype,"DoubleTwelveWin");ViewManager.ins().reg(DoubleTwelveWin,LayerManager.UI_Main);var DoubleTwelveGift=function(_super){__extends(DoubleTwelveGift,_super);function DoubleTwelveGift(){var _this=_super.call(this)||this;_this._index=0;return _this}DoubleTwelveGift.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);var idx=this.getRule();this.updateData(idx)};DoubleTwelveGift.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.buy,this.onTap);this.addTouchEvent(this.szlb,this.onTap);this.addTouchEvent(this.lhlb,this.onTap);this.addTouchEvent(this.yylb,this.onTap);this.addTouchEvent(this.sblb,this.onTap);this.observe(Activity.ins().postRewardResult,this.GetCallBack);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.hideSelect();var idx=this.getRule();this.updateData(idx)};DoubleTwelveGift.prototype.close=function(){this.removeObserve();TimerManager.ins().removeAll(this)};DoubleTwelveGift.prototype.hideSelect=function(){for(var i=0;i<4;i++){this["select"+i].visible=false;this["arrow"+i].visible=false;this["select"+i].visible=false}};DoubleTwelveGift.prototype.GetCallBack=function(activityID){if(this.activityID!=activityID)return;if(!Activity.ins().isSuccee){UserTips.ins().showTips(i18n("DoubleTwelveGift_4"));var activityData=Activity.ins().doubleTwelveData[this.activityID];Activity.ins().sendChangePage(activityData.id)}Activity.ins().isSuccee=false;this.hideSelect();var idx=this.getRule();this.updateData(idx)};DoubleTwelveGift.prototype.onTap=function(e){var index;switch(e.currentTarget){case this.buy:if(this.config.vip&&UserVip.ins().lv<this.config.vip){var warnWin=WarnWin.show(i18n("DoubleTwelveGift_6"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("DoubleTwelveGift_7"))}else{if(UserBag.ins().getSurplusCount()<7){UserTips.ins().showTips(i18n("DoubleTwelveGift_8"));return}if(Actor.yb>=this.config.price){Activity.ins().sendReward(this.activityID,this._index)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("DoubleTwelveGift_9"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("DoubleTwelveGift_10"))}}}index=-1;break;case this.lhlb:index=1;break;case this.yylb:index=2;break;case this.szlb:index=3;break;case this.sblb:index=4;break}if(index!=-1){for(var i=0;i<4;i++){if(index!=i+1)this["select"+i].visible=false;else this["select"+i].visible=true;this["arrow"+i].visible=this["select"+i].visible}this.updateData(index)}};DoubleTwelveGift.prototype.getRule=function(){var activityData=Activity.ins().doubleTwelveData[this.activityID];var tmplist=GlobalConfig.ActivityType2Config[this.activityID];var listData=[];for(var k in tmplist){listData.push(tmplist[k])}listData.sort(this.sortFunc);for(var i=0;i<listData.length;i++){var config=listData[i];var isBuy=activityData.buyData[config.index]>=config.count?true:false;if(!isBuy)return config.index}return 2};DoubleTwelveGift.prototype.sortFunc=function(aConfig,bConfig){if(aConfig.price<bConfig.price)return-1;if(aConfig.price>bConfig.price)return 1;return 0};DoubleTwelveGift.prototype.updateData=function(index){if(index===void 0){index=2}this._index=index;this["select"+(index-1)].visible=true;this["arrow"+(index-1)].visible=true;var activityData=Activity.ins().doubleTwelveData[this.activityID];this.setTime();this.config=GlobalConfig.ActivityType2Config[this.activityID][index];var btncfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btncfg)this.title.source=btncfg.title;this.desc3.text=this.config.price+"";this.desc5.text=this.config.giftName;for(var i=0;i<this.config.rewards.length;i++){var rew=this.config.rewards[i];this["item"+i].data={type:rew.type,count:rew.count,id:rew.id};if(this["item"+i].getItemType()==17)this["item"+i].showSpeicalDetail=false}var isBuy=activityData.buyData[this._index]>=this.config.count?true:false;this.buy.visible=!isBuy;this.already.visible=isBuy;this.actTime.visible=!this.already.visible;this.showbg.source=this.config.source[2]+"_png";this.redPoint.visible=this.buy.visible&&Actor.yb>=this.config.price;if(Actor.level<ActivityType2Data.LimitLevel)this.redPoint.visible=false;for(var i in GlobalConfig.ActivityType2Config[this.activityID]){var cfg=GlobalConfig.ActivityType2Config[this.activityID][i];if(cfg&&cfg.source[0]){this["bg"+(+i-1)].source=cfg.source[0]}if(cfg&&cfg.source[1]){this["name"+(+i-1)].source=cfg.source[1]}}};DoubleTwelveGift.prototype.setTime=function(){var activityData=Activity.ins().doubleTwelveData[this.activityID];var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime.text=i18n("DoubleTwelveGift_11")}else if(endedTime<=0){this.actTime.text=i18n("DoubleTwelveGift_12")}else{this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}};return DoubleTwelveGift}(BaseView);__reflect(DoubleTwelveGift.prototype,"DoubleTwelveGift");var DoubleTwelveLottery=function(_super){__extends(DoubleTwelveLottery,_super);function DoubleTwelveLottery(){return _super.call(this)||this}DoubleTwelveLottery.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();for(var i=0;i<3;i++){this.removeTouchEvent(this["isget"+i],this.onGiftClick)}egret.Tween.removeTweens(this.tttzhi);this.rolling=false;var data=Activity.ins().doubleTwelveData[this.activityID];if(data.indexs.length==1){Activity.ins().sendReward(this.activityID,1)}TimerManager.ins().removeAll(this)};DoubleTwelveLottery.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postChangePage,this.resultCallBack);this.observe(Activity.ins().postChangePage,this.updateView);this.observe(Activity.ins().postRewardResult,this.updateView);this.observe(Activity.ins().postActivityIsGetAwards,this.updateView);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.addTouchEvent(this.choujiangBtn,this.getLottery);for(var i=0;i<3;i++){this.addTouchEvent(this["isget"+i],this.onGiftClick)}this.list.itemRenderer=NoticeListRenderer;this.turnten.selected=false;this.updateView()};DoubleTwelveLottery.prototype.onTouch=function(e){};DoubleTwelveLottery.prototype.updateView=function(){var data=Activity.ins().doubleTwelveData[this.activityID];var config=GlobalConfig.ActivityType9Config[this.activityID][0];var itemcfg=GlobalConfig.ItemConfig[config.item];if(itemcfg){this.icon.source=itemcfg.icon+"_png";var item=UserBag.ins().getBagItemById(itemcfg.id);var sum=0;var maxsum=1;var colorStr=13746831;if(item){sum=item.count;if(sum>=maxsum)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N}else{colorStr=ColorUtil.RED_COLOR_N}this.num.textFlow=TextFlowMaker.generateTextFlow1(i18n("DoubleTwelveLottery_6",colorStr,sum,maxsum));this.pay0.text=config.yb+""}for(var i in GlobalConfig.ActivityType9Config[this.activityID]){if(!+i)continue;var cfg=GlobalConfig.ActivityType9Config[this.activityID][i];var item=this["item"+(+i-1)];item.itemIcon.data=cfg.reward[0];item.rewardState(false)}this.num2.visible=false;this.updateProgress();this.listRefush();this.setTime()};DoubleTwelveLottery.prototype.resultCallBack=function(){var data=Activity.ins().doubleTwelveData[this.activityID];if(data.indexs.length>1){ViewManager.ins().open(LuckyResultWin,this.activityID,data.indexs)}else if(data.indexs.length==1){this.beginLottery(data.indexs[0])}this.listRefush()};DoubleTwelveLottery.prototype.beginLottery=function(index){var _this=this;var rotat=360*4+(index-1)*36;var tween=egret.Tween.get(this.tttzhi);this.rolling=true;tween.to({rotation:rotat},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(_this.activityID,1);_this.flyItem(_this["item"+(index-1)]);setTimeout(function(){_this.rolling=false},2e3)},this)};DoubleTwelveLottery.prototype.flyItem=function(item){var itemBase=new ItemBase;itemBase.x=item.x;itemBase.y=item.y;itemBase.data=item.itemIcon.data;itemBase.anchorOffsetX=itemBase.width/2;itemBase.anchorOffsetY=itemBase.height/2;item.parent.addChild(itemBase);GameLogic.ins().postFlyItemEx(itemBase)};DoubleTwelveLottery.prototype.flyItemEx=function(itemicon){var flyItem=new eui.Image(itemicon.imgIcon.source);flyItem.x=itemicon.imgIcon.x;flyItem.y=itemicon.imgIcon.y;flyItem.width=itemicon.imgIcon.width;flyItem.height=itemicon.imgIcon.height;flyItem.scaleX=itemicon.imgIcon.scaleX;flyItem.scaleY=itemicon.imgIcon.scaleY;itemicon.imgIcon.parent.addChild(flyItem);GameLogic.ins().postFlyItemEx(flyItem)};DoubleTwelveLottery.prototype.getLottery=function(){if(this.rolling){UserTips.ins().showTips(i18n("DoubleTwelveLottery_0"));return}if(this.turnten.selected){if(Activity.ins().getIsRollTen(this.activityID)){Activity.ins().sendReward(this.activityID,2)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("DoubleTwelveLottery_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("DoubleTwelveLottery_2"))}}else{if(Activity.ins().getRollSum(this.activityID)||Actor.yb>=GlobalConfig.ActivityType9Config[this.activityID][0].yb){Activity.ins().sendReward(this.activityID,1)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("DoubleTwelveLottery_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("DoubleTwelveLottery_4"))}}};DoubleTwelveLottery.prototype.onGiftClick=function(e){for(var i=0;i<3;i++){if(e.currentTarget==this["isget"+i]){var itemicon=this["gift"+i].getItemIcon();this.flyItemEx(itemicon);Activity.ins().sendReward(this.activityID,0,i+1);break}}};DoubleTwelveLottery.prototype.updateProgress=function(){var config=GlobalConfig.ActivityType9Config[this.activityID][0];var data=Activity.ins().doubleTwelveData[this.activityID];if(config&&data){this.turntime.text=data.count+"";for(var i=0;i<3;i++){this["turntime"+i].text=config.reward[i].times;this["gift"+i].data={id:config.reward[i].id,type:config.reward[i].type,count:config.reward[i].count};this["gift"+i].isShowName(false);this["bar"+i].maximum=100;this["lingqu"+i].touchEnabled=false;if(data.record>>i+1&1){this["bar"+i].value=100;this["lingqu"+i].visible=true;this["isget"+i].touchEnabled=false}else{this["lingqu"+i].visible=false;if(data.count>=config.reward[i].times){this["bar"+i].value=100;this["isget"+i].touchEnabled=true}else{var prerewards=config.reward[i-1];var curCount=data.count;var totalCount=config.reward[i].times;if(prerewards){curCount=data.count-prerewards.times;totalCount=config.reward[i].times-prerewards.times}curCount=curCount>0?curCount:0;this["bar"+i].value=Math.floor(curCount/totalCount*100);this["isget"+i].touchEnabled=false}}this.updateRedPoint(this.activityID,i)}}};DoubleTwelveLottery.prototype.updateRedPoint=function(activityID,idx){var b=Activity.ins().isGetRollReward(activityID,idx);this["redPoint"+idx].visible=b};DoubleTwelveLottery.prototype.listRefush=function(){var data=Activity.ins().doubleTwelveData[this.activityID];if(data){var arr=[];for(var i=0;i<data.noticeArr.length;i++){var notice={activityID:this.activityID,name:data.noticeArr[i].name,index:data.noticeArr[i].index};arr.push(notice)}this.list.dataProvider=new eui.ArrayCollection(arr)}};DoubleTwelveLottery.prototype.setTime=function(){var data=Activity.ins().doubleTwelveData[Activity.ins().doubleTwelveIDAry[2]];this.actTime.text=i18n("DoubleTwelveLottery_5")+data.getLastTime()};return DoubleTwelveLottery}(ActivityPanel);__reflect(DoubleTwelveLottery.prototype,"DoubleTwelveLottery");var NYHigh=function(_super){__extends(NYHigh,_super);function NYHigh(){return _super!==null&&_super.apply(this,arguments)||this}return NYHigh}(BaseEuiView);__reflect(NYHigh.prototype,"NYHigh");var CDSnowBaby=function(_super){__extends(CDSnowBaby,_super);function CDSnowBaby(){return _super!==null&&_super.apply(this,arguments)||this}return CDSnowBaby}(BaseEuiView);__reflect(CDSnowBaby.prototype,"CDSnowBaby");var CDSnowMan=function(_super){__extends(CDSnowMan,_super);function CDSnowMan(){return _super!==null&&_super.apply(this,arguments)||this}return CDSnowMan}(BaseEuiView);__reflect(CDSnowMan.prototype,"CDSnowMan");var NYChange=function(_super){__extends(NYChange,_super);function NYChange(){return _super!==null&&_super.apply(this,arguments)||this}return NYChange}(BaseEuiView);__reflect(NYChange.prototype,"NYChange");var NYCost=function(_super){__extends(NYCost,_super);function NYCost(){return _super!==null&&_super.apply(this,arguments)||this}return NYCost}(BaseEuiView);__reflect(NYCost.prototype,"NYCost");var NYDailyGift=function(_super){__extends(NYDailyGift,_super);function NYDailyGift(){return _super!==null&&_super.apply(this,arguments)||this}return NYDailyGift}(BaseEuiView);__reflect(NYDailyGift.prototype,"NYDailyGift");var NYFireworker=function(_super){__extends(NYFireworker,_super);function NYFireworker(){return _super!==null&&_super.apply(this,arguments)||this}return NYFireworker}(BaseEuiView);__reflect(NYFireworker.prototype,"NYFireworker");var CDRecharge=function(_super){__extends(CDRecharge,_super);function CDRecharge(){return _super!==null&&_super.apply(this,arguments)||this}return CDRecharge}(BaseEuiView);__reflect(CDRecharge.prototype,"CDRecharge");var NYLog=function(_super){__extends(NYLog,_super);function NYLog(){return _super!==null&&_super.apply(this,arguments)||this}return NYLog}(BaseEuiView);__reflect(NYLog.prototype,"NYLog");var OSATarget2Panel4ItemRender=function(_super){__extends(OSATarget2Panel4ItemRender,_super);function OSATarget2Panel4ItemRender(){return _super!==null&&_super.apply(this,arguments)||this}return OSATarget2Panel4ItemRender}(BaseEuiView);__reflect(OSATarget2Panel4ItemRender.prototype,"OSATarget2Panel4ItemRender");var SBHigh=function(_super){__extends(SBHigh,_super);function SBHigh(){return _super!==null&&_super.apply(this,arguments)||this}return SBHigh}(BaseEuiView);__reflect(SBHigh.prototype,"SBHigh");var FengceActivityWin=function(_super){__extends(FengceActivityWin,_super);function FengceActivityWin(){var _this=_super.call(this)||this;_this.curLevelIndex=0;_this.skinName="fengceActiveSkin";_this.defaultText=i18n("FengceActivityWin_0");return _this}FengceActivityWin.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this.edit.addEventListener(egret.FocusEvent.FOCUS_IN,this.onTap,this);this.addTouchEvent(this.sendBtn,this.onTap);this.addTouchEvent(this.arrowleft,this.onTap);this.addTouchEvent(this.arrowright,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.edit,this.onTap);this.addChangeEvent(this.tab,this.onSelectIndex);this.setSelectIndex(params[0]||0)};FengceActivityWin.prototype.setSelectIndex=function(index){this.viewStack.selectedIndex=index;if(index==0){if(!this.levelData){this.levelData=[];var config=GlobalConfig.LevelMailConfig;for(var id in config){if(config[id].mType){this.levelData.push(+id)}}this.levelData.sort(function(a,b){return a<b?-1:1})}var lv=Actor.level;var zs=UserZs.ins().lv;this.curLevelIndex=0;for(var i=0;i<this.levelData.length;i++){this.curLevelIndex=i;var zz=Math.floor(this.levelData[i]/1e3);if(zz<1){if(lv<this.levelData[i]){break}}else{if(zs<zz){break}}}this.updateLevel(this.curLevelIndex);var curDay=GameServer.serverOpenDay+1;var dayConfig=GlobalConfig.LoginDayMailConfig[curDay];if(dayConfig){var mailId=dayConfig.idList[0];var mailConfig=GlobalConfig.MailIdConfig[mailId];this.count0.text=mailConfig.attachment[0].count+""}else{this.count0.text="0"}}};FengceActivityWin.prototype.updateLevel=function(levelIndex){if(levelIndex<0){levelIndex=0}if(levelIndex>=this.levelData.length){levelIndex=this.levelData.length-1}if(levelIndex==0){this.arrowleft.visible=false;this.arrowright.visible=true}else if(levelIndex==this.levelData.length-1){this.arrowleft.visible=true;this.arrowright.visible=false}else{this.arrowleft.visible=true;this.arrowright.visible=true}this.curLevelIndex=levelIndex;var lv=this.levelData[levelIndex];var zs=Math.floor(this.levelData[levelIndex]/1e3);if(zs<1){if(lv>Actor.level){this.countDesc.text=i18n("FengceActivityWin_1",lv-Actor.level)}else{this.countDesc.text=""}this.lvText.text=i18n("FengceActivityWin_2",lv)}else{if(zs>UserZs.ins().lv){this.countDesc.text=i18n("FengceActivityWin_3",zs)}else{this.countDesc.text=""}this.lvText.text=i18n("FengceActivityWin_4",zs)}var levelConfig=GlobalConfig.LevelMailConfig[lv];var mailId=levelConfig.idList[0];var mailConfig=GlobalConfig.MailIdConfig[mailId];this.count2.text=mailConfig.attachment[0].count+""};FengceActivityWin.prototype.onSelectIndex=function(e){this.setSelectIndex(e.itemIndex)};FengceActivityWin.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.bgClose){ViewManager.ins().close(this)}else if(tar==this.arrowleft){this.updateLevel(this.curLevelIndex-1)}else if(tar==this.arrowright){this.updateLevel(this.curLevelIndex+1)}else if(tar==this.sendBtn){if(this.edit.text.length==0||this.edit.text==this.defaultText){UserTips.ins().showTips(i18n("FengceActivityWin_5"));return}ReportData.getIns().advice(this.edit.text,this.callBack,this)}else if(tar==this.edit){if(this.edit.text==this.defaultText){this.edit.text="";this.edit.textColor=16777215}}};FengceActivityWin.prototype.callBack=function(){this.edit.text=""};FengceActivityWin.prototype.close=function(){this.tab.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectIndex,this);this.edit.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onTap,this)};return FengceActivityWin}(BaseEuiView);__reflect(FengceActivityWin.prototype,"FengceActivityWin");ViewManager.ins().reg(FengceActivityWin,LayerManager.UI_Popup);var GuoActivityWin=function(_super){__extends(GuoActivityWin,_super);function GuoActivityWin(){var _this=_super.call(this)||this;_this.skinName="guoqingjie";return _this}GuoActivityWin.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap)};GuoActivityWin.prototype.onTap=function(e){ViewManager.ins().close(this)};return GuoActivityWin}(BaseEuiView);__reflect(GuoActivityWin.prototype,"GuoActivityWin");ViewManager.ins().reg(GuoActivityWin,LayerManager.UI_Popup);var HappySevenDayBtnItemRender=function(_super){__extends(HappySevenDayBtnItemRender,_super);function HappySevenDayBtnItemRender(){var _this=_super.call(this)||this;_this.day=0;_this.touchChildren=false;return _this}HappySevenDayBtnItemRender.prototype.dataChanged=function(){this.dayImg.source=this.data.res;this.isOpen=this.data.isOpen;this.day=this.data.day;this.currentState=!this.isOpen?"lock":"unlock";this.redpoint.visible=this.data.showRed};Object.defineProperty(HappySevenDayBtnItemRender.prototype,"selected",{set:function(value){this.currentState=this.isOpen?value?"unlockS":"unlock":"lock";if(this.data)this.redpoint.visible=this.data.showRed},enumerable:true,configurable:true});return HappySevenDayBtnItemRender}(BaseItemRender);__reflect(HappySevenDayBtnItemRender.prototype,"HappySevenDayBtnItemRender");var HappySevenDayItemRender=function(_super){__extends(HappySevenDayItemRender,_super);function HappySevenDayItemRender(){return _super.call(this)||this}HappySevenDayItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBase;this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect;this.actBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};HappySevenDayItemRender.prototype.dataChanged=function(){this._listCollect.source=this.data.conf.reward;this.pName.textFlow=TextFlowMaker.generateTextFlow1(this.data.conf.name);this.scedule.textFlow=TextFlowMaker.generateTextFlow1(i18n("HappySevenDayItemRender_2",65280,Math.floor(this.data.times/this.data.conf.rate),Math.floor(this.data.conf.dayLimit/this.data.conf.rate)));this.currentState=this.data.state==2?"done":"normal";this.redpoint.visible=this.data.state==1;if(this.data.state==0&&this.data.conf.turn){this.actBtn.enabled=true;this.actBtn.label=i18n("HappySevenDayItemRender_0")}else{this.actBtn.label=i18n("HappySevenDayItemRender_1");this.actBtn.enabled=this.data.state==1}};HappySevenDayItemRender.prototype.onTouch=function(e){if(this.data.state==0&&this.data.conf.turn)ViewManager.ins().open(this.data.conf.turn[0],this.data.conf.turn[1]);else Activity.ins().sendReward(this.data.activityID,this.data.conf.index,2)};HappySevenDayItemRender.prototype.destruct=function(){this.actBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};return HappySevenDayItemRender}(BaseItemRender);__reflect(HappySevenDayItemRender.prototype,"HappySevenDayItemRender");var HappySevenDayTabListItemRender=function(_super){__extends(HappySevenDayTabListItemRender,_super);function HappySevenDayTabListItemRender(){var _this=_super.call(this)||this;_this.touchChildren=false;return _this}HappySevenDayTabListItemRender.prototype.dataChanged=function(){this.tabName.text=this.data.gName;this.redpoint.visible=this.data.showRed};Object.defineProperty(HappySevenDayTabListItemRender.prototype,"selected",{set:function(value){this.currentState=value?"select":"unselect";if(this.data)this.redpoint.visible=this.data.showRed},enumerable:true,configurable:true});return HappySevenDayTabListItemRender}(BaseItemRender);__reflect(HappySevenDayTabListItemRender.prototype,"HappySevenDayTabListItemRender");var HappySevenDayWin=function(_super){__extends(HappySevenDayWin,_super);function HappySevenDayWin(){var _this=_super.call(this)||this;_this._curDay=0;_this._curDayIndex=0;_this._curGroupIndex=0;_this.isTopLevel=true;_this.setActivityID();_this.setCurSkin();return _this}HappySevenDayWin.prototype.setActivityID=function(){var data=Activity.ins().activityData;for(var k in data){if(data[k].pageStyle==ActivityPageStyle.HAPPYSEVENDAY){this._activityID=data[k].id;break}}};HappySevenDayWin.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this._activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="sevenDayWin";if(this.actInfo0)this.actInfo0.text=aCon.desc};HappySevenDayWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.tabP.itemRenderer=HappySevenDayTabListItemRender;this.tabD.itemRenderer=HappySevenDayBtnItemRender;this.list.itemRenderer=HappySevenDayItemRender};HappySevenDayWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._activityID=param[0];this.setCurSkin();this._curDayIndex=0;this._curGroupIndex=0;this.itemlist.visible=true;this.updateView();this.updateTabs();this.tabD.selectedIndex=this._curDayIndex;this.tabP.selectedIndex=this._curGroupIndex;this.updateData();this.updateTargetAward();this.addTouchEvent(this,this.onTouch);this.observe(Activity.ins().postActivityIsGetAwards,this.refreshReds);this.addChangeEvent(this.tabD,this.onClickBtn);this.addChangeEvent(this.tabP,this.onTabBtn);TimerManager.ins().doTimer(1e3,0,this.setTime,this)};HappySevenDayWin.prototype.close=function(){this._tabCollect=null;this._btnCollect=null;this._listCollect=null};HappySevenDayWin.prototype.updateView=function(){var data=Activity.ins().getActivityDataById(this._activityID);this._curDay=data.getCurDay();this._items=[];var confs=GlobalConfig.ActivityType11_2Config[this._activityID];var conf;var btnArr=[];var days;var day;var group;var groups;var achieve;for(var k in confs){conf=confs[k];day=conf.day;days=this._items[conf.day-1];if(!days){days=[];this._items[conf.day-1]=days;btnArr.push({res:conf.dayImg,isOpen:this._curDay>=conf.day,showRed:false,day:conf.day})}achieve=data.achieveInfo[conf.index-1];if(this._curDay>=conf.day&&!achieve.isGot&&achieve.times>=conf.dayLimit)btnArr[conf.day-1].showRed=true;group=conf.group;groups=days[group-1];if(!groups){groups=[];days[group-1]=groups}groups.push(conf)}if(!this._btnCollect){this._btnCollect=new ArrayCollection;this.tabD.dataProvider=this._btnCollect}this._btnCollect.source=btnArr;this.tabD.validateNow();if(!this._tabCollect){this._tabCollect=new ArrayCollection;this.tabP.dataProvider=this._tabCollect}};HappySevenDayWin.prototype.refreshReds=function(){this.updateView();this.updateTabs();this.updateData();this.updateTargetAward()};HappySevenDayWin.prototype.updateData=function(){var items=this._items[this._curDayIndex][this._curGroupIndex];if(!items||!items.length)return;if(!this._listCollect){this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect}var len=items.length;var conf;var datas=[];var state=0;var achieve;var activityData=Activity.ins().getActivityDataById(this._activityID);for(var i=0;i<len;i++){conf=items[i];achieve=activityData.achieveInfo[conf.index-1];if(achieve.isGot)state=2;else if(achieve.times>=conf.dayLimit)state=1;else state=0;datas[i]={activityID:this._activityID,conf:conf,state:state,times:achieve.times}}datas.sort(this.sort);this._listCollect.source=datas};HappySevenDayWin.prototype.sort=function(a,b){if(a.state==1&&b.state!=1)return-1;if(a.state==2&&b.state!=2)return 1;if(a.conf.index<b.conf.index)return-1;if(a.conf.index>b.conf.index)return 1;return 0};HappySevenDayWin.prototype.updateTargetAward=function(){var conf=GlobalConfig.ActivityType11_1Config[this._activityID][Object.keys(GlobalConfig.ActivityType11_1Config[this._activityID]).length];this.schedule.maximum=conf.score;this.schedule.value=Activity.ins().getActivityDataById(this._activityID).hiScore};HappySevenDayWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:ViewManager.ins().open(SDRewardWin,this._activityID);break}};HappySevenDayWin.prototype.onClickBtn=function(e){if(this._curDayIndex==e.currentTarget.selectedIndex)return;var btnItem=this.tabD.getChildAt(e.currentTarget.selectedIndex);if(!btnItem.isOpen)UserTips.ins().showCenterTips(i18n("HappySevenDayWin_0")+btnItem.day+i18n("HappySevenDayWin_1"));else{btnItem=this.tabD.getChildAt(this._curDayIndex);btnItem.selected=false;this._curDayIndex=e.currentTarget.selectedIndex}this.tabD.selectedIndex=this._curDayIndex;btnItem=this.tabD.getChildAt(this._curDayIndex);btnItem.selected=true;this.updateTabs();this.tabP.selectedIndex=this._curGroupIndex=0;this.updateData()};HappySevenDayWin.prototype.onTabBtn=function(e){if(this._curGroupIndex==e.currentTarget.selectedIndex)return;this._curGroupIndex=e.currentTarget.selectedIndex;this.tabP.selectedIndex=this._curGroupIndex;this.updateData()};HappySevenDayWin.prototype.updateTabs=function(){var days=this._items[this._curDayIndex];var data=Activity.ins().getActivityDataById(this._activityID);var tabs=[];var len;var achieve;var conf;for(var k in days){tabs.push({gName:days[k][0].gName,showRed:false});len=days[k].length;for(var i=0;i<len;i++){conf=days[k][i];achieve=data.achieveInfo[conf.index-1];if(this._curDay>=conf.day&&!achieve.isGot&&achieve.times>=conf.dayLimit){tabs[k].showRed=true;break}}}this._tabCollect.source=tabs};HappySevenDayWin.prototype.setTime=function(){var data=Activity.ins().activityData[this._activityID];if(data)this.actTime0.text=data.getRemainTime()};return HappySevenDayWin}(BaseEuiView);__reflect(HappySevenDayWin.prototype,"HappySevenDayWin");ViewManager.ins().reg(HappySevenDayWin,LayerManager.UI_Main);var SDRewardWin=function(_super){__extends(SDRewardWin,_super);function SDRewardWin(){var _this=_super.call(this)||this;_this.skinName="SDRewardSkin";_this.isTopLevel=true;return _this}SDRewardWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=SDShowItemRender};SDRewardWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var len=Object.keys(GlobalConfig.ActivityType11_1Config[args[0]]).length;var dataArr=[];var conf;for(var key in GlobalConfig.ActivityType11_1Config[args[0]]){conf=GlobalConfig.ActivityType11_1Config[args[0]][key];dataArr.push({reward:conf.reward,showText:conf.showText})}this.list.dataProvider=new ArrayCollection(dataArr)};return SDRewardWin}(BaseEuiView);__reflect(SDRewardWin.prototype,"SDRewardWin");ViewManager.ins().reg(SDRewardWin,LayerManager.UI_Main);var SDShowItemRender=function(_super){__extends(SDShowItemRender,_super);function SDShowItemRender(){return _super.call(this)||this}SDShowItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBase};SDShowItemRender.prototype.dataChanged=function(){this.scheduleTxt.textFlow=TextFlowMaker.generateTextFlow1(this.data.showText);this.list.dataProvider=new ArrayCollection(this.data.reward)};return SDShowItemRender}(BaseItemRender);__reflect(SDShowItemRender.prototype,"SDShowItemRender");var KaiMenItem=function(_super){__extends(KaiMenItem,_super);function KaiMenItem(){var _this=_super.call(this)||this;_this.skinName="KMHRechargeItem";_this.init();return _this}KaiMenItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};KaiMenItem.prototype.init=function(){this.reward.itemRenderer=ItemBase;this.get.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};KaiMenItem.prototype.onClick=function(){if(!this.data||!(this.data instanceof KaiMenData))return;if(this.data.already){UserTips.ins().showTips(i18n("KaiMenItem_0"));return}if(this.data.unready){UserTips.ins().showTips(i18n("KaiMenItem_1"));return}if(this.data.type==3){if(!this.data.redPoint){Recharge.ins().tryShowChargeFirstWin();return}}else if(this.data.type==1){if(!this.data.redPoint){UserTips.ins().showTips(i18n("KaiMenItem_2"));return}}Activity.ins().sendReward(this.data.id,this.data.index)};KaiMenItem.prototype.dataChanged=function(){if(!this.data||!(this.data instanceof KaiMenData))return;this.unready.visible=this.data.unready;this.already.visible=this.data.already;this.redPoint.visible=this.data.redPoint;this.reward.dataProvider=new eui.ArrayCollection(this.data.reward);if(this.data.type==3){if(this.unready.visible){this.get.visible=false}else{this.get.visible=!this.already.visible}this.day.text=i18n("KaiMenItem_3",this.data.day);DisplayUtils.removeFromParent(this.daySchedule);if(!this.get.parent)this.buyGroup.addChild(this.get)}else if(this.data.type==1){if(this.unready.visible){this.get.visible=false}else{this.get.visible=this.redPoint.visible;if(!this.get.parent)this.buyGroup.addChild(this.get)}this.unready.visible=false;this.day.text=i18n("KaiMenItem_4",this.data.day);if(this.already.visible)DisplayUtils.removeFromParent(this.daySchedule);else{if(!this.daySchedule.parent)this.buyGroup.addChild(this.daySchedule)}}if(!this.get.visible){DisplayUtils.removeFromParent(this.get)}if(this.data.type==3&&!this.data.redPoint){this.get.label=i18n("KaiMenItem_5")}else{this.get.label=i18n("KaiMenItem_6")}if(this.daySchedule.parent){var act=Activity.ins().getActivityDataById(this.data.id);var color=65280;this.daySchedule.textFlow=TextFlowMaker.generateTextFlow1(i18n("KaiMenItem_7",color,act.dabiao[this.data.index-1],this.data.day))}};KaiMenItem.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};return KaiMenItem}(BaseItemRender);__reflect(KaiMenItem.prototype,"KaiMenItem");var KaiMenData=function(){function KaiMenData(){}return KaiMenData}();__reflect(KaiMenData.prototype,"KaiMenData");var KaiMenWin=function(_super){__extends(KaiMenWin,_super);function KaiMenWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.skinName="kaimenhongWin";_this.isTopLevel=true;_this.selectIndex=0;return _this}KaiMenWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this._pageStyle=ActivityPageStyle.KAIMENHONG;this.menuList.itemRenderer=ActivityBtnRenderer};KaiMenWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};KaiMenWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.KAIMENHONG)continue;if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("KaiMenWin_0"));return false};KaiMenWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.addChangeEvent(this.menuScroller,this.onChange)};KaiMenWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};KaiMenWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};KaiMenWin.prototype.updateView=function(){var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=this._pageStyle){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(data.activityType&&data.activityType==ActivityType.Nesting)continue;if(!ErrorLog.Assert(data,"kaimenhong  data   "+k))this._datas.push(data)}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,ActivityType.Normal);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};KaiMenWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};KaiMenWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};KaiMenWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);this.refushRedPoint()};KaiMenWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){this.setOpenIndex(this.selectIndex)}}};KaiMenWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};KaiMenWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}this.leftRed.visible=this.leftBtn.visible;this.rightRed.visible=this.rightBtn.visible};KaiMenWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};KaiMenWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return KaiMenWin}(BaseEuiView);__reflect(KaiMenWin.prototype,"KaiMenWin");ViewManager.ins().reg(KaiMenWin,LayerManager.UI_Main);var KMHRecharge=function(_super){__extends(KMHRecharge,_super);function KMHRecharge(){return _super!==null&&_super.apply(this,arguments)||this}return KMHRecharge}(BaseEuiView);__reflect(KMHRecharge.prototype,"KMHRecharge");var LaBaBossPlayerItemRender=function(_super){__extends(LaBaBossPlayerItemRender,_super);function LaBaBossPlayerItemRender(){var _this=_super.call(this)||this;_this.skinName="LaBaBossPlayerRankSkin";return _this}LaBaBossPlayerItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};LaBaBossPlayerItemRender.prototype.dataChanged=function(){if(!this.data)return;this.rank.text=this.data.rank+"";this.rank.visible=this.data.rank?true:false;this.name1.text=this.data.name;CommonUtils.labelIsOverLenght(this.hurt,this.data.damage)};LaBaBossPlayerItemRender.prototype.destruct=function(){};return LaBaBossPlayerItemRender}(BaseItemRender);__reflect(LaBaBossPlayerItemRender.prototype,"LaBaBossPlayerItemRender");var LabaBossUIPanel=function(_super){__extends(LabaBossUIPanel,_super);function LabaBossUIPanel(){var _this=_super.call(this)||this;_this._curMonsterID=0;_this.curValue=1;_this.skinName="LaBaBossBattleUiSkin";return _this}LabaBossUIPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.bloodBar.slideDuration=0;this.grayImg.visible=false;this.already=false;this.bossHurt=false};LabaBossUIPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.otherRank.itemRenderer=LaBaBossPlayerItemRender;this.rankArrayCollection=new eui.ArrayCollection;this.otherRank.dataProvider=this.rankArrayCollection;this.meRank.itemRenderer=LaBaBossPlayerItemRender;this.myrankArrayCollection=new eui.ArrayCollection;this.meRank.dataProvider=this.myrankArrayCollection};LabaBossUIPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.calcTime,this);TimerManager.ins().remove(this.updateLogic,this);this.removeObserve();this._curMonsterID=0;ViewManager.ins().close(this)};LabaBossUIPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(UserBoss.ins().postHpChange,this.updateInfo);this.addTouchEvent(this.rankReward,this.onTap);this.updateData();if(!this.activity||!this.activity.go2BossFb()){ViewManager.ins().close(this);UserFb.ins().sendExitFb();return}this.init()};LabaBossUIPanel.prototype.init=function(){this.timer=this.activity.getResidueTimer();this.readyTimer=this.activity.getResidueStartTimer();this.already=this.activity.checkRedPoint();this.TimerChange()};LabaBossUIPanel.prototype.updateData=function(){this.activity=Activity.ins().checkLabaBossData()};LabaBossUIPanel.prototype.updateLogic=function(){if(this.already)this.updateFb();else this.updateReady();this.refreshBg.visible=this.refreshHints.visible=this.refreshTime.visible=!this.already;this.bossBloodGroup.visible=this.already};LabaBossUIPanel.prototype.updateReady=function(){if(this.readyTimer){this.refreshTime.text=this.readyTimer+i18n("LabaBossUIPanel_0")}else{this.refreshTime.text=i18n("LabaBossUIPanel_1")}if(!this.bossHurt){this.already=false}else{this.timer=this.activity.getResidueTimer();this.already=true}};LabaBossUIPanel.prototype.updateFb=function(){this.updateBaseInfo();var config=GlobalConfig.ActivityType20Config[this.activity.id][this.activity.index];var percent=this.timer/config.duration;percent=percent>=1?1:percent;this.bloodBar.value=percent*100;this.bloodBar.maximum=100;var percentLabel=(percent*100).toFixed(1);this.bloodBar.labelFunction=function(){return percentLabel+"%"};this.updateHurtRank()};LabaBossUIPanel.prototype.updateHurtRank=function(){var rankData=[];var myData=[];for(var i=0;i<UserBoss.ins().rank.length;i++){var rankitemdata=UserBoss.ins().rank[i];var rd={rank:rankitemdata.rank,name:rankitemdata.roleName,damage:rankitemdata.value};if(i<5){rankData.push(rd)}if(rankitemdata.id==Actor.actorID){myData.push(rd)}if(rankData.length==5&&!myData.length)break}if(!myData.length){var rd={rank:0,name:Actor.myName,damage:0};myData.push(rd)}this.rankArrayCollection.replaceAll(rankData);this.myrankArrayCollection.replaceAll(myData)};LabaBossUIPanel.prototype.updateBaseInfo=function(){if(this._curMonsterID==UserBoss.ins().monsterID)return;this._curMonsterID=UserBoss.ins().monsterID;var config=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];if(!config)return;this.head.source="monhead"+config.head+"_png";this.lvTxt.text=config.level+i18n("Level_0");this.nameTxt.text=config.name};LabaBossUIPanel.prototype.tweenBlood=function(){var _this=this;var bloodPer=this.curValue*LabaBossUIPanel.GRAYIMG_WIDTH/100;var self=this;egret.Tween.removeTweens(this.grayImgMask);if(bloodPer<3)return;var t=egret.Tween.get(this.grayImgMask,{onChange:function(){if(self.grayImg)self.grayImg.mask=_this.grayImgMask}},self);t.to({width:bloodPer-3},1e3).call(function(){if(bloodPer<=0){self.grayImgMask.width=0;egret.Tween.removeTweens(this.grayImgMask)}},self)};LabaBossUIPanel.prototype.TimerChange=function(){if(!TimerManager.ins().isExists(this.calcTime,this))TimerManager.ins().doTimer(1e3,0,this.calcTime,this);if(!TimerManager.ins().isExists(this.updateLogic,this))TimerManager.ins().doTimer(60,0,this.updateLogic,this)};LabaBossUIPanel.prototype.calcTime=function(){if(this.timer>0)this.timer--;else{this.timer=0}if(this.bossHurt)this.readyTimer=0;else{if(this.readyTimer>0)this.readyTimer--}};LabaBossUIPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.rankReward:ViewManager.ins().open(LabaRewardTips,this.activity);break}};LabaBossUIPanel.prototype.updateReliveTime=function(){if(UserBoss.ins().reliveTime>0){ViewManager.ins().open(WorldBossBeKillWin)}else{ViewManager.ins().close(WorldBossBeKillWin)}};LabaBossUIPanel.prototype.updateInfo=function(){this.bossHurt=true};LabaBossUIPanel.GRAYIMG_WIDTH=0;return LabaBossUIPanel}(BaseEuiView);__reflect(LabaBossUIPanel.prototype,"LabaBossUIPanel");ViewManager.ins().reg(LabaBossUIPanel,LayerManager.Game_Main);var LabaChangeItemRender=function(_super){__extends(LabaChangeItemRender,_super);function LabaChangeItemRender(){return _super.call(this)||this}LabaChangeItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase;this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};LabaChangeItemRender.prototype.dataChanged=function(){if(!this.data)return;var config=this.data.config;var state=this.data.state;var actData=Activity.ins().getActivityDataById(config.Id);if(!this._dataCollect){this._dataCollect=new ArrayCollection;this.reward.dataProvider=this._dataCollect}this.result.data=config.rewards[0];var items=[];for(var i in config.items){var itemcfg=GlobalConfig.ItemConfig[config.items[i].id];var item={id:config.items[i].id,count:config.items[i].count,type:ItemConfig.getType(itemcfg)};items.push(item)}this._dataCollect.replaceAll(items);this.reward.validateNow();for(var i=0;i<this.reward.numElements;i++){var render=this.reward.getVirtualElementAt(i);var datas=this.reward.dataProvider.getItemAt(i);var itemData=UserBag.ins().getBagItemById(datas.id);var curCount=itemData?itemData.count:0;var color=curCount>=datas.count?65280:16711680;render.setName(i18n("LabaChangeItemRender_4",color,curCount,datas.count))}var colorStr=0;if(state==Activity.CanGet){this.get.enabled=true;this.get.currentState="up";colorStr=65280}else{this.get.enabled=false;this.get.currentState="disabled";colorStr=16711680}var sum=0;if(config.count){sum=config.count-actData.personalRewardsSum[config.index];sum=sum>0?sum:0;this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1(i18n("LabaChangeItemRender_0",sum))}else if(config.dailyCount){sum=config.dailyCount-actData.exchange[config.index];sum=sum>0?sum:0;this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1(i18n("LabaChangeItemRender_1",sum))}if(config.scount){this.slimit.visible=true;sum=config.scount-actData.worldRewardsSum[config.index];sum=sum>0?sum:0;this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1(i18n("LabaChangeItemRender_2",sum))}else{this.slimit.visible=false}this.redPoint.visible=this.get.enabled;var maxitems=3;for(var i=0;i<maxitems;i++){if(!config.items[maxitems-i-1]){if(this["add"+(maxitems-i-1)])DisplayUtils.removeFromParent(this["add"+(maxitems-i-1)])}}};LabaChangeItemRender.prototype.onTap=function(e){if(!this.data||!this.data.config){UserTips.ins().showTips(i18n("LabaChangeItemRender_3"));return}if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}Activity.ins().sendReward(this.data.config.Id,this.data.config.index)};LabaChangeItemRender.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};return LabaChangeItemRender}(BaseItemRender);__reflect(LabaChangeItemRender.prototype,"LabaChangeItemRender");var LaBaRewardItemItemRender=function(_super){__extends(LaBaRewardItemItemRender,_super);function LaBaRewardItemItemRender(){return _super.call(this)||this}LaBaRewardItemItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rewardList.itemRenderer=ItemBase};LaBaRewardItemItemRender.prototype.dataChanged=function(){if(!this.data)return;var config=this.data.config;var index=this.data.index;var show=config.rankReward[index];var rank="";if(index==config.rankReward.length-1){rank=i18n("LaBaRewardItemItemRender_0")}else if(show.start==show.endi){rank=i18n("LaBaRewardItemItemRender_1",show.start)}else{rank=i18n("LaBaRewardItemItemRender_2",show.start,show.endi)}this.ranks.text=rank;this.rewardList.dataProvider=new eui.ArrayCollection(show.reward)};LaBaRewardItemItemRender.prototype.destruct=function(){};return LaBaRewardItemItemRender}(BaseItemRender);__reflect(LaBaRewardItemItemRender.prototype,"LaBaRewardItemItemRender");var LabaRewardTips=function(_super){__extends(LabaRewardTips,_super);function LabaRewardTips(){var _this=_super.call(this)||this;_this.skinName="LaBaRankRewardskin";return _this}LabaRewardTips.prototype.destoryView=function(){_super.prototype.destoryView.call(this)};LabaRewardTips.prototype.initUI=function(){_super.prototype.initUI.call(this)};LabaRewardTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list0.itemRenderer=LaBaRewardItemItemRender;this.addTouchEvent(this.bgClose,this.onClick);this.activity=param[0];this.updateView()};LabaRewardTips.prototype.onClick=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break}};LabaRewardTips.prototype.updateView=function(){if(!this.activity)return;var config=GlobalConfig.ActivityType20Config[this.activity.id][this.activity.index];var arr=[];for(var i=0;i<config.rankReward.length;i++){arr.push({config:config,index:i})}this.list0.dataProvider=new eui.ArrayCollection(arr)};return LabaRewardTips}(BaseEuiView);__reflect(LabaRewardTips.prototype,"LabaRewardTips");ViewManager.ins().reg(LabaRewardTips,LayerManager.UI_Popup);var LabaWin=function(_super){__extends(LabaWin,_super);function LabaWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.skinName="LaBaWin";_this.isTopLevel=true;_this.selectIndex=0;return _this}LabaWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this._pageStyle=ActivityPageStyle.LABA;this.menuList.itemRenderer=ActivityBtnRenderer};LabaWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};LabaWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.LABA)continue;if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("LabaWin_0"));return false};LabaWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.addChangeEvent(this.menuScroller,this.onChange)};LabaWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};LabaWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};LabaWin.prototype.updateView=function(){var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=this._pageStyle){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(!ErrorLog.Assert(data,"laba  data   "+k))this._datas.push(data)}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,ActivityType.Normal);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};LabaWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};LabaWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};LabaWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);this.refushRedPoint()};LabaWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){this.setOpenIndex(this.selectIndex)}}};LabaWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};LabaWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}this.leftRed.visible=this.leftBtn.visible;this.rightRed.visible=this.rightBtn.visible};LabaWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};LabaWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return LabaWin}(BaseEuiView);__reflect(LabaWin.prototype,"LabaWin");ViewManager.ins().reg(LabaWin,LayerManager.UI_Main);var OSATarget21Panel=function(_super){__extends(OSATarget21Panel,_super);function OSATarget21Panel(){return _super.call(this)||this}OSATarget21Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();TimerManager.ins().removeAll(this);TimerManager.ins().remove(this.setTime,this)};OSATarget21Panel.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="LaBaActivityTimeDrop"};OSATarget21Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();this.rewardList.itemRenderer=ItemBase;this.updateData();this.updateUI();TimerManager.ins().doTimer(1e3,0,this.setTime,this)};OSATarget21Panel.prototype.updateData=function(){var config=GlobalConfig.ActivityBtnConfig[this.activityID];if(config.showReward)this.rewardList.dataProvider=new eui.ArrayCollection(config.showReward)};OSATarget21Panel.prototype.updateUI=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor(DateUtils.formatMiniDateTime(activityData.startTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND);var endedTime=Math.floor(DateUtils.formatMiniDateTime(activityData.endTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND);if(beganTime>=0){this.actTime.text=i18n("OSATarget21Panel_0")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget21Panel_1")}else{this._time=endedTime;if(this._time<0)this._time=0;this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}var config=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=config.desc;var btnconfig=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnconfig){this.title.source=btnconfig.title}};OSATarget21Panel.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};return OSATarget21Panel}(ActivityPanel);__reflect(OSATarget21Panel.prototype,"OSATarget21Panel");var OSATarget7Panel6=function(_super){__extends(OSATarget7Panel6,_super);function OSATarget7Panel6(){var _this=_super.call(this)||this;_this._leftTime=0;_this.skinName="LaBaexchangeSkin";return _this}OSATarget7Panel6.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.actInfo0.text=GlobalConfig.ActivityConfig[this.activityID].desc;this.content.itemRenderer=LabaChangeItemRender};Object.defineProperty(OSATarget7Panel6.prototype,"activityID",{get:function(){return this._activityID},set:function(value){this._activityID=value},enumerable:true,configurable:true});OSATarget7Panel6.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(UserBag.ins().postItemAdd,this.updateList);this.observe(UserBag.ins().postItemChange,this.updateList);this.observe(Activity.ins().postActivityIsGetAwards,this.updateList);this.updateData()};OSATarget7Panel6.prototype.close=function(){this.removeObserve();TimerManager.ins().remove(this.setTime,this);this._leftTime=0};OSATarget7Panel6.prototype.updateData=function(){this._activityData=Activity.ins().getActivityDataById(this.activityID);this.checkTime();this.updateList()};OSATarget7Panel6.prototype.updateList=function(){var datas=[];var configs=GlobalConfig.ActivityType7Config[this.activityID];for(var i in configs){var state=this._activityData.getExchange(configs[i].index);datas.push({config:configs[i],state:state})}datas.sort(this.sort);if(!this._dataCollect){this._dataCollect=new ArrayCollection;this.content.dataProvider=this._dataCollect}this._dataCollect.replaceAll(datas)};OSATarget7Panel6.prototype.sort=function(a,b){if(a.config.index<b.config.index)return-1;else return 1};OSATarget7Panel6.prototype.checkTime=function(){this._leftTime=0;if(Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3)>=0)this.actTime0.text=i18n("OSATarget7Panel6_0");else{this._leftTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);if(this._leftTime<=0)this.actTime0.text=i18n("OSATarget7Panel6_1");else{this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3);if(!TimerManager.ins().isExists(this.setTime,this))TimerManager.ins().doTimer(1e3,0,this.setTime,this)}}};OSATarget7Panel6.prototype.setTime=function(){this._leftTime--;this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3);if(this._leftTime<=0)this.checkTime()};return OSATarget7Panel6}(BaseView);__reflect(OSATarget7Panel6.prototype,"OSATarget7Panel6");var LongTaiTouWin=function(_super){__extends(LongTaiTouWin,_super);function LongTaiTouWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.skinName="longtaitouWin";_this.isTopLevel=true;_this.selectIndex=0;return _this}LongTaiTouWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this._pageStyle=ActivityPageStyle.LONGTAITOU;this.menuList.itemRenderer=ActivityBtnRenderer};LongTaiTouWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};LongTaiTouWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.LONGTAITOU)continue;if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("LongTaiTouWin_0"));return false};LongTaiTouWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.addChangeEvent(this.menuScroller,this.onChange)};LongTaiTouWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};LongTaiTouWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};LongTaiTouWin.prototype.updateView=function(){var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=this._pageStyle){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(data.activityType&&data.activityType==ActivityType.Nesting)continue;if(!ErrorLog.Assert(data,"longtaitou  data   "+k))this._datas.push(data)}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,ActivityType.Normal);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};LongTaiTouWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};LongTaiTouWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};LongTaiTouWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);this.refushRedPoint()};LongTaiTouWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){this.setOpenIndex(this.selectIndex)}}};LongTaiTouWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};LongTaiTouWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}this.leftRed.visible=this.leftBtn.visible;this.rightRed.visible=this.rightBtn.visible};LongTaiTouWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};LongTaiTouWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return LongTaiTouWin}(BaseEuiView);__reflect(LongTaiTouWin.prototype,"LongTaiTouWin");ViewManager.ins().reg(LongTaiTouWin,LayerManager.UI_Main);var FireworkerItemRender=function(_super){__extends(FireworkerItemRender,_super);function FireworkerItemRender(){var _this=_super.call(this)||this;_this._state=0;_this.skinName="fireworkerItemSkin";_this.touchChildren=false;return _this}FireworkerItemRender.prototype.dataChanged=function(){this.touchEnabled=this.data.state!=2;this.redPoint.visible=this.data.state==1;this.lingqu.visible=this.data.state==2;var colorStr=this.data.state==0?16711680:65280;this.boxSchadule.textFlow=TextFlowMaker.generateTextFlow1(i18n("fireworkerItemRender_0",colorStr,this.data.curTimes>this.data.times?this.data.times:this.data.curTimes,this.data.times));this.count.text=this.data.count;if(this.data.type==1){var itemConfig=GlobalConfig.ItemConfig[this.data.id];this.box.source=itemConfig.icon+"_png"}else this.box.source="richman_reward"};return FireworkerItemRender}(BaseItemRender);__reflect(FireworkerItemRender.prototype,"FireworkerItemRender");var HighProjectItemRender=function(_super){__extends(HighProjectItemRender,_super);function HighProjectItemRender(){var _this=_super.call(this)||this;_this.skinName="highProjectItemSkin";_this.touchChildren=false;_this.touchEnabled=true;_this.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTouch,_this);return _this}HighProjectItemRender.prototype.dataChanged=function(){this.projectName.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.data.config.name);this.jifen.textFlow=TextFlowMaker.generateTextFlow1(i18n("HighProjectItemRender_0",65280,this.data.config.score));var cur=Math.floor(this.data.times/this.data.config.target);var max=Math.floor(this.data.config.dayLimit/this.data.config.target);if(cur>max)cur=max;this.daliyCount.textFlow=TextFlowMaker.generateTextFlow1(i18n("HighProjectItemRender_1",65280,cur,max))};HighProjectItemRender.prototype.onTouch=function(e){if(this.data.config.turn)ViewManager.ins().open(this.data.config.turn[0],this.data.config.turn[1])};HighProjectItemRender.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};return HighProjectItemRender}(BaseItemRender);__reflect(HighProjectItemRender.prototype,"HighProjectItemRender");var HighRewardItemRender=function(_super){__extends(HighRewardItemRender,_super);function HighRewardItemRender(){var _this=_super.call(this)||this;_this.skinName="highRewardItemSkin";return _this}HighRewardItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBase;this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect;this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};HighRewardItemRender.prototype.dataChanged=function(){this.count.text=this.data.config.score;this.currentState=this.data.state==2?"done":this.data.state==1?"kelingqu":"normal";this._listCollect.source=this.data.config.reward};HighRewardItemRender.prototype.onTouch=function(e){Activity.ins().sendReward(this.data.activityID,this.data.index,1)};HighRewardItemRender.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};return HighRewardItemRender}(BaseItemRender);__reflect(HighRewardItemRender.prototype,"HighRewardItemRender");var NewYearWin=function(_super){__extends(NewYearWin,_super);function NewYearWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.selectIndex=0;_this.skinName="newYearWin";_this.isTopLevel=true;return _this}NewYearWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.menuList.itemRenderer=ActivityBtnRenderer};NewYearWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateView();this.addTouchEvent(this,this.onTouch);this.addChangeEvent(this.menuList,this.onClickMenu);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.selectIndex=0;if(param&&param.length){var id=param[0];var i=0;for(var k in this._datas){if(this._datas[k].id==id){this.selectIndex=i;break}i++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.selectIndex!=0)this.activityPanelList[0].close();this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true);this.onChange()};NewYearWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList);this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller);this.removeObserve();for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};NewYearWin.prototype.onChange=function(){if(this.menuList.scrollH<20){this.leftBtn0.visible=false;this.rightBtn0.visible=true}else if(this.menuList.scrollH>(this.menuList.dataProvider.length-5)*88+2){this.leftBtn0.visible=true;this.rightBtn0.visible=false}else{this.leftBtn0.visible=true;this.rightBtn0.visible=true}this.leftRed0.visible=this.rightRed0.visible=false;var len=this.menuList.dataProvider.length;if(len<=5){this.leftBtn0.visible=false;this.rightBtn0.visible=false}else{var curIndex=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn0.visible){for(var i=0;i<=curIndex-5;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed0.visible=true;break}}}if(this.rightBtn0.visible){for(var i=curIndex+1;i<len;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed0.visible=true;break}}}}};NewYearWin.prototype.updateView=function(){var i=0;for(i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle==ActivityPageStyle.NEWYEAR&&Activity.ins().getActivityDataById(+k).isOpenActivity()&&!Activity.ins().getActivityDataById(+k).getHide())this._datas.push(Activity.ins().getbtnInfo(k))}this._datas.sort(this.sort);i=0;for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);var panel=ActivityPanel.create(id,act.activityType);panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);i++}this.dataArr=new eui.ArrayCollection(this._datas);this.menuList.dataProvider=this.dataArr;this.viewStack.validateNow();this.menuList.validateNow()};NewYearWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas);this.menuList.dataProvider=this.dataArr};NewYearWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};NewYearWin.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn0:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;this.onChange();break;case this.rightBtn0:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;this.onChange();break}};NewYearWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this.activityPanelList[this.selectIndex].close()}else return;this.selectIndex=e.currentTarget.selectedIndex;this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true)};return NewYearWin}(BaseEuiView);__reflect(NewYearWin.prototype,"NewYearWin");ViewManager.ins().reg(NewYearWin,LayerManager.UI_Main);var DailyRechargeItemRender=function(_super){__extends(DailyRechargeItemRender,_super);function DailyRechargeItemRender(){var _this=_super.call(this)||this;_this._state=0;_this._totalRecharge=0;_this._activityID=0;_this._index=0;_this.skinName="DailyRechargeItemSkin";return _this}DailyRechargeItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase;this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};DailyRechargeItemRender.prototype.dataChanged=function(){this._config=this.data[0];this._state=this.data[1];this._totalRecharge=this.data[2];this._activityID=this.data[3];this._index=this.data[4];this.target.text=i18n("DailyRechargeItemRender_0")+this._config.val+i18n("DailyRechargeItemRender_1");this.recharge.text="("+(this._totalRecharge>this._config.val?this._config.val:this._totalRecharge)+"/"+this._config.val+")";this.reward.dataProvider=new eui.ArrayCollection(this._config.rewards);this.redPoint.visible=this._state==1;this.get.enabled=this._state==1;this.get.label=this._state==2?i18n("DailyRechargeItemRender_2"):this._state==1?i18n("DailyRechargeItemRender_3"):i18n("DailyRechargeItemRender_4")};DailyRechargeItemRender.prototype.onTap=function(e){if(this._config instanceof ActivityType3Config)Activity.ins().sendReward(this._activityID,this._index);else if(this._config instanceof PActivity3Config)PActivity.ins().sendReward(this._activityID,this._index)};return DailyRechargeItemRender}(BaseItemRender);__reflect(DailyRechargeItemRender.prototype,"DailyRechargeItemRender");var DailyRechargePanel=function(_super){__extends(DailyRechargePanel,_super);function DailyRechargePanel(){var _this=_super.call(this)||this;_this._time=0;_this.skinName="DailyRechargeSkin";return _this}DailyRechargePanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.content.itemRenderer=DailyRechargeItemRender};DailyRechargePanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.observe(PActivity.ins().postActivityIsGetAwards,this.updateData);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.updateData()};DailyRechargePanel.prototype.close=function(){this.removeObserve();TimerManager.ins().removeAll(this)};DailyRechargePanel.prototype.updateData=function(){var data;var configs;if(this.actType==ActivityType.Normal){data=Activity.ins().getActivityDataById(this.activityID);configs=GlobalConfig.ActivityType3Config[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().getActivityDataById(this.activityID);configs=GlobalConfig.PActivity3Config[this.activityID]}var config;var datas=[];var i=0;var state=0;for(var k in configs){config=configs[k];state=data.recrod>>config.index&1?2:data.chongzhiTotal>=config.val?1:0;datas[i]=[config,state,data.chongzhiTotal,this.activityID,config.index];i++}this.content.dataProvider=new eui.ArrayCollection(datas);this._time=data.getLeftTime();this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)};DailyRechargePanel.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)}};return DailyRechargePanel}(BaseView);__reflect(DailyRechargePanel.prototype,"DailyRechargePanel");var OSA3HeroesPanel=function(_super){__extends(OSA3HeroesPanel,_super);function OSA3HeroesPanel(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var _this=_super.call(this)||this;_this.skinName="OSA3Heroes";return _this}OSA3HeroesPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.updateData()};OSA3HeroesPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.active,this.onTap);this.observe(ThreeHeroes.ins().postInfoChange,this.updateData);this.updateData()};OSA3HeroesPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.active,this.onTap);this.removeObserve()};OSA3HeroesPanel.prototype.onTap=function(e){if(e.currentTarget==this.active){if(ThreeHeroes.ins().awardState==ThreeHeroes.NotActive)ViewManager.ins().open(VipWin,[4]);else if(ThreeHeroes.ins().awardState==ThreeHeroes.CanGet)ThreeHeroes.ins().sendReward();else if(ThreeHeroes.ins().awardState==ThreeHeroes.Active)UserTips.ins().showTips(i18n("OSA3HeroesPanel_0")+(GlobalConfig.LoginActivateConfig.loginDays-ThreeHeroes.ins().loginDays)+i18n("OSA3HeroesPanel_1"))}};OSA3HeroesPanel.prototype.getTime=function(activityData){var openTime=GlobalConfig.GuildBattleConst.openServer;var date=new Date(activityData.startTime);var head=date.getMonth()+1+i18n("OSA3HeroesPanel_2")+date.getDate()+i18n("OSA3HeroesPanel_3");date=new Date(activityData.endTime-DateUtils.SECOND_PER_DAY*1e3);var end=date.getMonth()+1+i18n("OSA3HeroesPanel_4")+date.getDate()+i18n("OSA3HeroesPanel_5")+"23:59";return head+end};OSA3HeroesPanel.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor(activityData.startTime/1e3-GameServer.serverTime/1e3);var endedTime=Math.floor(activityData.endTime/1e3-GameServer.serverTime/1e3);if(beganTime>=0){this.actTime.text=i18n("OSA3HeroesPanel_6")}else if(endedTime<=0){this.actTime.text=i18n("OSA3HeroesPanel_7")}else{this.actTime.text=this.getTime(activityData)}var state=ThreeHeroes.ins().awardState;this.active.enabled=state!=ThreeHeroes.Geted;this.redPoint.visible=state==ThreeHeroes.CanGet;if(state==ThreeHeroes.NotActive){this.active.label=i18n("OSA3HeroesPanel_8")}else if(state==ThreeHeroes.CanGet||state==ThreeHeroes.Active){this.active.label=i18n("OSA3HeroesPanel_9")}else{this.active.label=i18n("OSA3HeroesPanel_10")}var config=GlobalConfig.ActivityBtnConfig[this.activityID];this.actInfo.text=config.acDesc;this.state.text=state==ThreeHeroes.Active?i18n("OSA3HeroesPanel_11")+(GlobalConfig.LoginActivateConfig.loginDays-ThreeHeroes.ins().loginDays)+i18n("OSA3HeroesPanel_12"):""};return OSA3HeroesPanel}(BaseView);__reflect(OSA3HeroesPanel.prototype,"OSA3HeroesPanel");var OSADailyRechargeRender=function(_super){__extends(OSADailyRechargeRender,_super);function OSADailyRechargeRender(){var _this=_super.call(this)||this;_this.skinName="OSADailyRechargeItem";return _this}OSADailyRechargeRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase;this.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};OSADailyRechargeRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var config=this.data;this.info.text=i18n("OSADailyRechargeRender_0",config.pay);this.reward.dataProvider=new eui.ArrayCollection(config.awardList.concat());var data=Recharge.ins().getRechargeData(0);if(data.curDayPay>=config.pay){var state=data.isAwards>>config.index&1;if(state){this.getBtn.label=i18n("OSADailyRechargeRender_1");this.getBtn.enabled=false}else{this.getBtn.label=i18n("OSADailyRechargeRender_2");this.getBtn.enabled=true}}else{this.getBtn.label=i18n("OSADailyRechargeRender_4");this.getBtn.enabled=false;this.special.visible=false}};OSADailyRechargeRender.prototype.onTap=function(e){var config=this.data;var data=Recharge.ins().getRechargeData(0);if(data.curDayPay<config.pay&&config.index==0){Recharge.ins().showReCharge(1002)}else{Recharge.ins().getDayReward(this.data.index)}};return OSADailyRechargeRender}(BaseItemRender);__reflect(OSADailyRechargeRender.prototype,"OSADailyRechargeRender");var OSARankTipsWin=function(_super){__extends(OSARankTipsWin,_super);function OSARankTipsWin(){var _this=_super.call(this)||this;_this.skinName="OSARankTipsSkin";return _this}OSARankTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};OSARankTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.bgClose,this.onClick);this.addTouchEndEvent(this.closeBtn,this.onClick);this.arr=param[0];this.rankType=param[1];this.rankTitle=param[2];this.record.itemRenderer=OSATargetItemRender4;this.init()};OSARankTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick);this.removeObserve()};OSARankTipsWin.prototype.init=function(){if(this.rankTitle!=null){this.title.text=this.rankTitle}else{switch(this.rankType){case RankDataType.TYPE_BAOSHI:this.title.text=i18n("OSARankTipsWin_0");break;case RankDataType.TYPE_LONGHUN:this.title.text=i18n("OSARankTipsWin_1");break;case RankDataType.TYPE_WING:this.title.text=i18n("OSARankTipsWin_2");break;case RankDataType.TYPE_BOOK:this.title.text=i18n("OSARankTipsWin_3");break;case RankDataType.TYPE_ZS:this.title.text=i18n("OSARankTipsWin_4");break;case RankDataType.TYPE_SCORE:this.title.text=i18n("OSARankTipsWin_5");break;case RankDataType.TYPE_XIAOFEI:this.title.text=i18n("OSARankTipsWin_6");break;case RankDataType.TYPE_HF_XIAOFEI:this.title.text=i18n("OSARankTipsWin_8");break;case RankDataType.TYPE_XIANYU:this.title.text=i18n("OSARankTipsWin_7");break}}this.record.dataProvider=new eui.ArrayCollection(this.arr)};OSARankTipsWin.prototype.onClick=function(){ViewManager.ins().close(this)};return OSARankTipsWin}(BaseEuiView);__reflect(OSARankTipsWin.prototype,"OSARankTipsWin");ViewManager.ins().reg(OSARankTipsWin,LayerManager.UI_Popup);var OSATarget0Panel=function(_super){__extends(OSATarget0Panel,_super);function OSATarget0Panel(){var _this=_super.call(this)||this;_this.type0PanelList=[];return _this}OSATarget0Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.initPanelList()};OSATarget0Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var id=this.activityID-1e4;this.initPanelList();this.cruPanel=this.type0PanelList[id+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget0Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget0Panel.prototype.initPanelList=function(){var aconfg=GlobalConfig.ActivityBtnConfig[this.activityID];var id=this.activityID-1e4;if(!this.type0PanelList[id+""]){var clsStr=OSATarget0Panel.targetIndex[aconfg.showType]||"OSATarget0Panel1";var Cls=egret.getDefinitionByName(clsStr);this.type0PanelList[id+""]=new Cls(this.activityID);this.type0PanelList[id+""].top=0;this.type0PanelList[id+""].bottom=0;this.type0PanelList[id+""].left=0;this.type0PanelList[id+""].right=0;this.type0PanelList[id+""].activityID=this.activityID}};OSATarget0Panel.prototype.updateData=function(){this.cruPanel.updateData()};OSATarget0Panel.targetIndex={1:"OSATarget0Panel1",2:"OSATarget0Panel2",3:"OSATarget0Panel3",4:"OSA3HeroesPanel",5:"HefuXunbaoPanel",6:"HefuAncientBossPanel",7:"HefuLCZBPanel",8:"OSATarget0Panel8",9:"OSATarget0Panel9",11:"OSATarget0Panel4"};return OSATarget0Panel}(ActivityPanel);__reflect(OSATarget0Panel.prototype,"OSATarget0Panel");var OSATarget0Panel1=function(_super){__extends(OSATarget0Panel1,_super);function OSATarget0Panel1(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var _this=_super.call(this)||this;_this.skinName="OSAComp";_this.effs=[];_this.rewards=[{type:1,id:900007,count:1},{type:1,id:900008,count:1},{type:1,id:900009,count:1},{type:0,id:2,count:2e4}];return _this}OSATarget0Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.updateData()};OSATarget0Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.go,this.onTap);this.updateData()};OSATarget0Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.go,this.onTap);this.removeObserve();for(var i=0;i<this.effs.length;i++){if(this.effs[i])DisplayUtils.removeFromParent(this.effs[i])}this.effs=[]};OSATarget0Panel1.prototype.onTap=function(e){var index;switch(e.currentTarget){case this.go:if(Guild.ins().guildID!=0){ViewManager.ins().close(ActivityWin);GuildWar.ins().requestWinGuildInfo();ViewManager.ins().close(GuildMap);ViewManager.ins().open(GuildWarMainWin)}else{UserTips.ins().showTips(i18n("OSATarget0Panel1_0"))}break}};OSATarget0Panel1.prototype.getTime=function(activityData){var openTime=GlobalConfig.GuildBattleConst.openServer;var date=new Date(activityData.startTime-DateUtils.SECOND_PER_DAY*1e3);date.setDate(date.getDate()+openTime.day);date.setHours(openTime.hours,openTime.min||0,0,0);var head=date.getMonth()+1+i18n("OSATarget0Panel1_1")+date.getDate()+i18n("OSATarget0Panel1_2")+openTime.hours+":"+openTime.min+"-";var end=openTime.hours+":"+(openTime.min+GlobalConfig.GuildBattleConst.continueTime/60);var week=date.getDay();var weeklist=[i18n("OSATarget0Panel1_3"),i18n("OSATarget0Panel1_4"),i18n("OSATarget0Panel1_5"),i18n("OSATarget0Panel1_6"),i18n("OSATarget0Panel1_7"),i18n("OSATarget0Panel1_8"),i18n("OSATarget0Panel1_9")];return head+end+weeklist[Number(week)]};OSATarget0Panel1.prototype.updateData=function(index){if(index===void 0){index=1}var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor(activityData.startTime/1e3-GameServer.serverTime/1e3);var endedTime=Math.floor(activityData.endTime/1e3-GameServer.serverTime/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget0Panel1_10");this.over.visible=false}else if(endedTime<=0){this.actTime.text=i18n("OSATarget0Panel1_11");this.over.visible=true}else{this.over.visible=false;this.actTime.text=this.getTime(activityData)}this.go.visible=!this.over.visible;for(var i=1;i<=4;i++){this["reward"+i].data=this.rewards[i-1]}for(var i=1;i<=3;i++){var effname="chuanqizbeff";if(!this.effs[i-1]||!this.effs[i-1].parent){var mc=new MovieClip;mc.x=this["reward"+i].width/2;mc.y=this["reward"+i].height/2;mc.y-=10;this.effs.push(mc)}}};return OSATarget0Panel1}(BaseView);__reflect(OSATarget0Panel1.prototype,"OSATarget0Panel1");var OSATarget0Panel2=function(_super){__extends(OSATarget0Panel2,_super);function OSATarget0Panel2(){var _this=_super.call(this)||this;_this.skinName="Days42Recharge";return _this}OSATarget0Panel2.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.content.useVirtualLayout=true;this.content.itemRenderer=OSATargetDays42ItemRender;this.bigReward.itemRenderer=OSATargetDays42ItemRender2};OSATarget0Panel2.prototype.open=function(){if(this.content.dataProvider){this.updateData()}else{this.updateList()}this.observe(Recharge.ins().postRechargeTotalDay,this.updateData)};OSATarget0Panel2.prototype.updateList=function(){var arr=[];var bigArr=[];var ybAward=new RewardData;ybAward.count=0;ybAward.id=2;ybAward.type=0;var byConfig={id:100,awardList:[ybAward]};bigArr.push(byConfig);var list=Recharge.ins().getRechargeList();for(var id in list){var conf=list[id];arr.push(conf);ybAward.id=conf.awardList[0].id;ybAward.type=conf.awardList[0].type;ybAward.count+=conf.awardList[0].count;if(conf.awardList.length>1){bigArr.push(conf)}}arr.sort(this.sort);bigArr.sort(this.sort2);this.content.dataProvider=new eui.ArrayCollection(arr.splice(0,4));this.delayUpdate(arr);this.bigReward.dataProvider=new eui.ArrayCollection(bigArr);var data=Activity.ins().getbtnInfo(this.activityID);this.actDesc.text=data.acDesc;this.channelSDKModify(data)};OSATarget0Panel2.prototype.delayUpdate=function(arr){var ac=this.content.dataProvider;ac.addItem(arr.shift());if(arr.length)this.delayUpdate(arr)};OSATarget0Panel2.prototype.sort=function(a,b){var hasGetDay=Recharge.ins().rechargeTotal.hasGetDays;if(hasGetDay.indexOf(a.id)>=0&&hasGetDay.indexOf(b.id)<0)return 1;else if(hasGetDay.indexOf(a.id)<0&&hasGetDay.indexOf(b.id)>=0)return-1;if(a.id<b.id)return-1;return 1};OSATarget0Panel2.prototype.sort2=function(a,b){if(a.id<b.id)return 1;return-1};OSATarget0Panel2.prototype.close=function(){this.removeObserve()};OSATarget0Panel2.prototype.updateData=function(){var datas=this.content.dataProvider;datas.source.sort(this.sort);for(var i=0;i<datas.length;i++){datas.itemUpdated(datas.getItemAt(i))}datas=this.bigReward.dataProvider;for(var i=0;i<datas.length;i++){datas.itemUpdated(datas.getItemAt(i))}};OSATarget0Panel2.prototype.channelSDKModify=function(data){if(ChannelMgr.ins().isAnQiGeChannel()){var finalDesc=data.acDesc.replace(i18n("OSATarget0Panel2_0"),i18n("OSATarget0Panel2_1"));this.actDesc.text=finalDesc}};__decorate([callLater],OSATarget0Panel2.prototype,"delayUpdate",null);return OSATarget0Panel2}(BaseView);__reflect(OSATarget0Panel2.prototype,"OSATarget0Panel2");var OSATarget0Panel3=function(_super){__extends(OSATarget0Panel3,_super);function OSATarget0Panel3(){var _this=_super.call(this)||this;_this._time=0;_this.skinName="OSADailyRechargeSkin";return _this}OSATarget0Panel3.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.dailyReward.itemRenderer=OSADailyRechargeRender};OSATarget0Panel3.prototype.open=function(){this.title.source=""+(GlobalConfig.ActivityBtnConfig[this.activityID].title||"");this.observe(Recharge.ins().postUpdateRechargeEx,this.updateList);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.initList()};OSATarget0Panel3.prototype.updateData=function(){this.updateList()};OSATarget0Panel3.prototype.updateList=function(){var dataPro=this.dailyReward.dataProvider;var source=dataPro.source;source.sort(this.sort);dataPro.refresh();this.updateTime();this.updateValue()};OSATarget0Panel3.prototype.updateTime=function(){var date=new Date(GameServer.serverTime);date.setHours(23,59,59,0);this._time=Math.floor((date.getTime()-GameServer.serverTime)/1e3);if(this._time<0)this._time=0;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);var data=Activity.ins().getbtnInfo(this.activityID);this.actDesc.text=data.acDesc};OSATarget0Panel3.prototype.initList=function(){var config=Recharge.ins().getCurRechargeConfig();var arr=[];for(var k in config){arr.push(config[k])}arr.sort(this.sort);this.dailyReward.dataProvider=new eui.ArrayCollection(arr);this.updateTime();this.updateValue()};OSATarget0Panel3.prototype.updateValue=function(){var data=Recharge.ins().getRechargeData(0);this.record.text=i18n("OSATarget0Panel3_0",data.curDayPay)};OSATarget0Panel3.prototype.sort=function(a,b){var data=Recharge.ins().getRechargeData(0);var aState=data.isAwards>>a.index&1;var bState=data.isAwards>>b.index&1;if(aState&&!bState){return 1}else if(!aState&&bState){return-1}else{return a.pay<b.pay?-1:1}};OSATarget0Panel3.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget0Panel3.prototype.close=function(){this.removeObserve();TimerManager.ins().removeAll(this)};return OSATarget0Panel3}(BaseView);__reflect(OSATarget0Panel3.prototype,"OSATarget0Panel3");var OSATarget0Panel4=function(_super){__extends(OSATarget0Panel4,_super);function OSATarget0Panel4(){var _this=_super.call(this)||this;_this.skinName="LoopRechargeSkin";return _this}OSATarget0Panel4.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget0Panel4.prototype.open=function(){this.setData();this.observe(Recharge.ins().postMuchDayRecReward,this.setData)};OSATarget0Panel4.prototype.close=function(){this.removeObserve()};OSATarget0Panel4.prototype.setData=function(){var confing=GlobalConfig.MultiDayRechargeConfig;var awardIndex=0;for(var i in confing[1].awardList){if(awardIndex<=GameServer.serverOpenDay&&GameServer.serverOpenDay<parseInt(i)){break}awardIndex=parseInt(i)}var index=0;var dayNum=Recharge.ins().mDayNum;if(Recharge.ins().mRecNum>=confing[dayNum].num){dayNum=Recharge.ins().mDayNum}else{dayNum=Recharge.ins().mDayNum-1}for(var i in confing){var conf=confing[i];this["reward"+index].itemRenderer=ItemBase;this["reward"+index].dataProvider=new eui.ArrayCollection(conf.awardList[awardIndex]);var str=StringUtils.addColor("（"+(dayNum>index+1?i:dayNum)+"/"+i+"）",dayNum>=parseInt(i)?65280:16750848);this["target"+index].textFlow=(new egret.HtmlTextParser).parser(i18n("OSATarget0Panel4_1",i,str,conf.num));this["redPoint"+index].visible=false;if(Recharge.ins().mDayNum>parseInt(i)){this["get"+index].label=i18n("OSATarget0Panel4_2");this["get"+index].enabled=false}else if(Recharge.ins().mDayNum==parseInt(i)&&Recharge.ins().mRecNum>=conf.num&&Recharge.ins().mReward==0){this["redPoint"+index].visible=true;this["get"+index].label=i18n("OSATarget0Panel4_3");this["get"+index].enabled=true;var self_4=this;this.addTouchEvent(this["get"+index],this.onTap.bind(this,this["get"+index]))}else{this["get"+index].enabled=false}index++}this.todayRecharge.text=i18n("OSATarget0Panel4_4",Recharge.ins().mRecNum);var data=Activity.ins().getbtnInfo(this.activityID);this.actInfo0.text=data.acDesc};OSATarget0Panel4.prototype.onTap=function(get){Recharge.ins().sendMuchDayRecReward();get.label=i18n("OSATarget0Panel4_5");this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};return OSATarget0Panel4}(BaseView);__reflect(OSATarget0Panel4.prototype,"OSATarget0Panel4");var OSATarget0Panel8=function(_super){__extends(OSATarget0Panel8,_super);function OSATarget0Panel8(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var _this=_super.call(this)||this;_this._time=0;_this.skinName="HeFuResetRechargeSkin";return _this}OSATarget0Panel8.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.updateData()};OSATarget0Panel8.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.pay0,this.onTap);this.updateData();TimerManager.ins().doTimer(1e3,0,this.setTime,this)};OSATarget0Panel8.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget0Panel8.prototype.onTap=function(e){switch(e.currentTarget){case this.pay0:Recharge.ins().tryShowChargeFirstWin();break}};OSATarget0Panel8.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor(activityData.startTime/1e3-GameServer.serverTime/1e3);var endedTime=Math.floor(activityData.endTime/1e3-GameServer.serverTime/1e3);if(beganTime>=0){this.actTime1.text=i18n("OSATarget0Panel8_0")}else if(endedTime<=0){this.actTime1.text=i18n("OSATarget0Panel8_1")}else{this.actTime1.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}var btncfg=GlobalConfig.ActivityBtnConfig[this.activityID];this.title.source=btncfg.title;this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(btncfg.acDesc)};OSATarget0Panel8.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};return OSATarget0Panel8}(BaseView);__reflect(OSATarget0Panel8.prototype,"OSATarget0Panel8");var OSATarget0Panel9=function(_super){__extends(OSATarget0Panel9,_super);function OSATarget0Panel9(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var _this=_super.call(this)||this;_this._time=0;_this._angles=[0,0,0,0,0,0,0];_this._circleCenter={x:168,y:120};_this._a=155;_this._b=80;_this._angle=.1;return _this}OSATarget0Panel9.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget0Panel9.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityBtnConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="XNWingUpSkin"};OSATarget0Panel9.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();this.addTouchEvent(this.pay0,this.onTap);this.updateData();TimerManager.ins().doTimer(1e3,0,this.setTime,this)};OSATarget0Panel9.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();TimerManager.ins().removeAll(this);this.resetBalls()};OSATarget0Panel9.prototype.onTap=function(e){switch(e.currentTarget){case this.pay0:var aCon=GlobalConfig.ActivityBtnConfig[this.activityID];if(!aCon.jump)return;switch(aCon.jump[0]){case StatePageSysType.WING:if(Actor.level<GlobalConfig.WingCommonConfig.openLevel){UserTips.ins().showTips(i18n("OSATarget0Panel9_0")+GlobalConfig.WingCommonConfig.openLevel+i18n("OSATarget0Panel9_1"));return}ViewManager.ins().open(aCon.jump[1],aCon.jump[2],0);break;case StatePageSysType.RING:if(!LyMark.ins().checkOpen()){UserTips.ins().showTips(i18n("OSATarget0Panel9_2",GlobalConfig.FlameStamp.openLevel));return}ViewManager.ins().open(aCon.jump[1],aCon.jump[2]);break;default:ViewManager.ins().open(aCon.jump[1],aCon.jump[2])}break}};OSATarget0Panel9.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor(activityData.startTime/1e3-GameServer.serverTime/1e3);var endedTime=Math.floor(activityData.endTime/1e3-GameServer.serverTime/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget0Panel9_3")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget0Panel9_4")}else{this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}var btncfg=GlobalConfig.ActivityBtnConfig[this.activityID];this.title.source=btncfg.title;this.actInfo.textFlow=TextFlowMaker.generateTextFlow1(btncfg.acDesc);var aCon=GlobalConfig.ActivityBtnConfig[this.activityID];switch(aCon.jump[0]){case StatePageSysType.RING:this.updateBalls();this.redPoint.visible=false;if(LyMark.ins().checkOpen()){if(!LyMark.ins().isMax){var cfg=GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv];var itemData=UserBag.ins().getBagItemById(cfg.costItem);var count=itemData?itemData.count:0;this.redPoint.visible=count>=cfg.costCount}}break}};OSATarget0Panel9.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget0Panel9.prototype.updateBalls=function(){if(!this.img||!this.img.parent)return;var bollNum=7;if(bollNum){this.resetBalls();if(!this._balls){this._balls=[];TimerManager.ins().doTimer(17*3,0,this.doCircle,this)}this._circleCenter.x=this.img.width/2;this._circleCenter.y=this.img.height/2+25;var ball=void 0;var radian=2*Math.PI/bollNum;for(var i=0;i<bollNum;i++){ball=ObjectPool.pop("MovieClip");this.img.parent.addChild(ball);this._angles[i]=radian*i;ball.x=this._a*Math.cos(radian*i)+this._circleCenter.x;ball.y=this._b*Math.sin(radian*i)+this._circleCenter.y;this._balls.push(ball);ball.playFile(RES_DIR_EFF+"lymarkeff",-1)}}};OSATarget0Panel9.prototype.doCircle=function(){if(!this._balls){TimerManager.ins().removeAll(this);return}if(!this.img||!this.img.parent)return;var len=this._balls.length,ball;var parent;var imgIndex=0,selfIndex=0;for(var i=0;i<len;i++){ball=this._balls[i];ball.x=this._a*Math.cos(this._angles[i])+this._circleCenter.x;ball.y=this._b*Math.sin(this._angles[i])+this._circleCenter.y;this._angles[i]+=this._angle;this._angles[i]=this._angles[i]%(2*Math.PI);parent=ball.parent;imgIndex=parent.getChildIndex(this.img);selfIndex=parent.getChildIndex(ball);if(this._angles[i]>=2.5&&this._angles[i]<=6){if(selfIndex>imgIndex)parent.addChildAt(ball,3)}else{if(selfIndex<imgIndex)parent.addChildAt(ball,parent.numChildren)}}};OSATarget0Panel9.prototype.resetBalls=function(){TimerManager.ins().removeAll(this);if(this._balls){var len=this._balls.length;for(var i=0;i<len;i++){this._balls[i].destroy();this._balls[i]=null}this._balls.length=0;this._balls=null}};return OSATarget0Panel9}(BaseView);__reflect(OSATarget0Panel9.prototype,"OSATarget0Panel9");var OSATarget10Panel=function(_super){__extends(OSATarget10Panel,_super);function OSATarget10Panel(){return _super.call(this)||this}OSATarget10Panel.prototype.childrenCreated=function(){if(!this.skinName)this.skinName="YbTurntableSkin"};OSATarget10Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();egret.Tween.removeTweens(this.tttzhi);var data=Activity.ins().activityData[this.activityID];if(data&&data.state)Activity.ins().sendReward(this.activityID,this.level);this.rolling=false;this.isClick=false;TimerManager.ins().removeAll(this)};OSATarget10Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!this.skinName)this.skinName="YbTurntableSkin";this.observe(Activity.ins().postChangePage,this.resultCallBack);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.addTouchEvent(this.choujiangBtn,this.getLottery);this.list.itemRenderer=NoticeYBListRenderer;this.updateView()};OSATarget10Panel.prototype.updateView=function(){var data=Activity.ins().activityData[this.activityID];if(!data)return;var config=GlobalConfig.ActivityType10Config[this.activityID];this.level=data.getLevel();var lv=this.level;var finish=false;if(!this.level){lv=Object.keys(config).length;finish=true}this.img_level.source="trun_10000"+lv;var cfg=config[lv];for(var i=0;i<cfg.info.length;i++){this["multiple"+i].text=cfg.info[i].multiple+i18n("OSATarget10Panel_0")}this.pay0.text=cfg.yuanBao+"";var color=65280;var reyb=0;if(data.yb<cfg.recharge){color=16711680;reyb=cfg.recharge-data.yb}if(finish)this.label_needCharge.text=i18n("OSATarget10Panel_1");else this.label_needCharge.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget10Panel_2",color,reyb));this.listRefush();this.setTime();var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg)this.title.source=btnCfg.title};OSATarget10Panel.prototype.resultCallBack=function(id){if(!this.isClick)return;var data=Activity.ins().activityData[this.activityID];if(this.activityID!=id)return;if(data&&data.state)this.beginLottery(data.index);this.updateView();this.listRefush()};OSATarget10Panel.prototype.beginLottery=function(index){var _this=this;var rotat=360*4+(index-1)*36;var tween=egret.Tween.get(this.tttzhi);this.rolling=true;tween.to({rotation:rotat},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(_this.activityID,_this.level);_this.flyItemEx(_this["multiple"+(index-1)]);setTimeout(function(){_this.rolling=false;_this.isClick=false},2e3)},this)};OSATarget10Panel.prototype.flyItemEx=function(itemicon){var flyItem=new eui.Image(RewardData.getCurrencyRes(2));flyItem.x=itemicon.x;flyItem.y=itemicon.y;flyItem.scaleX=1;flyItem.scaleY=1;itemicon.parent.addChild(flyItem);GameLogic.ins().postFlyItemEx(flyItem)};OSATarget10Panel.prototype.getLottery=function(){if(!this.level){UserTips.ins().showTips(i18n("OSATarget10Panel_3"));this.isClick=false;return}var data=Activity.ins().activityData[this.activityID];var cfg=GlobalConfig.ActivityType10Config[this.activityID][this.level];if(data&&!data.getCondition(this.level)){UserTips.ins().showTips(i18n("OSATarget10Panel_4",cfg.recharge-data.yb));this.isClick=false;return}if(this.rolling){UserTips.ins().showTips(i18n("OSATarget10Panel_5"));return}if(this.isClick){UserTips.ins().showTips(i18n("OSATarget10Panel_6"));return}if(Activity.ins().getRollSum(this.activityID)||Actor.yb>=cfg.yuanBao){this.isClick=true;Activity.ins().sendReward(this.activityID,this.level)}else{this.isClick=false;if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget10Panel_7"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget10Panel_8"))}};OSATarget10Panel.prototype.listRefush=function(){var data=Activity.ins().activityData[this.activityID];if(data){if(!this.list.dataProvider){this.list.dataProvider=new eui.ArrayCollection}var dataPro=this.list.dataProvider;var arr=[];for(var i=0;i<data.noticeArr.length;i++){var notice={activityID:this.activityID,name:data.noticeArr[i].name,multiple:data.noticeArr[i].multiple,yb:data.noticeArr[i].yb};arr.push(notice)}dataPro.replaceAll(arr)}};OSATarget10Panel.prototype.setTime=function(){var data=Activity.ins().activityData[this.activityID];if(data)this.actTime.text=i18n("OSATarget10Panel_9")+data.getRemainTime()};return OSATarget10Panel}(ActivityPanel);__reflect(OSATarget10Panel.prototype,"OSATarget10Panel");var OSATarget11Panel=function(_super){__extends(OSATarget11Panel,_super);function OSATarget11Panel(){var _this=_super.call(this)||this;_this.type2PanelList=[];return _this}OSATarget11Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var config=GlobalConfig.ActivityType11_1Config[this.activityID];if(!this.type2PanelList[this.activityID]){var panel=ObjectPool.pop("OSATarget11Panel"+config[1].showType,[this.activityID]);panel.top=0;panel.bottom=0;panel.left=0;panel.right=0;panel.activityID=this.activityID;this.type2PanelList[this.activityID+""]=panel}this.cruPanel=this.type2PanelList[this.activityID+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget11Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget11Panel.prototype.updateData=function(){this.cruPanel.updateData()};return OSATarget11Panel}(ActivityPanel);__reflect(OSATarget11Panel.prototype,"OSATarget11Panel");var OSATarget11Panel1=function(_super){__extends(OSATarget11Panel1,_super);function OSATarget11Panel1(id){var _this=_super.call(this)||this;_this.activityID=id;_this.setCurSkin();return _this}OSATarget11Panel1.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="NYHighSkin"};OSATarget11Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rewardList.itemRenderer=HighRewardItemRender;this.projectList.itemRenderer=HighProjectItemRender};OSATarget11Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();var aCon=GlobalConfig.ActivityConfig[this.activityID];this.actInfo1.text=aCon.desc;this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateData()};OSATarget11Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget11Panel1.prototype.updateData=function(){var data=Activity.ins().activityData[this.activityID];if(!data)return;var len=Object.keys(GlobalConfig.ActivityType11_1Config[this.activityID]).length;var state=0;var list=[];list.length=len;var config;var i;for(i=1;i<=len;i++){config=GlobalConfig.ActivityType11_1Config[this.activityID][i];if(data.rewardInfo>>i&1)state=2;else if(data.hiScore>=config.score)state=1;else state=0;list[i-1]={activityID:this.activityID,index:i,state:state,config:config}}if(!this._rewardCollect){this._rewardCollect=new ArrayCollection;this.rewardList.dataProvider=this._rewardCollect}this._rewardCollect.source=list;len=Object.keys(GlobalConfig.ActivityType11_2Config[this.activityID]).length;var config2;list=[];list.length=len;var total=0;for(i=0;i<len;i++){var info=data.achieveInfo[i];config2=GlobalConfig.ActivityType11_2Config[this.activityID][i+1];list[i]={config:config2,times:info.times};var cur=Math.floor(info.times/config2.target);var max=Math.floor(config2.dayLimit/config2.target);if(cur>max)cur=max;total+=config2.score*cur}if(!this._achieveCollect){this._achieveCollect=new ArrayCollection;this.projectList.dataProvider=this._achieveCollect}this._achieveCollect.source=list;this.totalScore.text=i18n("OSATarget11Panel1_0")+total;this.setTime()};OSATarget11Panel1.prototype.setTime=function(){var data=Activity.ins().activityData[this.activityID];if(data)this.actTime1.text=data.getRemainTime()};return OSATarget11Panel1}(BaseView);__reflect(OSATarget11Panel1.prototype,"OSATarget11Panel1");var OSATarget11Panel3=function(_super){__extends(OSATarget11Panel3,_super);function OSATarget11Panel3(id){var _this=_super.call(this)||this;_this._curDayIndex=0;_this.activityID=id;_this.setCurSkin();return _this}OSATarget11Panel3.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.tabD.itemRenderer=FDtabBtnItemRender;this.list.itemRenderer=FDProjectItemRender;this.rewardlist.itemRenderer=FDrewardItemRender};OSATarget11Panel3.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();this._curDayIndex=0;this.setAct22ID();this.updateView();this.tabD.selectedIndex=this._curDayIndex;this.updateData();this.addTouchEvent(this,this.onTouch);this.observe(Activity.ins().postActivityIsGetAwards,this.refreshReds);this.addChangeEvent(this.tabD,this.onClickBtn);TimerManager.ins().doTimer(1e3,0,this.setTime,this);if(this.osa22Panel2){this.osa22Panel2.close();DisplayUtils.removeFromParent(this.osa22Panel2)}};OSATarget11Panel3.prototype.setAct22ID=function(){this.activity22ID=0;for(var k in Activity.ins().activityData){var ac=Activity.ins().activityData[k];if(!ac)continue;if(ac.pageStyle==ActivityPageStyle.VERSIONCELE&&ac.type==ActivityDataFactory.ACTIVITY_TYPE_22&&Activity.ins().getActivityDataById(+k).isOpenActivity()&&!Activity.ins().getActivityDataById(+k).getHide()){this.activity22ID=ac.id;return}}};OSATarget11Panel3.prototype.close=function(){this._btnCollect=null;this._listCollect=null};OSATarget11Panel3.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="fiveDaySkin";if(this.actDesc)this.actDesc.text=aCon.desc};OSATarget11Panel3.prototype.updateView=function(){var data=Activity.ins().getActivityDataById(this.activityID);this._items=[];var confs=GlobalConfig.ActivityType11_2Config[this.activityID];var conf;var btnArr=[];var groups;var group;var achieve;for(var k in confs){conf=confs[k];group=conf.group;groups=this._items[group-1];if(!groups){groups=[];this._items[group-1]=groups;btnArr.push({gName:conf.gName,showRed:false})}achieve=data.achieveInfo[conf.index-1];if(!achieve.isGot&&achieve.times>=conf.dayLimit)btnArr[group-1].showRed=true;groups.push(conf)}if(!this._btnCollect){this._btnCollect=new ArrayCollection;this.tabD.dataProvider=this._btnCollect}this._btnCollect.source=btnArr;this.tabD.validateNow();var data2=Activity.ins().activityData[this.activity22ID];this.redPointImg.visible=ActivityType11Data.FIRST_OPEN_SHOP||data2.refreshFree};OSATarget11Panel3.prototype.refreshReds=function(){this.updateView();this.updateData()};OSATarget11Panel3.prototype.updateData=function(){var items=this._items[this._curDayIndex];if(!items||!items.length)return;if(!this._listCollect){this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect}var len=items.length;var conf;var datas=[];var state=0;var achieve;var activityData=Activity.ins().getActivityDataById(this.activityID);for(var i_11=0;i_11<len;i_11++){conf=items[i_11];achieve=activityData.achieveInfo[conf.index-1];if(achieve.isGot)state=2;else if(achieve.times>=conf.dayLimit)state=1;else state=0;datas[i_11]={activityID:this.activityID,conf:conf,state:state,times:achieve.times}}datas.sort(this.sort);this._listCollect.source=datas;len=Object.keys(GlobalConfig.ActivityType11_1Config[this.activityID]).length;var list=[];list.length=len;var config;var i;for(i=1;i<=len;i++){config=GlobalConfig.ActivityType11_1Config[this.activityID][i];if(activityData.rewardInfo>>i&1)state=2;else if(activityData.hiScore>=config.score)state=1;else state=0;list[i-1]={activityID:this.activityID,index:i,state:state,config:config}}if(!this._rewardCollect){this._rewardCollect=new ArrayCollection;this.rewardlist.dataProvider=this._rewardCollect}this._rewardCollect.source=list;this.totalScore.text=activityData.hiScore+""};OSATarget11Panel3.prototype.sort=function(a,b){if(a.state==1&&b.state!=1)return-1;if(a.state!=1&&b.state==1)return 1;if(a.state==2&&b.state!=2)return 1;if(a.conf.index<b.conf.index)return-1;if(a.conf.index>b.conf.index)return 1;return 0};OSATarget11Panel3.prototype.onTouch=function(e){switch(e.target){case this.shopBtn:if(!this.osa22Panel2){this.osa22Panel2=ObjectPool.pop("OSATarget22Panel2",[this.activity22ID]);this.osa22Panel2.top=0;this.osa22Panel2.bottom=0;this.osa22Panel2.left=0;this.osa22Panel2.right=0}this.osa22Panel2.activityID=this.activity22ID;this.parent.addChild(this.osa22Panel2);this.osa22Panel2.open();this.close();DisplayUtils.removeFromParent(this);ActivityType11Data.FIRST_OPEN_SHOP=false;Activity.ins().postActivityIsGetAwards();break}};OSATarget11Panel3.prototype.onClickBtn=function(e){if(this._curDayIndex==e.currentTarget.selectedIndex)return;this._curDayIndex=e.currentTarget.selectedIndex;this.updateData()};OSATarget11Panel3.prototype.setTime=function(){var data=Activity.ins().activityData[this.activityID];if(data)this.actTime.text=data.getRemainTime();var data2=Activity.ins().activityData[this.activity22ID];if(data2){var time=data2.getRefreshTime();this.refreshTime.text=DateUtils.getFormatBySecond(time>0?time:0,DateUtils.TIME_FORMAT_1,5)+i18n("OSATarget11Panel3_0")}else this.refreshTime.text=i18n("OSATarget11Panel3_1")};return OSATarget11Panel3}(BaseView);__reflect(OSATarget11Panel3.prototype,"OSATarget11Panel3");var OSATarget12Panel=function(_super){__extends(OSATarget12Panel,_super);function OSATarget12Panel(){var _this=_super.call(this)||this;_this.type2PanelList=[];return _this}OSATarget12Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget12Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var config=GlobalConfig.ActivityType12Config[this.activityID];if(!this.type2PanelList[this.activityID+""]){var panel=ObjectPool.pop("OSATarget12Panel"+config[1].showType);panel.top=0;panel.bottom=0;panel.left=0;panel.right=0;panel.activityID=this.activityID;panel.activityType=this.activityType;this.type2PanelList[this.activityID+""]=panel}this.cruPanel=this.type2PanelList[this.activityID+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget12Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget12Panel.prototype.updateData=function(){this.cruPanel.updateData()};return OSATarget12Panel}(ActivityPanel);__reflect(OSATarget12Panel.prototype,"OSATarget12Panel");var OSATarget12Panel1=function(_super){__extends(OSATarget12Panel1,_super);function OSATarget12Panel1(){var _this=_super.call(this)||this;_this._time=0;return _this}OSATarget12Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget12Panel1.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="XNHongBaoSkin"};Object.defineProperty(OSATarget12Panel1.prototype,"activityID",{get:function(){return this._activityID},set:function(value){this._activityID=value;this.setCurSkin()},enumerable:true,configurable:true});OSATarget12Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this);this.removeObserve()};OSATarget12Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postChangePage,this.updateLogs);this.addTouchEvent(this.onbtn,this.onTap);this.addTouchEvent(this.leftBtn,this.onTap);this.addTouchEvent(this.rightBtn,this.onTap);TimerManager.ins().doTimer(1e3,0,this.setTime,this);if(!this.dataArr){this.list.itemRenderer=XiaoNianListRenderer;this.dataArr=new eui.ArrayCollection;this.list.dataProvider=this.dataArr}this.index=this.getRuleIndex();this.updateData();this.updateLogs()};OSATarget12Panel1.prototype.getRuleIndex=function(){var index=1;var activityData=Activity.ins().getActivityDataById(this.activityID);for(var k in GlobalConfig.ActivityType12Config[this.activityID]){if(activityData.score>=GlobalConfig.ActivityType12Config[this.activityID][k].score){index=GlobalConfig.ActivityType12Config[this.activityID][k].index}}return index};OSATarget12Panel1.prototype.GetCallBack=function(activityID){if(activityID!=this.activityID)return;this.updateData()};OSATarget12Panel1.prototype.onTap=function(e){switch(e.currentTarget){case this.onbtn:var activityData=Activity.ins().getActivityDataById(this.activityID);if(!activityData.isOpenActivity()){UserTips.ins().showTips(i18n("OSATarget12Panel1_0"));return}var config=GlobalConfig.ActivityType12Config[this.activityID];if(config&&config[this.index]){if(activityData.score>=config[this.index].score)ViewManager.ins().open(HongBaoSpeak,this.activityID,this.index);else UserTips.ins().showTips(i18n("OSATarget12Panel1_1"))}break;case this.leftBtn:if(this.index<=1)return;this.index--;this.updateBtn();break;case this.rightBtn:if(this.index>=CommonUtils.getObjectLength(GlobalConfig.ActivityType12Config[this.activityID]))return;this.index++;this.updateBtn();break}};OSATarget12Panel1.prototype.updateBtn=function(){if(this.index==1){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.index==CommonUtils.getObjectLength(GlobalConfig.ActivityType12Config[this.activityID])){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=this.rightBtn.visible=true}var config=GlobalConfig.ActivityType12Config[this.activityID][this.index];this.hongbao.data=config.skinType;var activityData=Activity.ins().getActivityDataById(this.activityID);this.redPoint.visible=activityData.score>=config.score};OSATarget12Panel1.prototype.updateLogs=function(){var arr=[];var activityData=Activity.ins().getActivityDataById(this.activityID);this.actPoint.text=activityData.score+"";for(var i=activityData.logs.length-1;i>=0;i--){var config=GlobalConfig.ActivityType12Config[this.activityID][activityData.logs[i].index];var roleName="s"+activityData.logs[i].serverId+"."+activityData.logs[i].name;var str=StringUtils.replace(config.record,roleName);arr.push(str)}this.dataArr.replaceAll(arr)};OSATarget12Panel1.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var actcfg=GlobalConfig.ActivityConfig[this.activityID];var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget12Panel1_2")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget12Panel1_3")}else{this._time=endedTime;if(this._time<0)this._time=0;this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.actInfo.text=actcfg.desc;this.updateBtn()};OSATarget12Panel1.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};return OSATarget12Panel1}(BaseView);__reflect(OSATarget12Panel1.prototype,"OSATarget12Panel1");var OSATarget17Panel=function(_super){__extends(OSATarget17Panel,_super);function OSATarget17Panel(){return _super.call(this)||this}OSATarget17Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.panelList=[]};OSATarget17Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.observe(Activity.ins().postChangePage,this.updateData);this.observe(Activity.ins().postRewardResult,this.updateData);this.showPanel()};OSATarget17Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();if(this.curPanel)this.curPanel.close()};OSATarget17Panel.prototype.showPanel=function(type){if(type===void 0){type=1}if(!this.panelList[type]){var Cls=egret.getDefinitionByName("OSATarget17Panel"+type);this.panelList[type]=new Cls;this.panelList[type].top=0;this.panelList[type].bottom=0;this.panelList[type].left=0;this.panelList[type].right=0;this.panelList[type].activityID=this.activityID;this.panelList[type].showPanel=this.showPanel.bind(this)}if(this.curPanel){this.curPanel.close();DisplayUtils.removeFromParent(this.curPanel)}this.curPanel=this.panelList[type];this.curPanel.open();this.addChild(this.curPanel)};OSATarget17Panel.prototype.updateData=function(){this.curPanel&&this.curPanel.updateData()};return OSATarget17Panel}(ActivityPanel);__reflect(OSATarget17Panel.prototype,"OSATarget17Panel");var OSATarget17Panel1=function(_super){__extends(OSATarget17Panel1,_super);function OSATarget17Panel1(){var _this=_super.call(this)||this;_this.skinName="luckyStarSkin";return _this}OSATarget17Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();this.$onClose();TimerManager.ins().removeAll(this)};OSATarget17Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.luckyzp,this.gotoLuckTurn);this.addTouchEvent(this.help,this.openHelp);this.updateData();this.refRedpoint()};OSATarget17Panel1.prototype.updateData=function(){var data=Activity.ins().activityData[this.activityID];if(!data)return;var config1=GlobalConfig.ActivityType17_1Config[this.activityID];this.inte.text=data.score+"";this.recharge.text=data.curRecharge+"";this.endtime.text=data.overDay+i18n("OSATarget17Panel1_0");var addScore=0;for(var n in data.actStar){addScore+=data.actStar[n]*config1[n].score;for(var i=1;i<=config1[n].star;i++){var indexStr=i<10?"0"+i:i+"";if(i<=data.actStar[n]){this["star"+(parseInt(n)-1)+indexStr].source="star"+(parseInt(n)+3)}else this["star"+(parseInt(n)-1)+indexStr].source="star1"}}var totalScore=0;for(var key in config1){totalScore+=config1[key].score*config1[key].star}this.accinte.text=addScore+"/"+totalScore};OSATarget17Panel1.prototype.gotoLuckTurn=function(){if(this.showPanel)this.showPanel(2)};OSATarget17Panel1.prototype.openHelp=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[26].text)};OSATarget17Panel1.prototype.refRedpoint=function(){var data=Activity.ins().activityData[this.activityID];if(data)this.redPoint.visible=data.checkRedPoint()};return OSATarget17Panel1}(ActivityPanel);__reflect(OSATarget17Panel1.prototype,"OSATarget17Panel1");var OSATarget17Panel2=function(_super){__extends(OSATarget17Panel2,_super);function OSATarget17Panel2(){var _this=_super.call(this)||this;_this.skinName="luckyTurntableSkin2";return _this}OSATarget17Panel2.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();egret.Tween.removeTweens(this.tttzhi);TimerManager.ins().removeAll(this);this.rolling=false;this.isClick=false};OSATarget17Panel2.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postRewardResult,this.resultCallBack);this.addTouchEvent(this.choujiangBtn,this.startLottery);this.addTouchEvent(this.back,this.gotoHome);this.list.itemRenderer=NoticeListRenderer;this.updateView();this.updateData()};OSATarget17Panel2.prototype.updateView=function(){var data=Activity.ins().activityData[this.activityID];var config2=GlobalConfig.ActivityType17_2Config[this.activityID];var config3=GlobalConfig.ActivityType17_3Config[this.activityID];var showAwards=config3[CommonUtils.getObjectLength(config3)].group;var max=showAwards.length;for(var i=0;i<max;i++){this["item"+i].itemIcon.data=showAwards[i];this["item"+i].rewardState(data.recrod>>i+1&1)}this.listRefush();var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg)this.title.source=btnCfg.title};OSATarget17Panel2.prototype.updateData=function(){var data=Activity.ins().activityData[this.activityID];this.inte.text=i18n("OSATarget17Panel2_1",data.score)};OSATarget17Panel2.prototype.resultCallBack=function(id){if(!Activity.ins().isSuccee)return;if(!this.isClick)return;if(this.activityID!=id)return;var data=Activity.ins().activityData[this.activityID];var index=data.awardIndex;if(index)this.beginLottery(index);this.updateView();this.listRefush()};OSATarget17Panel2.prototype.beginLottery=function(index){var _this=this;var rotat=360*4+(index-1)*(360/12);var tween=egret.Tween.get(this.tttzhi);this.rolling=true;tween.to({rotation:rotat},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(_this.activityID,0);Activity.ins().isSuccee=false;_this.flyItemEx(_this["item"+(index-1)]);setTimeout(function(){_this.rolling=false;_this.isClick=false},2e3)},this)};OSATarget17Panel2.prototype.flyItemEx=function(itemicon){var flyItem=new eui.Image(itemicon.itemIcon.getItemSoure());flyItem.x=itemicon.x;flyItem.y=itemicon.y;flyItem.scaleX=1;flyItem.scaleY=1;itemicon.parent.addChild(flyItem);GameLogic.ins().postFlyItemEx(flyItem)};OSATarget17Panel2.prototype.startLottery=function(){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}var data=Activity.ins().activityData[this.activityID];var cfg2=GlobalConfig.ActivityType17_2Config[this.activityID];if(this.rolling){UserTips.ins().showTips(i18n("OSATarget17Panel2_2"));return}if(this.isClick){UserTips.ins().showTips(i18n("OSATarget17Panel2_3"));return}if(Activity.ins().getRollSum(this.activityID)||data.score>=cfg2.score){this.isClick=true;Activity.ins().sendReward(this.activityID,1)}else{UserTips.ins().showTips(i18n("OSATarget17Panel2_4"));this.isClick=false}};OSATarget17Panel2.prototype.listRefush=function(){var data=Activity.ins().activityData[this.activityID];if(data){var arr=[];for(var i=0;i<data.noticeArr.length;i++){var notice={activityID:this.activityID,activityType:ActivityDataFactory.ACTIVITY_TYPE_17,name:data.noticeArr[i].name,index:data.noticeArr[i].index};arr.push(notice)}this.list.dataProvider=new eui.ArrayCollection(arr)}};OSATarget17Panel2.prototype.gotoHome=function(){if(this.showPanel)this.showPanel(1)};return OSATarget17Panel2}(ActivityPanel);__reflect(OSATarget17Panel2.prototype,"OSATarget17Panel2");var OSATarget18Panel=function(_super){__extends(OSATarget18Panel,_super);function OSATarget18Panel(){var _this=_super.call(this)||this;_this.typePanelList=[];return _this}OSATarget18Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.observe(Activity.ins().postRewardResult,this.updateData);if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var config=GlobalConfig.ActivityType18Config[this.activityID];if(!this.typePanelList[this.activityID]){var showType=config[0].showType||1;var panel=ObjectPool.pop("OSATarget18Panel"+showType,[this.activityID]);panel.top=0;panel.bottom=0;panel.left=0;panel.right=0;panel.activityID=this.activityID;this.typePanelList[this.activityID+""]=panel}this.cruPanel=this.typePanelList[this.activityID+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget18Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget18Panel.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData()};return OSATarget18Panel}(ActivityPanel);__reflect(OSATarget18Panel.prototype,"OSATarget18Panel");var OSATarget18Panel1=function(_super){__extends(OSATarget18Panel1,_super);function OSATarget18Panel1(id){var _this=_super.call(this)||this;_this.addBoxEvent=false;_this.huntType=1;_this.activityID=id;_this.setCurSkin();return _this}OSATarget18Panel1.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="CETreasureSkin"};OSATarget18Panel1.prototype.childrenCreated=function(){this.init()};OSATarget18Panel1.prototype.init=function(){var configs=GlobalConfig.ActivityType18Config[this.activityID];var config=configs[0];var len=config.showDrop.length;var gift;for(var i=0;i<len&&i<16;i++){gift=this["gift"+i];gift.data=config.showDrop[i];if(i<=1)gift.setItemHeirloomBgImg(true,"csbk03")}this.list.itemRenderer=HuntListRenderer;this.jpList.itemRenderer=HuntListRenderer;for(var k in configs){if(configs[k].count==1)this.yb1.text=configs[k].yb+"";else if(configs[k].count==10)this.yb10.text=configs[k].yb+""}};OSATarget18Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();this.addTouchEvent(this.buy1,this.onBuy);this.addTouchEvent(this.buy10,this.onBuy);this.observe(Activity.ins().postChangePage,this.updateData);var data=Activity.ins().getActivityDataById(this.activityID);this.endedTime=data.getLeftTime();this.timeClock();TimerManager.ins().remove(this.timeClock,this);TimerManager.ins().doTimer(1e3,0,this.timeClock,this);this.addBoxEvent=true;Activity.ins().sendChangePage(this.activityID)};OSATarget18Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buy1,this.onBuy);this.removeTouchEvent(this.buy10,this.onBuy);this.removeObserve();TimerManager.ins().remove(this.timeClock,this);this.addBoxEvent=false};OSATarget18Panel1.prototype.updateData=function(){this.listRefush();this.updateBox();this.updateMaterial()};OSATarget18Panel1.prototype.timeClock=function(){if(this.endedTime>=0)this.leftTimeTxt.text=DateUtils.getFormatBySecond(this.endedTime,DateUtils.TIME_FORMAT_5,4);this.endedTime-=1};OSATarget18Panel1.prototype.listRefush=function(){var data=Activity.ins().getActivityDataById(this.activityID);this.list.dataProvider=new eui.ArrayCollection(data.logs);this.jpList.dataProvider=new eui.ArrayCollection(data.bestlogs)};OSATarget18Panel1.prototype.onBuy=function(e){switch(e.target){case this.buy1:this.buyHunt(1);break;case this.buy10:this.buyHunt(2);break;default:break}};OSATarget18Panel1.prototype.buyHunt=function(index){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}this.huntType=index;var configs=GlobalConfig.ActivityType18Config[this.activityID];var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,configs[index].item);if(item&&item.count){Activity.ins().sendReward(this.activityID,index)}else{var times=index>1?10:1;var huntOnce=configs[index].yb;HuntWarnBuyWin.showBuyWarn("OSATarget18Panel1-HuntResultWin"+(times==10?1:0),this.huntWarnFun.bind(this),i18n("OSATarget18Panel1_0",huntOnce,GlobalConfig.ItemConfig[configs[index].item].name,times))}};OSATarget18Panel1.prototype.huntWarnFun=function(){var huntOnce=GlobalConfig.ActivityType18Config[this.activityID][this.huntType].yb;if(Actor.yb>=huntOnce){Activity.ins().sendReward(this.activityID,this.huntType)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget18Panel1_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget18Panel1_2"))}};OSATarget18Panel1.prototype.updateBox=function(){var configs=GlobalConfig.ActivityType18Config[this.activityID];var boxConfig=[];for(var i_12 in configs){if(configs[i_12].dbCount)boxConfig.push(configs[i_12])}boxConfig.sort(function(a,b){if(a.dbCount<b.dbCount)return-1;return 1});var data=Activity.ins().getActivityDataById(this.activityID);var state;var config;var i=0;var lenBox=boxConfig.length;var lastCount=0;for(var k in boxConfig){config=boxConfig[k];this["time"+i].text=config.dbCount+i18n("OSATarget18Panel1_3");this["time"+i].visible=true;this["done"+i].visible=false;this["boxPoint"+i].visible=false;this["bar"+i].value=0;this["bar"+i].maximum=100;this["box"+i].source="200116_0_png";this["box"+i].name="box"+config.index;if(!this.addBoxEvent)this.addTouchEvent(this["box"+i],this.onGetAward);if(i<lenBox){state=data.getStateByIndex(config.index);if(state==2){this["box"+i].source="200116_png";this["bar"+i].value=100;this["boxPoint"+i].visible=true}else if(state==1){this["time"+i].visible=false;this["done"+i].visible=true;this["bar"+i].value=100}else{var value=Math.floor((data.num-lastCount)/(config.dbCount-lastCount)*100);if(value<0)value=0;else if(value>100)value=100;this["bar"+i].value=value}}lastCount=config.dbCount;i++}this.icon10.source=this.icon1.source=GlobalConfig.ItemConfig[configs[1].item].icon+"_png"};OSATarget18Panel1.prototype.onGetAward=function(e){var index=e.target.name.slice(3,4);var data=Activity.ins().getActivityDataById(this.activityID);var state=data.getStateByIndex(index);if(state==2)Activity.ins().sendReward(this.activityID,index);else ViewManager.ins().open(HuntBoxsTips,index,3,this.activityID)};OSATarget18Panel1.prototype.updateMaterial=function(){var item=UserBag.ins().getBagGoodsByTypeAndId(0,GlobalConfig.ActivityType18Config[this.activityID][1].item);var count=item?item.count:0;this.num.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget18Panel1_4",count?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N,count));this.num10.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget18Panel1_5",count>=10?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N,count))};return OSATarget18Panel1}(BaseView);__reflect(OSATarget18Panel1.prototype,"OSATarget18Panel1");var OSATarget19Panel=function(_super){__extends(OSATarget19Panel,_super);function OSATarget19Panel(){return _super.call(this)||this}OSATarget19Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.panelList=[]};OSATarget19Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.observe(Activity.ins().postChangePage,this.updateData);this.observe(Activity.ins().postRewardResult,this.updateData);this.showPanel()};OSATarget19Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();if(this.curPanel)this.curPanel.close()};OSATarget19Panel.prototype.showPanel=function(){var config=GlobalConfig.ActivityType19Config[this.activityID];if(!config)return;var showType=config[1].showType;if(!this.panelList[showType]){var Cls=egret.getDefinitionByName("OSATarget19Panel"+showType);this.panelList[showType]=new Cls;this.panelList[showType].top=0;this.panelList[showType].bottom=0;this.panelList[showType].left=0;this.panelList[showType].right=0;this.panelList[showType].activityID=this.activityID;this.panelList[showType].showPanel=this.showPanel.bind(this)}if(this.curPanel){this.curPanel.close();DisplayUtils.removeFromParent(this.curPanel)}this.curPanel=this.panelList[showType];this.curPanel.open();this.addChild(this.curPanel)};OSATarget19Panel.prototype.updateData=function(){this.curPanel&&this.curPanel.updateData()};return OSATarget19Panel}(ActivityPanel);__reflect(OSATarget19Panel.prototype,"OSATarget19Panel");var OSATarget19Panel1=function(_super){__extends(OSATarget19Panel1,_super);function OSATarget19Panel1(){var _this=_super.call(this)||this;_this.skinName="ISCostWinSkin";return _this}OSATarget19Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.panelArr[this.curSelectIndex].close();this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget19Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addChangeEvent(this.tab,this.onTabTouch);this.observe(Activity.ins().postActivityIsGetAwards,this.updateRedPoint);var config=GlobalConfig.ActivityType19Config[this.activityID][1];this.costTarget.activityType=ActivityType.Normal;this.costTarget.activityID=config.activityID;this.panelArr=[this.ranking,this.costTarget,this.reward];this.setSelectedIndex(0);this.updateRedPoint()};OSATarget19Panel1.prototype.onTabTouch=function(e){this.panelArr[this.curSelectIndex].close();var selectedIndex=e.currentTarget.selectedIndex;this.setSelectedIndex(selectedIndex)};OSATarget19Panel1.prototype.setSelectedIndex=function(selectedIndex){this.curSelectIndex=selectedIndex;this.panelArr[selectedIndex].open(this.activityID);this.viewStack.selectedIndex=selectedIndex};OSATarget19Panel1.prototype.updateRedPoint=function(){var data=Activity.ins().getActivityDataById(this.activityID);this.redPoint1.visible=data.canReward()};OSATarget19Panel1.prototype.updateData=function(){};return OSATarget19Panel1}(BaseView);__reflect(OSATarget19Panel1.prototype,"OSATarget19Panel1");var OSATarget19PanelAct1=function(_super){__extends(OSATarget19PanelAct1,_super);function OSATarget19PanelAct1(){var _this=_super.call(this)||this;_this.skinName="ISCostTargetSkin";return _this}OSATarget19PanelAct1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve()};OSATarget19PanelAct1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.maskGroup,this.onClick);this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.activityID=param[0];Activity.ins().sendChangePage(this.activityID)};OSATarget19PanelAct1.prototype.onClick=function(e){switch(e.currentTarget){case this.maskGroup:if(this.state==Activity.CanGet){Activity.ins().sendReward(this.activityID,this.index)}else{var config=GlobalConfig.ActivityType1Config[this.activityID][this.index];var tips=0;switch(config.showType){case ShowType.XIAOFEI:var act=Activity.ins().getActivityDataById(this.activityID);if(act.hFTotalConsumption<config.consumeYuanbao)tips=config.consumeYuanbao-act.hFTotalConsumption;break}if(!tips){Activity.ins().sendReward(this.activityID,this.index);return}if(config.showType==ShowType.XIAOFEI)UserTips.ins().showTips(i18n("OSATarget19PanelAct1_0")+tips+i18n("OSATarget19PanelAct1_1"))}break}};OSATarget19PanelAct1.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);if(!activityData)return;if(!activityData.isOpenActivity()){UserTips.ins().showTips(i18n("OSATarget19PanelAct1_2"));return}var config=GlobalConfig.ActivityType1Config[this.activityID];this.index=this.getRuleIndex();this.reward.data=config[this.index].rewards[0];this.reward.setImgBg1();this.reward.hideName();this.reward.clearEffect();this.reward.showNum(false);this.cost.text=activityData.hFTotalConsumption+"";this.target.text="/"+config[this.index].consumeYuanbao};OSATarget19PanelAct1.prototype.getRuleIndex=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var config=GlobalConfig.ActivityType1Config[this.activityID];var index=1;for(var i in config){var acfg=config[i];activityData.getRewardStateById(acfg.index);var btnType=activityData.getRewardStateById(acfg.index);var curget=activityData.rewardsSum[acfg.index];var sum=acfg.total?acfg.total-curget:1;this.state=btnType;index=acfg.index;switch(btnType){case Activity.NotReached:break;case Activity.CanGet:if(sum<=0)this.state=Activity.NotReached;else this.state=Activity.CanGet;break;case Activity.Geted:break}if(this.state==Activity.CanGet){this.currentState="can";break}if(this.state==Activity.NotReached){this.currentState="cannot";break}}if(this.state==Activity.Geted){this.currentState="already"}this.validateNow();return index};return OSATarget19PanelAct1}(BaseComponent);__reflect(OSATarget19PanelAct1.prototype,"OSATarget19PanelAct1");var OSATarget1Panel=function(_super){__extends(OSATarget1Panel,_super);function OSATarget1Panel(id){var _this=_super.call(this)||this;_this._time=0;return _this}OSATarget1Panel.prototype.setCurSkin=function(){var aCon;if(this.activityType==ActivityType.Normal){aCon=GlobalConfig.ActivityConfig[this.activityID]}else if(this.activityType==ActivityType.Personal){aCon=GlobalConfig.PActivityConfig[this.activityID]}if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="OSATarget1"};OSATarget1Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();this.content.itemRenderer=OSATargetItemRenderer;var ins;if(this.activityType==ActivityType.Normal){ins=Activity.ins()}else if(this.activityType==ActivityType.Personal){ins=PActivity.ins()}this.observe(ins.postRewardResult,this.GetCallBack);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateData()};OSATarget1Panel.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget1Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget1Panel.prototype.GetCallBack=function(activityID){if(this.activityID!=activityID)return;var ins;var activityData;if(this.activityType==ActivityType.Normal){ins=Activity.ins();activityData=ins.getActivityDataById(this.activityID)}else if(this.activityType==ActivityType.Personal){ins=PActivity.ins();activityData=ins.getActivityDataById(this.activityID)}if(!ins.isSuccee){if(!UserBag.ins().getSurplusCount()){UserTips.ins().showTips(i18n("OSATarget1Panel_0"))}else{UserTips.ins().showTips(i18n("OSATarget1Panel_1"));ins.sendChangePage(activityData.id)}}ins.isSuccee=false;this.updateData()};OSATarget1Panel.prototype.updateData=function(){if(!this.listData){this.listData=new ArrayCollection;this.content.dataProvider=this.listData}var ins;var activityData;var tmplist;var aconfig;if(this.activityType==ActivityType.Normal){ins=Activity.ins();activityData=ins.getActivityDataById(this.activityID);tmplist=GlobalConfig.ActivityType1Config[activityData.id];aconfig=GlobalConfig.ActivityConfig}else if(this.activityType==ActivityType.Personal){ins=PActivity.ins();activityData=ins.getActivityDataById(this.activityID);tmplist=GlobalConfig.PActivityType1Config[activityData.id];aconfig=GlobalConfig.PActivityConfig}var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime0.text=i18n("OSATarget1Panel_2")}else if(endedTime<=0){this.actTime0.text=i18n("OSATarget1Panel_3")}else{this._time=endedTime;if(this._time<0)this._time=0;this.actTime0.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.actInfo0.text=aconfig[this.activityID].desc;var listData=[];for(var k in tmplist){listData.push(tmplist[k])}listData=listData.slice();var listDataSort=[];var listDataSortTotal=[];for(var i=0;i<listData.length;i++){var state=activityData.getRewardStateById(listData[i].index);if(state==Activity.Geted){listDataSortTotal.push(listData[i])}else{listDataSort.push(listData[i])}}if(listData[0].showType==ShowType.LEVEL){var listDataZsLevel=[];var listDataLevel=[];listDataLevel=this.sortLevelList(listDataSort);listDataZsLevel=this.sortLevelList(listDataSortTotal);listData=listDataLevel.concat(listDataZsLevel);this.listData.replaceAll(listData)}else{listDataSort.sort(this.sortFunc);listDataSortTotal.sort(this.sortFunc);listData=listDataSort.concat(listDataSortTotal);this.listData.replaceAll(listData)}var aBtn=ins.getbtnInfo(this.activityID.toString());this.title.source=aBtn.title;this.setDesc(activityData)};OSATarget1Panel.prototype.setDesc=function(activityData){var config;if(this.activityType==ActivityType.Normal){config=GlobalConfig.ActivityType1Config[activityData.id][1]}else if(this.activityType==ActivityType.Personal){config=GlobalConfig.PActivityType1Config[activityData.id][1]}var myAttr="";var val="";this.oldTips.visible=true;this.newTips.visible=false;switch(config.showType){case ShowType.LEVEL:myAttr=i18n("OSATarget1Panel_4");if(config.zslevel)val+=UserZs.ins().lv+i18n("OSATarget1Panel_5");if(config.level)val+=Actor.level+i18n("OSATarget1Panel_6");break;case ShowType.WING:myAttr=i18n("OSATarget1Panel_7");val=WingsData.getWingAllLevel()+"";break;case ShowType.ZHUZAO:myAttr=i18n("OSATarget1Panel_8");val=Role.getAllForgeLevelByType(PackageID.Zhuling)+"";break;case ShowType.LONGHUN:myAttr=i18n("OSATarget1Panel_9");val=LongHunData.getLongHunAllLevel()+"";break;case ShowType.BOOK:var power=Book.ins().getBookPowerNumEx();myAttr=i18n("OSATarget1Panel_10");val=power+"";break;case ShowType.EQUIP:myAttr=i18n("OSATarget1Panel_11");val=UserBag.ins().getEquipsScoreByRolesOfBody()+"";break;case ShowType.XIAOFEI:myAttr=i18n("OSATarget1Panel_12");val=activityData.hFTotalConsumption+"";break;case ShowType.RING:myAttr=i18n("OSATarget1Panel_13");var data=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);var stage=SpecialRing.ins().getRingStair(data.level);var star=SpecialRing.ins().getRingStar(data.level);val=stage+i18n("OSATarget1Panel_14")+star+i18n("OSATarget1Panel_15");break;case ShowType.SAMSARA:myAttr=i18n("OSATarget1Panel_16");var lv1=SamsaraModel.ins().getSamsara(Actor.samsaraLv);var lv2=SamsaraModel.ins().getSamsaraLv(Actor.samsaraLv);val=Actor.samsaraLv+" "+SamsaraModel.ins().getSamsaraDesc(lv1)+"·"+SamsaraModel.ins().getSamsaraLvDesc(lv2);break;case ShowType.ZHANLING:myAttr=i18n("OSATarget1Panel_17");var lv=ZhanLingModel.ins().getMaxZhanLingDataByLevel();val=Math.ceil(lv/10)+i18n("OSATarget1Panel_18")+(lv%10==0?lv?10:0:lv%10)+i18n("OSATarget1Panel_19");break;case ShowType.XIANYU:this.oldTips.visible=false;this.newTips.visible=true;var zNum=UserMiji.ins().getZiNumTotal();var tNum=UserMiji.ins().getXianYuNumTotal();var mLevel=UserMiji.ins().getMinLevelTotal();this.xianyu.text=i18n("OSATarget1Panel_20")+tNum.toString()+i18n("OSATarget1Panel_21")+zNum.toString()+i18n("OSATarget1Panel_22")+mLevel.toString();break}this.attr.text=myAttr;this.myAttrValue.text=val};OSATarget1Panel.prototype.sortLevelList=function(datalist){var listDataSort=[];var lhead=[];var ltotal=[];for(var i=0;i<datalist.length;i++){if(datalist[i].zslevel)ltotal.push(datalist[i]);else lhead.push(datalist[i])}lhead.sort(this.sortFunc);ltotal.sort(this.sortFunc);listDataSort=lhead.concat(ltotal);return listDataSort};OSATarget1Panel.prototype.sortFunc=function(aConfig,bConfig){var activityData;if(GlobalConfig.PActivityBtnConfig[aConfig.Id]){activityData=PActivity.ins().getActivityDataById(aConfig.Id)}else{activityData=Activity.ins().getActivityDataById(aConfig.Id)}var aState=activityData.getRewardStateById(aConfig.index);var bState=activityData.getRewardStateById(bConfig.index);if(aConfig.showType==ShowType.LEVEL){if(aConfig.zslevel<bConfig.zslevel)return-1;if(aConfig.zslevel>bConfig.zslevel)return 1;if(aConfig.level<bConfig.level)return-1;if(aConfig.level>bConfig.level)return 1}if(aConfig.showType==ShowType.WING){if(aConfig.wingLv<bConfig.wingLv)return-1;if(aConfig.wingLv>bConfig.wingLv)return 1}if(aConfig.showType==ShowType.ZHUZAO){if(aConfig.zzLv<bConfig.zzLv)return-1;if(aConfig.zzLv>bConfig.zzLv)return 1}if(aConfig.showType==ShowType.LONGHUN){if(aConfig.lhLv<bConfig.lhLv)return-1;if(aConfig.lhLv>bConfig.lhLv)return 1}if(aConfig.showType==ShowType.BOOK){if(aConfig.tjPower<bConfig.tjPower)return-1;if(aConfig.tjPower>bConfig.tjPower)return 1}if(aConfig.showType==ShowType.EQUIP){if(aConfig.equipPower<bConfig.equipPower)return-1;if(aConfig.equipPower>bConfig.equipPower)return 1}if(aConfig.showType==ShowType.XIAOFEI){if(aConfig.consumeYuanbao<bConfig.consumeYuanbao)return-1;if(aConfig.consumeYuanbao>bConfig.consumeYuanbao)return 1}if(aConfig.showType==ShowType.SAMSARA){if(aConfig.lunhLv<bConfig.lunhLv)return-1;if(aConfig.lunhLv>bConfig.lunhLv)return 1}if(aConfig.showType==ShowType.ZHANLING){if(aConfig.zhanlingLv<bConfig.zhanlingLv)return-1;if(aConfig.zhanlingLv>bConfig.zhanlingLv)return 1}return 0};return OSATarget1Panel}(ActivityPanel);__reflect(OSATarget1Panel.prototype,"OSATarget1Panel");var OSATarget20Panel=function(_super){__extends(OSATarget20Panel,_super);function OSATarget20Panel(){var _this=_super.call(this)||this;_this.skinName="LaBaBossSkin";return _this}OSATarget20Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget20Panel.prototype.close=function(){this.removeTouchEvent(this.goBtn,this.onTap);TimerManager.ins().remove(this.setTime,this)};OSATarget20Panel.prototype.open=function(){this.addTouchEvent(this.goBtn,this.onTap);this.initData();TimerManager.ins().doTimer(1e3,0,this.setTime,this)};OSATarget20Panel.prototype.initData=function(){this.rewardList.itemRenderer=ItemBase;this.updateData()};OSATarget20Panel.prototype.onTap=function(e){switch(e.currentTarget){case this.goBtn:var activityData=Activity.ins().getActivityDataById(this.activityID);if(activityData.IsEnd()){UserTips.ins().showTips(i18n("OSATarget20Panel_0"));return}if(activityData.go2BossFb()){Activity.ins().sendReward(this.activityID,activityData.index)}else{UserTips.ins().showTips(i18n("OSATarget20Panel_1"))}break}};OSATarget20Panel.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor(DateUtils.formatMiniDateTime(activityData.startTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND);var endedTime=Math.floor(DateUtils.formatMiniDateTime(activityData.endTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND);if(beganTime>=0){this.actTime.text=i18n("OSATarget20Panel_2");this.readyTime=0}else if(endedTime<=0){this.actTime.text=i18n("OSATarget20Panel_3");this.readyTime=0}else{this._time=endedTime;if(this._time<0)this._time=0;this.readyTime=activityData.getStartTimer();this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}var config=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(config.desc);this.redPoint.visible=activityData.checkRedPoint();var cfg=GlobalConfig.ActivityType20Config[this.activityID][activityData.index];if(cfg){this.rewardList.dataProvider=new eui.ArrayCollection(cfg.showReward)}this.playModel();this.setDate()};OSATarget20Panel.prototype.setDate=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);if(activityData.IsEnd()){this.time.text=i18n("OSATarget20Panel_4");return}var curTimer=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);var et=activityData.getEndTimer();if(curTimer>=et){this.time.text=i18n("OSATarget20Panel_5");return}var st=activityData.getStartTimer();if(curTimer>=st&&curTimer<et){this.time.text=i18n("OSATarget20Panel_6");return}var config=GlobalConfig.ActivityType20Config[this.activityID][activityData.index];var mconfig=GlobalConfig.MonstersConfig[config.monsterId.id];var secondTime=DateUtils.getFormatBySecond(st,DateUtils.TIME_FORMAT_6);this.time.text=i18n("OSATarget20Panel_7",mconfig.name,secondTime)};OSATarget20Panel.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget20Panel.prototype.playModel=function(){if(!this.bossModel)this.bossModel=new MovieClip;if(!this.bossModel.parent)this.Boss.addChild(this.bossModel);var activityData=Activity.ins().getActivityDataById(this.activityID);var config=GlobalConfig.ActivityType20Config[this.activityID][activityData.index];if(config){this.bossModel.playFile(RES_DIR_MONSTER+config.monsterId.monster,-1);this.bossModel.scaleX=this.bossModel.scaleY=config.monsterId.scale/100}};return OSATarget20Panel}(ActivityPanel);__reflect(OSATarget20Panel.prototype,"OSATarget20Panel");var OSATarget22Panel=function(_super){__extends(OSATarget22Panel,_super);function OSATarget22Panel(){var _this=_super.call(this)||this;_this.type2PanelList=[];return _this}OSATarget22Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var config=GlobalConfig.ActivityType22_1Config[this.activityID];if(!this.type2PanelList[this.activityID]){var panel=ObjectPool.pop("OSATarget22Panel"+config[1].showType,[this.activityID]);panel.top=0;panel.bottom=0;panel.left=0;panel.right=0;panel.activityID=this.activityID;this.type2PanelList[this.activityID+""]=panel}this.cruPanel=this.type2PanelList[this.activityID+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget22Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget22Panel.prototype.updateData=function(){this.cruPanel.updateData()};return OSATarget22Panel}(ActivityPanel);__reflect(OSATarget22Panel.prototype,"OSATarget22Panel");var OSATarget22Panel1=function(_super){__extends(OSATarget22Panel1,_super);function OSATarget22Panel1(id){var _this=_super.call(this)||this;_this.activityID=id;_this.setCurSkin();return _this}OSATarget22Panel1.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="activityStoreSkin"};OSATarget22Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.goodsOverView.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.goodsOverView.text);this.listView.itemRenderer=ActivityStoreItemRender};OSATarget22Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();var aCon=GlobalConfig.ActivityConfig[this.activityID];this.actInfo0.text=aCon.desc;this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.observe(UserBag.ins().postItemAdd,this.updateMaterial);this.observe(UserBag.ins().postItemChange,this.updateMaterial);this.observe(UserBag.ins().postItemDel,this.updateMaterial);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.addTouchEvent(this,this.onTouch);this.currentState="activityStore";this.updateData();this.updateMaterial()};OSATarget22Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTouch);this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget22Panel1.prototype.updateMaterial=function(){var itemData=UserBag.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.activityID][1].freshItem);var count=itemData?itemData.count:0;this.refreshItemNum.textFlow=TextFlowMaker.generateTextFlow(i18n("OSATarget22Panel1_4",count?65280:16711680,count));this._isEnough=count>0;if(this.currentState=="activityStore"){var data=Activity.ins().activityData[this.activityID];this.redPoint1.visible=data.refreshFree||this._isEnough}};OSATarget22Panel1.prototype.updateData=function(){if(!this._collect){this._collect=new ArrayCollection;this.listView.dataProvider=this._collect}var data=Activity.ins().activityData[this.activityID];var datas=[];var items=this.currentState=="activityStore"?data.shopItems:data.scoreItems;var len=items?items.length:0;for(var i=0;i<len;i++)datas.push({data:items[i],isScore:this.currentState=="integralStore",activityID:this.activityID});this._collect.source=datas;if(this.currentState=="activityStore"){this.costGroup.visible=!data.refreshFree;this.price.text=GlobalConfig.ActivityType22_1Config[this.activityID][1].freshPrice+"";this.refreshShopBtn.label=data.refreshFree?i18n("OSATarget22Panel1_0"):i18n("OSATarget22Panel1_1");this.redPoint1.visible=data.refreshFree||this._isEnough;var config=Activity.ins().getConfig22_3(this.activityID);this.redPoint0.visible=config&&data.tScore>=config.score}this.integralNum.text=data.tScore+"";var itemcfg=GlobalConfig.ItemConfig[GlobalConfig.ActivityType22_1Config[this.activityID][1].freshItem];this.refreshItem.source=itemcfg?itemcfg.icon+"_png":""};OSATarget22Panel1.prototype.onTouch=function(e){switch(e.target){case this.goodsOverView:ViewManager.ins().open(ActivityStoreRewardShowWin,this.activityID);break;case this.integralStoreBtn:this.currentState=this.currentState=="integralStore"?"activityStore":"integralStore";this.updateData();break;case this.refreshShopBtn:var data=Activity.ins().activityData[this.activityID];if(data.refreshFree)Activity.ins().sendReward(this.activityID,0,5,0);else{if(Actor.yb<GlobalConfig.ActivityType22_1Config[this.activityID][1].freshPrice&&!this._isEnough){var warnWin=WarnWin.show(i18n("OSATarget22Panel1_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget22Panel1_3"))}else Activity.ins().sendReward(this.activityID,0,5,0)}break}};OSATarget22Panel1.prototype.setTime=function(){var data=Activity.ins().activityData[this.activityID];this.actTime0.text=data.getRemainTime();var time=data.getRefreshTime();this.refreshTime.text=DateUtils.getFormatBySecond(time>0?time:0,DateUtils.TIME_FORMAT_1,5)};return OSATarget22Panel1}(BaseView);__reflect(OSATarget22Panel1.prototype,"OSATarget22Panel1");var OSATarget22Panel2=function(_super){__extends(OSATarget22Panel2,_super);function OSATarget22Panel2(id){var _this=_super.call(this)||this;_this.activityID=id;_this.setCurSkin();return _this}OSATarget22Panel2.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="FDStoreSkin"};OSATarget22Panel2.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.listView.itemRenderer=FDstoreItemRender};OSATarget22Panel2.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.observe(UserBag.ins().postItemAdd,this.updateMaterial);this.observe(UserBag.ins().postItemChange,this.updateMaterial);this.observe(UserBag.ins().postItemDel,this.updateMaterial);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.addTouchEvent(this,this.onTouch);this.updateData();this.updateMaterial();this.setTime()};OSATarget22Panel2.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTouch);this.removeObserve();TimerManager.ins().removeAll(this);if(this.objList){var obj=void 0;for(var i=0;i<this.objList.length;i++){obj=this.objList.shift();egret.Tween.removeTweens(obj);DisplayUtils.removeFromParent(obj)}this.objList=null}};OSATarget22Panel2.prototype.updateData=function(){if(!this._collect){this._collect=new ArrayCollection;this.listView.dataProvider=this._collect}var data=Activity.ins().activityData[this.activityID];var datas=[];var items=data.shopItems;var len=items?items.length:0;for(var i=0;i<len;i++)datas.push({data:items[i],activityID:this.activityID});this.noGoods.visible=!datas||!datas.length;this._collect.source=datas;this.redPoint.visible=data.refreshFree;this.refresh.visible=this.priceTxt.visible=this.moneyIcon.visible=!data.refreshFree;var cfg1=GlobalConfig.ActivityType22_1Config[this.activityID][1];this.priceTxt.text=cfg1.freshPrice+"";this.refreshFree.visible=data.refreshFree;this.icon.source=GlobalConfig.ItemConfig[cfg1.costItem].icon+"_png";items=data.limitItems;len=items?items.length:0;var vo;var limitItem;for(var i=0;i<5;i++){limitItem=this["itemShow"+i];if(i<=len-1){vo=items[i];limitItem.visible=true;limitItem.update({itemID:vo.itemID,max:vo.buyMax,buy:vo.buyCount})}else limitItem.visible=false}};OSATarget22Panel2.prototype.updateMaterial=function(){var itemData=UserBag.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.activityID][1].costItem);var count=itemData?itemData.count:0;this.point.text="X"+count;this.point.textColor=count?65280:16711680};OSATarget22Panel2.prototype.onTouch=function(e){switch(e.target){case this.refreshShopBtn:var data=Activity.ins().activityData[this.activityID];if(data.refreshFree)Activity.ins().sendReward(this.activityID,0,5,0);else{var price=GlobalConfig.ActivityType22_1Config[this.activityID][1].freshPrice;if(Actor.yb<price){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget22Panel2_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget22Panel2_1"))}else{Activity.ins().sendReward(this.activityID,0,5,0);this.flyRMB(price)}}break}};OSATarget22Panel2.prototype.flyRMB=function(rmb){var _this=this;if(!this.objList)this.objList=[];var obj=new eui.BitmapLabel;obj.font="num_2_fnt";obj.y=-10;obj.x=460;obj.scaleX=obj.scaleY=1.5;obj.text="-"+rmb;this.addChild(obj);this.objList.push(obj);egret.Tween.get(obj).to({y:obj.y+50},1e3).call(function(){DisplayUtils.removeFromParent(obj);_this.objList.shift()})};OSATarget22Panel2.prototype.setTime=function(){var data=Activity.ins().activityData[this.activityID];var time=data.getRefreshTime();this.refreshTime.text=DateUtils.getFormatBySecond(time>0?time:0,DateUtils.TIME_FORMAT_1,5);this.refreshTime.visible=this.refreshTip.visible=time>0};return OSATarget22Panel2}(BaseView);__reflect(OSATarget22Panel2.prototype,"OSATarget22Panel2");var OSATarget24Panel=function(_super){__extends(OSATarget24Panel,_super);function OSATarget24Panel(){var _this=_super.call(this)||this;_this.type24PanelList=[];return _this}OSATarget24Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.initPanelList()};OSATarget24Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var id=this.activityID;this.initPanelList();this.cruPanel=this.type24PanelList[id+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget24Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget24Panel.prototype.initPanelList=function(){var id=this.activityID;if(!this.type24PanelList[id+""]){var clsStr=OSATarget24Panel.targetIndex[id];var Cls=egret.getDefinitionByName(clsStr);this.type24PanelList[id+""]=new Cls(this.activityID);this.type24PanelList[id+""].top=0;this.type24PanelList[id+""].bottom=0;this.type24PanelList[id+""].left=0;this.type24PanelList[id+""].right=0;this.type24PanelList[id+""].activityID=this.activityID}};OSATarget24Panel.prototype.updateData=function(){this.cruPanel.updateData()};OSATarget24Panel.targetIndex={8401:"OSATarget24Panel1"};return OSATarget24Panel}(ActivityPanel);__reflect(OSATarget24Panel.prototype,"OSATarget24Panel");var OSATarget24Panel1=function(_super){__extends(OSATarget24Panel1,_super);function OSATarget24Panel1(){var _this=_super.call(this)||this;_this._leftTime=0;_this.skinName="OSAXianMengZhiLuSkin";_this._data=[];_this.listData=new eui.ArrayCollection;_this.list.dataProvider=_this.listData;_this.list.itemRenderer=OSAXianMengZhiLuItemRender;return _this}OSATarget24Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget24Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget24Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().doTimer(1e3,0,this.setTimer,this);this.updateView()};OSATarget24Panel1.prototype.updateView=function(){var data=Activity.ins().getActivityDataById(this.activityID);if(!data)return;this.initTime();this.listRefush();var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg)this.title.source=btnCfg.title;this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc};OSATarget24Panel1.prototype.listRefush=function(){var config=GlobalConfig.ActivityType24Config[this.activityID];var act=Activity.ins().getActivityDataById(this.activityID);var result;var arr1=[];var arr2=[];for(var k in config){var state=act.checkState(config[k].index);if(state>=config[k].value){arr2.push({config:config[k],state:state})}else{arr1.push({config:config[k],state:state})}}arr1.sort(this.sortRule);arr2.sort(this.sortRule);result=arr1.concat(arr2);this.listData.replaceAll(result)};OSATarget24Panel1.prototype.initTime=function(){var data=Activity.ins().getActivityDataById(this.activityID);this._leftTime=data.getLeftTime()||0};OSATarget24Panel1.prototype.setTimer=function(){this._leftTime=this._leftTime-1>0?this._leftTime-1:0;this.actTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3)};OSATarget24Panel1.prototype.sortRule=function(a,b){if(a.config.type!=b.config.type){return a.config.type-b.config.type}else{return a.config.index-b.config.index}};return OSATarget24Panel1}(ActivityPanel);__reflect(OSATarget24Panel1.prototype,"OSATarget24Panel1");var OSATarget25Panel=function(_super){__extends(OSATarget25Panel,_super);function OSATarget25Panel(){var _this=_super.call(this)||this;_this.skinName="huishouActSkin";return _this}OSATarget25Panel.prototype.close=function(){TimerManager.ins().removeAll(this)};OSATarget25Panel.prototype.open=function(){this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.updateData();TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1e3,0,this.setTime,this)};OSATarget25Panel.prototype.updateData=function(){var activityData;var aBtn;activityData=Activity.ins().getActivityDataById(this.activityID);aBtn=Activity.ins().getbtnInfo(this.activityID.toString());var config=GlobalConfig.ActivityConfig[this.activityID];var actCfg=GlobalConfig.ActivityType25Config[this.activityID]["1"];this.title.source=aBtn.title;this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(config.desc);this.imgContent.source=actCfg.source;this.setTime()};OSATarget25Panel.prototype.setTime=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);var desc;if(beganTime>=0){desc=i18n("ActivityFirstRechargeWin_1")}else if(endedTime<=0){desc=i18n("ActivityFirstRechargeWin_2")}else{desc=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.actTime.text=desc};return OSATarget25Panel}(BaseView);__reflect(OSATarget25Panel.prototype,"OSATarget25Panel");var OSATarget27Panel=function(_super){__extends(OSATarget27Panel,_super);function OSATarget27Panel(){var _this=_super.call(this)||this;_this.type27PanelList=[];return _this}OSATarget27Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.initPanelList()};OSATarget27Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var id=this.activityID;this.initPanelList();this.cruPanel=this.type27PanelList[id+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget27Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget27Panel.prototype.initPanelList=function(){var id=this.activityID;if(!this.type27PanelList[id+""]){var clsStr=OSATarget27Panel.targetIndex[id];var Cls=egret.getDefinitionByName(clsStr);this.type27PanelList[id+""]=new Cls(this.activityID);this.type27PanelList[id+""].top=0;this.type27PanelList[id+""].bottom=0;this.type27PanelList[id+""].left=0;this.type27PanelList[id+""].right=0;this.type27PanelList[id+""].activityID=this.activityID}};OSATarget27Panel.prototype.updateData=function(){this.cruPanel.updateData()};OSATarget27Panel.targetIndex={8501:"OSATarget27Panel1"};return OSATarget27Panel}(ActivityPanel);__reflect(OSATarget27Panel.prototype,"OSATarget27Panel");var OSATarget27Panel1=function(_super){__extends(OSATarget27Panel1,_super);function OSATarget27Panel1(){var _this=_super.call(this)||this;_this.activityId=8501;_this.lv=1;_this.skinName="OSAPrivateBossSkin";_this.reward.itemRenderer=ItemBase;_this.dataProvider=new eui.ArrayCollection;_this.reward.dataProvider=_this.dataProvider;return _this}OSATarget27Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget27Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.mcPowerBg)this.mcPowerBg.destroy();TimerManager.ins().remove(this.setTimer,this);this.removeTouchEvent(this.btnSelect1,this.onTap);this.removeTouchEvent(this.btnSelect2,this.onTap);this.removeTouchEvent(this.btnSelect3,this.onTap);this.removeTouchEvent(this.enter,this.onTap);this.removeObserve()};OSATarget27Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnSelect1,this.onTap);this.addTouchEvent(this.btnSelect2,this.onTap);this.addTouchEvent(this.btnSelect3,this.onTap);this.addTouchEvent(this.enter,this.onTap);this.updateView()};OSATarget27Panel1.prototype.updateView=function(){this.data=Activity.ins().getActivityDataById(this.activityID);this.setTimer();TimerManager.ins().remove(this.setTimer,this);TimerManager.ins().doTimer(1e3,0,this.setTimer,this);if(this.mcPowerBg)this.mcPowerBg.destroy();this.mcPowerBg=new MovieClip;this.mcPowerBg.playFile("resource/res/eff/sjxb_zdleff",-1);this.powerBg.addChild(this.mcPowerBg);this.title.source=""+(GlobalConfig.ActivityBtnConfig[this.data.id].title||"");var cfg=this.data.getConfig();for(var k in cfg){if(cfg[k]&&cfg[k].level<=3&&cfg[k].day==this.data.day){var boss=GlobalConfig.MonstersConfig[cfg[k].bossid];this["bossHead"+cfg[k].level].source="monhead"+boss.head+"_png"}}this.setBossLevel(this.lv||1)};OSATarget27Panel1.prototype.setTimer=function(){var daySecond=24*60*60;var x=Math.floor(Number(new Date("2020-1-1 00:00:00"))/1e3)%daySecond;var now=Math.floor(GameServer.serverTime/1e3)-x;var leftTime=daySecond*(this.data.sumTime()+1-this.data.day)-now%daySecond;var leftTime2=leftTime%daySecond;leftTime=leftTime<=0?0:leftTime;leftTime2=leftTime2<=0?0:leftTime2;this.leftTime.text=DateUtils.getFormatBySecond(leftTime,DateUtils.TIME_FORMAT_5,3);this.leftTime2.text=DateUtils.getFormatBySecond(leftTime2,DateUtils.TIME_FORMAT_5,3);if(leftTime2<=0||leftTime<=0){TimerManager.ins().remove(this.setTimer,this);return}};OSATarget27Panel1.prototype.setBossLevel=function(lv){var cfg=this.data.getConfig();var fuben=null;for(var k in cfg){if(cfg[k].day==this.data.day&&cfg[k].level==lv){fuben=cfg[k];break}}if(fuben){this.fuben=fuben;this.lv=lv;this.dataProvider.replaceAll([].concat(fuben.reward));this.enter.visible=this.data.getBossState(fuben.index)==ActivityType27Data.TYPE.close;this.finishImg.visible=this.data.getBossState(fuben.index)==ActivityType27Data.TYPE.done;for(var i=1;i<=3;i++){this["imgSelect"+i].visible=i==lv}if(this.model)this.model.destroy();this.model=new MovieClip;this.modelGroup.addChild(this.model);var bossBaseConfig=GlobalConfig.MonstersConfig[fuben.bossid];this.model.playFile(RES_DIR_MONSTER+("monster"+bossBaseConfig.avatar+"_3s"),-1);this.power.text=""+this.computeBossPower(bossBaseConfig)}};OSATarget27Panel1.prototype.onTap=function(e){switch(e.currentTarget){case this.btnSelect1:this.setBossLevel(1);break;case this.btnSelect2:this.setBossLevel(2);break;case this.btnSelect3:this.setBossLevel(3);break;case this.enter:this.challenge();break}};OSATarget27Panel1.prototype.computeBossPower=function(boss){var powerConfig=GlobalConfig.AttrPowerConfig;var attrs=[];for(var k in boss){switch(k){case"hp":attrs.push({value:boss[k],type:2});break;case"atk":attrs.push({value:boss[k],type:4});break;case"res":attrs.push({value:boss[k],type:6});break;case"def":attrs.push({value:boss[k],type:5});break}}return UserBag.getAttrPower(attrs)};OSATarget27Panel1.prototype.challenge=function(){if(!this.fuben)return;Activity.ins().sendReward(this.data.id,this.fuben.index)};return OSATarget27Panel1}(ActivityPanel);__reflect(OSATarget27Panel1.prototype,"OSATarget27Panel1");var OSATarget28Panel=function(_super){__extends(OSATarget28Panel,_super);function OSATarget28Panel(){var _this=_super.call(this)||this;_this.type2PanelList=[];return _this}OSATarget28Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var config;if(this.activityType==ActivityType.Normal){config=GlobalConfig.ActivityType28_1Config[this.activityID]}else if(this.activityType==ActivityType.Personal){config=GlobalConfig.PActivityType28_1Config[this.activityID]}if(this.cruPanel){if(config[1].showType==1||config[1].showType==3||config[1].showType==4){}else{this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}}if(!this.type2PanelList[this.activityID]){var panel=ObjectPool.pop("OSATarget28Panel"+config[1].showType);panel.top=0;panel.bottom=0;panel.left=0;panel.right=0;panel.activityID=this.activityID;this.type2PanelList[this.activityID+""]=panel}this.cruPanel=this.type2PanelList[this.activityID+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget28Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget28Panel.prototype.updateData=function(){this.cruPanel.updateData()};return OSATarget28Panel}(ActivityPanel);__reflect(OSATarget28Panel.prototype,"OSATarget28Panel");var OSATarget28Panel1=function(_super){__extends(OSATarget28Panel1,_super);function OSATarget28Panel1(){var _this=_super.call(this)||this;_this.skinName="luckyTurntable28Skin";return _this}OSATarget28Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();egret.Tween.removeTweens(this.tttzhi);this.rolling=false;var data;var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins();data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){ins=PActivity.ins();data=PActivity.ins().activityData[this.activityID]}if(data&&data.indexs.length==1){ins.sendReward(this.activityID,1)}TimerManager.ins().removeAll(this);this.removeTouchEvent(this.btnReward,this.onTouch);this.removeTouchEvent(this.btnRank,this.onTouch);this.removeTouchEvent(this.btnBox,this.onTouch)};OSATarget28Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}this.observe(ins.postChangePage,this.resultCallBack);this.observe(ins.postActivityIsGetAwards,this.refreshScore);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.addTouchEvent(this.choujiangBtn,this.getLottery);this.addTouchEvent(this.btnReward,this.onTouch);this.addTouchEvent(this.btnRank,this.onTouch);this.addTouchEvent(this.btnBox,this.onTouch);this.list.itemRenderer=NoticeListRenderer;this.turnten.selected=false;this.validateNow();this.updateData();this.refreshScore()};OSATarget28Panel1.prototype.refreshScore=function(){var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}this.redPoint.visible=ins.getType28ScoreRedPoint(this.activityID);var data=Activity.ins().activityData[this.activityID];var id=ins.getCurShowScoreId(this.activityID);var target=GlobalConfig.ActivityType28_3Config[id].score||100;var score=data.score;this.myScore.text=score.toString()+"/"+target.toString();this.bar.value=Math.min(score/target,1)*100};OSATarget28Panel1.prototype.onTouch=function(e){switch(e.currentTarget){case this.btnReward:ViewManager.ins().open(SpringTurntableRewardWin,this.activityID);break;case this.btnRank:ViewManager.ins().open(SpringTurntableRankWin,this.activityID);break;case this.btnBox:ViewManager.ins().open(SpringTurntableScoreWin,this.activityID);break}};OSATarget28Panel1.prototype.updateData=function(){var data;var config;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID];config=GlobalConfig.ActivityType28_1Config[this.activityID][0]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID];config=GlobalConfig.PActivityType28_1Config[this.activityID][0]}var itemcfg=GlobalConfig.ItemConfig[config.item];if(itemcfg){this.icon.source=itemcfg.icon+"_png";var item=UserBag.ins().getBagItemById(itemcfg.id);var sum=0;var maxsum=1;var colorStr=13746831;if(item){sum=item.count;if(sum>=maxsum)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N}else{colorStr=ColorUtil.RED_COLOR_N}this.num.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget9Panel1_6",colorStr,sum,maxsum));this.pay0.text=config.yb+""}var configList;if(this.actType==ActivityType.Normal){configList=GlobalConfig.ActivityType28_1Config}else if(this.actType==ActivityType.Personal){configList=GlobalConfig.PActivityType28_1Config}for(var i in configList[this.activityID]){if(!+i)continue;var cfg=configList[this.activityID][i];var item=this["item"+(+i-1)];item.itemIcon.data=cfg.reward[0];item.rewardState(false)}this.num2.visible=false;this.listRefush();this.setTime();if(this.activityID==4001){this.title.source="biaoti_duanwuzhuanpan"}var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg){if(btnCfg.title!=null&&btnCfg.title!=""){this.title.source=btnCfg.title}}};OSATarget28Panel1.prototype.resultCallBack=function(id){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(!data||this.activityID!=id)return;if(data.indexs.length>1){ViewManager.ins().open(LuckyResultWin,this.activityID,data.indexs,28)}else if(data.indexs.length==1){this.beginLottery(data.indexs[0])}this.listRefush()};OSATarget28Panel1.prototype.beginLottery=function(index){var _this=this;var rotat=360*4+(index-1)*36;var tween=egret.Tween.get(this.tttzhi);this.rolling=true;tween.to({rotation:rotat},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(_this.activityID,1);_this.flyItem(_this["item"+(index-1)]);setTimeout(function(){_this.rolling=false},2e3)},this)};OSATarget28Panel1.prototype.flyItem=function(item){var itemBase=new ItemBase;itemBase.x=item.x;itemBase.y=item.y;itemBase.data=item.itemIcon.data;itemBase.anchorOffsetX=itemBase.width/2;itemBase.anchorOffsetY=itemBase.height/2;item.parent.addChild(itemBase);GameLogic.ins().postFlyItemEx(itemBase)};OSATarget28Panel1.prototype.getLottery=function(){if(this.rolling){UserTips.ins().showTips(i18n("OSATarget9Panel1_0"));return}var ins;var cfg;if(this.actType==ActivityType.Normal){ins=Activity.ins();cfg=GlobalConfig.ActivityType28_1Config[this.activityID]}else if(this.actType==ActivityType.Personal){ins=PActivity.ins();cfg=GlobalConfig.PActivityType28_1Config[this.activityID]}if(this.turnten.selected){if(ins.getIsRollTen28(this.activityID)){ins.sendReward(this.activityID,2)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel1_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel1_2"))}}else{if(ins.getRollSum28(this.activityID)||Actor.yb>=cfg[0].yb){ins.sendReward(this.activityID,1)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel1_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel1_4"))}}};OSATarget28Panel1.prototype.listRefush=function(){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(data){var arr=[];for(var i=0;i<data.noticeArr.length;i++){var notice={activityID:this.activityID,name:data.noticeArr[i].name,index:data.noticeArr[i].index,actType:this.actType,activityType:28};arr.push(notice)}this.list.dataProvider=new eui.ArrayCollection(arr);this.barBg.visible=arr.length>0}};OSATarget28Panel1.prototype.setTime=function(){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(data)this.actTime.text=data.getRemainTime()};return OSATarget28Panel1}(BaseView);__reflect(OSATarget28Panel1.prototype,"OSATarget28Panel1");var OSATarget29Panel=function(_super){__extends(OSATarget29Panel,_super);function OSATarget29Panel(){var _this=_super.call(this)||this;_this.type29PanelList=[];return _this}OSATarget29Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.initPanelList()};OSATarget29Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.observe(Activity.ins().postChangePage,this.updateData);this.observe(Activity.ins().postRewardResult,this.updateData);if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var id=this.activityID;this.initPanelList();this.cruPanel=this.type29PanelList[id+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget29Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();if(this.cruPanel)this.cruPanel.close()};OSATarget29Panel.prototype.initPanelList=function(){var id=this.activityID;if(!this.type29PanelList[id+""]){var clsStr=OSATarget29Panel.targetIndex[id]||"OSATarget29Panel"+GlobalConfig.ActivityType29_1Config[id][1].showType;var Cls=egret.getDefinitionByName(clsStr);this.type29PanelList[id+""]=new Cls(this.activityID);this.type29PanelList[id+""].top=0;this.type29PanelList[id+""].bottom=0;this.type29PanelList[id+""].left=0;this.type29PanelList[id+""].right=0;this.type29PanelList[id+""].activityID=this.activityID}};OSATarget29Panel.prototype.updateData=function(){this.cruPanel.updateData()};OSATarget29Panel.targetIndex={4750:"OSATarget29Panel1"};return OSATarget29Panel}(ActivityPanel);__reflect(OSATarget29Panel.prototype,"OSATarget29Panel");var OSATarget29Panel1=function(_super){__extends(OSATarget29Panel1,_super);function OSATarget29Panel1(){var _this=_super.call(this)||this;_this.itemary=[];_this.dayindex=1;_this.itemList=[];_this.idx=1;_this.skinName="hefuCheckInSkin";_this.itemary=[];return _this}OSATarget29Panel1.prototype.initData=function(){};OSATarget29Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var config=GlobalConfig.ActivityType29_1Config[this.activityID];this.maxNum=0;this.itemList=[];this._activityData=Activity.ins().getActivityDataById(this.activityID);for(var i=0;i<=7;i++){this.itemList[i]=this["dayNum"+i];this.itemList[i].touchEnabled=false;if(config[i]){if(this["dayNum"+i]){this["dayNum"+i].visible=true}if(this["imgDay"+i]){this["imgDay"+i].visible=true}if(this["arrow"+i]){this["arrow"+i].visible=true}this.maxNum++}else{if(this["dayNum"+i]){this["dayNum"+i].visible=false}if(this["imgDay"+i]){this["imgDay"+i].visible=false}if(this["arrow"+i]){this["arrow"+i].visible=false}}var s=this._activityData.states[i];if(this["btn"+i]){this["btn"+i].visible=s==checkInType.CAN_RESIGN;this["btn"+i].name=""+i}}this.addTouchEvent(this.sureBtn,this.onTouch);this.addTouchEvent(this.group,this.onTouch);for(var i=0;i<this.maxNum;i++){if(this.itemList[i])this.addTouchEvent(this.itemList[i],this.itemTouch);if(this["btn"+i])this.addTouchEvent(this["btn"+i],this.btnTouch)}this.observe(Activity.ins().postActivityIsGetAwards,this.changeList);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateData();var dayNum=param[0];if(dayNum){this.setList(dayNum)}};OSATarget29Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.sureBtn,this.onTouch);this.removeTouchEvent(this.group,this.onTouch);DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<this.maxNum;i++){if(this.itemList[i])this.removeTouchEvent(this.itemList[i],this.itemTouch);if(this["btn"+i])this.removeTouchEvent(this["btn"+i],this.btnTouch)}this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget29Panel1.prototype.changeList=function(){var day=1;var dayNum=this._activityData.getCurDay();if(!dayNum){dayNum=day}if(dayNum>=this.maxNum)day=this.maxNum-1;else day=dayNum;for(var i=0;i<=day;i++){var config=GlobalConfig["ActivityType29_1Config"][this.activityID][i+""];var day_1=config.day||0;if(config){if(dayNum>=day_1){if(this._activityData.states[day_1]==checkInType.CAN_SIGN){this.setList(i);return}}}}if(this._activityData.states[0]==checkInType.SIGN){this.setList(0)}else{this.setList(day)}};OSATarget29Panel1.prototype.onTouch=function(e){switch(e.currentTarget){case this.sureBtn:var s=this._activityData.states[this.day];if(s==checkInType.CAN_SIGN)Activity.ins().sendReward(this.activityID,this.day);else UserTips.ins().showTips(i18n("OSATarget29Panel1_0"));break}};OSATarget29Panel1.prototype.itemTouch=function(e){this.setList(e.currentTarget.data)};OSATarget29Panel1.prototype.btnTouch=function(e){this.idx=Number(e.currentTarget.name);var resign_count=this._activityData.resign_count+1;var yb=GlobalConfig.ActivityType29_2Config[resign_count].cost||0;if(yb<=0){Activity.ins().sendReward(this.activityID,this.idx)}else{HuntWarnBuyWin.showBuyWarn("OSATarget29Panel1"+this.activityID,this.huntWarnFun.bind(this),i18n("OSATarget29Panel1_7",yb))}};OSATarget29Panel1.prototype.huntWarnFun=function(){var resign_count=this._activityData.resign_count+1;var yb=GlobalConfig.ActivityType29_2Config[resign_count].cost||0;if(Actor.yb>=yb){Activity.ins().sendReward(this.activityID,this.idx)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("LuckyResultWin_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("LuckyResultWin_4"))}};OSATarget29Panel1.prototype.setList=function(index){if(index===void 0){index=-1}if(index==-1){index=this.dayindex}if(index>this.maxNum){index=this.maxNum}this.dayindex=index;var conf=GlobalConfig["ActivityType29_1Config"][this.activityID][index+""];var list=conf.rewards;this.day=conf.day||0;var today=1;today=this._activityData.getCurDay();var sign_count=this._activityData.sign_count;this.daylabel.text=i18n("OSATarget29Panel1_1",sign_count);this.daylabel.visible=true;var s=this._activityData.states[this.day];this.dayaward.text=this.day>0?i18n("OSATarget29Panel1_2",TextFlowMaker.getCStr(index)):i18n("OSATarget29Panel1_8");this.sureBtn.visible=true;this.sureBtn.label=this.day!=0?i18n("OSATarget29Panel1_9"):i18n("OSATarget29Panel1_10");if(this.day!=0&&today>=this.day||this.day==0&&s!=checkInType.NONE){if(s==checkInType.CAN_SIGN){this.btnMC=this.btnMC||new MovieClip;this.btnMC.x=this.sureBtn.width/2;this.btnMC.y=this.sureBtn.height/2-5;this.btnMC.playFile(RES_DIR_EFF+"chargeff1",-1);this.sureBtn.addChild(this.btnMC);this.redPoint.visible=true}else if(s==checkInType.CAN_RESIGN){this.sureBtn.visible=false;this.redPoint.visible=false;this.state.text=i18n("OSATarget29Panel1_6")}else if(s==checkInType.SIGN||s==checkInType.RESIGN){this.sureBtn.visible=false;this.redPoint.visible=false;this.state.text=this.day!=0?i18n("OSATarget29Panel1_5"):i18n("OSATarget29Panel1_11")}else{this.sureBtn.visible=false;this.redPoint.visible=false;this.state.text=""}}else{DisplayUtils.removeFromParent(this.btnMC);this.sureBtn.visible=false;this.redPoint.visible=false;this.state.text=""}this.itemary.forEach(function(element){if(element.parent){element.parent.removeChild(element);element=null}});this.itemary=[];for(var i=0;i<list.length;i++){var item=new ItemBase;this.group1.addChild(item);item.data=list[i];this.itemary.push(item)}for(var i=0;i<this.maxNum;i++){this.itemList[i].activityID=this.activityID;this.itemList[i].data=i;if(i==index||i+1==this.maxNum&&index+1==this.maxNum){this.itemList[i].setSelectImg(true)}else{this.itemList[i].setSelectImg(false)}}this.showRedPoint()};OSATarget29Panel1.prototype.showRedPoint=function(){};OSATarget29Panel1.prototype.updateData=function(){this.changeList();this.showRedPoint();this.setTime()};OSATarget29Panel1.prototype.setTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget29Panel1_3")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget29Panel1_4")}else{this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}};return OSATarget29Panel1}(BaseView);__reflect(OSATarget29Panel1.prototype,"OSATarget29Panel1");var ActivityHFRenderItem2=function(_super){__extends(ActivityHFRenderItem2,_super);function ActivityHFRenderItem2(){return _super.call(this)||this}ActivityHFRenderItem2.prototype.dataChanged=function(){var activityID=this.activityID;var _activityData=Activity.ins().getActivityDataById(activityID);var index=this.data;var config=GlobalConfig["ActivityType29_1Config"][activityID][index+""];var s=_activityData.states[config.day||0];if(s==checkInType.SIGN||s==checkInType.RESIGN){this.select.visible=false;this.checkedMask.visible=this.checked.visible=true}else{this.checkedMask.visible=this.checked.visible=false}this.item.data=config.rewards[0];if(index==0&&s==checkInType.CAN_SIGN){if(this.mc)this.mc.destroy();this.mc=new MovieClip;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.addChild(this.mc);this.mc.x=this.width/2;this.mc.y=this.height/2-9;this.mc.scaleX=.5;this.mc.scaleY=1.4}};return ActivityHFRenderItem2}(SevenDayItemRender);__reflect(ActivityHFRenderItem2.prototype,"ActivityHFRenderItem2");var OSATarget2Panel=function(_super){__extends(OSATarget2Panel,_super);function OSATarget2Panel(){var _this=_super.call(this)||this;_this.type2PanelList=[];return _this}OSATarget2Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget2Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var config;if(this.activityType==ActivityType.Normal){config=GlobalConfig.ActivityType2Config[this.activityID]}else if(this.activityType==ActivityType.Personal){config=GlobalConfig.PActivity2Config[this.activityID]}if(!this.type2PanelList[this.activityID+""]){var panel=ObjectPool.pop("OSATarget2Panel"+config[1].showType);panel.top=0;panel.bottom=0;panel.left=0;panel.right=0;panel.activityID=this.activityID;panel.activityType=this.activityType;this.type2PanelList[this.activityID+""]=panel}this.cruPanel=this.type2PanelList[this.activityID+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget2Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget2Panel.prototype.initPanelList=function(){var config;if(this.activityType==ActivityType.Normal){config=GlobalConfig.ActivityConfig[this.activityID]}else if(this.activityType==ActivityType.Personal){config=GlobalConfig.PActivityConfig[this.activityID]}if(!this.type2PanelList[this.activityID+""]){this.type2PanelList[this.activityID+""]=new OSATarget2Panel2;this.type2PanelList[this.activityID+""].activityID=this.activityID;this.type2PanelList[this.activityID+""].actType=this.activityType}};OSATarget2Panel.prototype.updateData=function(){this.cruPanel.updateData()};return OSATarget2Panel}(ActivityPanel);__reflect(OSATarget2Panel.prototype,"OSATarget2Panel");var OSATarget2Panel1=function(_super){__extends(OSATarget2Panel1,_super);function OSATarget2Panel1(){var _this=_super.call(this)||this;_this._time=0;return _this}OSATarget2Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.gift.itemRenderer=OSATargetItemRender1};OSATarget2Panel1.prototype.setCurSkin=function(){var aCon;if(this.activityType==ActivityType.Normal){aCon=GlobalConfig.ActivityConfig[this.activityID]}else if(this.activityType==ActivityType.Personal){aCon=GlobalConfig.PActivityConfig[this.activityID]}if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="OSADailyGiftSkin"};Object.defineProperty(OSATarget2Panel1.prototype,"activityID",{get:function(){return this._activityID},set:function(value){this._activityID=value;this.activityType=ActivityPanel.getActivityTypeFromId(this._activityID);this.setCurSkin()},enumerable:true,configurable:true});OSATarget2Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();this.observe(Activity.ins().postRewardResult,this.GetCallBack);this.observe(PActivity.ins().postRewardResult,this.GetCallBack);TimerManager.ins().doTimer(1e3,0,this.setTime,this);if(!this.dataArr){this.dataArr=new eui.ArrayCollection;this.gift.dataProvider=this.dataArr}this.updateData()};OSATarget2Panel1.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget2Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this);this.removeObserve()};OSATarget2Panel1.prototype.GetCallBack=function(activityID){this.updateData()};OSATarget2Panel1.prototype.onTap=function(e){switch(e.currentTarget){}};OSATarget2Panel1.prototype.updateData=function(){var activityData;var actcfg;var config;if(this.activityType==ActivityType.Normal){activityData=Activity.ins().getActivityDataById(this.activityID);actcfg=GlobalConfig.ActivityConfig[this.activityID];config=GlobalConfig.ActivityType2Config[this.activityID]}else if(this.activityType==ActivityType.Personal){activityData=PActivity.ins().getActivityDataById(this.activityID);actcfg=GlobalConfig.PActivityConfig[this.activityID];config=GlobalConfig.PActivity2Config[this.activityID]}var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime1.text=i18n("OSATarget2Panel1_0")}else if(endedTime<=0){this.actTime1.text=i18n("OSATarget2Panel1_1")}else{this._time=endedTime;if(this._time<0)this._time=0;this.actTime1.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.actDesc.text=actcfg.desc;var arrconfig=[];for(var k in config){arrconfig.push(config[k])}this.dataArr.replaceAll(arrconfig)};return OSATarget2Panel1}(BaseView);__reflect(OSATarget2Panel1.prototype,"OSATarget2Panel1");var OSATarget2Panel2=function(_super){__extends(OSATarget2Panel2,_super);function OSATarget2Panel2(){var _this=_super.call(this)||this;_this._index=0;_this.skinName="OSAGift";return _this}OSATarget2Panel2.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.activityType=ActivityPanel.getActivityTypeFromId(this.activityID);var idx=this.getRule();this.updateData(idx)};OSATarget2Panel2.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.buy,this.onTap);this.addTouchEvent(this.szlb,this.onTap);this.addTouchEvent(this.lhlb,this.onTap);this.addTouchEvent(this.yylb,this.onTap);this.addTouchEvent(this.sblb,this.onTap);this.observe(Activity.ins().postRewardResult,this.GetCallBack);this.observe(PActivity.ins().postRewardResult,this.GetCallBack);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.hideSelect();var idx=this.getRule();this.updateData(idx)};OSATarget2Panel2.prototype.hideSelect=function(){for(var i=0;i<4;i++){this["select"+i].visible=false;this["arrow"+i].visible=false;this["select"+i].visible=false}};OSATarget2Panel2.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buy,this.onTap);this.removeTouchEvent(this.szlb,this.onTap);this.removeTouchEvent(this.lhlb,this.onTap);this.removeTouchEvent(this.yylb,this.onTap);this.removeTouchEvent(this.sblb,this.onTap);this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget2Panel2.prototype.GetCallBack=function(activityID){if(this.activityID!=activityID)return;var ins;var activityData;if(this.activityType==ActivityType.Normal){ins=Activity.ins();activityData=ins.getActivityDataById(this.activityID)}else if(this.activityType==ActivityType.Personal){ins=PActivity.ins();activityData=ins.getActivityDataById(this.activityID)}if(!ins.isSuccee){UserTips.ins().showTips(i18n("OSATarget2Panel2_4"));ins.sendChangePage(activityData.id)}ins.isSuccee=false;this.hideSelect();var idx=this.getRule();this.updateData(idx)};OSATarget2Panel2.prototype.onTap=function(e){var index;switch(e.currentTarget){case this.buy:if(this.config.vip&&UserVip.ins().lv<this.config.vip){var warnWin=WarnWin.show(i18n("OSATarget2Panel2_6"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget2Panel2_7"))}else{if(UserBag.ins().getSurplusCount()<7){UserTips.ins().showTips(i18n("OSATarget2Panel2_8"));return}if(Actor.yb>=this.config.price){if(this.activityType==ActivityType.Normal){Activity.ins().sendReward(this.activityID,this._index)}else if(this.activityType==ActivityType.Personal){PActivity.ins().sendReward(this.activityID,this._index)}}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget2Panel2_12"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget2Panel2_13"))}}index=-1;break;case this.lhlb:index=1;break;case this.yylb:index=2;break;case this.szlb:index=3;break;case this.sblb:index=4;break}if(index!=-1){for(var i=0;i<4;i++){if(index!=i+1)this["select"+i].visible=false;else this["select"+i].visible=true;this["arrow"+i].visible=this["select"+i].visible}this.updateData(index)}};OSATarget2Panel2.prototype.getRule=function(){var activityData;var tmplist;if(this.activityType==ActivityType.Normal){activityData=Activity.ins().getActivityDataById(this.activityID);tmplist=GlobalConfig.ActivityType2Config[this.activityID]}else if(this.activityType==ActivityType.Personal){activityData=PActivity.ins().getActivityDataById(this.activityID);tmplist=GlobalConfig.PActivity2Config[this.activityID]}var listData=[];for(var k in tmplist){listData.push(tmplist[k])}listData.sort(this.sortFunc);for(var i=0;i<listData.length;i++){var config=listData[i];var isBuy=activityData.buyData[config.index]>=config.count?true:false;if(!isBuy)return config.index}return 2};OSATarget2Panel2.prototype.sortFunc=function(aConfig,bConfig){if(aConfig.price<bConfig.price)return-1;if(aConfig.price>bConfig.price)return 1;return 0};OSATarget2Panel2.prototype.updateData=function(index){if(index===void 0){index=2}this._index=index;this["select"+(index-1)].visible=true;this["arrow"+(index-1)].visible=true;var activityData;var btncfg;var con2fig;if(this.activityType==ActivityType.Normal){activityData=Activity.ins().getActivityDataById(this.activityID);this.config=GlobalConfig.ActivityType2Config[this.activityID][index];btncfg=GlobalConfig.ActivityBtnConfig[this.activityID];con2fig=GlobalConfig.ActivityType2Config[this.activityID]}else if(this.activityType==ActivityType.Personal){activityData=PActivity.ins().getActivityDataById(this.activityID);this.config=GlobalConfig.PActivity2Config[this.activityID][index];btncfg=GlobalConfig.PActivityBtnConfig[this.activityID];con2fig=GlobalConfig.PActivity2Config[this.activityID]}this.setTime();if(btncfg)this.title.source=btncfg.title;this.desc3.text=this.config.price+"";this.desc5.text=this.config.giftName;for(var i=0;i<this.config.rewards.length;i++){var rew=this.config.rewards[i];this["item"+i].data={type:rew.type,count:rew.count,id:rew.id}}var isBuy=activityData.buyData[this._index]>=this.config.count?true:false;this.buy.visible=!isBuy;this.already.visible=isBuy;this.actTime.visible=!this.already.visible;this.showbg.source=this.config.source?this.config.source[2]+"_png":"";this.redPoint.visible=this.buy.visible&&Actor.yb>=this.config.price;if(Actor.level<ActivityType2Data.LimitLevel)this.redPoint.visible=false;for(var i in con2fig){var cfg=con2fig[i];if(!cfg||!cfg.source){continue}if(cfg&&cfg.source[0]){this["bg"+(+i-1)].source=cfg.source[0]}if(cfg&&cfg.source[1]){}}};OSATarget2Panel2.prototype.setTime=function(){var activityData;if(this.activityType==ActivityType.Normal){activityData=Activity.ins().getActivityDataById(this.activityID)}else if(this.activityType==ActivityType.Personal){activityData=PActivity.ins().getActivityDataById(this.activityID)}var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget2Panel2_17")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget2Panel2_18")}else{this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}};return OSATarget2Panel2}(BaseView);__reflect(OSATarget2Panel2.prototype,"OSATarget2Panel2");var OSATarget2Panel3=function(_super){__extends(OSATarget2Panel3,_super);function OSATarget2Panel3(){var _this=_super.call(this)||this;_this._time=0;_this._curPage=1;_this._maxPage=1;return _this}OSATarget2Panel3.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward0.itemRenderer=ItemBase};OSATarget2Panel3.prototype.setCurSkin=function(){var aCon;if(this.activityType==ActivityType.Normal){aCon=GlobalConfig.ActivityConfig[this.activityID]}else if(this.activityType==ActivityType.Personal){aCon=GlobalConfig.PActivityConfig[this.activityID]}if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="SFVipGiftSkin"};Object.defineProperty(OSATarget2Panel3.prototype,"activityID",{get:function(){return this._activityID},set:function(value){this._activityID=value;this.activityType=ActivityPanel.getActivityTypeFromId(this._activityID);this.setCurSkin()},enumerable:true,configurable:true});OSATarget2Panel3.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();this.observe(Activity.ins().postRewardResult,this.GetCallBack);this.observe(PActivity.ins().postRewardResult,this.GetCallBack);this.addTouchEvent(this,this.onTouch);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateData()};OSATarget2Panel3.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget2Panel3.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this);this.removeObserve();this.removeTouchEvent(this,this.onTouch)};OSATarget2Panel3.prototype.GetCallBack=function(activityID){this.updateData()};OSATarget2Panel3.prototype.onTap=function(e){switch(e.currentTarget){}};OSATarget2Panel3.prototype.updateData=function(){if(this.activityType==ActivityType.Normal){this._activityData=Activity.ins().getActivityDataById(this.activityID);this._config=GlobalConfig.ActivityType2Config[this.activityID]}else if(this.activityType==ActivityType.Personal){this._activityData=PActivity.ins().getActivityDataById(this.activityID);this._config=GlobalConfig.PActivity2Config[this.activityID]}var beganTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime0.text=i18n("OSATarget2Panel3_0")}else if(endedTime<=0){this.actTime0.text=i18n("OSATarget2Panel3_1")}else{this._time=endedTime;if(this._time<0)this._time=0;this.actTime0.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this._maxPage=Object.keys(this._config).length;this._curPage=1;var config;for(var i=1;i<=this._maxPage;i++){config=this._config[i];if(this._activityData.buyData[config.index]<config.count){this._curPage=i;break}}this.updatePage()};OSATarget2Panel3.prototype.updatePage=function(){this.turnBackBtn.visible=this._curPage>1;this.turnNextBtn.visible=this._curPage<this._maxPage;var config=this._config[this._curPage];this.ggtxt0.source="viptitle"+config.index+"_png";this.tu0.source="vipshow"+config.index+"_png";this.vipLv0.text=config.vip+"";this.times0.text=i18n("OSATarget2Panel3_2")+config.count+i18n("OSATarget2Panel3_3");this.get0.label=config.price+i18n("OSATarget2Panel3_4");if(!this._collect){this._collect=new ArrayCollection;this.reward0.dataProvider=this._collect}this._collect.source=config.rewards;this.buyred.visible=false;this.already0.visible=false;this.get0.visible=true;if(this._activityData.buyData[config.index]>=config.count){this.isGet=false;this.already0.visible=true;this.get0.visible=false}else{this.isGet=UserVip.ins().lv>=config.vip&&Actor.yb>=config.price;this.buyred.visible=this.isGet}this.leftred.visible=this.rightred.visible=false;for(var i=1;i<this._curPage;i++){config=this._config[i];if(this._activityData.buyData[config.index]<config.count&&UserVip.ins().lv>=config.vip&&Actor.yb>=config.price){this.leftred.visible=true;break}}for(var i=this._curPage+1;i<=this._maxPage;i++){config=this._config[i];if(this._activityData.buyData[config.index]<config.count&&UserVip.ins().lv>=config.vip&&Actor.yb>=config.price){this.rightred.visible=true;break}}};OSATarget2Panel3.prototype.onTouch=function(e){switch(e.target){case this.get0:var config=this._config[this._curPage];if(this.isGet){if(config instanceof ActivityType2Config)Activity.ins().sendReward(config.Id,config.index);else if(config instanceof PActivity2Config)PActivity.ins().sendReward(config.Id,config.index)}else{if(UserVip.ins().lv<config.vip){var warnWin=WarnWin.show(i18n("OSATarget2Panel3_6"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget2Panel3_7"))}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget2Panel3_8"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget2Panel3_9"))}}break;case this.turnBackBtn:if(this._curPage>1){this._curPage--;this.updatePage()}break;case this.turnNextBtn:if(this._curPage<this._maxPage){this._curPage++;this.updatePage()}break}};return OSATarget2Panel3}(BaseView);__reflect(OSATarget2Panel3.prototype,"OSATarget2Panel3");var OSATarget3BigRewardItemRender=function(_super){__extends(OSATarget3BigRewardItemRender,_super);function OSATarget3BigRewardItemRender(){return _super.call(this)||this}OSATarget3BigRewardItemRender.prototype.setData=function(actId,index){this.reward.touchEnabled=false;var config=GlobalConfig.ActivityType3Config[actId][index];var act=Activity.ins().getActivityDataById(actId);this.days.text=i18n("OSATarget3BigRewardItemRender_0",act.dabiao[index-1],config.day);this.reward.data=config.rewards[0];this.reward.isShowName(false);if((act.recrod>>index&1)==1){this.state.visible=true}else{this.state.visible=false}};OSATarget3BigRewardItemRender.prototype.showEquipEffect=function(b){if(!b){if(this.EquipEffect)DisplayUtils.removeFromParent(this.EquipEffect)}else{this.EquipEffect=this.EquipEffect||new MovieClip;this.EquipEffect.touchEnabled=false;this.EquipEffect.x=45;this.EquipEffect.y=48;this.EquipEffect.scaleX=1.6;this.EquipEffect.scaleY=1.6;if(!this.EquipEffect.parent)this.addChild(this.EquipEffect);this.EquipEffect.playFile(RES_DIR_EFF+"quaeff4",-1)}};OSATarget3BigRewardItemRender.prototype.setSelected=function(b){this.select.visible=b};return OSATarget3BigRewardItemRender}(BaseComponent);__reflect(OSATarget3BigRewardItemRender.prototype,"OSATarget3BigRewardItemRender");var OSATarget3ItemRender6=function(_super){__extends(OSATarget3ItemRender6,_super);function OSATarget3ItemRender6(){var _this=_super.call(this)||this;_this.skinName="DailyRechargeItemSkin";return _this}OSATarget3ItemRender6.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);this.reward.itemRenderer=ItemBase;this.isGet=true};OSATarget3ItemRender6.prototype.onClick=function(e){var ins;var config;var activityData;if(this.data instanceof ActivityType3Config){ins=Activity.ins();config=GlobalConfig.ActivityType3Config[this.actId][this.index];activityData=ins.getActivityDataById(this.actId)}else if(this.data instanceof PActivity3Config){ins=PActivity.ins();config=GlobalConfig.PActivity3Config[this.actId][this.index];activityData=ins.getActivityDataById(this.actId)}switch(e.target){case this.get:if(this.isGet){ins.sendReward(this.actId,this.index)}else{var tips=0;switch(config.showType){case Show3Type.TYPE6:if(activityData.chongzhiTotal<config.val)tips=config.val-activityData.chongzhiTotal;break}if(!tips){Activity.ins().sendReward(this.actId,this.index);return}if(config.showType==Show3Type.TYPE6&&activityData.chongzhiTotal<config.val)UserTips.ins().showTips(i18n("OSATarget3ItemRender6_0"))}break}};OSATarget3ItemRender6.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var config;var activityData;if(this.data instanceof ActivityType3Config){config=this.data;activityData=Activity.ins().getActivityDataById(config.Id)}else if(this.data instanceof PActivity3Config){config=this.data;activityData=PActivity.ins().getActivityDataById(config.Id)}this.reward.dataProvider=new eui.ArrayCollection(config.rewards);this.target.text=i18n("OSATarget3ItemRender6_1",config.val);var color=65280;if(activityData.chongzhiTotal<config.val){color=16711680}this.recharge.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget3ItemRender6_4",color,activityData.chongzhiTotal,65280,config.val));var btnType=activityData.getRewardStateById(config.index);switch(btnType){case Activity.NotReached:this.get.label=i18n("OSATarget3ItemRender6_2");this.get.currentState="disabled";this.isGet=false;this.redPoint.visible=false;break;case Activity.CanGet:this.get.label=i18n("OSATarget3ItemRender6_3");this.get.currentState="up";this.isGet=true;this.redPoint.visible=true;break;case Activity.Geted:this.isGet=false;this.redPoint.visible=false;this.get.visible=false;this.already.visible=true;break}this.actId=config.Id;this.index=config.index};return OSATarget3ItemRender6}(BaseItemRender);__reflect(OSATarget3ItemRender6.prototype,"OSATarget3ItemRender6");var OSATarget3ItemRender7=function(_super){__extends(OSATarget3ItemRender7,_super);function OSATarget3ItemRender7(){var _this=_super.call(this)||this;_this.skinName="OSAItem";return _this}OSATarget3ItemRender7.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);this.rewardList.itemRenderer=ItemBase;this.isGet=true};OSATarget3ItemRender7.prototype.onClick=function(e){switch(e.target){case this.get0:if(this.isGet){if(this.data instanceof ActivityType3Config){Activity.ins().sendReward(this.actId,this.index)}else if(this.data instanceof PActivity3Config){PActivity.ins().sendReward(this.actId,this.index)}}else{var config=void 0;var activityData=void 0;var ins=void 0;if(this.data instanceof ActivityType3Config){config=GlobalConfig.ActivityType3Config[this.actId][this.index];ins=Activity.ins();activityData=ins.getActivityDataById(this.actId)}else if(this.data instanceof PActivity3Config){config=GlobalConfig.PActivity3Config[this.actId][this.index];ins=PActivity.ins();activityData=ins.getActivityDataById(this.actId)}var tips=0;switch(config.showType){case Show3Type.TYPE7:if(activityData.dabiao[this.index-1]<config.day)tips=config.day-activityData.dabiao[this.index-1];break}if(!tips){ins.sendReward(this.actId,this.index);return}if(config.showType==Show3Type.TYPE7&&activityData.dabiao[this.index-1]<config.day)UserTips.ins().showTips(i18n("OSATarget3ItemRender7_0")+ +tips+i18n("OSATarget3ItemRender7_1"))}break}};OSATarget3ItemRender7.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var config;var ins;var activityData;if(this.data instanceof ActivityType3Config){config=this.data;ins=Activity.ins();activityData=ins.getActivityDataById(config.Id)}else if(this.data instanceof PActivity3Config){config=this.data;ins=PActivity.ins();activityData=ins.getActivityDataById(config.Id)}this.num.text=config.day+"";this.rewardList.dataProvider=new eui.ArrayCollection(config.rewards);var btnType=activityData.getRewardStateById(config.index);switch(btnType){case Activity.NotReached:this.get0.label=i18n("OSATarget3ItemRender7_2");this.get0.currentState="disabled";this.isGet=false;this.redPoint.visible=false;break;case Activity.CanGet:this.get0.label=i18n("OSATarget3ItemRender7_3");this.get0.currentState="up";this.isGet=true;this.redPoint.visible=true;break;case Activity.Geted:this.isGet=false;this.redPoint.visible=false;this.get0.visible=false;this.already.visible=true;break}this.actId=config.Id;this.index=config.index};return OSATarget3ItemRender7}(BaseItemRender);__reflect(OSATarget3ItemRender7.prototype,"OSATarget3ItemRender7");var OSATarget3Panel=function(_super){__extends(OSATarget3Panel,_super);function OSATarget3Panel(){var _this=_super.call(this)||this;_this.type3PanelList=[];return _this}OSATarget3Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.initPanelList()};OSATarget3Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.observe(Activity.ins().postChangePage,this.updateData);this.observe(Activity.ins().postRewardResult,this.updateData);this.observe(PActivity.ins().postActivityIsGetAwards,this.updateData);this.observe(PActivity.ins().postChangePage,this.updateData);this.observe(PActivity.ins().postRewardResult,this.updateData);if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var id=this.activityID;this.initPanelList();this.cruPanel=this.type3PanelList[id+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget3Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();if(this.cruPanel)this.cruPanel.close()};OSATarget3Panel.prototype.initPanelList=function(){var clsStr="";var id=this.activityID;var config;if(this.activityType==ActivityType.Normal){config=GlobalConfig.ActivityType3Config[id]}else if(this.activityType==ActivityType.Personal){config=GlobalConfig.PActivity3Config[id]}for(var i in config){if(!OSATarget3Panel.targetIndex[config[i].showType])continue;clsStr=OSATarget3Panel.targetIndex[config[i].showType];break}if(!clsStr)return;if(!this.type3PanelList[id+""]){var Cls=egret.getDefinitionByName(clsStr);this.type3PanelList[id+""]=new Cls(id);this.type3PanelList[id+""].top=0;this.type3PanelList[id+""].bottom=0;this.type3PanelList[id+""].left=0;this.type3PanelList[id+""].right=0;this.type3PanelList[id+""].activityID=id}};OSATarget3Panel.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData()};OSATarget3Panel.targetIndex={1:"OSATarget3Panel3",2:"OSATarget3Panel2",3:"OSATarget3Panel4",4:"DailyRechargePanel",5:"OSATarget3Panel5",6:"OSATarget3Panel6",7:"OSATarget3Panel7",8:"OSATarget3Panel8",9:"OSATarget3Panel9",10:"OSATarget3Panel10"};return OSATarget3Panel}(ActivityPanel);__reflect(OSATarget3Panel.prototype,"OSATarget3Panel");var OSATarget3Panel1=function(_super){__extends(OSATarget3Panel1,_super);function OSATarget3Panel1(){var _this=_super.call(this)||this;_this._state=0;_this._index=1;_this._time=0;_this.skinName="OSASeriesRechargeSkin";return _this}OSATarget3Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};OSATarget3Panel1.prototype.open=function(){this.addTouchEvent(this.getBtn,this.onTap);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.initData()};OSATarget3Panel1.prototype.initData=function(){var act=Activity.ins().getActivityDataById(this.activityID);var index=act.getCurIndex();this._index=index;var config=GlobalConfig.ActivityType3Config[this.activityID][index];this.reward.dataProvider=new eui.ArrayCollection(config.rewards);this.redPoint.visible=false;this.state.visible=true;if((act.dabiao[index-1]||0)>=config.day){var state=act.recrod>>index&1;if(state==0){this.getBtn.label=i18n("OSATarget3Panel1_0");this.getBtn.visible=true;this.getBtn.enabled=true;this.already.visible=false;this.redPoint.visible=true;this._state=1}else{this.getBtn.label=i18n("OSATarget3Panel1_1");this.getBtn.visible=false;this.already.visible=true;this.state.visible=false;this._state=2}this.state.textColor=65280}else{this.getBtn.label=i18n("OSATarget3Panel1_2");this.getBtn.visible=true;this.getBtn.enabled=false;this.already.visible=false;this.state.textColor=16750848;this._state=0}this.state.text=i18n("OSATarget3Panel1_3",act.dabiao[index-1]||0,config.day);this.updateTime()};OSATarget3Panel1.prototype.updateTime=function(){var act=Activity.ins().getActivityDataById(this.activityID);var sec=act.getLeftTime();this._time=sec;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);var config=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=config.desc};OSATarget3Panel1.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget3Panel1.prototype.onTap=function(){if(this._state==1){Activity.ins().sendReward(this.activityID,this._index)}};OSATarget3Panel1.prototype.close=function(){this.removeTouchEvent(this.getBtn,this.onTap);TimerManager.ins().removeAll(this)};OSATarget3Panel1.prototype.updateData=function(){this.initData()};return OSATarget3Panel1}(BaseView);__reflect(OSATarget3Panel1.prototype,"OSATarget3Panel1");var OSATarget3Panel10=function(_super){__extends(OSATarget3Panel10,_super);function OSATarget3Panel10(){var _this=_super.call(this)||this;_this.selectRes=["sd_projecttitle2","sd_projecttitle1"];_this.pageRedPoint=[false,false,false];return _this}OSATarget3Panel10.prototype.initSkin=function(){var config=GlobalConfig.ActivityConfig[this.activityID];if(config.pageSkin)this.skinName=config.pageSkin;else this.skinName="KMHRechargeSkin"};OSATarget3Panel10.prototype.close=function(){this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget3Panel10.prototype.open=function(){this.initSkin();this.observe(Activity.ins().postRewardResult,this.updateDataCall);this.observe(Activity.ins().postChangePage,this.updateDataCall);for(var i=0;i<3;i++){this["projectbg"+i].name=i.toString();this.addTouchEvent(this["projectbg"+i],this.onTap)}this.rechargeitem.itemRenderer=KaiMenItem;this.rechargeitemData=new eui.ArrayCollection;this.rechargeitem.dataProvider=this.rechargeitemData;this.initData();TimerManager.ins().doTimer(1e3,0,this.updateTime,this)};OSATarget3Panel10.prototype.updateTime=function(){var act=Activity.ins().getActivityDataById(this.activityID);var sec=act.getLeftTime();this.actTime.text=DateUtils.getFormatBySecond(sec,DateUtils.TIME_FORMAT_5,3)};OSATarget3Panel10.prototype.updatePageRedPoint=function(arr){for(var i=0;i<arr.length;i++){if(arr[i].redPoint)return true}return false};OSATarget3Panel10.prototype.updateList=function(id){var config=GlobalConfig.ActivityType3Config[id];var act=Activity.ins().getActivityDataById(id);var arr=[];for(var j in config){var kmd=new KaiMenData;kmd.id=config[j].Id;kmd.index=config[j].index;kmd.type=config[j].type;kmd.day=config[j].day;kmd.reward=config[j].rewards;kmd.already=act.recrod>>config[j].index&1?true:false;if(kmd.type==3){kmd.unready=act.isOverTimer(config[j].index);if(act.curOpenDay()+1==config[j].day){kmd.redPoint=act.chongzhiNum>=config[j].val?true:false}else{kmd.redPoint=false}}else if(kmd.type==1){kmd.unready=act.dabiao[config[j].index-1]<config[j].day;kmd.redPoint=!kmd.already&&!kmd.unready}if(kmd.unready){kmd.already=kmd.redPoint=false}else{kmd.redPoint=kmd.already?false:kmd.redPoint}arr.push(kmd)}return arr};OSATarget3Panel10.prototype.onTap=function(e){for(var i=0;i<3;i++){this["projectbg"+i].source=this.selectRes[0];if(e.currentTarget==this["projectbg"+i]){this.actIndex=i;this["projectbg"+i].source=this.selectRes[1];var id=this.actIds[this.actIndex];var arr=this.updateList(id);this.rechargeitemData.replaceAll(arr)}}};OSATarget3Panel10.prototype.initData=function(){var config=GlobalConfig.ActivityType3Config[this.activityID];this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc;this.actIds=[];this.actIds.push(this.activityID);for(var i=1;i<=config[1].activityID.length;i++){this.actIds.push(config[1].activityID[i-1])}this.actIndex=this.getRuleIndex();this.updateTime();this.updateData1();var btnconfig=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnconfig){this.title.source=btnconfig.title}};OSATarget3Panel10.prototype.getRuleIndex=function(){var index=0;return index};OSATarget3Panel10.prototype.updateDataCall=function(activityID){if(this.actIds.indexOf(activityID)==-1)return;this.updateData1()};OSATarget3Panel10.prototype.updateData1=function(){for(var i=0;i<3;i++){this["projectbg"+i].source=this.selectRes[0]}this["projectbg"+this.actIndex].source=this.selectRes[1];for(var i=0;i<this.actIds.length;i++){var tmpId=this.actIds[i];var arr=this.updateList(tmpId);this["redpoint"+i].visible=this.updatePageRedPoint(arr);if(i==this.actIndex){this.rechargeitemData.replaceAll(arr)}}var act=Activity.ins().getActivityDataById(this.actIds[this.actIndex]);this.rechargeCoumt.text=i18n("OSATarget3Panel10_0",Math.floor(act.chongzhiNum/100))};OSATarget3Panel10.prototype.updateData=function(){};return OSATarget3Panel10}(BaseView);__reflect(OSATarget3Panel10.prototype,"OSATarget3Panel10");var OSATarget3Panel2=function(_super){__extends(OSATarget3Panel2,_super);function OSATarget3Panel2(){var _this=_super.call(this)||this;_this._state=0;_this._index=1;_this._time=0;_this.skinName="OSATotalRechargeSkin";return _this}OSATarget3Panel2.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};OSATarget3Panel2.prototype.open=function(){this.addTouchEvent(this.getBtn,this.onTap);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.initData();var mc=new MovieClip;mc.playFile(RES_DIR_ROLE+"body805_0_c",-1);this.bodyMc.addChild(mc)};OSATarget3Panel2.prototype.initData=function(){if(!this.rechargeBar){this.rechargeBar=new ProgressBarEff;this.rechargeBar.setWidth(520);this.rechargeBar.x=-272;this.rechargeBar.y=0;this.process.addChild(this.rechargeBar)}var config;var act;var index;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);index=act.getCurIndex();config=GlobalConfig.ActivityType3Config[this.activityID][index]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);index=act.getCurIndex();config=GlobalConfig.PActivity3Config[this.activityID][index]}this._index=index;this.reward.dataProvider=new eui.ArrayCollection(config.rewards);this.redPoint.visible=false;this.state.visible=true;if(act.chongzhiTotal>=config.val){var state=act.recrod>>index&1;if(state==0){this.getBtn.label=i18n("OSATarget3Panel2_0");this.getBtn.visible=true;this.getBtn.enabled=true;this.already.visible=false;this.redPoint.visible=true;this._state=1}else{this.getBtn.label=i18n("OSATarget3Panel2_1");this.getBtn.visible=false;this.already.visible=true;this.state.visible=false;this._state=2}this.state.textColor=65280}else{this.getBtn.label=i18n("OSATarget3Panel2_2");this.getBtn.visible=true;this.getBtn.enabled=false;this.already.visible=false;this.state.textColor=16750848;this._state=0}this.state.text=i18n("OSATarget3Panel2_3",act.chongzhiTotal,config.val);this.rechargeBar.setData(act.chongzhiTotal,config.val);this.rechargeBar.setLbValueText("");this.updateTime()};OSATarget3Panel2.prototype.updateTime=function(){var act;var config;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);config=GlobalConfig.ActivityConfig[this.activityID]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);config=GlobalConfig.PActivityConfig[this.activityID]}var sec=act.getLeftTime();this._time=sec;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);this.actDesc.text=config.desc};OSATarget3Panel2.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget3Panel2.prototype.onTap=function(){if(this._state==1){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){UserTips.ins().showTips(i18n("OSATarget3Panel2_4"));return}if(this.actType==ActivityType.Normal){Activity.ins().sendReward(this.activityID,this._index)}else if(this.actType==ActivityType.Personal){PActivity.ins().sendReward(this.activityID,this._index)}}};OSATarget3Panel2.prototype.close=function(){this.removeTouchEvent(this.getBtn,this.onTap);TimerManager.ins().removeAll(this)};OSATarget3Panel2.prototype.updateData=function(){this.initData()};return OSATarget3Panel2}(BaseView);__reflect(OSATarget3Panel2.prototype,"OSATarget3Panel2");var OSATarget3Panel3=function(_super){__extends(OSATarget3Panel3,_super);function OSATarget3Panel3(){var _this=_super.call(this)||this;_this.skinName="OSASeriesRechargeSkin";return _this}OSATarget3Panel3.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};OSATarget3Panel3.prototype.open=function(){this.addTouchEvent(this.getBtn,this.onTap);this.addTouchEvent(this.gift0,this.onTap);this.addTouchEvent(this.gift1,this.onTap);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.show1Mc.removeChildren();var mc=new MovieClip;this.show1Mc.addChild(mc);this.show1McMc=mc;this.initData()};OSATarget3Panel3.prototype.initData=function(){var act;var configs;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);configs=GlobalConfig.ActivityType3Config[this.activityID]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);configs=GlobalConfig.PActivity3Config[this.activityID]}var minIndex=-1;var indexStr=Object.keys(configs);for(var i in configs){var config=configs[i];var index=+i;if((act.dabiao[index-1]||0)<config.day){if(minIndex==-1){minIndex=indexStr.length}}else if((act.recrod>>index&1)==0&&(act.dabiao[index-1]||0)>=config.day){minIndex=index}this["gift"+(index-1)].setData(this.activityID,index)}var keys=Object.keys(configs);var maxIndex=+keys[keys.length-1];this.bar.maximum=configs[maxIndex].day;this.bar.value=act.dabiao[maxIndex-1];if(minIndex==-1)minIndex=act.getCurIndex();this.setSelectIndex(minIndex);this.updateTime()};OSATarget3Panel3.prototype.setSelectIndex=function(index){this._index=index;var config;var act;if(this.actType==ActivityType.Normal){config=GlobalConfig.ActivityType3Config[this.activityID][index];act=Activity.ins().getActivityDataById(this.activityID)}else if(this.actType==ActivityType.Personal){config=GlobalConfig.PActivity3Config[this.activityID][index];act=PActivity.ins().getActivityDataById(this.activityID)}this.reward.dataProvider=new eui.ArrayCollection(config.rewards);this.redPoint.visible=false;if((act.dabiao[index-1]||0)>=config.day){var state=act.recrod>>index&1;if(state==0){this.getBtn.label=i18n("OSATarget3Panel3_0");this.getBtn.visible=true;this.getBtn.enabled=true;this.already.visible=false;this.redPoint.visible=true;this._state=1}else{this.getBtn.label=i18n("OSATarget3Panel3_1");this.getBtn.visible=false;this.already.visible=true;this._state=2}}else{this.getBtn.label=i18n("OSATarget3Panel3_2");this.getBtn.visible=true;this.getBtn.enabled=false;this.already.visible=false;this._state=0}if(config.show0!=null&&config.show0!=""){this.show0.source=config.show0}if(config.show1Mc!=null&&config.show1Mc!=""){this.show1McMc.playFile(config.show1Mc,-1)}if(index==1){this.show0.visible=true;this.show1Mc.visible=false;this.gift0.setSelected(true);this.gift1.setSelected(false)}else{this.show0.visible=false;this.show1Mc.visible=true;this.gift0.setSelected(false);this.gift1.setSelected(true)}};OSATarget3Panel3.prototype.updateTime=function(){var act;var config;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);config=GlobalConfig.ActivityConfig[this.activityID]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);config=GlobalConfig.PActivityConfig[this.activityID]}var sec=act.getLeftTime();this._time=sec;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);this.actDesc.text=config.desc;var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg){if(btnCfg.title!=null&&btnCfg.title!=""){this.title.source=btnCfg.title}}};OSATarget3Panel3.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget3Panel3.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.getBtn){if(this._state==1){if(this.actType==ActivityType.Normal){Activity.ins().sendReward(this.activityID,this._index)}else if(this.actType==ActivityType.Personal){PActivity.ins().sendReward(this.activityID,this._index)}}}else if(tar==this.gift0){this.setSelectIndex(1)}else if(tar==this.gift1){this.setSelectIndex(2)}};OSATarget3Panel3.prototype.close=function(){this.removeTouchEvent(this.getBtn,this.onTap);this.removeTouchEvent(this.gift0,this.onTap);this.removeTouchEvent(this.gift1,this.onTap);TimerManager.ins().removeAll(this)};OSATarget3Panel3.prototype.updateData=function(){this.initData()};return OSATarget3Panel3}(BaseView);__reflect(OSATarget3Panel3.prototype,"OSATarget3Panel3");var OSATarget3Panel4=function(_super){__extends(OSATarget3Panel4,_super);function OSATarget3Panel4(){var _this=_super.call(this)||this;_this.skinName="SecondRechargeSkin";return _this}OSATarget3Panel4.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward0.itemRenderer=ItemBase;this.reward1.itemRenderer=ItemBase};OSATarget3Panel4.prototype.open=function(){this.addTouchEvent(this.get0,this.onTap);this.addTouchEvent(this.get1,this.onTap);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.initData()};OSATarget3Panel4.prototype.initData=function(){this.setIndex(0);this.setIndex(1);this.updateTime()};OSATarget3Panel4.prototype.setIndex=function(type){var index,curValue;var act;var config;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID)}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID)}if(type==0){index=act.getCurIndex(3);this._index=index;curValue=act.chongzhiNum}else{index=act.getCurIndex(2);curValue=act.chongzhiTotal}if(this.actType==ActivityType.Normal){config=GlobalConfig.ActivityType3Config[this.activityID][index]}else if(this.actType==ActivityType.Personal){config=GlobalConfig.ActivityType3Config[this.activityID][index]}this["reward"+type].dataProvider=new eui.ArrayCollection(config.rewards);this["redPoint"+type].visible=false;var already=this["already"+type];var getBtn=this["get"+type];var record=this["record"+type];already.visible=false;if(curValue>=config.val){var state=act.recrod>>index&1;if(state==0){getBtn.label=i18n("OSATarget3Panel4_0");getBtn.visible=true;getBtn.enabled=true;this["redPoint"+type].visible=true}else{getBtn.label=i18n("OSATarget3Panel4_1");getBtn.visible=false;already.visible=true}record.textColor=65280}else{getBtn.label=i18n("OSATarget3Panel4_2");getBtn.visible=true;getBtn.enabled=false;record.textColor=16750848}record.text=i18n("OSATarget3Panel4_3",curValue,config.val);if(type==0){this.target0.text=i18n("OSATarget3Panel4_4",config.val)}else{this.target1.text=i18n("OSATarget3Panel4_5",config.val)}};OSATarget3Panel4.prototype.updateTime=function(){var act;var config;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);config=GlobalConfig.ActivityConfig[this.activityID]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);config=GlobalConfig.PActivityConfig[this.activityID]}var sec=act.getLeftTime();this._time=sec;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);this.actDesc.text=config.desc};OSATarget3Panel4.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget3Panel4.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.get0){if(this.actType==ActivityType.Normal){Activity.ins().sendReward(this.activityID,this._index)}else if(this.actType==ActivityType.Personal){PActivity.ins().sendReward(this.activityID,this._index)}}else if(tar==this.get1){var act=void 0;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);Activity.ins().sendReward(this.activityID,act.getCurIndex(2))}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);PActivity.ins().sendReward(this.activityID,act.getCurIndex(2))}}};OSATarget3Panel4.prototype.close=function(){this.removeTouchEvent(this.get0,this.onTap);this.removeTouchEvent(this.get1,this.onTap);TimerManager.ins().removeAll(this)};OSATarget3Panel4.prototype.updateData=function(){this.initData()};return OSATarget3Panel4}(BaseView);__reflect(OSATarget3Panel4.prototype,"OSATarget3Panel4");var OSATarget3Panel5=function(_super){__extends(OSATarget3Panel5,_super);function OSATarget3Panel5(){return _super.call(this)||this}OSATarget3Panel5.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward0.itemRenderer=ItemBase;this.reward1.itemRenderer=ItemBase};Object.defineProperty(OSATarget3Panel5.prototype,"activityID",{get:function(){return this._activityID},set:function(value){this._activityID=value;this.setCurSkin()},enumerable:true,configurable:true});OSATarget3Panel5.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="hefuSeriesRechargeSkin"};OSATarget3Panel5.prototype.open=function(){this.setCurSkin();this.addTouchEvent(this.getBtn0,this.onTap);this.addTouchEvent(this.getBtn1,this.onTap);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.initData()};OSATarget3Panel5.prototype.initData=function(){this.setIndex(0);this.setIndex(1);this.updateTime()};OSATarget3Panel5.prototype.setIndex=function(type){var index,curValue;var act;var btncfg;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);btncfg=GlobalConfig.ActivityBtnConfig[this.activityID]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);btncfg=GlobalConfig.PActivityBtnConfig[this.activityID]}if(btncfg)this.title.source=btncfg.title;if(type==0){index=act.getCurIndex(3);this._index=index;curValue=act.chongzhiNum}else{index=act.getCurIndex(2);curValue=act.chongzhiTotal}var config;if(this.actType==ActivityType.Normal){config=GlobalConfig.ActivityType3Config[this.activityID][index]}else if(this.actType==ActivityType.Personal){config=GlobalConfig.PActivity3Config[this.activityID][index]}this["reward"+type].dataProvider=new eui.ArrayCollection(config.rewards);this["redPoint"+type].visible=false;var already=this["already"+type];var getBtn=this["getBtn"+type];already.visible=false;if(curValue>=config.val){var state=act.recrod>>index&1;if(state==0){getBtn.label=i18n("OSATarget3Panel5_0");getBtn.visible=true;getBtn.enabled=true;this["redPoint"+type].visible=true}else{getBtn.label=i18n("OSATarget3Panel5_1");getBtn.visible=false;already.visible=true}}else{getBtn.label=i18n("OSATarget3Panel5_2");getBtn.visible=true;getBtn.enabled=false}if(type==0){}else{this["state"].text=i18n("OSATarget3Panel5_5",curValue,config.val)}if(this.bar){this.bar.maximum=config.val;this.bar.value=curValue}if(this.activityID==158){this.addchong.source="l_biaoti_leichong800"}else if(this.activityID==212){this.addchong.source="l_biaoti_leichong800"}};OSATarget3Panel5.prototype.updateTime=function(){var act;var config;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);config=GlobalConfig.ActivityConfig[this.activityID]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);config=GlobalConfig.PActivityConfig[this.activityID]}var sec=act.getLeftTime();this._time=sec;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);this.actDesc.text=config.desc};OSATarget3Panel5.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget3Panel5.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.getBtn0){if(this.actType==ActivityType.Normal){Activity.ins().sendReward(this.activityID,this._index)}else if(this.actType==ActivityType.Personal){PActivity.ins().sendReward(this.activityID,this._index)}}else if(tar==this.getBtn1){var act=void 0;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);Activity.ins().sendReward(this.activityID,act.getCurIndex(2))}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);PActivity.ins().sendReward(this.activityID,act.getCurIndex(2))}}};OSATarget3Panel5.prototype.close=function(){this.removeTouchEvent(this.getBtn0,this.onTap);this.removeTouchEvent(this.getBtn1,this.onTap);TimerManager.ins().removeAll(this)};OSATarget3Panel5.prototype.updateData=function(){this.initData()};return OSATarget3Panel5}(BaseView);__reflect(OSATarget3Panel5.prototype,"OSATarget3Panel5");var OSATarget3Panel6=function(_super){__extends(OSATarget3Panel6,_super);function OSATarget3Panel6(){var _this=_super.call(this)||this;_this.skinName="hefuCostSkin";return _this}OSATarget3Panel6.prototype.close=function(){TimerManager.ins().removeAll(this)};OSATarget3Panel6.prototype.open=function(){this.listData=new eui.ArrayCollection;this.content.itemRenderer=OSATarget3ItemRender6;this.content.dataProvider=this.listData;TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.updateData()};OSATarget3Panel6.prototype.updateTime=function(){var act;var config;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);config=GlobalConfig.ActivityConfig[this.activityID]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);config=GlobalConfig.PActivityConfig[this.activityID]}var sec=act.getLeftTime();this._time=sec;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);this.actDesc.text=config.desc};OSATarget3Panel6.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget3Panel6.prototype.updateData=function(){this.updateTime();this.updateList()};OSATarget3Panel6.prototype.updateList=function(){var activityData;var tmplist;var aBtn;if(this.actType==ActivityType.Normal){activityData=Activity.ins().getActivityDataById(this.activityID);tmplist=GlobalConfig.ActivityType3Config[this.activityID];aBtn=Activity.ins().getbtnInfo(this.activityID.toString())}else if(this.actType==ActivityType.Personal){activityData=PActivity.ins().getActivityDataById(this.activityID);tmplist=GlobalConfig.PActivity3Config[this.activityID];aBtn=PActivity.ins().getbtnInfo(this.activityID.toString())}var listData=[];for(var k in tmplist){listData.push(tmplist[k])}listData=listData.slice();var listDataSort=[];var listDataSortTotal=[];for(var i=0;i<listData.length;i++){var state=activityData.getRewardStateById(listData[i].index);if(state==Activity.Geted){listDataSortTotal.push(listData[i])}else{listDataSort.push(listData[i])}}listDataSort.sort(this.sortFunc);listDataSortTotal.sort(this.sortFunc);listData=listDataSort.concat(listDataSortTotal);this.listData.replaceAll(listData);this.title.source=aBtn.title};OSATarget3Panel6.prototype.sortFunc=function(aConfig,bConfig){if(aConfig.val<bConfig.val)return-1;else return 1};return OSATarget3Panel6}(BaseView);__reflect(OSATarget3Panel6.prototype,"OSATarget3Panel6");var OSATarget3Panel7=function(_super){__extends(OSATarget3Panel7,_super);function OSATarget3Panel7(){var _this=_super.call(this)||this;_this.skinName="hefuSeriesRechargeSkin2";return _this}OSATarget3Panel7.prototype.open=function(){this.observe(Activity.ins().postRewardResult,this.GetCallBack);this.observe(PActivity.ins().postRewardResult,this.GetCallBack);this.listData=new eui.ArrayCollection;this.content0.itemRenderer=OSATarget3ItemRender7;this.content0.dataProvider=this.listData;TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.updateData()};OSATarget3Panel7.prototype.GetCallBack=function(activityID){if(this.activityID!=activityID)return;var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}if(!ins.isSuccee){if(!UserBag.ins().getSurplusCount()){UserTips.ins().showTips(i18n("OSATarget3Panel7_0"))}else{UserTips.ins().showTips(i18n("OSATarget3Panel7_1"));var activityData=void 0;if(this.actType==ActivityType.Normal){activityData=ins.getActivityDataById(this.activityID)}else if(this.actType==ActivityType.Personal){activityData=ins.getActivityDataById(this.activityID)}ins.sendChangePage(activityData.id)}}ins.isSuccee=false;this.updateData()};OSATarget3Panel7.prototype.updateTime=function(){var act;var config;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);config=GlobalConfig.ActivityConfig[this.activityID]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);config=GlobalConfig.PActivityConfig[this.activityID]}var sec=act.getLeftTime();this._time=sec;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);this.actDesc.text=config.desc};OSATarget3Panel7.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget3Panel7.prototype.close=function(){TimerManager.ins().removeAll(this)};OSATarget3Panel7.prototype.updateData=function(){this.updateTime();this.updateList()};OSATarget3Panel7.prototype.updateList=function(){var activityData;var tmplist;var aBtn;if(this.actType==ActivityType.Normal){activityData=Activity.ins().getActivityDataById(this.activityID);tmplist=GlobalConfig.ActivityType3Config[this.activityID];aBtn=Activity.ins().getbtnInfo(this.activityID.toString())}else if(this.actType==ActivityType.Personal){activityData=PActivity.ins().getActivityDataById(this.activityID);tmplist=GlobalConfig.PActivity3Config[this.activityID];aBtn=PActivity.ins().getbtnInfo(this.activityID.toString())}var listData=[];for(var k in tmplist){listData.push(tmplist[k])}listData=listData.slice();var listDataSort=[];var listDataSortTotal=[];for(var i=0;i<listData.length;i++){var state=activityData.getRewardStateById(listData[i].index);if(state==Activity.Geted){listDataSortTotal.push(listData[i])}else{listDataSort.push(listData[i])}}listDataSort.sort(this.sortFunc);listDataSortTotal.sort(this.sortFunc);listData=listDataSort.concat(listDataSortTotal);this.listData.replaceAll(listData);this.title.source=aBtn.title};OSATarget3Panel7.prototype.sortFunc=function(aConfig,bConfig){if(aConfig.index<bConfig.index)return-1;else return 1};return OSATarget3Panel7}(BaseView);__reflect(OSATarget3Panel7.prototype,"OSATarget3Panel7");var Timer=egret.Timer;window["Timer"]=Timer;var OSATarget3Panel8=function(_super){__extends(OSATarget3Panel8,_super);function OSATarget3Panel8(id){var _this=_super.call(this)||this;_this.activityID=id||0;_this.initSkin();return _this}OSATarget3Panel8.prototype.initSkin=function(){this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);var config;if(this.actType==ActivityType.Normal){config=GlobalConfig.ActivityConfig[this.activityID];this.skinName=config.pageSkin}else if(this.actType==ActivityType.Personal){config=GlobalConfig.PActivityConfig[this.activityID];this.skinName=config.pageSkin}};OSATarget3Panel8.prototype.open=function(){this.initSkin();for(var i=0;i<6;i++){this.addTouchEvent(this["reward"+i],this.onTap)}this.addTouchEvent(this.rechargeBtn,this.onTap);this.observe(Activity.ins().postActivityIsGetAwards,this.showAward);this.observe(PActivity.ins().postActivityIsGetAwards,this.showAward);this.initData();TimerManager.ins().doTimer(1e3,0,this.updateTime,this)};OSATarget3Panel8.prototype.initData=function(){var config;if(this.actType==ActivityType.Normal){this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc;config=GlobalConfig.ActivityType3Config[this.activityID]}else if(this.actType==ActivityType.Personal){this.actInfo1.text=GlobalConfig.PActivityConfig[this.activityID].desc;config=GlobalConfig.PActivity3Config[this.activityID]}for(var i in config){var conf=config[i];if(conf.type==4){this.singleReward.data=conf.rewards[0];break}}this.updateTime();this.updateData()};OSATarget3Panel8.prototype.updateTime=function(){var act;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID)}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID)}var sec=act.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(sec,DateUtils.TIME_FORMAT_5,3)};OSATarget3Panel8.prototype.onTap=function(e){if(e.currentTarget==this.rechargeBtn){Recharge.ins().tryShowChargeFirstWin();return}var tar=e.currentTarget;if(tar){var data=void 0;var actData=void 0;if(this.actType==ActivityType.Normal){data=tar.data;Activity.ins().sendReward(data.Id,data.index);actData=Activity.ins().getActivityDataById(data.Id)}else if(this.actType==ActivityType.Personal){data=tar.data;PActivity.ins().sendReward(data.Id,data.index);actData=PActivity.ins().getActivityDataById(data.Id)}var state=actData.getRewardStateById(data.index);if(state==Activity.CanGet){this._sendConf=data}}};OSATarget3Panel8.prototype.showAward=function(){if(this._sendConf){var actData=void 0;if(this.actType==ActivityType.Normal){actData=Activity.ins().getActivityDataById(this._sendConf.Id)}else if(this.actType==ActivityType.Personal){actData=PActivity.ins().getActivityDataById(this._sendConf.Id)}var state=actData.getRewardStateById(this._sendConf.index);if(state==Activity.Geted){UserTips.ins().showItemTips(this._sendConf.rewards[0].id)}}};OSATarget3Panel8.prototype.close=function(){for(var i=0;i<6;i++){this.removeTouchEvent(this["reward"+i],this.onTap)}this.removeTouchEvent(this.rechargeBtn,this.onTap);this.removeObserve();TimerManager.ins().remove(this.updateTime,this)};OSATarget3Panel8.prototype.updateData=function(){var act;var config;if(this.actType==ActivityType.Normal){act=Activity.ins().getActivityDataById(this.activityID);config=GlobalConfig.ActivityType3Config[this.activityID]}else if(this.actType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(this.activityID);config=GlobalConfig.PActivity3Config[this.activityID]}for(var i=0;i<5;i++){var curConf=config[i+1];var nextConf=config[i+2];var v=Math.floor((act.chongzhiTotal-curConf.val)/(nextConf.val-curConf.val)*5);for(var j=0;j<5;j++){var key="sche"+i+"bell"+j;if(v>j){this[key].source="bell2"}else{this[key].source="bell1"}}}for(var i=0;i<6;i++){this["reward"+i].data=config[i+1]}this.numLbl.text=""+Math.floor(act.chongzhiTotal/100)};return OSATarget3Panel8}(BaseView);__reflect(OSATarget3Panel8.prototype,"OSATarget3Panel8");var OSATarget3Panel9=function(_super){__extends(OSATarget3Panel9,_super);function OSATarget3Panel9(id){var _this=_super.call(this)||this;_this.activityID=id||0;_this.initSkin();return _this}OSATarget3Panel9.prototype.initSkin=function(){var config=GlobalConfig.ActivityConfig[this.activityID];this.skinName=config.pageSkin};OSATarget3Panel9.prototype.open=function(){this.initSkin();var config=GlobalConfig.ActivityType3Config[this.activityID];var len=CommonUtils.getObjectLength(config);for(var i=0;i<len;i++){if(this["targtet"+i])this.addTouchEvent(this["targtet"+i],this.onTap)}this.addTouchEvent(this.rechargeBtn,this.onTap);this.observe(Activity.ins().postActivityIsGetAwards,this.showAward);this.reward.itemRenderer=ItemBase;this.initData();TimerManager.ins().doTimer(1e3,0,this.updateTime,this)};OSATarget3Panel9.prototype.initData=function(){this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc;for(var i in GlobalConfig.ActivityType3Config[this.activityID]){var conf=GlobalConfig.ActivityType3Config[this.activityID][i];if(conf.type==4){this.singleReward.data=conf.rewards[0];break}}this.updateTime();this.updateData2()};OSATarget3Panel9.prototype.updateTime=function(){var act=Activity.ins().getActivityDataById(this.activityID);var sec=act.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(sec,DateUtils.TIME_FORMAT_5,3)};OSATarget3Panel9.prototype.onTap=function(e){if(e.currentTarget==this.rechargeBtn){if(!this._sendConf)return;var actData=Activity.ins().getActivityDataById(this._sendConf.Id);var state=actData.getRewardStateById(this._sendConf.index);if(state==Activity.Geted){UserTips.ins().showTips(i18n("OSATarget3Panel9_0"))}else if(state==Activity.CanGet){Activity.ins().sendReward(this.activityID,this._sendConf.index)}else{UserTips.ins().showTips(i18n("OSATarget3Panel9_1"))}return}if(e.currentTarget instanceof CelebrationItem){var tar=e.currentTarget;this.updateReward(tar.data.config.index,tar.data.config.index);var cfg=GlobalConfig.ActivityType3Config[this.activityID];for(var i in cfg){if(cfg[i].index!=tar.data.config.index&&this["targtet"+(cfg[i].index-1)])this["targtet"+(cfg[i].index-1)].setSelect(false)}}};OSATarget3Panel9.prototype.showAward=function(){if(this._sendConf){var actData=Activity.ins().getActivityDataById(this._sendConf.Id);var state=actData.getRewardStateById(this._sendConf.index);if(state==Activity.Geted){this.showEff(this._sendConf);this.rechargeBtn.visible=false;this.already.visible=!this.rechargeBtn.visible}}};OSATarget3Panel9.prototype.close=function(){this.cleanEff();this.removeTouchEvent(this.rechargeBtn,this.onTap);this.removeObserve();TimerManager.ins().remove(this.updateTime,this)};OSATarget3Panel9.prototype.updateReward=function(index,select){var act=Activity.ins().getActivityDataById(this.activityID);var config=GlobalConfig.ActivityType3Config[this.activityID][index];if(!config||!act||!this["targtet"+(index-1)])return;this["targtet"+(index-1)].data={curCost:act.chongzhiTotal,config:config};this["targtet"+(index-1)].setSelect(select?index==select:false);this.rechargeBtn.visible=true;this.bigEgg.source=config.expAttr[4];if(index==select){this._sendConf=config;var state=act.getRewardStateById(this._sendConf.index);this.redPoint.visible=false;if(state==Activity.Geted){this.rechargeBtn.visible=false;this.bigEgg.source=config.expAttr[5]}else if(state==Activity.CanGet){this.redPoint.visible=true}else{}this.reward.dataProvider=new eui.ArrayCollection(config.rewards)}this.already.visible=!this.rechargeBtn.visible};OSATarget3Panel9.prototype.updateData2=function(){var curIndex=this.getRuleIndex();if(!curIndex)return;var act=Activity.ins().getActivityDataById(this.activityID);var config=GlobalConfig.ActivityType3Config[this.activityID];var len=CommonUtils.getObjectLength(config);for(var i=0;i<len;i++){this.updateReward(i+1,curIndex)}};OSATarget3Panel9.prototype.updateData=function(){};OSATarget3Panel9.prototype.getRuleIndex=function(){var act=Activity.ins().getActivityDataById(this.activityID);if(!act)return 0;var config=GlobalConfig.ActivityType3Config[this.activityID];var maxIndex=CommonUtils.getObjectLength(config);var minIndex=maxIndex;for(var k in config){if(config[k].index-1>=maxIndex||!this["targtet"+(config[k].index-1)])continue;var state=act.getRewardStateById(config[k].index);if(state==Activity.Geted){continue}else if(state==Activity.CanGet){return config[k].index}else{if(minIndex>config[k].index)minIndex=config[k].index}}return minIndex};OSATarget3Panel9.prototype.cleanEff=function(){egret.Tween.removeTweens(this.hamer);egret.Tween.removeTweens(this.flower);DisplayUtils.removeFromParent(this.tonk);DisplayUtils.removeFromParent(this.boom)};OSATarget3Panel9.prototype.showEff=function(config){var _this=this;if(!config)return;if(!this.tonk)this.tonk=new MovieClip;if(!this.tonk.parent)this.hamer.addChild(this.tonk);if(!this.boom)this.boom=new MovieClip;if(!this.boom.parent)this.flower.addChild(this.boom);egret.Tween.removeTweens(this.hamer);egret.Tween.removeTweens(this.flower);var self=this;this.tonk.playFile(RES_DIR_EFF+config.expAttr[2],1,function(){var tw=egret.Tween.get(_this.hamer);tw.wait(200).call(function(){self.updateReward(config.index,config.index)});self.boom.playFile(RES_DIR_EFF+config.expAttr[3],1,function(){egret.Tween.removeTweens(self.hamer);egret.Tween.removeTweens(self.flower);DisplayUtils.removeFromParent(self.tonk);DisplayUtils.removeFromParent(self.boom)})})};return OSATarget3Panel9}(BaseView);__reflect(OSATarget3Panel9.prototype,"OSATarget3Panel9");var OSATarget4Panel=function(_super){__extends(OSATarget4Panel,_super);function OSATarget4Panel(){var _this=_super.call(this)||this;_this.type4PanelList=[];return _this}OSATarget4Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget4Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}this.observe(Rank.ins().postRankingData,this.initInfo);this.initPanelList()};OSATarget4Panel.prototype.initInfo=function(model){this.openPanel(model)};OSATarget4Panel.prototype.openPanel=function(model){this.cruPanel=this.type4PanelList[this.activityID+""];this.cruPanel.open(model);this.addChild(this.cruPanel)};OSATarget4Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget4Panel.prototype.initPanelList=function(){var config=GlobalConfig.ActivityConfig[this.activityID];if(!this.type4PanelList[this.activityID+""]){var panel=new OSATarget4Panel2;panel.top=0;panel.bottom=0;panel.left=0;panel.right=0;this.type4PanelList[this.activityID+""]=panel;this.type4PanelList[this.activityID+""].activityID=this.activityID}var rankType=GlobalConfig.ActivityType4Config[this.activityID][0].rankType;if(!rankType||rankType==RankDataType.TYPE_XIAOFEI||rankType==RankDataType.TYPE_HF_XIAOFEI||rankType==RankDataType.TYPE_XIANYU)this.openPanel();else{Rank.ins().sendGetRankingData(rankType)}};OSATarget4Panel.prototype.updateData=function(){this.cruPanel.updateData()};return OSATarget4Panel}(ActivityPanel);__reflect(OSATarget4Panel.prototype,"OSATarget4Panel");var OSATarget4Panel2=function(_super){__extends(OSATarget4Panel2,_super);function OSATarget4Panel2(){var _this=_super.call(this)||this;_this._time=0;_this.skinName="OSARankSkin";return _this}OSATarget4Panel2.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward0.itemRenderer=ItemBase;this.reward1.itemRenderer=ItemBase;this.reward2.itemRenderer=ItemBase;this.reward3.itemRenderer=ItemBase;if(!this.titleEffNameMc)this.titleEffNameMc=new MovieClip;if(!this.titleEffNameMc.parent)this.titleEffGroup.addChild(this.titleEffNameMc);this.titleEffNameMc.x=this.titleEffGroup.x;this.titleEffNameMc.y=this.titleEffGroup.y};OSATarget4Panel2.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!this.titleEffNameMc)this.titleEffNameMc=new MovieClip;this.addTouchEvent(this.seek,this.onTap);TimerManager.ins().doTimer(1e3,0,this.setTime,this);if(param){this.model=param[0]}this.observe(Activity.ins().postGetDaBiaoInfo,this.updateData);var cfg=GlobalConfig.ActivityType4Config[this.activityID][1];if(cfg&&(cfg.rankType==RankDataType.TYPE_XIAOFEI||cfg.rankType==RankDataType.TYPE_HF_XIAOFEI||cfg.rankType==RankDataType.TYPE_XIANYU))Activity.ins().sendDabiaoInfo(this.activityID);else this.updateData()};OSATarget4Panel2.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};OSATarget4Panel2.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.seek,this.onTap);TimerManager.ins().removeAll(this);this.removeObserve()};OSATarget4Panel2.prototype.onTap=function(e){switch(e.target){case this.seek:var cfg=GlobalConfig.ActivityType4Config[this.activityID][0];var rankType=cfg.rankType;var rankDataList=void 0;var len=void 0;if(!this.model){rankDataList=Activity.ins().rankInfoList}else{rankDataList=this.model.getDataList()}len=Math.min(rankDataList.length,20);var arr=[];var activityData=Activity.ins().getActivityDataById(this.activityID);var curIndex={idx:1};for(var i=0;i<len;i++){var rankdata=rankDataList[i];var rank=activityData.getCostRank(rankdata,curIndex);if(rank>0){arr.push({rankData:rankDataList[i],activityID:this.activityID,rank:rank})}}ViewManager.ins().open(OSARankTipsWin,arr,rankType,cfg.rankTitle);break}};OSATarget4Panel2.prototype.setMyRank=function(){this.myAttrValue.text=i18n("OSATarget4Panel2_0");var rankType=GlobalConfig.ActivityType4Config[this.activityID][0].rankType;if(rankType==RankDataType.TYPE_HF_XIAOFEI||rankType==RankDataType.TYPE_XIAOFEI){if(Activity.ins().myPaiming==null||Activity.ins().myPaiming==0){this.myRanking.text=i18n("OSATarget4Panel2_1")}else{var activityData=Activity.ins().getActivityDataById(this.activityID);if(activityData.myPaiming)this.myRanking.text=activityData.myPaiming+"";else this.myRanking.text=i18n("OSATarget4Panel2_2")}}else if(rankType==RankDataType.TYPE_XIANYU){if(Activity.ins().myPaiming==null||Activity.ins().myPaiming==0){this.myRanking.text=i18n("OSATarget4Panel2_3")}else{this.myRanking.text=Activity.ins().myPaiming+""}}else{this.myRanking.text=i18n("OSATarget4Panel2_4")}switch(rankType){case RankDataType.TYPE_BAOSHI:this.myAttrValue.text=Role.getAllForgeLevelByType(PackageID.Zhuling)+"";break;case RankDataType.TYPE_LONGHUN:this.myAttrValue.text=LongHunData.getLongHunAllLevel()+"";break;case RankDataType.TYPE_WING:this.myAttrValue.text=WingsData.getWingAllLevel()+"";break;case RankDataType.TYPE_BOOK:var power=Book.ins().getBookPowerNumEx();this.myAttrValue.text=power+"";break;case RankDataType.TYPE_ZS:this.myAttrValue.text=UserZs.ins().lv+"";break;case RankDataType.TYPE_SCORE:this.myAttrValue.text=UserBag.ins().getEquipsScoreByRolesOfBody()+"";break;case RankDataType.TYPE_XIAOFEI:this.myAttrValue.text=Activity.ins().myDabiaoInfo?Activity.ins().myDabiaoInfo:0;break;case RankDataType.TYPE_HF_XIAOFEI:this.myAttrValue.text=Activity.ins().myDabiaoInfo?Activity.ins().myDabiaoInfo:0;break;case RankDataType.TYPE_XIANYU:this.myAttrValue.text=Activity.ins().myDabiaoInfo?Activity.ins().myDabiaoInfo:0;break}};OSATarget4Panel2.prototype.updateData=function(){var rankType=GlobalConfig.ActivityType4Config[this.activityID][0].rankType;if(rankType==RankDataType.TYPE_HF_XIAOFEI||rankType==RankDataType.TYPE_XIAOFEI)this.currentState="hefu";else this.currentState="kaifu";this.validateNow();var actcfg=GlobalConfig.ActivityConfig[this.activityID];var config=GlobalConfig.ActivityType4Config[this.activityID];var rankDataList;if(!this.model){rankDataList=Activity.ins().rankInfoList}else{rankDataList=this.model.getDataList()}if(!rankDataList){return}var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget4Panel2_6")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget4Panel2_7")}else{this._time=endedTime;if(this._time<0)this._time=0;this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.actDesc.text=actcfg.desc;if(rankType==RankDataType.TYPE_HF_XIAOFEI||rankType==RankDataType.TYPE_XIAOFEI){this.costRank(rankDataList,config)}else{this.normalRank(rankDataList,config)}var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg){this.title.source=btnCfg.title}if(config[0].rankContent!=null){this.attr.text=config[0].rankContent}else{switch(rankType){case RankDataType.TYPE_BAOSHI:this.attr.text=i18n("OSATarget4Panel2_8");break;case RankDataType.TYPE_LONGHUN:this.attr.text=i18n("OSATarget4Panel2_9");break;case RankDataType.TYPE_WING:this.attr.text=i18n("OSATarget4Panel2_10");break;case RankDataType.TYPE_BOOK:this.attr.text=i18n("OSATarget4Panel2_11");break;case RankDataType.TYPE_ZS:this.attr.text=i18n("OSATarget4Panel2_12");break;case RankDataType.TYPE_SCORE:this.attr.text=i18n("OSATarget4Panel2_13");break;case RankDataType.TYPE_HF_XIAOFEI:this.attr.text=i18n("OSATarget4Panel2_25");break;case RankDataType.TYPE_XIAOFEI:this.attr.text=i18n("OSATarget4Panel2_14");break;case RankDataType.TYPE_XIANYU:this.attr.text=i18n("OSATarget4Panel2_15");break}}if(GlobalConfig.ActivityType4Config[this.activityID][0].titleEffName){var ref=GlobalConfig.ActivityType4Config[this.activityID][0].titleEffName;this.titleEffNameMc.playFile(RES_DIR_EFF+ref,-1)}else{this.titleName.source=GlobalConfig.ActivityType4Config[this.activityID][0].titleName}};OSATarget4Panel2.prototype.costRank=function(rankDataList,config){for(var z=0;z<4;z++){if(this["name"+z])this["name"+z].visible=false;if(this["name"+z+"1"])this["name"+z+"1"].visible=false;var idx=z+1;if(z==2)idx=4;else if(z==3)idx=6;var cfg_1=config[idx];this["reward"+z].dataProvider=new eui.ArrayCollection(cfg_1.rewards);if(this["attrValue"+z]){this["attrValue"+z].visible=true;this["attrValue"+z].text=i18n("OSATarget4Panel2_16",cfg_1.value)}}var curIndex={idx:1};var activityData=Activity.ins().getActivityDataById(this.activityID);for(var k in rankDataList){var rankdata=rankDataList[k];var i=activityData.getCostRank(rankdata,curIndex);var cfg_2=config[i];if(!i||!cfg_2||i>5)continue;if(i==1){if(rankdata){this["name0"].visible=true;this["attrValue0"].visible=this["name0"].visible;if(!this.model){this["name0"].text=rankdata.name;this["attrValue0"].text=i18n("OSATarget4Panel2_17")+rankdata.numType}else{this["name0"].text=rankdata.player;this["attrValue0"].text=rankdata.value}}}else{var nlabel="";if(i==2){nlabel="name1"}else if(i==3){nlabel="name11";this["attrValue1"].visible=false}else if(i==4){nlabel="name2"}else if(i==5){nlabel="name21";this["attrValue2"].visible=false}else{continue}cfg_2=config[i];var selfname=this[nlabel];selfname.visible=true;if(!this.model){selfname.text=rankdata.name}else{selfname.text=rankdata.player}}}var cfg=config[6];this["reward3"].dataProvider=new eui.ArrayCollection(cfg.rewards);if(this.model){if(this.model.selfPos){if(this.model.selfPos<=20)this.myRanking.text=this.model.selfPos+"";else this.myRanking.text=i18n("OSATarget4Panel2_18");if(rankDataList[this.model.selfPos-1]){this.myAttrValue.text=rankDataList[this.model.selfPos-1].value}else{this.setMyRank()}}else{this.setMyRank()}}else{this.setMyRank()}};OSATarget4Panel2.prototype.normalRank=function(rankDataList,config){for(var i=1;i<=3;i++){var rankdata=rankDataList[i-1];var cfg1=config[i.toString()];if(rankdata){this["name"+(i-1)].visible=true;this["attrValue"+(i-1)].visible=this["name"+(i-1)].visible;if(!this.model){this["name"+(i-1)].text=rankdata.name;if(cfg1.rankType==RankDataType.TYPE_XIANYU){this["attrValue"+(i-1)].text=rankdata.numType}else{this["attrValue"+(i-1)].text=i18n("OSATarget4Panel2_21")+rankdata.numType}}else{this["name"+(i-1)].text=rankdata.player;this["attrValue"+(i-1)].text=rankdata.value}}else{this["name"+(i-1)].visible=false;this["attrValue"+(i-1)].visible=this["name"+(i-1)].visible}this["reward"+(i-1)].dataProvider=new eui.ArrayCollection(cfg1.rewards)}var cfg=config[4];this["reward3"].dataProvider=new eui.ArrayCollection(cfg.rewards);if(this.model){if(this.model.selfPos){if(this.model.selfPos<=20)this.myRanking.text=this.model.selfPos+"";else this.myRanking.text=i18n("OSATarget4Panel2_24");if(rankDataList[this.model.selfPos-1]){this.myAttrValue.text=rankDataList[this.model.selfPos-1].value}else{this.setMyRank()}}else{this.setMyRank()}}else{this.setMyRank()}};return OSATarget4Panel2}(BaseView);__reflect(OSATarget4Panel2.prototype,"OSATarget4Panel2");var OSATarget5Panel=function(_super){__extends(OSATarget5Panel,_super);function OSATarget5Panel(){var _this=_super.call(this)||this;_this.type5PanelList=[];return _this}OSATarget5Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.initPanelList()};OSATarget5Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);this.observe(Activity.ins().postChangePage,this.updateData);this.observe(Activity.ins().postRewardResult,this.updateData);if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var id=this.activityID;this.initPanelList();this.cruPanel=this.type5PanelList[id+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget5Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();if(this.cruPanel)this.cruPanel.close()};OSATarget5Panel.prototype.initPanelList=function(){var id=this.activityID;if(!this.type5PanelList[id+""]){var clsStr=OSATarget5Panel.targetIndex[id]||"OSATarget5Panel"+GlobalConfig.ActivityType5Config[id][1].showType;var Cls=egret.getDefinitionByName(clsStr);this.type5PanelList[id+""]=new Cls(this.activityID);this.type5PanelList[id+""].top=0;this.type5PanelList[id+""].bottom=0;this.type5PanelList[id+""].left=0;this.type5PanelList[id+""].right=0;this.type5PanelList[id+""].activityID=this.activityID}};OSATarget5Panel.prototype.updateData=function(){this.cruPanel.updateData()};OSATarget5Panel.targetIndex={157:"OSATarget5Panel1",210:"OSATarget5Panel2"};return OSATarget5Panel}(ActivityPanel);__reflect(OSATarget5Panel.prototype,"OSATarget5Panel");var OSATarget5Panel1=function(_super){__extends(OSATarget5Panel1,_super);function OSATarget5Panel1(){var _this=_super.call(this)||this;_this.itemary=[];_this.dayindex=1;_this.itemList=[];_this.skinName="hefuLogSkin";_this.itemary=[];return _this}OSATarget5Panel1.prototype.initData=function(){};OSATarget5Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var config=GlobalConfig.ActivityType5Config[this.activityID];this.maxNum=0;this.itemList=[];for(var i=0;i<7;i++){this.itemList[i]=this["dayNum"+(i+1)];this.itemList[i].touchEnabled=false;if(config[i+1]){if(this["dayNum"+(i+1)]){this["dayNum"+(i+1)].visible=true}if(this["imgDay"+(i+1)]){this["imgDay"+(i+1)].visible=true}if(this["arrow"+(i+2)]){this["arrow"+(i+2)].visible=true}this.maxNum++}else{if(this["dayNum"+(i+1)]){this["dayNum"+(i+1)].visible=false}if(this["imgDay"+(i+1)]){this["imgDay"+(i+1)].visible=false}if(this["arrow"+(i+2)]){this["arrow"+(i+2)].visible=false}}}this._activityData=Activity.ins().getActivityDataById(this.activityID);this.addTouchEvent(this.suerBtn,this.onTouch);this.addTouchEvent(this.group,this.onTouch);for(var i=0;i<this.maxNum;i++){this.addTouchEvent(this.itemList[i],this.itemTouch)}this.observe(Activity.ins().postActivityIsGetAwards,this.changeList);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateData();var dayNum=param[0];if(dayNum){this.setList(dayNum)}};OSATarget5Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.suerBtn,this.onTouch);this.removeTouchEvent(this.group,this.onTouch);DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<this.maxNum;i++){this.removeTouchEvent(this.itemList[i],this.itemTouch)}this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget5Panel1.prototype.changeList=function(){var day=1;var dayNum=this._activityData.getCurDay();if(!dayNum){dayNum=day}if(dayNum>=this.maxNum)day=this.maxNum;else day=dayNum;for(var i=1;i<=day;i++){var config=GlobalConfig["ActivityType5Config"][this.activityID][i+""];if(config){if(dayNum>=config.day){if((this._activityData.recrod>>config.day&1)==0){this.setList(i);return}}}}this.setList(day+1)};OSATarget5Panel1.prototype.onTouch=function(e){switch(e.currentTarget){case this.suerBtn:if(this._activityData.getCurDay()>=this.day)Activity.ins().sendReward(this.activityID,this.day);else UserTips.ins().showTips(i18n("OSATarget5Panel1_0"));break}};OSATarget5Panel1.prototype.itemTouch=function(e){this.setList(e.currentTarget.data)};OSATarget5Panel1.prototype.setList=function(index){if(index===void 0){index=-1}if(index==-1){index=this.dayindex}if(index>this.maxNum){index=this.maxNum}this.dayindex=index;var conf=GlobalConfig["ActivityType5Config"][this.activityID][index+""];var list=conf.rewards;this.day=conf.day;var today=1;today=this._activityData.getCurDay();this.daylabel.text=i18n("OSATarget5Panel1_1",today);this.daylabel.visible=true;var flag=(this._activityData.recrod>>this.day&1)==1;this.dayaward.text=i18n("OSATarget5Panel1_2",TextFlowMaker.getCStr(index));this.suerBtn.visible=true;if(today>=this.day){if(!flag){this.btnMC=this.btnMC||new MovieClip;this.btnMC.x=this.suerBtn.width/2;this.btnMC.y=this.suerBtn.height/2-5;this.btnMC.playFile(RES_DIR_EFF+"chargeff1",-1);this.suerBtn.addChild(this.btnMC);this.redPoint.visible=true}else{this.daylabel.visible=false;this.suerBtn.visible=false;this.redPoint.visible=false}}else{DisplayUtils.removeFromParent(this.btnMC);this.suerBtn.visible=false;this.redPoint.visible=false}this.itemary.forEach(function(element){if(element.parent){element.parent.removeChild(element);element=null}});this.itemary=[];for(var i=0;i<list.length;i++){var item=new ItemBase;this.group1.addChild(item);item.data=list[i];this.itemary.push(item)}for(var i=0;i<this.maxNum;i++){this.itemList[i].activityID=this.activityID;this.itemList[i].data=i+1;if(i+1==index||i+1==this.maxNum&&index==this.maxNum){this.itemList[i].setSelectImg(true)}else{this.itemList[i].setSelectImg(false)}}this.showRedPoint()};OSATarget5Panel1.prototype.showRedPoint=function(){};OSATarget5Panel1.prototype.updateData=function(){this.changeList();this.showRedPoint();this.setTime()};OSATarget5Panel1.prototype.setTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget5Panel1_3")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget5Panel1_4")}else{this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}};return OSATarget5Panel1}(BaseView);__reflect(OSATarget5Panel1.prototype,"OSATarget5Panel1");var ActivityHFRenderItem=function(_super){__extends(ActivityHFRenderItem,_super);function ActivityHFRenderItem(){return _super.call(this)||this}ActivityHFRenderItem.prototype.dataChanged=function(){var activityID=this.activityID;var _activityData=Activity.ins().getActivityDataById(activityID);var index=this.data;var config=GlobalConfig["ActivityType5Config"][activityID][index+""];var currDay=_activityData.getCurDay();var flag=(_activityData.recrod>>config.day&1)==1;if(flag){this.select.visible=false;this.checkedMask.visible=this.checked.visible=true}else{this.checkedMask.visible=this.checked.visible=false}this.item.data=config.rewards[0]};return ActivityHFRenderItem}(SevenDayItemRender);__reflect(ActivityHFRenderItem.prototype,"ActivityHFRenderItem");var OSATarget5Panel2=function(_super){__extends(OSATarget5Panel2,_super);function OSATarget5Panel2(){var _this=_super.call(this)||this;_this.itemary=[];_this.dayindex=1;_this.itemList=[];_this.skinName="ganenLogSkin";_this.itemary=[];return _this}OSATarget5Panel2.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var config=GlobalConfig.ActivityType5Config[this.activityID];this.maxNum=0;this.itemList=[];for(var i=0;i<3;i++){this.itemList[i]=this["dayNum"+(i+1)];this.itemList[i].touchEnabled=false;if(config[i+1]){if(this["dayNum"+(i+1)]){this["dayNum"+(i+1)].visible=true}if(this["imgDay"+(i+1)]){this["imgDay"+(i+1)].visible=true}if(this["arrow"+(i+1)]){this["arrow"+(i+1)].visible=true}this.maxNum++}else{if(this["dayNum"+(i+1)]){this["dayNum"+(i+1)].visible=false}if(this["imgDay"+(i+1)]){this["imgDay"+(i+1)].visible=false}if(this["arrow"+(i+1)]){this["arrow"+(i+1)].visible=false}}}this._activityData=Activity.ins().getActivityDataById(this.activityID);this.addTouchEvent(this.suerBtn,this.onTouch);this.addTouchEvent(this.group,this.onTouch);for(var i=0;i<this.maxNum;i++){this.addTouchEvent(this.itemList[i],this.itemTouch)}this.observe(Activity.ins().postActivityIsGetAwards,this.changeList);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateData();var dayNum=param[0];if(dayNum){this.setList(dayNum)}};OSATarget5Panel2.prototype.setTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget5Panel2_0")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget5Panel2_1")}else{this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}};OSATarget5Panel2.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.suerBtn,this.onTouch);this.removeTouchEvent(this.group,this.onTouch);DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<this.maxNum;i++){this.removeTouchEvent(this.itemList[i],this.itemTouch)}this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget5Panel2.prototype.changeList=function(){var day=1;var dayNum=this._activityData.getCurDay();if(!dayNum){dayNum=day}if(dayNum>=this.maxNum)day=this.maxNum;else day=dayNum;for(var i=1;i<=day;i++){var config=GlobalConfig["ActivityType5Config"][this.activityID][i+""];if(config){if(dayNum>=config.day){if((this._activityData.recrod>>config.day&1)==0){this.setList(i);return}}}}this.setList(day+1)};OSATarget5Panel2.prototype.onTouch=function(e){switch(e.currentTarget){case this.group:this.setList(this.group.getChildIndex(e.target));break;case this.suerBtn:if(this._activityData.getCurDay()>=this.day)Activity.ins().sendReward(this.activityID,this.day);else UserTips.ins().showTips(i18n("OSATarget5Panel2_2"));break}};OSATarget5Panel2.prototype.itemTouch=function(e){this.setList(e.currentTarget.data)};OSATarget5Panel2.prototype.setList=function(index){if(index===void 0){index=-1}if(index==-1){index=this.dayindex}if(index>this.maxNum){index=this.maxNum}this.dayindex=index;var conf=GlobalConfig["ActivityType5Config"][this.activityID][index+""];var list=conf.rewards;this.day=conf.day;var today=1;today=this._activityData.getCurDay();this.daylabel.text=i18n("OSATarget5Panel2_3",today);this.daylabel.visible=true;var flag=(this._activityData.recrod>>this.day&1)==1;this.dayaward.text=i18n("OSATarget5Panel2_4",TextFlowMaker.getCStr(index));this.suerBtn.visible=true;if(today>=this.day){if(!flag){this.btnMC=this.btnMC||new MovieClip;this.btnMC.x=this.suerBtn.width/2;this.btnMC.y=this.suerBtn.height/2-5;this.btnMC.playFile(RES_DIR_EFF+"chargeff1",-1);this.suerBtn.addChild(this.btnMC);this.redPoint.visible=true}else{this.daylabel.visible=false;this.suerBtn.visible=false;this.redPoint.visible=false}}else{DisplayUtils.removeFromParent(this.btnMC);this.suerBtn.visible=false;this.redPoint.visible=false}this.itemary.forEach(function(element){if(element.parent){element.parent.removeChild(element);element=null}});this.itemary=[];for(var i=0;i<list.length;i++){var item=new ItemBase;this.group1.addChild(item);item.data=list[i];this.itemary.push(item)}for(var i=0;i<this.maxNum;i++){this.itemList[i].activityID=this.activityID;this.itemList[i].data=i+1;if(i+1==index||i+1==this.maxNum&&index==this.maxNum){this.itemList[i].setSelectImg(true)}else{this.itemList[i].setSelectImg(false)}}this.showRedPoint()};OSATarget5Panel2.prototype.showRedPoint=function(){};OSATarget5Panel2.prototype.updateData=function(){this.changeList();this.showRedPoint();this.setTime()};return OSATarget5Panel2}(BaseView);__reflect(OSATarget5Panel2.prototype,"OSATarget5Panel2");var OSATarget5Panel3=function(_super){__extends(OSATarget5Panel3,_super);function OSATarget5Panel3(){var _this=_super.call(this)||this;_this.itemary=[];_this.itemList=[];_this.dayindex=1;return _this}Object.defineProperty(OSATarget5Panel3.prototype,"activityID",{get:function(){return this._activityID},set:function(value){this._activityID=value;this.setCurSkin()},enumerable:true,configurable:true});OSATarget5Panel3.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="NYLogSkin"};OSATarget5Panel3.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();var config=GlobalConfig.ActivityType5Config[this.activityID];this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc;this.itemList=[];this.maxNum=Object.keys(config).length;for(var i=0;i<this.maxNum;i++){this.itemList[i]=this["dayNum"+(i+1)];this.addTouchEvent(this.itemList[i],this.itemTouch);this.itemList[i].item.hideName()}this._activityData=Activity.ins().getActivityDataById(this.activityID);this.addTouchEvent(this.suerBtn,this.onTouch);this.observe(Activity.ins().postActivityIsGetAwards,this.changeList);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateData();var dayNum=param[0];if(dayNum)this.setList(dayNum)};OSATarget5Panel3.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.suerBtn,this.onTouch);DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<this.maxNum;i++)this.removeTouchEvent(this.itemList[i],this.itemTouch);this.itemList.length=0;this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget5Panel3.prototype.changeList=function(){var day=1;var dayNum=this._activityData.getCurDay();if(!dayNum)dayNum=day;if(dayNum>=this.maxNum)day=this.maxNum;else day=dayNum;for(var i=1;i<=day;i++){var config=GlobalConfig["ActivityType5Config"][this.activityID][i+""];if(dayNum>=config.day){if((this._activityData.recrod>>config.day&1)==0){this.setList(i);return}}}this.setList(day+1)};OSATarget5Panel3.prototype.onTouch=function(e){switch(e.currentTarget){case this.suerBtn:if(this._activityData.getCurDay()>=this.day)Activity.ins().sendReward(this.activityID,this.day);else UserTips.ins().showTips(i18n("OSATarget5Panel3_0"));break}};OSATarget5Panel3.prototype.itemTouch=function(e){this.setList(e.currentTarget.data)};OSATarget5Panel3.prototype.setList=function(index){if(index===void 0){index=-1}if(index==-1){index=this.dayindex}if(index>this.maxNum){index=this.maxNum}this.dayindex=index;var conf=GlobalConfig["ActivityType5Config"][this.activityID][index+""];var list=conf.rewards;this.day=conf.day;var today=1;today=this._activityData.getCurDay();this.daylabel.text=i18n("OSATarget5Panel3_1",today);var flag=(this._activityData.recrod>>this.day&1)==1;this.dayaward.text=i18n("OSATarget5Panel3_2",TextFlowMaker.getCStr(index));this.suerBtn.visible=true;this.done.visible=false;if(today>=this.day){if(!flag){this.btnMC=this.btnMC||new MovieClip;this.btnMC.x=this.suerBtn.width/2;this.btnMC.y=this.suerBtn.height/2-5;this.btnMC.playFile(RES_DIR_EFF+"chargeff1",-1);this.suerBtn.addChild(this.btnMC);this.redPoint.visible=true}else{this.suerBtn.visible=false;this.redPoint.visible=false;this.done.visible=true}}else{DisplayUtils.removeFromParent(this.btnMC);this.suerBtn.visible=false;this.redPoint.visible=false}this.itemary.forEach(function(element){if(element.parent){element.parent.removeChild(element);element=null}});this.itemary=[];for(var i=0;i<list.length;i++){var item=new ItemBase;this.group1.addChild(item);item.data=list[i];this.itemary.push(item)}for(var i=0;i<this.maxNum;i++){this.itemList[i].activityID=this.activityID;this.itemList[i].data=i+1;if(i+1==index||i+1==this.maxNum&&index==this.maxNum){this.itemList[i].setSelectImg(true)}else{this.itemList[i].setSelectImg(false)}}};OSATarget5Panel3.prototype.updateData=function(){this.changeList();this.setTime();var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg){if(btnCfg.title!=null&&btnCfg.title!=""){this.title.source=btnCfg.title}}};OSATarget5Panel3.prototype.setTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime1.text=i18n("OSATarget5Panel3_3")}else if(endedTime<=0){this.actTime1.text=i18n("OSATarget5Panel3_4")}else{this.actTime1.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}};return OSATarget5Panel3}(BaseView);__reflect(OSATarget5Panel3.prototype,"OSATarget5Panel3");var OSATarget6Panel=function(_super){__extends(OSATarget6Panel,_super);function OSATarget6Panel(){var _this=_super.call(this)||this;_this.skinName="OSABoss";_this.maxIndex=0;return _this}OSATarget6Panel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);var sortId=this.getRule();this.updateData(sortId)};OSATarget6Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.leftBtn,this.onTap);this.addTouchEvent(this.rightBtn,this.onTap);this.addTouchEvent(this.goBtn,this.onTap);this.observe(Activity.ins().postRewardResult,this.GetCallBack);for(var i=1;i<=3;i++){this.addTouchEvent(this["boss"+i],this.onClick)}this.maxIndex=0;for(var k in GlobalConfig.ActivityType6Config[this.activityID])this.maxIndex++;var sortId=this.getRule();this.updateData(sortId)};OSATarget6Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.leftBtn,this.onTap);this.removeTouchEvent(this.rightBtn,this.onTap);this.removeTouchEvent(this.goBtn,this.onTap);this.removeObserve()};OSATarget6Panel.prototype.onClick=function(e){for(var i=1;i<=3;i++){if(e.currentTarget==this["boss"+i]){var idx=this.calcIndex(this.index);var config=GlobalConfig.ActivityType6Config[this.activityID][idx];if(config&&config.bossID&&config.jump){ViewManager.ins().open(config.jump[0][0],config.jump[0][1],config.bossID[i-1][0])}break}}};OSATarget6Panel.prototype.onTap=function(e){var config;var idx;switch(e.currentTarget){case this.leftBtn:--this.index;idx=this.calcIndex(this.index);if(!idx)return;config=GlobalConfig.ActivityType6Config[this.activityID][idx];if(!config||this.index-1<=0){this.index=1;this.leftBtn.visible=false}this.rightBtn.visible=true;this.updateData(this.index);break;case this.rightBtn:++this.index;idx=this.calcIndex(this.index);if(!idx)return;config=GlobalConfig.ActivityType6Config[this.activityID][idx];if(!config||this.index+1>this.maxIndex){this.index=this.maxIndex;this.rightBtn.visible=false}this.leftBtn.visible=true;this.updateData(this.index);break;case this.goBtn:idx=this.calcIndex(this.index);if(!idx)return;if(this.goBtn.label==i18n("OSATarget6Panel_0")){ViewManager.ins().close(ActivityWin);config=GlobalConfig.ActivityType6Config[this.activityID][idx];if(config&&config.bossID&&config.jump){ViewManager.ins().open(config.jump[0][0],config.jump[0][1],config.bossID[0][0])}}else{Activity.ins().sendReward(this.activityID,idx)}break}};OSATarget6Panel.prototype.GetCallBack=function(activityID){if(this.activityID!=activityID)return;if(!Activity.ins().isSuccee){if(!UserBag.ins().getSurplusCount()){UserTips.ins().showTips(i18n("OSATarget6Panel_1"))}else{UserTips.ins().showTips(i18n("OSATarget6Panel_2"));var activityData=Activity.ins().getActivityDataById(this.activityID);Activity.ins().sendChangePage(activityData.id)}}Activity.ins().isSuccee=false;var sortId=this.getRule();this.updateData(sortId)};OSATarget6Panel.prototype.sortRule=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};OSATarget6Panel.prototype.getRule=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var copyConfig=GlobalConfig.ActivityType6Config[this.activityID];var ruleIndex1=0;var ruleIndex2=0;var isRule=false;var config=[];for(var i in copyConfig){config.push(copyConfig[i])}config.sort(this.sortRule);for(var k in config){var idx=this.calcIndex(Number(k));var record=activityData.getBossGroupGiftIndex(config[k]);var bossRecord=activityData.getBossGroup(activityData.rewardsBossSum[idx],config[k]);if(record==Activity.Geted){}else if(bossRecord==Activity.KILL&&record==Activity.CanGet){if(!ruleIndex1||config[k].sort<ruleIndex1){ruleIndex1=config[k].sort;isRule=true}break}else if(bossRecord==Activity.NOKILL&&record==Activity.CanGet){if(!ruleIndex2||config[k].sort<ruleIndex2)ruleIndex2=config[k].sort;break}if(isRule)break}var curIndex=0;if(ruleIndex1)curIndex=ruleIndex1;else curIndex=ruleIndex2;curIndex=curIndex?curIndex:config[0].sort;return curIndex};OSATarget6Panel.prototype.updateData=function(sortId){if(sortId===void 0){sortId=1}if(sortId>this.maxIndex){this.index=this.maxIndex;return}this.index=sortId;var id=this.calcIndex(this.index);if(!id)return;var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget6Panel_3")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget6Panel_4")}else{this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.actInfo.text=GlobalConfig.ActivityConfig[this.activityID].desc;var curRole=SubRoles.ins().getSubRoleByIndex(0);var config=GlobalConfig.ActivityType6Config[this.activityID][id];var idx=0;for(var i=0;i<config.rewards.length;i++){if(!this["item"+idx])break;var rew=config.rewards[i];if(rew.job&&curRole.job!=rew.job)continue;this["item"+idx].data={type:rew.type,count:rew.count,id:rew.id};this["item"+idx].visible=true;idx++}for(var j=idx;j<4;j++){this["item"+j].visible=false}var bossList=config.bossID;for(var i=0;i<3;i++){if(this["boss"+(i+1)]){var mid=bossList[i][0];var mcfg=GlobalConfig.MonstersConfig[mid];this["boss"+(i+1)].source="monhead"+mcfg.head+"_png";this["monName"+i].text=mcfg.name}}var record=activityData.getBossGroupGiftIndex(config);var bossRecord=activityData.getBossGroup(activityData.rewardsBossSum[id],config);this.redPoint.visible=false;if(record==Activity.Geted){this.successBtn.visible=true;this.goBtn.visible=false}else if(bossRecord==Activity.KILL&&record==Activity.CanGet){this.goBtn.visible=true;this.successBtn.visible=false;this.goBtn.label=i18n("OSATarget6Panel_5");this.redPoint.visible=true}else if(bossRecord==Activity.NOKILL&&record==Activity.CanGet){this.goBtn.visible=true;this.successBtn.visible=false;this.goBtn.label=i18n("OSATarget6Panel_6")}this.leftBtn.visible=true;this.rightBtn.visible=true;if(this.index==1){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.index==this.maxIndex){this.rightBtn.visible=false;this.leftBtn.visible=true}var group=activityData.getBossGroupIndex(activityData.rewardsBossSum[id],config);for(var i=0;i<group.length;i++){if(group[i]){this["state"+i].visible=true}else{this["state"+i].visible=false}}this.actTitle.source=config.groupName;this.giftTitle.source=config.giftName};OSATarget6Panel.prototype.calcSortId=function(index){for(var i in GlobalConfig.ActivityType6Config[this.activityID]){var cfg=GlobalConfig.ActivityType6Config[this.activityID][i];if(cfg.index==index)return cfg.sort}return 0};OSATarget6Panel.prototype.calcIndex=function(sortId){for(var i in GlobalConfig.ActivityType6Config[this.activityID]){var cfg=GlobalConfig.ActivityType6Config[this.activityID][i];if(cfg.sort==sortId)return cfg.index}return 0};return OSATarget6Panel}(ActivityPanel);__reflect(OSATarget6Panel.prototype,"OSATarget6Panel");var OSATarget7Panel4=function(_super){__extends(OSATarget7Panel4,_super);function OSATarget7Panel4(){var _this=_super.call(this)||this;_this.skinName="CDSnowManSkin";return _this}OSATarget7Panel4.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ChritmasSnowMainItem};OSATarget7Panel4.prototype.open=function(){this.addTouchEvent(this.turnBossBtn,this.onTap);this.addTouchEvent(this.arrowUp,this.onTap);this.addTouchEvent(this.arrowDown,this.onTap);TimerManager.ins().doTimer(1e3,0,this.updateTime,this);this.initData()};OSATarget7Panel4.prototype.initData=function(){this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc;var config=GlobalConfig.ActivityType7Config[this.activityID];var listConfig=[];for(var i in config){listConfig.push(config[i])}listConfig.sort(function(a,b){if(a.index<b.index)return-1;return 1});this.list.dataProvider=new eui.ArrayCollection(listConfig);this.updateTime();this.updateData()};OSATarget7Panel4.prototype.updateTime=function(){var act=Activity.ins().getActivityDataById(this.activityID);var sec=act.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(sec,DateUtils.TIME_FORMAT_5,3)};OSATarget7Panel4.prototype.updateData=function(){var data=Activity.ins().getActivityDataById(this.activityID);this.numLbl.text=""+data.bossScore;var sources=this.list.dataProvider;for(var _i=0,_a=sources.source;_i<_a.length;_i++){var source=_a[_i];sources.itemUpdated(source)}};OSATarget7Panel4.prototype.onTap=function(e){var tar=e.currentTarget;switch(tar){case this.turnBossBtn:ViewManager.ins().open(BossWin,1);break;case this.arrowUp:this.arrowTo(-1);break;case this.arrowDown:this.arrowTo(1);break}};OSATarget7Panel4.prototype.arrowTo=function(dir){var sv=this.list.scrollV+dir*130;if(sv<0){sv=0}else if(sv>this.list.contentHeight-this.list.parent.height){sv=this.list.contentHeight-this.list.parent.height}this.list.scrollV=sv};OSATarget7Panel4.prototype.close=function(){this.removeTouchEvent(this.turnBossBtn,this.onTap);this.removeTouchEvent(this.arrowUp,this.onTap);this.removeTouchEvent(this.arrowDown,this.onTap);TimerManager.ins().remove(this.updateTime,this)};return OSATarget7Panel4}(BaseView);__reflect(OSATarget7Panel4.prototype,"OSATarget7Panel4");var OSATarget8Panel=function(_super){__extends(OSATarget8Panel,_super);function OSATarget8Panel(){var _this=_super.call(this)||this;_this.skinName="OSARingFbSkin";return _this}OSATarget8Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve()};OSATarget8Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postChangePage,this.updateView);this.addTouchEvent(this.chanllage,this.onChanllage);var actId=0;for(var i in GlobalConfig.ActivityType8Config){var cfg=GlobalConfig.ActivityType8Config[i][1];if(cfg.showType=ActivityType8Data.TYPE_RING){actId=cfg.Id;break}}this.updateView()};OSATarget8Panel.prototype.updateView=function(){var data=Activity.ins().activityData[this.activityID];var config=GlobalConfig.ActivityType8Config[this.activityID][1];if(config.showType==ActivityType8Data.TYPE_RING){var index=Activity.ins().getCurrentRingAwardIndex(data.record);var cfg=Activity.ins().getRingAward(index);if(cfg){this.currentState="normal";this.price.setPrice(cfg.ybCount);this.awardIndex=index;this.needYB=cfg.ybCount;var rewardsNum=cfg.rewardsNum;this.starNum.text=SpecialRing.ins().getCanUpgradeStars(rewardsNum).toString();this.rewardsCount.text=rewardsNum.toString();var total=12;this.times.text=i18n("OSATarget8Panel_2")+(total-cfg.index+1)+"/"+total}else{var data_3=Activity.ins().getLastRingAward();this.starNum.text=SpecialRing.ins().getCanUpgradeStars(data_3.rewardsNum).toString();this.rewardsCount.text=data_3.rewardsNum.toString();this.currentState="fullcount";this.price.visible=false;this.chanllage.visible=false;this.times.text=""}}this.actTime.text=data.getRemainTime()};OSATarget8Panel.prototype.onChanllage=function(){if(Actor.yb>=this.needYB){Activity.ins().sendReward(this.activityID,this.awardIndex);Activity.ins().addEvent()}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget8Panel_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget8Panel_1"))}};return OSATarget8Panel}(ActivityPanel);__reflect(OSATarget8Panel.prototype,"OSATarget8Panel");var OSATarget9Panel=function(_super){__extends(OSATarget9Panel,_super);function OSATarget9Panel(){var _this=_super.call(this)||this;_this.type2PanelList=[];return _this}OSATarget9Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var config;if(this.activityType==ActivityType.Normal){config=GlobalConfig.ActivityType9Config[this.activityID]}else if(this.activityType==ActivityType.Personal){config=GlobalConfig.PActivityType9Config[this.activityID]}if(this.cruPanel){if(config[1].showType==1||config[1].showType==3||config[1].showType==4){}else{this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}}if(!this.type2PanelList[this.activityID]){var panel=ObjectPool.pop("OSATarget9Panel"+config[1].showType);panel.top=0;panel.bottom=0;panel.left=0;panel.right=0;panel.activityID=this.activityID;this.type2PanelList[this.activityID+""]=panel}this.cruPanel=this.type2PanelList[this.activityID+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget9Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close()};OSATarget9Panel.prototype.updateData=function(){this.cruPanel.updateData()};return OSATarget9Panel}(ActivityPanel);__reflect(OSATarget9Panel.prototype,"OSATarget9Panel");var OSATarget9Panel1=function(_super){__extends(OSATarget9Panel1,_super);function OSATarget9Panel1(){var _this=_super.call(this)||this;_this.skinName="luckyTurntableSkin";return _this}OSATarget9Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();for(var i=0;i<3;i++){this.removeTouchEvent(this["isget"+i],this.onGiftClick)}egret.Tween.removeTweens(this.tttzhi);this.rolling=false;var data;var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins();data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){ins=PActivity.ins();data=PActivity.ins().activityData[this.activityID]}if(data&&data.indexs.length==1){ins.sendReward(this.activityID,1)}TimerManager.ins().removeAll(this)};OSATarget9Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}this.observe(ins.postChangePage,this.resultCallBack);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.addTouchEvent(this.choujiangBtn,this.getLottery);for(var i=0;i<3;i++){this.addTouchEvent(this["isget"+i],this.onGiftClick)}this.list.itemRenderer=NoticeListRenderer;this.turnten.selected=false;this.currentState="unReset";this.validateNow();this.updateData()};OSATarget9Panel1.prototype.onTouch=function(e){switch(e.currentTarget){case this.getkey:break}};OSATarget9Panel1.prototype.updateData=function(){var data;var config;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID];config=GlobalConfig.ActivityType9Config[this.activityID][0]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID];config=GlobalConfig.PActivityType9Config[this.activityID][0]}var itemcfg=GlobalConfig.ItemConfig[config.item];if(itemcfg){this.icon.source=itemcfg.icon+"_png";var item=UserBag.ins().getBagItemById(itemcfg.id);var sum=0;var maxsum=1;var colorStr=13746831;if(item){sum=item.count;if(sum>=maxsum)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N}else{colorStr=ColorUtil.RED_COLOR_N}this.num.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget9Panel1_6",colorStr,sum,maxsum));this.pay0.text=config.yb+""}var configList;if(this.actType==ActivityType.Normal){configList=GlobalConfig.ActivityType9Config}else if(this.actType==ActivityType.Personal){configList=GlobalConfig.PActivityType9Config}for(var i in configList[this.activityID]){if(!+i)continue;var cfg=configList[this.activityID][i];var item=this["item"+(+i-1)];item.itemIcon.data=cfg.reward[0];item.rewardState(false)}this.num2.visible=false;this.updateProgress();this.listRefush();this.setTime();if(this.activityID==4001){this.title.source="biaoti_duanwuzhuanpan"}var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg){if(btnCfg.title!=null&&btnCfg.title!=""){this.title.source=btnCfg.title}}};OSATarget9Panel1.prototype.resultCallBack=function(id){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(!data||this.activityID!=id)return;if(data.indexs.length>1){ViewManager.ins().open(LuckyResultWin,this.activityID,data.indexs)}else if(data.indexs.length==1){this.beginLottery(data.indexs[0])}this.listRefush()};OSATarget9Panel1.prototype.beginLottery=function(index){var _this=this;var rotat=360*4+(index-1)*36;var tween=egret.Tween.get(this.tttzhi);this.rolling=true;tween.to({rotation:rotat},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(_this.activityID,1);_this.flyItem(_this["item"+(index-1)]);setTimeout(function(){_this.rolling=false},2e3)},this)};OSATarget9Panel1.prototype.flyItem=function(item){var itemBase=new ItemBase;itemBase.x=item.x;itemBase.y=item.y;itemBase.data=item.itemIcon.data;itemBase.anchorOffsetX=itemBase.width/2;itemBase.anchorOffsetY=itemBase.height/2;item.parent.addChild(itemBase);GameLogic.ins().postFlyItemEx(itemBase)};OSATarget9Panel1.prototype.flyItemEx=function(itemicon){var flyItem=new eui.Image(itemicon.imgIcon.source);flyItem.x=itemicon.imgIcon.x;flyItem.y=itemicon.imgIcon.y;flyItem.width=itemicon.imgIcon.width;flyItem.height=itemicon.imgIcon.height;flyItem.scaleX=itemicon.imgIcon.scaleX;flyItem.scaleY=itemicon.imgIcon.scaleY;itemicon.imgIcon.parent.addChild(flyItem);GameLogic.ins().postFlyItemEx(flyItem)};OSATarget9Panel1.prototype.getLottery=function(){if(this.rolling){UserTips.ins().showTips(i18n("OSATarget9Panel1_0"));return}var ins;var cfg;if(this.actType==ActivityType.Normal){ins=Activity.ins();cfg=GlobalConfig.ActivityType9Config[this.activityID]}else if(this.actType==ActivityType.Personal){ins=PActivity.ins();cfg=GlobalConfig.PActivityType9Config[this.activityID]}if(this.turnten.selected){if(ins.getIsRollTen(this.activityID)){ins.sendReward(this.activityID,2)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel1_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel1_2"))}}else{if(ins.getRollSum(this.activityID)||Actor.yb>=cfg[0].yb){ins.sendReward(this.activityID,1)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel1_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel1_4"))}}};OSATarget9Panel1.prototype.onGiftClick=function(e){for(var i=0;i<3;i++){if(e.currentTarget==this["isget"+i]){var itemicon=this["gift"+i].getItemIcon();this.flyItemEx(itemicon);Activity.ins().sendReward(this.activityID,0,i+1);break}}};OSATarget9Panel1.prototype.updateProgress=function(){var cfg;var data;if(this.actType==ActivityType.Normal){cfg=GlobalConfig.ActivityType9Config[this.activityID];data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){cfg=GlobalConfig.PActivityType9Config[this.activityID];data=PActivity.ins().activityData[this.activityID]}var config=cfg[0];if(config&&data){this.turntime.text=data.count+"";for(var i=0;i<3;i++){this["turntime"+i].text=config.reward[i].times;this["gift"+i].data={id:config.reward[i].id,type:config.reward[i].type,count:config.reward[i].count};this["gift"+i].isShowName(false);this["bar"+i].maximum=100;this["lingqu"+i].touchEnabled=false;if(data.record>>i+1&1){this["bar"+i].value=100;this["lingqu"+i].visible=true;this["isget"+i].touchEnabled=false}else{this["lingqu"+i].visible=false;if(data.count>=config.reward[i].times){this["bar"+i].value=100;this["isget"+i].touchEnabled=true}else{var prerewards=config.reward[i-1];var curCount=data.count;var totalCount=config.reward[i].times;if(prerewards){curCount=data.count-prerewards.times;totalCount=config.reward[i].times-prerewards.times}curCount=curCount>0?curCount:0;this["bar"+i].value=Math.floor(curCount/totalCount*100);this["isget"+i].touchEnabled=false}}this.updateRedPoint(this.activityID,i)}}};OSATarget9Panel1.prototype.updateRedPoint=function(activityID,idx){var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}var b=ins.isGetRollReward(activityID,idx);this["redPoint"+idx].visible=b};OSATarget9Panel1.prototype.listRefush=function(){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(data){var arr=[];for(var i=0;i<data.noticeArr.length;i++){var notice={activityID:this.activityID,name:data.noticeArr[i].name,index:data.noticeArr[i].index,actType:this.actType};arr.push(notice)}this.list.dataProvider=new eui.ArrayCollection(arr)}};OSATarget9Panel1.prototype.setTime=function(){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(data)this.actTime.text=i18n("OSATarget9Panel1_5")+data.getRemainTime()};return OSATarget9Panel1}(BaseView);__reflect(OSATarget9Panel1.prototype,"OSATarget9Panel1");var OSATarget9Panel2=function(_super){__extends(OSATarget9Panel2,_super);function OSATarget9Panel2(){var _this=_super.call(this)||this;_this._curAwardPage=1;_this._maxAwardPages=1;return _this}OSATarget9Panel2.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATarget9Panel2.prototype.init=function(){this.list.itemRenderer=ItemBase;this.list0.itemRenderer=NoticeListRenderer;var config;var reward;var datas=[];for(var i=1;i<=8;i++){if(this.actType==ActivityType.Normal){config=GlobalConfig.ActivityType9Config[this.activityID][i]}else if(this.actType==ActivityType.Personal){config=GlobalConfig.PActivityType9Config[this.activityID][i]}reward=new RewardData;reward.type=config.reward[0].type;reward.id=config.reward[0].id;reward.count=config.reward[0].count;datas[i-1]=reward}this.list.dataProvider=new ArrayCollection(datas)};Object.defineProperty(OSATarget9Panel2.prototype,"activityID",{get:function(){return this._activityID},set:function(value){this._activityID=value;if(isNaN(this.actType)){this.actType=ActivityPanel.getActivityTypeFromId(this._activityID)}this.setCurSkin()},enumerable:true,configurable:true});OSATarget9Panel2.prototype.setCurSkin=function(){var aCon;if(this.actType==ActivityType.Normal){aCon=GlobalConfig.ActivityConfig[this.activityID]}else if(this.actType==ActivityType.Personal){aCon=GlobalConfig.PActivityConfig[this.activityID]}if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="NYFireworkerSkin"};OSATarget9Panel2.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setCurSkin();this.init();var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins();this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc}else if(this.actType==ActivityType.Personal){ins=PActivity.ins();this.actInfo1.text=GlobalConfig.PActivityConfig[this.activityID].desc}this.observe(ins.postActivityIsGetAwards,this.updateData);this.observe(ins.postChangePage,this.resultCallBack);this.addTouchEvent(this,this.onTouch);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateData()};OSATarget9Panel2.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();this.removeTouchEvent(this,this.onTouch);TimerManager.ins().removeAll(this);DisplayUtils.removeFromParent(this._fireEff);this.turnten.selected=false};OSATarget9Panel2.prototype.updateMaterial=function(){var item=UserBag.ins().getBagGoodsByTypeAndId(0,this.config.item);var count=item?item.count:0;this.costNum.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget9Panel2_3",count?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N,count))};OSATarget9Panel2.prototype.onTouch=function(e){switch(e.target){case this.buyBtn:var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,this.config.item);if(item&&item.count){this.onSend()}else{var times=this.turnten.selected?10:1;var total=this.config.yb*times;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+(times==10?"-10":"-1"),this.huntWarnFun.bind(this),i18n("OSATarget9Panel2_0",total,GlobalConfig.ItemConfig[this.config.item].name,times))}break;case this.reward0:case this.reward1:case this.reward2:case this.reward3:var data=e.target.data;if(data.state==0)ViewManager.ins().open(ItemDetailedWin,0,data.id,data.count);else if(data.state==1){this.flyItemEx(e.target);this.ins.sendReward(this.activityID,0,data.index)}break;case this.arrowleft:if(this._curAwardPage>1){this._curAwardPage--;this.updateAwardPage()}break;case this.arrowright:if(this._curAwardPage<this._maxAwardPages){this._curAwardPage++;this.updateAwardPage()}break}};OSATarget9Panel2.prototype.huntWarnFun=function(){var times=this.turnten.selected?10:1;var total=this.config.yb*times;if(Actor.yb>=total){this.onSend()}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel2_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel2_2"))}};OSATarget9Panel2.prototype.onSend=function(){if(this.turnten.selected)this.ins.sendReward(this.activityID,2);else{this.ins.sendReward(this.activityID,1);this.ins.sendReward(this.activityID,1);if(!this._fireEff)this._fireEff=new MovieClip;if(!this._fireEff.parent){this.effLocation.addChild(this._fireEff);this._fireEff.scaleX=this.effLocation.scaleX;this._fireEff.scaleY=this.effLocation.scaleY}this._fireEff.playFile(RES_DIR_EFF+"yanhuaeff",1)}};OSATarget9Panel2.prototype.setCurAwardPage=function(){var config;var data;if(this.actType==ActivityType.Normal){config=GlobalConfig.ActivityType9Config[this.activityID][0];data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){config=GlobalConfig.PActivityType9Config[this.activityID][0];data=PActivity.ins().activityData[this.activityID]}this._maxAwardPages=config.reward.length/4;if(!data){this._curAwardPage=1;return}var len=config.reward.length;for(var i=0;i<len;i++){if(!(data.record>>i+1&1)){this._curAwardPage=Math.floor(i/4)+1;return}}this._curAwardPage=1};OSATarget9Panel2.prototype.updateData=function(){var data;var config9;if(this.actType==ActivityType.Normal){this.ins=Activity.ins();this.config=GlobalConfig.ActivityType9Config[this.activityID][0];data=Activity.ins().activityData[this.activityID];config9=GlobalConfig.ActivityType9Config}else if(this.actType==ActivityType.Personal){this.ins=PActivity.ins();this.config=GlobalConfig.PActivityType9Config[this.activityID][0];data=PActivity.ins().activityData[this.activityID];config9=GlobalConfig.PActivityType9Config}this.price.setText(this.config.yb+"");this.price.setType(MoneyConst.yuanbao);this.costIcon.source=GlobalConfig.ItemConfig[this.config.item].icon+"_png";this.setCurAwardPage();this.updateAwardPage();if(!this._recordCollect){this._recordCollect=new ArrayCollection;this.list0.dataProvider=this._recordCollect}if(data){var arr=[];var len=data.noticeArr.length;var notice=void 0;for(var i=0;i<len;i++){var config=config9[this.activityID][data.noticeArr[i].index];notice={activityID:this.activityID,name:data.noticeArr[i].name,index:data.noticeArr[i].index,des:config?config.middleDesc:null};arr.push(notice)}this._recordCollect.source=arr}else this._recordCollect.source=null;this.setTime();this.updateMaterial()};OSATarget9Panel2.prototype.updateAwardPage=function(){var config9;var data;if(this.actType==ActivityType.Normal){config9=GlobalConfig.ActivityType9Config;data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){config9=GlobalConfig.PActivityType9Config;data=PActivity.ins().activityData[this.activityID]}this.arrowleft.visible=this._curAwardPage>1;this.arrowright.visible=this._curAwardPage<this._maxAwardPages;var config=config9[this.activityID][0];this.redPointLeft.visible=this.redPointRight.visible=false;if(!data)return;var curTimes=data.count;var index=0;var state=0;var cTimes=0;var pTimes=0;for(var i=1;i<=this._maxAwardPages;i++){for(var j=0;j<4;j++){index=(i-1)*4+j;if(data.record>>index+1&1)state=2;else if(curTimes>=config.reward[index].times)state=1;else state=0;if(i==this._curAwardPage){this["reward"+j].data={id:config.reward[index].id,type:config.reward[index].type,count:config.reward[index].count,index:index+1,state:state,times:config.reward[index].times,curTimes:curTimes};if(j>0){cTimes=this["reward"+j].data.times;if(curTimes>=cTimes){this["bar"+(j-1)].maximum=100;this["bar"+(j-1)].value=100}else{pTimes=this["reward"+(j-1)].data.times;this["bar"+(j-1)].maximum=cTimes-pTimes;this["bar"+(j-1)].value=curTimes<=pTimes?0:curTimes-pTimes}}}else if(i<this._curAwardPage){if(state==1){this.redPointLeft.visible=true;break}}else{if(state==1){this.redPointRight.visible=true;break}}}}};OSATarget9Panel2.prototype.resultCallBack=function(id){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(!data||this.activityID!=id)return;if(data.indexs.length>1)ViewManager.ins().open(LuckyResultWin,this.activityID,data.indexs);this.updateMaterial()};OSATarget9Panel2.prototype.flyItemEx=function(itemicon){var flyItem=new eui.Image(itemicon.box.source);flyItem.x=itemicon.box.x;flyItem.y=itemicon.box.y;flyItem.width=itemicon.box.width;flyItem.height=itemicon.box.height;flyItem.scaleX=itemicon.box.scaleX;flyItem.scaleY=itemicon.box.scaleY;itemicon.box.parent.addChild(flyItem);GameLogic.ins().postFlyItemEx(flyItem)};OSATarget9Panel2.prototype.setTime=function(){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}this.actTime1.text=data.getRemainTime()};return OSATarget9Panel2}(BaseView);__reflect(OSATarget9Panel2.prototype,"OSATarget9Panel2");var OSATarget9Panel3=function(_super){__extends(OSATarget9Panel3,_super);function OSATarget9Panel3(){var _this=_super.call(this)||this;_this.skinName="luckyTurntableSkin";return _this}OSATarget9Panel3.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.menuScroller.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this);this.removeObserve();egret.Tween.removeTweens(this.tttzhi);this.rolling=false;var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(data&&data.indexs.length==1){this.ins.sendReward(this.activityID,1)}TimerManager.ins().removeAll(this)};OSATarget9Panel3.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);if(this.actType==ActivityType.Normal){this.config9=GlobalConfig.ActivityType9Config;this.ins=Activity.ins()}else if(this.actType==ActivityType.Personal){this.config9=GlobalConfig.PActivityType9Config;this.ins=PActivity.ins()}this.observe(this.ins.postChangePage,this.resultCallBack);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.addTouchEvent(this.rightBtn,this.onTouch);this.addTouchEvent(this.leftBtn,this.onTouch);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.addTouchEvent(this.choujiangBtn,this.getLottery);this.list.itemRenderer=NoticeListRenderer;this.menuList.itemRenderer=OSATarget9Panel3ItemRender;this.menuListData=new eui.ArrayCollection;this.menuList.dataProvider=this.menuListData;this.turnten.selected=false;this.currentState="reset";this.validateNow();this.updateData()};OSATarget9Panel3.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.currentTarget){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;this.updateBtn();break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;this.updateBtn();break}};OSATarget9Panel3.prototype.updateData=function(){var config;if(this.actType==ActivityType.Normal){config=this.config9[this.activityID][0]}else if(this.actType==ActivityType.Personal){config=this.config9[this.activityID][0]}var itemcfg=GlobalConfig.ItemConfig[config.item];if(itemcfg){this.icon.source=itemcfg.icon+"_png";var item=UserBag.ins().getBagItemById(itemcfg.id);var sum=0;var maxsum=1;var colorStr=13746831;if(item){sum=item.count;if(sum>=maxsum)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N}else{colorStr=ColorUtil.RED_COLOR_N}this.num.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget9Panel3_8",colorStr,sum,maxsum));this.pay0.text=config.yb+""}for(var i in this.config9[this.activityID]){if(!+i)continue;var cfg=this.config9[this.activityID][i];var item=this["item"+(+i-1)];item.itemIcon.data=cfg.reward[0];item.rewardState(false)}this.num2.visible=false;this.updateProgress();this.listRefush();this.setTime();var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg){if(btnCfg.title!=null&&btnCfg.title!=""){this.title.source=btnCfg.title}}};OSATarget9Panel3.prototype.resultCallBack=function(id){var data;if(this.actType==ActivityType.Normal){data=Activity.ins().activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=PActivity.ins().activityData[this.activityID]}if(!data||this.activityID!=id)return;if(data.indexs.length>1){ViewManager.ins().open(LuckyResultWin,this.activityID,data.indexs)}else if(data.indexs.length==1){this.beginLottery(data.indexs[0])}this.listRefush();this.updateData()};OSATarget9Panel3.prototype.beginLottery=function(index){var _this=this;var rotat=360*4+(index-1)*36;var tween=egret.Tween.get(this.tttzhi);this.rolling=true;var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}tween.to({rotation:rotat},4e3,egret.Ease.circOut).call(function(){ins.sendReward(_this.activityID,1);_this.flyItem(_this["item"+(index-1)]);setTimeout(function(){_this.rolling=false},2e3)},this)};OSATarget9Panel3.prototype.flyItem=function(item){var itemBase=new ItemBase;itemBase.x=item.x;itemBase.y=item.y;itemBase.data=item.itemIcon.data;itemBase.anchorOffsetX=itemBase.width/2;itemBase.anchorOffsetY=itemBase.height/2;item.parent.addChild(itemBase);GameLogic.ins().postFlyItemEx(itemBase)};OSATarget9Panel3.prototype.getLottery=function(){if(this.rolling){UserTips.ins().showTips(i18n("OSATarget9Panel3_0"));return}if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}var config=this.config9[this.activityID][0];if(this.turnten.selected){var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,config.item);if(item&&item.count){ins.sendReward(this.activityID,2)}else{var count=10;var total=config.yb*count;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-10",this.checkSend10.bind(this),i18n("OSATarget9Panel3_1",total,GlobalConfig.ItemConfig[config.item].name,count))}}else{var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,config.item);if(item&&item.count){ins.sendReward(this.activityID,1)}else{var count=1;var total=config.yb*1;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-1",this.checkSend1.bind(this),i18n("OSATarget9Panel3_2",total,GlobalConfig.ItemConfig[config.item].name,count))}}};OSATarget9Panel3.prototype.checkSend1=function(){var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}if(ins.getRollSum(this.activityID)||Actor.yb>=this.config9[this.activityID][0].yb){ins.sendReward(this.activityID,1)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel3_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel3_4"))}};OSATarget9Panel3.prototype.checkSend10=function(){var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}if(ins.getIsRollTen(this.activityID)){ins.sendReward(this.activityID,2)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel3_5"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel3_6"))}};OSATarget9Panel3.prototype.updateProgress=function(){var _this=this;var data;var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins();data=ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){ins=PActivity.ins();data=ins.activityData[this.activityID]}var config=this.config9[this.activityID][0];var arr=[];if(config&&data){for(var i=0;i<config.reward.length;i++){var arrdata={index:i,config:config,actType:this.actType};arr.push(arrdata)}this.menuListData.replaceAll(arr)}this.menuList.validateNow();TimerManager.ins().doNext(function(){var startX=0;for(var i=1;i<=_this.menuListData.length;i++){if(data.getStateByIndex(i)==0){startX=90*(i-1);break}}if(startX>_this.menuList.contentWidth-_this.menuList.width)startX=_this.menuList.contentWidth-_this.menuList.width;_this.menuList.scrollH=startX;_this.updateBtn()},this)};OSATarget9Panel3.prototype.updateBtn=function(){if(this.menuListData.length<=5){this.rightBtn.visible=this.rightRed.visible=this.leftBtn.visible=this.leftRed.visible=false}else{this.onChange()}};OSATarget9Panel3.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=this.leftRed.visible=false;this.rightBtn.visible=this.rightRed.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=this.leftRed.visible=true;this.rightBtn.visible=this.rightRed.visible=false}else{this.leftBtn.visible=this.leftRed.visible=true;this.rightBtn.visible=this.rightRed.visible=true}this.updateRedPoint()};OSATarget9Panel3.prototype.updateRedPoint=function(){var config=this.config9[this.activityID][0];var ins;if(this.actType==ActivityType.Normal){ins=Activity.ins()}else if(this.actType==ActivityType.Personal){ins=PActivity.ins()}var b=false;for(var i=0;i<config.reward.length;i++){b=ins.isGetRollReward(this.activityID,i);if(b)break}if(this.leftBtn.visible)this.leftRed.visible=b;if(this.rightBtn.visible)this.rightRed.visible=b};OSATarget9Panel3.prototype.listRefush=function(){var ins;var data;if(this.actType==ActivityType.Normal){ins=Activity.ins();data=ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){ins=PActivity.ins();data=ins.activityData[this.activityID]}if(data){var arr=[];for(var i=0;i<data.noticeArr.length;i++){var notice={activityID:this.activityID,name:data.noticeArr[i].name,index:data.noticeArr[i].index,actType:this.actType};arr.push(notice)}this.list.dataProvider=new eui.ArrayCollection(arr)}};OSATarget9Panel3.prototype.setTime=function(){var ins;var data;if(this.actType==ActivityType.Normal){ins=Activity.ins();data=ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){ins=PActivity.ins();data=ins.activityData[this.activityID]}if(data)this.actTime.text=i18n("OSATarget9Panel3_7")+data.getRemainTime()};return OSATarget9Panel3}(BaseView);__reflect(OSATarget9Panel3.prototype,"OSATarget9Panel3");var OSATarget9Panel3ItemRender=function(_super){__extends(OSATarget9Panel3ItemRender,_super);function OSATarget9Panel3ItemRender(){var _this=_super.call(this)||this;_this.skinName="luckyTurntableItemSkin";return _this}OSATarget9Panel3ItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this["isget"].addEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this)};OSATarget9Panel3ItemRender.prototype.onTap=function(e){var itemicon=this["gift"].getItemIcon();this.flyItemEx(itemicon);this.ins.sendReward(this.activityID,0,this.index+1)};OSATarget9Panel3ItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);if(!this.data||!(this.data.config instanceof ActivityType9Config)&&!(this.data.config instanceof PActivity9Config))return;this.actType=this.data.actType;var config=this.data.config;this.activityID=config.Id;var i=this.index=this.data.index;var data;if(this.actType==ActivityType.Normal){this.ins=Activity.ins();data=this.ins.activityData[config.Id]}else if(this.actType==ActivityType.Personal){this.ins=PActivity.ins();data=this.ins.activityData[config.Id]}if(!data)return;this.targetTime.text="/"+config.reward[i].times;this["gift"].data={id:config.reward[i].id,type:config.reward[i].type,count:config.reward[i].count};this["gift"].isShowName(false);this["lingqu"].touchEnabled=false;var color=0;var curCount=data.count>=config.reward[i].times?config.reward[i].times:data.count;if(data.record>>i+1&1){this["lingqu"].visible=true;this["isget"].touchEnabled=false;color=65280}else{this["lingqu"].visible=false;if(data.count>=config.reward[i].times){this["isget"].touchEnabled=true;color=65280}else{var prerewards=config.reward[i-1];var curCount_2=data.count;var totalCount=config.reward[i].times;if(prerewards){curCount_2=data.count-prerewards.times;totalCount=config.reward[i].times-prerewards.times}curCount_2=curCount_2>0?curCount_2:0;this["isget"].touchEnabled=false;color=16711680}}this.alreadyTime.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget9Panel3ItemRender_0",color,curCount));this.updateRedPoint(this.activityID,i)};OSATarget9Panel3ItemRender.prototype.updateRedPoint=function(activityID,idx){var b=this.ins.isGetRollReward(activityID,idx);this["redPoint"].visible=b};OSATarget9Panel3ItemRender.prototype.flyItemEx=function(itemicon){var flyItem=new eui.Image(itemicon.imgIcon.source);flyItem.x=itemicon.imgIcon.x;flyItem.y=itemicon.imgIcon.y;flyItem.width=itemicon.imgIcon.width;flyItem.height=itemicon.imgIcon.height;flyItem.scaleX=itemicon.imgIcon.scaleX;flyItem.scaleY=itemicon.imgIcon.scaleY;itemicon.imgIcon.parent.addChild(flyItem);GameLogic.ins().postFlyItemEx(flyItem)};return OSATarget9Panel3ItemRender}(BaseItemRender);__reflect(OSATarget9Panel3ItemRender.prototype,"OSATarget9Panel3ItemRender");var OSATarget9Panel4=function(_super){__extends(OSATarget9Panel4,_super);function OSATarget9Panel4(){var _this=_super.call(this)||this;_this.huntType=1;_this.skinName="luckyTurntableSkin";return _this}OSATarget9Panel4.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.menuScroller.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this);this.removeObserve();egret.Tween.removeTweens(this.tttzhi);this.rolling=false;var data;if(this.actType==ActivityType.Normal){data=this.ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=this.ins.activityData[this.activityID]}if(data&&data.indexs.length==1){this.ins.sendReward(this.activityID,1)}TimerManager.ins().removeAll(this)};OSATarget9Panel4.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);if(this.actType==ActivityType.Normal){this.ins=Activity.ins();this.config9=GlobalConfig.ActivityType9Config}else if(this.actType==ActivityType.Personal){this.ins=PActivity.ins();this.config9=GlobalConfig.PActivityType9Config}this.observe(this.ins.postChangePage,this.resultCallBack);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.addTouchEvent(this.rightBtn,this.onTouch);this.addTouchEvent(this.leftBtn,this.onTouch);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.addTouchEvent(this.choujiangBtn,this.getLottery);this.list.itemRenderer=NoticeListRenderer;this.menuList.itemRenderer=OSATarget9Panel3ItemRender;this.menuListData=new eui.ArrayCollection;this.menuList.dataProvider=this.menuListData;this.turnten.selected=false;this.currentState="resetWithKey";this.validateNow();this.updateData()};OSATarget9Panel4.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.currentTarget){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;this.updateBtn();break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;this.updateBtn();break}};OSATarget9Panel4.prototype.updateData=function(){var config=this.config9[this.activityID][0];var itemcfg=GlobalConfig.ItemConfig[config.item];if(itemcfg){this.icon.source=itemcfg.icon+"_png";var item=UserBag.ins().getBagItemById(itemcfg.id);var sum=0;var maxsum=1;var colorStr=13746831;if(item){sum=item.count;if(sum>=maxsum)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N}else{colorStr=ColorUtil.RED_COLOR_N}this.num.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget9Panel4_5",colorStr,sum,maxsum));this.pay0.text=config.yb+""}for(var i in this.config9[this.activityID]){if(!+i)continue;var cfg=this.config9[this.activityID][i];var item=this["item"+(+i-1)];item.itemIcon.data=cfg.reward[0];item.rewardState(false)}this.num2.visible=false;this.updateProgress();this.listRefush();this.setTime();var btnCfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btnCfg){if(btnCfg.title!=null&&btnCfg.title!=""){this.title.source=btnCfg.title}}};OSATarget9Panel4.prototype.resultCallBack=function(id){var data;if(this.actType==ActivityType.Normal){data=this.ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=this.ins.activityData[this.activityID]}if(!data||this.activityID!=id)return;if(data.indexs.length>1){ViewManager.ins().open(LuckyResultWin,this.activityID,data.indexs)}else if(data.indexs.length==1){this.beginLottery(data.indexs[0])}this.listRefush();this.updateData()};OSATarget9Panel4.prototype.beginLottery=function(index){var _this=this;var rotat=360*4+(index-1)*36;var tween=egret.Tween.get(this.tttzhi);this.rolling=true;tween.to({rotation:rotat},4e3,egret.Ease.circOut).call(function(){_this.ins.sendReward(_this.activityID,1);_this.flyItem(_this["item"+(index-1)]);setTimeout(function(){_this.rolling=false},2e3)},this)};OSATarget9Panel4.prototype.flyItem=function(item){var itemBase=new ItemBase;itemBase.x=item.x;itemBase.y=item.y;itemBase.data=item.itemIcon.data;itemBase.anchorOffsetX=itemBase.width/2;itemBase.anchorOffsetY=itemBase.height/2;item.parent.addChild(itemBase);GameLogic.ins().postFlyItemEx(itemBase)};OSATarget9Panel4.prototype.getLottery=function(){if(this.rolling){UserTips.ins().showTips(i18n("OSATarget9Panel4_0"));return}if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}this.huntType=this.turnten.selected?2:1;var config=this.config9[this.activityID][0];var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,config.item);if(item&&item.count){this.ins.sendReward(this.activityID,this.huntType)}else{var times=this.huntType==2?10:1;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+(times==10?"-10":"-1"),this.huntWarnFun.bind(this),i18n("OSATarget9Panel4_1",config.yb*times,GlobalConfig.ItemConfig[config.item].name,times))}};OSATarget9Panel4.prototype.huntWarnFun=function(){var config=this.config9[this.activityID][0];var times=this.huntType==2?10:1;if(Actor.yb>=config.yb*times){this.ins.sendReward(this.activityID,this.huntType)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel4_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel4_3"))}};OSATarget9Panel4.prototype.updateProgress=function(){var _this=this;var config=this.config9[this.activityID][0];var data;if(this.actType==ActivityType.Normal){data=this.ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=this.ins.activityData[this.activityID]}var arr=[];if(config&&data){for(var i=0;i<config.reward.length;i++){var arrdata={index:i,config:config,actType:this.actType};arr.push(arrdata)}this.menuListData.replaceAll(arr)}this.menuList.validateNow();TimerManager.ins().doNext(function(){var startX=0;for(var i=1;i<=_this.menuListData.length;i++){if(data.getStateByIndex(i)==0){startX=90*(i-1);break}}if(startX>_this.menuList.contentWidth-_this.menuList.width)startX=_this.menuList.contentWidth-_this.menuList.width;_this.menuList.scrollH=startX;_this.updateBtn()},this)};OSATarget9Panel4.prototype.updateBtn=function(){if(this.menuListData.length<=5){this.rightBtn.visible=this.rightRed.visible=this.leftBtn.visible=this.leftRed.visible=false}else{this.onChange()}};OSATarget9Panel4.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=this.leftRed.visible=false;this.rightBtn.visible=this.rightRed.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=this.leftRed.visible=true;this.rightBtn.visible=this.rightRed.visible=false}else{this.leftBtn.visible=this.leftRed.visible=true;this.rightBtn.visible=this.rightRed.visible=true}this.updateRedPoint()};OSATarget9Panel4.prototype.updateRedPoint=function(){var config=this.config9[this.activityID][0];var b=false;for(var i=0;i<config.reward.length;i++){b=this.ins.isGetRollReward(this.activityID,i);if(b)break}if(this.leftBtn.visible)this.leftRed.visible=b;if(this.rightBtn.visible)this.rightRed.visible=b};OSATarget9Panel4.prototype.listRefush=function(){var data;if(this.actType==ActivityType.Normal){data=this.ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=this.ins.activityData[this.activityID]}if(data){var arr=[];for(var i=0;i<data.noticeArr.length;i++){var notice={activityID:this.activityID,name:data.noticeArr[i].name,index:data.noticeArr[i].index,actType:this.actType};arr.push(notice)}this.list.dataProvider=new eui.ArrayCollection(arr)}};OSATarget9Panel4.prototype.setTime=function(){var data;if(this.actType==ActivityType.Normal){data=this.ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=this.ins.activityData[this.activityID]}if(data)this.actTime.text=i18n("OSATarget9Panel4_4")+data.getRemainTime()};return OSATarget9Panel4}(BaseView);__reflect(OSATarget9Panel4.prototype,"OSATarget9Panel4");var OSATarget9Panel5=function(_super){__extends(OSATarget9Panel5,_super);function OSATarget9Panel5(){return _super.call(this)||this}OSATarget9Panel5.prototype.setCurSkin=function(){var aCon;if(this.actType==ActivityType.Normal){aCon=GlobalConfig.ActivityConfig[this.activityID]}else if(this.actType==ActivityType.Personal){aCon=GlobalConfig.PActivityConfig[this.activityID]}if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="XNluckyTurntableSkin"};OSATarget9Panel5.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();egret.Tween.removeTweens(this.tttzhi);this.rolling=false;var data;if(this.actType==ActivityType.Normal){data=this.ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=this.ins.activityData[this.activityID]}if(data&&data.indexs.length==1){this.ins.sendReward(this.activityID,1)}TimerManager.ins().removeAll(this)};OSATarget9Panel5.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);this.setCurSkin();if(this.actType==ActivityType.Normal){this.ins=Activity.ins();this.config9=GlobalConfig.ActivityType9Config}else if(this.actType==ActivityType.Personal){this.ins=PActivity.ins();this.config9=GlobalConfig.PActivityType9Config}this.observe(this.ins.postChangePage,this.resultCallBack);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.addTouchEvent(this.choujiangBtn,this.getLottery);this.list.itemRenderer=NoticeListRenderer;this.turnten.selected=false;this.currentState="resetWithKey";this.validateNow();this.updateData()};OSATarget9Panel5.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.currentTarget){}};OSATarget9Panel5.prototype.updateData=function(){var config=this.config9[this.activityID][0];var itemcfg=GlobalConfig.ItemConfig[config.item];if(itemcfg){this.icon.source=itemcfg.icon+"_png";var item=UserBag.ins().getBagItemById(itemcfg.id);var sum=0;var maxsum=1;var colorStr=13746831;if(item){sum=item.count;if(sum>=maxsum)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N}else{colorStr=ColorUtil.RED_COLOR_N}this.num.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATarget9Panel5_8",colorStr,sum,maxsum));this.pay0.text=config.yb+""}for(var i in this.config9[this.activityID]){if(!+i)continue;var cfg=this.config9[this.activityID][i];var item=this["item"+(+i-1)];item.itemIcon.data=cfg.reward[0];item.rewardState(false)}this.num2.visible=false;this.listRefush();this.setTime()};OSATarget9Panel5.prototype.resultCallBack=function(id){var data;if(this.actType==ActivityType.Normal){data=this.ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=this.ins.activityData[this.activityID]}if(!data||this.activityID!=id)return;if(data.indexs.length>1){ViewManager.ins().open(LuckyResultWin,this.activityID,data.indexs)}else if(data.indexs.length==1){this.beginLottery(data.indexs[0])}this.listRefush();this.updateData()};OSATarget9Panel5.prototype.beginLottery=function(index){var _this=this;var rotat=360*4+(index-1)*36;var tween=egret.Tween.get(this.tttzhi);this.rolling=true;tween.to({rotation:rotat},4e3,egret.Ease.circOut).call(function(){_this.ins.sendReward(_this.activityID,1);_this.flyItem(_this["item"+(index-1)]);setTimeout(function(){_this.rolling=false},2e3)},this)};OSATarget9Panel5.prototype.flyItem=function(item){var itemBase=new ItemBase;itemBase.x=item.x;itemBase.y=item.y;itemBase.data=item.itemIcon.data;itemBase.anchorOffsetX=itemBase.width/2;itemBase.anchorOffsetY=itemBase.height/2;item.parent.addChild(itemBase);GameLogic.ins().postFlyItemEx(itemBase)};OSATarget9Panel5.prototype.getLottery=function(){if(this.rolling){UserTips.ins().showTips(i18n("OSATarget9Panel5_0"));return}if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}var config=this.config9[this.activityID][0];if(this.turnten.selected){var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,config.item);if(item&&item.count){this.ins.sendReward(this.activityID,2)}else{var count=10;var total=config.yb*count;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-10",this.checkSend10.bind(this),i18n("OSATarget9Panel5_1",total,GlobalConfig.ItemConfig[config.item].name,count))}}else{var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,config.item);if(item&&item.count){this.ins.sendReward(this.activityID,1)}else{var count=1;var total=config.yb*1;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-1",this.checkSend1.bind(this),i18n("OSATarget9Panel5_2",total,GlobalConfig.ItemConfig[config.item].name,count))}}};OSATarget9Panel5.prototype.checkSend10=function(){if(this.ins.getIsRollTen(this.activityID)){this.ins.sendReward(this.activityID,2)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel5_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel5_4"))}};OSATarget9Panel5.prototype.checkSend1=function(){if(this.ins.getRollSum(this.activityID)||Actor.yb>=this.config9[this.activityID][0].yb){this.ins.sendReward(this.activityID,1)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("OSATarget9Panel5_5"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATarget9Panel5_6"))}};OSATarget9Panel5.prototype.updateRedPoint=function(){var config=this.config9[this.activityID][0];var b=false;for(var i=0;i<config.reward.length;i++){b=this.ins.isGetRollReward(this.activityID,i);if(b)break}};OSATarget9Panel5.prototype.listRefush=function(){var data;if(this.actType==ActivityType.Normal){data=this.ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=this.ins.activityData[this.activityID]}if(data){var arr=[];for(var i=0;i<data.noticeArr.length;i++){var config=this.config9[this.activityID][data.noticeArr[i].index];var notice={activityID:this.activityID,name:data.noticeArr[i].name,index:data.noticeArr[i].index,actType:this.actType,des:config?config.middleDesc:null};arr.push(notice)}this.list.dataProvider=new eui.ArrayCollection(arr)}};OSATarget9Panel5.prototype.setTime=function(){var data;if(this.actType==ActivityType.Normal){data=this.ins.activityData[this.activityID]}else if(this.actType==ActivityType.Personal){data=this.ins.activityData[this.activityID]}if(data)this.actTime.text=i18n("OSATarget9Panel5_7")+data.getRemainTime()};return OSATarget9Panel5}(BaseView);__reflect(OSATarget9Panel5.prototype,"OSATarget9Panel5");var OSATargetDays42ItemRender=function(_super){__extends(OSATargetDays42ItemRender,_super);function OSATargetDays42ItemRender(){var _this=_super.call(this)||this;_this.skinName="OSAItem";return _this}OSATargetDays42ItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.get0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.rewardList.itemRenderer=ItemBase};OSATargetDays42ItemRender.prototype.onTap=function(e){Recharge.ins().getRechargeTotalAward(this.data.id)};OSATargetDays42ItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.num.text=data.id+"";this.rewardList.dataProvider=new eui.ArrayCollection(data.awardList);if(Recharge.ins().rechargeTotal.hasGetDays.indexOf(data.id)>=0){this.get0.visible=false;this.already.visible=true}else{this.get0.visible=true;this.already.visible=false;if(data.id<=Recharge.ins().rechargeTotal.totalDay){this.get0.label=i18n("OSATargetDays42ItemRender_0");this.get0.enabled=true}else{this.get0.label=i18n("OSATargetDays42ItemRender_1");this.get0.enabled=false}}};return OSATargetDays42ItemRender}(BaseItemRender);__reflect(OSATargetDays42ItemRender.prototype,"OSATargetDays42ItemRender");var OSATargetDays42ItemRender2=function(_super){__extends(OSATargetDays42ItemRender2,_super);function OSATargetDays42ItemRender2(){var _this=_super.call(this)||this;_this.skinName="Days42BigRewardItemSkin";return _this}OSATargetDays42ItemRender2.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};OSATargetDays42ItemRender2.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.days.text="";if(data.awardList.length>1){this.reward.data=data.awardList[1]}else{this.reward.data=data.awardList[0]}if(Recharge.ins().rechargeTotal.hasGetDays.length>=42){this.state.visible=true}else if(Recharge.ins().rechargeTotal.hasGetDays.indexOf(data.id)>=0){this.state.visible=true}else{this.state.visible=false}};return OSATargetDays42ItemRender2}(BaseItemRender);__reflect(OSATargetDays42ItemRender2.prototype,"OSATargetDays42ItemRender2");var OSATargetItemRenderer=function(_super){__extends(OSATargetItemRenderer,_super);function OSATargetItemRenderer(){var _this=_super.call(this)||this;_this.init();return _this}OSATargetItemRenderer.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);this.isGet=true};OSATargetItemRenderer.prototype.onClick=function(e){switch(e.target){case this.get:var config=void 0;var ins=void 0;if(GlobalConfig.PActivityBtnConfig[this.actId]){config=GlobalConfig.PActivityType1Config[this.actId][this.index];ins=PActivity.ins()}else{config=GlobalConfig.ActivityType1Config[this.actId][this.index];ins=Activity.ins()}if(this.isGet){ins.sendReward(this.actId,this.index)}else{var tipsLevel=0;switch(config.showType){case ShowType.LEVEL:if(Actor.level<config.level)tipsLevel=config.level-Actor.level;else if(UserZs.ins().lv<config.zslevel)tipsLevel=config.zslevel-UserZs.ins().lv;break;case ShowType.WING:if(WingsData.getWingAllLevel()<config.wingLv)tipsLevel=config.wingLv-WingsData.getWingAllLevel();break;case ShowType.ZHUZAO:if(Role.getAllForgeLevelByType(PackageID.Zhuling)<config.zzLv)tipsLevel=config.zzLv-Role.getAllForgeLevelByType(PackageID.Zhuling);break;case ShowType.LONGHUN:if(LongHunData.getLongHunAllLevel()<config.lhLv)tipsLevel=config.lhLv-LongHunData.getLongHunAllLevel();break;case ShowType.BOOK:var power=Book.ins().getBookPowerNumEx();if(power<config.tjPower)tipsLevel=config.tjPower-power;break;case ShowType.EQUIP:var point=UserBag.ins().getEquipsScoreByRolesOfBody();if(point<config.equipPower)tipsLevel=config.equipPower-point;break;case ShowType.XIAOFEI:var act=Activity.ins().getActivityDataById(this.actId);if(act.hFTotalConsumption<config.consumeYuanbao)tipsLevel=config.consumeYuanbao-act.hFTotalConsumption;break;case ShowType.RING:var lvl=0;var data=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(data&&data.level)lvl=data.level;if(lvl<config.huoyanRingLv){tipsLevel=config.huoyanRingLv-lvl}break;case ShowType.SAMSARA:if(Actor.samsaraLv<config.lunhLv)tipsLevel=config.lunhLv-Actor.samsaraLv;break;case ShowType.TONGGUAN:if(UserFb.ins().guanqiaID<config.tgNum)tipsLevel=config.tgNum-UserFb.ins().guanqiaID;break;case ShowType.FUWENTA:var level=SkyLevelModel.ins().cruLevel-1;if(level<config.fwtLv){tipsLevel=config.fwtLv-level}break;case ShowType.SHENJIANG:if(ShapeShiftingMgr.ins().getTotalPower()<config.sjPower)tipsLevel=config.sjPower-ShapeShiftingMgr.ins().getTotalPower();break}if(!tipsLevel){Activity.ins().sendReward(this.actId,this.index);return}if(config.showType==ShowType.LEVEL&&UserZs.ins().lv<config.zslevel)UserTips.ins().showTips(+tipsLevel+i18n("OSATargetItemRender_0"));else if(config.showType==ShowType.BOOK)UserTips.ins().showTips(i18n("OSATargetItemRender_3")+tipsLevel+i18n("OSATargetItemRender_4"));else if(config.showType==ShowType.EQUIP)UserTips.ins().showTips(i18n("OSATargetItemRender_5")+tipsLevel+i18n("OSATargetItemRender_6"));else if(config.showType==ShowType.XIAOFEI)UserTips.ins().showTips(i18n("OSATargetItemRender_7")+tipsLevel+i18n("OSATargetItemRender_8"));else UserTips.ins().showTips(i18n("OSATargetItemRender_9")+tipsLevel+i18n("OSATargetItemRender_10"))}break}};OSATargetItemRenderer.prototype.dataChanged=function(){if(!this.data)return;var config=this.data;var data;if(GlobalConfig.PActivityBtnConfig[config.Id]){data=PActivity.ins().getActivityDataById(config.Id)}else{data=Activity.ins().getActivityDataById(config.Id)}this.ActivityShowType(config);var role=SubRoles.ins().getSubRoleByIndex(0);var idx=0;for(var i=0;i<3;i++){this["item"+i].visible=false}for(var i=0;i<config.rewards.length;i++){var rd=config.rewards[i];if(rd.job&&rd.job!=role.job)continue;this["item"+idx].visible=true;this["item"+idx].data={type:rd.type,count:rd.count,id:rd.id};idx++}var btnType=data.getRewardStateById(config.index);var curget=data.rewardsSum[config.index];var sum=config.total?config.total-curget:1;sum=sum>0?sum:0;this.redPoint.visible=false;switch(btnType){case Activity.NotReached:if(sum>0){this.currentState="can"}else{this.currentState="zero"}this.isGet=false;break;case Activity.CanGet:if(sum>0){this.currentState="can";this.redPoint.visible=true}else{this.currentState="zero"}break;case Activity.Geted:this.currentState="already";break}this.get.touchEnabled=this.redPoint.visible;if(this.get.touchEnabled){this.get.label=i18n("OSATargetItemRender_13");this.get.currentState="up"}else{this.get.label=i18n("OSATargetItemRender_14");this.get.currentState="disabled"}this.num.visible=true;if(config.total)this.num.text=i18n("OSATargetItemRender_15")+sum+i18n("OSATargetItemRender_16");else this.num.visible=false;this.actId=config.Id;this.index=config.index;if(config.showType==ShowType.XIAOFEI){this.target.visible=this.recharge.visible=true;this.target.visible=false;this.recharge.text=data.hFTotalConsumption+"/"+config.consumeYuanbao}else{this.target.visible=this.recharge.visible=false}this.validateNow()};OSATargetItemRenderer.prototype.getRedPoint=function(config){switch(config.showType){case ShowType.LEVEL:var lv=config.level?config.level:0;var zslv=config.zslevel?config.zslevel:0;if(Actor.level>=lv&&UserZs.ins().lv>=zslv)return true;break;case ShowType.LEVEL:if(WingsData.getWingAllLevel()>=config.wingLv)return true;break;case ShowType.ZHUZAO:if(Role.getAllForgeLevelByType(PackageID.Zhuling)>=config.zzLv)return true;break;case ShowType.LONGHUN:if(LongHunData.getLongHunAllLevel()>=config.lhLv)return true;break;case ShowType.BOOK:var power=Book.ins().getBookPowerNumEx();if(power>=config.tjPower)return true;break;case ShowType.EQUIP:var point=UserBag.ins().getEquipsScoreByRolesOfBody();if(point>=config.equipPower)return true;break;case ShowType.XIAOFEI:var act=Activity.ins().getActivityDataById(this.actId);if(act.hFTotalConsumption>=config.consumeYuanbao){return true}break;case ShowType.RING:var lvl=0;var data=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(data&&data.level)lvl=data.level;return lvl>=config.huoyanRingLv;case ShowType.SAMSARA:if(Actor.samsaraLv>=config.lunhLv)return true;break;case ShowType.TONGGUAN:if(UserFb.ins().guanqiaID>=config.tgNum)return true;break;case ShowType.FUWENTA:var level=SkyLevelModel.ins().cruLevel-1;if(level>=config.fwtLv)return true;break;case ShowType.SHENJIANG:if(ShapeShiftingMgr.ins().getTotalPower()>=config.sjPower)return true;break;default:return false}};OSATargetItemRenderer.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};OSATargetItemRenderer.prototype.ActivityShowType=function(config){this.oldCond.visible=true;this.xianyuCond.visible=false;switch(config.showType){case ShowType.LEVEL:this.lvName.text=i18n("OSATargetItemRender_18");if(!config.zslevel)this.lvName0.text=config.level+"";else{this.lvName0.text=config.zslevel+i18n("OSATargetItemRender_19")}if(config.Id==15){this.lvName.text=i18n("OSATargetItemRender_20");this.lvName0.text=config.zslevel+i18n("OSATargetItemRender_21")}break;case ShowType.WING:this.lvName.text=i18n("OSATargetItemRender_22");this.lvName0.text=config.wingLv+"";break;case ShowType.ZHUZAO:this.lvName.text=i18n("OSATargetItemRender_23");this.lvName0.text=config.zzLv+"";break;case ShowType.LONGHUN:this.lvName.text=i18n("OSATargetItemRender_24");this.lvName0.text=config.lhLv+"";break;case ShowType.BOOK:this.lvName.text=i18n("OSATargetItemRender_25");this.lvName0.text=config.tjPower+"";break;case ShowType.EQUIP:this.lvName.text=i18n("OSATargetItemRender_26");this.lvName0.text=config.equipPower+"";break;case ShowType.XIAOFEI:this.lvName.text=i18n("OSATargetItemRender_27");this.lvName0.text=config.consumeYuanbao+"";break;case ShowType.RING:this.lvName.text=i18n("OSATargetItemRender_28");var level=config.huoyanRingLv;var stage=SpecialRing.ins().getRingStair(level);var star=SpecialRing.ins().getRingStar(level);this.lvName0.text=stage+i18n("OSATargetItemRender_29")+star+i18n("OSATargetItemRender_30");break;case ShowType.SAMSARA:this.lvName.text=i18n("OSATargetItemRender_31");var lv1=SamsaraModel.ins().getSamsara(config.lunhLv);var lv2=SamsaraModel.ins().getSamsaraLv(config.lunhLv);var desc=SamsaraModel.ins().getSamsaraDesc(lv1)+"·"+SamsaraModel.ins().getSamsaraLvDesc(lv2);this.lvName0.textFlow=TextFlowMaker.generateTextFlow1(config.lunhLv+"\n|S:16&T:"+desc);break;case ShowType.ZHANLING:this.lvName.text=i18n("OSATargetItemRender_32");var lv=config.zhanlingLv;this.lvName0.text=Math.ceil(lv/10)+i18n("OSATargetItemRender_33")+(lv%10==0?lv?10:0:lv%10)+i18n("OSATargetItemRender_34");break;case ShowType.XIANYU:this.oldCond.visible=false;this.xianyuCond.visible=true;var xianyuziseNum=config.xianyuziseNum;var xianyuLv=config.xianyuLv;var xianyuNum=config.xianyuNum;var str="";if(xianyuNum){str=i18n("OSATargetItemRender_35",xianyuNum)}if(xianyuziseNum){str=i18n("OSATargetItemRender_36",xianyuziseNum)}if(xianyuLv){str=i18n("OSATargetItemRender_37",xianyuLv)}this.xianyu.textFlow=(new egret.HtmlTextParser).parser(str);break;case ShowType.TONGGUAN:this.lvName.text=i18n("OSATargetItemRender_38");this.lvName0.text=config.tgNum+"";break;case ShowType.FUWENTA:this.lvName.text=i18n("OSATargetItemRender_39");this.lvName0.text=config.fwtLv+"";break;case ShowType.SHENJIANG:this.lvName.text=i18n("OSATargetItemRender_40");this.lvName0.text=config.sjPower+"";break}};return OSATargetItemRenderer}(BaseItemRender);__reflect(OSATargetItemRenderer.prototype,"OSATargetItemRenderer");var OSATargetItemRender1=function(_super){__extends(OSATargetItemRender1,_super);function OSATargetItemRender1(){var _this=_super.call(this)||this;_this.skinName="OSADailyGiftItemSkin";_this.init();return _this}OSATargetItemRender1.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);this.reward.itemRenderer=ItemBase};OSATargetItemRender1.prototype.onClick=function(e){switch(e.target){case this.get:if(this.isGet){if(this.data instanceof ActivityType2Config){Activity.ins().sendReward(this.actId,this.index)}else if(this.data instanceof PActivity2Config){PActivity.ins().sendReward(this.actId,this.index)}}else{var config=this.data;if(config){if(UserVip.ins().lv<config.vip){var warnWin=WarnWin.show(i18n("OSATargetItemRender1_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATargetItemRender1_1"))}else{var warnWin=WarnWin.show(i18n("OSATargetItemRender1_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("OSATargetItemRender1_4"))}}}break}};OSATargetItemRender1.prototype.dataChanged=function(){if(!this.data)return;var config;var act2Data;if(this.data instanceof ActivityType2Config){config=this.data;act2Data=Activity.ins().getActivityDataById(config.Id)}else if(this.data instanceof PActivity2Config){config=this.data;act2Data=PActivity.ins().getActivityDataById(config.Id)}if(!config||!act2Data){this.isGet=false;return}this.redPoint.visible=false;if(act2Data.buyData[config.index]>=config.count){this.isGet=false;this.already.visible=true}else{this.isGet=UserVip.ins().lv>=config.vip&&Actor.yb>=config.price;this.already.visible=false;this.redPoint.visible=this.getRedPoint(config)}var cur=config.count-act2Data.buyData[config.index];cur=cur<=0?0:cur;var colorStr=cur?65280:16711680;this.times.textFlow=TextFlowMaker.generateTextFlow1(i18n("OSATargetItemRender1_5",colorStr,cur,config.count));this.times.visible=this.get.visible=!this.already.visible;this.original.text=config.originalPrice+"";this.now.text=config.price+"";this.reward.dataProvider=new eui.ArrayCollection(config.rewards);this.actId=config.Id;this.index=config.index;this.showDisCountNum(config.discount);if(config.vip){this.vip.visible=true;this.vipLv.text=config.vip+""}else{this.vip.visible=false}if(Actor.level<ActivityType2Data.LimitLevel)this.redPoint.visible=false};OSATargetItemRender1.prototype.getRedPoint=function(config){return UserVip.ins().lv>=config.vip&&Actor.yb>=config.price};OSATargetItemRender1.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};OSATargetItemRender1.prototype.showDisCountNum=function(discount){if(discount%10==0){this.discountNum.text=discount/10+""}else{this.discountNum.text=(discount/10).toFixed(1)}};return OSATargetItemRender1}(BaseItemRender);__reflect(OSATargetItemRender1.prototype,"OSATargetItemRender1");var OSATargetItemRender4=function(_super){__extends(OSATargetItemRender4,_super);function OSATargetItemRender4(){var _this=_super.call(this)||this;_this.skinName="OSARankListItemSkin";_this.init();return _this}OSATargetItemRender4.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);this.reward.itemRenderer=ItemBase};OSATargetItemRender4.prototype.onClick=function(e){};OSATargetItemRender4.prototype.dataChanged=function(){if(!this.data.rankData)return;var rankData=this.data.rankData;var activityID=this.data.activityID;var pos;var cfg=GlobalConfig.ActivityType4Config[activityID][1];var rankType=cfg.rankType;if(rankType==RankDataType.TYPE_HF_XIAOFEI||rankType==RankDataType.TYPE_XIAOFEI){if(rankData instanceof DabiaoData){var rank=this.data.rank?this.data.rank:rankData.rankIndex;if(rank<=3){this.rankImg.source="paihang"+rank;this.rankNum.visible=false}else{this.rankImg.source="";this.rankNum.visible=true;this.rankNum.text=rank+""}this.name1.text=rankData.name;this.value.text=rankData.numType;pos=rank;if(pos==1){pos=1}else if(pos==2||pos==3){pos=2}else if(pos==4||pos==5){pos=4}else{pos=6}cfg=GlobalConfig.ActivityType4Config[activityID][pos];this.reward.dataProvider=new eui.ArrayCollection(cfg.rewards)}else{var rank=this.data.rank?this.data.rank:rankData.pos;if(rank<=3){this.rankImg.source="paihang"+rank;this.rankNum.visible=false}else{this.rankImg.source="";this.rankNum.visible=true;this.rankNum.text=rank}this.name1.text=rankData.player;this.value.text=rankData.value;pos=rank;if(pos==1){pos=1}else if(pos==2||pos==3){pos=2}else if(pos==4||pos==5){pos=4}else{pos=6}cfg=GlobalConfig.ActivityType4Config[activityID][pos];this.reward.dataProvider=new eui.ArrayCollection(cfg.rewards)}}else{if(rankData instanceof DabiaoData){if(rankData.rankIndex<=3){this.rankImg.source="paihang"+rankData.rankIndex;this.rankNum.visible=false}else{this.rankImg.source="";this.rankNum.visible=true;this.rankNum.text=rankData.rankIndex+""}this.name1.text=rankData.name;this.value.text=rankData.numType;pos=rankData.rankIndex;if(pos>4){pos=4}cfg=GlobalConfig.ActivityType4Config[activityID][pos];this.reward.dataProvider=new eui.ArrayCollection(cfg.rewards)}else{if(rankData.pos<=3){this.rankImg.source="paihang"+rankData.pos;this.rankNum.visible=false}else{this.rankImg.source="";this.rankNum.visible=true;this.rankNum.text=rankData.pos}this.name1.text=rankData.player;this.value.text=rankData.value;pos=rankData.pos;cfg=GlobalConfig.ActivityType4Config[activityID][pos];this.reward.dataProvider=new eui.ArrayCollection(cfg.rewards)}}};return OSATargetItemRender4}(BaseItemRender);__reflect(OSATargetItemRender4.prototype,"OSATargetItemRender4");var OSAXianMengZhiLuItemRender=function(_super){__extends(OSAXianMengZhiLuItemRender,_super);function OSAXianMengZhiLuItemRender(){var _this=_super.call(this)||this;_this.state=1;_this.skinName="OSAXianMengZhiLuItemSkin";return _this}OSAXianMengZhiLuItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};OSAXianMengZhiLuItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.setState();this.setInfo()};OSAXianMengZhiLuItemRender.prototype.setState=function(){var data=this.data;this.state=data.state};OSAXianMengZhiLuItemRender.prototype.setInfo=function(){var data=this.data;this.taskDesc.textFlow=TextFlowMaker.generateTextFlow(i18n("OSAXianMengZhiLuItemRender_1",data.config.taskDesc,"|C:"+(data.state>=data.config.value?"0x3FFF00":"0xFD7878")+"&T:"+data.state+"|",data.config.value));this.desc.text=data.config.desc||"";this.memberNum.text=i18n("OSAXianMengZhiLuItemRender_2",data.config.memberNum);this.taskLv.text=data.config.taskLv;var reward=[];for(var k in data.config.reward){reward.push(data.config.reward[k])}this.reward.dataProvider=new eui.ArrayCollection(reward)};return OSAXianMengZhiLuItemRender}(BaseItemRender);__reflect(OSAXianMengZhiLuItemRender.prototype,"OSAXianMengZhiLuItemRender");var SanbaWin=function(_super){__extends(SanbaWin,_super);function SanbaWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.selectIndex=0;_this.skinName="sanbaWin";_this.isTopLevel=true;return _this}SanbaWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.menuList.itemRenderer=ActivityBtnRenderer};SanbaWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateView();this.addTouchEvent(this,this.onTouch);this.addChangeEvent(this.menuList,this.onClickMenu);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.selectIndex=0;if(param&&param.length){var id=param[0];var i=0;for(var k in this._datas){if(this._datas[k].id==id){this.selectIndex=i;break}i++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.selectIndex!=0)this.activityPanelList[0].close();this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true);this.onChange()};SanbaWin.prototype.close=function(){for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};SanbaWin.prototype.onChange=function(){if(this.menuList.scrollH<20){this.leftBtn0.visible=false;this.rightBtn0.visible=true}else if(this.menuList.scrollH>(this.menuList.dataProvider.length-5)*88+2){this.leftBtn0.visible=true;this.rightBtn0.visible=false}else{this.leftBtn0.visible=true;this.rightBtn0.visible=true}this.leftRed0.visible=this.rightRed0.visible=false;var len=this.menuList.dataProvider.length;if(len<=5){this.leftBtn0.visible=false;this.rightBtn0.visible=false}else{var curIndex=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn0.visible){for(var i=0;i<=curIndex-5;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed0.visible=true;break}}}if(this.rightBtn0.visible){for(var i=curIndex+1;i<len;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed0.visible=true;break}}}}};SanbaWin.prototype.updateView=function(){var i=0;for(i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];for(var k in Activity.ins().activityData){if(Activity.ins().activityData[k].pageStyle==ActivityPageStyle.SANBA&&Activity.ins().getActivityDataById(+k).isOpenActivity()&&!Activity.ins().getActivityDataById(+k).getHide())this._datas.push(Activity.ins().getbtnInfo(k))}this._datas.sort(this.sort);i=0;for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);var panel=ActivityPanel.create(id,act.activityType);panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);i++}this.dataArr=new eui.ArrayCollection(this._datas);this.menuList.dataProvider=this.dataArr;this.viewStack.validateNow();this.menuList.validateNow()};SanbaWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas);this.menuList.dataProvider=this.dataArr};SanbaWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};SanbaWin.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn0:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;this.onChange();break;case this.rightBtn0:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;this.onChange();break}};SanbaWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this.activityPanelList[this.selectIndex].close()}else return;this.selectIndex=e.currentTarget.selectedIndex;this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true)};return SanbaWin}(BaseEuiView);__reflect(SanbaWin.prototype,"SanbaWin");ViewManager.ins().reg(SanbaWin,LayerManager.UI_Main);var ActivityStoreRewardShowWin=function(_super){__extends(ActivityStoreRewardShowWin,_super);function ActivityStoreRewardShowWin(){var _this=_super.call(this)||this;_this.skinName="activityStoreRewardShowSkin";_this.isTopLevel=true;return _this}ActivityStoreRewardShowWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.shopList.itemRenderer=ActivityStoreShowItemRender};ActivityStoreRewardShowWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._activityID=args[0];this.update();this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch)};ActivityStoreRewardShowWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch);this.removeTouchEvent(this.closeBtn,this.onTouch)};ActivityStoreRewardShowWin.prototype.update=function(){var config=Activity.ins().getConfig22_3(this._activityID);this.shopList.dataProvider=new ArrayCollection(config?config.showReward:null)};ActivityStoreRewardShowWin.prototype.onTouch=function(e){ViewManager.ins().close(this)};return ActivityStoreRewardShowWin}(BaseEuiView);__reflect(ActivityStoreRewardShowWin.prototype,"ActivityStoreRewardShowWin");ViewManager.ins().reg(ActivityStoreRewardShowWin,LayerManager.UI_Main);var SpringBeginWin=function(_super){__extends(SpringBeginWin,_super);function SpringBeginWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.selectIndex=0;_this.skinName="springBeginWin";_this.isTopLevel=true;return _this}SpringBeginWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.menuList.itemRenderer=ActivityBtnRenderer};SpringBeginWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateView();this.addTouchEvent(this,this.onTouch);this.addChangeEvent(this.menuList,this.onClickMenu);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(UserBag.ins().postItemAdd,this.refushRedPoint);this.observe(UserBag.ins().postItemChange,this.refushRedPoint);this.observe(UserBag.ins().postItemDel,this.refushRedPoint);this.selectIndex=0;if(param&&param.length){var id=param[0];var i=0;for(var k in this._datas){if(this._datas[k].id==id){this.selectIndex=i;break}i++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.selectIndex!=0)this.activityPanelList[0].close();this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true);this.onChange()};SpringBeginWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList);this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller);this.removeObserve();for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};SpringBeginWin.prototype.onChange=function(){if(this.menuList.scrollH<20){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>(this.menuList.dataProvider.length-5)*88+2){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}this.leftRed.visible=this.rightRed.visible=false;var len=this.menuList.dataProvider.length;if(len<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}else{var curIndex=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn.visible){for(var i=0;i<=curIndex-5;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed.visible=true;break}}}if(this.rightBtn.visible){for(var i=curIndex+1;i<len;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed.visible=true;break}}}}};SpringBeginWin.prototype.updateView=function(){var i=0;for(i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle==ActivityPageStyle.SPRINGBEGIN&&Activity.ins().getActivityDataById(+k).isOpenActivity()&&!Activity.ins().getActivityDataById(+k).getHide())this._datas.push(Activity.ins().getbtnInfo(k))}this._datas.sort(this.sort);i=0;for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);var panel=ActivityPanel.create(id,act.activityType);panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);i++}this.dataArr=new eui.ArrayCollection(this._datas);this.menuList.dataProvider=this.dataArr;this.viewStack.validateNow();this.menuList.validateNow()};SpringBeginWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas);this.menuList.dataProvider=this.dataArr};SpringBeginWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};SpringBeginWin.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;this.onChange();break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;this.onChange();break}};SpringBeginWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this.activityPanelList[this.selectIndex].close()}else return;this.selectIndex=e.currentTarget.selectedIndex;this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true)};return SpringBeginWin}(BaseEuiView);__reflect(SpringBeginWin.prototype,"SpringBeginWin");ViewManager.ins().reg(SpringBeginWin,LayerManager.UI_Main);var ActivityStoreItemRender=function(_super){__extends(ActivityStoreItemRender,_super);function ActivityStoreItemRender(){var _this=_super.call(this)||this;_this.skinName="activityStoreItem";return _this}ActivityStoreItemRender.prototype.dataChanged=function(){this.buyBtn.label=this.data.isScore?i18n("ActivityStoreItemRender_0"):i18n("ActivityStoreItemRender_1");this.discount.visible=!this.data.isScore&&this.data.data.discount;if(this.discount.visible)this.discountNum.source="discountNum"+this.data.data.discount;this.itemIcon.data={type:1,id:this.data.data.itemID,count:this.data.data.itemCount};this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);if(!this.data.isScore){this.buyBtn.enabled=this.data.data.state==0;this.yuanbao.visible=true;this.jifen.visible=false;this.money.text=this.data.data.price}else{this.buyBtn.enabled=true;this.yuanbao.visible=false;this.jifen.visible=true;this.jifenNum.text=this.data.data.score}};ActivityStoreItemRender.prototype.onRmove=function(e){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};ActivityStoreItemRender.prototype.onTouch=function(e){var data=Activity.ins().activityData[this.data.activityID];if(this.data.isScore){if(data.tScore<this.data.data.score)UserTips.ins().showTips(i18n("ActivityStoreItemRender_2"));else Activity.ins().sendReward(this.data.activityID,0,4,this.data.data.id)}else{if(Actor.yb<this.data.data.price){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("ActivityStoreItemRender_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("ActivityStoreItemRender_4"))}else Activity.ins().sendReward(this.data.activityID,0,3,this.data.data.id)}};return ActivityStoreItemRender}(BaseItemRender);__reflect(ActivityStoreItemRender.prototype,"ActivityStoreItemRender");var ActivityStoreShowItemRender=function(_super){__extends(ActivityStoreShowItemRender,_super);function ActivityStoreShowItemRender(){var _this=_super.call(this)||this;_this.skinName="activityStoreShowItem";return _this}ActivityStoreShowItemRender.prototype.dataChanged=function(){this.discount.visible=this.data.discountImg>0;if(this.discount.visible)this.discountNum.source="discountNum"+this.data.discountImg;this.money.text=this.data.cost;this.itemIcon.data=this.data};return ActivityStoreShowItemRender}(BaseItemRender);__reflect(ActivityStoreShowItemRender.prototype,"ActivityStoreShowItemRender");var SpringEightDayWin=function(_super){__extends(SpringEightDayWin,_super);function SpringEightDayWin(){var _this=_super.call(this)||this;_this._curDay=0;_this._curDayIndex=0;_this._curGroupIndex=0;_this.isTopLevel=true;_this.setActivityID();_this.setCurSkin();return _this}SpringEightDayWin.prototype.setActivityID=function(){var data=Activity.ins().activityData;for(var k in data){if(data[k].pageStyle==ActivityPageStyle.SPRINGEIGHTDAY){this._activityID=data[k].id;break}}};SpringEightDayWin.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this._activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="SFEightDayWin";if(this.actInfo0)this.actInfo0.text=aCon.desc};SpringEightDayWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.tabP.itemRenderer=HappySevenDayTabListItemRender;this.tabD.itemRenderer=HappySevenDayBtnItemRender;this.list.itemRenderer=HappySevenDayItemRender};SpringEightDayWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._activityID=param[0];this.setCurSkin();this._curDayIndex=0;this._curGroupIndex=0;this.updateView();this.updateTabs();this.tabD.selectedIndex=this._curDayIndex;this.tabP.selectedIndex=this._curGroupIndex;this.updateData();this.updateTargetAward();this.addTouchEvent(this,this.onTouch);this.observe(Activity.ins().postActivityIsGetAwards,this.refreshReds);this.addChangeEvent(this.tabD,this.onClickBtn);this.addChangeEvent(this.tabP,this.onTabBtn);TimerManager.ins().doTimer(1e3,0,this.setTime,this)};SpringEightDayWin.prototype.close=function(){this._tabCollect=null;this._btnCollect=null;this._listCollect=null};SpringEightDayWin.prototype.updateView=function(){var data=Activity.ins().getActivityDataById(this._activityID);this._curDay=data.getCurDay();this._items=[];var confs=GlobalConfig.ActivityType11_2Config[this._activityID];var conf;var btnArr=[];var days;var day;var group;var groups;var achieve;for(var k in confs){conf=confs[k];day=conf.day;days=this._items[conf.day-1];if(!days){days=[];this._items[conf.day-1]=days;btnArr.push({res:conf.dayImg,isOpen:this._curDay>=conf.day,showRed:false,day:conf.day})}achieve=data.achieveInfo[conf.index-1];if(this._curDay>=conf.day&&!achieve.isGot&&achieve.times>=conf.dayLimit)btnArr[conf.day-1].showRed=true;group=conf.group;groups=days[group-1];if(!groups){groups=[];days[group-1]=groups}groups.push(conf)}if(!this._btnCollect){this._btnCollect=new ArrayCollection;this.tabD.dataProvider=this._btnCollect}this._btnCollect.source=btnArr;this.tabD.validateNow();if(!this._tabCollect){this._tabCollect=new ArrayCollection;this.tabP.dataProvider=this._tabCollect}};SpringEightDayWin.prototype.refreshReds=function(){this.updateView();this.updateTabs();this.updateData();this.updateTargetAward()};SpringEightDayWin.prototype.updateData=function(){var items=this._items[this._curDayIndex][this._curGroupIndex];if(!items||!items.length)return;if(!this._listCollect){this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect}var len=items.length;var conf;var datas=[];var state=0;var achieve;var activityData=Activity.ins().getActivityDataById(this._activityID);for(var i=0;i<len;i++){conf=items[i];achieve=activityData.achieveInfo[conf.index-1];if(achieve.isGot)state=2;else if(achieve.times>=conf.dayLimit)state=1;else state=0;datas[i]={activityID:this._activityID,conf:conf,state:state,times:achieve.times}}datas.sort(this.sort);this._listCollect.source=datas};SpringEightDayWin.prototype.sort=function(a,b){if(a.state==1&&b.state!=1)return-1;if(a.state==2&&b.state!=2)return 1;if(a.conf.index<b.conf.index)return-1;if(a.conf.index>b.conf.index)return 1;return 0};SpringEightDayWin.prototype.updateTargetAward=function(){var conf=GlobalConfig.ActivityType11_1Config[this._activityID][Object.keys(GlobalConfig.ActivityType11_1Config[this._activityID]).length];this.schedule.maximum=conf.score;this.schedule.value=Activity.ins().getActivityDataById(this._activityID).hiScore};SpringEightDayWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:ViewManager.ins().open(SDRewardWin,this._activityID);break}};SpringEightDayWin.prototype.onClickBtn=function(e){if(this._curDayIndex==e.currentTarget.selectedIndex)return;var btnItem=this.tabD.getChildAt(e.currentTarget.selectedIndex);if(!btnItem.isOpen)UserTips.ins().showCenterTips(i18n("SpringEightDayWin_0")+btnItem.day+i18n("SpringEightDayWin_1"));else{btnItem=this.tabD.getChildAt(this._curDayIndex);btnItem.selected=false;this._curDayIndex=e.currentTarget.selectedIndex}this.tabD.selectedIndex=this._curDayIndex;btnItem=this.tabD.getChildAt(this._curDayIndex);btnItem.selected=true;this.updateTabs();this.tabP.selectedIndex=this._curGroupIndex=0;this.updateData()};SpringEightDayWin.prototype.onTabBtn=function(e){if(this._curGroupIndex==e.currentTarget.selectedIndex)return;this._curGroupIndex=e.currentTarget.selectedIndex;this.tabP.selectedIndex=this._curGroupIndex;this.updateData()};SpringEightDayWin.prototype.updateTabs=function(){var days=this._items[this._curDayIndex];var data=Activity.ins().getActivityDataById(this._activityID);var tabs=[];var len;var achieve;var conf;for(var k in days){tabs.push({gName:days[k][0].gName,showRed:false});len=days[k].length;for(var i=0;i<len;i++){conf=days[k][i];achieve=data.achieveInfo[conf.index-1];if(this._curDay>=conf.day&&!achieve.isGot&&achieve.times>=conf.dayLimit){tabs[k].showRed=true;break}}}this._tabCollect.source=tabs};SpringEightDayWin.prototype.setTime=function(){var data=Activity.ins().activityData[this._activityID];this.actTime0.text=data.getRemainTime()};return SpringEightDayWin}(BaseEuiView);__reflect(SpringEightDayWin.prototype,"SpringEightDayWin");ViewManager.ins().reg(SpringEightDayWin,LayerManager.UI_Main);var SpringFestivalWin=function(_super){__extends(SpringFestivalWin,_super);function SpringFestivalWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.selectIndex=0;_this.skinName="springfestivalWin";_this.isTopLevel=true;return _this}SpringFestivalWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.menuList.itemRenderer=ActivityBtnRenderer};SpringFestivalWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateView();this.addTouchEvent(this,this.onTouch);this.addChangeEvent(this.menuList,this.onClickMenu);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.selectIndex=0;if(param&&param.length){var id=param[0];var i=0;for(var k in this._datas){if(this._datas[k].id==id){this.selectIndex=i;break}i++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.selectIndex!=0)this.activityPanelList[0].close();this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true);this.onChange()};SpringFestivalWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList);this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller);this.removeObserve();for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};SpringFestivalWin.prototype.onChange=function(){if(this.menuList.scrollH<20){this.leftBtn0.visible=false;this.rightBtn0.visible=true}else if(this.menuList.scrollH>(this.menuList.dataProvider.length-5)*88+2){this.leftBtn0.visible=true;this.rightBtn0.visible=false}else{this.leftBtn0.visible=true;this.rightBtn0.visible=true}this.leftRed0.visible=this.rightRed0.visible=false;var len=this.menuList.dataProvider.length;if(len<=5){this.leftBtn0.visible=false;this.rightBtn0.visible=false}else{var curIndex=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn0.visible){for(var i=0;i<=curIndex-5;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed0.visible=true;break}}}if(this.rightBtn0.visible){for(var i=curIndex+1;i<len;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed0.visible=true;break}}}}};SpringFestivalWin.prototype.updateView=function(){var i=0;for(i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];for(var k in Activity.ins().activityData){if(Activity.ins().activityData[k].pageStyle==ActivityPageStyle.SPRINGFESTIVAL&&Activity.ins().getActivityDataById(+k).isOpenActivity()&&!Activity.ins().getActivityDataById(+k).getHide())this._datas.push(Activity.ins().getbtnInfo(k))}this._datas.sort(this.sort);i=0;for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);var panel=ActivityPanel.create(id,act.activityType);panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);i++}this.dataArr=new eui.ArrayCollection(this._datas);this.menuList.dataProvider=this.dataArr;this.viewStack.validateNow();this.menuList.validateNow()};SpringFestivalWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas);this.menuList.dataProvider=this.dataArr};SpringFestivalWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};SpringFestivalWin.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn0:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;this.onChange();break;case this.rightBtn0:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;this.onChange();break}};SpringFestivalWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this.activityPanelList[this.selectIndex].close()}else return;this.selectIndex=e.currentTarget.selectedIndex;this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true)};return SpringFestivalWin}(BaseEuiView);__reflect(SpringFestivalWin.prototype,"SpringFestivalWin");ViewManager.ins().reg(SpringFestivalWin,LayerManager.UI_Main);var Activity2Panel1=function(_super){__extends(Activity2Panel1,_super);function Activity2Panel1(){var _this=_super.call(this)||this;_this.skinName="LimitGiftActSkin";return _this}Activity2Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};Activity2Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateData();this.addTouchEvent(this.buy0,this.onTap);this.addTouchEvent(this.buy1,this.onTap);this.addTouchEvent(this.buy2,this.onTap)};Activity2Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}debug.log("close");this.removeTouchEvent(this.buy0,this.onTap);this.removeTouchEvent(this.buy1,this.onTap);this.removeTouchEvent(this.buy2,this.onTap)};Activity2Panel1.prototype.onTap=function(e){var _this=this;var config;var index;switch(e.currentTarget){case this.buy0:index=0;break;case this.buy1:index=1;break;case this.buy2:index=2;break}var activityData=Activity.ins().activityData[this.activityID];config=GlobalConfig.ActivityType2Config[this.activityID][index];var buyData=activityData.buyData[index]||0;var myMoney=config.currencyType==1?Actor.gold:Actor.yb;var typeName=config.currencyType==1?i18n("Activity2Panel1_0"):i18n("Activity2Panel1_1");if(config.vip&&UserVip.ins().lv<config.vip){var warnWin=WarnWin.show(i18n("Activity2Panel1_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("Activity2Panel1_4"))}else{var id=this.configList[index].rewards[0].id;var type=ItemConfig.getType(GlobalConfig.ItemConfig[id]);if(UserBag.ins().getSurplusCount()<1&&type==0){UserTips.ins().showTips(i18n("Activity2Panel1_5"));return}if(myMoney>=config.price){WarnWin.show(i18n("Activity2Panel1_6",config.price)+typeName+i18n("Activity2Panel1_7"),function(){Activity.ins().sendReward(_this.activityID,index+1)},this)}else UserTips.ins().showTips(typeName+i18n("Activity2Panel1_8"))}};Activity2Panel1.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.date.text=i18n("Activity2Panel1_9")}else if(endedTime<=0){this.date.text=i18n("Activity2Panel1_10")}else{var day=Math.floor(endedTime/(3600*24));var hour=Math.floor(endedTime%(3600*24)/3600);var minu=Math.floor(endedTime%3600/60);this.date.text=day+i18n("Activity2Panel1_11")+hour+i18n("Activity2Panel1_12")+minu+i18n("Activity2Panel1_13")}this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc;this.configList=GlobalConfig.ActivityType2Config[this.activityID];if(this.group_item0)this.group_item0.visible=false;if(this.group_item1)this.group_item1.visible=false;if(this.group_item2)this.group_item2.visible=false;for(var i=0;i<this.configList.length;i++){var config=this.configList[i];var buyData=activityData.buyData[i]||0;var item=this["item"+i];var itemCount=this["itemCount"+i];var label_title=this["label_title"+i];var price=this["price"+i];var desc=this["desc"+i];var buy=this["buy"+i];var redPoint=this["redPoint"+i];var group_item=this["group_item"+i];var imgDiscount=this["imgDiscount"+i];var nameLabel=this["itemname"+i];var title=this["title"+i];var itemCfg=GlobalConfig.ItemConfig[config.rewards[0].id];if(item){item.setData(itemCfg);itemCount.text=config.rewards[0].count+""}if(nameLabel){nameLabel.text=itemCfg.name}if(label_title){label_title.text=config.vip?i18n("Activity2Panel1_15",config.vip):i18n("Activity2Panel1_14")}if(price){price.setText(config.price+"");price.setType(config.currencyType==1?MoneyConst.gold:MoneyConst.yuanbao)}if(desc){desc.text=i18n("Activity2Panel1_16")+(config.count-buyData)}if(title){title.source="tq_"+(config.vip<10?"0"+config.vip:config)}if(buy){buy.enabled=config.count-buyData>0}if(redPoint){redPoint.visible=Activity.ins().getisCanBuyXianGouItem(this.activityID+"",i)}if(group_item){group_item.visible=true}if(imgDiscount){}}};return Activity2Panel1}(BaseView);__reflect(Activity2Panel1.prototype,"Activity2Panel1");var Activity2Panel2=function(_super){__extends(Activity2Panel2,_super);function Activity2Panel2(){var _this=_super.call(this)||this;_this._index=0;_this.skinName="ActGiftSkin";_this.list.itemRenderer=ItemBase;return _this}Object.defineProperty(Activity2Panel2,"giftNameArr",{get:function(){if(this._giftNameArr==null){this._giftNameArr=[i18n("Activity2Panel2_0"),i18n("Activity2Panel2_1"),i18n("Activity2Panel2_2"),i18n("Activity2Panel2_3")]}return this._giftNameArr},enumerable:true,configurable:true});Activity2Panel2.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};Activity2Panel2.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.buyBtn,this.onTap);this.addTouchEvent(this.type_1,this.onTap);this.addTouchEvent(this.type_2,this.onTap);this.addTouchEvent(this.type_3,this.onTap);this.addTouchEvent(this.type_4,this.onTap);this.updateData();if(ChannelMgr.ins().isRechargeHidden()){this.buyBtn.label=i18n("Recharge_30")}else{this.buyBtn.label=i18n("Recharge_29")}};Activity2Panel2.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buyBtn,this.onTap);this.removeTouchEvent(this.type_1,this.onTap);this.removeTouchEvent(this.type_2,this.onTap);this.removeTouchEvent(this.type_3,this.onTap);this.removeTouchEvent(this.type_4,this.onTap)};Activity2Panel2.prototype.onTap=function(e){var _this=this;var index;switch(e.currentTarget){case this.buyBtn:index=-1;if(this.config.vip&&UserVip.ins().lv<this.config.vip){var warnWin=WarnWin.show(i18n("Activity2Panel2_5"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("Activity2Panel2_6"))}else{if(UserBag.ins().getSurplusCount()<1&&this._index==3){UserTips.ins().showTips(i18n("Activity2Panel2_7"));return}if(Actor.yb>=this.config.price){WarnWin.show(i18n("Activity2Panel2_8",this.config.price),function(){Activity.ins().sendReward(_this.activityID,_this._index+1)},this)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("Activity2Panel2_9"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("Activity2Panel2_10"))}}}break;case this.type_1:index=0;break;case this.type_2:index=1;break;case this.type_3:index=2;break;case this.type_4:index=3;break}if(index!=-1)this.updateData(index)};Activity2Panel2.prototype.updateData=function(index){if(index===void 0){index=0}var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor((DateUtils.formatMiniDateTime(activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.date.text=i18n("Activity2Panel2_11")}else if(endedTime<=0){this.date.text=i18n("Activity2Panel2_12")}else{this.date.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.config=GlobalConfig.ActivityType2Config[this.activityID][index];this.list.dataProvider=new eui.ArrayCollection(this.config.rewards);var giftName=Activity2Panel2.giftNameArr[index];var str=i18n("Activity2Panel2_13",this.config.price,giftName);this.desc.textFlow=(new egret.HtmlTextParser).parser(str);this.chosen.x=7+index*105;this._index=index;this.get_1.visible=activityData.buyData[0]==1;this.get_2.visible=activityData.buyData[1]==1;this.get_3.visible=activityData.buyData[2]==1;this.get_4.visible=activityData.buyData[3]==1;this.buyBtn.visible=activityData.buyData[index]==0};return Activity2Panel2}(BaseView);__reflect(Activity2Panel2.prototype,"Activity2Panel2");var VersionCeleWin=function(_super){__extends(VersionCeleWin,_super);function VersionCeleWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.selectIndex=0;_this.skinName="carnivalWin";_this.isTopLevel=true;return _this}VersionCeleWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.menuList.itemRenderer=ActivityBtnRenderer};VersionCeleWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateView();this.addTouchEvent(this,this.onTouch);this.addChangeEvent(this.menuList,this.onClickMenu);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(UserBag.ins().postItemAdd,this.refushRedPoint);this.observe(UserBag.ins().postItemChange,this.refushRedPoint);this.observe(UserBag.ins().postItemDel,this.refushRedPoint);this.selectIndex=0;if(param&&param.length){var id=param[0];var i=0;for(var k in this._datas){if(this._datas[k].id==id){this.selectIndex=i;break}i++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.selectIndex!=0)this.activityPanelList[0].close();this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true);this.onChange()};VersionCeleWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList);this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller);this.removeObserve();for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};VersionCeleWin.prototype.onChange=function(){if(this.menuList.scrollH<20){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>(this.menuList.dataProvider.length-5)*88+2){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}this.leftRed.visible=this.rightRed.visible=false;var len=this.menuList.dataProvider.length;if(len<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}else{var curIndex=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn.visible){for(var i=0;i<=curIndex-5;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed.visible=true;break}}}if(this.rightBtn.visible){for(var i=curIndex+1;i<len;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed.visible=true;break}}}}};VersionCeleWin.prototype.updateView=function(){var i=0;for(i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];for(var k in Activity.ins().activityData){var ac=Activity.ins().activityData[k];if(!ac)continue;if(ac.pageStyle==ActivityPageStyle.VERSIONCELE&&ac.type!=ActivityDataFactory.ACTIVITY_TYPE_22&&Activity.ins().getActivityDataById(+k).isOpenActivity()&&!Activity.ins().getActivityDataById(+k).getHide())this._datas.push(Activity.ins().getbtnInfo(k))}this._datas.sort(this.sort);i=0;for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);var panel=ActivityPanel.create(id,act.activityType);panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);i++}this.dataArr=new eui.ArrayCollection(this._datas);this.menuList.dataProvider=this.dataArr;this.viewStack.validateNow();this.menuList.validateNow()};VersionCeleWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas);this.menuList.dataProvider=this.dataArr};VersionCeleWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};VersionCeleWin.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;this.onChange();break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;this.onChange();break}};VersionCeleWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this.activityPanelList[this.selectIndex].close()}else return;this.selectIndex=e.currentTarget.selectedIndex;this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true)};return VersionCeleWin}(BaseEuiView);__reflect(VersionCeleWin.prototype,"VersionCeleWin");ViewManager.ins().reg(VersionCeleWin,LayerManager.UI_Main);var FDProjectItemRender=function(_super){__extends(FDProjectItemRender,_super);function FDProjectItemRender(){return _super.call(this)||this}FDProjectItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBase;this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect};FDProjectItemRender.prototype.dataChanged=function(){this._listCollect.source=this.data.conf.reward;this.pName.textFlow=TextFlowMaker.generateTextFlow1(this.data.conf.name);this.scedule.textFlow=TextFlowMaker.generateTextFlow1(i18n("FDProjectItemRender_2",65280,Math.floor(this.data.times/this.data.conf.rate),Math.floor(this.data.conf.dayLimit/this.data.conf.rate)));this.currentState=this.data.state==2?"done":"normal";this.redpoint.visible=this.data.state==1;this.score.text=this.data.conf.score;if(this.data.state==0&&this.data.conf.turn){this.actBtn.enabled=true;this.actBtn.label=i18n("FDProjectItemRender_0")}else{this.actBtn.label=i18n("FDProjectItemRender_1");this.actBtn.enabled=this.data.state==1}if(!this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE))this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);if(!this.hasEventListener(egret.TouchEvent.TOUCH_TAP))this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};FDProjectItemRender.prototype.onTouch=function(e){if(e.target!=this.actBtn)return;if(this.data.state==0&&this.data.conf.turn)ViewManager.ins().open(this.data.conf.turn[0],this.data.conf.turn[1]);else Activity.ins().sendReward(this.data.activityID,this.data.conf.index,2)};FDProjectItemRender.prototype.onRmove=function(e){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};return FDProjectItemRender}(BaseItemRender);__reflect(FDProjectItemRender.prototype,"FDProjectItemRender");var FDrewardItemRender=function(_super){__extends(FDrewardItemRender,_super);function FDrewardItemRender(){var _this=_super.call(this)||this;_this.skinName="FDrewardItem";return _this}FDrewardItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.itemicon.touchChildren=false};FDrewardItemRender.prototype.dataChanged=function(){this.tsNeed.text=this.data.config.score+i18n("FDrewardItemRender_0");this.get.visible=this.data.state==2;this.redpoint.visible=this.data.state==1;this.arrow.source=this.data.state?"fd_arrow2":"fd_arrow1";var config=this.data.config;this.itemicon.data=config.reward[0];this.itemicon.isShowName(false);this.itemicon.showNum(false);if(!this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE))this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);if(!this.hasEventListener(egret.TouchEvent.TOUCH_TAP))this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this.itemicon.touchEnabled=this.data.state!=1;this.itemicon.filters=this.data.state==0?FilterUtil.ARRAY_GRAY_FILTER:null};FDrewardItemRender.prototype.onTouch=function(e){if(this.data.state==1){Activity.ins().sendReward(this.data.activityID,this.data.index,1)}};FDrewardItemRender.prototype.onRmove=function(e){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};return FDrewardItemRender}(BaseItemRender);__reflect(FDrewardItemRender.prototype,"FDrewardItemRender");var FDstoreItemRender=function(_super){__extends(FDstoreItemRender,_super);function FDstoreItemRender(){var _this=_super.call(this)||this;_this.skinName="FDstoreItem";return _this}FDstoreItemRender.prototype.dataChanged=function(){var vo=this.data.data;this.discount.visible=vo.buyMax>0;this.limitCount.text=vo.buyMax-vo.buyCount+"";this.itemIcon.data={type:1,id:vo.itemID,count:vo.itemCount};this.costIcon.source=GlobalConfig.ItemConfig[GlobalConfig.ActivityType22_1Config[this.data.activityID][1].costItem].icon+"_png";this.money.text="X"+vo.materialNum;if(!this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE))this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);if(!this.hasEventListener(egret.TouchEvent.TOUCH_TAP))this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this.buyBtn.label=this.data.data.state==0?i18n("FDstoreItemRender_0"):i18n("FDstoreItemRender_1");this.buyBtn.enabled=this.data.data.state==0};FDstoreItemRender.prototype.onRmove=function(e){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};FDstoreItemRender.prototype.onTouch=function(e){if(e.target!=this.buyBtn)return;var itemData=UserBag.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.data.activityID][1].costItem);var count=itemData?itemData.count:0;if(count>=this.data.data.materialNum)Activity.ins().sendReward(this.data.activityID,0,3,this.data.data.id);else UserTips.ins().showTips(i18n("FDstoreItemRender_2"))};return FDstoreItemRender}(BaseItemRender);__reflect(FDstoreItemRender.prototype,"FDstoreItemRender");var FDstoreShowItemRender=function(_super){__extends(FDstoreShowItemRender,_super);function FDstoreShowItemRender(){var _this=_super.call(this)||this;_this.skinName="FDstoreShowItem";return _this}Object.defineProperty(FDstoreShowItemRender.prototype,"className",{get:function(){return this._className},set:function(v){this._className=v},enumerable:true,configurable:true});FDstoreShowItemRender.prototype.update=function(data){this.itemID=data.itemID;this.itemImg.source=GlobalConfig.ItemConfig[data.itemID].icon+"_png";this.limitCount.textFlow=TextFlowMaker.generateTextFlow(i18n("FDstoreShowItemRender_0",data.buy,data.max));if(!this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE))this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);if(!this.hasEventListener(egret.TouchEvent.TOUCH_TAP))this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};FDstoreShowItemRender.prototype.onRmove=function(e){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this);this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};FDstoreShowItemRender.prototype.onTouch=function(e){if(!this.itemID)return;ViewManager.ins().open(ItemDetailedWin,0,this.itemID)};return FDstoreShowItemRender}(eui.Component);__reflect(FDstoreShowItemRender.prototype,"FDstoreShowItemRender");var FDtabBtnItemRender=function(_super){__extends(FDtabBtnItemRender,_super);function FDtabBtnItemRender(){var _this=_super.call(this)||this;_this.touchChildren=true;return _this}FDtabBtnItemRender.prototype.dataChanged=function(){this.tabName.text=this.data.gName;this.redpoint.visible=this.data.showRed};Object.defineProperty(FDtabBtnItemRender.prototype,"selected",{set:function(value){this.currentState=value?"select":"unselect";if(this.data){this.redpoint.visible=this.data.showRed}},enumerable:true,configurable:true});return FDtabBtnItemRender}(BaseItemRender);__reflect(FDtabBtnItemRender.prototype,"FDtabBtnItemRender");var HongBaoOpenItem=function(_super){__extends(HongBaoOpenItem,_super);function HongBaoOpenItem(){var _this=_super.call(this)||this;_this.skinName="hongbaoOpenSkin";_this.init();return _this}HongBaoOpenItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};HongBaoOpenItem.prototype.init=function(){this.hbbtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this);this.list.itemRenderer=HongBaoRewardsItem;this.closeBtn.visible=false;this.isClick=false};HongBaoOpenItem.prototype.onClick=function(e){switch(e.currentTarget){case this.hbbtn:if(!this.data||!this.data.actId||!this.data.eId)return;var activityData=Activity.ins().getActivityDataById(this.data.actId);if(!activityData.isOpenActivity()){UserTips.ins().showTips(i18n("HongBaoOpenItem_0"));return}if(!this.isClick){Activity.ins().sendReward(this.data.actId,this.data.eId,EnvelopeType.GET);this.isClick=true}break}};HongBaoOpenItem.prototype.onTouch=function(){this.close()};HongBaoOpenItem.prototype.close=function(){if(this.callFun&&this.bt1&&this.bt2&&this.bt3){TimerManager.ins().remove(this.close,this);if(this.parent){this.parent.removeChildren();this.callFun()}}};HongBaoOpenItem.prototype.dataChanged=function(){if(!this.data)return;var job=fixJob(this.data.job);var sex=fixSex(this.data.sex);var roleName=this.data.name;var text=this.data.text;var index=this.data.index;this.myFace.source="head_"+job+sex;this.playerName.text=roleName;this.speaktxt.textFlow=TextFlowMaker.generateTextFlow1(text);var config=GlobalConfig.ActivityType12Config[this.data.actId][index];this.title.source="hongbao_title"+config.skinType};HongBaoOpenItem.prototype.destruct=function(){this.hbbtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};HongBaoOpenItem.prototype.playAni=function(arr,callFun,obj,isSucceed){var _this=this;this.callFun=function(){if(callFun)callFun.call(obj)};if(!isSucceed){WarnWin.show(i18n("HongBaoOpenItem_1"),function(){},this,undefined,undefined,"sure");this.bt1=true;this.bt2=true;this.bt3=true;this.close();return}if(this.hbbtn)this.removeChild(this.hbbtn);if(this.hhbtnlabel)this.removeChild(this.hhbtnlabel);if(this.speaktxt)this.removeChild(this.speaktxt);if(this.speakbg)this.removeChild(this.speakbg);if(!this.topImg.scrollRect)this.topImg.scrollRect=new egret.Rectangle(0,0,this.topImg.width,this.topImg.height);if(!this.downImg.scrollRect)this.downImg.scrollRect=new egret.Rectangle(0,0,this.downImg.width,this.downImg.height);var self=this;var upSr=this.topImg.scrollRect;var downSr=this.downImg.scrollRect;var twTime=400;this.list.dataProvider=new eui.ArrayCollection(arr);var tw1=egret.Tween.get(upSr,{onChange:function(){_this.topImg.scrollRect=upSr}}).to({y:160},twTime).call(function(){egret.Tween.removeTweens(tw1);self.bt1=true;self.closeBtn.visible=true});var tw2=egret.Tween.get(downSr,{onChange:function(){_this.downImg.scrollRect=downSr}}).to({height:0},twTime).call(function(){egret.Tween.removeTweens(tw2);self.bt2=true});var tw3=egret.Tween.get(this.downImg).to({y:this.downImg.y+this.downImg.height},twTime).call(function(){egret.Tween.removeTweens(tw3);self.bt3=true});if(!TimerManager.ins().isExists(this.close,this)){TimerManager.ins().doTimer(1e4,0,this.close,this)}if(arr[0].yb>0){var stage=StageUtils.ins().getStage();MainAniMgr.ins().playExplode(RES_DIR_EFF+"yuanbaofly_eff",60,stage.stageWidth/2,stage.stageHeight/2)}};return HongBaoOpenItem}(BaseItemRender);__reflect(HongBaoOpenItem.prototype,"HongBaoOpenItem");var HongBaoRewardsItem=function(_super){__extends(HongBaoRewardsItem,_super);function HongBaoRewardsItem(){var _this=_super.call(this)||this;_this.skinName="hongbaoRewardItem";return _this}HongBaoRewardsItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};HongBaoRewardsItem.prototype.dataChanged=function(){if(!this.data)return;var yb=this.data.yb;var gold=this.data.gold;var money=""+yb;var text="";if(!this.itemIndex&&this.data.name==Actor.myName){this.currentState="owner";text=i18n("HongBaoRewardsItem_0")}else{this.currentState="otherman";text=i18n("HongBaoRewardsItem_1")}if(gold){money=CommonUtils.overLength(gold);text+=money+i18n("HongBaoRewardsItem_2")}else{text+=money+i18n("HongBaoRewardsItem_3")}this.validateNow();this.speaktxt.text=text;this.myFace.source="yuanhead"+this.data.job+this.data.sex;this.playerName.text=this.data.name};HongBaoRewardsItem.prototype.destruct=function(){};return HongBaoRewardsItem}(BaseItemRender);__reflect(HongBaoRewardsItem.prototype,"HongBaoRewardsItem");var HongBaoShowItem=function(_super){__extends(HongBaoShowItem,_super);function HongBaoShowItem(){var _this=_super.call(this)||this;_this.skinName="hongbaoShowItem";_this.init();_this.addEventListener(egret.Event.REMOVED_FROM_STAGE,_this.destruct,_this);return _this}HongBaoShowItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.touchEnabled=false};HongBaoShowItem.prototype.init=function(){this.hbimg.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);this.hongbaoeff.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};HongBaoShowItem.prototype.onClick=function(){if(!this.data||!this.data.actId||!this.data.eId)return;var activityData=Activity.ins().getActivityDataById(this.data.actId);if(!activityData.isOpenActivity()){UserTips.ins().showTips(i18n("HongBaoShowItem_0"));return}for(var i=activityData.envelopeData.length-1;i>=0;i--){if(!activityData.envelopeData[i]||activityData.envelopeData[i].id==this.data.eId){if(activityData.envelopeData[i].isOverTimer()){UserTips.ins().showTips(i18n("HongBaoShowItem_1"));Activity.ins().postEnvelopeDataCall(null);return}break}}Activity.ins().sendEnvelopeData(this.data.actId,this.data.eId)};HongBaoShowItem.prototype.dataChanged=function(){TimerManager.ins().remove(this.onTimerOver,this);if(!this.data)return;var redEnvelope=this.data.redEnvelope;var remainTimeMS=DateUtils.formatMiniDateTime(redEnvelope.timer)-GameServer.serverTime;TimerManager.ins().doTimer(remainTimeMS,1,this.onTimerOver,this);if(!this.eff)this.eff=new MovieClip;if(!this.eff.parent){this.hbimg.visible=false;this.hongbaoeff.addChild(this.eff);this.eff.x=this.eff.y=60;var self_5=this;this.eff.playFile(RES_DIR_EFF+"hongbao_eff",-1,function(){if(self_5.hbimg){}})}};HongBaoShowItem.prototype.onTimerOver=function(){this.close();HBSystem.ins().updateHongBao()};HongBaoShowItem.prototype.close=function(){this.parent.removeChild(this);this.destruct()};HongBaoShowItem.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);TimerManager.ins().remove(this.onTimerOver,this)};return HongBaoShowItem}(BaseItemRender);__reflect(HongBaoShowItem.prototype,"HongBaoShowItem");var HongBaoSpeak=function(_super){__extends(HongBaoSpeak,_super);function HongBaoSpeak(){var _this=_super.call(this)||this;_this.skinName="hongbaoSpeakSkin";return _this}HongBaoSpeak.prototype.destoryView=function(){_super.prototype.destoryView.call(this)};HongBaoSpeak.prototype.initUI=function(){_super.prototype.initUI.call(this)};HongBaoSpeak.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.sendBtn,this.onClick);this.actId=param[0];this.index=param[1];var config=GlobalConfig.ActivityType12Config[this.actId][this.index];this.input.text="";this.input.prompt=config.blessWord+i18n("HongBaoSpeak_0");this.input.maxChars=config.wordCount};HongBaoSpeak.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};HongBaoSpeak.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.sendBtn:ViewManager.ins().close(this);var activityData=Activity.ins().getActivityDataById(this.actId);if(!activityData.isOpenActivity()){UserTips.ins().showTips(i18n("HongBaoSpeak_1"));return}Activity.ins().sendReward(this.actId,this.index,EnvelopeType.SEND,this.input.text);ViewManager.ins().close(XiaoNianWin);break}};return HongBaoSpeak}(BaseEuiView);__reflect(HongBaoSpeak.prototype,"HongBaoSpeak");ViewManager.ins().reg(HongBaoSpeak,LayerManager.UI_Popup);var XiaoNianItem=function(_super){__extends(XiaoNianItem,_super);function XiaoNianItem(){var _this=_super.call(this)||this;_this.skinName="XNHongBaoItem";return _this}XiaoNianItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};XiaoNianItem.prototype.dataChanged=function(){if(!this.data)return;this.currentState=this.data};XiaoNianItem.prototype.destruct=function(){};return XiaoNianItem}(BaseItemRender);__reflect(XiaoNianItem.prototype,"XiaoNianItem");var XiaoNianListRenderer=function(_super){__extends(XiaoNianListRenderer,_super);function XiaoNianListRenderer(){var _this=_super.call(this)||this;_this.skinName="HuntListRendererSkin";return _this}XiaoNianListRenderer.prototype.dataChanged=function(){if(!this.data)return;this.showText.textFlow=TextFlowMaker.generateTextFlow(this.data)};return XiaoNianListRenderer}(BaseItemRender);__reflect(XiaoNianListRenderer.prototype,"XiaoNianListRenderer");var XiaoNianWin=function(_super){__extends(XiaoNianWin,_super);function XiaoNianWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.skinName="XiaoNianWinSkin";_this.isTopLevel=true;_this.selectIndex=0;return _this}XiaoNianWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this._pageStyle=ActivityPageStyle.XIAONIAN;this.menuList.itemRenderer=ActivityBtnRenderer};XiaoNianWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};XiaoNianWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.XIAONIAN)continue;if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("XiaoNianWin_0"));return false};XiaoNianWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.addChangeEvent(this.menuScroller,this.onChange)};XiaoNianWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};XiaoNianWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};XiaoNianWin.prototype.updateView=function(){var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=this._pageStyle){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(!ErrorLog.Assert(data,"xiaonian  data   "+k))this._datas.push(data)}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,ActivityType.Normal);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};XiaoNianWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};XiaoNianWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};XiaoNianWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);this.refushRedPoint()};XiaoNianWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){this.setOpenIndex(this.selectIndex)}}};XiaoNianWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};XiaoNianWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}this.leftRed.visible=this.leftBtn.visible;this.rightRed.visible=this.rightBtn.visible};XiaoNianWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};XiaoNianWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return XiaoNianWin}(BaseEuiView);__reflect(XiaoNianWin.prototype,"XiaoNianWin");ViewManager.ins().reg(XiaoNianWin,LayerManager.UI_Main);var ZhanLingACTWin=function(_super){__extends(ZhanLingACTWin,_super);function ZhanLingACTWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.selectIndex=0;_this.skinName="ZhanlingActWin";_this.isTopLevel=true;return _this}ZhanLingACTWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.menuList.itemRenderer=ActivityBtnRenderer};ZhanLingACTWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateView();this.addTouchEvent(this,this.onTouch);this.addChangeEvent(this.menuList,this.onClickMenu);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.selectIndex=0;if(param&&param.length){var id=param[0];var i=0;for(var k in this._datas){if(this._datas[k].id==id){this.selectIndex=i;break}i++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.selectIndex!=0)this.activityPanelList[0].close();this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true);this.onChange()};ZhanLingACTWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList);this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller);this.removeObserve();for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};ZhanLingACTWin.prototype.onChange=function(){if(this.menuList.scrollH<20){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>(this.menuList.dataProvider.length-5)*88+2){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}this.leftRed.visible=this.rightRed.visible=false;var len=this.menuList.dataProvider.length;if(len<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}else{var curIndex=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn.visible){for(var i=0;i<=curIndex-5;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed.visible=true;break}}}if(this.rightBtn.visible){for(var i=curIndex+1;i<len;i++){if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed.visible=true;break}}}}};ZhanLingACTWin.prototype.updateView=function(){var i=0;for(i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle==ActivityPageStyle.ZHANLING&&Activity.ins().getActivityDataById(+k).isOpenActivity()&&!Activity.ins().getActivityDataById(+k).getHide())this._datas.push(Activity.ins().getbtnInfo(k))}this._datas.sort(this.sort);i=0;for(var k in this._datas){var id=this._datas[k].id;var act=Activity.ins().getActivityDataById(+id);var panel=ActivityPanel.create(id,act.activityType);panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);i++}this.dataArr=new eui.ArrayCollection(this._datas);this.menuList.dataProvider=this.dataArr;this.viewStack.validateNow();this.menuList.validateNow()};ZhanLingACTWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas);this.menuList.dataProvider=this.dataArr};ZhanLingACTWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};ZhanLingACTWin.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;this.onChange();break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;this.onChange();break}};ZhanLingACTWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this.activityPanelList[this.selectIndex].close()}else return;this.selectIndex=e.currentTarget.selectedIndex;this.activityPanelList[this.selectIndex].open();this.viewStack.selectedIndex=this.selectIndex;this.menuList.selectedIndex=this.selectIndex;Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,true)};return ZhanLingACTWin}(BaseEuiView);__reflect(ZhanLingACTWin.prototype,"ZhanLingACTWin");ViewManager.ins().reg(ZhanLingACTWin,LayerManager.UI_Main);var ActivityExWin=function(_super){__extends(ActivityExWin,_super);function ActivityExWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.helpId=54;_this.skinName="ActivityWinSkin";_this.isTopLevel=true;_this.selectIndex=0;return _this}ActivityExWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.menuList.itemRenderer=ActivityBtnRenderer};ActivityExWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};ActivityExWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ACTIVITY));return false}var actId=param[0];if(actId!=undefined){if(Activity.ins().activityData[actId].pageStyle||Activity.ins().activityData[actId].timeType!=ActivityDataFactory.TimeType_Total){UserTips.ins().showTips(i18n("ActivityExWin_0"));return false}if(!Activity.ins().getActivityDataById(actId)||!Activity.ins().getActivityDataById(actId).isOpenActivity()){UserTips.ins().showTips(i18n("ActivityExWin_1"));return false}}var sum=Object.keys(Activity.ins().activityData);if(!sum.length){UserTips.ins().showTips(i18n("ActivityExWin_2"));return false}for(var k in Activity.ins().activityData){if(Activity.ins().activityData[k].pageStyle||Activity.ins().activityData[k].timeType!=ActivityDataFactory.TimeType_Total){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("ActivityExWin_3"));return false};ActivityExWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var actId=param[0];this.updateView(actId);this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.addTouchEvent(this.help,this.onTouchBtn);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.observe(UserBag.ins().postItemAdd,this.refushRedPoint);this.observe(UserBag.ins().postItemChange,this.refushRedPoint);this.observe(Activity.ins().postChangePage,this.ChangePageCallBack);this.addChangeEvent(this.menuScroller,this.onChange)};ActivityExWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onClick);this.menuList.removeEventListener(egret.Event.CHANGE,this.onClickMenu,this);this.removeTouchEvent(this.leftBtn,this.onTouchBtn);this.removeTouchEvent(this.rightBtn,this.onTouchBtn);this.menuScroller.removeEventListener(egret.Event.CHANGE,this.onChange,this);this.removeObserve();TimerManager.ins().removeAll(this);for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};ActivityExWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};ActivityExWin.prototype.updateView=function(actId){this.title.source="biaoti_huodong";var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(Activity.ins().activityData[k].pageStyle||Activity.ins().activityData[k].timeType!=ActivityDataFactory.TimeType_Total){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(data.activityType&&data.activityType==ActivityType.Nesting)continue;if(!ErrorLog.Assert(data,"ActivityExWin  data   "+k))this._datas.push(data)}}var rechargeId=Activity.ins().rechargeId;this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=void 0;if(this._datas[k].activityType==ActivityType.Normal){act=Activity.ins().getActivityDataById(+id)}else if(this._datas[k].activityType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(+id)}if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,act.activityType);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);if(ChannelMgr.ins().isRechargeHidden()){if(rechargeId.indexOf(id)<0){this.BtnArr.push(this._datas[k]);if(actId!=undefined&&actId==id){index=i}i++}}else{this.BtnArr.push(this._datas[k]);if(actId!=undefined&&actId==id){index=i}i++}}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};ActivityExWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};ActivityExWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};ActivityExWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);Activity.ins().setfirstShowRedPointById(this.activityPanelList[selectedIndex].activityID,"onclicked");this.help.visible=false;var config;var actType=this.activityPanelList[selectedIndex].activityType;if(actType==ActivityType.Normal){config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID]}else if(actType==ActivityType.Personal){config=GlobalConfig.PActivityConfig[this.activityPanelList[this.selectIndex].activityID]}if(config){if(config.activityType==ActivityDataFactory.ACTIVITY_TYPE_9){this.help.visible=true;this.helpId=54}if(config.activityType==ActivityDataFactory.ACTIVITY_TYPE_28){this.help.visible=true;this.helpId=70}}this.refushRedPoint()};ActivityExWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){if(config.activityType==3){this.setOpenIndex(this.selectIndex)}else{Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID)}}}};ActivityExWin.prototype.ChangePageCallBack=function(){this.setOpenIndex(this.selectIndex)};ActivityExWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}this.leftRed.visible=this.leftBtn.visible;this.rightRed.visible=this.rightBtn.visible};ActivityExWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[this.helpId].text);break}this.onChange()};ActivityExWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return ActivityExWin}(BaseEuiView);__reflect(ActivityExWin.prototype,"ActivityExWin");ViewManager.ins().reg(ActivityExWin,LayerManager.UI_Main);var BossScoreExchangeBtn=function(_super){__extends(BossScoreExchangeBtn,_super);function BossScoreExchangeBtn(){var _this=_super.call(this)||this;_this.skinName="hefuBossBtnSkin";return _this}BossScoreExchangeBtn.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};BossScoreExchangeBtn.prototype.dataChanged=function(){var id=this.data.id;var index=this.data.index;var config=GlobalConfig.ActivityType7Config[id][index];this.btnText.text=config.title+i18n("BossScoreExchangeBtn_0");this.redPoint.visible=Activity.ins().IsBossScoreTitle(config.Id,config.title)};BossScoreExchangeBtn.prototype.destruct=function(){};return BossScoreExchangeBtn}(eui.ItemRenderer);__reflect(BossScoreExchangeBtn.prototype,"BossScoreExchangeBtn");var BossScoreExchangeItem=function(_super){__extends(BossScoreExchangeItem,_super);function BossScoreExchangeItem(){var _this=_super.call(this)||this;_this.skinName="hefuBossItemSkin";return _this}BossScoreExchangeItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)};BossScoreExchangeItem.prototype.dataChanged=function(){if(this.data instanceof ActivityType7Config){var config=this.data;var item=GlobalConfig.ItemConfig[config.rewards[0].id];var actdata=Activity.ins().getActivityDataById(config.Id);var count=actdata.bossScore;var isBuy=Activity.ins().getIsBuy(config);this.redPoint.visible=isBuy&&count>=config.score;this.nameLab.text=item.name;var color=count<config.score?"#F3311E":"#03b154";this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+color+"'>"+config.score+"</font>");this.goBtn.currentState="up";this.goBtn.touchEnabled=true;if(config.count){this.count.visible=true;var sum=config.count-actdata.personalRewardsSum[config.index];sum=sum>0?sum:0;if(!sum){this.goBtn.currentState="disabled";this.goBtn.touchEnabled=false}var colorInt=sum<0?15937822:242004;this.count.textFlow=TextFlowMaker.generateTextFlow1(i18n("BossScoreExchangeItem_0",colorInt,sum))}else{this.count.visible=false}this.itemConfig=item;this.itemIcon0.data=config.rewards[0]}};BossScoreExchangeItem.prototype.onClick=function(){if(this.data instanceof ActivityType7Config){var config=this.data;var actdata=Activity.ins().getActivityDataById(config.Id);if(actdata.bossScore<config.score){UserTips.ins().showTips(i18n("BossScoreExchangeItem_2"));return}if(!Activity.ins().getIsBuy(config)){UserTips.ins().showTips(i18n("BossScoreExchangeItem_3"));return}Activity.ins().sendReward(config.Id,config.index)}};return BossScoreExchangeItem}(eui.ItemRenderer);__reflect(BossScoreExchangeItem.prototype,"BossScoreExchangeItem");var BossScoreExchangeWin=function(_super){__extends(BossScoreExchangeWin,_super);function BossScoreExchangeWin(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.currentSelect=0;return _this}BossScoreExchangeWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="hefuBossjifenSkin";this.equiplist.itemRenderer=BossScoreExchangeBtn;this.dataArr=new eui.ArrayCollection;this.listData={};this.menuData=[]};BossScoreExchangeWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.activityID=param[0];this.initMenu();var cfg=GlobalConfig.ActivityType7Config[this.activityID][1];if(cfg&&cfg.showType==ActivityType7Data.TYPE_RING){this.currentState="lyring";this.exchangelist.itemRenderer=RingBossScoreExchangeItem}else{this.currentState="hefu";this.equiplist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this);this.exchangelist.itemRenderer=BossScoreExchangeItem}this.observe(Activity.ins().postRewardResult,this.onListChange);this.observe(Activity.ins().postChangePage,this.ChangePageCallBack);this.addTouchEvent(this.bgClose,this.onClick);this.addTouchEvent(this.closeBtn,this.onClick);if(cfg&&cfg.showType!=ActivityType7Data.TYPE_RING)this.equiplist.selectedIndex=this.currentSelect;this.refushInfo()};BossScoreExchangeWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick);this.equiplist.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this);this.removeObserve()};BossScoreExchangeWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break}};BossScoreExchangeWin.prototype.onListChange=function(){Activity.ins().sendChangePage(this.activityID)};BossScoreExchangeWin.prototype.ChangePageCallBack=function(){this.refushInfo()};BossScoreExchangeWin.prototype.initMenu=function(){var config=GlobalConfig.ActivityType7Config[this.activityID];var index=-1;var curTitle=0;for(var k in config){if(curTitle!=config[k].title){curTitle=config[k].title;index++;if(!this.menuData)this.menuData=[];this.menuData.push({id:config[k].Id,index:config[k].index})}if(!this.listData[index])this.listData[index]=[];this.listData[index].push(config[k])}};BossScoreExchangeWin.prototype.refushInfo=function(){var data=Activity.ins().getActivityDataById(this.activityID);this.suipian.text=""+data.bossScore;this.dataArr.replaceAll(this.listData[this.currentSelect].concat());this.exchangelist.dataProvider=this.dataArr;this.exchangelist.scrollV=0;this.exchangelist.validateNow();var cfg=GlobalConfig.ActivityType7Config[this.activityID][1];if(cfg&&cfg.showType!=ActivityType7Data.TYPE_RING)this.equiplist.dataProvider=new eui.ArrayCollection(this.menuData)};BossScoreExchangeWin.prototype.onListTap=function(e){if(e&&e.itemRenderer&&e.item){if(this.listData[this.currentSelect][e.itemIndex]){}}};BossScoreExchangeWin.prototype.onTap=function(e){if(e&&e.itemRenderer&&e.item){this.currentSelect=e.itemIndex;this.refushInfo()}};return BossScoreExchangeWin}(BaseEuiView);__reflect(BossScoreExchangeWin.prototype,"BossScoreExchangeWin");ViewManager.ins().reg(BossScoreExchangeWin,LayerManager.UI_Popup);var HefuAncientBossPanel=function(_super){__extends(HefuAncientBossPanel,_super);function HefuAncientBossPanel(){var _this=_super.call(this)||this;_this.openTime=[0,1,3,5];_this._aryTime=[];_this.skinName="hefuBoss";_this.bossEffect=new MovieClip;_this.bossEffect.scaleX=-1;_this.bossEffect.scaleY=1;_this.bossEffect.x=78+50;_this.bossEffect.y=160;_this.Boss.addChild(_this.bossEffect);_this.bossImage=new MovieClip;_this.bossImage.scaleX=-1;_this.bossImage.scaleY=1;_this.bossImage.x=78+50;_this.bossImage.y=160;_this.Boss.addChild(_this.bossImage);_this.bossImg.visible=false;return _this}HefuAncientBossPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};HefuAncientBossPanel.prototype.close=function(){this.removeTouchEvent(this.goBtn,this.onTap)};HefuAncientBossPanel.prototype.open=function(){this.addTouchEvent(this.goBtn,this.onTap);this.rewardList.itemRenderer=ItemBase;this.initView()};HefuAncientBossPanel.prototype.initView=function(){this._aryTime=[];this.actInfo.text=GlobalConfig.ActivityBtnConfig[this.activityID].acDesc;var hefuTime=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);var str="";var timeS=0;var date;var i;for(i=0;i<this.openTime.length;i++){if(str.length>0){str+="、"}timeS=hefuTime+this.openTime[i]*DateUtils.MS_PER_DAY;date=new Date(timeS);str+=date.getMonth()+1+i18n("HefuAncientBossPanel_0")+date.getDate()+i18n("HefuAncientBossPanel_1");this._aryTime.push(date.getMonth()+1+i18n("HefuAncientBossPanel_2")+date.getDate()+i18n("HefuAncientBossPanel_3"))}str+=i18n("HefuAncientBossPanel_4",HefuAncientBossPanel.timer);this.actTime.text=str;var b=false;var startIndex=-1;var timeE;var dateE;var firstNum;var endNum;for(i=this.openTime.length-1;i>=0;i--){timeS=hefuTime+this.openTime[i]*DateUtils.MS_PER_DAY;date=new Date(timeS);date.setHours(20,30,0);timeE=hefuTime+(this.openTime[i]+1)*DateUtils.MS_PER_DAY;dateE=new Date(timeE);if(i==0){firstNum=date.getTime()}if(i==this.openTime.length-1){endNum=dateE.getTime()}if(!i){if(GameServer.serverTime>=date.getTime()){b=true}startIndex=i;break}var idx=i-1;if(idx>=0){var cityBoss=this.getBossConfig(i);var killBossId=cityBoss.killBossId;timeS=hefuTime+this.openTime[i]*DateUtils.MS_PER_DAY;var predate=new Date(timeS);predate.setHours(0,0,0);if(CityCC.ins().bossKillNumData[killBossId][1]!=1&&GameServer.serverTime<predate.getTime()){continue}else{if(GameServer.serverTime>=date.getTime()){b=true}startIndex=i;break}}}if(!b){if(GameServer.serverTime<firstNum){startIndex=-1;this.selectCurBoss(GlobalConfig.CityBossConfig[1].bossId,startIndex)}else if(GameServer.serverTime>=endNum){startIndex=-2;this.selectCurBoss(GlobalConfig.CityBossConfig[4].bossId,startIndex)}else{var bossid=this.getBossConfig(startIndex+1).bossId;this.selectCurBoss(bossid,startIndex,true)}}else{this.selectCurBoss(GlobalConfig.CityBossConfig[startIndex+1].bossId,startIndex)}var cbid;if(startIndex==-1){cbid=1}else if(startIndex==-2){cbid=4}else{cbid=startIndex+1}var cbcfg=GlobalConfig.CityBossConfig[cbid];if(cbcfg){this.rewardList.dataProvider=new eui.ArrayCollection(cbcfg.showReward)}};HefuAncientBossPanel.prototype.selectCurBoss=function(bossId,startIndex,b){if(b===void 0){b=false}var monster=GlobalConfig.MonstersConfig[bossId];if(startIndex>=0){var bid=GlobalConfig.CityBossConfig[startIndex+1].bossId;monster=GlobalConfig.MonstersConfig[bid]}var effectPath=GlobalConfig.EffectConfig[monster.effect].fileName;this.bossImage.playFile(RES_DIR_MONSTER+("monster"+monster.avatar+"_3s"),-1);this.bossEffect.playFile(RES_DIR_EFF+effectPath,-1);var str;var act=Activity.ins().getActivityDataById(this.activityID);this.redPoint.visible=act.specialState();if(startIndex>=0){if(!b){str=this._aryTime[startIndex];this.time.text=str+(" "+HefuAncientBossPanel.timer);var cityBoss=this.getBossConfig(startIndex+1);var killBossId=cityBoss.killBossId;if(CityCC.ins().bossKillNumData&&CityCC.ins().bossKillNumData[killBossId]!=undefined&&CityCC.ins().bossKillNumData[killBossId][1]!=1){this._btnB=true}else{this._btnB=false;str=this._aryTime[startIndex+1];if(str){this.time.text=str+(" "+HefuAncientBossPanel.timer);var bid=GlobalConfig.CityBossConfig[startIndex+1].bossId;monster=GlobalConfig.MonstersConfig[bid];var effectPath_1=GlobalConfig.EffectConfig[monster.effect].fileName;this.bossImage.playFile(RES_DIR_MONSTER+("monster"+monster.avatar+"_3s"),-1);this.bossEffect.playFile(RES_DIR_EFF+effectPath_1,-1)}}}else{str=this._aryTime[startIndex];this.time.text=str+(" "+HefuAncientBossPanel.timer);this._btnB=false}}else{this._btnB=false;if(startIndex==-2){this.time.text=i18n("HefuAncientBossPanel_5")}else if(startIndex==-1){str=this._aryTime[0]+i18n("HefuAncientBossPanel_6",HefuAncientBossPanel.timer);this.time.text=str}}};HefuAncientBossPanel.getCityBossConfig=function(bossId){var cfg;for(var i in GlobalConfig.CityBossConfig){if(GlobalConfig.CityBossConfig[i].bossId==bossId&&GlobalConfig.CityBossConfig[i].killBossId<=999){cfg=GlobalConfig.CityBossConfig[i];break}}return cfg};HefuAncientBossPanel.prototype.getNextBossId=function(){var hefuTime=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);var bossId=0;var timeE;var dateE;var timeS;var date;var startIndex=0;for(var i=0;i<this.openTime.length;i++){timeS=hefuTime+this.openTime[i]*DateUtils.MS_PER_DAY;date=new Date(timeS);if(GameServer.serverTime>=date.getTime()){startIndex=i}}return startIndex};HefuAncientBossPanel.prototype.getBossConfig=function(index){return GlobalConfig.CityBossConfig[index]};HefuAncientBossPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.goBtn:if(this._btnB){}else{UserTips.ins().showTips(i18n("HefuAncientBossPanel_7"));return}if(CityCC.ins().enterCD>0){UserTips.ins().showTips(i18n("HefuAncientBossPanel_8",CityCC.ins().enterCD));return}else{if(CityCC.ins().isCity){TimerManager.ins().doNext(function(){var win=ViewManager.ins().getView(BossBelongPanel);if(win){win.attrBoss()}},this)}else{CityCC.ins().isChallenge=true;CityCC.ins().sendEnter()}}ViewManager.ins().close(ActivityExWin);break}};HefuAncientBossPanel.timer="20:30";return HefuAncientBossPanel}(BaseView);__reflect(HefuAncientBossPanel.prototype,"HefuAncientBossPanel");var HefuLCZBPanel=function(_super){__extends(HefuLCZBPanel,_super);function HefuLCZBPanel(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var _this=_super.call(this)||this;_this.openTime=[3,5,7];_this.skinName="hefuLongchengSkin";_this.effs=[];return _this}HefuLCZBPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};HefuLCZBPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.go,this.onTap);this.observe(GuildWar.ins().postHeFuBelong,this.updateBelongs);GuildWar.ins().sendHeFuBelong();this.updateData()};HefuLCZBPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.go,this.onTap);this.removeObserve();for(var i=0;i<this.effs.length;i++){if(this.effs[i])DisplayUtils.removeFromParent(this.effs[i])}this.effs=[]};HefuLCZBPanel.prototype.onTap=function(e){var index;switch(e.currentTarget){case this.go:if(Guild.ins().guildID!=0){ViewManager.ins().close(ActivityExWin);GuildWar.ins().requestWinGuildInfo();ViewManager.ins().close(GuildMap);ViewManager.ins().open(GuildWarMainWin)}else{UserTips.ins().showTips(i18n("HefuLCZBPanel_0"))}break}};HefuLCZBPanel.prototype.getTime=function(activityData){return};HefuLCZBPanel.prototype.updateData=function(){this.actInfo.text=GlobalConfig.ActivityBtnConfig[this.activityID].acDesc;var openTime=GlobalConfig.GuildBattleConst.hefuOpen;var hefuTime=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);var str="";var timeS=0;var date;var i;for(i=0;i<openTime.length;i++){if(str.length>0){str+="、"}timeS=hefuTime+(openTime[i].day-1)*DateUtils.MS_PER_DAY;date=new Date(timeS);date.setHours(openTime[i].hours,openTime[i].min||0,0,0);var min=date.getMinutes()<10?"0"+date.getMinutes():date.getMinutes()+"";str+=date.getMonth()+1+i18n("HefuLCZBPanel_10")+date.getDate()+i18n("HefuLCZBPanel_11")+date.getHours()+":"+min}this.actTime.text=str;var b=false;var firstNum;var startIndex=0;var timeE=0;var dataE;var lastNum;for(i=0;i<openTime.length;i++){timeS=hefuTime+(openTime[i].day-1)*DateUtils.MS_PER_DAY;timeE=hefuTime+openTime[i].day*DateUtils.MS_PER_DAY;date=new Date(timeS);date.setHours(openTime[i].hours,openTime[i].min||0,0,0);dataE=new Date(timeE);dataE.setHours(0,0,0);if(i==0){firstNum=date.getTime()}if(i==openTime.length-1){lastNum=dataE.getTime()}if(GameServer.serverTime>=date.getTime()&&GameServer.serverTime<dataE.getTime()){b=true;startIndex=i;break}}if(!b){this.over.visible=true;if(GameServer.serverTime<firstNum){this.over.text=i18n("HefuLCZBPanel_12")}else if(GameServer.serverTime>=lastNum){this.over.text=i18n("HefuLCZBPanel_13")}else{this.over.text=i18n("HefuLCZBPanel_14")}}else{this.over.visible=false}this.go.visible=!this.over.visible;var awardany=GlobalConfig.GuildBattleConst.hefuAward.leader;var list=awardany.award;this.list0.itemRenderer=ItemBase;this.list1.itemRenderer=ItemBase;this.list2.itemRenderer=ItemBase;this.list0.dataProvider=new eui.ArrayCollection(list[0]);this.list1.dataProvider=new eui.ArrayCollection(list[1]);this.list2.dataProvider=new eui.ArrayCollection(list[2])};HefuLCZBPanel.prototype.updateBelongs=function(){for(var i=0;i<3;i++){if(GuildWar.ins().GuildNameBelongs[i]){this["guild"+i].visible=true;this["guild"+i].text=i18n("HefuLCZBPanel_15")+GuildWar.ins().GuildNameBelongs[i]}else this["guild"+i].visible=false}};return HefuLCZBPanel}(BaseView);__reflect(HefuLCZBPanel.prototype,"HefuLCZBPanel");var Group=eui.Group;window["Group"]=Group;var HefuXunbaoPanel=function(_super){__extends(HefuXunbaoPanel,_super);function HefuXunbaoPanel(){var _this=_super.call(this)||this;_this.jobId=0;_this.skinName="hefuXunbao";return _this}HefuXunbaoPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};HefuXunbaoPanel.prototype.close=function(){this.removeTouchEvent(this.goBtn,this.onTap);TimerManager.ins().remove(this.playSkillAnmi,this)};HefuXunbaoPanel.prototype.open=function(){this.addTouchEvent(this.goBtn,this.onTap);var tMap={1:"skill404_0",2:"skill405",3:"skill406"};this.jobId=SubRoles.ins().getSubRoleByIndex(0).job;this.targetSkillID=tMap[this.jobId];for(var i=0;i<8;i++){this["HejiSkillMc2_"+i]=new MovieClip;this["HejiSkillMc2Group"+i].addChild(this["HejiSkillMc2_"+i])}if(!TimerManager.ins().isExists(this.playSkillAnmi,this))TimerManager.ins().doTimer(3e3,0,this.playSkillAnmi,this);this.initData()};HefuXunbaoPanel.prototype.initData=function(){this.playSkillAnmi();this.updateData()};HefuXunbaoPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.goBtn:ViewManager.ins().close(ActivityWin);ViewManager.ins().open(TreasureHuntWin);break}};HefuXunbaoPanel.prototype.updateData=function(){var activityData=Activity.ins().getActivityDataById(this.activityID);var beganTime=Math.floor(activityData.startTime/1e3-GameServer.serverTime/1e3);var endedTime=Math.floor(activityData.endTime/1e3-GameServer.serverTime/1e3);if(beganTime>=0){this.actTime.text=i18n("HefuXunbaoPanel_0")}else if(endedTime<=0){this.actTime.text=i18n("HefuXunbaoPanel_1")}else{this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}var btncfg=GlobalConfig.ActivityBtnConfig[this.activityID];this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(btncfg.acDesc)};HefuXunbaoPanel.prototype.playSkillAnmi=function(){var _this=this;for(var i=1;i<=2;i++){if(!this["mc"+i])this["mc"+i]=new MovieClip}var role=SubRoles.ins().getSubRoleByIndex(0);var mcSkillID="skill40"+role.job;var targetSkillID="skill"+(403+role.job)+"_0";var t=egret.Tween.get(this);if(!this["mc"+1].parent)this["eff"+1].addChild(this["mc"+1]);this.mc1.playFile(RES_DIR_SKILLEFF+mcSkillID,1,null,true);var _loop_15=function(i){if(i==0){t.wait(900).call(function(){if(!_this["HejiSkillMc2_"+i].parent)_this["HejiSkillMc2Group"+i].addChild(_this["HejiSkillMc2_"+i]);_this["HejiSkillMc2_"+i].playFile(""+RES_DIR_SKILLEFF+_this.targetSkillID,1,null,true)},this_12)}else{t.wait(100).call(function(){if(!_this["HejiSkillMc2_"+i].parent)_this["HejiSkillMc2Group"+i].addChild(_this["HejiSkillMc2_"+i]);_this["HejiSkillMc2_"+i].playFile(""+RES_DIR_SKILLEFF+_this.targetSkillID,1,null,true)},this_12)}};var this_12=this;for(var i=0;i<8;i++){_loop_15(i)}};return HefuXunbaoPanel}(BaseView);__reflect(HefuXunbaoPanel.prototype,"HefuXunbaoPanel");var limitChangeItemRender=function(_super){__extends(limitChangeItemRender,_super);function limitChangeItemRender(){return _super.call(this)||this}limitChangeItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase;this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};limitChangeItemRender.prototype.dataChanged=function(){this._activityID=this.data[0];this._config=this.data[1];this.slimit.visible=this.data[4]!=Number.MAX_VALUE;if(this.data[4]!=Number.MAX_VALUE){var colorStr=this.data[4]?65280:16711680;this.limitchange0.textFlow=TextFlowMaker.generateTextFlow1(i18n("limitChangeItemRender_0",colorStr,this.data[4]))}if(this.data[3]==Number.MAX_VALUE)this.limitchange1.text="";else{var colorStr=this.data[3]?65280:16711680;this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1(i18n("limitChangeItemRender_1",colorStr,this.data[3],this._config.count))}if(!this._dataCollect){this._dataCollect=new ArrayCollection;this.reward.dataProvider=this._dataCollect}this._dataCollect.source=this._config.rewards;this.consnum.text=this._config.itemCount+"";this.get.enabled=this.data[2];this.redPoint.visible=this.get.enabled};limitChangeItemRender.prototype.onTap=function(e){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}Activity.ins().sendReward(this._activityID,this._config.index)};limitChangeItemRender.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};return limitChangeItemRender}(BaseItemRender);__reflect(limitChangeItemRender.prototype,"limitChangeItemRender");var OSATarget7Panel=function(_super){__extends(OSATarget7Panel,_super);function OSATarget7Panel(){var _this=_super.call(this)||this;_this.type2PanelList=[];return _this}OSATarget7Panel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel){this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)}var config=GlobalConfig.ActivityType7Config[this.activityID];if(!this.type2PanelList[this.activityID]){var showType=config[1].showType;var panel=ObjectPool.pop("OSATarget7Panel"+(showType==ActivityType7Data.TYPE_RING||showType==ActivityType7Data.TYPE_HEFUBOSS||showType==ActivityType7Data.TYPE_CELEBREATE?1:showType));panel.top=0;panel.bottom=0;panel.left=0;panel.right=0;panel.activityID=this.activityID;this.type2PanelList[this.activityID+""]=panel}this.cruPanel=this.type2PanelList[this.activityID+""];this.cruPanel.open();this.addChild(this.cruPanel)};OSATarget7Panel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.cruPanel)this.cruPanel.close();DisplayUtils.removeFromParent(this.cruPanel)};OSATarget7Panel.prototype.updateData=function(){this.cruPanel.updateData()};return OSATarget7Panel}(ActivityPanel);__reflect(OSATarget7Panel.prototype,"OSATarget7Panel");var OSATarget7Panel1=function(_super){__extends(OSATarget7Panel1,_super);function OSATarget7Panel1(){var _this=_super.call(this)||this;_this.skinName="hefuHalftimeBoss";_this.bossMc=new MovieClip;_this.bossGroup.addChild(_this.bossMc);_this.bossMc.x=_this.bossGroup.x;_this.bossMc.y=_this.bossGroup.y;return _this}OSATarget7Panel1.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.updateData()};OSATarget7Panel1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.boss,this.onTap);this.addTouchEvent(this.costbtn,this.onTap);this.observe(Activity.ins().postRewardResult,this.GetCallBack);this.observe(Activity.ins().postChangePage,this.GetCallBack);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.updateData()};OSATarget7Panel1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.boss,this.onTap);this.removeTouchEvent(this.costbtn,this.onTap);this.removeObserve();TimerManager.ins().removeAll(this)};OSATarget7Panel1.prototype.onClick=function(e){};OSATarget7Panel1.prototype.onTap=function(e){switch(e.currentTarget){case this.boss:ViewManager.ins().open(BossWin,1);break;case this.costbtn:if(this.activityData)ViewManager.ins().open(BossScoreExchangeWin,this.activityID);break}};OSATarget7Panel1.prototype.GetCallBack=function(activityID){this.updateData()};OSATarget7Panel1.prototype.updateData=function(){var cfg=GlobalConfig.ActivityType7Config[this.activityID][1];if(cfg.showType==ActivityType7Data.TYPE_RING)this.currentState="lieyan";else if(cfg.showType==ActivityType7Data.TYPE_HEFUBOSS)this.currentState="hefu";else this.currentState="celebreate";this.validateNow();var btncfg=GlobalConfig.ActivityBtnConfig[this.activityID];if(btncfg)this.title.source=btncfg.title;this.activityData=Activity.ins().getActivityDataById(this.activityID);this.setTime();this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc;var actdata=Activity.ins().getActivityDataById(this.activityID);this.cost.text=i18n("OSATarget7Panel1_0",actdata.bossScore);var modelStr="monster"+10129+"_3s";if(cfg.exValue&&cfg.exValue.bossModel)modelStr=cfg.exValue.bossModel;this.bossMc.playFile(RES_DIR_MONSTER+modelStr,-1);this.redPoint.visible=Activity.ins().getType7RedPoint(this.activityID)};OSATarget7Panel1.prototype.setTime=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.activityData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.activityData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.actTime.text=i18n("OSATarget7Panel1_1")}else if(endedTime<=0){this.actTime.text=i18n("OSATarget7Panel1_2")}else{this.actTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}};return OSATarget7Panel1}(BaseView);__reflect(OSATarget7Panel1.prototype,"OSATarget7Panel1");var OSATarget7Panel3=function(_super){__extends(OSATarget7Panel3,_super);function OSATarget7Panel3(){var _this=_super.call(this)||this;_this._leftTime=0;_this._matrailId=0;_this._oldCount=0;return _this}OSATarget7Panel3.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.actInfo.text=GlobalConfig.ActivityConfig[this.activityID].desc;this.content.itemRenderer=limitChangeItemRender};Object.defineProperty(OSATarget7Panel3.prototype,"activityID",{get:function(){return this._activityID},set:function(value){this._activityID=value;this.setCurSkin()},enumerable:true,configurable:true});OSATarget7Panel3.prototype.setCurSkin=function(){var aCon=GlobalConfig.ActivityConfig[this.activityID];if(aCon.pageSkin)this.skinName=aCon.pageSkin;else this.skinName="limitChangeSkin"};OSATarget7Panel3.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.setCurSkin();this.observe(UserBag.ins().postItemAdd,this.updateMaterial);this.observe(UserBag.ins().postItemChange,this.updateMaterial);this.updateData()};OSATarget7Panel3.prototype.close=function(){this.removeObserve();TimerManager.ins().remove(this.setTime,this);this._leftTime=0;this._oldCount=0};OSATarget7Panel3.prototype.updateData=function(){this._activityData=Activity.ins().getActivityDataById(this.activityID);this.checkTime();this.updateList()};OSATarget7Panel3.prototype.updateMaterial=function(){var itemData=UserBag.ins().getBagItemById(this._matrailId);var mCount=itemData?itemData.count:0;if(mCount!=this._oldCount)this.updateList()};OSATarget7Panel3.prototype.updateList=function(){var configs=GlobalConfig.ActivityType7Config[this.activityID];this._matrailId=configs[1].itemId;var itemData=UserBag.ins().getBagItemById(this._matrailId);var mCount=itemData?itemData.count:0;this.num.text=mCount+"";this._oldCount=mCount;var config;var datas=[];var i=0;var state=0;var pCount=0,sCount=0;for(var k in configs){config=configs[k];if(config.scount==undefined||config.scount==0)sCount=Number.MAX_VALUE;else sCount=config.scount-this._activityData.worldRewardsSum[i+1];if(config.count==undefined||config.count==0)pCount=Number.MAX_VALUE;else pCount=config.count-this._activityData.personalRewardsSum[i+1];state=sCount&&pCount&&mCount>=config.itemCount?1:0;datas[i]=[this.activityID,config,state,pCount,sCount];i++}datas.sort(this.sort);if(!this._dataCollect){this._dataCollect=new ArrayCollection;this.content.dataProvider=this._dataCollect}this._dataCollect.source=datas};OSATarget7Panel3.prototype.sort=function(a,b){if(a[2]>b[2])return-1;if(a[2]<b[2])return 1;if(a[1].index<b[1].index)return-1;return 1};OSATarget7Panel3.prototype.checkTime=function(){TimerManager.ins().remove(this.setTime,this);this._leftTime=0;if(Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3)>=0)this.actTime.text=i18n("OSATarget7Panel3_0");else{this._leftTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);if(this._leftTime<=0)this.actTime.text=i18n("OSATarget7Panel3_1");else{this.actTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3);TimerManager.ins().doTimer(1e3,0,this.setTime,this)}}};OSATarget7Panel3.prototype.setTime=function(){this._leftTime--;this.actTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3);if(this._leftTime<=0)this.checkTime()};return OSATarget7Panel3}(BaseView);__reflect(OSATarget7Panel3.prototype,"OSATarget7Panel3");var RingBossScoreExchangeItem=function(_super){__extends(RingBossScoreExchangeItem,_super);function RingBossScoreExchangeItem(){var _this=_super.call(this)||this;_this.skinName="ringBossItemSkin";return _this}RingBossScoreExchangeItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)};RingBossScoreExchangeItem.prototype.dataChanged=function(){if(this.data instanceof ActivityType7Config){var config=this.data;var item=GlobalConfig.ItemConfig[config.rewards[0].id];var actdata=Activity.ins().getActivityDataById(config.Id);var count=actdata.bossScore;var isBuy=Activity.ins().getIsBuy(config);this.redPoint.visible=isBuy&&count>=config.score;this.nameLab.text=item.name;var color=count<config.score?"#F3311E":"#03b154";this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+color+"'>"+count+"</font><font color = '#9F946D'>/"+config.score+"</font>");this.itemConfig=item;this.itemIcon0.data=config.rewards[0];this.itemIcon0.hideName();var data=Activity.ins().getActivityDataById(config.Id);var useCount=data.personalRewardsSum[config.index];var remainCount=config.count-useCount;if(remainCount){this.count.text=i18n("RingBossScoreExchangeItem_0")+remainCount+i18n("RingBossScoreExchangeItem_1")}else{this.count.text=""}}};RingBossScoreExchangeItem.prototype.onClick=function(){if(this.data instanceof ActivityType7Config){var config=this.data;var actdata=Activity.ins().getActivityDataById(config.Id);if(actdata.bossScore<config.score){UserTips.ins().showTips(i18n("RingBossScoreExchangeItem_2"));return}if(!Activity.ins().getIsBuy(config)){UserTips.ins().showTips(i18n("RingBossScoreExchangeItem_3"));return}Activity.ins().sendReward(config.Id,config.index)}};return RingBossScoreExchangeItem}(eui.ItemRenderer);__reflect(RingBossScoreExchangeItem.prototype,"RingBossScoreExchangeItem");var PActivity=function(_super){__extends(PActivity,_super);function PActivity(){var _this=_super.call(this)||this;_this.activityData={};_this.palyEffList=[];_this.rankInfoList=[];_this.indexCurrDabiao=0;_this.nextDayState=0;_this.hfLoginDay=1;_this.geLoginDay=1;_this.firstRedpointlocal="_PActfirstRedpointlocal_";_this.isSuccee=false;_this.sysId=PackageID.PActivity;_this.regNetMsg(1,_this.doActivityData);_this.regNetMsg(2,_this.postRewardResult);_this.regNetMsg(7,_this.postChangePage);return _this}PActivity.ins=function(){return _super.ins.call(this)};PActivity.prototype.initZero=function(){if(this.activityData){for(var id in this.activityData){var activityId=+id;if(activityId<1e4){var config=GlobalConfig.ActivityConfig[id];if(config){this.sendChangePage(activityId)}}}}};PActivity.prototype.getActivityDataById=function(id){return this.activityData[id]};PActivity.prototype.getPalyEffListById=function(id){return this.palyEffList[id]};PActivity.prototype.setPalyEffListById=function(id,value){this.palyEffList[id]=value};PActivity.prototype.getrankInfoListByIndex=function(index){return this.rankInfoList[index]};PActivity.prototype.getfirstShowRedPointById=function(id){var t=true;LoginMgr.getItem(this.firstRedpointlocal+id,function(str){if(str){if(str=="onclicked")t=false}});return t};PActivity.prototype.setfirstShowRedPointById=function(id,value){LoginMgr.setItem(this.firstRedpointlocal+id,value)};PActivity.prototype.doActivityData=function(bytes){this.activityData={};var count=bytes.readShort();for(var i=0;i<count;i++){var activityData=PActivityDataFactory.create(bytes);if(activityData){var id=activityData.id;this.activityData[id]=activityData}}this.postActivityIsGetAwards()};PActivity.prototype.postSpecials=function(){};PActivity.prototype.postActivityIsGetAwards=function(){};PActivity.prototype.postRewardResult=function(bytes){this.isSuccee=bytes.readBoolean();var activityID=bytes.readInt();this.getActivityDataById(activityID).update(bytes);this.postActivityPanel(activityID);this.postActivityIsGetAwards();return activityID};PActivity.prototype.postActivityPanel=function(activityId){return activityId};PActivity.prototype.sendReward=function(actID,rewardID,param1){var bytes=this.getBytes(2);var cfg=GlobalConfig.PActivityConfig[actID];if(cfg&&cfg.activityType==PActivityDataFactory.PACTIVITY_TYPE_9){if(rewardID){bytes.writeInt(actID);bytes.writeShort(rewardID)}else{bytes.writeInt(actID);bytes.writeShort(rewardID);bytes.writeByte(param1)}}else if(cfg&&cfg.activityType==PActivityDataFactory.PACTIVITY_TYPE_28){if(rewardID){bytes.writeInt(actID);bytes.writeShort(rewardID)}else{bytes.writeInt(actID);bytes.writeShort(rewardID);bytes.writeByte(param1)}}else{bytes.writeInt(actID);bytes.writeShort(rewardID)}this.sendToServer(bytes)};PActivity.prototype.sendLianxuReward=function(actId){var bytes=this.getBytes(13);bytes.writeInt(actId);this.sendToServer(bytes)};PActivity.prototype.doRewardStatu=function(bytes){var activityId=bytes.readInt();var data=this.getActivityDataById(activityId);if(data){data.updateData(bytes)}this.postActivityIsGetAwards()};PActivity.prototype.postChangePage=function(bytes){var activityData=PActivityDataFactory.create(bytes);if(activityData){this.activityData[activityData.id]=activityData}this.postActivityIsGetAwards();return activityData?activityData.id:0};PActivity.prototype.sendChangePage=function(actId){var bytes=this.getBytes(7);bytes.writeInt(actId);this.sendToServer(bytes)};PActivity.prototype.doDaBiaoInfo=function(bytes){this.dabiaoDecode(bytes);this.postGetDaBiaoInfo()};PActivity.prototype.postGetDaBiaoInfo=function(){};PActivity.prototype.doNextDayLoginData=function(bytes){this.nextDayState=bytes.readShort();debug.log(this.nextDayState)};PActivity.prototype.doNextDayLoginReward=function(bytes){var state=bytes.readShort();if(state){this.nextDayState=2;UserTips.ins().showTips(StringUtils.addColor(i18n("PActivity_0"),15937822))}};PActivity.prototype.sendNextDayReward=function(){var bytes=this.getBytes(20);this.sendToServer(bytes)};PActivity.prototype.sendDabiaoInfo=function(dabiao){var bytes=this.getBytes(3);bytes.writeInt(dabiao);this.sendToServer(bytes)};PActivity.prototype.sendGetDabiaoReward=function(dabiao){var bytes=this.getBytes(4);bytes.writeInt(dabiao);this.sendToServer(bytes)};PActivity.prototype.postIsGetAwards=function(bytes){this.isGetAward=bytes.readBoolean()};PActivity.prototype.sendGetSevenDayAwards=function(day){var bytes=this.getBytes(12);bytes.writeShort(day);this.sendToServer(bytes)};PActivity.prototype.doSevenDayData=function(bytes){this.dayNum=bytes.readShort();this.isAwards=bytes.readInt();this.postSevendayIsAwards()};PActivity.prototype.doChangeSevenDayData=function(bytes){var flag=bytes.readBoolean();if(flag){var changeDay=bytes.readShort();this.isAwards=bytes.readInt();this.postSevendayAwardCallback()}else{UserTips.ins().showTips(i18n("PActivity_1"))}this.postSevendayIsAwards()};PActivity.prototype.postSevendayAwardCallback=function(){};PActivity.prototype.postSevendayIsAwards=function(){};PActivity.prototype.postNextDayInfo=function(){};PActivity.prototype.getSevenDayStast=function(){var day=DateUtils.DAYS_PER_WEEK;if(this.dayNum>14)day=14;else day=this.dayNum;for(var i=1;i<=day;i++){var config=GlobalConfig.LoginRewardsConfig[i];if(config){if(this.dayNum>=config.day){if((this.isAwards>>config.day&1)==0)return true}}}return false};PActivity.prototype.getSevenDayLogIsVisible=function(){return(this.isAwards>>14&1)==0};PActivity.prototype.getbtnInfo=function(str){var config=GlobalConfig.PActivityBtnConfig;if(config[str]){return config[str]}return null};PActivity.prototype.isShowRedPointByBtnInfo=function(abc){var result=false;result=this.isFirstShow(abc)||this.checkAcCanGet(abc.id+"");return result};PActivity.prototype.isFirstShow=function(abc){return this.getfirstShowRedPointById(abc.id)};PActivity.prototype.checkAcCanGet=function(index){var data=this.activityData;for(var k in data){if(k==index&&data[k].isOpenActivity()&&data[k].canReward()&&data[k].specialState()){return true}}return false};PActivity.prototype.checkOtherCharge2CanGet=function(){var rechargeData=Recharge.ins().getRechargeData(1);var config=GlobalConfig.ChongZhi2Config[rechargeData.day/7>=1?2:1][rechargeData.day%7];for(var k in config){if((rechargeData.isAwards>>config[k].index&1)==0&&rechargeData.num>=config[k].pay){return true}}return false};PActivity.prototype.dabiaoDecode=function(bytes){this.isDaBiao=bytes.readBoolean();this.indexCurrDabiao=Math.max(bytes.readInt()-1,0);var rankType=bytes.readShort();if(rankType==RankDataType.TYPE_LEVEL){bytes.readInt();bytes.readInt()}else if(rankType==RankDataType.TYPE_BAOSHI){this.myDabiaoInfo=bytes.readInt()}else if(rankType==RankDataType.TYPE_ZHANLING){var zj=bytes.readInt();var zx=bytes.readInt();this.myDabiaoInfo=[zj,zx]}else if(rankType==RankDataType.TYPE_LONGHUN){this.myDabiaoInfo=bytes.readInt()}else if(rankType==RankDataType.TYPE_XIAOFEI){this.myDabiaoInfo=bytes.readInt();this.myPaiming=bytes.readInt()}else if(rankType==RankDataType.TYPE_HF_XIAOFEI){this.myDabiaoInfo=bytes.readInt();this.myPaiming=bytes.readInt()}else if(rankType==RankDataType.TYPE_XIANYU){this.myDabiaoInfo=bytes.readInt();this.myPaiming=bytes.readInt()}else{this.myDabiaoInfo=bytes.readDouble()}var len=bytes.readShort();var data;this.rankInfoList=[];for(var i=0;i<len;i++){if(!this.rankInfoList[i]){this.rankInfoList.push(new PDabiaoData)}data=this.rankInfoList[i];data.prase(bytes,rankType)}};PActivity.prototype.getisCangetDabiao3=function(id){var activityData=PActivity.ins().getActivityDataById(id);if(activityData.canOnlyReward){activityData.canOnlyReward();return activityData.btn1||activityData.btn2}else{return this.checkAcCanGet(id+"")}};PActivity.prototype.getisCanBuyXianGou=function(actId){var rtn=false;var configList=GlobalConfig.PActivity2Config[actId];if(configList){for(var i=0;i<configList.length;i++){rtn=this.getisCanBuyXianGouItem(actId,i);if(rtn)break}}return rtn};PActivity.prototype.getisCanBuyXianGouItem=function(actId,itemId){var rtn=false;var activityData=PActivity.ins().activityData[actId];var configList=GlobalConfig.PActivity2Config[actId];if(activityData&&configList){var config=configList[itemId];var buyData=activityData.buyData[itemId]||0;if(config&&buyData){var myMoney=config.currencyType==1?Actor.gold:Actor.yb;var a=config.currencyType==1;var b=myMoney>=config.price;var c=config.count-buyData>0;rtn=a&&b&&c}}return rtn};PActivity.prototype.IsHefuXunBaoTimer=function(){if(!GameServer._serverHeZeroTime)return false;var startTime=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);var endTime=startTime+GlobalConfig.TreasureHuntConfig.hefuDay*24*60*60*1e3;var curTime=GameServer.serverTime;if(curTime>=startTime&&curTime<=endTime){return true}return false};PActivity.prototype.IsBossScoreTitle=function(id,title){return false};PActivity.prototype.getIsBuy=function(config){if(config){var activityData=Activity.ins().getActivityDataById(config.Id);if(config.count&&activityData.personalRewardsSum[config.index]>=config.count){return false}if(config.scount&&activityData.worldRewardsSum[config.index]>=config.scount){return false}return true}};PActivity.prototype.getType7RedPoint=function(activityID){var itemData;var config=GlobalConfig.ActivityType7Config[activityID];var actdata=Activity.ins().getActivityDataById(activityID);for(var i in config){if(Activity.ins().getIsBuy(config[i])){if(config[i].itemId){itemData=UserBag.ins().getBagItemById(config[i].itemId);if(itemData&&itemData.count>=config[i].itemCount)return true}else if(actdata.bossScore>=config[i].score)return true}}return false};PActivity.prototype.getCurrentRingAwardIndex=function(record){var index=1;if(record>0){while((record>>index&1)!=0){index++}}return index};PActivity.prototype.getRingAward=function(index){for(var i in GlobalConfig.ActivityType8Config){var cfg=GlobalConfig.ActivityType8Config[i][1];if(cfg.showType==ActivityType8Data.TYPE_RING){for(var j in GlobalConfig.ActivityType8Config[i]){if(j==index.toString()){return GlobalConfig.ActivityType8Config[i][j]}}}}return null};PActivity.prototype.getLastRingAward=function(){var lastCfg;for(var i in GlobalConfig.ActivityType8Config){var cfg=GlobalConfig.ActivityType8Config[i][1];if(cfg.showType==ActivityType8Data.TYPE_RING){for(var j in GlobalConfig.ActivityType8Config[i]){lastCfg=GlobalConfig.ActivityType8Config[i][j]}}}return lastCfg};PActivity.prototype.addEvent=function(){MessageCenter.addListener(GameLogic.ins().postEnterMap,this.openRingActivity,this)};PActivity.prototype.removeEvent=function(){MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap["funcallname"],this.openRingActivity,this)};PActivity.prototype.openRingActivity=function(){if(GameMap.fbType==0){MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap["funcallname"],this.openRingActivity,this);ViewManager.ins().open(ActivityWin,201);Activity.ins().sendChangePage(201)}};PActivity.prototype.getType8RedPoint=function(activityID){var isRedPoint=false;var data=Activity.ins().activityData[activityID];if(data&&data.record==0){isRedPoint=true}return isRedPoint};PActivity.prototype.getType9RedPoint=function(activityID){var isRedPoint=false;var data=PActivity.ins().activityData[activityID];if(this.getRollSum(activityID)){isRedPoint=true}else{var config=GlobalConfig.PActivityType9Config[activityID];for(var i in config[0].reward){if(this.isGetRollReward(activityID,+i)){isRedPoint=true;break}}}return isRedPoint};PActivity.prototype.getType28RedPoint=function(activityID){var isRedPoint=false;var data=Activity.ins().activityData[activityID];if(this.getRollSum28(activityID)){isRedPoint=true}else{isRedPoint=this.getType28ScoreRedPoint(activityID)}return isRedPoint};PActivity.prototype.getType28ScoreRedPoint=function(activityID){var isRedPoint=false;var config=GlobalConfig.ActivityType28_3Config;for(var i in config){var c=config[i];if(this.isGetScoreReward28(activityID,c.id)){isRedPoint=true;break}}return isRedPoint};PActivity.prototype.getType10RedPoint=function(activityID){var data=Activity.ins().activityData[activityID];var config=GlobalConfig.ActivityType10Config[activityID][data.getLevel()];if(!config)return false;if(data.yb>=config.recharge&&Actor.yb>=config.yuanBao)return true;return false};PActivity.prototype.getType17RedPoint=function(activityID){var data=Activity.ins().activityData[activityID];var config=GlobalConfig.ActivityType17_2Config[activityID];if(!config)return false;if(data.score>=config.score)return true;return false};PActivity.prototype.isGetRollReward=function(activityID,id){var data=PActivity.ins().activityData[activityID];var config=GlobalConfig.PActivityType9Config[activityID];if(config&&config[0]){if(config[0].reward[id].times&&data.count>=config[0].reward[id].times&&!(data.record>>id+1&1)){return true}}return false};PActivity.prototype.getRollSum=function(activityID){var config=GlobalConfig.PActivityType9Config[activityID];if(config&&config[0]){var itemData=UserBag.ins().getBagItemById(config[0].item);if(itemData){return true}}return false};PActivity.prototype.getIsRollTen=function(activityID){var config=GlobalConfig.PActivityType9Config[activityID][0];if(config){var sum=0;if(config.item){var item=UserBag.ins().getBagItemById(config.item);if(item){sum+=item.count}if(sum>=10)return true}sum=10-sum;if(config.yb){if(Actor.yb>=config.yb*sum)return true}}return false};PActivity.prototype.isGetScoreReward28=function(activityID,id){var cfg=GlobalConfig.ActivityType28_3Config[id];if(!cfg){return false}var target=cfg.score||0;var data=Activity.ins().activityData[activityID];var score=data.score||0;if(score<target){return false}else{var gotArr=data.gotArr||[];if(gotArr.indexOf(id)>-1){return false}return true}};PActivity.prototype.getRollSum28=function(activityID){var config=GlobalConfig.PActivityType28_1Config[activityID];if(config&&config[0]){var itemData=UserBag.ins().getBagItemById(config[0].item);if(itemData){return true}}return false};PActivity.prototype.getIsRollTen28=function(activityID){var config=GlobalConfig.PActivityType28_1Config[activityID][0];if(config){var sum=0;if(config.item){var item=UserBag.ins().getBagItemById(config.item);if(item){sum+=item.count}if(sum>=10)return true}sum=10-sum;if(config.yb){if(Actor.yb>=config.yb*sum)return true}}return false};PActivity.prototype.getCurShowScoreId=function(activityID){var cfg=GlobalConfig.ActivityType28_3Config;var found=-1;for(var i in cfg){var c=cfg[i];var id=c.id;var canGet=this.isGetScoreReward28(activityID,id);if(canGet){found=id}}if(found>-1){return found}else{var data=Activity.ins().activityData[activityID];for(var i in cfg){var c=cfg[i];var id=c.id;var target=c.score||0;var score=data.score||0;if(score<target){found=id;return found}}}return 1};PActivity.NotReached=0;PActivity.CanGet=1;PActivity.Geted=2;PActivity.NOKILL=0;PActivity.KILL=1;return PActivity}(BaseSystem);__reflect(PActivity.prototype,"PActivity");var PDabiaoData=function(){function PDabiaoData(){}PDabiaoData.prototype.prase=function(bytes,rankType){if(rankType==RankDataType.TYPE_XIAOFEI||rankType==RankDataType.TYPE_HF_XIAOFEI||rankType==RankDataType.TYPE_XIANYU){this.rankIndex=bytes.readShort();this.id=bytes.readInt();this.name=bytes.readString();this.numType=bytes.readInt();return}this.rankIndex=bytes.readShort();this.id=bytes.readInt();this.name=bytes.readString();this.level=bytes.readShort();this.zsLevel=bytes.readShort();this.monthCard=bytes.readShort();this.vipLv=bytes.readShort();if(RankDataType.TYPE_LEVEL!=rankType){if(rankType==RankDataType.TYPE_BAOSHI||rankType==RankDataType.TYPE_LONGHUN){this.numType=bytes.readInt()}else if(rankType==RankDataType.TYPE_ZHANLING){var zj=bytes.readInt();var zx=bytes.readInt();this.numType=[zj,zx]}else{this.numType=bytes.readDouble()}}};return PDabiaoData}();__reflect(PDabiaoData.prototype,"PDabiaoData");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.pactivity=PActivity.ins.bind(PActivity)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var PActivityDataFactory=function(){function PActivityDataFactory(){}PActivityDataFactory.create=function(bytes){var id=bytes.readInt();var startTime=bytes.readInt();var endTime=bytes.readInt();var type=bytes.readShort();var len=bytes.readInt();var data;switch(type){case PActivityDataFactory.PACTIVITY_TYPE_1:data=new PActivityType1Data(bytes);break;case PActivityDataFactory.PACTIVITY_TYPE_2:data=new PActivityType2Data(bytes);break;case PActivityDataFactory.PACTIVITY_TYPE_3:data=new PActivityType3Data(bytes);break;case PActivityDataFactory.PACTIVITY_TYPE_9:data=new PActivityType9Data(bytes);break;default:{if(!ErrorLog.Assert(type,i18n("PActivityDataFactory_1",id)+type))for(var i=0;i<len;i++){bytes.readByte()}return null}}if(!data)return null;data.id=id;data.startTime=startTime;data.endTime=endTime;data.type=type;data.activityType=ActivityType.Personal;var paconfig=GlobalConfig.PActivityConfig[id];if(paconfig){data.duration=paconfig.duration}return data};PActivityDataFactory.PACTIVITY_TYPE_1=1;PActivityDataFactory.PACTIVITY_TYPE_2=2;PActivityDataFactory.PACTIVITY_TYPE_3=3;PActivityDataFactory.PACTIVITY_TYPE_4=4;PActivityDataFactory.PACTIVITY_TYPE_5=5;PActivityDataFactory.PACTIVITY_TYPE_6=6;PActivityDataFactory.PACTIVITY_TYPE_7=7;PActivityDataFactory.PACTIVITY_TYPE_8=8;PActivityDataFactory.PACTIVITY_TYPE_9=9;PActivityDataFactory.PACTIVITY_TYPE_10=10;PActivityDataFactory.PACTIVITY_TYPE_11=11;PActivityDataFactory.PACTIVITY_TYPE_17=17;PActivityDataFactory.PACTIVITY_TYPE_28=28;return PActivityDataFactory}();__reflect(PActivityDataFactory.prototype,"PActivityDataFactory");var PActivityType1Data=function(_super){__extends(PActivityType1Data,_super);function PActivityType1Data(bytes){return _super.call(this,bytes)||this}return PActivityType1Data}(ActivityType1Data);__reflect(PActivityType1Data.prototype,"PActivityType1Data");var PActivityType28_1Data=function(_super){__extends(PActivityType28_1Data,_super);function PActivityType28_1Data(bytes){return _super.call(this,bytes)||this}return PActivityType28_1Data}(ActivityType28_1Data);__reflect(PActivityType28_1Data.prototype,"PActivityType28_1Data");var PActivityType2Data=function(_super){__extends(PActivityType2Data,_super);function PActivityType2Data(bytes){var _this=_super.call(this,bytes)||this;_this.buyData=[];_this.serverBuyData=[];_this.initBuyData(bytes);return _this}PActivityType2Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);var id=bytes.readShort();var count=bytes.readInt();this.buyData[id]=count;this.serverBuyData[id]=bytes.readInt()};PActivityType2Data.prototype.initBuyData=function(bytes){var count=bytes.readShort();for(var i=1;i<=count;i++){this.buyData[i]=bytes.readShort();this.serverBuyData[i]=bytes.readShort()}this.sumRMB=bytes.readInt()};PActivityType2Data.prototype.canReward=function(){if(Actor.level<PActivityType2Data.LimitLevel)return false;var activityData;activityData=PActivity.ins().getActivityDataById(this.id);var config=GlobalConfig.PActivity2Config[this.id];var serverBuy=false;for(var i in config){var cfd=config[i];var isBuy=activityData.buyData[cfd.index]>=cfd.count?true:false;if(!isBuy&&activityData.sumRMB>=cfd.needRecharge&&Actor.yb>=cfd.price&&UserVip.ins().lv>=cfd.vip&&!serverBuy){return true}}return false};PActivityType2Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};PActivityType2Data.prototype.getHide=function(){if(this.isHide)return this.isHide;var config=GlobalConfig.PActivity2Config[this.id];for(var i=1;i<this.buyData.length;i++){var cfd=config[i];if(this.buyData[i]<cfd.count){this.isHide=false;return this.isHide}}this.isHide=true;return this.isHide};PActivityType2Data.prototype.getLeftTime=function(){if(this.endTime){var end_time=DateUtils.formatMiniDateTime(this.endTime)/1e3;var leftTime=Math.floor((end_time-GameServer.serverTime)/1e3);if(leftTime<0){leftTime=0}return leftTime}return 0};PActivityType2Data.prototype.getSpecialOpenLeftTime=function(){};PActivityType2Data.prototype.getAreaReward=function(index,zqindex){return 0};PActivityType2Data.LimitLevel=50;return PActivityType2Data}(ActivityBaseData);__reflect(PActivityType2Data.prototype,"PActivityType2Data");var PActivityType3Data=function(_super){__extends(PActivityType3Data,_super);function PActivityType3Data(bytes){var _this=_super.call(this,bytes)||this;_this.dabiao=[];_this.chongzhiNum=0;_this.chongzhiTotal=0;_this.btn1=false;_this.btn2=false;_this.image1=false;_this.image2=false;_this.updateData(bytes);_this.recrod=bytes.readInt();return _this}PActivityType3Data.prototype.update=function(bytes){_super.prototype.update.call(this,bytes);var rewardID=bytes.readShort();this.recrod=bytes.readInt()};PActivityType3Data.prototype.openDay=function(){var configs=GlobalConfig["PActivity3Config"][this.id];if(configs&&configs[0]){return configs[0].day}return 7};PActivityType3Data.prototype.canReward=function(){var configs=GlobalConfig["PActivity3Config"][this.id];var records=this.recrod;var curIndex=-1;var i=0;for(var k in configs){var record=records>>configs[k].index&1;if(configs[k].type==1){if(this.dabiao[i]>=configs[k].day){if(record==0)return true}}else if(configs[k].type==2&&configs[k].val<=this.chongzhiTotal){if(record==0)return true}else if(configs[k].type==3&&configs[k].val<=this.chongzhiNum){if(curIndex==-1){curIndex=this.getCurIndex(3)}if(curIndex==configs[k].index&&record==0)return true}i++}return false};PActivityType3Data.prototype.isOpenActivity=function(){var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(beganTime<0&&endedTime>0){return true}return false};PActivityType3Data.prototype.updateData=function(bytes){var num=bytes.readShort();this.dabiao=[];for(var i=0;i<num;i++){this.dabiao.push(bytes.readShort())}this.chongzhiNum=bytes.readInt();this.chongzhiTotal=bytes.readInt()};Object.defineProperty(PActivityType3Data.prototype,"day7text",{get:function(){var configs=GlobalConfig["PActivity3Config"][this.id];for(var k in configs){if(configs[k].type==1){this.rewards1=configs[k].rewards;this._day7text=i18n("PActivityType3Data_0","<font color='#ffff00'>"+configs[k].day+"</font>","<font color='#ffff00'>"+configs[k].val+"</font>")}}return this._day7text},enumerable:true,configurable:true});Object.defineProperty(PActivityType3Data.prototype,"totaltext",{get:function(){var configs=GlobalConfig["PActivity3Config"][this.id];for(var k in configs){if(configs[k].type==2){this.maxTotal=configs[k].val;this.rewards2=configs[k].rewards;this._totaltext=i18n("PActivityType3Data_1","<font color='#ffff00'>"+configs[k].val+"</font>")}}return this._totaltext},enumerable:true,configurable:true});PActivityType3Data.prototype.canOnlyReward=function(){var configs=GlobalConfig["PActivity3Config"][this.id];var records=this.recrod;this.btn1=false;this.btn2=false;this.image1=false;this.image2=false;for(var k in configs){var record=records>>configs[k].index&1;if(configs[k].type==1&&this.dabiao){if(this.dabiao[0]>=configs[k].day){if(record==0)this.btn1=true;if(record==1)this.image1=true}}if(configs[k].type==2&&configs[k].val<=this.chongzhiTotal){if(record==0)this.btn2=true;if(record==1)this.image2=true}}};PActivityType3Data.prototype.getDateTime=function(str){var arr=str.split(/[-,.,:]/g);var date=new Date(+arr[0],+arr[1]-1,+arr[2],+arr[3]||0,+arr[4]||0);return date.getTime()};PActivityType3Data.prototype.curOpenDay=function(){var openTime=Math.floor(GameServer.serverTime-DateUtils.formatMiniDateTime(this.startTime)/1e3/3600/24);return openTime};PActivityType3Data.prototype.getCurIndex=function(type){var actConfig=GlobalConfig.PActivityConfig[this.id];var type3Config=GlobalConfig.PActivity3Config[this.id];var day=0;if(this.startTime){day=this.curOpenDay()}var types={};for(var t in type3Config){types[type3Config[t].type]=1}var keys=Object.keys(types);if(keys.length==1||type==undefined){type=+keys[0]}var configArr=[];var i;for(i in type3Config){if(type3Config[i].type==type){configArr.push(type3Config[i])}}configArr.sort(function(a,b){if(a.day<b.day)return-1;return 1});for(var _i=0,configArr_2=configArr;_i<configArr_2.length;_i++){var conf=configArr_2[_i];i=conf.index;if(type==1||type==2){if(day<conf.day){return+i}}else if(type==3){if(day<conf.day){return+i}}}return+i};PActivityType3Data.prototype.getLeftTime=function(){if(this.endTime){var leftTime=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);if(leftTime<0){leftTime=0}return leftTime}return 0};PActivityType3Data.prototype.getRewardStateById=function(index){var config=GlobalConfig.PActivity3Config[this.id][index];switch(config.showType){case Show3Type.TYPE6:case Show3Type.TYPE8:if(this.chongzhiTotal<config.val)return Activity.NotReached;break;case Show3Type.TYPE7:if(this.dabiao[index-1]<config.day)return Activity.NotReached;break}var record=this.recrod>>config.index&1;return record?Activity.Geted:Activity.CanGet};return PActivityType3Data}(ActivityBaseData);__reflect(PActivityType3Data.prototype,"PActivityType3Data");var PShow1Type;(function(PShow1Type){PShow1Type[PShow1Type["TYPE1"]=1]="TYPE1";PShow1Type[PShow1Type["TYPE2"]=2]="TYPE2";PShow1Type[PShow1Type["TYPE3"]=3]="TYPE3";PShow1Type[PShow1Type["TYPE4"]=4]="TYPE4";PShow1Type[PShow1Type["TYPE5"]=5]="TYPE5";PShow1Type[PShow1Type["TYPE6"]=6]="TYPE6";PShow1Type[PShow1Type["TYPE7"]=7]="TYPE7";PShow1Type[PShow1Type["TYPE8"]=8]="TYPE8"})(PShow1Type||(PShow1Type={}));window["PShow1Type"]=PShow1Type;var PActivityType9Data=function(_super){__extends(PActivityType9Data,_super);function PActivityType9Data(bytes){return _super.call(this,bytes)||this}return PActivityType9Data}(ActivityType9Data);__reflect(PActivityType9Data.prototype,"PActivityType9Data");var Artifact=function(_super){__extends(Artifact,_super);function Artifact(){var _this=_super.call(this)||this;_this.artifacts=[];_this.showGuide=-2e3;_this.openHeji=0;_this.attArr=["a","args","b","cd","crit","d","selfEff"];_this.listArtifacts={};_this.sysId=PackageID.Artifact;_this.regNetMsg(1,_this.postArtifactInit);_this.regNetMsg(2,_this.postArtifactUpdate);_this.regNetMsg(3,_this.postNewArtifactInit);_this.regNetMsg(4,_this.postNewArtifactUpdate);return _this}Artifact.ins=function(){return _super.ins.call(this)};Artifact.prototype.getNewArtifactPower=function(index){var conf=GlobalConfig.ImbaConf[index];var data=this.listArtifacts[conf.id];if(!data)return 0;var isSuit=true;var power=0;for(var i=0;i<conf.jigsawId.length;i++){var state=data.record>>i&1;if(state)power+=GlobalConfig.ImbaJigsawConf[conf.jigsawId[i]].power;else isSuit=false}if(data.open)power+=conf.power;return power};Artifact.prototype.getAttr=function(){var list={};for(var index in GlobalConfig.ImbaConf){var conf=GlobalConfig.ImbaConf[index];var data=this.getNewArtifactBy(conf.index);for(var i=0;i<conf.jigsawId.length;i++){var state=data.record>>i&1;if(state){var chipConf=GlobalConfig.ImbaJigsawConf[conf.jigsawId[i]];for(var j=0;j<chipConf.attrs.length;j++){var attr=chipConf.attrs[j];AttributeData.addAttrToList(list,attr)}}}if(data.open){if(conf.attrs){for(var i=0;i<conf.attrs.length;i++){AttributeData.addAttrToList(list,conf.attrs[i])}}}}var result=[];for(var k in list){result.push(list[k])}result.sort(AttributeData.sortAttribute);return result};Artifact.prototype.getAllArtifactPower=function(){var power=0;for(var k in GlobalConfig.ImbaConf){power+=this.getNewArtifactPower(+k)}return power};Artifact.prototype.getArtifactIndexById=function(id){for(var k in GlobalConfig.ImbaConf){if(GlobalConfig.ImbaConf[k].id==id){return GlobalConfig.ImbaConf[k].index}}return 0};Artifact.prototype.getNewArtifactBy=function(index){var id=0;if(GlobalConfig.ImbaConf[index]){id=GlobalConfig.ImbaConf[index].id}else{return null}if(!this.listArtifacts[id]){var data=new NewArtifactData;data.id=id;data.record=0;this.listArtifacts[id]=data}return this.listArtifacts[id]};Artifact.prototype.getMaxIndex=function(){if(!this.maxIndex){var id=1;var conf=GlobalConfig.ImbaConf;for(var i in conf){id=Math.max(conf[i].index,id)}this.maxIndex=id}return this.maxIndex};Artifact.prototype.getConfById=function(id){var conf=GlobalConfig.ImbaConf;for(var k in conf){if(conf[k].id==id){return conf[k]}}};Artifact.prototype.showRedPoint=function(){var max=this.getMaxIndex();for(var i=1;i<=max;i++){var conf=GlobalConfig.ImbaConf[i];var data=this.getNewArtifactBy(i);if(!data.open){var len=conf.jigsawId.length;var complete=Math.pow(2,len)-1;if(complete==data.record)return true;if(data.exitRecord!=data.record)return true}}return false};Artifact.prototype.getNextChapterId=function(){var max=this.getMaxIndex();for(var i=1;i<=max;i++){var data=this.getNewArtifactBy(i);var id=data.getNextChipId();if(id){}}};Artifact.prototype.getConfByChipId=function(id){var conf=GlobalConfig.ImbaConf;for(var k in conf){if(conf[k].jigsawId.indexOf(id)!=-1){return conf[k]}}return null};Artifact.prototype.setGuide=function(){this.showGuide=egret.getTimer();this.postGuide();TimerManager.ins().remove(this.guideEnd,this);TimerManager.ins().doTimer(3e3,1,this.guideEnd,this)};Artifact.prototype.guideEnd=function(){Artifact.ins().showGuide=-3e3;Artifact.ins().postGuide()};Artifact.prototype.postGuide=function(){};Artifact.prototype.postArtifactInit=function(bytes){var count=bytes.readInt();for(var i=0;i<count;i++){var artifact=new ArtifactData;artifact.parser(bytes);this.artifacts[artifact.id]=artifact}};Artifact.prototype.postArtifactUpdate=function(bytes){var isSuccee=bytes.readBoolean();if(isSuccee){var artifactId=bytes.readInt();var rank=bytes.readShort();this.artifacts[artifactId].rank=rank}else{UserTips.ins().showTips(i18n("Artifact_1"))}return isSuccee};Artifact.prototype.sendRank=function(artifactId){var bytes=this.getBytes(2);bytes.writeInt(artifactId);this.sendToServer(bytes)};Artifact.prototype.postNewArtifactInit=function(bytes){var len=bytes.readUnsignedShort();this.artifactsOpenDic={};for(var i=0;i<len;i++){var data=new NewArtifactData;data.id=bytes.readInt();data.record=bytes.readInt();data.open=bytes.readByte()!=0;if(!data.open){data.exitRecord=bytes.readInt()}else{data.exitRecord=Math.pow(2,32)-1;if(len==1&&this.openHeji==1){this.openHeji=2}}this.listArtifacts[data.id]=data;if(data.open)this.artifactsOpenDic[data.id]=data}this.setImbaBuffDic()};Artifact.prototype.setImbaBuffDic=function(){if(!this.imbaBuffDic){this.imbaBuffDic={};var config=GlobalConfig.ImbaSkillReviseConfig;for(var k in config){if(!this.imbaBuffDic[config[k].skill])this.imbaBuffDic[config[k].skill]={};if(!this.imbaBuffDic[config[k].skill][config[k].imba_id])this.imbaBuffDic[config[k].skill][config[k].imba_id]={};this.imbaBuffDic[config[k].skill][config[k].imba_id]=config[k]}}var len=CommonUtils.getObjectLength(this.artifactsOpenDic);if(len){this.imbaSkillDic={};for(var j in this.imbaBuffDic){for(var l in this.imbaBuffDic[j]){if(this.artifactsOpenDic[l]){if(!this.imbaSkillDic[j]){this.imbaSkillDic[j]=new ImbaSkillReviseConfig}for(var m in this.imbaSkillDic[j]){if(this.attArr.indexOf(m)==-1)continue;if(this.imbaBuffDic[j][l][m]){if(m=="selfEff"){if(!this.imbaSkillDic[j][m]){this.imbaSkillDic[j][m]=[]}this.imbaSkillDic[j][m].push(this.imbaBuffDic[j][l][m][0])}else if(m=="args"){this.imbaSkillDic[j][m]=this.imbaBuffDic[j][l][m]}else{this.imbaSkillDic[j][m]+=this.imbaBuffDic[j][l][m]}}}}}}}};Artifact.prototype.getReviseBySkill=function(sId){if(!this.imbaSkillDic)return null;var skillId=Math.floor(sId/1e3);if(this.imbaSkillDic[skillId]){return this.imbaSkillDic[skillId]}return null};Artifact.prototype.postNewArtifactUpdate=function(bytes){var id=bytes.readInt();var tar=this.listArtifacts[id];if(tar){var oldRecord=tar.exitRecord;tar.exitRecord=bytes.readInt();tar.record=bytes.readInt();var addRecord=tar.exitRecord-oldRecord;var conf=this.getConfById(id);for(var i=0;i<conf.jigsawId.length;i++){var state=addRecord>>i&1;if(state){var itemData=new ItemData;itemData.configID=conf.jigsawId[i]}}}else{var data=new NewArtifactData;data.id=id;data.exitRecord=bytes.readInt();data.record=bytes.readInt();this.listArtifacts[id]=data}};Artifact.prototype.sendOpenChip=function(id){var bytes=this.getBytes(4);bytes.writeInt(id);this.sendToServer(bytes)};Artifact.prototype.openArtifact=function(id){var bytes=this.getBytes(3);bytes.writeInt(id);this.sendToServer(bytes);if(this.openHeji==0){this.openHeji=1}};return Artifact}(BaseSystem);__reflect(Artifact.prototype,"Artifact");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.artifact=Artifact.ins.bind(Artifact)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ArtifactData=function(){function ArtifactData(){this.id=0;this.rank=0}ArtifactData.prototype.parser=function(bytes){this.id=bytes.readInt();this.rank=bytes.readShort()};return ArtifactData}();__reflect(ArtifactData.prototype,"ArtifactData");var NewArtifactData=function(){function NewArtifactData(){this.id=0;this.record=0;this.open=false;this.exitRecord=0}NewArtifactData.prototype.isChipExit=function(index){return(this.exitRecord>>index&1)==1};NewArtifactData.prototype.isChipOpen=function(index){return(this.record>>index&1)==1};NewArtifactData.prototype.getChipLength=function(){return GlobalConfig.ImbaConf[this.id].jigsawId.length};NewArtifactData.prototype.getNextChipId=function(){var conf=GlobalConfig.ImbaConf[this.id];for(var i=0;i<conf.jigsawId.length;i++){if(!this.isChipExit(i)){return conf.jigsawId[i]}}return null};NewArtifactData.prototype.remindNumToOpen=function(){var conf=this.getConf();var num=0;for(var i=0;i<conf.jigsawId.length;i++){if(!this.isChipExit(i)){num++}}return num};NewArtifactData.prototype.getConf=function(){for(var k in GlobalConfig.ImbaConf){if(GlobalConfig.ImbaConf[k].id==this.id){return GlobalConfig.ImbaConf[k]}}};return NewArtifactData}();__reflect(NewArtifactData.prototype,"NewArtifactData");var ArtifactAllAttrWin=function(_super){__extends(ArtifactAllAttrWin,_super);function ArtifactAllAttrWin(){var _this=_super.call(this)||this;_this.skinName="shenqiAttrskin";_this.list.itemRenderer=ArtifactAttrDescItem;return _this}ArtifactAllAttrWin.prototype.open=function(){this.addTouchEvent(this.rect,this.onTap);this.list.dataProvider=new eui.ArrayCollection(Artifact.ins().getAttr())};ArtifactAllAttrWin.prototype.close=function(){};ArtifactAllAttrWin.prototype.onTap=function(e){switch(e.target){case this.rect:ViewManager.ins().close(this);break}};return ArtifactAllAttrWin}(BaseEuiView);__reflect(ArtifactAllAttrWin.prototype,"ArtifactAllAttrWin");ViewManager.ins().reg(ArtifactAllAttrWin,LayerManager.UI_Popup);var ArtifactAttrDescItem=function(_super){__extends(ArtifactAttrDescItem,_super);function ArtifactAttrDescItem(){var _this=_super.call(this)||this;_this.skinName="shenQiAttrDescSkin";return _this}ArtifactAttrDescItem.prototype.dataChanged=function(){var data=this.data;var str=AttributeData.getAttStrByType(data,0,"：");this.labelInfo.text=str};return ArtifactAttrDescItem}(eui.ItemRenderer);__reflect(ArtifactAttrDescItem.prototype,"ArtifactAttrDescItem");var ArtifactChipOpenWin=function(_super){__extends(ArtifactChipOpenWin,_super);function ArtifactChipOpenWin(){var _this=_super.call(this)||this;_this.skinName="shenqiPartActskin";_this.list.itemRenderer=ArtifactAttrDescItem;return _this}ArtifactChipOpenWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.index=param[1];this.mId=param[0];this.openTips(this.mId);this.addTouchEvent(this.btnOpen,this.onTap)};ArtifactChipOpenWin.prototype.close=function(){};ArtifactChipOpenWin.prototype.openTips=function(mId){var data=Artifact.ins().getNewArtifactBy(this.index);var conf=GlobalConfig.ImbaJigsawConf[mId];this.list.dataProvider=new eui.ArrayCollection(conf.attrs);this.imgArtifact.source=conf.img;this.labelInfo.text=i18n("ArtifactChipOpenWin_0",data.remindNumToOpen());this.labelName.text=conf.name};ArtifactChipOpenWin.prototype.onTap=function(e){switch(e.target){case this.btnOpen:Artifact.ins().sendOpenChip(this.mId);ViewManager.ins().close(this);break}};return ArtifactChipOpenWin}(BaseEuiView);__reflect(ArtifactChipOpenWin.prototype,"ArtifactChipOpenWin");ViewManager.ins().reg(ArtifactChipOpenWin,LayerManager.UI_Popup);var ArtifactConditionItemRenderer=function(_super){__extends(ArtifactConditionItemRenderer,_super);function ArtifactConditionItemRenderer(){var _this=_super.call(this)||this;_this.skinName="ArtifactsItemSkin";_this.go.addEventListener(egret.TextEvent.LINK,_this.onGo,_this);return _this}ArtifactConditionItemRenderer.prototype.dataChanged=function(){var achievementID=this.data["taskId"];var data=UserTask.ins().getAchieveByTaskId(achievementID);this.config=UserTask.ins().getAchieveConfById(data.id);var color;if(data.value>=this.config.target){color="0x03b154";this.go.visible=false;this.complete.visible=true}else{color="0xf3311e";this.go.textFlow=(new egret.HtmlTextParser).parser(i18n("ArtifactConditionItemRenderer_0"));this.go.visible=true;this.complete.visible=false;if(this.config.controlTarget==undefined){this.go.visible=false}}var str=this.config.name+"(<font color="+color+">"+data.value+"</font>/"+this.config.target+")";this.desc.textFlow=(new egret.HtmlTextParser).parser(str)};ArtifactConditionItemRenderer.prototype.destruct=function(){this.go.removeEventListener(egret.TextEvent.LINK,this.onGo,this)};ArtifactConditionItemRenderer.prototype.onGo=function(){var i;if(this.config.controlTarget==undefined){new Error(i18n("ArtifactConditionItemRenderer_1"))}else{ViewManager.ins().close(this.config.controlTarget[0].toString());ViewManager.ins().open(this.config.controlTarget[0].toString(),[this.config.controlTarget[1]])}};return ArtifactConditionItemRenderer}(BaseItemRender);__reflect(ArtifactConditionItemRenderer.prototype,"ArtifactConditionItemRenderer");var ArtifactItemRenderer=function(_super){__extends(ArtifactItemRenderer,_super);function ArtifactItemRenderer(){var _this=_super.call(this)||this;_this.skinName="shenqiItemskin";return _this}ArtifactItemRenderer.prototype.dataChanged=function(){this.groupAct.visible=false;this.labelCond.visible=false;this.lock.visible=false;this.guiderGroup.visible=false;this.mcGroup.visible=false;if(this.data==null){this.labelCond.visible=true;this.lock.visible=true;return}switch(this.data.state){case ArtifactItemState.activatable:this.groupAct.visible=true;this.lock.visible=true;break;case ArtifactItemState.activated:this.mcGroup.visible=true;this.mcGroup.removeChildren();var mc=new MovieClip;mc.playFile(this.data.mc,-1);this.mcGroup.addChild(mc);break;case ArtifactItemState.unActivated:this.labelCond.visible=true;this.labelCond.text=this.data.lockLabel;this.lock.visible=true;break}};return ArtifactItemRenderer}(BaseItemRender);__reflect(ArtifactItemRenderer.prototype,"ArtifactItemRenderer");var ArtifactItemData=function(){function ArtifactItemData(){}return ArtifactItemData}();__reflect(ArtifactItemData.prototype,"ArtifactItemData");var ArtifactItemState;(function(ArtifactItemState){ArtifactItemState[ArtifactItemState["activatable"]=0]="activatable";ArtifactItemState[ArtifactItemState["activated"]=1]="activated";ArtifactItemState[ArtifactItemState["unActivated"]=2]="unActivated"})(ArtifactItemState||(ArtifactItemState={}));window["ArtifactItemState"]=ArtifactItemState;var NewArtifactWin=function(_super){__extends(NewArtifactWin,_super);function NewArtifactWin(){var _this=_super.call(this)||this;_this.nextUpdateGuideTips=false;_this.isTopLevel=true;_this.arrImage=[];_this.name=i18n("NewArtifactWin_0");return _this}NewArtifactWin.prototype.childrenCreated=function(){this.mc=new MovieClip;this.groupEff.addChild(this.mc);this.mc.x=0;this.mc.y=0;this.mc.playFile(RES_DIR_EFF+"artifacteff",-1);this.list.itemRenderer=ArtifactAttrDescItem;this.turnicon.textFlow=(new egret.HtmlTextParser).parser(i18n("NewArtifactWin_1"));this.eff=new MovieClip;this.eff.x=78;this.eff.y=30;this.eff.scaleX=1;this.eff.scaleY=1;this.eff.touchEnabled=false};NewArtifactWin.prototype.open=function(){this.index=1;this.addTouchEvent(this.imgLeft,this.onTap);this.addTouchEvent(this.imgRight,this.onTap);this.addTouchEvent(this.btnOpen,this.onTap);this.addTouchEvent(this.detail,this.onTap);this.addTouchEvent(this.turnicon,this.onTap);for(var i=0;i<8;i++){var item=this.itemWin["item"+(i+1)];this.addTouchEvent(item.btn,this.onLink)}this.observe(Artifact.ins().postNewArtifactUpdate,this.updateView);this.observe(Artifact.ins().postNewArtifactInit,this.updateView);this.getGuideTips();this.updateView()};NewArtifactWin.prototype.close=function(){DisplayUtils.removeFromParent(this.eff);ViewManager.ins().close(ArtifactChipOpenWin)};NewArtifactWin.prototype.onTap=function(e){this.isBtnOpen=false;switch(e.target){case this.imgLeft:if(this.index==1)break;else this.index--;this.updateView();break;case this.imgRight:if(this.index<Artifact.ins().getMaxIndex()){if(this.getIsNext())this.index++}this.updateView();break;case this.btnOpen:this.isBtnOpen=true;Artifact.ins().openArtifact(this.index);this.nextUpdateGuideTips=true;break;case this.detail:ViewManager.ins().open(ArtifactAllAttrWin);break;case this.turnicon:var conf=GlobalConfig.ImbaConf[this.index];if(conf&&conf.winGuide){GameGuider.guidance(conf.winGuide[0],conf.winGuide[1]);if(conf.winGuide[0]!="LiLianWin")ViewManager.ins().close(LiLianWin)}break;default:break}};NewArtifactWin.prototype.getIsNext=function(){if(this.index==1)return true;var pidx=this.index-1;var cafd=Artifact.ins().getNewArtifactBy(pidx);if(!cafd.open)return false;return true};NewArtifactWin.prototype.setMcArtfact=function(mcName,isGray){if(isGray===void 0){isGray=false}if(!this.mcArtfact){this.mcArtfact=new MovieClip;this.mcArtfactGroup.addChild(this.mcArtfact)}this.mcArtfact.playFile(RES_DIR_SQ+mcName,-1);if(isGray){var filter=FilterUtil.ARRAY_GRAY_FILTER;this.mcArtfact.filters=filter}else{this.mcArtfact.filters=null}};NewArtifactWin.prototype.updateView=function(){var conf=GlobalConfig.ImbaConf[this.index];var data=Artifact.ins().getNewArtifactBy(this.index);if(data.open&&this.isBtnOpen){var arr=conf.img.split("_");var img=arr[0]+"_"+arr[1];var mc=conf.mc;RewardWin.showAct(0,conf.name,"",true,function(){if(conf.winGuide){ViewManager.ins().open(conf.winGuide[0],conf.winGuide[1]);if(conf.winGuide[0]!="LiLianWin")ViewManager.ins().close(LiLianWin)}},"","","",mc,"",RES_DIR_SQ)}if(this.nextUpdateGuideTips){this.nextUpdateGuideTips=false;this.getGuideTips()}var confNext=GlobalConfig.ImbaConf[this.index];data=Artifact.ins().getNewArtifactBy(this.index);if(data&&data.open&&confNext.turnDesc){this.turnicon.visible=true;this.turnicon.textFlow=(new egret.HtmlTextParser).parser("<u>"+confNext.turnDesc+"</u>")}else{this.turnicon.visible=false}this.imgOpen.visible=!data.open;if(!this.getGuideMaterialId(this.index)){if(data.open){this.setMcArtfact(confNext.mc);this.groupEff.visible=true;this.currentState="normal";DisplayUtils.removeFromParent(this.eff)}else{this.setMcArtfact(confNext.mc,true);this.groupEff.visible=false;this.currentState="open";this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.eff.parent)this.actGroup.addChild(this.eff)}}else{this.setMcArtfact(confNext.mc,true);this.groupEff.visible=false;this.currentState="normal";DisplayUtils.removeFromParent(this.eff)}this.imgName.source=confNext.imgName;var attstr="";var num=0;for(var key in confNext.attrs){num++}if(confNext.attrs)attstr=AttributeData.getAttStr(confNext.attrs,1);if(confNext.exattrs!=null){for(var key in confNext.exattrs){attstr+="\n";attstr+=AttributeData.getExtAttStrByType(confNext.exattrs[key],1);num++}}this.labelAttr.text=confNext.funcDesc;this.imgFunc.source=confNext.simpleDesc;var array=[];var artData=Artifact.ins().getNewArtifactBy(this.index);var len=0;for(var i=0;i<8;i++){var color=void 0;var state=artData.record>>i&1;var state2=artData.exitRecord>>i&1&&state==0;var mId=confNext.jigsawId[i];var s=ArtifactItemState.unActivated;s=state2?ArtifactItemState.activatable:s;s=state?ArtifactItemState.activated:s;var obj={};obj["state"]=s;obj["mc"]=RES_DIR_EFF+"feishengfire";if(mId){obj["lockLabel"]=GlobalConfig.ImbaJigsawConf[mId].guide;obj["mId"]=mId;obj["point"]=GlobalConfig.ImbaJigsawConf[mId].point;array.push(obj)}}array.sort(this.sortFunc);this.itemWin.setData(array);this.powerPanel.setPower(Artifact.ins().getNewArtifactPower(this.index));this.imgLeft.visible=this.index!=1;this.imgRight.visible=this.index<Artifact.ins().getMaxIndex()&&this.getIsNext()};NewArtifactWin.prototype.sortFunc=function(a,b){var asid=a.point;var bsid=b.point;if(asid>bsid)return 1;if(asid<bsid)return-1;return 0};NewArtifactWin.prototype.getGuideTips=function(){var maxIndex=Artifact.ins().getMaxIndex();for(var i=1;i<=maxIndex;i++){var data=Artifact.ins().getNewArtifactBy(i);var mId=this.getGuideMaterialId(i);this.index=i;if(!data.open){break}}};NewArtifactWin.prototype.getGuideMaterialId=function(index){var conf=GlobalConfig.ImbaConf[index];var data=Artifact.ins().getNewArtifactBy(index);var id=0;for(var i=0;i<conf.jigsawId.length;i++){var e=data.record>>i&1;if(e!=1){id=conf.jigsawId[i];break}}return id};NewArtifactWin.prototype.openTips=function(mId){var artData=Artifact.ins().getNewArtifactBy(this.index);var conf=GlobalConfig.ImbaConf[this.index];var itemConf=GlobalConfig.ImbaJigsawConf[mId];var index=conf.jigsawId.indexOf(mId);var state=artData.record>>index&1;var state2=artData.exitRecord>>index&1&&!state;this.parttips.visible=false;if(state2)ViewManager.ins().open(ArtifactChipOpenWin,mId,this.index);else{ViewManager.ins().open(shenqispTipsWin,mId,this.index)}};NewArtifactWin.prototype.onLink=function(e){for(var i=0;i<8;i++){var item=this.itemWin["item"+(i+1)];if(e.target==item.btn){this.openTips(item.data.mId);break}}};return NewArtifactWin}(BaseEuiView);__reflect(NewArtifactWin.prototype,"NewArtifactWin");ViewManager.ins().reg(NewArtifactWin,LayerManager.UI_Main);var ShenqiSelectItemWin=function(_super){__extends(ShenqiSelectItemWin,_super);function ShenqiSelectItemWin(){return _super.call(this)||this}ShenqiSelectItemWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};ShenqiSelectItemWin.prototype.setData=function(data){this.data=data;for(var i=0;i<data.length;i++){this["item"+(i+1)].data=data[i];this["item"+(i+1)].dataChanged()}var len=data.length;this.currentState=len.toString()};return ShenqiSelectItemWin}(BaseView);__reflect(ShenqiSelectItemWin.prototype,"ShenqiSelectItemWin");var shenqispTipsWin=function(_super){__extends(shenqispTipsWin,_super);function shenqispTipsWin(){var _this=_super.call(this)||this;_this.skinName="shenqispTip";_this.isTopLevel=true;return _this}shenqispTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var mId=param[0];var index=param[1];this.list.itemRenderer=ArtifactAttrDescItem;this.addTouchEvent(this.rect,this.onTap);this.setData(mId,index)};shenqispTipsWin.prototype.setData=function(mId,ix){var itemConf=GlobalConfig.ImbaJigsawConf[mId];var conf=GlobalConfig.ImbaJigsawConf[mId];this.partname.text=conf.name;this.getway.text=conf.guide;this.icon.source=conf.img;var data=Artifact.ins().getNewArtifactBy(ix);this.list.dataProvider=new eui.ArrayCollection(itemConf.attrs);var index=mId%10-1;var state=data.record>>index&1;var str="";var power=UserBag.getAttrPower(itemConf.attrs);this.powerPanel.setPower(power);if(state)str=i18n("shenqispTipsWin_0");else str=i18n("shenqispTipsWin_1")};shenqispTipsWin.prototype.onTap=function(e){switch(e.target){case this.rect:ViewManager.ins().close(this);break}};shenqispTipsWin.prototype.dataChanged=function(){};return shenqispTipsWin}(BaseEuiView);__reflect(shenqispTipsWin.prototype,"shenqispTipsWin");ViewManager.ins().reg(shenqispTipsWin,LayerManager.UI_Popup);var TargetWin=function(_super){__extends(TargetWin,_super);function TargetWin(){var _this=_super.call(this)||this;_this.skinName="targetSkin";return _this}TargetWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.taskTip.visible=false;this.isTopLevel=true};TargetWin.prototype.destoryView=function(){_super.prototype.destoryView.call(this)};TargetWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();this.removeTouchEvent(this,this.onTouch);this.removeTouchEvent(this.bgClose,this.onTouch);this.removeTouchEvent(this.button,this.onTouch);this.removeTouchEvent(this.btn2,this.onTouch);TimerManager.ins().removeAll(this)};TargetWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.button,this.onTouch);this.addTouchEvent(this.btn2,this.onTouch);this.observe(UserFb.ins().postAddEnergy,this.upDataGuanqia);if(param[0]==TargetWin.SEHNQI){this.guanqia.visible=true;this.quest.visible=false;this.index=this.getShenQiId()}else{this.guanqia.visible=false;this.quest.visible=true;this.HejiSkillMc1=new MovieClip;this.HejiSkillMc1.x=this.roleimg.x+this.roleimg.width/2+73;this.HejiSkillMc1.y=this.roleimg.y+this.roleimg.height/2+70+73;this.quest.addChild(this.HejiSkillMc1);this.HejiSkillMc2=new MovieClip;this.HejiSkillMc2.x=this.enenyimg.x+this.enenyimg.width/2+80;this.HejiSkillMc2.y=this.enenyimg.y+this.enenyimg.height/2+167;this.quest.addChild(this.HejiSkillMc2)}this["show"+param[0]]()};TargetWin.prototype.show2=function(){var role=SubRoles.ins().getSubRoleByIndex(0);var cur=this.getTaskSum();var totovalue=TargetWin.TASKID%100;this.skillName.source="8000"+role.job+"_png";this.questNumber.text=TargetWin.TASKID%100-cur+1+"";this.mcSkillID="skill40"+role.job;this.targetSkillID="skill"+(403+role.job);var bvalue=0;cur=cur>0?cur:0;var calc=(cur-1)/totovalue;calc=calc<=0?0:calc;calc=calc>=1?1:calc;bvalue=Math.floor(calc*100);this.bar2.value=cur-1;this.bar2.maximum=totovalue;this.bar2.labelFunction=function(){return bvalue+"%"};TimerManager.ins().remove(this.playSkillAnmi,this);TimerManager.ins().doTimer(3e3,0,this.playSkillAnmi,this);this.playSkillAnmi()};TargetWin.prototype.getTaskSum=function(){if(UserTask.ins().taskTrace.id>=TargetWin.TASKID)return 0;for(var i in GlobalConfig.AchievementTaskConfig){if(UserTask.ins().taskTrace.id==GlobalConfig.AchievementTaskConfig[i].taskId){var idx=GlobalConfig.AchievementTaskConfig[i].index;return idx>0?idx:0}}return 0};TargetWin.prototype.setMcArtfact=function(mcName,isGray){if(isGray===void 0){isGray=false}if(!this.mcArtfact){this.mcArtfact=new MovieClip;this.mcArtfactGroup.addChild(this.mcArtfact)}this.mcArtfact.playFile(RES_DIR_SQ+mcName,-1);if(isGray){var filter=FilterUtil.ARRAY_GRAY_FILTER;this.mcArtfact.filters=filter}else{this.mcArtfact.filters=null}};TargetWin.prototype.show1=function(){var config=GlobalConfig.ImbaConf[this.index];if(!config)return;var rd=UserFb.ins().getNextReward();if(!rd)return;var wrconfig=UserFb.ins().getNewChapter();if(!wrconfig)return;var chip=this.getChipNum(config);var MaxGK=UserFb.ins().getDiffChapter();var newPassGK=wrconfig.needLevel;var itemconfig=GlobalConfig.ItemConfig[rd[0].id];this.setMcArtfact(config.mc,false);this.itemImg.source=itemconfig.icon+"_png";this.artifactname.text=config.name;this.number1.text=chip+"";this.des1a1.text=config.funcDesc;this.guanqiaDes2.text=UserFb.ins().getNextNeedChapter()+"";this.artifactName1.text=itemconfig.name;var bvalue=0;var cur=UserFb.ins().guanqiaID-newPassGK-1;cur=cur>0?cur:0;var calc=cur/MaxGK;calc=calc>=1?1:calc;bvalue=Math.floor(calc*100);this.bar1.value=cur;this.bar1.maximum=MaxGK;this.bar1.labelFunction=function(){return bvalue+"%"};this.prossX=0;var p=this.btnbar.localToGlobal();this.btnbar.parent.globalToLocal(p.x,p.y,p);this.masksp=new egret.Sprite;var square=new egret.Shape;square.graphics.beginFill(16777215);square.graphics.drawRect(p.x,p.y,this.btnbar.width,this.btnbar.height);square.graphics.endFill();this.prossX=p.x-this.btnbar.width;this.masksp.y=p.y;this.masksp.addChild(square);this.btnbar.parent.addChild(this.masksp);this.btnbar.mask=this.masksp;this.upDataGuanqia()};TargetWin.prototype.upDataGuanqia=function(){if(this.masksp){var value=UserFb.ins().currentEnergy;var total=UserFb.ins().energy;var persent=(value-1)/total;persent=persent>=1?1:persent;this.masksp.x=this.prossX+Math.abs(this.prossX)*persent}};TargetWin.prototype.getChipNum=function(config){var chip=0;for(var i=0;i<config.jigsawId.length;i++){for(var k in GlobalConfig.WorldRewardConfig){var wrconfig=GlobalConfig.WorldRewardConfig[k];if(wrconfig.rewards[0].id==config.jigsawId[i]){if(wrconfig.needLevel>=UserFb.ins().guanqiaID)chip++;break}}}return chip};TargetWin.prototype.getShenQiId=function(){var maxIndex=Artifact.ins().getMaxIndex();var index=1;for(var i=1;i<=maxIndex;i++){var data=Artifact.ins().getNewArtifactBy(i);for(var j in GlobalConfig.ImbaConf){if(GlobalConfig.ImbaConf[j].id==data.id){var chipId=UserFb.ins().getChipByGuanQia();if(GlobalConfig.ImbaConf[j].jigsawId.indexOf(chipId)!=-1){index=GlobalConfig.ImbaConf[j].index;return index}}}}return index};TargetWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.bgClose:case this.btn2:ViewManager.ins().close(this);break;case this.button:if(UserFb.ins().currentEnergy>=UserFb.ins().energy){var self_6=this;GameGuider.challengeBoss(function(){ViewManager.ins().close(self_6)})}else{this.showTaskTips(i18n("TargetWin_0"))}break}};TargetWin.prototype.showTaskTips=function(text){var tips=this.taskTip;this.taskTipText0.textFlow=TextFlowMaker.generateTextFlow1(text);egret.Tween.removeTweens(tips);tips.bottom=70;tips.visible=true;egret.Tween.get(tips).to({bottom:100},500).wait(2e3).call(function(){tips.visible=false})};TargetWin.prototype.playSkillAnmi=function(){var _this=this;egret.Tween.removeTweens(this.roleimg);var t=egret.Tween.get(this.roleimg);if(!this.HejiSkillMc1.parent)this.quest.addChild(this.HejiSkillMc1);this.HejiSkillMc1.playFile(""+RES_DIR_SKILLEFF+this.mcSkillID,1,null,true);t.wait(1500).call(function(){if(!_this.HejiSkillMc2.parent)_this.quest.addChild(_this.HejiSkillMc2);_this.HejiSkillMc2.playFile(""+RES_DIR_SKILLEFF+_this.targetSkillID,1,null,true)},this)};TargetWin.SEHNQI=1;TargetWin.HEJI=2;TargetWin.TASKID=100026;return TargetWin}(BaseEuiView);__reflect(TargetWin.prototype,"TargetWin");ViewManager.ins().reg(TargetWin,LayerManager.UI_Popup);var GameSocket=function(){function GameSocket(){this._socketStatus=0;this._lastReceiveTime=0;this.pid=0;this.PACK_HANDLER=[];this._serverId=0;this._user="";this._pwd="";this.svrHeartbeatGot=false;this.firstConnect=true;this.lastPos=-1;this.hasShowReLoginWin=false;this.disconnectTime=0;this.reconnCount=0;this.packetSizes={};if(!window["connectError"]){window["connectError"]=function(e){ViewManager.ins().close(LoginFailedWin,e);TimerManager.ins().doNext(function(){ViewManager.ins().open(LoginFailedWin,e)},this)}}egret.startTick(this.update,this);this.newSocket();this.recvPack=new GameByteArray;this._packets=[]}GameSocket.ins=function(){if(!GameSocket._ins){GameSocket._ins=new GameSocket}return GameSocket._ins};GameSocket.prototype.getSocket=function(){return this.socket_};GameSocket.prototype.newSocket=function(){if(this.socket_){this.removeEvent()}this.socket_=new egret.WebSocket;this.socket_.type=egret.WebSocket.TYPE_BINARY;this.socket_.addEventListener(egret.Event.CONNECT,this.onSocketConnected,this);this.socket_.addEventListener(egret.Event.CLOSE,this.onSocketClose,this);this.socket_.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketRead,this);this.socket_.addEventListener(egret.IOErrorEvent.IO_ERROR,this.connectError,this)};GameSocket.prototype.removeEvent=function(){if(this.socket_){this.socket_.removeEventListener(egret.Event.CONNECT,this.onSocketConnected,this);this.socket_.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this);this.socket_.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketRead,this);this.socket_.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.connectError,this)}};GameSocket.prototype.sendToServer=function(bytes){this.send(bytes);bytes.position=12;this.recycleByte(bytes)};GameSocket.prototype.connectError=function(){var p=[];for(var _i=0;_i<arguments.length;_i++){p[_i]=arguments[_i]}this.removeEvent();if(this.socket_!=null){this.socket_.close()}this.socket_=null;if(!this.firstConnect){this.onSocketClose(null)}else{window["connectError"]()}};GameSocket.prototype.checkConnnected=function(){if(this._socketStatus==GameSocket.STATUS_CONNECTING){console.log("connect timeout!");this.connectError()}};GameSocket.prototype.connect=function(host,port,timeout){if(timeout===void 0){timeout=undefined}if(timeout==undefined){timeout=3e4}this.updateStatus(GameSocket.STATUS_CONNECTING);TimerManager.ins().doTimer(timeout,1,this.checkConnnected,this);this._host=host;this._port=port;var url=location.protocol;if(url==null){url=LocationProperty.resAdd}if(url.indexOf("https:")!=-1){this.socket_.connectByUrl("wss://"+host+":"+port)}else{if(host&&(host.indexOf("lkgame")!=-1||host.indexOf(".com")!=-1)){this.socket_.connectByUrl("wss://"+host+":"+port)}else{this.socket_.connect(host,port)}}};GameSocket.prototype.close=function(){if(!this.socket_)return;this.socket_.close()};GameSocket.prototype.send=function(message){if(this._socketStatus==GameSocket.STATUS_COMMUNICATION){this.sendPack(message);return true}else{console.log(i18n("GameSocket_1"));return false}};GameSocket.prototype.onSocketConnected=function(e){LoadingTimeoutMgr.ins().endStep(LoadingTimeoutMgr.STEPID_ENTER_GAME);LoadingTimeoutMgr.ins().beginStep(LoadingTimeoutMgr.STEPID_GET_ROLES_LIST);this.firstConnect=false;console.log("Socket connected！ip:"+this._host+" port:"+this._port);TimerManager.ins().remove(this.reLogin,this);this.updateStatus(GameSocket.STATUS_CHECKING);var selfSalt=Encrypt.getSelfSalt();console.log(i18n("GameSocket_2"),selfSalt);var bytes=new GameByteArray;bytes.writeUnsignedInt(selfSalt);this.socket_.writeBytes(bytes);this.socket_.flush();if(this._onConnected){this._onConnected()}ViewManager.ins().close(LoginFailedWin)};GameSocket.prototype.onSocketRead=function(e){if(this.lastPos!=-1){for(var i=0;i<=this.lastPos;i++){this.recycleByte(this._packets[i])}this._packets.splice(0,this.lastPos+1);this.lastPos=-1}if(this._socketStatus<GameSocket.STATUS_COMMUNICATION){this.sendKeyToServer();return}var bytesCache=new GameByteArray;this._lastReceiveTime=egret.getTimer();this.socket_.readBytes(bytesCache,bytesCache.length);var tag=bytesCache.readUnsignedShort();if(tag!=GameSocket.DEFAULT_TAG)return;var buffLen=bytesCache.readUnsignedShort();bytesCache.position+=4;this._packets.push(bytesCache)};GameSocket.prototype.update=function(time){for(var _i=0,_a=this._packets;_i<_a.length;_i++){var pack=_a[_i];this.lastPos++;this.processRecvPacket(pack);this.recycleByte(pack)}this._packets.length=0;this.lastPos=-1;return false};GameSocket.prototype.sendKeyToServer=function(){var pack=new GameByteArray;this.socket_.readBytes(pack);pack.position=0;var salt=pack.readUnsignedInt();Encrypt.setTargetSalt(salt);var key=Encrypt.getCheckKey();console.log(i18n("GameSocket_3"),key);pack.position=0;pack.writeShort(key);this.socket_.writeBytes(pack,0,2);this.updateStatus(GameSocket.STATUS_COMMUNICATION)};GameSocket.prototype.onSocketClose=function(e){console.log(i18n("GameSocket_4")+this._host+" port:"+this._port);if(RoleAI.ins().inStoryMode){NewStoryMgr.ins().stopCurStory()}this.updateStatus(GameSocket.STATUS_DISCONNECT);this.removeEvent();this.socket_=null;LoginMgr.ins().stopAntiAddictionTimer();TimerManager.ins().remove(this.reLogin,this);KFServerSys.ins().closeSocket();GameLogic.ins().stopHeartbeatCheck();this.startReconnect()};GameSocket.prototype.heartbeatFailedReconn=function(){this.onSocketClose(null)};GameSocket.prototype.startReconnect=function(){if(RoleMgr.ins().dontReconnect){return}var reconnTimes=[100,1e3,3e3,6e3];if(this.reconnCount>=reconnTimes.length){this.showReLoginWin()}else{if(this._onClosed){this._onClosed()}TimerManager.ins().remove(this.reLogin,this);var reconnTime=reconnTimes[this.reconnCount];TimerManager.ins().doTimer(reconnTime,1,this.reLogin,this);++this.reconnCount}};GameSocket.prototype.showReLoginWin=function(){var _this=this;this.reconnCount=0;if(this.hasShowReLoginWin&&ViewManager.ins().isShow(WarnWin))return;this.hasShowReLoginWin=true;this.disconnectTime=egret.getTimer();var func=function(){_this.hasShowReLoginWin=false;if(_this._onClosed){_this._onClosed()}TimerManager.ins().remove(_this.reLogin,_this);if(RoleAI.ins().inStoryMode){NewStoryMgr.ins().stopCurStory()}if(egret.getTimer()-_this.disconnectTime>=6e3){_this.reLogin()}else{TimerManager.ins().doTimer(6e3-(egret.getTimer()-_this.disconnectTime),1,_this.reLogin,_this)}};if(!RoleMgr.ins().dontReconnect){WarnWin.show(i18n("GameSocket_5"),func,this,func,this,"sure")}};GameSocket.prototype.reLogin=function(){var _this=this;this.close();ChannelMgr.ins().channelReLoad();var loadGame=function(){_this.newSocket();RoleMgr.ins().connectServer()};if(!window["getClientVersion"]||LocationProperty.isLocation){loadGame();return}if(window["getClientVersion"]){window["getClientVersion"](function(ver){var v=parseInt(ver)||0;if(v===LocationProperty.v||v===0){loadGame()}else{ChannelMgr.ins().reload()}})}};GameSocket.prototype.updateStatus=function(status){if(this._socketStatus!=status){var old=this._socketStatus;this._socketStatus=status;this.onFinishCheck(status,old)}};GameSocket.prototype.onFinishCheck=function(newStatus,oldStatus){if(newStatus==GameSocket.STATUS_COMMUNICATION){console.log(i18n("GameSocket_6")+this._host+" port:"+this._port);if(KFServerSys.ins().isKF){KFServerSys.ins().sendKFLogin()}else{this.sendCheckAccount(this._user,this._pwd)}}else if(newStatus==GameSocket.STATUS_DISCONNECT){}};Object.defineProperty(GameSocket.prototype,"host",{get:function(){return this._host},enumerable:true,configurable:true});Object.defineProperty(GameSocket.prototype,"port",{get:function(){return this._port},enumerable:true,configurable:true});GameSocket.prototype.sendCheckAccount=function(user,pwd){console.log(i18n("GameSocket_7"),this._serverId,user,pwd);var bytes=this.getBytes();bytes.writeCmd(255,1);bytes.writeInt(this._serverId);bytes.writeString(user);bytes.writeString(pwd);this.sendToServer(bytes)};GameSocket.prototype.login=function(user,pwd,serverID,ip,port){this._user=user;this._pwd=pwd;this._serverId=serverID;if(ip.split(":")[1]&&ip.split(":")[1].length)port=parseInt(ip.split(":")[1]);if(!this.socket_.connected){console.log("connect to "+ip+" ,port: "+port);this.connect(ip,port)}else{this.sendCheckAccount(user,pwd)}};GameSocket.prototype.processRecvPacket=function(packet){var sysId=packet.readUnsignedByte();var msgId=packet.readUnsignedByte();this.dispatch(sysId,msgId,packet);this.onSvrHeartbeat()};GameSocket.prototype.showPacketSizes=function(){var totalSize=0;var packetSizes=this.packetSizes;var sizesArr=[];for(var k in packetSizes){var v=packetSizes[k];totalSize+=v;sizesArr.push([k,v])}console.log("游戏服务器总流量 = "+totalSize);sizesArr.sort(function(a,b){return b[1]-a[1]});for(var i=0,c=Math.min(10,sizesArr.length);i<c;++i){console.log(""+(i+1)+". "+sizesArr[i][0]+"消息流量 = "+sizesArr[i][1])}};GameSocket.prototype.dispatch=function(sysId,msgId,byte){if(!this.PACK_HANDLER[sysId]||!this.PACK_HANDLER[sysId][msgId]){return}var arr=this.PACK_HANDLER[sysId][msgId];LoadingTimeoutMgr.ins().pushRecentNetId(sysId,msgId);arr[0].call(arr[1],byte)};GameSocket.prototype.recycleByte=function(byte){ObjectPool.push(byte)};GameSocket.prototype.getBytes=function(){var pack=ObjectPool.pop(GameSocket.CLASSNAME);pack.clear();pack.writeShort(GameSocket.DEFAULT_TAG);pack.writeShort(0);pack.writeShort(0);pack.writeShort(GameSocket.DEFAULT_CRC_KEY);pack.writeUnsignedInt(this.pid++);return pack};GameSocket.prototype.registerSTCFunc=function(sysId,msgId,fun,sysClass){if(!this.PACK_HANDLER[sysId]){this.PACK_HANDLER[sysId]=[]}else if(this.PACK_HANDLER[sysId][msgId]){console.error(i18n("GameSocket_9",sysId,msgId));return}this.PACK_HANDLER[sysId][msgId]=[fun,sysClass]};GameSocket.prototype.setOnClose=function(ex,obj){this._onClosed=ex.bind(obj)};GameSocket.prototype.setOnConnected=function(ex,obj){this._onConnected=ex.bind(obj)};GameSocket.prototype.sendPack=function(pack){if(pack==null||pack.length==0){throw new egret.error(i18n("GameSocket_10"))}var headsize=GameSocket.HEAD_SIZE;pack.position=2;pack.writeShort(pack.length-headsize);var msgCK=Encrypt.getCRC16ByPos(pack,headsize);pack.position=4;pack.writeShort(msgCK);var headerCRC=Encrypt.getCRC16(pack,headsize);pack.position=6;pack.writeShort(headerCRC);Encrypt.encode(pack,4,4);this.socket_.writeBytes(pack)};GameSocket.prototype.onSvrHeartbeat=function(){this.svrHeartbeatGot=true};GameSocket.DEFAULT_TAG=52462;GameSocket.DEFAULT_CRC_KEY=30301;GameSocket.HEAD_SIZE=8;GameSocket.STATUS_CONNECTING=1;GameSocket.STATUS_CHECKING=2;GameSocket.STATUS_COMMUNICATION=3;GameSocket.STATUS_DISCONNECT=4;GameSocket.CLASSNAME=egret.getQualifiedClassName(GameByteArray);return GameSocket}();__reflect(GameSocket.prototype,"GameSocket");var AuctionItemRender=function(_super){__extends(AuctionItemRender,_super);function AuctionItemRender(){var _this=_super.call(this)||this;_this.STATE_SHOW=0;_this.STATE_AUCTION=1;_this.STATE_END=2;_this.state=0;_this.leftTime=0;return _this}AuctionItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};AuctionItemRender.prototype.dataChanged=function(){var vo=this.data;var cfg=GlobalConfig.AuctionItem[vo.aID];if(!cfg)return;this.item.data=cfg.item;this.price=cfg.buy;this.price2=cfg.bid+Math.floor(cfg.bid*vo.auctionTimes*GlobalConfig.AuctionConfig.priceIncrease/1e4);this.btn1.visible=cfg.buy>0;this.zb0.text=this.price+"";this.jingjia.text=this.price2+"";this.labelMy.visible=vo.owner>0;this.labelMy.source=vo.owner?vo.owner==1?"labelMy":"labelGuild":"";this.zb1.text=cfg.bid+Math.floor(cfg.bid*(vo.auctionTimes>0?vo.auctionTimes-1:0)*GlobalConfig.AuctionConfig.priceIncrease/1e4)+"";if(!this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE))this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this);if(!this.hasEventListener(egret.TouchEvent.TOUCH_TAP))this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this.checkTime();if(this.openedWard)this.showWarn()};AuctionItemRender.prototype.showWarn=function(){var price=this.isYiKouJia?this.price:this.price2;var vo=this.data;var actStr="";if(this.isYiKouJia){actStr=vo.myAuPrice?i18n("AuctionItemRender_10",price,""):i18n("AuctionItemRender_1",price,"")}else{actStr=vo.myAuPrice?i18n("AuctionItemRender_2",price,""):i18n("AuctionItemRender_0",price,"")}WarnWin.show(actStr,this.onAuction.bind(this),this,this.onAuction2.bind(this),this)};AuctionItemRender.prototype.checkTime=function(){TimerManager.ins().removeAll(this);var vo=this.data;var endTime=DateUtils.formatMiniDateTime(vo.endTime);var serverTime=GameServer.serverTime;var putAwayTime=DateUtils.formatMiniDateTime(vo.putAwayTime);this.leftTime=0;this.showTime.textColor=15937822;if(serverTime>=endTime){this.state=this.STATE_END;this.showTime.text="00:00:00";Auction.ins().deleteVo(vo);Auction.ins().postUpdate()}else if(Math.floor((serverTime-putAwayTime)/1e3)<(vo.type?GlobalConfig.AuctionConfig.globalShowTime:GlobalConfig.AuctionConfig.guildShowTime)){this.state=this.STATE_SHOW;this.showTime.textColor=14502316;this.leftTime=(vo.type?GlobalConfig.AuctionConfig.globalShowTime:GlobalConfig.AuctionConfig.guildShowTime)-Math.floor((serverTime-putAwayTime)/1e3)}else{this.state=this.STATE_AUCTION;this.showTime.textColor=242004;this.leftTime=Math.floor((endTime-serverTime)/1e3)}if(this.leftTime){this.repeat();TimerManager.ins().doTimer(1e3,0,this.repeat,this)}this.jingjiazhong.visible=vo.auctionTimes>0;this.jingjiazhong.textFlow=TextFlowMaker.generateTextFlow("|C:"+(vo.myAuPrice?14502316:242004)+"&T:"+(vo.myAuPrice?"我的竞价":"竞价中"))};AuctionItemRender.prototype.repeat=function(){this.showTime.text=DateUtils.getFormatBySecond(this.leftTime,DateUtils.TIME_FORMAT_12)+(this.state==this.STATE_SHOW?i18n("AuctionItemRender_3"):i18n("AuctionItemRender_4"));if(this.state==this.STATE_AUCTION&&this.leftTime<=GlobalConfig.AuctionConfig.rushTime&&this.showTime.textColor!=15937822)this.showTime.textColor=15937822;if(this.leftTime<=0){this.checkTime();return}this.leftTime--};AuctionItemRender.prototype.onRemove=function(){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this);this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);TimerManager.ins().removeAll(this);this.openedWard=false};AuctionItemRender.prototype.onTouch=function(e){switch(e.target){case this.yikoujia:case this.yikoujia0:if(this.state==this.STATE_END){UserTips.ins().showTips(i18n("AuctionItemRender_5"));return}else if(this.state==this.STATE_SHOW){UserTips.ins().showTips(i18n("AuctionItemRender_6"));return}this.openedWard=true;this.isYiKouJia=e.target==this.yikoujia;this.showWarn();break}};AuctionItemRender.prototype.onAuction=function(){this.openedWard=false;if(Actor.yb<(this.isYiKouJia?this.price:this.price2)){this.noMoney();return}var vo=this.data;if(this.isYiKouJia)Auction.ins().sendBuy(vo.id,vo.type);else Auction.ins().sendAUction(vo.id,vo.type,vo.auctionTimes+1)};AuctionItemRender.prototype.noMoney=function(){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("AuctionItemRender_7"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("AuctionItemRender_8"))};AuctionItemRender.prototype.onAuction2=function(){this.openedWard=false};__decorate([callDelay(150)],AuctionItemRender.prototype,"noMoney",null);return AuctionItemRender}(BaseItemRender);__reflect(AuctionItemRender.prototype,"AuctionItemRender");var AuctionRecordItemRender=function(_super){__extends(AuctionRecordItemRender,_super);function AuctionRecordItemRender(){return _super.call(this)||this}AuctionRecordItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};AuctionRecordItemRender.prototype.dataChanged=function(){var vo=this.data;var cfg=GlobalConfig.AuctionItem[vo.aId];this.item.data=cfg.item;this.playerName.text=vo.roleName;this.price.text=vo.price+"";this.successTime.text=DateUtils.getFormatBySecond(Math.floor(DateUtils.formatMiniDateTime(vo.time)/1e3),DateUtils.TIME_FORMAT_15);this.text1.text=vo.state?vo.state==1?i18n("AuctionRecordItemRender_0"):i18n("AuctionRecordItemRender_1"):vo.type==0?i18n("AuctionRecordItemRender_2"):i18n("AuctionRecordItemRender_3")};return AuctionRecordItemRender}(BaseItemRender);__reflect(AuctionRecordItemRender.prototype,"AuctionRecordItemRender");var AuctionBonus=function(_super){__extends(AuctionBonus,_super);function AuctionBonus(){return _super.call(this)||this}AuctionBonus.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};AuctionBonus.prototype.opencheck=function(){var today=new Date(GameServer.serverTime).getDay()+1;for(var i=1;i<=Auction.ins().total;i++){if(this["item"+i].parent){this.itemP.removeChild(this["item"+i])}}for(var i=1;i<=Auction.ins().total;i++){var cfg=GlobalConfig.BonusConfig[i];var showday=cfg.showday;if(showday.indexOf(today)>-1&&cfg.isOpen==1){this.itemP.addChild(this["item"+i])}}this.num.text=Auction.ins().bonusGot.toString()};AuctionBonus.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=1;i<=Auction.ins().total;i++){this["item"+i].setData(i);this["item"+i].open()}this.observe(GameServer.ins().postServerOpenDay,this.opencheck);this.observe(Auction.ins().postBonusResult,this.opencheck);this.opencheck()};AuctionBonus.prototype.close=function(){};return AuctionBonus}(BaseEuiView);__reflect(AuctionBonus.prototype,"AuctionBonus");var AuctionBonusItem=function(_super){__extends(AuctionBonusItem,_super);function AuctionBonusItem(){var _this=_super.call(this)||this;_this.fid=1;_this.state=0;return _this}AuctionBonusItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};AuctionBonusItem.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.onTouch);this.observe(Auction.ins().postListData,this.update);this.observe(Auction.ins().postBonusResult,this.update);this.observe(UserBoss.ins().postNewBossOpen,this.update);this.observe(GameServer.ins().postServerOpenDay,this.update);this.observe(Actor.ins().postLevelChange,this.update);this.observe(UserFb.ins().postGuanKaIdChange,this.update);this.observe(BattleCC.ins().postOpenInfo,this.update);this.observe(PaoDianCC.ins().postOpenInfo,this.update);this.observe(GuildWar.ins().postGuildWarStarInfo,this.update);this.update()};AuctionBonusItem.prototype.close=function(){TimerManager.ins().removeAll(this)};AuctionBonusItem.prototype.update=function(){switch(this.fid){case AuctionBonusType.NewWorldBoss:this.updateNewWorld();break;case AuctionBonusType.CampBattle:this.updateCampBattle();break;case AuctionBonusType.PassionPoint:this.updatePassionPoint();break;case AuctionBonusType.GuildWar:this.updateGuildWar();break}};AuctionBonusItem.prototype.toFb=function(){switch(this.fid){case AuctionBonusType.NewWorldBoss:UserBoss.ins().toNewWorldBoss();break;case AuctionBonusType.CampBattle:BattleCC.ins().toBattleCC();break;case AuctionBonusType.PassionPoint:PaoDianCC.ins().toPaoDianCC();break;case AuctionBonusType.GuildWar:GuildWar.ins().toGuildWar();break}};AuctionBonusItem.prototype.updateBonusNum=function(){var bonus=Auction.ins().getBonusCount(this.fid);var canGet=Auction.ins().canGetBonus(this.fid);if(bonus>0){if(canGet){this.txt.text=i18n("AuctionBonusItem_8");this.num.text=bonus.toString()}else{this.txt.text=i18n("AuctionBonusItem_7");this.num.text=bonus.toString()}}else{this.txt.text=i18n("AuctionBonusItem_7");this.num.text=this.config.bonusShow["min"].toString()+"-"+this.config.bonusShow["max"].toString()}};AuctionBonusItem.prototype.updateBtnState=function(){this.bg.source=this.config&&this.config.pic;this.btn.enabled=this.state==0||this.state==1;this.btn.label=this.state==0?i18n("AuctionBonusItem_0"):this.state==1?i18n("AuctionBonusItem_1"):this.state==2?i18n("AuctionBonusItem_2"):i18n("AuctionBonusItem_9");this.redPoint.visible=this.state==0};AuctionBonusItem.prototype.onClickBtn=function(){switch(this.state){case 0:Auction.ins().sendReqBonus(this.fid);break;case 1:this.toFb();break;case 2:break;case 3:break}};AuctionBonusItem.prototype.updateNewWorld=function(){this.showInfo=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[18].text)};var bonus=Auction.ins().getBonusCount(this.fid);var canGet=Auction.ins().canGetBonus(this.fid);if(bonus>0){if(canGet){this.state=0}else{this.state=3}}else{var b=BattleCC.ins().isOpen;this.state=b?1:2}this.updateBtnState();this.time.text=i18n("AuctionBonusItem_3");this.updateBonusNum()};AuctionBonusItem.prototype.updateCampBattle=function(){this.showInfo=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[17].text)};var bonus=Auction.ins().getBonusCount(this.fid);var canGet=Auction.ins().canGetBonus(this.fid);if(bonus>0){if(canGet){this.state=0}else{this.state=3}var b=BattleCC.ins().checkOpen();this.state=b?1:2}this.updateBtnState();this.time.text=i18n("AuctionBonusItem_4");this.updateBonusNum()};AuctionBonusItem.prototype.updatePassionPoint=function(){this.showInfo=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[20].text)};var bonus=Auction.ins().getBonusCount(this.fid);var canGet=Auction.ins().canGetBonus(this.fid);if(bonus>0){if(canGet){this.state=0}else{this.state=3}var b=PaoDianCC.ins().checkOpen();this.state=b?1:2}this.updateBtnState();this.time.text=i18n("AuctionBonusItem_5");this.updateBonusNum()};AuctionBonusItem.prototype.updateGuildWar=function(){this.showInfo=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[8].text)};var bonus=Auction.ins().getBonusCount(this.fid);var canGet=Auction.ins().canGetBonus(this.fid);if(bonus>0){if(canGet){this.state=0}else{this.state=3}}else{var b=GuildWar.ins().getModel().getIsShowGuildWarBtn()==1;this.state=b?1:2}this.updateBtnState();this.time.text=i18n("AuctionBonusItem_6");this.updateBonusNum()};AuctionBonusItem.prototype.setData=function(id){if(id===void 0){id=1}this.fid=id;this.config=GlobalConfig.BonusConfig[id];this.update()};AuctionBonusItem.prototype.showInfo=function(){};AuctionBonusItem.prototype.onTouch=function(e){switch(e.target){case this.info:this.showInfo();break;case this.btn:this.onClickBtn();break}};return AuctionBonusItem}(BaseEuiView);__reflect(AuctionBonusItem.prototype,"AuctionBonusItem");var AuctionBonusType;(function(AuctionBonusType){AuctionBonusType[AuctionBonusType["NewWorldBoss"]=1]="NewWorldBoss";AuctionBonusType[AuctionBonusType["CampBattle"]=2]="CampBattle";AuctionBonusType[AuctionBonusType["PassionPoint"]=3]="PassionPoint";AuctionBonusType[AuctionBonusType["GuildWar"]=4]="GuildWar"})(AuctionBonusType||(AuctionBonusType={}));window["AuctionBonusType"]=AuctionBonusType;var AuctionItemChoiceWin=function(_super){__extends(AuctionItemChoiceWin,_super);function AuctionItemChoiceWin(){var _this=_super.call(this)||this;_this.skinName="auctionItemChoiceSkin";_this.isTopLevel=true;return _this}AuctionItemChoiceWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};AuctionItemChoiceWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.itemID=param[0];this.auID=param[1];this.addTouchEndEvent(this,this.onTouch);this.update()};AuctionItemChoiceWin.prototype.update=function(){var cfg=GlobalConfig.AuctionItem[this.auID];this.item.data=cfg.item;this.price1.text=cfg.bid+"";this.price2.text=cfg.buy+""};AuctionItemChoiceWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.ownUse:case this.auctionBtn:Auction.ins().sendUseAuBox(e.target==this.ownUse?0:1,this.itemID);ViewManager.ins().close(this);break}};return AuctionItemChoiceWin}(BaseEuiView);__reflect(AuctionItemChoiceWin.prototype,"AuctionItemChoiceWin");ViewManager.ins().reg(AuctionItemChoiceWin,LayerManager.UI_Main);var auction=GameSystem.auction;window["auction"]=auction;var AuctionPanel=function(_super){__extends(AuctionPanel,_super);function AuctionPanel(){var _this=_super.call(this)||this;_this.curPage=1;_this.maxPage=1;_this.type=0;_this.itemCount=10;return _this}AuctionPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=AuctionItemRender};AuctionPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.type=param[0];this.itemCount=GlobalConfig.AuctionConfig.eachPageNumber;this.addTouchEndEvent(this,this.onTouch);this.observe(Auction.ins().postListData,this.update);this.observe(Auction.ins().postAuctionResult,this.update);this.observe(Auction.ins().postBuyResult,this.update);this.observe(Auction.ins().postUpdate,this.update);this.curPage=1;this.update();TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1e4,0,this.onSend,this)};AuctionPanel.prototype.close=function(){TimerManager.ins().removeAll(this)};AuctionPanel.prototype.onSend=function(){Auction.ins().sendGetList(this.type)};AuctionPanel.prototype.update=function(){if(!this.collect){this.collect=new ArrayCollection;this.list.dataProvider=this.collect}this.maxPage=Auction.ins().getMaxPageByType(this.type,this.itemCount);if(this.curPage>this.maxPage)this.curPage=this.maxPage;this.updateCurPage();this.add.visible=this.maxPage>1};AuctionPanel.prototype.onTouch=function(e){switch(e.target){case this.btn:ViewManager.ins().open(AuctionRecordWin,this.type);break;case this.minBtn:if(this.curPage>1){this.curPage--;this.updateCurPage()}break;case this.maxBtn:if(this.curPage<this.maxPage){this.curPage++;this.updateCurPage()}break}};AuctionPanel.prototype.updateCurPage=function(){var source=Auction.ins().getDataByPage(this.type,this.curPage,this.itemCount);var oldSource=this.collect.source;if(oldSource&&oldSource.length==(source?source.length:0)){var len=oldSource.length;for(var i=0;i<len;i++){oldSource[i]=source[i];var render=this.list.getElementAt(i);if(render)this.list.updateRenderer(render,i,source[i])}}else this.collect.source=source;this.null.visible=!this.collect.source||this.collect.source.length<=0&&this.type==0;this.null0.visible=!this.collect.source||this.collect.source.length<=0&&this.type==1;this.pageTxt.text=this.curPage+"/"+this.maxPage};return AuctionPanel}(BaseEuiView);__reflect(AuctionPanel.prototype,"AuctionPanel");var AuctionQuotaTipWin=function(_super){__extends(AuctionQuotaTipWin,_super);function AuctionQuotaTipWin(){var _this=_super.call(this)||this;_this.skinName="auctionQuotaTipSkin";return _this}AuctionQuotaTipWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};AuctionQuotaTipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.onTouch);this.positiveQuotaNum.text=param[0];this.rechargeQuotaNum.text=param[1]};AuctionQuotaTipWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.goRechargeBtn:Recharge.ins().tryShowChargeFirstWin();ViewManager.ins().close(AuctionQuotaTipWin);break}};return AuctionQuotaTipWin}(BaseEuiView);__reflect(AuctionQuotaTipWin.prototype,"AuctionQuotaTipWin");ViewManager.ins().reg(AuctionQuotaTipWin,LayerManager.UI_Popup);var AuctionRecordWin=function(_super){__extends(AuctionRecordWin,_super);function AuctionRecordWin(){var _this=_super.call(this)||this;_this.type=0;_this.skinName="auctionRecordSkin";return _this}AuctionRecordWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=AuctionRecordItemRender};AuctionRecordWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.type=param[0];this.observe(Auction.ins().postRecord,this.update);var typeStr=this.type?i18n("AuctionRecordWin_0"):i18n("AuctionRecordWin_1");this.curAuction.textFlow=TextFlowMaker.generateTextFlow(i18n("AuctionRecordWin_2",typeStr));this.null.visible=true;Auction.ins().sendRecord(this.type);this.addTouchEndEvent(this,this.onTouch)};AuctionRecordWin.prototype.onTouch=function(e){if(e.target==this.bgClose)ViewManager.ins().close(this);if(e.target==this.closeBtn)ViewManager.ins().close(this)};AuctionRecordWin.prototype.update=function(param){if(!this.collect){this.collect=new ArrayCollection;this.list.dataProvider=this.collect}if(param.type!=this.type)return;this.collect.source=param.list;this.null.visible=!this.collect.source||this.collect.source.length<=0};return AuctionRecordWin}(BaseEuiView);__reflect(AuctionRecordWin.prototype,"AuctionRecordWin");ViewManager.ins().reg(AuctionRecordWin,LayerManager.UI_Popup);var AuctionWin=function(_super){__extends(AuctionWin,_super);function AuctionWin(){var _this=_super.call(this)||this;_this.skinName="auctionSkin";_this.isTopLevel=true;return _this}AuctionWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.onTouch);this.addChangeEvent(this.tab,this.selectIndexChange);this.observe(Auction.ins().postListData,this.updateRed);this.observe(Auction.ins().postAuctionResult,this.updateRed);this.observe(Auction.ins().postBuyResult,this.updateRed);this.observe(Auction.ins().postUpdate,this.updateRed);this.observe(Auction.ins().postBonusResult,this.updateRed);this.observe(GameServer.ins().postServerTime,this.updateRed);this.updateRed();if(Auction.ins().checkRedByType(2)){this.tab.selectedIndex=2}else{this.tab.selectedIndex=this.viewStack.selectedIndex=Auction.ins().checkRedByType(1)&&!Auction.ins().checkRedByType(0)?1:0}this.selectIndexChange()};AuctionWin.prototype.close=function(){};AuctionWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:ViewManager.ins().open(ZsBossRuleSpeak,41);break}};AuctionWin.prototype.selectIndexChange=function(e){if(e===void 0){e=null}switch(this.tab.selectedIndex){case 0:Auction.ins().sendGetList(0);this.guild.open(0);break;case 1:Auction.ins().sendGetList(1);this.server.open(1);break;case 2:this.bonus.open();break}};AuctionWin.prototype.updateRed=function(){this.redPoint0.visible=Auction.ins().checkRedByType(0);this.redPoint1.visible=Auction.ins().checkRedByType(1);this.redPoint2.visible=Auction.ins().checkRedByType(2)};return AuctionWin}(BaseEuiView);__reflect(AuctionWin.prototype,"AuctionWin");ViewManager.ins().reg(AuctionWin,LayerManager.UI_Main);var AuctionRecordVo=function(){function AuctionRecordVo(bytes){this.type=0;this.parser(bytes)}AuctionRecordVo.prototype.parser=function(bytes){this.aId=bytes.readInt();this.roleName=bytes.readString();this.state=bytes.readByte();this.price=bytes.readInt();this.time=bytes.readInt()};return AuctionRecordVo}();__reflect(AuctionRecordVo.prototype,"AuctionRecordVo");var AuctionVo=function(){function AuctionVo(bytes){this.parser(bytes)}AuctionVo.prototype.parser=function(bytes){this.type=bytes.readByte();this.endTime=bytes.readInt();this.id=bytes.readInt();this.putAwayTime=bytes.readInt();this.aID=bytes.readInt();this.auctionTimes=bytes.readByte();this.myAuPrice=bytes.readByte();this.owner=bytes.readByte()};return AuctionVo}();__reflect(AuctionVo.prototype,"AuctionVo");var AutoTestMgr=function(){function AutoTestMgr(){this.enabled=false;this.paused=false;this.allLayers=[LayerManager.Game_Bg,LayerManager.Game_Main,LayerManager.Main_View,LayerManager.UI_Main,LayerManager.UI_Main2,LayerManager.UI_Popup,LayerManager.UI_Message,LayerManager.UI_Tips];this.ignoreUIs={TipsView:1,BoostPowerView:1,NoticeView:1,EffectivenessTip:1,BossBloodPanel:1};this.coexistUIs={UIView2:1,ChatMainUI:1,BtnHejiWin:1};this.timerInited=false;this.firstTimeCheck=false;this.autoTestData={WelcomeWin:{COMMENT:"开启仙途",backBtn:"WelcomeWin/sureBtn"},StoryWin:{COMMENT:"剧情模式",backBtn:"StoryWin/btnNext"},PlayFunView:{COMMENT:"点击关卡按钮",btns:[["UIView2/guanqiaBtn1",1,function(mgr){var guanqiaPro=mgr.getUIByPath("UIView2/guanqiaBar");return!mgr.isGuanqiaPaused()&&GameMap.fbType==0&&guanqiaPro.value>=guanqiaPro.maximum}],["UIView2/guanqiaBtn2",1,function(mgr){var guanqiaPro=mgr.getUIByPath("UIView2/guanqiaBar");return!mgr.isGuanqiaPaused()&&GameMap.fbType==0&&guanqiaPro.value>=guanqiaPro.maximum}]]},SmeltEquipTotalWin:{COMMENT:"回收装备",btns:[["SmeltEquipTotalWin/equip/smeltBtn",10]],backBtn:"SmeltEquipTotalWin/equip/backbtn"},ForgeWin:{COMMENT:"升级装备",btns:[["ForgeWin/roleSelect/role0",1,function(mgr,ele){return ele["redPoint"].visible},1],["ForgeWin/roleSelect/role1",1,function(mgr,ele){return ele["redPoint"].visible},1],["ForgeWin/roleSelect/role2",1,function(mgr,ele){return ele["redPoint"].visible},1],["ForgeWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("ForgeWin/redPoint0").visible},2],["ForgeWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("ForgeWin/redPoint1").visible},2],["ForgeWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("ForgeWin/redPoint2").visible},2],["ForgeWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("ForgeWin/redPoint3").visible},2]],viewPath:"ForgeWin/viewStack/selectedChild",views:{ForgeBoostPanel:{btns:[["ForgeWin/boostPanel/upGradeBtn0",1,function(mgr,ele){var boostPanel=mgr.getUIByPath("ForgeWin/boostPanel");var costConfig=UserForge.ins().getEnhanceCostConfigByLv(boostPanel.lv+1);var cost=0;var itemNum=0;if(costConfig){itemNum=UserBag.ins().getBagGoodsCountById(0,costConfig.stoneId);cost=costConfig.stoneNum}return itemNum>=cost}]]},ForgeGemPanel:{btns:[["ForgeWin/gemPanel/upGradeBtn",5]]},ForgeZhulingPanel:{btns:[["ForgeWin/zhulingPanel/upGradeBtn",1]]},WeaponWin:{btns:[["ForgeWin/weaponsoul/list1/*",1,function(mgr,ele){return ele.redPoint0.visible}]]}},backBtn:"UIView2/closeBtn"},GiftPackWarnWin:{COMMENT:"限时福利感恩大礼",backBtn:"GiftPackWarnWin/btnClose"},OfflineRewardWin:{COMMENT:"离线收益",backBtn:"OfflineRewardWin/closeBtn"},SkillWin:{COMMENT:"技能界面",btns:[["SkillWin/roleSelect/role0",1,function(mgr,ele){return ele["redPoint"].visible},1],["SkillWin/roleSelect/role1",1,function(mgr,ele){return ele["redPoint"].visible},1],["SkillWin/roleSelect/role2",1,function(mgr,ele){return ele["redPoint"].visible},1],["SkillWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("SkillWin/redPoint0").visible},2],["SkillWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("SkillWin/redPoint1").visible},2],["SkillWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("SkillWin/redPoint2").visible},2],["SkillWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("SkillWin/redPoint3").visible},2],["SkillWin/tab/4",1,function(mgr,ele){return mgr.getUIByPath("SkillWin/redPoint4").visible},2]],viewPath:"SkillWin/viewStack/selectedChild",views:{SkillPanel:{btns:[["SkillWin/viewStack/selectedChild/all",1]]},NeiGongWin:{btns:[["SkillWin/neiGongPanel/UplevelBtn0",1,function(mgr){return mgr.getUIByPath("SkillWin/neiGongPanel/Activation").visible}],["SkillWin/neiGongPanel/oneKeyUp",1],["SkillWin/neiGongPanel/mixBtn",1]]},JingMaiPanel:{btns:[["SkillWin/jingMai/boostBtn",5]]},ZhanLingPanel:{btns:[["SkillWin/zhanlingPanel/upBtn",1],["SkillWin/zhanlingPanel/upBtnEx",1]]},MijiPanel:{btns:[["SkillWin/viewStack/selectedChild/mijiBtn0",1,"redPoint"],["SkillWin/viewStack/selectedChild/mijiBtn1",1,"redPoint"],["SkillWin/viewStack/selectedChild/mijiBtn2",1,"redPoint"],["SkillWin/viewStack/selectedChild/mijiBtn3",1,"redPoint"],["SkillWin/viewStack/selectedChild/mijiBtn4",1,"redPoint"],["SkillWin/viewStack/selectedChild/mijiBtn5",1,"redPoint"],["SkillWin/viewStack/selectedChild/mijiBtn6",1,"redPoint"],["SkillWin/viewStack/selectedChild/mijiBtn7",1,"redPoint"],["SkillWin/viewStack/selectedChild/mijiBtn8",1,"redPoint"],["SkillWin/viewStack/selectedChild/mijiBtn9",1,"redPoint"]]}},backBtn:"UIView2/closeBtn"},MijiLearnWin:{COMMENT:"镶嵌仙玉",btns:[["MijiLearnWin/smeltBtn",1]],backBtn:"MijiLearnWin/closeBtn"},BagFullTipsWin:{COMMENT:"背包已满",backBtn:"BagFullTipsWin/sureBtn"},LiLianWin:{COMMENT:"仙阶界面",btns:[["LiLianWin/roleSelect/role0",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/roleSelect/role1",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/roleSelect/role2",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("LiLianWin/redPoint1").visible},2],["LiLianWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("LiLianWin/redPoint0").visible},2],["LiLianWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("LiLianWin/redPoint2").visible},2],["LiLianWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("LiLianWin/redPoint3").visible},2],["LiLianWin/tab/4",1,function(mgr,ele){return mgr.getUIByPath("LiLianWin/redPoint4").visible},2]],viewPath:"LiLianWin/viewStack/selectedChild",views:{NewLilianWin:{btns:[["LiLianWin/liLianPanel/upgradeBtn",1,function(mgr,ele){var eff=mgr.getUIByPath("LiLianWin/liLianPanel/eff");return eff.parent!=null&&eff.visible}],["LiLianWin/liLianPanel/reward",1,function(mgr,ele){return mgr.getUIByPath("LiLianWin/liLianPanel/redPoint0").visible}],["LiLianWin/liLianPanel/gift1",1,function(mgr,ele){return mgr.getUIByPath("LiLianWin/liLianPanel/redPoint1").visible}],["LiLianWin/liLianPanel/gift2",1,function(mgr,ele){return mgr.getUIByPath("LiLianWin/liLianPanel/redPoint2").visible}],["LiLianWin/liLianPanel/gift3",1,function(mgr,ele){return mgr.getUIByPath("LiLianWin/liLianPanel/redPoint3").visible}]]},XunzhangPanel:{btns:[["LiLianWin/xunzhangPanel/btn",1]]},NewArtifactWin:{btns:[["LiLianWin/artifactWin/btnOpen",1],["LiLianWin/artifactWin/itemWin/item1/btn",1,function(mgr,ele){return ele.parent["labelAct"].visible}],["LiLianWin/artifactWin/itemWin/item2/btn",1,function(mgr,ele){return ele.parent["labelAct"].visible}],["LiLianWin/artifactWin/itemWin/item3/btn",1,function(mgr,ele){return ele.parent["labelAct"].visible}],["LiLianWin/artifactWin/itemWin/item4/btn",1,function(mgr,ele){return ele.parent["labelAct"].visible}],["LiLianWin/artifactWin/itemWin/item5/btn",1,function(mgr,ele){return ele.parent["labelAct"].visible}],["LiLianWin/artifactWin/itemWin/item6/btn",1,function(mgr,ele){return ele.parent["labelAct"].visible}],["LiLianWin/artifactWin/itemWin/item7/btn",1,function(mgr,ele){return ele.parent["labelAct"].visible}],["LiLianWin/artifactWin/itemWin/item8/btn",1,function(mgr,ele){return ele.parent["labelAct"].visible}]]},BookWin:{btns:[["LiLianWin/bookPanel/listBook/*",1,function(mgr,ele){return ele["kejihuo"].visible}],["LiLianWin/bookPanel/listMenu/0",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/bookPanel/listMenu/1",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/bookPanel/listMenu/2",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/bookPanel/listMenu/3",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/bookPanel/listMenu/4",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/bookPanel/rightBtn",1,undefined,1],["LiLianWin/bookPanel/listMenu/5",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/bookPanel/listMenu/6",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/bookPanel/listMenu/7",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/bookPanel/listMenu/8",1,function(mgr,ele){return ele["redPoint"].visible},1],["LiLianWin/bookPanel/listMenu/9",1,function(mgr,ele){return ele["redPoint"].visible},1]]},TODO:"其它分页"},backBtn:"UIView2/closeBtn"},BookUpWin:{COMMENT:"激活图鉴",btns:[["BookUpWin/btnUp",1,undefined,0,10]],backBtn:"BookUpWin/closeBtn"},TeamFbRoomWin:{COMMENT:"组队副本准备界面",btns:[["TeamFbRoomWin/fastGameBtn",10,function(){return true}],["TeamFbRoomWin/challengeBtn",1]],backBtn:"TeamFbRoomWin/closeBtn0"},GuildMap:{COMMENT:"公会主界面",btns:[["GuildMap/practiseBtn",10,function(mgr,ele){return mgr.getUIByPath("GuildMap/redPoint1").visible}],["GuildMap/shopBtn",10,function(mgr,ele){return mgr.getUIByPath("GuildMap/redPoint3").visible}],["GuildMap/manageBtn",10,function(mgr,ele){return mgr.getUIByPath("GuildMap/redPoint0").visible}],["GuildMap/cityBtn",10,function(mgr,ele){return mgr.getUIByPath("GuildMap/redPoint2").visible}]],backBtn:"GuildMap/closeBtn"},GuildSkillWin:{COMMENT:"公会活动大厅",btns:[["GuildSkillWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("GuildSkillWin/redPoint0").visible},2],["GuildSkillWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("GuildSkillWin/redPoint1").visible},2],["GuildSkillWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("GuildSkillWin/redPoint2").visible},2]],viewPath:"GuildSkillWin/viewStack/selectedChild",views:{GuildSkillPanel:{btns:[["GuildSkillWin/viewStack/selectedChild/skillBmp1",1,function(mgr,ele){return mgr.getUIByPath("GuildSkillWin/viewStack/selectedChild/redPoint1").visible},1],["GuildSkillWin/viewStack/selectedChild/skillBmp2",1,function(mgr,ele){return mgr.getUIByPath("GuildSkillWin/viewStack/selectedChild/redPoint2").visible},1],["GuildSkillWin/viewStack/selectedChild/skillBmp3",1,function(mgr,ele){return mgr.getUIByPath("GuildSkillWin/viewStack/selectedChild/redPoint3").visible},1],["GuildSkillWin/viewStack/selectedChild/praBtnMc",1]]},GuildFirePanel:{btns:[["GuildSkillWin/viewStack/selectedChild/give",5,function(mgr,ele){return mgr.getUIByPath("GuildSkillWin/viewStack/selectedChild/redPoint").visible}]]},GuildBoxRewardWin:{btns:[["GuildSkillWin/viewStack/selectedChild/btnAutoGet",1]]}},backBtn:"UIView2/closeBtn"},GuildBossWin:{COMMENT:"公会BOSS",btns:[["GuildBossWin/bossItem0",10,function(mgr,ele){return ele.redPoint0.visible}],["GuildBossWin/bossItem1",10,function(mgr,ele){return ele.redPoint0.visible}],["GuildBossWin/bossItem2",10,function(mgr,ele){return ele.redPoint0.visible}],["GuildBossWin/bossItem3",10,function(mgr,ele){return ele.redPoint0.visible}],["GuildBossWin/bossItem4",10,function(mgr,ele){return ele.redPoint0.visible}],["GuildBossWin/bossItem5",10,function(mgr,ele){return ele.redPoint0.visible}]],backBtn:"GuildBossWin/closeBtn"},GuildBossDetailWin:{COMMENT:"公会BOSS弹窗",btns:[["GuildBossDetailWin/chanllageOme",10],["GuildBossDetailWin/chanllage",10]],backBtn:"GuildBossDetailWin/closeBtn"},ArtifactChipOpenWin:{COMMENT:"激活神器",backBtn:"ArtifactChipOpenWin/btnOpen"},BossWin:{COMMENT:"BOSS之家",btns:[["BossWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("BossWin/redPoint1").visible},1],["BossWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("BossWin/redPoint0").visible},1],["BossWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("BossWin/redPoint2").visible},1],["BossWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("BossWin/redPoint3").visible},1],["BossWin/tab/4",1,function(mgr,ele){return mgr.getUIByPath("BossWin/redPoint4").visible},1]],viewPath:"BossWin/viewStack/selectedChild",views:{PersonalBossPanel:{btns:[["BossWin/viewStack/selectedChild/challengeBtn",1,function(mgr,ele){return Math.random()<.5}]]},PublicBossPanel:{btns:[["BossWin/viewStack/selectedChild/list/*/challengeBtn",1]]},WorldBossMainPanel:{btns:[["BossWin/viewStack/selectedChild/challengeBtn",1]]},ShenyuBossPanel:{btns:[["BossWin/viewStack/selectedChild/list/*/challengeBtn",1]]},BossHomeMainWin:{btns:[["BossWin/viewStack/selectedChild/bosshome0",1,function(mgr,ele){return mgr.getUIByPath("BossWin/viewStack/selectedChild/gotoImg0").visible}],["BossWin/viewStack/selectedChild/bosshome1",1,function(mgr,ele){return mgr.getUIByPath("BossWin/viewStack/selectedChild/gotoImg1").visible}],["BossWin/viewStack/selectedChild/bosshome2",1,function(mgr,ele){return mgr.getUIByPath("BossWin/viewStack/selectedChild/gotoImg2").visible}]]}},backBtn:"UIView2/closeBtn"},ShopWin:{COMMENT:"商城",btns:[["ShopWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("ShopWin/redPoint0").visible},1],["ShopWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("ShopWin/redPoint2").visible},1]],viewPath:"ShopWin/viewStack/selectedChild",views:{BlackMarketPanel:{btns:[["ShopWin/viewStack/selectedChild/refreshShopBtn",1,function(mgr,ele){return mgr.getUIByPath("ShopWin/viewStack/selectedChild/redPoint").visible}]]},ItemShopPanel:{btns:[]}},backBtn:"UIView2/closeBtn"},LadderWin:{COMMENT:"PVP",btns:[["LadderWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("LadderWin/redPoint1").visible},1],["LadderWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("LadderWin/redPoint2").visible},1],["LadderWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("LadderWin/redPoint3").visible},1],["LadderWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("LadderWin/redPoint4").visible},1],["LadderWin/tab/4",1,function(mgr,ele){return mgr.getUIByPath("LadderWin/redPoint5").visible},1]],viewPath:"LadderWin/viewStack/selectedChild",views:{EncounterInfoWin:{btns:[["LadderWin/viewStack/selectedChild/list/0/challengeBtn",1]]},LadderInfoPanel:{btns:[["LadderWin/viewStack/selectedChild/flowPlayer",1]]},MinePanel:{btns:[["LadderWin/viewStack/selectedChild/go",1,function(mgr,ele){return mgr.getUIByPath("LadderWin/viewStack/selectedChild/redPoint").visible}]]},TeamFbNewPanel:{btns:[["LadderWin/viewStack/selectedChild/Fblist/*/createRoomBtn",1]]},HunShouFBWin:{btns:[["LadderWin/viewStack/selectedChild/btnChallenge",1],["LadderWin/viewStack/selectedChild/btnSweep",1]]},EscortPanel:{btns:[["LadderWin/viewStack/selectedChild/goddessList/0/escortBtn",1],["LadderWin/viewStack/selectedChild/finishBtn",1,function(mgr,ele){return mgr.getUIByPath("LadderWin/viewStack/selectedChild/redPointFinishBtn").visible}]]},TODO:"其它分页"},backBtn:"UIView2/closeBtn"},UseXianYuJiaTip:{COMMENT:"使用仙玉",backBtn:"UseXianYuJiaTip/btnUse"},BagWin:{COMMENT:"背包",btns:[["BagWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("BagWin/redPoint0").visible},1],["BagWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("BagWin/redPoint1").visible},1],["BagWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("BagWin/redPoint2").visible},1],["BagWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("BagWin/redPoint3").visible},1]],viewPath:"BagWin/viewStack/selectedChild",viewIdxMode:true,views:{0:{btns:[["BagWin/smeltBtn",1,function(mgr,ele){return mgr.getUIByPath("BagWin/redPoint").visible}]]},1:{btns:[["BagWin/itemListGoods/*",1,function(mgr,uiEle){var itemConfig=GlobalConfig.ItemConfig[uiEle.data.configID];if(MijiGuideMgr.ins().isJia(itemConfig.id)){return true}return uiEle["redPoint"]&&uiEle["redPoint"].visible}]]},2:{btns:[["BagWin/itemListRune/*",1,function(mgr,uiEle){return uiEle["redPoint"]&&uiEle["redPoint"].visible}]]},TODO:"其它分页"},backBtn:"BagWin/closeBtn"},FbWin:{COMMENT:"副本",btns:[["FbWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("FbWin/redPoint0").visible},1],["FbWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("FbWin/redPoint1").visible},1],["FbWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("FbWin/redPoint2").visible},1],["FbWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("FbWin/redPoint3").visible},1],["FbWin/tab/4",1,function(mgr,ele){return mgr.getUIByPath("FbWin/redPoint4").visible},1]],viewPath:"FbWin/viewStack/selectedChild",viewIdxMode:true,views:{0:{btns:[["FbWin/fbList/*/challengeBtn",1,function(mgr,ele){return ele.enabled}],["FbWin/fbList/*/doubleChallengeBtn",1,function(mgr,ele){return ele.enabled}]]},1:{btns:[["FbWin/viewStack/selectedChild/viewStack/selectedChild/btnChallenge",1],["FbWin/viewStack/selectedChild/viewStack/selectedChild/btnSD",1],["FbWin/viewStack/selectedChild/viewStack/selectedChild/btnGet2",1,function(mgr,ele){return mgr.getUIByPath("FbWin/viewStack/selectedChild/viewStack/selectedChild/freedG2").visible}],["FbWin/viewStack/selectedChild/viewStack/selectedChild/btnGet0",1,function(mgr,ele){return mgr.getUIByPath("FbWin/viewStack/selectedChild/viewStack/selectedChild/lbFree").visible}],["FbWin/viewStack/selectedChild/btn_exp",1,function(mgr,ele){return mgr.getUIByPath("FbWin/viewStack/selectedChild/expRedPoint").visible},1],["FbWin/viewStack/selectedChild/btn_sd",1,function(mgr,ele){return mgr.getUIByPath("FbWin/viewStack/selectedChild/sdRedPoint").visible},1],["FbWin/viewStack/selectedChild/btn_cbp",1,function(mgr,ele){return mgr.getUIByPath("FbWin/viewStack/selectedChild/cbpRedPoint").visible},1],["FbWin/viewStack/selectedChild/btn_nmrq",1,function(mgr,ele){return mgr.getUIByPath("FbWin/viewStack/selectedChild/nmrqRedPoint").visible},1]]},2:{btns:[["FbWin/fbChallengePanel/challengeBtn0",1,function(mgr,ele){var redPoint=mgr.getUIByPath("FbWin/fbChallengePanel/redPoint0");return redPoint.visible}],["FbWin/fbChallengePanel/choujiang",1,function(mgr,ele){var redPoint=mgr.getUIByPath("FbWin/fbChallengePanel/redPoint1");return redPoint.visible}],["FbWin/fbChallengePanel/challengeBtn",1]]},3:{btns:[["FbWin/playWayPanel/btn2",1,function(mgr,ele){return ele.enabled}],["FbWin/playWayPanel/btn1",1,function(mgr,ele){return ele.enabled}],["FbWin/playWayPanel/btn3",1,function(mgr,ele){return ele.enabled}],["FbWin/playWayPanel/btn4",1,function(mgr,ele){return ele.enabled}]]},4:{btns:[["FbWin/viewStack/selectedChild/Fblist/*/createRoomBtn",1]]}},backBtn:"UIView2/closeBtn"},ItemUseTipsWin:{COMMENT:"使用道具",backBtn:"ItemUseTipsWin/useBtn"},LimitStartTipsView:{COMMENT:"限时任务开始",backBtn:"LimitStartTipsView/btn"},MijiGuideFinishTip:{COMMENT:"仙玉提示",backBtn:"MijiGuideFinishTip/labelClose"},WarnWin:{COMMENT:"提示弹窗",btns:[["WarnWin/sureBtn",1,function(mgr,ele){var sureBtn=mgr.getUIByPath("WarnWin/sureBtn");if(sureBtn.label=="双倍领取"){return false}return mgr.getTopUI("AdvanEquipWin")==null},0,10],["WarnWin/notBtn",1,function(mgr,ele){var notBtn=mgr.getUIByPath("WarnWin/notBtn");if(notBtn.label=="单倍领取"){return true}return mgr.getTopUI("AdvanEquipWin")!=null},0,10]],backBtn:"WarnWin/sureBtn"},FuliWin:{COMMENT:"福利",btns:[["FuliWin/iconList/0",1,"redPoint",1],["FuliWin/iconList/1",1,"redPoint",1],["FuliWin/iconList/2",1,"redPoint",1],["FuliWin/iconList/3",1,"redPoint",1],["FuliWin/iconList/4",1,"redPoint",1],["FuliWin/iconList/5",1,"redPoint",1],["FuliWin/iconList/6",1,"redPoint",1],["FuliWin/iconList/7",1,"redPoint",1],["FuliWin/iconList/8",1,"redPoint",1]],viewPath:"FuliWin/curPanel",views:{FuliHongbaoPanel:{btns:[["FuliWin/curPanel/btnQiang",1],["FuliWin/curPanel/btnExtraGet",1,function(mgr,ele){return UserFuLiHongbao.ins().IsExtraGet()}]]},DailyCheckInPanel:{btns:[["FuliWin/curPanel/rewardBtn",1,function(mgr,ele){return ele.enabled}],["FuliWin/curPanel/cardList/*",1,function(mgr,ele){return ele.EquipEffect&&ele.EquipEffect.visible&&ele.EquipEffect.parent!=null}]]},SevenDayLogWin:{btns:[["FuliWin/curPanel/suerBtn",5,function(mgr,ele){return mgr.getUIByPath("FuliWin/curPanel/redPoint").visible}]]},LevelupRewardsPanel:{btns:[["FuliWin/curPanel/content/*/btnGet",5,function(mgr,ele){return ele.parent.parent.redPoint.visible}]]},MonthCardWin:{btns:[]},FranchiseWin:{btns:[]},GameNoticePanle:{btns:[["FuliWin/curPanel/suerBtn",1,function(mgr,ele){return mgr.getUIByPath("FuliWin/curPanel/redPoint").visible}]]},TimeCardWin:{btns:[["FuliWin/curPanel/listReward/*/btnGet",1,function(mgr,ele){return ele.parent.imageRedPoint.visible}]]},CdkeyPanle:{btns:[]}},backBtn:"UIView2/closeBtn"},RoleWin:{COMMENT:"角色",btnsCOMMENT:["uiPath","点击次数","生效条件","重刷等级"],btnsCOMMENT2:"重刷等级：当重刷等级不为null时，按钮只生效一次。但是，重刷等级高的按钮，在生效时可以让所有比它低的按钮重新生效。另外，高重刷等级的按钮生效了一次之后，此重刷等级的按钮将不再生效，除非没有更低重刷等级的按钮可生效了。",btns:[["RoleWin/tab/0",1,function(mgr,ele){return ele.parent.parent["redPoint0"].visible},2],["RoleWin/tab/1",1,function(mgr,ele){return ele.parent.parent["redPoint1"].visible},2],["RoleWin/tab/2",1,function(mgr,ele){return ele.parent.parent["redPoint2"].visible},2],["RoleWin/tab/3",1,function(mgr,ele){return ele.parent.parent["redPoint3"].visible},2],["RoleWin/tab/4",1,function(mgr,ele){return ele.parent.parent["redPoint4"].visible},2],["RoleWin/roleSelect/role0",1,function(mgr,ele){return ele["redPoint"].visible},1],["RoleWin/roleSelect/role1",1,function(mgr,ele){return ele["redPoint"].visible},1],["RoleWin/roleSelect/role2",1,function(mgr,ele){return ele["redPoint"].visible},1]],viewPath:"RoleWin/viewStack/selectedChild",views:{RoleInfoPanel:{btns:[["RoleWin/roleInfoPanel/oneKeyChange",1,undefined,0],["RoleWin/roleInfoPanel/bless0",1,function(mgr,ele){var redPoint=mgr.getUIByPath("RoleWin/roleInfoPanel/ringRedPoint");return redPoint!=null&&redPoint.visible},2],["RoleWin/roleInfoPanel/orange",1,function(mgr,ele){var redPoint=mgr.getUIByPath("RoleWin/roleInfoPanel/orangeRedPoint");return redPoint!=null&&redPoint.visible},2],["RoleWin/roleInfoPanel/heirloom",1,function(mgr,ele){var redPoint=mgr.getUIByPath("RoleWin/roleInfoPanel/heirloomRedPoint");return redPoint!=null&&redPoint.visible},2],["RoleWin/roleInfoPanel/shenlu",1,function(mgr,ele){var redPoint=mgr.getUIByPath("RoleWin/roleInfoPanel/redPointShenlu");return redPoint!=null&&redPoint.visible},2],["RoleWin/roleInfoPanel/rune",1,function(mgr,ele){var redPoint=mgr.getUIByPath("RoleWin/roleInfoPanel/zwRedPoint");return redPoint!=null&&redPoint.visible},2],["RoleWin/roleInfoPanel/shuzhuang",1,function(mgr,ele){var redPoint=mgr.getUIByPath("RoleWin/roleInfoPanel/fashionPoint");return redPoint!=null&&redPoint.visible},2],["RoleWin/roleInfoPanel/item0",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint0").visible}],["RoleWin/roleInfoPanel/item1",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint1").visible}],["RoleWin/roleInfoPanel/item2",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint2").visible}],["RoleWin/roleInfoPanel/item3",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint3").visible}],["RoleWin/roleInfoPanel/item4",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint4").visible}],["RoleWin/roleInfoPanel/item5",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint5").visible}],["RoleWin/roleInfoPanel/item6",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint6").visible}],["RoleWin/roleInfoPanel/item7",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint7").visible}],["RoleWin/roleInfoPanel/item8",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint8").visible}],["RoleWin/roleInfoPanel/item9",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint9").visible}],["RoleWin/roleInfoPanel/item10",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint10").visible}],["RoleWin/roleInfoPanel/item11",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint11").visible}],["RoleWin/roleInfoPanel/item12",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/roleInfoPanel/redPoint12").visible}],["RoleWin/roleInfoPanel/roleInfoItem0",1,"redPoint"],["RoleWin/roleInfoPanel/roleInfoItem1",1,"redPoint"]]},HejiPanel:{btns:[["RoleWin/viewStack/selectedChild/UplevelBtn1",1],["RoleWin/viewStack/selectedChild/fenjieBtn",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/viewStack/selectedChild/redPointSo").visible}],["RoleWin/viewStack/selectedChild/punchtogether1",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/viewStack/selectedChild/redPointEx").visible}],["RoleWin/viewStack/selectedChild/turnPunchForge",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/viewStack/selectedChild/redPointPf").visible}],["RoleWin/viewStack/selectedChild/btnShapeShifting",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/viewStack/selectedChild/redPointSS").visible}],["RoleWin/viewStack/selectedChild/PunchForge/btn",1,function(mgr,ele){return mgr.getUIByPath("RoleWin/viewStack/selectedChild/PunchForge/redPoint").visible}],["RoleWin/viewStack/selectedChild/item1/addBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}],["RoleWin/viewStack/selectedChild/item2/addBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}],["RoleWin/viewStack/selectedChild/item3/addBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}],["RoleWin/viewStack/selectedChild/item4/addBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}],["RoleWin/viewStack/selectedChild/item5/addBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}],["RoleWin/viewStack/selectedChild/item6/addBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}],["RoleWin/viewStack/selectedChild/item7/addBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}],["RoleWin/viewStack/selectedChild/item8/addBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}]]},ZsPanel:{btns:[["RoleWin/viewStack/selectedChild/link",1],["RoleWin/viewStack/selectedChild/getBtn",1]]},WingPanel:{btns:[["RoleWin/viewStack/selectedChild/openStatusBtn",1],["RoleWin/viewStack/selectedChild/boostBtn0",1]]},SamsaraPanel:{btns:[["RoleWin/viewStack/selectedChild/upBtn",1]]},TODO:"各分页逻辑完善"},backBtn:"UIView2/closeBtn"},Activationtongyong:{COMMENT:"激活弹窗",backBtn:"Activationtongyong/labelClose"},SettingView:{COMMENT:"设置",backBtn:"SettingView/closeBtn"},shenqispTipsWin:{COMMENT:"神器",backBtn:"shenqispTipsWin/labelClose"},LevelUpWayWin:{COMMENT:"我要升级",backBtn:"LevelUpWayWin/closeBtn"},RingInfoView:{COMMENT:"飞剑",TODO:"激活能激活的飞剑",btns:[["RingInfoView/menuList/*",1,function(mgr,ele){return ele["redPoint"].visible},1],["RingInfoView/acivebtn",1],["RingInfoView/upgradebtn",1],["RingInfoView/goQuicklyOpen",1]],backBtn:"UIView2/closeBtn"},TreasureWin:{COMMENT:"飞剑",btns:[["TreasureWin/tab/0",1,function(mgr,ele){return ele.parent.parent["redPoint0"].visible},3],["TreasureWin/tab/1",1,function(mgr,ele){return ele.parent.parent["redPoint1"].visible},3],["TreasureWin/tab/2",1,function(mgr,ele){return ele.parent.parent["redPoint2"].visible},3],["TreasureWin/tab/3",1,function(mgr,ele){return ele.parent.parent["redPoint3"].visible},3],["TreasureWin/tab/4",1,function(mgr,ele){return ele.parent.parent["redPoint4"].visible},3],["TreasureWin/roleSelect/role0",1,function(mgr,ele){return ele["redPoint"].visible},2],["TreasureWin/roleSelect/role1",1,function(mgr,ele){return ele["redPoint"].visible},2],["TreasureWin/roleSelect/role2",1,function(mgr,ele){return ele["redPoint"].visible},2]],viewPath:"TreasureWin/viewStack/selectedChild",views:{LongHunWin:{btns:[["TreasureWin/viewStack/selectedChild/activeBtn",1],["TreasureWin/viewStack/selectedChild/upgradeBtn",1]]},JadeNewPanel:{btns:[["TreasureWin/viewStack/selectedChild/upgradeBtn0",1],["TreasureWin/viewStack/selectedChild/upgradeBtn1",1]]},HeartMethodWin:{btns:[["TreasureWin/viewStack/selectedChild/fenjie",1,function(mgr,ele){return mgr.getUIByPath("TreasureWin/viewStack/selectedChild/redPoint").visible}],["TreasureWin/viewStack/selectedChild/activeBtn0",1,function(mgr,ele){return mgr.getUIByPath("TreasureWin/viewStack/selectedChild/redPoint1").visible}],["TreasureWin/viewStack/selectedChild/boostBtn",1,function(mgr,ele){return mgr.getUIByPath("TreasureWin/viewStack/selectedChild/redPoint0").visible}],["TreasureWin/viewStack/selectedChild/rightBtn",1,function(mgr,ele){return mgr.getUIByPath("TreasureWin/viewStack/selectedChild/redPoint3").visible},1,10],["TreasureWin/viewStack/selectedChild/item1",1,"redPoint",0,10],["TreasureWin/viewStack/selectedChild/item2",1,"redPoint",0,10],["TreasureWin/viewStack/selectedChild/item3",1,"redPoint",0,10],["TreasureWin/viewStack/selectedChild/item4",1,"redPoint",0,10],["TreasureWin/viewStack/selectedChild/item5",1,"redPoint",0,10]]},ShenshouWin:{btns:[["TreasureWin/viewStack/selectedChild/activityBtn",1]]},HunguWin:{btns:[["TreasureWin/viewStack/selectedChild/executeBtn0",1],["TreasureWin/viewStack/selectedChild/executeBtn",1]]}},backBtn:"UIView2/closeBtn"},ActivityWin:{COMMENT:"活动",btns:[["ActivityWin/menuList/*",1,"redPoint",3]],viewPath:"ActivityWin/viewStack/selectedChild",views:{OSATarget12Panel:{btns:[["ActivityWin/viewStack/selectedChild/cruPanel/onbtn",1,function(mgr,ele){return mgr.getUIByPath("ActivityWin/viewStack/selectedChild/cruPanel/redPoint").visible}]]},OSATarget10Panel:{btns:[["ActivityWin/viewStack/selectedChild/choujiangBtn",1]]}},backBtn:"UIView2/closeBtn"},HongBaoSpeak:{COMMENT:"发红包",backBtn:"HongBaoSpeak/sendBtn"},ShopGoodsWarn:{COMMENT:"材料不足",backBtn:"ShopGoodsWarn/closeBtn"},AdvanEquipWin:{COMMENT:"战装",btns:[["AdvanEquipWin/roleSelect/role0",1,function(mgr,ele){return ele["redPoint"].visible},2],["AdvanEquipWin/roleSelect/role1",1,function(mgr,ele){return ele["redPoint"].visible},2],["AdvanEquipWin/roleSelect/role2",1,function(mgr,ele){return ele["redPoint"].visible},2],["AdvanEquipWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("AdvanEquipWin/redPoint0").visible},3],["AdvanEquipWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("AdvanEquipWin/redPoint1").visible},3],["AdvanEquipWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("AdvanEquipWin/redPoint3").visible},3],["AdvanEquipWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("AdvanEquipWin/redPoint2").visible},3]],viewPath:"AdvanEquipWin/viewStack/selectedChild",views:{OrangeEquipPanel:{btns:[["AdvanEquipWin/orangeEquipPanel/getTreasureBtn",1,function(mgr,ele){var eff=mgr.getUIByPath("AdvanEquipWin/orangeEquipPanel/chargeEff1");return eff&&eff.visible},0],["AdvanEquipWin/orangeEquipPanel/equip0",1,function(mgr,ele){return ele.redPoint.visible},1],["AdvanEquipWin/orangeEquipPanel/equip1",1,function(mgr,ele){return ele.redPoint.visible},1],["AdvanEquipWin/orangeEquipPanel/equip2",1,function(mgr,ele){return ele.redPoint.visible},1],["AdvanEquipWin/orangeEquipPanel/equip3",1,function(mgr,ele){return ele.redPoint.visible},1],["AdvanEquipWin/orangeEquipPanel/equip4",1,function(mgr,ele){return ele.redPoint.visible},1],["AdvanEquipWin/orangeEquipPanel/equip5",1,function(mgr,ele){return ele.redPoint.visible},1],["AdvanEquipWin/orangeEquipPanel/equip6",1,function(mgr,ele){return ele.redPoint.visible},1],["AdvanEquipWin/orangeEquipPanel/equip7",1,function(mgr,ele){return ele.redPoint.visible},1],["AdvanEquipWin/orangeEquipPanel/executeBtn",1,function(mgr,ele){var panel=mgr.getUIByPath("AdvanEquipWin/orangeEquipPanel");var equip=panel["equip"+panel["curIndex"]];return equip["redPoint"].visible}]]},LegendEquipPanel:{btns:[["AdvanEquipWin/viewStack/selectedChild/swordIcon",1,function(mgr,ele){return mgr.getUIByPath("AdvanEquipWin/viewStack/selectedChild/redPoint0").visible},1],["AdvanEquipWin/viewStack/selectedChild/armorIcon",1,function(mgr,ele){return mgr.getUIByPath("AdvanEquipWin/viewStack/selectedChild/redPoint1").visible},1],["AdvanEquipWin/viewStack/selectedChild/executeBtn",1]]},ExtremeEquipPanel:{btns:[["AdvanEquipWin/viewStack/selectedChild/updateBtn",1,function(mgr,ele){return mgr.getUIByPath("AdvanEquipWin/viewStack/selectedChild/redPoint").visible},0],["AdvanEquipWin/viewStack/selectedChild/menuList/*",1,function(mgr,ele){return ele["redPoint"].visible},1]]}},backBtn:"UIView2/closeBtn"},BreakDownView:{COMMENT:"分解",btns:[["BreakDownView/equipList/*/breakDown",1,undefined,undefined,5]],backBtn:"BreakDownView/closeBtn"},LimitTaskView:{COMMENT:"限时任务",btns:[["LimitTaskView/list/*/goBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}]],backBtn:"UIView2/closeBtn"},RuneWin:{COMMENT:"符文",btns:[["RuneWin/roleSelect/role0",1,function(mgr,ele){return ele["redPoint"].visible},1],["RuneWin/roleSelect/role1",1,function(mgr,ele){return ele["redPoint"].visible},1],["RuneWin/roleSelect/role2",1,function(mgr,ele){return ele["redPoint"].visible},1]],viewPath:"RuneWin/viewStack/selectedChild",views:{RunePanel:{btns:[["RuneWin/runePanel/rune0",1,"redPoint",1],["RuneWin/runePanel/rune1",1,"redPoint",1],["RuneWin/runePanel/rune2",1,"redPoint",1],["RuneWin/runePanel/rune3",1,"redPoint",1],["RuneWin/runePanel/rune4",1,"redPoint",1],["RuneWin/runePanel/rune5",1,"redPoint",1],["RuneWin/runePanel/rune6",1,"redPoint",1],["RuneWin/runePanel/rune7",1,"redPoint",1],["RuneWin/runePanel/replace",1,function(mgr,ele){return mgr.getUIByPath("RuneWin/runePanel/redPointReplace").visible},0],["RuneWin/runePanel/uplevel",5,function(mgr,ele){return mgr.getUIByPath("RuneWin/runePanel/upRed").visible},0]]},TODO:"各分页逻辑完善"},backBtn:"UIView2/closeBtn"},TongResultWin:{COMMENT:"试练塔结算页",backBtn:"TongResultWin/closeBtn"},SamsaraEquipTips:{COMMENT:"六道装备弹窗",btns:[["SamsaraEquipTips/spiritBtn",5,function(mgr,ele){return mgr.getUIByPath("SamsaraEquipTips/redPoint").visible},0,10],["SamsaraEquipTips/soulBtn",5,function(mgr,ele){return mgr.getUIByPath("SamsaraEquipTips/redPoint1").visible},0,10]],backBtn:"UIView2/closeBtn"},AddSpiritView:{COMMENT:"注灵",btns:[["AddSpiritView/upBtn",1,function(mgr,ele){return mgr.getUIByPath("AddSpiritView/redPoint").visible}]],backBtn:"AddSpiritView/closeBtn"},SamsaraSoulWin:{COMMENT:"注魂",btns:[["SamsaraSoulWin/soulBtn",1,function(mgr,ele){return mgr.getUIByPath("SamsaraSoulWin/redPoint").visible}]],backBtn:"UIView2/closeBtn"},ResultWin:{COMMENT:"试练塔结算页",btns:[["ResultWin/closeBtn",1],["ResultWin/rewardBtn",1]],backBtn:"ResultWin/closeBtn"},RuneReplaceWin:{COMMENT:"符文替换",btns:[["RuneReplaceWin/list/*/changeBtn",1],["RuneReplaceWin/list/*/changeBtn0",1]],backBtn:"UIView2/closeBtn"},ChallengeDayRewardWin:{COMMENT:"试练塔每日奖励",backBtn:"ChallengeDayRewardWin/GetRewardBtn0"},Recharge1Win:{COMMENT:"首充界面",btns:[["Recharge1Win/buyed",1]],backBtn:"Recharge1Win/closeBtn"},BuyWin:{COMMENT:"购买页面",btns:[["BuyWin/add10Btn",1],["BuyWin/buyBtn",1]],backBtn:"BuyWin/labelClose"},TreasureHuntWin:{COMMENT:"寻宝",btns:[["TreasureHuntWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/redPoint0").visible},1],["TreasureHuntWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/redPoint1").visible},1],["TreasureHuntWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/redPoint2").visible},1],["TreasureHuntWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/redPoint3").visible},1],["TreasureHuntWin/tab/4",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/redPoint4").visible},1]],viewPath:"TreasureHuntWin/viewStack/selectedChild",views:{TreasureHuntPanel:{btns:[["TreasureHuntWin/viewStack/selectedChild/buy1",1],["TreasureHuntWin/viewStack/selectedChild/outBag",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/redPoint2").visible},0],["TreasureHuntWin/viewStack/selectedChild/box0",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint0").visible},0],["TreasureHuntWin/viewStack/selectedChild/box1",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint1").visible},0],["TreasureHuntWin/viewStack/selectedChild/box2",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint2").visible},0],["TreasureHuntWin/viewStack/selectedChild/box3",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint3").visible},0],["TreasureHuntWin/viewStack/selectedChild/box4",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint4").visible},0]]},TreasureRunePanel:{btns:[["TreasureHuntWin/viewStack/selectedChild/buy1",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/redPoint3").visible},0],["TreasureHuntWin/viewStack/selectedChild/box0",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint0").visible},0],["TreasureHuntWin/viewStack/selectedChild/box1",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint1").visible},0],["TreasureHuntWin/viewStack/selectedChild/box2",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint2").visible},0],["TreasureHuntWin/viewStack/selectedChild/box3",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint3").visible},0],["TreasureHuntWin/viewStack/selectedChild/box4",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint4").visible},0]]},MillionaireWin:{btns:[["TreasureHuntWin/viewStack/selectedChild/autoGo",2,undefined,0]]},TreasureChuanshiPanel:{btns:[["TreasureHuntWin/viewStack/selectedChild/buy1",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/redPoint3").visible},0],["TreasureHuntWin/viewStack/selectedChild/box0",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint0").visible},0],["TreasureHuntWin/viewStack/selectedChild/box1",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint1").visible},0],["TreasureHuntWin/viewStack/selectedChild/box2",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint2").visible},0],["TreasureHuntWin/viewStack/selectedChild/box3",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint3").visible},0],["TreasureHuntWin/viewStack/selectedChild/box4",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint4").visible},0]]},TreasureShapeShiftingPanel:{btns:[["TreasureHuntWin/viewStack/selectedChild/buy1",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/redPoint3").visible},0],["TreasureHuntWin/viewStack/selectedChild/box0",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint0").visible},0],["TreasureHuntWin/viewStack/selectedChild/box1",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint1").visible},0],["TreasureHuntWin/viewStack/selectedChild/box2",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint2").visible},0],["TreasureHuntWin/viewStack/selectedChild/box3",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint3").visible},0],["TreasureHuntWin/viewStack/selectedChild/box4",1,function(mgr,ele){return mgr.getUIByPath("TreasureHuntWin/viewStack/selectedChild/boxPoint4").visible},0]]}},backBtn:"UIView2/closeBtn"},TreasureStorePanel:{COMMENT:"寻宝仓库",btns:[["TreasureStorePanel/get",1]],backBtn:"UIView2/closeBtn"},GuildApplyWin:{COMMENT:"申请仙盟",backBtn:"GuildApplyWin/closeBtn"},VipGiftWin:{COMMENT:"尊者礼包",btns:[["VipGiftWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("VipGiftWin/redPoint0").visible},1]],viewPath:"VipGiftWin/viewStack/selectedChild",views:{VipGiftPanel:{btns:[["VipGiftWin/viewStack/selectedChild/vipGiftItem/getBtn",5,function(mgr,ele){return mgr.getUIByPath("VipGiftWin/viewStack/selectedChild/vipGiftItem/redPoint").visible},0]]}},backBtn:"UIView2/closeBtn"},Vip3MWin:{COMMENT:"领取神器",btns:[["Vip3MWin/pay",1]],backBtn:"Vip3MWin/closeBtn"},NewRoleWin:{COMMENT:"新角色",btns:[["NewRoleWin/openBtn",1]],backBtn:"UIView2/closeBtn"},EquipDetailedWin:{COMMENT:"装备详情",btns:[["EquipDetailedWin/changeBtn",1,undefined,0,10]],backBtn:"UIView2/closeBtn"},RoleChooseEquipWin:{COMMENT:"更换装备",btns:[["RoleChooseEquipWin/list/*/changeBtn",1,function(mgr,ele){return ele.parent.best.visible},0,10]],backBtn:"RoleChooseEquipWin/closeBtn"},BuyRedNameWin:{COMMENT:"减少红名",backBtn:"BuyRedNameWin/btnClose"},NewEquipWin:{COMMENT:"新装备",backBtn:"NewEquipWin/go"},GainZsWin:{COMMENT:"获取转生",btns:[["GainZsWin/btn1",5,function(mgr,ele){return mgr.getUIByPath("GainZsWin/btn1").enabled}],["GainZsWin/btn2",5,function(mgr,ele){return mgr.getUIByPath("GainZsWin/btn2").enabled}],["GainZsWin/btn3",5,function(mgr,ele){return mgr.getUIByPath("GainZsWin/btn3").enabled}]],backBtn:"GainZsWin/closeBtn"},StrengthWarnWin:{COMMENT:"我要变强提示框",backBtn:"StrengthWarnWin/sureBtn"},StrengthWin:{COMMENT:"我要变强",btns:[["StrengthWin/btnGetReward",5,function(mgr,ele){return mgr.getUIByPath("StrengthWin/redPoint").visible}],["StrengthWin/listTask/*/btnGo",1,function(mgr,ele){return ele.parent.redPoint.visible}]],backBtn:"StrengthWin/btnClose"},TicketWin:{COMMENT:"成长之路",btns:[["TicketWin/listTask/*/btnGet",1,function(mgr,ele){return ele.parent.redPoint.visible},0,20],["TicketWin/listPage/*",1,function(mgr,ele){return ele.redPoint.visible},1]],backBtn:"TicketWin/btnClose"},HappySevenDayWin:{COMMENT:"七日狂欢",btns:[["HappySevenDayWin/tabD/*",1,function(mgr,ele){return ele.redpoint.visible},2],["HappySevenDayWin/tabP/*",1,function(mgr,ele){return ele.redpoint.visible},1],["HappySevenDayWin/list/*/actBtn",1,function(mgr,ele){return ele.parent.redpoint.visible},0]],backBtn:"UIView2/closeBtn"},FriendBgWin:{COMMENT:"邮件",viewPath:"FriendBgWin/viewStack/selectedChild",views:{MailWin:{btns:[["FriendBgWin/viewStack/selectedChild/allReceiveBtn",1]]}},backBtn:"FriendBgWin/btnClose"},VipWin:{COMMENT:"尊者",btns:[["VipWin/suerBtn",10]],backBtn:"UIView2/closeBtn"},MillionaireWin:{COMMENT:"宝藏猎人",btns:[["MillionaireWin/autoGo",1]],backBtn:"UIView2/closeBtn"},GodWeaponWin:{COMMENT:"本命神器",COMMENT2:"完成views里面的逻辑",viewPath:"GodWeaponWin/viewStack/selectedChild",btns:[["GodWeaponWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/mjRp").visible}],["GodWeaponWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/mixRp").visible}],["GodWeaponWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/gwBossRp").visible}],["GodWeaponWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/gwRp").visible}]],views:{GwWeaponView:{btns:[["GodWeaponWin/viewStack/selectedChild/gwTask/btn",1,function(mgr,ele){var btn=mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/gwTask/btn");return btn!=null&&btn.label!="前往"}]]},GwFubenView:{btns:[["GodWeaponWin/viewStack/selectedChild/challenge",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/rpImg").visible}]]},GodweaponItemMixView:{btns:[["GodWeaponWin/viewStack/selectedChild/mix",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/rpImg").visible}]]},GwBossView:{btns:[["GodWeaponWin/viewStack/selectedChild/tower0",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/towerRedPoint0").visible}],["GodWeaponWin/viewStack/selectedChild/tower1",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/towerRedPoint1").visible}],["GodWeaponWin/viewStack/selectedChild/tower2",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/towerRedPoint2").visible}],["GodWeaponWin/viewStack/selectedChild/tower3",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/towerRedPoint3").visible}],["GodWeaponWin/viewStack/selectedChild/tower4",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/towerRedPoint4").visible}],["GodWeaponWin/viewStack/selectedChild/gw0",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/redPoint0").visible}],["GodWeaponWin/viewStack/selectedChild/gw1",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/redPoint1").visible}],["GodWeaponWin/viewStack/selectedChild/gw2",1,function(mgr,ele){return mgr.getUIByPath("GodWeaponWin/viewStack/selectedChild/redPoint2").visible}]]}},backBtn:"UIView2/closeBtn"},GwBossChallengeView:{COMMENT:"本命神器BOSS掉落",btns:[["GwBossChallengeView/challengeBtn",1]],backBtn:"GwBossChallengeView/closeBtn"},HejiEquipTipsWin:{COMMENT:"拼图",btns:[["HejiEquipTipsWin/changeBtn",1,undefined,0,8]],backBtn:"HejiEquipTipsWin/labelClose"},WeaponPanel:{COMMENT:"剑灵",btns:[["WeaponPanel/weaponShowPanel/item0",1,"redPoint"],["WeaponPanel/weaponShowPanel/item1",1,"redPoint"],["WeaponPanel/weaponShowPanel/item2",1,"redPoint"],["WeaponPanel/weaponShowPanel/item3",1,"redPoint"],["WeaponPanel/weaponShowPanel/item4",1,"redPoint"],["WeaponPanel/weaponShowPanel/item5",1,"redPoint"],["WeaponPanel/weaponShowPanel/item6",1,"redPoint"],["WeaponPanel/weaponShowPanel/item7",1,"redPoint"],["WeaponPanel/upGradeBtn0",1,function(mgr,ele){return mgr.getUIByPath("WeaponPanel/redPoint").visible}]],backBtn:"UIView2/closeBtn"},WeaponSoulBreakWin:{COMMENT:"剑灵突破",btns:[["WeaponSoulBreakWin/btnjihuo",1],["WeaponSoulBreakWin/btnlianhua",1],["WeaponSoulBreakWin/btntupo",1]],backBtn:"WeaponSoulBreakWin/closeBtn"},BabelLotteryWin:{COMMENT:"试炼塔转盘",btns:[["BabelLotteryWin/choujiangBtn",1]],backBtn:"UIView2/closeBtn"},SpecialRingWin:{COMMENT:"特殊装备启用",btns:[["SpecialRingWin/btnUse",1]],backBtn:"UIView2/closeBtn"},MineScenePanel:{COMMENT:"矿洞",btns:[["MineScenePanel/wakuangGroup",1,function(mgr,ele){return mgr.getUIByPath("MineScenePanel/redPoint1").visible}]],backBtn:"GameSceneView/escBtn"},MineChoseWorkerWin:{COMMENT:"选择矿工",btns:[["MineChoseWorkerWin/start",1]],backBtn:"UIView2/closeBtn"},WingHintWin:{COMMENT:"神翼祝福值清空提示",backBtn:"WingHintWin/closeBtn"},BattleNpcTipWin:{COMMENT:"仙魔战场进入提示",btns:[["BattleNpcTipWin/goTo",1]],backBtn:"BattleNpcTipWin/closeBtn"},PunchResWin:{COMMENT:"分解碎片",btns:[["PunchResWin/smeltBtn",5]],backBtn:"PunchResWin/closeBtn"},PunchExchangeWin:{COMMENT:"合成碎片",btns:[["PunchExchangeWin/equiplist/*",1,function(mgr,ele){return ele["redPoint"].visible},1],["PunchExchangeWin/exchangelist/*/goBtn",1,function(mgr,ele){return ele.parent["redPoint"].visible}]],backBtn:"UIView2/closeBtn"},ShapeShiftingWin:{COMMENT:"无双变身",btns:[["ShapeShiftingWin/itemList/*",1,function(mgr,ele){return ele["redPoint"].visible},1],["ShapeShiftingWin/btnUpgrade",1],["ShapeShiftingWin/btnActivate",1]],backBtn:"UIView2/closeBtn"},DressWin:{COMMENT:"皮肤",btns:[["DressWin/list/*",1,function(mgr,ele){return ele["redPoint0"].visible},1],["DressWin/buyBtn",1]],backBtn:"UIView2/closeBtn"},KFBattleWin:{COMMENT:"跨服战场",viewPath:"KFBattleWin/viewStack/selectedChild",btns:[["KFBattleWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("KFBattleWin/redPoint0").visible}],["KFBattleWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("KFBattleWin/redPoint1").visible}]],views:{KffieldPanel:{btns:[["KFBattleWin/viewStack/selectedChild/island0",1,function(mgr,ele){return ele.redPoint.visible}],["KFBattleWin/viewStack/selectedChild/island1",1,function(mgr,ele){return ele.redPoint.visible}],["KFBattleWin/viewStack/selectedChild/island2",1,function(mgr,ele){return ele.redPoint.visible}],["KFBattleWin/viewStack/selectedChild/island3",1,function(mgr,ele){return ele.redPoint.visible}]]},KffieldRecordPanel:{btns:[]}},backBtn:"UIView2/closeBtn"},KFBossWin:{COMMENT:"跨服BOSS",btns:[["KFBossWin/island1",1,function(mgr,ele){return ele.redPoint.visible},1],["KFBossWin/island2",1,function(mgr,ele){return ele.redPoint.visible},1],["KFBossWin/island3",1,function(mgr,ele){return ele.redPoint.visible},1],["KFBossWin/island4",1,function(mgr,ele){return ele.redPoint.visible},1],["KFBossWin/island5",1,function(mgr,ele){return ele.redPoint.visible},1],["KFBossWin/island6",1,function(mgr,ele){return ele.redPoint.visible},1],["KFBossWin/island7",1,function(mgr,ele){return ele.redPoint.visible},1],["KFBossWin/island8",1,function(mgr,ele){return ele.redPoint.visible},1]],backBtn:"UIView2/closeBtn"},KFBossShowWin:{COMMENT:"跨服BOSS弹窗",btns:[["KFBossShowWin/challengeBtn",1]],backBtn:"UIView2/closeBtn"},KFBossSceneWin:{COMMENT:"特殊BOSS场景",btns:[["BossBelongPanel/attackBoss1",5]],backBtn:"GameSceneView/escBtn"},TargetListPanel:{COMMENT:"跨服BOSS场景",btns:[["BossBelongPanel/attackBoss1",5,function(mgr,ele){return ele.currentState=="attbossup"},0,9999999]],backBtn:"GameSceneView/escBtn"},FireRingWin:{COMMENT:"无双飞剑",viewPath:"FireRingWin/viewStack/selectedChild",btns:[["FireRingWin/tab/0",1,function(mgr,ele){return mgr.getUIByPath("FireRingWin/redPoint0").visible}],["FireRingWin/tab/1",1,function(mgr,ele){return mgr.getUIByPath("FireRingWin/redPoint1").visible}],["FireRingWin/tab/2",1,function(mgr,ele){return mgr.getUIByPath("FireRingWin/redPoint2").visible}],["FireRingWin/tab/3",1,function(mgr,ele){return mgr.getUIByPath("FireRingWin/redPoint3").visible}]],views:{FireRingInfoPanel:{btns:[["FireRingWin/viewStack/selectedChild/lvupBtn",1]]},FireRingSkillPanel:{btns:[["FireRingWin/viewStack/selectedChild/opraBtn",1]]},FireRingFb:{btns:[["FireRingWin/viewStack/selectedChild/btnChallenge",1],["FireRingWin/viewStack/selectedChild/btnGet0",1]]},LyMarkPanel:{btns:[["FireRingWin/viewStack/selectedChild/lvupBtn",1]]}},backBtn:"UIView2/closeBtn"},HuntWarnBuyWin:{COMMENT:"寻宝券购买",btns:[["HuntWarnBuyWin/yesBtn",1]],backBtn:"UIView2/closeBtn"},HeirloomWin:{COMMENT:"套装",btns:[["HeirloomWin/roleSelect/role0",1,function(mgr,ele){return ele["redPoint"].visible},2],["HeirloomWin/roleSelect/role1",1,function(mgr,ele){return ele["redPoint"].visible},2],["HeirloomWin/roleSelect/role2",1,function(mgr,ele){return ele["redPoint"].visible},2],["HeirloomWin/pos0",1,"redPoint",1],["HeirloomWin/pos1",1,"redPoint",1],["HeirloomWin/pos2",1,"redPoint",1],["HeirloomWin/pos3",1,"redPoint",1],["HeirloomWin/pos4",1,"redPoint",1],["HeirloomWin/pos5",1,"redPoint",1],["HeirloomWin/pos6",1,"redPoint",1],["HeirloomWin/pos7",1,"redPoint",1],["HeirloomWin/jihuo",1]],backBtn:"UIView2/closeBtn"},PaoDianNpcTalkWin:{COMMENT:"决战云巅",btns:[["PaoDianNpcTalkWin/goTo",1]],backBtn:"UIView2/closeBtn"},GwResultView:{COMMENT:"通关评价",btns:[["GwResultView/closeBtn",1]],backBtn:"GwResultView/closenoget"},MineRobWin:{COMMENT:"矿洞结果",btns:[["MineRobWin/handleBtn",1]],backBtn:"MineRobWin/closeBtn"}};this.ccgToClicks=[];this.ccgRefreshData={};this.sysEntrances={UIView2:["bagBtn","roleBtn","furnaceBtn","taskBtn","forgingBtn"]};this.clickedEntrances={};this.tcseidx=-1;this.lastViewName=null;this.uiShowUpTimes=null;this.testReportStarted=false}AutoTestMgr.ins=function(){if(this.singleton==null){this.singleton=new AutoTestMgr}return this.singleton};AutoTestMgr.prototype.regEventListeners=function(){MessageCenter.addListener(GameLogic.ins().postEnterMap,this.onEnterMap,this,undefined)};AutoTestMgr.prototype.getOperatableTopUIs=function(){var allTopUIs=this.getAllTopUIs();var result=[];for(var i=allTopUIs.length-1;i>=0;i--){var ui=allTopUIs[i];var uiClass=ui["__proto__"]["__class__"];if(this.ignoreUIs[uiClass]){continue}if(this.coexistUIs[uiClass]){result.push(ui);continue}result.push(ui);break}return result};AutoTestMgr.prototype.getAllTopUIs=function(){var result=[];for(var _i=0,_a=this.allLayers;_i<_a.length;_i++){var layer=_a[_i];for(var i=0,c=layer.numChildren;i<c;++i){var child=layer.getChildAt(i);if(child.visible){result.push(child)}}}return result};AutoTestMgr.prototype.getTopUI=function(uiName){for(var _i=0,_a=this.allLayers;_i<_a.length;_i++){var layer=_a[_i];for(var i=0,c=layer.numChildren;i<c;++i){var child=layer.getChildAt(i);if(child["__class__"]==uiName){return child}}}};AutoTestMgr.prototype.getClickableElements=function(topUI){var result={};var u;if(topUI instanceof BaseEuiView){u=topUI}else{u=this.getTopUI(topUI)}this.getClickableRecursive(u["__proto__"]["__class__"],u,result);return result};AutoTestMgr.prototype.isUIParent=function(child,parent){var u=child.parent;while(u!=null){if(u==parent){return true}u=u.parent}return false};AutoTestMgr.prototype.getClickableRecursive=function(prefix,uiNode,elements){for(var k in uiNode){var v=uiNode[k];if(v&&v.visible&&v instanceof egret.DisplayObject&&this.isUIParent(v,uiNode)){var elementPath=prefix+"/"+k;elements[elementPath]=v;if(v instanceof egret.DisplayObjectContainer){this.getClickableRecursive(elementPath,v,elements)}}}};AutoTestMgr.prototype.getTabBarBtns=function(topUI){var allElements=this.getClickableElements(topUI);var result={};for(var k in allElements){var v=allElements[k];if(v instanceof eui.TabBar){var count=v.numElements;for(var i=0;i<count;++i){var btn=v.getElementAt(i);result[k+"/"+i]=btn}}}return result};AutoTestMgr.prototype.getActivatedViews=function(topUI){var allElements=this.getClickableElements(topUI);var result={};for(var k in allElements){var v=allElements[k];if(v instanceof eui.ViewStack){var view=v.selectedChild;result[k+"/selectedChild"]=view}}return result};AutoTestMgr.prototype.getElementByName=function(topUI,elementName){return topUI[elementName]};AutoTestMgr.prototype.getElementWorldPos=function(element,resultPoint){return element.localToGlobal(element.width/2,element.height/2,resultPoint)};AutoTestMgr.prototype.clickWorldPos=function(worldPoint){if(this.webPlayer==null){if(window["isSmallGame"]){this.webPlayer=window["player"]}else{var list=document.querySelectorAll(".egret-player");var length_2=list.length;for(var i=0;i<length_2;i++){var container=list[i];var player=container["egret-player"];if(player!=null){this.webPlayer=player;break}}}}if(this.webPlayer){var touch=this.webPlayer.webTouchHandler.touch;var touchId=Math.floor(Math.random()*2147483648);setTimeout(function(){touch.onTouchBegin(worldPoint.x,worldPoint.y,touchId);setTimeout(function(){touch.onTouchEnd(worldPoint.x,worldPoint.y,touchId)},200)},100)}};AutoTestMgr.prototype.checkElementClicked=function(element,clickedCB,notClickedCB,checkTime){if(checkTime===void 0){checkTime=500}var self=this;var info={timeoutId:null};function onClicked(){element.removeEventListener("touchTap",onClicked,self);clearTimeout(info.timeoutId);clickedCB()}info.timeoutId=setTimeout(function(){element.removeEventListener("touchTap",onClicked,self);notClickedCB()});element.addEventListener("touchTap",onClicked,self)};AutoTestMgr.prototype.temporaryPauseGuide=function(untilSecsPassed){this.noGuideUntilTime=TimerManager.ins().getCurrTime()+untilSecsPassed*1e3};AutoTestMgr.prototype.isGuidePaused=function(){return this.noGuideUntilTime!=null&&TimerManager.ins().getCurrTime()<this.noGuideUntilTime};AutoTestMgr.prototype.temporaryPauseGuanqia=function(untilSecsPassed){this.noGuanqiaUntilTime=TimerManager.ins().getCurrTime()+untilSecsPassed*1e3};AutoTestMgr.prototype.isGuanqiaPaused=function(){return this.noGuanqiaUntilTime!=null&&TimerManager.ins().getCurrTime()<this.noGuanqiaUntilTime};AutoTestMgr.prototype.onFbResult=function(fbType){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}switch(fbType){case UserFb.FB_TYPE_NEW_WORLD_BOSS:case UserFb.FB_TYPE_CITY:case UserFb.FB_TYPE_ALLHUMENBOSS:case UserFb.FB_TYPE_ZHUANSHENGBOSS:case UserFb.FB_TYPE_HOMEBOSS:case UserFb.FB_TYPE_LABA:case UserFb.FB_TYPE_DARK_BOSS:case UserFb.FB_TYPE_HIDE_BOSS:case UserFb.FB_TYPE_GOD_WEAPON:case UserFb.FB_TYPE_GOD_WEAPON_TOP:case UserFb.FB_TYPE_KF_BOSS:break;case UserFb.FB_TYPE_PERSONAL:case UserFb.FB_TYPE_GUARD_WEAPON:case UserFb.FB_TYPE_TIAOZHAN:case UserFb.FB_TYPE_FIRE_RING:case UserFb.FB_TYPE_MATERIAL:if(!param[0]){this.temporaryPauseGuide(10*60)}break;default:if(!param[0]){this.temporaryPauseGuanqia(10*60)}break}};AutoTestMgr.prototype.getCurrentGuide=function(){var guideView=GuideUtils.ins().view;if(guideView&&guideView.parent){var mc=guideView["mc"];var pt=mc.localToGlobal(0,0);return{hasGuide:true,isForceGuide:true,stageX:pt.x,stageY:pt.y}}var mapView=ViewManager.ins().getView(GameSceneView).map;var playFunView=ViewManager.ins().getView(PlayFunView);var coveredMap=true;var otuis=this.getOperatableTopUIs();for(var _i=0,otuis_1=otuis;_i<otuis_1.length;_i++){var otui=otuis_1[_i];if(otui["__class__"]=="PlayFunView"){coveredMap=false;break}}if(!coveredMap){var hasEff=false;var taskTraceBtn=playFunView.taskTraceBtn;for(var i=0,c=taskTraceBtn.numChildren;i<c;++i){var child=taskTraceBtn.getChildAt(i);if(child instanceof MovieClip&&child.visible){var data=UserTask.ins().taskTrace;if(data.state!=1){if(this.isGuidePaused()){return null}}var config=UserTask.ins().getAchieveConfById(data.id);if(child.name!="resource/res/eff/achieveCom"||config&&config.controlTarget!=null){hasEff=true}break}}var hasTaskGuide=playFunView.taskTraceBtn.visible&&(GameGuider.taskEffect&&GameGuider.taskEffect.parent!=null||hasEff)&&GameMap.fbType==0;if(hasTaskGuide){var btn=playFunView.taskTraceBtn;var pt=btn.localToGlobal(btn.width/2,btn.height/2);return{hasGuide:true,isForceGuide:false,stageX:pt.x,stageY:pt.y}}}return null};AutoTestMgr.prototype.isNumber=function(val){var regPos=/^\d+(\.\d+)?$/;var regNeg=/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/;if(regPos.test(val)||regNeg.test(val)){return true}else{return false}};AutoTestMgr.prototype.tokensToPath=function(tokens){var result="";for(var i=0,c=tokens.length;i<c;++i){result+=tokens[i];if(i<c-1){result+="/"}}return result};AutoTestMgr.prototype.getUIsByPathRecursive=function(tokens,curIdx,parent,allUIs,thePath){if(curIdx>=tokens.length){allUIs.push([parent,thePath]);return}if(parent==null){return}var curToken=tokens[curIdx];if(curToken=="*"){if(parent instanceof eui.List||parent instanceof eui.DataGroup){for(var i=0,c=parent.numElements;i<c;++i){this.getUIsByPathRecursive(tokens,curIdx+1,parent.getElementAt(i),allUIs,thePath+"/"+i)}}}else if(this.isNumber(curToken)){if(parent instanceof eui.TabBar||parent instanceof eui.List||parent instanceof eui.DataGroup){var btnIdx=parseInt(curToken);this.getUIsByPathRecursive(tokens,curIdx+1,parent.getElementAt(btnIdx),allUIs,thePath+"/"+curToken)}}else{this.getUIsByPathRecursive(tokens,curIdx+1,parent[curToken],allUIs,thePath+"/"+curToken)}};AutoTestMgr.prototype.getUIsByPath=function(uiPath){if(uiPath==null){return null}var result=[];var tokens=uiPath.split("/");if(tokens.length>=2){var topUIName=tokens[0];var topUI=this.getTopUI(topUIName);this.getUIsByPathRecursive(tokens,1,topUI,result,topUIName)}return result};AutoTestMgr.prototype.getUIByPath=function(uiPath){var uis=this.getUIsByPath(uiPath);if(uis&&uis.length>0){return uis[0][0]}else{return null}};AutoTestMgr.prototype.clickUI=function(uiElement){if(uiElement==null){return}var ele;if(uiElement instanceof egret.DisplayObject){ele=uiElement}else{ele=this.getUIByPath(uiElement)}if(ele){var pt=ele.localToGlobal(ele.width/2,ele.height/2);this.clickWorldPos(pt)}};AutoTestMgr.prototype.onEnterMap=function(){if(!this.firstTimeCheck){this.firstTimeCheck=true;this.__th_at=GetUrlParam("__th_at");if(this.__th_at=="1"||this.__th_at=="2"){this.enabled=true}var __th_fr=GetUrlParam("__th_fr");if(__th_fr!=null&&__th_fr!=""){StageUtils.ins().setFrameRate(parseInt(__th_fr))}}this.tryStart()};AutoTestMgr.prototype.tryStart=function(){if(this.enabled){if(this.labelDebug==null){var labelDebug=new eui.Label;this.labelDebug=labelDebug;labelDebug.size=18;labelDebug.textAlign="center";labelDebug.verticalAlign="middle";labelDebug.width=580;labelDebug.y=280;labelDebug.touchEnabled=false;labelDebug.textColor=16777215;labelDebug.strokeColor=0;labelDebug.stroke=1;labelDebug.visible=false;if(this.__th_at=="2"){labelDebug.visible=true}GameSceneView.instance.parent.parent.addChild(labelDebug)}else{GameSceneView.instance.parent.parent.removeChild(this.labelDebug);GameSceneView.instance.parent.parent.addChild(this.labelDebug)}}if(this.enabled&&this.labelDebug!=null&&!this.timerInited){this.timerInited=true;TimerManager.ins().doTimer(500,0,this.updateDebugMsg,this)}};AutoTestMgr.prototype.updateDebugMsg=function(){if(this.labelDebug&&!this.paused){var debugMsg="";var allTopUIs=this.getAllTopUIs();debugMsg+="all top uis = [";for(var _i=0,allTopUIs_1=allTopUIs;_i<allTopUIs_1.length;_i++){var ui=allTopUIs_1[_i];debugMsg+=ui["__proto__"]["__class__"]+", "}debugMsg+="]\n";var operatableUIs=this.getOperatableTopUIs();debugMsg+="operatable uis = [";for(var _a=0,operatableUIs_1=operatableUIs;_a<operatableUIs_1.length;_a++){var ui=operatableUIs_1[_a];debugMsg+=ui["__proto__"]["__class__"]+", "}debugMsg+="]\n";var g=this.getCurrentGuide();debugMsg+="guide = ";if(g!=null){debugMsg+=JSON.stringify(g)}debugMsg+="\n";debugMsg+="GameMap.fbType = "+GameMap.fbType+", GameMap.fubenID = "+GameMap.fubenID;debugMsg+="\n";this.clickCurGuide();this.labelDebug.text=debugMsg}};AutoTestMgr.prototype.clickCurGuideBtnData=function(curUIName,btnss){if(this.ccgRefreshData[curUIName]==null){this.ccgRefreshData[curUIName]={}}for(var level=0;level<=4;++level){var ok=this.clickCurGuideBtnDataImpl(curUIName,btnss,level);if(ok){break}}};AutoTestMgr.prototype.allParentsVisible=function(u){var lastU=null;while(u!=null){if(!(u instanceof egret.Stage||u.visible)){return false}lastU=u;u=u.parent}return lastU instanceof egret.Stage};AutoTestMgr.prototype.clickCurGuideBtnDataImpl=function(curUIName,btnss,allowedLevel){for(var _i=0,btnss_1=btnss;_i<btnss_1.length;_i++){var btns=btnss_1[_i];for(var _a=0,btns_1=btns;_a<btns_1.length;_a++){var btn=btns_1[_a];var btnPath=btn[0];var clickCnt=btn[1];var condFunc=btn[2];var refreshLv=btn[3];var clicklimit=btn[4]||0;if(refreshLv==null){refreshLv=0}if(allowedLevel!=refreshLv){continue}if(typeof btnPath=="function"){btnPath=btnPath(this)}var btnUIs=this.getUIsByPath(btnPath);if(btnUIs){for(var _b=0,btnUIs_1=btnUIs;_b<btnUIs_1.length;_b++){var btnUIArr=btnUIs_1[_b];var btnUI=btnUIArr[0];var btnUIPath=btnUIArr[1];if(this.ccgRefreshData[curUIName][refreshLv]&&this.ccgRefreshData[curUIName][refreshLv][btnUIPath]&&this.ccgRefreshData[curUIName][refreshLv][btnUIPath]>=clicklimit){continue}if(btnUI&&this.allParentsVisible(btnUI)){if(condFunc){if(typeof condFunc=="function"&&!condFunc(this,btnUI)){continue}else if(condFunc=="redPoint"){if(!(btnUI["redPoint"]&&btnUI["redPoint"].visible)){continue}}}for(var i=0;i<clickCnt;++i){this.ccgToClicks.push(btnUI)}var toDeletes=[];for(var k in this.ccgRefreshData[curUIName]){var kk=parseInt(k);if(kk<refreshLv){toDeletes.push(k)}}for(var _c=0,toDeletes_2=toDeletes;_c<toDeletes_2.length;_c++){var toDelete=toDeletes_2[_c];delete this.ccgRefreshData[curUIName][toDelete]}if(this.ccgRefreshData[curUIName][refreshLv]==null){this.ccgRefreshData[curUIName][refreshLv]={}}if(this.ccgRefreshData[curUIName][refreshLv][btnUIPath]==null){this.ccgRefreshData[curUIName][refreshLv][btnUIPath]=1}else{this.ccgRefreshData[curUIName][refreshLv][btnUIPath]++}return true}else{continue}}}}}return false};AutoTestMgr.prototype.tryClickSystemEntrance=function(){if(this.ccgToClicks.length>0){return}if(this.clickedEntrances==null){this.clickedEntrances={}}this.tcseidx=(this.tcseidx+1)%8;if(this.tcseidx<1){var btns1=this.sysEntrances["UIView2"];for(var i=0;i<5;++i){var btn=btns1[(i+this.tcseidx)%btns1.length];var btnPath="UIView2/"+btn;var btnEle=this.getUIByPath(btnPath);if(!this.clickedEntrances[btn]&&btnEle["redPoint"]&&btnEle["redPoint"].visible){this.clickedEntrances[btn]=1;this.ccgToClicks.push(btnPath);return}}}else if(this.tcseidx==1){var pfv=this.getTopUI("PlayFunView");if(pfv){var ruleList=pfv.ruleList;var ruleMap={};for(var k in ruleList){var rule=ruleList[k];if(rule.isShow){ruleMap[rule["__class__"]]=rule}}var rule3=["BossIconRule","FbBtnIconRule","LadderBtnIconRule"];var idx0=Math.floor(Math.random()*rule3.length);for(var i=0;i<rule3.length;++i){var idx=(idx0+i)%rule3.length;var rndRule=rule3[idx];var selectedRule=ruleMap[rndRule];if(selectedRule&&selectedRule.isShow&&selectedRule.tar.redPoint.visible){this.ccgToClicks.push(selectedRule.tar);return}}}}else if(this.tcseidx>=2&&this.tcseidx<=7){var pfv=this.getTopUI("PlayFunView");if(pfv){var ruleList=pfv.ruleList;var rules=[];for(var k in ruleList){var rule=ruleList[k];var hasEff=false;var tar=rule.tar;if(tar){for(var i=0,c=tar.numChildren;i<c;++i){var child=tar.getChildAt(i);if(child instanceof MovieClip){hasEff=true;break}}}if(rule.isShow&&tar&&tar.visible&&(tar["redPoint"]&&tar["redPoint"].visible||hasEff)){rules.push(rule)}}if(rules.length>0){var selectedRule=rules[Math.floor(Math.random()*rules.length)];this.ccgToClicks.push(selectedRule.tar);return}}}};AutoTestMgr.prototype.clickCurGuide=function(){var curTime=TimerManager.ins().getCurrTime();var clickSysEntrances=curTime%(2*60*1e3)<.8*60*1e3&&GameMap.fbType==0;if(!clickSysEntrances){this.clickedEntrances=null}var operatableUIs=this.getOperatableTopUIs();if(operatableUIs.length>0){var curUI=operatableUIs[operatableUIs.length-1];var curUIName=curUI["__class__"];if(this.lastViewName!=null&&this.lastViewName!=curUIName){this.ccgToClicks.splice(0);if(this.lastViewName=="PlayFunView"||curUIName=="PlayFunView"){this.ccgRefreshData={}}}this.lastViewName=curUIName;if(curUIName=="PlayFunView"){this.uiShowUpTimes=null}}if(this.ccgToClicks.length>0){var eleToClick=this.ccgToClicks.shift();this.clickUI(eleToClick);return}var guide=this.getCurrentGuide();if(guide!=null&&guide.hasGuide&&(guide.isForceGuide||Math.random()<.5)){this.clickWorldPos(new egret.Point(guide.stageX,guide.stageY));return}if(operatableUIs.length>0){var curUI=operatableUIs[operatableUIs.length-1];var curUIName=curUI["__class__"];if(curUIName=="PlayFunView"){this.uiShowUpTimes=null}else{if(this.uiShowUpTimes==null){this.uiShowUpTimes={}}var now=TimerManager.ins().getCurrTime();if(this.uiShowUpTimes[curUIName]==null){this.uiShowUpTimes[curUIName]=now}var autoTestData=this.autoTestData;var uiData=autoTestData[curUIName];if(now-this.uiShowUpTimes[curUIName]>5*60*1e3){if(uiData){this.ccgToClicks.push(uiData["backBtn"])}else{if(this.getTopUI("GameSceneView")==null){this.ccgToClicks.push("UIView2/closeBtn")}else{this.ccgToClicks.push("GameSceneView/escBtn")}}return}}if(curUIName=="PlayFunView"&&clickSysEntrances){this.tryClickSystemEntrance()}else{var autoTestData=this.autoTestData;var uiData=autoTestData[curUIName];var btnss=[];if(uiData){var viewPath=uiData["viewPath"];var viewIdxMode=uiData["viewIdxMode"];if(viewPath){var curView=this.getUIByPath(viewPath);if(curView){var curViewName=curView["__class__"];if(viewIdxMode){curViewName=curView.parent["selectedIndex"]}var views=uiData["views"];var view=views[curViewName];if(view){btnss.push(view["btns"])}}}var btns=uiData["btns"];if(btns){btnss.push(btns)}this.clickCurGuideBtnData(curUIName,btnss);var backBtn=uiData["backBtn"];if(backBtn&&this.ccgToClicks.length==0){this.ccgToClicks.push(backBtn);this.ccgRefreshData[curUIName]=null}}else{this.ccgToClicks.push("UIView2/closeBtn")}}}};AutoTestMgr.prototype.reportError=function(msg){};AutoTestMgr.prototype.tryStartTestReport=function(){if(this.testReportStarted){return false}this.testReportStarted=true;window.onerror=function(){var info=[];for(var _i=0;_i<arguments.length;_i++){info[_i]=arguments[_i]}var funName="";var callPos="";console.log("[OS] = "+egret.Capabilities.os);console.log(info);if(egret.Capabilities.os=="iOS"){if(info[4]&&info[4].stack){callPos=info[4].stack.toString()}}else{if(info[4]&&info[4].stack){var list=info[4].stack.split("at ");if(list[1]!=null){funName=list[1].split(" ")[0];for(var i=2;i<list.length;i++){var arr=list[i].split("/");callPos+=arr[arr.length-1]}}}}var str="兼容问题无法获取值";var resultStr="错误信息："+info[0]+"\n"+("出错位置："+info[2]+"行"+(info[3]?info[3]+"列":str)+"\n")+("出错函数："+funName+"\n")+("函数调用："+callPos);if(resultStr.indexOf(str)>=0)return;AutoTestMgr.ins().reportError(resultStr)};var old_onLoadFinish=RES.ImageAnalyzer.prototype["onLoadFinish"];RES.ImageAnalyzer.prototype["onLoadFinish"]=function(event){var request=event.$target;var data=this.resItemDic[request.$hashCode];var resItem=data.item;resItem.loaded=event.$type==egret.Event.COMPLETE;if(!resItem.loaded){AutoTestMgr.ins().reportError("资源加载失败："+resItem.name)}old_onLoadFinish.apply(this,[event])}};return AutoTestMgr}();__reflect(AutoTestMgr.prototype,"AutoTestMgr");var ProfilingMgr=function(){function ProfilingMgr(){this.enabled=false;this.timerInited=false;this.memoryUsed=0;this.cpuUsed=0}ProfilingMgr.ins=function(){if(this.singleton==null){this.singleton=new ProfilingMgr}return this.singleton};ProfilingMgr.prototype.tryStart=function(){if(this.enabled){if(this.labelDebug==null){var labelDebug=new eui.Label;this.labelDebug=labelDebug;labelDebug.size=18;labelDebug.textAlign="center";labelDebug.verticalAlign="middle";labelDebug.width=580;labelDebug.y=280;labelDebug.touchEnabled=false;labelDebug.textColor=16777215;labelDebug.strokeColor=0;labelDebug.stroke=1;labelDebug.visible=false;labelDebug.visible=true;GameSceneView.instance.parent.parent.addChild(labelDebug)}else{GameSceneView.instance.parent.parent.removeChild(this.labelDebug);GameSceneView.instance.parent.parent.addChild(this.labelDebug)}}if(this.enabled&&this.labelDebug!=null&&!this.timerInited){this.timerInited=true;TimerManager.ins().doTimer(1e3,0,this.updateDebugMsg,this)}};ProfilingMgr.prototype.updateDebugMsg=function(){if(this.labelDebug){var debugMsg="";var self=this;if(JsNativeCallMgr.hasMethod("memoryUsage")){JsNativeCallMgr.callMethod("memoryUsage",function(memoryUsed){self.memoryUsed=memoryUsed})}if(JsNativeCallMgr.hasMethod("cpu_usage")){JsNativeCallMgr.callMethod("cpu_usage",function(cpu_usage){self.cpuUsed=cpu_usage})}var mb=Math.floor(this.memoryUsed/1024/1024);var cpuPc=Math.floor(this.cpuUsed);debugMsg+="memory = "+mb+"MB, cpu = "+cpuPc+"%";debugMsg+="\n";var _displayList=egret.BitmapData["_displayList"];var disCnt=0;var bitmapDatas={};for(var k in _displayList){disCnt+=1;var varr=_displayList[k];for(var _i=0,varr_1=varr;_i<varr_1.length;_i++){var v=varr_1[_i];if(v instanceof egret.Bitmap){bitmapDatas[v.texture.bitmapData.hashCode]=v.texture.bitmapData}}}var bdCnt=0;var pixelSize=0;for(var kd in bitmapDatas){bdCnt+=1;var vd=bitmapDatas[kd];pixelSize+=vd.width*vd.height*4}var pixelSizeMB=Math.floor(pixelSize/1024/1024);debugMsg+="len(_displayList) = "+disCnt+", len(bitmapDatas) = "+bdCnt+", pixelSize = "+pixelSizeMB+"MB";debugMsg+="\n";var baseAnalyzer=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE);var fileDic=baseAnalyzer["fileDic"];var fileDicCnt=0;var textureSize=0;bitmapDatas={};for(var key in fileDic){var texture=fileDic[key];fileDicCnt+=1;var v=texture.bitmapData;if(v){bitmapDatas[v.hashCode]=v}}var bdCnt=0;var pixelSize=0;for(var kd in bitmapDatas){bdCnt+=1;var vd=bitmapDatas[kd];pixelSize+=vd.width*vd.height*4}var pixelSizeMB=Math.floor(pixelSize/1024/1024);debugMsg+="len(fileDic) = "+disCnt+", len(bitmapDatas) = "+bdCnt+", pixelSize = "+pixelSizeMB+"MB";debugMsg+="\n";debugMsg+="destroyRes = "+ResourceMgr.ins().destroyResCalledNum+", destroyUIRes = "+ResourceMgr.ins().destroyResCalledNum;debugMsg+="\n";debugMsg+="egret.Capabilities.os = "+egret.Capabilities.os;debugMsg+="\n";this.labelDebug.text=debugMsg}};ProfilingMgr.prototype.webglSupport=function(){var support=false;if(egret.Capabilities.renderMode=="webgl"){support=true}return support};return ProfilingMgr}();__reflect(ProfilingMgr.prototype,"ProfilingMgr");var DepotType;(function(DepotType){DepotType[DepotType["Equip"]=0]="Equip";DepotType[DepotType["Rune"]=1]="Rune";DepotType[DepotType["Heirloom"]=2]="Heirloom";DepotType[DepotType["ShapeShiftingTreasure"]=3]="ShapeShiftingTreasure";DepotType[DepotType["TicketLingShiTreasure"]=4]="TicketLingShiTreasure"})(DepotType||(DepotType={}));window["DepotType"]=DepotType;var ItemData=function(){function ItemData(){this._point=-1}ItemData.prototype.parser=function(bytes){this.handle=bytes.readDouble();this.configID=bytes.readInt();this.count=bytes.readInt();this.att=[];for(var i=0;i<8;i++){var att=new AttributeData(bytes.readInt(),bytes.readInt());this.att.push(att)}this.extAtt=[];for(var i=0;i<8;i++){var att=new AttributeData(bytes.readInt(),bytes.readInt());this.extAtt.push(att)}};Object.defineProperty(ItemData.prototype,"configID",{get:function(){return this._configID},set:function(value){this.itemConfig=GlobalConfig.ItemConfig[value];if(value!=0){Assert(this.itemConfig,i18n("ItemData_0")+value+i18n("ItemData_1"))}this._point=-1;this._configID=value;this.setCanbeUsed()},enumerable:true,configurable:true});ItemData.getStringByList=function(str,newline,addStr){if(newline===void 0){newline=1}if(addStr===void 0){addStr=": "}var ret="";for(var i=0;i<str.length;i++){ret+=str[i]+addStr;if(i<str.length-1){for(var j=0;j<newline;j++)ret+="\n"}}return ret};ItemData.getStringByNextList=function(now,next){var ret="";for(var i=0;i<now.length;i++){ret+=now[i];if(next[i]){ret+=next[i]}if(i<now.length-1){ret+="\n"}}return ret};Object.defineProperty(ItemData.prototype,"point",{get:function(){if(this._point==-1){this._point=ItemConfig.calculateBagItemScore(this)}return this._point},enumerable:true,configurable:true});ItemData.prototype.setCanbeUsed=function(){if(!this.itemConfig)return;if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_20){this.canbeUsed=SpecialRing.ins().checkCanUseByItem(this.itemConfig.id)}else if(this.itemConfig.useType==1||this.itemConfig.useType==2){if(UserZs.ins().lv<this.itemConfig.zsLevel&&Actor.level<this.itemConfig.level){this.canbeUsed=false}else{if(this.itemConfig.id==230001||this.itemConfig.id==230002||this.itemConfig.id==230003){this.canbeUsed=false}else{this.canbeUsed=true}if(Math.floor(this.itemConfig.id/1e4)==26){var id=this.itemConfig.id%26e4;var bookData=Book.ins().getBookById(id);var state=bookData.getState();this.canbeUsed=state==BookState.canOpen}}}else{this.canbeUsed=false}};ItemData.prototype.getCanbeUsed=function(){return this.canbeUsed};ItemData.prototype.copy=function(item){if(!item)item=new ItemData;var self=this;item.handle=self.handle;item.configID=self.configID;item.count=self.count;item._point=self._point;item.att=[];for(var i=0;i<8;i++){var att=new AttributeData(self.att[i].type,self.att[i].value);item.att.push(att)}item.extAtt=[];for(var i=0;i<8;i++){var att=new AttributeData(self.extAtt[i].type,self.extAtt[i].value);item.extAtt.push(att)}return item};ItemData.prototype.init=function(){this.handle=0;this.configID=0;this.count=0;this.att=[];for(var i=0;i<8;i++){var att=new AttributeData(0,0);this.att.push(att)}this.extAtt=[];for(var i=0;i<8;i++){var att=new AttributeData(0,0);this.extAtt.push(att)}};return ItemData}();__reflect(ItemData.prototype,"ItemData");var UserBag=function(_super){__extends(UserBag,_super);function UserBag(){var _this=_super.call(this)||this;_this.bagNum=0;_this.bagModel=[];_this.isExitUsedItem=0;_this.isChange=0;_this.OrangeEquipRedPoint=[];_this.autoMeltOpened=0;_this.itemCount={0:{},1:{}};_this.exchange_info={5:{}};_this.promptList=["",i18n("UserBag_0"),"",i18n("UserBag_1"),i18n("UserBag_2"),i18n("UserBag_3"),"","",i18n("UserBag_9")];_this.sendCooling=false;_this.equipPowerDic=[];_this.wearList=[];_this.sysId=PackageID.Bag;_this.regNetMsg(1,_this.doBagData);_this.regNetMsg(2,_this.doBagValumnAdd);_this.regNetMsg(3,_this.doDeleteItem);_this.regNetMsg(4,_this.doAddItem);_this.regNetMsg(5,_this.doUpDataItem);_this.regNetMsg(6,_this.doUserItemBack);_this.regNetMsg(7,_this.postMergeItemBack);_this.regNetMsg(8,_this.doChoosableGiftResult);_this.regNetMsg(9,_this.doShowAwards);_this.regNetMsg(10,_this.postExchangeData);_this.regNetMsg(11,_this.postExchangeRes);_this.observe(Recharge.ins().postGetMonthDay,_this.doBagVolChange);_this._useItemFunc={};_this.registerUseItemFunc(ItemConst.RENAME,_this.useRenameItem);for(var i=0;i<8;i++){_this.OrangeEquipRedPoint[i]=false}return _this}UserBag.ins=function(){return _super.ins.call(this)};Object.defineProperty(UserBag,"canAutoMelt",{get:function(){return UserBag.auto_smelt!=2},enumerable:true,configurable:true});Object.defineProperty(UserBag,"auto_smelt",{get:function(){return UserBag.ins().autoMeltOpened},set:function(f){UserBag.ins().autoMeltOpened=f;UserBag.ins().checkAutoMelt()},enumerable:true,configurable:true});Object.defineProperty(UserBag,"fitleEquip",{get:function(){if(!UserBag._fitleEquip){UserBag._fitleEquip=[];for(var k in GlobalConfig.SpecialEquipsConfig){if(GlobalConfig.SpecialEquipsConfig[k].style==FitleStyle.hc)UserBag._fitleEquip.push(GlobalConfig.SpecialEquipsConfig[k].id)}}return UserBag._fitleEquip},enumerable:true,configurable:true});UserBag.prototype.sendAddBagGrid=function(num){var bytes=this.getBytes(2);bytes.writeInt(num);this.sendToServer(bytes)};UserBag.prototype.sendUseItem=function(id,count){if(this._useItemFunc[id]!=null){this._useItemFunc[id](id,count);return true}var bytes=this.getBytes(6);bytes.writeInt(id);bytes.writeInt(count);this.sendToServer(bytes);return false};UserBag.prototype.sendUserGoods=function(id,count){};UserBag.prototype.addItemCount=function(type,item){var id=item.configID;if(item.count==0){this.delItemCount(type,id);return}this.itemCount[type][id]=this.itemCount[type][id]||0;if(type==1){this.itemCount[type][id]+=1}else{this.itemCount[type][id]=item.count}};UserBag.prototype.delItemCount=function(type,delId){if(type==1){if(this.itemCount[type][delId]){this.itemCount[type][delId]-=1;if(this.itemCount[type][delId]==0)delete this.itemCount[type][delId]}}else{delete this.itemCount[type][delId]}};UserBag.prototype.getBagItemCount=function(type,id){return this.itemCount[type][id]||0};UserBag.prototype.doBagData=function(bytes){var code=bytes.readByte();var type=bytes.readByte();if(code==0){this.bagModel[type]=[];this.itemCount[type]={}}var len=bytes.readInt();var itemModel;for(var i=0;i<len;i++){itemModel=new ItemData;itemModel.parser(bytes);this.bagModel[type].push(itemModel);if(type==0||type==1){this.addItemCount(type,itemModel)}}UserBag.ins().postItemAdd();if(type==1){this.doBagVolChange()}if(type==2){UserBag.ins().postHuntStore()}this.getIsExitUsedItem();UserBag.ins().postHasItemCanUse();UserBag.ins().checkAutoMelt()};UserBag.prototype.doBagVolChange=function(){this.postBagVolChange()};UserBag.prototype.postBagVolChange=function(){var b=this.ronglianCheck();this.isChange=b?1:0;var count=b?2:0;UserBag.ins().postItemCountChange();if(!b){b=this.getSurplusCount()<this.getMaxBagRoom()*.05;count=b?1:0}UserBag.ins().postBagWillFull(count)};UserBag.prototype.ronglianCheck=function(){var total=this.bagNum;if(GlobalConfig&&GlobalConfig.VipGridConfig&&GlobalConfig.VipGridConfig[UserVip.ins().lv]){total+=GlobalConfig.VipGridConfig[UserVip.ins().lv].grid+Recharge.ins().getAddBagGrid()}var ins=UserBag.ins();var isFind=false;var b=UserFb.ins().guanqiaID>50?this.getBagItemNum()/total>=.8:this.getBagItemNum()>=50;if(b){var list=ins.getOutEquips(false);for(var _i=0,list_7=list;_i<list_7.length;_i++){var data=list_7[_i];if(data&&data.itemConfig){isFind=true;break}}}return isFind};UserBag.prototype.UseItemSuccessShow=function(){};UserBag.prototype.doUserItemBack=function(bytes){var index=bytes.readByte();if(index>0){UserTips.ins().showTips(this.promptList[index])}else if(index==0){UserBag.ins().postUseItemSuccess()}UserBag.ins().checkAutoMelt()};UserBag.prototype.doBagValumnAdd=function(bytes){this.bagNum=bytes.readInt();UserBag.ins().postBagVolAdd();UserBag.ins().checkAutoMelt()};UserBag.prototype.doDeleteItem=function(bytes){var type=bytes.readByte();var handle=bytes.readDouble();var delId=0;for(var i=this.bagModel[type].length-1;i>=0;i--){if(this.bagModel[type][i].handle==handle){delId=this.bagModel[type][i].configID;UserBag.ins().isExitUsedItem=this.bagModel[type][i].getCanbeUsed()?1:0;this.bagModel[type].splice(i,1);break}}if(type==0||type==1){this.delItemCount(type,delId)}if(type==2){this.deleteHasType2=true}if(!this.isDeleteDelay){this.isDeleteDelay=true;TimerManager.ins().doTimer(50,1,this.deleteDelay,this)}UserBag.ins().checkAutoMelt()};UserBag.prototype.doAddItem=function(bytes){var type=bytes.readByte();var itemModel=new ItemData;itemModel.parser(bytes);this.bagModel[type].push(itemModel);if(type==0||type==1){this.addItemCount(type,itemModel)}UserBag.ins().isExitUsedItem=itemModel.getCanbeUsed()?1:0;var showTip=bytes.readByte();if(showTip){var quality=ItemConfig.getQuality(itemModel.itemConfig);if(quality>=4&&type==1){UserTips.ins().showGoodEquipTips(itemModel)}else{if(type!=2){if(ItemConfig.getType(itemModel.itemConfig)==ItemType.TYPE_18){UserTips.ins().showHeartItemTips(itemModel.itemConfig.id)}else{var str=i18n("UserBag_4")+i18n("UserBag_7")+ItemConfig.getQualityColor(itemModel.itemConfig)+"&T:"+itemModel.itemConfig.name+" x "+itemModel.count+"|";UserTips.ins().showTips2(str)}}}}if(type==2){this.addHasType2=true}if(!this.isAddDelay){this.isAddDelay=true;TimerManager.ins().doTimer(50,1,this.addDelay,this)}if(type==1){NewEquip.ins().addItem(itemModel)}if(itemModel._configID==1016005){ViewManager.ins().close(newPlayerChapterGiftWin);ViewManager.ins().open(newBoxWin,1016005)}if(itemModel._configID==1710004){ViewManager.ins().open(UseXianYuJiaTip,itemModel)}UserBag.ins().checkAutoMelt()};UserBag.prototype.addDelay=function(){this.isAddDelay=false;UserBag.ins().postItemAdd();UserBag.ins().postHasItemCanUse();this.doBagVolChange();if(this.addHasType2){this.addHasType2=false;UserBag.ins().postHuntStore()}};UserBag.prototype.deleteDelay=function(){this.isDeleteDelay=false;UserBag.ins().postItemDel();UserBag.ins().postHasItemCanUse();this.doBagVolChange();if(this.deleteHasType2){this.deleteHasType2=false;UserBag.ins().postHuntStore()}};UserBag.prototype.doUpDataItem=function(bytes){var type=bytes.readByte();var handle=bytes.readDouble();var addNum=0;var element;for(var i=0;i<this.bagModel[type].length;i++){element=this.bagModel[type][i];if(element.handle==handle){var num=bytes.readInt();addNum=num-element.count;element.count=num;if(type==0||type==1){this.addItemCount(type,element)}UserBag.ins().isExitUsedItem=element.getCanbeUsed()?1:0;UserBag.ins().postHasItemCanUse();break}}var showTip=bytes.readByte();if(showTip){if(addNum>0){if(type!=2){if(ItemConfig.getType(element.itemConfig)==ItemType.TYPE_18){UserTips.ins().showHeartItemTips(element.itemConfig.id)}else{var quality=ItemConfig.getQualityColor(element.itemConfig);var str=i18n("UserBag_5")+i18n("UserBag_8")+quality+"&T:"+element.itemConfig.name+" x "+addNum+"|";UserTips.ins().showTips2(str)}UserBag.ins().postItemAdd(type,element)}}}this.doBagVolChange();UserBag.ins().postItemChange()};UserBag.prototype.sendMergeItem=function(id,count){var bytes=this.getBytes(7);bytes.writeInt(id);bytes.writeInt(count);this.sendToServer(bytes)};UserBag.prototype.postMergeItemBack=function(bytes){var id=bytes.readInt();var count=bytes.readInt();var len=bytes.readInt();var items=[];for(var i=0;i<len;i++){items[i]=new RewardData;items[i].parser(bytes)}UserBag.ins().checkAutoMelt();return items};UserBag.prototype.sendGetGoodsByStore=function(uuid){if(uuid==DepotType.Equip&&this.getSurplusCount()<1){var strTips=GlobalConfig.ServerTips[2].tips;UserTips.ins().showTips2(strTips);return}var bytes=this.getBytes(4);bytes.writeDouble(uuid);this.sendToServer(bytes)};UserBag.prototype.postItemChange=function(){this.checkAutoMelt()};UserBag.prototype.checkAutoMelt=function(){if(UserBag.auto_smelt==1){var own=UserBag.ins().getBagItemNum();var full=UserBag.ins().getMaxBagRoom();var p=own/full;if(p>=.5){UserBag.ins().sendSmeltAll();setTimeout(function(){UserBag.ins().postBagWillFull(-1);UserEquip.ins().showRecycle()},2e3)}}};UserBag.prototype.sendSmeltAll=function(){if(this.sendCooling){return}var self=this;self.sendCooling=true;setTimeout(function(){self.sendCooling=false},1e4);var eq=UserBag.ins().getOutEquips(true);var count=Math.ceil(eq.length/9);for(var i=0;i<count;i++){var seq=eq.slice(i*9,i*9+9);if(i==count-1){seq=eq.slice(i*9,eq.length)}UserEquip.ins().sendSmeltEquip(0,seq)}};UserBag.prototype.registerUseItemFunc=function(itemID,useFunc){this._useItemFunc[itemID]=useFunc};UserBag.prototype.postItemDel=function(){};UserBag.prototype.postItemAdd=function(type,item){if(type===void 0){type=0}if(item===void 0){item=null}if(type==0&&item&&item._configID==1016005){ViewManager.ins().close(newPlayerChapterGiftWin);ViewManager.ins().open(newBoxWin,1016005)}};UserBag.prototype.postItemCountChange=function(){return UserBag.ins().isChange};UserBag.prototype.postBagWillFull=function(willFull){return willFull};UserBag.prototype.postHuntStore=function(){};UserBag.prototype.postHasItemCanUse=function(){return UserBag.ins().isExitUsedItem};UserBag.prototype.postUseItemSuccess=function(){};UserBag.prototype.postBagVolAdd=function(){};UserBag.prototype.getBagItemById=function(id,Bag_Type){if(Bag_Type===void 0){Bag_Type=UserBag.BAG_TYPE_OTHTER}var itemData=this.bagModel[Bag_Type];if(!itemData)return null;for(var _i=0,itemData_3=itemData;_i<itemData_3.length;_i++){var data=itemData_3[_i];if(data.itemConfig.id==id)return data}return null};UserBag.prototype.getFilterBagItemById=function(id,filterAry,Bag_Type){if(Bag_Type===void 0){Bag_Type=UserBag.BAG_TYPE_OTHTER}var itemData=this.bagModel[Bag_Type];for(var _i=0,itemData_4=itemData;_i<itemData_4.length;_i++){var data=itemData_4[_i];if(data.itemConfig.id==id&&filterAry.indexOf(data.handle)<0)return data}return null};UserBag.prototype.getBagGoodsByTypeAndId=function(type,id){var itemData=this.bagModel[type];for(var _i=0,itemData_5=itemData;_i<itemData_5.length;_i++){var data=itemData_5[_i];if(data.itemConfig.id==id)return data}return null};UserBag.prototype.getBagEquipByType=function(type){var itemData=this.bagModel[UserBag.BAG_TYPE_EQUIP];var itemData1=[];for(var a in itemData){if(ItemConfig.getType(itemData[a].itemConfig)==type){itemData1.push(itemData[a])}}return itemData1};UserBag.prototype.getBagByType=function(t){return this.bagModel[t]};UserBag.prototype.getBagGoodsCountByType=function(type,ids){var itemData=this.bagModel[UserBag.BAG_TYPE_OTHTER];if(itemData){for(var i=0;i<itemData.length;i++){if(ItemConfig.getType(itemData[i].itemConfig)==8){if(itemData[i].itemConfig.bagType==DepotType.Rune){continue}if(ids){if(ids.indexOf(itemData[i].itemConfig.id)!=-1)return true}if(itemData[i].itemConfig.id==ItemConst.EXP_ITEM){if(Actor.level<65)continue}if(itemData[i].itemConfig.descIndex==814){if(!nPChapterGiftSys.ins().isCangetchapterGift())continue}if(itemData[i].itemConfig.id==ItemConst.LEVELUP_ITEM){if(this.getRmbItemIsBuy(ItemConst.LEVELUP_ITEM))return true;continue}if(itemData[i].itemConfig.id==ItemConst.WEIWANG_ITEM)continue;return true}else if(ItemConfig.getType(itemData[i].itemConfig)==12){var b=Actor.level>=itemData[i].itemConfig.level&&Guild.ins().guildID!=0?true:false;if(b)return true}else if(ItemConfig.getType(itemData[i].itemConfig)==17){return true}else{var composeConf=GlobalConfig.ItemComposeConfig[itemData[i].configID];if(composeConf&&composeConf.srcCount<=itemData[i].count){return true}}}}return false};UserBag.prototype.getRuneBagGoodsCountByType=function(type){var itemData=this.bagModel[UserBag.BAG_TYPE_OTHTER];if(itemData){for(var i=0;i<itemData.length;i++){if(ItemConfig.getType(itemData[i].itemConfig)==8){if(itemData[i].itemConfig.bagType){return true}}}}return false};UserBag.prototype.getBagGoodsCountById=function(type,id){if(type==0||type==1){return this.getBagItemCount(type,id)}var itemData=this.bagModel[type];if(itemData){for(var i=0;i<itemData.length;i++){if(itemData[i].itemConfig&&itemData[i].itemConfig.id==id)return itemData[i].count}}return 0};UserBag.prototype.getBagGoodsByIndex=function(type,index){return this.bagModel[type][index]};UserBag.prototype.getBagItemNum=function(type){if(type===void 0){type=1}var itemData=this.bagModel[type];return itemData?itemData.length:0};UserBag.prototype.getSurplusCount=function(){return this.bagNum-this.getBagItemNum()+GlobalConfig.VipGridConfig[UserVip.ins().lv].grid+Recharge.ins().getAddBagGrid()};UserBag.prototype.isBagFull=function(){return UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH};UserBag.prototype.getMaxBagRoom=function(){return this.bagNum+GlobalConfig.VipGridConfig[UserVip.ins().lv].grid+Recharge.ins().getAddBagGrid()+Recharge.ins().getAddBagFranchiseGrid()};UserBag.prototype.sort1=function(a,b){var s1=a.point;var s2=b.point;if(s1>s2)return-1;else if(s1<s2)return 1;else return 0};UserBag.prototype.sort2=function(a,b){var s1=a.point;var s2=b.point;if(s1<s2)return-1;else if(s1>s2)return 1;else return 0};UserBag.prototype.getHejiEquipsByType=function(pos){var itemData=this.bagModel[1];var list=[];for(var i=0;i<itemData.length;i++){var item=itemData[i];var type=ItemConfig.getType(item.itemConfig);var subType=ItemConfig.getSubType(item.itemConfig);if(type!=5)continue;if(subType==pos){list.push(item)}}list.sort(this.sort3);return list};UserBag.prototype.sort3=function(a,b){var s1=a.point;var s2=b.point;if(s1>s2)return-1;else if(s1<s2)return 1;if(a.configID>b.configID)return-1;else if(a.configID<b.configID)return 1;else return 0};UserBag.prototype.getBagSortEquips=function(isSort){if(isSort===void 0){isSort=0}var itemData=this.bagModel[UserBag.BAG_TYPE_EQUIP];if(isSort)itemData.sort(this.sort1);else itemData.sort(this.sort2);return itemData};UserBag.prototype.getBagSortQualityEquips=function(quality,sole,sort,filter){if(quality===void 0){quality=5}if(sole===void 0){sole=0}if(sort===void 0){sort=0}if(filter===void 0){filter=null}var list=this.bagModel[UserBag.BAG_TYPE_EQUIP];var returnList=[];if(!list)return returnList;for(var i=0;i<list.length;i++){var q=ItemConfig.getQuality(list[i].itemConfig);if(quality!=5&&(q>quality||sole&&q<quality))continue;if(filter!=null&&!filter(list[i]))continue;returnList[returnList.length]=list[i]}return returnList};UserBag.prototype.getLegendOutEquips=function(){var list=UserBag.ins().getBagEquipsByQuality(5);var returnList=[];var nowEquips=[];var roleList=[];var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(!roleList[role.job]){roleList[role.job]=[]}var equipLen=role.getEquipLen();for(var ii=0;ii<equipLen;ii++){var goods=role.getEquipByIndex(ii);if(!goods.item.itemConfig){continue}this.addOneEquipToListEx(nowEquips,goods,role.job)}}var outEquip;for(var i=0;i<list.length;i++){var item=list[i];var subType=ItemConfig.getSubType(item.itemConfig);if(subType!=0&&subType!=2)continue;var isWear=false;for(var j=0;j<nowEquips.length;j++){var pos=ItemConfig.getSubType(item.itemConfig);if(pos==subType){isWear=true;break}}if(!isWear)continue;outEquip=this.checkEquipsIsGood(nowEquips,this.cloneItemDataInfo(item));if(outEquip){if(!UserEquip.ins().checkEquipsIsWear(outEquip)&&ItemConfig.getQuality(outEquip.itemConfig)==5){returnList.push(outEquip)}}}return returnList};UserBag.prototype.getLegendHasResolve=function(){var list=UserBag.ins().getBagEquipsByQuality(4);var returnList=[];var nowEquips=[];var roleList=[];var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);var equipLen=role.getEquipLen();for(var ii=0;ii<equipLen;ii++){var goods=role.getEquipByIndex(ii);if(!goods.item.itemConfig){continue}this.addOneEquipToListRed(nowEquips,goods,i)}}var outEquip;for(var i=0;i<list.length;i++){var item=list[i];var job=ItemConfig.getJob(item.itemConfig);if(BreakDownView.fitleEquip[item.configID])continue;outEquip=this.checkEquipsIsGoodRed(nowEquips,this.cloneItemDataInfo(item));if(!outEquip){return true}}return false};UserBag.prototype.otherEquipSmeltFilter=function(item){var type=ItemConfig.getType(item.itemConfig);var subType=ItemConfig.getSubType(item.itemConfig);if(item.itemConfig&&type==4)return true;if(type==0){for(var key in ForgeConst.CAN_FORGE_EQUIP){if(ForgeConst.EQUIP_POS_TO_SUB[ForgeConst.CAN_FORGE_EQUIP[key]]==subType)return false}return true}return false};UserBag.prototype.normalEquipSmeltFilter=function(item){return ItemConfig.getType(item.itemConfig)==0};UserBag.prototype.getHejiOutEquips=function(){var returnList=[];if(returnList.length<9){this.checkHejiEquipsTodestroy(returnList)}this.creatListLength(returnList);return returnList};UserBag.prototype.getShapeShiftingOutEquips=function(){var itemList=this.getShapeShiftingPro();return itemList};UserBag.prototype.getOutEquips=function(all){if(all===void 0){all=false}var list=this.getBagSortQualityEquips(5,0,1,this.normalEquipSmeltFilter);var returnList=[];var nowEquips=[];var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);var equipLen=role.getEquipLen();for(var ii=0;ii<equipLen;ii++){var goods=role.getEquipByIndex(ii);if(!goods.item.itemConfig){continue}this.addOneEquipToList(nowEquips,goods,role.job)}}var outEquip;for(var i=0;i<list.length;i++){var item=list[i];outEquip=this.checkEquipsIsGood(nowEquips,this.cloneItemDataInfo(item));if(outEquip){if(!UserEquip.ins().checkEquipsIsWear(outEquip)&&ItemConfig.getQuality(outEquip.itemConfig)<4){if(ItemConfig.getSubType(outEquip.itemConfig)!=ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]){returnList.push(outEquip)}}}if(!all){if(returnList.length>=9){break}}}this.getGuanyinEquip(all,returnList);if(!all&&returnList.length>9){returnList=returnList.slice(0,9)}this.upLevelEquips=[];this.creatListLength(returnList);return returnList};UserBag.prototype.creatListLength=function(list){if(list.length<9){for(var i=0;i<9;i++){if(list[i]==undefined){list[i]=null}}}};UserBag.prototype.checkUpLevelEquips=function(item){var job=ItemConfig.getJob(item.itemConfig);var subType=ItemConfig.getSubType(item.itemConfig);var zsLv=item.itemConfig.zsLevel;var level=item.itemConfig.level;var quality=ItemConfig.getQuality(item.itemConfig);if(quality==5)return null;if(!this.upLevelEquips){this.upLevelEquips=[]}if(!this.upLevelEquips[job]){this.upLevelEquips[job]=[]}if(!this.upLevelEquips[job][subType]){this.upLevelEquips[job][subType]=[]}if(!this.upLevelEquips[job][subType][zsLv]){this.upLevelEquips[job][subType][zsLv]=[]}var onItem;onItem=this.upLevelEquips[job][subType][zsLv][level];if(onItem){var best=this.checkEquipGetBest(onItem,item);if(best==onItem){this.upLevelEquips[job][subType][zsLv][level]=item}return best}else{this.upLevelEquips[job][subType][zsLv][level]=item}return null};UserBag.prototype.checkUplevelBest=function(item,list){var job=ItemConfig.getJob(item.itemConfig);var subType=ItemConfig.getSubType(item.itemConfig);var item1;var item2;var bestOne=null;if(!list[job]){list[job]=[]}if(!list[job][subType]){list[job][subType]=null}item1=list[job][subType];if(item1){bestOne=this.checkEquipGetBest(item1,item)}return bestOne};UserBag.prototype.checkEquipsIsGoodRed=function(list,item){var lv=Actor.level;var zsLv=UserZs.ins().lv;var job=ItemConfig.getJob(item.itemConfig);var subType=ItemConfig.getSubType(item.itemConfig);var len=SubRoles.ins().subRolesLen;for(var roleId=0;roleId<len;roleId++){if(!list[roleId]){list[roleId]=[]}var itemZsLevel=item.itemConfig.zsLevel?item.itemConfig.zsLevel:0;var itemLevel=item.itemConfig.level?item.itemConfig.level:0;if(zsLv>=itemZsLevel&&lv>=itemLevel){if(!list[roleId][subType]){return item}var best=this.checkEquipGetBestEx(list[roleId][subType],item);if(!UserEquip.ins().checkEquipsIsWear(best)){return best}}}return null};UserBag.prototype.checkEquipsIsGood=function(list,item){var lv=Actor.level;var zsLv=UserZs.ins().lv;var job=ItemConfig.getJob(item.itemConfig);var subType=ItemConfig.getSubType(item.itemConfig);if(item.itemConfig.level>lv||item.itemConfig.zsLevel>zsLv){var best=this.checkUplevelBest(item,list);if(best&&!UserEquip.ins().checkEquipsIsWear(best)){return best}return this.checkUpLevelEquips(item)}if(!list[job]||!list[job][subType]){this.addOneEquipToList(list,item);return null}var oldItem;var clearItem1;var clearItem;oldItem=list[job][subType];clearItem=this.checkEquipGetBest(oldItem,item);if(oldItem==clearItem){list[job][subType]=item}return clearItem};UserBag.prototype.checkEquipGetBestEx=function(oldItem,newItem){if(oldItem&&newItem){if(oldItem.point>=newItem.point){return oldItem}else{return newItem}}return null};UserBag.prototype.checkEquipGetBest=function(oldItem,newItem){if(oldItem!=null&&newItem!=null&&oldItem.point>=newItem.point){return newItem}return oldItem};UserBag.prototype.addOneEquipToListEx=function(list,item,rolejob){if(rolejob===void 0){rolejob=0}var goods;if(item instanceof EquipsData){goods=this.cloneItemDataInfo(item.item)}else{goods=this.cloneItemDataInfo(item)}var job=ItemConfig.getJob(goods.itemConfig);var subType=ItemConfig.getSubType(goods.itemConfig);if(!job)job=rolejob;if(!list[job]){list[job]=[]}list[job][subType]=goods};UserBag.prototype.addOneEquipToListRed=function(list,item,roleId){var goods;if(item instanceof EquipsData){goods=this.cloneItemDataInfo(item.item)}else{goods=this.cloneItemDataInfo(item)}var subType=ItemConfig.getSubType(goods.itemConfig);if(!list[roleId]){list[roleId]=[]}list[roleId][subType]=goods};UserBag.prototype.addOneEquipToList=function(list,item,index){if(index===void 0){index=0}var goods;if(item instanceof EquipsData){goods=this.cloneItemDataInfo(item.item)}else{goods=this.cloneItemDataInfo(item)}var job=ItemConfig.getJob(goods.itemConfig);if(job==0)job=index;var subType=ItemConfig.getSubType(goods.itemConfig);if(!list[job]){list[job]=[]}list[job][subType]=goods};UserBag.prototype.cloneItemDataList=function(list){var returnList=[];for(var i=0;i<list.length;i++){var item=new ItemData;item.handle=list[i].handle;item.configID=list[i].configID;item.att=list[i].att;item.itemConfig=list[i].itemConfig;item.count=list[i].count;returnList.push(item)}return returnList};UserBag.prototype.cloneItemDataInfo=function(data){var item=new ItemData;item.handle=data.handle;item.configID=data.configID;item.att=data.att;item.itemConfig=data.itemConfig;item.count=data.count;return item};UserBag.prototype.getBagGoodsBySort=function(type){var goodsList=this.getGoodsListByType(type,UserBag.BAG_TYPE_OTHTER);goodsList.sort(function(n1,n2){if(n1.configID>n2.configID){return 1}if(n1.configID<n2.configID){return-1}return 0});return goodsList};UserBag.prototype.getBagGoodsByType=function(type){var itemData=this.bagModel[UserBag.BAG_TYPE_OTHTER];var itemData1=[];for(var a in itemData){if(ItemConfig.getType(itemData[a].itemConfig)==type){itemData1.push(itemData[a])}}return itemData1};UserBag.prototype.getBagGoodsByDescIndex=function(descIndex,Bag_Type){if(Bag_Type===void 0){Bag_Type=UserBag.BAG_TYPE_OTHTER}var itemData=this.bagModel[Bag_Type];var itemData1;for(var a in itemData){if(itemData[a].itemConfig.descIndex==descIndex){itemData1=itemData[a];break}}return itemData1};UserBag.prototype.getBagEquipsByQuality=function(quality,type,Bag_Type){if(type===void 0){type=0}if(Bag_Type===void 0){Bag_Type=UserBag.BAG_TYPE_EQUIP}var itemData=this.bagModel[Bag_Type];var itemData1=[];for(var a in itemData){var item=itemData[a];if(item&&ItemConfig.getType(item.itemConfig)==type&&ItemConfig.getQuality(item.itemConfig)==quality){itemData1.push(itemData[a])}}return itemData1};UserBag.prototype.getBagGoodsByHandle=function(type,handle){var itemData=this.bagModel[type];for(var i=0;i<itemData.length;i++){if(itemData[i].handle==handle)return itemData[i]}return null};UserBag.prototype.getHuntGoods=function(type){return this.getGoodsListByType(type)};UserBag.prototype.getGoodsListByType=function(type,bagType){if(bagType===void 0){bagType=UserBag.BAG_TYPE_TREASUREHUNT}var list=this.bagModel[bagType];var backList=[];if(list){for(var i=0;i<list.length;i++){var itemConfig=list[i].itemConfig;if(itemConfig.bagType==type){if(itemConfig.split)this.splitItemData(backList,list[i]);else backList.push(list[i])}}}return backList};UserBag.prototype.splitItemData=function(list,itemData){var count=itemData.count;if(count>1){while(count>0){var newItem=itemData.copy();newItem.count=1;list.push(newItem);count-=1}}else{list.push(itemData)}};UserBag.prototype.getHuntGoodsBySort=function(type){var goodsList=[];if(this.bagModel[UserBag.BAG_TYPE_TREASUREHUNT]){goodsList=this.getGoodsListByType(type);goodsList.sort(function(n1,n2){var n1t=ItemConfig.getType(n1.itemConfig);var n2t=ItemConfig.getType(n2.itemConfig);if(n1t<n2t){return 1}else if(n1t>n2t){return-1}if(n1t){if(n1.configID>=n2.configID){return 1}else if(n1.configID<n2.configID){return-1}}else{if(n1.point>=n2.point){return-1}else if(n1.point<n2.point){return 1}}return 0})}return goodsList};UserBag.prototype.getGuanyinEquip=function(all,list){if(all===void 0){all=false}var items=this.getBagSortQualityEquips(5,0,0,this.otherEquipSmeltFilter);var lastId=0;var len=SubRoles.ins().subRolesLen;if(len<3){lastId=0}else{for(var i=0;i<len;i++){var mo=SubRoles.ins().getSubRoleByIndex(i);var equip=mo.getEquipByIndex(EquipPos.DZI);if(equip&&equip.item&&equip.item.configID<lastId||lastId==0)lastId=equip.item.configID}}if(items.length>0){for(var k in items){var item=this.updateGuanyinEquip(items[k],lastId);if(item!=null)list.push(item);if(!all&&list.length>=9)break}}return list};UserBag.prototype.updateGuanyinEquip=function(data,lastId){if(lastId===void 0){lastId=0}var index=0;var len=SubRoles.ins().subRolesLen;if(ItemConfig.getSubType(data.itemConfig)==ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]){var score=data.point;for(var i=0;i<len;i++){var mo=SubRoles.ins().getSubRoleByIndex(i);var equip=mo.getEquipByIndex(EquipPos.DZI);var config=equip.item.itemConfig;if(!config||config&&score>equip.item.point){return null}}return data}return null};UserBag.prototype.getGuanyinLevel=function(itemConfig){var str=TextFlowMaker.getCStr(itemConfig.id-ItemConst.GUANYIN_ITEM+1);return i18n("UserBag_6",str)};UserBag.prototype.getIsExitUsedItem=function(){var arr=this.bagModel[UserBag.BAG_TYPE_OTHTER];if(!arr)return false;for(var i=0;i<arr.length;i++){if(arr[i].getCanbeUsed()){UserBag.ins().isExitUsedItem=1;return true}}UserBag.ins().isExitUsedItem=0;return false};UserBag.prototype.getEquipsScoreByRolesOfBody=function(){var len=SubRoles.ins().subRolesLen;var point=0;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role&&role.equipsData){var eqdata=role.equipsData;for(var j=0;j<EquipPos.MAX;j++){if(eqdata[j]&&eqdata[j].item&&eqdata[j].item.itemConfig&&eqdata[j].item.itemConfig.id){point+=eqdata[j].item.point}}}}return point};UserBag.prototype.calculationScore=function(item){var equipsData;var mPoint=0;var len=SubRoles.ins().subRolesLen;for(var ii=0;ii<len;ii++){var role=SubRoles.ins().getSubRoleByIndex(ii);if(role.job==ItemConfig.getJob(item.itemConfig)){var equipLen=role.getEquipLen();for(var n=0;n<equipLen;n++){equipsData=role.getEquipByIndex(n).item;if(equipsData&&equipsData.itemConfig&&ItemConfig.getSubType(equipsData.itemConfig)==ItemConfig.getSubType(item.itemConfig)){if(mPoint==0){mPoint=equipsData.point}else{mPoint=Math.min(equipsData.point,mPoint)}}}}}return item.point-mPoint};UserBag.prototype.useRenameItem=function(id,count){ViewManager.ins().open(RenameWin)};UserBag.getAttrPower=function(attr,role){if(role===void 0){role=null}var powerConfig=GlobalConfig.AttrPowerConfig;var allPower=0;if(!attr)return allPower;var exPower=0;for(var i=0;i<attr.length;i++){var atype=attr[i].type;var value=attr[i].value;if(atype==AttributeType.atHpEx||atype==AttributeType.atAtkEx||atype==AttributeType.atDamageReduction){continue}if(!powerConfig[atype]||!value)continue;allPower+=value*powerConfig[atype].power;if(atype==AttributeType.atHuiXinDamage&&role)exPower+=ItemConfig.relatePower(attr[i],role)}return Math.floor(allPower/100)+Math.floor(exPower)};UserBag.prototype.setEquipPowerDic=function(job,pos,power){if(power===void 0){power=0}if(!this.equipPowerDic[job])this.equipPowerDic[job]=[];if(!this.equipPowerDic[job][pos])this.equipPowerDic[job][pos]=0;this.equipPowerDic[job][pos]=power};UserBag.prototype.getEquipPowerDic=function(job,pos){if(this.equipPowerDic[job]&&this.equipPowerDic[job][pos]){return this.equipPowerDic[job][pos]}return 0};UserBag.prototype.getLowEquipIndex=function(equips,type){var index=-1;var tPower=Number.MAX_VALUE;var len=equips.length;for(var i=0;i<len;i++){if(ForgeConst.EQUIP_POS_TO_SUB[i]!=type)continue;var item=equips[i];if(item.handle==0){return i}var itemPower=item.point;if(itemPower<tPower){index=i;tPower=itemPower}}return index};UserBag.prototype.getHejiEquips=function(){var itemData=this.bagModel[1];var list=[];for(var i=0;i<itemData.length;i++){var item=itemData[i];if(ItemConfig.getType(item.itemConfig)==5)list.push(item)}return list};UserBag.prototype.getShapeShiftingPro=function(){var list=[];var uselessProp=ShapeShiftingMgr.ins().getUselessProp();if(uselessProp.length<1){return list}var itemData=this.bagModel[0];for(var i=0;i<itemData.length;i++){var item=itemData[i];if(ItemConfig.getType(item.itemConfig)==26){for(var j=0;j<item.count;j++){if(uselessProp.indexOf(item._configID)>-1){list.push(item)}if(list.length>=9){return list}}}}return list};UserBag.prototype.checkIsWear=function(item){if(!item){return false}for(var k=0;k<8;k++){var wear=UserSkill.ins().equipListData[k];if(wear&&wear.handle==item.handle){return false}}return true};UserBag.prototype.makeHejiWearList=function(item){var pos=ItemConfig.getSubType(item.itemConfig);this.wearList[pos]=item};UserBag.prototype.checkHejiEquipsTodestroy=function(returnList){if(!UserSkill.ins().equipListData)return;for(var k=0;k<8;k++){var wear_1=UserSkill.ins().equipListData[k];if(wear_1&&wear_1.configID!=0){this.makeHejiWearList(wear_1)}}var itemList=this.getHejiEquips();var len=itemList.length;var item;var wear;for(var i=0;i<len;i++){item=itemList[i];var pos=ItemConfig.getSubType(item.itemConfig);wear=this.wearList[pos];if(!wear||wear.configID==0)continue;var point1=0;var point2=0;point1=item.point;point2=wear.point;if(point2>=point1){returnList.push(item)}else{var level=0;if(item.itemConfig.level<=level){this.wearList[pos]=item;if(this.checkIsWear(wear)){returnList.push(wear)}}}if(returnList.length>=9){break}}};UserBag.prototype.getEquipByPos=function(index,pos){var list=this.bagModel[UserBag.BAG_TYPE_EQUIP];var role=SubRoles.ins().getSubRoleByIndex(index);var goods=role.getEquipByIndex(pos);var subType=0;if(goods&&goods.item.itemConfig){subType=ItemConfig.getSubType(goods.item.itemConfig)}else{subType=pos}var returnList=[];var tempList=[];var level=Actor.level;var zsLevel=UserZs.ins().lv;for(var i=0;i<list.length;i++){var job=ItemConfig.getJob(list[i].itemConfig);var subType1=ItemConfig.getSubType(list[i].itemConfig);if((job==role.job||job==0)&&subType1==subType){if(Math.floor(list[i].itemConfig.id/1e4)==91)continue;if(goods&&list[i].handle==goods.item.handle){continue}if(zsLevel<list[i].itemConfig.zsLevel||level<list[i].itemConfig.level){tempList.push(list[i])}else{returnList.push(list[i])}}}returnList=returnList.sort(this.sortFun);tempList.sort(this.sortFun);returnList=returnList.concat(tempList);return returnList};UserBag.prototype.sortFun=function(aItem,bItem){var att1=UserBag.ins().getEquipAttrs(aItem);var itemPoint1=UserBag.getAttrPower(att1);var att2=UserBag.ins().getEquipAttrs(bItem);var itemPoint2=UserBag.getAttrPower(att2);if(itemPoint1<itemPoint2)return 1;if(itemPoint1>itemPoint2)return-1;return 0};UserBag.prototype.getEquipAttrs=function(data){var config=GlobalConfig.EquipConfig[data.configID];var totalAttr=[];for(var k in Role.translate){if(config[k]<=0)continue;var attr=data.att;for(var index=0;index<attr.length;index++){if(attr[index].type==Role.getAttrTypeByName(k)){var attrs=new AttributeData;attrs.type=attr[index].type;attrs.value=config[k]+attr[index].value;totalAttr.push(attrs);break}}}return totalAttr};UserBag.prototype.checkEqRedPoint=function(index,role,islook){var equipData=role.getEquipByIndex(index);var nextConfig;if(equipData.item.itemConfig&&ItemConfig.getQuality(equipData.item.itemConfig)<4)nextConfig=null;else nextConfig=GlobalConfig.ItemConfig[equipData.item.configID+1];var needNum=0;var costID=0;if(equipData.item.itemConfig&&ItemConfig.getQuality(equipData.item.itemConfig)==4&&equipData.item.itemConfig.zsLevel>=12)return null;if(equipData.item.itemConfig&&ItemConfig.getQuality(equipData.item.itemConfig)==5)return null;if(nextConfig!=null&&(nextConfig.level>Actor.level||nextConfig.zsLevel>UserZs.ins().lv))return null;if(nextConfig!=undefined&&equipData.item.handle!=0&&ItemConfig.getQuality(equipData.item.itemConfig)==4&&equipData.item.itemConfig.level!=1&&UserBag.fitleEquip.indexOf(equipData.item.configID)==-1){}else{var configId=UserEquip.ins().getEquipConfigIDByPosAndQualityByGod(role,index,4,role.job);var mixConfig=GlobalConfig.LegendComposeConfig[configId];if(mixConfig){needNum=mixConfig.count;costID=mixConfig.itemId;var curNum=UserBag.ins().getBagGoodsCountById(0,costID);if(curNum>=needNum&&!UserBag.ins().OrangeEquipRedPoint[index]){if(islook)UserBag.ins().OrangeEquipRedPoint[index]=false;return true}else{return false}}}return null};UserBag.prototype.doChoosableGiftResult=function(bytes){var result=bytes.readUnsignedByte();if(result==0)this.postGiftResult()};UserBag.prototype.doShowAwards=function(bytes){var reason=bytes.readString();var awardsStr=bytes.readString();var awards=JSON.parse(awardsStr);if(awardsStr!="{}"){RewardWin.show(awards,RewardWin.TYPE_GXHD2)}};UserBag.prototype.postExchangeData=function(bytes){var count=bytes.readInt();for(var i=0;i<count;i++){var id=bytes.readInt();var eid=bytes.readInt();var state=bytes.readShort();var times=bytes.readInt();if(!this.exchange_info[id]){this.exchange_info[id]={}}this.exchange_info[id][eid]={state:state,times:times}}};UserBag.prototype.getExchangeState=function(id,eid){if(id===void 0){id=5}if(eid===void 0){eid=1}if(!this.exchange_info[id]){this.exchange_info[id]={}}if(!this.exchange_info[id][eid]){return eState.ok}return this.exchange_info[id][eid].state||eState.ok};UserBag.prototype.getExchangedTimes=function(id,eid){if(id===void 0){id=5}if(eid===void 0){eid=1}if(!this.exchange_info[id]){this.exchange_info[id]={}}if(!this.exchange_info[id][eid]){return 0}return this.exchange_info[id][eid].times||0};UserBag.prototype.canExchange=function(id,eid){if(id===void 0){id=5}if(eid===void 0){eid=-1}if(eid==-1){var cfg=GlobalConfig.ItemExchangeConfig[id];for(var e in cfg){var b=this.canExchange(id,Number(e));if(b){return true}}return false}var state=this.getExchangeState(id,eid);if(state==eState.no){return false}if(id==GlobalConfig.PeachBaseConfig.exchangeId){var cfg=GlobalConfig.ItemExchangeConfig[id][eid];var cost=cfg.materials[0]["count"]||0;var itemid=GlobalConfig.PeachBaseConfig.costItemId;var isHave=UserBag.ins().getBagGoodsCountById(0,itemid);return isHave>=cost}return false};UserBag.prototype.getExchangeRecord=function(id){if(id===void 0){id=5}var ids=[];if(!this.exchange_info[id]){this.exchange_info[id]={};return ids}for(var eid in this.exchange_info[id]){var times=this.exchange_info[id][eid].times||0;for(var i=0;i<times;i++){ids.push(eid)}}return ids};UserBag.prototype.sendExchange=function(id,eid){var bytes=this.getBytes(11);bytes.writeInt(id);bytes.writeInt(eid);this.sendToServer(bytes)};UserBag.prototype.postExchangeRes=function(bytes){var err_code=bytes.readInt();var id=bytes.readInt();var eid=bytes.readInt();console.log("postExchangeRes err_code:"+err_code+" id:"+id+" eid:"+eid);return[err_code,id]};UserBag.prototype.postGiftResult=function(){};UserBag.prototype.sendChoosableGift=function(itemId,count,index){var bytes=this.getBytes(8);bytes.writeInt(itemId);bytes.writeInt(count);bytes.writeInt(index+1);this.sendToServer(bytes)};UserBag.prototype.getRmbItemIsBuy=function(id){var config=GlobalConfig.ItemConfig[id];if(config&&config.needyuanbao&&Actor.yb>=config.needyuanbao){return true}return false};UserBag.BAG_TYPE_OTHTER=0;UserBag.BAG_TYPE_EQUIP=1;UserBag.BAG_TYPE_TREASUREHUNT=2;UserBag.BAG_ENOUGH=20;UserBag.BAG_ENOUGH100=100;UserBag.BAG_ENOUGH200=200;UserBag.BAG_DESC_TYPE_HEIR=11;return UserBag}(BaseSystem);__reflect(UserBag.prototype,"UserBag");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userbag=UserBag.ins.bind(UserBag)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var eState;(function(eState){eState[eState["ok"]=1]="ok";eState[eState["no"]=2]="no"})(eState||(eState={}));window["eState"]=eState;var BagWin=function(_super){__extends(BagWin,_super);function BagWin(){var _this=_super.call(this)||this;_this.oldIndex=0;_this.skinName="BagSkin";_this.isTopLevel=true;return _this}BagWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.tab.dataProvider=this.viewStack;this.itemList.itemRenderer=ItemBase;this.itemListGoods.itemRenderer=ItemBase;this.itemListRune.itemRenderer=ItemBase;this.itemScroller.viewport=this.itemList;this.itemGoodsScroller.viewport=this.itemListGoods};BagWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.smeltBtn,this.onClick);this.addTouchEvent(this.addBtn,this.onClick);this.addChangeEvent(this.tab,this.onClick);this.addTouchEvent(this.help,this.onClick);this.addTouchEvent(this.itemListGoods,this.removeGuide);this.observe(UserBag.ins().postBagWillFull,this.setBagTips);this.observe(UserBag.ins().postBagVolAdd,this.setCount);this.observe(UserBag.ins().postHasItemCanUse,this.setIsExitUsedItem);this.observe(UserBag.ins().postItemCountChange,this.showBagBtnRedPoint);this.observe(UserBag.ins().postItemChange,this.updateBag);this.observe(UserBag.ins().postItemAdd,this.updateBag);this.observe(UserBag.ins().postItemDel,this.updateBag);MijiGuideMgr.ins().addEventListener(MijiGuideMgr.EVENT_MIJI_GUIDE_STEP_CHANGE,this.stepChange,this);DressGuideMgr.ins().addEventListener(DressGuideMgr.EVENT_DRESS_GUIDE_STEP_CHANGE,this.stepChange2,this);var index=0;if(param[0]!=undefined){index=param[0];if(index==3){this.reinComposePanel.open(param[1],param[2],param[3])}}this.viewStack.selectedIndex=this.tab.selectedIndex=index;this.setBagData(index);this.setIsExitUsedItem();UserBag.ins().postBagVolChange();this.showBagBtnRedPoint(UserBag.ins().isChange);if(MergeCC.ins().isOpen()){this.openMerge()}else{this.inactiveSamsara()}if(!this.guideArrow||!this.guideArrow.parent){this.guideArrow=new GuideArrow2(true);this.itemListGoods.addChildAt(this.guideArrow,1e4)}this.guideArrow.touchEnabled=false;this.guideArrow.visible=false;this.help.visible=false};BagWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}MijiGuideMgr.ins().removeEventListener(MijiGuideMgr.EVENT_MIJI_GUIDE_STEP_CHANGE,this.stepChange,this);DressGuideMgr.ins().removeEventListener(DressGuideMgr.EVENT_DRESS_GUIDE_STEP_CHANGE,this.stepChange2,this);var uiview2=ViewManager.ins().getView(UIView2);if(uiview2)uiview2.closeNav(UIView2.NAV_BAG);ViewManager.ins().close(SwordSkinWin)};BagWin.prototype.openMerge=function(){var index=this.viewStack.getChildIndex(this.reinComposePanel);if(index<0){this.viewStack.addChild(this.reinComposePanel)}this.tab.dataProvider=this.viewStack;this.redPointGroup.horizontalCenter=37;this.redPoint3.visible=MergeCC.ins().redPoint()};BagWin.prototype.inactiveSamsara=function(){var index=this.viewStack.getChildIndex(this.reinComposePanel);if(index>=0){this.viewStack.removeChildAt(index)}this.tab.dataProvider=this.viewStack;this.redPointGroup.horizontalCenter=98;this.redPoint3.visible=false};BagWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(BagWin);break;case this.smeltBtn:ViewManager.ins().close(BagWin);ViewManager.ins().open(SmeltEquipTotalWin);break;case this.addBtn:var config=GlobalConfig.BagBaseConfig;var row=(UserBag.ins().bagNum-config.baseSize)/config.rowSize;if(row>=CommonUtils.getObjectLength(GlobalConfig.BagExpandConfig)){UserTips.ins().showTips(StringUtils.addColor(i18n("BagWin_0"),15937822))}else ViewManager.ins().open(BagAddItemWarn);break;case this.tab:this.help.visible=false;if(this.tab.selectedIndex==3){this.reinComposePanel.open();this.help.visible=true}else if(this.tab.selectedIndex==2){this.setBagData(this.tab.selectedIndex)}else{this.setBagData(this.tab.selectedIndex)}break;case this.help:if(this.viewStack.selectedIndex==3){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[48].text)}break}};BagWin.prototype.setCount=function(){this.itemCount.text=UserBag.ins().getBagItemNum()+"/"+UserBag.ins().getMaxBagRoom()};BagWin.prototype.updateBag=function(){this.setBagData(this.oldIndex)};BagWin.prototype.stepChange=function(){var s=MijiGuideMgr.ins().getStep();if(s>2){this.guideArrow.visible=false;this.guideArrow.removeTweens()}};BagWin.prototype.stepChange2=function(){var s=DressGuideMgr.ins().getStep();if(s>1){this.guideArrow.visible=false;this.guideArrow.removeTweens()}};BagWin.prototype.removeGuide=function(e){if(this.itemGoodsScroller.viewport.scrollV!=0){this.guideArrow.visible=false;this.guideArrow.removeTweens()}};BagWin.prototype.highLight=function(pos){if(pos===void 0){pos={x:0,y:0}}var self=this;if(pos){var vp_1=self.itemGoodsScroller.viewport;vp_1.scrollV=pos.y-108-5;setTimeout(function(){self.itemListGoods.setChildIndex(self.guideArrow,1e4);self.guideArrow.visible=true;self.guideArrow.x=pos.x+108;self.guideArrow.y=pos.y+68;self.guideArrow.setTips(i18n("BagWin_1"));if(self.guideArrow.x+self.guideArrow.width>vp_1.width){self.guideArrow.setDirection(0);self.guideArrow.x=pos.x+115-108/2}else{self.guideArrow.setDirection(1)}},50)}};BagWin.prototype.setBagData=function(tabIndex){if(tabIndex===void 0){tabIndex=1}var self=this;switch(tabIndex){case 0:var equipItemData=UserBag.ins().getBagSortQualityEquips(5,0,1);equipItemData.sort(UserBag.ins().sort3);var dataPro=this.itemList.dataProvider;if(dataPro){dataPro.replaceAll(equipItemData)}else{this.itemList.dataProvider=new eui.ArrayCollection(equipItemData)}break;case 1:var goodsList=UserBag.ins().getBagGoodsBySort(0);var goodsList2=UserBag.ins().getBagGoodsBySort(2);var goodsList3_1=goodsList2.concat(goodsList);var goodDataPro=this.itemListGoods.dataProvider;if(goodDataPro){goodDataPro.replaceAll(goodsList3_1)}else{this.itemListGoods.dataProvider=new eui.ArrayCollection(goodsList3_1)}setTimeout(function(){var step=MijiGuideMgr.ins().getStep();var pos=null;if(step==1){for(var j=0;j<goodsList3_1.length;j++){var good=goodsList3_1[j];if(MijiGuideMgr.ins().isJia(good.itemConfig.id)){pos=self.getItemPos(j);break}}}else if(step==2){for(var j=0;j<goodsList3_1.length;j++){var good=goodsList3_1[j];var _type=ItemConfig.getType(good.itemConfig);if(_type==ItemType.TYPE_2){pos=self.getItemPos(j);break}}}if(pos){self.highLight(pos)}},50);setTimeout(function(){var step=DressGuideMgr.ins().getStep();var pos=null;if(step==1){for(var j=0;j<goodsList3_1.length;j++){var good=goodsList3_1[j];if(DressGuideMgr.ins().isJia(good.itemConfig.id)){pos=self.getItemPos(j);break}}}if(pos){self.highLight(pos)}},50);break;case 2:var listRune=UserBag.ins().getBagGoodsBySort(1);var runeDataPro=this.itemListRune.dataProvider;if(runeDataPro){runeDataPro.replaceAll(listRune)}else{this.itemListRune.dataProvider=new eui.ArrayCollection(listRune)}break}if(this.oldIndex!=tabIndex){this.oldIndex=tabIndex}else{this.tab.selectedIndex=tabIndex}this.setCount()};BagWin.prototype.getItemPos=function(i){var x=i%5*(90+20);var y=Math.floor(i/5)*(108+5);var pos={x:x,y:y};return pos};BagWin.prototype.setIsExitUsedItem=function(){this.redPoint1.visible=UserBag.ins().getIsExitUsedItem()||UserBag.ins().getBagGoodsCountByType(8);this.redPoint2.visible=UserBag.ins().getRuneBagGoodsCountByType(8);this.redPoint3.visible=MergeCC.ins().isOpen()&&MergeCC.ins().redPoint()};BagWin.prototype.setBagTips=function(result){this.redPoint0.visible=result>0||UserBag.ins().isChange>0};BagWin.prototype.showBagBtnRedPoint=function(b){this.redPoint.visible=b>0};BagWin.prototype.getItemDisplayObjectById=function(itemID){for(var i=0;i<this.itemListGoods.numChildren;i++){var item=this.itemListGoods.getChildAt(i);if(item&&item.data.configID==itemID){return item}}return null};__decorate([callDelay(100)],BagWin.prototype,"updateBag",null);return BagWin}(BaseEuiView);__reflect(BagWin.prototype,"BagWin");ViewManager.ins().reg(BagWin,LayerManager.UI_Main);var BookUpItem=function(_super){__extends(BookUpItem,_super);function BookUpItem(){var _this=_super.call(this)||this;_this.touchChildren=false;return _this}BookUpItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.mc=new MovieClip;this.mc.x=45;this.mc.y=40};BookUpItem.prototype.dataChanged=function(){this.clear();if(this.data instanceof ItemData){this.itemConfig=this.data.itemConfig;this.itemIcon.setData(this.itemConfig);if(this.itemConfig==null)return;var type=ItemConfig.getType(this.itemConfig);var job=ItemConfig.getJob(this.itemConfig);if(type==4){this.nameTxt.text=this.itemConfig.name}else{}this.itemIcon.imgJob.source=(type==0||type==4)&&job&&this.itemIcon.imgJob.visible?"job"+job+"Item":""}};BookUpItem.prototype.onClick=function(){};BookUpItem.prototype.playEff=function(){if(this.data){this.mc.playFile(RES_DIR_EFF+"litboom",1);this.addChild(this.mc)}};BookUpItem.prototype.clear=function(){_super.prototype.clear.call(this);this.itemIcon.imgJob.source=null};return BookUpItem}(ItemBase);__reflect(BookUpItem.prototype,"BookUpItem");var DressSpecialTipsBase=function(_super){__extends(DressSpecialTipsBase,_super);function DressSpecialTipsBase(){var _this=_super.call(this)||this;_this.skinName="DressSpecialAttrSkin";return _this}DressSpecialTipsBase.prototype.setData=function(data){this.clear();if(data==null)return;var title=data.title;var attrDesc=data.attrDesc;this.attrType.textFlow=TextFlowMaker.generateTextFlow1(title);this.suit.textFlow=TextFlowMaker.generateTextFlow1(attrDesc)};DressSpecialTipsBase.prototype.clear=function(){this.attrType.textFlow=null;this.suit.textFlow=null};return DressSpecialTipsBase}(BaseView);__reflect(DressSpecialTipsBase.prototype,"DressSpecialTipsBase");var DressTipsWin=function(_super){__extends(DressTipsWin,_super);function DressTipsWin(){var _this=_super.call(this)||this;_this.trival=0;_this.trivalType=1;_this.skinName="DressTipsSkin";return _this}DressTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.itemConfig=param[0];this.trival=param[1];this.itemId=this.itemConfig.id;Dress.ins().sendDressInfoReq();this.addTouchEvent(this.takeBtn,this.onTap);this.addTouchEndEvent(this,this.otherClose);this.setTipsData()};DressTipsWin.prototype.close=function(){this.itemData=null};DressTipsWin.prototype.setTipsData=function(){var data;this.trialTxt.text="";if(this.trival==1){var res_1=Dress.ins().getIdByTrialId(this.itemId);data=res_1[0];var yb=data.tryOn.count||0;this.trialTxt.text=i18n("DressTipsWin_5",data.tryOn.level);this.takeBtn.label=i18n("DressTipsWin_6");this.trivalType=res_1[1];if(this.trivalType==0){this.takeBtn.label=i18n("DressTipsWin_7");this.trialTxt.text=i18n("DressTipsWin_4",yb)}}else{data=this.getIdByItemId(this.itemId)}if(!data)return;this.itemData=data;var attr=data.attr;var power=UserBag.getAttrPower(AttributeData.transformAttr(attr));this.powerPanel.setPower(power);this.itemname.text=data.name;this.quali.source="quali"+ItemConfig.getQuality(this.itemConfig);var DressTypeName=["",i18n("Dress_0"),i18n("Dress_1"),i18n("Dress_2")];this.style.text=DressTypeName[data.pos];this.dressName.text=data.name;var equip=new EquipTipsItemBase;equip.data={title:i18n("DressTipsWin_0"),titleColor:2188190,attributeData:attr,colorName:298564,colorValue:298564,others:null};this.content.addChild(equip);if(data.special_attr_desc){var special=new DressSpecialTipsBase;special.setData({title:i18n("DressTipsWin_1"),attrDesc:data.special_attr_desc});this.content.addChild(special)}var mcX=201;var mcY=279;var res=data.res;if(res.indexOf("weapon")>-1){var sex=sexByJob(data.roletype);res=res+"_"+sex+"_c";if(sex==0){mcX=331;mcY=187}else{mcX=300;mcY=237}}if(res.indexOf("body")>-1){res=res+"_c"}this.mcGroup.x=mcX;this.mcGroup.y=mcY;imageToMc(this.mcImg,res,this.mcGroup,null,RES_DIR_ROLE)};DressTipsWin.prototype.onTap=function(){if(this.itemData){var isShow=this.itemData.isShow;if(isShow==0&&Setting.ins().getValue(ClientSet.showAllDress)==0){UserTips.ins().showTips(i18n("DressTipsWin_3"));return}}if(this.trival==1){switch(this.trivalType){case 0:Dress.ins().sendDressActivationReq(this.itemData.id,1);break;case 1:this.activate();break;case 2:UserTips.ins().showTips(i18n("DressTipsWin_2"));break}}else{this.activate()}};DressTipsWin.prototype.activate=function(){var cjob=0;if(this.itemData){cjob=this.itemData.roletype}var role=SubRoles.ins().getSubRoleByJob(cjob);if(role){var id=this.trival;if(this.trival==1){id=this.itemData.id}ViewManager.ins().open(DressWin,role.index,this.itemData.pos-1,this.itemData.id,true,id)}else{UserTips.ins().showTips(i18n("DressTipsWin_2"))}};DressTipsWin.prototype.otherClose=function(){ViewManager.ins().close(this)};DressTipsWin.prototype.getIdByItemId=function(itemId){var allData=GlobalConfig.ZhuangBanId;var elements=[];for(var key in allData){var element=allData[key];if(element.cost.itemId==itemId){elements.push(element)}}var res=null;for(var i=0;i<SubRoles.ins().subRolesLen;i++){var role=SubRoles.ins().getSubRoleByIndex(i);var job=role.job;res=elements[job-1];if(res&&res.isShow==1){return res}}return res};return DressTipsWin}(BaseEuiView);__reflect(DressTipsWin.prototype,"DressTipsWin");ViewManager.ins().reg(DressTipsWin,LayerManager.UI_Popup);var EquipDetailedWin=function(_super){__extends(EquipDetailedWin,_super);function EquipDetailedWin(){var _this=_super.call(this)||this;_this._bottomY=0;_this._equipPower=0;_this._totalPower=0;_this.curRole=0;_this.index=0;_this.skinName="EquipTipsSkin";return _this}EquipDetailedWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.itemIcon.imgJob.visible=false};EquipDetailedWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var type=param[0];var handle=param[1];var configID=param[2];var data=param[3];this.roleModel=param[4];if(param[5]>=0){this.curRole=param[5];this.index=param[6];this.changeBtn.visible=true}else{this.changeBtn.visible=false}this.addTouchEndEvent(this.bgClose,this.otherClose);this.addTouchEndEvent(this.changeBtn,this.onEquipChange);this.setData(type,handle,configID,data)};EquipDetailedWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose)};EquipDetailedWin.prototype.otherClose=function(evt){ViewManager.ins().close(EquipDetailedWin)};EquipDetailedWin.prototype.onEquipChange=function(e){ViewManager.ins().open(RoleChooseEquipWin,this.curRole,this.index);ViewManager.ins().close(EquipDetailedWin)};EquipDetailedWin.prototype.getExtremeName=function(){if(!this.changeBtn.visible)return"";var lv=ExtremeEquipModel.ins().getZhiZunLvByRoleID(this.roleModel,this.index);if(!lv)return"";return GlobalConfig.ZhiZunEquipLevel[this.index][lv].headTxt};EquipDetailedWin.prototype.setData=function(type,handle,configID,_data){var data=_data instanceof ItemData?_data:undefined;var itemConfig;this._totalPower=0;if(handle!=undefined&&data==undefined){data=UserBag.ins().getBagGoodsByHandle(type,handle);if(!data){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);var equipLen=role.getEquipLen();for(var kk=0;kk<equipLen;kk++){if(role.getEquipByIndex(kk).item.handle==handle){data=role.getEquipByIndex(kk).item;break}}}}if(!data){var shopData=Shop.ins().shopData;var len=shopData.getShopEquipDataLength();var sed=null;for(var i=0;i<len;i++){sed=shopData.getShopEquipDataByIndex(i);if(sed!=null){if(handle==sed.item.handle){data=sed.item;break}}}}if(!data){new Error(i18n("EquipDetailedWin_0"))}itemConfig=data.itemConfig;configID=data.configID}else itemConfig=GlobalConfig.ItemConfig[configID];this.nameLabel.text=this.getExtremeName()+itemConfig.name;this.nameLabel.textColor=ItemConfig.getQualityColor(itemConfig);this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);var q=ItemConfig.getQuality(itemConfig);var subType=ItemConfig.getSubType(itemConfig);var job=ItemConfig.getJob(itemConfig);this.quali.source=q>0?"quali"+q:"";this.itemIcon.setData(itemConfig);var exPower=0;if(data instanceof ItemData||itemConfig!=null){if(data&&ItemConfig.getType(data.itemConfig)==4){this.levelKey.text=i18n("EquipDetailedWin_1");this.type.text=Role.getWingEquipNameByType(subType);this.lv.text=itemConfig.level+1+i18n("EquipDetailedWin_2");this.lv.textColor=15937822;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(SubRoles.ins().getSubRoleByIndex(i).wingsData.lv>=itemConfig.level){this.lv.textColor=242004;break}}this.career.text=Role.getJobNameByJob(job);this.jobGroup.visible=true}else if(data&&ItemConfig.getType(data.itemConfig)==5){this.levelKey.text=itemConfig.zsLevel>0?i18n("EquipDetailedWin_3"):i18n("EquipDetailedWin_4");this.type.text=Role.getHejiEquipNameByType(subType);this.lv.text=isNaN(itemConfig.zsLevel)?(itemConfig.level||1)+i18n("EquipDetailedWin_5"):itemConfig.zsLevel+i18n("EquipDetailedWin_6");if(itemConfig.zsLevel>0){this.lv.textColor=UserZs.ins().lv<itemConfig.zsLevel?15937822:242004}else{this.lv.textColor=Actor.level<itemConfig.level?15937822:242004}this.jobGroup.visible=false;if(UserBag.fitleEquip.indexOf(itemConfig.id)!=-1){this.lv.text=i18n("EquipDetailedWin_7")}}else{if(subType==EquipPos.DZI){this.levelKey.text=i18n("EquipDetailedWin_8");this.type.text=Role.getEquipNameByType(subType);this.lv.text=UserBag.ins().getGuanyinLevel(itemConfig)}else{this.levelKey.text=itemConfig.zsLevel>0?i18n("EquipDetailedWin_9"):i18n("EquipDetailedWin_10");this.type.text=Role.getEquipNameByType(subType);this.lv.text=isNaN(itemConfig.zsLevel)?(itemConfig.level||1)+i18n("EquipDetailedWin_11"):itemConfig.zsLevel+i18n("EquipDetailedWin_12");if(UserBag.fitleEquip.indexOf(itemConfig.id)!=-1){this.lv.text=i18n("EquipDetailedWin_13")}}if(itemConfig.zsLevel>0){this.lv.textColor=UserZs.ins().lv<itemConfig.zsLevel?15937822:242004}else{this.lv.textColor=Actor.level<itemConfig.level?15937822:242004}this.career.text=Role.getJobNameByJob(job);this.jobGroup.visible=true}}var ii=1;this.attr1.visible=false;this.attr2.visible=false;this.attr3.visible=false;this.attr4.visible=false;var config=GlobalConfig.EquipConfig[configID];var totalAttr=[];var info;var transfrom=["","","hp","","atk","def","res"];if(this.roleModel)info=this.roleModel.heirloom.getInfoBySolt(this.index);for(var k in Role.translate){if(isNaN(config[k])||!config[k])continue;var attrStr="";attrStr+=AttributeData.getAttrStrByType(Role.getAttrTypeByName(k))+"  ";attrStr+=config[k];var attrs=new AttributeData;if(data!=undefined){if(data.att){var attr=data.att;for(var index=0;index<attr.length;index++){if(attr[index].type==Role.getAttrTypeByName(k)){attrStr+=" +"+attr[index].value;if(info&&info.attr_add){attrStr+="+"+Math.floor((config[k]+attr[index].value)*(info.attr_add/100))}attrs.type=attr[index].type;attrs.value=config[k]+attr[index].value;totalAttr.push(attrs);break}}}else{for(var k_3 in config){if(!transfrom[k_3])continue;var value=config[transfrom[k_3]];if(value==undefined||value==0)continue;var type_1=Role.getAttrTypeByName(transfrom[k_3]);attrStr+=AttributeData.getAttrStrByType(type_1)+"  ";attrStr+=config[k_3];attrs.type=type_1;attrs.value=config[k_3];totalAttr.push(attrs)}}}else{attrs.type=Role.getAttrTypeByName(k);attrs.value=config[k];totalAttr.push(attrs)}this["attr"+ii].text=attrStr;this["attr"+ii].visible=true;ii++}if(data){this._equipPower=data.point}else{this._equipPower=Math.floor(UserBag.getAttrPower(totalAttr));if(config&&config.exPower){exPower=config.exPower}}this._totalPower+=this._equipPower+exPower;this._score=this._totalPower;this.score.text=i18n("EquipDetailedWin_14")+this._totalPower;this._bottomY=this["attr"+(ii-1)].y+this["attr"+(ii-1)].height;while(this.forgeGroup.numElements){this.forgeGroup.removeChildAt(0)}if(this.roleModel){var len=this.roleModel.getEquipLen();for(var i=0;i<len;i++){var equipsData=this.roleModel.getEquipByIndex(i);if(equipsData.item.handle==handle){this.setForge(equipsData,i);break}}if(config){if(config.baseAttr1){this._equipPower+=ItemConfig.relatePower(config.baseAttr1,this.roleModel)}if(config.baseAttr2){this._equipPower+=ItemConfig.relatePower(config.baseAttr2,this.roleModel)}}}if(subType==EquipPos.DZI)this.addTips(null,4,0);if(itemConfig.desc){var desc=new eui.Label;desc.size=18;desc.width=250;desc.textColor=4883880;desc.x=this.attr1.x;desc.y=this._bottomY+=10;desc.textFlow=TextFlowMaker.generateTextFlow(itemConfig.desc);this.forgeGroup.addChild(desc);this._bottomY+=desc.textHeight}var scrollMaxHeight=400;if(this._bottomY>scrollMaxHeight)this._bottomY=scrollMaxHeight;this.background.height=this.powerPanel.y+this.powerPanel.height+this._bottomY;this.bgGroup.y=this.background.y+this.background.height;this.powerPanel.setPower(this._totalPower);var scrollerGroup=this.attr1.parent.parent;scrollerGroup.height=this._bottomY;scrollerGroup.scrollPolicyV=this._bottomY>=scrollMaxHeight?"on":"off";this.fengexian.y=this.background.y+this.background.height-10;this.anigroup.height=this.powerPanel.y+this.powerPanel.height+this.bgGroup.height+scrollerGroup.height-65;this.anigroup.height=this.anigroup.height>930?930:this.anigroup.height;this.anigroup.y=0};EquipDetailedWin.prototype.setForge=function(equipsData,pos){var lv=0;for(var i=0;i<4;i++){switch(i){case ForgeWin.Page_Select_Boost:lv=equipsData.strengthen;break;case ForgeWin.Page_Select_ZhuLing:lv=equipsData.zhuling;break;case ForgeWin.Page_Select_Gem:lv=equipsData.gem;break;case ForgeWin.Page_Select_Weapon:lv=equipsData.tupo;break}if(lv>0){var config=UserForge.ins().getForgeConfigByPos(pos,lv,i);this.addTips(config.attr,i,lv);var power=0;if(i==3)power=Math.floor(this._equipPower*(Number(config.attr)/100));else power=Math.floor(UserBag.getAttrPower(config.attr));this._totalPower+=power}}if(pos>=EquipPos.WEAPON&&pos<=EquipPos.SHOE){lv=ExtremeEquipModel.ins().getZhiZunLvByRoleID(this.roleModel,pos);this.itemIcon.extreme.visible=lv?true:false;if(lv){var config=GlobalConfig.ZhiZunEquipLevel[pos][lv];if(config.ex_attrs)this._totalPower+=Math.floor(UserBag.getAttrPower(config.ex_attrs));this._totalPower+=config.ex_power;var des="";var lv2=ExtremeEquipModel.ins().getZhiZunLinkLv(this.curRole+1,pos,lv);var isTrue=lv2>0;var linkCfg=void 0;var stop_1=false;for(var key in GlobalConfig.ZhiZunLinkLevel[pos]){for(var key2 in GlobalConfig.ZhiZunLinkLevel[pos][key]){linkCfg=GlobalConfig.ZhiZunLinkLevel[pos][key][key2];if(linkCfg.level==1)des=linkCfg.chainDesc;if(linkCfg.level==lv2&&isTrue){stop_1=true;if(linkCfg.attrs)this._totalPower+=Math.floor(UserBag.getAttrPower(linkCfg.attrs));if(linkCfg.exAttrs)this._totalPower+=Math.floor(UserBag.getAttrPower(linkCfg.exAttrs));this._totalPower+=linkCfg.ex_power;des=linkCfg.chainDesc;break}}if(stop_1)break}this._totalPower+=Math.floor(UserBag.getAttrPower(config.attrs));this.addTips(config.attrs,5,lv,lv2,config.skillId,des)}}};EquipDetailedWin.prototype.addTips=function(attr,type,lv,lv2,skillId,des){if(lv===void 0){lv=0}if(lv2===void 0){lv2=0}if(skillId===void 0){skillId=0}if(des===void 0){des=""}var titleAttrTxt=new eui.Label;titleAttrTxt.fontFamily="Arial";titleAttrTxt.size=20;titleAttrTxt.textColor=4740980;titleAttrTxt.bold=true;titleAttrTxt.x=24;titleAttrTxt.y=this._bottomY+10+14;titleAttrTxt.touchEnabled=false;this.forgeGroup.addChild(titleAttrTxt);var attrTxt=new eui.Label;attrTxt.fontFamily="Arial";attrTxt.size=18;attrTxt.lineSpacing=8;attrTxt.x=46;attrTxt.y=titleAttrTxt.y+24;attrTxt.touchEnabled=false;this.forgeGroup.addChild(attrTxt);var attrs;switch(type){case ForgeWin.Page_Select_Boost:titleAttrTxt.text=i18n("EquipDetailedWin_16");attrs=AttributeData.getAttrStrAdd(attr,11);attrTxt.textColor=4883880;break;case ForgeWin.Page_Select_Gem:titleAttrTxt.text=i18n("EquipDetailedWin_17");attrs=AttributeData.getAttrStrAdd(attr,12);attrTxt.textColor=4883880;break;case ForgeWin.Page_Select_ZhuLing:titleAttrTxt.text=i18n("EquipDetailedWin_18");attrTxt.textColor=4883880;attrs=AttributeData.getAttrStrAdd(attr,15);break;case ForgeWin.Page_Select_Weapon:titleAttrTxt.text=i18n("EquipDetailedWin_21");break;case 4:titleAttrTxt.text=i18n("EquipDetailedWin_22");this._bottomY=titleAttrTxt.y+titleAttrTxt.height;break;case 5:titleAttrTxt.text=i18n("EquipDetailedWin_23");titleAttrTxt.textColor=4740980;attrs=attr;attrTxt.textColor=4883880;break}var info;if(type!=ForgeWin.Page_Select_ZhuLing&&type!=5&&this.roleModel)info=this.roleModel.heirloom.getInfoBySolt(this.index);var off=0;if(attrs){if(type!=ForgeWin.Page_Select_Weapon){attrTxt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(attrs,1,1,"  ",false,true,info));if(type==5){var z1=new eui.Label;z1.fontFamily="Arial";z1.size=20;z1.textColor=16577847;z1.x=24;z1.y=attrTxt.y+attrTxt.height+10;z1.touchEnabled=false;z1.width=280;this.forgeGroup.addChild(z1);z1.textFlow=TextFlowMaker.generateTextFlow("<font color = '"+(lv2?"#FCF537":"#666666")+"'>"+i18n("EquipDetailedWin_24")+(lv2?lv2:1)+"级】</b></font>");off+=z1.textHeight+10;var z2=new eui.Label;z2.fontFamily="Arial";z2.size=18;z2.lineSpacing=8;z2.textColor=16577847;z2.x=46;z2.y=z1.y+z1.textHeight+10;z2.touchEnabled=false;z2.multiline=true;z2.wordWrap=true;this.forgeGroup.addChild(z2);z2.textFlow=TextFlowMaker.generateTextFlow("<font color = '"+(lv2?"#FCF537":"#666666")+"'>"+des+"</font>");off+=z2.textHeight+10;if(skillId){var skillCfg=GlobalConfig.SkillsConfig[skillId];var skillDes=GlobalConfig.SkillsDescConfig[skillCfg.desc];var z3=new eui.Label;z3.fontFamily="Arial";z3.size=20;z3.textColor=16577847;z3.x=24;z3.y=z2.y+z2.height+10;z3.touchEnabled=false;z3.width=280;z3.wordWrap=true;z3.multiline=true;this.forgeGroup.addChild(z3);z3.textFlow=TextFlowMaker.generateTextFlow("<b>【"+skillDes.name+" "+lv+"级】</b>");off+=z3.textHeight+10;var z4=new eui.Label;z4.fontFamily="Arial";z4.size=18;z4.lineSpacing=8;z4.textColor=16577847;z4.x=46;z4.y=z3.y+z3.textHeight+10;z4.touchEnabled=false;z4.width=280;z4.wordWrap=true;z4.multiline=true;this.forgeGroup.addChild(z4);z4.textFlow=TextFlowMaker.generateTextFlow(skillDes.desc.replace("%s%",skillCfg.desc_ex[0]+""));off+=z4.textHeight+10}}}else attrTxt.textFlow=TextFlowMaker.generateTextFlow1(i18n("EquipDetailedWin_25")+attr+"%")}this._bottomY=attrTxt.y+attrTxt.height+off};EquipDetailedWin.prototype.getScore=function(){return this._score};EquipDetailedWin.prototype.getPower=function(){return this.powerPanel.power};EquipDetailedWin.prototype.getType=function(){return this.type.text};return EquipDetailedWin}(BaseEuiView);__reflect(EquipDetailedWin.prototype,"EquipDetailedWin");ViewManager.ins().reg(EquipDetailedWin,LayerManager.UI_Popup);var FlowerOpenWin=function(_super){__extends(FlowerOpenWin,_super);function FlowerOpenWin(){var _this=_super.call(this)||this;_this.skinName="flowerOpenSkin";return _this}FlowerOpenWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=FlowerRewardItemRender};FlowerOpenWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.closeBtn0,this.onTouch);this.observe(UserFb.ins().postTeamFbFlowarRecords,this.update);this.update()};FlowerOpenWin.prototype.close=function(){this.removeTouchEvent(this.closeBtn,this.onTouch);this.removeTouchEvent(this.closeBtn0,this.onTouch);this.removeObserve();UserFb.ins().clearTfFlowerRecords();var win=ViewManager.ins().getView(PlayFunView);if(win)win.removeFlowerItem()};FlowerOpenWin.prototype.update=function(){if(!this._collect){this._collect=new ArrayCollection;this.list.dataProvider=this._collect}var source=UserFb.ins().tfFlowerRecords.concat();source.reverse();this._collect.source=source;var len=source.length;var total=0;for(var i=0;i<len;i++)total+=source[i].count*GlobalConfig.TeamFuBenBaseConfig.flowerChiv;this.charmCount.text=i18n("FlowerOpenWin_0")+total+i18n("FlowerOpenWin_1")};FlowerOpenWin.prototype.onTouch=function(e){ViewManager.ins().close(this)};return FlowerOpenWin}(BaseEuiView);__reflect(FlowerOpenWin.prototype,"FlowerOpenWin");ViewManager.ins().reg(FlowerOpenWin,LayerManager.UI_Popup);var FlowerUseTipsWin=function(_super){__extends(FlowerUseTipsWin,_super);function FlowerUseTipsWin(){var _this=_super.call(this)||this;_this._sendCount=1;_this._maxCount=0;_this.skinName="flowerUseTips";return _this}FlowerUseTipsWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=FlowerTargetItemrender};FlowerUseTipsWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.addTouchEvent(this.list,this.onTouchList);this.observe(Friends.ins().postFriendChange,this.update,this);this.observe(UserBag.ins().postItemAdd,this.updateMaterial);this.observe(UserBag.ins().postItemChange,this.updateMaterial);this.observe(UserBag.ins().postItemDel,this.updateMaterial);this._sendCount=1;this._friendID=0;this.update();this.selectName.text=""};FlowerUseTipsWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeTouchEvent(this.list,this.onTouchList);this.removeObserve();this.scroller.visible=false};FlowerUseTipsWin.prototype.update=function(){if(!this._collect){this._collect=new ArrayCollection;this.list.dataProvider=this._collect}this._collect.source=Friends.ins().friendsList.source;this.updateCount();this.updateMaterial()};FlowerUseTipsWin.prototype.updateMaterial=function(){var itemData=UserBag.ins().getBagItemById(GlobalConfig.TeamFuBenBaseConfig.itemId);this._maxCount=itemData?itemData.count:0;this.itemCount.text=i18n("FlowerUseTipsWin_0")+this._maxCount};FlowerUseTipsWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.sendBtn:if(!this._friendID){UserTips.ins().showTips(i18n("FlowerUseTipsWin_1"));return}if(this._maxCount<=0||this._maxCount<this._sendCount){UserTips.ins().showTips(i18n("FlowerUseTipsWin_2"));return}UserFb.ins().sendTfFlower(this._friendID,this._sendCount);break;case this.minBtn:if(this._sendCount!=1){this._sendCount=1;this.updateCount()}break;case this.maxBtn:if(this._sendCount!=this._maxCount){this._sendCount=this._maxCount;this.updateCount()}break;case this.sub1Btn:if(this._sendCount>1){this._sendCount--;this.updateCount()}break;case this.add1Btn:if(this._sendCount<this._maxCount){this._sendCount++;this.updateCount()}break;case this.openListBtn:this.scroller.visible=!this.scroller.visible;break}};FlowerUseTipsWin.prototype.onTouchList=function(e){var selectedItem=this.list.selectedItem;if(selectedItem){this._friendID=selectedItem.id;this.selectName.text=selectedItem.name;this.scroller.visible=!this.scroller.visible}};FlowerUseTipsWin.prototype.updateCount=function(){this.numLabel.text=this._sendCount+"";this.charmPoint.text=i18n("FlowerUseTipsWin_3")+this._sendCount*GlobalConfig.TeamFuBenBaseConfig.flowerChiv};return FlowerUseTipsWin}(BaseEuiView);__reflect(FlowerUseTipsWin.prototype,"FlowerUseTipsWin");ViewManager.ins().reg(FlowerUseTipsWin,LayerManager.UI_Popup);var HejiEquipTipsWin=function(_super){__extends(HejiEquipTipsWin,_super);function HejiEquipTipsWin(){var _this=_super.call(this)||this;_this._bottomY=0;_this._equipPower=0;_this._totalPower=0;_this.curRole=0;_this.index=0;_this.gainWay=[[i18n("HejiEquipTipsWin_3"),"FbWin",4],[i18n("HejiEquipTipsWin_4"),"LimitTaskView"]];_this.skinName="HejiEquipTipsSkin";return _this}HejiEquipTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.itemIcon.imgJob.visible=false;this.waylist.itemRenderer=RingGainItem};HejiEquipTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.data=param[0];if(param[1]){this.changeBtn.visible=true}else{this.changeBtn.visible=false}this.isBagTips=param[2];this.addTouchEndEvent(this.bgClose,this.otherClose);this.addTouchEndEvent(this.changeBtn,this.onEquipChange);this.waylist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.setData(this.data)};HejiEquipTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose);this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEquipChange,this.changeBtn);this.waylist.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this)};HejiEquipTipsWin.prototype.onTouchList=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2],true);ViewManager.ins().close(this)}};HejiEquipTipsWin.prototype.otherClose=function(evt){ViewManager.ins().close(HejiEquipTipsWin)};HejiEquipTipsWin.prototype.onEquipChange=function(e){if(!this.needCount){UserTips.ins().showTips(i18n("HejiEquipTipsWin_0"));return}this.onBtn()};HejiEquipTipsWin.prototype.onBtn=function(){var nextId;if(!(this.data instanceof ItemData)&&!this.data.id){var posId=91e4+this.data+1;nextId=posId}else{nextId=this.data.configID+10}var nextItemConfig=GlobalConfig.ItemConfig[nextId];var pos=ItemConfig.getSubType(nextItemConfig);var itemList=UserBag.ins().getHejiEquipsByType(pos);var handle=0;for(var i=0;i<itemList.length;i++){if(itemList[i].configID==nextItemConfig.id&&pos==ItemConfig.getSubType(itemList[i].itemConfig)){handle=itemList[i].handle;break}}if(!handle){UserTips.ins().showTips(i18n("HejiEquipTipsWin_1"));return}var itemlv=nextItemConfig.level?nextItemConfig.level:0;var itemzslv=nextItemConfig.zsLevel?nextItemConfig.zsLevel:0;if(itemzslv>UserZs.ins().lv||itemlv>Actor.level){UserTips.ins().showTips(i18n("HejiEquipTipsWin_2",itemzslv,itemlv));return}ViewManager.ins().close(HejiEquipTipsWin);UserSkill.ins().sendDressHejiEquip(handle,pos)};HejiEquipTipsWin.prototype.setData=function(_data){var data;if(!(_data instanceof ItemData)){if(!_data.id){if(_data>91e4){data=new ItemData;data.configID=_data}else{var posId=91e4+_data+1;data=new ItemData;data.configID=posId}}else{data=new ItemData;data.configID=_data.id}var itemData=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_EQUIP,data.configID);if(!itemData||!itemData.count)this.currentState="unactivated_no";else this.currentState="unactivated_have"}else{data=_data;var next=GlobalConfig.EquipConfig[data.configID+10];if(next){var itemData=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_EQUIP,next.id);if(itemData)this.currentState="not_max";else this.currentState="not_max_no"}else this.currentState="max"}if(this.isBagTips)this.currentState="default";this.validateNow();this.needCount=0;this.setCurAttrs(data);this.setNextAttrs(data);this.unactivated(data)};HejiEquipTipsWin.prototype.unactivated=function(data){if(this.currentState=="max"||this.currentState=="default")return;var nextId;if(!(this.data instanceof ItemData)&&!this.data.id){nextId=data.configID}else{nextId=data.configID+10}var nextItemConfig=GlobalConfig.ItemConfig[nextId];this.attr0.text=""+nextItemConfig.name;this.attr0.textColor=ItemConfig.getQualityColor(nextItemConfig);this.attr0.strokeColor=ItemConfig.getQualityStrokeColor(nextItemConfig);var itemData=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_EQUIP,nextItemConfig.id);if(itemData){this.attr6.text=i18n("HejiEquipTipsWin_5",itemData.count);this.attr6.textColor=ColorUtil.UI_ITEMNUMBER_BULE_N;this.needCount=itemData.count}else{this.attr6.textColor=16711680}if(this.currentState=="unactivated_no"||this.currentState=="not_max_no"){this.waylist.dataProvider=new eui.ArrayCollection(this.gainWay)}else if(this.currentState=="unactivated_have"){this.changeBtn.label=i18n("HejiEquipTipsWin_6")}};HejiEquipTipsWin.prototype.setNextAttrs=function(data){if(this.currentState!="not_max"&&this.currentState!="not_max_no")return;this.changeBtn.label=i18n("HejiEquipTipsWin_7");var nextId=data.configID+10;var nextItemConfig=GlobalConfig.ItemConfig[nextId];var nextEquipConfig=GlobalConfig.EquipConfig[nextId];var itemConfig=nextItemConfig;this._totalPower=0;this.nextTile.text=i18n("HejiEquipTipsWin_8",itemConfig.name);this.nextTile.textColor=ItemConfig.getQualityColor(itemConfig);this.nextTile.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.attr7.text=""+itemConfig.name;this.attr7.textColor=this.nextTile.textColor;var itemData=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_EQUIP,nextItemConfig.id);if(itemData){this.attr9.text=i18n("HejiEquipTipsWin_9",itemData.count);this.attr9.textColor=ColorUtil.UI_ITEMNUMBER_BULE_N;this.needCount=itemData.count}else{this.attr9.textColor=16711680}var ii=1;this.nextAttr1.visible=false;this.nextAttr2.visible=false;this.nextAttr3.visible=false;this.nextAttr4.visible=false;var config=nextEquipConfig;var totalAttr=[];this.score.visible=false;if(data.att){for(var k in AttributeData.translate){if(!config[k]||config[k]<=0)continue;var tempAtt=new AttributeData(AttributeData.translate[k],config[k]);for(var j in data.att){if(data.att[j].type==tempAtt.type){tempAtt.value+=data.att[j].value;break}}var attrStr="";attrStr=AttributeData.getAttStrByType(tempAtt,0,"  ");totalAttr.push(tempAtt);this["nextAttr"+ii].text=attrStr;this["nextAttr"+ii].visible=true;ii++}this._bottomY=this["nextAttr"+(ii-1)].y+this["nextAttr"+(ii-1)].height}else{for(var k in AttributeData.translate){if(!config[k]||config[k]<=0)continue;var tempAtt=new AttributeData(AttributeData.translate[k],config[k]);var attrStr="";attrStr=AttributeData.getAttStrByType(tempAtt,0,"  ");totalAttr.push(tempAtt);this["nextAttr"+ii].text=attrStr;this["nextAttr"+ii].visible=true;ii++}this._bottomY=this["nextAttr"+(ii-1)].y+this["nextAttr"+(ii-1)].height}if(config.baseAttr1){var att=new AttributeData(config.baseAttr1.type,config.baseAttr1.value);totalAttr.push(att)}if(config.baseAttr2){var att=new AttributeData(config.baseAttr2.type,config.baseAttr2.value);totalAttr.push(att)}this._equipPower=Math.floor(UserBag.getAttrPower(totalAttr));this._totalPower+=this._equipPower+(config.exPower||0);this._totalPower*=SubRoles.ins().subRolesLen;this.score.text=i18n("HejiEquipTipsWin_14")+this._totalPower;while(this.nextForgeGroup.numElements){this.nextForgeGroup.removeChildAt(0)}this.addTips(config,this.nextForgeGroup);this.background.height=this._bottomY+12;this.powerPanel0.setPower(this._totalPower)};HejiEquipTipsWin.prototype.setCurAttrs=function(data){var itemConfig=data.itemConfig;this._totalPower=0;this.nameLabel.text=itemConfig.name;this.nameLabel.textColor=ItemConfig.getQualityColor(itemConfig);this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);var q=ItemConfig.getQuality(itemConfig);this.quali.source=q>0?"quali"+q:"";this.itemIcon.setData(itemConfig);if(data instanceof ItemData||itemConfig!=null){if(data&&ItemConfig.getType(data.itemConfig)==5){this.levelKey.text=itemConfig.zsLevel>0?i18n("HejiEquipTipsWin_15"):i18n("HejiEquipTipsWin_16");this.type.text=Role.getHejiEquipNameByType(ItemConfig.getSubType(itemConfig));this.lv.text=itemConfig.zsLevel>0?itemConfig.zsLevel+i18n("HejiEquipTipsWin_17"):itemConfig.level+i18n("HejiEquipTipsWin_18");if(itemConfig.zsLevel>0){this.lv.textColor=UserZs.ins().lv<itemConfig.zsLevel?15937822:242004}else{this.lv.textColor=Actor.level<(itemConfig.level||1)?15937822:242004}}}var ii=1;this.attr1.visible=false;this.attr2.visible=false;this.attr3.visible=false;this.attr4.visible=false;var config=GlobalConfig.EquipConfig[data.configID];var totalAttr=[];this.score.visible=false;if(data.att){for(var k in AttributeData.translate){if(!config[k]||config[k]<=0)continue;var tempAtt=new AttributeData(AttributeData.translate[k],config[k]);for(var j in data.att){if(data.att[j].type==tempAtt.type){tempAtt.value+=data.att[j].value;break}}var attrStr="";attrStr=AttributeData.getAttStrByType(tempAtt,0,"  ");totalAttr.push(tempAtt);this["attr"+ii].text=attrStr;this["attr"+ii].visible=true;ii++}this._bottomY=this["attr"+(ii-1)].y+this["attr"+(ii-1)].height}else{for(var k in AttributeData.translate){if(!config[k]||config[k]<=0)continue;var tempAtt=new AttributeData(AttributeData.translate[k],config[k]);var attrStr="";attrStr=AttributeData.getAttStrByType(tempAtt,0,"  ");totalAttr.push(tempAtt);this["attr"+ii].text=attrStr;this["attr"+ii].visible=true;ii++}this._bottomY=this["attr"+(ii-1)].y+this["attr"+(ii-1)].height}if(config.baseAttr1){var att=new AttributeData(config.baseAttr1.type,config.baseAttr1.value);totalAttr.push(att)}if(config.baseAttr2){var att=new AttributeData(config.baseAttr2.type,config.baseAttr2.value);totalAttr.push(att)}this._equipPower=Math.floor(UserBag.getAttrPower(totalAttr));this._totalPower+=this._equipPower+(config.exPower||0);this._totalPower*=SubRoles.ins().subRolesLen;this.score.text=i18n("HejiEquipTipsWin_19")+this._totalPower;while(this.forgeGroup.numElements){this.forgeGroup.removeChildAt(0)}this.addTips(config,this.forgeGroup);this.background.height=this._bottomY+12;this.powerPanel.setPower(this._totalPower);this.next.y=this._bottomY+12};HejiEquipTipsWin.prototype.addTips=function(data,forgeGroup){var titleAttrTxt=new eui.Label;var attrTxt=new eui.Label;if(data.baseAttr1){if(!titleAttrTxt.parent)this.createTitle(titleAttrTxt,attrTxt,forgeGroup);attrTxt.text+=AttributeData.getAttStrByType(data.baseAttr1,1,"");this._bottomY=attrTxt.y+attrTxt.height}if(data.baseAttr2){if(!titleAttrTxt.parent)this.createTitle(titleAttrTxt,attrTxt,forgeGroup);attrTxt.text+=AttributeData.getAttStrByType(data.baseAttr2,1,"");this._bottomY=attrTxt.y+attrTxt.height}if(data.exAttr1){if(!titleAttrTxt.parent)this.createTitle(titleAttrTxt,attrTxt,forgeGroup);attrTxt.text+=AttributeData.getExtAttStrByType(data.exAttr1,1,"");this._bottomY=attrTxt.y+attrTxt.height}if(data["exAttr2"]){attrTxt.text=AttributeData.getExtAttStrByType(data["exAttr2"],1,"");this._bottomY=attrTxt.y+attrTxt.height}if(this.forgeGroup==forgeGroup){var titlePunchAttrTxt=new eui.Label;var attrPunchTxt=new eui.Label;var pos=data.id%10;var lv=UserSkill.ins().getPunchForge().getPunchLevel(pos-1);var config=GlobalConfig.PunchEquipConfig[pos-1][lv];if(config){if(!titlePunchAttrTxt.parent)this.createTitle(titlePunchAttrTxt,attrPunchTxt,forgeGroup,i18n("HejiEquipTipsWin_20"));attrPunchTxt.text=AttributeData.getAttStr(config.attr,1,1," ");this._bottomY=attrPunchTxt.y+attrPunchTxt.height}}};HejiEquipTipsWin.prototype.createTitle=function(titleAttrTxt,attrTxt,forgeGroup,title){titleAttrTxt.fontFamily="Arial";titleAttrTxt.size=20;titleAttrTxt.textColor=4740980;titleAttrTxt.bold=true;titleAttrTxt.x=24;titleAttrTxt.y=this._bottomY+10+14;forgeGroup.addChild(titleAttrTxt);titleAttrTxt.text=title?title:i18n("HejiEquipTipsWin_21");attrTxt.fontFamily="Arial";attrTxt.size=18;attrTxt.lineSpacing=8;attrTxt.x=46;attrTxt.y=titleAttrTxt.y+24;attrTxt.textColor=16730612;forgeGroup.addChild(attrTxt)};return HejiEquipTipsWin}(BaseEuiView);__reflect(HejiEquipTipsWin.prototype,"HejiEquipTipsWin");ViewManager.ins().reg(HejiEquipTipsWin,LayerManager.UI_Popup);var ItemCurrencyWin=function(_super){__extends(ItemCurrencyWin,_super);function ItemCurrencyWin(){return _super.call(this)||this}ItemCurrencyWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ItemCurrencySkin";this.itemIcon.imgJob.visible=false};ItemCurrencyWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var id=param[0];var count=param[1];count=count?count:0;this.addTouchEndEvent(this,this.otherClose);this.setData(id,count)};ItemCurrencyWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};ItemCurrencyWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};ItemCurrencyWin.prototype.setData=function(id,count){var numStr="";switch(id){case MoneyConst.feat:numStr=count?count+"":"0";break}var config=GlobalConfig.MoneyConfig[id];this.nameLabel.text=config.name;this.num.text=numStr;this.setImgData(id,count);this.description.textFlow=TextFlowMaker.generateTextFlow1(config.describe);this.BG.height=170+this.description.height};ItemCurrencyWin.prototype.setImgData=function(id,count){var type=1;switch(id){case MoneyConst.yuanbao:type=5;break;case MoneyConst.gold:type=0;break;case MoneyConst.soul:case MoneyConst.chip:type=2;break;case MoneyConst.piece:type=2;break;case MoneyConst.godweaponExp:type=2;break;default:break}this.nameLabel.text=RewardData.getCurrencyName(id);this.nameLabel.textColor=ItemBase.QUALITY_COLOR[type];this.nameLabel.strokeColor=ItemBase.QUALITY_STROKE_COLOR[type];this.itemIcon.imgIcon.source=RewardData.getCurrencyRes(id);this.itemIcon.imgBg.source="quality"+type;this.setCount(count+"")};ItemCurrencyWin.prototype.setCount=function(str){if(str.length>4){var wNum=Math.floor(Number(str)/1e3);str=wNum/10+i18n("ItemCurrencyWin_0")}this.num.text=str};return ItemCurrencyWin}(BaseEuiView);__reflect(ItemCurrencyWin.prototype,"ItemCurrencyWin");ViewManager.ins().reg(ItemCurrencyWin,LayerManager.UI_Popup);var ItemDetailedWin=function(_super){__extends(ItemDetailedWin,_super);function ItemDetailedWin(){return _super.call(this)||this}ItemDetailedWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ItemTipsSkin";this.itemIcon.imgJob.visible=false};ItemDetailedWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var type=param[0];var id=param[1];var num=param[2];this.addTouchEndEvent(this,this.otherClose);this.setData(type,id,num)};ItemDetailedWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};ItemDetailedWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};ItemDetailedWin.prototype.setData=function(type,id,num){var numStr="";if(num==undefined){var data=UserBag.ins().getBagGoodsByTypeAndId(type,id);numStr=data?data.count+"":"0"}else numStr=num+"";var _ItemConfig=GlobalConfig.getConfigByName("ItemConfig");var config=_ItemConfig[id];this.nameLabel.text=config.name;this.nameLabel.textColor=ItemConfig.getQualityColor(config);this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(config);this.itemIcon.setData(config);this.lv.text=(config.level||1)+i18n("ItemDetailedWin_0");this.num.text=numStr;var str=UserMiji.ins().replaceDec(config.desc,config.id);this.description.textFlow=TextFlowMaker.generateTextFlow1(str);if(ItemConfig.getType(config)==2){var sID=MiJiSkillConfig.getSkillIDByItem(config.id);var _MiJiSkillConfig=GlobalConfig.getConfigByName("MiJiSkillConfig");this.power.text=i18n("ItemDetailedWin_1")+_MiJiSkillConfig[sID].power;this.labelLV.visible=this.lv.visible=false}else{this.power.text="";this.labelLV.visible=this.lv.visible=true}this.BG.height=170+this.description.height};return ItemDetailedWin}(BaseEuiView);__reflect(ItemDetailedWin.prototype,"ItemDetailedWin");ViewManager.ins().reg(ItemDetailedWin,LayerManager.UI_Popup);var ItemUseTipsWin=function(_super){__extends(ItemUseTipsWin,_super);function ItemUseTipsWin(){var _this=_super.call(this)||this;_this.maxNum=0;_this.oldNum=0;_this.bossBoxIdList=[230001,230002,230003];_this.onlyRetrieve=false;_this.useSuccessshow=false;_this.SuccessshowText="";return _this}ItemUseTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ItemUseTipsSkin";this.numLabel.restrict="0-9";this.itemIcon.imgJob.visible=false;this.isTopLevel=true;this.showNoBtn=false};ItemUseTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._data=param[0];this.showNoBtn=param[1];this.useSuccessshow=param[2];this.SuccessshowText=param[3];this.goodsId=this._data.configID;this.addTouchEndEvent(this.BG,this.otherClose);this.addTouchEndEvent(this.minBtn,this.onTap);this.addTouchEndEvent(this.maxBtn,this.onTap);this.addTouchEndEvent(this.sub1Btn,this.onTap);this.addTouchEndEvent(this.add1Btn,this.onTap);this.addTouchEndEvent(this.useBtn,this.onTap);this.addTouchEndEvent(this.useBtn0,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.observe(UserBag.ins().postUseItemSuccess,this.useSuccess);this.observe(UserBag.ins().postItemChange,this.itemChange);this.observe(UserBag.ins().postItemDel,this.itemChange);this.addChangeEvent(this.numLabel,this.onTxtChange);this.setData(this._data);var t=ItemConfig.getType(this._data.itemConfig);this.isBossBox=this.bossBoxIdList.lastIndexOf(this.goodsId)!=-1;this.itemList.itemRenderer=ItemBase;this.useBtn.visible=!this.showNoBtn&&!this.onlyRetrieve;this.useLabel.visible=this.showNoBtn;this.add.visible=t!=ItemType.TYPE_25;var step=MijiGuideMgr.ins().getStep();var needGuide=false;var str=i18n("ItemUseTipsWin_0");if(step==1&&MijiGuideMgr.ins().isJia(this._data.itemConfig.id)){needGuide=true}else if(step==2&&t==ItemType.TYPE_2){needGuide=true;str=i18n("ItemUseTipsWin_1")}var step2=DressGuideMgr.ins().getStep();var needGuide2=false;if(step2==1&&DressGuideMgr.ins().isJia(this._data.itemConfig.id)){needGuide2=true;str=i18n("ItemUseTipsWin_2")}this.guideArrow=new GuideArrow2(true);this.guideArrow.x=245;this.guideArrow.y=427;this.anigroup.addChildAt(this.guideArrow,1e4);this.guideArrow.visible=false;this.guideArrow.touchEnabled=false;if(needGuide||needGuide2){this.guideArrow.setTips(str);this.guideArrow.visible=true;this.guideArrow.setDirection(1)}else{this.guideArrow.visible=false;this.guideArrow.removeTweens()}};ItemUseTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.BG.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this);this.minBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this);this.maxBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this);this.sub1Btn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this);this.add1Btn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this);this.useBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this);this.numLabel.removeEventListener(egret.Event.CHANGE,this.onTxtChange,this);this.removeTouchEvent(this.bgClose,this.onTap);this.removeObserve();this._data=null};ItemUseTipsWin.prototype.otherClose=function(evt){ViewManager.ins().close(ItemUseTipsWin)};ItemUseTipsWin.prototype.onTxtChange=function(e){var num=Number(this.numLabel.text);if(num>this.maxNum){num=this.maxNum}else if(num<=0){num=1}this.useNum=num;this.numLabel.text=this.useNum+""};ItemUseTipsWin.prototype.onTap=function(e){switch(e.target){case this.minBtn:this.useNum=1;break;case this.maxBtn:this.useNum=this.maxNum;break;case this.sub1Btn:this.useNum--;if(this.useNum<=0){this.useNum=1}break;case this.add1Btn:this.useNum++;if(this.useNum>this.maxNum){this.useNum=this.maxNum}break;case this.useBtn:if(Number(this.numLabel.text)<=0){this.numLabel.text="1"}this.onUse();break;case this.useBtn0:this.onBack();break;case this.bgClose:ViewManager.ins().close(this);break}this.numLabel.text=this.useNum+""};ItemUseTipsWin.prototype.onUse=function(){var config=this._data.itemConfig;if(config.id==GlobalConfig.WingCommonConfig.attrPillId||config.id==GlobalConfig.WingCommonConfig.flyPillId){Wing.ins().userDans(config.id);ViewManager.ins().close(this);return}if(this.checkCanMerge()){this.onMerge();ViewManager.ins().close(ItemUseTipsWin);return}var _type=ItemConfig.getType(config);if(_type==ItemType.TYPE_2){ViewManager.ins().open(SkillWin,3);ViewManager.ins().close(this);UserMiji.ins().postBagUseMiji(config.id);return}if(_type==ItemType.TYPE_10){this.onUseType10();ViewManager.ins().close(ItemUseTipsWin);return}if(_type==ItemType.TYPE_13){this.onUseType13();ViewManager.ins().close(ItemUseTipsWin);return}if(_type==ItemType.TYPE_14){this.onUseType14();ViewManager.ins().close(ItemUseTipsWin);return}if(_type==ItemType.TYPE_20){if(!SpecialRing.ins().checkCanUseByItem(config.id)){UserTips.ins().showTips(i18n("ItemUseTipsWin_3"));ViewManager.ins().close(ItemUseTipsWin);return}}if(config.id==ItemConst.LEVELUP_ITEM){var rch=Recharge.ins().getRechargeData(0);if(!rch.num){UserTips.ins().showTips(i18n("ItemUseTipsWin_4"));ViewManager.ins().close(ItemUseTipsWin);Recharge.ins().tryShowChargeFirstWin();return}}if(config.id==GlobalConfig.MijiBaseConfig.lockId){ViewManager.ins().close(ItemUseTipsWin);ViewManager.ins().open(MijiLockWin,UserMiji.BAGOPEN);return}if(_type==ItemType.TYPE_9){ViewManager.ins().close(ItemUseTipsWin);ViewManager.ins().open(LiLianWin,3);return}if(this.isBossBox){ViewManager.ins().close(ItemUseTipsWin);ViewManager.ins().open(RandBossWin,this.goodsId);return}if(config.needyuanbao&&Actor.yb<config.needyuanbao){ViewManager.ins().close(this);if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("ItemUseTipsWin_5"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("ItemUseTipsWin_6"));return}if(_type==ItemType.TYPE_8||_type==ItemType.TYPE_27){var lv=config.level?config.level:0;var zslv=config.zsLevel?config.zsLevel:0;if(Actor.level>=lv&&UserZs.ins().lv>=zslv){}else{var tips="";if(UserZs.ins().lv<zslv){tips+=i18n("ItemUseTipsWin_7",zslv)}if(Actor.level<lv){tips+=i18n("ItemUseTipsWin_8",lv)}UserTips.ins().showTips(i18n("ItemUseTipsWin_9",tips))}}if(_type==ItemType.TYPE_25){Auction.ins().sendOpenAuBox(config.id);ViewManager.ins().close(ItemUseTipsWin);return}if(UserBag.ins().sendUseItem(this.goodsId,this.useNum)||config.split){ViewManager.ins().close(ItemUseTipsWin)}if(MijiGuideMgr.ins().getStep()==1&&MijiGuideMgr.ins().isJia(config.id)){MijiGuideMgr.ins().toStep(2)}if(DressGuideMgr.ins().getStep()==1&&DressGuideMgr.ins().isJia(config.id)){DressGuideMgr.ins().toStep(2)}};ItemUseTipsWin.prototype.onUseType10=function(){var config=this._data.itemConfig;var index=config.id==200013?0:1;for(var i=0;i<SubRoles.MAX_ROLES;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role){var ringLv=SubRoles.ins().getSubRoleByIndex(i).getExRingsData(index);if(ringLv<=0){ViewManager.ins().open(RoleWin,0,i);ViewManager.ins().close(ItemUseTipsWin);break}}else{UserTips.ins().showTips(i18n("ItemUseTipsWin_10"));break}}};ItemUseTipsWin.prototype.onUseType13=function(){var config=this._data.itemConfig;var boosType=config.useCond;if(config.descIndex==300){this.onUseType13_300();return}else if(config.descIndex==302){this.onUseType13_302();return}if(!boosType){UserTips.ins().showTips(i18n("ItemUseTipsWin_11"));return}var leftSum=UserBoss.ins().worldBossLeftTime[boosType];var bname=config.name;if(leftSum>0){UserTips.ins().showTips(i18n("ItemUseTipsWin_14",bname));return}UserTips.ins().showTips(i18n("ItemUseTipsWin_15",this.useNum,bname));UserBag.ins().sendUseItem(this.goodsId,this.useNum)};ItemUseTipsWin.prototype.onUseType13_300=function(){var leftSum=UserFb.ins().fbRings.challengeTime;if(leftSum>0){UserTips.ins().showTips(i18n("ItemUseTipsWin_16"));return}UserTips.ins().showTips(i18n("ItemUseTipsWin_17",this.useNum));UserBag.ins().sendUseItem(this.goodsId,this.useNum)};ItemUseTipsWin.prototype.onUseType13_302=function(){var leftSum=GodWeaponCC.ins().fubenInfoData.hadChallengeNum;if(leftSum>0){UserTips.ins().showTips(i18n("ItemUseTipsWin_18"));return}UserTips.ins().showTips(i18n("ItemUseTipsWin_19",this.useNum));UserBag.ins().sendUseItem(this.goodsId,this.useNum)};ItemUseTipsWin.prototype.onUseType14=function(){ViewManager.ins().open(RenameWin)};ItemUseTipsWin.prototype.onMerge=function(){var itemConfig=this._data.itemConfig;var id=itemConfig.id;var count=this._data.count;var mergeConfig=GlobalConfig.ItemComposeConfig[id];if(mergeConfig.srcCount>count){UserTips.ins().showTips(i18n("ItemUseTipsWin_20"));return}UserBag.ins().sendMergeItem(id,count)};ItemUseTipsWin.prototype.onBack=function(){var config=this._data.itemConfig;if(ItemConfig.getType(config)==ItemType.TYPE_10){UserBag.ins().sendUseItem(this.goodsId,this.useNum)}else{if(UserBag.ins().sendUseItem(this.goodsId,this.useNum)){ViewManager.ins().close(ItemUseTipsWin)}}};ItemUseTipsWin.prototype.useSuccess=function(){var data=UserBag.ins().getBagItemById(this.goodsId);if(this.useSuccessshow){if(this.SuccessshowText)WarnWin.show(this.SuccessshowText,null,null,null,null,"sure")}if(!data){ViewManager.ins().close(ItemUseTipsWin)}else{this.setData(data);this.onTxtChange(null)}};ItemUseTipsWin.prototype.itemChange=function(){var data=UserBag.ins().getBagItemById(this.goodsId);if(data){this.setData(data);this.onTxtChange(null)}else{ViewManager.ins().close(this)}};ItemUseTipsWin.prototype.updateState=function(){var data=this._data;var type=ItemConfig.getType(data.itemConfig);if(this.checkCanMerge()){this.currentState="rename"}else if(type==ItemType.TYPE_2){this.currentState="2"}else if(type==ItemType.TYPE_10){this.currentState="10"}else if(type==ItemType.TYPE_12){this.currentState="guildgifts"}else if(type==ItemType.TYPE_14){this.currentState="rename"}else{this.currentState="2"}};ItemUseTipsWin.prototype.checkCanMerge=function(){var data=this._data;var id=data.itemConfig.id;return!!GlobalConfig.ItemComposeConfig[id]};ItemUseTipsWin.prototype.updateBaseInfo=function(idata){var data=this._data;idata.count=idata.count?idata.count:1;var numStr=idata.count+"";var config=data.itemConfig;this.nameLabel.text=config.name;this.nameLabel.textColor=ItemConfig.getQualityColor(config);this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(config);this.itemIcon.setData(config);this.lv.text=(config.level||1)+i18n("ItemUseTipsWin_22");this.num.text=numStr;var str=UserMiji.ins().replaceDec(config.desc,config.id);this.description.textFlow=TextFlowMaker.generateTextFlow(str)};ItemUseTipsWin.prototype.updateUse=function(){var data=this._data;this.useNum=this._data.count;this.numLabel.text=this.useNum+"";this.oldNum=data.count;this.maxNum=data.count};ItemUseTipsWin.prototype.updateHandlePos=function(){var data=this._data};ItemUseTipsWin.prototype.setData=function(data){this.onlyRetrieve=false;this._data=data;var config=this._data.itemConfig;this.updateState();this.updateBaseInfo(data);var type=ItemConfig.getType(config);if(type==ItemType.TYPE_2){this.updateType2()}else if(type==ItemType.TYPE_10){this.updateType10()}if(this.checkCanMerge()){this.useBtn.label=i18n("ItemUseTipsWin_23")}else if(config.needyuanbao){this.useBtn.label=config.needyuanbao+i18n("ItemUseTipsWin_24")}this.updateUse();this.updateHandlePos();this.updateGuildGift(config);if(ItemConfig.getType(config)==2){this.labelLV.visible=this.lv.visible=false}else{this.labelLV.visible=this.lv.visible=true}};ItemUseTipsWin.prototype.updateType2=function(){};ItemUseTipsWin.prototype.updateGuildGift=function(config){var cfg=GlobalConfig.ItemGiftConfig[config.id];if(cfg){this.itemList.dataProvider=new eui.ArrayCollection(cfg.awards)}};ItemUseTipsWin.prototype.updateType10=function(){var config=this._data.itemConfig;var activityNum=0;if(SubRoles.ins().subRolesLen==SubRoles.MAX_ROLES){var index=config.id==200013?0:1;for(var i=0;i<SubRoles.MAX_ROLES;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role){var ringLv=SubRoles.ins().getSubRoleByIndex(i).getExRingsData(index);if(ringLv>0){activityNum+=1}}}}if(activityNum==SubRoles.MAX_ROLES){this.onlyRetrieve=true;this.useBtn0.horizontalCenter=0;this.useBtn.visible=false}else{this.useBtn0.visible=true;this.useBtn0.horizontalCenter=-90;this.useBtn.visible=true}};return ItemUseTipsWin}(BaseEuiView);__reflect(ItemUseTipsWin.prototype,"ItemUseTipsWin");ViewManager.ins().reg(ItemUseTipsWin,LayerManager.UI_Popup);var RuneTipsWin=function(_super){__extends(RuneTipsWin,_super);function RuneTipsWin(){return _super!==null&&_super.apply(this,arguments)||this}RuneTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="RuneTipsSkin";this.cur_desc=""};RuneTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var id=param[0];this.item_config_id=param[1];this.cur_desc=param[2];this.cur_desc2=param[3];this.addTouchEndEvent(this,this.otherClose);this.addTouchEndEvent(this.userBtn,this.onUser);this.setData(this.item_config_id)};RuneTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};RuneTipsWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};RuneTipsWin.prototype.onUser=function(evt){var conf=Rune.ins().getRuneMergeByID(this.item_config_id);if(conf){ViewManager.ins().open(BagWin,3,MergeType.Rune,conf.mixId[1],Rune.ins().getMergeIndexByType(conf.mixId[1],conf.id))}};RuneTipsWin.prototype.setData=function(id){var itemCfg=GlobalConfig.ItemConfig[id];if(!itemCfg){return}this.itemIcon.setData(itemCfg);var lvstr="";var itemLv=itemCfg.id%100;if(itemLv==0){if(!this.cur_desc2){lvstr=itemLv+" 级"}}else{if(ItemConfig.getSubType(itemCfg)!=0){lvstr=itemLv+" 级"}}this.nameLabel.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+ItemConfig.getQualityColor(itemCfg)+"'>"+itemCfg.name+" · "+lvstr+"</font>");this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(itemCfg);this.userBtn.visible=false;if(Rune.ins().isOpen()&&Rune.ins().getRuneMergeByID(itemCfg.id))this.userBtn.visible=true;var desc="";var isRune=false;if(ItemConfig.getType(itemCfg)==1){this.randomAttr.text=itemCfg.desc}else{var runeCfg=GlobalConfig.RuneBaseConfig[id];if(!runeCfg){this.randomAttr.visible=true;this.randomAttr.text=itemCfg.desc;if(this.cur_desc2)this.attrDes.text=i18n("RuneTipsWin_2",this.cur_desc2);else this.attrDes.visible=false}else{isRune=true;this.attrName.text=RuneConfigMgr.ins().getcfgAttrData(runeCfg);this.attrValue.text=RuneConfigMgr.ins().getcfgAttrData(runeCfg,false);this.attrName.x=this.runeAttr.width/2-(this.attrName.width+this.attrValue.width)/2;this.attrValue.x=this.attrName.x+this.attrName.width;this.attrDes.text=this.cur_desc}}this.attrName.visible=this.attrValue.visible=isRune;this.randomAttr.visible=!isRune};return RuneTipsWin}(BaseEuiView);__reflect(RuneTipsWin.prototype,"RuneTipsWin");ViewManager.ins().reg(RuneTipsWin,LayerManager.UI_Popup);var RuneTowerTipsWin=function(_super){__extends(RuneTowerTipsWin,_super);function RuneTowerTipsWin(){var _this=_super.call(this)||this;_this.skinName="RuneTowerTips";return _this}RuneTowerTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.setTipsData()};RuneTowerTipsWin.prototype.close=function(){};RuneTowerTipsWin.prototype.setTipsData=function(){var level=SkyLevelModel.ins().cruLevel;var cfg=GlobalConfig.FbChallengeConfig[level];var dayRewardBuffShow=cfg.dayRewardBuffShow||0;var clearRewardBuffShow1=cfg.clearRewardBuffShow1||0;var clearRewardBuffShow2=cfg.clearRewardBuffShow2||0;var clearRewardBuffShow3=cfg.clearRewardBuffShow3||0;this.dayRewardBuffShow.text=dayRewardBuffShow.toString();this.clearRewardBuffShow1.text=clearRewardBuffShow1.toString();this.clearRewardBuffShow2.text=clearRewardBuffShow2.toString();this.clearRewardBuffShow3.text=clearRewardBuffShow3.toString()};RuneTowerTipsWin.prototype.otherClose=function(){ViewManager.ins().close(this)};return RuneTowerTipsWin}(BaseEuiView);__reflect(RuneTowerTipsWin.prototype,"RuneTowerTipsWin");ViewManager.ins().reg(RuneTowerTipsWin,LayerManager.UI_Popup);var SmeltEquipItem=function(_super){__extends(SmeltEquipItem,_super);function SmeltEquipItem(){var _this=_super.call(this)||this;_this.touchChildren=false;return _this}SmeltEquipItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.mc=new MovieClip;this.mc.x=45;this.mc.y=40};SmeltEquipItem.prototype.dataChanged=function(){this.clear();if(this.data instanceof ItemData){this.itemConfig=this.data.itemConfig;this.itemIcon.setData(this.itemConfig);var type=ItemConfig.getType(this.itemConfig);var job=ItemConfig.getJob(this.itemConfig);if(type==4){this.nameTxt.text=this.itemConfig.name}else{var curType=this.itemConfig?ItemConfig.getSubType(this.itemConfig):-1;if(curType==ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]){this.nameTxt.text=this.itemConfig.name}else{this.nameTxt.text=isNaN(this.itemConfig.zsLevel)?(this.itemConfig.level||1)+"级":this.itemConfig.zsLevel+i18n("SmeltEquipItem_0")}if(UserBag.fitleEquip.indexOf(this.itemConfig.id)!=-1){this.nameTxt.text=i18n("SmeltEquipItem_1")}}this.itemIcon.imgJob.source=(type==0||type==4)&&job&&this.itemIcon.imgJob.visible?"job"+job+"Item":""}};SmeltEquipItem.prototype.onClick=function(){};SmeltEquipItem.prototype.playEff=function(){if(this.data){this.mc.playFile(RES_DIR_EFF+"litboom",1);this.addChild(this.mc);this.selectFrame.visible=false}};SmeltEquipItem.prototype.clear=function(){_super.prototype.clear.call(this);this.itemIcon.imgJob.source=null};return SmeltEquipItem}(ItemBase);__reflect(SmeltEquipItem.prototype,"SmeltEquipItem");var SmeltEquipTotalWin=function(_super){__extends(SmeltEquipTotalWin,_super);function SmeltEquipTotalWin(){var _this=_super.call(this)||this;_this.skinName="SmeltMainViewSkin";_this.isTopLevel=true;return _this}SmeltEquipTotalWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};SmeltEquipTotalWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.lastSelect=0;this.equip.open();this.addTouchEvent(this.bgClose,this.onTap)};SmeltEquipTotalWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.equip.close();this.removeTouchEvent(this.bgClose,this.onTap)};SmeltEquipTotalWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};return SmeltEquipTotalWin}(BaseEuiView);__reflect(SmeltEquipTotalWin.prototype,"SmeltEquipTotalWin");ViewManager.ins().reg(SmeltEquipTotalWin,LayerManager.UI_Popup);var SmeltSelectItem=function(_super){__extends(SmeltSelectItem,_super);function SmeltSelectItem(){var _this=_super.call(this)||this;_this.translate={hp:AttributeType.atMaxHp,atk:AttributeType.atAttack,def:AttributeType.atDef,res:AttributeType.atRes,crit:AttributeType.atCrit,tough:AttributeType.atTough};_this.skinName="SmeltSeletctItemSkin";_this.touchChildren=false;return _this}SmeltSelectItem.prototype.createChildren=function(){_super.prototype.createChildren.call(this)};SmeltSelectItem.prototype.dataChanged=function(){if(this.data instanceof ItemData){var data=this.data;this.itemConfig=data.itemConfig;this.arrowIcon.visible=false;if(!this.itemConfig)return;this.itemIcon.setData(this.itemConfig);var type=ItemConfig.getType(this.itemConfig);if(type==4){this.updateWingEquip();this.lvLabel.text=this.itemConfig.name}else if(type==0){this.lvLabel.text=this.itemConfig.zsLevel?this.itemConfig.zsLevel+i18n("SmeltSelectItem_0"):this.itemConfig.level+"级"}else{this.lvLabel.text=""}this.nameLabel.textColor=ItemConfig.getQualityColor(this.itemConfig);this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(this.itemConfig);this.nameLabel.text=this.itemConfig.name;this.gradeLabel.text=i18n("SmeltSelectItem_1")+data.point;this.attrLabel.text=AttributeData.getAttrInfoByItemData(data)}};SmeltSelectItem.prototype.updateWingEquip=function(){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var wingsData=SubRoles.ins().getSubRoleByIndex(i).wingsData;var equipLen=wingsData.equipsLen;for(var k=0;k<equipLen;k++){var equdata=wingsData.getEquipByIndex(k);if(equdata.item.configID!=0){if(ItemConfig.getSubType(this.data.itemConfig)==ItemConfig.getSubType(equdata.item.itemConfig)&&this.data.point>equdata.item.point){this.arrowIcon.visible=true;return}}else if(this.data.itemConfig.subType==k){this.arrowIcon.visible=true;return}}}};return SmeltSelectItem}(BaseItemRender);__reflect(SmeltSelectItem.prototype,"SmeltSelectItem");var SmeltSelectWin=function(_super){__extends(SmeltSelectWin,_super);function SmeltSelectWin(){return _super.call(this)||this}SmeltSelectWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="SmeltSelectSkin";this.isTopLevel=true;this.itemList.itemRenderer=SmeltSelectItem;this.itemScroller.viewport=this.itemList;this.checkList=[]};SmeltSelectWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.len=param[1];this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.sureBtn,this.onTap);this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);var list=param[0];list.sort(UserBag.ins().sort2);this.itemList.dataProvider=new eui.ArrayCollection(param[0])};SmeltSelectWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.sureBtn,this.onTap);this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.foolChecklist();this.removeObserve();UserEquip.ins().postEquipCheckList(this.checkList)};SmeltSelectWin.prototype.onItemTap=function(e){var item=e.itemRenderer;item.checkBoxs.selected=!item.checkBoxs.selected;var itemData=this.itemList.selectedItem;if(item.checkBoxs.selected){if(this.checkList.length<this.len){this.checkList[this.checkList.length]=itemData;if(this.checkList.length>=this.len){this.autoClose();return}}else{this.autoClose();return}}else{var index=this.checkList.indexOf(itemData);if(index<0)return;this.checkList.splice(index,1)}this.setCountLabel(this.checkList.length)};SmeltSelectWin.prototype.autoClose=function(){UserEquip.ins().postEquipCheckList(this.checkList);ViewManager.ins().close(SmeltSelectWin)};SmeltSelectWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(SmeltSelectWin);break;case this.sureBtn:UserEquip.ins().postEquipCheckList(this.checkList);ViewManager.ins().close(SmeltSelectWin);break}};SmeltSelectWin.prototype.setSmeltEquipList=function(list){var _this=this;this.checkList=list;this.checkListData();this.setCountLabel(this.checkList.length);TimerManager.ins().doTimer(60,1,function(){for(var i=0;i<_this.checkList.length;i++){for(var j=0;j<_this.itemList.numElements;j++){var item=_this.itemList.getElementAt(j);if(_this.checkList[i]&&item&&_this.checkList[i].handle==item.data.handle){if(_this.checkList.length<=_this.len){item.checkBoxs.selected=true}break}}}},this)};SmeltSelectWin.prototype.setCountLabel=function(count){this.countLabel.text=count+"/"+this.len};SmeltSelectWin.prototype.checkListData=function(){var len=this.checkList.length;for(var i=len-1;i>=0;i--){if(this.checkList[i]==null){this.checkList.splice(i,1)}}};SmeltSelectWin.prototype.foolChecklist=function(){var len=this.checkList.length;for(var i=0;i<this.len;i++){if(i>=len){this.checkList.push(null)}}};return SmeltSelectWin}(BaseEuiView);__reflect(SmeltSelectWin.prototype,"SmeltSelectWin");ViewManager.ins().reg(SmeltSelectWin,LayerManager.UI_Main);var SwordSkinTipsWin=function(_super){__extends(SwordSkinTipsWin,_super);function SwordSkinTipsWin(){var _this=_super.call(this)||this;_this.trival=0;_this.trivalType=1;_this.skinName="DressTipsSkin";return _this}SwordSkinTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.itemConfig=param[0];this.trival=param[1];this.itemId=this.itemConfig.id;this.addTouchEvent(this.takeBtn,this.onTap);this.addTouchEndEvent(this,this.otherClose);this.setTipsData()};SwordSkinTipsWin.prototype.close=function(){this.itemData=null};SwordSkinTipsWin.prototype.setTipsData=function(){var data;this.trialTxt.text="";if(this.trival==1){var res_2=SwordSkinMgr.ins().getIdByTrialId(this.itemId);data=res_2[0];var yb=data.tryOn.count||0;this.trialTxt.text=i18n("SwordSkinTipsWin_2",data.tryOn.level);this.takeBtn.label=i18n("SwordSkinTipsWin_3");this.trivalType=res_2[1];if(this.trivalType==0){this.takeBtn.label=i18n("SwordSkinTipsWin_4");this.trialTxt.text=i18n("SwordSkinTipsWin_5",yb)}}else{data=this.getIdByItemId(this.itemId)}if(!data)return;this.itemData=data;var attr=GlobalConfig.SwordSkinLevelConfig[data.id][1].attr;var power=UserBag.getAttrPower(AttributeData.transformAttr(attr));this.powerPanel.setPower(power);this.itemname.text=data.name;this.style.text=i18n("SwordSkinTipsWin_0");this.dressName.text=data.name;var equip=new EquipTipsItemBase;equip.data={title:i18n("SwordSkinTipsWin_1"),titleColor:2188190,attributeData:attr,colorName:298564,colorValue:298564,others:null};this.content.addChild(equip);var mcX=201;var mcY=157;var res=data.fjMcFile;this.mcGroup.x=mcX;this.mcGroup.y=mcY;imageToMc(this.mcImg,res,this.mcGroup,null,RES_DIR_EFF,false,true);this.takeBtn.label=i18n("WeaponPanel_7")};SwordSkinTipsWin.prototype.onTap=function(){if(this.trival==1){var cjob=1;if(this.itemData){cjob=this.itemData.roletype}var role=SubRoles.ins().getSubRoleByJob(cjob);var idx=role&&role.index||0;switch(this.trivalType){case 0:SwordSkinMgr.ins().sendSwordSkinActivate(this.itemData.id,idx+1,this.trival);break;case 1:this.activate();break;case 2:UserTips.ins().showTips(i18n("SwordSkinTipsWin_6"));break}}else{this.activate()}ViewManager.ins().close(this)};SwordSkinTipsWin.prototype.activate=function(){var cjob=0;if(this.itemData){cjob=this.itemData.roletype}var role=SubRoles.ins().getSubRoleByJob(cjob);if(role){var id=this.trival;if(this.trival==1){id=this.itemData.id}ViewManager.ins().open(SwordSkinWin,null,role.index,this.itemData.id)}else{UserTips.ins().showTips(i18n("SwordSkinTipsWin_6"))}};SwordSkinTipsWin.prototype.otherClose=function(e){ViewManager.ins().close(this)};SwordSkinTipsWin.prototype.getIdByItemId=function(itemId){var allData=GlobalConfig.SwordSkinConfig;var elements=[];for(var key in allData){var element=allData[key];if(element.mat==itemId){elements.push(element)}}var job=SubRoles.ins().getFirstJob();var res=elements[job-1]||null;var len=elements.length;if(len<job&&len>0){res=elements[0]}return res};return SwordSkinTipsWin}(BaseEuiView);__reflect(SwordSkinTipsWin.prototype,"SwordSkinTipsWin");ViewManager.ins().reg(SwordSkinTipsWin,LayerManager.UI_Popup);var FlowerRewardItemRender=function(_super){__extends(FlowerRewardItemRender,_super);function FlowerRewardItemRender(){var _this=_super.call(this)||this;_this.skinName="flowerRewardItem";return _this}FlowerRewardItemRender.prototype.dataChanged=function(){this.playerName.text=this.data.roleName;this.flowerCount.textFlow=TextFlowMaker.generateTextFlow(i18n("FlowerRewardItemRender_0",65280,this.data.count))};return FlowerRewardItemRender}(BaseItemRender);__reflect(FlowerRewardItemRender.prototype,"FlowerRewardItemRender");var FlowerShowItem=function(_super){__extends(FlowerShowItem,_super);function FlowerShowItem(){var _this=_super.call(this)||this;_this.skinName="flowerShowItem";return _this}FlowerShowItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this._inited=true;this.showEffect()};FlowerShowItem.prototype.onTouch=function(e){ViewManager.ins().open(FlowerOpenWin);DisplayUtils.removeFromParent(this)};FlowerShowItem.prototype.onRemove=function(e){this.flowerImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this);if(this.mcEff){this.mcEff.destroy();this.mcEff=null;this.isPlaying=false}};FlowerShowItem.prototype.showEffect=function(){if(!this._inited)return;if(this.isPlaying)return;this.flowerImg.alpha=0;if(!this.mcEff){this.mcEff=ObjectPool.pop("MovieClip");this.flowereff.addChild(this.mcEff)}this.mcEff.playFile(RES_DIR_EFF+"flowereff",1,this.playComplete.bind(this),true);this.isPlaying=true;if(!this.flowerImg.hasEventListener(egret.TouchEvent.TOUCH_TAP))this.flowerImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);if(!this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE))this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this);this.flowerImg.source=null;this.flowerImg.source="flower_openImg";this.imgBg.source=null;this.imgBg.source="main_hongbaotexiao_png"};FlowerShowItem.prototype.playComplete=function(){this.mcEff.destroy();this.mcEff=null;this.flowerImg.alpha=1;this.isPlaying=false};return FlowerShowItem}(eui.Component);__reflect(FlowerShowItem.prototype,"FlowerShowItem");var FlowerTargetItemrender=function(_super){__extends(FlowerTargetItemrender,_super);function FlowerTargetItemrender(){var _this=_super.call(this)||this;_this.skinName="flowerTargetItem";_this.touchChildren=false;_this.touchEnabled=true;return _this}FlowerTargetItemrender.prototype.dataChanged=function(){this.nameTxt.text=this.data.name};return FlowerTargetItemrender}(BaseItemRender);__reflect(FlowerTargetItemrender.prototype,"FlowerTargetItemrender");var BaoZang=function(_super){__extends(BaoZang,_super);function BaoZang(){var _this=_super.call(this)||this;_this.chapterVip={};_this.chapterReward={};_this.chapterVipReward={};_this.chapterFuliReward={};_this.chapterFuliVipReward={};_this.chapterVipBuyCount=0;_this.chapterCount=0;_this.chapterRewardRedPoint=false;_this.chapterVipRewardRedPoint=false;_this.chapterFuliRewardRedPoint=false;_this.chapterFuliVipRewardRedPoint=false;_this.chapterPhaseRedPoint={};_this.chapterFirstRedPoint=true;_this.chapterVipHasBuy=0;_this.chapterVipRedPoint=false;_this.chapterHasChange=false;_this.fuwentaVip={};_this.fuwentaReward={};_this.fuwentaVipReward={};_this.fuwentaFuliReward={};_this.fuwentaFuliVipReward={};_this.fuwentaVipBuyCount=0;_this.fuwentaCount=0;_this.fuwentaRewardRedPoint=false;_this.fuwentaVipRewardRedPoint=false;_this.fuwentaFuliRewardRedPoint=false;_this.fuwentaFuliVipRewardRedPoint=false;_this.fuwentaPhaseRedPoint={};_this.fuwentaFirstRedPoint=true;_this.fuwentaVipHasBuy=0;_this.fuwentaVipRedPoint=false;_this.fuwentaHasChange=false;_this.nanguanVip={};_this.nanguanReward={};_this.nanguanVipReward={};_this.nanguanFuliReward={};_this.nanguanFuliVipReward={};_this.nanguanVipBuyCount=0;_this.nanguanCount=0;_this.nanguanRewardRedPoint=false;_this.nanguanVipRewardRedPoint=false;_this.nanguanFuliRewardRedPoint=false;_this.nanguanFuliVipRewardRedPoint=false;_this.nanguanPhaseRedPoint={};_this.nanguanFirstRedPoint=true;_this.nanguanVipHasBuy=0;_this.nanguanVipRedPoint=false;_this.nanguanHasChange=false;_this.sysId=PackageID.BaoZang;_this.regNetMsg(1,_this.dealNewInfo);return _this}BaoZang.ins=function(){return _super.ins.call(this)};BaoZang.prototype.sendInfo=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};BaoZang.prototype.dealNewInfo=function(bytes){var type=bytes.readInt();switch(type){case BaoZang.TYPE_BZ.chapter:this.postChapterData(bytes);break;case BaoZang.TYPE_BZ.fuwenta:this.postFuwentaData(bytes);break;case BaoZang.TYPE_BZ.nanguan:this.postNanguanData(bytes);break}};BaoZang.prototype.postChapterData=function(bytes){if(!bytes)return;this.chapterHasChange=true;var len;var id;var i;var conf=GlobalConfig.BaoZangChapterConfig;this.chapterRewardRedPoint=false;this.chapterVipRewardRedPoint=false;this.chapterFuliRewardRedPoint=false;this.chapterFuliVipRewardRedPoint=false;this.chapterPhaseRedPoint={};this.chapterVipRedPoint=false;len=bytes.readInt();for(i=0;i<len;i++){id=bytes.readInt();this.chapterVip[id]=bytes.readInt();this.chapterVipRedPoint=this.chapterVipRedPoint||this.chapterVip[id]==BaoZang.TYPE_GET.open}len=bytes.readInt();for(i=0;i<len;i++){id=bytes.readInt();this.chapterReward[id]=bytes.readInt();this.chapterVipReward[id]=bytes.readInt();this.chapterRewardRedPoint=this.chapterRewardRedPoint||this.chapterReward[id]==BaoZang.TYPE_GET.open;this.chapterVipRewardRedPoint=this.chapterVipRewardRedPoint||this.chapterVipReward[id]==BaoZang.TYPE_GET.open;this.chapterPhaseRedPoint[conf[id].group]=this.chapterPhaseRedPoint[conf[id].group]||this.chapterVip[conf[id].group]==BaoZang.TYPE_GET.open||this.chapterReward[id]==BaoZang.TYPE_GET.open||this.chapterVipReward[id]==BaoZang.TYPE_GET.open}len=bytes.readInt();for(i=0;i<len;i++){id=bytes.readInt();this.chapterFuliReward[id]=bytes.readInt();this.chapterFuliVipReward[id]=bytes.readInt();this.chapterFuliRewardRedPoint=this.chapterFuliRewardRedPoint||this.chapterFuliReward[id]==BaoZang.TYPE_GET.open;this.chapterFuliVipRewardRedPoint=this.chapterFuliVipRewardRedPoint||this.chapterFuliVipReward[id]==BaoZang.TYPE_GET.open}this.chapterVipBuyCount=bytes.readInt();this.chapterCount=bytes.readInt();this.chapterVipHasBuy=bytes.readByte();this.chapterFirstRedPoint=this.chapterFirstRedPoint&&this.chapterVipHasBuy==BaoZang.TYPE_BUY.noBuy};BaoZang.prototype.postFuwentaData=function(bytes){if(!bytes)return;this.fuwentaHasChange=true;var len;var id;var i;var conf=GlobalConfig.BaoZangFuwentaConfig;this.fuwentaRewardRedPoint=false;this.fuwentaVipRewardRedPoint=false;this.fuwentaFuliRewardRedPoint=false;this.fuwentaFuliVipRewardRedPoint=false;this.fuwentaPhaseRedPoint={};this.fuwentaVipRedPoint=false;len=bytes.readInt();for(i=0;i<len;i++){id=bytes.readInt();this.fuwentaVip[id]=bytes.readInt();this.fuwentaVipRedPoint=this.fuwentaVipRedPoint||this.fuwentaVip[id]==BaoZang.TYPE_GET.open}len=bytes.readInt();for(i=0;i<len;i++){id=bytes.readInt();this.fuwentaReward[id]=bytes.readInt();this.fuwentaVipReward[id]=bytes.readInt();this.fuwentaRewardRedPoint=this.fuwentaRewardRedPoint||this.fuwentaReward[id]==BaoZang.TYPE_GET.open;this.fuwentaVipRewardRedPoint=this.fuwentaVipRewardRedPoint||this.fuwentaVipReward[id]==BaoZang.TYPE_GET.open;this.fuwentaPhaseRedPoint[conf[id].group]=this.fuwentaPhaseRedPoint[conf[id].group]||this.fuwentaVip[conf[id].group]==BaoZang.TYPE_GET.open||this.fuwentaReward[id]==BaoZang.TYPE_GET.open||this.fuwentaVipReward[id]==BaoZang.TYPE_GET.open}len=bytes.readInt();for(i=0;i<len;i++){id=bytes.readInt();this.fuwentaFuliReward[id]=bytes.readInt();this.fuwentaFuliVipReward[id]=bytes.readInt();this.fuwentaFuliRewardRedPoint=this.fuwentaFuliRewardRedPoint||this.fuwentaFuliReward[id]==BaoZang.TYPE_GET.open;this.fuwentaFuliVipRewardRedPoint=this.fuwentaFuliVipRewardRedPoint||this.fuwentaFuliVipReward[id]==BaoZang.TYPE_GET.open}this.fuwentaVipBuyCount=bytes.readInt();this.fuwentaCount=bytes.readInt();this.fuwentaVipHasBuy=bytes.readByte();this.fuwentaFirstRedPoint=this.fuwentaFirstRedPoint&&this.fuwentaVipHasBuy==BaoZang.TYPE_BUY.noBuy};BaoZang.prototype.postNanguanData=function(bytes){};BaoZang.prototype.sendGetReward=function(bz_type,reward_type,id){var bytes=this.getBytes(2);bytes.writeInt(bz_type);bytes.writeInt(reward_type);bytes.writeInt(id);this.sendToServer(bytes)};BaoZang.prototype.sendBuyBaoZang=function(type,group){Recharge.ins().showReCharge(GlobalConfig.BaoZangBaseConfig.products[type-1],group)};BaoZang.prototype.chapterCanGet=function(){if(!this.baoZangIsOpen(BaoZang.TYPE_BZ.chapter))return false;return this.chapterRewardRedPoint||this.chapterVipRewardRedPoint||this.chapterFuliRewardRedPoint||this.chapterFuliVipRewardRedPoint||this.chapterFirstRedPoint||this.chapterVipRedPoint};BaoZang.prototype.fuwentaCanGet=function(){if(!this.baoZangIsOpen(BaoZang.TYPE_BZ.fuwenta))return false;return this.fuwentaRewardRedPoint||this.fuwentaVipRewardRedPoint||this.fuwentaFuliRewardRedPoint||this.fuwentaFuliVipRewardRedPoint||this.fuwentaFirstRedPoint||this.fuwentaVipRedPoint};BaoZang.prototype.nanguanCanGet=function(){if(!this.baoZangIsOpen(BaoZang.TYPE_BZ.nanguan))return false;return this.nanguanRewardRedPoint||this.nanguanVipRewardRedPoint||this.nanguanFuliRewardRedPoint||this.nanguanFuliVipRewardRedPoint||this.nanguanFirstRedPoint||this.nanguanVipRedPoint};BaoZang.prototype.baoZangIsOpen=function(type_bz){var info;switch(type_bz){case BaoZang.TYPE_BZ.chapter:info=GlobalConfig.OpenSystemConfig[89];break;case BaoZang.TYPE_BZ.fuwenta:info=GlobalConfig.OpenSystemConfig[90];break}return info!=undefined&&!ChannelMgr.ins().isRechargeHidden()&&(Actor.level||0)>=(info.openlevel||0)&&(UserFb.ins().guanqiaID||0)>=(info.opencheck||0)&&(Actor.zhuanShengLv||0)>=(info.openzs||0)};BaoZang.TYPE_BUY={noBuy:0,buy:1};BaoZang.TYPE_GET={close:0,open:1,done:2};BaoZang.TYPE_BZ={chapter:1,fuwenta:2,nanguan:3};BaoZang.TYPE_REWARD={private:1,world:2,recharge:3};return BaoZang}(BaseSystem);__reflect(BaoZang.prototype,"BaoZang");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.baoZang=BaoZang.ins.bind(BaoZang)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var BaoZangBuyWin=function(_super){__extends(BaoZangBuyWin,_super);function BaoZangBuyWin(){var _this=_super.call(this)||this;_this.skinName="BaoZangBuyWinSkin";_this.reward0.itemRenderer=ItemBaseNoName;_this.reward1.itemRenderer=ItemBaseNoName;return _this}BaoZangBuyWin.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this.type=params[0];this.phase=params[1];switch(this.type){case BaoZang.TYPE_BZ.chapter:this.setChapter();break;case BaoZang.TYPE_BZ.fuwenta:this.setFuwenta();break;case BaoZang.TYPE_BZ.nanguan:this.setNanguan();break}this.addTouchEvent(this.btnClose,this.onTap);this.addTouchEvent(this.btnBuy,this.onTap)};BaoZangBuyWin.prototype.closeWin=function(){ViewManager.ins().close(this)};BaoZangBuyWin.prototype.close=function(){this.removeTouchEvent(this.btnClose,this.onTap);this.removeTouchEvent(this.btnBuy,this.onTap)};BaoZangBuyWin.prototype.onTap=function(e){switch(e.currentTarget){case this.btnClose:this.closeWin();break;case this.btnBuy:BaoZang.ins().sendBuyBaoZang(this.type,this.phase);this.closeWin();break}};BaoZangBuyWin.prototype.setChapter=function(){this.title.text=i18n("BaoZangBuyWin_1",this.phase);var sum=0;var n=0;var cfg=GlobalConfig.BaoZangChapterConfig;var baseCfg=GlobalConfig.BaoZangBaseConfig;for(var k in cfg){if(cfg[k]&&cfg[k].id&&cfg[k].group==this.phase){sum++;if(BaoZang.ins().chapterReward[cfg[k].id]!=BaoZang.TYPE_GET.close){n++}}}var str=JSON.stringify(baseCfg.advanced_reward);var r0=JSON.parse(str);var r1=JSON.parse(str);for(var i=0;i<baseCfg.advanced_reward.length;i++){r0[i].count=r0[i].count*sum;r1[i].count=r1[i].count*n}if(sum==0)r0.splice(0,baseCfg.advanced_reward.length);if(n==0)r1.splice(0,baseCfg.advanced_reward.length);this.reward0.dataProvider=new eui.ArrayCollection(r0.concat(baseCfg.initial_reward));this.reward1.dataProvider=new eui.ArrayCollection(r1.concat(baseCfg.initial_reward));this.btnBuy.label=i18n("BaoZangBuyWin_0",baseCfg.group_price);if(ChannelMgr.ins().isAnQiGeChannel()){var productId=GlobalConfig.BaoZangBaseConfig.products[this.type-1];this.btnBuy.label=i18n("BaoZangBuyWin_4",GlobalConfig.RechargeItemsConfig[productId].channel_20121_NT)}};BaoZangBuyWin.prototype.setFuwenta=function(){this.title.text=i18n("BaoZangBuyWin_2",this.phase);var sum=0;var n=0;var cfg=GlobalConfig.BaoZangFuwentaConfig;var baseCfg=GlobalConfig.BaoZangBaseConfig;for(var k in cfg){if(cfg[k]&&cfg[k].id&&cfg[k].group==this.phase){sum++;if(BaoZang.ins().fuwentaReward[cfg[k].id]!=BaoZang.TYPE_GET.close){n++}}}var str=JSON.stringify(baseCfg.advanced_reward);var r0=JSON.parse(str);var r1=JSON.parse(str);for(var i=0;i<baseCfg.advanced_reward.length;i++){r0[i].count=r0[i].count*sum;r1[i].count=r1[i].count*n}if(sum==0)r0.splice(0,baseCfg.advanced_reward.length);if(n==0)r1.splice(0,baseCfg.advanced_reward.length);this.reward0.dataProvider=new eui.ArrayCollection(r0.concat(baseCfg.initial_reward));this.reward1.dataProvider=new eui.ArrayCollection(r1.concat(baseCfg.initial_reward));this.btnBuy.label=i18n("BaoZangBuyWin_0",baseCfg.group_price);if(ChannelMgr.ins().isAnQiGeChannel()){var productId=GlobalConfig.BaoZangBaseConfig.products[this.type-1];this.btnBuy.label=i18n("BaoZangBuyWin_4",GlobalConfig.RechargeItemsConfig[productId].channel_20121_NT)}};BaoZangBuyWin.prototype.setNanguan=function(){};return BaoZangBuyWin}(BaseEuiView);__reflect(BaoZangBuyWin.prototype,"BaoZangBuyWin");ViewManager.ins().reg(BaoZangBuyWin,LayerManager.UI_Popup);var BaoZangChapterPanel=function(_super){__extends(BaoZangChapterPanel,_super);function BaoZangChapterPanel(){var _this=_super.call(this)||this;_this.groupId=1;_this.btnData=[];_this.skinName="BaoZangPanelSkin";_this.skin.currentState="chapter";_this.list.itemRenderer=BaoZangTaskItem;_this.dataProvider=new eui.ArrayCollection;_this.list.dataProvider=_this.dataProvider;_this.btnList.itemRenderer=BaoZangPhaseBtn;return _this}BaoZangChapterPanel.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this.observe(BaoZang.ins().postChapterData,this.updateView);this.addTouchEvent(this.btnList,this.onTap);this.addTouchEvent(this.bzVip,this.onTap);this.addTouchEvent(this.btnFuli,this.onTap);this.addTouchEvent(this.btnBuy,this.onTap);this.addTouchEvent(this.btnGetItem,this.onTap);this.addTouchEvent(this.rect,this.onTap);BaoZang.curPanel=BaoZang.TYPE_BZ.chapter;BaoZangChapterPanel.pages=[];this.groupId=this.getOpenPage();if(BaoZang.ins().chapterFirstRedPoint){BaoZang.ins().chapterFirstRedPoint=false;BaoZang.ins().postChapterData()}else{this.updateView()}};BaoZangChapterPanel.prototype.close=function(){BaoZang.curPanel=undefined;this.removeObserve();this.removeTouchEvent(this.btnList,this.onTap);this.removeTouchEvent(this.bzVip,this.onTap);this.removeTouchEvent(this.btnFuli,this.onTap);this.removeTouchEvent(this.btnBuy,this.onTap);this.removeTouchEvent(this.btnGetItem,this.onTap);this.removeTouchEvent(this.rect,this.onTap)};BaoZangChapterPanel.prototype.updateView=function(){this.num1.text=(GlobalConfig.BaoZangBaseConfig.return_multiples||0)*100+"%";this.bitNum2=BitmapNumber.ins().createNumPic(GlobalConfig.BaoZangBaseConfig.return_amount||0,"j0",10);this.numGroup2.removeChildren();this.numGroup2.addChild(this.bitNum2);this.numGroup2.width=this.bitNum2.width;this.numGroup2.height=this.bitNum2.height;this.count.text=""+(BaoZang.ins().chapterVipBuyCount||0);this.redPoint.visible=BaoZang.ins().chapterFuliRewardRedPoint||BaoZang.ins().chapterFuliVipRewardRedPoint;this.item.data=GlobalConfig.BaoZangBaseConfig.initial_reward[0];this.curGq.text=i18n("BaoZangPanel_1",BaoZang.ins().chapterCount);this.tool.visible=false;this.rect.visible=false;this.selectGroup(this.groupId)};BaoZangChapterPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.btnList:this.selectGroup(this.btnData[this.btnList.selectedIndex]);break;case this.btnFuli:ViewManager.ins().open(BaoZangFuliWin,BaoZang.TYPE_BZ.chapter);break;case this.bzVip:;case this.btnBuy:ViewManager.ins().open(BaoZangBuyWin,BaoZang.TYPE_BZ.chapter,this.groupId);break;case this.btnGetItem:if(BaoZang.ins().chapterVip[this.groupId]!=BaoZang.TYPE_GET.open){this.item.onClick()}else{this.getRewardAfterMC()}break;case this.rect:this.getReward();break}};BaoZangChapterPanel.prototype.setGroupBtn=function(group){var cfg=GlobalConfig.BaoZangChapterConfig;var min=1;var max=0;var id=1;while(id in cfg){if(id!=1&&BaoZang.ins().chapterReward[id-1]==BaoZang.TYPE_GET.close)break;max++;id+=GlobalConfig.BaoZangBaseConfig.group_times}var row=3;var column=3;var arr=[];var left=1;var right=0;var reset=true;var oldSelectID=this.btnData.indexOf(group);if(oldSelectID==0){if(group==min){left=min}else{left=group-row}}else if(oldSelectID==row*column-1){if(group==max){if(group-row>min)left=group-row*column+1;else left=min}else{left=group-row*(column-1)+1}}else if(oldSelectID<0){left=group-group%row+1;if(left==min){left=min}else if(left+row<=max||left-row*(column-1)<min){left=left-row}else{left=left-row*(column-1)}}else{reset=false}if(reset){right=left+row*column-1;for(var i=left;i>=min&&i<=right&&i<=max;i++){arr.push(i)}}else{arr=this.btnData}this.btnData=arr;this.btnList.dataProvider=new eui.ArrayCollection(this.btnData);this.btnList.selectedIndex=this.btnData.indexOf(group)};BaoZangChapterPanel.prototype.selectGroup=function(group){if(BaoZangChapterPanel.pages.indexOf(group)<0)BaoZangChapterPanel.pages.push(group);this.groupId=group;var hasBuy=BaoZang.ins().chapterVip[this.groupId]!=BaoZang.TYPE_GET.close;this.btnBuy.touchEnabled=!hasBuy;this.btnBuy.label=hasBuy?i18n("BaoZangPanel_3"):i18n("BaoZangPanel_0",GlobalConfig.BaoZangBaseConfig.group_price);if(ChannelMgr.ins().isAnQiGeChannel()){var productId=GlobalConfig.BaoZangBaseConfig.products[BaoZang.TYPE_BZ.chapter-1];this.btnBuy.label=hasBuy?i18n("BaoZangPanel_3"):i18n("BaoZangPanel_4",GlobalConfig.RechargeItemsConfig[productId].channel_20121_NT)}this.bzVip.touchEnabled=!hasBuy;this.reward.visible=true;this.lock.visible=true;this.btnGetItem.visible=true;this.redPoint2.visible=true;switch(BaoZang.ins().chapterVip[this.groupId]){case BaoZang.TYPE_GET.close:this.redPoint2.visible=false;break;case BaoZang.TYPE_GET.open:this.lock.visible=false;break;case BaoZang.TYPE_GET.done:this.reward.visible=false;break}this.dataProvider.replaceAll(this.getConfigByGroup(group));this.setGroupBtn(group)};BaoZangChapterPanel.prototype.getConfigByGroup=function(group){var cfg;var record;var vipRecord;cfg=GlobalConfig.BaoZangChapterConfig;record=BaoZang.ins().chapterReward;vipRecord=BaoZang.ins().chapterVipReward;var r0=[];var r1=[];var r2=[];var r3=[];for(var k in cfg){if(cfg[k]&&cfg[k].id&&cfg[k].group==group){if(record[cfg[k].id]==BaoZang.TYPE_GET.close&&vipRecord[cfg[k].id]==BaoZang.TYPE_GET.close){r0.push(cfg[k])}else if(record[cfg[k].id]==BaoZang.TYPE_GET.open||vipRecord[cfg[k].id]==BaoZang.TYPE_GET.open){r1.push(cfg[k])}else if(record[cfg[k].id]==BaoZang.TYPE_GET.done&&vipRecord[cfg[k].id]==BaoZang.TYPE_GET.done){r2.push(cfg[k])}else if(record[cfg[k].id]==BaoZang.TYPE_GET.done&&vipRecord[cfg[k].id]==BaoZang.TYPE_GET.close){r3.push(cfg[k])}}}return r1.concat(r3,r0,r2)};BaoZangChapterPanel.prototype.getRewardAfterMC=function(){var _this=this;if(BaoZang.ins().chapterVip[this.groupId]!=BaoZang.TYPE_GET.open)return;var r0=-20;var r1=30;var t=200;this.rect.visible=true;this.tool.visible=true;this.tool.rotation=r1;egret.Tween.get(this.tool).to({rotation:r0},t,egret.Ease.circIn).to({rotation:r1},t,egret.Ease.circOut).to({rotation:r0},t,egret.Ease.circIn).to({rotation:r1},t,egret.Ease.circOut).call(function(){_this.getReward()})};BaoZangChapterPanel.prototype.getReward=function(){this.rect.visible=false;this.tool.visible=false;egret.Tween.removeTweens(this.tool);BaoZang.ins().sendGetReward(BaoZang.TYPE_BZ.chapter,BaoZang.TYPE_REWARD.recharge,this.groupId)};BaoZangChapterPanel.prototype.getOpenPage=function(){var cfg=GlobalConfig.BaoZangChapterConfig;var id=1;var p=0;while(id in cfg){if(id!=1&&BaoZang.ins().chapterReward[id-1]==BaoZang.TYPE_GET.close)break;p++;if(BaoZang.ins().chapterPhaseRedPoint[p])break;id+=GlobalConfig.BaoZangBaseConfig.group_times}return p};BaoZangChapterPanel.pages=[];return BaoZangChapterPanel}(BaseEuiView);__reflect(BaoZangChapterPanel.prototype,"BaoZangChapterPanel");ViewManager.ins().reg(BaoZangChapterPanel,LayerManager.UI_Popup);var BaoZangFuliTaskItem=function(_super){__extends(BaoZangFuliTaskItem,_super);function BaoZangFuliTaskItem(){var _this=_super.call(this)||this;_this.skinName="BaoZangFuliTaskSkin";return _this}BaoZangFuliTaskItem.prototype.dataChanged=function(){switch(BaoZangFuliWin.type){case BaoZang.TYPE_BZ.chapter:this.setChapter();break;case BaoZang.TYPE_BZ.fuwenta:this.setFuwenta();break;case BaoZang.TYPE_BZ.nanguan:this.setNanguan();break}this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.btnContinue.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.btnContinue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};BaoZangFuliTaskItem.prototype.setChapter=function(){var d=this.data;this.count.text=i18n("BaoZangFuliTaskItem_0",d.purchaseTimes);this.reward.data=d.reward[0];this.vipReward.data=d.vipReward[0];this.redPoint.visible=false;this.btnGet.visible=false;this.btnContinue.visible=false;this.gotNormal.visible=BaoZang.ins().chapterFuliReward[d.id]==BaoZang.TYPE_GET.done;this.gotVip.visible=BaoZang.ins().chapterFuliVipReward[d.id]==BaoZang.TYPE_GET.done;this.lock.visible=BaoZang.ins().chapterVipHasBuy==BaoZang.TYPE_BUY.noBuy;if(BaoZang.ins().chapterFuliReward[d.id]==BaoZang.TYPE_GET.open||BaoZang.ins().chapterFuliVipReward[d.id]==BaoZang.TYPE_GET.open){this.btnGet.visible=true;this.btnGet.enabled=true;this.redPoint.visible=true;this.btnGet.label=i18n("BaoZangFuliTaskItem_1")}else if(BaoZang.ins().chapterFuliReward[d.id]==BaoZang.TYPE_GET.done&&BaoZang.ins().chapterFuliVipReward[d.id]==BaoZang.TYPE_GET.done){this.btnGet.visible=true;this.btnGet.enabled=false;this.btnGet.label=i18n("BaoZangFuliTaskItem_2")}else if(BaoZang.ins().chapterFuliReward[d.id]==BaoZang.TYPE_GET.close&&BaoZang.ins().chapterFuliVipReward[d.id]==BaoZang.TYPE_GET.close){this.btnGet.visible=true;this.btnGet.enabled=false;this.btnGet.label=i18n("BaoZangFuliTaskItem_3")}else if(BaoZang.ins().chapterFuliReward[d.id]==BaoZang.TYPE_GET.done&&BaoZang.ins().chapterFuliVipReward[d.id]==BaoZang.TYPE_GET.close){this.btnContinue.visible=true;this.btnContinue.enabled=true;this.btnContinue.label=i18n("BaoZangFuliTaskItem_5")}};BaoZangFuliTaskItem.prototype.setFuwenta=function(){var d=this.data;this.count.text=i18n("BaoZangFuliTaskItem_0",d.purchaseTimes);this.reward.data=d.reward[0];this.vipReward.data=d.vipReward[0];this.redPoint.visible=false;this.btnGet.visible=false;this.btnContinue.visible=false;this.gotNormal.visible=BaoZang.ins().fuwentaFuliReward[d.id]==BaoZang.TYPE_GET.done;this.gotVip.visible=BaoZang.ins().fuwentaFuliVipReward[d.id]==BaoZang.TYPE_GET.done;this.lock.visible=BaoZang.ins().fuwentaVipHasBuy==BaoZang.TYPE_BUY.noBuy;if(BaoZang.ins().fuwentaFuliReward[d.id]==BaoZang.TYPE_GET.open||BaoZang.ins().fuwentaFuliVipReward[d.id]==BaoZang.TYPE_GET.open){this.btnGet.visible=true;this.btnGet.enabled=true;this.redPoint.visible=true;this.btnGet.label=i18n("BaoZangFuliTaskItem_1")}else if(BaoZang.ins().fuwentaFuliReward[d.id]==BaoZang.TYPE_GET.done&&BaoZang.ins().fuwentaFuliVipReward[d.id]==BaoZang.TYPE_GET.done){this.btnGet.visible=true;this.btnGet.enabled=false;this.btnGet.label=i18n("BaoZangFuliTaskItem_2")}else if(BaoZang.ins().fuwentaFuliReward[d.id]==BaoZang.TYPE_GET.close&&BaoZang.ins().fuwentaFuliVipReward[d.id]==BaoZang.TYPE_GET.close){this.btnGet.visible=true;this.btnGet.enabled=false;this.btnGet.label=i18n("BaoZangFuliTaskItem_3")}else if(BaoZang.ins().fuwentaFuliReward[d.id]==BaoZang.TYPE_GET.done&&BaoZang.ins().fuwentaFuliVipReward[d.id]==BaoZang.TYPE_GET.close){this.btnContinue.visible=true;this.btnContinue.enabled=true;this.btnContinue.label=i18n("BaoZangFuliTaskItem_5")}};BaoZangFuliTaskItem.prototype.setNanguan=function(){};BaoZangFuliTaskItem.prototype.onTap=function(e){var d=this.data;switch(e.currentTarget){case this.btnGet:BaoZang.ins().sendGetReward(BaoZangFuliWin.type,BaoZang.TYPE_REWARD.world,d.id);break;case this.btnContinue:WarnWin.show(i18n("BaoZangFuliTaskItem_4"),this.openBuyWin,this,null,null,"noraml");break}};BaoZangFuliTaskItem.prototype.openBuyWin=function(){ViewManager.ins().open(BaoZangBuyWin,BaoZangFuliWin.type,1)};return BaoZangFuliTaskItem}(BaseItemRender);__reflect(BaoZangFuliTaskItem.prototype,"BaoZangFuliTaskItem");var BaoZangFuliWin=function(_super){__extends(BaoZangFuliWin,_super);function BaoZangFuliWin(){var _this=_super.call(this)||this;_this.skinName="BaoZangFuliWinSkin";_this.list.itemRenderer=BaoZangFuliTaskItem;return _this}BaoZangFuliWin.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}BaoZangFuliWin.type=params[0];switch(BaoZangFuliWin.type){case BaoZang.TYPE_BZ.chapter:this.observe(BaoZang.ins().postChapterData,this.setChapter);this.setChapter();break;case BaoZang.TYPE_BZ.fuwenta:this.observe(BaoZang.ins().postFuwentaData,this.setFuwenta);this.setFuwenta();break;case BaoZang.TYPE_BZ.nanguan:this.observe(BaoZang.ins().postNanguanData,this.setNanguan);this.setNanguan();break}this.addTouchEvent(this.btnClose,this.onTap)};BaoZangFuliWin.prototype.close=function(){this.removeTouchEvent(this.btnClose,this.onTap);this.removeObserve()};BaoZangFuliWin.prototype.closeWin=function(){ViewManager.ins().close(this)};BaoZangFuliWin.prototype.onTap=function(e){switch(e.currentTarget){case this.btnClose:this.closeWin();break}};BaoZangFuliWin.prototype.setChapter=function(){this.title.text=i18n("BaoZangFuliWin_1");CommonUtils.labelIsOverLenght(this.count,BaoZang.ins().chapterVipBuyCount||0);var cfg=GlobalConfig.BaoZangChapterFuliConfig;var arr0=[];var arr1=[];var arr2=[];var arr3=[];for(var k in cfg){if(cfg[k]&&cfg[k].id){if(BaoZang.ins().chapterFuliReward[cfg[k].id]==BaoZang.TYPE_GET.close&&BaoZang.ins().chapterFuliVipReward[cfg[k].id]==BaoZang.TYPE_GET.close){arr0.push(cfg[k])}else if(BaoZang.ins().chapterFuliReward[cfg[k].id]==BaoZang.TYPE_GET.open||BaoZang.ins().chapterFuliVipReward[cfg[k].id]==BaoZang.TYPE_GET.open){arr1.push(cfg[k])}else if(BaoZang.ins().chapterFuliReward[cfg[k].id]==BaoZang.TYPE_GET.done&&BaoZang.ins().chapterFuliVipReward[cfg[k].id]==BaoZang.TYPE_GET.done){arr2.push(cfg[k])}else if(BaoZang.ins().chapterFuliReward[cfg[k].id]==BaoZang.TYPE_GET.done&&BaoZang.ins().chapterFuliVipReward[cfg[k].id]==BaoZang.TYPE_GET.close){arr3.push(cfg[k])}}}this.list.dataProvider=new eui.ArrayCollection(arr1.concat(arr3,arr0,arr2))};BaoZangFuliWin.prototype.setFuwenta=function(){this.title.text=i18n("BaoZangFuliWin_2");CommonUtils.labelIsOverLenght(this.count,BaoZang.ins().fuwentaVipBuyCount||0);var cfg=GlobalConfig.BaoZangFuwentaFuliConfig;var arr0=[];var arr1=[];var arr2=[];var arr3=[];for(var k in cfg){if(cfg[k]&&cfg[k].id){if(BaoZang.ins().fuwentaFuliReward[cfg[k].id]==BaoZang.TYPE_GET.close&&BaoZang.ins().fuwentaFuliVipReward[cfg[k].id]==BaoZang.TYPE_GET.close){arr0.push(cfg[k])}else if(BaoZang.ins().fuwentaFuliReward[cfg[k].id]==BaoZang.TYPE_GET.open||BaoZang.ins().fuwentaFuliVipReward[cfg[k].id]==BaoZang.TYPE_GET.open){arr1.push(cfg[k])}else if(BaoZang.ins().fuwentaFuliReward[cfg[k].id]==BaoZang.TYPE_GET.done&&BaoZang.ins().fuwentaFuliVipReward[cfg[k].id]==BaoZang.TYPE_GET.done){arr2.push(cfg[k])}else if(BaoZang.ins().fuwentaFuliReward[cfg[k].id]==BaoZang.TYPE_GET.done&&BaoZang.ins().fuwentaFuliVipReward[cfg[k].id]==BaoZang.TYPE_GET.close){arr3.push(cfg[k])}}}this.list.dataProvider=new eui.ArrayCollection(arr1.concat(arr3,arr0,arr2))};BaoZangFuliWin.prototype.setNanguan=function(){this.title.text=i18n("BaoZangFuliWin_3")};return BaoZangFuliWin}(BaseEuiView);__reflect(BaoZangFuliWin.prototype,"BaoZangFuliWin");ViewManager.ins().reg(BaoZangFuliWin,LayerManager.UI_Popup);var BaoZangFuwentaPanel=function(_super){__extends(BaoZangFuwentaPanel,_super);function BaoZangFuwentaPanel(){var _this=_super.call(this)||this;_this.groupId=1;_this.btnData=[];_this.skinName="BaoZangPanelSkin";_this.skin.currentState="fuwenta";_this.list.itemRenderer=BaoZangTaskItem;_this.dataProvider=new eui.ArrayCollection;_this.list.dataProvider=_this.dataProvider;_this.btnList.itemRenderer=BaoZangPhaseBtn;return _this}BaoZangFuwentaPanel.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this.observe(BaoZang.ins().postFuwentaData,this.updateView);this.addTouchEvent(this.btnList,this.onTap);this.addTouchEvent(this.bzVip,this.onTap);this.addTouchEvent(this.btnFuli,this.onTap);this.addTouchEvent(this.btnBuy,this.onTap);this.addTouchEvent(this.btnGetItem,this.onTap);this.addTouchEvent(this.rect,this.onTap);BaoZang.curPanel=BaoZang.TYPE_BZ.fuwenta;BaoZangFuwentaPanel.pages=[];this.groupId=this.getOpenPage();if(BaoZang.ins().fuwentaFirstRedPoint){BaoZang.ins().fuwentaFirstRedPoint=false;BaoZang.ins().postFuwentaData()}else{this.updateView()}};BaoZangFuwentaPanel.prototype.close=function(){BaoZang.curPanel=undefined;this.removeObserve();this.removeTouchEvent(this.btnList,this.onTap);this.removeTouchEvent(this.bzVip,this.onTap);this.removeTouchEvent(this.btnFuli,this.onTap);this.removeTouchEvent(this.btnBuy,this.onTap);this.removeTouchEvent(this.btnGetItem,this.onTap);this.removeTouchEvent(this.rect,this.onTap)};BaoZangFuwentaPanel.prototype.updateView=function(){this.num1.text=(GlobalConfig.BaoZangBaseConfig.return_multiples||0)*100+"%";this.bitNum2=BitmapNumber.ins().createNumPic(GlobalConfig.BaoZangBaseConfig.return_amount||0,"j0",10);this.numGroup2.removeChildren();this.numGroup2.addChild(this.bitNum2);this.numGroup2.width=this.bitNum2.width;this.numGroup2.height=this.bitNum2.height;this.count.text=""+(BaoZang.ins().fuwentaVipBuyCount||0);this.redPoint.visible=BaoZang.ins().fuwentaFuliRewardRedPoint||BaoZang.ins().fuwentaFuliVipRewardRedPoint;this.item.data=GlobalConfig.BaoZangBaseConfig.initial_reward[0];var x=Math.ceil(BaoZang.ins().fuwentaCount/10);var y=BaoZang.ins().fuwentaCount%10;y=y==0&&BaoZang.ins().fuwentaCount>0?10:y;this.curGq.text=i18n("BaoZangPanel_2",x,y);this.tool.visible=false;this.rect.visible=false;this.selectGroup(this.groupId)};BaoZangFuwentaPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.btnList:this.selectGroup(this.btnData[this.btnList.selectedIndex]);break;case this.btnFuli:ViewManager.ins().open(BaoZangFuliWin,BaoZang.TYPE_BZ.fuwenta);break;case this.bzVip:;case this.btnBuy:ViewManager.ins().open(BaoZangBuyWin,BaoZang.TYPE_BZ.fuwenta,this.groupId);break;case this.btnGetItem:if(BaoZang.ins().fuwentaVip[this.groupId]!=BaoZang.TYPE_GET.open){this.item.onClick()}else{this.getRewardAfterMC()}break;case this.rect:this.getReward();break}};BaoZangFuwentaPanel.prototype.setGroupBtn=function(group){var cfg=GlobalConfig.BaoZangFuwentaConfig;var min=1;var max=0;var id=1;while(id in cfg){if(id!=1&&BaoZang.ins().fuwentaReward[id-1]==BaoZang.TYPE_GET.close)break;max++;id+=GlobalConfig.BaoZangBaseConfig.group_times}var row=3;var column=3;var arr=[];var left=1;var right=0;var reset=true;var oldSelectID=this.btnData.indexOf(group);if(oldSelectID==0){if(group==min){left=min}else{left=group-row}}else if(oldSelectID==row*column-1){if(group==max){if(group-row>min)left=group-row*column+1;else left=min}else{left=group-row*(column-1)+1}}else if(oldSelectID<0){left=group-group%row+1;if(left==min){left=min}else if(left+row<=max||left-row*(column-1)<min){left=left-row}else{left=left-row*(column-1)}}else{reset=false}if(reset){right=left+row*column-1;for(var i=left;i>=min&&i<=right&&i<=max;i++){arr.push(i)}}else{arr=this.btnData}this.btnData=arr;this.btnList.dataProvider=new eui.ArrayCollection(this.btnData);this.btnList.selectedIndex=this.btnData.indexOf(group)};BaoZangFuwentaPanel.prototype.selectGroup=function(group){if(BaoZangFuwentaPanel.pages.indexOf(group)<0)BaoZangFuwentaPanel.pages.push(group);this.groupId=group;var hasBuy=BaoZang.ins().fuwentaVip[this.groupId]!=BaoZang.TYPE_GET.close;this.btnBuy.touchEnabled=!hasBuy;this.btnBuy.label=hasBuy?i18n("BaoZangPanel_3"):i18n("BaoZangPanel_0",GlobalConfig.BaoZangBaseConfig.group_price);if(ChannelMgr.ins().isAnQiGeChannel()){var productId=GlobalConfig.BaoZangBaseConfig.products[BaoZang.TYPE_BZ.fuwenta-1];this.btnBuy.label=hasBuy?i18n("BaoZangPanel_3"):i18n("BaoZangPanel_4",GlobalConfig.RechargeItemsConfig[productId].channel_20121_NT)}this.bzVip.touchEnabled=!hasBuy;this.reward.visible=true;this.lock.visible=true;this.btnGetItem.visible=true;this.redPoint2.visible=true;switch(BaoZang.ins().fuwentaVip[this.groupId]){case BaoZang.TYPE_GET.close:this.redPoint2.visible=false;break;case BaoZang.TYPE_GET.open:this.lock.visible=false;break;case BaoZang.TYPE_GET.done:this.reward.visible=false;break}this.dataProvider.replaceAll(this.getConfigByGroup(group));this.setGroupBtn(group)};BaoZangFuwentaPanel.prototype.getConfigByGroup=function(group){var cfg;var record;var vipRecord;cfg=GlobalConfig.BaoZangFuwentaConfig;record=BaoZang.ins().fuwentaReward;vipRecord=BaoZang.ins().fuwentaVipReward;var r0=[];var r1=[];var r2=[];var r3=[];for(var k in cfg){if(cfg[k]&&cfg[k].id&&cfg[k].group==group){if(record[cfg[k].id]==BaoZang.TYPE_GET.close&&vipRecord[cfg[k].id]==BaoZang.TYPE_GET.close){r0.push(cfg[k])}else if(record[cfg[k].id]==BaoZang.TYPE_GET.open||vipRecord[cfg[k].id]==BaoZang.TYPE_GET.open){r1.push(cfg[k])}else if(record[cfg[k].id]==BaoZang.TYPE_GET.done&&vipRecord[cfg[k].id]==BaoZang.TYPE_GET.done){r2.push(cfg[k])}else if(record[cfg[k].id]==BaoZang.TYPE_GET.done&&vipRecord[cfg[k].id]==BaoZang.TYPE_GET.close){r3.push(cfg[k])}}}return r1.concat(r3,r0,r2)};BaoZangFuwentaPanel.prototype.getRewardAfterMC=function(){var _this=this;if(BaoZang.ins().fuwentaVip[this.groupId]!=BaoZang.TYPE_GET.open)return;var r0=-20;var r1=30;var t=200;this.rect.visible=true;this.tool.visible=true;this.tool.rotation=r1;egret.Tween.get(this.tool).to({rotation:r0},t,egret.Ease.circIn).to({rotation:r1},t,egret.Ease.circOut).to({rotation:r0},t,egret.Ease.circIn).to({rotation:r1},t,egret.Ease.circOut).call(function(){_this.getReward()})};BaoZangFuwentaPanel.prototype.getReward=function(){this.rect.visible=false;this.tool.visible=false;egret.Tween.removeTweens(this.tool);BaoZang.ins().sendGetReward(BaoZang.TYPE_BZ.fuwenta,BaoZang.TYPE_REWARD.recharge,this.groupId)};BaoZangFuwentaPanel.prototype.getOpenPage=function(){var cfg=GlobalConfig.BaoZangFuwentaConfig;var id=1;var p=0;while(id in cfg){if(id!=1&&BaoZang.ins().fuwentaReward[id-1]==BaoZang.TYPE_GET.close)break;p++;if(BaoZang.ins().fuwentaPhaseRedPoint[p])break;id+=GlobalConfig.BaoZangBaseConfig.group_times}return p};BaoZangFuwentaPanel.pages=[];return BaoZangFuwentaPanel}(BaseEuiView);__reflect(BaoZangFuwentaPanel.prototype,"BaoZangFuwentaPanel");ViewManager.ins().reg(BaoZangFuwentaPanel,LayerManager.UI_Popup);var BaoZangPhaseBtn=function(_super){__extends(BaoZangPhaseBtn,_super);function BaoZangPhaseBtn(){var _this=_super.call(this)||this;_this.skinName="Btn1013Skin";return _this}BaoZangPhaseBtn.prototype.dataChanged=function(){var phase=this.data;if(this.selected){this.skin.currentState="down"}else{this.skin.currentState="up"}this.labelDisplay.text=i18n("BaoZangPhaseBtn_0",phase);this.setRePoint()};BaoZangPhaseBtn.prototype.setRePoint=function(){var phase=this.data;switch(BaoZang.curPanel){case BaoZang.TYPE_BZ.chapter:this.redPoint.visible=BaoZangChapterPanel.pages.indexOf(phase)<0&&BaoZang.ins().chapterPhaseRedPoint[phase];break;case BaoZang.TYPE_BZ.fuwenta:this.redPoint.visible=BaoZangFuwentaPanel.pages.indexOf(phase)<0&&BaoZang.ins().fuwentaPhaseRedPoint[phase];break}};return BaoZangPhaseBtn}(BaseItemRender);__reflect(BaoZangPhaseBtn.prototype,"BaoZangPhaseBtn");var BaoZangTaskItem=function(_super){__extends(BaoZangTaskItem,_super);function BaoZangTaskItem(){var _this=_super.call(this)||this;_this.hasBuy=false;_this.inMc=false;_this.skinName="BaoZangTaskItemSkin";return _this}BaoZangTaskItem.prototype.dataChanged=function(){switch(BaoZang.curPanel){case BaoZang.TYPE_BZ.chapter:this.setChapter();break;case BaoZang.TYPE_BZ.fuwenta:this.setFuwenta();break;case BaoZang.TYPE_BZ.nanguan:break}this.inMc=false;this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.btnContinue.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.btnContinue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.btnGo.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.btnGo.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.lock.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.lock.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};BaoZangTaskItem.prototype.onTap=function(e){var d=this.data;switch(e.currentTarget){case this.btnGet:this.getRewardAfterMC();break;case this.btnContinue:WarnWin.show(i18n("BaoZangTaskItem_3"),this.openBuyWin,this,null,null,"normal");break;case this.btnGo:switch(BaoZang.curPanel){case BaoZang.TYPE_BZ.chapter:GameGuider.challengeBoss();break;case BaoZang.TYPE_BZ.fuwenta:var conf=GlobalConfig.WinOpenConfig[32];ViewManager.ins().open(conf.winClass,conf.subWinId);break;case BaoZang.TYPE_BZ.nanguan:break}ViewManager.ins().close(FuliWin);break;case this.lock:this.item1.onClick();break}};BaoZangTaskItem.prototype.openBuyWin=function(){var d=this.data;ViewManager.ins().open(BaoZangBuyWin,BaoZang.curPanel,d.group)};BaoZangTaskItem.prototype.setChapter=function(){var d=this.data;this.num.text=i18n("BaoZangTaskItem_4",d.chapter);var hasBuy=BaoZang.ins().chapterVip[d.group]!=BaoZang.TYPE_GET.close;this.hasBuy=hasBuy;this.lock.visible=!hasBuy;var hasGet0=BaoZang.ins().chapterReward[d.id]==BaoZang.TYPE_GET.done;this.gotNormal.visible=hasGet0;var hasGet1=BaoZang.ins().chapterVipReward[d.id]==BaoZang.TYPE_GET.done;this.gotVip.visible=hasGet1;this.btnContinue.visible=false;this.btnGo.visible=false;this.btnGet.visible=false;this.redPoint.visible=false;if(BaoZang.ins().chapterReward[d.id]==BaoZang.TYPE_GET.done&&BaoZang.ins().chapterVipReward[d.id]==BaoZang.TYPE_GET.close){this.btnContinue.visible=true;this.btnContinue.label=i18n("BaoZangTaskItem_6")}else if(BaoZang.ins().chapterReward[d.id]==BaoZang.TYPE_GET.open||BaoZang.ins().chapterVipReward[d.id]==BaoZang.TYPE_GET.open){this.btnGet.visible=true;this.btnGet.enabled=true;this.btnGet.label=i18n("BaoZangTaskItem_0");this.redPoint.visible=true}else if(BaoZang.ins().chapterReward[d.id]==BaoZang.TYPE_GET.close&&BaoZang.ins().chapterVipReward[d.id]==BaoZang.TYPE_GET.close&&BaoZang.ins().chapterReward[d.id-1]!=BaoZang.TYPE_GET.close){this.btnGo.visible=true;this.btnGo.label=i18n("BaoZangTaskItem_1")}else if(BaoZang.ins().chapterReward[d.id]==BaoZang.TYPE_GET.done&&BaoZang.ins().chapterVipReward[d.id]==BaoZang.TYPE_GET.done){this.btnGet.visible=true;this.btnGet.enabled=false;this.btnGet.label=i18n("BaoZangTaskItem_2")}this.item0.data=GlobalConfig.BaoZangBaseConfig.regular_reward[0];this.item1.data=GlobalConfig.BaoZangBaseConfig.advanced_reward[0];this.tool.visible=false};BaoZangTaskItem.prototype.setFuwenta=function(){var d=this.data;var x=Math.ceil(d.chapter/10);var y=d.chapter%10==0?10:d.chapter%10;this.num.text=i18n("BaoZangTaskItem_5",x,y);var hasBuy=BaoZang.ins().fuwentaVip[d.group]!=BaoZang.TYPE_GET.close;this.hasBuy=hasBuy;this.lock.visible=!hasBuy;var hasGet0=BaoZang.ins().fuwentaReward[d.id]==BaoZang.TYPE_GET.done;this.gotNormal.visible=hasGet0;var hasGet1=BaoZang.ins().fuwentaVipReward[d.id]==BaoZang.TYPE_GET.done;this.gotVip.visible=hasGet1;this.btnContinue.visible=false;this.btnGo.visible=false;this.btnGet.visible=false;this.redPoint.visible=false;if(BaoZang.ins().fuwentaReward[d.id]==BaoZang.TYPE_GET.done&&BaoZang.ins().fuwentaVipReward[d.id]==BaoZang.TYPE_GET.close){this.btnContinue.visible=true;this.btnContinue.label=i18n("BaoZangTaskItem_6")}else if(BaoZang.ins().fuwentaReward[d.id]==BaoZang.TYPE_GET.open||BaoZang.ins().fuwentaVipReward[d.id]==BaoZang.TYPE_GET.open){this.btnGet.visible=true;this.btnGet.enabled=true;this.btnGet.label=i18n("BaoZangTaskItem_0");this.redPoint.visible=true}else if(BaoZang.ins().fuwentaReward[d.id]==BaoZang.TYPE_GET.close&&BaoZang.ins().fuwentaVipReward[d.id]==BaoZang.TYPE_GET.close&&BaoZang.ins().fuwentaReward[d.id-1]!=BaoZang.TYPE_GET.close){this.btnGo.visible=true;this.btnGo.label=i18n("BaoZangTaskItem_1")}else if(BaoZang.ins().fuwentaReward[d.id]==BaoZang.TYPE_GET.done&&BaoZang.ins().fuwentaVipReward[d.id]==BaoZang.TYPE_GET.done){this.btnGet.visible=true;this.btnGet.enabled=false;this.btnGet.label=i18n("BaoZangTaskItem_2")}this.item0.data=GlobalConfig.BaoZangBaseConfig.regular_reward[0];this.item1.data=GlobalConfig.BaoZangBaseConfig.advanced_reward[0];this.tool.visible=false};BaoZangTaskItem.prototype.getRewardAfterMC=function(){var _this=this;var d=this.data;if(!this.hasBuy||this.inMc){this.getReward();return}this.inMc=true;var r0=-20;var r1=30;var t=200;this.tool.visible=true;this.tool.rotation=r1;egret.Tween.get(this.tool).to({rotation:r0},t,egret.Ease.circIn).to({rotation:r1},t,egret.Ease.circOut).to({rotation:r0},t,egret.Ease.circIn).to({rotation:r1},t,egret.Ease.circOut).call(function(){_this.getReward()})};BaoZangTaskItem.prototype.getReward=function(){this.inMc=false;this.tool.visible=false;egret.Tween.removeTweens(this.tool);var d=this.data;BaoZang.ins().sendGetReward(BaoZang.curPanel,BaoZang.TYPE_REWARD.private,d.id)};return BaoZangTaskItem}(BaseItemRender);__reflect(BaoZangTaskItem.prototype,"BaoZangTaskItem");var BattleCC=function(_super){__extends(BattleCC,_super);function BattleCC(){var _this=_super.call(this)||this;_this._leftTime=0;_this.battleRanks=[];_this.myRank=0;_this.myScore=0;_this.awardID=0;_this._openLeftTime=0;_this._openTimer=0;_this._enterCD=0;_this._enterCDTimer=0;_this._changeTime=0;_this._changeLittle=0;_this.sysId=PackageID.Battle;_this.observe(GameLogic.ins().postEnterMap,_this.mapChange);_this.regNetMsg(1,_this.joinResult);_this.regNetMsg(2,_this.doRank);_this.regNetMsg(3,_this.doOpen);_this.regNetMsg(4,_this.doRelive);_this.regNetMsg(5,_this.getAwardResult);_this.regNetMsg(6,_this.doAwardInfo);_this.regNetMsg(7,_this.doMyScore);_this.regNetMsg(10,_this.doMyRank);_this.regNetMsg(11,_this.doEnterCD);_this.regNetMsg(12,_this.doGameOver);_this.regNetMsg(13,_this.postLittleChange);_this.regNetMsg(14,_this.postChangeTime);_this.regNetMsg(15,_this.postKilled);return _this}BattleCC.prototype.mapChange=function(){if(GameMap.fubenID==GlobalConfig.CampBattleConfig.fbId)this.enterBattle();if(this._isBattle&&GameMap.fubenID!=GlobalConfig.CampBattleConfig.fbId)this.escBattle();if(this.gotoNpc&&GameMap.fbType==UserFb.FB_TYPE_CITY){this.gotoNpc=false;GameMap.myMoveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE,this.findComplete);GameMap.moveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE)}};BattleCC.prototype.findComplete=function(){ViewManager.ins().open(BattleNpcTipWin)};BattleCC.ins=function(){return _super.ins.call(this)};BattleCC.prototype.isBattle=function(){return this._isBattle};BattleCC.prototype.joinBattle=function(){this.sendBaseProto(1)};BattleCC.prototype.joinResult=function(bytes){this.camp=bytes.readShort();this._leftTime=DateUtils.formatMiniDateTime(bytes.readInt());this.postEnterSuccess()};BattleCC.prototype.postEnterSuccess=function(){};BattleCC.prototype.doRank=function(bytes){var len=bytes.readInt();this.battleRanks.length=len;var vo;for(var i=0;i<len;i++){vo=this.battleRanks[i];if(!vo){vo=new BattleRankVo;this.battleRanks[i]=vo}vo.parse(bytes)}this.postRankInfo()};BattleCC.prototype.doOpen=function(bytes){this.isOpen=bytes.readBoolean();this._openLeftTime=bytes.readInt();this._openTimer=egret.getTimer();this.postOpenInfo()};BattleCC.prototype.doRelive=function(bytes){UserBoss.ins().reliveTime=bytes.readInt();UserBoss.ins().killerHandler=bytes.readDouble();ViewManager.ins().close(TargetPlayerBigBloodPanel);if(UserBoss.ins().reliveTime>0){UserBoss.ins().clearWorldBossList();ViewManager.ins().open(WorldBossBeKillWin)}else ViewManager.ins().close(WorldBossBeKillWin)};BattleCC.prototype.postOpenInfo=function(){};BattleCC.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3};BattleCC.prototype.getRankTop=function(len){if(len===void 0){len=3}if(this.battleRanks)return this.battleRanks.slice(0,len);return null};BattleCC.prototype.postRankInfo=function(){};BattleCC.prototype.getLeftTime=function(){return Math.floor((this._leftTime-GameServer.serverTime)/1e3)};BattleCC.prototype.enterBattle=function(){this._isBattle=true;if(!ViewManager.ins().isShow(BattleWin))ViewManager.ins().open(BattleWin);ViewManager.ins().close(BattleNpcTipWin)};BattleCC.prototype.escBattle=function(){this._isBattle=false;ViewManager.ins().close(BattleWin);var roleList=EntityManager.ins().getEntitysBymasterhHandle(Actor.handle,EntityType.Role);if(roleList&&roleList.length>0){var len=roleList.length;var role=void 0;for(var i=0;i<len;i++){role=roleList[i];if(role&&role.infoModel){role.setCharName(role.infoModel.guildAndName)}}}};BattleCC.prototype.sendReLive=function(){this.sendBaseProto(4)};BattleCC.prototype.getMyAward=function(){this.sendBaseProto(5)};BattleCC.prototype.getAwardResult=function(bytes){if(bytes.readBoolean()){}};BattleCC.prototype.doAwardInfo=function(bytes){this.awardID=bytes.readInt();this.postGiftInfo()};BattleCC.prototype.postGiftInfo=function(){};BattleCC.prototype.doMyScore=function(bytes){this.myScore=bytes.readInt();var change=bytes.readInt();var roleName=bytes.readString();var str;var tip=bytes.readUnsignedByte();switch(tip){case 1:str=i18n("BattleCC_0",roleName,change);break;case 2:str=i18n("BattleCC_1",roleName,change);break;case 3:str=i18n("BattleCC_2",roleName,change);break;case 4:str=i18n("BattleCC_3",change);break;case 5:str=i18n("BattleCC_4",change);break}if(str){UserTips.ins().showCenterTips3(str)}this.postScoreChange()};BattleCC.prototype.doMyRank=function(bytes){this.myRank=bytes.readInt();this.myScore=bytes.readInt();this.postScoreChange()};BattleCC.prototype.postScoreChange=function(){};BattleCC.prototype.doEnterCD=function(bytes){this._enterCD=bytes.readInt();this._enterCDTimer=egret.getTimer()};BattleCC.prototype.doGameOver=function(bytes){ViewManager.ins().open(BattleResultWin)};BattleCC.prototype.postLittleChange=function(bytes){this._changeLittle=DateUtils.formatMiniDateTime(bytes.readInt())};BattleCC.prototype.getChangeLittleTime=function(){return Math.floor((this._changeLittle-GameServer.serverTime)/1e3)};BattleCC.prototype.canMove=function(){return this.getChangeLittleTime()<=0};BattleCC.prototype.postChangeTime=function(bytes){this._changeTime=DateUtils.formatMiniDateTime(bytes.readInt())};BattleCC.prototype.postKilled=function(bytes){return bytes.readShort()};BattleCC.prototype.getChangeTime=function(){return Math.floor((this._changeTime-GameServer.serverTime)/1e3)};BattleCC.prototype.getEnterCD=function(){return Math.ceil(this._enterCD-(egret.getTimer()-this._enterCDTimer)/1e3)};BattleCC.prototype.checkRedPoint=function(){return this.isOpen&&Actor.level>=GlobalConfig.CampBattleConfig.openLevel};BattleCC.prototype.checkOpen=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.BATTLE))return false;if(BattleCC.ins().isOpen){return true}else{var leftTime=BattleCC.ins().getOpenLeftTime();if(leftTime>0){return true}}return false};BattleCC.prototype.toBattleCC=function(){if(Actor.level<=GlobalConfig.CampBattleConfig.openLevel){UserTips.ins().showTips(GlobalConfig.CampBattleConfig.openLevel+i18n("PlayWayPanel_10"));return}if(!BattleCC.ins().isOpen){UserTips.ins().showTips(GlobalConfig.CampBattleConfig.openTips);return}if(CityCC.ins().enterCD<1){if(CityCC.ins().isCity){GameMap.myMoveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE,BattleCC.ins().findComplete);GameMap.moveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE)}else{BattleCC.ins().gotoNpc=true;CityCC.ins().sendEnter()}}else UserTips.ins().showTips(i18n("PlayWayPanel_11",CityCC.ins().enterCD))};return BattleCC}(BaseSystem);__reflect(BattleCC.prototype,"BattleCC");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.battlecc=BattleCC.ins.bind(BattleCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var BattleAwardTargetItemRender=function(_super){__extends(BattleAwardTargetItemRender,_super);function BattleAwardTargetItemRender(){var _this=_super.call(this)||this;_this.skinName="BattleTargetItemSkin";return _this}BattleAwardTargetItemRender.prototype.dataChanged=function(){var cfg=this.data[0];this.rank.text=cfg.integral+i18n("BattleAwardTargetItemRender_0");this.award.data=cfg.award[0];this.already.visible=this.data[1]};return BattleAwardTargetItemRender}(BaseItemRender);__reflect(BattleAwardTargetItemRender.prototype,"BattleAwardTargetItemRender");var BattleNpcTipWin=function(_super){__extends(BattleNpcTipWin,_super);function BattleNpcTipWin(){var _this=_super.call(this)||this;_this.skinName="BattleTipsSkin";return _this}BattleNpcTipWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onGoto);this.update()};BattleNpcTipWin.prototype.close=function(){this.removeTouchEvent(this.goTo,this.onGoto)};BattleNpcTipWin.prototype.update=function(){this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.CampBattleConfig.desc);this.rule.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HelpInfoConfig[17].text);this.redPoint.visible=BattleCC.ins().isOpen};BattleNpcTipWin.prototype.onGoto=function(e){if(e.target==this.goTo){if(Actor.level<GlobalConfig.CampBattleConfig.openLevel){UserTips.ins().showTips(GlobalConfig.CampBattleConfig.openLevel+i18n("BattleNpcTipWin_0"));return}if(!BattleCC.ins().isOpen){UserTips.ins().showTips(GlobalConfig.CampBattleConfig.openTips);return}var cd=BattleCC.ins().getEnterCD();if(cd>0){UserTips.ins().showTips(cd+i18n("BattleNpcTipWin_1"));return}BattleCC.ins().joinBattle()}else if(e.target==this.bgClose){ViewManager.ins().close(this)}else if(e.target==this.closeBtn){ViewManager.ins().close(this)}};return BattleNpcTipWin}(BaseEuiView);__reflect(BattleNpcTipWin.prototype,"BattleNpcTipWin");ViewManager.ins().reg(BattleNpcTipWin,LayerManager.UI_Main);var BattleRankItemRender=function(_super){__extends(BattleRankItemRender,_super);function BattleRankItemRender(){var _this=_super.call(this)||this;_this.skinName="BattleScoreRankItem";return _this}BattleRankItemRender.prototype.dataChanged=function(){var vo=this.data;var isTop=vo.rank<=3;this.rankImg.source=isTop?"paihang"+vo.rank:null;this.rank.text=isTop?"":vo.rank+"";this.nameLabel.text=vo.roleName;this.nameGuild.text=vo.unionName;this.score.text=vo.score+""};return BattleRankItemRender}(BaseItemRender);__reflect(BattleRankItemRender.prototype,"BattleRankItemRender");var BattleRankWin=function(_super){__extends(BattleRankWin,_super);function BattleRankWin(){var _this=_super.call(this)||this;_this._selectedIndex=0;_this.skinName="BattleScoreSkin";_this.isTopLevel=true;return _this}BattleRankWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this._panels=[this.runePanel0,this.decomPanel0];this._panels[this._selectedIndex].open();this.viewStack.selectedIndex=this._selectedIndex};BattleRankWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);this.addChangeEvent(this.tab,this.onTabTouch)};BattleRankWin.prototype.close=function(){this.removeTouchEvent(this,this.onTap);this.removeEventListener(egret.TouchEvent.CHANGE,this.onTabTouch,this.tab)};BattleRankWin.prototype.onTabTouch=function(e){this._panels[this._selectedIndex].close();this._selectedIndex=e.currentTarget.selectedIndex;this._panels[this._selectedIndex].open();this.viewStack._selectedIndex=this._selectedIndex};BattleRankWin.prototype.onTap=function(e){if(e.target==this.bgClose)ViewManager.ins().close(this);if(e.target==this.closeBtn)ViewManager.ins().close(this)};return BattleRankWin}(BaseEuiView);__reflect(BattleRankWin.prototype,"BattleRankWin");ViewManager.ins().reg(BattleRankWin,LayerManager.UI_Popup);var BattleResultItemRender=function(_super){__extends(BattleResultItemRender,_super);function BattleResultItemRender(){var _this=_super.call(this)||this;_this.skinName="BattleResultItem";return _this}BattleResultItemRender.prototype.dataChanged=function(){var vo=this.data;this.ranking.text=vo.rank+"";this.roleName.text=vo.roleName;this.guild.text=vo.unionName;this.score.text=vo.score+""};return BattleResultItemRender}(BaseItemRender);__reflect(BattleResultItemRender.prototype,"BattleResultItemRender");var BattleResultWin=function(_super){__extends(BattleResultWin,_super);function BattleResultWin(){var _this=_super.call(this)||this;_this._time=5;_this.skinName="BattleResultSkin";return _this}BattleResultWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rankList.itemRenderer=BattleResultItemRender;this.myRewarrd.itemRenderer=ItemBase};BattleResultWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);this.observe(BattleCC.ins().postRankInfo,this.updateRank);this.observe(BattleCC.ins().postScoreChange,this.updateMyScore);this.timerGroup.visible=true;this.info.text=this._time+"";TimerManager.ins().doTimer(1e3,5,this.repeat,this);this.updateMyScore();this.updateRank()};BattleResultWin.prototype.updateRank=function(){this.rankList.dataProvider=new eui.ArrayCollection(BattleCC.ins().getRankTop(5))};BattleResultWin.prototype.updateMyScore=function(){var myRank=BattleCC.ins().myRank;this.myScore.text=BattleCC.ins().myScore+"";this.myRanking.text=myRank+"";var maxLen=Object.keys(GlobalConfig.CampBattlePersonalRankAwardConfig).length;var cfg=GlobalConfig.CampBattlePersonalRankAwardConfig[myRank>0&&myRank<=maxLen?myRank:maxLen];this.myRewarrd.dataProvider=new eui.ArrayCollection(cfg.award)};BattleResultWin.prototype.repeat=function(){this._time--;if(this._time>0)this.info.text=this._time+"";else this.timerGroup.visible=false};BattleResultWin.prototype.close=function(){this.removeTouchEvent(this,this.onTap);this.removeObserve();TimerManager.ins().removeAll(this)};BattleResultWin.prototype.onTap=function(e){switch(e.target){case this.closeBtn:UserFb.ins().sendExitFb();ViewManager.ins().close(this);break}};return BattleResultWin}(BaseEuiView);__reflect(BattleResultWin.prototype,"BattleResultWin");ViewManager.ins().reg(BattleResultWin,LayerManager.UI_Main);var BattleRewardItemRender=function(_super){__extends(BattleRewardItemRender,_super);function BattleRewardItemRender(){var _this=_super.call(this)||this;_this.skinName="BattleRewarrdItemSkin";return _this}BattleRewardItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.awards.itemRenderer=ItemBase;this._arrayCollect=new eui.ArrayCollection;this.awards.dataProvider=this._arrayCollect};BattleRewardItemRender.prototype.dataChanged=function(){var cfg=this.data;this.rank.text=i18n("BattleRewardItemRender_0")+cfg.rank+i18n("BattleRewardItemRender_1");this._arrayCollect.source=cfg.award};return BattleRewardItemRender}(BaseItemRender);__reflect(BattleRewardItemRender.prototype,"BattleRewardItemRender");var BattleRewardPanel=function(_super){__extends(BattleRewardPanel,_super);function BattleRewardPanel(){return _super.call(this)||this}BattleRewardPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list0.itemRenderer=BattleRewardItemRender;var i=0;var datas=[];for(var key in GlobalConfig.CampBattlePersonalRankAwardConfig){datas[i]=GlobalConfig.CampBattlePersonalRankAwardConfig[key];i++}this.list0.dataProvider=new eui.ArrayCollection(datas);this._collect=new eui.ArrayCollection;this.list1.itemRenderer=BattleAwardTargetItemRender;this.list1.dataProvider=this._collect};BattleRewardPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(BattleCC.ins().postGiftInfo,this.update);this.update()};BattleRewardPanel.prototype.close=function(){this.removeObserve()};BattleRewardPanel.prototype.update=function(){var len=Object.keys(GlobalConfig.CampBattlePersonalAwardConfig).length;var datas=[];var awardId=BattleCC.ins().awardID;datas.length=len;for(var i=1;i<=len;i++)datas[i-1]=[GlobalConfig.CampBattlePersonalAwardConfig[i],i<=awardId];this._collect.source=datas};return BattleRewardPanel}(BaseEuiView);__reflect(BattleRewardPanel.prototype,"BattleRewardPanel");var BattleScoreRankPanel=function(_super){__extends(BattleScoreRankPanel,_super);function BattleScoreRankPanel(){return _super.call(this)||this}BattleScoreRankPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=BattleRankItemRender;this._arrayCllect=new eui.ArrayCollection;this.list.dataProvider=this._arrayCllect};BattleScoreRankPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(BattleCC.ins().postRankInfo,this.update);this.observe(BattleCC.ins().postScoreChange,this.updateMyScore);this.update();this.updateMyScore()};BattleScoreRankPanel.prototype.close=function(){this.removeObserve()};BattleScoreRankPanel.prototype.update=function(){this._arrayCllect.source=BattleCC.ins().battleRanks};BattleScoreRankPanel.prototype.updateMyScore=function(){this.myScore.text=BattleCC.ins().myScore+"";this.myRank.text=i18n("BattleScoreRankPanel_0")+BattleCC.ins().myRank};return BattleScoreRankPanel}(BaseEuiView);__reflect(BattleScoreRankPanel.prototype,"BattleScoreRankPanel");var BattleWin=function(_super){__extends(BattleWin,_super);function BattleWin(){var _this=_super.call(this)||this;_this._leftTime=0;_this._changeTime=-1;_this._littleChangeTime=-1;_this.skinName="BattleLittleRankSkin";return _this}BattleWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.jump.textFlow=TextFlowMaker.generateTextFlow1(i18n("BattleWin_0"));this.bigTimeGroup.visible=false;this.assignPer.visible=false};BattleWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);this.observe(BattleCC.ins().postRankInfo,this.updateRank);this.observe(BattleCC.ins().postScoreChange,this.updateMyScore);this.observe(BattleCC.ins().postGiftInfo,this.updateGift);this.observe(BattleCC.ins().postEnterSuccess,this.update);this.observe(BattleCC.ins().postChangeTime,this.update);this.observe(BattleCC.ins().postLittleChange,this.update);this.observe(BattleCC.ins().postKilled,this.onKill);this.updateRank();this.updateGift();this.updateMyScore();this.update()};BattleWin.prototype.update=function(){TimerManager.ins().remove(this.repeat,this);this._leftTime=BattleCC.ins().getLeftTime();var startTimer;if(this._leftTime>0)startTimer=true;else this.wholeLeftTime.text="";this._changeTime=BattleCC.ins().getChangeTime();if(this._changeTime>0)startTimer=true;else this.assignPer.visible=false;this._littleChangeTime=BattleCC.ins().getChangeLittleTime();if(this._littleChangeTime>0)startTimer=true;else this.bigTimeGroup.visible=false;if(startTimer){TimerManager.ins().doTimer(1e3,0,this.repeat,this);this.repeat()}this.skillGroup0.visible=false};BattleWin.prototype.onKill=function(value){egret.Tween.removeTweens(this.lzlabel0);egret.Tween.removeTweens(this.skillGroup0);if(!value){this.skillGroup0.visible=false;return}this.skillGroup0.visible=true;this.skillGroup0.alpha=1;this.lzlabel0.scaleX=this.lzlabel0.scaleY=1;this.lzlabel0.text=value+"";var self=this;egret.Tween.get(this.lzlabel0).to({scaleX:2,scaleY:2},200).to({scaleX:1,scaleY:1},100).call(function(){egret.Tween.get(self.skillGroup0).wait(1e3).to({alpha:0},1e3).call(function(){egret.Tween.removeTweens(self.lzlabel0);egret.Tween.removeTweens(self.skillGroup0);self.skillGroup0.visible=false})})};BattleWin.prototype.repeat=function(){if(this._leftTime<=0){if(this.wholeLeftTime.text!="")this.wholeLeftTime.text=""}else this.wholeLeftTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4);this._leftTime--;if(this._changeTime<=0){if(this.assignPer.visible)this.assignPer.visible=false}else{if(!this.assignPer.visible)this.assignPer.visible=true;this.campLeftTime0.text=DateUtils.getFormatBySecond(this._changeTime,DateUtils.TIME_FORMAT_5,4)}this._changeTime--;if(this._littleChangeTime<=0){if(this.bigTimeGroup.visible)this.bigTimeGroup.visible=false}else{this.countDown.text=Math.floor(this._littleChangeTime)+"";if(!this.bigTimeGroup.visible)this.bigTimeGroup.visible=true}this._littleChangeTime--};BattleWin.prototype.close=function(){this.removeTouchEvent(this,this.onTap);this.removeObserve();TimerManager.ins().removeAll(this);this._giftMax=false;this._canGetGift=false;egret.Tween.removeTweens(this.lzlabel0);egret.Tween.removeTweens(this.skillGroup0)};BattleWin.prototype.updateRank=function(){var ranks=BattleCC.ins().getRankTop();var len=ranks?ranks.length:0;var vo;for(var i=0;i<3;i++){if(i<len)vo=ranks[i];else vo=null;this["name"+i].text=vo?vo.roleName:"";this["num"+i].text=vo?vo.score+"":""}};BattleWin.prototype.updateMyScore=function(){this.num3.text=BattleCC.ins().myScore+"";this.rank3.text=BattleCC.ins().myRank+"";this.updateGift()};BattleWin.prototype.updateGift=function(){if(this._giftMax)return;var awardId=BattleCC.ins().awardID;var len=Object.keys(GlobalConfig.CampBattlePersonalAwardConfig).length;this._canGetGift=false;if(awardId>=len){this._giftMax=true;this.giftGroup.visible=false}else{this.giftGroup.visible=true;var cfg=void 0;cfg=GlobalConfig.CampBattlePersonalAwardConfig[awardId+1];this._canGetGift=BattleCC.ins().myScore>=cfg.integral;this.redPoint.visible=this._canGetGift;this.scoreTxt.text=i18n("BattleWin_1")+BattleCC.ins().myScore;var colorStr=this._canGetGift?65280:16711680;this.scoreTxt2.textFlow=TextFlowMaker.generateTextFlow1(i18n("BattleWin_2",colorStr,BattleCC.ins().myScore,cfg.integral))}};BattleWin.prototype.onTap=function(e){switch(e.target){case this.jump:ViewManager.ins().open(BattleRankWin);break;case this.giftBtn:if(this._canGetGift)BattleCC.ins().getMyAward();break}};return BattleWin}(BaseEuiView);__reflect(BattleWin.prototype,"BattleWin");ViewManager.ins().reg(BattleWin,LayerManager.Main_View);var CommonHelpWin=function(_super){__extends(CommonHelpWin,_super);function CommonHelpWin(){var _this=_super.call(this)||this;_this.skinName="HelpTipsSkin";return _this}CommonHelpWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.textInfo.textFlow=TextFlowMaker.generateTextFlow(param[0]);this.textInfo.height=this.textInfo.textHeight;this.background.height=this.textInfo.textHeight+60;this.anigroup.y=(StageUtils.ins().getHeight()-this.background.height)/2};CommonHelpWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};CommonHelpWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};return CommonHelpWin}(BaseEuiView);__reflect(CommonHelpWin.prototype,"CommonHelpWin");ViewManager.ins().reg(CommonHelpWin,LayerManager.UI_Popup);var BattleRankVo=function(){function BattleRankVo(){}BattleRankVo.prototype.parse=function(bytes){this.rank=bytes.readShort();this.camp=bytes.readShort();this.roleName=bytes.readString();this.unionName=bytes.readString();this.score=bytes.readInt()};return BattleRankVo}();__reflect(BattleRankVo.prototype,"BattleRankVo");var BattleGround=function(_super){__extends(BattleGround,_super);function BattleGround(){var _this=_super.call(this)||this;_this._openLeftTime=0;_this._openTimer=0;_this._enterCD=0;_this._enterCDTimer=0;_this._leftTime=0;_this._areaId=0;_this._shenBingExp=0;_this._jadeChips=0;_this.canClick=true;_this.canPlayList=[];_this.attHandle=0;_this.sysId=PackageID.BattleGround;_this.observe(GameLogic.ins().postEnterMap,_this.mapChange);_this.regNetMsg(1,_this.postEnterSuccess);_this.regNetMsg(2,_this.postBelongChange);_this.regNetMsg(3,_this.doEnterCD);_this.regNetMsg(4,_this.postOpenInfo);_this.regNetMsg(5,_this.doRelive);_this.regNetMsg(6,_this.postMyInfo);_this.regNetMsg(7,_this.postAreaChange);_this.regNetMsg(8,_this.doResult);return _this}Object.defineProperty(BattleGround.prototype,"areaId",{get:function(){return this._areaId},enumerable:true,configurable:true});Object.defineProperty(BattleGround.prototype,"shenBingExp",{get:function(){return this._shenBingExp},enumerable:true,configurable:true});Object.defineProperty(BattleGround.prototype,"jadeChips",{get:function(){return this._jadeChips},enumerable:true,configurable:true});BattleGround.prototype.mapChange=function(){if(GameMap.fubenID==GlobalConfig.BattleGroundConfig.fbId)this.enterBattle();if(this._isPaoDian&&GameMap.fubenID!=GlobalConfig.BattleGroundConfig.fbId)this.escBattle();if(this.gotoNpc&&GameMap.fbType==UserFb.FB_TYPE_CITY){this.gotoNpc=false;GameMap.myMoveTo(GlobalConfig.BattleGroundConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.BattleGroundConfig.npcPos[1]*GameMap.CELL_SIZE,this.findComplete);GameMap.moveTo(GlobalConfig.BattleGroundConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.BattleGroundConfig.npcPos[1]*GameMap.CELL_SIZE)}};BattleGround.prototype.findComplete=function(){ViewManager.ins().open(BattleGroundNpcTalkWin)};BattleGround.prototype.enterBattle=function(){this._isPaoDian=true;if(!ViewManager.ins().isShow(BattleGroundWin))ViewManager.ins().open(BattleGroundWin);ViewManager.ins().close(BattleGroundNpcTalkWin)};BattleGround.prototype.escBattle=function(){this._isPaoDian=false;ViewManager.ins().close(BattleGroundWin)};BattleGround.ins=function(){return _super.ins.call(this)};Object.defineProperty(BattleGround.prototype,"isPaoDian",{get:function(){return this._isPaoDian},enumerable:true,configurable:true});Object.defineProperty(BattleGround.prototype,"isOpen",{get:function(){return this._isOpen},enumerable:true,configurable:true});BattleGround.prototype.enterPaoDian=function(){this.sendBaseProto(1)};BattleGround.prototype.postEnterSuccess=function(bytes){this._leftTime=DateUtils.formatMiniDateTime(bytes.readInt())};BattleGround.prototype.getLeftTime=function(){return Math.floor((this._leftTime-GameServer.serverTime)/1e3)};BattleGround.prototype.postBelongChange=function(bytes){this._belongs=[];var len=bytes.readInt();this._belongs.length=len;for(var i=0;i<len;i++)this._belongs[i]={id:bytes.readShort(),handler:bytes.readDouble()}};BattleGround.prototype.doEnterCD=function(bytes){this._enterCD=bytes.readInt();this._enterCDTimer=egret.getTimer()};BattleGround.prototype.getEnterCD=function(){return Math.ceil(this._enterCD-(egret.getTimer()-this._enterCDTimer)/1e3)};BattleGround.prototype.postOpenInfo=function(bytes){this._isOpen=bytes.readBoolean();this._openLeftTime=bytes.readInt();this._openTimer=egret.getTimer()};BattleGround.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3};BattleGround.prototype.sendReLive=function(){this.sendBaseProto(5)};BattleGround.prototype.doRelive=function(bytes){UserBoss.ins().reliveTime=bytes.readInt();UserBoss.ins().killerHandler=bytes.readDouble();ViewManager.ins().close(TargetPlayerBigBloodPanel);if(UserBoss.ins().reliveTime>0){UserBoss.ins().clearWorldBossList();ViewManager.ins().open(WorldBossBeKillWin)}else ViewManager.ins().close(WorldBossBeKillWin)};BattleGround.prototype.sendCheckMyInfo=function(){this.sendBaseProto(6)};BattleGround.prototype.postMyInfo=function(bytes){this._shenBingExp=bytes.readInt();this._jadeChips=bytes.readInt()};BattleGround.prototype.postAreaChange=function(bytes){this._areaId=bytes.readShort()};BattleGround.prototype.doResult=function(bytes){var len=bytes.readInt();var list=[];list.length=len;for(var i=0;i<len;i++)list[i]=new BattleGroundRankVo(bytes);ViewManager.ins().open(BattleGroundResultWin,list);this.attHandle=0};BattleGround.prototype.checkRedPoint=function(){return this.isOpen&&Actor.level+UserZs.ins().lv*1e3>=GlobalConfig.BattleGroundConfig.openLv};BattleGround.prototype.getBelongById=function(id){if(!this._belongs||this._belongs.length==0)return null;var len=this._belongs.length;for(var i=0;i<len;i++){if(this._belongs[i].id==id)return this._belongs[i]}return null};BattleGround.prototype.checkOpen=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.PAODIAN))return false;if(BattleGround.ins().isOpen){return true}else{var leftTime=BattleGround.ins().getOpenLeftTime();if(leftTime>0){return true}}return false};BattleGround.prototype.toPaoDianCC=function(){if(!BattleGround.ins().isOpen){UserTips.ins().showTips(GlobalConfig.BattleGroundConfig.openTips);return}var openLevel=GlobalConfig.BattleGroundConfig.openLv;if(Actor.level+UserZs.ins().lv*1e3<openLevel){UserTips.ins().showTips((openLevel<1e3?openLevel+i18n("PlayWayPanel_12"):openLevel%1e3==0?openLevel/1e3+i18n("PlayWayPanel_13"):openLevel/1e3+i18n("PlayWayPanel_14")+openLevel%1e3+i18n("PlayWayPanel_15"))+i18n("PlayWayPanel_16"));return}if(CityCC.ins().enterCD<1){if(CityCC.ins().isCity){GameMap.myMoveTo(GlobalConfig.BattleGroundConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.BattleGroundConfig.npcPos[1]*GameMap.CELL_SIZE,BattleGround.ins().findComplete);GameMap.moveTo(GlobalConfig.BattleGroundConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.BattleGroundConfig.npcPos[1]*GameMap.CELL_SIZE)}else{BattleGround.ins().gotoNpc=true;CityCC.ins().sendEnter()}}else UserTips.ins().showTips(i18n("PlayWayPanel_17",CityCC.ins().enterCD))};Object.defineProperty(BattleGround.prototype,"clickTime",{get:function(){return this._clickTime},set:function(value){this.canClick=false;this._clickTime=value;TimerManager.ins().remove(this.endTimeChangeStatu,this);TimerManager.ins().doTimer(1e3,this._clickTime,this.endTimeChangeStatu,this)},enumerable:true,configurable:true});BattleGround.prototype.endTimeChangeStatu=function(){--this._clickTime;if(this._clickTime<=0){this.canClick=true;TimerManager.ins().remove(this.endTimeChangeStatu,this)}};BattleGround.prototype.checkListElements=function(handle,list){if(list.length<=0){return-1}for(var i=0;i<list.length;i++){if(list[i]==handle){return i}}return-1};BattleGround.prototype.changecanPlayList=function(handel,add){if(add===void 0){add=true}if(Actor.handle==handel){return}var index=this.checkListElements(handel,this.canPlayList);if(add){if(index==-1){this.canPlayList.push(handel)}}else{if(index!=-1){this.canPlayList.splice(index,1)}}this.postCanplayChange()};BattleGround.prototype.postCanplayChange=function(){};return BattleGround}(BaseSystem);__reflect(BattleGround.prototype,"BattleGround");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.battleGround=BattleGround.ins.bind(BattleGround)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var BattleGroundCurrentWin=function(_super){__extends(BattleGroundCurrentWin,_super);function BattleGroundCurrentWin(){var _this=_super.call(this)||this;_this.skinName="BattleGroundCurrentTipsSkin";return _this}BattleGroundCurrentWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};BattleGroundCurrentWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.observe(BattleGround.ins().postMyInfo,this.update);this.observe(BattleGround.ins().postAreaChange,this.update);this.update()};BattleGroundCurrentWin.prototype.update=function(){this.yupeiNum.text=i18n("PaoDianCurrentWin_0")+BattleGround.ins().jadeChips;this.gwexpNum.text=i18n("PaoDianCurrentWin_1")+BattleGround.ins().shenBingExp;var cfg=GlobalConfig.PassionPointAwardConfig[BattleGround.ins().areaId];this.currentArea.text=cfg?cfg.times+i18n("PaoDianCurrentWin_2"):"";var num=cfg?cfg.reward[1].count:0;num=Math.floor(num/1e3)/10;this.Speed.text=GlobalConfig.BattleGroundConfig.efficiencyDesc.replace("{0}",(cfg?cfg.reward[0].count:0)+"").replace("{1}",num+"");this.currentArea.textColor=this.yupeiNum.textColor=this.gwexpNum.textColor=this.Speed.textColor=cfg?cfg.color:this.Speed.textColor};BattleGroundCurrentWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeObserve()};BattleGroundCurrentWin.prototype.onClose=function(e){ViewManager.ins().close(this)};return BattleGroundCurrentWin}(BaseEuiView);__reflect(BattleGroundCurrentWin.prototype,"BattleGroundCurrentWin");ViewManager.ins().reg(BattleGroundCurrentWin,LayerManager.Main_View);var BattleGroundIconItemRender=function(_super){__extends(BattleGroundIconItemRender,_super);function BattleGroundIconItemRender(){var _this=_super.call(this)||this;_this.skinName="BattleGroundResultAwardSkin";return _this}BattleGroundIconItemRender.prototype.dataChanged=function(){this.icon.source=this.data[0];var num=this.data[1];num=Math.floor(num/1e3)/10;this.count.text=num==0?"0":num+i18n("PaoDianIconItemRender_0")};return BattleGroundIconItemRender}(BaseItemRender);__reflect(BattleGroundIconItemRender.prototype,"BattleGroundIconItemRender");var BattleGroundMemberHeadRender=function(_super){__extends(BattleGroundMemberHeadRender,_super);function BattleGroundMemberHeadRender(){var _this=_super.call(this)||this;_this.skinName="MemberHeadSkin";_this.clickEffc=new MovieClip;_this.clickEffc.x=48.5;_this.clickEffc.y=54;return _this}BattleGroundMemberHeadRender.prototype.dataChanged=function(){this.haveGuildName(false);if(!isNaN(this.data)){this.currentState="war";var charSource=EntityManager.ins().getEntityBymasterhHandle(this.data);if(charSource){var info=charSource.infoModel;var guildName=info.guildName?"\n<font color='#6495ed'>"+info.guildName+"</font>":"";var str=DevildomSys.ins().isDevildomBattle&&guildName?info.name+guildName:info.getNameWithServer2();if(str.indexOf("\n")>-1){this.haveGuildName(true)}this.roleName.textFlow=(new egret.HtmlTextParser).parser(str);this.roleHead.source="yuanhead"+info.job+info.sex;if(BattleGround.ins().attHandle&&BattleGround.ins().attHandle==this.data){this.addAttEffect()}}else{this.roleName.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildWarMemberHeadRender_0"))}}else if(this.data instanceof SelectInfoData){this.currentState="panel";this.num.textFlow=(new egret.HtmlTextParser).parser(this.data.num+i18n("GuildWarMemberHeadRender_1"));this.roleName.textFlow=(new egret.HtmlTextParser).parser(this.data.data.name);this.roleHead.source="yuanhead"+this.data.data.job+this.data.data.sex}};BattleGroundMemberHeadRender.prototype.addAttEffect=function(){if(!this.attEffect){this.attEffect=new MovieClip;this.attEffect.x=44;this.attEffect.y=25}this.attEffect.playFile(RES_DIR_EFF+"FightingEff",-1);this.addChild(this.attEffect)};BattleGroundMemberHeadRender.prototype.removeAttEffect=function(){if(this.attEffect){this.attEffect.stop();this.attEffect.destroy();this.attEffect=null}};BattleGroundMemberHeadRender.prototype.showEffect=function(){this.clickEffc.playFile(RES_DIR_EFF+"tapCircle",1);this.addChild(this.clickEffc)};BattleGroundMemberHeadRender.prototype.clearEffect=function(){DisplayUtils.removeFromParent(this.clickEffc);DisplayUtils.removeFromParent(this.attEffect)};BattleGroundMemberHeadRender.prototype.haveGuildName=function(b){if(b){this.namebg.height=45;this.height=110}else{this.namebg.height=26;this.height=98}};return BattleGroundMemberHeadRender}(BaseItemRender);__reflect(BattleGroundMemberHeadRender.prototype,"BattleGroundMemberHeadRender");var BattleGroundNpcTalkWin=function(_super){__extends(BattleGroundNpcTalkWin,_super);function BattleGroundNpcTalkWin(){var _this=_super.call(this)||this;_this.skinName="BattleGroundTipsSkin";return _this}BattleGroundNpcTalkWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onGoto);this.update()};BattleGroundNpcTalkWin.prototype.close=function(){this.removeTouchEvent(this.goTo,this.onGoto)};BattleGroundNpcTalkWin.prototype.update=function(){this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.BattleGroundConfig.desc);this.rule.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HelpInfoConfig[20].text);this.redPoint.visible=BattleGround.ins().isOpen};BattleGroundNpcTalkWin.prototype.onGoto=function(e){if(e.target==this.goTo){if(!BattleGround.ins().isOpen){UserTips.ins().showTips(GlobalConfig.BattleGroundConfig.openTips);return}var openLevel=GlobalConfig.BattleGroundConfig.openLv;if(Actor.level+UserZs.ins().lv*1e3<openLevel){UserTips.ins().showTips((openLevel<1e3?openLevel+i18n("PaoDianNpcTalkWin_0"):openLevel%1e3==0?openLevel/1e3+i18n("PaoDianNpcTalkWin_1"):openLevel/1e3+i18n("PaoDianNpcTalkWin_2")+openLevel%1e3+i18n("PaoDianNpcTalkWin_3"))+i18n("PaoDianNpcTalkWin_4"));return}var cd=BattleGround.ins().getEnterCD();if(cd>0){UserTips.ins().showTips(cd+i18n("PaoDianNpcTalkWin_5"));return}BattleGround.ins().enterPaoDian()}else if(e.target==this.bgClose||e.target==this.closeBtn)ViewManager.ins().close(this)};return BattleGroundNpcTalkWin}(BaseEuiView);__reflect(BattleGroundNpcTalkWin.prototype,"BattleGroundNpcTalkWin");ViewManager.ins().reg(BattleGroundNpcTalkWin,LayerManager.UI_Main);var BattleGroundResultItemRender=function(_super){__extends(BattleGroundResultItemRender,_super);function BattleGroundResultItemRender(){var _this=_super.call(this)||this;_this.skinName="BattleGroundResultItemSkin";return _this}BattleGroundResultItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.award.itemRenderer=BattleGroundIconItemRender};BattleGroundResultItemRender.prototype.dataChanged=function(){var vo=this.data;this.ranking.text=vo.rank+"";this.roleName.text=vo.roleName;this.guild.text=vo.unionName;this.award.dataProvider=new ArrayCollection([["ZSprestige",vo.jadeChips],["ZSexp",vo.shenBingExp]])};return BattleGroundResultItemRender}(BaseItemRender);__reflect(BattleGroundResultItemRender.prototype,"BattleGroundResultItemRender");var BattleGroundResultWin=function(_super){__extends(BattleGroundResultWin,_super);function BattleGroundResultWin(){var _this=_super.call(this)||this;_this._time=5;_this.skinName="BattleGroundResultSkin";return _this}BattleGroundResultWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rankList.itemRenderer=BattleGroundResultItemRender;this.myRewarrd.itemRenderer=BattleGroundIconItemRender;this._arrayCollect=new ArrayCollection;this.myRewarrd.dataProvider=this._arrayCollect};BattleGroundResultWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);this.observe(BattleGround.ins().postMyInfo,this.updateMyScore);this.timerGroup.visible=true;this.info.text=this._time+"";TimerManager.ins().doTimer(1e3,5,this.repeat,this);this.updateMyScore();this.rankList.dataProvider=new eui.ArrayCollection(args[0])};BattleGroundResultWin.prototype.updateMyScore=function(){this._arrayCollect.source=[["ZSprestige",BattleGround.ins().jadeChips],["ZSexp",BattleGround.ins().shenBingExp]]};BattleGroundResultWin.prototype.repeat=function(){this._time--;if(this._time>0)this.info.text=this._time+"";else this.timerGroup.visible=false};BattleGroundResultWin.prototype.close=function(){this.removeTouchEvent(this,this.onTap);this.removeObserve();TimerManager.ins().removeAll(this)};BattleGroundResultWin.prototype.onTap=function(e){switch(e.target){case this.closeBtn:UserFb.ins().sendExitFb();ViewManager.ins().close(this);break}};return BattleGroundResultWin}(BaseEuiView);__reflect(BattleGroundResultWin.prototype,"BattleGroundResultWin");ViewManager.ins().reg(BattleGroundResultWin,LayerManager.UI_Main);var BattleGroundWin=function(_super){__extends(BattleGroundWin,_super);function BattleGroundWin(){var _this=_super.call(this)||this;_this._leftTime=0;_this._stateList=["one","two","three","","five"];return _this}BattleGroundWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.observe(BattleGround.ins().postEnterSuccess,this.updateTime);this.observe(BattleGround.ins().postBelongChange,this.update);this.observe(BattleGround.ins().postAreaChange,this.updateCurrentArea);this.observe(BattleGround.ins().postCanplayChange,this.refushcanPlayList);TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1e3,0,this.updateMonster,this);this.update();this.updateTime();this.updateMonster();this.updateCurrentArea();this.refushcanPlayList()};BattleGroundWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="BattleGroundFightSkin";this.list1.itemRenderer=GuildWarMemberHeadRender};BattleGroundWin.prototype.updateMonster=function(){var char;var roleList=EntityManager.ins().getAllEntity();var infoModel;var teamMembers=[];var monsters=[];var boss;for(var i in roleList){char=roleList[i];infoModel=char.infoModel;if(!infoModel)continue;if(infoModel.type==EntityType.Monster&&infoModel.getAtt(AttributeType.atHp)>0){var monsterConfig=GlobalConfig.MonstersConfig[infoModel.configID];if(!monsterConfig)continue;if(monsterConfig.type==4||monsterConfig.type==3)continue;var isBoss=monsterConfig.type==1;if(!isBoss&&!infoModel.masterHandle&&monsters.length<4)monsters.push(char);if(isBoss)boss=char}}var monster;var len=monsters.length;for(var i=1;i<5;i++){monster=this["target"+i];if(i<=len){this.teamFbTarget.addChild(monster);monster.data=monsters[i-1]}else DisplayUtils.removeFromParent(monster)}if(boss){this.boss.data=boss;this.teamFbTarget.addChildAt(this.boss,Math.ceil(this.teamFbTarget.numChildren/2))}else DisplayUtils.removeFromParent(this.boss)};BattleGroundWin.prototype.refushcanPlayList=function(data){data=data||BattleGround.ins().canPlayList;this.list1.dataProvider=new eui.ArrayCollection(data);this.attList.visible=false};BattleGroundWin.prototype.clearRendererItem=function(){var len=this.list1.numChildren;for(var index=0;index<len;index++){var item=this.list1.getChildAt(index);item.clearEffect()}};BattleGroundWin.prototype.update=function(){var cfg,id;var belong;var btn;var char;for(var i=0;i<5;i++){cfg=GlobalConfig.BattleGroundConfig.expPoint[i];id=cfg[2];belong=BattleGround.ins().getBelongById(id);btn=this["area"+i];btn.name=belong?belong.handler+"":cfg[0]+","+cfg[1];this["occupy"+i].visible=belong==null;if(belong){char=EntityManager.ins().getEntityBymasterhHandle(belong.handler);if(char){this["name"+i].text=char.infoModel.name;this["guild"+i].text=char.infoModel.guildName}else{this["name"+i].text="";this["guild"+i].text=""}}else{this["name"+i].text="";this["guild"+i].text=""}}};BattleGroundWin.prototype.updateTime=function(){TimerManager.ins().remove(this.repeat,this);this._leftTime=BattleGround.ins().getLeftTime();if(this._leftTime>0){TimerManager.ins().doTimer(1e3,0,this.repeat,this);this.repeat()}else this.wholeLeftTime.text=""};BattleGroundWin.prototype.repeat=function(){if(this._leftTime<=0){this.wholeLeftTime.text="";TimerManager.ins().remove(this.repeat,this);return}this.wholeLeftTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4);this._leftTime--};BattleGroundWin.prototype.updateCurrentArea=function(){var cfg=GlobalConfig.PassionPointAwardConfig[BattleGround.ins().areaId];this.currentArea.currentState=this._stateList[cfg?cfg.times-1:0]};BattleGroundWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeObserve();TimerManager.ins().remove(this.repeat,this);this.clearRendererItem()};BattleGroundWin.prototype.onTouch=function(e){switch(e.target){case this.area0:case this.area1:case this.area2:case this.area3:case this.area4:var list=e.target.name.split(",");if(list.length==1)GameLogic.ins().postChangeAttrPoint(Number(list[0]));else{GameLogic.ins().stopAI();SysSetting.ins().setValue("mapClickTx",0);SysSetting.ins().setValue("mapClickTy",0);GameMap.moveTo(Number(list[0])*GameMap.CELL_SIZE,Number(list[1])*GameMap.CELL_SIZE)}break;case this.currentArea:BattleGround.ins().sendCheckMyInfo();ViewManager.ins().open(BattleGroundCurrentWin);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[20].text);break;case this.list1:this.listTap(e);break;case this.target1:case this.target2:case this.target3:case this.target4:case this.boss:if(e.target.data&&e.target.data.infoModel){SysSetting.ins().setValue("mapClickTx",0);SysSetting.ins().setValue("mapClickTy",0);GameLogic.ins().postChangeAttrPoint(e.target.data.infoModel.handle)}break}};BattleGroundWin.prototype.listTap=function(e){var list=e.currentTarget;var i=list.selectedIndex;var item=list.getVirtualElementAt(i);if(!item||!item.data)return;item.showEffect();if(!BattleGround.ins().canClick){return}GameLogic.ins().postChangeAttrPoint(item.data);if(!(BattleGround.ins().attHandle==item.data))EntityShowMgr.ins().showHideSomeOne(item.data)};return BattleGroundWin}(BaseEuiView);__reflect(BattleGroundWin.prototype,"BattleGroundWin");ViewManager.ins().reg(BattleGroundWin,LayerManager.Main_View);var BattleGroundRankVo=function(){function BattleGroundRankVo(bytes){this.rank=bytes.readShort();this.roleName=bytes.readString();this.unionName=bytes.readString();this.shenBingExp=bytes.readInt();this.jadeChips=bytes.readInt()}return BattleGroundRankVo}();__reflect(BattleGroundRankVo.prototype,"BattleGroundRankVo");var PackageID;(function(PackageID){PackageID[PackageID["Default"]=0]="Default";PackageID[PackageID["Guanqia"]=1]="Guanqia";PackageID[PackageID["Skill"]=2]="Skill";PackageID[PackageID["Bag"]=3]="Bag";PackageID[PackageID["Equip"]=4]="Equip";PackageID[PackageID["Encounter"]=5]="Encounter";PackageID[PackageID["Wing"]=6]="Wing";PackageID[PackageID["strongthen"]=7]="strongthen";PackageID[PackageID["Mail"]=8]="Mail";PackageID[PackageID["Task"]=9]="Task";PackageID[PackageID["Boss"]=10]="Boss";PackageID[PackageID["Gem"]=11]="Gem";PackageID[PackageID["JingMai"]=12]="JingMai";PackageID[PackageID["Zs"]=13]="Zs";PackageID[PackageID["Zhuling"]=14]="Zhuling";PackageID[PackageID["Tupo"]=15]="Tupo";PackageID[PackageID["Shop"]=16]="Shop";PackageID[PackageID["Ring"]=17]="Ring";PackageID[PackageID["Ranking"]=18]="Ranking";PackageID[PackageID["Vip"]=19]="Vip";PackageID[PackageID["Notice"]=20]="Notice";PackageID[PackageID["LoongSoul"]=21]="LoongSoul";PackageID[PackageID["TreasureHunt"]=22]="TreasureHunt";PackageID[PackageID["Train"]=23]="Train";PackageID[PackageID["FbChallenge"]=24]="FbChallenge";PackageID[PackageID["Activity"]=25]="Activity";PackageID[PackageID["Artifact"]=26]="Artifact";PackageID[PackageID["Recharge"]=27]="Recharge";PackageID[PackageID["ExpGold"]=28]="ExpGold";PackageID[PackageID["CDKey"]=29]="CDKey";PackageID[PackageID["Chat"]=30]="Chat";PackageID[PackageID["ZhuZaiEquip"]=31]="ZhuZaiEquip";PackageID[PackageID["ZsBoss"]=32]="ZsBoss";PackageID[PackageID["pfActivity"]=33]="pfActivity";PackageID[PackageID["Ladder"]=34]="Ladder";PackageID[PackageID["Miji"]=35]="Miji";PackageID[PackageID["moneyTree"]=36]="moneyTree";PackageID[PackageID["Guild"]=37]="Guild";PackageID[PackageID["Title"]=38]="Title";PackageID[PackageID["GuildFB"]=39]="GuildFB";PackageID[PackageID["GuildWar"]=40]="GuildWar";PackageID[PackageID["GuildRobber"]=41]="GuildRobber";PackageID[PackageID["GuildStore"]=42]="GuildStore";PackageID[PackageID["WarSpirit"]=43]="WarSpirit";PackageID[PackageID["Dress"]=44]="Dress";PackageID[PackageID["GuildBoss"]=46]="GuildBoss";PackageID[PackageID["Friends"]=47]="Friends";PackageID[PackageID["Mine"]=49]="Mine";PackageID[PackageID["Rune"]=50]="Rune";PackageID[PackageID["NeiGong"]=51]="NeiGong";PackageID[PackageID["Box"]=52]="Box";PackageID[PackageID["Book"]=53]="Book";PackageID[PackageID["DailyCheckIn"]=54]="DailyCheckIn";PackageID[PackageID["Heirloom"]=55]="Heirloom";PackageID[PackageID["Weapons"]=56]="Weapons";PackageID[PackageID["Millionaire"]=57]="Millionaire";PackageID[PackageID["City"]=58]="City";PackageID[PackageID["ThreeHeroes"]=59]="ThreeHeroes";PackageID[PackageID["GodWeapon"]=60]="GodWeapon";PackageID[PackageID["Battle"]=61]="Battle";PackageID[PackageID["PaoDian"]=62]="PaoDian";PackageID[PackageID["GodWeaponItem"]=63]="GodWeaponItem";PackageID[PackageID["Samsara"]=64]="Samsara";PackageID[PackageID["WJBattle"]=65]="WJBattle";PackageID[PackageID["WeiWang"]=66]="WeiWang";PackageID[PackageID["PKCompetition"]=67]="PKCompetition";PackageID[PackageID["PActivity"]=68]="PActivity";PackageID[PackageID["HeartMethod"]=69]="HeartMethod";PackageID[PackageID["JadeNew"]=70]="JadeNew";PackageID[PackageID["LyMark"]=71]="LyMark";PackageID[PackageID["KFBoss"]=72]="KFBoss";PackageID[PackageID["Shenshou"]=73]="Shenshou";PackageID[PackageID["Hungu"]=74]="Hungu";PackageID[PackageID["Devildom"]=75]="Devildom";PackageID[PackageID["Auction"]=76]="Auction";PackageID[PackageID["KfArena"]=77]="KfArena";PackageID[PackageID["Promote"]=78]="Promote";PackageID[PackageID["FuliHongbao"]=79]="FuliHongbao";PackageID[PackageID["LevelupRewards"]=80]="LevelupRewards";PackageID[PackageID["SwordSkin"]=81]="SwordSkin";PackageID[PackageID["Ticket"]=82]="Ticket";PackageID[PackageID["ShapeShifting"]=83]="ShapeShifting";PackageID[PackageID["DressCollection"]=84]="DressCollection";PackageID[PackageID["Strength"]=85]="Strength";PackageID[PackageID["Escort"]=86]="Escort";PackageID[PackageID["Marry"]=87]="Marry";PackageID[PackageID["NewStory"]=88]="NewStory";PackageID[PackageID["ShapeShiftingTreasure"]=89]="ShapeShiftingTreasure";PackageID[PackageID["GiftPack"]=90]="GiftPack";PackageID[PackageID["TicketLingShiTreasure"]=91]="TicketLingShiTreasure";PackageID[PackageID["TimeCard"]=92]="TimeCard";PackageID[PackageID["RealNameReward"]=93]="RealNameReward";PackageID[PackageID["newBossHome"]=94]="newBossHome";PackageID[PackageID["OpenSystem"]=95]="OpenSystem";PackageID[PackageID["OnlineTrain"]=96]="OnlineTrain";PackageID[PackageID["StrategyReward"]=97]="StrategyReward";PackageID[PackageID["Peach"]=98]="Peach";PackageID[PackageID["BattleGround"]=99]="BattleGround";PackageID[PackageID["ROLLMAP"]=100]="ROLLMAP";PackageID[PackageID["ShoppingGift"]=101]="ShoppingGift";PackageID[PackageID["QQzone"]=102]="QQzone";PackageID[PackageID["QQDaTing"]=103]="QQDaTing";PackageID[PackageID["BaoZang"]=104]="BaoZang";PackageID[PackageID["HardFb"]=105]="HardFb";PackageID[PackageID["TGuide"]=106]="TGuide";PackageID[PackageID["Login"]=255]="Login"})(PackageID||(PackageID={}));window["PackageID"]=PackageID;var BookState;(function(BookState){BookState[BookState["canOpen"]=0]="canOpen";BookState[BookState["haveOpen"]=1]="haveOpen";BookState[BookState["noOpen"]=2]="noOpen"})(BookState||(BookState={}));window["BookState"]=BookState;var BooKData=function(){function BooKData(){this.level=-1;this.exp=0;this.number=0}BooKData.prototype.updateData=function(bytes){this.level=bytes.readShort()};BooKData.prototype.getNum=function(roleJob){var id=GlobalConfig.CardConfig[this.id][0].itemId;var isHave=UserBag.ins().getBagGoodsCountById(0,id);if(isNaN(roleJob)){var suitId=Book.ins().getSuitIdByBookId(this.id);if(!suitId)return isHave;var tmproleJob=Book.jobs.indexOf(suitId);if(tmproleJob==-1)return isHave;var isActRole=void 0;for(var i=0;i<SubRoles.ins().subRolesLen;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(!role)continue;if(role.job==tmproleJob+1){isActRole=true;break}}if(!isActRole)return 0;return isHave}if(isHave){for(var k in GlobalConfig.SuitConfig){var tmproleJob=Book.jobs.indexOf(Number(k));if(tmproleJob!=-1&&GlobalConfig.SuitConfig[k][1].idList.indexOf(this.id)!=-1){for(var i=0;i<SubRoles.ins().subRolesLen;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(!role)continue;if(role.job==roleJob+1)return isHave}}}}return 0};BooKData.prototype.getItemId=function(){return GlobalConfig.CardConfig[this.id][0].itemId};BooKData.prototype.canOpen=function(){return this.getNum()>0};BooKData.prototype.getNextLevelCost=function(){if(this.level==-1)return 0;var nextConf=GlobalConfig.CardConfig[this.id][this.level+1];if(nextConf)return nextConf.cost;return 0};BooKData.prototype.getState=function(roleJob){if(this.level>-1)return BookState.haveOpen;if(this.getNum(roleJob)>0)return BookState.canOpen;else return BookState.noOpen};return BooKData}();__reflect(BooKData.prototype,"BooKData");var BookRedPoint=function(_super){__extends(BookRedPoint,_super);function BookRedPoint(){var _this=_super.call(this)||this;_this.canLvlUp=false;_this.registerOpen(Actor.ins().postLevelChange,UserZs.ins().postZsData);_this.registerTab(0,Book.ins().postDataChange,UserBag.ins().postItemAdd,GameLogic.ins().postSubRoleChange);_this.registerTab(1,Book.ins().postDataChange,UserBag.ins().postItemAdd);_this.associated(_this.postLvlUp,Book.ins().postDataChange);return _this}BookRedPoint.ins=function(){return _super.ins.call(this)};BookRedPoint.prototype.postLvlUp=function(){var oldv=this.canLvlUp;this.canLvlUp=Book.ins().getBookUpRed();return oldv!=this.canLvlUp};BookRedPoint.prototype.getTabRedPoint=function(tab){if(tab==0){return Book.ins().getBookRed()}else if(tab==1){return Book.ins().checkResolveRedPoint()}else if(tab==2){return Book.ins().getBookUpRed()}return false};BookRedPoint.prototype.getIsOpen=function(){return LiLian.ins().checkBookOpen()};return BookRedPoint}(RedPointBase);__reflect(BookRedPoint.prototype,"BookRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.bookRedPoint=BookRedPoint.ins.bind(BookRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var BookAttrWin=function(_super){__extends(BookAttrWin,_super);function BookAttrWin(){var _this=_super.call(this)||this;_this.skinName="tujianzonshuxin";_this.isTopLevel=true;_this.pown=BitmapNumber.ins().createNumPic(0,"8",8);_this.pown.x=56+169;_this.pown.y=199+98+15;_this.addChild(_this.pown);return _this}BookAttrWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.update();this.addTouchEvent(this.bgClose,this.onTop)};BookAttrWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};BookAttrWin.prototype.onTop=function(){ViewManager.ins().close(BookAttrWin)};BookAttrWin.prototype.update=function(){var str=""};return BookAttrWin}(BaseEuiView);__reflect(BookAttrWin.prototype,"BookAttrWin");ViewManager.ins().reg(BookAttrWin,LayerManager.UI_Main);var book=GameSystem.book;window["book"]=book;var BookItem=function(_super){__extends(BookItem,_super);function BookItem(){var _this=_super.call(this)||this;_this.skinName="tujianskinstate";_this.tw=egret.Tween.get(_this.kejihuo,{loop:true});_this.tw.to({scaleX:_this.kejihuo.scaleX+.3,scaleY:_this.kejihuo.scaleY+.3},500).to({scaleX:_this.kejihuo.scaleX,scaleY:_this.kejihuo.scaleY},500);return _this}BookItem.prototype.dataChanged=function(){var id=this.data;var bookData=Book.ins().getBookById(id);var confBase=GlobalConfig.DecomposeConfig[id];var level=bookData.level>-1?bookData.level:0;var conf=GlobalConfig.CardConfig[id][level];var roleJob;for(var i in GlobalConfig.SuitConfig){var scfg=GlobalConfig.SuitConfig[i][1];var sid=scfg.idList.indexOf(id);if(sid==-1){continue}roleJob=Book.jobs.indexOf(Number(i));if(roleJob!=-1){break}roleJob=undefined}var state=bookData.getState(roleJob);this.quality0.source=this.quality1.source=this.quality2.source=this.quality3.source="tujian_"+confBase.quality+"c";this.quality.source="tujian_"+confBase.quality+"a";this.quality4.source="tujian_"+confBase.quality+"b";this.setStar(level);var power=UserBag.getAttrPower(conf.attrs);power=Book.ins().getBookPowerNum(power,confBase.id);if(this.pown){BitmapNumber.ins().changeNum(this.pown,power,"8",4)}else{this.pown=BitmapNumber.ins().createNumPic(power,"8",4)}this.pown.x=56;this.pown.y=199;this.pownGP.addChild(this.pown);this.rect.visible=false;this.weiji.visible=false;this.manji.visible=false;this.kejihuo.visible=false;if(bookData.level==10){this.manji.visible=true;this.redPoint.visible=false;this.imgBox.source=""+confBase.imgLight}else{switch(state){case BookState.canOpen:this.imgBox.source=""+confBase.imgLight;this.redPoint.visible=false;this.rect.visible=true;this.kejihuo.visible=true;break;case BookState.haveOpen:this.imgBox.source=""+confBase.imgLight;var needScore=bookData.getNextLevelCost();this.redPoint.visible=needScore&&Book.ins().score>=needScore;break;case BookState.noOpen:this.imgBox.source=""+confBase.imgLight;this.redPoint.visible=false;this.rect.visible=true;this.weiji.visible=true;break;default:this.imgBox.source=""+confBase.imgLight;break}}this.labelName.text=confBase.name;this.labelName.textColor=ItemBase.QUALITY_COLOR[confBase.quality];this.labelName.strokeColor=ItemBase.QUALITY_STROKE_COLOR[confBase.quality];this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)};BookItem.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);egret.Tween.removeTweens(this.kejihuo)};BookItem.prototype.setRemoveTween=function(v){if(v)egret.Tween.removeTweens(this.kejihuo)};BookItem.prototype.setStar=function(num){for(var i=num;i<10;i++){this["imgStar"+i].visible=false}for(var i=0;i<num;i++){this["imgStar"+i].visible=true}};BookItem.prototype.getCurrentState=function(){var state="notactive";return state};return BookItem}(BaseItemRender);__reflect(BookItem.prototype,"BookItem");var BookListItem=function(_super){__extends(BookListItem,_super);function BookListItem(){var _this=_super.call(this)||this;_this.isShow=false;_this.skinName="TujiandaanniuSkin";_this.init();return _this}BookListItem.prototype.init=function(){this.label.touchEnabled=false};BookListItem.prototype.destruct=function(){};BookListItem.prototype.dataChanged=function(){var data=this.data;this.label.text=""+data.name;this.btnName.source=data.icon;this.idList=data.idList;this.checkRedPoint()};BookListItem.prototype.checkRedPoint=function(){for(var _i=0,_a=this.idList;_i<_a.length;_i++){var k=_a[_i];if(Book.ins().getBookUpRedByListId(k)||Book.ins().getSuitRedPoint(k)){this.redPoint.visible=true;return}}this.redPoint.visible=false};return BookListItem}(BaseItemRender);__reflect(BookListItem.prototype,"BookListItem");var BookMenuItem=function(_super){__extends(BookMenuItem,_super);function BookMenuItem(){var _this=_super.call(this)||this;_this.isShow=false;_this.skinName="TujianzianniuSkin";_this.width=160;_this.height=50;_this.label.touchEnabled=false;return _this}BookMenuItem.prototype.dataChanged=function(){this.itemData=GlobalConfig.SuitConfig[this.data][1];this.label.text=this.itemData.name;this.checkRedPoint()};BookMenuItem.prototype.checkRedPoint=function(){this.redPoint.visible=Book.ins().getSuitRedPoint(this.data)};BookMenuItem.prototype.show=function(b){this.isShow=b;if(this.isShow){this.currentState="select"}else{this.currentState="close"}this.validateNow();this.checkRedPoint()};return BookMenuItem}(BaseItemRender);__reflect(BookMenuItem.prototype,"BookMenuItem");var BookTipsWin=function(_super){__extends(BookTipsWin,_super);function BookTipsWin(){var _this=_super.call(this)||this;_this._bottomY=0;_this._equipPower=0;_this._totalPower=0;_this.curRole=0;_this.curId=0;_this.curLevel=0;_this.index=0;_this.skinName="tujiantips";return _this}BookTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.itemIcon.imgJob.visible=false;this.anigroup.touchEnabled=false};BookTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curId=param[0];this.curLevel=param[1]||0;this.handle=param[2];this.addTouchEndEvent(this.bgClose,this.otherClose);this.addTouchEndEvent(this.btnUse,this.onTap);this.setData(this.curId)};BookTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.otherClose);this.removeTouchEvent(this.btnUse,this.onTap)};BookTipsWin.prototype.otherClose=function(evt){ViewManager.ins().close(BookTipsWin)};BookTipsWin.prototype.onTap=function(e){var btn=e.currentTarget;if(btn.label==i18n("BookTipsWin_0")){}else{}ViewManager.ins().close(this);ViewManager.ins().open(LiLianWin,3,this.curId)};BookTipsWin.prototype.setData=function(curId){var confBase=Book.ins().getDecomposeConfigByItemId(curId);var conf=GlobalConfig.CardConfig[confBase.id][this.curLevel];this._confBase=confBase;this._totalPower=0;var itemConfig=GlobalConfig.ItemConfig[conf.itemId];if(itemConfig)this.nameLabel.text=itemConfig.name;this.nameLabel.textColor=ItemBase.QUALITY_COLOR[confBase.quality];this.nameLabel.strokeColor=ItemBase.QUALITY_STROKE_COLOR[confBase.quality];this.lvTxt.text=i18n("BookTipsWin_1",conf.level);this.qualityImg.source="bagSkin_json.quali"+confBase.quality;this.qualTxt.text=ColorUtil.COLOR_STR[confBase.quality];itemConfig=GlobalConfig.ItemConfig[conf.itemId];this.itemIcon.setData(itemConfig);var ii=1;this.attr1.visible=false;this.attr2.visible=false;this.attr3.visible=false;this.attr4.visible=false;var totalAttr=[];var specailDesc=false;var specStr="";for(var k in conf.attrs){if(conf.attrs[k].type==0||conf.attrs[k].value==0)continue;if(conf.attrs[k].type==AttributeType.atHpEx||conf.attrs[k].type==AttributeType.atAtkEx||conf.attrs[k].type==AttributeType.atDamageReduction||conf.attrs[k].type==AttributeType.atDefEx||conf.attrs[k].type==AttributeType.atResEx){if(!specailDesc){specStr=i18n("BookTipsWin_2");specStr+=i18n("BookTipsWin_3");specailDesc=true;var specName=AttributeData.getAttrStrByType(conf.attrs[k].type);if(conf.attrs[k].type==AttributeType.atDefEx||conf.attrs[k].type==AttributeType.atResEx){specName=i18n("BookTipsWin_4")}specStr+=specName;specStr+="+"+conf.attrs[k].value/100+"%";totalAttr.push(conf.attrs[k])}}else{var attrStr="";attrStr=AttributeData.getAttStrByType(conf.attrs[k],0,"  ");totalAttr.push(conf.attrs[k]);this["attr"+ii].text=attrStr;this["attr"+ii].visible=true;ii++}}if(conf.specialAttr){if(specStr=="")specStr=i18n("BookTipsWin_5");for(var k in conf.specialAttr){if(conf.specialAttr[k].type==0||conf.specialAttr[k].value==0)continue;if(conf.specialAttr){specailDesc=true;specStr+=i18n("BookTipsWin_6");specStr+=conf.specialAttr[k].type==1?i18n("BookTipsWin_7"):i18n("BookTipsWin_8");specStr+="+"+conf.specialAttr[k].value+"%"}}}this.specialAttr.text=specStr;this.specialAttr.visible=specailDesc;this._equipPower=Math.floor(UserBag.getAttrPower(totalAttr));this._totalPower+=this._equipPower;this.addTipsEx();var len=3;for(var k in GlobalConfig.SuitConfig){if(Book.jobs.indexOf(Number(k))!=-1&&GlobalConfig.SuitConfig[k][1].idList.indexOf(conf.id)!=-1){len=1;this.threeLabel.visible=false;break}}this._totalPower=this._totalPower*len;this.powerPanel.setPower(this._totalPower);this.iconBg.source=confBase.imgShow||confBase.imgLight;var books=Book.ins().getBookByItemId(this.curId);var isAllOpen=true;for(var _i=0,books_2=books;_i<books_2.length;_i++){var book_1=books_2[_i];if(book_1.getState()!=BookState.haveOpen){isAllOpen=false;break}}if(!isAllOpen){this.btnUse.label=i18n("BookTipsWin_9");this.tips.source="tjweijihuo"}else{this.btnUse.label=i18n("BookTipsWin_10");this.tips.source="tjyijihuo"}this.btnUse.visible=!!this.handle;return};BookTipsWin.prototype.addTipsEx=function(){var id;var item=Book.ins().getBookByItemId(this.curId)[0];if(item)id=item.id;if(!id)return;var desc1="";for(var j in GlobalConfig.SuitConfig){var config=GlobalConfig.SuitConfig[j][1];if(config.idList.indexOf(id)!=-1){desc1=config.name?config.name:"";id=config.id;break}}var desc2="";for(var k in GlobalConfig.BookListConfig){var config=GlobalConfig.BookListConfig[k];if(config.idList.indexOf(id)!=-1){desc2=config.name?config.name:"";break}}if(desc1||desc2){this.belong.visible=true;var text=desc1?desc1+"·":"";text+=desc2;this.belong.text=text}else this.belong.visible=false};BookTipsWin.prototype.addTips=function(){while(this.forgeGroup.numElements){this.forgeGroup.removeChildAt(0)}var titleAttrTxt=new eui.Label;var attrTxt=new eui.Label;var count=Book.ins().getSuitNum(this.curId);var dev=GlobalConfig.SuitConfig[this.curId][1].count;var level=Math.floor(count/dev);if(level==0)return;var config=GlobalConfig.SuitConfig[this.curId][level];if(!titleAttrTxt.parent)this.createTitle(titleAttrTxt,attrTxt);var str=Book.ins().getTitleById(this.curId);titleAttrTxt.text=i18n("BookTipsWin_11",str,config.name,Book.ins().getSuitNum(this.curId),config.idList.length);attrTxt.text=AttributeData.getAttStr(config.attrs,1,1,"  ");if(GlobalConfig.SuitConfig[this.curId][level]){var nextTitleAttrTxt=new eui.Label;var nextAttrTxt=new eui.Label;this._bottomY=attrTxt.y+attrTxt.height;this.createTitle(nextTitleAttrTxt,nextAttrTxt);var nextConfig=GlobalConfig.SuitConfig[this.curId][level+1];nextTitleAttrTxt.text=i18n("BookTipsWin_12",str,nextConfig.name,nextConfig.count,config.idList.length);nextAttrTxt.text+=AttributeData.getAttStr(nextConfig.attrs,1,1,"  ");this._bottomY=nextAttrTxt.y+nextAttrTxt.height}else{this._bottomY=attrTxt.y+attrTxt.height}};BookTipsWin.prototype.createTitle=function(titleAttrTxt,attrTxt){titleAttrTxt.fontFamily="Arial";titleAttrTxt.size=20;titleAttrTxt.textColor=8283191;titleAttrTxt.bold=true;titleAttrTxt.x=24;titleAttrTxt.y=this._bottomY+10+14;this.forgeGroup.addChild(titleAttrTxt);attrTxt.fontFamily="Arial";attrTxt.size=18;attrTxt.lineSpacing=8;attrTxt.x=46;attrTxt.y=titleAttrTxt.y+24;attrTxt.textColor=10458221;this.forgeGroup.addChild(attrTxt)};BookTipsWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!Book.ins().getDecomposeConfigByItemId(param[0])){return false}return true};return BookTipsWin}(BaseEuiView);__reflect(BookTipsWin.prototype,"BookTipsWin");ViewManager.ins().reg(BookTipsWin,LayerManager.UI_Popup);var BookUpWin=function(_super){__extends(BookUpWin,_super);function BookUpWin(){var _this=_super.call(this)||this;_this.jobName=[i18n("BookUpWin_0"),i18n("BookUpWin_1"),i18n("BookUpWin_2")];_this.skinName="tujianshengxing";_this.list.itemRenderer=BookUpItem;_this.listOpen.dataProvider=null;_this.listOpen.itemRenderer=BookItem;_this.isTopLevel=true;_this.smeltEquips=[];_this.smeltEquips.length=10;_this.dataInfo=new eui.ArrayCollection(_this.smeltEquips);_this.list.dataProvider=_this.dataInfo;_this.barbc=new ProgressBarEff;_this.barbc.setWidth(450);_this.barbc.x=-10;_this.barbc.y=-15;_this.barGroup.addChild(_this.barbc);return _this}BookUpWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.selectData=param[0];this.observe(Book.ins().postDataChange,this.updateView);this.updateView();this.addTouchEvent(this.btnUp,this.onTap);this.addTouchEvent(this.info,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap)};BookUpWin.prototype.close=function(){this.removeTouchEvent(this.btnUp,this.onTap);this.removeTouchEvent(this.info,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeObserve()};BookUpWin.prototype.onTap=function(e){switch(e.target){case this.btnUp:var id=Book.ins().getSuitIdByBookId(this.selectData.id);if(!id)return;var isHaveJob=false;var roleJob=Book.jobs.indexOf(Number(id));if(roleJob!=-1){for(var i=0;i<SubRoles.ins().subRolesLen;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(!role)continue;if(role.job==roleJob+1){isHaveJob=true;break}}if(!isHaveJob){UserTips.ins().showTips(i18n("BookUpWin_3",this.jobName[roleJob]));return}}var config=GlobalConfig.DecomposeConfig[this.selectData.id];var itemId=config.itemId;var name_6=config.name;var imgLight=config.imgLight;if(isHaveJob){var csfg=GlobalConfig.CardConfig[this.selectData.id][0];itemId=csfg.itemId}if(this.selectData.level==-1){var item=GlobalConfig.ItemConfig[itemId];var good=UserBag.ins().getBagItemById(item.id);if(good){Book.ins().sendOpen(this.selectData.id);ViewManager.ins().close(this);ViewManager.ins().open(Activationtongyong,0,name_6,imgLight,true,function(){})}else{UserWarn.ins().setBuyGoodsWarn(item.id,1)}}else{var cardConf=GlobalConfig.CardConfig[this.selectData.id][this.selectData.level];if(cardConf.cost>Book.ins().score){UserTips.ins().showTips(i18n("BookUpWin_4"))}else{Book.ins().sendUp(this.selectData.id)}}break;case this.info:if(this.selectData.level==-1){var id_1=Book.ins().getSuitIdByBookId(this.selectData.id);if(!id_1)return;var config_4;var item=void 0;if(Book.jobs.indexOf(Number(id_1))==-1){config_4=GlobalConfig.DecomposeConfig[this.selectData.id];item=GlobalConfig.ItemConfig[config_4.itemId];UserWarn.ins().setBuyGoodsWarn(item.id,1)}else{var cardConfig=GlobalConfig.CardConfig[this.selectData.id][0];item=GlobalConfig.ItemConfig[cardConfig.itemId];UserWarn.ins().setBuyGoodsWarn(item.id,1)}}else{ViewManager.ins().open(BreakDownView,BreakDownView.type_book,ItemType.TYPE_9)}break;case this.btnAdd:break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};BookUpWin.prototype.updateView=function(){var confBase=GlobalConfig.DecomposeConfig[this.selectData.id];var level=this.selectData.level>-1?this.selectData.level:0;var conf=GlobalConfig.CardConfig[this.selectData.id][level];this.expBar.value=Book.ins().score;this.listOpen.dataProvider=new eui.ArrayCollection([this.selectData.id]);this.listOpen.validateNow();for(var i=0;i<this.listOpen.numElements;i++){var bitem=this.listOpen.getElementAt(i);if(bitem)bitem.setRemoveTween(true)}var nextConf=GlobalConfig.CardConfig[this.selectData.id][this.selectData.level+1];this.labelCur.text=AttributeData.getAttStr(conf.attrs,0,1,"：");this.barbc.setMaxValue(nextConf?nextConf.cost:conf.cost);this.barbc.setValue(Book.ins().score);if(this.selectData.level<0){this.currentState="noActive";this.btnUp.label=i18n("BookUpWin_5");this.info.textFlow=TextFlowMaker.generateTextFlow1(i18n("BookUpWin_6"));var newAttrs=[];for(var i in conf.attrs){if(conf.attrs[i].type==AttributeType.atHpEx||conf.attrs[i].type==AttributeType.atAtkEx||conf.attrs[i].type==AttributeType.atDamageReduction||conf.attrs[i].type==AttributeType.atDefEx||conf.attrs[i].type==AttributeType.atResEx){continue}newAttrs.push({type:conf.attrs[i].type,value:0})}this.labelCur.text=AttributeData.getAttStr(newAttrs,0,1,"：")}else if(nextConf){this.currentState="nomax";this.btnUp.label=i18n("BookUpWin_7");this.info.textFlow=TextFlowMaker.generateTextFlow1(i18n("BookUpWin_8"))}else{this.currentState="max";this.btnUp.label=i18n("BookUpWin_9");this.info.textFlow=TextFlowMaker.generateTextFlow1(i18n("BookUpWin_10"))}if(this.selectData.level<0){this.tujian.textColor=ItemBase.QUALITY_COLOR[confBase.quality];this.tujian.strokeColor=ItemBase.QUALITY_STROKE_COLOR[confBase.quality];var itemConfig=GlobalConfig.ItemConfig[confBase.itemId];this.tujian.text=itemConfig.name+"x1"}if(nextConf){this.expLabel.text=Book.ins().score+"/"+nextConf.cost;this.expBar.maximum=nextConf.cost;this.barbc.setMaxValue(nextConf.cost);var nextConf2=[];for(var i in nextConf.attrs){if(nextConf.attrs[i].type==AttributeType.atHpEx||nextConf.attrs[i].type==AttributeType.atAtkEx||nextConf.attrs[i].type==AttributeType.atDamageReduction||nextConf.attrs[i].type==AttributeType.atDefEx||nextConf.attrs[i].type==AttributeType.atResEx){continue}nextConf2[i]=nextConf.attrs[i]}this.labelNext.text=AttributeData.getAttStr(nextConf2,0,1,"：")}else{this.expLabel.text=i18n("BookUpWin_11");this.labelNext.text=i18n("BookUpWin_12");this.barbc.setLbValueText(i18n("BookUpWin_13"))}this.specialAttrDese(conf)};BookUpWin.prototype.setMaterial=function(){this.arrMat=Book.ins().getUpChipData(this.selectData);var data=new eui.ArrayCollection;this.smeltEquips=[];this.smeltEquips.length=10;for(var i=0;i<this.arrMat.length;i++){if(i<10){var conf=GlobalConfig.CardConfig[this.arrMat[i]][1];var itemdata=new ItemData;itemdata.itemConfig=GlobalConfig.ItemConfig[conf.itemId];this.smeltEquips[i]=itemdata}else break}this.dataInfo.replaceAll(this.smeltEquips);this.list.dataProvider=this.dataInfo};BookUpWin.prototype.specialAttrDese=function(conf){if(!conf){this.specialAttr.visible=false;return}this.specialAttr.visible=true;var specailDesc=false;var specStr="";for(var k in conf.attrs){if(conf.attrs[k].type==0||conf.attrs[k].value==0)continue;if(!specailDesc){if(conf.attrs[k].type==AttributeType.atHpEx||conf.attrs[k].type==AttributeType.atAtkEx||conf.attrs[k].type==AttributeType.atDamageReduction||conf.attrs[k].type==AttributeType.atDefEx||conf.attrs[k].type==AttributeType.atResEx){specStr=i18n("BookUpWin_14");specailDesc=true;specStr+=i18n("BookUpWin_15");var specName=AttributeData.getAttrStrByType(conf.attrs[k].type);if(conf.attrs[k].type==AttributeType.atDefEx||conf.attrs[k].type==AttributeType.atResEx){specName=i18n("BookUpWin_16")}specStr+=specName;specStr+="+"+conf.attrs[k].value/100+"%"}}}if(conf.specialAttr){if(specStr=="")specStr=i18n("BookUpWin_17");for(var k in conf.specialAttr){if(conf.specialAttr[k].type==0||conf.specialAttr[k].value==0)continue;if(conf.specialAttr){specailDesc=true;specStr+=i18n("BookUpWin_18");specStr+=conf.specialAttr[k].type==1?i18n("BookUpWin_19"):i18n("BookUpWin_20");specStr+="+"+conf.specialAttr[k].value+"%"}}}this.specialAttr.text=specStr;this.specialAttr.visible=specailDesc};return BookUpWin}(BaseEuiView);__reflect(BookUpWin.prototype,"BookUpWin");ViewManager.ins().reg(BookUpWin,LayerManager.UI_Popup);var BookWayTips=function(_super){__extends(BookWayTips,_super);function BookWayTips(){var _this=_super.call(this)||this;_this.skinName="TuJianSuitTips";return _this}BookWayTips.prototype.initUI=function(){_super.prototype.initUI.call(this);this.suitlist.itemRenderer=BookWayTipsItem};BookWayTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.bgClose,this.otherClose);this.suitId=param[0];this.updateData()};BookWayTips.prototype.updateData=function(){this.nameLabel.text=Book.ins().getTitleById(this.suitId)+i18n("BookWayTips_0");var config=GlobalConfig.SuitConfig[this.suitId];var datalist=[];var curNum=Book.ins().getSuitNum(this.suitId);for(var i in config){var cfg=config[i];var data={config:cfg,curNum:curNum};datalist.push(data)}this.suitlist.dataProvider=new eui.ArrayCollection(datalist)};BookWayTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.otherClose)};BookWayTips.prototype.otherClose=function(evt){ViewManager.ins().close(BookWayTips)};return BookWayTips}(BaseEuiView);__reflect(BookWayTips.prototype,"BookWayTips");ViewManager.ins().reg(BookWayTips,LayerManager.UI_Popup);var BookWayTipsItem=function(_super){__extends(BookWayTipsItem,_super);function BookWayTipsItem(){var _this=_super.call(this)||this;_this.skinName="TuJianSuitItem";_this.init();return _this}BookWayTipsItem.prototype.init=function(){};BookWayTipsItem.prototype.destruct=function(){};BookWayTipsItem.prototype.dataChanged=function(){var cfg=this.data.config;this.jieduan.text=cfg.level+i18n("BookWayTipsItem_0");this.num.text=cfg.count+"";this.suitNum.text=this.data.curNum+"/"+cfg.count;for(var i=0;i<cfg.attrs.length;i++){var attrname=AttributeData.getAttrStrByType(cfg.attrs[i].type);this["value"+i].text=attrname+"+"+cfg.attrs[i].value;if(this.data.curNum>=cfg.count)this["value"+i].textColor=2149168}if(this.data.curNum>=cfg.count)this.suitNum.textColor=2149168};return BookWayTipsItem}(BaseItemRender);__reflect(BookWayTipsItem.prototype,"BookWayTipsItem");var BookWin=function(_super){__extends(BookWin,_super);function BookWin(){var _this=_super.call(this)||this;_this.focusId=-1;_this.waitTime=100;_this.name=i18n("BookWin_0");return _this}BookWin.prototype.childrenCreated=function(){this.listBook.dataProvider=null;this.listMenu.dataProvider=null;this.listBook.itemRenderer=BookItem;this.listMenu.itemRenderer=BookListItem;this.listBook.touchEnabled=false;this.resolve.textFlow=TextFlowMaker.generateTextFlow1(i18n("BookWin_1"));this.chargeEff1=new MovieClip;this.eff.addChild(this.chargeEff1);this.chargeEff1.x=this.eff.x;this.chargeEff1.y=this.eff.y;this.chargeEff1.touchEnabled=false;this.chargeEff1.scaleY=.5;this.chargeEff1.scaleX=.75;this.greencolor=2149168;this.graycolor=this.attr.textColor;this.itemHeight=150;this.flameMC=new MovieClip;this.flameMC.x=100;this.flameMC.y=15;this.flameGroup.addChildAt(this.flameMC,1);this.power=BitmapNumber.ins().createNumPic(0,"8",5);this.power.x=this.fightImg.x+70;this.power.y=this.fightImg.y+4;this.flameGroup.addChild(this.power)};BookWin.prototype.open=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.labelAttr.text="";this.labelSuit.text="";this.listBook.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBookTap,this);this.listMenu.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onMenuTap,this);this.addTouchEvent(this.xiangqing,this.onTap);this.addTouchEvent(this.resolve,this.onTap);this.addTouchEvent(this.getway,this.onTap);this.addTouchEvent(this.leftGroup,this.onTap);this.addTouchEvent(this.rightGroup,this.onTap);this.observe(Book.ins().postDataChange,this.delayItemChange);this.observe(UserBag.ins().postItemDel,this.delayItemChange);this.observe(UserBag.ins().postItemAdd,this.delayItemChange);this.observe(UserBag.ins().postItemChange,this.delayItemChange);this.observe(BookRedPoint.ins().postRedPoint,this.updateRedPoint);this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange);this.initView();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.yingHun);var curId=param[0]||0;var conf=null;var subSelect=0;var subSelect2=0;if(curId){conf=Book.ins().getDecomposeConfigByItemId(curId);var suitConf=GlobalConfig.SuitConfig;var subId=1;for(var id in suitConf){if(suitConf[id][1].idList.indexOf(conf.id)>=0){subId=+id;this.focusId=conf.id;break}}for(var id in GlobalConfig.BookListConfig){if(GlobalConfig.BookListConfig[id].idList.indexOf(subId)>=0){subSelect=GlobalConfig.BookListConfig[id].sort-1;subSelect2=GlobalConfig.BookListConfig[id].idList.indexOf(subId);break}}}TimerManager.ins().doTimer(this.waitTime,1,function(){_this.listMenu.selectedIndex=subSelect;var firstMenu=_this.listMenu.getVirtualElementAt(subSelect);if(firstMenu){if(firstMenu.idList){_this.curId=firstMenu.idList[subSelect2];_this.updateBook();_this.updateAttr()}}},this);this.preScrollV=0;this.flameMC.playFile(RES_DIR_EFF+"zhanduolibeijing",-1)};BookWin.prototype.onChange=function(){if(this.listMenu.scrollH<46){this.leftGroup.visible=false;this.rightGroup.visible=true}else if(this.listMenu.scrollH>=this.listMenu.contentWidth-this.listMenu.width-46){this.leftGroup.visible=true;this.rightGroup.visible=false}else{this.leftGroup.visible=true;this.rightGroup.visible=true}this.updateRedPoint()};BookWin.prototype.onTap=function(e){var num=92*5;var scrollH=0;switch(e.currentTarget){case this.xiangqing:ViewManager.ins().open(BookAttrWin);break;case this.resolve:ViewManager.ins().open(BreakDownView,BreakDownView.type_book,ItemType.TYPE_9);break;case this.getway:ViewManager.ins().open(BookWayTips,this.curId);break;case this.leftGroup:scrollH=this.listMenu.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.listMenu.scrollH=scrollH;this.onChange();break;case this.rightGroup:scrollH=this.listMenu.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.listMenu.contentWidth-this.listScroller.width){scrollH=this.listMenu.contentWidth-this.listScroller.width}this.listMenu.scrollH=scrollH;this.onChange();break}};BookWin.prototype.close=function(){this.removeTouchEvent(this.xiangqing,this.onTap);this.removeTouchEvent(this.resolve,this.onTap);this.removeTouchEvent(this.getway,this.onTap);this.removeTouchEvent(this.listMenu,this.onMenuTap);this.removeTouchEvent(this.leftGroup,this.onTap);this.removeTouchEvent(this.rightGroup,this.onTap);this.listBook.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBookTap,this);this.listMenu.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onMenuTap,this);this.listScroller.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this);this.removeObserve();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};BookWin.prototype.initView=function(){var config=GlobalConfig.BookListConfig;var conf=[];for(var k in config){conf.push(config[k])}conf.sort(function(a,b){if(a.sort<b.sort)return-1;else return 1});var data=new eui.ArrayCollection(conf);this.listMenu.dataProvider=data;this.updateBook();this.leftGroup.parent.touchEnabled=false;this.onChange()};BookWin.prototype.playEffect=function(){if(!BookRedPoint.ins().getRedPoint(1)){DisplayUtils.removeFromParent(this.chargeEff1)}else{if(!this.chargeEff1.parent){this.eff.addChild(this.chargeEff1)}this.chargeEff1.playFile(RES_DIR_EFF+"chargeff1",-1)}};BookWin.prototype.delayItemChange=function(){if(!TimerManager.ins().isExists(this.onItemChange,this))TimerManager.ins().doTimer(60,1,this.onItemChange,this)};BookWin.prototype.onItemChange=function(){this.updateBook();var g=this.listBook.parent;g.scrollV=this.preScrollV};BookWin.prototype.setStartPosition=function(idList){var g=this.listBook.parent;var scro=g.parent;scro.stopAnimation();var startPos=0;for(var i=0;i<idList.length;i++){if(this.getIsAct(idList[i])){if(i>9){startPos=Math.floor((i+1)/3)*this.itemHeight}break}}if(scro.height>=this.listBook.contentHeight)startPos=0;else{var maxHeight=this.listBook.contentHeight-scro.height*41/30;maxHeight=maxHeight>0?maxHeight:0;if(startPos>=maxHeight)startPos=maxHeight}g.scrollV=startPos;this.preScrollV=g.scrollV};BookWin.prototype.updateBook=function(noUpdateMenu){var _this=this;if(!this.curId)return;var conf=GlobalConfig.SuitConfig[this.curId][1];var dataPro=this.listBook.dataProvider;if(dataPro&&dataPro.source==conf.idList){dataPro.refresh()}else{this.listBook.dataProvider=new eui.ArrayCollection(conf.idList)}this.listBook.validateNow();this.setStartPosition(conf.idList);if(!noUpdateMenu){var dataProvider=this.listMenu.dataProvider;for(var i in dataProvider.source)dataProvider.itemUpdated(dataProvider.getItemAt(parseInt(i)))}this.updateAttr();this.playEffect();var power=Book.ins().getBookPowerNumEx();BitmapNumber.ins().changeNum(this.power,power,"8",5);if(this.focusId>=0){var moveToIndex=0;for(var i in conf.idList){if(conf.idList[i]==this.focusId){moveToIndex=parseInt(i);break}}var moveToRow_1=Math.floor(moveToIndex/3);var itemHeight=236;var listScale=.85;var realHeight_1=itemHeight*listScale;if(moveToRow_1>1){TimerManager.ins().doTimer(this.waitTime+50,1,function(){var g=_this.listBook.parent;moveToRow_1-=1;g.scrollV=moveToRow_1*realHeight_1;_this.preScrollV=g.scrollV},this)}this.focusId=-1}};BookWin.prototype.onBookTap=function(e){var id=this.listBook.selectedItem;var data=Book.ins().getBookById(id);if(!id||!data){return}var g=this.listBook.parent;this.preScrollV=g.scrollV;ViewManager.ins().open(BookUpWin,data)};BookWin.prototype.updateAttr=function(){var conf=GlobalConfig.SuitConfig[this.curId][1];var level=Book.ins().getSuitLevel(this.curId);var labelColor;if(level>0){conf=GlobalConfig.SuitConfig[this.curId][level];labelColor=this.greencolor}else{labelColor=this.graycolor}var title="";for(var k in GlobalConfig.BookListConfig){var config=GlobalConfig.BookListConfig[k];if(config.idList.indexOf(this.curId)!=-1){title=config.nameImg;break}}var curNum=Book.ins().getSuitNum(this.curId);var maxNum=conf.idList.length;this.progress.text=i18n("BookWin_2",curNum,maxNum);this.labelIcon.source=title;var str=AttributeData.getAttStr(conf.attrs,0,1,":");var arr=str.split("\n");var newStr=i18n("BookWin_3");for(var i=0;i<arr.length;i++){newStr+=arr[i]+"  "}this.attr.textFlow=TextFlowMaker.generateTextFlow1(i18n("BookWin_6",labelColor,newStr));this.expValue.text=Book.ins().score+""};BookWin.prototype.onMenuTap=function(e){var data=e.item;this.curId=data.idList[0];this.updateBook(true);this.updateAttr()};BookWin.prototype.getIsAct=function(id){var bookData=Book.ins().getBookById(id);var state=bookData.getState();return state==BookState.canOpen};BookWin.prototype.updateRedPoint=function(){this.leftRed.visible=BookRedPoint.ins().redpoint;this.rightRed.visible=BookRedPoint.ins().redpoint};return BookWin}(BaseComponent);__reflect(BookWin.prototype,"BookWin");var BreakDownView=function(_super){__extends(BreakDownView,_super);function BreakDownView(){var _this=_super.call(this)||this;_this._addExp=[];_this.skinName="BreakDownSkin";_this.isTopLevel=true;_this.listData=new eui.ArrayCollection;_this.equipList.itemRenderer=BreakDownItemRenderer;_this.equipList.dataProvider=_this.listData;_this.gainList.itemRenderer=GainGoodsItem;_this.goList=new eui.ArrayCollection;_this.gainList.dataProvider=_this.goList;return _this}BreakDownView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.observe(UserBag.ins().postItemDel,this.updateData);this.observe(UserBag.ins().postItemCountChange,this.updateData);this.observe(Book.ins().postDataChange,this.showExp);this.addTouchEvent(this,this.onTap);this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this);this._breakType=param[0]||0;this._ext=param[1];this.updateData()};BreakDownView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this,this.onTap);this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this);this.removeObserve()};Object.defineProperty(BreakDownView,"fitleEquip",{get:function(){if(!BreakDownView._fitleEquip){BreakDownView._fitleEquip={};for(var k in GlobalConfig.SpecialEquipsConfig){if(GlobalConfig.SpecialEquipsConfig[k].style==FitleStyle.fj)BreakDownView._fitleEquip[GlobalConfig.SpecialEquipsConfig[k].id]=GlobalConfig.SpecialEquipsConfig[k]}}return BreakDownView._fitleEquip},enumerable:true,configurable:true});BreakDownView.prototype.getLegendSource=function(){var itemData=[];if(this._ext==4){var totalItemData=UserBag.ins().getBagEquipsByQuality(4);for(var i=0;i<totalItemData.length;i++){if(!BreakDownView.fitleEquip[totalItemData[i].configID]){itemData.push(totalItemData[i])}}}else{itemData=UserBag.ins().getBagEquipsByQuality(5)}itemData.sort(function(n1,n2){var config1=GlobalConfig.ItemConfig[n1.configID];var config2=GlobalConfig.ItemConfig[n2.configID];if(config1.zsLevel>config2.zsLevel){return 1}if(config1.zsLevel<config2.zsLevel){return-1}if(config1.level>config2.level){return 1}if(config1.level<config2.level){return-1}return 0});return itemData};BreakDownView.prototype.getBookSource=function(){var itemData=UserBag.ins().getBagGoodsByType(this._ext);itemData.sort(function(n1,n2){var n1q=ItemConfig.getQuality(n1.itemConfig);var n2q=ItemConfig.getQuality(n2.itemConfig);if(n1q<n2q){return-1}else if(n1q>n2q){return 1}return n1.configID-n2.configID});var itemArr=[];var listBook=Book.ins().itemBook;var noActDic={};for(var itemId in listBook){for(var _i=0,_a=listBook[itemId];_i<_a.length;_i++){var item=_a[_i];if(item.getState()!=BookState.haveOpen){noActDic[itemId]=true;break}}}for(var _b=0,itemData_6=itemData;_b<itemData_6.length;_b++){var item=itemData_6[_b];if(noActDic[item.configID]){continue}var data=new ItemData;data.count=1;data.handle=item.handle;data.configID=item.configID;for(var i=0;i<item.count;i++){itemArr.push(data)}}return itemArr};BreakDownView.prototype.getLegendGoSource=function(){if(this.itemList){return this.itemList}var data1=new GainWay;data1[0]=i18n("BreakDownView_0");data1[1]=egret.getQualifiedClassName(TreasureHuntWin);data1[2]=0;var data2=new GainWay;data2[0]=i18n("BreakDownView_1");data2[1]=egret.getQualifiedClassName(BossWin);data2[2]=1;var data3=new GainWay;data3[0]=i18n("BreakDownView_2");data3[1]=egret.getQualifiedClassName(FbWin);data3[2]=2;var data4=new GainWay;data4[0]=i18n("BreakDownView_3");data4[1]=egret.getQualifiedClassName(TreasureHuntWin);data4[2]=0;var list=[[],[],[],[],[data1,data2],[data4]];this.itemList=list[this._ext];return this.itemList};BreakDownView.prototype.getBookGoSource=function(){return[]};BreakDownView.prototype.updateData=function(){var source,goList;this.title.text=i18n("BreakDownView_6");if(this._breakType==BreakDownView.type_legend){source=this.getLegendSource();goList=this.getLegendGoSource();this.title.text=i18n("BreakDownView_7")}else if(this._breakType==BreakDownView.type_book){source=this.getBookSource();goList=this.getBookGoSource()}this.listData.source=source;this.goList.source=goList;var dataNum=goList.length;this.refushPos(dataNum);this.noEquip.visible=source.length>0?false:true};BreakDownView.prototype.showExp=function(){var exp=this._addExp.pop();if(exp){}};BreakDownView.prototype.refushPos=function(len){this.contrain.height=60*len;this.equipScroller.height=310+60*(3-len)};BreakDownView.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;default:if(e.target instanceof eui.Button){switch(e.target.name){case"breakDown":this.onHandler(e.target.parent["data"]);break}}}};BreakDownView.prototype.onHandler=function(data){if(this._breakType==BreakDownView.type_legend){UserEquip.ins().sendSmeltEquip(1,[data])}else if(this._breakType==BreakDownView.type_book){var config=Book.ins().getDecomposeConfigByItemId(data.itemConfig.id);Book.ins().sendDecompose([[config.id,data.count]]);this._addExp.push(config.value)}};BreakDownView.prototype.onGo=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2]);ViewManager.ins().close(this)}};BreakDownView.type_legend=1;BreakDownView.type_book=2;return BreakDownView}(BaseEuiView);__reflect(BreakDownView.prototype,"BreakDownView");ViewManager.ins().reg(BreakDownView,LayerManager.UI_Popup);var AutoChallengeBoss=function(_super){__extends(AutoChallengeBoss,_super);function AutoChallengeBoss(){var _this=_super.call(this)||this;_this.observe(UserBoss.ins().postWorldBoss,_this.checkEnter);_this.observe(UserBoss.ins().postBossData,_this.delayCheckEnter);_this.observe(GameLogic.ins().postEnterMap,function(){if(GameMap.fubenID==0){_this.checkEnter()}});return _this}AutoChallengeBoss.ins=function(){return _super.ins.call(this)};AutoChallengeBoss.prototype.refBossTimeFun=function(){TimerManager.ins().remove(this.refTimes,this);this.refType=UserBoss.BOSS_SUBTYPE_QMBOSS;var time=UserBoss.ins().worldBossrestoreTime[this.refType];if(time>UserBoss.ins().worldBossrestoreTime[UserBoss.BOSS_SUBTYPE_SHENYU]){this.refType=UserBoss.BOSS_SUBTYPE_SHENYU;time=UserBoss.ins().worldBossrestoreTime[this.refType]}var t=time-egret.getTimer();if(t>0)TimerManager.ins().doTimer(t,1,this.refTimes,this)};AutoChallengeBoss.prototype.refTimes=function(){UserBoss.ins().sendWorldBossInfo(this.refType)};AutoChallengeBoss.prototype.delayCheckEnter=function(params){if(params[0]){TimerManager.ins().doTimer(1e3,2,this.checkEnter,this)}};AutoChallengeBoss.prototype.checkEnter=function(){var _this=this;clearTimeout(this._checkEnterTimer);this._checkEnterTimer=setTimeout(function(){console.log("checkEnter");if(!UserBoss.ins().worldInfoList||GameMap.fubenID!=0)return;var item;var lunhuiList=[];var ywList=[];var ywBoss=UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_QMBOSS];if(ywBoss&&_this.autoYewaiBoss&&(UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_QMBOSS]||_this.autoCostYewaiBoss&&(item=UserBag.ins().getBagItemById(ItemConst.PUBLICBOSS))&&item.count)){for(var _i=0,ywBoss_1=ywBoss;_i<ywBoss_1.length;_i++){var item_4=ywBoss_1[_i];var bossDp=GlobalConfig.WorldBossConfig[item_4.id];if(!UserBoss.isCanChallenge(bossDp))continue;bossDp.samsaraLv?lunhuiList.push(item_4):ywList.push(item_4)}}lunhuiList=lunhuiList.sort(_this.compareFn);for(var i=0;i<lunhuiList.length;i++){var item_5=lunhuiList[i];if(item_5.canChallenge&&UserBoss.ins().getBossRemindByIndex(item_5.id)){_this.enterFb(item_5.id,UserBoss.BOSS_SUBTYPE_QMBOSS);return}}if(UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_SHENYU]&&_this.autoShenyuBoss&&(UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_SHENYU]||_this.autoCostShenyuBoss&&(item=UserBag.ins().getBagItemById(ItemConst.SHENYUBOSS))&&item.count)){var syList=UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_SHENYU].slice();syList=syList.sort(_this.compareFn);for(var i=0;i<syList.length;i++){var item_6=syList[i];if(item_6.canChallenge&&UserBoss.ins().getBossRemindByIndex(item_6.id)){_this.enterFb(item_6.id,UserBoss.BOSS_SUBTYPE_SHENYU);return}}}ywList=ywList.sort(_this.compareFn);for(var i=0;i<ywList.length;i++){var item_7=ywList[i];if(item_7.canChallenge&&UserBoss.ins().getBossRemindByIndex(item_7.id)){_this.enterFb(item_7.id,UserBoss.BOSS_SUBTYPE_QMBOSS);return}}},100)};AutoChallengeBoss.prototype.enterFb=function(id,type){var cd=UserBoss.ins().worldBossCd[type]-egret.getTimer();if(cd>0){TimerManager.ins().doTimer(cd,1,this.checkEnter,this)}else{var item=void 0;UserBoss.ins().postBossData(false);if(type==UserBoss.BOSS_SUBTYPE_QMBOSS&&UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_QMBOSS]==0&&this.autoCostYewaiBoss&&(item=UserBag.ins().getBagItemById(ItemConst.PUBLICBOSS))&&item.count){item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,ItemConst.PUBLICBOSS);UserBag.ins().sendUseItem(item.configID,1)}else if(type==UserBoss.BOSS_SUBTYPE_SHENYU&&UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_SHENYU]==0&&this.autoShenyuBoss&&(item=UserBag.ins().getBagItemById(ItemConst.SHENYUBOSS))&&item.count){item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,ItemConst.SHENYUBOSS);UserBag.ins().sendUseItem(item.configID,1)}UserBoss.ins().sendChallengWorldBoss(id,type,1)}};AutoChallengeBoss.prototype.compareFn=function(a,b){var configA=GlobalConfig.WorldBossConfig[a.id];var configB=GlobalConfig.WorldBossConfig[b.id];if(configA.zsLevel<configB.zsLevel){return 1}else if(configA.zsLevel>configB.zsLevel){return-1}if(configA.level<configB.level)return 1;else if(configA.level>configB.level)return-1;else return 0};return AutoChallengeBoss}(BaseSystem);__reflect(AutoChallengeBoss.prototype,"AutoChallengeBoss");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.autoChallengeBoss=AutoChallengeBoss.ins.bind(AutoChallengeBoss)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var BossHomeSys=function(_super){__extends(BossHomeSys,_super);function BossHomeSys(){var _this=_super.call(this)||this;_this.canOpenBossInfoList=[];_this.roomingBossInfoList=[];_this.homeList=[];_this.exitCD=0;_this.sysId=PackageID.newBossHome;_this.regNetMsg(1,_this.postCanOpenBossData);_this.regNetMsg(2,_this.postRoomingBossData);_this.regNetMsg(3,_this.postCreateRoomsuccess);_this.regNetMsg(4,_this.postEnterRoomsuccess);_this.regNetMsg(5,_this.bossHomeSysInviteInfo);_this.regNetMsg(6,_this.postRebornTime);_this.regNetMsg(7,_this.postBossLose);_this.regNetMsg(8,_this.postRoomingChange);_this.regNetMsg(9,_this.postChallengeCd);return _this}BossHomeSys.prototype.initLogin=function(){this.init()};BossHomeSys.prototype.init=function(){this.sendCanOpenBossInfo(UserBoss.BOSS_SUBTYPE_HOMEBOSS);this.sendRoomingBossInfo(UserBoss.BOSS_SUBTYPE_HOMEBOSS)};BossHomeSys.ins=function(){return _super.ins.call(this)};BossHomeSys.prototype.postCanOpenBossData=function(bytes){this.bossType0=bytes.readByte();this.bossCD0=bytes.readShort();this.nowOpenTicketCount0=bytes.readInt();this.bosslistLength0=bytes.readShort();var infoList=[];infoList.length=this.bosslistLength0;for(var i=0;i<this.bosslistLength0;i++){var bossInfoData=infoList[i]||new BossHomeItemData;bossInfoData.parser(bytes);infoList[i]=bossInfoData}this.canOpenBossInfoList=infoList;this.bossRecoverTime0=bytes.readShort();this.bossChallengeTime0=bytes.readShort();this.bossBelongTime0=bytes.readShort()};BossHomeSys.prototype.postRoomingBossData=function(bytes){this.bosslistLength1=bytes.readShort();var infoList=[];infoList.length=this.bosslistLength1;for(var i=0;i<this.bosslistLength1;i++){var bossInfoData=infoList[i]||new BossHomeItemData;bossInfoData.parser1(bytes);infoList[i]=bossInfoData}this.roomingBossInfoList=infoList;this.joinRecoverTime=bytes.readShort()*1e3+egret.getTimer();this.nowjoinletfTime=bytes.readShort()};BossHomeSys.prototype.postCreateRoomsuccess=function(bytes){var openedRoomID=bytes.readInt();var openedRoomHost=bytes.readString();var openedBossID=bytes.readInt();var openederror=bytes.readInt();if(openederror==1){UserTips.ins().showTips(i18n("BossHomeSys_0"))}else if(openederror==2){UserTips.ins().showTips(i18n("BossHomeSys_5"))}else{this.sendBosshomeSysInvite(this.getDes(openedRoomHost,openedBossID)+i18n("BossHomeSys_10",openedRoomID,65280));EasyLoading.ins().showLoading(5);this.sendEnterRoom(openedRoomID)}};BossHomeSys.prototype.postEnterRoomsuccess=function(bytes){var errorMsg=bytes.readUnsignedByte();switch(errorMsg){case 0:this.nowChallengeBossID=bytes.readInt();var enterRoomID=bytes.readInt();this.hostName=bytes.readString();this.nowhomerelieveTime=bytes.readInt();break;case 3:UserTips.ins().showTips(i18n("BossHomeSys_1"));break;case 4:UserTips.ins().showTips(i18n("BossHomeSys_2"));break;case 5:UserTips.ins().showTips(i18n("BossHomeSys_3"));break;case 7:UserTips.ins().showTips(i18n("BossHomeSys_4"));break;case 8:UserTips.ins().showTips(i18n("BossHomeSys_6"));break}};BossHomeSys.prototype.bossHomeSysInviteInfo=function(bytes){Chat.ins().postSysChatMsg(new ChatSystemData(3,bytes.readString()))};BossHomeSys.prototype.postRebornTime=function(bytes){this.rebornCd=bytes.readShort();this.nowrebornCd=GameServer.serverTime/1e3+this.rebornCd;var killerHdl=bytes.readDouble()};BossHomeSys.prototype.postBossLose=function(bytes){var aid=bytes.readInt();ViewManager.ins().open(ResultWin,0)};BossHomeSys.prototype.postRoomingChange=function(bytes){this.bosslistLength1=bytes.readInt();this.homeList=[];for(var i=0;i<this.bosslistLength1;i++){var room_bossid=bytes.readInt();this.homeList.push(room_bossid)}};BossHomeSys.prototype.postChallengeCd=function(bytes){this.exitCD=bytes.readInt();this.postExitCD()};BossHomeSys.prototype.postExitCD=function(){};BossHomeSys.prototype.sendCanOpenBossInfo=function(bosstype){var bytes=this.getBytes(1);bytes.writeInt(bosstype);this.sendToServer(bytes)};BossHomeSys.prototype.sendRoomingBossInfo=function(bosstype){var bytes=this.getBytes(2);bytes.writeInt(bosstype);this.sendToServer(bytes)};BossHomeSys.prototype.sendCreateRoom=function(fbid){var bytes=this.getBytes(3);bytes.writeShort(fbid);this.sendToServer(bytes)};BossHomeSys.prototype.sendEnterRoom=function(roomid){var bytes=this.getBytes(4);bytes.writeInt(roomid);this.sendToServer(bytes)};BossHomeSys.prototype.sendBosshomeSysInvite=function(des){var bytes=this.getBytes(5);bytes.writeString(des);this.sendToServer(bytes)};BossHomeSys.prototype.getDes=function(name,bossid){var nameStr=i18n("BossHomeSys_9",2933499,name);var config=GlobalConfig.WorldBossConfig[bossid];var bossConfig=GlobalConfig.MonstersConfig[config.bossId];return nameStr+i18n("BossHomeSys_7")+i18n("BossHomeSys_12")+bossConfig.name+i18n("BossHomeSys_8")};BossHomeSys.prototype.openBossHomeMainWin=function(){if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS){UserTips.ins().showTips(i18n("BossHomeSys_11"));return}ViewManager.ins().open(BossWin,5,1)};BossHomeSys.prototype.isHasCanChanellageRoom=function(){var canChallenge=false;if(this.homeList.length<=0)return false;else{for(var _i=0,_a=this.homeList;_i<_a.length;_i++){var room_bossid=_a[_i];var config=GlobalConfig.WorldBossConfig[room_bossid];if(config.zsLevel>0){canChallenge=UserZs.ins().lv>=config.zsLevel}else{canChallenge=Actor.level>=config.level}if(canChallenge){return true}}return false}};return BossHomeSys}(BaseSystem);__reflect(BossHomeSys.prototype,"BossHomeSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.bossHomeSys=BossHomeSys.ins.bind(BossHomeSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var DarkMjBoss=function(_super){__extends(DarkMjBoss,_super);function DarkMjBoss(){var _this=_super.call(this)||this;_this.isDarkBoss=false;_this.isBossDie=false;_this.observe(GameLogic.ins().postEnterMap,function(){if(GameMap.fbType==UserFb.FB_TYPE_DARK_BOSS){_this.postEnterGwBoss()}else if(_this.isDarkBoss){_this.postEscGwBoss()}_this.checkIsShowBtn()});_this.observe(GameLogic.ins().postCreateOtherEntity,_this.onCreateEntity);_this.observe(UserBoss.ins().postRemainTime,_this.onDie);_this.observe(UserBoss.ins().postWorldBossEndTime,_this.onBossDisappear);_this.observe(UserBoss.ins().postBaseHideBossInfo,_this.onHideBossAppear);return _this}DarkMjBoss.prototype.postEnterGwBoss=function(){this.isDarkBoss=GameMap.fbType==UserFb.FB_TYPE_DARK_BOSS;this.isBossDie=false;this.showView(true)};DarkMjBoss.prototype.postEscGwBoss=function(){this.isDarkBoss=false;this.isBossDie=false;this.showView(false);ViewManager.ins().close(BossEndView)};DarkMjBoss.prototype.showView=function(show){if(show){if(!ViewManager.ins().isShow(BossBelongPanel)){ViewManager.ins().open(BossBelongPanel)}if(!ViewManager.ins().isShow(BossBloodPanel)){ViewManager.ins().open(BossBloodPanel)}if(!ViewManager.ins().isShow(TargetListPanel)){ViewManager.ins().open(TargetListPanel)}}else{ViewManager.ins().close(BossBelongPanel);ViewManager.ins().close(BossBloodPanel);ViewManager.ins().close(TargetListPanel)}};DarkMjBoss.prototype.onCreateEntity=function(model){if(!model)return;if(this.isDarkBoss){if(model.type==EntityType.Monster&&model.team==Team.Monster&&!model.masterHandle){UserBoss.ins().monsterID=model.configID;UserBoss.ins().bossHandler=model.handle;this.showView(true)}}};DarkMjBoss.prototype.onDie=function(){if(this.isDarkBoss){if(this.isRoleDie()){ViewManager.ins().open(WorldBossBeKillWin)}else{ViewManager.ins().close(WorldBossBeKillWin)}}};DarkMjBoss.prototype.isRoleDie=function(){if(UserBoss.ins().reliveTime>0){return true}else{return false}};DarkMjBoss.prototype.onBossDisappear=function(){if(this.isDarkBoss){this.showView(false);this.isBossDie=true;ViewManager.ins().open(BossEndView)}};DarkMjBoss.prototype.checkIsShowBtn=function(){if(this.checkCanShow()&&GameMap.sceneInMain()){if(!ViewManager.ins().isShow(HideBossBtnWin))ViewManager.ins().open(HideBossBtnWin)}else{ViewManager.ins().close(HideBossBtnWin)}};DarkMjBoss.prototype.checkCanShow=function(){var endTime=UserBoss.ins().hideBossData.endTime;return UserBoss.ins().hideBossData.id&&endTime&&DateUtils.formatMiniDateTime(endTime)>GameServer.serverTime};DarkMjBoss.prototype.onHideBossAppear=function(){var _this=this;if(this.checkCanShow()){if(this.isDarkBoss){var entity=EntityManager.ins().getEntityByHandle(UserBoss.ins().bossHandler);if(entity&&entity.parent){var mc_7=ObjectPool.pop("MovieClip");var callFunc_1=function(){if(!ViewManager.ins().isShow(HideBossBtnWin))ViewManager.ins().open(HideBossBtnWin,1);mc_7.removeEventListener(egret.Event.REMOVED_FROM_STAGE,callFunc_1,_this);mc_7.destroy()};mc_7.playFile(RES_DIR_EFF+"luckyboss_dragon_up",1,function(){callFunc_1()});mc_7.x=entity.x;mc_7.y=entity.y;mc_7.addEventListener(egret.Event.REMOVED_FROM_STAGE,callFunc_1,this);entity.parent.addChild(mc_7)}else{ViewManager.ins().open(HideBossBtnWin,1)}}else{ViewManager.ins().open(HideBossBtnWin)}}else{ViewManager.ins().close(HideBossBtnWin)}};DarkMjBoss.prototype.canMove=function(){return!this.isBossDie};DarkMjBoss.ins=function(){return _super.ins.call(this)};return DarkMjBoss}(BaseSystem);__reflect(DarkMjBoss.prototype,"DarkMjBoss");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.darkMjBoss=DarkMjBoss.ins.bind(DarkMjBoss)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GwBoss=function(_super){__extends(GwBoss,_super);function GwBoss(){var _this=_super.call(this)||this;_this.isGwBoss=false;_this.isGwTopBoss=false;_this.isBossDie=false;_this.observe(GameLogic.ins().postEnterMap,function(){if(GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON||GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON_TOP){_this.postEnterGwBoss()}else if(_this.isGwBoss||_this.isGwTopBoss){_this.postEscGwBoss()}});_this.observe(GameLogic.ins().postCreateOtherEntity,_this.onCreateEntity);_this.observe(UserBoss.ins().postRemainTime,_this.onDie);_this.observe(UserBoss.ins().postWorldBossEndTime,_this.onBossDisappear);return _this}GwBoss.prototype.postEnterGwBoss=function(){this.isGwBoss=GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON;this.isGwTopBoss=GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON_TOP;this.isBossDie=false;this.showView(true)};GwBoss.prototype.postEscGwBoss=function(){this.isGwBoss=false;this.isGwTopBoss=false;this.isBossDie=false;this.showView(false);ViewManager.ins().close(BossEndView)};GwBoss.prototype.showView=function(show){if(show){if(!ViewManager.ins().isShow(BossBelongPanel)){ViewManager.ins().open(BossBelongPanel)}if(!ViewManager.ins().isShow(BossBloodPanel)){ViewManager.ins().open(BossBloodPanel)}if(!ViewManager.ins().isShow(TargetListPanel)){ViewManager.ins().open(TargetListPanel)}}else{ViewManager.ins().close(BossBelongPanel);ViewManager.ins().close(BossBloodPanel);ViewManager.ins().close(TargetListPanel)}};GwBoss.prototype.onCreateEntity=function(model){if(!model)return;if(this.isGwBoss||this.isGwTopBoss){if(model.type==EntityType.Monster&&model.team==Team.Monster&&!model.masterHandle){UserBoss.ins().monsterID=model.configID;UserBoss.ins().bossHandler=model.handle;this.showView(true)}}};GwBoss.prototype.onDie=function(){if(this.isGwBoss||this.isGwTopBoss){if(this.isRoleDie()){ViewManager.ins().open(WorldBossBeKillWin)}else{ViewManager.ins().close(WorldBossBeKillWin)}}};GwBoss.prototype.isRoleDie=function(){var isDie=false;if(this.isGwTopBoss){var role=EntityManager.ins().getNoDieRole();if(!role||role.infoModel.getAtt(AttributeType.atHp)<=0){isDie=true}}if(UserBoss.ins().reliveTime>0||isDie){return true}else{return false}};GwBoss.prototype.onBossDisappear=function(){if(this.isGwBoss||this.isGwTopBoss){this.showView(false);this.isBossDie=true;ViewManager.ins().open(BossEndView)}};GwBoss.prototype.canMove=function(){return!this.isBossDie};GwBoss.ins=function(){return _super.ins.call(this)};return GwBoss}(BaseSystem);__reflect(GwBoss.prototype,"GwBoss");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.gwboss=GwBoss.ins.bind(GwBoss)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UserBoss=function(_super){__extends(UserBoss,_super);function UserBoss(){var _this=_super.call(this)||this;_this.worldBossLeftTime=[];_this.worldChallengeTime=[];_this.worldBossCd=[];_this.worldBossLastWinner=[];_this.worldBossrestoreTime=[];_this.worldBossBelongTime=[];_this.curShield=0;_this.totalShield=0;_this.shieldType=0;_this.worldInfoList=[];_this.worldBossPlayList=[];_this.rankList=[];_this.monsterID=0;_this.hp=0;_this.bossHandler=0;_this.lastBossID=-1;_this.rank=[];_this.changeAttr=[];_this.isShowWarn=false;_this.challengeCount=0;_this.restoreTime=0;_this.toDaySoul=0;_this.cdTime=0;_this.bossRemind=0;_this.bossInfo=[];_this.isDoingTimer=false;_this.autoClear=[false,false,false];_this.ShowTip=true;_this.currBossSubType=0;_this.currBossConfigID=0;_this.newWorldBossData=new NewWorldBossData;_this.hideBossData={id:0,endTime:0,lastId:0};_this.worldPrize=0;_this._reliveTime=0;_this.killerHandler=0;_this.winner="";_this.bossAlertList=[];_this.publicBossIdDic=[];_this.weixieList=[];_this.canPlayList=[];_this.belongName="";_this.attHandle=0;_this.canClick=true;_this.sysId=PackageID.Boss;_this.regNetMsg(10,_this.postWorldBoss);_this.regNetMsg(11,_this.setShieldPer);_this.regNetMsg(14,_this.doClearCD);_this.regNetMsg(16,_this.postLottery);_this.regNetMsg(17,_this.doLotteryRan);_this.regNetMsg(18,_this.doLotteryResult);_this.regNetMsg(20,_this.doBossBlood);_this.regNetMsg(21,_this.postUpdatePerInfo);_this.regNetMsg(7,_this.doBelongChange);_this.regNetMsg(23,_this.postAttackList);_this.regNetMsg(24,_this.doKillNotice);_this.regNetMsg(25,_this.postRemainTime);_this.regNetMsg(26,_this.postWorldBossEndTime);_this.regNetMsg(27,_this.postWorldNotice);_this.regNetMsg(28,_this.postChallageRank);_this.regNetMsg(29,_this.doBossChallengeResult);_this.regNetMsg(30,_this.doBossSetting);_this.regNetMsg(31,_this.postNewBossResult);_this.regNetMsg(32,_this.postNewBossInfo);_this.regNetMsg(33,_this.postNewBossReliveTime);_this.regNetMsg(34,_this.postNewBossOpen);_this.regNetMsg(35,_this.postAddAttrNum);_this.regNetMsg(36,_this.postNewBossRank);_this.regNetMsg(37,_this.postBossDieNotice);_this.regNetMsg(38,_this.postBaseHideBossInfo);_this.observe(GameLogic.ins().postEnterMap,_this.checkShow);_this.observe(GameLogic.ins().postHpChange,_this.checkOpenBossBlood);_this.observe(GameLogic.ins().postRemoveEntity,_this.checkRemoveEntity);_this.observe(UserZs.ins().postZsLv,_this.postUpdateWorldPlayList);_this.observe(Actor.ins().postLevelChange,_this.postUpdateWorldPlayList);return _this}UserBoss.ins=function(){return _super.ins.call(this)};UserBoss.prototype.initLogin=function(){this.init()};UserBoss.prototype.checkOpenBossBlood=function(_a){var target=_a[0],value=_a[1];var monsterID=target.infoModel.configID;if(!monsterID||monsterID!=this.monsterID)return;if(GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS)return;if(GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS)return;if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS)return;if(GameMap.fbType==UserFb.FB_TYPE_LABA)return;if(GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS)return;this.hp=value;value>0?ViewManager.ins().open(BossBloodPanel):ViewManager.ins().close(BossBloodPanel)};UserBoss.prototype.postListData=function(){};UserBoss.prototype.postHpChange=function(){};UserBoss.prototype.postBossData=function(isShow,name){if(name===void 0){name=""}return[isShow,name]};UserBoss.prototype.sendWorldBossInfo=function(id){var bytes=this.getBytes(10);bytes.writeInt(id);this.sendToServer(bytes)};UserBoss.prototype.postWorldBoss=function(bytes){var type=bytes.readByte();var infoList=this.worldInfoList[type]=this.worldInfoList[type]||[];this.worldBossPlayList[type]=[];this.worldBossrestoreTime[type]=[];this.worldBossCd[type]=bytes.readShort()*1e3+egret.getTimer();this.worldBossLeftTime[type]=bytes.readShort();var count=bytes.readShort();infoList.length=count;for(var i=0;i<count;i++){var bossInfoData=infoList[i]||new WorldBossItemData;bossInfoData.parser(bytes);infoList[i]=bossInfoData}this.worldBossrestoreTime[type]=bytes.readShort()*1e3+egret.getTimer();this.worldChallengeTime[type]=bytes.readShort();this.worldBossBelongTime[type]=bytes.readShort();this.updateBossPlayList(type);if(type==UserBoss.BOSS_SUBTYPE_QMBOSS||type==UserBoss.BOSS_SUBTYPE_SHENYU){AutoChallengeBoss.ins().refBossTimeFun()}return type};UserBoss.prototype.updateBossPlayList=function(type){var tempArr=UserBoss.ins().worldInfoList[type].slice();var bossList=this.worldBossPlayList[type];for(var k in tempArr){var bossConfig=GlobalConfig.WorldBossConfig[tempArr[k].id];if(!bossConfig)continue;if(type==UserBoss.BOSS_SUBTYPE_QMBOSS){if(UserZs.ins().lv>=bossConfig.zsLevel&&Actor.level>=bossConfig.level){bossList.push(tempArr[k])}}else if(type==UserBoss.BOSS_SUBTYPE_WORLDBOSS){if(bossConfig.zslook&&bossConfig.zslook.length>0){var lowLvl=bossConfig.zslook[0];var hightLvl=bossConfig.zslook[bossConfig.zslook.length-1];if(UserZs.ins().lv>=lowLvl&&UserZs.ins().lv<=hightLvl&&Actor.level>=bossConfig.level){bossList.push(tempArr[k])}}}else if(type==UserBoss.BOSS_SUBTYPE_SHENYU){if(UserZs.ins().lv>=bossConfig.zsLevel&&Actor.level>=bossConfig.level){bossList.push(tempArr[k])}}else if(type==UserBoss.BOSS_SUBTYPE_GODWEAPON||type==UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP){if(tempArr[k].canInto)bossList.push(tempArr[k])}else if(type==UserBoss.BOSS_SUBTYPE_DARKBOSS){if(tempArr[k].canInto)bossList.push(tempArr[k])}}};UserBoss.prototype.postUpdateWorldPlayList=function(){for(var t in this.worldInfoList){var _type=+t;this.worldBossPlayList[_type]=[];this.updateBossPlayList(_type)}};UserBoss.prototype.setShieldPer=function(bytes){this.shieldType=bytes.readByte();this.curShield=bytes.readInt();this.totalShield=bytes.readInt();var boo=bytes.readByte();var showNotice=this.curShield==this.totalShield;if(showNotice){var str="";if(boo){str=i18n("UserBoss_0");UserTips.ins().showSceneTips(str)}else{str=i18n("UserBoss_1");UserTips.ins().showSceneTips(str)}}this.postShieldPer()};UserBoss.prototype.postShieldPer=function(){};UserBoss.prototype.sendClearCD=function(){if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){UserFb.ins().sendGuideFbAlive()}else if(GameMap.fbType==UserFb.FB_TYPE_CITY)CityCC.ins().sendRevival();else if(GameMap.fubenID==GlobalConfig.CampBattleConfig.fbId)BattleCC.ins().sendReLive();else if(GameMap.fubenID==GlobalConfig.PassionPointConfig.fbId){PaoDianCC.ins().sendReLive()}else if(GameMap.fubenID==GlobalConfig.BattleGroundConfig.fbId){BattleGround.ins().sendReLive()}else if(GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS){this.sendNewBossBuyRelive()}else{this.sendToServer(this.getBytes(14))}};UserBoss.prototype.doClearCD=function(bytes){UserTips.ins().showTips(bytes.readByte()?i18n("UserBoss_2"):i18n("UserBoss_3"))};UserBoss.prototype.sendChallengWorldBoss=function(id,type,auto){this.currBossSubType=type;this.currBossConfigID=id;var bytes=this.getBytes(15);bytes.writeInt(id);bytes.writeByte(auto||0);this.sendToServer(bytes)};UserBoss.prototype.postLottery=function(bytes){this.worldPrize=bytes.readInt();ViewManager.ins().open(WorldBossJiangLiWin)};UserBoss.prototype.sendJoinLottery=function(){this.sendBaseProto(17)};UserBoss.prototype.doLotteryRan=function(bytes){var ran=bytes.readShort();this.postLotteryRan(ran)};UserBoss.prototype.postLotteryRan=function(n){return n};UserBoss.prototype.sendChallengRank=function(id){this.currBossSubType=id;var bytes=this.getBytes(28);bytes.writeInt(id);this.sendToServer(bytes)};UserBoss.prototype.doLotteryResult=function(bytes){var name=bytes.readString();var ranPoint=bytes.readShort();this.postLotteryResult(name,ranPoint)};UserBoss.prototype.postLotteryResult=function(str,n){return[str,n]};UserBoss.prototype.doBossBlood=function(bytes){this.monsterID=bytes.readInt();this.hp=bytes.readDouble();if(this.hp&&this.monsterID!=this.lastBossID){if(GameMap.fbType!=UserFb.FB_TYPE_MATERIAL&&GameMap.fbType!=UserFb.FB_TYPE_TIAOZHAN&&GameMap.fbType!=UserFb.FB_TYPE_EXP&&GameMap.fbType!=UserFb.FB_TYPE_GUIDEBOSS){this.postBossAppear()}}this.lastBossID=this.monsterID;if(this.hp<=0){this.lastBossID=-1}this.bossHandler=bytes.readDouble();var handler=bytes.readDouble();var count=bytes.readShort();this.rank.length=count;for(var i=0;i<count;i++){this.rank[i]=this.rank[i]||new WorldBossRankItemData;this.rank[i].parser(bytes);this.rank[i].rank=i+1}this.postHpChange();if(GameMap.fbType!=UserFb.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=UserFb.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=UserFb.FB_TYPE_HOMEBOSS&&GameMap.fbType!=UserFb.FB_TYPE_LABA&&GameMap.fbType!=UserFb.FB_TYPE_NEW_WORLD_BOSS){ViewManager.ins().open(BossBloodPanel)}if(!this.hp||this.hp<=0&&GuildWar.ins().getModel().checkinAppoint(1)){ViewManager.ins().close(BossBloodPanel)}};UserBoss.prototype.postBossAppear=function(){return this.monsterID};UserBoss.prototype.postBossDisappear=function(entity){this.bossHandler=0;return entity};UserBoss.prototype.postUpdatePerInfo=function(bytes){this.worldBossCd[this.currBossSubType]=bytes.readShort()*1e3+egret.getTimer();this.worldBossLeftTime[this.currBossSubType]=bytes.readShort();return[this.worldBossCd,this.worldBossLeftTime]};UserBoss.prototype.doBelongChange=function(bytes){var handle=bytes.readDouble();var oldHandle=bytes.readDouble();var oldName=bytes.readString();this.postBelongChange(handle,oldHandle,oldName)};UserBoss.prototype.postBelongChange=function(handle,oldHandle,oldName){if(oldHandle===void 0){oldHandle=0}if(oldName===void 0){oldName=""}UserBoss.ins().changecanPlayList(handle);this.attHandle=handle;EntityShowMgr.ins().showHideSomeOne(handle);if(handle>0){var belongHandel=EntityManager.ins().getMasterList(handle);var belongName="";if(belongHandel&&belongHandel[0]&&belongHandel[0].infoModel){belongName=belongHandel[0].infoModel.name;this.setBelongHPandColor()}else{return}var str="";if(handle>0&&oldHandle>0){var btname=belongName;var strlist=btname.split("\n");if(strlist[1])btname=strlist[1];else btname=strlist[0];var tname=oldName;strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];tname=StringUtils.replaceStr(tname,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+"");str=i18n("UserBoss_4",ColorUtil.ROLENAME_COLOR_GREEN,btname,ColorUtil.ROLENAME_COLOR_GREEN,tname);UserTips.ins().showSceneTips(str)}else{if(handle>0&&belongName!=""){}}}};UserBoss.prototype.postAttackList=function(bytes){var count=bytes.readUnsignedInt();this.weixieList=[];for(var i=0;i<count;i++){var handle=bytes.readDouble();var masterHandle=EntityManager.ins().getRootMasterHandle(handle);UserBoss.ins().changeWeiXieList(masterHandle)}this.postHasAttackChange(0)};UserBoss.prototype.doKillNotice=function(bytes){var name=bytes.readString();var killNum=bytes.readShort();var ID=bytes.readShort();var str=GlobalConfig.WorldBossKillMsgConfig[ID].msg;str=StringUtils.substitute(str,name,killNum);UserTips.ins().showSceneTips(str)};UserBoss.prototype.postRemainTime=function(bytes){this.reliveTime=bytes.readShort();this.killerHandler=bytes.readDouble();if(this.reliveTime>0){this.clearWorldBossList()}};UserBoss.prototype.setBelongHPandColor=function(){if(this.attHandle!=Actor.handle){var belongHandel=EntityManager.ins().getMasterList(this.attHandle);for(var k in belongHandel){if(!(belongHandel[k]instanceof CharRole))continue;belongHandel[k].setNameTxtColor(ColorUtil.ROLENAME_COLOR_YELLOW)}}};UserBoss.prototype.postWorldBossEndTime=function(bytes){this.winner=bytes.readString();var remainTime=6e4;if(GwBoss.ins().isGwBoss)remainTime=3e4;this.worldBossEndTime=egret.getTimer()+remainTime;this.clearWorldBossList()};UserBoss.prototype.postWorldNotice=function(bytes){var type=bytes.readByte();var id=bytes.readInt();var lv=Actor.level;var zslv=UserZs.ins().lv;if(type==UserBoss.BOSS_SUBTYPE_QMBOSS){var tempArr=UserBoss.ins().worldInfoList[type];for(var k in tempArr){var config=GlobalConfig.WorldBossConfig[id];if(tempArr[k].id==id&&this.getBossRemindByIndex(id)&&zslv>=config.zsLevel&&lv>=config.level){var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];tempArr[k].hp=100;tempArr[k].bossState=1;var playList=this.worldBossPlayList[type];for(var j in playList){if(playList[j]&&playList[j].id==id){playList[j].hp=100;playList[j].bossState=1;break}}var str=i18n("UserBoss_7",bossBaseConfig.name);Chat.ins().postSysChatMsg(new ChatSystemData(3,str));if(UserBoss.ins().worldBossLeftTime[type]){this.postBossData(true,bossBaseConfig.name)}break}}}else if(type==UserBoss.BOSS_SUBTYPE_HOMEBOSS){}else if(type==UserBoss.BOSS_SUBTYPE_SHENYU){var tempArr=UserBoss.ins().worldInfoList[type];for(var k in tempArr){var config=GlobalConfig.WorldBossConfig[id];if(tempArr[k].id==id&&this.getBossRemindByIndex(id)&&zslv>=config.zsLevel&&lv>=config.level){var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];tempArr[k].hp=100;tempArr[k].bossState=1;var playList=this.worldBossPlayList[type];for(var j in playList){if(playList[j]&&playList[j].id==id){playList[j].hp=100;playList[j].bossState=1;break}}var str=i18n("UserBoss_10",bossBaseConfig.name);Chat.ins().postSysChatMsg(new ChatSystemData(3,str));if(UserBoss.ins().worldBossLeftTime[type]){this.postBossData(true,bossBaseConfig.name)}break}}}else if(type==UserBoss.BOSS_SUBTYPE_GODWEAPON||type==UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP){var tempArr=UserBoss.ins().worldInfoList[type];for(var k in tempArr){var config=GlobalConfig.WorldBossConfig[id];if(tempArr[k].id==id){var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];tempArr[k].hp=100;tempArr[k].bossState=1;var playList=this.worldBossPlayList[type];for(var j in playList){if(playList[j]&&playList[j].id==id){playList[j].hp=100;playList[j].bossState=1;break}}break}}}else if(type==UserBoss.BOSS_SUBTYPE_DARKBOSS){var tempArr=UserBoss.ins().worldInfoList[type];for(var k in tempArr){var config=GlobalConfig.WorldBossConfig[id];if(tempArr[k].id==id){var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];tempArr[k].hp=100;tempArr[k].bossState=1;var playList=this.worldBossPlayList[type];for(var j in playList){if(playList[j]&&playList[j].id==id){playList[j].hp=100;playList[j].bossState=1;break}}if(tempArr[k].canInto){var str=i18n("UserBoss_11",bossBaseConfig.name);Chat.ins().postSysChatMsg(new ChatSystemData(3,str));if(UserBoss.ins().worldBossLeftTime[type]){this.postBossData(true,bossBaseConfig.name)}}break}}}};UserBoss.prototype.postChallageRank=function(bytes){var id=bytes.readInt();var count=bytes.readByte();var datas=[];var tNum;for(var i=0;i<count;i++){datas[i]=[];tNum=bytes.readInt();datas[i][0]=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(tNum)/1e3,6);datas[i][1]=bytes.readString();datas[i][2]=bytes.readDouble().toString();datas[i][3]=1+""}datas.reverse();return[id,datas]};UserBoss.prototype.doBossChallengeResult=function(bytes){var isBelong=bytes.readByte();var belongName=bytes.readString();var job=bytes.readByte()||1;var sex=bytes.readByte();var count=bytes.readShort();var myReward=[];for(var i=0;i<count;i++){myReward[i]=new RewardData;myReward[i].parser(bytes)}var belongImg="yuanhead"+job+sex;ResultManager.ins().create(GameMap.fbType,true,myReward,"",null,[isBelong,belongName,belongImg])};UserBoss.prototype.setBossSetting=function(id){var index=this.bossAlertList.indexOf(id);if(index!=-1){this.bossAlertList.splice(index,1)}else{this.bossAlertList.push(id)}};UserBoss.prototype.sendBossSetting=function(){var len=this.bossAlertList?this.bossAlertList.length:0;var bytes=this.getBytes(29);bytes.writeShort(len);for(var i=0;i<len;i++){bytes.writeShort(this.bossAlertList[i])}this.sendToServer(bytes)};UserBoss.prototype.doBossSetting=function(bytes){this.bossAlertList=[];var count=bytes.readShort();for(var i=0;i<count;i++){var id=bytes.readShort();this.bossAlertList.push(id)}};UserBoss.prototype.checkNewWorldBossOpen=function(){return Actor.level>=GlobalConfig.NewWorldBossBaseConfig.openLv};UserBoss.prototype.sendIntoNewBoss=function(){this.sendBaseProto(31)};UserBoss.prototype.postNewBossResult=function(bytes){this.newWorldBossData.isKill=!!bytes.readByte();this.newWorldBossData.rank=bytes.readInt();this.newWorldBossData.lastKillRoleName=bytes.readString();this.newWorldBossData.randomRoleName=bytes.readString();this.newWorldBossData.totalTime=bytes.readInt();this.newWorldBossData.randomAwards=[];var len=bytes.readShort();for(var i=0;i<len;i++){this.newWorldBossData.randomAwards[i]=new RewardData;this.newWorldBossData.randomAwards[i].parser(bytes)}ResultManager.ins().create(GameMap.fbType,1)};UserBoss.prototype.sendGetNewBossInfo=function(){this.sendBaseProto(32)};UserBoss.prototype.postNewBossInfo=function(bytes){this.newWorldBossData.bossID=bytes.readInt();this.newWorldBossData.curHp=bytes.readDouble()};UserBoss.prototype.sendNewBossBuyRelive=function(){this.sendBaseProto(33)};UserBoss.prototype.postNewBossReliveTime=function(bytes){this.reliveTime=bytes.readShort()};UserBoss.prototype.postNewBossOpen=function(bytes){this.newWorldBossData.isOpen=!!bytes.readByte();this.newWorldBossData.startTime=bytes.readInt();if(this.newWorldBossData.startTime){this.newWorldBossData.startTime=DateUtils.formatMiniDateTime(this.newWorldBossData.startTime)}};UserBoss.prototype.postAddAttrNum=function(bytes){this.newWorldBossData.addAttrNum=bytes.readShort()};UserBoss.prototype.postNewBossRank=function(bytes){var len=bytes.readShort();if(this.newWorldBossData.rankList==null){this.newWorldBossData.rankList=[]}this.newWorldBossData.rankList.length=len;for(var i=0;i<len;i++){this.newWorldBossData.rankList[i]=this.newWorldBossData.rankList[i]||new NewWorldBossRankData;this.newWorldBossData.rankList[i].parser(bytes)}this.newWorldBossData.rankList.sort(this.sortNewBossRank)};UserBoss.prototype.sortNewBossRank=function(a,b){if(a.value>b.value)return-1;return 1};UserBoss.prototype.postBossDieNotice=function(bytes){var bossId=bytes.readInt();var allStand=bytes.readByte();if(allStand){var entities=EntityManager.ins().getAllEntity();for(var k in entities){var v=entities[k];if(v._state==EntityAction.ATTACK){v.playAction(EntityAction.STAND)}}}var config=GlobalConfig.WorldBossConfig[bossId];if(!config)return;switch(config.type){case UserBoss.BOSS_SUBTYPE_WORLDBOSS:case UserBoss.BOSS_SUBTYPE_QMBOSS:case UserBoss.BOSS_SUBTYPE_DARKBOSS:case UserBoss.BOSS_SUBTYPE_GODWEAPON:case UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP:var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];UserBoss.ins().postBossData(false,bossBaseConfig.name);this.sendWorldBossInfo(config.type);break;case UserBoss.BOSS_SUBTYPE_HOMEBOSS:UserBoss.ins().postBossData(false,i18n("UserBoss_12"));this.sendWorldBossInfo(config.type);break}};UserBoss.prototype.sendBuyChallengeTimes=function(type){var bytes=this.getBytes(30);bytes.writeByte(type);this.sendToServer(bytes)};UserBoss.prototype.sendBuyAddAttrNum=function(){this.sendBaseProto(34)};UserBoss.prototype.getBossRemindByIndex=function(id){return this.bossAlertList.indexOf(id)!=-1};UserBoss.prototype.sendCleanBelong=function(){this.sendBaseProto(35)};UserBoss.prototype.sendChallengeHideBoss=function(){this.sendBaseProto(36)};UserBoss.prototype.postBaseHideBossInfo=function(bytes){var id=bytes.readInt();var time=bytes.readInt();this.hideBossData.id=id;this.hideBossData.endTime=time};UserBoss.prototype.checkWorldBossMoney=function(){return Actor.yb>=this.checkWorldBossNeed()};UserBoss.prototype.checkWorldBossNeed=function(){if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){return GlobalConfig.LeadFubenBaseConfig.BuyRebornCost}else if(GameMap.fbType==UserFb.FB_TYPE_CITY){return GlobalConfig.CityBaseConfig.BuyRebornCost}else if(GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS){return GlobalConfig.NewWorldBossBaseConfig.clearCdCost}else if(GameMap.fubenID==GlobalConfig.CampBattleConfig.fbId)return GlobalConfig.CampBattleConfig.buyRebornCdCost;else if(GameMap.fubenID==GlobalConfig.PassionPointConfig.fbId)return GlobalConfig.PassionPointConfig.buyRebornCdCost;else if(GameMap.fubenID==GlobalConfig.BattleGroundConfig.fbId)return GlobalConfig.BattleGroundConfig.buyRebornCdCost;else if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS)return GlobalConfig.WorldBossBaseConfig.clearCdCost[UserBoss.BOSS_SUBTYPE_HOMEBOSS-1];return GlobalConfig.WorldBossBaseConfig.clearCdCost[this.currBossSubType-1]};UserBoss.prototype.checkisAutoRelive=function(){if(this.reliveTime>0){if(this.autoClear[this.currBossSubType]){if(this.checkWorldBossMoney()){this.sendClearCD();return false}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("UserBoss_14"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("UserBoss_15"))}this.autoClear[this.currBossSubType]=false}}return true}return false};Object.defineProperty(UserBoss.prototype,"reliveTime",{get:function(){return this._reliveTime},set:function(num){if(this._reliveTime!=num){this._reliveTime=num;TimerManager.ins().remove(this.timeClock,this);TimerManager.ins().doTimer(1e3,this._reliveTime,this.timeClock,this)}},enumerable:true,configurable:true});UserBoss.prototype.timeClock=function(){this._reliveTime--;if(this._reliveTime<=0){TimerManager.ins().remove(this.timeClock,this)}};UserBoss.prototype.parser=function(bytes){this.challengeCount=bytes.readShort();this.restoreTime=bytes.readShort()*1e3+egret.getTimer();this.toDaySoul=bytes.readInt();this.cdTime=bytes.readShort()*1e3+egret.getTimer();this.bossRemind=bytes.readInt();if(!this.hp||this.hp<=0&&GuildWar.ins().getModel().checkinAppoint(1)){ViewManager.ins().close(BossBloodPanel)}};UserBoss.prototype.parserBossList=function(bytes){};UserBoss.prototype.parserBoss=function(bytes){};UserBoss.prototype.checkShow=function(){var fbID=GameMap.fubenID;if(isNaN(fbID)){return}if(GameMap.fubenID!=GameMap.lastFbId){this.lastBossID=-1;GameMap.lastFbId=GameMap.fubenID}if(fbID!=0&&GameMap.fbType!=UserFb.FB_TYPE_GUANQIABOSS){if(GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS&&GameMap.fubenID==GlobalConfig.NewWorldBossBaseConfig.fbId){ViewManager.ins().open(NewWorldBossUIView)}else if(GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS||GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS&&GameMap.fubenID!=40001){ViewManager.ins().open(WorldBossUiInfo)}else if(GameMap.sceneInMine()){ViewManager.ins().open(MineScenePanel)}else if(GameMap.fbType==UserFb.FB_TYPE_LABA){ViewManager.ins().open(LabaBossUIPanel)}}else{ViewManager.ins().close(MineScenePanel);ViewManager.ins().close(WorldBossUiInfo);ViewManager.ins().close(WorldBossBeKillWin);ViewManager.ins().close(NewWorldBossUIView);ViewManager.ins().close(LabaBossUIPanel)}};UserBoss.prototype.checkRelive=function(){if(GwBoss.ins().isRoleDie()){if(this.checkWorldBossMoney()){return true}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("UserBoss_17"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("UserBoss_18"))}this.autoClear[this.currBossSubType]=false}}return false};UserBoss.prototype.checkRemoveEntity=function(_a){var handle=_a[0],entity=_a[1];var model=entity.infoModel;if(model&&model.team!=Team.My&&model.type==EntityType.Role&&model.masterHandle){var masterHandle=model.masterHandle;if(!EntityManager.ins().getMasterList(masterHandle))EntityShowMgr.ins().showNearSomeOne()}if(model&&handle==this.bossHandler){this.postBossDisappear(entity)}};UserBoss.prototype.getRankList=function(index){return this.rankList[index]};UserBoss.prototype.init=function(){this.sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_WORLDBOSS);this.sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_QMBOSS);this.sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_HOMEBOSS);this.sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_SHENYU);this.sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_GODWEAPON);this.sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP);this.sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_DARKBOSS)};UserBoss.prototype.changeWeiXieList=function(handel,add,showName){if(add===void 0){add=true}if(showName===void 0){showName=""}if(Actor.handle==handel){return}var index=this.checkListElements(handel,this.weixieList);if(add){if(index==-1){this.weixieList.push(handel)}}else{if(index!=-1){this.weixieList.splice(index,1)}}};UserBoss.prototype.changecanPlayList=function(handel,add){if(add===void 0){add=true}var tempHandel;if(Actor.handle!=handel){if(handel==0){this.canPlayList=[];this.belongName=""}else{this.weixieList=[];this.canPlayList[0]=handel;tempHandel=EntityManager.ins().getEntityBymasterhHandle(handel);if(tempHandel)this.belongName=tempHandel.infoModel.name}}else{this.weixieList=[];this.canPlayList=[];this.belongName=Actor.myName}this.postHasAttackChange(0);this.postCanplayChange()};UserBoss.prototype.checkListElements=function(handle,list){if(list.length<=0){return-1}for(var i=0;i<list.length;i++){if(list[i]==handle){return i}}return-1};UserBoss.prototype.postHasAttackChange=function(b){return b};UserBoss.prototype.postCanplayChange=function(){};UserBoss.prototype.clearWorldBossList=function(){if(GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS||GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS||GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON||GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON_TOP||GameMap.fbType==UserFb.FB_TYPE_DARK_BOSS){this.weixieList=[];this.canPlayList=[];GameLogic.ins().currAttackHandle=0}else{UserBoss.ins().winner="";UserFb.ins().guideBossKill=0}};UserBoss.prototype.checkBossIconShow=function(){return OpenSystem.ins().checkSysOpen(SystemType.BOSS)&&!UserFb.ins().pkGqboss};UserBoss.prototype.checkShenyuOpen=function(){return GameServer.serverOpenDay>=GlobalConfig.WorldBossBaseConfig.shenyuOpenDay-1};UserBoss.prototype.checkWorldBossRedPoint=function(type){var bossList=this.worldBossPlayList[type];if(!bossList)return false;if(type==UserBoss.BOSS_SUBTYPE_SHENYU&&!this.checkShenyuOpen())return false;if(type!=UserBoss.BOSS_SUBTYPE_HOMEBOSS){if(!this.worldBossLeftTime||this.worldBossLeftTime.length<0||!this.worldBossLeftTime[type])return false}if(type==UserBoss.BOSS_SUBTYPE_QMBOSS||type==UserBoss.BOSS_SUBTYPE_SHENYU||type==UserBoss.BOSS_SUBTYPE_DARKBOSS){if(this.bossAlertList&&this.bossAlertList.length){var isAllDie=true;var tempArr=this.worldInfoList[type].slice();var roleLv=UserZs.ins().lv*1e3+Actor.level;for(var i=0;i<tempArr.length;i++){var isDie=(tempArr[i].relieveTime-egret.getTimer())/1e3>0||tempArr[i].hp<=0;if(!isDie){var boo=this.getBossRemindByIndex(tempArr[i].id);if(boo){var bossConfig=GlobalConfig.WorldBossConfig[tempArr[i].id];if(!bossConfig.samsaraLv){var bossLv=bossConfig.zsLevel*1e3+bossConfig.level;if(roleLv>=bossLv){isAllDie=false;break}}else{if(Actor.samsaraLv>=bossConfig.samsaraLv){isAllDie=false;break}}}}}return!isAllDie}}if(type==UserBoss.BOSS_SUBTYPE_GODWEAPON){for(var _i=0,bossList_1=bossList;_i<bossList_1.length;_i++){var data=bossList_1[_i];if(this.worldBossBelongTime[type]>0&&data.canChallenge&&this.getBossRemindByIndex(data.id)){return true}}return false}if(type==UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP){for(var _a=0,bossList_2=bossList;_a<bossList_2.length;_a++){var data=bossList_2[_a];if(data.canChallenge&&this.getBossRemindByIndex(data.id)){var itemId=GlobalConfig.WorldBossBaseConfig.challengeItem[type-1];var item=UserBag.ins().getBagGoodsByTypeAndId(0,itemId);if(item&&item.count)return true}}return false}if(type==UserBoss.BOSS_SUBTYPE_HOMEBOSS){if(BossHomeSys.ins().bosslistLength1>0)return true;else return false}var len=bossList.length;for(var i=0;i<len;i++){if(bossList[i].bossState!=2)return true}return false};Object.defineProperty(UserBoss.prototype,"clickTime",{set:function(value){this.canClick=false;this._clickTime=value;TimerManager.ins().remove(this.endTimeChangeStatu,this);TimerManager.ins().doTimer(500,this._clickTime,this.endTimeChangeStatu,this)},enumerable:true,configurable:true});UserBoss.prototype.endTimeChangeStatu=function(){--this._clickTime;if(this._clickTime<=0){this.canClick=true;TimerManager.ins().remove(this.endTimeChangeStatu,this)}};UserBoss.prototype.getListData=function(){var tempArr=UserFb.getPersonalBossFbIds().slice();var dieArr=[];var canPlayArr=[];var canNotPlayArr=[];var roleLv=UserZs.ins().lv*1e3+Actor.level;for(var i in tempArr){var config=UserFb.ins().getFbDataById(tempArr[i].id);if(!config)continue;var isDie=config.getPlayCount()<=0;if(isDie){dieArr.push(tempArr[i])}else{var bossLv=tempArr[i].zsLevel*1e3+tempArr[i].levelLimit;if(tempArr[i].monthcard){if(UserZs.ins().lv==tempArr[i].zsLevel){if(Recharge.ins().monthDay>0){canPlayArr.unshift(tempArr[i])}else{canNotPlayArr.push(tempArr[i])}}}else if(tempArr[i].specialCard){if(UserZs.ins().lv==tempArr[i].zsLevel){if(Recharge.ins().franchise){canPlayArr.unshift(tempArr[i])}else{canNotPlayArr.push(tempArr[i])}}}else if(tempArr[i].privilege){if(Recharge.ins().getIsForeve()){canPlayArr.unshift(tempArr[i])}else{canNotPlayArr.push(tempArr[i])}}else{if(roleLv>=bossLv){canPlayArr.push(tempArr[i])}else{canNotPlayArr.push(tempArr[i])}}}}return[canPlayArr,canNotPlayArr,dieArr]};UserBoss.prototype.getGwBossList=function(){var gwList=(UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON]||[]).concat();var topList=(UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP]||[]).concat();for(var i=0;i<topList.length;i++){var data=topList[i];var config=GlobalConfig.WorldBossConfig[data.id];if(data.canInto){gwList.push(topList[i]);break}}return gwList};UserBoss.isCanChallenge=function(data){var canChallenge;if(data.samsaraLv>0){canChallenge=Actor.samsaraLv>=data.samsaraLv}else{var roleLv=UserZs.ins().lv*1e3+Actor.level;var bossLv=data.zsLevel*1e3+data.level;canChallenge=roleLv>=bossLv}return canChallenge};UserBoss.prototype.newWorldBossOpen=function(){if(!GameServer.serverOpenDay||Actor.level<GlobalConfig.NewWorldBossBaseConfig.openLv)return false;var b=UserBoss.ins().newWorldBossData.isOpen;return b};UserBoss.prototype.toNewWorldBoss=function(){if(!UserBoss.ins().newWorldBossData.isOpen){UserTips.ins().showTips(i18n("PlayWayPanel_5"));return}if(UserBoss.ins().newWorldBossData.startTime>GameServer.serverTime){var date=new Date(UserBoss.ins().newWorldBossData.startTime);var time=i18n("PlayWayPanel_18",date.getHours(),date.getMinutes()?date.getMinutes()+i18n("PlayWayPanel_6"):"");UserTips.ins().showTips(i18n("PlayWayPanel_8",time));return}if(!UserBoss.ins().checkNewWorldBossOpen()){UserTips.ins().showTips(i18n("PlayWayPanel_9",GlobalConfig.NewWorldBossBaseConfig.openLv));return}UserBoss.ins().sendIntoNewBoss()};UserBoss.WB_BAG_ENOUGH=50;UserBoss.BOSS_SUBTYPE_WORLDBOSS=1;UserBoss.BOSS_SUBTYPE_QMBOSS=2;UserBoss.BOSS_SUBTYPE_HOMEBOSS=3;UserBoss.BOSS_SUBTYPE_SHENYU=4;UserBoss.BOSS_SUBTYPE_GODWEAPON=5;UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP=6;UserBoss.BOSS_SUBTYPE_DARKBOSS=7;return UserBoss}(BaseSystem);__reflect(UserBoss.prototype,"UserBoss");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userboss=UserBoss.ins.bind(UserBoss)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var BossHomeItemData=function(){function BossHomeItemData(){this.canopen_id=0;this.canopen_roleName="";this.canopen_guildName="";this.canopen_relieveTime=0;this.canopen_bossState=0;this.canopen_hp=0;this.canopen_people=0;this.canopen_challengeing=0;this.room_bossid=0;this.room_hostname="";this.room_guildname="";this.room_relieveTime=0;this.room_state=0;this.room_hp=0;this.room_playernum=0;this.room_ischallengeing=0;this.room_rid=0;this.room_hostid=0;this.bosshomeShowrank=[]}BossHomeItemData.prototype.parser=function(bytes){this.canopen_id=bytes.readInt();this.canopen_roleName=bytes.readString();this.canopen_guildName=bytes.readString();var rTime=bytes.readInt();this.canopen_relieveTime=rTime*1e3+egret.getTimer();this.canopen_bossState=bytes.readShort();this.canopen_hp=bytes.readByte();this.canopen_people=bytes.readShort();this.canopen_challengeing=bytes.readByte()};BossHomeItemData.prototype.parser1=function(bytes){this.room_bossid=bytes.readInt();this.room_hostname=bytes.readString();this.room_guildname=bytes.readString();var rTime=bytes.readInt();this.room_relieveTime=rTime;this.room_state=bytes.readShort();this.room_hp=bytes.readByte();this.room_playernum=bytes.readShort();this.room_ischallengeing=bytes.readByte();this.room_rid=bytes.readInt();this.room_hostid=bytes.readInt();var count=bytes.readInt();this.bosshomeShowrank.length=count;if(this.room_bossid&&count>GlobalConfig.BossHomeBaseConfig[this.room_bossid].maxMember)count=GlobalConfig.BossHomeBaseConfig[this.room_bossid].maxMember;for(var i=0;i<count;i++){this.bosshomeShowrank[i]=this.bosshomeShowrank[i]||new WorldBossRankItemData;this.bosshomeShowrank[i].parser(bytes);this.bosshomeShowrank[i].rank=i+1}};return BossHomeItemData}();__reflect(BossHomeItemData.prototype,"BossHomeItemData");var NewWorldBossData=function(){function NewWorldBossData(){this.addAttrNum=0}return NewWorldBossData}();__reflect(NewWorldBossData.prototype,"NewWorldBossData");var NewWorldBossRankData=function(_super){__extends(NewWorldBossRankData,_super);function NewWorldBossRankData(){return _super!==null&&_super.apply(this,arguments)||this}return NewWorldBossRankData}(WorldBossRankItemData);__reflect(NewWorldBossRankData.prototype,"NewWorldBossRankData");var PublicBossInfo=function(){function PublicBossInfo(){}PublicBossInfo.prototype.parser=function(bytes){this.id=bytes.readInt();this.hp=bytes.readShort();this.people=bytes.readShort();this.reliveTime=bytes.readInt()*1e3+egret.getTimer();this.challengeing=bytes.readBoolean()};Object.defineProperty(PublicBossInfo.prototype,"isDie",{get:function(){return(this.reliveTime-egret.getTimer())/1e3>0},enumerable:true,configurable:true});return PublicBossInfo}();__reflect(PublicBossInfo.prototype,"PublicBossInfo");var WorldBossItemData=function(){function WorldBossItemData(){this.id=0;this.roleName="";this.guildName="";this.relieveTime=0;this.bossState=0;this.hp=0;this.people=0;this.challengeing=0}WorldBossItemData.prototype.parser=function(bytes){this.id=bytes.readInt();this.roleName=bytes.readString();this.guildName=bytes.readString();var rTime=bytes.readInt();this.relieveTime=rTime*1e3+egret.getTimer();this.bossState=bytes.readShort();this.hp=bytes.readByte();this.people=bytes.readShort();this.challengeing=bytes.readByte()};Object.defineProperty(WorldBossItemData.prototype,"isDie",{get:function(){return(this.relieveTime-egret.getTimer())/1e3>0},enumerable:true,configurable:true});Object.defineProperty(WorldBossItemData.prototype,"canInto",{get:function(){var config=GlobalConfig.WorldBossConfig[this.id];var zsLevel=config.zsLevel;if(typeof zsLevel=="number"){if(zsLevel>0){return UserZs.ins().lv>=zsLevel}else{return Actor.level>=zsLevel}}else{var arr=zsLevel;if(arr.length>1){return UserZs.ins().lv>=arr[0]&&UserZs.ins().lv<=arr[1]}else{console.log(i18n("WorldBossItemData_0",arr))}}},enumerable:true,configurable:true});Object.defineProperty(WorldBossItemData.prototype,"canChallenge",{get:function(){return!this.isDie&&this.canInto},enumerable:true,configurable:true});return WorldBossItemData}();__reflect(WorldBossItemData.prototype,"WorldBossItemData");var PHPAPI=function(){function PHPAPI(){}PHPAPI.SVER_URL="http://pay.lcbyh5.com/";PHPAPI.GET_LAST_SERVER=PHPAPI.SVER_URL+"api/getlastserver?";PHPAPI.GET_SEVER_LIST=PHPAPI.SVER_URL+"api/getserverlist?";PHPAPI.WAN_BA=PHPAPI.SVER_URL+"login/wanba?";PHPAPI.USER_INFO=PHPAPI.SVER_URL+"payment/userInfo?";PHPAPI.BUY=PHPAPI.SVER_URL+"payment/buy?";return PHPAPI}();__reflect(PHPAPI.prototype,"PHPAPI");var BloodBar=function(_super){__extends(BloodBar,_super);function BloodBar(){var _this=_super.call(this)||this;_this.skinName="BloodBarSkin";return _this}BloodBar.prototype.$onRemoveFromStage=function(){_super.prototype.$onRemoveFromStage.call(this);DisplayUtils.removeFromParent(this.effMc)};BloodBar.prototype.setEff=function(wid,hei,effName){if(wid===void 0){wid=323}if(hei===void 0){hei=18}if(effName===void 0){effName="bossxtbig_eff"}this.wid=wid;this.hei=hei;this.effName=effName};BloodBar.prototype.childrenCreated=function(){this.init()};BloodBar.prototype.init=function(){this.bar.width=this.wid;this.bar.height=this.hei;this.width=this.wid;this.height=this.hei;this.valueLabel.width=this.wid;this.mcGroup.removeChildren();this.effMc=new MovieClip;this.effMc.x=this.wid/2;this.effMc.y=this.hei/2;this.mcGroup.addChild(this.effMc);this.effMc.playFile(RES_DIR_EFF+this.effName,-1);this.value=100;this.maximum=100;this.setValue()};BloodBar.prototype.setValue=function(){if(this.bar){if(this.maximum>0){this.bar.width=this.wid*(this.value/this.maximum)}else{this.bar.width=this.wid}this.setLabel(this.value.toString()+"/"+this.maximum.toString())}};BloodBar.prototype.setLabel=function(str){if(str===void 0){str=""}if(!this.valueLabel){return}this.valueLabel.text=str};return BloodBar}(BaseView);__reflect(BloodBar.prototype,"BloodBar");var BossBloodPanel=function(_super){__extends(BossBloodPanel,_super);function BossBloodPanel(){var _this=_super.call(this)||this;_this._curMonsterID=0;_this.curValue=1;_this.skinName="BossBloodSkin";_this.bloodBar=new BloodBar;_this.bloodBar.setEff();_this.hudunbloodBar=new BloodBar;_this.hudunbloodBar.setEff(179,7,"bossxtsmall_eff");return _this}BossBloodPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.bloodBarGroup.addChild(this.bloodBar);this.hudunbloodBarGroup.addChild(this.hudunbloodBar);this.headMc=new MovieClip;this.mcGroup.addChild(this.headMc);this.headMc.playFile(RES_DIR_EFF+"bosstx_eff",-1);this.grayImg.source="bosshp2";this.grayImgMask=new egret.Rectangle(0,0,this.grayImg.width,this.grayImg.height);this.grayImg.mask=this.grayImgMask;BossBloodPanel.GRAYIMG_WIDTH=this.grayImg.width;this.see.visible=false;this.hudunbloodBar.value=100;this.hudunbloodBar.maximum=100;this.hudunbloodBar.setValue();this.hudunbloodBar.setLabel("");this.observe(CityCC.ins().postHudunPoint,this.delayHuDunChange);this.observe(ZsBoss.ins().postHudunPoint,this.delayHuDunChange);this.observe(UserBoss.ins().postShieldPer,this.delayHuDunChange);this.addTouchEvent(this.seeRewardBtn,this.onTap);this.addChangeEvent(this.clearRole,this.autoClearChange);this.addTouchEvent(this.clearBtn,this.onTap);this.addTouchEvent(this.tipBtn0,this.onTap)};BossBloodPanel.prototype.test=function(){if(this.bloodBar.value>100){this.bloodBar.value=100}if(this.hudunbloodBar.value>100){this.hudunbloodBar.value=100}this.bloodBar.value-=20;if(this.bloodBar.value<=0){this.bloodBar.value=100}this.bloodBar.maximum=100;this.bloodBar.setValue();this.hudunbloodBar.value-=10;if(this.hudunbloodBar.value<=0){this.hudunbloodBar.value=100}this.hudunbloodBar.maximum=100;this.hudunbloodBar.setValue();this.hudunbloodBar.setLabel("")};BossBloodPanel.prototype.open=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.myTxt.text=i18n("BossBloodPanel_0");this.dropDown.setEnabled(false);this.hudun.visible=false;this.tipBtn0.visible=this.checkShowSeeAwardBtn();var dataArr=UserBoss.ins().rank.concat();var len=dataArr.length;if(len){if(len>3){len=3}var showArr=dataArr.slice(1,len);this.dropDown.setData(showArr);this.dropDown.setLabel(dataArr[0].name)}else{this.dropDown.setData([]);this.dropDown.setLabel("")}len=dataArr.length;var id=Actor.actorID;for(var i=0;i<len;i++){if(dataArr[i].id==id){this.myTxt.text=i18n("BossBloodPanel_1",CommonUtils.overLength(dataArr[i].value));break}}this.huDunChange();this.clearRole.selected=ZsBoss.ins().clearOther;this.checkIsShowFbInfo();this.showCurRewards();var config=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];if(config){this.updateBaseInfo();this.guildFBInfo(config)}this.warnGroup.visible=false;if(UserBoss.ins().isShowWarn){this.warnGroup.visible=true}TimerManager.ins().doTimer(5e3,1,function(){UserBoss.ins().isShowWarn=_this.warnGroup.visible=false},this)};BossBloodPanel.prototype.checkShowSeeAwardBtn=function(){return CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||KFBossSys.ins().isKFBossBattle||GameMap.fbType==UserFb.FB_TYPE_HIDE_BOSS||DarkMjBoss.ins().isDarkBoss||DevildomSys.ins().isDevildomBattle};BossBloodPanel.prototype.updateBaseInfo=function(){if(this._curMonsterID==UserBoss.ins().monsterID)return;this._curMonsterID=UserBoss.ins().monsterID;var config=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];var layer;if(GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){if(SkyLevelModel.ins().cruLevel)layer=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel].layer}var head=layer&&GameMap.fbType!=UserFb.FB_TYPE_HUN_SHOU?i18n("BossBloodPanel_2",layer):"";if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){var tf=TextFlowMaker.generateTextFlow1(config.name);var tfName=tf[tf.length-1].text;this.nameTxt.visible=false}else{this.nameTxt.text=i18n("BossBloodPanel_4",head,config.name,config.level)}this.head.source="monhead"+config.head+"_png";if(GameMap.fbType==UserFb.FB_TYPE_KF_BOSS||GameMap.fbType==UserFb.FB_TYPE_HIDE_BOSS)UserBoss.ins().currBossConfigID=UserBoss.ins().monsterID};BossBloodPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.seeRewardBtn,this.onTap);this.clearRole.removeEventListener(egret.Event.CHANGE,this.autoClearChange,this);this.removeTouchEvent(this.clearBtn,this.onTap);this.closeShowInfoPanel();this.removeObserve();this._curMonsterID=0;if(this.grayImgMask)egret.Tween.removeTweens(this.grayImgMask);UserBoss.ins().isShowWarn=false};BossBloodPanel.prototype.guildFBInfo=function(config){var charm=EntityManager.ins().getEntityByHandle(UserBoss.ins().bossHandler);var monstermodel=charm?charm.infoModel:null;if(GuildWar.ins().getModel().checkinAppoint(1)){var time=GuildWar.ins().getModel().doorEndtime;this.bloodBar.value=time;this.bloodBar.maximum=120;this.bloodBar.setValue();this.barGroup.y=101;if(time<=0){this.visible=false}else{this.visible=true}this.bloodBar.setLabel(Math.floor(time*100/120)+"%");this.curValue=Math.floor(this.bloodBar.value/120*100);this.tweenBlood()}else{this.myTxt.visible=this.dropDown.visible=UserBoss.ins().publicBossIdDic.lastIndexOf(config.id)>=0;this.bloodBar.value=UserBoss.ins().hp==undefined?config.hp:UserBoss.ins().hp;this.bloodBar.maximum=config.hp;this.bloodBar.setValue();this.barGroup.y=20;this.visible=this.bloodBar.value>0;this.curValue=Math.floor(this.bloodBar.value/config.hp*100);this.tweenBlood()}};BossBloodPanel.prototype.tweenBlood=function(){var _this=this;var bloodPer=this.curValue*BossBloodPanel.GRAYIMG_WIDTH/100;var self=this;egret.Tween.removeTweens(this.grayImgMask);if(bloodPer<3)return;var t=egret.Tween.get(this.grayImgMask,{onChange:function(){if(self.grayImg)self.grayImg.mask=_this.grayImgMask}},self);t.to({width:bloodPer-3},1e3).call(function(){if(bloodPer<=0){self.grayImgMask.width=0;egret.Tween.removeTweens(this.grayImgMask)}},self)};BossBloodPanel.prototype.autoClearChange=function(e){if(ZsBoss.ins().canChange){ZsBoss.ins().clearOther=this.clearRole.selected;this.clearSelect=this.clearRole.selected;EntityManager.ins().hideOtherEntity(this.clearSelect)}else{this.clearRole.selected=this.clearSelect;UserTips.ins().showTips(i18n("BossBloodPanel_5"))}};BossBloodPanel.prototype.delayHuDunChange=function(){if(!TimerManager.ins().isExists(this.huDunChange,this))TimerManager.ins().doTimer(60,1,this.huDunChange,this)};BossBloodPanel.prototype.huDunChange=function(){this.proLab.visible=true;if(ZsBoss.ins().isZsBossFb(GameMap.fubenID)||GuildWar.ins().getModel().checkinAppoint(1)){if(ZsBoss.ins().hudun&&ZsBoss.ins().hudun>0){this.hudun.visible=true;this.hudunbloodBar.value=ZsBoss.ins().hudun;this.hudunbloodBar.setValue();this.hudunbloodBar.setLabel("")}else{this.hudun.visible=false}}else if(CityCC.ins().isCity){this.proLab.visible=false;if(CityCC.ins().hudun&&CityCC.ins().hudun>0){this.hudun.visible=true;this.hudunbloodBar.value=CityCC.ins().hudun;this.hudunbloodBar.maximum=CityCC.ins().huDunMax;this.hudunbloodBar.setValue();this.hudunbloodBar.setLabel("")}else{this.hudun.visible=false}}else if(GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||DarkMjBoss.ins().isDarkBoss){this.proLab.visible=false;if(UserBoss.ins().shieldType){if(UserBoss.ins().curShield>0){this.hudun.visible=true;if(!TimerManager.ins().isExists(this.setTimeShieldChange,this)){TimerManager.ins().doTimer(1e3,0,this.setTimeShieldChange,this);this.setTimeShieldChange()}}}else{this.setHpShieldChange()}}else{this.hudun.visible=false}};BossBloodPanel.prototype.setHpShieldChange=function(){if(UserBoss.ins().curShield&&UserBoss.ins().curShield>0){this.hudun.visible=true;var value=Math.ceil(UserBoss.ins().curShield/UserBoss.ins().totalShield*100);this.hudunbloodBar.value=value;this.hudunbloodBar.setValue();this.hudunbloodBar.setLabel("")}else{this.hudun.visible=false}};BossBloodPanel.prototype.setTimeShieldChange=function(){this.hudunbloodBar.value=UserBoss.ins().curShield;this.hudunbloodBar.maximum=UserBoss.ins().totalShield;this.hudunbloodBar.setValue();this.hudunbloodBar.setLabel("");if(UserBoss.ins().curShield>0){this.hudun.visible=true}else{TimerManager.ins().remove(this.setTimeShieldChange,this);this.hudun.visible=false}UserBoss.ins().curShield--};BossBloodPanel.prototype.overTime=function(){this.cd.visible=false;ViewManager.ins().close(ZSBossCDWin)};BossBloodPanel.prototype.refushLabel=function(){this.remainM--;this.timeLable.text=i18n("BossBloodPanel_6")+this.remainM+i18n("BossBloodPanel_7")};BossBloodPanel.prototype.onTap=function(e){switch(e.target){case this.tipBtn0:if(CityCC.ins().isCity){ViewManager.ins().open(CityBossJiangliTipsWin)}else if(GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON){ViewManager.ins().open(GuardRewardWin)}else if(DevildomSys.ins().isDevildomBattle){ViewManager.ins().open(DevildomBossAwardWin)}else{ViewManager.ins().open(PublicBossJiangliTipWin)}break;case this.seeRewardBtn:ViewManager.ins().open(ZsBossRewardShowWin);break;case this.clearBtn:if(UserBoss.ins().checkWorldBossMoney()){ViewManager.ins().open(ZSBossCDWin,this.autoClear.selected)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("BossBloodPanel_8"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("BossBloodPanel_9"))}}break}};BossBloodPanel.prototype.checkIsShowFbInfo=function(){switch(GameMap.fbType){case UserFb.FB_TYPE_TIAOZHAN:case UserFb.FB_TYPE_HUN_SHOU:ViewManager.ins().open(ChallengeInfoPanel);break}};BossBloodPanel.prototype.closeShowInfoPanel=function(){if(ViewManager.ins().isShow(ChallengeInfoPanel)){ViewManager.ins().close(ChallengeInfoPanel)}};BossBloodPanel.prototype.showCurRewards=function(){if(GameMap.fbType!=UserFb.FB_TYPE_TIAOZHAN&&GameMap.fbType!=UserFb.FB_TYPE_HUN_SHOU){this.currewards.visible=false;return}this.currewards.visible=true;var rdatas={rewards:[]};if(GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU){var id=Hungu.ins().hunShouFBPassID>=Object.keys(GlobalConfig.FsFbConfig).length?Hungu.ins().hunShouFBPassID:Hungu.ins().hunShouFBPassID+1;var cfg=GlobalConfig.FsFbConfig[id];rdatas.rewards=cfg.award}else{var model=SkyLevelModel.ins();var info=GlobalConfig.FbChallengeConfig[model.cruLevel];if(info){rdatas.rewards=info.passReward}}this.currewards.data=rdatas};BossBloodPanel.GRAYIMG_WIDTH=0;return BossBloodPanel}(BaseEuiView);__reflect(BossBloodPanel.prototype,"BossBloodPanel");ViewManager.ins().reg(BossBloodPanel,LayerManager.Game_Main);var BossEndView=function(_super){__extends(BossEndView,_super);function BossEndView(){var _this=_super.call(this)||this;_this.skinName="BossEndSkin";return _this}BossEndView.prototype.open=function(){this.observe(UserBoss.ins().postWorldBossEndTime,this.worldBossEnd);this.worldBossEnd()};BossEndView.prototype.close=function(){TimerManager.ins().removeAll(this)};BossEndView.prototype.worldBossEnd=function(){var _this=this;this.winnerName.text=i18n("BossEndView_0",UserBoss.ins().winner);var time=Math.ceil((UserBoss.ins().worldBossEndTime-egret.getTimer())/1e3);this.leftTime.text=DateUtils.getFormatTimeByStyle(time,DateUtils.STYLE_4);TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1e3,time,function(){time--;_this.leftTime.text=DateUtils.getFormatTimeByStyle(time,DateUtils.STYLE_4);if(time==0){UserFb.ins().sendExitFb()}},this)};return BossEndView}(BaseEuiView);__reflect(BossEndView.prototype,"BossEndView");ViewManager.ins().reg(BossEndView,LayerManager.Main_View);var BossItem=function(_super){__extends(BossItem,_super);function BossItem(){return _super.call(this)||this}BossItem.prototype.childrenCreated=function(){};BossItem.prototype.dataChanged=function(){var limitStr="";var color="";var canChallenge;var boss;var model=this.data;var config=GlobalConfig.WorldBossConfig[model.id];this.list.itemRenderer=this.list.itemRenderer||ItemBase;this.config=config;if(!this.list.dataProvider){this.list.dataProvider=new eui.ArrayCollection(config.showReward.concat())}else{var dataPro=this.list.dataProvider;dataPro.source=config.showReward.concat()}var isDie=model.isDie;this.boxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);canChallenge=UserBoss.isCanChallenge(config);if(config.samsaraLv>0){limitStr=i18n("BossItem_0",config.showName)}else{if(config.zsLevel>0){limitStr=i18n("BossItem_1",config.zsLevel)}else{limitStr=i18n("BossItem_2",config.level)}}color=canChallenge?"23CA23":"f15a25";this.levelRequire.text=limitStr;this.bar.maximum=100;this.bar.value=model.hp;boss=GlobalConfig.MonstersConfig[config.bossId];this.timeTxt.visible=isDie;if(this.timeTxt.visible){this.updateTime();TimerManager.ins().doTimer(100,0,this.updateTime,this)}this.challengeBtn.visible=!isDie;if(config.type==UserBoss.BOSS_SUBTYPE_QMBOSS){this.challengeBtn.name="publicChallenge"}else if(config.type==UserBoss.BOSS_SUBTYPE_SHENYU){this.challengeBtn.name="shenyuChallenge"}if(this.challengeBtn.visible){var cdTime=(UserBoss.ins().cdTime-egret.getTimer())/1e3;if(model.challengeing&&cdTime>0){this.challengeBtn.enabled=false;this.challengeBtn.touchEnabled=false;this.updateCDTime();TimerManager.ins().doTimer(100,0,this.updateCDTime,this)}else{this.challengeBtn.label=i18n("BossItem_4");this.challengeBtn.enabled=true;this.challengeBtn.touchEnabled=true;TimerManager.ins().remove(this.updateCDTime,this)}}this.barBg.visible=this.bar.visible=true;if(boss){this.head.source="monhead"+boss.head+"_png";var levelStr=void 0;if(config.samsaraLv>0){levelStr=config.showName}else if(config.zsLevel>0){levelStr=i18n("BossItem_5",config.zsLevel)}else{levelStr=i18n("BossItem_6",config.level)}this.nameTxt0.text=levelStr;this.nameTxt.text=""+boss.name}this.needLv.visible=!canChallenge;this.challengeBtn.visible=this.challengeBtn.visible&&canChallenge};BossItem.prototype.updateCDTime=function(){var cdTime=(UserBoss.ins().cdTime-egret.getTimer())/1e3;this.challengeBtn.label=i18n("BossItem_7",cdTime.toFixed(0));if(cdTime<=0){this.challengeBtn.label=i18n("BossItem_8");this.challengeBtn.enabled=true;this.challengeBtn.touchEnabled=true;TimerManager.ins().remove(this.updateCDTime,this)}};BossItem.prototype.updateTime=function(){var model=this.data;var time=model.relieveTime-egret.getTimer();this.timeTxt.text=i18n("BossItem_9",DateUtils.getFormatBySecond(Math.floor(time/1e3),1));if(time<=0){this.timeTxt.visible=false;UserBoss.ins().sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_QMBOSS);TimerManager.ins().remove(this.updateTime,this)}};BossItem.prototype.onTap=function(e){switch(e.currentTarget){case this.boxBtn:WarnWin.show(this.config.rewardsDesc,null,this,null,null,"sure");break}};BossItem.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);TimerManager.ins().removeAll(this)};return BossItem}(BaseItemRender);__reflect(BossItem.prototype,"BossItem");var BossRewardsItem=function(_super){__extends(BossRewardsItem,_super);function BossRewardsItem(){return _super.call(this)||this}BossRewardsItem.prototype.dataChanged=function(){var rewards=this.data.rewards;this.experience.data=rewards[0];this.randomRune.data=rewards[1];this.runeCream.data=rewards[2];var model=SkyLevelModel.ins();var nextCfg=model.getNextOpenLevel();if(nextCfg){if(!this.target.data){this.target.data=nextCfg.showIcon}var curCfg=GlobalConfig.FbChallengeConfig[model.cruLevel];var cfg=GlobalConfig.ItemConfig[nextCfg.showIcon];var runeType=ItemConfig.getQuality(cfg);var endstr=i18n("BossRewards_0");if(runeType==FBChallengePanel.RunType)endstr=i18n("BossRewards_1");if(curCfg.group==nextCfg.group)this.leftlabel.text=""+nextCfg.layer+endstr;else this.leftlabel.text=i18n("BossRewards_2",nextCfg.id-curCfg.id)+endstr}this.labelGroup.visible=this.target.visible=nextCfg&&GameMap.fbType!=UserFb.FB_TYPE_HUN_SHOU};return BossRewardsItem}(BaseItemRender);__reflect(BossRewardsItem.prototype,"BossRewardsItem");var BossTargetInfo=function(_super){__extends(BossTargetInfo,_super);function BossTargetInfo(){var _this=_super.call(this)||this;_this.skinName="BossTargetSkin";return _this}BossTargetInfo.prototype.refushTargetInfo=function(target){this.model=target.infoModel;this.bloodBar.maximum=this.model.getAtt(AttributeType.atMaxHp);this.bloodBar.value=target.getHP();if(this.model.team==Team.My){this.nameLabel.text=Actor.myName}else{this.nameLabel.text=this.model.name+""}this.head.source="yuanhead"+this.model.job+this.model.sex};return BossTargetInfo}(BaseView);__reflect(BossTargetInfo.prototype,"BossTargetInfo");var HomeBossGroupItem=function(_super){__extends(HomeBossGroupItem,_super);function HomeBossGroupItem(){return _super.call(this)||this}HomeBossGroupItem.prototype.dataChanged=function(){};return HomeBossGroupItem}(BaseItemRender);__reflect(HomeBossGroupItem.prototype,"HomeBossGroupItem");var HomeBossItem=function(_super){__extends(HomeBossItem,_super);function HomeBossItem(){return _super.call(this)||this}HomeBossItem.prototype.dataChanged=function(){var limitStr="";var color="";var canChallenge;var boss;var model=this.data;var config=GlobalConfig.WorldBossConfig[model.canopen_id];var numStr;this.list.itemRenderer=ItemBase;this.config=config;this.list.dataProvider=new eui.ArrayCollection(config.showReward);if(config.zsLevel>0){canChallenge=UserZs.ins().lv>=config.zsLevel;limitStr=i18n("HomeBossItem_0",config.zsLevel)}else{canChallenge=Actor.level>=config.level;limitStr=i18n("HomeBossItem_1",config.level)}this.levelRequire.text=limitStr;if(BossHomeSys.ins().nowOpenTicketCount0>=GlobalConfig.BossHomeBaseConfig[model.canopen_id].need[0].count)numStr=i18n("HomeBossItem_11")+BossHomeSys.ins().nowOpenTicketCount0+"|/"+GlobalConfig.BossHomeBaseConfig[model.canopen_id].need[0].count;else numStr=i18n("HomeBossItem_12")+BossHomeSys.ins().nowOpenTicketCount0+"|/"+GlobalConfig.BossHomeBaseConfig[model.canopen_id].need[0].count;this.num.textFlow=TextFlowMaker.generateTextFlow(numStr);boss=GlobalConfig.MonstersConfig[config.bossId];this.challengeBtn.name="homebossopen";this.challengeBtn.visible=true;if(this.challengeBtn.visible){this.challengeBtn.label=i18n("HomeBossItem_4");this.challengeBtn.enabled=true;this.challengeBtn.touchEnabled=true}if(boss){this.head.source="monhead"+boss.head+"_png";var levelStr=config.zsLevel>0?i18n("HomeBossItem_5",config.zsLevel):i18n("HomeBossItem_6",config.level);this.nameTxt0.text=levelStr;this.nameTxt.text=""+boss.name}this.challengeBtn.visible=canChallenge;this.needLv.visible=!this.challengeBtn.visible};return HomeBossItem}(BaseItemRender);__reflect(HomeBossItem.prototype,"HomeBossItem");var HomeBossItem1=function(_super){__extends(HomeBossItem1,_super);function HomeBossItem1(){var _this=_super.call(this)||this;_this.showrelieveTime=0;return _this}HomeBossItem1.prototype.dataChanged=function(){var limitStr="";var color="";var canChallenge;var boss;var model=this.data;var config=GlobalConfig.WorldBossConfig[model.room_bossid];this.list.itemRenderer=ItemBase;this.config=config;this.list.dataProvider=new eui.ArrayCollection(config.showReward);if(config.zsLevel>0){canChallenge=UserZs.ins().lv>=config.zsLevel;limitStr=i18n("HomeBossItem_9",config.zsLevel)}else{canChallenge=Actor.level>=config.level;limitStr=i18n("HomeBossItem_10",config.level)}this.levelRequire.text=limitStr;this.bar.value=model.room_hp;this.bar.maximum=100;boss=GlobalConfig.MonstersConfig[config.bossId];this.roomhost.text=model.room_hostname;BossHomeSys.ins().nowhomehostName=model.room_hostname;this.showrelieveTime=model.room_relieveTime;this.updateTime();TimerManager.ins().remove(this.updateTime,this);TimerManager.ins().doTimer(1e3,0,this.updateTime,this);var textstr;if(model.room_playernum<GlobalConfig.BossHomeBaseConfig[model.room_bossid].maxMember){textstr=i18n("HomeBossItem_11")+model.room_playernum+"|/"+GlobalConfig.BossHomeBaseConfig[model.room_bossid].maxMember}else{textstr=i18n("HomeBossItem_12")+model.room_playernum+"|/"+GlobalConfig.BossHomeBaseConfig[model.room_bossid].maxMember}this.joinNum.textFlow=TextFlowMaker.generateTextFlow(textstr);this.challengeBtn.name="homebossjoin";this.challengeBtn.currentState="up";this.challengeBtn.label=i18n("HomeBossItem_8");if(this.challengeBtn.visible){if(model.room_playernum>=GlobalConfig.BossHomeBaseConfig[model.room_bossid].maxMember&&model.room_ischallengeing==0)this.challengeBtn.currentState="disabled";else{}}this.barBg.visible=this.bar.visible=true;if(boss){this.head.source="monhead"+boss.head+"_png";var levelStr=config.zsLevel>0?i18n("HomeBossItem_5",config.zsLevel):i18n("HomeBossItem_6",config.level);this.nameTxt0.text=levelStr;this.nameTxt.text=""+boss.name}this.challengeBtn.visible=this.challengeBtn.visible&&canChallenge;this.needLv.visible=!this.challengeBtn.visible};HomeBossItem1.prototype.updateTime=function(){if(this.showrelieveTime==undefined)return;if(this.showrelieveTime<=0){BossHomeSys.ins().sendRoomingBossInfo(UserBoss.BOSS_SUBTYPE_HOMEBOSS);TimerManager.ins().remove(this.updateTime,this)}else{this.showrelieveTime=this.showrelieveTime-1;this.lasttimeTxt.text=DateUtils.getFormatBySecond(Math.floor(this.showrelieveTime),DateUtils.TIME_FORMAT_1)}};return HomeBossItem1}(BaseItemRender);__reflect(HomeBossItem1.prototype,"HomeBossItem1");var PersonalBossItem=function(_super){__extends(PersonalBossItem,_super);function PersonalBossItem(){var _this=_super.call(this)||this;_this.skinName="personalBossItemSkin";return _this}PersonalBossItem.prototype.dataChanged=function(){var tData=this.data;var bossBaseConfig=GlobalConfig.MonstersConfig[tData.bossId];var str="";if(tData.monthcard){str=i18n("PersonalBossItem_0")}else if(tData.specialCard){str=i18n("PersonalBossItem_1")}else if(tData.privilege){str=i18n("PersonalBossItem_2")}else{str=tData.zsLevel>0?i18n("PersonalBossItem_3",tData.zsLevel):i18n("PersonalBossItem_4",tData.levelLimit)}this.nameTxt.text=bossBaseConfig.name+"·"+str;var roleLv=UserZs.ins().lv*1e3+Actor.level;var config=UserFb.ins().getFbDataById(this.data.id);var isDie=config.getPlayCount()<=0;var bossLv=this.data.zsLevel*1e3+this.data.levelLimit;if(isDie){this.enabled=false;this.currentState="disabled";this.notOpenImg.visible=false}else{this.enabled=true;if(tData.monthcard){this.notOpenImg.visible=Recharge.ins().monthDay?false:true}else if(tData.privilege){this.notOpenImg.visible=Recharge.ins().forevetCard!=2}else if(tData.specialCard){this.notOpenImg.visible=Recharge.ins().franchise?false:true}else{this.notOpenImg.visible=roleLv<bossLv}}};return PersonalBossItem}(BaseItemRender);__reflect(PersonalBossItem.prototype,"PersonalBossItem");var PublicBossPanel=function(_super){__extends(PublicBossPanel,_super);function PublicBossPanel(){var _this=_super.call(this)||this;_this.isStartTime=false;_this.type=0;_this.restoreTime=0;return _this}PublicBossPanel.prototype.childrenCreated=function(){this.init()};PublicBossPanel.prototype.init=function(){this.list.itemRenderer=BossItem;this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>");this.setting.touchEnabled=true;this.listData=new eui.ArrayCollection;this.list.dataProvider=this.listData;this.vipGroup.touchEnabled=this.tipTxt.touchEnabled=false;this.tipTxt.textFlow=TextFlowMaker.generateTextFlow(i18n("PublicBossPanel_0"))};PublicBossPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.type=UserBoss.BOSS_SUBTYPE_QMBOSS;this.observe(UserBoss.ins().postWorldBoss,this.updateList);this.observe(UserBoss.ins().postWorldBoss,this.calljoinPulbicChallenge);this.observe(UserBag.ins().postItemCountChange,this.UseToItem);this.setting.addEventListener(egret.TextEvent.LINK,this.onLink,this);this.addTouchEvent(this.buyBtn,this.onTap);this.addTouchEvent(this,this.onTap);this.setData();this.showBossId=param[0];TimerManager.ins().doTimer(2e3,0,this.getNewInfo,this);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.ywBoss)};PublicBossPanel.prototype.close=function(){this.setting.removeEventListener(egret.TextEvent.LINK,this.onLink,this);egret.Tween.removeTweens(this.vipGroup);this.removeObserve();TimerManager.ins().removeAll(this);this.isStartTime=false;GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};PublicBossPanel.prototype.getNewInfo=function(){UserBoss.ins().sendWorldBossInfo(this.type)};PublicBossPanel.prototype.showTips=function(){var count=UserBoss.ins().worldBossLeftTime[this.type];if(count>0){return true}var self=this;var tipText="";var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,ItemConst.PUBLICBOSS);if(item){tipText=i18n("PublicBossPanel_1");self.inUse=true;WarnWin.show(tipText,function(){self.isUse=true;self.inUse=false;UserBag.ins().sendUseItem(item.configID,1)},this,function(){self.inUse=false})}else{var vipConfig=GlobalConfig.VipConfig[UserVip.ins().lv];if(!vipConfig){UserTips.ins().showTips(i18n("PublicBossPanel_2"));return false}if(!vipConfig.boss1buy){var warnWin=WarnWin.show(i18n("PublicBossPanel_4"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("PublicBossPanel_5"));return false}var currentUse=UserBoss.ins().worldChallengeTime[this.type];if(count<=0&&currentUse>=vipConfig.boss1buy){UserTips.ins().showTips(i18n("PublicBossPanel_6"));return}if(Actor.yb<GlobalConfig.WorldBossBaseConfig.buyCountPrice[this.type-1]){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("PublicBossPanel_7"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("PublicBossPanel_8"))}return false}tipText=i18n("PublicBossPanel_9",GlobalConfig.WorldBossBaseConfig.buyCountPrice[this.type-1])+i18n("PublicBossPanel_10",currentUse,vipConfig.boss1buy);WarnWin.show(tipText,function(){UserBoss.ins().sendBuyChallengeTimes(this.type)},this)}return false};PublicBossPanel.prototype.UseToItem=function(){var leftTime=UserBoss.ins().worldBossLeftTime[this.type];this.challengeCountTxt.text=leftTime+"/"+GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1];if(this.isUse){this.isUse=false;UserBoss.ins().sendWorldBossInfo(this.type);if(this.eId&&this.type)UserBoss.ins().sendChallengWorldBoss(this.eId,this.type)}};PublicBossPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.buyBtn:if(!this.showTips())return;break;default:if(e.target instanceof eui.Button){var config=e.target.parent["config"];switch(e.target.name){case"publicChallenge":this.isJoin=true;this.config=config;this.eId=e.target.parent.data.id;if(!this.showTips()){this.isJoin=false;return}if(!this.joinPulbicChallenge(config)){this.isJoin=false;return}break}ViewManager.ins().close(LimitTaskView)}break}};PublicBossPanel.prototype.calljoinPulbicChallenge=function(){if(!this.joinPulbicChallenge(this.config))return;ViewManager.ins().close(LimitTaskView)};PublicBossPanel.prototype.joinPulbicChallenge=function(config){if(!config)return false;if(!this.isJoin)return false;this.isJoin=false;if(UserFb.ins().checkInFB())return false;if(config.zsLevel<=UserZs.ins().lv&&config.level<=Actor.level){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH)}else{var endTime=Math.ceil((UserBoss.ins().worldBossCd[this.type]-egret.getTimer())/1e3);if(endTime>0){UserTips.ins().showTips(i18n("PublicBossPanel_11",endTime));return false}if(!this.inUse){UserBoss.ins().sendChallengWorldBoss(this.eId,this.type);ViewManager.ins().close(this);EasyLoading.ins().showLoading(5)}}}else{UserTips.ins().showTips(i18n("PublicBossPanel_12"))}return true};PublicBossPanel.prototype.updateTime=function(){if(this.timeTxt==undefined)return;var time=this.restoreTime-egret.getTimer();if(time<0){this.restoreTime=UserBoss.ins().worldBossrestoreTime[this.type];time=0}if(time<=0){if(UserBoss.ins().worldBossLeftTime[this.type]>=GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1]){TimerManager.ins().remove(this.updateTime,this);this.isStartTime=false;this.timeTxt.visible=false}}else{if(!this.timeTxt.visible)this.timeTxt.visible=true}var timeStr=DateUtils.getFormatBySecond(Math.floor(time/1e3),DateUtils.TIME_FORMAT_12);this.timeTxt.text=i18n("PublicBossPanel_13",timeStr)};PublicBossPanel.prototype.setData=function(){var leftTime=UserBoss.ins().worldBossLeftTime[this.type];var itemData=UserBag.ins().getBagItemById(ItemConst.PUBLICBOSS);this.buyBtn.visible=leftTime>0||itemData?false:true;this.showJuan(itemData);this.challengeCountTxt.text=leftTime+"/"+GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1];if(leftTime<=0&&UserVip.ins().lv<=0){this.vipGroup.visible=true;var t=egret.Tween.get(this.vipGroup,{loop:true}).to({alpha:0},1e3).to({alpha:1},1e3)}else{this.vipGroup.visible=false;egret.Tween.removeTweens(this.vipGroup)}if(!this.isStartTime){TimerManager.ins().doTimer(1e3,0,this.updateTime,this);this.restoreTime=UserBoss.ins().worldBossrestoreTime[this.type];this.isStartTime=true;this.updateTime()}this.initList()};PublicBossPanel.prototype.showJuan=function(itemData){if(!itemData){this.juan.visible=false;return}this.juan.visible=true;this.jicon.source=itemData.itemConfig.icon+"_png";this.jcount.text=itemData.count+""};PublicBossPanel.prototype.initList=function(){var list=UserBoss.ins().worldInfoList[this.type]||[];var tempArr=list.slice();var bossInfos=[];var remindArr=[];var remindDieArr=[];var noRemindArr=[];var noRemindDieArr=[];var canNotPlayArr=[];var roleLv=UserZs.ins().lv*1e3+Actor.level;for(var i=0;i<tempArr.length;i++){var isDie=(tempArr[i].relieveTime-egret.getTimer())/1e3>0||tempArr[i].hp<=0;var boo=UserBoss.ins().getBossRemindByIndex(tempArr[i].id);var bossConfig=GlobalConfig.WorldBossConfig[tempArr[i].id];if(!bossConfig)continue;var bossLv=bossConfig.zsLevel*1e3+bossConfig.level;var canChallenge=void 0;if(bossConfig.samsaraLv){canChallenge=Actor.samsaraLv>=bossConfig.samsaraLv;if(!SamsaraModel.ins().isOpen()){continue}}else{canChallenge=roleLv>=bossLv}if(canChallenge){if(boo){if(isDie){remindDieArr.push(tempArr[i])}else{remindArr.push(tempArr[i])}}else{if(isDie){noRemindDieArr.push(tempArr[i])}else{noRemindArr.push(tempArr[i])}}}else{canNotPlayArr.push(tempArr[i])}}remindArr.sort(this.compareFn);remindDieArr.sort(this.compareFn);noRemindArr.sort(this.compareFn);noRemindDieArr.sort(this.compareFn);canNotPlayArr.sort(this.compareFn);bossInfos=remindArr.concat(remindDieArr,noRemindArr,canNotPlayArr,noRemindDieArr);this.listData.replaceAll(bossInfos);this.refushBarList(bossInfos)};PublicBossPanel.prototype.updateList=function(){for(var i=0;i<this.listData.length;i++){this.listData.itemUpdated(this.listData.getItemAt(i))}};PublicBossPanel.prototype.compareFn=function(a,b){var configA=GlobalConfig.WorldBossConfig[a.id];var configB=GlobalConfig.WorldBossConfig[b.id];if(configA.zsLevel<configB.zsLevel){return 1}else if(configA.zsLevel>configB.zsLevel){return-1}if(configA.level<configB.level)return 1;else if(configA.level>configB.level)return-1;else return 0};PublicBossPanel.prototype.onTouch=function(){GameGuider.guidance(egret.getQualifiedClassName(ForgeWin),2)};PublicBossPanel.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,this.type)};PublicBossPanel.prototype.refushBarList=function(wbitems){if(!this.showBossId){this.bossScroller.viewport.scrollV=0;return}for(var i=0;i<wbitems.length;i++){var wcfg=GlobalConfig.WorldBossConfig[wbitems[i].id];if(wcfg&&this.showBossId==wcfg.bossId){this.bossScroller.viewport.validateNow();this.bossScroller.viewport.scrollV=i*138;if(this.bossScroller.viewport.contentHeight-this.bossScroller.viewport.scrollV<this.bossScroller.viewport.height){this.bossScroller.viewport.scrollV=this.bossScroller.viewport.contentHeight-this.bossScroller.height}break}}};return PublicBossPanel}(BaseView);__reflect(PublicBossPanel.prototype,"PublicBossPanel");var ShenyuBossPanel=function(_super){__extends(ShenyuBossPanel,_super);function ShenyuBossPanel(){var _this=_super.call(this)||this;_this.isStartTime=false;_this.type=0;_this.restoreTime=0;return _this}ShenyuBossPanel.prototype.childrenCreated=function(){this.init()};ShenyuBossPanel.prototype.init=function(){this.list.itemRenderer=BossItem;this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>");this.setting.touchEnabled=true;this.listData=new eui.ArrayCollection;this.list.dataProvider=this.listData};ShenyuBossPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.type=UserBoss.BOSS_SUBTYPE_SHENYU;this.observe(UserBoss.ins().postWorldBoss,this.setData);this.observe(UserBoss.ins().postWorldBoss,this.calljoinPulbicChallenge);this.observe(UserBag.ins().postItemCountChange,this.UseToItem);this.setting.addEventListener(egret.TextEvent.LINK,this.onLink,this);this.addTouchEvent(this.buyBtn,this.onTap);this.addTouchEvent(this,this.onTap);this.setData();this.showBossId=param[0]};ShenyuBossPanel.prototype.close=function(){this.setting.removeEventListener(egret.TextEvent.LINK,this.onLink,this);this.removeObserve();TimerManager.ins().remove(this.updateTime,this);this.isStartTime=false};ShenyuBossPanel.prototype.showTips=function(){var count=UserBoss.ins().worldBossLeftTime[this.type];if(count>0){return true}var self=this;var tipText="";var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,ItemConst.SHENYUBOSS);if(item){tipText=i18n("ShenyuBossPanel_2");self.inUse=true;WarnWin.show(tipText,function(){self.isUse=true;self.inUse=false;UserBag.ins().sendUseItem(item.configID,1)},this,function(){self.inUse=false})}else{UserTips.ins().showTips(i18n("ShenyuBossPanel_1"));return}return false};ShenyuBossPanel.prototype.UseToItem=function(){if(this.isUse){this.isUse=false;UserBoss.ins().sendWorldBossInfo(this.type)}};ShenyuBossPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.buyBtn:if(!this.showTips())return;break;default:if(e.target instanceof eui.Button){var config=e.target.parent["config"];switch(e.target.name){case"shenyuChallenge":this.isJoin=true;this.config=config;this.eId=e.target.parent.data.id;if(!this.showTips())return;if(!this.joinPulbicChallenge(config))return;break}ViewManager.ins().close(LimitTaskView)}break}};ShenyuBossPanel.prototype.calljoinPulbicChallenge=function(){if(!this.joinPulbicChallenge(this.config))return;ViewManager.ins().close(LimitTaskView)};ShenyuBossPanel.prototype.joinPulbicChallenge=function(config){if(!config)return false;if(!this.isJoin)return false;this.isJoin=false;if(UserFb.ins().checkInFB())return false;if(UserBoss.ins().worldBossLeftTime[this.type]<=0){UserTips.ins().showTips(i18n("ShenyuBossPanel_10"))}else if(config.zsLevel<=UserZs.ins().lv&&config.level<=Actor.level){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH)}else{var endTime=Math.ceil((UserBoss.ins().worldBossCd[this.type]-egret.getTimer())/1e3);if(endTime>0){UserTips.ins().showTips(i18n("ShenyuBossPanel_11",endTime));return false}if(!this.inUse){UserBoss.ins().sendChallengWorldBoss(this.eId,this.type);ViewManager.ins().close(this);EasyLoading.ins().showLoading(5)}}}else{UserTips.ins().showTips(i18n("ShenyuBossPanel_12"))}return true};ShenyuBossPanel.prototype.updateTime=function(){if(this.timeTxt==undefined)return;var time=this.restoreTime-egret.getTimer();if(time<=0){TimerManager.ins().remove(this.updateTime,this);this.isStartTime=false;if(UserBoss.ins().worldBossLeftTime[this.type]>=GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1])this.timeTxt.visible=false;else{UserBoss.ins().sendWorldBossInfo(this.type)}}else{if(!this.timeTxt.visible)this.timeTxt.visible=true}var timeStr=DateUtils.getFormatBySecond(Math.floor(time/1e3),DateUtils.TIME_FORMAT_12);this.timeTxt.text=i18n("ShenyuBossPanel_13",timeStr)};ShenyuBossPanel.prototype.showJuan=function(itemData){if(!itemData){this.juan.visible=false;return}this.juan.visible=true;this.jicon.source=itemData.itemConfig.icon+"_png";this.jcount.text=itemData.count+""};ShenyuBossPanel.prototype.setData=function(){var leftTime=UserBoss.ins().worldBossLeftTime[this.type];this.buyBtn.visible=false;var itemData=UserBag.ins().getBagItemById(ItemConst.SHENYUBOSS);this.showJuan(itemData);this.challengeCountTxt.text=leftTime+"/"+GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1];var list=UserBoss.ins().worldInfoList[this.type]||[];var tempArr=list.slice();var bossInfos=[];var remindArr=[];var remindDieArr=[];var noRemindArr=[];var noRemindDieArr=[];var canNotPlayArr=[];var roleLv=UserZs.ins().lv*1e3+Actor.level;for(var i=0;i<tempArr.length;i++){var isDie=(tempArr[i].relieveTime-egret.getTimer())/1e3>0||tempArr[i].hp<=0;var boo=UserBoss.ins().getBossRemindByIndex(tempArr[i].id);var bossConfig=GlobalConfig.WorldBossConfig[tempArr[i].id];var bossLv=bossConfig.zsLevel*1e3+bossConfig.level;if(roleLv>=bossLv){if(boo){if(isDie){remindDieArr.push(tempArr[i])}else{remindArr.push(tempArr[i])}}else{if(isDie){noRemindDieArr.push(tempArr[i])}else{noRemindArr.push(tempArr[i])}}}else{canNotPlayArr.push(tempArr[i])}}remindArr.sort(this.compareFn);remindDieArr.sort(this.compareFn);noRemindArr.sort(this.compareFn);noRemindDieArr.sort(this.compareFn);canNotPlayArr.sort(this.compareFn);bossInfos=remindArr.concat(remindDieArr,noRemindArr,canNotPlayArr,noRemindDieArr);this.listData.replaceAll(bossInfos);if(!this.isStartTime){TimerManager.ins().doTimer(1e3,0,this.updateTime,this);this.restoreTime=UserBoss.ins().worldBossrestoreTime[this.type];this.isStartTime=true;this.updateTime()}this.refushBarList(bossInfos)};ShenyuBossPanel.prototype.compareFn=function(a,b){var configA=GlobalConfig.WorldBossConfig[a.id];var configB=GlobalConfig.WorldBossConfig[b.id];if(configA.zsLevel<configB.zsLevel){return 1}else if(configA.zsLevel>configB.zsLevel){return-1}if(configA.level<configB.level)return 1;else if(configA.level>configB.level)return-1;else return 0};ShenyuBossPanel.prototype.onTouch=function(){GameGuider.guidance(egret.getQualifiedClassName(ForgeWin),2)};ShenyuBossPanel.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,this.type)};ShenyuBossPanel.prototype.refushBarList=function(wbitems){if(!this.showBossId){this.bossScroller.viewport.scrollV=0;return}for(var i=0;i<wbitems.length;i++){var wcfg=GlobalConfig.WorldBossConfig[wbitems[i].id];if(wcfg&&this.showBossId==wcfg.bossId){this.bossScroller.viewport.validateNow();this.bossScroller.viewport.scrollV=i*138;if(this.bossScroller.viewport.contentHeight-this.bossScroller.viewport.scrollV<this.bossScroller.viewport.height){this.bossScroller.viewport.scrollV=this.bossScroller.viewport.contentHeight-this.bossScroller.height}break}}};return ShenyuBossPanel}(BaseView);__reflect(ShenyuBossPanel.prototype,"ShenyuBossPanel");var VipBossItem=function(_super){__extends(VipBossItem,_super);function VipBossItem(){return _super.call(this)||this}VipBossItem.prototype.dataChanged=function(){if(!this.data)return;var index=this.itemIndex+1;var config=GlobalConfig.BossHomeConfig[index];this.bg.source="vipbossb"+index};return VipBossItem}(BaseItemRender);__reflect(VipBossItem.prototype,"VipBossItem");var WildBossJoinItem=function(_super){__extends(WildBossJoinItem,_super);function WildBossJoinItem(){return _super.call(this)||this}WildBossJoinItem.prototype.dataChanged=function(){this.bg.visible=this.itemIndex%2==0;if(this.data[3]){this.txt0.text=this.data[0]}else this.txt0.text=this.itemIndex+1+"";this.txt1.text=this.data[1];this.txt2.text=this.data[2]};return WildBossJoinItem}(BaseItemRender);__reflect(WildBossJoinItem.prototype,"WildBossJoinItem");var WorldBossItem=function(_super){__extends(WorldBossItem,_super);function WorldBossItem(){var _this=_super.call(this)||this;_this.addEventListener(egret.Event.REMOVED_FROM_STAGE,_this.onRemove,_this);return _this}WorldBossItem.prototype.dataChanged=function(){if(!this.data)return;var config=GlobalConfig.WorldBossConfig[this.data.id];if(!config)return;var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];TimerManager.ins().remove(this.updateTime,this);this.titleText.text=bossBaseConfig.name;if(this.data.bossState==2||this.data.bossState==0){this.killImg.visible=false;this.updateTime();TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}else if(this.data.bossState==1){this.timeTxt.text=i18n("WorldBossItem_2");this.killImg.visible=true}else{this.killImg.visible=false}};WorldBossItem.prototype.updateTime=function(){var time=this.data.relieveTime-egret.getTimer();this.timeTxt.text=DateUtils.getFormatBySecond(Math.floor(time/1e3),1)+"后重生";if(time<=0){TimerManager.ins().remove(this.updateTime,this);this.timeTxt.text=""}};WorldBossItem.prototype.onRemove=function(e){TimerManager.ins().remove(this.updateTime,this)};return WorldBossItem}(BaseItemRender);__reflect(WorldBossItem.prototype,"WorldBossItem");var WorldBossItemMain=function(_super){__extends(WorldBossItemMain,_super);function WorldBossItemMain(){return _super.call(this)||this}WorldBossItemMain.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=WorldBossItem;this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this);this.listData=new eui.ArrayCollection;this.list.dataProvider=this.listData};WorldBossItemMain.prototype.onTap=function(e){var data=this.listData.getItemAt(e.itemIndex);this.data.clickCall(data)};WorldBossItemMain.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.listData.source=data.arr;this.list.selectedIndex=data.selectIndex;if(data.type==UserBoss.BOSS_SUBTYPE_WORLDBOSS)this.title.source="title_mijingboss";else if(data.type==UserBoss.BOSS_SUBTYPE_DARKBOSS)this.title.source="title_anzhimijingboss";var redPoint=false;if(UserBoss.ins().worldBossLeftTime[data.type]){redPoint=UserBoss.ins().checkWorldBossRedPoint(data.type)}this.redPoint.visible=redPoint};return WorldBossItemMain}(BaseItemRender);__reflect(WorldBossItemMain.prototype,"WorldBossItemMain");var WorldBossMainPanel=function(_super){__extends(WorldBossMainPanel,_super);function WorldBossMainPanel(){var _this=_super.call(this)||this;_this.endTime=0;return _this}WorldBossMainPanel.prototype.childrenCreated=function(){this.init()};WorldBossMainPanel.prototype.init=function(){this.list.itemRenderer=WorldBossItemMain;this.dropRewardList.itemRenderer=ItemBase;this.bossImage=new MovieClip;this.bossImage.scaleX=-1;this.bossImage.scaleY=1;this.bossImage.x=78;this.bossImage.y=165;this.bossGroup.touchEnabled=this.bossGroup.touchChildren=false;this.bossDiMc=new MovieClip;this.bossDiGroup.addChild(this.bossDiMc);this.bossDiMc.playFile(RES_DIR_EFF+"bossdz_eff",-1);this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>");this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>");this.remindTpis.touchEnabled=true;this.listData=new eui.ArrayCollection;this.list.dataProvider=this.listData};WorldBossMainPanel.prototype.open=function(){var dataList=[];var type=UserBoss.BOSS_SUBTYPE_WORLDBOSS;var canPlayList=UserBoss.ins().worldBossPlayList[type].slice();if(!canPlayList.length){UserBoss.ins().updateBossPlayList(type);canPlayList=UserBoss.ins().worldBossPlayList[type].slice()}canPlayList.sort(this.sortList);dataList.push({type:type,arr:canPlayList,selectIndex:0,clickCall:this.onClickList.bind(this)});if(UserZs.ins().lv>=5&&GameServer.serverOpenDay>=GlobalConfig.WorldBossBaseConfig.canSeeDarkBossDay-1){type=UserBoss.BOSS_SUBTYPE_DARKBOSS;canPlayList=UserBoss.ins().worldBossPlayList[type].slice();if(!canPlayList.length){UserBoss.ins().updateBossPlayList(type);canPlayList=UserBoss.ins().worldBossPlayList[type].slice()}canPlayList.sort(this.sortList);dataList.push({type:type,arr:canPlayList,selectIndex:-1,clickCall:this.onClickList.bind(this)})}if(this.bossImage&&!this.bossImage.parent){this.bossGroup.addChild(this.bossImage)}this.observe(UserBoss.ins().postWorldBoss,this.setWin);this.observe(UserBoss.ins().postWorldBoss,this.joinWorldBoss);this.observe(UserBag.ins().postItemCountChange,this.UseToItem);this.listData.source=dataList;this.list.scrollV=0;this.list.selectedIndex=0;this.currData=dataList[0].arr[0];this.addTouchEvent(this.challengeBtn,this.onTap);this.addTouchEvent(this.getItemTxt,this.onTap);this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this);this.setWin()};WorldBossMainPanel.prototype.sortList=function(a,b){if(a.id<b.id)return-1;return 1};WorldBossMainPanel.prototype.onClickMenu=function(e){var data=this.list.dataProvider.getItemAt(e.itemIndex);if(data.type==UserBoss.BOSS_SUBTYPE_DARKBOSS&&data.arr.length==0){UserTips.ins().showTips(i18n("WorldBossMainPanel_0"))}};WorldBossMainPanel.prototype.onClickList=function(data){this.currData=data;var config=GlobalConfig.WorldBossConfig[this.currData.id];for(var i=0;i<this.listData.length;i++){var source=this.listData.getItemAt(i);if(config.type==source.type){source.selectIndex=source.arr.indexOf(data)}else{source.selectIndex=-1;this.listData.itemUpdated(source)}}this.setWin()};WorldBossMainPanel.prototype.setWin=function(){if(!this.currData)return;var config=GlobalConfig.WorldBossConfig[this.currData.id];var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];var lvStr=config.zsLevel>0?i18n("WorldBossMainPanel_1",config.zsLevel):i18n("WorldBossMainPanel_2",config.level);this.nameTxt.text=i18n("WorldBossMainPanel_3",bossBaseConfig.name,config.zslook[0],config.zslook[config.zslook.length-1]);var str=i18n("WorldBossMainPanel_4");if(this.currData.roleName!=""){str=this.currData.roleName;if(this.currData.guildName!=""){str=this.currData.guildName!="null"?str+"("+this.currData.guildName+")":str}}if(this.currData.bossState==2){this.stateImage.source="zdbossyijisha"}else if(this.currData.bossState==1){this.stateImage.source="zdbosskejisha"}else{this.stateImage.source=""}if(this.currData.canChallenge){this.challengeBtn.skin.currentState="up";this.challengeBtn.touchEnabled=true}else{this.challengeBtn.skin.currentState="disabled";this.challengeBtn.touchEnabled=false}if(!this.dropRewardList.dataProvider){this.dropRewardList.dataProvider=new eui.ArrayCollection(config.showReward.concat())}else{this.dropRewardList.dataProvider["source"]=config.showReward.concat()}this.playerNameTxt.text=str;var count=UserBoss.ins().worldBossLeftTime[config.type];var txt=config.type==UserBoss.BOSS_SUBTYPE_WORLDBOSS?i18n("WorldBossMainPanel_6"):i18n("WorldBossMainPanel_7");this.leftText.text=i18n("WorldBossMainPanel_8",txt,count);this.getItemTxt.visible=count>0||config.type==UserBoss.BOSS_SUBTYPE_DARKBOSS?false:true;this.endTime=Math.floor((UserBoss.ins().worldBossCd[config.type]-egret.getTimer())/1e3);if(this.endTime>0){this.challengeBtn.visible=false;this.updateTime();TimerManager.ins().doTimer(100,0,this.updateTime,this);str=DateUtils.getFormatBySecond(this.endTime,5,3);this.leftCDText.text=i18n("WorldBossMainPanel_9",str)}else{this.leftCDText.text=""}this.bossImage.playFile(RES_DIR_MONSTER+("monster"+bossBaseConfig.avatar+"_3s"),-1);for(var i=0;i<4;i++){var item=void 0;switch(i){case 0:item=GlobalConfig.ItemConfig[config.joinReward];break;case 1:item=GlobalConfig.ItemConfig[config.shieldReward];break;case 2:item=GlobalConfig.ItemConfig[config.belongReward];break;case 3:item=GlobalConfig.ItemConfig[config.killReward];break}}if(config.type==UserBoss.BOSS_SUBTYPE_WORLDBOSS){var itemData=UserBag.ins().getBagItemById(ItemConst.WORLDBOSS);this.showJuan(itemData)}else{this.showJuan(null)}};WorldBossMainPanel.prototype.showJuan=function(itemData){if(!itemData){this.juan.visible=false;return}this.juan.visible=true;this.jicon.source=itemData.itemConfig.icon+"_png";this.jcount.text=itemData.count+""};WorldBossMainPanel.prototype.updateTime=function(){if(!this.currData)return;var config=GlobalConfig.WorldBossConfig[this.currData.id];var time=Math.floor((UserBoss.ins().worldBossCd[config.type]-egret.getTimer())/1e3);this.leftCDText.text=i18n("WorldBossMainPanel_10",DateUtils.getFormatBySecond(time,5,3));if(time<=0){TimerManager.ins().remove(this.updateTime,this);this.leftCDText.text="";this.challengeBtn.visible=true}};WorldBossMainPanel.prototype.showTips=function(){var self=this;if(!this.currData)return;var config=GlobalConfig.WorldBossConfig[this.currData.id];var count=UserBoss.ins().worldBossLeftTime[config.type];if(count>0){return true}if(config.type==UserBoss.BOSS_SUBTYPE_DARKBOSS){UserTips.ins().showTips(i18n("WorldBossMainPanel_11"));return}var tipText="";var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,ItemConst.WORLDBOSS);if(item){tipText=i18n("WorldBossMainPanel_12");WarnWin.show(tipText,function(){self.isUse=true;UserBag.ins().sendUseItem(item.configID,1)},this)}else{var vipConfig=GlobalConfig.VipConfig[UserVip.ins().lv];if(!vipConfig){UserTips.ins().showTips(i18n("WorldBossMainPanel_13"));return false}if(!vipConfig.boss2buy){var warnWin=WarnWin.show(i18n("WorldBossMainPanel_15"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("WorldBossMainPanel_16"));return false}var currentUse=UserBoss.ins().worldChallengeTime[config.type];if(count<=0&&currentUse>=vipConfig.boss2buy){UserTips.ins().showTips(i18n("WorldBossMainPanel_17"));return}if(Actor.yb<GlobalConfig.WorldBossBaseConfig.buyCountPrice[config.type-1]){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("WorldBossMainPanel_18"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("WorldBossMainPanel_19"))}return false}tipText=i18n("WorldBossMainPanel_20",GlobalConfig.WorldBossBaseConfig.buyCountPrice[config.type-1])+i18n("WorldBossMainPanel_21",currentUse,vipConfig.boss2buy);WarnWin.show(tipText,function(){UserBoss.ins().sendBuyChallengeTimes(config.type)},this)}return false};WorldBossMainPanel.prototype.UseToItem=function(){if(!this.currData)return;var config=GlobalConfig.WorldBossConfig[this.currData.id];if(this.isUse){this.isUse=false;UserBoss.ins().sendWorldBossInfo(config.type)}};WorldBossMainPanel.prototype.joinWorldBoss=function(){if(!this.isJoin||!this.currData)return;var config=GlobalConfig.WorldBossConfig[this.currData.id];this.isJoin=false;if(UserFb.ins().checkInFB())return;if(Math.floor((UserBoss.ins().worldBossCd[config.type]-egret.getTimer())/1e3)>0){UserTips.ins().showTips(i18n("WorldBossMainPanel_22"));return}var roleLv=UserZs.ins().lv*1e3+Actor.level;var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];var bossLv=config.zsLevel*1e3+config.level;if(bossLv>roleLv){var str=config.zsLevel>0?i18n("WorldBossMainPanel_23",config.zsLevel):i18n("WorldBossMainPanel_24",config.level);UserTips.ins().showTips(i18n("WorldBossMainPanel_25",str));return}if(UserBag.ins().getSurplusCount()<UserBoss.WB_BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin,UserBoss.WB_BAG_ENOUGH)}else{ViewManager.ins().close(BossWin);UserBoss.ins().sendChallengWorldBoss(this.currData.id,config.type);EasyLoading.ins().showLoading(5)}ViewManager.ins().close(LimitTaskView)};WorldBossMainPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.challengeBtn:this.isJoin=true;if(!this.showTips())return;this.joinWorldBoss();break;case this.getItemTxt:if(!this.showTips())return;break}};WorldBossMainPanel.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,UserBoss.BOSS_SUBTYPE_DARKBOSS)};WorldBossMainPanel.prototype.close=function(){this.removeObserve();this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this);this.removeTouchEvent(this.challengeBtn,this.onTap);this.removeTouchEvent(this.getItemTxt,this.onTap);this.remindTpis.removeEventListener(egret.TextEvent.LINK,this.onLink,this)};return WorldBossMainPanel}(BaseView);__reflect(WorldBossMainPanel.prototype,"WorldBossMainPanel");var BossHomeMainWin=function(_super){__extends(BossHomeMainWin,_super);function BossHomeMainWin(){var _this=_super.call(this)||this;_this.openItemID=1015002;_this.isStartTime=false;_this.type=0;_this.restoreTime=0;_this.nowSelectState=0;return _this}BossHomeMainWin.prototype.childrenCreated=function(){this.init()};BossHomeMainWin.prototype.init=function(){this.list.itemRenderer=HomeBossItem;this.list1.itemRenderer=HomeBossItem1;this.ranklist.itemRenderer=RankItemRenderer1;this.nowSelectState=0;this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>");this.setting.touchEnabled=true;this.canopen_listData=new eui.ArrayCollection;this.rooming_listData=new eui.ArrayCollection;this.roomrank_listData=new eui.ArrayCollection;this.list.dataProvider=this.canopen_listData;this.list1.dataProvider=this.rooming_listData;this.ranklist.dataProvider=this.roomrank_listData};BossHomeMainWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.type=UserBoss.BOSS_SUBTYPE_HOMEBOSS;this.canOpenGroup.visible=true;this.OpeningGroup.visible=false;this.mainGroup.visible=true;this.showRankGroup.visible=false;this.redPoint0.visible=false;this.observe(BossHomeSys.ins().postCanOpenBossData,this.setCanOpenData);this.observe(BossHomeSys.ins().postRoomingBossData,this.setRoomingData);this.observe(UserBag.ins().postItemAdd,this.updateTicket);this.addTouchEvent(this.canOpenBtn,this.onTap);this.addTouchEvent(this.OpeningBtn,this.onTap);TimerManager.ins().doTimer(2e3,0,this.getNewInfo,this);if(BossHomeSys.ins().bosslistLength1>0||param[0]==1){this.initRoomingView()}else{this.initcanOpenView()}};BossHomeMainWin.prototype.getNewInfo=function(){BossHomeSys.ins().sendRoomingBossInfo(UserBoss.BOSS_SUBTYPE_HOMEBOSS)};BossHomeMainWin.prototype.close=function(){this.removeObserve();TimerManager.ins().removeAll(this);this.isStartTime=false};BossHomeMainWin.prototype.onTap=function(e){var tar=e.currentTarget;switch(tar){case this.canOpenBtn:this.initcanOpenView();break;case this.OpeningBtn:this.initRoomingView();break}};BossHomeMainWin.prototype.initcanOpenView=function(){this.setCanOpenData();this.canOpenBtn.currentState="down";this.OpeningBtn.currentState="up";this.Scroller0.visible=true;this.Scroller1.visible=false;this.canOpenGroup.visible=true;this.OpeningGroup.visible=false;this.nowOpenTipsGroup.visible=false;this.showRankGroup.visible=false;this.updateTicket();BossHomeSys.ins().sendCanOpenBossInfo(UserBoss.BOSS_SUBTYPE_HOMEBOSS)};BossHomeMainWin.prototype.initRoomingView=function(){this.setRoomingData();this.canOpenBtn.currentState="up";this.OpeningBtn.currentState="down";this.Scroller0.visible=false;this.Scroller1.visible=true;this.canOpenGroup.visible=false;this.OpeningGroup.visible=true;this.nowOpenTipsGroup.visible=true;this.Retime.visible=false;BossHomeSys.ins().sendRoomingBossInfo(UserBoss.BOSS_SUBTYPE_HOMEBOSS)};BossHomeMainWin.prototype.updatejoinNum=function(){this.joinnum.text=BossHomeSys.ins().nowjoinletfTime+"/"+GlobalConfig.WorldBossBaseConfig.bhChallengeTimeLimit;this.joinitemnum.text="("+UserBag.ins().getBagGoodsCountById(0,GlobalConfig.WorldBossBaseConfig.bhChallengeItem)+")"};BossHomeMainWin.prototype.updateTicket=function(){var str=i18n("BossHomeMainWin_5")+UserBag.ins().getBagGoodsCountById(0,this.openItemID)+"|";this.openticketText.textFlow=TextFlowMaker.generateTextFlow(str)};BossHomeMainWin.prototype.setCanOpenData=function(){var scro=this.list.parent;scro.stopAnimation();this.list.scrollV=0;this.noBossTips.visible=false;var tempArr=BossHomeSys.ins().canOpenBossInfoList;var bossInfos=[];var canPlayArr=[];var canNotLevel=[];var roleLv=UserZs.ins().lv*1e3+Actor.level;for(var i=0;i<tempArr.length;i++){var bossConfig=GlobalConfig.WorldBossConfig[tempArr[i].canopen_id];var bossLv=bossConfig.zsLevel*1e3+bossConfig.level;if(roleLv<bossLv){canNotLevel.push(tempArr[i])}else{canPlayArr.push(tempArr[i])}}canPlayArr.sort(this.compareFn);canNotLevel.sort(this.compareFn);bossInfos=canPlayArr.concat(canNotLevel);this.canopen_listData.replaceAll(bossInfos);if(this.canopen_listData.length==0){this.noBossTips.visible=true}};BossHomeMainWin.prototype.setRoomingData=function(){var scro=this.list1.parent;scro.stopAnimation();this.list1.scrollV=0;this.noBossTips.visible=false;var str=i18n("BossHomeMainWin_0")+BossHomeSys.ins().bosslistLength1+i18n("BossHomeMainWin_1");this.nowOpenTips.textFlow=TextFlowMaker.generateTextFlow(str);var tempArr=BossHomeSys.ins().roomingBossInfoList;var bossInfos=[];var canPlayArr=[];var canNotLevelArr=[];var RoomingRankInfo=[];var roleLv=UserZs.ins().lv*1e3+Actor.level;var isChallengeShow=false;this.showRankGroup.visible=false;var index=-1;for(var i=0;i<tempArr.length;i++){var bossConfig=GlobalConfig.WorldBossConfig[tempArr[i].room_bossid];var bossLv=bossConfig.zsLevel*1e3+bossConfig.level;var room_ischallengeing=tempArr[i].room_ischallengeing;if(roleLv<bossLv){canNotLevelArr.push(tempArr[i])}else{canPlayArr.push(tempArr[i])}if(room_ischallengeing==1){RoomingRankInfo.push(tempArr[i]);isChallengeShow=true;index=i}}canPlayArr.sort(this.compareFn);canNotLevelArr.sort(this.compareFn);bossInfos=canPlayArr.concat(canNotLevelArr);if(isChallengeShow){this.nowOpenTips.text=i18n("BossHomeMainWin_4");this.rooming_listData.replaceAll(RoomingRankInfo);this.setRoomRankData(index)}else this.rooming_listData.replaceAll(bossInfos);if(this.rooming_listData.length==0&&this.OpeningBtn.currentState=="down"){this.noBossTips.visible=true}if(!this.isStartTime&&BossHomeSys.ins().nowjoinletfTime<GlobalConfig.WorldBossBaseConfig.bhChallengeTimeLimit){TimerManager.ins().doTimer(1e3,0,this.updateTime,this);this.restoreTime=BossHomeSys.ins().joinRecoverTime;this.isStartTime=true;this.updateTime()}this.updatejoinNum();this.updateshowRedPoint()};BossHomeMainWin.prototype.updateshowRedPoint=function(){if(BossHomeSys.ins().bosslistLength1>0){this.redPoint0.visible=true}else this.redPoint0.visible=false};BossHomeMainWin.prototype.setRoomRankData=function(index){if(this.OpeningBtn.currentState=="down")this.showRankGroup.visible=true;var ranklist=BossHomeSys.ins().roomingBossInfoList[index].bosshomeShowrank;var dataArr=ranklist?ranklist:[];var len=dataArr.length;if(len){if(len>10){len=10}var showArr=dataArr.slice(0,len);this.roomrank_listData.replaceAll(showArr)}};BossHomeMainWin.prototype.updateTime=function(){if(this.Retime==undefined)return;var time=this.restoreTime-egret.getTimer();if(time<0){this.restoreTime=BossHomeSys.ins().joinRecoverTime;time=0}if(time<=0){this.updatejoinNum();BossHomeSys.ins().sendRoomingBossInfo(UserBoss.BOSS_SUBTYPE_HOMEBOSS);if(BossHomeSys.ins().nowjoinletfTime>=GlobalConfig.WorldBossBaseConfig.bhChallengeTimeLimit){TimerManager.ins().remove(this.updateTime,this);this.isStartTime=false;this.Retime.visible=false}}else{if(!this.Retime.visible)this.Retime.visible=true}var timeStr=DateUtils.getFormatBySecond(Math.floor(time/1e3),DateUtils.TIME_FORMAT_12);this.Retime.text=i18n("BossHomeMainWin_3",timeStr)};BossHomeMainWin.prototype.compareFn=function(a,b){var configA=GlobalConfig.WorldBossConfig[a.canopen_id];var configB=GlobalConfig.WorldBossConfig[b.canopen_id];if(configA&&configB){if(configA.zsLevel<configB.zsLevel){return 1}else if(configA.zsLevel>configB.zsLevel){return-1}if(configA.level<configB.level)return 1;else if(configA.level>configB.level)return-1;else return 0}else return 0};BossHomeMainWin.prototype.onTouch=function(){GameGuider.guidance(egret.getQualifiedClassName(ForgeWin),2)};return BossHomeMainWin}(BaseView);__reflect(BossHomeMainWin.prototype,"BossHomeMainWin");ViewManager.ins().reg(BossHomeMainWin,LayerManager.UI_Main);var BossWin=function(_super){__extends(BossWin,_super);function BossWin(){var _this=_super.call(this)||this;_this.lastIndex=0;_this.skinName="BossSkin";_this.isTopLevel=true;return _this}BossWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.redPoint2.visible=false;if(UserBoss.ins().checkShenyuOpen()){this.redPoints=[];for(var i=0;i<5;i++){this.redPoints.push(this["redPoint"+i])}if(!this.shenyuBoss.parent){this.viewStack.addChildAt(this.shenyuBoss,3)}}else{this.redPoints=[];for(var i=0;i<5;i++){i!=3&&this.redPoints.push(this["redPoint"+i])}if(this.shenyuBoss.parent){this.viewStack.removeChild(this.shenyuBoss)}}this.validateNow();var redPointGap=115;var len=this.viewStack.numChildren;var startHor=-182;if(len==4)startHor=-120;for(var i=0;i<len;i++){if(i==0)this.redPoints[i].horizontalCenter=startHor;else this.redPoints[i].horizontalCenter=this.redPoints[i-1].horizontalCenter+redPointGap}};BossWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}UserBoss.ins().init();BossHomeSys.ins().init();this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this,this.onTap);this.addTouchEvent(this.seeRule,this.onTap);this.addChangeEvent(this.tab,this.setSelectedIndex);this.addChangingEvent(this.tab,this.checkIsOpen);this.observe(UserBoss.ins().postWorldBoss,this.updateRedPoint);this.observe(UserFb.ins().postUpDataInfo,this.updatePanel);this.observe(UserFb.ins().postUpDataInfo,this.updateRedPoint);if(param[0]==undefined){var tempArr=UserBoss.ins().getListData()[0];if(tempArr.length==0){param[0]=1}}this.lastSelect=param.length?param[0]:0;if(this.lastSelect>this.viewStack.numChildren-1){this.lastSelect=this.viewStack.numChildren-1}this.viewStack.selectedIndex=this.lastSelect;this.tab.selectedIndex=this.lastSelect;this.viewStack.getElementAt(this.lastSelect)["open"](param[1]);this.updateRedPoint();ViewManager.ins().close(GuildMap);ViewManager.ins().close(GuildActivityWin);ViewManager.ins().close(TreasureHuntWin);this.checkHelpBtn()};BossWin.prototype.updatePanel=function(){this.viewStack.getElementAt(this.lastSelect)["close"]();this.lastSelect=this.viewStack.selectedIndex;this.viewStack.getElementAt(this.lastSelect)["open"]();this.checkHelpBtn()};BossWin.prototype.setSelectedIndex=function(e){this.viewStack.getElementAt(this.lastSelect)["close"]();this.lastSelect=this.viewStack.selectedIndex;if(this.lastSelect<=1)this.viewStack.getElementAt(this.lastSelect)["open"]();else{if(UserFb.ins().isCloseFbEntrance)UserTips.ins().showTips(i18n("BossWin_0"));else{this.viewStack.getElementAt(this.lastSelect)["open"]()}}this.checkHelpBtn()};BossWin.prototype.checkHelpBtn=function(){if(UserBoss.ins().checkShenyuOpen()){if(this.lastSelect==3){this.seeRule.visible=false}else{this.seeRule.visible=true}}else{this.seeRule.visible=true}};BossWin.prototype.updateRedPoint=function(){this.redPoint0.visible=UserFb.isCanChallenge();this.redPoint1.visible=UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_QMBOSS);this.redPoint2.visible=UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_WORLDBOSS)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_DARKBOSS);this.redPoint3.visible=UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_SHENYU);this.redPoint4.visible=UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_HOMEBOSS)};BossWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.viewStack.getElementAt(this.lastSelect)["close"]()};BossWin.prototype.onLink=function(e){var _this=this;var cost=GlobalConfig.WorldBossBaseConfig.clearCdCost[UserBoss.ins().currBossSubType-1];WarnWin.show(i18n("BossWin_1",cost),function(){ViewManager.ins().close(_this);UserBoss.ins().sendClearCD()},this)};BossWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:if(this.viewStack.selectedIndex==4){ViewManager.ins().open(ZsBossRuleSpeak,12)}else if(this.viewStack.selectedIndex==3&&!UserBoss.ins().checkShenyuOpen()){ViewManager.ins().open(ZsBossRuleSpeak,12)}else{ViewManager.ins().open(ZsBossRuleSpeak,this.viewStack.selectedIndex+1)}break;default:if(e.target instanceof eui.Button){var config=e.target.parent["config"];switch(e.target.name){case"publicChallenge":return;case"homebossopen":if(UserFb.ins().checkInFB())return;this.onhomebossOpen(config,e.target.parent.data.canopen_id);break;case"homebossjoin":this.onhomebossJoin(e);break;case"ZsBoss":break}ViewManager.ins().close(LimitTaskView)}}};BossWin.prototype.onhomebossOpen=function(config,canopen_id){if(config.zsLevel<=UserZs.ins().lv&&config.level<=Actor.level){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH)}else{var boss=GlobalConfig.MonstersConfig[config.bossId];var ticketNum=GlobalConfig.BossHomeBaseConfig[canopen_id].need[0].count;var warnTips=i18n("BossWin_14")+ticketNum+i18n("BossWin_15")+boss.name+i18n("BossWin_16");if(UserBag.ins().getBagGoodsCountById(0,GlobalConfig.BossHomeBaseConfig[canopen_id].need[0].item)>=ticketNum){WarnWin.show(warnTips,function(){BossHomeSys.ins().sendCreateRoom(canopen_id)},this,null,null,"normal")}else UserTips.ins().showTips(i18n("BossWin_20"))}}else{UserTips.ins().showTips(i18n("BossWin_6"))}};BossWin.prototype.onhomebossJoin=function(e){var data=e.target.parent.data;if(data.room_relieveTime<=0){UserTips.ins().showTips(i18n("BossWin_18"))}else{if(BossHomeSys.ins().nowjoinletfTime==0&&BossHomeSys.ins().nowhomehostName!=Actor.myName){var warnTips=i18n("BossWin_19");WarnWin.show(warnTips,function(){BossHomeSys.ins().sendEnterRoom(data.room_rid)},this,null,null,"normal")}else BossHomeSys.ins().sendEnterRoom(e.target.parent.data.room_rid)}};BossWin.prototype.checkIsOpen=function(e){var tab=e.target;var zsLv=1;ViewManager.ins().close(LimitTaskView);if(tab.selectedIndex==2&&UserZs.ins().lv<zsLv){UserTips.ins().showTips(i18n("BossWin_7",zsLv));e.$cancelable=true;e.preventDefault();return}if(UserFb.ins().isCloseFbEntrance&&tab.selectedIndex>1){UserTips.ins().showTips(i18n("BossWin_8"));e.preventDefault();return}};BossWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_WORLDBOSS]&&!UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_QMBOSS]){UserTips.ins().showTips(i18n("BossWin_10"));UserBoss.ins().init();return false}if(param&&param.length){if(param[0]==2){var zsLv=1;if(UserZs.ins().lv<zsLv){UserTips.ins().showTips(i18n("BossWin_11",zsLv));return false}return true}else if(param[0]==4){if(!UserBoss.ins().checkShenyuOpen()){UserTips.ins().showTips(i18n("BossWin_12",GlobalConfig.WorldBossBaseConfig.shenyuOpenDay));return false}}}if(OpenSystem.ins().checkSysOpen(SystemType.BOSS)){if(!FbWin.isClose)ViewManager.ins().close(LiLianWin);FbWin.isClose=false;return true}else{UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOSS));return false}};return BossWin}(BaseEuiView);__reflect(BossWin.prototype,"BossWin");ViewManager.ins().reg(BossWin,LayerManager.UI_Main);var HideBossBtnWin=function(_super){__extends(HideBossBtnWin,_super);function HideBossBtnWin(){var _this=_super.call(this)||this;_this.skinName="HideBossBtnSkin";return _this}HideBossBtnWin.prototype.childrenCreated=function(){this.eff_dragon.touchEnabled=false;this.eff_dragon.touchChildren=false;this.hideBossBtn.visible=false;this.eff_dragon.visible=false};HideBossBtnWin.prototype.initUI=function(){this.hideBossBtn.visible=false;this.eff_dragon.visible=false};HideBossBtnWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(param[0]){this.playDragonEff()}else{this.showBtn()}};HideBossBtnWin.prototype.onTap=function(){if(!GameMap.sceneInMain()){UserTips.ins().showCenterTips(i18n("HideBossBtnWin_0"));return}if(Encounter.ins().isEncounter()){UserTips.ins().showCenterTips(i18n("HideBossBtnWin_1"));return}ViewManager.ins().open(HideBossWin)};HideBossBtnWin.prototype.playDragonEff=function(){var _this=this;var mc=ObjectPool.pop("MovieClip");mc.addEventListener(egret.Event.CHANGE,this.onloadComp,this);mc.playFile(RES_DIR_EFF+"luckyboss_dragon_down",1,function(){mc.removeEventListener(egret.Event.CHANGE,_this.onloadComp,_this);mc.destroy()});this.eff_dragon.visible=true;this.eff_dragon.addChild(mc)};HideBossBtnWin.prototype.onloadComp=function(){TimerManager.ins().doTimer(400,1,this.showBtn,this)};HideBossBtnWin.prototype.showBtn=function(){if(Assert(UserBoss.ins().hideBossData.id,"hideBossData id:"+UserBoss.ins().hideBossData.id)){ViewManager.ins().close(this);return}this.hideBossBtn.visible=true;this.addTouchEvent(this.hideBossBtn,this.onTap);var config=GlobalConfig.MonstersConfig[GlobalConfig.HideBossConfig[UserBoss.ins().hideBossData.id].bossId];this.hideBossBtn["headImg"].source="monhead"+config.head+"_png";this._sec=Math.floor((DateUtils.formatMiniDateTime(UserBoss.ins().hideBossData.endTime)-GameServer.serverTime)/1e3);this.lbTime.text=DateUtils.getFormatBySecond(this._sec,DateUtils.TIME_FORMAT_1);TimerManager.ins().remove(this.setTime,this);TimerManager.ins().doTimer(1e3,0,this.setTime,this);if(!this.mcBtn){this.mcBtn=ObjectPool.pop("MovieClip");this.mcBtn.playFile(RES_DIR_EFF+"luckyboss_hint",-1)}if(!this.mcBtn.parent)this.hideBossBtn["eff_btn"].addChild(this.mcBtn)};HideBossBtnWin.prototype.setTime=function(){if(this._sec>0){this._sec-=1;this.lbTime.text=DateUtils.getFormatBySecond(this._sec,DateUtils.TIME_FORMAT_1)}else{UserBoss.ins().hideBossData.id=0;UserBoss.ins().hideBossData.endTime=0;ViewManager.ins().close(this)}};HideBossBtnWin.prototype.close=function(){if(this.mcBtn)this.mcBtn.destroy();this.mcBtn=null};return HideBossBtnWin}(BaseEuiView);__reflect(HideBossBtnWin.prototype,"HideBossBtnWin");ViewManager.ins().reg(HideBossBtnWin,LayerManager.UI_Main);var HideBossWin=function(_super){__extends(HideBossWin,_super);function HideBossWin(){var _this=_super.call(this)||this;_this.skinName="LuckyBossSkin";return _this}HideBossWin.prototype.childrenCreated=function(){this.boss.touchEnabled=false;this.boss.touchChildren=false;this.dropRewardList.itemRenderer=ItemBase};HideBossWin.prototype.open=function(){this.addTouchEvent(this.challengeBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.showBoss();this.showAward()};HideBossWin.prototype.close=function(){if(this.bossMc)this.bossMc.destroy();this.bossMc=null};HideBossWin.prototype.showAward=function(){var id=UserBoss.ins().hideBossData.id;var rewardShow=GlobalConfig.HideBossConfig[id].rewardShow;this.dropRewardList.dataProvider=new eui.ArrayCollection(rewardShow.concat())};HideBossWin.prototype.showBoss=function(){if(!this.bossMc){var bossImage=ObjectPool.pop("MovieClip");this.bossMc=bossImage;bossImage.scaleX=-1;bossImage.scaleY=1;bossImage.x=78;bossImage.y=50;this.boss.addChild(bossImage)}var id=UserBoss.ins().hideBossData.id;var bossId=GlobalConfig.HideBossConfig[id].bossId;var bossBaseConfig=GlobalConfig.MonstersConfig[bossId];this.bossMc.playFile(RES_DIR_MONSTER+("monster"+bossBaseConfig.avatar+"_3s"),-1)};HideBossWin.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.bgClose){ViewManager.ins().close(this)}else if(tar==this.challengeBtn){if(Encounter.ins().isEncounter()){UserTips.ins().showCenterTips(i18n("HideBossWin_0"))}else if(GameMap.sceneInMain()){UserBoss.ins().hideBossData.lastId=UserBoss.ins().hideBossData.id;UserBoss.ins().sendChallengeHideBoss();ViewManager.ins().close(this)}else{UserTips.ins().showCenterTips(i18n("HideBossWin_1"))}}};return HideBossWin}(BaseEuiView);__reflect(HideBossWin.prototype,"HideBossWin");ViewManager.ins().reg(HideBossWin,LayerManager.UI_Popup);var PubBossRemindWin=function(_super){__extends(PubBossRemindWin,_super);function PubBossRemindWin(){var _this=_super.call(this)||this;_this.skinName="PubBossRemindSkin";_this.isTopLevel=true;return _this}PubBossRemindWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.listDatas=new eui.ArrayCollection};PubBossRemindWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.type=param[0];var tempArr=[];var list=UserBoss.ins().worldInfoList[this.type]||[];tempArr=list.slice();if(this.type==UserBoss.BOSS_SUBTYPE_QMBOSS){this.skin.currentState="hasCheckBox";this.list0.itemRenderer=PubBossRemindItem;this.autoChallenge.selected=AutoChallengeBoss.ins().autoYewaiBoss;this.autoCost.selected=AutoChallengeBoss.ins().autoCostYewaiBoss}else if(this.type==UserBoss.BOSS_SUBTYPE_HOMEBOSS){}else if(this.type==UserBoss.BOSS_SUBTYPE_DARKBOSS){this.skin.currentState="noCheckBox";this.list0.itemRenderer=PubBossRemindItem}else if(this.type==UserBoss.BOSS_SUBTYPE_GODWEAPON){this.skin.currentState="noCheckBox";tempArr=UserBoss.ins().getGwBossList();this.list0.itemRenderer=GwBossRemindItem}else if(this.type==UserBoss.BOSS_SUBTYPE_SHENYU){this.skin.currentState="hasCheckBox";this.list0.itemRenderer=PubBossRemindItem;this.autoChallenge.selected=AutoChallengeBoss.ins().autoShenyuBoss;this.autoCost.selected=AutoChallengeBoss.ins().autoCostShenyuBoss}this.addTouchEvent(this.autoChallenge,this.onChallenge);this.addTouchEvent(this.autoCost,this.onCost);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);if(this.type==UserBoss.BOSS_SUBTYPE_QMBOSS){if(!SamsaraModel.ins().isOpen()){var ary=[];for(var i in tempArr){var config=GlobalConfig.WorldBossConfig[tempArr[i].id];if(!config.samsaraLv){ary.push(tempArr[i])}}tempArr=ary}}this.listDatas.source=tempArr.sort(this.compareFn);this.list0.dataProvider=this.listDatas;this.addTouchEvent(this,this.onTap)};PubBossRemindWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}UserBoss.ins().sendBossSetting();this.removeTouchEvent(this.autoChallenge,this.onChallenge);this.removeTouchEvent(this.autoCost,this.onCost);this.removeTouchEvent(this,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);AutoChallengeBoss.ins().checkEnter()};PubBossRemindWin.prototype.onChallenge=function(e){if(!Recharge.ins().franchise){UserTips.ins().showTips(i18n("PubBossRemindWin_0"));this.autoChallenge.selected=false;return}if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH);this.autoChallenge.selected=false}else{if(this.type==UserBoss.BOSS_SUBTYPE_SHENYU){AutoChallengeBoss.ins().autoShenyuBoss=this.autoChallenge.selected}else if(this.type==UserBoss.BOSS_SUBTYPE_QMBOSS){AutoChallengeBoss.ins().autoYewaiBoss=this.autoChallenge.selected}}};PubBossRemindWin.prototype.onCost=function(e){if(!Recharge.ins().franchise){UserTips.ins().showTips(i18n("PubBossRemindWin_0"));this.autoCost.selected=false;return}if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH);this.autoCost.selected=false}else{if(this.type==UserBoss.BOSS_SUBTYPE_SHENYU){AutoChallengeBoss.ins().autoCostShenyuBoss=this.autoCost.selected}else if(this.type==UserBoss.BOSS_SUBTYPE_QMBOSS){AutoChallengeBoss.ins().autoCostYewaiBoss=this.autoCost.selected}}};PubBossRemindWin.prototype.onTap=function(e){if(e.target instanceof eui.CheckBox){var index=parseInt(e.target.name);if(index>-1){UserBoss.ins().setBossSetting(index);var render=this.list0.getElementAt(this.list0.selectedIndex);if(render){render.dataChanged()}}}else{switch(e.currentTarget){case this.bgClose:case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}}};PubBossRemindWin.prototype.compareFn=function(a,b){var configA=GlobalConfig.WorldBossConfig[a.id];var configB=GlobalConfig.WorldBossConfig[b.id];var canChallenge1=UserBoss.isCanChallenge(configA);var canChallenge2=UserBoss.isCanChallenge(configB);if(canChallenge1&&!canChallenge2){return-1}else if(!canChallenge1&&canChallenge2){return 1}else{if(configA.samsaraLv>configB.samsaraLv){return 1}else if(configA.samsaraLv<configB.samsaraLv){return-1}else if(configA.samsaraLv==configB.samsaraLv&&configA.samsaraLv!=0){if(configA.level>configB.level)return 1;else if(configA.level<configB.level)return-1}else{if(configA.zsLevel>configB.zsLevel){return 1}else if(configA.zsLevel<configB.zsLevel){return-1}if(configA.level>configB.level)return 1;else if(configA.level<configB.level)return-1;else return 0}}};return PubBossRemindWin}(BaseEuiView);__reflect(PubBossRemindWin.prototype,"PubBossRemindWin");ViewManager.ins().reg(PubBossRemindWin,LayerManager.UI_Main);var PublicBossJiangliTipWin=function(_super){__extends(PublicBossJiangliTipWin,_super);function PublicBossJiangliTipWin(){return _super.call(this)||this}PublicBossJiangliTipWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WorldBossJiangLiTishiSkin";this.isTopLevel=true;this.belongList.itemRenderer=ItemBase;this.joinList.itemRenderer=ItemBase};PublicBossJiangliTipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.otherClose);if(GwBoss.ins().isGwBoss||KFBossSys.ins().isKFBossBattle){this.currentState="gwboss"}else if(GwBoss.ins().isGwTopBoss){this.currentState="tower"}else if(GameMap.fbType==UserFb.FB_TYPE_HIDE_BOSS){this.currentState="hideboss"}else if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS){this.currentState="bosshome"}else{this.currentState="normal"}if(KFBossSys.ins().isKFBossBattle){this.proWordGroup1.visible=false;this.proWordGroup.visible=false;var ar=[];for(var k in GlobalConfig.CrossBossConfig){var dp=GlobalConfig.CrossBossConfig[k];if(dp.fbid==GameMap.fubenID){var belongRewardshow=CommonUtils.copyDataHandler(dp.belongRewardshow);if(belongRewardshow)this.belongItem.data=belongRewardshow.shift();this.belongList.dataProvider=new eui.ArrayCollection(belongRewardshow);break}}}else if(GameMap.fbType==UserFb.FB_TYPE_HIDE_BOSS){var id=UserBoss.ins().hideBossData.lastId;var reward=GlobalConfig.HideBossConfig[id].rewardShow.concat();this.belongItem.data=reward.shift();this.belongList.dataProvider=new eui.ArrayCollection(reward)}else if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS){var config=GlobalConfig.WorldBossConfig[BossHomeSys.ins().nowChallengeBossID];this.belongItem.data=config.belongRewardshow[0];this.belongList.dataProvider=new eui.ArrayCollection(config.belongRewardshow[1]);if(config.canRewardshow){this.joinItem.data=config.canRewardshow[0];this.joinList.dataProvider=new eui.ArrayCollection(config.canRewardshow[1])}}else{var config=GlobalConfig.WorldBossConfig[UserBoss.ins().currBossConfigID];this.belongItem.data=config.belongRewardshow[0];this.belongList.dataProvider=new eui.ArrayCollection(config.belongRewardshow[1]);if(config.canRewardshow){this.joinItem.data=config.canRewardshow[0];this.joinList.dataProvider=new eui.ArrayCollection(config.canRewardshow[1])}}};PublicBossJiangliTipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.otherClose)};PublicBossJiangliTipWin.prototype.otherClose=function(evt){ViewManager.ins().close(PublicBossJiangliTipWin)};PublicBossJiangliTipWin.openCheck=function(){if(!UserBoss.ins().currBossConfigID&&!BossHomeSys.ins().nowChallengeBossID){return false}return true};return PublicBossJiangliTipWin}(BaseEuiView);__reflect(PublicBossJiangliTipWin.prototype,"PublicBossJiangliTipWin");ViewManager.ins().reg(PublicBossJiangliTipWin,LayerManager.UI_Popup);var PublicBossMainWin=function(_super){__extends(PublicBossMainWin,_super);function PublicBossMainWin(){var _this=_super.call(this)||this;_this.endTime=0;_this.actLevel=0;return _this}PublicBossMainWin.prototype.childrenCreated=function(){this.init()};PublicBossMainWin.prototype.init=function(){this.list.itemRenderer=WorldBossItem;this.dropRewardList.itemRenderer=ItemBase;this.bossImage=new MovieClip;this.bossImage.scaleX=-1;this.bossImage.scaleY=1;this.bossImage.x=78;this.bossImage.y=165;this.bossGroup.touchEnabled=this.bossGroup.touchChildren=false};PublicBossMainWin.prototype.open=function(){var canPlayList=UserBoss.ins().worldBossPlayList[UserBoss.BOSS_SUBTYPE_QMBOSS].slice();if(this.bossImage&&!this.bossImage.parent){this.bossGroup.addChild(this.bossImage)}this.observe(UserZs.ins().postZsData,this.setActLevel);this.observe(Actor.ins().postLevelChange,this.setActLevel);this.setActLevel();this.list.dataProvider=new eui.ArrayCollection(canPlayList);this.list.selectedIndex=0;this.currData=this.list.dataProvider.getItemAt(0);this.addTouchEvent(this.challengeBtn,this.onTap);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this);this.setWin()};PublicBossMainWin.prototype.onClickMenu=function(e){this.currData=this.list.dataProvider.getItemAt(e.itemIndex);this.setWin()};PublicBossMainWin.prototype.setWin=function(){if(!this.currData)return;var config=GlobalConfig.WorldBossConfig[this.currData.id];var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];var lvStr=config.zsLevel>0?i18n("PublicBossMainWin_0",config.zsLevel):i18n("PublicBossMainWin_1",config.level);this.nameTxt.text=bossBaseConfig.name+"("+lvStr+")";var str=i18n("PublicBossMainWin_2");if(this.currData.roleName!=""){str=this.currData.roleName;if(this.currData.guildName!="")str=str+"("+this.currData.guildName+")"}if(this.currData.bossState==2){this.stateImage.source="zdbossyijisha"}else if(this.currData.bossState==1){this.stateImage.source="zdbosskejisha"}else{this.stateImage.source=""}this.dropRewardList.dataProvider=new eui.ArrayCollection(config.showReward);this.playerNameTxt.text=str;var count=UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_QMBOSS];this.leftText.text=i18n("PublicBossMainWin_4",count);this.endTime=Math.floor((UserBoss.ins().worldBossCd[UserBoss.BOSS_SUBTYPE_QMBOSS]-egret.getTimer())/1e3);if(this.endTime>0){this.challengeBtn.visible=false;this.updateTime();TimerManager.ins().doTimer(100,0,this.updateTime,this);str=DateUtils.getFormatBySecond(this.endTime,5,3);this.leftCDText.text=i18n("PublicBossMainWin_5",str)}else{this.leftCDText.text=""}this.bossImage.playFile(RES_DIR_MONSTER+("monster"+bossBaseConfig.avatar+"_3s"),-1);for(var i=0;i<4;i++){var item=void 0;switch(i){case 0:item=GlobalConfig.ItemConfig[config.joinReward];break;case 1:item=GlobalConfig.ItemConfig[config.shieldReward];break;case 2:item=GlobalConfig.ItemConfig[config.belongReward];break;case 3:item=GlobalConfig.ItemConfig[config.killReward];break}}};PublicBossMainWin.prototype.updateTime=function(){var time=Math.floor((UserBoss.ins().worldBossCd[UserBoss.BOSS_SUBTYPE_QMBOSS]-egret.getTimer())/1e3);this.leftCDText.text=i18n("PublicBossMainWin_7",DateUtils.getFormatBySecond(time,5,3));if(time<=0){TimerManager.ins().remove(this.updateTime,this);this.leftCDText.text="";this.challengeBtn.visible=true}};PublicBossMainWin.prototype.onTap=function(e){switch(e.currentTarget){case this.challengeBtn:if(Math.floor((UserBoss.ins().worldBossCd[UserBoss.BOSS_SUBTYPE_QMBOSS]-egret.getTimer())/1e3)>0){UserTips.ins().showTips(i18n("PublicBossMainWin_8"));return}var roleLv=UserZs.ins().lv*1e3+Actor.level;var config=GlobalConfig.WorldBossConfig[this.currData.id];var bossBaseConfig=GlobalConfig.MonstersConfig[config.bossId];var bossLv=(config.zsLevel||0)*1e3+config.level;if(bossLv>roleLv){var str=config.zsLevel>0?i18n("PublicBossMainWin_9",config.zsLevel):i18n("PublicBossMainWin_10",config.level);UserTips.ins().showTips(i18n("PublicBossMainWin_11",str));return}if(UserBag.ins().getSurplusCount()<UserBoss.WB_BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin,UserBoss.WB_BAG_ENOUGH)}else{ViewManager.ins().close(BossWin);UserBoss.ins().sendChallengWorldBoss(this.currData.id,UserBoss.BOSS_SUBTYPE_QMBOSS)}break}};PublicBossMainWin.prototype.setActLevel=function(){this.actLevel=UserZs.ins().lv*1e4+Actor.level};PublicBossMainWin.prototype.close=function(){this.removeObserve();this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this);this.removeTouchEvent(this.challengeBtn,this.onTap)};return PublicBossMainWin}(BaseView);__reflect(PublicBossMainWin.prototype,"PublicBossMainWin");var PublicBossRank=function(_super){__extends(PublicBossRank,_super);function PublicBossRank(){return _super.call(this)||this}PublicBossRank.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="BossRankSkin"};PublicBossRank.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.hideBtn,this.onTap);this["myHarm"].text=i18n("PublicBossRank_0");this["myRank"].text=i18n("PublicBossRank_1")};PublicBossRank.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.hideBtn,this.onTap);this.removeObserve()};PublicBossRank.prototype.updateRank=function(param){var id=param[0];var datas=param[1];var actorID=Actor.actorID;for(var i=0;i<3;i++){this["rank"+i].text=i+1;this["name"+i].text=datas[i]?datas[i][1]:"";if(datas[i]){CommonUtils.labelIsOverLenght(this["harm"+i],datas[i][2])}else this["harm"+i].text="";if(datas[i]&&datas[i][0]==actorID.toString()){this["myHarm"].text=i18n("PublicBossRank_4",this["harm"+i].text);this["myRank"].text=i18n("PublicBossRank_5",this["rank"+i].text)}}};PublicBossRank.prototype.onTap=function(e){switch(e.currentTarget){case this.hideBtn:var t=egret.Tween.get(this.group);t.to({x:this.hideBtn.selected?480:247},500);break}};return PublicBossRank}(BaseEuiView);__reflect(PublicBossRank.prototype,"PublicBossRank");ViewManager.ins().reg(PublicBossRank,LayerManager.UI_Main);var PubResultWin=function(_super){__extends(PubResultWin,_super);function PubResultWin(){return _super.call(this)||this}PubResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="PubResultSkin"};PubResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var myRank=param[0];var no1Name=param[1];var no1Level=param[2];var no1Reward=param[3];var myReward=param[4];this.addTouchEvent(this.closeBtn,this.onTap);TimerManager.ins().doTimer(1e3,10,this.updateCloseBtnLabel,this);var level=i18n("Level_0");this.txt0.text="（"+no1Name+" "+no1Level+level+"）";for(var i=0;i<this.container0.numChildren;i++){var element=this.container0.getChildAt(i);element.destruct()}for(var i=0;i<this.container1.numChildren;i++){var element=this.container1.getChildAt(i);element.destruct()}this.container0.removeChildren();this.container1.removeChildren();this.txt1.visible=myRank!=1;this.txt2.visible=myRank!=1;for(var i=0;i<no1Reward.length;i++){var item=new ItemBase;item.data=no1Reward[i];this.container0.addChild(item)}this.s=10;this.closeBtn.name=i18n("PubResultWin_0");if(myRank==1)return;this.txt2.text=i18n("PubResultWin_1",myRank);for(var i=0;i<myReward.length;i++){var item=new ItemBase;item.data=myReward[i];this.container1.addChild(item)}};PubResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);if(GameMap.fubenID>0){UserFb.ins().sendExitFb()}};PubResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)this.onTap();this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"};PubResultWin.prototype.onTap=function(){ViewManager.ins().close(this)};return PubResultWin}(BaseEuiView);__reflect(PubResultWin.prototype,"PubResultWin");ViewManager.ins().reg(PubResultWin,LayerManager.UI_Main);var RandBossWin=function(_super){__extends(RandBossWin,_super);function RandBossWin(){return _super.call(this)||this}RandBossWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="RandBossSkin";this.list.itemRenderer=ItemBase;this.upVip.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor(i18n("RandBossWin_0"),"#23C42A"))};RandBossWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.sure,this.onTap);this.addTouchEvent(this.upVip,this.onTap);this.info=this.getUserInfoByItemId(param[0]);this.list.dataProvider=new eui.ArrayCollection(this.info.show);var num=UserFb.ins().bossCallNum;var maxNum=this.info.challengeTime[UserVip.ins().lv];this.playNum.text=maxNum-num+"/"+maxNum;this.lastNum=maxNum-num;this.bossdesc.text=this.info.titledes};RandBossWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.sure,this.onTap);this.removeTouchEvent(this.upVip,this.onTap)};RandBossWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.sure:if(this.lastNum<=0){UserTips.ins().showTips(i18n("RandBossWin_1"));return}if(Actor.level>=this.info.levelLimit){UserFb.ins().sendCallBossPlay(this.info.id);ViewManager.ins().close(this);ViewManager.ins().close(BagWin);return}UserTips.ins().showTips(i18n("RandBossWin_2")+this.info.levelLimit+i18n("RandBossWin_3"));break;case this.upVip:ViewManager.ins().open(VipWin);break}};RandBossWin.prototype.getUserInfoByItemId=function(id){var config=GlobalConfig.OtherBoss2Config;for(var i in config){if(config[i].itemId==id){return config[i]}}return null};return RandBossWin}(BaseEuiView);__reflect(RandBossWin.prototype,"RandBossWin");ViewManager.ins().reg(RandBossWin,LayerManager.UI_Main);var ShieldWin=function(_super){__extends(ShieldWin,_super);function ShieldWin(){var _this=_super.call(this)||this;_this.skinName="shieldSkin";return _this}ShieldWin.prototype.open=function(){this.addTouchEvent(this.shieldBtn,this.onTap);this.touchEnabled=false;this.shieldBtn.selected=!EntityHideBody.ins().isShow};ShieldWin.prototype.onTap=function(e){EntityHideBody.ins().setShowState(!this.shieldBtn.selected)};ShieldWin.prototype.setBtnBottom=function(b){if(b===void 0){b=140}this.shieldBtn.bottom=b};return ShieldWin}(BaseEuiView);__reflect(ShieldWin.prototype,"ShieldWin");ViewManager.ins().reg(ShieldWin,LayerManager.UI_Main);var WildBossJoinWin=function(_super){__extends(WildBossJoinWin,_super);function WildBossJoinWin(){return _super.call(this)||this}WildBossJoinWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WildBossJoinSkin";this.list.itemRenderer=WildBossJoinItem;this.arrCollect=new eui.ArrayCollection};WildBossJoinWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.arrCollect.source=[];this.list.dataProvider=this.arrCollect};WildBossJoinWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeObserve()};WildBossJoinWin.prototype.updateRank=function(param){var id=param[0];var datas=param[1];this.arrCollect.source=datas;this.list.dataProvider=this.arrCollect};WildBossJoinWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;default:break}};return WildBossJoinWin}(BaseEuiView);__reflect(WildBossJoinWin.prototype,"WildBossJoinWin");ViewManager.ins().reg(WildBossJoinWin,LayerManager.UI_Main);var WildBossRecordWin=function(_super){__extends(WildBossRecordWin,_super);function WildBossRecordWin(){return _super.call(this)||this}WildBossRecordWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WildBossRecordSkin";this.list.itemRenderer=WildBossJoinItem;this.arrCollect=new eui.ArrayCollection};WildBossRecordWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.observe(UserBoss.ins().postChallageRank,this.updateRank);this.arrCollect.source=[];this.list.dataProvider=this.arrCollect};WildBossRecordWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeObserve()};WildBossRecordWin.prototype.updateRank=function(param){var id=param[0];var datas=param[1];this.arrCollect.source=datas;this.list.dataProvider=this.arrCollect};WildBossRecordWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;default:break}};return WildBossRecordWin}(BaseEuiView);__reflect(WildBossRecordWin.prototype,"WildBossRecordWin");ViewManager.ins().reg(WildBossRecordWin,LayerManager.UI_Main);var WorldBossBeKillWin=function(_super){__extends(WorldBossBeKillWin,_super);function WorldBossBeKillWin(){var _this=_super.call(this)||this;_this.remainM=0;return _this}WorldBossBeKillWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WorldBossGoldSkin";this.aliveNum=0};WorldBossBeKillWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.reliveBtn,this.onTap);this.addTouchEvent(this.exitBtn,this.onTap);this.setWin()};WorldBossBeKillWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.reliveBtn,this.onTap);this.removeTouchEvent(this.exitBtn,this.onTap);ViewManager.ins().close(WorldBossCdWin)};WorldBossBeKillWin.prototype.setWin=function(){if(UserBoss.ins().killerHandler>0){var killer=EntityManager.ins().getEntityByHandle(UserBoss.ins().killerHandler);var str="";if(killer){if(killer instanceof CharRole){str=killer.infoModel.name}else if(killer.infoModel.masterHandle){var killers=EntityManager.ins().getMasterList(EntityManager.ins().getRootMasterHandle(killer.infoModel.masterHandle));if(killers&&killers.length){for(var _i=0,killers_1=killers;_i<killers_1.length;_i++){var char=killers_1[_i];if(char instanceof CharRole){str=""+char.infoModel.name;break}}}if(!str){str=""+killer.infoModel.name}}else{var boss=i18n("Boss_0");str=""+boss+killer.infoModel.name}}this.killTips.textFlow=(new egret.HtmlTextParser).parser(i18n("WorldBossBeKillWin_1",StringUtils.addColor(str,"#23C42A")));this.aliveNum=this.getAliveItem();this.alive.visible=this.aliveNum?true:false;if(this.alive.visible)this.alive.text=i18n("WorldBossBeKillWin_2",this.aliveNum)}this.reliveBtn.label=i18n("WorldBossBeKillWin_3",UserBoss.ins().checkWorldBossNeed());if(GameMap.fbType==UserFb.FB_TEAM||GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS||BattleGround.ins().isPaoDian){this.reliveBtn.visible=false;this.moneyIcon.visible=false}else{this.reliveBtn.visible=true;this.moneyIcon.visible=true}if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS){this.reliveTimesTxt.text=BossHomeSys.ins().rebornCd+i18n("WorldBossBeKillWin_4");this.remainM=BossHomeSys.ins().rebornCd}else{this.reliveTimesTxt.text=UserBoss.ins().reliveTime+i18n("WorldBossBeKillWin_4");this.remainM=UserBoss.ins().reliveTime}TimerManager.ins().remove(this.refushLabel,this);TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this);DieGuide.ins().postdieGuide(0)};WorldBossBeKillWin.prototype.getAliveItem=function(){if(BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||BattleGround.ins().isPaoDian)return 0;var itemId=CityCC.ins().isCity?GlobalConfig.CityBaseConfig.rebornItem:GlobalConfig.WorldBossBaseConfig.rebornItem;var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,itemId);if(!item)return 0;return item.count};WorldBossBeKillWin.prototype.refushLabel=function(){this.remainM--;this.reliveTimesTxt.text=this.remainM+i18n("WorldBossBeKillWin_5");if(this.remainM<0){TimerManager.ins().remove(this.refushLabel,this);this.overTime()}};WorldBossBeKillWin.prototype.overTime=function(){ViewManager.ins().close(this);ViewManager.ins().close(WorldBossCdWin)};WorldBossBeKillWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};WorldBossBeKillWin.prototype.onTap=function(e){switch(e.currentTarget){case this.reliveBtn:if(this.aliveNum){UserBoss.ins().sendClearCD();return}if(UserBoss.ins().checkWorldBossMoney())UserBoss.ins().sendClearCD();else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("WorldBossBeKillWin_7"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("WorldBossBeKillWin_8"))}}break;case this.exitBtn:UserFb.ins().sendExitFb();break}};return WorldBossBeKillWin}(BaseEuiView);__reflect(WorldBossBeKillWin.prototype,"WorldBossBeKillWin");ViewManager.ins().reg(WorldBossBeKillWin,LayerManager.UI_Popup);var WorldBossCdWin=function(_super){__extends(WorldBossCdWin,_super);function WorldBossCdWin(){return _super.call(this)||this}WorldBossCdWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WorldBosstishiSkin";this.isTopLevel=true};WorldBossCdWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.sure,this.onTap);this.addTouchEvent(this.giveUp,this.onTap);this.addChangeEvent(this.check,this.selectChange);var cost=UserBoss.ins().checkWorldBossNeed();var colorStr=StringUtils.addColor(i18n("WorldBossCdWin_0",cost),"#23C42A");this.tipsTxt.textFlow=(new egret.HtmlTextParser).parser(i18n("WorldBossCdWin_1",colorStr))};WorldBossCdWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.sure,this.onTap);this.removeTouchEvent(this.giveUp,this.onTap);this.check.removeEventListener(egret.Event.CHANGE,this.selectChange,this)};WorldBossCdWin.prototype.selectChange=function(e){UserBoss.ins().ShowTip=!this.check.selected};WorldBossCdWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return UserBoss.ins().ShowTip};WorldBossCdWin.prototype.onTap=function(e){switch(e.currentTarget){case this.sure:if(UserBoss.ins().checkRelive()){UserBoss.ins().sendClearCD();ViewManager.ins().close(WorldBossCdWin);ViewManager.ins().close(WorldBossBeKillWin)}break;case this.giveUp:ViewManager.ins().close(WorldBossCdWin);break}};return WorldBossCdWin}(BaseEuiView);__reflect(WorldBossCdWin.prototype,"WorldBossCdWin");ViewManager.ins().reg(WorldBossCdWin,LayerManager.UI_Popup);var WorldBossGold=function(_super){__extends(WorldBossGold,_super);function WorldBossGold(){return _super.call(this)||this}WorldBossGold.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WorldBossGoldSkin"};WorldBossGold.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var hurt=param[0];var gold=param[1];this.infoTxt.textFlow=(new egret.HtmlTextParser).parser(i18n("WorldBossGold_0",hurt));this.price.setType(MoneyConst.gold);this.price.setPrice(gold);this.s=10;this.updateBtn();TimerManager.ins().doTimer(1e3,this.s,this.updateBtn,this);this.addTouchEvent(this.okBtn,this.onTap)};WorldBossGold.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.okBtn,this.onTap);TimerManager.ins().remove(this.updateBtn,this);UserFb.ins().sendExitFb()};WorldBossGold.prototype.onTap=function(e){ViewManager.ins().close(this)};WorldBossGold.prototype.updateBtn=function(){this.s--;this.okBtn.label=i18n("WorldBossGold_1",this.s);if(this.s<=0){this.onTap()}};return WorldBossGold}(BaseEuiView);__reflect(WorldBossGold.prototype,"WorldBossGold");ViewManager.ins().reg(WorldBossGold,LayerManager.UI_Main);var CRC16=function(){function CRC16(){}CRC16.update=function(bytes,offset,length){if(offset===void 0){offset=0}if(length===void 0){length=0}var c=0;var index=0;if(length==0){length=bytes.length}bytes.position=offset;for(var i=offset;i<length;++i){index=CRC16.CRCBitReflect(bytes.readByte(),8)&255^c>>8&16777215;index&=255;c=CRC16.CRCTable[index]^c<<8&4294967040}return(CRC16.CRCBitReflect(c,16)^0)&65535};CRC16.makeCRCTable=function(){var c=0;var crcTable=new Array(256);for(var i=0;i<256;++i){c=i<<8&4294967040;for(var j=0;j<8;++j){c=c&32768?c<<1&4294967294^CRC16.POLYNOMIAL:c<<1&4294967294}crcTable[i]=c}return crcTable};CRC16.CRCBitReflect=function(input,bitCount){var out=0;var x=0;bitCount--;for(var i=0;i<=bitCount;++i){x=bitCount-i;if(input&1){out|=1<<x&CRC16.DropBits[x]}input=input>>1&2147483647}return out};CRC16.POLYNOMIAL=4129;CRC16.CRCTable=CRC16.makeCRCTable();CRC16.DropBits=[4294967295,4294967294,4294967292,4294967288,4294967280,4294967264,4294967232,4294967168,4294967040,4294966784,4294966272,4294965248,4294963200,4294959104,4294950912,4294934528];return CRC16}();__reflect(CRC16.prototype,"CRC16");var WorldBossJiangliTipWin=function(_super){__extends(WorldBossJiangliTipWin,_super);function WorldBossJiangliTipWin(){return _super.call(this)||this}WorldBossJiangliTipWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WorldBossJiangLiTishiSkin2";this.isTopLevel=true;this.belongList.itemRenderer=ItemBase;this.joinList.itemRenderer=ItemBase};WorldBossJiangliTipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.otherClose);var config=GlobalConfig.WorldBossConfig[UserBoss.ins().currBossConfigID];this.belongList.dataProvider=new eui.ArrayCollection(config.belongRewardshow[1]);this.joinList.dataProvider=new eui.ArrayCollection(config.canRewardshow[1])};WorldBossJiangliTipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.otherClose)};WorldBossJiangliTipWin.prototype.otherClose=function(evt){ViewManager.ins().close(WorldBossJiangliTipWin)};WorldBossJiangliTipWin.openCheck=function(){if(!UserBoss.ins().currBossConfigID){return false}var config=GlobalConfig.WorldBossConfig[UserBoss.ins().currBossConfigID];if(Assert(config,i18n("WorldBossJiangliTipWin_0",UserBoss.ins().currBossConfigID))){return false}return true};return WorldBossJiangliTipWin}(BaseEuiView);__reflect(WorldBossJiangliTipWin.prototype,"WorldBossJiangliTipWin");ViewManager.ins().reg(WorldBossJiangliTipWin,LayerManager.UI_Popup);var WorldBossJiangLiWin=function(_super){__extends(WorldBossJiangLiWin,_super);function WorldBossJiangLiWin(){var _this=_super.call(this)||this;_this.configTimes=0;_this.type=0;return _this}WorldBossJiangLiWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WorldBossJiangLiSkin";this.bar.labelDisplay.visible=false;this.isTopLevel=true};WorldBossJiangLiWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.playGroup.visible=true;this.maxPointGroup.visible=false;this.myPointGroup.visible=false;this.addTouchEvent(this.play,this.onTap);this.addTouchEvent(this.giveUp,this.onTap);this.observe(UserBoss.ins().postLotteryRan,this.getMyPoint);this.observe(UserBoss.ins().postLotteryResult,this.getMaxPoint);this.observe(GuildWar.ins().postLotteryPoint,this.getMyPoint);this.observe(GuildWar.ins().postLotteryMaxPost,this.getMaxPoint);this.type=0;if(param[0]){this.configTimes=GlobalConfig.WorldBossBaseConfig.lotteryTime>0?GlobalConfig.WorldBossBaseConfig.lotteryTime:10;this.type=param[0]}else{this.configTimes=10;this.type=0}this.bar.maximum=10*this.configTimes;this.refushInfo()};WorldBossJiangLiWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.play,this.onTap);this.removeTouchEvent(this.giveUp,this.onTap);TimerManager.ins().remove(this.refushBar,this);this.removeObserve()};WorldBossJiangLiWin.prototype.refushInfo=function(){this.times=0;if(this.type==0){this.goods.data={type:1,id:UserBoss.ins().worldPrize,count:1}}else if(this.type==1){this.goods.data={type:1,id:UserBoss.ins().worldPrize,count:1}}TimerManager.ins().doTimer(100,10*this.configTimes,this.refushBar,this,this.TimeOver,this);this.timeLabel.text=i18n("WorldBossJiangLiWin_0",this.configTimes)};WorldBossJiangLiWin.prototype.refushBar=function(){this.times++;var value=10*this.configTimes-this.times;this.bar.value=value;this.timeLabel.text=Math.floor(this.configTimes-this.times/10)+i18n("WorldBossJiangLiWin_1");if(value<=0){ViewManager.ins().close(WorldBossJiangLiWin)}};WorldBossJiangLiWin.prototype.TimeOver=function(){ViewManager.ins().close(WorldBossJiangLiWin)};WorldBossJiangLiWin.prototype.getMyPoint=function(point){this.play.touchEnabled=false;this.myPoint.text=point+"";this.myPointGroup.visible=true};WorldBossJiangLiWin.prototype.getMaxPoint=function(info){this.maxPoint.text=info[1];this.playerName.text=info[0];this.maxPointGroup.visible=true};WorldBossJiangLiWin.prototype.onTap=function(e){switch(e.currentTarget){case this.play:if(this.type==0){UserBoss.ins().sendJoinLottery()}else if(this.type==1){GuildWar.ins().sendPlayLotteryInfo()}this.playGroup.visible=false;break;case this.giveUp:if(this.type==0){ViewManager.ins().close(WorldBossJiangLiWin)}else if(this.type==1){ViewManager.ins().close(WorldBossJiangLiWin)}break}};return WorldBossJiangLiWin}(BaseEuiView);__reflect(WorldBossJiangLiWin.prototype,"WorldBossJiangLiWin");ViewManager.ins().reg(WorldBossJiangLiWin,LayerManager.UI_Popup);var WorldBossUiInfo=function(_super){__extends(WorldBossUiInfo,_super);function WorldBossUiInfo(){var _this=_super.call(this)||this;_this.GRAYIMG_WIDTH=0;_this._curMonsterID=0;_this.lastWeixieList=[];_this.isDelayUpdate=false;_this.curValue=1;_this.skinName="WorldBossUiSkin";_this.bloodBar=new BloodBar;_this.bloodBar.setEff();_this.bloodBar0=new BloodBar;_this.bloodBar0.setEff(137,12);_this.hudunbloodBar=new BloodBar;_this.hudunbloodBar.setEff(175,7,"bossxtsmall_eff");_this.neigongBar0=new BloodBar;_this.neigongBar0.setEff(95,4,"bossxtsmall_eff");return _this}WorldBossUiInfo.prototype.initUI=function(){_super.prototype.initUI.call(this);this.bloodBarGroup.addChild(this.bloodBar);this.bloodBar0Group.addChild(this.bloodBar0);this.hudunbloodBarGroup.addChild(this.hudunbloodBar);this.neigongBar0Group.addChild(this.neigongBar0);this.headMc=new MovieClip;this.mcGroup.addChild(this.headMc);this.headMc.playFile(RES_DIR_EFF+"bosstx_eff",-1);this.clickEffc=new MovieClip;this.clickEffc.x=630;this.clickEffc.y=269;this.pointEff=new MovieClip;this.pointEff.x=110;this.pointEff.y=510;this.list1.itemRenderer=WorldBossHeadRender;this.list2.itemRenderer=WorldBossHeadRender;this.grayImg.source="bosshp2";this.GRAYIMG_WIDTH=this.grayImg.width=this.grayScroller.width=this.grayGroup.width;this.bloodBar0.setLabel("");this.dropDown.currentState="down";TimerManager.ins().remove(this.reflashAtkInfo,this);TimerManager.ins().doTimer(200,0,this.reflashAtkInfo,this)};WorldBossUiInfo.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.hudun.visible=false;this.visible=true;this.attList.visible=this.attackBtnGroup.visible=true&&UserBoss.ins().winner=="";this.bossBloodGroup.visible=false;var self=this;this.myTxt.visible=false;this.observe(UserBoss.ins().postHasAttackChange,this.refushWeixieList);this.observe(UserBoss.ins().postCanplayChange,this.refushcanPlayList);TimerManager.ins().doTimer(300,1,function(){self.observe(UserBoss.ins().postHpChange,self.reflashBlood)},self);this.observe(UserBoss.ins().postShieldPer,this.huDunChange);this.observe(UserBoss.ins().postRemainTime,this.reliveInfoChange);this.observe(BossHomeSys.ins().postRebornTime,this.reliveInfoChange);this.observe(UserBoss.ins().postWorldBossEndTime,this.worldBossEnd);this.observe(BossHomeSys.ins().postEnterRoomsuccess,this.updateBossHomeUI);this.observe(GameLogic.ins().postChangeTarget,this.refushcanPlayList);this.observe(UserBoss.ins().postHpChange,this.updateRank);this.list2.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.list2Tap,this);this.addTouchEvent(this.btn,this.onTap);this.addTouchEvent(this.attackBoss,this.onTap);this.addTouchEvent(this.attackPlayer,this.onTap);this.addTouchEvent(this.belongGroup,this.onTap);this.addTouchEvent(this.tipBtn,this.onTap);this.addTouchEvent(this.attguishu,this.onTap);this.updateBaseInfo();this.refushShowInfo();this.reflashAtkInfo();this.refushWeixieList();this.refushcanPlayList();TimerManager.ins().doTimer(300,1,function(){self.reflashBlood()},self)};WorldBossUiInfo.prototype.updateBaseInfo=function(){this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];if(!this.bossConfig){return}this._curMonsterID=UserBoss.ins().monsterID;this.nameTxt.text=this.bossConfig.name;this.head.source="monhead"+this.bossConfig.head+"_png";var level=i18n("Level_0");this.lvTxt.text=""+this.bossConfig.level+level};WorldBossUiInfo.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}DisplayUtils.removeFromParent(this.clickEffc);DisplayUtils.removeFromParent(this.nextEff);DisplayUtils.removeFromParent(this.pointEff);this.list2.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.list2Tap,this);this.clearRendererItem();this._curMonsterID=0};WorldBossUiInfo.prototype.refushShowInfo=function(){this.leftTimeGroup.visible=false;this.roomhostName.visible=false;this.rankGroup.visible=false;if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS){this.belongGroup.visible=false;this.attackBtnGroup.visible=false;this.leftTimeGroup.visible=true;this.rankGroup.visible=true}else{this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4);if(!TimerManager.ins().isExists(this.showInfoTime,this))TimerManager.ins().doTimer(1e3,GuildWar.ins().getModel().acEndTime,this.showInfoTime,this)}};WorldBossUiInfo.prototype.updateBossHomeUI=function(){this.roomhostName.visible=true;if(BossHomeSys.ins().hostName)this.roomhostName.text="开启者："+BossHomeSys.ins().hostName;this.lastTime.text=BossHomeSys.ins().nowhomerelieveTime;this.showbosshomeTime=BossHomeSys.ins().nowhomerelieveTime;this.updateBossHomeTimeUI();TimerManager.ins().remove(this.updateBossHomeTimeUI,this);TimerManager.ins().doTimer(1e3,0,this.updateBossHomeTimeUI,this)};WorldBossUiInfo.prototype.updateBossHomeTimeUI=function(){if(this.showbosshomeTime==undefined)return;if(this.showbosshomeTime<=0){TimerManager.ins().remove(this.updateBossHomeTimeUI,this)}else{this.showbosshomeTime=this.showbosshomeTime-1;this.lastTime.text=DateUtils.getFormatBySecond(Math.floor(this.showbosshomeTime),DateUtils.TIME_FORMAT_1)}};WorldBossUiInfo.prototype.showInfoTime=function(){this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4)};WorldBossUiInfo.prototype.reflashAtkInfo=function(){var roleList=EntityManager.ins().getMasterList(EntityManager.ins().getRootMasterHandle(UserBoss.ins().attHandle));if(roleList&&roleList.length>0){var len=roleList.length;var hpValue=0;var hpTotal=0;var neigongValue=0;var neigongTotal=0;var mainRoleInfo=void 0;for(var i=0;i<len;i++){var role=roleList[i];if(role instanceof CharRole){var curHp=role.infoModel.getAtt(AttributeType.atHp)||0;var maxHp=role.infoModel.getAtt(AttributeType.atMaxHp)||0;hpValue+=curHp;hpTotal+=maxHp;var curNeigong=role.infoModel.getAtt(AttributeType.cruNeiGong)||0;var maxNeigong=role.infoModel.getAtt(AttributeType.maxNeiGong)||0;neigongValue+=curNeigong;neigongTotal+=maxNeigong;if(!mainRoleInfo){mainRoleInfo=role.infoModel}}}this.belongGroup.visible=hpValue>0&&UserBoss.ins().winner=="";var color=Actor.handle!=UserBoss.ins().attHandle?ColorUtil.ROLENAME_COLOR_YELLOW:ColorUtil.ROLENAME_COLOR_GREEN;var tname=mainRoleInfo.name;var strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];tname=StringUtils.replaceStr(tname,"0xffffff",color+"");this.belongNameTxt.textFlow=TextFlowMaker.generateTextFlow(i18n("WorldBossUiInfo_2",color,tname));this.roleHead.source="yuanhead"+mainRoleInfo.job+mainRoleInfo.sex;this.bloodBar0.maximum=hpTotal;this.bloodBar0.value=hpValue;this.bloodBar0.setValue();this.bloodBar0.setLabel();this.neigongBar0.maximum=neigongTotal;this.neigongBar0.value=neigongValue;this.neigongBar0.setValue();this.neigongBar0.setLabel("")}else{this.belongGroup.visible=false}if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS)this.belongGroup.visible=false};WorldBossUiInfo.prototype.refushWeixieList=function(){if(!this.isDelayUpdate){this.isDelayUpdate=true;TimerManager.ins().doTimer(500,1,this.updateWeixieList,this)}};WorldBossUiInfo.prototype.updateRank=function(){if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS){this.myTxt.visible=true;var dataArr=UserBoss.ins().rank?UserBoss.ins().rank.concat():[];var len=dataArr.length;if(len){if(len>3){len=3}var showArr=dataArr.slice(1,len);this.dropDown.setData(showArr);this.dropDown.setLabel(dataArr[0].roleName+":"+CommonUtils.overLength(dataArr[0].value))}else{this.dropDown.setData([]);this.dropDown.setLabel("")}for(var i=0;i<dataArr.length;i++){if(dataArr[i].id==Actor.actorID){var txt=CommonUtils.overLength(dataArr[i].value);this.myTxt.text=i18n("WorldBossUiInfo_3",txt);break}}}};WorldBossUiInfo.prototype.updateWeixieList=function(){this.isDelayUpdate=false;if(UserBoss.ins().weixieList.length>this.lastWeixieList.length){this.showAttGroupEff()}var cartList=this.getWeixieList();if(!this.list2.dataProvider){this.list2.dataProvider=new eui.ArrayCollection(cartList)}else{var dataPro=this.list2.dataProvider;dataPro.replaceAll(cartList)}this.lastWeixieList=UserBoss.ins().weixieList.slice();if(!this.list1.dataProvider){this.list1.dataProvider=new eui.ArrayCollection([GameLogic.ins().currAttackHandle])}else{var dataPro=this.list1.dataProvider;dataPro.replaceAll([GameLogic.ins().currAttackHandle])}this.checkListVis();if(UserBoss.ins().weixieList.length){this.checkGuide()}};WorldBossUiInfo.prototype.getWeixieList=function(){var list=UserBoss.ins().weixieList;var charList=[];for(var _i=0,list_8=list;_i<list_8.length;_i++){var handle=list_8[_i];var masterList=EntityManager.ins().getMasterList(handle);var char=void 0;if(masterList&&masterList.length){for(var _a=0,masterList_1=masterList;_a<masterList_1.length;_a++){var monster=masterList_1[_a];if(monster instanceof CharRole){char=monster;break}}if(!char)char=masterList[0]}else{char=EntityManager.ins().getEntityByHandle(handle)}if(char)charList.push(char)}return charList};WorldBossUiInfo.prototype.showAttGroupEff=function(){var _this=this;if(!this.attEffectGroup.visible){this.attEffectGroup.touchEnabled=false;this.attEffectGroup.visible=true;var t=egret.Tween.get(this.attEffectGroup);t.to({alpha:1},500).to({alpha:0},500).to({alpha:1},500).to({alpha:0},500).call(function(){_this.attEffectGroup.visible=false},this)}};WorldBossUiInfo.prototype.refushcanPlayList=function(){this.reflashAtkInfo();this.checkListVis();this.refushWeixieList()};WorldBossUiInfo.prototype.checkListVis=function(){var role=EntityManager.ins().getNoDieRole();var bool=role&&role.infoModel.getAtt(AttributeType.atHp)>0&&UserBoss.ins().winner=="";this.beAttackGroup.visible=UserBoss.ins().weixieList.length>0&&bool;this.attackGroup.visible=bool;if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS){this.beAttackGroup.visible=false;this.attackGroup.visible=false}this.setBtnState(bool)};WorldBossUiInfo.prototype.checkGuide=function(){if(UserFb.ins().guideBossKill==1){GuideUtils.ins().updateByAppear()}};WorldBossUiInfo.prototype.setBtnState=function(bool){this.attguishu.visible=true;if(!bool){this.attackPlayer.currentState="attgsup";this.attackBoss.currentState="attbossup";return}if(UserBoss.ins().attHandle==Actor.handle){this.attackPlayer.currentState="attgsdis";this.attguishu.visible=false}else{if(GameLogic.ins().currAttackHandle){this.attackPlayer.currentState="attgsing"}else{this.attackPlayer.currentState="attgsup"}}if(GameLogic.ins().currAttackHandle||this.attackPlayer.currentState=="attgsing"){this.attackBoss.currentState="attbossup"}else{this.attackBoss.currentState="attbossing"}};WorldBossUiInfo.prototype.onBegin=function(e){switch(e.currentTarget){case this.attackPlayer:this.attackPlayer.scaleX=this.attackPlayer.scaleY=.8;break;case this.attackBoss:this.attackBoss.scaleX=this.attackBoss.scaleY=.8;break}};WorldBossUiInfo.prototype.onEnd=function(e){switch(e.currentTarget){case this.attackPlayer:this.attackPlayer.scaleX=this.attackPlayer.scaleY=1;break;case this.attackBoss:this.attackBoss.scaleX=this.attackBoss.scaleY=1;break;default:this.attackPlayer.scaleX=this.attackPlayer.scaleY=1;this.attackBoss.scaleX=this.attackBoss.scaleY=1;break}};WorldBossUiInfo.prototype.onTap=function(e){switch(e.currentTarget){case this.btn:if(this.btn.currentState=="down"){this.list1.dataProvider=new eui.ArrayCollection([])}else{this.refushcanPlayList()}break;case this.attackBoss:if(GameLogic.ins().currAttackHandle==0){return}this.clearRendererItem();GameLogic.ins().postChangeAttrPoint(0);break;case this.attackPlayer:case this.belongGroup:if(UserBoss.ins().attHandle==Actor.handle||UserBoss.ins().attHandle==GameLogic.ins().currAttackHandle){return}if(!this.list1||!this.list1.dataProvider||this.list1.dataProvider.length<=0)return;if(!UserBoss.ins().canClick){return}this.clearRendererItem();if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){UserFb.ins().sendGuideFbAttacker()}else{GameLogic.ins().postChangeAttrPoint(UserBoss.ins().attHandle)}break;case this.tipBtn:if(GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS){ViewManager.ins().open(WorldBossJiangliTipWin)}else{ViewManager.ins().open(PublicBossJiangliTipWin)}break;case this.attguishu:UserTips.ins().showTips(i18n("WorldBossUiInfo_0"));break}};WorldBossUiInfo.prototype.list2Tap=function(e){if(!UserBoss.ins().canClick||UserBoss.ins().attHandle==GameLogic.ins().currAttackHandle){return}var item=this.list2.getChildAt(e.itemIndex);if(!item)return;this.clearRendererItem();item.addAttEffect();var attHandle=item.data;if(item.data instanceof CharMonster){attHandle=item.data.infoModel.masterHandle}if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){UserFb.ins().sendGuideFbAttacker()}else{GameLogic.ins().postChangeAttrPoint(attHandle)}if(!(UserBoss.ins().attHandle==attHandle))EntityShowMgr.ins().showHideSomeOne(attHandle)};WorldBossUiInfo.prototype.clearRendererItem=function(){var len=this.list1.numChildren;for(var index=0;index<len;index++){var item=this.list1.getChildAt(index);item.clearEffect()}len=this.list2.numChildren;for(var index=0;index<len;index++){var item=this.list2.getChildAt(index);item.clearEffect()}};WorldBossUiInfo.prototype.reflashBlood=function(){if(this._curMonsterID!=UserBoss.ins().monsterID){this.updateBaseInfo()}this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];if(!this.bossConfig){this.bossBloodGroup.visible=false;this.checkListVis();return}var charm=EntityManager.ins().getEntityByHandle(UserBoss.ins().bossHandler);if(!charm||!charm.infoModel){this.bossBloodGroup.visible=false;this.checkListVis();return}var monstermodel=charm?charm.infoModel:null;if(monstermodel){this.bloodBar.maximum=monstermodel.getAtt(AttributeType.atMaxHp);this.bloodBar.value=monstermodel.getAtt(AttributeType.atHp);this.bloodBar.setValue();this.bossBloodGroup.visible=this.bloodBar.value>0}else{this.bloodBar.maximum=this.bossConfig.hp;this.bloodBar.value=this.bossConfig.hp;this.bloodBar.setValue();this.bossBloodGroup.visible=this.bloodBar.value>0}this.curValue=Math.floor(this.bloodBar.value/this.bloodBar.maximum*100);this.tweenBlood()};WorldBossUiInfo.prototype.huDunChange=function(){if(UserBoss.ins().shieldType){if(UserBoss.ins().curShield>0){if(!TimerManager.ins().isExists(this.setTimeShieldChange,this))TimerManager.ins().doTimer(1e3,0,this.setTimeShieldChange,this);this.setTimeShieldChange()}}else{this.setHpShieldChange()}};WorldBossUiInfo.prototype.setHpShieldChange=function(){if(UserBoss.ins().curShield&&UserBoss.ins().curShield>0){this.hudun.visible=true;var value=Math.ceil(UserBoss.ins().curShield/UserBoss.ins().totalShield*100);this.hudunbloodBar.value=value;this.hudunbloodBar.setValue();this.hudunbloodBar.setLabel()}else{this.hudun.visible=false}};WorldBossUiInfo.prototype.setTimeShieldChange=function(){this.hudunbloodBar.value=UserBoss.ins().curShield;this.hudunbloodBar.maximum=UserBoss.ins().totalShield;this.hudunbloodBar.setValue();this.hudunbloodBar.setLabel();if(UserBoss.ins().curShield>0){this.hudun.visible=true}else{TimerManager.ins().remove(this.setTimeShieldChange,this);this.hudun.visible=false}UserBoss.ins().curShield--};WorldBossUiInfo.prototype.worldBossEnd=function(){var _this=this;TimerManager.ins().remove(this.reflashAtkInfo,this);if(GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS){this.endGroup.visible=true;this.winnerName.text=i18n("WorldBossUiInfo_1",UserBoss.ins().winner);var time_1=Math.ceil((UserBoss.ins().worldBossEndTime-egret.getTimer())/1e3);this.leftTime.text=DateUtils.getFormatTimeByStyle(time_1,DateUtils.STYLE_4);TimerManager.ins().doTimer(1e3,time_1,function(){time_1--;_this.leftTime.text=DateUtils.getFormatTimeByStyle(time_1,DateUtils.STYLE_4);if(time_1==0){UserFb.ins().sendExitFb()}},this)}this.attList.visible=this.attackBtnGroup.visible=this.attackPlayer.visible=this.attackBoss.visible=false};WorldBossUiInfo.prototype.reliveInfoChange=function(){if(UserBoss.ins().reliveTime>0||BossHomeSys.ins().rebornCd>0){ViewManager.ins().open(WorldBossBeKillWin)}else{ViewManager.ins().close(WorldBossBeKillWin)}this.refushWeixieList()};WorldBossUiInfo.prototype.tweenBlood=function(){var bloodPer=this.curValue*this.GRAYIMG_WIDTH/100;var self=this;egret.Tween.removeTweens(self.grayScroller);if(bloodPer<3)return;var t=egret.Tween.get(self.grayScroller);t.to({width:bloodPer-3},800).call(function(){if(bloodPer<=0){egret.Tween.removeTweens(self.grayScroller)}})};return WorldBossUiInfo}(BaseEuiView);__reflect(WorldBossUiInfo.prototype,"WorldBossUiInfo");ViewManager.ins().reg(WorldBossUiInfo,LayerManager.UI_Main);var WorldBossWin=function(_super){__extends(WorldBossWin,_super);function WorldBossWin(){var _this=_super.call(this)||this;_this.selectIndex=0;_this.isTopLevel=true;return _this}WorldBossWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WorldBossSkin";this.bossImage=new MovieClip;this.bossImage.scaleX=-1;this.bossImage.scaleY=1;this.bossImage.x=330;this.bossImage.y=380;this.challengeBtn.y=400};return WorldBossWin}(BaseEuiView);__reflect(WorldBossWin.prototype,"WorldBossWin");ViewManager.ins().reg(WorldBossWin,LayerManager.UI_Main);var NewBossJiangliView=function(_super){__extends(NewBossJiangliView,_super);function NewBossJiangliView(){var _this=_super.call(this)||this;_this.skinName="wpkBossJiangLiTishiSkin";return _this}NewBossJiangliView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.belongList.itemRenderer=ItemBaseNoName;this.endList.itemRenderer=ItemBaseNoName;this.joinList.itemRenderer=ItemBaseNoName};NewBossJiangliView.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.giveUp,this.onTap);this.initView()};NewBossJiangliView.prototype.initView=function(){var cfg=GlobalConfig.NewWorldBossBaseConfig;this.belongList.dataProvider=new ArrayCollection(cfg.rankRewardShow);this.endList.dataProvider=new ArrayCollection(cfg.killRewardShow);this.joinList.dataProvider=new ArrayCollection(cfg.joinRewardShow)};NewBossJiangliView.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.closeBtn||tar==this.giveUp){ViewManager.ins().close(this)}};NewBossJiangliView.prototype.close=function(){};return NewBossJiangliView}(BaseEuiView);__reflect(NewBossJiangliView.prototype,"NewBossJiangliView");ViewManager.ins().reg(NewBossJiangliView,LayerManager.UI_Popup);var NewWorldBossUIView=function(_super){__extends(NewWorldBossUIView,_super);function NewWorldBossUIView(){var _this=_super.call(this)||this;_this.GRAYIMG_WIDTH=0;_this.leftTime=0;_this._curMonsterID=0;_this.curValue=1;_this.skinName="wpkBossUiSkin";return _this}NewWorldBossUIView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.bossBloodGroup.visible=false;this.leftTimeGroup.visible=false;this.dropDown.visible=false;this.dropDown.setEnabled(false);this.attList.visible=false;this.attList0.visible=false;this.grayImg.source="bosshp2";this.grayImgMask=new egret.Rectangle(0,0,this.grayImg.width,this.grayImg.height);this.grayImg.mask=this.grayImgMask;this.GRAYIMG_WIDTH=this.grayImg.width};NewWorldBossUIView.prototype.open=function(){this.observe(UserBoss.ins().postHpChange,this.reflashBlood);this.observe(UserBoss.ins().postBossAppear,this.reflashBlood);this.observe(UserBoss.ins().postNewBossReliveTime,this.updateReliveTime);this.observe(UserBoss.ins().postNewBossOpen,this.updateTime);this.observe(UserBoss.ins().postNewBossRank,this.updateRank);this.observe(UserBoss.ins().postAddAttrNum,this.updateAttr);this.addTouchEvent(this.guwu,this.onTap);this.addTouchEvent(this.tipBtn0,this.onTap);this.initView()};NewWorldBossUIView.prototype.initView=function(){this.updateTime();this.updateReliveTime();this.updateAttr();this.dropDown.currentState="down";this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];if(!this.bossConfig){return}this.updateBaseInfo();this.reflashBlood()};NewWorldBossUIView.prototype.updateTime=function(){var time=UserBoss.ins().newWorldBossData.startTime;var isOpen=UserBoss.ins().newWorldBossData.isOpen;if(!isOpen||!time){this.leftTimeGroup.visible=false;return}var overTime=Math.floor((GameServer.serverTime-time)/1e3);if(overTime<=0||overTime>=GlobalConfig.NewWorldBossBaseConfig.bossTime){this.leftTimeGroup.visible=false;return}this.leftTimeGroup.visible=true;this.leftTime=GlobalConfig.NewWorldBossBaseConfig.bossTime-overTime;if(!TimerManager.ins().isExists(this.setTime,this)){TimerManager.ins().doTimer(1e3,0,this.setTime,this)}this.setTime()};NewWorldBossUIView.prototype.setTime=function(){this.lastTime.text=DateUtils.getFormatBySecond(this.leftTime,DateUtils.TIME_FORMAT_10);if(this.leftTime>0){this.leftTime-=1}};NewWorldBossUIView.prototype.updateReliveTime=function(){if(UserBoss.ins().reliveTime>0){ViewManager.ins().open(WorldBossBeKillWin)}else{ViewManager.ins().close(WorldBossBeKillWin)}};NewWorldBossUIView.prototype.updateBaseInfo=function(){this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];if(!this.bossConfig){return}this._curMonsterID=UserBoss.ins().monsterID;this.nameTxt.text=this.bossConfig.name;this.head.source="monhead"+this.bossConfig.head+"_png";this.lvTxt.text=this.bossConfig.level+"级"};NewWorldBossUIView.prototype.reflashBlood=function(){if(this._curMonsterID!=UserBoss.ins().monsterID){this.updateBaseInfo()}this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];if(!this.bossConfig){this.bossBloodGroup.visible=false;this.leftTimeGroup.visible=false;return}var charm=EntityManager.ins().getEntityByHandle(UserBoss.ins().bossHandler);if(!charm||!charm.infoModel||charm.infoModel.getAtt(AttributeType.atHp)<=0){this.bossBloodGroup.visible=false;this.leftTimeGroup.visible=false;return}var monstermodel=charm?charm.infoModel:null;if(monstermodel){this.bloodBar.maximum=monstermodel.getAtt(AttributeType.atMaxHp);this.bloodBar.value=monstermodel.getAtt(AttributeType.atHp);this.bossBloodGroup.visible=this.bloodBar.value>0}else{this.bloodBar.maximum=this.bossConfig.hp;this.bloodBar.value=this.bossConfig.hp;this.bossBloodGroup.visible=this.bloodBar.value>0}if(!this.bossBloodGroup.visible)this.leftTimeGroup.visible=false;this.dropDown.visible=true;this.updateRank();this.curValue=Math.floor(this.bloodBar.value/this.bloodBar.maximum*100);this.tweenBlood()};NewWorldBossUIView.prototype.tweenBlood=function(){var _this=this;var bloodPer=this.curValue*this.GRAYIMG_WIDTH/100;var self=this;egret.Tween.removeTweens(this.grayImgMask);if(bloodPer<3)return;var t=egret.Tween.get(this.grayImgMask,{onChange:function(){if(self.grayImg)self.grayImg.mask=_this.grayImgMask}},self);t.to({width:bloodPer-3},1e3).call(function(){if(bloodPer<=0){self.grayImgMask.width=this.GRAYIMG_WIDTH;egret.Tween.removeTweens(this.grayImgMask)}},self)};NewWorldBossUIView.prototype.updateRank=function(){var dataArr=UserBoss.ins().newWorldBossData.rankList?UserBoss.ins().newWorldBossData.rankList.concat():[];var len=dataArr.length;if(len){if(len>3){len=3}var showArr=dataArr.slice(1,len);this.dropDown.setData(showArr);this.dropDown.setLabel(dataArr[0].roleName+":"+CommonUtils.overLength(dataArr[0].value))}else{this.dropDown.setData([]);this.dropDown.setLabel("")}for(var i=0;i<dataArr.length;i++){if(dataArr[i].id==Actor.actorID){var txt=CommonUtils.overLength(dataArr[i].value);this.myTxt.text=i18n("NewWorldBossUIView_0",txt);break}}};NewWorldBossUIView.prototype.updateAttr=function(){var count=UserBoss.ins().newWorldBossData.addAttrNum||0;var curConf=GlobalConfig.NewWorldBossAttrConfig[count];var nextConf=GlobalConfig.NewWorldBossAttrConfig[count+1];var str="";var curAttr={type:0,value:0};var nextAttr={type:0,value:0};if(nextConf){for(var i=0;i<nextConf.attr.length;i++){if(i>0)str+="\n";nextAttr.type=nextConf.attr[i].type;nextAttr.value=nextConf.attr[i].value;curAttr.type=nextAttr.type;curAttr.value=0;if(curConf&&curConf.attr[i]){curAttr.value=curConf.attr[i].value}str+=AttributeData.getAttStrByType(curAttr,0,":",false);nextAttr.value-=curAttr.value;str+=AttributeData.getAttStrByType(nextAttr,0,"+",false,false)}if(!this.costGroup.parent){this.timeGroup.addChildAt(this.costGroup,0)}}else{for(var i=0;i<curConf.attr.length;i++){if(i>0)str+="\n";str+=AttributeData.getAttStrByType(curConf.attr[i],0,":",false)}if(this.costGroup.parent){this.costGroup.parent.removeChild(this.costGroup)}}this.guwuNum.text=str;this.guwutime.text=count+"/"+Object.keys(GlobalConfig.NewWorldBossAttrConfig).length;var conf=nextConf||curConf;if(conf.type==1){this.typeImg.source="szjinbi"}else if(conf.type==2){this.typeImg.source="szyuanbao"}this.cost.text=conf.count+""};NewWorldBossUIView.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.guwu){if(UserBoss.ins().newWorldBossData.addAttrNum==Object.keys(GlobalConfig.NewWorldBossAttrConfig).length){UserTips.ins().showTips(i18n("NewWorldBossUIView_1"));return}var count=UserBoss.ins().newWorldBossData.addAttrNum||0;var nextConf=GlobalConfig.NewWorldBossAttrConfig[count+1];if(nextConf){if(nextConf.type==1&&Actor.gold<nextConf.count){UserTips.ins().showTips(i18n("NewWorldBossUIView_2"));return}else if(nextConf.type==2&&Actor.yb<nextConf.count){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("NewWorldBossUIView_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("NewWorldBossUIView_4"));return}}UserBoss.ins().sendBuyAddAttrNum()}else if(tar==this.tipBtn0){ViewManager.ins().open(NewBossJiangliView)}};NewWorldBossUIView.prototype.close=function(){TimerManager.ins().removeAll(this);WatcherUtil.removeFromArray(UserBoss.ins().newWorldBossData.rankList);this._curMonsterID=0};return NewWorldBossUIView}(BaseEuiView);__reflect(NewWorldBossUIView.prototype,"NewWorldBossUIView");ViewManager.ins().reg(NewWorldBossUIView,LayerManager.UI_Main);var NewWorldBossWin=function(_super){__extends(NewWorldBossWin,_super);function NewWorldBossWin(){var _this=_super.call(this)||this;_this.skinName="wpkBossSkin";return _this}NewWorldBossWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.bossImage=new MovieClip;this.bossImage.scaleX=-1;this.bossImage.scaleY=1;this.bossImage.x=0;this.bossImage.y=215;this.boss.addChild(this.bossImage);this.list.itemRenderer=ItemBaseNoName;UserBoss.ins().sendGetNewBossInfo()};NewWorldBossWin.prototype.open=function(){this.observe(UserBoss.ins().postNewBossInfo,this.update);this.addTouchEvent(this.enter,this.onTap);this.addTouchEvent(this.help,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.update()};NewWorldBossWin.prototype.update=function(){var id=UserBoss.ins().newWorldBossData.bossID;var config=GlobalConfig.MonstersConfig[id];if(!config)return;this.nameTxt.text=config.name+"("+config.level+")";this.bossImage.playFile(RES_DIR_MONSTER+("monster"+config.avatar+"_3s"),-1);this.list.dataProvider=new eui.ArrayCollection(GlobalConfig.NewWorldBossBaseConfig.showAwards);this.bar.maximum=config.hp;this.bar.value=UserBoss.ins().newWorldBossData.curHp};NewWorldBossWin.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.enter){if(UserBoss.ins().newWorldBossData.startTime>GameServer.serverTime){var date=new Date(UserBoss.ins().newWorldBossData.startTime);var time=i18n("NewWorldBossWin_4",date.getHours(),date.getMinutes()?date.getMinutes()+i18n("NewWorldBossWin_0"):"");UserTips.ins().showTips(i18n("NewWorldBossWin_2",time));return}if(!UserBoss.ins().checkNewWorldBossOpen()){UserTips.ins().showTips(i18n("NewWorldBossWin_3",GlobalConfig.NewWorldBossBaseConfig.openLv));return}UserBoss.ins().sendIntoNewBoss();ViewManager.ins().close(this)}else if(tar==this.help){ViewManager.ins().open(ZsBossRuleSpeak,15)}else if(tar==this.bgClose){ViewManager.ins().close(this)}else if(tar==this.closeBtn){ViewManager.ins().close(this)}};NewWorldBossWin.prototype.close=function(){};return NewWorldBossWin}(BaseEuiView);__reflect(NewWorldBossWin.prototype,"NewWorldBossWin");ViewManager.ins().reg(NewWorldBossWin,LayerManager.UI_Popup);var Box=function(_super){__extends(Box,_super);function Box(){var _this=_super.call(this)||this;_this.arrOpenData=[];_this.freeInfoList=[];_this.sysId=PackageID.Box;_this.regNetMsg(1,_this.updateBoxData);_this.regNetMsg(2,_this.getBox);_this.regNetMsg(3,_this.updateTipsList);_this.regNetMsg(5,_this.getBoxNotice);_this.regNetMsg(6,_this.doShowRewardInfo);_this.arrTips=[];return _this}Box.ins=function(){return _super.ins.call(this)};Box.prototype.postUpdateData=function(){};Box.prototype.postUpdateFreeBox=function(){};Box.prototype.getGridInfoById=function(id){for(var i=0;i<this.arrOpenData.length;i++){if(this.arrOpenData[i].pos==id){return this.arrOpenData[i]}}return null};Box.prototype.isHaveFreePos=function(){var num=0;for(var i=0;i<this.arrOpenData.length;i++){if(this.arrOpenData[i].state==2&&this.arrOpenData[i].getTime()>0){++num}}var freeNum=UserVip.ins().lv>=GlobalConfig.TreasureBoxBaseConfig.thirdOpenLevel?2:1;return freeNum>num};Box.prototype.updateBoxQueue=function(){};Box.prototype.canAdd=function(){for(var i=1;i<4;i++){if(this.arrOpenData[i].canUsed&&this.arrOpenData[i].itemId==0)return true}return false};Box.prototype.getAddIndex=function(){for(var i=1;i<4;i++){if(this.arrOpenData[i].canUsed&&this.arrOpenData[i].itemId==0)return i}return 0};Box.prototype.updateBoxData=function(bytes){var len=bytes.readShort();this.arrOpenData=[];for(var i=0;i<len;i++){var data=new BoxOpenData;data.updateData(bytes);this.arrOpenData.push(data)}len=bytes.readShort();this.freeInfoList=[];for(var i=0;i<len;i++){var data=new BoxFreeData;data.updateData(bytes);this.freeInfoList.push(data)}TimerManager.ins().removeAll(this);this.postUpdateData()};Box.prototype.sendOpen=function(index){var bytes=this.getBytes(2);bytes.writeShort(index);this.sendToServer(bytes)};Box.prototype.getBox=function(bytes){UserTips.ins().showBoxTips(bytes.readShort())};Box.prototype.sendAddToQueue=function(id){var bytes=this.getBytes(3);bytes.writeShort(id);this.sendToServer(bytes)};Box.prototype.updateTipsList=function(bytes){var len=bytes.readShort();for(var i=0;i<len;i++){var data=new BoxTipsData;data.id=bytes.readShort();data.name=bytes.readString();this.arrTips.push(data)}this.postUpdateData()};Box.prototype.sendOpenFreeBox=function(index){var bytes=this.getBytes(4);bytes.writeShort(index);this.sendToServer(bytes)};Box.prototype.getBoxNotice=function(bytes){UserTips.ins().showRewardBox(bytes.readShort())};Box.prototype.doShowRewardInfo=function(bytes){var type=bytes.readShort();var len=bytes.readShort();var rewardList=[];for(var i=0;i<len;i++){var item=new RewardData;item.parser(bytes);rewardList.push(item)}ViewManager.ins().open(BoxOpenWin,type,rewardList)};return Box}(BaseSystem);__reflect(Box.prototype,"Box");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.box=Box.ins.bind(Box)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var BoxItemData=function(){function BoxItemData(){}return BoxItemData}();__reflect(BoxItemData.prototype,"BoxItemData");var BoxModel=function(_super){__extends(BoxModel,_super);function BoxModel(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.gridCfgList=[];return _this}BoxModel.ins=function(){return _super.ins.call(this)};BoxModel.prototype.getGridCfgList=function(){if(this.gridCfgList.length>0){return this.gridCfgList}var list=GlobalConfig.TreasureBoxGridConfig;for(var str in list){this.gridCfgList.push(list[str])}return this.gridCfgList};BoxModel.prototype.countBoxTimeCost=function(time,type){var cost=GlobalConfig.TreasureBoxBaseConfig.moneyCoefficient;var num=Math.ceil(time/60)*cost;var boxCoefficient=1;var boxCfg=GlobalConfig.TreasureBoxConfig[type];if(boxCfg)boxCoefficient=boxCfg.quality;num=Math.ceil(boxCoefficient*num);return num};BoxModel.prototype.getOtherBoxIsTimeDown=function(index){var other=index==0?1:0;var data=Box.ins().freeInfoList[other];return data.getTime()<=0};BoxModel.prototype.getDownTimeIndex=function(){var data1=Box.ins().freeInfoList[0];var data2=Box.ins().freeInfoList[1];var time1=data1.getTime();var time2=data2.getTime();if(time2>0&&time1>0){if(time1>time2){return data2.pos}return data1.pos}else if(time2>0&&time1<=0){return data2.pos}else if(time2<=0&&time1>0){return data1.pos}else{return 0}};BoxModel.prototype.checkRedPointShow=function(){if(Actor.level<GlobalConfig.TreasureBoxBaseConfig.openLevel){return false}var box=Box.ins();var data1=box.freeInfoList[0];var data2=box.freeInfoList[1];if(!data1||!data2)return false;if(data1.getTime()<=0||data2.getTime()<=0){return true}var openList=box.arrOpenData;var havePos=box.isHaveFreePos();for(var i=0;i<openList.length;i++){var data=openList[i];if(data.itemId>0&&data.state==1&&havePos){return true}}return false};BoxModel.prototype.checkCanTake=function(){var box=Box.ins();var data1=box.freeInfoList[0];var data2=box.freeInfoList[1];if(!data1||!data2)return false;if(data1.getTime()<=0||data2.getTime()<=0){return true}var openList=box.arrOpenData;for(var _i=0,openList_1=openList;_i<openList_1.length;_i++){var item=openList_1[_i];if(item.itemId>0&&item.state==2&&item.getTime()<=0){return true}}return false};BoxModel.prototype.getMinBoxTime=function(){var list=Box.ins().freeInfoList;var time=Number.MAX_VALUE;for(var _i=0,list_9=list;_i<list_9.length;_i++){var box=list_9[_i];if(box&&box.getTime()<time){time=box.getTime()}}var openList=Box.ins().arrOpenData;for(var _a=0,openList_2=openList;_a<openList_2.length;_a++){var item=openList_2[_a];if(item.itemId>0&&item.state==2&&item.getTime()<time){time=item.getTime()}}return time};return BoxModel}(BaseClass);__reflect(BoxModel.prototype,"BoxModel");var BoxOpenData=function(){function BoxOpenData(){this.itemId=0;this.canUsed=true}BoxOpenData.prototype.updateData=function(bytes){this.pos=bytes.readShort();this.itemId=bytes.readShort();this.state=bytes.readShort();this.remindTime=bytes.readInt();this.updateTime=egret.getTimer()};BoxOpenData.prototype.getTime=function(){return Math.floor((this.remindTime*1e3+this.updateTime-egret.getTimer())/1e3)};BoxOpenData.prototype.getDetailData=function(){var arrDesc=GlobalConfig.TreasureBoxConfig[this.itemId].desc;var arrRewards=GlobalConfig.TreasureBoxConfig[this.itemId].rewards;var data=[];for(var i=0;i<arrDesc.length;i++){var item=new BoxItemData;item.desc=arrDesc[i];item.reward=arrRewards[i];data.push(item)}return data};return BoxOpenData}();__reflect(BoxOpenData.prototype,"BoxOpenData");var BoxFreeData=function(){function BoxFreeData(){this.statu=1}BoxFreeData.prototype.updateData=function(bytes){this.pos=bytes.readShort();this.remindTime=bytes.readInt();this.updateTime=egret.getTimer()};BoxFreeData.prototype.getTime=function(){return Math.max(Math.floor((this.remindTime*1e3+this.updateTime-egret.getTimer())/1e3),0)};return BoxFreeData}();__reflect(BoxFreeData.prototype,"BoxFreeData");var BoxRoomData=function(){function BoxRoomData(){this.itemId=0;this.canUsed=true}BoxRoomData.prototype.updateData=function(bytes){this.itemId=bytes.readShort();if(this.itemId)this.name=GlobalConfig.TreasureBoxConfig[this.itemId].name};return BoxRoomData}();__reflect(BoxRoomData.prototype,"BoxRoomData");var BoxTipsData=function(){function BoxTipsData(){}return BoxTipsData}();__reflect(BoxTipsData.prototype,"BoxTipsData");var BoxBgWin=function(_super){__extends(BoxBgWin,_super);function BoxBgWin(){var _this=_super.call(this)||this;_this.skinName="chestbgskin";_this.isTopLevel=true;return _this}BoxBgWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addChangeEvent(this.tab,this.onTabTouch);this.observe(Book.ins().postDataChange,this.redUpdate);this.observe(Box.ins().postUpdateData,this.redUpdate);this.observe(Box.ins().postUpdateFreeBox,this.redUpdate);this.addTouchEvent(this.help,this.onBtnClick);this.tab.selectedIndex=this.viewStack.selectedIndex=param[0]||0;this._ext=param[1];this.setSelectedIndex(this.tab.selectedIndex);this.help.visible=false;this.redUpdate()};BoxBgWin.prototype.close=function(){this.boxPanel.close();this.bookPanel.close();this.removeObserve()};BoxBgWin.prototype.redUpdate=function(){this.redPoint1.visible=BoxModel.ins().checkRedPointShow();this.redPoint2.visible=Book.ins().getBookRed()};BoxBgWin.prototype.onBtnClick=function(e){switch(e.currentTarget){case this.help:ViewManager.ins().open(ZsBossRuleSpeak,11);break}};BoxBgWin.prototype.onTabTouch=function(e){if(e===void 0){e=null}this.setSelectedIndex(this.tab.selectedIndex)};BoxBgWin.prototype.setSelectedIndex=function(index){this.help.visible=false;if(index==0){this.boxPanel.open()}else if(index==1){if(this._ext){this.bookPanel.open(this._ext);this._ext=null}else{this.bookPanel.open()}this.help.visible=true}};return BoxBgWin}(BaseEuiView);__reflect(BoxBgWin.prototype,"BoxBgWin");ViewManager.ins().reg(BoxBgWin,LayerManager.UI_Main);var BoxDetailItem=function(_super){__extends(BoxDetailItem,_super);function BoxDetailItem(){var _this=_super.call(this)||this;_this.skinName="ChestShowItemSkin";return _this}BoxDetailItem.prototype.dataChanged=function(){var data=this.data;this.labelDesc.textFlow=TextFlowMaker.generateTextFlow1(data.desc);this.item.data=data.reward};return BoxDetailItem}(BaseItemRender);__reflect(BoxDetailItem.prototype,"BoxDetailItem");var BoxDetailWin=function(_super){__extends(BoxDetailWin,_super);function BoxDetailWin(){var _this=_super.call(this)||this;_this.skinName="ChestRewardSkin";_this.list.dataProvider=null;_this.list.itemRenderer=BoxDetailItem;_this.isTopLevel=true;return _this}BoxDetailWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.data=param[0];var conf=GlobalConfig.TreasureBoxConfig[this.data.itemId];this.imgBox.source=conf.imgClose;this.updateList();this.endTime=this.data.getTime();if(this.data.state==2){this.currentState="payOpen";this.doTime();TimerManager.ins().doTimer(1e3,this.endTime,this.doTime,this)}else if(this.data.state==1&&Box.ins().isHaveFreePos()){this.currentState="open";this.t3.text=DateUtils.getFormatBySecond(conf.time)}else{this.currentState="jiesuo";this.labelTime.text=DateUtils.getFormatBySecond(conf.time);this.costMoney=BoxModel.ins().countBoxTimeCost(conf.time,conf.type);this.costNum.text=this.costMoney+"";if(UserVip.ins().lv<GlobalConfig.TreasureBoxBaseConfig.thirdOpenLevel){this.labelVip.visible=true;this.labelWarning.text=i18n("BoxDetailWin_0");this.labelVip.text=i18n("BoxDetailWin_1",GlobalConfig.TreasureBoxBaseConfig.thirdOpenLevel)}else{this.labelVip.visible=false;this.labelWarning.text=i18n("BoxDetailWin_2")}}this.addTouchEvent(this.rect,this.onTap);this.addTouchEvent(this.btnOpen,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap)};BoxDetailWin.prototype.close=function(){this.removeTouchEvent(this.rect,this.onTap);this.removeTouchEvent(this.btnOpen,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap)};BoxDetailWin.prototype.doTime=function(){this.endTime--;if(this.endTime<=-1){TimerManager.ins().remove(this.doTime,this);Box.ins().sendOpen(this.data.pos);ViewManager.ins().close(BoxDetailWin)}else{this.labelTime.text=DateUtils.getFormatBySecond(this.endTime,1);this.costMoney=BoxModel.ins().countBoxTimeCost(this.endTime,this.data.itemId);this.costNum.text=this.costMoney+""}};BoxDetailWin.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(this.data.getDetailData())};BoxDetailWin.prototype.onTap=function(e){switch(e.target){case this.btnOpen:if(Actor.yb<this.costMoney){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("BoxDetailWin_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("BoxDetailWin_4"))}ViewManager.ins().close(this);return}Box.ins().sendOpen(this.data.pos);ViewManager.ins().close(BoxDetailWin);break;case this.rect:case this.closeBtn:ViewManager.ins().close(BoxDetailWin);break}};return BoxDetailWin}(BaseEuiView);__reflect(BoxDetailWin.prototype,"BoxDetailWin");ViewManager.ins().reg(BoxDetailWin,LayerManager.UI_Popup);var BoxFreeItemRenderer=function(_super){__extends(BoxFreeItemRenderer,_super);function BoxFreeItemRenderer(){var _this=_super.call(this)||this;_this.skinName="ChestSkinReward2";return _this}BoxFreeItemRenderer.prototype.dataChanged=function(){this.info=this.data;if(!this.info)return;this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);var downIndex=BoxModel.ins().getDownTimeIndex();if(this.info.getTime()>0&&downIndex==this.info.pos){this.currentState="close";this.refushDaojishi();TimerManager.ins().doTimer(1e3,0,this.refushDaojishi,this)}else{if(this.info.getTime()<=0){this.currentState="open"}else{this.currentState="wait"}}};BoxFreeItemRenderer.prototype.refushDaojishi=function(){var time=this.info.getTime();this.labelTime.text=DateUtils.getFormatBySecond(time);if(time<=0){TimerManager.ins().removeAll(this);this.currentState="open";Box.ins().postUpdateFreeBox()}};BoxFreeItemRenderer.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);this.removeTimer()};BoxFreeItemRenderer.prototype.removeTimer=function(){TimerManager.ins().removeAll(this)};return BoxFreeItemRenderer}(BaseItemRender);__reflect(BoxFreeItemRenderer.prototype,"BoxFreeItemRenderer");var BoxGetHintTips=function(_super){__extends(BoxGetHintTips,_super);function BoxGetHintTips(){var _this=_super.call(this)||this;_this.skinName="ChestInformationSkin";_this.horizontalCenter=0;_this.bottom=0;return _this}Object.defineProperty(BoxGetHintTips.prototype,"data",{set:function(type){var boxCfg=GlobalConfig.TreasureBoxConfig[type];if(boxCfg){this.information.text=i18n("BoxGetHintTips_0",boxCfg.name);this.box.source=boxCfg.imgClose}},enumerable:true,configurable:true});return BoxGetHintTips}(BaseView);__reflect(BoxGetHintTips.prototype,"BoxGetHintTips");var BoxOpenItem=function(_super){__extends(BoxOpenItem,_super);function BoxOpenItem(){var _this=_super.call(this)||this;_this.skinName="ChestStateOpenSkin";return _this}BoxOpenItem.prototype.dataChanged=function(){this.labelTime.text="";TimerManager.ins().removeAll(this);var data=this.data;this.time=data.getTime();if(!data.canUsed){this.labelTips.text=""+data.openTips;this.currentState="tips";return}if(!data.itemId){this.currentState="add";return}var conf=GlobalConfig.TreasureBoxConfig[data.itemId];this.imgBox.source=conf.imgClose;if(this.time>0){TimerManager.ins().doTimer(1e3,this.time,this.updateTime,this);this.currentState="waiting"}else{this.currentState="canOpen"}};BoxOpenItem.prototype.updateTime=function(){if(this.time>0){this.time--;this.labelTime.text=DateUtils.getFormatBySecond(this.time,1)}else{TimerManager.ins().removeAll(this)}};BoxOpenItem.prototype.destruct=function(){TimerManager.ins().removeAll(this)};return BoxOpenItem}(BaseItemRender);__reflect(BoxOpenItem.prototype,"BoxOpenItem");var BoxOpenWin=function(_super){__extends(BoxOpenWin,_super);function BoxOpenWin(){var _this=_super.call(this)||this;_this.rewardList=[];_this.items=[];_this.rollNum=0;_this.index=0;_this.skinName="ChestOpenRewardSkin";_this.list.itemRenderer=ItemBase;_this.isTopLevel=true;return _this}BoxOpenWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var para=param[0];this.conf=GlobalConfig.TreasureBoxConfig[para];this.rewardList=param[1];this.list.dataProvider=new eui.ArrayCollection(this.rewardList);this.addTouchEvent(this.bgClose,this.onTap);this.showTween()};BoxOpenWin.prototype.close=function(){};BoxOpenWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(BoxOpenWin);break}};BoxOpenWin.prototype.showTween=function(){var _this=this;this.imgBox.source=this.conf.imgClose;this.rollNum=0;var t=egret.Tween.get(this.imgBox,{loop:true});t.to({x:265},20).to({x:245},20).to({x:265},20).call(function(){++_this.rollNum;if(_this.rollNum>=9){egret.Tween.removeTweens(_this.imgBox);_this.rotationComplete()}},this)};BoxOpenWin.prototype.rotationComplete=function(){this.imgBox.source=this.conf.imgOpen;this.movieComplete()};BoxOpenWin.prototype.movieComplete=function(){var count=this.rewardList.length;var waitTime=0;for(var i=0;i<count;i++){this.items[i]=this.createItem(this.rewardList[i]);var t=egret.Tween.get(this.items[i]);var posX=i%5*96+3;var posY=Math.floor(i/5)*106+205;this.items[i].alpha=0;t.wait(waitTime).to({x:posX,y:posY,alpha:1},200);waitTime+=500}this.boxBgMc=this.boxBgMc||new MovieClip;this.boxBgMc.x=0;this.boxBgMc.y=50;this.boxBgMc.playFile(RES_DIR_EFF+"laddercircle",-1);this.bgGroup.addChild(this.boxBgMc)};BoxOpenWin.prototype.createItem=function(data){var item=new ItemBase;this.listCon.addChild(item);item.data=data;item.x=204;item.y=52;return item};BoxOpenWin.prototype.showUp=function(){var tar=this.list.getElementAt(this.index);++this.index;tar.visible=true;var t=egret.Tween.get(tar);t.to({alpha:0},200)};return BoxOpenWin}(BaseEuiView);__reflect(BoxOpenWin.prototype,"BoxOpenWin");ViewManager.ins().reg(BoxOpenWin,LayerManager.UI_Main);var BoxPayItemRenderer=function(_super){__extends(BoxPayItemRenderer,_super);function BoxPayItemRenderer(){var _this=_super.call(this)||this;_this.skinName="ChestSkinState1";return _this}BoxPayItemRenderer.prototype.dataChanged=function(){var info=this.data;var level=UserFb.ins().guanqiaID;egret.Tween.removeTweens(this.imgNeedle);this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);this.imgNeedle.rotation=0;if(info.chapter>level){this.currentState="kong2";this.openDesc.text=i18n("BoxPayItemRenderer_0",info.chapter)}else{var openInfo=Box.ins().getGridInfoById(info.pos);this.dataInfo=openInfo;if(openInfo&&openInfo.itemId>0){var boxCfg=GlobalConfig.TreasureBoxConfig[openInfo.itemId];if(boxCfg)this.baoxiang.source=boxCfg.imgClose;if(openInfo.state==1){if(boxCfg){this.boxName.text=boxCfg.name;this.jishi.text=DateUtils.getFormatBySecond(boxCfg.time,9)}if(Box.ins().isHaveFreePos()){this.currentState="wait2"}else{this.currentState="wait3"}}else{if(openInfo.getTime()>0){this.currentState="wait";this.refushDaojishi();TimerManager.ins().doTimer(1e3,0,this.refushDaojishi,this);this.runTween()}else{this.currentState="open"}}}else{this.currentState="kong"}}};BoxPayItemRenderer.prototype.runTween=function(){this.imgNeedle.rotation=0;egret.Tween.removeTweens(this.imgNeedle);var t=egret.Tween.get(this.imgNeedle,{loop:true});t.to({rotation:360},2e3)};BoxPayItemRenderer.prototype.refushDaojishi=function(){var lastTime=this.dataInfo.getTime();this.t3.text=DateUtils.getFormatBySecond(lastTime);var cost=BoxModel.ins().countBoxTimeCost(lastTime,this.dataInfo.itemId);this.payNum.text=cost+"";if(lastTime<=0){TimerManager.ins().removeAll(this);this.currentState="open";this.imgNeedle.rotation=0}};BoxPayItemRenderer.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);TimerManager.ins().removeAll(this);egret.Tween.removeTweens(this.imgNeedle)};return BoxPayItemRenderer}(BaseItemRender);__reflect(BoxPayItemRenderer.prototype,"BoxPayItemRenderer");var BoxRoomItem=function(_super){__extends(BoxRoomItem,_super);function BoxRoomItem(){return _super.call(this)||this}BoxRoomItem.prototype.dataChanged=function(){var data=this.data;if(!data.canUsed){this.currentState="Tips";this.labelTips.text=i18n("BoxRoomItem_0",data.openChapter);return}if(data.itemId){this.currentState="box";var conf=GlobalConfig.TreasureBoxConfig[data.itemId];this.imgBox.source=conf.imgClose;this.labelName.text=conf.name}else{this.currentState="room"}};return BoxRoomItem}(BaseItemRender);__reflect(BoxRoomItem.prototype,"BoxRoomItem");var BoxTipsItem=function(_super){__extends(BoxTipsItem,_super);function BoxTipsItem(){var _this=_super.call(this)||this;_this.skinName="ChestInformationSkin";return _this}BoxTipsItem.prototype.dataChanged=function(){var data=this.data;var str=i18n("BoxTipsItem_1");str+=data.name+i18n("BoxTipsItem_0");var item=GlobalConfig.ItemConfig[data.id];str+=i18n("BoxTipsItem_2")+ItemConfig.getQualityColor(item)+"&T:"+item.name+"|";this.label.textFlow=TextFlowMaker.generateTextFlow1(str)};return BoxTipsItem}(BaseItemRender);__reflect(BoxTipsItem.prototype,"BoxTipsItem");var BoxWin=function(_super){__extends(BoxWin,_super);function BoxWin(){var _this=_super.call(this)||this;_this.skinName="ChestSkin";_this.name=i18n("BoxWin_0");return _this}BoxWin.prototype.createChildren=function(){this.listBox.itemRenderer=BoxPayItemRenderer};BoxWin.prototype.open=function(){this.addTouchEvent(this.listBox,this.onListTap);this.addTouchEvent(this.box1,this.onTap);this.addTouchEvent(this.box2,this.onTap);this.observe(Box.ins().postUpdateData,this.setGridInfo);this.observe(Box.ins().postUpdateFreeBox,this.setFreeBox);this.setGridInfo()};BoxWin.prototype.close=function(){this.removeTouchEvent(this.box1,this.onTap);this.removeTouchEvent(this.box2,this.onTap);this.removeTouchEvent(this.listBox,this.onListTap);this.removeObserve();this.box1.removeTimer();this.box2.removeTimer()};BoxWin.prototype.setGridInfo=function(){this.listBox.dataProvider=new eui.ArrayCollection(BoxModel.ins().getGridCfgList());this.setFreeBox()};BoxWin.prototype.setFreeBox=function(){var openNum=0;var data=Box.ins().freeInfoList[0];this.box1.data=data;if(data.getTime()<=0){++openNum}data=Box.ins().freeInfoList[1];this.box2.data=data;if(data.getTime()<=0){++openNum}this.freeNum.text="("+openNum+"/2)"};BoxWin.prototype.onListTap=function(e){var tar=e.target.parent;if(!tar||!tar.data)return;var info=tar.data;var level=UserFb.ins().guanqiaID;if(info.chapter>level){UserTips.ins().showTips(i18n("BoxWin_1"));return}var data=Box.ins().getGridInfoById(tar.data.pos);if(data&&data.itemId>0){if(data.state==2&&data.getTime()<=0){Box.ins().sendOpen(data.pos)}else{ViewManager.ins().open(BoxDetailWin,data)}}else{UserWarn.ins().setBuyGoodsWarn(GlobalConfig.TreasureBoxBaseConfig.getItemguide,1)}};BoxWin.prototype.onTap=function(e){switch(e.currentTarget){case this.box1:if(this.box1.currentState=="open"){Box.ins().sendOpenFreeBox(1)}break;case this.box2:if(this.box2.currentState=="open"){Box.ins().sendOpenFreeBox(2)}break}};BoxWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(Actor.level>=GlobalConfig.TreasureBoxBaseConfig.openLevel){return true}UserTips.ins().showTips(i18n("BoxWin_2",GlobalConfig.TreasureBoxBaseConfig.openLevel));return false};return BoxWin}(BaseEuiView);__reflect(BoxWin.prototype,"BoxWin");ViewManager.ins().reg(BoxWin,LayerManager.UI_Main);var BtnHejiWin=function(_super){__extends(BtnHejiWin,_super);function BtnHejiWin(){var _this=_super.call(this)||this;_this.skinName="BtnHejiSkin";return _this}BtnHejiWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.heji,this.onTap);if(PaoDianCC.ins().isPaoDian||BattleGround.ins().isPaoDian){this.y=200}this.hejiState(Setting.ins().getValue(ClientSet.autoHeji))};BtnHejiWin.prototype.onTap=function(){var state=Setting.ins().getValue(ClientSet.autoHeji)>0?0:1;this.hejiState(state);Setting.ins().setValue(ClientSet.autoHeji,state)};BtnHejiWin.prototype.hejiState=function(state){this.heji.icon=!state||state==0?"noheji_png":"heji_png"};return BtnHejiWin}(BaseEuiView);__reflect(BtnHejiWin.prototype,"BtnHejiWin");ViewManager.ins().reg(BtnHejiWin,LayerManager.UI_Popup);var CDKey=function(_super){__extends(CDKey,_super);function CDKey(){var _this=_super.call(this)||this;_this.sysId=PackageID.CDKey;_this.regNetMsg(1,_this.doChangeResult);return _this}CDKey.ins=function(){return _super.ins.call(this)};CDKey.prototype.sendCdkey=function(str){if(str.length<=0){UserTips.ins().showTips(i18n("CDKey_0"));return}var bytes=this.getBytes(1);bytes.writeString(str);this.sendToServer(bytes)};CDKey.prototype.doChangeResult=function(bytes){var result=bytes.readByte();var error_msg=bytes.readString();var str;if(result==0){str=i18n("CDKey_6")}else{str=i18n("CDKey_7")+error_msg+"|"}UserTips.ins().showTips(str)};return CDKey}(BaseSystem);__reflect(CDKey.prototype,"CDKey");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.cdkey=CDKey.ins.bind(CDKey)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var CDKeyWin=function(_super){__extends(CDKeyWin,_super);function CDKeyWin(){return _super.call(this)||this}CDKeyWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="CDkeySkin";this.input.maxChars=28};CDKeyWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.sendBtn,this.onTap)};CDKeyWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.sendBtn,this.onTap)};CDKeyWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(CDKeyWin);break;case this.sendBtn:CDKey.ins().sendCdkey(this.input.text);break}};return CDKeyWin}(BaseEuiView);__reflect(CDKeyWin.prototype,"CDKeyWin");ViewManager.ins().reg(CDKeyWin,LayerManager.UI_Main);var FollowWin=function(_super){__extends(FollowWin,_super);function FollowWin(){var _this=_super.call(this)||this;_this.type=1;return _this}FollowWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="FollowSkin";this.list.itemRenderer=ItemBase};FollowWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateInfo(param);this.observe(ChannelNet.ins().postShareStart,this.updateInfo);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.followBtn,this.onTap)};FollowWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateInfo,this);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.followBtn,this.onTap);this.removeObserve()};FollowWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.followBtn:this.onFollow();break}};FollowWin.prototype.onFollow=function(){if(ChannelMgr.ins().isFKYLCChannel()){var sdk=window["HORTOR_AGENT"];if(!sdk){console.log("channel 20117 sdk = null L205");return}sdk.showQRCode();console.log("channel 20117 sdk.showQRCode()")}if(ChannelMgr.ins().isAWYCChannel()){var sdk=window["AWY_SDK"];if(!sdk){console.log("channel 20118 sdk = null");return}sdk.showFocus();console.log("channel 20118 sdk.showQRCode()")}};FollowWin.prototype.updateInfo=function(param){if(param){this.type=param[0]||1}var cfg=GlobalConfig.QzoneShareConfig[this.type];var awards=cfg&&cfg.awards||[];var limit=cfg.max_count||0;this.list.dataProvider=new eui.ArrayCollection(awards)};return FollowWin}(BaseEuiView);__reflect(FollowWin.prototype,"FollowWin");ViewManager.ins().reg(FollowWin,LayerManager.UI_Popup);var InviteWin=function(_super){__extends(InviteWin,_super);function InviteWin(){var _this=_super.call(this)||this;_this.type=1;_this.n=0;return _this}InviteWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="InviteDailySkin";this.list.itemRenderer=ItemBase};InviteWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateInfo(param);this.observe(ChannelNet.ins().postShareStart,this.updateInfo);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.bgClose0,this.onTap);this.addTouchEvent(this.fxBtn,this.onTap);this.guideGroup.visible=false;if(ChannelMgr.ins().isAWYCChannel()){this.bg.source="cn_invite";this.count.x=425;this.fxBtn.label=i18n("InviteWin_1")}else{this.bg.source="cn_share_bg";this.count.x=453;this.fxBtn.label=i18n("InviteWin_2")}};InviteWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateInfo,this);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.bgClose0,this.onTap);this.removeTouchEvent(this.fxBtn,this.onTap);this.removeObserve()};InviteWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.bgClose0:this.guideGroup.visible=false;break;case this.fxBtn:this.onFxBtn();break}};InviteWin.prototype.onFxBtn=function(){if(ChannelMgr.ins().isAWYCChannel()){var sdk=window["AWY_SDK"];if(!sdk){console.log("channel 20118 sdk = null before share");return}sdk.showShare()}else{this.guideGroup.visible=true}};InviteWin.prototype.updateInfo=function(param){if(param){this.type=param[0]||1;this.n=param[1]||0}var cfg=GlobalConfig.QzoneShareConfig[this.type];var awards=cfg&&cfg.awards||[];var limit=cfg.max_count||0;var left=Math.max(0,limit-this.n);this.count.textFlow=TextFlowMaker.generateTextFlow1(i18n("InviteWin_0",left,limit));this.list.dataProvider=new eui.ArrayCollection(awards)};return InviteWin}(BaseEuiView);__reflect(InviteWin.prototype,"InviteWin");ViewManager.ins().reg(InviteWin,LayerManager.UI_Popup);var VertifyWin=function(_super){__extends(VertifyWin,_super);function VertifyWin(){var _this=_super.call(this)||this;_this.type=1;return _this}VertifyWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="VertifySkin";this.list.itemRenderer=ItemBase};VertifyWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateInfo(param);this.observe(ChannelNet.ins().postShareStart,this.updateInfo);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.vertifyBtn,this.onTap)};VertifyWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateInfo,this);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.vertifyBtn,this.onTap);this.removeObserve()};VertifyWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.vertifyBtn:this.onVertify();break}};VertifyWin.prototype.onVertify=function(){if(ChannelMgr.ins().isAWYCChannel()){var sdk=window["AWY_SDK"];if(!sdk){console.log("channel 20118 sdk = null");return}sdk.showFocus();console.log("channel 20118 sdk.verify()");sdk.verify(function(data){var error=data.error;var wallow=data.wallow;window["20118verify"]=error==0?true:window["20118verify"];window["20118wallow"]=wallow==1?true:window["20118wallow"];console.log("channel 20118 sdk.verify callback error="+error+" wallow="+wallow)})}};VertifyWin.prototype.updateInfo=function(param){if(param){this.type=param[0]||1}var cfg=GlobalConfig.QzoneShareConfig[this.type];var awards=cfg&&cfg.awards||[];var limit=cfg.max_count||0;this.list.dataProvider=new eui.ArrayCollection(awards)};return VertifyWin}(BaseEuiView);__reflect(VertifyWin.prototype,"VertifyWin");ViewManager.ins().reg(VertifyWin,LayerManager.UI_Popup);var newPlayerChapterGiftWin=function(_super){__extends(newPlayerChapterGiftWin,_super);function newPlayerChapterGiftWin(){return _super.call(this)||this}newPlayerChapterGiftWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ChapterGiftWinSkin";this.rankrewardlistItem.itemRenderer=ItemBase};newPlayerChapterGiftWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var chaptergiftconfig=GlobalConfig.ChaptersGiftConfig;this.observe(UserFb.ins().postGuanKaIdChange,this.guanqiaChange);this.btnGet.visible=false;this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.btnGet,this.onTap);this.showUI(chaptergiftconfig)};newPlayerChapterGiftWin.prototype.guanqiaChange=function(){UserFb.ins().guanqiaID};newPlayerChapterGiftWin.prototype.showUI=function(chaptergiftconfig){var nowUseItemid=nPChapterGiftSys.ins().useitemID;var rewards=this.getGiftItemReward(chaptergiftconfig,nowUseItemid);if(rewards){this.rankrewardlistItem.dataProvider=new eui.ArrayCollection(rewards);if(rewards.length>3){this.BG0.height=320;this.btnGet.y=390}else{this.BG0.height=230;this.btnGet.y=296}this.isShowGetBtn();TimerManager.ins().remove(this.isShowGetBtn,this);TimerManager.ins().doTimer(1e3,1,this.isShowGetBtn,this)}};newPlayerChapterGiftWin.prototype.isShowGetBtn=function(){if(nPChapterGiftSys.ins().isCangetchapterGift()){this.btnGet.visible=true}};newPlayerChapterGiftWin.prototype.getGiftItemReward=function(chaptergiftconfig,nowUseItemid){for(var cfg in chaptergiftconfig){if(nowUseItemid==chaptergiftconfig[cfg].itemId){return chaptergiftconfig[cfg].rewards}}return};newPlayerChapterGiftWin.prototype.onTap=function(e){switch(e.target){case this.btnGet:nPChapterGiftSys.ins().onChapterGiftBtn();break;case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break}};newPlayerChapterGiftWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap)};return newPlayerChapterGiftWin}(BaseEuiView);__reflect(newPlayerChapterGiftWin.prototype,"newPlayerChapterGiftWin");ViewManager.ins().reg(newPlayerChapterGiftWin,LayerManager.UI_Main);var nPChapterGiftSys=function(_super){__extends(nPChapterGiftSys,_super);function nPChapterGiftSys(){var _this=_super.call(this)||this;_this.useitemID=-1;_this.isSendUse=false;_this.observe(UserBag.ins().postUseItemSuccess,_this.useSuccessShow);return _this}nPChapterGiftSys.ins=function(){return _super.ins.call(this)};nPChapterGiftSys.prototype.isCangetchapterGift=function(){var chaptergiftconfig=GlobalConfig.ChaptersGiftConfig;if(this.ishadchapterGift()){if(UserFb.ins().guanqiaID>chaptergiftconfig[this.nowcfgID].needLevel){return true}}return false};nPChapterGiftSys.prototype.ishadchapterGift=function(){var chaptergiftconfig=GlobalConfig.ChaptersGiftConfig;for(var cfg in chaptergiftconfig){if(UserBag.ins().getBagItemById(chaptergiftconfig[cfg].itemId)){this.nowcfgID=cfg;return true}}return false};nPChapterGiftSys.prototype.onChapterGiftBtn=function(){var chaptergiftconfig=GlobalConfig.ChaptersGiftConfig;var item=null;var needchapterLevel;if(this.ishadchapterGift()){var id=chaptergiftconfig[this.nowcfgID].itemId;item=UserBag.ins().getBagItemById(id);needchapterLevel=chaptergiftconfig[this.nowcfgID].needLevel}if(item){if(this.isCangetchapterGift()){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}UserBag.ins().sendUseItem(item._configID,1);this.isSendUse=true;this.useitemID=item._configID}}};nPChapterGiftSys.prototype.ChapterCompare=function(){var chaptergiftconfig=GlobalConfig.ChaptersGiftConfig;var nowChapter=UserFb.ins().guanqiaID-1;var index=+this.nowcfgID;var NewChapter=1;for(var i=1;i<Object.keys(chaptergiftconfig).length;i++){if(chaptergiftconfig[i]&&chaptergiftconfig[i+1]){if(UserFb.ins().guanqiaID>chaptergiftconfig[i].needLevel&&UserFb.ins().guanqiaID<=chaptergiftconfig[i+1].needLevel){NewChapter=chaptergiftconfig[i+1].needLevel}}}return NewChapter-nowChapter};nPChapterGiftSys.prototype.useSuccessShow=function(){var _this=this;if(this.useitemID>0&&this.isSendUse){var nowUseItemid=nPChapterGiftSys.ins().useitemID;var rewards=this.getGiftItemRewards(nowUseItemid);if(rewards!=null){RewardWin.show(rewards,RewardWin.TYPE_TONGGUAN,function(btnIdx){_this.onChapterGiftBtn()})}this.isSendUse=false}};nPChapterGiftSys.prototype.getGiftItemRewards=function(nowUseItemid){var cfgs=GlobalConfig.ChaptersGiftConfig;for(var k in cfgs){var cfg=cfgs[k];if(nowUseItemid==cfg.itemId){return cfg.rewards}}return null};return nPChapterGiftSys}(BaseSystem);__reflect(nPChapterGiftSys.prototype,"nPChapterGiftSys");var Chat=function(_super){__extends(Chat,_super);function Chat(){var _this=_super.call(this)||this;_this.isShowTip=false;_this.chatInterval=5e3;_this.charMax=50;_this.canSpeak=true;_this.UpSpeak="";_this.feedbackSuccess=-1;_this.feedbackString="";_this.canSpeakTime=0;_this.is800CustomerService=false;_this.initData();_this.sysId=PackageID.Chat;_this.regNetMsg(1,_this.doNewChatMsg);_this.regNetMsg(2,_this.doSystemInfo);_this.regNetMsg(3,_this.doIsSendSuccess);_this.regNetMsg(4,_this.postSystemMessage);_this.regNetMsg(5,_this.doCannotSpeak);_this.regNetMsg(6,_this.dopostFeedback);_this.regNetMsg(7,_this.doHas800CustomerService);return _this}Chat.prototype.initData=function(){if(!this._chatListData)this._chatListData=new eui.ArrayCollection;if(!this._systemListData)this._systemListData=new eui.ArrayCollection;if(!this._chatListData2)this._chatListData2=new eui.ArrayCollection;if(!this._chatListData3)this._chatListData3=new eui.ArrayCollection;if(!this._chatListData4)this._chatListData4=new eui.ArrayCollection;this._chatListData.removeAll();this._systemListData.removeAll();this._chatListData2.removeAll();this._chatListData3.removeAll();this._chatListData4.removeAll()};Chat.ins=function(){return _super.ins.call(this)};Chat.prototype.sendFeedback=function(type,msg){var bytes=this.getBytes(2);bytes.writeInt(Number(ChannelMgr.ins().main_channel));bytes.writeInt(Number(ChannelMgr.ins().sub_channel));bytes.writeInt(type);bytes.writeString(msg);this.sendToServer(bytes)};Chat.prototype.dopostFeedback=function(bytes){this.feedbackSuccess=bytes.readInt();this.feedbackString=bytes.readString();if(this.feedbackSuccess==0){var warnWin=WarnWin.show(i18n("Chat_7"),null,null,null,null,"sure");warnWin.setBtnLabel(i18n("Chat_8"))}};Chat.prototype.doHas800CustomerService=function(bytes){this.is800CustomerService=bytes.readInt()==1};Chat.prototype.sendReqHas800CustomerService=function(){var bytes=this.getBytes(7);bytes.writeInt(parseInt(ChannelMgr.ins().main_channel));bytes.writeInt(parseInt(ChannelMgr.ins().sub_channel));GameLogic.ins().sendToServer(bytes)};Chat.prototype.sendChatInfo=function(type,str,pointId){if(pointId===void 0){pointId=0}if(str.length<=0){UserTips.ins().showTips(i18n("Chat_0"));return}if(str=="#testmonthcardexpired"){PlayFunView.addMonthCardExpiredTip(0);PlayFunView.addMonthCardExpiredTip(1);return}if(str=="#showaudio"){var AudioContext_1=window["AudioContext"]||window["webkitAudioContext"];var audioCtx_1=AudioContext_1?new AudioContext_1:"";var soundBuffer_1={getBuffer:function(link){return new Promise(function(resolve,reject){if(audioCtx_1){var request_1=new XMLHttpRequest;request_1.open("GET",link,true);request_1.responseType="arraybuffer";request_1.onload=function(){audioCtx_1.decodeAudioData(request_1.response,function(buffer){resolve(buffer)},function(e){console.log("reject");reject(e)})};request_1.send()}else{reject("not support AudioContext")}})},createSound:function(buffer){if(audioCtx_1.state!="running"){console.log(i18n("Chat_1"));audioCtx_1.resume()}var analyser=audioCtx_1.createAnalyser();var gainNode=audioCtx_1.createGain();var source=audioCtx_1.createBufferSource();source.buffer=buffer;source.connect(analyser);analyser.connect(gainNode);gainNode.connect(audioCtx_1.destination);return source}};soundBuffer_1.getBuffer("resource/sound/longlin_a_chuandai.ogg").then(function(buf){var sound=soundBuffer_1.createSound(buf);sound.start(0)}).catch(function(e){console.log(e)});return}if(str=="#hideui"){UIView2.instance.visible=false;PlayFunView.instance.visible=false;ChatMainUI.instance.visible=false;return}if(str=="#hidegame"){GameSceneView.instance.visible=false;return}if(str=="#nores"){var testimg=new eui.Image;testimg.source="res_no_exists";GameSceneView.instance.addChild(testimg);return}if(str.charAt(0)=="@"){var bytes_1=this.getBytes(0);bytes_1.writeString(str);this.sendToServer(bytes_1);return}if(ChannelMgr.ins().isQQZoneChannel()){var isYearvip=QzoneSys.ins().isYellowYearVip()?1:0;str=str+QzoneSys.MARK_QZVIP+QzoneSys.ins().getYellowViplv()+QzoneSys.MARK_QZYEAR+isYearvip}if(ChannelMgr.ins().isQQDaTingChannel()){var isYearvip=QQDaTingSys.ins().isDaTYearVip()?1:0;var isHighvip=QQDaTingSys.ins().isDaTHighVip()?1:0;str=str+QQDaTingSys.MARK_DATVIP+QQDaTingSys.ins().getDaTViplv()+QQDaTingSys.MARK_DATHIGHVIP+isHighvip+QQDaTingSys.MARK_DATYEAR+isYearvip}var bytes=this.getBytes(1);bytes.writeByte(type);bytes.writeUnsignedInt(pointId);bytes.writeString(str);this.sendToServer(bytes);if(type==7&&this.isCanSpeak()){ReportData.getIns().reportChat(str,4)}};Chat.prototype.doNewChatMsg=function(bytes){var message_length=bytes.readInt();var messageList=[];for(var i=0;i<message_length;i++){var message=new ChatInfoData(bytes);messageList.push(message)}this.onDealMessage(messageList)};Chat.prototype.onDealMessage=function(messageList){for(var _i=0,messageList_1=messageList;_i<messageList_1.length;_i++){var message=messageList_1[_i];if(Friends.ins().indexOfBlackList(message.id)==-1&&message.type!=Chat.CHANNEL_TYPE_KF&&message.type!=Chat.CHANNEL_TYPE_TEAM){this.insertChatMsg(message)}else if(message.type==Chat.CHANNEL_TYPE_KF){this.insertKfChatMsg(message)}else if(message.type==Chat.CHANNEL_TYPE_TEAM){this.insertTeamChatMsg(message);var channel=i18n("Chat_10");var name_7="";if(message.name){name_7=i18n("Chat_11")+message.name+"]|"}if(SysSetting.ins().getBool(SysSetting.SHOW_DANMU_TEAM)){ViewManager.ins().open(FlyingWorldView).showNotice(channel+name_7+message.str)}}}};Chat.prototype.insertChatMsg=function(message){if(!this._chatListData){this._chatListData=new eui.ArrayCollection}if(this._chatListData.length>=this.charMax){var msg=this._chatListData.removeItemAt(0);this.removeAllChatMsg(msg)}this._chatListData.addItem(message);this.insertAllChatMsg(message);this.postNewChatMsg(message)};Chat.prototype.insertKfChatMsg=function(message){if(!this._chatListData3){this._chatListData3=new eui.ArrayCollection}if(this._chatListData3.length>=this.charMax){var msg=this._chatListData3.removeItemAt(0);this.removeAllChatMsg(msg)}this._chatListData3.addItem(message);this.insertAllChatMsg(message);this.postNewChatMsg(message)};Chat.prototype.insertTeamChatMsg=function(message){if(!this._chatListData4){this._chatListData4=new eui.ArrayCollection}if(this._chatListData4.length>=this.charMax){var msg=this._chatListData4.removeItemAt(0);this.removeAllChatMsg(msg)}this.insertAllChatMsg(message);this._chatListData4.addItem(message);this.postNewChatMsg(message)};Chat.prototype.insertAllChatMsg=function(message){if(!this._chatListData2){this._chatListData2=new eui.ArrayCollection}if(message&&message.str&&message.str.indexOf(i18n("Chat_2"))>-1){return}else{this._chatListData2.addItem(message)}};Chat.prototype.removeAllChatMsg=function(message){var index=this._chatListData2.getItemIndex(message);if(index>=0){this._chatListData2.removeItemAt(index)}};Chat.prototype.removeChatWithId=function(userId){if(this._chatListData&&this._chatListData.length){var source=[];for(var i=0;i<this._chatListData.length;i++){var cData=this._chatListData.getItemAt(i);if(cData.id!=userId){source.push(cData)}}this._chatListData.source=source;this._chatListData.refresh()}};Chat.prototype.postNewChatMsg=function(message){return message};Chat.prototype.doSystemInfo=function(bytes){};Chat.prototype.doIsSendSuccess=function(bytes){var result=bytes.readShort();if(result==1){this.postSendInfoSuccess()}else if(result==2){UserTips.ins().showDownTips(i18n("Chat_9"))}else{}};Chat.prototype.postSendInfoSuccess=function(){};Chat.prototype.postSystemMessage=function(bytes){var level=bytes.readInt();var type=bytes.readInt();var str=bytes.readString();if(level==0||Actor.level>=level){switch(type){case 8:UserTips.ins().showCenterTips2(str);break;case 4:ErrorLog.ins().show(str);if(AutoTestMgr.ins().testReportStarted){AutoTestMgr.ins().reportError(str)}break;case 2:UserTips.ins().showCenterTips(str);break;default:UserTips.ins().showTips(str);break}}return str};Chat.prototype.doCannotSpeak=function(bytes){this.canSpeakTime=bytes.readInt()};Chat.prototype.isCanSpeak=function(){if(this.canSpeakTime){if(this.canSpeakTime>GameServer.serverTime/1e3)return false}return true};Chat.prototype.sortListDatabyDate=function(chatlistData){chatlistData.sort(function(n1,n2){if(n1.chatdate>n2.chatdate){return 1}if(n1.chatdate<n2.chatdate){return-1}return 0})};Object.defineProperty(Chat.prototype,"chatListData",{get:function(){if(!this._chatListData)this._chatListData=new eui.ArrayCollection;return this._chatListData},enumerable:true,configurable:true});Object.defineProperty(Chat.prototype,"chatListData2",{get:function(){if(!this._chatListData2)this._chatListData2=new eui.ArrayCollection;return this._chatListData2},enumerable:true,configurable:true});Object.defineProperty(Chat.prototype,"chatListData3",{get:function(){if(!this._chatListData3)this._chatListData3=new eui.ArrayCollection;return this._chatListData3},enumerable:true,configurable:true});Object.defineProperty(Chat.prototype,"chatListData4",{get:function(){if(!this._chatListData4)this._chatListData4=new eui.ArrayCollection;return this._chatListData4},enumerable:true,configurable:true});Object.defineProperty(Chat.prototype,"chatListTip",{get:function(){if(!this._chatListData){this._chatListData=new eui.ArrayCollection([])}var len=this._chatListData.length;var start;var end;if(len>2){start=len-2;end=len}else{start=0;end=len}return this._chatListData.source.slice(start,end)},enumerable:true,configurable:true});Object.defineProperty(Chat.prototype,"chatListTip2",{get:function(){if(!this._chatListData2){this._chatListData2=new eui.ArrayCollection([])}var len=this._chatListData2.length;var start;var end;if(len>3){start=len-3;end=len}else{start=0;end=len}return this._chatListData2.source.slice(start,end)},enumerable:true,configurable:true});Chat.prototype.startInterval=function(){this.canSpeak=false;TimerManager.ins().doTimer(this.chatInterval,1,this.timeDo,this)};Chat.prototype.timeDo=function(){this.canSpeak=true};Chat.prototype.postSysChatMsg=function(message){if(this._systemListData.length>=this.charMax){var msg=this._systemListData.removeItemAt(0);this.removeAllChatMsg(msg)}if(message&&message.str&&message.str.indexOf(i18n("Chat_3"))>-1){}else{this._systemListData.addItem(message)}this.insertAllChatMsg(message);return message};Object.defineProperty(Chat.prototype,"systemListData",{get:function(){if(!this._systemListData)this._systemListData=new eui.ArrayCollection([]);return this._systemListData},enumerable:true,configurable:true});Chat.prototype.checkRepeatString=function(str){var len=str.length;if(len<=10){return true}var repeatNum=0;for(var i=0;i<len;i++){var strIndex=str.charAt(i);if(this.UpSpeak.lastIndexOf(strIndex)!=-1){++repeatNum}}if(repeatNum>=10){UserTips.ins().showTips(i18n("Chat_4"));return false}return true};Chat.prototype.getWorldStr=function(){return i18n("Chat_6")};Chat.prototype.getKfStr=function(){return i18n("Chat_5")};Chat.CHANNEL_TYPE_WORD=7;Chat.CHANNEL_TYPE_TEAM=4;Chat.CHANNEL_TYPE_KF=10;return Chat}(BaseSystem);__reflect(Chat.prototype,"Chat");window["gm"]=function gm(str){var bytes=GameLogic.ins().getBytes(0);bytes.writeString(str);GameLogic.ins().sendToServer(bytes)};var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.chat=Chat.ins.bind(Chat)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ChatMainUI=function(_super){__extends(ChatMainUI,_super);function ChatMainUI(){var _this=_super.call(this)||this;_this.resId=["xlt_98","xlt_99"];_this.fistOpenGuild=true;_this.firstShow=true;ChatMainUI.instance=_this;return _this}ChatMainUI.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ChatMainSkin";this.chatList.itemRenderer=ChatListItemRenderer2;this.chatList.itemRendererSkinName="ChatItemSkin2";this.dataList=new eui.ArrayCollection([]);this.chatList.dataProvider=this.dataList};ChatMainUI.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.message,this.onTap);this.addTouchEvent(this.chatList,this.onTap);this.observe(Chat.ins().postSysChatMsg,this.getNewNotice);this.observe(Chat.ins().postNewChatMsg,this.updateNewChatMsg);this.observe(GameLogic.ins().postEnterMap,this.checkShow);this.observe(UserTask.ins().postUpdteTaskTrace,this.updateTipShow);this.updataList();this.updateTipShow();this.setChatTipShow(Chat.ins().isShowTip);this.checkShow()};ChatMainUI.prototype.onTap=function(e){switch(e.currentTarget){case this.message:case this.chatList:{ViewManager.ins().open(ChatWin);break}}};ChatMainUI.prototype.getNewNotice=function(msg){if(msg.type==7){if(!this.chat){this.chat=new ChatTipsView;this.chat.y=this.message.y+12;this.chat.x=this.message.x+50}if(!this.chat.parent){this.addChildAt(this.chat,0)}this.chat.setData(msg)}else if(msg.type==3){this.updataList()}this.chudongChat()};ChatMainUI.prototype.updateNewChatMsg=function(){if(this.fistOpenGuild){this.fistOpenGuild=false;if(Guild.ins().guildID){Guild.ins().sendAllGuildMessage()}}this.updataList();this.chudongChat()};ChatMainUI.prototype.chudongChat=function(){var isChuDong=ChannelMgr.ins().isChuDongChannel();var is1758=ChannelMgr.ins().is1758Channel();if((isChuDong||is1758)&&this.firstShow){var str=i18n("ChatMainUI_0");if(is1758){str=i18n("ChatMainUI_1")}this.firstShow=false;setTimeout(function(){for(var i=0;i<3;++i){var data=new ChatSystemData(7,str);data.lv=1;data["name"]="";Chat.ins().insertChatMsg(data)}},200)}};ChatMainUI.prototype.updataList=function(){this.dataList.replaceAll(Chat.ins().chatListTip2.concat())};ChatMainUI.prototype.checkShow=function(){var fbID=GameMap.fubenID;this.updataLayer(fbID!=0);this.updataList()};ChatMainUI.prototype.updataLayer=function(value){if(value)this.chatGroup.y=616;else this.chatGroup.y=546};ChatMainUI.prototype.setChatTipShow=function(value){this.chatList.visible=true};ChatMainUI.prototype.updateTipShow=function(){var boo=true;this.setChatTipShow(boo)};ChatMainUI.prototype.destoryView=function(){_super.prototype.destoryView.call(this,false)};return ChatMainUI}(BaseEuiView);__reflect(ChatMainUI.prototype,"ChatMainUI");ViewManager.ins().reg(ChatMainUI,LayerManager.UI_Popup);var ChatWin=function(_super){__extends(ChatWin,_super);function ChatWin(){var _this=_super.call(this)||this;_this.isShowList=false;_this.cruIndex=0;_this.dataList=new eui.ArrayCollection;_this.fistOpenGuild=true;_this.isStretch=false;_this.isTopLevel=true;return _this}ChatWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ChatSkin";this.defaultText=i18n("ChatWin_0");this.chatInput.maxChars=30;this.input.maxChars=GlobalConfig.CustomServiceBaseConfig.wordlimit+10;this.tabData=new eui.ArrayCollection;this.tab.dataProvider=this.tabData;this.chatList.touchEnabled=false};ChatWin.prototype.refTab=function(){var world=Chat.ins().getWorldStr();var isTeam=UserFb.ins().isInTeamScene()?i18n("ChatWin_21"):i18n("ChatWin_1");var arr=[isTeam,world,i18n("ChatWin_20"),i18n("ChatWin_2"),i18n("ChatWin_3")];if(LocationProperty.appid!=PlatFormID.GE_TUI)arr.push(i18n("ChatWin_4"));this.tabData.replaceAll(arr)};ChatWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}Chat.ins().sendReqHas800CustomerService();if(this.input.text.length==0){this.input.text=this.defaultText;this.input.textColor=7105644}else{this.input.textColor=14668213}this.chatList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListTap,this,false);this.addTouchEvent(this.upBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.closeBg,this.onTap);this.addTouchEvent(this.sendBtn,this.onTap);this.addTouchEvent(this.allReceiveBtn,this.onTap);this.addTouchEvent(this.typelistBtn,this.onTap);this.observe(Chat.ins().postNewChatMsg,this.getNewOne);this.chatInput.addEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this);if(window["isSmallGame"]){this.textInOn()}this.observe(Chat.ins().postSendInfoSuccess,this.textInOn);this.addChangeEvent(this.tab,this.selectIndexChange);this.addChangingEvent(this.tab,this.checkIsOpen);this.addTouchEvent(this.sendBtn0,this.onTap);this.input.addEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this);this.observe(Guild.ins().postGetNewGuildMessage,this.getNewOneGuild);this.observe(Guild.ins().postAllGuildMessage,this.updataList);this.observe(UserMail.ins().postMailDetail,this.setOpenMail);this.observe(UserMail.ins().postMailData,this.onSendMail);this.observe(Guild.ins().postQuitGuild,this.updateMsgRedPoint);this.observe(GameLogic.ins().postEnterMap,this.updateMsgRedPoint);this.addTouchEvent(this.chatList,this.onSendMail);this.cruIndex=param[0]===undefined?this.cruIndex:param[0];if(this.cruIndex==ChatWin.GUILD_CHANNEL&&!Guild.ins().guildID){this.cruIndex=0}else if(this.cruIndex>ChatWin.GUILD_CHANNEL||this.cruIndex==ChatWin.KF_CHANNEL){this.cruIndex=0}this.refTab();this.backSelect(this.cruIndex);TimerManager.ins().doTimer(100,1,this.selectIndexChange,this);this.addDataProviderEvent();if(this.fistOpenGuild){this.fistOpenGuild=false;Guild.ins().sendAllGuildMessage()}};ChatWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.chatInput.removeEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this);this.input.removeEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this);WatcherUtil.removeFromArrayCollection(Chat.ins().chatListData);WatcherUtil.removeFromArrayCollection(Guild.ins().guildMessageInfoData);WatcherUtil.removeFromArrayCollection(Chat.ins().systemListData);this.removeDataProviderEvent();WatcherUtil.removeFromArrayCollection(this.tab.dataProvider);this.chatList.dataProvider=null;this.expressionlist0.dataProvider=null;this.expressionlist1.dataProvider=null;this.expressionlist2.dataProvider=null};ChatWin.prototype.destoryView=function(){};ChatWin.prototype.addDataProviderEvent=function(){if(this.chatList.dataProvider){this.chatList.dataProvider.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.listDataChange,this)}};ChatWin.prototype.removeDataProviderEvent=function(){if(this.chatList.dataProvider){this.chatList.dataProvider.removeEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.listDataChange,this)}};ChatWin.prototype.updateInput=function(){if(this.input.text==this.defaultText){this.input.text="";this.input.textColor=14668213}};ChatWin.prototype.checkIsOpen=function(e){var tab=e.target;if(tab.selectedIndex==ChatWin.GUILD_CHANNEL&&!Guild.ins().guildID){UserTips.ins().showTips(i18n("ChatWin_6"));e.preventDefault();return}if(tab.selectedIndex==5&&Actor.level<GlobalConfig.CustomServiceBaseConfig.openlevel){UserTips.ins().showTips(GlobalConfig.CustomServiceBaseConfig.openlevel+i18n("ChatWin_14"));e.preventDefault();return}if(tab.selectedIndex==5&&ChannelMgr.ins().isWXSmallGameChannel()){e.preventDefault();qingjs.instance.goCustomerService();return}if(tab.selectedIndex==5){if(Chat.ins().is800CustomerService&&!window["isSmallGame"]){e.preventDefault();EmbededWebPage.instance.popIFrame("https://v1.live800.com/live800/chatClient/chatbox.jsp?companyID=56788&configID=44613&jid=6451171910&enterurl=WLMZ&s=1&navHidden=1&closebt=1",null);return}}};ChatWin.prototype.selectIndexChange=function(e){this.oldChangle=this.cruIndex;this.cruIndex=this.tab.selectedIndex;this.updataList(true);if(this.cruIndex==ChatWin.GUILD_CHANNEL&&this.fistOpenGuild){this.fistOpenGuild=false;Guild.ins().sendAllGuildMessage()}};ChatWin.prototype.backSelect=function(id){this.tab.selectedIndex=id};ChatWin.prototype.onSendMail=function(e){if(!e)return;if(this.cruIndex==6){var item=e.target.parent;if(item){var mailData=item.data;if(mailData){UserMail.ins().sendMailContentData(mailData.handle)}}}};ChatWin.prototype.setOpenMail=function(mailData){if(this.cruIndex==6){for(var i=0;i<this.chatList.numChildren;i++){var item=this.chatList.getChildAt(i);if(item.data.handle==mailData.handle){item.data=mailData;break}}}};ChatWin.prototype.updataList=function(barChange){if(barChange===void 0){barChange=false}switch(this.cruIndex){case 0:if(!UserFb.ins().isInTeamScene()){this.currentState="all";this.removeDataProviderEvent();this.chatList.dataProvider=null;this.chatList.itemRenderer=ChatListItemRenderer3;Chat.ins().sortListDatabyDate(Chat.ins().chatListData2.source);Chat.ins().chatListData2.refresh();this.chatList.dataProvider=Chat.ins().chatListData2;this.chatList.itemRendererSkinName="ChatItemSkin3";this.chatList.validateNow();this.addDataProviderEvent();this.initExpressionUI()}else{this.currentState="all";this.removeDataProviderEvent();this.chatList.dataProvider=null;this.chatList.itemRenderer=ChatListItemRenderer4;this.chatList.dataProvider=Chat.ins().chatListData4;this.chatList.itemRendererSkinName="ChatItemSkin4";this.chatList.validateNow();this.addDataProviderEvent();this.initExpressionUI()}break;case 1:this.currentState="world";this.removeDataProviderEvent();this.chatList.dataProvider=null;this.chatList.itemRenderer=ChatListItemRenderer;this.chatList.dataProvider=Chat.ins().chatListData;this.chatList.itemRendererSkinName="ChatItemSkin";this.chatList.validateNow();this.addDataProviderEvent();this.initExpressionUI();break;case 2:this.currentState="kuafu";this.removeDataProviderEvent();this.chatList.dataProvider=null;this.chatList.itemRenderer=ChatListItemRenderer5;this.chatList.dataProvider=Chat.ins().chatListData3;this.chatList.itemRendererSkinName="ChatItemSkin5";this.chatList.validateNow();this.addDataProviderEvent();this.initExpressionUI();break;case 3:this.currentState="guild";this.removeDataProviderEvent();this.chatList.dataProvider=null;this.chatList.itemRenderer=ChatGuildItemRender;this.chatList.dataProvider=Guild.ins().guildMessageInfoData;this.chatList.itemRendererSkinName="ChatGuildItemSkin";this.chatList.validateNow();this.addDataProviderEvent();this.initExpressionUI();break;case 4:this.currentState="sys";this.removeDataProviderEvent();this.chatList.itemRenderer=ChatSystemItemRenderer;this.chatList.dataProvider=Chat.ins().systemListData;this.addDataProviderEvent();break;case 5:this.currentState="customService";this.initServiceUI();this.removeDataProviderEvent();break}this.chatInput.textColor=16777215;this.listDataChange();this.updateMsgRedPoint()};ChatWin.prototype.updateMsgRedPoint=function(){if(KFServerSys.ins().isKF){this.redPoint2.visible=false;return}if(this.tab.selectedIndex==ChatWin.GUILD_CHANNEL){Guild.ins().hasNewMsg=false}this.redPoint2.visible=Guild.ins().hasNewMsg};ChatWin.prototype.getNewOne=function(msg){if(Friends.ins().indexOfBlackList(msg.id)!=-1)return;this.refushBar();this.updateMsgRedPoint()};ChatWin.prototype.getNewOneGuild=function(msg){if(Friends.ins().indexOfBlackList(msg.id)!=-1)return;this.refushBar()};ChatWin.prototype.listDataChange=function(){if(this.cruIndex!=4){if(this.cruIndex==6)this.refushBarListTop();else this.refushBar()}};ChatWin.prototype.refushBar=function(){this.barList.viewport.validateNow();TimerManager.ins().doTimer(100,2,this.refushBarList,this)};ChatWin.prototype.refushBarList=function(){this.barList.viewport.validateNow();if(this.barList.viewport.contentHeight>this.barList.height){this.barList.viewport.scrollV=this.barList.viewport.contentHeight-this.barList.height}};ChatWin.prototype.refushBarListTop=function(){this.barList.viewport.scrollV=0};ChatWin.prototype.textInOn=function(){if(this.chatInput.text==i18n("ChatWin_19"))this.chatInput.text=""};ChatWin.prototype.callBack=function(){this.input.text=""};ChatWin.prototype.setStretchWin=function(){if(this.isStretch){this.isStretch=false;this.upBtn.scaleY=1;this.winGroup.height=ChatWin.LITTLE_HEIGHT}else{this.isStretch=true;this.upBtn.scaleY=-1;this.winGroup.height=ChatWin.BIG_HEIGHT}this.updataList()};ChatWin.prototype.allReceiveMail=function(){var list=[];var mailList=UserMail.ins().getMailByReceive();for(var i=0;i<mailList.length;i++){list.push(mailList[i].handle)}UserMail.ins().sendGetItem(list)};ChatWin.prototype.onListTap=function(){var selectedItem=this.chatList.selectedItem;if(selectedItem&&(selectedItem instanceof ChatInfoData||selectedItem instanceof GuildMessageInfo||selectedItem instanceof ChatSystemData)){if(selectedItem instanceof ChatSystemData){var str=selectedItem.str;if(str&&str.indexOf("|E:")>=0){this.onLink(str);return}}if(selectedItem instanceof GuildMessageInfo){switch(selectedItem.type){case 3:ViewManager.ins().open(GuildSkillWin,2);break;case 4:ViewManager.ins().open(MineRobWin,selectedItem);break}return}if(selectedItem.lv!=undefined){var data=selectedItem;var uid=data.id;var idx=Friends.ins().getFriendIndex(uid);if(idx>-1){ViewManager.ins().open(PlayerTipsWin,Friends.ins().friendsList.source[idx])}else{ViewManager.ins().open(PlayerTipsWin,data)}}}};ChatWin.prototype.onLink=function(str){var index=str.indexOf("|E:");str=str.slice(index+3,Number.MAX_VALUE);var list;if(str.indexOf(",")>=0)list=str.split(",");else if(str.indexOf("*")>=0)list=str.split("*");if(!list||list.length<=0)return;switch(list[0]){case"1":UserFb.ins().sendEnterTFRoom(+list[1]);break;case"2":KfArenaSys.ins().sendJoinTeam(+list[1]);break;case"3":BossHomeSys.ins().openBossHomeMainWin();break}};ChatWin.prototype.onTap=function(e){switch(e.currentTarget){case this.upBtn:this.setStretchWin();this.refushBar();break;case this.closeBg:case this.closeBtn0:ViewManager.ins().close(this);break;case this.sendBtn:if(this.chatInput.text=="@show recharge"){Recharge.ins().postChangeRecharge(true);return}if(this.chatInput.text=="@hide recharge"){Recharge.ins().postChangeRecharge(false);return}if(this.chatInput.text.indexOf("@maxchars")==0){this.chatInput.maxChars=100;return}if(this.chatInput.text.indexOf("@row")==0){var winName=this.chatInput.text.substr("@row".length);var winClass=window[winName];var openQQActWin=function(){ViewManager.ins().open(winClass);setTimeout(closeWin,500)};var closeWin=function(){ViewManager.ins().close(winClass);setTimeout(openQQActWin,500)};openQQActWin();return}if(this.chatInput.text=="@show small game activity"){ChannelNet.ins().showSmallGameActivity=true;ChannelNet.ins().postShowIcon();return}if(this.chatInput.text=="@show all shape"){if(ChannelMgr.ins().isDev()||ChannelMgr.ins().isQA){Setting.ins().setValue(ClientSet.showAllShape,1);UserTips.ins().showTips("show all shape successully");this.chatInput.text="";return}}if(this.chatInput.text=="@show all dress"){if(ChannelMgr.ins().isDev()||ChannelMgr.ins().isQA){UserTips.ins().showTips("show all dress successully");Setting.ins().setValue(ClientSet.showAllDress,1);this.chatInput.text="";return}}if(this.chatInput.text=="@showskill"){if(ChannelMgr.ins().isDev()){ViewManager.ins().open(SkillPreviewWin);return}}if(this.chatInput.text=="@hideskill"){if(ChannelMgr.ins().isDev()){ViewManager.ins().close(SkillPreviewWin);return}}if(this.chatInput.text=="#crash"){var s=null;s.ape();return}if(this.chatInput.text=="#profile"){ProfilingMgr.ins().enabled=true;ProfilingMgr.ins().tryStart();return}if(this.chatInput.text=="@autotest"){AutoTestMgr.ins().enabled=true;AutoTestMgr.ins().tryStart();return}if(this.chatInput.text=="@autotestdebug"){if(AutoTestMgr.ins().labelDebug){AutoTestMgr.ins().labelDebug.visible=true}return}if(this.chatInput.text.indexOf("@")>-1){GameLogic.ins().sendGMCommad(this.chatInput.text);return}if(this.cruIndex!=ChatWin.GUILD_CHANNEL&&!OpenSystem.ins().checkSysOpen(SystemType.CHAT)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.CHAT));return}if(!Chat.ins().canSpeak){UserTips.ins().showTips(i18n("ChatWin_9"));return}if(this.chatInput.text==i18n("ChatWin_10")){UserTips.ins().showTips(i18n("ChatWin_11"));return}Chat.ins().startInterval();if(this.cruIndex==ChatWin.GUILD_CHANNEL){Guild.ins().sendGuildMessage(this.chatInput.text);this.chatInput.text=""}else{if(this.chatInput.text.indexOf("@")>-1){GameLogic.ins().sendGMCommad(this.chatInput.text);if(this.chatInput.text=="@version"){WarnWin.show(Version.BUILD_NUMBER,null,this,null,null,"sure")}else if(this.chatInput.text=="@player"){PlayerAttrManager.ins().getAttr()}return}if(UserFb.ins().isInTeamScene()&&this.cruIndex==0&&Chat.ins().checkRepeatString(this.chatInput.text)){Chat.ins().sendChatInfo(Chat.CHANNEL_TYPE_TEAM,this.chatInput.text);Chat.ins().UpSpeak=this.chatInput.text;this.chatInput.text=""}if(!UserFb.ins().isInTeamScene()&&this.cruIndex==0&&Chat.ins().checkRepeatString(this.chatInput.text)||this.cruIndex==ChatWin.WORD_CHANNEL&&Chat.ins().checkRepeatString(this.chatInput.text)){Chat.ins().sendChatInfo(Chat.CHANNEL_TYPE_WORD,this.chatInput.text);Chat.ins().UpSpeak=this.chatInput.text;this.chatInput.text=""}if(this.cruIndex==ChatWin.KF_CHANNEL&&Chat.ins().checkRepeatString(this.chatInput.text)){if(UserZs.ins().lv>=5){Chat.ins().sendChatInfo(Chat.CHANNEL_TYPE_KF,this.chatInput.text);Chat.ins().UpSpeak=this.chatInput.text;this.chatInput.text=""}else{UserTips.ins().showTips(i18n("ChatWin_22"));this.chatInput.text=""}}}break;case this.sendBtn0:if(this.input.text.length==0||this.input.text==this.defaultText){UserTips.ins().showTips(i18n("ChatWin_12"));return}if(this.input.text.length>GlobalConfig.CustomServiceBaseConfig.wordlimit){UserTips.ins().showTips(i18n("ChatWin_15"));return}if(this.input.text.indexOf("$")>-1){var rmb=parseInt(this.input.text.slice(1));return}this.sendServiceMessage(this.input.text);ReportData.getIns().advice(this.input.text,this.callBack,this);break;case this.typelistBtn:this.onSelectTypeListBtn();break;case this.expressionBtn:this.onBtnExpression();break;case this.expressionClose:this.expressionGroup.visible=false;break}};ChatWin.prototype.onBtnExpression=function(){if(this.expressionGroup.visible){this.expressionGroup.visible=false;this.expressionClose.visible=false}else{this.expressionGroup.visible=true;this.expressionClose.visible=true}};ChatWin.prototype.onSelectTypeListBtn=function(){if(!this.isShowList){this.scroller.visible=true;this.isShowList=true}else{this.scroller.visible=false;this.isShowList=false}};ChatWin.prototype.initServiceUI=function(){var arr=[];var config=GlobalConfig.CustomServiceProblemConfig;for(var i in config){if(config[i].problem)arr.push(config[i].problem)}this.typelist.itemRenderer=ListitemRender;this.typelist.dataProvider=new eui.ArrayCollection(arr);this.scroller.visible=false;this.typelist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTypeListTap,this);this.typelist.selectedIndex=0};ChatWin.prototype.onTypeListTap=function(e){var data=e.item;this.typelistBtn.label=data;this.scroller.visible=false;this.isShowList=false};ChatWin.prototype.sendServiceMessage=function(inputMsg){if(Chat.ins().feedbackSuccess!=1){var config=GlobalConfig.CustomServiceProblemConfig;var problemType=-1;for(var i in config){if(this.typelistBtn.label==config[i].problem){problemType=config[i].id;break}}if(problemType>=0)Chat.ins().sendFeedback(problemType,inputMsg);else UserTips.ins().showTips(i18n("ChatWin_16"))}else{var warnWin=WarnWin.show(i18n("ChatWin_18"),null,null,null,null,"sure");warnWin.setBtnLabel(i18n("ChatWin_17"))}};ChatWin.prototype.initExpressionUI=function(){this.expressionGroup.visible=false;this.expressionClose.visible=false;this.expressionBtn.visible=true;this.expressionScroller0.visible=true;this.expressionScroller1.visible=false;this.expressionScroller2.visible=false;this.expressionlist0.itemRenderer=ChatEsionItemRenderer1;this.expressionlist1.itemRenderer=ChatEsionItemRenderer2;this.expressionlist2.itemRenderer=ChatEsionItemRenderer2;this.initEsionData();this.addTouchEvent(this.expressionBtn,this.onTap);this.addTouchEvent(this.expressionClose,this.onTap);this.addTouchEvent(this.esionBtn0,this.onEsionBtn);this.addTouchEvent(this.esionBtn1,this.onEsionBtn);this.addTouchEvent(this.esionBtn2,this.onEsionBtn)};ChatWin.prototype.initEsionData=function(){var datalist=[];var datalist1=[];var datalist2=[];var boy_startNum=10;var boy_endNum=20;for(var i=0;i<Object.keys(GlobalConfig.SmallExpressionConf).length;i++){var config=GlobalConfig.SmallExpressionConf[i+1];datalist.push(config.expressionStr)}for(var i=0;i<boy_startNum;i++){var config=GlobalConfig.BigExpressionConf[i+1];datalist1.push(config.expressionStr)}for(var i=boy_startNum;i<boy_endNum;i++){var config=GlobalConfig.BigExpressionConf[i+1];datalist2.push(config.expressionStr)}this.expressionlist0.dataProvider=new eui.ArrayCollection(datalist);this.expressionlist1.dataProvider=new eui.ArrayCollection(datalist1);this.expressionlist2.dataProvider=new eui.ArrayCollection(datalist2);this.addTouchEvent(this.expressionlist0,this.onEsionBtn);this.addTouchEvent(this.expressionlist1,this.onEsionBtn);this.addTouchEvent(this.expressionlist2,this.onEsionBtn)};ChatWin.prototype.onEsionBtn=function(e){switch(e.currentTarget){case this.esionBtn0:this.expressionScroller0.visible=true;this.expressionScroller1.visible=false;this.expressionScroller2.visible=false;break;case this.esionBtn1:this.expressionScroller0.visible=false;this.expressionScroller1.visible=true;this.expressionScroller2.visible=false;break;case this.esionBtn2:this.expressionScroller0.visible=false;this.expressionScroller1.visible=false;this.expressionScroller2.visible=true;break;case this.expressionlist0:if(this.expressionlist0.selectedItem){this.textInOn();this.chatInput.text=this.chatInput.text+this.expressionlist0.selectedItem}break;case this.expressionlist1:if(this.expressionlist1.selectedItem){if(this.cruIndex==ChatWin.GUILD_CHANNEL){Guild.ins().sendGuildMessage(this.expressionlist1.selectedItem)}else if(this.cruIndex==0&&!UserFb.ins().isInTeamScene()||this.cruIndex==ChatWin.WORD_CHANNEL){Chat.ins().sendChatInfo(Chat.CHANNEL_TYPE_WORD,this.expressionlist1.selectedItem)}else if(this.cruIndex==ChatWin.KF_CHANNEL){Chat.ins().sendChatInfo(Chat.CHANNEL_TYPE_KF,this.expressionlist1.selectedItem)}else if(this.cruIndex==0&&UserFb.ins().isInTeamScene()){Chat.ins().sendChatInfo(Chat.CHANNEL_TYPE_TEAM,this.expressionlist1.selectedItem)}}break;case this.expressionlist2:if(this.expressionlist2.selectedItem){if(this.cruIndex==ChatWin.GUILD_CHANNEL){Guild.ins().sendGuildMessage(this.expressionlist2.selectedItem)}else if(this.cruIndex==0&&!UserFb.ins().isInTeamScene()||this.cruIndex==ChatWin.WORD_CHANNEL){Chat.ins().sendChatInfo(Chat.CHANNEL_TYPE_WORD,this.expressionlist2.selectedItem)}else if(this.cruIndex==ChatWin.KF_CHANNEL){Chat.ins().sendChatInfo(Chat.CHANNEL_TYPE_KF,this.expressionlist2.selectedItem)}else if(this.cruIndex==0&&UserFb.ins().isInTeamScene()){Chat.ins().sendChatInfo(Chat.CHANNEL_TYPE_WORD,this.expressionlist2.selectedItem)}}break}};ChatWin.BIG_HEIGHT=850;ChatWin.LITTLE_HEIGHT=370;ChatWin.WORD_CHANNEL=1;ChatWin.KF_CHANNEL=2;ChatWin.GUILD_CHANNEL=3;return ChatWin}(BaseEuiView);__reflect(ChatWin.prototype,"ChatWin");ViewManager.ins().reg(ChatWin,LayerManager.UI_Popup);var Expression=function(_super){__extends(Expression,_super);function Expression(){return _super.call(this)||this}Expression.prototype.setSmallExpressionText=function(chatbg,EsiontextGroup,textLabel,strDesc,oldlineWidth,oldlineHeight){if(oldlineWidth===void 0){oldlineWidth=-1}if(oldlineHeight===void 0){oldlineHeight=-1}var str=strDesc;var str2=textLabel.text;var strlist=[];if(textLabel.text.indexOf("#a")!=-1){var Esionstr=this.getSmallExpressionStr(textLabel.text);while(Esionstr!=""){var idx=textLabel.text.indexOf(Esionstr);while(idx!=-1){var Imgsource=this.getExpressionSource(Esionstr);var expressionImage=DisplayUtils.createEuiImage(Imgsource);expressionImage.scaleX=expressionImage.scaleY=.9;if(textLabel.size>=20)str=str.replace(Esionstr,"      ");else str=str.replace(Esionstr,"         ");textLabel.textFlow=TextFlowMaker.generateTextFlow(str);var offsetx=0;var offsety=0;var x=0;var y=0;if(oldlineWidth!=-1&&oldlineHeight!=-1){offsetx=StringUtils.getTextWidth(textLabel.text.substring(0,idx),textLabel.size,textLabel.fontFamily)-textLabel.textWidth;offsety=textLabel.textHeight-oldlineHeight+5;x=textLabel.x+offsetx;if(chatbg)chatbg.height=55}else{x=textLabel.x+StringUtils.getTextWidth(textLabel.text.substring(0,idx),textLabel.size,textLabel.fontFamily)-offsetx;if(chatbg)chatbg.height=45}y=textLabel.y-5+offsety;expressionImage.x=x;expressionImage.y=y;EsiontextGroup.addChild(expressionImage);idx=textLabel.text.indexOf(Esionstr,idx+1)}Esionstr=this.getSmallExpressionStr(textLabel.text)}this.validateNow()}};Expression.prototype.create=function(width,height){if(width===void 0){width=60}if(height===void 0){height=40}var bg=DisplayUtils.createEuiImage("zjmbaoxiang");bg.width=width;bg.height=width;bg.alpha=.6;return bg};Expression.prototype.setBigExpression=function(Group,textLabel){if(textLabel.text.indexOf("#b")!=-1){var BigEsionImgsource=this.getBigExpressionSource(textLabel.text);var mc=new MovieClip;mc.playFile(RES_DIR_EXPRESSION+BigEsionImgsource,-1);mc.scaleX=mc.scaleY=.4;textLabel.text="";mc.x=textLabel.x+40;mc.y=textLabel.y+33;this.validateNow();Group.addChild(mc);return true}else{return false}};Expression.prototype.setBigExpression2=function(Group,textLabel){if(textLabel.text.indexOf("#b")!=-1){var BigEsionImgsource=this.getBigExpressionSource(textLabel.text);var mc=new MovieClip;mc.playFile(RES_DIR_EXPRESSION+BigEsionImgsource,-1);mc.scaleX=mc.scaleY=.4;textLabel.text=textLabel.text.slice(0,textLabel.text.indexOf("#b"));mc.x=textLabel.x+textLabel.textWidth+60;mc.y=textLabel.y;this.validateNow();Group.addChild(mc);return true}else{return false}};Expression.prototype.isHasSmallExpression=function(){return this.ishasSmallExpression};Expression.prototype.replaceByExpressionMark=function(desc){if(desc.indexOf("#a")!=-1){var Esionstr=this.getSmallExpressionStr2(desc);var idx=desc.indexOf(Esionstr[0]);while(idx!=-1){desc=desc.replace(Esionstr[0],Esionstr[1]);idx=desc.indexOf(Esionstr[0],idx+1)}}else if(desc.indexOf("#b")!=-1){var Esionstr2=this.getBigExpressionStr2(desc);var idx=desc.indexOf(Esionstr2[0]);while(idx!=-1){desc=desc.replace(Esionstr2[0],Esionstr2[1]);idx=desc.indexOf(Esionstr2[0],idx+1)}}return desc};Expression.prototype.getSmallExpressionStr=function(text){for(var i=0;i<Object.keys(GlobalConfig.SmallExpressionConf).length;i++){var item=GlobalConfig.SmallExpressionConf[i+1];var idx=text.indexOf(item.expressionStr);if(idx!=-1)return item.expressionStr}return""};Expression.prototype.getSmallExpressionStr2=function(text){for(var i=0;i<Object.keys(GlobalConfig.SmallExpressionConf).length;i++){var item=GlobalConfig.SmallExpressionConf[i+1];var idx=text.indexOf(item.expressionStr);if(idx!=-1)return[item.expressionStr,item.expressionMark]}return[]};Expression.prototype.getExpressionSource=function(expressionStr){for(var i=0;i<Object.keys(GlobalConfig.SmallExpressionConf).length;i++){var item=GlobalConfig.SmallExpressionConf[i+1];if(item.expressionStr==expressionStr)return item.source}return""};Expression.prototype.getBigExpressionSource=function(text){for(var i=0;i<Object.keys(GlobalConfig.BigExpressionConf).length;i++){var item=GlobalConfig.BigExpressionConf[i+1];var idx=text.indexOf(item.expressionStr);if(idx!=-1)return item.source}return""};Expression.prototype.getBigExpressionStr2=function(text){for(var i=0;i<Object.keys(GlobalConfig.BigExpressionConf).length;i++){var item=GlobalConfig.BigExpressionConf[i+1];var idx=text.indexOf(item.expressionStr);if(idx!=-1)return[item.expressionStr,item.expressionMark]}return[]};return Expression}(BaseItemRender);__reflect(Expression.prototype,"Expression");var FlyingWorldView=function(_super){__extends(FlyingWorldView,_super);function FlyingWorldView(){var _this=_super.call(this)||this;_this.startX=0;_this.endX=0;_this.nowshowNum=0;_this.MAX_SHOW_CENTER_NUM=5;_this.MAX_SHOW_DOWN_NUM=4;_this.CENTER_Y_LIST=[0,70,170,260,350,440];_this.DOWN_Y_LIST=[0,500,590,680,770];_this.nowshowYlist=[];_this.nowshowY=0;_this.labPool=[];_this.delayList=[];_this.groupPool=[];_this.Expression=new Expression;return _this}FlyingWorldView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.touchChildren=false;this.touchEnabled=false;this.startX=StageUtils.ins().getWidth()/2+240;this.endX=StageUtils.ins().getWidth()/2-320};FlyingWorldView.prototype.showNotice=function(str){var lab;var showGroup;if(this.labPool.length>0)lab=this.labPool.shift();else lab=new eui.Label;if(this.groupPool.length>0)showGroup=this.groupPool.shift();else showGroup=new eui.Group;lab.size=22;lab.textColor=1301748;lab.stroke=1;lab.strokeColor=9605264;lab.touchEnabled=false;showGroup.x=this.startX;lab.x=0;lab.textFlow=TextFlowMaker.generateTextFlow(str);showGroup.height=35;showGroup.removeChildren();showGroup.addChild(lab);this.Expression.setSmallExpressionText(null,showGroup,lab,str,-1,-1);this.Expression.setBigExpression2(showGroup,lab);this.addChild(showGroup);showGroup.visible=false;this.nowshowNum++;if(this.nowshowNum<=this.MAX_SHOW_CENTER_NUM){if(this.CENTER_Y_LIST[this.nowshowNum])showGroup.y=this.CENTER_Y_LIST[this.nowshowNum];else showGroup.y=this.CENTER_Y_LIST[1];this.tweenLab(showGroup,lab)}if(this.nowshowNum>this.MAX_SHOW_CENTER_NUM&&this.nowshowNum<=this.MAX_SHOW_CENTER_NUM+this.MAX_SHOW_DOWN_NUM){if(this.DOWN_Y_LIST[this.nowshowNum-this.MAX_SHOW_CENTER_NUM])showGroup.y=this.DOWN_Y_LIST[this.nowshowNum-this.MAX_SHOW_CENTER_NUM];else showGroup.y=this.DOWN_Y_LIST[1];this.tweenLab(showGroup,lab)}if(this.nowshowNum>this.MAX_SHOW_CENTER_NUM+this.MAX_SHOW_DOWN_NUM){var key=this.nowshowNum%this.MAX_SHOW_DOWN_NUM;if(this.DOWN_Y_LIST[key+1])showGroup.y=this.DOWN_Y_LIST[key+1];else showGroup.y=this.DOWN_Y_LIST[1];this.delayList.push(showGroup);if(!TimerManager.ins().isExists(this.delayfunc,this))TimerManager.ins().doTimer(5e3,0,this.delayfunc,this)}if(this.delayList.length<=0)TimerManager.ins().remove(this.delayfunc,this)};FlyingWorldView.prototype.delayfunc=function(){var self=this;var delaygroup;if(self.delayList.length>0&&(SysSetting.ins().getBool(SysSetting.SHOW_DANMU)||SysSetting.ins().getBool(SysSetting.SHOW_DANMU_TEAM))){for(var i=0;i<this.MAX_SHOW_DOWN_NUM;i++){delaygroup=self.delayList.shift();if(delaygroup)self.tweenLab(delaygroup)}}else{TimerManager.ins().remove(this.delayfunc,this);this.nowshowNum=0}};FlyingWorldView.prototype.tweenLab=function(group,lab){var _this=this;var tweenX=this.endX-group.width;var t=egret.Tween.get(group);group.visible=true;if(lab)lab.visible=true;t.to({x:tweenX},5e3).call(function(){if(lab)_this.labPool.push(lab);_this.groupPool.push(group);group.removeChildren();_this.removeChild(group);_this.nowshowNum--},this)};return FlyingWorldView}(BaseEuiView);__reflect(FlyingWorldView.prototype,"FlyingWorldView");ViewManager.ins().reg(FlyingWorldView,LayerManager.UI_Tips);var ListitemRender=function(_super){__extends(ListitemRender,_super);function ListitemRender(){var _this=_super.call(this)||this;_this.skinName="ServicetypelistSkin";return _this}ListitemRender.prototype.dataChanged=function(){var info=this.data;if(info){this.typeLab.text=info}};ListitemRender.prototype.onClick=function(){};return ListitemRender}(BaseItemRender);__reflect(ListitemRender.prototype,"ListitemRender");var TextImage=function(_super){__extends(TextImage,_super);function TextImage(_TextImageData){if(_TextImageData===void 0){_TextImageData=[]}var _this=_super.call(this)||this;_this._TextImageData=_TextImageData;_this._size=16;_this._verticalAlign=egret.VerticalAlign.MIDDLE;_this._lineSpacing=0;_this.lineHeightArray=[];_this.components=[];_this._textColor=16777215;_this.invalidate_Flag=false;_this.init();return _this}Object.defineProperty(TextImage.prototype,"TextImageData",{get:function(){return this._TextImageData},set:function(val){this._TextImageData=val;this.init()},enumerable:true,configurable:true});Object.defineProperty(TextImage.prototype,"size",{get:function(){return this._size},set:function(val){this._size=val},enumerable:true,configurable:true});Object.defineProperty(TextImage.prototype,"width",{get:function(){return this._width},set:function(val){this._width=val;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(TextImage.prototype,"verticalAlign",{get:function(){return this._verticalAlign},set:function(val){this._verticalAlign=val;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(TextImage.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(val){this._maxWidth=val;if(this.templet.width>val){this.width=val;this.invalidate()}},enumerable:true,configurable:true});Object.defineProperty(TextImage.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(val){if(this._lineSpacing===val)return;this._lineSpacing=val;this.invalidate()},enumerable:true,configurable:true});TextImage.prototype.validateNow=function(){this.init();this.invalidate_Flag=false};TextImage.prototype.init=function(){var _this=this;this.removeChildren();if(this._TextImageData.length==0){this.width=this.height=0;return}this.components=[];this._TextImageData.forEach(function(component){if(typeof component=="object"){_this.components.push(component);if(!component["watch"]){egret.is(component,"eui.Image")&&component.once(egret.Event.COMPLETE,_this.invalidate,_this);eui.Watcher.watch(component,["width"],_this.invalidate,_this);eui.Watcher.watch(component,["height"],_this.invalidate,_this);component["watch"]=true}}});var textFlow=this._TextImageData.map(function(text){return typeof text==="string"||egret.is(text,"eui.Label")?{text:egret.is(text,"eui.Label")?text.text:text}:{text:"樂",style:{size:text.width}}});var TextField=this.templet=new egret.TextField;TextField.size=this.size;TextField.lineSpacing=0;TextField.width=this.width;TextField.textFlow=textFlow;TextField.height=TextField.height;this.height=0;this.lineHeightArray=[];var componentTestIndex=0;var componentIndex=0;TextField["linesArr"].forEach(function(item,lines){console.log("item=>",item);var maxheight=_this.size;item.elements.forEach(function(element){if(element.text=="樂"){var c=_this.components[componentTestIndex++];maxheight=Math.max(maxheight,c.height)}});maxheight=_this._lineSpacing+maxheight;_this.lineHeightArray.push(maxheight);var x=0;item.elements.forEach(function(element){var component;if(element.text!=="樂"){component=new egret.TextField;component.x=x;component.size=_this.size;component.text=element.text;component.width=element.width;component.textColor=_this._textColor;component.height=maxheight;component.y=_this.height;component.verticalAlign=_this._verticalAlign}else{component=_this.components[componentIndex++];component.x=x;component.y=_this.height+(maxheight-component.height)/2}x+=component.width;_this.addChild(component)});_this.height+=maxheight});this._width=this.templet.width};Object.defineProperty(TextImage.prototype,"textColor",{get:function(){return this._textColor},set:function(val){this._textColor=val;this.invalidate()},enumerable:true,configurable:true});TextImage.prototype.invalidate=function(e){var _this=this;if(this.invalidate_Flag){return}this.invalidate_Flag=true;this.once(egret.Event.ENTER_FRAME,function(){_this.init();_this.invalidate_Flag=false},this)};return TextImage}(eui.Group);__reflect(TextImage.prototype,"TextImage");var Encrypt=function(){function Encrypt(){}Encrypt.encode=function(inBuff,offset,length){if(offset===void 0){offset=0}if(length===void 0){length=0}if(offset>=inBuff.length)return 0;var end=length?offset+length:inBuff.length;if(end>inBuff.length)end=inBuff.length;inBuff.position=offset;for(var i=offset;i<end;++i){var byte=inBuff.readByte();byte^=Encrypt.sKeyBuff[i%4];inBuff.position--;inBuff.writeByte(byte)}return end-offset};Encrypt.decode=function(inBuff,offset,length){if(offset===void 0){offset=0}if(length===void 0){length=0}return Encrypt.encode(inBuff,offset,length)};Encrypt.getCRC16=function(bytes,length){if(length===void 0){length=0}return CRC16.update(bytes,0,length)};Encrypt.getCRC16ByPos=function(bytes,offset,length){if(offset===void 0){offset=0}if(length===void 0){length=0}return CRC16.update(bytes,offset,length)};Encrypt.getCheckKey=function(){var bytes=new egret.ByteArray;bytes.endian=egret.Endian.LITTLE_ENDIAN;bytes.writeUnsignedInt(Encrypt.sKey);var ck=CRC16.update(bytes);return ck};Encrypt.getSelfSalt=function(){return Encrypt.sSelfSalt};Encrypt.getTargetSalt=function(){return Encrypt.sTargetSalt};Encrypt.setTargetSalt=function(value){Encrypt.sTargetSalt=value;Encrypt.makeKey()};Encrypt.makeSalt=function(){var d=new Date;return Math.random()*d.getTime()};Encrypt.makeKey=function(){Encrypt.sKey=(Encrypt.sSelfSalt^Encrypt.sTargetSalt)+8254;for(var i=0;i<4;++i){Encrypt.sKeyBuff[i]=(Encrypt.sKey&255<<(i<<3))>>(i<<3)}};Encrypt.sSelfSalt=Encrypt.makeSalt();Encrypt.sKeyBuff=new Array(4);return Encrypt}();__reflect(Encrypt.prototype,"Encrypt");var ChatInfoData=function(_super){__extends(ChatInfoData,_super);function ChatInfoData(bytes){if(bytes===void 0){bytes=null}var _this=_super.call(this)||this;_this.type=0;_this.id=0;_this.servId=0;_this.name="";_this.job=0;_this.sex=0;_this.vip=0;_this.monthCard=0;_this.ladderLevel=0;_this.pointId=0;_this.str="";_this.isFirst=0;_this.zsLevel=0;_this.lv=0;_this.guild="";_this.titleId=0;_this.qzviplv=0;_this.isYearVip=0;_this.datviplv=0;_this.isdatHighVip=0;_this.isdatYearVip=0;if(bytes){_this.type=bytes.readByte();_this.id=bytes.readUnsignedInt();_this.servId=bytes.readInt();_this.name=bytes.readString();_this.job=bytes.readByte();_this.sex=bytes.readByte();_this.vip=bytes.readByte();_this.monthCard=bytes.readByte();_this.ladderLevel=bytes.readByte();_this.isFirst=bytes.readByte();_this.zsLevel=bytes.readUnsignedByte();_this.lv=bytes.readShort();_this.guild=bytes.readString();_this.pointId=bytes.readUnsignedInt();_this.str=bytes.readString();_this.chatdate=bytes.readInt();_this.dealChannelDate()}return _this}ChatInfoData.prototype.dealChannelDate=function(){if(ChannelMgr.ins().isQQZoneChannel()){var str=this.str.split(QzoneSys.MARK_QZVIP);this.str=str[0];var Qzmarkstr=str[1];if(Qzmarkstr){var lvstr=Qzmarkstr.split(QzoneSys.MARK_QZYEAR);if(lvstr){var qzviplvstr=lvstr[0];var qzisyearstr=lvstr[1];this.qzviplv=Number(qzviplvstr);this.isYearVip=Number(qzisyearstr)}}}if(ChannelMgr.ins().isQQDaTingChannel()){var str=this.str.split(QQDaTingSys.MARK_DATVIP);this.str=str[0];var Qzmarkstr=str[1];if(Qzmarkstr){var lvstr=Qzmarkstr.split(QQDaTingSys.MARK_DATHIGHVIP);if(lvstr){var datviplvstr=lvstr[0];var datHYMark=lvstr[1];var datHYstr=datHYMark.split(QQDaTingSys.MARK_DATYEAR);var datishighstr=datHYstr[0];var datisyearstr=datHYstr[1];this.datviplv=Number(datviplvstr);this.isdatHighVip=Number(datishighstr);this.isdatYearVip=Number(datisyearstr)}}}};return ChatInfoData}(ChatDataBase);__reflect(ChatInfoData.prototype,"ChatInfoData");var ChatSystemData=function(_super){__extends(ChatSystemData,_super);function ChatSystemData(type,str){var _this=_super.call(this)||this;_this.type=type;_this.str=str;return _this}return ChatSystemData}(ChatDataBase);__reflect(ChatSystemData.prototype,"ChatSystemData");var ChatEsionItemRenderer1=function(_super){__extends(ChatEsionItemRenderer1,_super);function ChatEsionItemRenderer1(){var _this=_super.call(this)||this;_this.touchEnabled=true;return _this}ChatEsionItemRenderer1.prototype.dataChanged=function(){var _data=this.data;if(this.data){var imgName=this.getExpressionSource(_data);this.img.source=""+imgName}};ChatEsionItemRenderer1.prototype.getExpressionSource=function(expressionStr){for(var i=0;i<Object.keys(GlobalConfig.SmallExpressionConf).length;i++){var item=GlobalConfig.SmallExpressionConf[i+1];if(item.expressionStr==expressionStr)return item.source}return""};return ChatEsionItemRenderer1}(BaseItemRender);__reflect(ChatEsionItemRenderer1.prototype,"ChatEsionItemRenderer1");var ChatEsionItemRenderer2=function(_super){__extends(ChatEsionItemRenderer2,_super);function ChatEsionItemRenderer2(){var _this=_super.call(this)||this;_this.touchEnabled=true;return _this}ChatEsionItemRenderer2.prototype.dataChanged=function(){var _data=this.data;if(this.data){var imgName=this.getExpressionSource(_data);this.group.removeChildren();var mc=new MovieClip;mc.playFile(RES_DIR_EXPRESSION+imgName,-1);mc.scaleX=mc.scaleY=.4;mc.x=50;mc.y=50;this.group.addChild(mc);this.validateNow()}};ChatEsionItemRenderer2.prototype.getExpressionSource=function(expressionStr){for(var i=0;i<Object.keys(GlobalConfig.BigExpressionConf).length;i++){var item=GlobalConfig.BigExpressionConf[i+1];if(item.expressionStr==expressionStr)return item.source}return""};return ChatEsionItemRenderer2}(BaseItemRender);__reflect(ChatEsionItemRenderer2.prototype,"ChatEsionItemRenderer2");var ChatGuildItemRender=function(_super){__extends(ChatGuildItemRender,_super);function ChatGuildItemRender(){var _this=_super.call(this)||this;_this.Expression=new Expression;return _this}ChatGuildItemRender.prototype.dataChanged=function(){if(this.data instanceof GuildMessageInfo){var _data=this.data;if(_data.type!=1)this.currentState="system";else if(_data.roleId==Actor.actorID)this.currentState="playernomal";else this.currentState="playernomal";var info=this.data;this.validateNow();if(info.type==1||info.type==3){var oldLineWidth=-1;var oldLineHeight=-1;var strDesc=i18n("ChatGuildItemRender_3")+info.content+"|";this.showText.textFlow=TextFlowMaker.generateTextFlow(strDesc);this.EsionGroup.removeChildren();var isShowBigEsion=this.Expression.setBigExpression(this.EsionGroup,this.showText);if(isShowBigEsion){this.currentState="playerbig"}this.validateNow();if(this.showChannel)this.showChannel.visible=info.office>=0?true:false;if(info.office>=0){var channel=i18n("ChatGuildItemRender_1")+GuildLanguage.guildOfficeColor[info.office]+"&T:["+GuildLanguage.guildOffice[info.office]+"]|";this.showChannel.textFlow=TextFlowMaker.generateTextFlow(channel)}else{this.showChannel.text=""}if(this.chatVip)this.chatVip.visible=info.vipLevel>0?true:false;var vipImgWidth=0;if(info.vipLevel>0){if(info.type==3){this.chatVip.x=this.showChannel.width;this.chatVip.y=this.showChannel.y}else{this.chatVip.x=102;this.chatVip.y=0}vipImgWidth=this.chatVip.width}if(this.showHead)this.showHead.visible=info.name?true:false;if(this.playerhead){if(_data.job>=0&&_data.sex>=0){this.playerhead.source="yuanhead"+_data.job+_data.sex}}if(info.name){var head=i18n("ChatGuildItemRender_2")+info.name+"]|";this.showHead.textFlow=TextFlowMaker.generateTextFlow(head);if(info.office<0){this.showHead.x=vipImgWidth;this.showHead.y=0}else{this.showHead.x=this.showChannel.x+this.showChannel.width+vipImgWidth;this.showHead.y+this.showChannel.y}}this.showQzVip();this.showDatVip();if(!isShowBigEsion){this.showText.x=80;this.chatbg.height=38;this.validateNow();var strWidth=StringUtils.getTextWidth(this.showText.text,this.showText.size,this.showText.fontFamily);if(info.type==3&&this.showChannel&&this.showChannel.width+this.showHead.width+vipImgWidth+this.showText.width>=this.textGroup.width){var space=i18n("ChatGuildItemRender_4");this.showText.text="";for(var i=1;i<=200;i++){space+=" ";if(i*4.5>this.showChannel.width+this.showHead.width+vipImgWidth)break}this.showText.x=10;space+=info.content+"|";this.showText.textFlow=TextFlowMaker.generateTextFlow(space);this.showText.width=this.textGroup.width;this.showText.height=this.textGroup.height}else if(strWidth>=this.textGroup.width+this.showText.x){this.showText.x=80;oldLineWidth=this.showText.textWidth;oldLineHeight=16;this.showText.width=this.textGroup.width;this.showText.height=this.textGroup.height;if(this.chatbg)this.chatbg.height=55}this.Expression.setSmallExpressionText(this.chatbg,this.EsionGroup,this.showText,strDesc,oldLineWidth,oldLineHeight);if(info.type==1)this.showText.y=28;else this.showText.y=this.showHead?this.showHead.y:0;if(this.chatbg){this.validateNow();this.chatbg.width=this.showText.textWidth+30}}}else{var str=i18n("ChatGuildItemRender_5")+info.content+"|";this.showText.textFlow=TextFlowMaker.generateTextFlow(str);this.showText.x=0;this.showText.y=0;if(this.showChannel)this.showChannel.visible=false;if(this.chatVip)this.chatVip.visible=false;if(this.showHead)this.showHead.visible=false;var strWidth=StringUtils.getTextWidth(this.showText.text,this.showText.size,this.showText.fontFamily);if(strWidth>=this.textGroup.width+this.showText.x&&DeviceUtils.IsMobile){this.showText.x=0;if(DeviceUtils.IsMobile){this.showText.width=540}this.showText.height=this.textGroup.height;if(this.chatbg)this.chatbg.height=55}}}};ChatGuildItemRender.prototype.showQzVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQZoneChannel()){var qzviplv=this.data.qzviplv;var isqzyearVip=this.data.isYearVip;if(qzviplv>=1&&isqzyearVip<1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_"+qzviplv}else if(qzviplv>=1&&isqzyearVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_year_"+qzviplv}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onqzvipBtn,this)}}};ChatGuildItemRender.prototype.showDatVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQDaTingChannel()){var datviplv=this.data.datviplv;var isdathighVip=this.data.isdatHighVip;var isdatyearVip=this.data.isdatYearVip;if(datviplv>=1&&isdathighVip<1){this.qzVip.visible=true;this.qzVip.source="dat_vip_icon_"+datviplv}else if(datviplv>=1&&isdathighVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_high_"+datviplv}if(isdatyearVip>=1){this.datYearVip.visible=true}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ondatvipBtn,this)}}};ChatGuildItemRender.prototype.onqzvipBtn=function(){ViewManager.ins().open(QzVipWin)};ChatGuildItemRender.prototype.ondatvipBtn=function(){ViewManager.ins().open(DaTVipWin)};return ChatGuildItemRender}(BaseItemRender);__reflect(ChatGuildItemRender.prototype,"ChatGuildItemRender");var ChatListItemRenderer=function(_super){__extends(ChatListItemRenderer,_super);function ChatListItemRenderer(){var _this=_super.call(this)||this;_this.Expression=new Expression;return _this}ChatListItemRenderer.prototype.dataChanged=function(){var _data=null;if(this.type)this.type.visible=false;if(this.data.type==Chat.CHANNEL_TYPE_WORD){_data=this.data}else if(this.data.type==3){_data=this.data}else{_data=this.data}if(_data.id==Actor.actorID)this.currentState="playernomal";else if(this.data.type==3)this.currentState="system";else this.currentState="playernomal";var servStr=KFServerSys.ins().isKF?"S"+_data.servId:"";this.validateNow();var desc="";var vip=0;var head;var strDesc;var oldLineWidth=-1;var oldLineHeight=-1;if(_data.type==0||_data.type==1||_data.type==2){return}else if(_data.type==3){desc=_data.str;vip=0;head=i18n("ChatListItemRenderer_0");strDesc=desc}else{desc=_data.str;vip=_data.vip;head=i18n("ChatListItemRenderer_1",_data.name,servStr);strDesc=i18n("ChatListItemRenderer_2")+desc+"|"}if(this.playerhead){if(_data.job>=0&&_data.sex>=0){this.playerhead.source="yuanhead"+_data.job+_data.sex}}this.showText.textFlow=TextFlowMaker.generateTextFlow1(strDesc);this.EsionGroup.removeChildren();var isShowBigEsion=this.Expression.setBigExpression(this.EsionGroup,this.showText);if(isShowBigEsion){this.currentState="playerbig"}this.validateNow();this.showHead.textFlow=TextFlowMaker.generateTextFlow(head);this.chatVip.visible=vip>0?true:false;var vipImgWidth=0;if(vip>0){vipImgWidth=this.chatVip.width;this.chatVip.x=62;this.chatVip.y=0;this.showHead.x=this.chatVip.x+vipImgWidth;this.showHead.y+this.chatVip.y}else{this.showHead.x=92;this.showHead.y=0}this.showQzVip();this.showDatVip();if(!isShowBigEsion){var strWidth=StringUtils.getTextWidth(this.showText.text,this.showText.size,this.showText.fontFamily);this.showText.x=80;this.chatbg.height=38;if(_data.type==3&&this.showHead.width+vipImgWidth+this.showText.width>=this.textGroup.width){var space=i18n("ChatListItemRenderer_3");this.showText.text="";for(var i=1;i<=200;i++){space+=" ";if(i*4.5>this.showHead.width+vipImgWidth)break}space+=desc+"|";this.showText.textFlow=TextFlowMaker.generateTextFlow(space);this.showText.x=10;this.showText.width=this.textGroup.width;this.showText.height=this.textGroup.height}else if(strWidth>=this.textGroup.width+this.showText.x){this.showText.x=80;oldLineWidth=this.showText.textWidth;oldLineHeight=16;this.showText.width=this.textGroup.width;this.showText.height=this.textGroup.height;if(this.chatbg)this.chatbg.height=55}this.validateNow();this.Expression.setSmallExpressionText(this.chatbg,this.EsionGroup,this.showText,strDesc,oldLineWidth,oldLineHeight);this.showText.y=28;if(this.chatbg){this.validateNow();this.chatbg.width=this.showText.textWidth+30}}};ChatListItemRenderer.prototype.showQzVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQZoneChannel()){var qzviplv=this.data.qzviplv;var isqzyearVip=this.data.isYearVip;if(qzviplv>=1&&isqzyearVip<1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_"+qzviplv}else if(qzviplv>=1&&isqzyearVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_year_"+qzviplv}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onqzvipBtn,this)}}};ChatListItemRenderer.prototype.showDatVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQDaTingChannel()){var datviplv=this.data.datviplv;var isdathighVip=this.data.isdatHighVip;var isdatyearVip=this.data.isdatYearVip;if(datviplv>=1&&isdathighVip<1){this.qzVip.visible=true;this.qzVip.source="dat_vip_icon_"+datviplv}else if(datviplv>=1&&isdathighVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_high_"+datviplv}if(isdatyearVip>=1){this.datYearVip.visible=true}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;this.datYearVip.x=this.qzVip.x+24;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ondatvipBtn,this)}}};ChatListItemRenderer.prototype.onqzvipBtn=function(){ViewManager.ins().open(QzVipWin)};ChatListItemRenderer.prototype.ondatvipBtn=function(){ViewManager.ins().open(DaTVipWin)};ChatListItemRenderer.HEAD_BG=["touxiangkuang0","touxiangkuang1"];return ChatListItemRenderer}(BaseItemRender);__reflect(ChatListItemRenderer.prototype,"ChatListItemRenderer");var ChatListItemRenderer2=function(_super){__extends(ChatListItemRenderer2,_super);function ChatListItemRenderer2(){var _this=_super.call(this)||this;_this.Expression=new Expression;return _this}ChatListItemRenderer2.prototype.dataChanged=function(){var _data=this.data;var maxWidth=0;if(this.$parent){maxWidth=this.$parent.$explicitWidth}var channel="";var desc="";var vip=0;if(_data instanceof GuildMessageInfo){channel=i18n("ChatListItemRenderer2_0");desc=_data.content;vip=_data.vipLevel}else if(_data instanceof ChatSystemData){channel=i18n("ChatListItemRenderer2_1");desc=_data.str}else{if(_data.type==Chat.CHANNEL_TYPE_WORD){var world=Chat.ins().getWorldStr();channel=i18n("ChatListItemRenderer3_3",world)}else if(_data.type==Chat.CHANNEL_TYPE_KF){var world=Chat.ins().getKfStr();channel=i18n("ChatListItemRenderer3_3",world)}else if(_data.type==Chat.CHANNEL_TYPE_TEAM){channel=i18n("ChatListItemRenderer3_10",i18n("ChatListItemRenderer2_9"))}desc=_data.str;vip=_data.vip}this.showChannel.textFlow=TextFlowMaker.generateTextFlow(channel);this.showHead.text="";if(_data.name){var head=i18n("ChatListItemRenderer2_7")+_data.name+"]|";this.showHead.textFlow=TextFlowMaker.generateTextFlow(head)}this.chatVip.visible=vip>0?true:false;var vipImgWidth=0;if(vip>0){this.chatVip.x=this.showChannel.width;this.chatVip.y=this.showChannel.y;vipImgWidth=this.chatVip.width}this.showHead.x=this.showChannel.x+this.showChannel.width+vipImgWidth;this.showHead.y+this.showChannel.y;desc=this.Expression.replaceByExpressionMark(desc);var strDesc=i18n("ChatListItemRenderer2_8")+desc+"|";this.showText.textFlow=TextFlowMaker.generateTextFlow(strDesc);this.showText.y=this.showHead.y;this.showText.width=undefined;this.validateNow();if(this.showChannel.width+vipImgWidth+this.showHead.width+this.showText.textWidth>(maxWidth||this.textGroup.width)){var tH=this.showText.height;this.showText.width=(maxWidth||this.textGroup.width)-this.showChannel.width-vipImgWidth-this.showHead.width;this.showText.height=tH}this.showText.x=this.showChannel.x+this.showChannel.width+vipImgWidth+this.showHead.width};return ChatListItemRenderer2}(BaseItemRender);__reflect(ChatListItemRenderer2.prototype,"ChatListItemRenderer2");var ChatListItemRenderer3=function(_super){__extends(ChatListItemRenderer3,_super);function ChatListItemRenderer3(){var _this=_super.call(this)||this;_this.Expression=new Expression;return _this}ChatListItemRenderer3.prototype.dataChanged=function(){var _data=this.data;var maxWidth=0;if(this.$parent){maxWidth=this.$parent.$explicitWidth}var channel="";var desc="";var vip=0;this.currentState="playernomal";if(_data instanceof GuildMessageInfo){channel=i18n("ChatListItemRenderer3_0");desc=_data.content;vip=_data.vipLevel;var playername=_data.name;if(_data.type!=1){if(playername==undefined){this.currentState="guildSys"}else{this.currentState="system"}}}else if(_data instanceof ChatSystemData){channel=i18n("ChatListItemRenderer3_1");desc=_data.str;this.currentState="system"}else{if(_data.type==Chat.CHANNEL_TYPE_WORD){var world=Chat.ins().getWorldStr();channel=i18n("ChatListItemRenderer3_3",world)}else if(_data.type==Chat.CHANNEL_TYPE_KF){var world=Chat.ins().getKfStr();channel=i18n("ChatListItemRenderer3_3",world)}else if(_data.type==Chat.CHANNEL_TYPE_TEAM){channel=i18n("ChatListItemRenderer3_10",i18n("ChatListItemRenderer2_9"))}desc=_data.str;vip=_data.vip}if(this.playerhead){if(_data.job>=0&&_data.sex>=0){this.playerhead.source="yuanhead"+_data.job+_data.sex}}var oldLineWidth=-1;var oldLineHeight=-1;var strDesc=i18n("ChatListItemRenderer3_8")+desc+"|";this.showText.textFlow=TextFlowMaker.generateTextFlow1(strDesc);this.EsionGroup.removeChildren();this.showText.x=80;this.showText.y=28;var isShowBigEsion=this.Expression.setBigExpression(this.EsionGroup,this.showText);if(isShowBigEsion){this.currentState="playerbig"}this.validateNow();this.showChannel.textFlow=TextFlowMaker.generateTextFlow(channel);this.showHead.text="";if(_data.name){var head=i18n("ChatListItemRenderer3_7")+_data.name+"]|";this.showHead.textFlow=TextFlowMaker.generateTextFlow(head)}this.chatVip.visible=vip>0?true:false;var vipImgWidth=0;if(vip>0){this.chatVip.x=this.showChannel.x+this.showChannel.width;this.chatVip.y=this.showChannel.y;vipImgWidth=this.chatVip.width}this.showHead.x=this.showChannel.x+this.showChannel.width+vipImgWidth;this.showHead.y+this.showChannel.y;this.showQzVip();this.showDatVip();if(!isShowBigEsion){var strWidth=StringUtils.getTextWidth(this.showText.text,this.showText.size,this.showText.fontFamily);this.showText.width=undefined;this.showText.height=undefined;this.chatbg.height=38;if(this.currentState=="playernomal"){this.showText.x=80;this.showText.y=28}else if(this.currentState=="system"||this.currentState=="guildSys"){this.showText.x=this.showChannel.x+this.showChannel.width+vipImgWidth+this.showHead.width;this.showText.y=0}if(_data.type==3&&this.showChannel.width+vipImgWidth+this.showHead.width+this.showText.textWidth>(maxWidth||this.textGroup.width)){var space=i18n("ChatListItemRenderer3_9");this.showText.text="";for(var i=1;i<=200;i++){space+=" ";if(i*4.5>this.showChannel.width+this.showHead.width+vipImgWidth+10)break}space+=desc+"|";this.showText.x=0;this.showText.y=0;this.showText.textFlow=TextFlowMaker.generateTextFlow(space);this.showText.width=maxWidth||this.textGroup.width}else if(strWidth>=this.textGroup.width+this.showText.x){this.showText.x=45;if(this.currentState=="guildSys"){if(DeviceUtils.IsMobile){this.showText.width=this.textGroup.width-this.showText.x}}else{this.showText.x=80;this.showText.width=this.textGroup.width}oldLineWidth=this.showText.textWidth;oldLineHeight=16;this.showText.height=this.textGroup.height;if(this.chatbg)this.chatbg.height=55}this.validateNow();this.Expression.setSmallExpressionText(this.chatbg,this.EsionGroup,this.showText,strDesc,oldLineWidth,oldLineHeight);if(this.chatbg){this.validateNow();this.chatbg.width=this.showText.textWidth+30}}};ChatListItemRenderer3.prototype.showQzVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQZoneChannel()){var qzviplv=this.data.qzviplv;var isqzyearVip=this.data.isYearVip;if(qzviplv>=1&&isqzyearVip<1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_"+qzviplv}else if(qzviplv>=1&&isqzyearVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_year_"+qzviplv}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onqzvipBtn,this)}}};ChatListItemRenderer3.prototype.showDatVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQDaTingChannel()){var datviplv=this.data.datviplv;var isdathighVip=this.data.isdatHighVip;var isdatyearVip=this.data.isdatYearVip;if(datviplv>=1&&isdathighVip<1){this.qzVip.visible=true;this.qzVip.source="dat_vip_icon_"+datviplv}else if(datviplv>=1&&isdathighVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_high_"+datviplv}if(isdatyearVip>=1){this.datYearVip.visible=true}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;this.datYearVip.x=this.qzVip.x+24;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ondatvipBtn,this)}}};ChatListItemRenderer3.prototype.onqzvipBtn=function(){ViewManager.ins().open(QzVipWin)};ChatListItemRenderer3.prototype.ondatvipBtn=function(){ViewManager.ins().open(DaTVipWin)};return ChatListItemRenderer3}(BaseItemRender);__reflect(ChatListItemRenderer3.prototype,"ChatListItemRenderer3");var ChatListItemRenderer4=function(_super){__extends(ChatListItemRenderer4,_super);function ChatListItemRenderer4(){var _this=_super.call(this)||this;_this.Expression=new Expression;return _this}ChatListItemRenderer4.prototype.dataChanged=function(){var _data=null;if(this.type)this.type.visible=false;if(this.data.type==Chat.CHANNEL_TYPE_WORD){_data=this.data}else if(this.data.type==3){_data=this.data}else{_data=this.data}if(_data.id==Actor.actorID)this.currentState="playernomal";else if(this.data.type==3)this.currentState="system";else this.currentState="playernomal";var servStr=KFServerSys.ins().isKF?"S"+_data.servId:"";this.validateNow();var desc="";var vip=0;var head;var strDesc;var oldLineWidth=-1;var oldLineHeight=-1;if(_data.type==0||_data.type==1||_data.type==2){return}else if(_data.type==3){desc=_data.str;vip=0;head=i18n("ChatListItemRenderer_0");strDesc=desc}else{desc=_data.str;vip=_data.vip;head=i18n("ChatListItemRenderer_1",_data.name,servStr);strDesc=i18n("ChatListItemRenderer_2")+desc+"|"}if(this.playerhead){if(_data.job>=0&&_data.sex>=0){this.playerhead.source="yuanhead"+_data.job+_data.sex}}this.showText.textFlow=TextFlowMaker.generateTextFlow1(strDesc);this.EsionGroup.removeChildren();var isShowBigEsion=this.Expression.setBigExpression(this.EsionGroup,this.showText);if(isShowBigEsion){this.currentState="playerbig"}this.validateNow();this.showHead.textFlow=TextFlowMaker.generateTextFlow(head);this.chatVip.visible=vip>0?true:false;var vipImgWidth=0;if(vip>0){vipImgWidth=this.chatVip.width;this.chatVip.x=62;this.chatVip.y=0;this.showHead.x=this.chatVip.x+vipImgWidth;this.showHead.y+this.chatVip.y}else{this.showHead.x=92;this.showHead.y=0}this.showQzVip();this.showDatVip();if(!isShowBigEsion){var strWidth=StringUtils.getTextWidth(this.showText.text,this.showText.size,this.showText.fontFamily);this.showText.x=80;this.chatbg.height=38;if(_data.type==3&&this.showHead.width+vipImgWidth+this.showText.width>=this.textGroup.width){var space=i18n("ChatListItemRenderer_3");this.showText.text="";for(var i=1;i<=200;i++){space+=" ";if(i*4.5>this.showHead.width+vipImgWidth)break}space+=desc+"|";this.showText.textFlow=TextFlowMaker.generateTextFlow(space);this.showText.x=10;this.showText.width=this.textGroup.width;this.showText.height=this.textGroup.height}else if(strWidth>=this.textGroup.width+this.showText.x){this.showText.x=80;oldLineWidth=this.showText.textWidth;oldLineHeight=16;this.showText.width=this.textGroup.width;this.showText.height=this.textGroup.height;if(this.chatbg)this.chatbg.height=55}this.validateNow();this.Expression.setSmallExpressionText(this.chatbg,this.EsionGroup,this.showText,strDesc,oldLineWidth,oldLineHeight);this.showText.y=28;if(this.chatbg){this.validateNow();this.chatbg.width=this.showText.textWidth+30}}};ChatListItemRenderer4.prototype.showQzVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQZoneChannel()){var qzviplv=this.data.qzviplv;var isqzyearVip=this.data.isYearVip;if(qzviplv>=1&&isqzyearVip<1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_"+qzviplv}else if(qzviplv>=1&&isqzyearVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_year_"+qzviplv}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onqzvipBtn,this)}}};ChatListItemRenderer4.prototype.showDatVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQDaTingChannel()){var datviplv=this.data.datviplv;var isdathighVip=this.data.isdatHighVip;var isdatyearVip=this.data.isdatYearVip;if(datviplv>=1&&isdathighVip<1){this.qzVip.visible=true;this.qzVip.source="dat_vip_icon_"+datviplv}else if(datviplv>=1&&isdathighVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_high_"+datviplv}if(isdatyearVip>=1){this.datYearVip.visible=true}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;this.datYearVip.x=this.qzVip.x+24;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ondatvipBtn,this)}}};ChatListItemRenderer4.prototype.onqzvipBtn=function(){ViewManager.ins().open(QzVipWin)};ChatListItemRenderer4.prototype.ondatvipBtn=function(){ViewManager.ins().open(DaTVipWin)};ChatListItemRenderer4.HEAD_BG=["touxiangkuang0","touxiangkuang1"];return ChatListItemRenderer4}(BaseItemRender);__reflect(ChatListItemRenderer4.prototype,"ChatListItemRenderer4");var ChatListItemRenderer5=function(_super){__extends(ChatListItemRenderer5,_super);function ChatListItemRenderer5(){var _this=_super.call(this)||this;_this.Expression=new Expression;return _this}ChatListItemRenderer5.prototype.dataChanged=function(){var _data=null;if(this.type)this.type.visible=false;if(this.data.type==Chat.CHANNEL_TYPE_KF){_data=this.data}if(_data.id==Actor.actorID){this.currentState="playernomal"}else this.currentState="playernomal";var servStr=KFServerSys.ins().isKF?"S"+_data.servId:"";this.validateNow();var desc="";var vip=0;var head;var strDesc;var oldLineWidth=-1;var oldLineHeight=-1;if(_data.type==0||_data.type==1||_data.type==2){return}else{desc=_data.str;vip=_data.vip;head=i18n("ChatListItemRenderer_1",_data.name,servStr);strDesc=i18n("ChatListItemRenderer_2")+desc+"|"}if(this.playerhead){if(_data.job>=0&&_data.sex>=0){this.playerhead.source="yuanhead"+_data.job+_data.sex}}this.showText.textFlow=TextFlowMaker.generateTextFlow1(strDesc);this.EsionGroup.removeChildren();var isShowBigEsion=this.Expression.setBigExpression(this.EsionGroup,this.showText);if(isShowBigEsion){this.currentState="playerbig";this.chatbg.height=90}this.validateNow();this.showHead.textFlow=TextFlowMaker.generateTextFlow(head);this.chatVip.visible=vip>0?true:false;var vipImgWidth=0;if(vip>0){vipImgWidth=this.chatVip.width;this.chatVip.x=62;this.chatVip.y=0;this.showHead.x=this.chatVip.x+vipImgWidth;this.showHead.y+this.chatVip.y}else{this.showHead.x=92;this.showHead.y=0}this.showQzVip();this.showDatVip();if(!isShowBigEsion){var strWidth=StringUtils.getTextWidth(this.showText.text,this.showText.size,this.showText.fontFamily);this.showText.x=80;this.chatbg.height=38;if(_data.type==3&&this.showHead.width+vipImgWidth+this.showText.width>=this.textGroup.width){var space=i18n("ChatListItemRenderer_3");this.showText.text="";for(var i=1;i<=200;i++){space+=" ";if(i*4.5>this.showHead.width+vipImgWidth)break}space+=desc+"|";this.showText.textFlow=TextFlowMaker.generateTextFlow(space);this.showText.x=10;this.showText.width=this.textGroup.width;this.showText.height=this.textGroup.height}else if(strWidth>=this.textGroup.width+this.showText.x){this.showText.x=80;oldLineWidth=this.showText.textWidth;oldLineHeight=16;this.showText.width=this.textGroup.width;this.showText.height=this.textGroup.height;if(this.chatbg)this.chatbg.height=55}this.validateNow();this.Expression.setSmallExpressionText(this.chatbg,this.EsionGroup,this.showText,strDesc,oldLineWidth,oldLineHeight);this.showText.y=28;if(this.chatbg){this.validateNow();this.chatbg.width=this.showText.textWidth+30}}};ChatListItemRenderer5.prototype.showQzVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQZoneChannel()){var qzviplv=this.data.qzviplv;var isqzyearVip=this.data.isYearVip;if(qzviplv>=1&&isqzyearVip<1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_"+qzviplv}else if(qzviplv>=1&&isqzyearVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_year_"+qzviplv}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onqzvipBtn,this)}}};ChatListItemRenderer5.prototype.showDatVip=function(){this.qzVip.visible=false;this.datYearVip.visible=false;if(ChannelMgr.ins().isQQDaTingChannel()){var datviplv=this.data.datviplv;var isdathighVip=this.data.isdatHighVip;var isdatyearVip=this.data.isdatYearVip;if(datviplv>=1&&isdathighVip<1){this.qzVip.visible=true;this.qzVip.source="dat_vip_icon_"+datviplv}else if(datviplv>=1&&isdathighVip>=1){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_high_"+datviplv}if(isdatyearVip>=1){this.datYearVip.visible=true}this.validateNow();this.qzVip.x=this.showHead.x+this.showHead.textWidth+5;this.datYearVip.x=this.qzVip.x+24;if(!this.qzVip.hasEventListener(egret.TouchEvent.TOUCH_TAP)){this.qzVip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ondatvipBtn,this)}}};ChatListItemRenderer5.prototype.onqzvipBtn=function(){ViewManager.ins().open(QzVipWin)};ChatListItemRenderer5.prototype.ondatvipBtn=function(){ViewManager.ins().open(DaTVipWin)};ChatListItemRenderer5.HEAD_BG=["touxiangkuang0","touxiangkuang1"];return ChatListItemRenderer5}(BaseItemRender);__reflect(ChatListItemRenderer5.prototype,"ChatListItemRenderer5");var ChatSystemItemRenderer=function(_super){__extends(ChatSystemItemRenderer,_super);function ChatSystemItemRenderer(){var _this=_super.call(this)||this;_this.skinName="SysMesItemSkin";return _this}ChatSystemItemRenderer.prototype.dataChanged=function(){if(this.data.type==1){this.str.textFlow=TextFlowMaker.generateTextFlow(i18n("ChatSystemItemRenderer_0")+this.data.str+"|");this.type.source="lt_01"}else{this.str.textFlow=TextFlowMaker.generateTextFlow(this.data.str);this.type.source="lt_02"}};return ChatSystemItemRenderer}(BaseItemRender);__reflect(ChatSystemItemRenderer.prototype,"ChatSystemItemRenderer");var PlayerTipsWin=function(_super){__extends(PlayerTipsWin,_super);function PlayerTipsWin(){var _this=_super.call(this)||this;_this.currId=0;_this.skinName="PlayerInfoSkin";return _this}PlayerTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.data=param[0];if(!this.data){ViewManager.ins().close(PlayerTipsWin);return}this.currId=0;this.btnGiveLock.visible=!UserMiji.ins().canGive();this.addTouchEvent(this.btnIgnore,this.onTap);this.addTouchEvent(this.btnChat,this.onTap);this.addTouchEvent(this.btnFriend,this.onTap);this.addTouchEvent(this.btnInfo,this.onTap);this.addTouchEvent(this.btnGive,this.onTap);this.addTouchEvent(this.rect,this.onTap);this.addTouchEvent(this.btnPropose,this.onTap);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.initView()};PlayerTipsWin.prototype.onTap=function(e){switch(e.target){case this.btnChat:var index=Friends.ins().getFriendIndex(this.currId);if(index!=-1){ViewManager.ins().close(this);ViewManager.ins().open(FriendBgWin,0,index)}else{UserTips.ins().showTips(i18n("PlayerTipsWin_0"))}break;case this.btnInfo:UserReadPlayer.ins().sendFindPlayer(this.currId);break;case this.btnIgnore:Friends.ins().sendAddBlackList(this.currId,this.data.name);break;case this.btnFriend:Friends.ins().sendAddFriend(this.currId,this.data.name);break;case this.rect:ViewManager.ins().close(PlayerTipsWin);break;case this.btnGive:if(UserMiji.ins().canGive()){ViewManager.ins().close(PlayerTipsWin);ViewManager.ins().open(MijiGiveWin,this.labelName.text)}else{WarnWin.show(i18n("PlayerTipsWin_10")+GlobalConfig.MijiBaseConfig.sendGiftVipLevel.toString()+i18n("PlayerTipsWin_1"),function(){ViewManager.ins().open(VipWin)},this)}break;case this.btnPropose:ViewManager.ins().close(PlayerTipsWin);ViewManager.ins().close(FriendBgWin);var isMarried=MarryMgr.ins().isMarried();if(isMarried){UserTips.ins().showTips(i18n("ProposePanel_6"))}else{if(!this.data.married){ViewManager.ins().open(UnMarriedMainWin,0,this.data)}else{UserTips.ins().showTips(i18n("ProposePanel_5"))}}break}};PlayerTipsWin.prototype.initView=function(){if(this.data instanceof FriendData){var data=this.data;this.labelName.text=data.name;if(data.zs)this.labelLv.text=i18n("PlayerTipsWin_2",data.zs,data.lv);else this.labelLv.text=i18n("PlayerTipsWin_3",this.data.lv);this.labelGuild.text=data.guildName;this.imgBg.source=ChatListItemRenderer.HEAD_BG[data.sex];var job=fixJob(data.job);var sex=fixSex(data.sex);this.imgHead.source="head_"+job+sex;this.currId=data.id}else if(this.data instanceof GuildMemberInfo){this.labelName.text=this.data.name;if(this.data.zsLevel)this.labelLv.text=i18n("PlayerTipsWin_4",this.data.zsLevel,this.data.level);else this.labelLv.text=i18n("PlayerTipsWin_5",this.data.level);this.labelGuild.text=Guild.ins().guildName?Guild.ins().guildName:"";this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.sex];var job=fixJob(this.data.job);var sex=fixSex(this.data.sex);this.imgHead.source="head_"+job+sex;this.currId=this.data.roleID}else if(this.data instanceof GuildMessageInfo){this.labelName.text=this.data.name;if(this.data.zsLevel)this.labelLv.text=i18n("PlayerTipsWin_6",this.data.zsLevel,this.data.lv);else this.labelLv.text=i18n("PlayerTipsWin_7",this.data.lv);this.labelGuild.text=this.data.guildName;this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.sex];var job=fixJob(this.data.job);var sex=fixSex(this.data.sex);this.imgHead.source="head_"+job+sex;this.currId=this.data.roleId}else{if(this.data.servId!=undefined&&this.data.servId!=GameServer.serverID){this.btnGive.visible=false}this.labelName.text=this.data.name;if(this.data.zsLevel)this.labelLv.text=i18n("PlayerTipsWin_8",this.data.zsLevel,this.data.lv);else this.labelLv.text=i18n("PlayerTipsWin_9",this.data.lv);this.labelGuild.text=this.data.guild;this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.sex];var job=fixJob(this.data.job);var sex=fixSex(this.data.sex);this.imgHead.source="head_"+job+sex;this.currId=this.data.id}this.btnPropose.visible=true;var idx=Friends.ins().getFriendIndex(this.data.id);var open=MarryMgr.ins().isOpen();if(idx==-1||!open){this.btnPropose.visible=false}};PlayerTipsWin.prototype.openOtherPlayerView=function(otherPlayerData){ViewManager.ins().close(this);ViewManager.ins().close(FriendBgWin);ViewManager.ins().open(RRoleWin,otherPlayerData)};return PlayerTipsWin}(BaseEuiView);__reflect(PlayerTipsWin.prototype,"PlayerTipsWin");ViewManager.ins().reg(PlayerTipsWin,LayerManager.UI_Popup);var DailyCheckIn=function(_super){__extends(DailyCheckIn,_super);function DailyCheckIn(){var _this=_super.call(this)||this;_this._loginTimes=0;_this.conLoginTimes=0;_this.todayReward=false;_this.comTimesIndexList=[];_this.sysId=PackageID.DailyCheckIn;_this.regNetMsg(1,_this.postCheckInData);return _this}DailyCheckIn.ins=function(){return _super.ins.call(this)};Object.defineProperty(DailyCheckIn.prototype,"loginTimes",{get:function(){return this._loginTimes},enumerable:true,configurable:true});DailyCheckIn.prototype.postCheckInData=function(bytes){this._loginTimes=bytes.readShort();this.todayReward=bytes.readBoolean();this.conLoginTimes=bytes.readShort();this.rewardIndex=bytes.readShort()};DailyCheckIn.prototype.sendCheckIn=function(index){var bytes=this.getBytes(1);bytes.writeShort(index);this.sendToServer(bytes)};DailyCheckIn.prototype.sendReCheckIn=function(index){var bytes=this.getBytes(2);bytes.writeShort(index);this.sendToServer(bytes)};DailyCheckIn.prototype.postCheckIn=function(param){return param};DailyCheckIn.prototype.sendGetReward=function(index){var bytes=this.getBytes(3);bytes.writeInt(index);this.sendToServer(bytes)};DailyCheckIn.prototype.postComplement=function(param){return param};DailyCheckIn.prototype.showRedPoint=function(){var result=this.canNormalCheckIn()||this.checkConReward();return result};DailyCheckIn.prototype.canNormalCheckIn=function(){return!this.todayReward};DailyCheckIn.prototype.checkConReward=function(){var days=this.getRewardList(this.rewardIndex)?this.getRewardList(this.rewardIndex).days:0;return this.conLoginTimes>=days};DailyCheckIn.prototype.getCheckInState=function(day){if(day>this.loginTimes){return DailyCheckInState.notYet}else if(day<this.loginTimes){return DailyCheckInState.hasChecked}else{if(this.todayReward){return DailyCheckInState.hasChecked}else{return DailyCheckInState.canCheck}}};DailyCheckIn.prototype.getRewardDays=function(){return 0};DailyCheckIn.prototype.getRewardList=function(index){if(GlobalConfig.MonthSignDaysConfig[index+1]){return GlobalConfig.MonthSignDaysConfig[index+1]}return null};return DailyCheckIn}(BaseSystem);__reflect(DailyCheckIn.prototype,"DailyCheckIn");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.dailycheckin=DailyCheckIn.ins.bind(DailyCheckIn)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var DailyCheckInState;(function(DailyCheckInState){DailyCheckInState[DailyCheckInState["notYet"]=0]="notYet";DailyCheckInState[DailyCheckInState["canCheck"]=1]="canCheck";DailyCheckInState[DailyCheckInState["hasChecked"]=2]="hasChecked"})(DailyCheckInState||(DailyCheckInState={}));window["DailyCheckInState"]=DailyCheckInState;var DailyCheckInCard=function(_super){__extends(DailyCheckInCard,_super);function DailyCheckInCard(){var _this=_super.call(this)||this;_this.id=0;_this.checkInState=0;_this.skinName="DailyCheckInItem";return _this}DailyCheckInCard.prototype.dataChanged=function(){this.resetView();var rewardCfg=this.data;if(rewardCfg){this.vipFlagGroup.touchChildren=false;this.vipFlagGroup.touchEnabled=false;this.dayFlagGroup.touchChildren=false;this.dayFlagGroup.touchEnabled=false;this.complement.touchEnabled=false;this.dayFlagGroup.visible=false;this.item.data=rewardCfg.rewards[0];this.item.touchChildren=false;this.item.touchEnabled=false;var state=DailyCheckIn.ins().getCheckInState(rewardCfg.day);if(state){switch(state){case DailyCheckInState.canCheck:this.checkInState=DailyCheckInState.canCheck;this.showFlag();break;case DailyCheckInState.hasChecked:this.checkInState=DailyCheckInState.hasChecked;this.showChecked();break}}else{this.showFlag();var isComplement=false;this.item.touchChildren=!isComplement;this.item.touchEnabled=!isComplement}}this.showEquipEffect()};DailyCheckInCard.prototype.showEquipEffect=function(){var state=DailyCheckIn.ins().getCheckInState(this.data.day);if(state!=DailyCheckInState.canCheck){if(this.EquipEffect)DisplayUtils.removeFromParent(this.EquipEffect);this.canGetFlag.visible=false}else{this.EquipEffect=this.EquipEffect||new MovieClip;this.EquipEffect.touchEnabled=false;this.EquipEffect.x=45;this.EquipEffect.y=35;this.EquipEffect.scaleX=1.1;this.EquipEffect.scaleY=1.1;if(!this.EquipEffect.parent)this.addChild(this.EquipEffect);this.EquipEffect.playFile(RES_DIR_EFF+"quaeff4",-1);this.canGetFlag.visible=true}};DailyCheckInCard.prototype.showChecked=function(){this.checked.visible=this.checkedMask.visible=true};DailyCheckInCard.prototype.showFlag=function(){var rewardCfg=this.data;if(rewardCfg){if(rewardCfg.vipLabel>0){var vipLevel=rewardCfg.vipLabel;if(vipLevel>10)vipLevel=10;var vipCfg=CheckInConfigMgr.ins().getVipCfg_Daily(vipLevel);if(vipCfg){this.vipFlagGroup.visible=true;this.vipLab.text=i18n("DailyCheckInCard_11",vipLevel)}}else{if(rewardCfg.dayLabel>0){this.dayLab.text=i18n("DailyCheckInCard_12",rewardCfg.day)}}}};DailyCheckInCard.prototype.resetView=function(){this.complement.visible=false;this.vipFlagGroup.visible=false;this.dayFlagGroup.visible=false;this.checked.visible=this.checkedMask.visible=false;if(this.EquipEffect)DisplayUtils.removeFromParent(this.EquipEffect)};return DailyCheckInCard}(eui.ItemRenderer);__reflect(DailyCheckInCard.prototype,"DailyCheckInCard");var DailyCheckInPanel=function(_super){__extends(DailyCheckInPanel,_super);function DailyCheckInPanel(){var _this=_super.call(this)||this;_this.isTweenItem=false;_this.currentyear=0;_this.currentDay=0;_this.panelwidth=400;_this.xqArr=[i18n("DailyCheckInPanel_8"),i18n("DailyCheckInPanel_9"),i18n("DailyCheckInPanel_10"),i18n("DailyCheckInPanel_11"),i18n("DailyCheckInPanel_12"),i18n("DailyCheckInPanel_13"),i18n("DailyCheckInPanel_14")];_this.MonthArr=[31,28,31,30,31,30,31,31,30,31,30,31];_this.skinName="DailyCheckInPanelSkin";_this.cardList.itemRenderer=DailyCheckInCard;return _this}DailyCheckInPanel.prototype.childrenCreated=function(){this.eff=new MovieClip;this.eff.x=428;this.eff.y=53;this.eff.scaleX=.85;this.eff.scaleY=.85;this.eff.touchEnabled=false;this.listData=new eui.ArrayCollection;this.cardList.dataProvider=this.listData};DailyCheckInPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(DailyCheckIn.ins().postCheckInData,this.onCheckInData);this.observe(DailyCheckIn.ins().postCheckIn,this.onCheckIn);this.observe(UserVip.ins().postUpdateVipData,this.onCheckInData);this.cardScroller.addEventListener(egret.Event.ENTER_FRAME,this.updateListPos,this);this.addTouchEvent(this.cardList,this.onListTap);this.addTouchEvent(this.rewardBtn,this.ondayRewardListTap);this.addTouchEvent(this.rewardBtn0,this.onTotalRewardListTap);this.isTweenItem=true;this.initPanel();this.updateCheckInTimes();this.updateList()};DailyCheckInPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isTweenItem=false;this.cardScroller.removeEventListener(egret.Event.ENTER_FRAME,this.updateListPos,this);DisplayUtils.removeFromParent(this.eff);this.listData=null;this.removeObserve();this.cleanList()};DailyCheckInPanel.prototype.toCheckIn=function(index){DailyCheckIn.ins().sendCheckIn(index)};DailyCheckInPanel.prototype.onCheckIn=function(param){var success=param[0];var index=param[1];var str=success?i18n("DailyCheckInPanel_0"):i18n("DailyCheckInPanel_1");UserTips.ins().showTips(str);if(success&&this.isTweenItem){this.runTweenItem(this,index)}};DailyCheckInPanel.prototype.runTweenItem=function(self,index){if(!self)return;var cardList=self.cardList;if(!cardList)return;var card=cardList.getElementAt(index-1);if(!card)return;var rewardCfg=card.data;if(!rewardCfg)return;var itemCfg=GlobalConfig.ItemConfig[rewardCfg.rewards[0].id];if(!itemCfg)return;var cardGlobalPos=cardList.localToGlobal(card.x+(card.width>>1),card.y+(card.height>>1));var posX=cardGlobalPos.x;var posY=cardGlobalPos.y;return[itemCfg.icon.toString(),posX,posY]};DailyCheckInPanel.prototype.onCheckInData=function(param){this.updateCheckInTimes();this.updateList()};DailyCheckInPanel.prototype.onListTap=function(e){var _this=this;if(e&&e.currentTarget){if(this.cardList.selectedItem){var state=DailyCheckIn.ins().getCheckInState(this.cardList.selectedItem.day);if(state){if(state==1){if(UserVip.ins().lv>0){this.toCheckIn(this.cardList.selectedItem.day)}else if(this.cardList.selectedItem.vipLabel&&UserVip.ins().lv<this.cardList.selectedItem.vipLabel){var str=i18n("DailyCheckInPanel_2");var win=WarnWin.show(str,function(){ViewManager.ins().open(Recharge1Win)},this,function(){_this.toCheckIn(_this.cardList.selectedItem.day)},this);win.showUI("","","","尊者1");win.setBtnLabel(i18n("DailyCheckInPanel_3"),i18n("DailyCheckInPanel_4"))}else{this.toCheckIn(this.cardList.selectedItem.day)}}else if(state==2){UserTips.ins().showTips(i18n("DailyCheckInPanel_5"))}}else{if(this.cardList.selectedItem.day>this.currentDay){UserTips.ins().showTips(i18n("DailyCheckInPanel_6"))}}}}};DailyCheckInPanel.prototype.ondayRewardListTap=function(e){DailyCheckIn.ins().sendGetReward(this.curRewardData.days)};DailyCheckInPanel.prototype.onTotalRewardListTap=function(e){ViewManager.ins().open(DailyTotalRewardPanel)};DailyCheckInPanel.prototype.onNotYetCardTap=function(rewardCfg){if(!rewardCfg)return;var card=this.cardList.getElementAt(rewardCfg.day-1);if(!card)return};DailyCheckInPanel.prototype.updateCheckInTimes=function(){this.checkInLab.text=i18n("DailyCheckInPanel_7",DailyCheckIn.ins().loginTimes.toString())};DailyCheckInPanel.prototype.initPanel=function(){this.monthList=CheckInConfigMgr.ins().getMonthRewardCfg_Daily();var xm=this.panelwidth/7;var ym=0;this.listData.replaceAll(this.monthList)};DailyCheckInPanel.prototype.updateList=function(){this.addDate()};DailyCheckInPanel.prototype.addDate=function(){this.listData.replaceAll(this.monthList);var logIndays=DailyCheckIn.ins().conLoginTimes;var tempRewardList=DailyCheckIn.ins().getRewardList(DailyCheckIn.ins().rewardIndex);if(tempRewardList){this.rewardBtn.visible=this.rewardItem.visible=true;this.curRewardData=tempRewardList;var comDays=this.curRewardData.days-logIndays>=0?this.curRewardData.days-logIndays:0;var boo=logIndays>=this.curRewardData.days;var color1=boo?5330771:16135779;var color2=5330771;var color3=16422420;var str=i18n("DailyCheckInPanel_15",color1,logIndays,color2,this.curRewardData.days,color3,comDays);this.dayReardText.textFlow=TextFlowMaker.generateTextFlow(str);this.rewardItem.data=this.curRewardData.rewards[0];if(boo){this.rewardBtn.enabled=true;this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.eff.parent)this.rewardGroup.addChild(this.eff)}else{this.rewardBtn.enabled=false;DisplayUtils.removeFromParent(this.eff)}}else{DisplayUtils.removeFromParent(this.eff);this.rewardBtn.visible=this.rewardItem.visible=false;this.rewardBtn.enabled=false;var str=i18n("DailyCheckInPanel_16");this.dayReardText.textFlow=TextFlowMaker.generateTextFlow(str)}};DailyCheckInPanel.prototype.cleanList=function(){this.cardList.dataProvider=null};DailyCheckInPanel.prototype.updateListPos=function(){this.cardScroller.removeEventListener(egret.Event.ENTER_FRAME,this.updateListPos,this);var cardIndex=DailyCheckIn.ins().loginTimes;if(cardIndex>=25){this.cardScroller.viewport.scrollV=this.cardScroller.viewport.contentHeight-this.cardScroller.height}};return DailyCheckInPanel}(BaseEuiView);__reflect(DailyCheckInPanel.prototype,"DailyCheckInPanel");var DailyDayRewardItem=function(_super){__extends(DailyDayRewardItem,_super);function DailyDayRewardItem(){var _this=_super.call(this)||this;_this.id=0;_this.skinName="DailyDayRewardItemSkin";return _this}DailyDayRewardItem.prototype.dataChanged=function(){var rewardCfg=this.data;this.item.data=rewardCfg.rewards[0];this.item.touchChildren=false;this.item.touchEnabled=false;this.item.isShowName(false)};DailyDayRewardItem.prototype.resetView=function(){};return DailyDayRewardItem}(eui.ItemRenderer);__reflect(DailyDayRewardItem.prototype,"DailyDayRewardItem");var DailyTotalRewardItem=function(_super){__extends(DailyTotalRewardItem,_super);function DailyTotalRewardItem(){var _this=_super.call(this)||this;_this.skinName="DailyTotalRewardItemSkin";_this.list.itemRenderer=ItemBase;return _this}DailyTotalRewardItem.prototype.dataChanged=function(){var cfg=this.data;this.list.dataProvider=new ArrayCollection(cfg.rewards);this.day.text=cfg.days.toString()};return DailyTotalRewardItem}(ItemRenderer);__reflect(DailyTotalRewardItem.prototype,"DailyTotalRewardItem");var DailyTotalRewardPanel=function(_super){__extends(DailyTotalRewardPanel,_super);function DailyTotalRewardPanel(){var _this=_super.call(this)||this;_this.skinName="DailyTotalRewardPanelSkin";_this.isTopLevel=true;return _this}DailyTotalRewardPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list.itemRenderer=DailyTotalRewardItem;this.addTouchEndEvent(this.colorCanvas,this.otherClose);this.addTouchEndEvent(this.closeBtn,this.otherClose);var ary=[];var cfg=GlobalConfig.MonthSignDaysConfig;for(var i in cfg){ary.push(cfg[i])}this.list.dataProvider=new ArrayCollection(ary)};DailyTotalRewardPanel.prototype.otherClose=function(evt){ViewManager.ins().close(this)};return DailyTotalRewardPanel}(BaseEuiView);__reflect(DailyTotalRewardPanel.prototype,"DailyTotalRewardPanel");ViewManager.ins().reg(DailyTotalRewardPanel,LayerManager.UI_Popup);var CheckInConfigMgr=function(_super){__extends(CheckInConfigMgr,_super);function CheckInConfigMgr(){return _super.call(this)||this}CheckInConfigMgr.ins=function(){return _super.ins.call(this)};CheckInConfigMgr.prototype.getMonthRewardCfg_Daily=function(){if(!this.monthListConfig||this.monthListConfig.length<=0){this.monthListConfig=[];var config=GlobalConfig.MonthSignConfig;for(var j in config){this.monthListConfig.push(config[j])}}return this.monthListConfig};CheckInConfigMgr.prototype.getSingleRewardCfg_Daily=function(index){var monthCfg=this.getMonthRewardCfg_Daily();if(monthCfg){var singleCfg=monthCfg[index-1];if(this.assert(singleCfg,"MonthSignConfig("+index+")"))return null;return singleCfg}return null};CheckInConfigMgr.prototype.getVipCfg_Daily=function(vipLevel){var cfg=GlobalConfig.MonthSignVipConfig[vipLevel];if(this.assert(cfg,"MonthSignVipConfig("+vipLevel+")"))return null;return cfg};CheckInConfigMgr.prototype.assert=function(value,msg){return Assert(value,msg+" is null")};return CheckInConfigMgr}(BaseClass);__reflect(CheckInConfigMgr.prototype,"CheckInConfigMgr");var CheckInData=function(){function CheckInData(){}CheckInData.prototype.paser=function(bytes){this.cDate=bytes.readShort();this.rewardState=bytes.readShort()};return CheckInData}();__reflect(CheckInData.prototype,"CheckInData");var CityCC=function(_super){__extends(CityCC,_super);function CityCC(){var _this=_super.call(this)||this;_this.cityBossId=0;_this.cityBossHandle=0;_this.attStatue=2;_this.bossKillNumData={};_this.bossIconStatus=true;_this.sysId=PackageID.City;_this.enterCD=0;_this.observe(GameLogic.ins().postEnterMap,function(){if(GameMap.fbType==UserFb.FB_TYPE_CITY)_this.postEnterCity();if(_this.isCity&&GameMap.fbType!=UserFb.FB_TYPE_CITY)_this.postEscCity()});_this.observe(Rank.ins().postPraiseData,_this.createStatue);_this.observe(GuildWar.ins().postWinGuildInfo,_this.createStatue);_this.regNetMsg(1,_this.postCityBossBelong);_this.regNetMsg(2,UserBoss.ins().doBossChallengeResult);_this.regNetMsg(3,_this.postBossInfo);_this.regNetMsg(4,_this.postCityBossId);_this.regNetMsg(5,_this.postRemainTime);_this.regNetMsg(6,_this.postHudunPoint);_this.regNetMsg(7,_this.postEnterCD);return _this}CityCC.prototype.getBossList=function(){var ary;var ids=new Array;for(var i in GlobalConfig.CityBossConfig){var cfg=GlobalConfig.CityBossConfig[i];if(ids.indexOf(cfg.bossId)==-1&&cfg.killBossId>999){ids.push(cfg.bossId)}}ary=new eui.ArrayCollection(ids);return ary};CityCC.prototype.getCityBossConfig=function(bossId){var cfg;for(var i in GlobalConfig.CityBossConfig){if(GlobalConfig.CityBossConfig[i].bossId==bossId&&GlobalConfig.CityBossConfig[i].killBossId>999){cfg=GlobalConfig.CityBossConfig[i];break}}return cfg};CityCC.prototype.getKillBossNum=function(bossId){var cityBoss=CityCC.ins().getCityBossConfig(bossId);var killBossId=cityBoss.killBossId;var killNum=0;if(CityCC.ins().bossKillNumData[killBossId]!=undefined){killNum=CityCC.ins().bossKillNumData[killBossId][0]}var needKillNum=this.getNeedKillBossNum(bossId);if(bossId==this.cityBossId||killNum>needKillNum){killNum=needKillNum}return killNum};CityCC.prototype.getNeedKillBossNum=function(bossId){var cityBoss=CityCC.ins().getCityBossConfig(bossId);var killBossId=cityBoss.killBossId;var appearNum=0;if(CityCC.ins().bossKillNumData[killBossId]!=undefined){appearNum=CityCC.ins().bossKillNumData[killBossId][1]}if(appearNum>=cityBoss.killCount.length){appearNum=cityBoss.killCount.length-1}return cityBoss.killCount[appearNum]};CityCC.prototype.getRefreshTime=function(bossId){var cityBoss=CityCC.ins().getCityBossConfig(bossId);var killBossId=cityBoss.killBossId;var time=0;if(CityCC.ins().bossKillNumData[killBossId]!=undefined){time=CityCC.ins().bossKillNumData[killBossId][2]}var format;if(time==0){format=""}else{time=DateUtils.formatMiniDateTime(time);if(DateUtils.checkTime(time,7)||time==0){format=""}else{format=DateUtils.formatFullTime(time)}}return format};CityCC.prototype.postBossInfo=function(bytes){var count=bytes.readShort();for(var i=0;i<count;i++){var id=bytes.readInt();var num=bytes.readInt();var appearNum=bytes.readInt();var refeshTime=bytes.readInt();this.bossKillNumData[id]=[num,appearNum,refeshTime]}};CityCC.prototype.postCityBossId=function(bytes){UserBoss.ins().monsterID=this.cityBossId=bytes.readInt();UserBoss.ins().bossHandler=this.cityBossHandle=bytes.readDouble();this.changeFunView()};CityCC.prototype.getMaxKillNumBoss=function(){var bossId=0;var tempMax=0;var temp=0;var time=Number.MAX_VALUE;var cfg;var isFirstZero=false;var zeroBossId=0;for(var i in this.bossKillNumData){if(+i<999)continue;cfg=this.getCfgByKillBossId(parseInt(i));var appearNum=cfg.killCount[this.bossKillNumData[i][1]];if(appearNum==undefined){appearNum=cfg.killCount[cfg.killCount.length-1]}temp=this.bossKillNumData[i][0]/appearNum;if(temp>=1){return[bossId,temp]}if(!bossId&&!isFirstZero&&this.bossKillNumData[i][2]==0){isFirstZero=true;zeroBossId=cfg.bossId;tempMax=temp}if(this.bossKillNumData[i][2]&&this.bossKillNumData[i][2]<time){bossId=cfg.bossId;time=this.bossKillNumData[i][2];tempMax=temp}}return[bossId||zeroBossId,tempMax]};CityCC.prototype.getShowBossId=function(){var bossId;if(this.cityBossId>0){bossId=this.cityBossId}else{bossId=this.getMaxKillNumBoss()[0]}return bossId};CityCC.prototype.getCfgByKillBossId=function(killBossId){for(var i in GlobalConfig.CityBossConfig){if(GlobalConfig.CityBossConfig[i].killBossId==killBossId){return GlobalConfig.CityBossConfig[i]}}return null};CityCC.prototype.createStatue=function(type){if(type===void 0){type=-1}if(!this.isCity)return;var title={};title[RankDataType.TYPE_POWER]="chenghaotxdy";title[RankDataType.TYPE_LILIAN]="chenghaomdtx";title[RankDataType.TYPE_SKIRMISH]="chenghaoslzw";var scene=ViewManager.ins().getView(GameSceneView);var sv;var p;if(type==-1){var guildModel=GuildWar.ins().getModel().winGuildInfo;p=GlobalConfig.CityBaseConfig.masterPos;if(guildModel.guildOwnName&&guildModel.guildOwnSex==1){sv=new StatueView("chenghaolcbz",guildModel.guildOwnName||i18n("CityCC_0"),"junzhunv");sv.x=p.x;sv.y=p.y-300}else if(guildModel.guildOwnName&&guildModel.guildOwnSex!=1){sv=new StatueView("chenghaolcbz",guildModel.guildOwnName||i18n("CityCC_1"),"junzhunan");sv.x=p.x;sv.y=p.y-300}else{sv=new StatueView("chenghaolcbz",guildModel.guildOwnName||i18n("CityCC_2"),"diaoxiang0_0");sv.x=p.x;sv.y=p.y}}else{p=GlobalConfig.CityBaseConfig.statuePos[type];if(!p)return;var model=Rank.ins().getRankModel(type).praise;var id=3;if(!model.subRole[0]){switch(type){case RankDataType.TYPE_POWER:id=1;break;case RankDataType.TYPE_SKIRMISH:id=2;break}}else id=model.subRole[0].job;sv=new StatueView(title[type],model.name||i18n("CityCC_3"),"statue_"+id+"_"+(model.subRole[0]?model.subRole[0].sex:0));sv.x=p.x;sv.y=p.y}scene.map.addEntity(sv)};CityCC.prototype.sendEnter=function(){this.sendBaseProto(1)};CityCC.prototype.sendStopAI=function(){this.sendBaseProto(2)};CityCC.prototype.sendRevival=function(){this.sendBaseProto(3)};CityCC.prototype.postEnterCity=function(){this.isCity=true;if(this.cityBossId>0&&this.isChallenge){this.isChallenge=false;TimerManager.ins().doNext(function(){var win=ViewManager.ins().getView(BossBelongPanel);if(win)win.attrBoss()},this)}this.changeFunView();ViewManager.ins().open(CityFunPanel);Rank.ins().sendGetRankingData();Rank.ins().sendGetPraiseData(RankDataType.TYPE_POWER);Rank.ins().sendGetPraiseData(RankDataType.TYPE_SKIRMISH);Rank.ins().sendGetPraiseData(RankDataType.TYPE_LILIAN);GuildWar.ins().requestWinGuildInfo()};CityCC.prototype.postEscCity=function(){this.isCity=false;this.attStatue=2;ViewManager.ins().close(CityFunPanel);ViewManager.ins().close(BossBelongPanel);ViewManager.ins().close(BossBloodPanel);ViewManager.ins().close(TargetPlayerBigBloodPanel)};CityCC.prototype.postChangeAttStatue=function(type){this.attStatue=type;this.changeFunView();return type};CityCC.prototype.changeFunView=function(){if(!this.isCity)return;if(this.attStatue==2&&this.cityBossId==0)ViewManager.ins().open(PlayFunView);else ViewManager.ins().close(PlayFunView);if(this.cityBossId==0){ViewManager.ins().close(BossBloodPanel);ViewManager.ins().close(BossBelongPanel)}else{ViewManager.ins().open(BossBelongPanel);ViewManager.ins().open(BossBloodPanel)}};CityCC.prototype.postCityBossBelong=function(bytes){var oldHandle=bytes.readDouble();var handle=bytes.readDouble();var oldName="";if(oldHandle>0){var oldChar=EntityManager.ins().getMasterList(oldHandle);if(oldChar&&oldChar[0]&&oldChar[0].infoModel){oldName=oldChar[0].infoModel.name}}UserBoss.ins().postBelongChange(handle,oldHandle,oldName)};CityCC.prototype.postRemainTime=function(bytes){UserBoss.ins().reliveTime=bytes.readShort();UserBoss.ins().killerHandler=bytes.readDouble();if(UserBoss.ins().reliveTime>0){UserBoss.ins().clearWorldBossList();ViewManager.ins().open(WorldBossBeKillWin)}else ViewManager.ins().close(WorldBossBeKillWin)};CityCC.prototype.postHudunPoint=function(bytes){if(!bytes)return;this.hudun=bytes.readInt();this.huDunMax=bytes.readInt();TimerManager.ins().remove(this.hudunPointFun,this);if(this.hudun>0){TimerManager.ins().doTimer(1e3,CityCC.ins().hudun,this.hudunPointFun,this)}};CityCC.prototype.hudunPointFun=function(){CityCC.ins().hudun--;this.postHudunPoint(null)};CityCC.prototype.postEnterCD=function(bytes){this.enterCD=bytes.readInt();TimerManager.ins().remove(this.enterCDFun,this);if(this.enterCD>0){TimerManager.ins().doTimer(1e3,this.enterCD,this.enterCDFun,this)}};CityCC.prototype.enterCDFun=function(){this.enterCD--};CityCC.prototype.postCityBossIconVisable=function(){};CityCC.ins=function(){return _super.ins.call(this)};return CityCC}(BaseSystem);__reflect(CityCC.prototype,"CityCC");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.citycc=CityCC.ins.bind(CityCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var BossBelongPanel=function(_super){__extends(BossBelongPanel,_super);function BossBelongPanel(){var _this=_super.call(this)||this;_this.skinName="BossBelongSkin";_this.bloodBar0.labelDisplay.visible=false;_this.attackBoss1.currentState="attbossup";return _this}BossBelongPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(UserBoss.ins().postBelongChange,this.updateBelong);this.observe(GameLogic.ins().postChangeTarget,this.updateTarget);this.observe(MapView.onGridClick,this.mapClick);this.observe(GameLogic.ins().postEnterMap,this.onEnterMap);this.addTouchEvent(this.belongGroup,this.onTap);this.addTouchEvent(this.attguishu1,this.onTap);this.addTouchEvent(this.attackBoss1,this.onTap);this.addTouchEvent(this.attackPlayer1,this.onTap);this.updateBelong();TimerManager.ins().remove(this.updateBelong,this);TimerManager.ins().doTimer(200,0,this.updateBelong,this)};BossBelongPanel.prototype.onEnterMap=function(){this.attackBoss1.currentState="attbossup";this.attackPlayer1.currentState="attgsup"};BossBelongPanel.prototype.mapClick=function(_a){var target=_a.target,x=_a.x,y=_a.y;this.attackBoss1.currentState="attbossup"};BossBelongPanel.prototype.onTap=function(e){TargetListCC.ins().isStopAutoAttack=true;switch(e.currentTarget){case this.attackBoss1:this.attrBoss();break;case this.attguishu1:if(UserBoss.ins().attHandle==Actor.handle){if(KFBossSys.ins().isKFBossBattle){KFBossSys.ins().sendCleanBelong()}else if(DevildomSys.ins().isDevildomBattle){DevildomSys.ins().sendCleanBelong()}else{UserBoss.ins().sendCleanBelong()}break}case this.belongGroup:case this.attackPlayer1:if(UserBoss.ins().attHandle==0){UserTips.ins().showTips(i18n("BossBelongPanel_1"));return}if(UserBoss.ins().attHandle==Actor.handle||UserBoss.ins().attHandle==GameLogic.ins().currAttackHandle)return;if(!UserBoss.ins().canClick)return;GameLogic.ins().postChangeAttrPoint(UserBoss.ins().attHandle);this.setBtnState();break}};BossBelongPanel.prototype.attrBoss=function(){GameLogic.ins().postChangeAttrPoint(UserBoss.ins().bossHandler);this.attackBoss1.currentState="attbossing";this.attackPlayer1.currentState="attgsup"};BossBelongPanel.prototype.updateTarget=function(){this.setBtnState()};BossBelongPanel.prototype.setBtnState=function(){if(UserBoss.ins().attHandle==Actor.handle){if(GwBoss.ins().isGwBoss||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle){this.attguishu1.label=i18n("BossBelongPanel_2")}else{this.attguishu1.visible=false}this.attackPlayer1.currentState="attgsdis"}else{this.attguishu1.visible=true;this.attguishu1.label=i18n("BossBelongPanel_3");if(GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle!=UserBoss.ins().bossHandler){this.attackPlayer1.currentState="attgsing"}else{this.attackPlayer1.currentState="attgsup"}}if(GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==UserBoss.ins().bossHandler){this.attackBoss1.currentState="attbossing"}else{this.attackBoss1.currentState="attbossup"}};BossBelongPanel.prototype.updateBelong=function(){this.updateTarget();var roleList=EntityManager.ins().getMasterList(EntityManager.ins().getRootMasterHandle(UserBoss.ins().attHandle));if(roleList&&roleList.length>0){var len=roleList.length;var hpValue=0;var hpTotal=0;var neigongValue=0;var neigongTotal=0;var mainRoleInfo=void 0;for(var i=0;i<len;i++){var role=roleList[i];if(role instanceof CharRole){var curHp=role.infoModel.getAtt(AttributeType.atHp)||0;var maxHp=role.infoModel.getAtt(AttributeType.atMaxHp)||0;hpValue+=curHp;hpTotal+=maxHp;var curNeigong=role.infoModel.getAtt(AttributeType.cruNeiGong)||0;var maxNeigong=role.infoModel.getAtt(AttributeType.maxNeiGong)||0;neigongValue+=curNeigong;neigongTotal+=maxNeigong;if(!mainRoleInfo){mainRoleInfo=role.infoModel}}}this.belongGroup.visible=hpValue>0&&UserBoss.ins().winner=="";var color=Actor.handle!=UserBoss.ins().attHandle?ColorUtil.ROLENAME_COLOR_YELLOW:ColorUtil.ROLENAME_COLOR_GREEN;var tname=mainRoleInfo.getNameWithServer();var strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];tname=StringUtils.replaceStr(tname,"0xffffff",color+"");this.belongNameTxt1.textFlow=TextFlowMaker.generateTextFlow(i18n("BossBelongPanel_4",color,tname));this.roleHead1.source="yuanhead"+mainRoleInfo.job+mainRoleInfo.sex;this.bloodBar0.maximum=hpTotal;this.bloodBar0.value=hpValue;this.neigongBar0.maximum=neigongTotal;this.neigongBar0.value=neigongValue}else{this.belongGroup.visible=false;this.attackPlayer1.currentState="attgsup"}};return BossBelongPanel}(BaseEuiView);__reflect(BossBelongPanel.prototype,"BossBelongPanel");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.bossBelongPanel=function(){ViewManager.ins().reg(BossBelongPanel,LayerManager.Main_View)}})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var CityBossJiangliTipsWin=function(_super){__extends(CityBossJiangliTipsWin,_super);function CityBossJiangliTipsWin(){return _super.call(this)||this}CityBossJiangliTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="CityBossJiangliTipsSkin";this.isTopLevel=true;this.belongList.itemRenderer=ItemBase};CityBossJiangliTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.giveUp,this.otherClose);this.showAward()};CityBossJiangliTipsWin.prototype.showAward=function(){if(CityCC.ins().isCity){for(var i in GlobalConfig.CityBossConfig){if(GlobalConfig.CityBossConfig[i].bossId==CityCC.ins().cityBossId){this.belongList.dataProvider=new eui.ArrayCollection(GlobalConfig.CityBossConfig[i].showReward);break}}}};CityBossJiangliTipsWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};return CityBossJiangliTipsWin}(BaseEuiView);__reflect(CityBossJiangliTipsWin.prototype,"CityBossJiangliTipsWin");ViewManager.ins().reg(CityBossJiangliTipsWin,LayerManager.UI_Popup);var CityBossView=function(_super){__extends(CityBossView,_super);function CityBossView(){var _this=_super.call(this)||this;_this.lastSelect=0;_this.skinName="CitySkin";_this.isTopLevel=true;return _this}CityBossView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn0,this.onTap);this.tab.addEventListener(egret.Event.CHANGE,this.setSelectedIndex,this);this.addTouchEvent(this.seeRule,this.onSeeRule);this.viewStack.selectedIndex=0;this.viewStack.getElementAt(0)["open"]()};CityBossView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn0,this.onTap)};CityBossView.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn0:ViewManager.ins().close(this);break}};CityBossView.prototype.onSeeRule=function(e){ViewManager.ins().open(ZsBossRuleSpeak,16)};CityBossView.prototype.setSelectedIndex=function(e){this.viewStack.getElementAt(this.lastSelect)["close"]();this.lastSelect=this.viewStack.selectedIndex;this.viewStack.getElementAt(this.lastSelect)["open"]()};return CityBossView}(BaseEuiView);__reflect(CityBossView.prototype,"CityBossView");ViewManager.ins().reg(CityBossView,LayerManager.UI_Main);var CityFunPanel=function(_super){__extends(CityFunPanel,_super);function CityFunPanel(){var _this=_super.call(this)||this;_this.skinName="CityFunSkin";return _this}CityFunPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.attState,this.onClick);this.addTouchEvent(this.quit,this.onClick);this.addTouchEvent(this.npcBtn,this.onClick);this.observe(CityCC.ins().postChangeAttStatue,this.changeBtn);this.observe(CityCC.ins().postCityBossId,this.changeAttStatue);this.changeAttStatue();PlayFunView.instance.updateWild(1)};CityFunPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}PlayFunView.instance.updateWild()};CityFunPanel.prototype.changeAttStatue=function(){if(CityCC.ins().cityBossId>0){CityCC.ins().postChangeAttStatue(1);ViewManager.ins().open(TargetListPanel)}};CityFunPanel.prototype.changeBtn=function(){this.attState.selected=ViewManager.ins().isShow(TargetListPanel)};CityFunPanel.prototype.onClick=function(e){switch(e.currentTarget){case this.attState:var type=0;if(this.attState.selected){ViewManager.ins().open(TargetListPanel);type=1}else if(CityCC.ins().cityBossId==0){type=2;ViewManager.ins().close(TargetListPanel)}else{UserTips.ins().showTips(i18n("CityFunPanel_0"))}CityCC.ins().postChangeAttStatue(type);break;case this.quit:WarnWin.show(i18n("CityFunPanel_1"),function(){UserFb.ins().sendExitFb()},this);break;case this.npcBtn:break}};return CityFunPanel}(BaseEuiView);__reflect(CityFunPanel.prototype,"CityFunPanel");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.cityfunpanel=function(){ViewManager.ins().reg(CityFunPanel,LayerManager.Main_View)}})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var MonsterCityWarView=function(_super){__extends(MonsterCityWarView,_super);function MonsterCityWarView(){return _super.call(this)||this}MonsterCityWarView.prototype.childrenCreated=function(){this.init()};MonsterCityWarView.prototype.open=function(){this.addCustomEvent();this.initView()};MonsterCityWarView.prototype.init=function(){if(!this.isInit){this.list.itemRenderer=BossListRender;this.rewardList.itemRenderer=ItemBase;this.canChallengeTxt.text=i18n("MonsterCityWarView_0");this.bossEffect=new MovieClip;this.bossEffect.scaleX=-1;this.bossEffect.scaleY=1;this.bossEffect.x=78;this.bossEffect.y=160;this.bossGroup.addChild(this.bossEffect);this.bossImage=new MovieClip;this.bossImage.scaleX=-1;this.bossImage.scaleY=1;this.bossImage.x=78;this.bossImage.y=160;this.bossGroup.addChild(this.bossImage);this.isInit=true}};MonsterCityWarView.prototype.addCustomEvent=function(){this.observe(CityCC.ins().postBossInfo,this.checkState);this.observe(CityCC.ins().postCityBossId,this.checkState);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this);this.addTouchEvent(this.challengeBtn,this.onChallenge);this.bossName.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openBossWin,this)};MonsterCityWarView.prototype.openBossWin=function(e){var bossId=this.list.dataProvider.getItemAt(this.list.selectedIndex);var cityBoss=CityCC.ins().getCityBossConfig(bossId);var killBossId=cityBoss.killBossId;ViewManager.ins().open(BossWin,1,killBossId)};MonsterCityWarView.prototype.initView=function(){this.list.dataProvider=CityCC.ins().getBossList();var index=this.getBossIndex();this.list.selectedIndex=index;this.updateView(index)};MonsterCityWarView.prototype.getBossIndex=function(){var bossId=CityCC.ins().getShowBossId();var index=0;if(bossId>0){var count=this.list.dataProvider.length;for(var i=0;i<count;i++){if(bossId==this.list.dataProvider.getItemAt(i)){index=i;break}}}return index};MonsterCityWarView.prototype.onChallenge=function(e){if(CityCC.ins().enterCD>0){UserTips.ins().showTips(i18n("MonsterCityWarView_1",CityCC.ins().enterCD))}else{if(CityCC.ins().isCity){TimerManager.ins().doNext(function(){var win=ViewManager.ins().getView(BossBelongPanel);win.attrBoss()},this)}else{CityCC.ins().isChallenge=true;CityCC.ins().sendEnter()}}ViewManager.ins().close(this)};MonsterCityWarView.prototype.checkState=function(){this.list.dataProvider=CityCC.ins().getBossList();this.updateView(this.list.selectedIndex)};MonsterCityWarView.prototype.onListChange=function(e){this.updateView(e.itemIndex)};MonsterCityWarView.prototype.updateView=function(index){var bossId=this.list.dataProvider.getItemAt(index);var monster=GlobalConfig.MonstersConfig[bossId];var cityBoss=CityCC.ins().getCityBossConfig(bossId);var killNum=CityCC.ins().getKillBossNum(bossId);var maxKillNum=CityCC.ins().getNeedKillBossNum(bossId);var isOpen=killNum>=maxKillNum;var effectPath=GlobalConfig.EffectConfig[monster.effect].fileName;this.bossName.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+GlobalConfig.MonstersConfig[cityBoss.killBossId].name+"</u></a>");this.bossName.touchEnabled=true;var time=CityCC.ins().getRefreshTime(bossId);if(time&&time.length>0){this.nextTime.text=i18n("MonsterCityWarView_2")+CityCC.ins().getRefreshTime(bossId)+i18n("MonsterCityWarView_3")}else{this.nextTime.text=""}this.nextTime.visible=true;this.nameTxt.text=i18n("MonsterCityWarView_4",monster.name,monster.level);this.killProgressBar.minimum=0;this.killProgressBar.maximum=maxKillNum;this.killProgressBar.value=killNum;this.rewardList.dataProvider=new eui.ArrayCollection(cityBoss.showReward);this.bossImage.playFile(RES_DIR_MONSTER+("monster"+monster.avatar+"_3s"),-1);this.bossEffect.playFile(RES_DIR_EFF+effectPath,-1);this.updateState(isOpen)};MonsterCityWarView.prototype.updateState=function(isOpen){this.canChallengeTxt.visible=!isOpen;this.challengeBtn.visible=isOpen;this.redPoint.visible=isOpen;this.stateImage.visible=isOpen;this.nextTime.visible=!isOpen};return MonsterCityWarView}(BaseView);__reflect(MonsterCityWarView.prototype,"MonsterCityWarView");var StatueView=function(_super){__extends(StatueView,_super);function StatueView(title,name,body){var _this=_super.call(this)||this;_this.title=new MovieClip;_this.title.playFile(RES_DIR_EFF+title,-1);_this.addChild(_this.title);_this.roleName=new eui.Label;_this.roleName.size=14;_this.roleName.strokeColor=0;_this.roleName.stroke=1;_this.roleName.text=""+name;_this.roleName.x=-_this.roleName.width>>1;_this.addChild(_this.roleName);if(name==i18n("StatueView_0")){_this.model=new eui.Image;_this.model.source=""+RES_DIR_CITY+body+".png";_this.model.once(egret.Event.COMPLETE,function(){_this.model.x=-_this.model.width>>1;_this.model.y=-_this.model.height;_this.roleName.y=_this.model.y-20;_this.title.y=_this.roleName.y-50},_this);_this.addChild(_this.model)}else{_this.model2=new MovieClip;_this.model2.playFile(RES_DIR_EFF+body,-1);_this.model2.once(egret.Event.COMPLETE,function(){_this.model2.x=-_this.model2.width>>1;_this.model2.y=-_this.model2.height;_this.roleName.y=_this.model2.y-20;_this.title.y=_this.roleName.y-50},_this);_this.addChild(_this.model2);_this.roleName.y=_this.model2.y-180;_this.title.y=_this.roleName.y-30}return _this}Object.defineProperty(StatueView.prototype,"weight",{get:function(){return this.y},enumerable:true,configurable:true});return StatueView}(egret.DisplayObjectContainer);__reflect(StatueView.prototype,"StatueView");var BossListRender=function(_super){__extends(BossListRender,_super);function BossListRender(){var _this=_super.call(this)||this;_this.skinName="CityBossItemSkin";return _this}BossListRender.prototype.dataChanged=function(){var bossId=this.data;var monster=GlobalConfig.MonstersConfig[bossId];this.nameTxt.text=monster.name;var isOpen=CityCC.ins().getKillBossNum(bossId)>=CityCC.ins().getNeedKillBossNum(bossId);this.redPoint.visible=isOpen};return BossListRender}(BaseItemRender);__reflect(BossListRender.prototype,"BossListRender");var BubbleFactory=function(_super){__extends(BubbleFactory,_super);function BubbleFactory(){return _super.call(this)||this}BubbleFactory.prototype.playBubbleEffect=function(id){var bubble="";var config=GlobalConfig.BubbleConfig[id];if(config){switch(config.type){case BubbleType.B1:bubble=config.news;break;case BubbleType.B2:if(config.news)UserSkill.ins().postShowSkillWord(config.news);break}}return bubble};return BubbleFactory}(BaseClass);__reflect(BubbleFactory.prototype,"BubbleFactory");var BubbleType;(function(BubbleType){BubbleType[BubbleType["B1"]=1]="B1";BubbleType[BubbleType["B2"]=2]="B2"})(BubbleType||(BubbleType={}));window["BubbleType"]=BubbleType;var CustomServiceWin=function(_super){__extends(CustomServiceWin,_super);function CustomServiceWin(){return _super.call(this)||this}CustomServiceWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="CustomServiceSkin";this.defaultText=i18n("CustomServiceWin_0")};CustomServiceWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};CustomServiceWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.input.textDisplay.size=16;this.input.textDisplay.lineSpacing=0;this.input.textDisplay.multiline=true;this.input.textDisplay.wordWrap=true;this.input.textDisplay.height=335;if(this.input.text.length==0){this.input.text=this.defaultText;this.input.textColor=7105644}else this.input.textColor=14668213;this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.sendBtn,this.onTap);this.input.addEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this)};CustomServiceWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.sendBtn,this.onTap);this.input.removeEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this)};CustomServiceWin.prototype.updateInput=function(){if(this.input.text==this.defaultText){this.input.text="";this.input.textColor=14668213}};CustomServiceWin.prototype.onTap=function(e){switch(e.target){case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break;case this.sendBtn:if(this.input.text.length==0||this.input.text==this.defaultText){UserTips.ins().showTips(i18n("CustomServiceWin_2"));return}ReportData.getIns().advice(this.input.text,this.callBack,this);break}};CustomServiceWin.prototype.callBack=function(){this.input.text=""};return CustomServiceWin}(BaseEuiView);__reflect(CustomServiceWin.prototype,"CustomServiceWin");ViewManager.ins().reg(CustomServiceWin,LayerManager.UI_Main);var DieGuide=function(_super){__extends(DieGuide,_super);function DieGuide(){var _this=_super.call(this)||this;_this.resImg=["vipbn2_0_jpg","vipbn2_1_jpg"];_this.observe(Encounter.ins().postFightResult,_this.postdieGuide);_this.observe(Recharge.ins().postRecharge1Data,_this.initRecharge1);_this.observe(Setting.ins().postInitSetting,_this.initSetting);return _this}DieGuide.ins=function(){return _super.ins.call(this)};DieGuide.prototype.initRecharge1=function(){this.isInitRecharge1=true};DieGuide.prototype.initSetting=function(){this.isInitSetting=true};DieGuide.prototype.postdieGuide=function(result){if(result)return;var dieTime=Setting.ins().getValue(ClientSet.diedFirstTime);if(!dieTime){dieTime=Math.floor((new Date).getTime()/1e3);Setting.ins().setValue(ClientSet.diedFirstTime,dieTime)}var rch=Recharge.ins().getRechargeData(0);if(rch.num){dieTime=Setting.ins().getValue(ClientSet.diedFirstTime2);if(!dieTime){dieTime=Math.floor((new Date).getTime()/1e3);Setting.ins().setValue(ClientSet.diedFirstTime2,dieTime)}}};DieGuide.prototype.dieFbRedPoint=function(resetCount,fbId){var fbconfig=GlobalConfig.DailyFubenConfig[fbId];if(!fbconfig)return false;if(UserZs.ins().lv<fbconfig.zsLevel||Actor.level<fbconfig.levelLimit)return false;var timer=Setting.ins().getValue(ClientSet.FB);if(timer){var index=fbId-3e3;if(timer>>index&1)return false}var dieTime=Setting.ins().getValue(ClientSet.diedFirstTime);if(!dieTime)return false;var curTime=Math.floor((new Date).getTime()/1e3);if(curTime>DateUtils.getTodayZeroSecond(new Date(dieTime*1e3))+60*60*24)return false;if(resetCount>0){return true}return false};DieGuide.prototype.checkCDTimeShow=function(){if(Recharge.ins().showCdTime&&Actor.level>=10){var view=ViewManager.ins().getView(PlayFunView);if(view){view.setDieGuide(DieGuide.CD)}}};DieGuide.prototype.checkFirstChargeOrVIPWin=function(){if(!this.isInitRecharge1||!this.isInitSetting)return;if(UserFb.ins().pkGqboss)return;var rch=Recharge.ins().getRechargeData(0);if(!rch.num){if(Actor.level>=10){var recharge=Setting.ins().getValue(ClientSet.recharge1);if(!recharge){var view=ViewManager.ins().getView(PlayFunView);if(view){view.setDieGuide(DieGuide.RECHARGE)}Setting.ins().setValue(ClientSet.recharge1,DieGuide.Show);return}}var dieTime=Setting.ins().getValue(ClientSet.diedFirstTime);if(dieTime&&dieTime>0){var recharge=Setting.ins().getValue(ClientSet.recharge2);if(!recharge){var view=ViewManager.ins().getView(PlayFunView);if(view){view.setDieGuide(DieGuide.RECHARGE)}Setting.ins().setValue(ClientSet.recharge2,DieGuide.Show);return}}}else{var dieTime=Setting.ins().getValue(ClientSet.diedFirstTime2);if(dieTime&&dieTime>0){if(UserVip.ins().lv<3){var vipGuide=Setting.ins().getValue(ClientSet.vip);if(!vipGuide){var view=ViewManager.ins().getView(PlayFunView);if(view){view.setDieGuide(DieGuide.VIP)}Setting.ins().setValue(ClientSet.vip,DieGuide.Show);return}}}}};DieGuide.prototype.getOpenRoles=function(){var id=Setting.ins().getValue(ClientSet.role);if(id==DieGuide.Show2){if(SubRoles.ins().subRolesLen>=3)return""}var len=3;for(var i=1;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(!role){if(!id){Setting.ins().setValue(ClientSet.role,DieGuide.Show)}else if(id==DieGuide.Show&&i==2){Setting.ins().setValue(ClientSet.role,DieGuide.Show2)}return this.resImg[i-1]}}return""};DieGuide.prototype.setClick=function(fbID){var index=fbID-3e3;var timer=Setting.ins().getValue(ClientSet.FB);if(!timer)timer=0;if(timer>>index&1)return;timer=timer|1<<index;Setting.ins().setValue(ClientSet.FB,timer)};DieGuide.prototype.setMaxFb=function(sweeps){var timer=Setting.ins().getValue(ClientSet.FB);for(var i=0;i<sweeps.length;i++){if(sweeps[i]>3e3){var index=sweeps[i]-3e3;if(timer>>index&1)continue;timer=timer|1<<index;Setting.ins().setValue(ClientSet.FB,timer)}}};DieGuide.Show=1;DieGuide.Show2=2;DieGuide.RECHARGE=1;DieGuide.VIP=2;DieGuide.FB=3;DieGuide.CD=4;return DieGuide}(BaseSystem);__reflect(DieGuide.prototype,"DieGuide");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.dieGuide=DieGuide.ins.bind(DieGuide)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var DressType;(function(DressType){DressType[DressType["ROLE"]=1]="ROLE";DressType[DressType["ARM"]=2]="ARM";DressType[DressType["WING"]=3]="WING"})(DressType||(DressType={}));window["DressType"]=DressType;var Dress=function(_super){__extends(Dress,_super);function Dress(){var _this=_super.call(this)||this;_this.timeInfo={};_this.posInfo=[];_this.unlockable_ids=[];_this.parts_info={};_this.dressUnlockable={};_this.partDressRedNum=0;_this.careerDic={};_this.itemIdDic={};_this.sysId=PackageID.Dress;_this.regNetMsg(1,_this.doDressInfo);_this.regNetMsg(2,_this.doDressActivationRes);_this.regNetMsg(3,_this.doDressUserRes);_this.regNetMsg(4,_this.doUnDressUserRes);_this.regNetMsg(5,_this.doDressTimeEnd);_this.regNetMsg(6,_this.postLevelUp);_this.regNetMsg(8,_this.doPartsTransform);_this.regNetMsg(9,_this.doQueryBuyParts);_this.regNetMsg(10,_this.doBuyParts);_this.regNetMsg(11,_this.doDressRedpoint);_this.regNetMsg(12,_this.doTrialInvalid);_this.regNetMsg(13,_this.postRecycle);return _this}Dress.ins=function(){return _super.ins.call(this)};Dress.prototype.sendDressInfoReq=function(){this.sendBaseProto(1)};Dress.prototype.doDressInfo=function(bytes){this.parser(bytes);Dress.ins().postDressInfo()};Dress.prototype.sendDressActivationReq=function(dressid,trial){if(trial===void 0){trial=0}var bytes=this.getBytes(2);bytes.writeInt(dressid);bytes.writeByte(trial);this.sendToServer(bytes)};Dress.prototype.doDressActivationRes=function(bytes){var id=this.parserAct(bytes);Dress.ins().postJiHuo(id);UserTips.ins().showTips(i18n("Dress_3"))};Dress.prototype.sendDressUserReq=function(roid,dressid){var bytes=this.getBytes(3);bytes.writeByte(roid);bytes.writeInt(dressid);this.sendToServer(bytes)};Dress.prototype.doDressUserRes=function(bytes){this.parserDress(bytes);Dress.ins().postDressInfo();UserTips.ins().showTips(i18n("Dress_4"))};Dress.prototype.sendUnDressUserReq=function(roid,dressid){var bytes=this.getBytes(4);bytes.writeByte(roid);bytes.writeInt(dressid);this.sendToServer(bytes)};Dress.prototype.doUnDressUserRes=function(bytes){this.parserDress(bytes);Dress.ins().postDressInfo();UserTips.ins().showTips(i18n("Dress_5"))};Dress.prototype.doDressTimeEnd=function(bytes){this.parserDel(bytes);Dress.ins().postDressInfo()};Dress.prototype.parser=function(bytes){var num=bytes.readInt();this.timeInfo={};for(var i=0;i<num;i++){var time=new DressTimeInfo;time.dressId=bytes.readInt();time.invalidtime=bytes.readInt();time.lv=bytes.readInt();time.trival=bytes.readInt();this.timeInfo[time.dressId]=time}num=bytes.readByte();this.posInfo=[];for(var i=0;i<num;i++){var pos=new DressPosInfo;for(var k=0;k<3;k++){pos.posAry[k]=bytes.readInt()}this.posInfo.push(pos)}var unlockable_num=bytes.readInt();this.unlockable_ids=[];this.dressUnlockable={};for(var i=0;i<unlockable_num;i++){var dress_id=bytes.readInt();this.unlockable_ids.push(dress_id);this.dressUnlockable[dress_id]=true}};Dress.prototype.parserAct=function(bytes){var info=new DressTimeInfo;info.dressId=bytes.readInt();info.invalidtime=bytes.readInt();info.lv=bytes.readInt();info.trival=bytes.readInt();this.timeInfo[info.dressId]=info;return info.dressId};Dress.prototype.parserDress=function(bytes){var index=bytes.readByte();var posinfo=this.posInfo[index];var pos=bytes.readByte();var item=bytes.readInt();if(posinfo){posinfo.posAry[pos-1]=item}var role=SubRoles.ins().getSubRoleByIndex(index);role.zhuangbei[pos-1]=item;if(pos==1||pos==2)UserEquip.ins().postEquipChange();else Dress.ins().postChangeWing();var mainRole=EntityManager.ins().getEntityByHandle(role.handle);if(mainRole)mainRole.updateModel()};Dress.prototype.parserDel=function(bytes){var id=bytes.readInt();var cfg=GlobalConfig.ZhuangBanId[id];var power=(cfg.exPower||0)+UserBag.getAttrPower(AttributeData.transformAttr(cfg.attr));var str=i18n("Dress_10",cfg.name,power);PlayFunView.addExpiredFuncTip(str);delete this.timeInfo[id];for(var i=0;i<this.posInfo.length;i++){var pos=this.posInfo[i];for(var k=0;k<3;k++){if(pos.posAry[k]==id){pos.posAry[k]=0;var role=SubRoles.ins().getSubRoleByIndex(i);role.zhuangbei[k]=0;if(k==0||k==1)UserEquip.ins().postEquipChange();else Dress.ins().postChangeWing();var mainRole=EntityManager.ins().getEntityByHandle(role.handle);if(mainRole)mainRole.updateModel();break}}}};Dress.prototype.getModelPosId=function(curRole){return this.posInfo[curRole]};Dress.prototype.redPoint=function(){return this.careerRedPoint()};Dress.prototype.careerRedPoint=function(){for(var i=0;i<SubRoles.ins().subRolesLen;i++){var career=SubRoles.ins().getSubRoleByIndex(i).job;var zbs=this.getIdByCareer(career);for(var pos in zbs){var zhuangban=zbs[pos];for(var _i=0,zhuangban_1=zhuangban;_i<zhuangban_1.length;_i++){var element=zhuangban_1[_i];if(this.redPointDress(element.id)){return true}}}}if(DressCollectionMgr.ins().canActivate()){return true}if(this.partDressRedNum>0){return true}return false};Dress.prototype.curRoleRedPoint=function(roleId){return this.roleRedPoint()[roleId]};Dress.prototype.roleRedPoint=function(){var boolList=[false,false,false];var length=SubRoles.ins().subRolesLen;for(var i=0;i<length;i++){var career=SubRoles.ins().getSubRoleByIndex(i).job;var zbs=this.getIdByCareer(career);for(var pos in zbs){var zhuangban=zbs[pos];for(var _i=0,zhuangban_2=zhuangban;_i<zhuangban_2.length;_i++){var element=zhuangban_2[_i];if(this.redPointDress(element.id)){boolList[i]=true;break}}if(boolList[i])break}}return boolList};Dress.prototype.canDress=function(job,pos){var arrZB=this.getIdByCareer(job)[pos];for(var k in arrZB){if(this.redPointDress(arrZB[k].id)){return true}}return false};Dress.prototype.posRedPoint=function(){var ret=[false,false,false];var length=SubRoles.ins().subRolesLen;for(var j=0;j<length;j++){var career=SubRoles.ins().getSubRoleByIndex(j).job;var zbs=this.getIdByCareer(career);for(var i=0;i<3;i++){if(ret[i])continue;var configs=zbs[i+1];for(var _i=0,configs_1=configs;_i<configs_1.length;_i++){var conf=configs_1[_i];if(this.redPointDress(conf.id)){ret[i]=true;break}}}}return ret};Dress.prototype.getIdByCareer=function(career){if(this.careerDic[career])return this.careerDic[career];this.initConfig();return this.careerDic[career]};Dress.prototype.getIdByItemId=function(itemId){if(this.itemIdDic[itemId])return this.itemIdDic[itemId];this.initConfig();return this.itemIdDic[itemId]};Dress.prototype.initConfig=function(){if(Object.keys(this.itemIdDic).length)return;var ZBConfig=GlobalConfig.ZhuangBanId;for(var k in ZBConfig){var config=ZBConfig[k];var roleType=config.roletype;var pos=config.pos;this.careerDic[roleType]=this.careerDic[roleType]||{};this.careerDic[roleType][pos]=this.careerDic[roleType][pos]||[];this.careerDic[roleType][pos].push(config);var itemId=config.cost.itemId;this.itemIdDic[itemId]=this.itemIdDic[itemId]||[];this.itemIdDic[itemId].push(config)}};Dress.prototype.redPointDress=function(id){var config=GlobalConfig.ZhuangBanId[id];if(config.isShow!=1&&Setting.ins().getValue(ClientSet.showAllDress)!=1){return false}if(this.dressUnlockable[id]){return true}var itemId=config.cost.itemId;var num=UserBag.ins().getBagGoodsCountById(0,itemId);var tryOn=config.tryOn;var num2=null;if(tryOn){var item=tryOn.item;num2=UserBag.ins().getBagGoodsCountById(0,item)}if(num==0&&!num2)return false;if(!this.timeInfo[id]){if(num>=config.cost.num){return true}if(num2&&num2>=1){return true}}else{var trival=this.timeInfo[id].trival||0;if(trival>0){if(num>=config.cost.num){return true}if(num2&&num2>=1){return true}}var arrIds=this.getIdByItemId(itemId);for(var _i=0,arrIds_1=arrIds;_i<arrIds_1.length;_i++){var conf=arrIds_1[_i];if(conf.id!=id){if(!this.timeInfo[conf.id])return false}}var nextlv=this.timeInfo[id].lv+1;var zblu=GlobalConfig.ZhuangBanLevelUp[id];if(zblu&&zblu[nextlv]&&zblu[nextlv].cost.num<=num){return true}}return false};Dress.prototype.getIdZhuangBanId=function(itemId){var allData=GlobalConfig.ZhuangBanId;for(var key in allData){var element=allData[key];if(element.cost.itemId==itemId){return itemId}}return 0};Dress.prototype.isTrival=function(itemId){return itemId==Dress.ins().getIdZhuangBanTrialId(itemId)};Dress.prototype.getIdZhuangBanTrialId=function(itemId){var allData=GlobalConfig.ZhuangBanId;for(var key in allData){var element=allData[key];if(element.tryOn&&element.tryOn.item==itemId){return itemId}}return 0};Dress.prototype.getIdByTrialId=function(itemId){var info=Dress.ins().timeInfo;var allData=GlobalConfig.ZhuangBanId;var trials=[];var elements=[];for(var key in allData){var element_2=allData[key];if(element_2.tryOn&&element_2.tryOn.item==itemId){elements.push(element_2);var id=element_2.id;if(!info[id]||!info[id].lv){trials.push(element_2)}}}for(var key in allData){var element_3=allData[key];if(element_3.tryOn&&element_3.tryOn.item==itemId){var id=element_3.id;if(info[id]&&info[id].lv&&info[id].trival>=1){}}}var e=null;var r=0;for(var _i=0,trials_1=trials;_i<trials_1.length;_i++){var element=trials_1[_i];var job=element.roletype;var role=SubRoles.ins().getSubRoleByJob(job);if(role){e=element;r=1;break}}if(!e){if(trials[0]){e=trials[0];r=2}else{var job=SubRoles.ins().getFirstJob();e=elements[job-1];r=0}}return[e,r]};Dress.prototype.sendLevelUp=function(id){var bytes=this.getBytes(6);bytes.writeInt(id);this.sendToServer(bytes)};Dress.prototype.postLevelUp=function(bytes){var id=bytes.readInt();var time=bytes.readInt();var lv=bytes.readInt();var info=this.timeInfo[id];info.invalidtime=time;info.lv=lv;this.postDressInfo()};Dress.prototype.postDressInfo=function(){};Dress.prototype.postJiHuo=function(id){return id};Dress.prototype.postChangeWing=function(){};Dress.prototype.sendPartsTransform=function(zhuangban_id){var bytes=this.getBytes(8);this.sendToServer(bytes)};Dress.prototype.doPartsTransform=function(bytes){var error_code=bytes.readInt();var activated=error_code==0;if(activated){var dti=new DressTimeInfo;dti.dressId=bytes.readInt();dti.invalidtime=bytes.readInt();dti.lv=bytes.readInt();dti.trival=bytes.readInt();this.timeInfo[dti.dressId]=dti;this.postPartsTransform(error_code,dti)}else{this.postPartsTransform(error_code,null)}};Dress.prototype.postPartsTransform=function(error_code,dti){};Dress.prototype.sendQueryBuyParts=function(zhuangban_id){var bytes=this.getBytes(9);bytes.writeInt(zhuangban_id);this.sendToServer(bytes)};Dress.prototype.doQueryBuyParts=function(bytes){var error_code=bytes.readInt();if(error_code==0||error_code==2){var zhuangban_id=bytes.readInt();var price=bytes.readInt();var parts_id=[];for(var i=0;i<7;++i){parts_id.push(bytes.readInt())}this.parts_info[zhuangban_id]={price:price,parts_id:parts_id};this.postQueryBuyParts()}else{UserTips.ins().showTips(i18n("Dress_6"))}};Dress.prototype.postQueryBuyParts=function(){};Dress.prototype.sendBuyParts=function(zhuangban_id){var bytes=this.getBytes(10);bytes.writeInt(zhuangban_id);this.sendToServer(bytes)};Dress.prototype.doBuyParts=function(bytes){var error_code=bytes.readInt();var zhuangban_id=bytes.readInt();var price=bytes.readInt();if(error_code==0){var dti=new DressTimeInfo;dti.dressId=bytes.readInt();dti.invalidtime=bytes.readInt();dti.lv=bytes.readInt();this.timeInfo[dti.dressId]=dti;this.dressUnlockable[dti.dressId]=false;this.postBuyParts()}else{if(error_code==1){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("Dress_7"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("Dress_8"))}else{UserTips.ins().showTips(i18n("Dress_9"))}}};Dress.prototype.postBuyParts=function(){};Dress.prototype.doDressRedpoint=function(bytes){var redNum=bytes.readInt();this.partDressRedNum=redNum};Dress.prototype.doTrialInvalid=function(bytes){var trialId=bytes.readShort();var pos=bytes.readByte();var job=bytes.readByte();ViewManager.ins().open(DressInvalidTipsWin,trialId,pos,job)};Dress.prototype.postRecycle=function(bytes){var id=bytes.readInt();return id};return Dress}(BaseSystem);__reflect(Dress.prototype,"Dress");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.dress=Dress.ins.bind(Dress)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var DressItemInfo=function(){function DressItemInfo(){this.isDress=false;this.lv=0;this.rank=0;this.trial=0}return DressItemInfo}();__reflect(DressItemInfo.prototype,"DressItemInfo");var DressPosInfo=function(){function DressPosInfo(){this.posAry=[]}return DressPosInfo}();__reflect(DressPosInfo.prototype,"DressPosInfo");var DressTimeInfo=function(){function DressTimeInfo(){}return DressTimeInfo}();__reflect(DressTimeInfo.prototype,"DressTimeInfo");var DressInvalidTipsWin=function(_super){__extends(DressInvalidTipsWin,_super);function DressInvalidTipsWin(){var _this=_super.call(this)||this;_this.trialId=1;_this.pos=1;_this.job=1;_this.skinName="DressInvalidTipsSkin";return _this}DressInvalidTipsWin.prototype.childrenCreated=function(){this.list.itemRenderer=DressPermanentItemRender;this._listDt=new eui.ArrayCollection;this.list.dataProvider=this._listDt;var data=[];var cfg=GlobalConfig.ZhuangBanTrial[this.trialId];for(var pos=1;pos<=3;pos++){var dressID=cfg[pos].dressID;var id=dressID[this.job-1];var desc=cfg[pos].desc;var go=cfg[pos].go;data.push({id:id,desc:desc,go:go})}this._listDt.replaceAll(data);var bgMc=new MovieClip;bgMc.playFile(RES_DIR_EFF+"18jikqi_eff",-1);this.bgAniGroup.addChild(bgMc)};DressInvalidTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.trialId=param[0];this.pos=param[1];this.job=param[2];this.showMC();this.addTouchEndEvent(this.bgClose,this.otherClose)};DressInvalidTipsWin.prototype.close=function(){if(this._body){this._body.removeEventListener(egret.Event.CHANGE,null,null)}this.removeTouchEvent(this.bgClose,this.otherClose)};DressInvalidTipsWin.prototype.showMC=function(){this.bodyImg.source=null;this.weaponImg.source=null;this.wingImg.source=null;var bodyId=GlobalConfig.ZhuangBanTrial[this.trialId][1].dressID[this.job-1];var weaponId=GlobalConfig.ZhuangBanTrial[this.trialId][2].dressID[this.job-1];var wingId=GlobalConfig.ZhuangBanTrial[this.trialId][3].dressID[this.job-1];var bodyRes=getZhuangbanById(bodyId).res+"_c";var weaponRes=getZhuangbanById(weaponId).res+"_"+sexByJob(this.job)+"_c";var wingRes=getZhuangbanById(wingId).res;this._body=imageToMc(this.bodyImg,bodyRes,this.bodyMc);imageToMc(this.weaponImg,weaponRes,this.weaponMc,this._body);imageToMc(this.wingImg,wingRes,this.wingMc,this._body,RES_DIR_ROLE,false,true)};DressInvalidTipsWin.prototype.otherClose=function(){ViewManager.ins().close(this)};return DressInvalidTipsWin}(BaseEuiView);__reflect(DressInvalidTipsWin.prototype,"DressInvalidTipsWin");ViewManager.ins().reg(DressInvalidTipsWin,LayerManager.UI_Popup);var DressItemRenderer=function(_super){__extends(DressItemRenderer,_super);function DressItemRenderer(){var _this=_super.call(this)||this;_this.skinName="DressItemSkin";return _this}DressItemRenderer.prototype.dataChanged=function(){var config=this.data;if(config==null)return;this.redPoint0.visible=false;var id=config.zhuanban.cost["itemId"];if(config.lv){this.timelabel.visible=true;this.imgIcon.source=id+"_png"}else{this.timelabel.visible=false;this.imgIcon.source=id+"_png"}this.redPoint0.visible=Dress.ins().redPointDress(config.zhuanban.id);this.imageName.text=config.zhuanban.name;if(config.isDress)this.huanhuaImage.visible=true;else this.huanhuaImage.visible=false;this.updateTimer();if(config.lv>1){this.levellabel.text=i18n("DressItemRenderer_1",config.lv)}else{this.levellabel.text=i18n("DressItemRenderer_2")}this.imgBg.source="quality"+config.rank;this.equipEffect.removeChildren();this.EquipEffect=this.EquipEffect||new MovieClip;this.EquipEffect.touchEnabled=false;this.EquipEffect.x=this.equipEffect.width/2;this.EquipEffect.y=this.equipEffect.height/2;this.EquipEffect.scaleX=this.equipEffect.width/76;this.EquipEffect.scaleY=this.equipEffect.height/76;var effectName="";if(config.rank==3){effectName="quality3_eff";this.EquipEffect.scaleX=this.equipEffect.width/76*1.1;this.EquipEffect.scaleY=this.equipEffect.height/76*1.1}else if(config.rank==4){effectName="quality4_eff";this.EquipEffect.scaleX=this.equipEffect.width/76*1.1;this.EquipEffect.scaleY=this.equipEffect.height/76*1.1}else if(config.rank==5){effectName="chuanqizbeff";this.EquipEffect.scaleX=this.equipEffect.width/76*1.1;this.EquipEffect.scaleY=this.equipEffect.height/76*1.1}if(effectName){this.equipEffect.addChild(this.EquipEffect);this.EquipEffect.playFile(RES_DIR_EFF+effectName,-1)}};DressItemRenderer.prototype.updateTimer=function(){var config=this.data;if(config==null)return;var zhuanban=config.zhuanban;var id=zhuanban.id;var tryOn=GlobalConfig.ZhuangBanId[id].tryOn||null;var level=tryOn&&tryOn.level||0;var timer=config.timer;if(config.timer==0){this.timelabel.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor(i18n("DressItemRenderer_0"),16317955))}if(config.timer>0){if(level>0){this.timelabel.text=i18n("DressItemRenderer_3",level)}else{var str="";var endTimer=(DateUtils.formatMiniDateTime(timer)-GameServer.serverTime)/1e3;if(endTimer>=0)str=DateUtils.getFormatBySecond(endTimer,5,2);this.timelabel.text=str}}else{this.timelabel.visible=false}};Object.defineProperty(DressItemRenderer.prototype,"selected",{set:function(value){this.selectImage.visible=value},enumerable:true,configurable:true});return DressItemRenderer}(eui.ItemRenderer);__reflect(DressItemRenderer.prototype,"DressItemRenderer");var DressPart=function(_super){__extends(DressPart,_super);function DressPart(){return _super!==null&&_super.apply(this,arguments)||this}DressPart.prototype.setInfo=function(activated,partItemId){this.currentState=activated?"got":"empty";this.itemCfg=GlobalConfig.ItemConfig[partItemId];this.imgIcon.source=this.itemCfg.icon.toString()+"_png";this.removeTouchEvent(this,this.onTap);this.addTouchEvent(this,this.onTap)};DressPart.prototype.onTap=function(){ViewManager.ins().open(EquipDetailedWin,1,undefined,this.itemCfg.id)};return DressPart}(BaseView);__reflect(DressPart.prototype,"DressPart");var DressPermanentItemRender=function(_super){__extends(DressPermanentItemRender,_super);function DressPermanentItemRender(){var _this=_super.call(this)||this;_this.skinName="DressPermanentItemSkin";_this.btnGo.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onClick,_this);return _this}DressPermanentItemRender.prototype.dataChanged=function(){if(!this.data){return}var id=this.data.id;var desc=this.data.desc;var cfg=GlobalConfig.ZhuangBanId[id];var name=cfg.name;this.dressName.text=name;this.gainWay.text=desc};DressPermanentItemRender.prototype.onClick=function(){if(!this.data){return}var go=this.data.go;ViewManager.ins().close(DressInvalidTipsWin);ViewManager.ins().open(go[0],go[1]||0)};return DressPermanentItemRender}(BaseItemRender);__reflect(DressPermanentItemRender.prototype,"DressPermanentItemRender");var DressTryTipsWin=function(_super){__extends(DressTryTipsWin,_super);function DressTryTipsWin(){var _this=_super.call(this)||this;_this.trialId=1;_this.job=1;_this.time=10;_this.skinName="DressTryTipsSkin";return _this}DressTryTipsWin.prototype.childrenCreated=function(){var data=[];var cfg=GlobalConfig.ZhuangBanTrial[this.trialId];var power=0;this.job=SubRoles.ins().getFirstJob();for(var pos=1;pos<=3;pos++){var dressID=cfg[pos].dressID;var id=dressID[this.job-1];data.push({id:id,wear:false});var attr=GlobalConfig.ZhuangBanId[id].attr;var p=UserBag.getAttrPower(AttributeData.transformAttr(attr));power+=p}this.data=data;this.power0.text=""+power;var bgMc=new MovieClip;bgMc.playFile(RES_DIR_EFF+"18jikqi_eff",-1);this.bgAniGroup.addChild(bgMc);var mcPower=new MovieClip;mcPower.playFile("resource/res/eff/sjxb_zdleff",-1);this.grpPower0.addChild(mcPower);this.list.itemRenderer=ItemBase};DressTryTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.tick=this.time;this.timeLable.text=i18n("newBoxWin_0",this.time);if(!TimerManager.ins().isExists(this.updateTime,this)){this.tick=this.time;TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}this.showMC();this.observe(Dress.ins().postJiHuo,this.wear,this);this.addTouchEndEvent(this.oneKeyChange,this.oneKeyChanged);this.showItem()};DressTryTipsWin.prototype.showItem=function(){var data=[];var items=[1016002,1016003,1016004];for(var i=0;i<3;i++){var r=new RewardData;r.id=items[i];r.count=1;r.type=1;data.push(r)}this.list.dataProvider=new eui.ArrayCollection(data)};DressTryTipsWin.prototype.updateTime=function(){if(this.tick<=0){this.oneKeyChanged();return}this.timeLable.text=i18n("newBoxWin_0",this.tick);this.tick--};DressTryTipsWin.prototype.close=function(){if(this._body){this._body.removeEventListener(egret.Event.CHANGE,null,null)}};DressTryTipsWin.prototype.oneKeyChanged=function(){for(var i=0;i<this.data.length;i++){var id=this.data[i].id;Dress.ins().sendDressActivationReq(id,1)}this.otherClose()};DressTryTipsWin.prototype.wear=function(id){Dress.ins().sendDressUserReq(0,id);var allWeared=true;for(var _i=0,_a=this.data;_i<_a.length;_i++){var v=_a[_i];if(v.id==id){v["wear"]=true}if(v["wear"]==false){allWeared=false}}if(allWeared){this.otherClose()}};DressTryTipsWin.prototype.showMC=function(){this.bodyImg.source=null;this.weaponImg.source=null;this.wingImg.source=null;var bodyId=GlobalConfig.ZhuangBanTrial[this.trialId][1].dressID[this.job-1];var weaponId=GlobalConfig.ZhuangBanTrial[this.trialId][2].dressID[this.job-1];var wingId=GlobalConfig.ZhuangBanTrial[this.trialId][3].dressID[this.job-1];var bodyRes=getZhuangbanById(bodyId).res+"_c";var weaponRes=getZhuangbanById(weaponId).res+"_"+sexByJob(this.job)+"_c";var wingRes=getZhuangbanById(wingId).res;this._body=imageToMc(this.bodyImg,bodyRes,this.bodyMc);imageToMc(this.weaponImg,weaponRes,this.weaponMc,this._body);imageToMc(this.wingImg,wingRes,this.wingMc,this._body,RES_DIR_ROLE,false,true)};DressTryTipsWin.prototype.otherClose=function(){TimerManager.ins().removeAll(this);ViewManager.ins().close(this)};return DressTryTipsWin}(BaseEuiView);__reflect(DressTryTipsWin.prototype,"DressTryTipsWin");ViewManager.ins().reg(DressTryTipsWin,LayerManager.UI_Popup);var DressWin=function(_super){__extends(DressWin,_super);function DressWin(){var _this=_super.call(this)||this;_this.listId=-1;_this.listId2=-1;_this.needScroll=true;_this.trival=0;_this.isNotMove=true;_this.lastRole=-1;_this.lastIndex=-1;_this.scolledToRedPoint0=false;_this.scolledToRedPoint1=false;_this.scolledToRedPoint2=false;_this.collectionID=-1;_this.skinName="DressSkin";_this.isTopLevel=true;return _this}DressWin.prototype.childrenCreated=function(){this.init()};DressWin.prototype.init=function(){this.listInfo=[];this.arry=new eui.ArrayCollection(this.listInfo);this.list.itemRenderer=DressItemRenderer;this.list.dataProvider=this.arry;this.titleList.itemRenderer=TitleItem;var arr=[];arr=CommonUtils.copyDataHandler(GlobalConfig.ZhuangBanConfig.zhuangbanpos);arr.push(i18n("DressWin_0"));arr.push(i18n("DressWin_1"));this.tab.dataProvider=new eui.ArrayCollection(arr);var mc=new MovieClip;mc.playFile(RES_DIR_EFF+"actIconCircle",-1);this.dcMcGroup.addChild(mc);TimerManager.ins().doTimer(1e3,0,this.updateTime,this)};DressWin.prototype.updateTime=function(){for(var i=0;i<this.arry.length;i++){var item=this.list.getVirtualElementAt(i);if(item){item.updateTimer()}}};DressWin.prototype.open=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curRole=param[0]||0;if(param[1]!=undefined){this.lastIndex=this.selectIndex=parseInt(param[1]+"");this.tab.selectedIndex=this.selectIndex}this.listId2=param[2]||-1;this.needScroll=!(param[3]||false);this.trival=param[4]||0;this.list.selectedIndex=-1;this.roleSelect.setCurRole(this.curRole);this.roleSelect0.setCurRole(this.curRole);MessageCenter.ins().addListener(Title.TITLE_WIN_REFLASH_PANEL,function(obj,param){if(obj.itemIndex==Title.ins().list.length-1){var itemHeight=Title.EXPAND_HEIGHT-Title.SIMLPE_HEIGHT;if(param=="expand"){_this.titleList.scrollV=_this.titleList.contentHeight-_this.titleList.height+itemHeight}else{_this.titleList.scrollV=_this.titleList.contentHeight-_this.titleList.height-itemHeight}_this.titleList.validateNow()}},this);this.observe(Dress.ins().postDressInfo,this.update);this.observe(Dress.ins().postBuyParts,this.update);this.observe(Dress.ins().postJiHuo,this.onJihuo);this.observe(Dress.ins().postQueryBuyParts,this.onQueryBuyParts);this.observe(Dress.ins().postBuyParts,this.onBuyParts);this.observe(Dress.ins().postRecycle,this.update);this.observe(GameLogic.ins().postSubRoleChange,this.getDressInfo);this.observe(UserBag.ins().postItemAdd,this.checkPoint);this.observe(UserBag.ins().postItemDel,this.checkPoint);this.observe(UserBag.ins().postItemCountChange,this.checkPoint);this.observe(Actor.ins().postPowerChange,this.refreshPower);this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.help,this.onClick);this.addTouchEvent(this.itemName,this.onClick);this.addTouchEvent(this.list,this.listTap);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangeEvent(this.roleSelect,this.onChange);this.addChangeEvent(this.roleSelect0,this.onChange);this.addTouchEvent(this.dressBtn,this.onClick);this.addTouchEvent(this.dressBtn2,this.onClick);this.addTouchEvent(this.buyBtn,this.onBuyBtn);this.addTouchEvent(this.btnDressCollection,this.onDcBtn);this.observe(Title.ins().postListUpdate,this.updateList);this.observe(Title.ins().postTitleShow,this.updateShow);this.observe(Title.ins().postUseTitle,this.useTitle);this.observe(DressCollectionMgr.ins().postDressCollectionInfo,this.onDS);this.list.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this);this.list.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this);this.list.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this);this.titleList.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this);this.titleList.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this);this.titleList.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this);this.titleGroup.visible=false;this.dressGroup.visible=true;this.changeRole();this.getDressInfo();if(this.lastIndex>=0){this.setSelectedIndex(this.lastIndex)}this.checkPoint()};DressWin.prototype.onDS=function(){this.checkPoint();this.redPoint()};DressWin.prototype.refreshPower=function(){this.roleSelect.refreshPower(this.roleSelect._curRole)};DressWin.prototype.checkPoint=function(){if(!this.redPoint4){return}this.redPoint4.visible=SwordSkinMgr.ins().showRedPoint();this.redPoint5.visible=DressCollectionMgr.ins().canActivate(this.roleSelect._curRole);var dc=Setting.ins().getValue(ClientSet.dcMc,0);this.dcMcGroup.visible=this.redPoint5.visible||dc==0};DressWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this);this.list.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this);this.list.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this);this.titleList.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this);this.titleList.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this);this.titleList.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this);this.lastWing=0;this.lastWeapon=0;this.lastBody=0;WatcherUtil.removeFromArrayCollection(this.titleList.dataProvider);this.titleList.dataProvider=null;ViewManager.ins().close(SwordSkinWin);DressGuideMgr.ins().toStep(3);TimerManager.ins().remove(this.updateTime,this)};DressWin.prototype.listSelectIndex=function(id){if(id==-1)return-1;var index=0;for(var key in this.listInfo){if(this.listInfo.hasOwnProperty(key)){var element=this.listInfo[key];if(element.zhuanban.id==id){break}}index++}return index};DressWin.prototype.onTouch=function(e){if(e.type==egret.TouchEvent.TOUCH_BEGIN){this.roleSelect.parent.touchEnabled=false;this.roleSelect0.parent.touchEnabled=false}else{this.roleSelect.parent.touchEnabled=true;this.roleSelect0.parent.touchEnabled=true}};DressWin.prototype.getDressInfo=function(){Dress.ins().sendDressInfoReq()};DressWin.prototype.onChange=function(e){this.listId=this.changeId();this.listId2=-1;this.needScroll=true;switch(e.target){case this.roleSelect:if(this.lastRole==this.roleSelect.getCurRole())return;this.changeRole();break;case this.roleSelect0:if(this.lastRole==this.roleSelect0.getCurRole())return;Title.ins().curSelectRole=this.lastRole=this.roleSelect0.getCurRole();if(Title.ins().list==null)Title.ins().sendGetList();else this.updateList();break}};DressWin.prototype.changeId=function(id){if(id===void 0){id=null}if(!id){id=this.dress&&this.dress.zhuanban&&this.dress.zhuanban.id}if(id&&id>-1){var cfg=GlobalConfig.ZhuangBanId[id];var sort=cfg.sort;var pos=cfg.pos;this.curRole=this.roleSelect.getCurRole();var role=SubRoles.ins().getSubRoleByIndex(this.curRole);var job=role.job;for(var i in GlobalConfig.ZhuangBanId){var v=GlobalConfig.ZhuangBanId[i];if(v.sort==sort&&v.roletype==job&&v.pos==pos&&(v.isShow==1||Setting.ins().getValue(ClientSet.showAllDress)==1)){return v.id}}}else{return-1}};DressWin.prototype.listTap=function(e){var list=e.currentTarget;var i=list.selectedIndex;var item=list.getVirtualElementAt(i);if(!item||!item.data)return;this.onInfoUpdate(item.data)};DressWin.prototype.changeRole=function(){this.curRole=this.roleSelect.getCurRole();this.lastWeapon=this.changeId(this.lastWeapon);this.lastBody=this.changeId(this.lastBody);this.lastWing=this.changeId(this.lastWing);this.lastRole=this.curRole;this.update();this.checkPoint()};DressWin.prototype.careerRedPoint=function(){var redPoint=Dress.ins().posRedPoint();for(var i=0;i<3;i++){this["redPoint"+i].visible=redPoint[i]}};DressWin.prototype.onTabTouch=function(e){var sro=this.list.parent;sro.stopAnimation();this.list.scrollH=0;this.listId=this.changeId();this.listId2=-1;this.needScroll=true;this.selectIndex=e.currentTarget.selectedIndex;this.setSelectedIndex(this.selectIndex)};DressWin.prototype.setSelectedIndex=function(index){if(this.lastIndex==this.selectIndex){return}ViewManager.ins().close(SwordSkinWin);this.lastIndex=this.selectIndex;if(this.selectIndex<this.tab.dataProvider.length-2){this.dressGroup.visible=true;this.roleSelect.setState("noPower");this.titleGroup.visible=false;this.update()}else if(this.selectIndex==this.tab.dataProvider.length-2){this.dressGroup.visible=false;this.titleGroup.visible=true;Title.ins().curSelectRole=0;this.roleSelect.setState("nohead");if(Title.ins().list==null)Title.ins().sendGetList();else this.updateList()}else if(this.selectIndex==this.tab.dataProvider.length-1){this.dressGroup.visible=false;this.roleSelect.setState("nohead");this.titleGroup.visible=false;ViewManager.ins().open(SwordSkinWin,function(){ViewManager.ins().close(DressWin)},this.roleSelect._curRole)}};DressWin.prototype.update=function(){if(this.curRole==null)this.curRole=0;if(this.selectIndex==null)this.selectIndex=0;var model=Dress.ins();this.listInfo=[];for(var k in GlobalConfig.ZhuangBanId){if(SubRoles.ins().getSubRoleByIndex(this.curRole).job==GlobalConfig.ZhuangBanId[k].roletype&&this.selectIndex+1==GlobalConfig.ZhuangBanId[k].pos){var info_1=new DressItemInfo;info_1.zhuanban=GlobalConfig.ZhuangBanId[k];info_1.lv=0;info_1.rank=GlobalConfig.ZhuangBanId[k].rank;var id=info_1.zhuanban.id;if(model.timeInfo[id]){info_1.timer=model.timeInfo[id].invalidtime;info_1.lv=model.timeInfo[id].lv;info_1.trial=model.timeInfo[id].trival}if(model.posInfo.length>this.curRole&&id==model.posInfo[this.curRole].posAry[this.selectIndex])info_1.isDress=true;if(GlobalConfig.ZhuangBanId[k].isShow==1||Setting.ins().getValue(ClientSet.showAllDress)==1)this.listInfo.push(info_1)}}this.listInfo.sort(this.sortList);this.arry.replaceAll(this.listInfo);this.list.dataProvider=this.arry;this.redPoint();this.careerRedPoint();if(!this["scolledToRedPoint"+this.selectIndex]&&this.needScroll){this["scolledToRedPoint"+this.selectIndex]=true;for(var i=0,c=this.listInfo.length;i<c;++i){var info=this.listInfo[i];if(Dress.ins().redPointDress(info.zhuanban.id)){this.listId=info.zhuanban.id;break}}}if(this.selectIndex==0&&this.lastBody&&this.lastBody>-1){this.listId=this.lastBody}if(this.selectIndex==1&&this.lastWeapon&&this.lastWeapon>-1){this.listId=this.lastWeapon}if(this.selectIndex==2&&this.lastWing&&this.lastWing>-1){this.listId=this.lastWing}var equip=Dress.ins().getModelPosId(this.curRole);if(this.selectIndex==0&&equip&&equip.posAry[0]&&this.listId==-1){this.listId=equip.posAry[0]}if(this.selectIndex==1&&equip&&equip.posAry[1]&&this.listId==-1){this.listId=equip.posAry[1]}if(this.selectIndex==2&&equip&&equip.posAry[2]&&this.listId==-1){this.listId=equip.posAry[2]}if(this.listId2&&this.listId2!=-1){this.listId=this.listId2}this.list.selectedIndex=-1;if(this.listId&&this.listId!=-1){var index=this.listSelectIndex(this.listId);this.list.selectedIndex=index;var max=this.listInfo.length*110-520;max=max<0?0:max;var min=Math.min(max,110*index);this.list.scrollH=min}else{this.list.scrollH=0}if(this.list.selectedIndex>-1){var item=this.list.getVirtualElementAt(this.list.selectedIndex);if(!item||!item.data){this.onInfoUpdate()}else{this.onInfoUpdate(item.data)}}else{this.onInfoUpdate()}};DressWin.prototype.sortList=function(a,b){if(a.zhuanban.sort<b.zhuanban.sort)return-1;if(a.zhuanban.sort>b.zhuanban.sort)return 1;return 0};DressWin.prototype.redPoint=function(){for(var i=0;i<SubRoles.ins().subRolesLen;i++){var isOpen=Dress.ins().canDress(SubRoles.ins().getSubRoleByIndex(i).job,this.tab.selectedIndex+1);var ds=DressCollectionMgr.ins().canActivate(i);this.roleSelect.showRedPoint(i,isOpen||ds)}};DressWin.prototype.setItemName=function(){var str;if(UserBag.ins().getBagGoodsCountById(0,this.id)>=this.num){str="<font color = '#23C42A'><u>"+GlobalConfig.ItemConfig[this.id].name+"×"+this.num+"</u></font>";this.redPoint6.visible=true}else{str="<font color = '#f3311e'><u>"+GlobalConfig.ItemConfig[this.id].name+"×"+this.num+"</u></font>";this.redPoint6.visible=false}this.itemName.textFlow=(new egret.HtmlTextParser).parser(str)};DressWin.prototype.onInfoUpdate=function(data){if(data===void 0){data=null}if(data==null){this.dress=null;this.powerPanel.setPower(0);this.buyGroup.visible=false;this.redPoint6.visible=false}else{this.dress=data}this.attrLv1.visible=true;this.attrLv1.text="";this.attrLv2.visible=true;this.attrLv2.text="";if(this.dress){this.selectGroup.visible=true;var attr=this.dress.zhuanban.attr;if(this.dress.lv>1){var config=GlobalConfig.ZhuangBanLevelUp[this.dress.zhuanban.id][this.dress.lv];attr=AttributeData.AttrAddition(attr,config.attr)}var zbCfg=GlobalConfig.ZhuangBanId[this.dress.zhuanban.id];if(zbCfg.helmet!=null&&zbCfg.helmet!=""){this.partGroup.visible=true;this.partsBuyPrice=null;this.parts_id=null;this.refreshParts();Dress.ins().sendQueryBuyParts(this.dress.zhuanban.id)}else{this.partGroup.visible=false}var attrstr=AttributeData.getAttStr(AttributeData.transformAttr(attr),0,1,":");var attrlines=attrstr.split("\n");var attrLabelStrs=["",""];for(var i=0,c=attrlines.length;i<c;++i){var line=attrlines[i];attrLabelStrs[i%2]+=line+"\n"}for(var i=0;i<2;++i){if(attrLabelStrs[i].length>0){attrLabelStrs[i]=attrLabelStrs[i].substr(0,attrLabelStrs[i].length-1)}}this.attrLabel1.text=attrLabelStrs[0];this.attrLabel2.text=attrLabelStrs[1];var desc=this.getSlotDesc(this.dress.zhuanban.id);this.attrLabel3.text=desc?desc:"";if(this.dress.zhuanban.wing_attr_per>0){this.attrLabel3.text+=(this.attrLabel3.text.length>0?"\n":"")+i18n("DressWin_2",Math.floor(this.dress.zhuanban.wing_attr_per/100));var lvAttrs=[];var wingData=SubRoles.ins().getSubRoleByIndex(this.curRole).wingsData;var wingLv=wingData?wingData.lv:0;wingLv=wingLv>=0?wingLv:0;var tempConfig=GlobalConfig.WingLevelConfig[wingLv].attr;var len=tempConfig.length;for(var i_13=0;i_13<len;i_13++)lvAttrs.push(new AttributeData(tempConfig[i_13].type,Math.floor(tempConfig[i_13].value*this.dress.zhuanban.wing_attr_per/1e4)));attr=AttributeData.AttrAddition(attr,lvAttrs)}if(this.isCanLevelUp(this.dress)&&!this.isMaxLevel(this.dress)){var nextLv=this.dress.lv+1;var conf=GlobalConfig.ZhuangBanLevelUp[this.dress.zhuanban.id];var attr1=conf[nextLv].attr;if(conf[this.dress.lv]){attr1=AttributeData.AttrDel(attr1,conf[this.dress.lv].attr)}var strs=["",""];for(var i_14=0;i_14<attr1.length;i_14++){strs[i_14%2]+=i18n("DressWin_3",attr1[i_14].value)}for(var i=0;i<2;++i){if(strs[i].length>0){strs[i]=strs[i].substr(0,strs[i].length-1)}}this.attrLv1.text=strs[0];this.attrLv2.text=strs[1]}var power=UserBag.getAttrPower(AttributeData.transformAttr(attr));power+=this.dress.zhuanban.exPower?this.dress.zhuanban.exPower:0;this.powerPanel.setPower(power);this.namelabel.visible=false;this.itemName.visible=false;this.dressName.text=i18n("DressWin_4")+this.dress.zhuanban.name;this.dressBtn.enabled=true;var cfg=GlobalConfig.ZhuangBanId[this.dress.zhuanban.id];if(this.dress.lv&&this.dress.trial||!this.dress.lv){if(cfg.tryOn){var t=cfg.tryOn.item;var c=this.dress.zhuanban.cost["itemId"];var num=this.dress.zhuanban.cost["num"];var isHaveT=UserBag.ins().getBagGoodsCountById(0,t);var isHaveC=UserBag.ins().getBagGoodsCountById(0,c);if(isHaveC<num&&isHaveT>0){this.trival=this.dress.zhuanban.id}}}this.redPoint6.visible=false;if(this.dress.lv){this.buyGroup.visible=false;this.itemGroup.visible=true;if(this.dress.trial>=1){if(this.dress.zhuanban.id==this.trival){this.dressBtn.label=i18n("DressWin_48");this.namelabel.visible=true;this.itemName.visible=true;this.dressBtn.visible=true;this.dressBtn2.visible=true;if(this.dress.isDress){this.dressBtn2.label=i18n("DressWin_9")}else{this.dressBtn2.label=i18n("DressWin_10")}this.id=GlobalConfig.ZhuangBanId[this.dress.zhuanban.id].tryOn.item;this.num=1;this.setItemName()}else{this.namelabel.visible=true;this.itemName.visible=true;this.dressBtn.visible=true;this.dressBtn2.visible=true;this.dressBtn.label=i18n("DressWin_11");this.id=this.dress.zhuanban.cost["itemId"];this.num=this.dress.zhuanban.cost["num"];if(this.dress.isDress){this.dressBtn2.label=i18n("DressWin_5")}else{this.dressBtn2.label=i18n("DressWin_6")}this.setItemName()}}else{if(!this.isCanLevelUp(this.dress)){this.namelabel.visible=false;this.itemName.visible=false;this.dressBtn.visible=true;this.dressBtn2.visible=false;if(this.dress.isDress){this.dressBtn.label=i18n("DressWin_5")}else{this.dressBtn.label=i18n("DressWin_6")}this.redPoint6.visible=false}else{this.dressBtn.visible=true;this.dressBtn2.visible=true;if(this.isMaxLevel(this.dress)){this.namelabel.visible=false;this.itemName.visible=false;this.dressBtn.label=i18n("DressWin_7");this.dressBtn.enabled=false;this.redPoint6.visible=false}else{this.namelabel.visible=true;this.itemName.visible=true;this.dressBtn.label=i18n("DressWin_8");var nextLv=this.dress.lv+1;var config=GlobalConfig.ZhuangBanLevelUp[this.dress.zhuanban.id][nextLv];this.id=config.cost["itemId"];this.num=config.cost["num"];this.setItemName()}if(this.dress.isDress){this.dressBtn2.label=i18n("DressWin_9")}else{this.dressBtn2.label=i18n("DressWin_10")}}}}else{this.namelabel.visible=true;this.itemName.visible=true;this.dressBtn2.visible=false;if(this.trival==this.dress.zhuanban.id){this.dressBtn.label=i18n("DressWin_48");this.id=GlobalConfig.ZhuangBanId[this.dress.zhuanban.id].tryOn.item;this.num=1}else{this.dressBtn.label=i18n("DressWin_11");this.id=this.dress.zhuanban.cost["itemId"];this.num=this.dress.zhuanban.cost["num"]}this.buyGroup.visible=this.dress.zhuanban.activation==1;this.dressBtn.visible=this.dress.zhuanban.activation!=1;if(this.id==null||this.dress.zhuanban.activation==1){this.itemGroup.visible=false}else{this.itemGroup.visible=true;this.setItemName()}}this.onupdateEquip(false)}else{this.selectGroup.visible=false;this.partGroup.visible=false;this.onupdateEquip(true)}};DressWin.prototype.refreshParts=function(){var parts=this.parts;if(parts==null){parts=[this.part1,this.part2,this.part3,this.part4,this.part5,this.part6,this.part7];this.parts=parts}var conf=GlobalConfig.ZhuangBanId[this.dress.zhuanban.id];var partIds=[conf.helmet,conf.clothes,conf.necklace,conf.bracelet,conf.belt,conf.ring,conf.shoes];if(this.partsBuyPrice>0){var str=i18n("DressWin_45")+16172614+"&T:"+this.partsBuyPrice+i18n("DressWin_46")+1700253+i18n("DressWin_12");this.labelBuyPrice.textFlow=TextFlowMaker.generateTextFlow1(str);this.groupBuyPrice.visible=true;this.redPointBuyBtn.visible=false}else if(this.partsBuyPrice==0){this.groupBuyPrice.visible=false;this.redPointBuyBtn.visible=true}else{this.groupBuyPrice.visible=false;this.redPointBuyBtn.visible=false}for(var i=0,c=parts.length;i<c;++i){var part=parts[i];var partId=partIds[i];var curId=partId[0];var activated=false;if(this.parts_id){activated=this.parts_id[i]!=0;if(activated){curId=this.parts_id[i]}}part.setInfo(activated,curId)}};DressWin.prototype.isCanLevelUp=function(info){var id=info.zhuanban.id;if(GlobalConfig.ZhuangBanLevelUp[id])return true;return false};DressWin.prototype.isMaxLevel=function(info){var nextLv=info.lv+1;var id=info.zhuanban.id;if(GlobalConfig.ZhuangBanLevelUp[id]&&GlobalConfig.ZhuangBanLevelUp[id][nextLv])return false;return true};DressWin.prototype.onupdateEquip=function(isshowjichu){if(isshowjichu===void 0){isshowjichu=false}var model=SubRoles.ins().getSubRoleByIndex(this.curRole);var info=Dress.ins().getModelPosId(this.curRole);var wingId=0;if(!info||!info.posAry||info.posAry.length<=0){debug.log(this.listInfo);var tempInfo=this.listInfo[0];if(tempInfo.zhuanban.pos==1){this.setEquip(model,tempInfo.zhuanban.id,this.lastWeapon);this.lastBody=tempInfo.zhuanban.id}else if(tempInfo.zhuanban.pos==2){this.setEquip(model,this.lastBody,tempInfo.zhuanban.id);this.lastWeapon=tempInfo.zhuanban.id}else{wingId=tempInfo.zhuanban.id;this.lastWing=tempInfo.zhuanban.id}this.collectionID=DressCollectionMgr.ins().dressIDtoCID(tempInfo.zhuanban.id);debug.log(i18n("DressWin_13"));return}if(isshowjichu){this.setEquip(model,info.posAry[0],info.posAry[1]);wingId=info.posAry[2];var id0=DressCollectionMgr.ins().dressIDtoCID(info.posAry[0]);var id1=DressCollectionMgr.ins().dressIDtoCID(info.posAry[1]);var id2=DressCollectionMgr.ins().dressIDtoCID(info.posAry[2]);if(id0>-1){this.collectionID=id0}else if(id1>-1){this.collectionID=id1}else if(id2>-1){this.collectionID=id2}}else{if(this.dress.zhuanban.pos==3){this.setEquip(model,this.lastBody||info.posAry[0],this.lastWeapon||info.posAry[1]);wingId=this.dress.zhuanban.id;this.lastWing=this.dress.zhuanban.id}else if(this.dress.zhuanban.pos==1){this.setEquip(model,this.dress.zhuanban.id,this.lastWeapon||info.posAry[1]);this.lastBody=this.dress.zhuanban.id}else{this.setEquip(model,this.lastBody||info.posAry[0],this.dress.zhuanban.id);this.lastWeapon=this.dress.zhuanban.id}this.collectionID=DressCollectionMgr.ins().dressIDtoCID(this.dress.zhuanban.id)}this.setWing(wingId);this.btnDressCollection.visible=true};DressWin.prototype.setWing=function(wingId){var wingdata=SubRoles.ins().getSubRoleByIndex(this.curRole).wingsData;var id=SubRoles.ins().getSubRoleByIndex(this.curRole).zhuangbei[2];var source="";if(wingId>0){source=getZhuangbanById(wingId).res}else if(this.lastWing&&this.lastWing>-1){source=getZhuangbanById(this.lastWing).res}else if(id>0){source=GlobalConfig.ZhuangBanId[id].res}else if(wingdata.openStatus){source=GlobalConfig.WingLevelConfig[wingdata.lv].appearance}else{source=""}imageToMc(this.wingImg,source,this.wingMc,this._body)};DressWin.prototype.setEquip=function(role,bodyId,weaponId){if(!role)return;var equipData=role.equipsData;var isHaveBody;var weaponRes="";var bodyRes="";for(var i=0;i<equipData.length;i++){var element=equipData[i];if(i==0||i==2){var id=equipData[i].item.configID;if(id>0){var fileName=GlobalConfig.EquipConfig[id].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}if(i==0){weaponRes=fileName+"_"+role.sex+"_c"}else{if(fileName.indexOf("903")>0){bodyRes=fileName+"_"+role.sex+"_c"}else{bodyRes=fileName+"_c"}isHaveBody=true}}}}if(!isHaveBody){bodyRes=getDefaultBody(role.job)+"_c"}if(weaponId>0){weaponRes=getZhuangbanById(weaponId).res+"_"+role.sex+"_c"}if(bodyId>0){bodyRes=getZhuangbanById(bodyId).res+"_c"}this._body=imageToMc(this.bodyImg,bodyRes,this.bodyMc);imageToMc(this.weaponImg,weaponRes,this.weaponMc,this._body)};DressWin.prototype.onJihuo=function(){this.trival=0;Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id)};DressWin.prototype.onQueryBuyParts=function(){if(!this.dress){return}if(!this.dress.zhuanban){return}var parts_info=Dress.ins().parts_info[this.dress.zhuanban.id];if(parts_info){this.partsBuyPrice=parts_info.price;this.parts_id=parts_info.parts_id;this.refreshParts()}};DressWin.prototype.onBuyParts=function(){if(this.dress&&this.dress.zhuanban){var dti=Dress.ins().timeInfo[this.dress.zhuanban.id];if(dti){this.dress.lv=dti.lv;this.dress.timer=dti.invalidtime;this.onInfoUpdate(this.dress);Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id)}}};DressWin.prototype.onBuyBtn=function(){var msg;if(this.partsBuyPrice==0){var curRole=this.lastRole!=null?this.lastRole:this.curRole;var job=SubRoles.ins().roles[curRole].job;var jobs=["",i18n("DressWin_14"),i18n("DressWin_15"),i18n("DressWin_16")];var zhuangbanName=this.dress.zhuanban.name;msg=i18n("DressWin_17")+296532+"&T:"+jobs[job]+i18n("DressWin_18")+zhuangbanName+i18n("DressWin_19")}else{msg=i18n("DressWin_20")+13539857+"&T:"+this.partsBuyPrice+i18n("DressWin_47")+296532+i18n("DressWin_21")}WarnWin.show(msg,function(){Dress.ins().sendBuyParts(this.dress.zhuanban.id)},this,function(){},this,"normal")};DressWin.prototype.onDcBtn=function(){Setting.ins().setValue(ClientSet.dcMc,1);ViewManager.ins().open(DressCollectionWin,this.collectionID,this.curRole);this.checkPoint()};DressWin.prototype.onClick=function(e){var _this=this;switch(e.target){case this.closeBtn:ViewManager.ins().close(DressWin);break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,9);break;case this.itemName:var itemconfig=GlobalConfig.ItemConfig[this.id];var type=ItemConfig.getType(itemconfig);if(itemconfig!=undefined&&itemconfig&&type!=undefined){if(type==0||type==4){ViewManager.ins().open(EquipDetailedWin,1,undefined,itemconfig.id)}else{ViewManager.ins().open(ItemDetailedWin,0,itemconfig.id)}}break;case this.dressBtn2:if(this.dressBtn2.label==i18n("DressWin_22")){Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id)}else{Dress.ins().sendUnDressUserReq(this.curRole,this.dress.zhuanban.id)}break;case this.dressBtn:if(!this.dress||!this.dress.zhuanban){debug.log(DressWin,"DressWin　　"+this.dress+" ++++++ ");return}if(this.dressBtn.label==i18n("DressWin_23")||this.dressBtn.label==i18n("DressWin_48")){if(UserBag.ins().getBagGoodsCountById(0,this.id)<this.num){UserTips.ins().showTips(i18n("DressWin_24"));return}var jobNumberToName={0:i18n("DressWin_26"),1:i18n("DressWin_27"),2:i18n("DressWin_28"),3:i18n("DressWin_29")};var posAry=GlobalConfig.ZhuangBanConfig.zhuangbanpos;var trial_1=this.dressBtn.label==i18n("DressWin_48")?1:0;var str=i18n("DressWin_30",jobNumberToName[this.dress.zhuanban.roletype]+posAry[this.dress.zhuanban.pos-1],this.dress.zhuanban.name);if(trial_1==1){var lv=Actor.level;var tryOn=GlobalConfig.ZhuangBanId[this.dress.zhuanban.id].tryOn;var level=tryOn&&tryOn.level||0;if(level>0&&lv>=level){str+=i18n("DressWin_49")}else{var model=Dress.ins();var info=model.timeInfo[this.dress.zhuanban.id];var inTrial=info&&info.trival||0;if(inTrial>1){str+=i18n("DressWin_50")}}}WarnWin.show(str,function(){Dress.ins().sendDressActivationReq(_this.dress.zhuanban.id,trial_1)},this)}else if(this.dressBtn.label==i18n("DressWin_31")){Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id)}else if(this.dressBtn.label==i18n("DressWin_32")){if(UserBag.ins().getBagGoodsCountById(0,this.id)<this.num){UserTips.ins().showTips(i18n("DressWin_33"));return}Dress.ins().sendLevelUp(this.dress.zhuanban.id)}else if(this.dressBtn.label==i18n("DressWin_34")){Dress.ins().sendUnDressUserReq(this.curRole,this.dress.zhuanban.id)}break}};DressWin.prototype.useTitle=function(info){if(info.config.Id!=Title.ins().showTitleDic[Title.ins().curSelectRole]){if(!info.config.job||info.config.job==SubRoles.ins().getSubRoleByIndex(this.roleSelect.getCurRole()).job)Title.ins().setTitle(this.roleSelect0.getCurRole(),info.config.Id);else UserTips.ins().showTips(i18n("DressWin_35"))}else{Title.ins().setTitle(Title.ins().curSelectRole,0)}};DressWin.prototype.updateList=function(){this.titleList.dataProvider=Title.ins().list;Title.ins().list.refresh()};DressWin.prototype.updateShow=function(param){var roleIndex,titleID,lastID;roleIndex=param[0];titleID=param[1];lastID=param[2];if(titleID>0==lastID>0){this.updateItemByID(lastID);this.updateItemByID(titleID)}else{for(var id in Title.ins().timeDict){this.updateItemByID(Number(id))}}};DressWin.prototype.updateItemByID=function(titleID){if(!(titleID in Title.ins().infoDict))return;var info=Title.ins().infoDict[titleID];Title.ins().list.itemUpdated(info)};DressWin.prototype.getSlotDesc=function(id){var zbconfig=GlobalConfig.ZhuangBanId[id];if(!zbconfig||!zbconfig.attr_precent)return"";var str="";for(var i=0;i<zbconfig.attr_precent.length;i++){switch(zbconfig.attr_precent[i].pos){case EquipPos.WEAPON:str=i18n("DressWin_36");break;case EquipPos.HEAD:str=i18n("DressWin_37");break;case EquipPos.CLOTHES:str=i18n("DressWin_38");break;case EquipPos.NECKLACE:str=i18n("DressWin_39");break;case EquipPos.Wrist:str=i18n("DressWin_40");break;case EquipPos.BRACELET:str=i18n("DressWin_41");break;case EquipPos.RING:str=i18n("DressWin_42");break;case EquipPos.SHOE:str=i18n("DressWin_43");break}str+=i18n("DressWin_44",Math.floor(zbconfig.attr_precent[i].pre/100))}if(str){var index=str.lastIndexOf("\n");str=str.substring(0,index)}return str};return DressWin}(BaseEuiView);__reflect(DressWin.prototype,"DressWin");ViewManager.ins().reg(DressWin,LayerManager.UI_Main);var DressCollectionType;(function(DressCollectionType){DressCollectionType[DressCollectionType["NotActivate"]=0]="NotActivate";DressCollectionType[DressCollectionType["Activatable"]=1]="Activatable";DressCollectionType[DressCollectionType["Activated"]=2]="Activated"})(DressCollectionType||(DressCollectionType={}));window["DressCollectionType"]=DressCollectionType;var DressCollectionMgr=function(_super){__extends(DressCollectionMgr,_super);function DressCollectionMgr(){var _this=_super.call(this)||this;_this.collectionInfo={};_this.sysId=PackageID.DressCollection;_this.regNetMsg(1,_this.postDressCollectionInfo);_this.regNetMsg(2,_this.postDressCollectionActivate);_this.regNetMsg(3,_this.postDressCollectionWear);return _this}DressCollectionMgr.ins=function(){return _super.ins.call(this)};DressCollectionMgr.prototype.canActivate=function(roleId){if(roleId===void 0){roleId=-1}for(var k in GlobalConfig.DressCollectionConfig){var cid=GlobalConfig.DressCollectionConfig[k].id;var isShow=GlobalConfig.DressCollectionConfig[k].isShow;for(var i=0;i<SubRoles.ins().subRolesLen;i++){var role=SubRoles.ins().getSubRoleByIndex(i);var job=role.job||1;var isshow=isShow[job-1]==1||Setting.ins().getValue(ClientSet.showAllDress)==1;var state=this.getDressState(cid,i);if(state==DressCollectionType.Activatable&&isshow){if(roleId>-1){if(i==roleId){return true}}else{return true}}}}return false};DressCollectionMgr.prototype.canWear=function(id,roleId){var res=false;var state=this.getDressState(id,roleId);if(state==DressCollectionType.NotActivate){return res}var role=SubRoles.ins().getSubRoleByIndex(roleId);var zb=role.zhuangbei;var bodyId=zb[0];var weaponId=zb[1];var wingId=zb[2];var swordId=SwordSkinMgr.ins().getCurSkin(roleId+1);var bodyId2=this.getPartID(id,roleId,"clothes");var weaponId2=this.getPartID(id,roleId,"weapon");var wingId2=this.getPartID(id,roleId,"wing");var swordId2=this.getPartID(id,roleId,"sword");if(bodyId!=bodyId2&&bodyId2>0||weaponId!=weaponId2&&weaponId2>0||wingId!=wingId2&&wingId2>0||swordId!=swordId2&&swordId2>0){res=true}return res};DressCollectionMgr.prototype.getPartID=function(cid,roleId,part){if(part===void 0){part="clothes"}var partId=-1;var role=SubRoles.ins().getSubRoleByIndex(roleId);var job=role.job;switch(part){case"clothes":var clothes=GlobalConfig.DressCollectionConfig[cid].clothes;partId=clothes&&clothes[job-1]||-1;break;case"weapon":var weapon=GlobalConfig.DressCollectionConfig[cid].weapon;partId=weapon&&weapon[job-1]||-1;break;case"wing":var wing=GlobalConfig.DressCollectionConfig[cid].wing;partId=wing&&wing[job-1]||-1;break;case"sword":var sword=GlobalConfig.DressCollectionConfig[cid].sword;partId=sword&&sword[roleId]||-1;break}return partId};DressCollectionMgr.prototype.getPartCostID=function(id,roleId,part){if(part===void 0){part="clothes"}var itemid=0;if(part=="sword"){itemid=GlobalConfig.SwordSkinConfig[id].mat}else{itemid=GlobalConfig.ZhuangBanId[id].cost.itemId}return itemid};DressCollectionMgr.prototype.getPartName=function(id,roleId,part){if(part===void 0){part="clothes"}var name="";if(part=="sword"){name=GlobalConfig.SwordSkinConfig[id].name}else{name=GlobalConfig.ZhuangBanId[id].name}return name};DressCollectionMgr.prototype.getPartIcon=function(id,roleId,part){if(part===void 0){part="clothes"}var icon="";if(part=="sword"){icon=GlobalConfig.SwordSkinConfig[id].icon}else{icon=GlobalConfig.ZhuangBanId[id].cost.itemId+"_png"}return icon};DressCollectionMgr.prototype.isPartActivate=function(id,roleId,part){if(part===void 0){part="clothes"}var res=false;if(this.collectionInfo[id][roleId][part]==1){res=true}return res};DressCollectionMgr.prototype.nearActivate=function(id,roleId){var res=false;var state=this.getDressState(id,roleId);if(state==DressCollectionType.Activated||state==DressCollectionType.Activatable){return res}var count=0;var dcfg=GlobalConfig.DressCollectionConfig;var cfg=dcfg[id];if(cfg.clothes){if(this.collectionInfo[id][roleId]["clothes"]==0){count+=1}}if(cfg.weapon){if(this.collectionInfo[id][roleId]["weapon"]==0){count+=1}}if(cfg.wing){if(this.collectionInfo[id][roleId]["wing"]==0){count+=1}}if(cfg.sword){if(this.collectionInfo[id][roleId]["sword"]==0){count+=1}}res=count==1?true:false;return res};DressCollectionMgr.prototype.getDressState=function(cid,roleId){if(!this.collectionInfo[cid]){return DressCollectionType.NotActivate}var state=this.collectionInfo[cid][roleId]["activate"];return state};DressCollectionMgr.prototype.dressIDtoCID=function(dressID){if(dressID===void 0){dressID=1}var dcfg=GlobalConfig.DressCollectionConfig;for(var cid in GlobalConfig.DressCollectionConfig){var cfg=dcfg[cid];if(cfg.clothes){for(var _i=0,_a=cfg.clothes;_i<_a.length;_i++){var v=_a[_i];if(v==dressID){return cfg.id}}}if(cfg.weapon){for(var _b=0,_c=cfg.weapon;_b<_c.length;_b++){var v=_c[_b];if(v==dressID){return cfg.id}}}if(cfg.wing){for(var _d=0,_e=cfg.wing;_d<_e.length;_d++){var v=_e[_d];if(v==dressID){return cfg.id}}}}return-1};DressCollectionMgr.prototype.sendGetInfo=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};DressCollectionMgr.prototype.postDressCollectionInfo=function(bytes){this.collectionInfo={};for(var k in GlobalConfig.DressCollectionConfig){for(var roleId=0;roleId<3;roleId++){var id=bytes.readShort();if(!this.collectionInfo[id]){this.collectionInfo[id]={}}this.collectionInfo[id][roleId]={};this.collectionInfo[id][roleId]["clothes"]=bytes.readShort();this.collectionInfo[id][roleId]["weapon"]=bytes.readShort();this.collectionInfo[id][roleId]["wing"]=bytes.readShort();this.collectionInfo[id][roleId]["sword"]=bytes.readShort();this.collectionInfo[id][roleId]["activate"]=bytes.readShort()}}};DressCollectionMgr.prototype.sendDressCollectionActivate=function(id,roleId){var bytes=this.getBytes(2);bytes.writeInt(id);bytes.writeInt(roleId);this.sendToServer(bytes)};DressCollectionMgr.prototype.postDressCollectionActivate=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var id=bytes.readInt();var roleId=bytes.readInt();console.log("postSwordSkinActivate");if(errid==0){this.collectionInfo[id][roleId-1]["activate"]=2}else{console.log(errmsg)}return[errid,errmsg]};DressCollectionMgr.prototype.sendDressCollectionWear=function(id,roleId){var bytes=this.getBytes(3);bytes.writeInt(id);bytes.writeInt(roleId);this.sendToServer(bytes)};DressCollectionMgr.prototype.postDressCollectionWear=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var id=bytes.readInt();var roleId=bytes.readInt();console.log("postDressCollectionWear");if(errid==0){}else{console.log(errmsg)}return[errid,errmsg]};return DressCollectionMgr}(BaseSystem);__reflect(DressCollectionMgr.prototype,"DressCollectionMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.dresscollectionMgr=DressCollectionMgr.ins.bind(DressCollectionMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var DressCollectionItemRenderer=function(_super){__extends(DressCollectionItemRenderer,_super);function DressCollectionItemRenderer(){var _this=_super.call(this)||this;_this.skinName="DressCollectionItemSkin";return _this}DressCollectionItemRenderer.prototype.dataChanged=function(){if(this.data==null)return;this.setIcon(this.data.icon);this.imageName.text=this.data.name;this.imgBg.source="quality"+this.data.rank;this.redPoint(this.data["roleId"]);this.equipEffect.removeChildren();this.EquipEffect=this.EquipEffect||new MovieClip;this.EquipEffect.touchEnabled=false;this.EquipEffect.x=this.equipEffect.width/2;this.EquipEffect.y=this.equipEffect.height/2;this.EquipEffect.scaleX=this.equipEffect.width/76;this.EquipEffect.scaleY=this.equipEffect.height/76;var effectName="";if(this.data.rank==3){effectName="quality3_eff";this.EquipEffect.scaleX=this.equipEffect.width/76*1.1;this.EquipEffect.scaleY=this.equipEffect.height/76*1.1}else if(this.data.rank==4){effectName="quality4_eff";this.EquipEffect.scaleX=this.equipEffect.width/76*1.1;this.EquipEffect.scaleY=this.equipEffect.height/76*1.1}else if(this.data.rank==5){effectName="chuanqizbeff";this.EquipEffect.scaleX=this.equipEffect.width/76*1.1;this.EquipEffect.scaleY=this.equipEffect.height/76*1.1}if(effectName){this.equipEffect.addChild(this.EquipEffect);this.EquipEffect.playFile(RES_DIR_EFF+effectName,-1)}};Object.defineProperty(DressCollectionItemRenderer.prototype,"selected",{set:function(value){this.selectImage.visible=value},enumerable:true,configurable:true});DressCollectionItemRenderer.prototype.redPoint=function(roleId){if(roleId===void 0){roleId=0}this.redPoint0.visible=false;this.data["roleId"]=roleId;var state=DressCollectionMgr.ins().getDressState(this.data.id,roleId);if(state==DressCollectionType.Activatable){this.redPoint0.visible=true}else{this.redPoint0.visible=false}var role=SubRoles.ins().getSubRoleByIndex(roleId);var job=role&&role.job||1;var cfg=GlobalConfig.DressCollectionConfig;var icon=cfg[this.data.id].icon[job-1];this.setIcon(icon)};DressCollectionItemRenderer.prototype.setIcon=function(icon){this.data.icon=icon;this.imgIcon.source=this.data.icon+"_png"};return DressCollectionItemRenderer}(eui.ItemRenderer);__reflect(DressCollectionItemRenderer.prototype,"DressCollectionItemRenderer");var DressCollectionItemInfo=function(){function DressCollectionItemInfo(){this.roleId=0}return DressCollectionItemInfo}();__reflect(DressCollectionItemInfo.prototype,"DressCollectionItemInfo");var DressCollectionPart=function(_super){__extends(DressCollectionPart,_super);function DressCollectionPart(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.partName="clothes";return _this}DressCollectionPart.prototype.setInfo=function(partName,activated,id,icon,nearActivate,itemName,res,costItemID){if(partName===void 0){partName="clothes"}if(nearActivate===void 0){nearActivate=false}this.currentState=activated?"got":"empty";this.imgIcon.source=icon;this.removeTouchEvent(this,this.onTap);this.addTouchEvent(this,this.onTap);if(!this.effGroup){this.effGroup=new eui.Group;this.addChild(this.effGroup)}else{this.effGroup.removeChildren()}if(!activated&&nearActivate){this.eff=new MovieClip;this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);this.eff.scaleX=.42;this.eff.scaleY=1.11;this.eff.x=74/2;this.eff.y=77/2;this.effGroup.addChildAt(this.eff,1)}this.itemName=itemName;this.res=res;this.costItemID=costItemID;this.partName=partName};DressCollectionPart.prototype.onTap=function(){ViewManager.ins().open(DressCollectionTips,this.itemName,this.res,this.costItemID,this.partName)};return DressCollectionPart}(BaseView);__reflect(DressCollectionPart.prototype,"DressCollectionPart");var DressCollectionTips=function(_super){__extends(DressCollectionTips,_super);function DressCollectionTips(){var _this=_super.call(this)||this;_this.RES_DIR=RES_DIR_ROLE;_this.skinName="DressCollectionTipsSkin";return _this}DressCollectionTips.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.gainList.itemRenderer=RingGainItem};DressCollectionTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.itemName=param[0];this.res=param[1];this.itemID=param[2];this.partName=param[3];var data=new ItemData;data.configID=this.itemID;this.nameLabel.text=this.itemName;this.descLabel.textFlow=TextFlowMaker.generateTextFlow(data.itemConfig.desc);var mcX=201;var mcY=279;switch(this.partName){case"sword":this.RES_DIR=RES_DIR_EFF;mcY=157;break;case"weapon":if(this.res.indexOf("_0_c")>-1){mcX=331;mcY=187}else{mcX=300;mcY=237}break}this.mcGroup.x=mcX;this.mcGroup.y=mcY;imageToMc(this.mcImg,this.res,this.mcGroup,null,this.RES_DIR);this.addTouchEvent(this.bgClose,this.onTap);this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);var gainConfig=GlobalConfig.GainItemConfig[this.itemID];if(gainConfig){this.gainList.dataProvider=new eui.ArrayCollection(gainConfig.gainWay)}};DressCollectionTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this)};DressCollectionTips.prototype.onTouchList=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2],true)}};DressCollectionTips.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break}};return DressCollectionTips}(BaseEuiView);__reflect(DressCollectionTips.prototype,"DressCollectionTips");ViewManager.ins().reg(DressCollectionTips,LayerManager.UI_Main);var DressCollectionWin=function(_super){__extends(DressCollectionWin,_super);function DressCollectionWin(){var _this=_super.call(this)||this;_this.cid=1;_this.roleIndex=0;_this.isNotMove=true;_this.sValue=null;_this.skinName="DressCollectionSkin";_this.isTopLevel=true;return _this}DressCollectionWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};DressCollectionWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.cid=param[0]&&param[0]>0?param[0]:1;this.roleIndex=param[1]?param[1]:0;this.showActivate();this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.btnActivate,this.onClick);this.addTouchEvent(this.btnWear,this.onClick);this.addChangeEvent(this.roleSelect,this.onChange);this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.observe(DressCollectionMgr.ins().postDressCollectionActivate,this.onActivate);this.observe(DressCollectionMgr.ins().postDressCollectionWear,this.onWear);this.observe(DressCollectionMgr.ins().postDressCollectionInfo,this.updatePanel);DressCollectionMgr.ins().sendGetInfo();this.roleSelect.setCurRole(this.roleIndex)};DressCollectionWin.prototype.setListData=function(){var role=SubRoles.ins().getSubRoleByIndex(this.roleIndex);var job=role&&role.job||1;var cfg=GlobalConfig.DressCollectionConfig;var arr=[];for(var id in cfg){var v=cfg[id];var obj=new DressCollectionItemInfo;obj["id"]=v.id;obj["icon"]=v.icon[job-1];obj["rank"]=v.rank;obj["name"]=v.name;obj["roleId"]=this.roleIndex;var isShow=v.isShow[job-1];if(isShow){arr.push(obj)}}this.itemlistData.replaceAll(arr);this.itemList.dataProvider=this.itemlistData};DressCollectionWin.prototype.childrenCreated=function(){this.itemList.itemRenderer=DressCollectionItemRenderer;this.itemlistData=new eui.ArrayCollection;this.itemList.dataProvider=this.itemlistData;this.itemScroller.viewport=this.itemList;this.roleSelect.setCurRole(this.roleIndex);this.setListData()};DressCollectionWin.prototype.onChange=function(e){this.roleIndex=this.roleSelect.getCurRole();this.setListData();this.updatePanel()};DressCollectionWin.prototype.onItemTap=function(e){this.itemList.selectedIndex=e.itemIndex;this.cid=e.itemIndex+1;this.updateDetail()};DressCollectionWin.prototype.updatePanel=function(){this.updateBottom();this.updateDetail();this.showRedPoint()};DressCollectionWin.prototype.listSelectIndex=function(id){if(id==-1)return-1;var index=0;for(var key in this.itemlistData.source){if(this.itemlistData.source.hasOwnProperty(key)){var element=this.itemlistData.source[key];if(element.id==id){break}}index++}return index};DressCollectionWin.prototype.updateBottom=function(){var self=this;for(var i=0;i<self.itemlistData.source.length;i++){var data=self.itemlistData.source[i];data["roleId"]=self.roleIndex}var idx=this.cid-1;self.itemList.selectedIndex=idx;var func1=function(){self.itemScroller.viewport.scrollH=self.sValue;self.sValue=null};var func2=function(){var index=self.listSelectIndex(self.cid);var max=self.itemlistData.source.length*110-476;max=max<0?0:max;var min=Math.min(max,110*index);self.itemList.scrollH=min};var func3=function(){if(self.itemList&&self.itemList.numChildren>0){for(var i=0;i<self.itemList.numChildren;i++){var item=self.itemList.getChildAt(i);item.redPoint(self.roleIndex)}}};if(self.sValue){func1()}else{func2()}func3()};DressCollectionWin.prototype.showActivate=function(){var state=DressCollectionMgr.ins().getDressState(this.cid,this.roleIndex);if(state==DressCollectionType.Activatable){return}for(var k in GlobalConfig.DressCollectionConfig){var cid=GlobalConfig.DressCollectionConfig[k].id;var state=DressCollectionMgr.ins().getDressState(cid,this.roleIndex);if(state==DressCollectionType.Activatable){this.cid=cid;return}}};DressCollectionWin.prototype.showRedPoint=function(){for(var i=0;i<SubRoles.ins().subRolesLen;i++){this.roleSelect.showRedPoint(i,false);for(var k in GlobalConfig.DressCollectionConfig){var cid=GlobalConfig.DressCollectionConfig[k].id;var isShow=GlobalConfig.DressCollectionConfig[k].isShow;var role=SubRoles.ins().getSubRoleByIndex(i);var job=role.job||1;var isshow=isShow[job-1]==1||Setting.ins().getValue(ClientSet.showAllDress)==1;var state=DressCollectionMgr.ins().getDressState(cid,i);if(state==DressCollectionType.Activatable&&isshow){this.roleSelect.showRedPoint(i,true);break}}}};DressCollectionWin.prototype.onActivate=function(param){var errid=param[0];var errmsg=param[1];if(errid==0){UserTips.ins().showTips(errmsg)}else{WarnWin.show(errmsg,function(){},this,undefined,undefined,"sure")}};DressCollectionWin.prototype.onWear=function(param){var errid=param[0];var errmsg=param[1];if(errid==0){UserTips.ins().showTips(i18n("DressCollectionWin_3")+errmsg+"|")}else{WarnWin.show(errmsg,function(){},this,undefined,undefined,"sure")}};DressCollectionWin.prototype.showDress=function(){this.bodyImg.source="";this.weaponImg.source="";this.wingImg.source="";this.bodyImg0.source="";this.weaponImg0.source="";this.wingImg0.source="";var role=SubRoles.ins().getSubRoleByIndex(this.roleIndex);var bodyId=DressCollectionMgr.ins().getPartID(this.cid,this.roleIndex,"clothes");var weaponId=DressCollectionMgr.ins().getPartID(this.cid,this.roleIndex,"weapon");var wingId=DressCollectionMgr.ins().getPartID(this.cid,this.roleIndex,"wing");var swordId=DressCollectionMgr.ins().getPartID(this.cid,this.roleIndex,"sword");var bodyRes;if(bodyId>0){bodyRes=getZhuangbanById(bodyId).res+"_c"}else{bodyRes=getDefaultBody(role.job)+"_c"}this._body=imageToMc(this.bodyImg,bodyRes,this.bodyMc);var weaponRes;if(weaponId>0){weaponRes=getZhuangbanById(weaponId).res+"_"+role.sex+"_c"}imageToMc(this.weaponImg,weaponRes,this.weaponMc,this._body);var wingRes;if(wingId>0){wingRes=getZhuangbanById(wingId).res}imageToMc(this.wingImg,wingRes,this.wingMc,this._body);var bodyRes2;if(bodyId>0){bodyRes2=getZhuangbanById(bodyId).res+"_3s"}else{bodyRes2=getDefaultBody(role.job)+"_3s"}this._body2=imageToMc(this.bodyImg0,bodyRes2,this.bodyMc0,null,RES_DIR_BODY,false,true);var weaponRes2;if(weaponId>0){weaponRes2=getZhuangbanById(weaponId).res+"_"+role.sex+"_3s"}imageToMc(this.weaponImg0,weaponRes2,this.weaponMc0,this._body2,RES_DIR_WEAPON,false,true);var wingRes2;if(wingId>0){wingRes2=getZhuangbanById(wingId).res+"_3s"}imageToMc(this.wingImg0,wingRes2,this.wingMc0,this._body2,RES_DIR_WING,false,true);var swordRes2;if(swordId>0){swordRes2=getSwordMcById(swordId)+"_3f"}imageToMc(this.swordImg0,swordRes2,this.swordMc0,this._body2,RES_DIR_FLYSWORD,false,true);this.bodyRes=bodyRes;this.weaponRes=weaponRes;this.wingRes=wingRes;this.swordRes=swordRes2};DressCollectionWin.prototype.updateDetail=function(){var self=this;var cfg=GlobalConfig.DressCollectionConfig[this.cid];if(!cfg){return}var roleIdx=this.roleIndex;var role=SubRoles.ins().getSubRoleByIndex(roleIdx);var job=role.job;var isShow=cfg.isShow[job-1];if(!isShow&&!(Setting.ins().getValue(ClientSet.showAllDress)==1)){this.cid=this.cid-1;this.cid=Math.max(1,this.cid);cfg=GlobalConfig.DressCollectionConfig[this.cid]}this.showDress();this.refreshParts();var attrs=cfg.attrs;var power=UserBag.getAttrPower(attrs);this.attrPower.text=power.toString();var curAttrs=AttributeData.getAttStr(attrs,0,1,"：",false,true,null,"",false,-1,-1,true);curAttrs=attr2column(curAttrs);this.attrLabel.text=curAttrs;var state=DressCollectionMgr.ins().getDressState(this.cid,this.roleIndex);var nearActivate=DressCollectionMgr.ins().nearActivate(this.cid,this.roleIndex);this.dc_des_2.visible=nearActivate;this.dc_des_1.visible=!this.dc_des_2.visible;if(state==DressCollectionType.Activatable){this.btnActivate.visible=true;this.redPoint.visible=true;this.activedLabel.visible=false}else if(state==DressCollectionType.NotActivate){this.btnActivate.visible=true;this.redPoint.visible=false;this.activedLabel.visible=false}else if(state==DressCollectionType.Activated){this.btnActivate.visible=false;this.redPoint.visible=false;this.activedLabel.visible=true}this.btnWear.visible=DressCollectionMgr.ins().canWear(this.cid,this.roleIndex)};DressCollectionWin.prototype.refreshParts=function(){var cfg=GlobalConfig.DressCollectionConfig[this.cid];if(!cfg){return}var role=SubRoles.ins().getSubRoleByIndex(this.roleIndex);var job=role.job;this.setPart(cfg.clothes,this.part_clothes,cfg.clothes&&cfg.clothes[job-1]||1,"clothes",this.label_clothes);this.setPart(cfg.weapon,this.part_weapon,cfg.weapon&&cfg.weapon[job-1]||1,"weapon",this.label_weapon);this.setPart(cfg.wing,this.part_wing,cfg.wing&&cfg.wing[job-1]||1,"wing",this.label_wing);this.setPart(cfg.sword,this.part_sword,cfg.sword&&cfg.sword[this.roleIndex]||1,"sword",this.label_sword)};DressCollectionWin.prototype.setPart=function(ids,part,id,partName,label){if(partName===void 0){partName="clothes"}if(!ids){part.visible=false;label.visible=false}else{part.visible=true;label.visible=true}var activated=DressCollectionMgr.ins().isPartActivate(this.cid,this.roleIndex,partName);var icon=DressCollectionMgr.ins().getPartIcon(id,this.roleIndex,partName);var name=DressCollectionMgr.ins().getPartName(id,this.roleIndex,partName);var costItemID=DressCollectionMgr.ins().getPartCostID(id,this.roleIndex,partName);var nearActivate=DressCollectionMgr.ins().nearActivate(this.cid,this.roleIndex);var res=this.bodyRes;switch(partName){case"clothes":res=this.bodyRes;break;case"weapon":res=this.weaponRes;break;case"wing":res=this.wingRes;break;case"sword":res=GlobalConfig.SwordSkinConfig[id].fjMcFile;break}part.setInfo(partName,activated,id,icon,nearActivate,name,res,costItemID)};DressCollectionWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.btnActivate,this.onClick);this.removeTouchEvent(this.btnWear,this.onClick);this.itemList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)};DressCollectionWin.prototype.recordScroll=function(){this.sValue=this.itemScroller.viewport.scrollH;if(this.sValue==0){this.sValue+=.001}};DressCollectionWin.prototype.onClick=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.btnActivate:this.recordScroll();this.sendActivate();break;case this.btnWear:this.sendWear();break}};DressCollectionWin.prototype.sendWear=function(){var state=DressCollectionMgr.ins().getDressState(this.cid,this.roleIndex);if(state==DressCollectionType.NotActivate){UserTips.ins().showTips(i18n("DressCollectionWin_0"));return}DressCollectionMgr.ins().sendDressCollectionWear(this.cid,this.roleIndex+1)};DressCollectionWin.prototype.sendActivate=function(){var state=DressCollectionMgr.ins().getDressState(this.cid,this.roleIndex);if(state==DressCollectionType.NotActivate){UserTips.ins().showTips(i18n("DressCollectionWin_1"));return}if(state==DressCollectionType.Activated){console.log(i18n("DressCollectionWin_2"));return}if(state==DressCollectionType.Activatable){DressCollectionMgr.ins().sendDressCollectionActivate(this.cid,this.roleIndex+1)}};return DressCollectionWin}(BaseEuiView);__reflect(DressCollectionWin.prototype,"DressCollectionWin");ViewManager.ins().reg(DressCollectionWin,LayerManager.UI_Main);var Encounter=function(_super){__extends(Encounter,_super);function Encounter(){var _this=_super.call(this)||this;_this.encounterModel=[];_this.wildModel={};_this.isGuiding=false;_this.wildPersonList={};_this.isFindDrop=false;_this.buyAndFight=false;_this.encounterRank=0;_this.sysId=PackageID.Encounter;_this.regNetMsg(1,_this.doLastRefreshTime);_this.regNetMsg(2,_this.doEncounterData);_this.regNetMsg(3,_this.doResult);_this.regNetMsg(4,_this.postZaoYuRecord);_this.regNetMsg(7,_this.postDataUpdate);_this.regNetMsg(5,_this.doUpdateWildBoss);_this.regNetMsg(6,_this.doWildBossResult);_this.regNetMsg(8,_this.doAddWildPlayer);_this.regNetMsg(9,_this.doWildPlayerResult);_this.regNetMsg(10,_this.doRedNameResult);_this.regNetMsg(11,_this.doEncounterDataLite);return _this}Encounter.ins=function(){return _super.ins.call(this)};Encounter.prototype.doLastRefreshTime=function(bytes){EncounterModel.lastTime=bytes.readInt();var a=bytes.readInt();var b=bytes.readInt();EncounterModel.refreshTimes=bytes.readInt();EncounterModel.redName=bytes.readInt();this.postEncounterDataChange()};Encounter.prototype.sendRefresh=function(){this.sendBaseProto(1)};Encounter.prototype.sendFightResult=function(result){if(result==1){UserTips.ins().showTips(i18n("Encounter_3",GlobalConfig.SkirmishBaseConfig.onesPkval))}var bytes=this.getBytes(2);bytes.writeInt(EncounterFight.ins().encounterIndex);bytes.writeInt(result);this.sendToServer(bytes);console.log("[encounter] sendFightResult")};Encounter.prototype.postFightResult=function(result){return result};Encounter.prototype.isEncounter=function(){return EncounterFight.ins().isEncountering};Encounter.prototype.isHasRed=function(){var num=0;for(var i=0;i<Encounter.ins().encounterModel.length;i++){if(Encounter.ins().getEncounterModel(i))num++}if(num>0&&EncounterModel.redName<GlobalConfig.SkirmishBaseConfig.maxPkval)return num;return 0};Encounter.prototype.doEncounterData=function(bytes){var index=bytes.readInt();bytes.position-=4;console.log("收到论剑玩家详细信息："+(index+1));this.encounterModel[index]=this.encounterModel[index]||new EncounterModel;this.encounterModel[index].parser(bytes);this.postEncounterDataChange();this.postEncounterStartFight()};Encounter.prototype.postEncounterDataChange=function(){};Encounter.prototype.postEncounterStartFight=function(){};Encounter.prototype.sendGetreward=function(){this.sendBaseProto(3)};Encounter.prototype.doResult=function(bytes){console.log("[encounter] EncounterFight.doResult");var index=bytes.readInt();var result=bytes.readInt();var reward=[];var types=[0,1,4,3];var len=types.length;var rewardData;for(var i=0;i<len;i++){rewardData=new RewardData;rewardData.type=0;rewardData.id=types[i];rewardData.count=bytes.readInt();if(rewardData.count)reward.push(rewardData)}len=bytes.readShort();for(var i=0;i<len;i++){rewardData=new RewardData;rewardData.parser(bytes);Encounter.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,rewardData);reward.push(rewardData)}this.encounterModel[index-1]=null;var s=i18n("Encounter_4");if(result&&len){var f=function(){Encounter.ins().isFindDrop=false;this.sendGetreward();EncounterFight.ins().win()};this.isFindDrop=true;DropHelp.addCompleteFunc(f,this);DropHelp.start()}else if(!result){EncounterFight.ins().lose()}this.postEncounterDataChange()};Encounter.prototype.getEncounterLength=function(){var len=0;for(var i=0;i<Encounter.ins().encounterModel.length;i++){var enModel=Encounter.ins().getEncounterModel(i);if(enModel){len+=1}}return len};Encounter.prototype.postDataUpdate=function(bytes){var prestige=bytes.readInt();var rank=bytes.readShort();this.encounterRank=rank;return[prestige,rank]};Encounter.prototype.sendInquirePrestige=function(){this.sendBaseProto(7)};Encounter.prototype.postZaoYuRecord=function(bytes){if(bytes===void 0){bytes=null}if(!bytes)return null;var count=bytes.readShort();var arr=[];for(var i=0;i<count;i++){var r=[];r[0]=bytes.readInt();r[1]=bytes.readBoolean();r[2]=bytes.readString();r[3]=bytes.readInt();r[4]=bytes.readInt();r[5]=bytes.readInt();r[6]=bytes.readInt();arr[i]=r}return arr};Encounter.prototype.sendInquireRecord=function(){this.sendBaseProto(4)};Encounter.prototype.doUpdateWildBoss=function(bytes){var id=bytes.readInt();this.willBossID=id;if(id==0){}else{}PlayFun.ins().upDataWillBoss(id)};Encounter.prototype.createBoss=function(){};Encounter.prototype.doWildBossResult=function(bytes){var b=bytes.readBoolean();if(b){var count=bytes.readShort();for(var j=0;j<count;j++){var award=new RewardData;award.parser(bytes);Encounter.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,award)}}var f=function(){this.sendGetAward();GameLogic.ins().createGuanqiaMonster()};DropHelp.addCompleteFunc(f,this);DropHelp.start()};Encounter.prototype.postCreateDrop=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}if(DropHelp.getItemCount()<5){DropHelp.addDrop(params);return false}return params};Encounter.prototype.sendResult=function(result){var bytes=this.getBytes(5);bytes.writeBoolean(result);this.sendToServer(bytes)};Encounter.prototype.sendGetAward=function(){this.sendBaseProto(6)};Encounter.prototype.getEncounterModel=function(index){return this.encounterModel[index]};Encounter.prototype.clearEncounterModel=function(){this.encounterModel.length=0};Encounter.prototype.sendCleanRedName=function(){this.sendBaseProto(8)};Encounter.prototype.doAddWildPlayer=function(bytes){var data=new WildPlayerData;data.index=bytes.readInt();var x=bytes.readShort();var y=bytes.readShort();var lv=bytes.readShort();var zsLv=bytes.readShort();data.actionType=bytes.readByte();data.attackEnable=bytes.readByte()!=0;data.killNum=bytes.readInt();data.backX=bytes.readShort();data.backY=bytes.readShort();var name=bytes.readString();var len=bytes.readShort();var masterHandle;for(var i=0;i<len;i++){var role=new Role;role.parser(bytes);role.x=x;role.y=y;role.name=name;role.type=EntityType.Role;role.killNum=0;GameLogic.ins().createEntityByModel(role,Team.Faker);if(i==0){masterHandle=role.handle}role.masterHandle=masterHandle}data.fireRing=new OtherFireRingData;data.fireRing.parser(bytes);this.wildPersonList[masterHandle]=data};Encounter.prototype.canRunAwary=function(masterHandle){var tar=this.wildPersonList[masterHandle];tar.backCount--;return tar.backCount==0};Encounter.prototype.RunAwary=function(masterHandle){var data=this.wildPersonList[masterHandle];delete this.wildPersonList[masterHandle]};Encounter.prototype.sendWildPeopleResult=function(acId,result){var bytes=this.getBytes(9);bytes.writeInt(acId);bytes.writeInt(result);this.sendToServer(bytes)};Encounter.prototype.doWildPlayerResult=function(bytes){var index=bytes.readInt();var result=bytes.readInt();var reward=[];var rewardData;var len=bytes.readShort();for(var i=0;i<len;i++){rewardData=new RewardData;rewardData.parser(bytes);Encounter.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,rewardData);reward.push(rewardData)}if(result){var f=function(){this.sendGetWildPeopleReward();GameLogic.ins().createGuanqiaMonster()};DropHelp.addCompleteFunc(f,this);DropHelp.start()}else{TimerManager.ins().doTimer(800,1,function(){ResultManager.ins().create(GameMap.fbType,result,reward,"",false);GameLogic.ins().createGuanqiaMonster();Encounter.ins().wildPersonList={}},this)}};Encounter.prototype.sendCleanWildPeople=function(index){var bytes=this.getBytes(10);bytes.writeInt(index);this.sendToServer(bytes)};Encounter.prototype.sendGetWildPeopleReward=function(){this.sendBaseProto(11)};Encounter.prototype.doRedNameResult=function(bytes){UserTips.ins().showTips(i18n("Encounter_8",GlobalConfig.SkirmishBaseConfig.subPkval))};Encounter.prototype.doEncounterDataLite=function(bytes){var index=bytes.readInt();bytes.position-=4;this.encounterModel[index]=this.encounterModel[index]||new EncounterModel;this.encounterModel[index].parserLite(bytes);this.postEncounterDataChange()};Encounter.prototype.checkIsEncounter=function(index,model){var enModel=this.encounterModel[index];if(!enModel)return false;var list=enModel.subRole;for(var i=0;i<list.length;i++){var role=list[i];if(role&&role.handle==model.handle){return true}}return false};Encounter.prototype.sendEnemyDetail=function(index){if(index===void 0){index=0}var bytes=this.getBytes(12);bytes.writeInt(index+1);this.sendToServer(bytes);console.log("寻仙论剑请求玩家详细信息："+(index+1))};return Encounter}(BaseSystem);__reflect(Encounter.prototype,"Encounter");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.encounter=Encounter.ins.bind(Encounter)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var EncounterFight=function(_super){__extends(EncounterFight,_super);function EncounterFight(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.isEncountering=false;_this.aiList={};_this.encounterList={};_this.willEntityFightTeam=Team.Monster;return _this}EncounterFight.ins=function(){return _super.ins.call(this)};EncounterFight.prototype.start=function(index){var _this=this;if(Encounter.ins().isEncounter()||EntityManager.ins().getTeamCount(Team.WillBoss)>0){UserTips.ins().showTips(i18n("EncounterFight_0"));return}if(UserFb.ins().checkInFB())return;if(!Encounter.ins().encounterModel[index])return;this.encounterIndex=index;this.isEncountering=true;SoundUtil.ins().changeSceneSound();this.rolePositions={};this.removeAllEncounter();RoleAI.ins().stop();DropHelp.clearDrop();ShapeShiftingMgr.ins().postShapeEndClient(true,null);UserSkill.ins().setHejiCD(6e3);HejiUseMgr.ins().register(this);this.addCheckResult();var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var _i=0,mylist_2=mylist;_i<mylist_2.length;_i++){var char=mylist_2[_i];char.stopMove();char.playAction(EntityAction.STAND);if(char instanceof CharRole){this.rolePositions[char.infoModel.handle]={x:char.x,y:char.y,dir:char.dir};this.playTransferEffect(char);char.playAction(EntityAction.ATTACK)}else{EntityManager.ins().removeByHandle(char.infoModel.handle)}}TimerManager.ins().doTimer(800,1,function(){DropHelp.clearDrop();_this.addRole()},this);this.clearOldAI();this.createEncounterAndMonster();SoundUtil.ins().playEffect(SoundUtil.SCENE)};EncounterFight.prototype.addCheckResult=function(){TimerManager.ins().doTimer(1e3,0,this.checkResult,this)};EncounterFight.prototype.checkResult=function(){if(!Encounter.ins().isFindDrop){if(EntityManager.ins().getTeamCount(Team.My)==0||EntityManager.ins().getTeamCount(Team.WillEntity)==0){if(EntityManager.ins().getTeamCount(Team.WillEntity)==0){this.sendFightResult(1)}else{this.sendFightResult(0)}}}};EncounterFight.prototype.sendFightResult=function(result){console.log("[encounter] EncounterFight.sendFightResult, result = "+result);if(EncounterFight.ins().encounterIndex==undefined){return}if(result){Encounter.ins().sendFightResult(result)}else{TimerManager.ins().doTimer(2e3,1,function(){Encounter.ins().sendFightResult(result)},this)}Encounter.ins().postFightResult(result);TimerManager.ins().remove(this.checkResult,this);TimerManager.ins().remove(this.forceQuit,this);TimerManager.ins().doTimer(5e3,1,this.forceQuit,this);EncounterFight.ins().encounterIndex=undefined};EncounterFight.prototype.forceQuit=function(){console.log("[encounter] EncounterFight.forceQuit");Encounter.ins().isFindDrop=false;this.lose()};EncounterFight.prototype.win=function(){var _this=this;console.log("[encounter] EncounterFight.win");TimerManager.ins().remove(this.forceQuit,this);var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var _i=0,mylist_3=mylist;_i<mylist_3.length;_i++){var char=mylist_3[_i];char.stopMove();if(!(char instanceof CharRole)){EntityManager.ins().removeByHandle(char.infoModel.handle)}else{this.playTransferEffect(char);char.playAction(EntityAction.ATTACK)}}console.log("[encounter] EncounterFight.win 1");SoundUtil.ins().playEffect(SoundUtil.SCENE);TimerManager.ins().doTimer(800,1,function(){var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var _i=0,mylist_4=mylist;_i<mylist_4.length;_i++){var char=mylist_4[_i];EntityManager.ins().removeByHandle(char.infoModel.handle)}_this.stop();_this.fightEnd();console.log("[encounter] EncounterFight.win 2");if(GameMap.sceneInMain()){console.log("[encounter] EncounterFight.win 3");_this.resetPos();RoleAI.ins().start()}},this)};EncounterFight.prototype.lose=function(){console.log("[encounter] EncounterFight.lose");TimerManager.ins().remove(this.forceQuit,this);SoundUtil.ins().playEffect(SoundUtil.SCENE);this.stop();this.fightEnd();if(GameMap.sceneInMain()){console.log("[encounter] EncounterFight.lose 1");this.resetPos();RoleAI.ins().start()}};EncounterFight.prototype.fightEnd=function(){if(EncounterModel.redName<GlobalConfig.SkirmishBaseConfig.maxPkval&&Encounter.ins().getEncounterLength())ViewManager.ins().open(LadderWin)};EncounterFight.prototype.stop=function(enterMap){if(enterMap===void 0){enterMap=false}if(!this.isEncountering){return}HejiUseMgr.ins().unregister(this);TimerManager.ins().removeAll(this);EntityManager.ins().resetRole();this.willEntityFightTeam=Team.Monster;this.removeAllEncounter();for(var handle in this.aiList){var char=EntityManager.ins().getEntityByHandle(handle);if(char&&char.AI_STATE!=AI_State.Die){RoleAI.ins().add(char)}}this.aiList={};if(!enterMap){GameLogic.ins().postMoveCamera()}this.isEncountering=false;SoundUtil.ins().changeSceneSound();RoleAI.ins().endMyShape()};EncounterFight.prototype.resetPos=function(){var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var i in mylist){var char=mylist[i];var pos=this.rolePositions[char.infoModel.handle];if(pos){char.x=pos.x;char.y=pos.y}this.playTransferEffect(char)}this.rolePositions={};GameLogic.ins().postMoveCamera()};EncounterFight.prototype.removeAllEncounter=function(){for(var handle in this.encounterList){EntityManager.ins().removeByHandle(handle);delete this.encounterList[handle]}};EncounterFight.prototype.addRole=function(){var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var _i=0,mylist_5=mylist;_i<mylist_5.length;_i++){var char=mylist_5[_i];EntityManager.ins().removeByHandle(char.infoModel.handle)}EntityManager.ins().resetRole();var master=EntityManager.ins().getNoDieRole();var rolePos=this.getRolePos();master.x=rolePos[0]*GameMap.CELL_SIZE;master.y=rolePos[1]*GameMap.CELL_SIZE;var list=EntityManager.ins().screeningTargetByPos(master);if(list[0]){master.dir=DirUtil.get8DirBy2Point(master,list[0])}else{var encounterModel=Encounter.ins().encounterModel[this.encounterIndex];if(encounterModel){var len=encounterModel.subRole.length;Assert(false,i18n("EncounterFight_1",len))}}var otherPos=EntityManager.ins().getMyOtherRolePos();mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var i in mylist){mylist[i].playAction(EntityAction.STAND);RoleAI.ins().add(mylist[i]);if(mylist[i]!=master){var handle=mylist[i].infoModel.handle;mylist[i].dir=master.dir;mylist[i].x=Math.floor(otherPos[handle].x);mylist[i].y=Math.floor(otherPos[handle].y)}this.playTransferEffect(mylist[i])}GameLogic.ins().postMoveCamera()};EncounterFight.prototype.playTransferEffect=function(char){var appearEff=new MovieClip;appearEff.playFile(RES_DIR_EFF+"jl_hd",1,function(){if(appearEff.parent){appearEff.parent.removeChild(appearEff)}});SkillEffPlayer.topLayer.addChild(appearEff);appearEff.x=char.x;appearEff.y=char.y};EncounterFight.prototype.getRoles=function(){var encounterModel=Encounter.ins().encounterModel[this.encounterIndex];return encounterModel&&encounterModel.subRole};EncounterFight.prototype.getSkillLvl=function(){var encounterModel=Encounter.ins().encounterModel[this.encounterIndex];return encounterModel&&encounterModel.hejiLvl||0};EncounterFight.prototype.getShapeInfo=function(){var info={};var encounterModel=Encounter.ins().encounterModel[this.encounterIndex];if(!encounterModel){return info}var shapeIds=encounterModel.shapeID;for(var i in shapeIds){var id=shapeIds[i];if(id>0){var handle=encounterModel.subRole[i].handle;if(handle){info[handle]=id}}}return info};EncounterFight.prototype.getIsWeiShe=function(selfTargetIsMy){var model=Encounter.ins().encounterModel[this.encounterIndex];if(!model)return false;if(selfTargetIsMy){return Actor.weiWang>model.weiWang}else{return Actor.weiWang<model.weiWang}};EncounterFight.prototype.getWeiSheHurt=function(selfTargetIsMy){if(!this.getIsWeiShe(selfTargetIsMy))return 0;var rankList=Rank.ins().getRankModel(RankDataType.TYPE_WEIWANG);var name="";if(selfTargetIsMy){name=Actor.myName}else{var model=Encounter.ins().encounterModel[this.encounterIndex];name=model.subRole[0].name}var rank=0;if(rankList){for(var i=0;i<3;i++){var data=rankList.getDataList(i);if(data&&data.player==name){rank=data.pos;break}}}return GlobalConfig.PrestigeBase.rankDeterDam[rank-1]||GlobalConfig.PrestigeBase.normalDeterDam};EncounterFight.prototype.getRolePos=function(){var range=GlobalConfig.SkirmishBaseConfig.range;return GameMap.getPosRange(this.zyRolePos[0],this.zyRolePos[1],range)};EncounterFight.prototype.clearOldAI=function(){this.aiList=RoleAI.ins().getAIList();RoleAI.ins().clearAIList()};EncounterFight.prototype.createEncounterAndMonster=function(){var zyPos=UserFb.ins().zyPos;var index=Math.floor(Math.random()*zyPos.length);var zyData=zyPos[index];var zyRolePos=zyData[0];this.zyRolePos=zyRolePos;var monsterId=UserFb.ins().waveMonsterId[0];var monsterPos=zyData[1];if(Assert(monsterPos,i18n("EncounterFight_2",UserFb.ins().guanqiaID))){monsterPos=[]}for(var i=0;i<monsterPos.length;i++){var entityModel=UserFb.ins().createMonster(monsterId);0;entityModel.x=monsterPos[i][0]*GameMap.CELL_SIZE;entityModel.y=monsterPos[i][1]*GameMap.CELL_SIZE;var monster=GameLogic.ins().createEntityByModel(entityModel);monster.AI_STATE=AI_State.Patrol;this.encounterList[monster.infoModel.handle]=monster}var encounterModel=Encounter.ins().encounterModel[this.encounterIndex];var len=encounterModel.subRole.length;for(var i=0;i<len;i++){var role=encounterModel.subRole[i];if(role){role.setAtt(AttributeType.atHp,role.getAtt(AttributeType.atMaxHp));role.setAtt(AttributeType.atMp,role.getAtt(AttributeType.atMaxMp));role.type=EntityType.Role;role.x=zyRolePos[0]*GameMap.CELL_SIZE+Math.floor(i*40*Math.random());role.y=zyRolePos[1]*GameMap.CELL_SIZE+Math.floor(i*40*Math.random());var tar=GameLogic.ins().createEntityByModel(role,Team.WillEntity);tar.AI_STATE=AI_State.Stand;tar.updateNeiGong();this.encounterList[role.handle]=tar}}RoleAI.ins().start()};return EncounterFight}(BaseClass);__reflect(EncounterFight.prototype,"EncounterFight",["IHejiUse"]);var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.encounterFight=EncounterFight.ins.bind(EncounterFight)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var EncounterModel=function(){function EncounterModel(name){this.subRole=[];this.hejiLvl=0;this.weiWang=0;this.shapeID=[-1,-1,-1];this.name=name}EncounterModel.prototype.parser=function(bytes){this.index=bytes.readInt();this.lv=bytes.readShort();this.zsLv=bytes.readShort();this.name=bytes.readString();console.log(this.index+1+"_"+this.name);this.subRole=[];var count=bytes.readShort();for(var i=0;i<count;i++){var role=this.subRole[i]=new Role;role.parser(bytes);role.name=this.name}this.fireRing=this.fireRing||new OtherFireRingData;this.fireRing.parser(bytes);this.firstData=bytes.readByte()!=0;this.hejiLvl=bytes.readInt();this.weiWang=bytes.readInt();for(var i=0;i<3;i++){this.shapeID[i]=bytes.readInt()}};EncounterModel.prototype.parserLite=function(bytes){this.index=bytes.readInt();this.lv=bytes.readShort();this.zsLv=bytes.readShort();this.name=bytes.readString();var role=this.subRole[0]=new Role;role.job=bytes.readShort();role.sex=bytes.readShort()};EncounterModel.moveEncounterByMasterHandle=function(handle,posX,posY){var list=EntityManager.ins().getMasterList(handle);for(var k in list){var entity=list[k];if(entity.parent&&entity.infoModel){GameMap.moveEntity(entity,posX,posY);entity.AI_STATE=AI_State.Run}}};EncounterModel.countKillNumByMarster=function(handle){var num=0;var list=EntityManager.ins().getMasterList(handle);for(var k in list){var entity=list[k];if(entity.parent&&entity.infoModel){num+=entity.infoModel.killNum}}return num};EncounterModel.getLiveNumByMarster=function(handle){var list=EntityManager.ins().getMasterList(handle);for(var k in list){var entity=list[k];if(entity.parent&&entity.infoModel){return 1}}return 0};EncounterModel.redName=0;return EncounterModel}();__reflect(EncounterModel.prototype,"EncounterModel");var WildPlayerData=function(){function WildPlayerData(){}return WildPlayerData}();__reflect(WildPlayerData.prototype,"WildPlayerData");var BuyRedNameWin=function(_super){__extends(BuyRedNameWin,_super);function BuyRedNameWin(){var _this=_super.call(this)||this;_this.skinName="ZaoYuQueSkin";_this.horizontalCenter=0;_this.verticalCenter=0;return _this}BuyRedNameWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnBuy,this.onTap);this.addTouchEvent(this.btnClose,this.onTap);this.updateText()};BuyRedNameWin.prototype.updateText=function(){this.pkNow.text=""+EncounterModel.redName;this.ybNum.text=""+(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)*GlobalConfig.SkirmishBaseConfig.subPkvalCost;this.pkValue.text=""+(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)};BuyRedNameWin.prototype.close=function(){this.removeTouchEvent(this.btnBuy,this.onTap);this.removeTouchEvent(this.btnClose,this.onTap)};BuyRedNameWin.prototype.onTap=function(e){switch(e.target){case this.btnBuy:if(Actor.yb>=(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)*GlobalConfig.SkirmishBaseConfig.subPkvalCost){Encounter.ins().sendCleanRedName();Encounter.ins().buyAndFight=true}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("BuyRedNameWin_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("BuyRedNameWin_1"))}ViewManager.ins().close(this);break}}ViewManager.ins().close(BuyRedNameWin)};return BuyRedNameWin}(BaseEuiView);__reflect(BuyRedNameWin.prototype,"BuyRedNameWin");ViewManager.ins().reg(BuyRedNameWin,LayerManager.UI_Popup);var EncounterBgWin=function(_super){__extends(EncounterBgWin,_super);function EncounterBgWin(){var _this=_super.call(this)||this;_this.skinName="ZaoYuBGSkin";_this.isTopLevel=true;_this.encounterPanel=new EncounterInfoWin;_this.viewStack.addChild(_this.encounterPanel);_this.tab.dataProvider=_this.viewStack;return _this}EncounterBgWin.prototype.open=function(){this.roleSelect.setState("nohead");this.addTouchEvent(this.btnClose,this.onTap);this.addTouchEvent(this.btnClose0,this.onTap);this.encounterPanel.open()};EncounterBgWin.prototype.close=function(){this.encounterPanel.close()};EncounterBgWin.prototype.onTap=function(e){switch(e.target){case this.btnClose:case this.btnClose0:ViewManager.ins().close(EncounterBgWin);break}};return EncounterBgWin}(BaseEuiView);__reflect(EncounterBgWin.prototype,"EncounterBgWin");ViewManager.ins().reg(EncounterBgWin,LayerManager.UI_Main);var EncounterInfoWin=function(_super){__extends(EncounterInfoWin,_super);function EncounterInfoWin(){var _this=_super.call(this)||this;_this.curIndex=-1;_this.cIdx=-1;_this.name=i18n("EncounterInfoWin_0");return _this}EncounterInfoWin.prototype.childrenCreated=function(){var job=fixJob(SubRoles.ins().getSubRoleByIndex(0).job);var sex=fixSex(SubRoles.ins().getSubRoleByIndex(0).sex);this.myFace.source="head_"+job+sex;this.list.itemRenderer=EncounterInfoItem;this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF};EncounterInfoWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.labelRed.textFlow=TextFlowMaker.generateTextFlow1(i18n("EncounterInfoWin_1"));this.setData();this.addTouchEvent(this,this.onTap);this.addTouchEvent(this.rewardBtn,this.onTap);this.observe(Encounter.ins().postEncounterDataChange,this.setData);this.observe(Encounter.ins().postEncounterStartFight,this.onStart);this.observe(Encounter.ins().postDataUpdate,this.updatePrestigeRank);Encounter.ins().sendInquireRecord();Encounter.ins().sendInquirePrestige();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.biWu)};EncounterInfoWin.prototype.$onClose=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.$onClose.call(this);TimerManager.ins().removeAll(this);GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};EncounterInfoWin.prototype.updatePrestigeRank=function(param){var prestige=param[0];var rank=param[1];this.dayPrestige.text=prestige+"";if(rank==0){this.rank.textFlow=TextFlowMaker.generateTextFlow1(i18n("EncounterInfoWin_2"))}else{this.rank.textFlow=TextFlowMaker.generateTextFlow1(i18n("EncounterInfoWin_3",rank))}};EncounterInfoWin.prototype.setData=function(){var arr=[];if(this.curIndex>-1&&Encounter.ins().buyAndFight){this.sendFight(this.curIndex)}Encounter.ins().buyAndFight=false;this.curIndex=-1;this.labelRedPoint.text=""+EncounterModel.redName;this.labelRedPoint.textColor=EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval?16711680:242004;this.labelRed.visible=false;if(EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval){this.time.text=i18n("EncounterInfoWin_4",EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1);this.time.textColor=16711680}else{this.removeTime()}for(var i=0;i<Encounter.ins().encounterModel.length;i++){var enModel=Encounter.ins().getEncounterModel(i);if(enModel){if(enModel.firstData){arr=[enModel];break}arr.push(enModel)}}if(arr.length==0){arr.push(null)}this.list.dataProvider=new eui.ArrayCollection(arr)};EncounterInfoWin.prototype.onStart=function(){if(this.cIdx>-1){this.startFight(this.cIdx)}};EncounterInfoWin.prototype.addTime=function(){this.removeTime();this.timeGap=(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)*60;this.time.text=i18n("EncounterInfoWin_5",DateUtils.getFormatBySecond(this.timeGap,3));TimerManager.ins().doTimer(1e3,0,this.timeHandler,this)};EncounterInfoWin.prototype.timeHandler=function(){if(this.timeGap>0){this.timeGap-=1;this.time.text=i18n("EncounterInfoWin_6",DateUtils.getFormatBySecond(this.timeGap,3))}else{this.time.text=""}};EncounterInfoWin.prototype.removeTime=function(){this.time.text="";TimerManager.ins().remove(this.timeHandler,this)};EncounterInfoWin.prototype.onTap=function(e){if(e.target instanceof eui.Button&&e.target.parent instanceof EncounterInfoItem){if(CityCC.ins().isCity){UserTips.ins().showTips(i18n("EncounterInfoWin_7"));return}if(e.target.label==i18n("EncounterInfoWin_8")){if(UserFb.ins().checkInFB())return;var index=e.target.parent.data.index;if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}if(EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval){this.curIndex=index;ViewManager.ins().open(BuyRedNameWin);return}this.sendFight(index)}else if(e.target.label==i18n("EncounterInfoWin_9")){UserTips.ins().showCenterTips2(i18n("EncounterInfoWin_9"))}else if(e.target.label==i18n("EncounterInfoWin_11")){ViewManager.ins().open(FindEnemyWin)}}else{switch(e.target){case this.rankBtn:ViewManager.ins().open(RankingWin,RankDataType.TYPE_SKIRMISH);break;case this.recordBtn:ViewManager.ins().open(ZaoYuRecordWin);break;case this.labelRed:if(EncounterModel.redName>0)ViewManager.ins().open(BuyRedNameWin);else UserTips.ins().showTips(i18n("EncounterInfoWin_12"));break;case this.rank:ViewManager.ins().open(RankingWin,RankDataType.TYPE_SKIRMISH);break;case this.rewardBtn:ViewManager.ins().open(EncounterRewardWin);break}}};EncounterInfoWin.prototype.sendFight=function(index){if(UserFb.ins().checkInFB())return;if(this.cIdx>-1){console.log("EncounterInfoWin this.cIdx > -1; return");return}this.cIdx=index;Encounter.ins().sendEnemyDetail(index)};EncounterInfoWin.prototype.startFight=function(index){console.log("寻仙论剑开始战斗");ViewManager.ins().close(BagFullTipsWin);ViewManager.ins().closeTopLevel();TimerManager.ins().doTimer(100,1,function(){EncounterFight.ins().start(index)},this);this.cIdx=-1};return EncounterInfoWin}(BaseComponent);__reflect(EncounterInfoWin.prototype,"EncounterInfoWin");var EncounterRewardRender=function(_super){__extends(EncounterRewardRender,_super);function EncounterRewardRender(){return _super.call(this)||this}EncounterRewardRender.prototype.dataChanged=function(){if(this.data){if(this.data.maxRank==this.data.minRank){this.rank.text=i18n("EncounterRewardRender_0",this.data.minRank)}else{this.rank.text=i18n("EncounterRewardRender_1",this.data.minRank,this.data.maxRank)}if(this.data.rewards){if(this.data.rewards[0])this.item0.data=this.data.rewards[0];if(this.data.rewards[1])this.item1.data=this.data.rewards[1];if(this.data.rewards[2])this.item2.data=this.data.rewards[2]}}};return EncounterRewardRender}(BaseItemRender);__reflect(EncounterRewardRender.prototype,"EncounterRewardRender");var EncounterRewardWin=function(_super){__extends(EncounterRewardWin,_super);function EncounterRewardWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="Zaoyurewardskin";return _this}EncounterRewardWin.prototype.createChildren=function(){this.list0.itemRenderer=EncounterRewardRender;this.rewardList=[];for(var k in GlobalConfig.SkirmishRankConfig){this.rewardList.push(GlobalConfig.SkirmishRankConfig[k])}};EncounterRewardWin.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.setPanelInfo()};EncounterRewardWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap)};EncounterRewardWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(EncounterRewardWin);break}};EncounterRewardWin.prototype.setPanelInfo=function(){this.list0.dataProvider=new eui.ArrayCollection(this.rewardList);var rank=Encounter.ins().encounterRank;if(rank==0){this.myRankText.textFlow=TextFlowMaker.generateTextFlow1(i18n("EncounterRewardWin_0"))}else{this.myRankText.textFlow=TextFlowMaker.generateTextFlow1(i18n("EncounterRewardWin_1",rank))}};return EncounterRewardWin}(BaseEuiView);__reflect(EncounterRewardWin.prototype,"EncounterRewardWin");ViewManager.ins().reg(EncounterRewardWin,LayerManager.UI_Main);var FindEnemyWin=function(_super){__extends(FindEnemyWin,_super);function FindEnemyWin(){return _super.call(this)||this}FindEnemyWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ZaoYuTip0Skin"};FindEnemyWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn0,this.closeCB);this.addTouchEvent(this.cancel,this.closeCB);this.addTouchEvent(this.ok,this.buy);this.updateView()};FindEnemyWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn0,this.closeCB);this.removeTouchEvent(this.cancel,this.closeCB);this.removeTouchEvent(this.ok,this.buy)};FindEnemyWin.prototype.updateView=function(){this.yuanbao.text=GlobalConfig.SkirmishBaseConfig.refreshCost+i18n("FindEnemyWin_0");this.count.text=i18n("FindEnemyWin_1")+EncounterModel.refreshTimes+i18n("FindEnemyWin_2")};FindEnemyWin.prototype.closeCB=function(e){ViewManager.ins().close(this)};FindEnemyWin.prototype.buy=function(e){if(Actor.yb>=GlobalConfig.SkirmishBaseConfig.refreshCost){Encounter.ins().sendRefresh();Encounter.ins().postZaoYuRecord();ViewManager.ins().close(this)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("FindEnemyWin_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("FindEnemyWin_4"))}};return FindEnemyWin}(BaseEuiView);__reflect(FindEnemyWin.prototype,"FindEnemyWin");ViewManager.ins().reg(FindEnemyWin,LayerManager.UI_Main);var WildBossWin=function(_super){__extends(WildBossWin,_super);function WildBossWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;return _this}WildBossWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ZaoYuBossSkin";this.bossImage=new MovieClip;this.bossImage.scaleX=-1;this.bossImage.x=250;this.bossImage.y=430;this.addChildAt(this.bossImage,6)};WildBossWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.challengeBtn,this.onTap);this.addTouchEvent(this.thinkBtn,this.onTap)};WildBossWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.challengeBtn,this.onTap);this.removeTouchEvent(this.thinkBtn,this.onTap)};WildBossWin.openCheck=function(){if(EntityManager.ins().getTeamCount(Team.WillBoss)){UserTips.ins().showTips(i18n("WildBossWin_0"));return false}return true};WildBossWin.prototype.onTap=function(e){switch(e.currentTarget){case this.challengeBtn:case this.thinkBtn:case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(WildBossWin);break}};return WildBossWin}(BaseEuiView);__reflect(WildBossWin.prototype,"WildBossWin");ViewManager.ins().reg(WildBossWin,LayerManager.UI_Main);var ZaoYuRecordItem=function(_super){__extends(ZaoYuRecordItem,_super);function ZaoYuRecordItem(){var _this=_super.call(this)||this;_this.skinName="ZaoYuRecordInfoSkin";return _this}ZaoYuRecordItem.prototype.dataChanged=function(){var data=this.data;this.time.text=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(data[0])/1e3,2);this.playerName.textFlow=(new egret.HtmlTextParser).parser(i18n("ZaoYuRecordItem_0",data[2]));this.exp.text=""+data[3];this.money.text=""+data[4];this.prestige.text=""+data[5];this.lingpo.text=data[6]||"0";if(data[1]){this.currentState="win"}else{this.currentState="lose"}};return ZaoYuRecordItem}(BaseItemRender);__reflect(ZaoYuRecordItem.prototype,"ZaoYuRecordItem");var ZaoYuRecordWin=function(_super){__extends(ZaoYuRecordWin,_super);function ZaoYuRecordWin(){var _this=_super.call(this)||this;_this.skinName="ZaoYuRecordSkin";_this.list.itemRenderer=ZaoYuRecordItem;return _this}ZaoYuRecordWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.observe(Encounter.ins().postZaoYuRecord,this.updateData);Encounter.ins().sendInquireRecord()};ZaoYuRecordWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeObserve()};ZaoYuRecordWin.prototype.updateData=function(arr){if(!arr)return;function sort(a,b){if(a[0]<b[0])return 1;else if(a[0]>b[0])return-1;else return 0}arr.sort(sort);this.list.dataProvider=new eui.ArrayCollection(arr)};ZaoYuRecordWin.prototype.onTap=function(e){switch(e.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};return ZaoYuRecordWin}(BaseEuiView);__reflect(ZaoYuRecordWin.prototype,"ZaoYuRecordWin");ViewManager.ins().reg(ZaoYuRecordWin,LayerManager.UI_Main);var EscortMgr=function(_super){__extends(EscortMgr,_super);function EscortMgr(){var _this=_super.call(this)||this;_this.lastCheckTime=0;_this.goddess_id=0;_this.start_time=0;_this.end_time=0;_this.escorted=0;_this.has_item_cnt=[];_this.reward_zslv=0;_this.sysId=PackageID.Escort;_this.regNetMsg(1,_this.postStatus);_this.regNetMsg(2,_this.postStartEscort);_this.regNetMsg(3,_this.postBuyEscort);_this.regNetMsg(4,_this.postGetBuyCost);return _this}EscortMgr.ins=function(){return _super.ins.call(this)};EscortMgr.prototype.isOpen=function(){var roleLevel=Actor.level;var v=GlobalConfig.EscortBaseConfig.openlevel;var b=roleLevel>=v;return b};EscortMgr.prototype.getMaxProtectCount=function(){var result=GlobalConfig.EscortBaseConfig.maxProtectCount;if(Recharge.ins().franchise>0){result+=GlobalConfig.PrivilegeData.addEscortCount}return result};EscortMgr.prototype.checkRedPoint=function(){if(!this.isOpen()){return false}if(this.hasEscort()){return this.getRemainSeconds()<=0}else{return this.escorted<EscortMgr.ins().getMaxProtectCount()}};EscortMgr.prototype.startEndTimer=function(){TimerManager.ins().remove(this.checkEndTime,this);if(this.end_time>0){TimerManager.ins().doTimer(1e3,0,this.checkEndTime,this)}};EscortMgr.prototype.checkEndTime=function(){var now=GameServer.serverTime;if(this.lastCheckTime<this.end_time&&this.end_time<=now){this.postEndTimeReached();TimerManager.ins().remove(this.checkEndTime,this)}this.lastCheckTime=now};EscortMgr.prototype.postEndTimeReached=function(){};EscortMgr.prototype.hasEscort=function(){return this.goddess_id!=null&&this.goddess_id!=0};EscortMgr.prototype.getRemainSeconds=function(){var now=GameServer.serverTime;var result=(this.end_time-now)/1e3;if(result<0){result=0}return Math.floor(result)};EscortMgr.prototype.sendGetStatus=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};EscortMgr.prototype.postStatus=function(bytes){this.goddess_id=bytes.readInt();this.start_time=bytes.readUnsignedInt();if(this.start_time>0){this.start_time=DateUtils.formatMiniDateTime(this.start_time)}this.end_time=bytes.readUnsignedInt();if(this.end_time>0){this.end_time=DateUtils.formatMiniDateTime(this.end_time)}this.escorted=bytes.readInt();for(var i=0;i<3;++i){this.has_item_cnt[i]=bytes.readInt()}this.reward_zslv=bytes.readInt();this.startEndTimer()};EscortMgr.prototype.sendStartEscort=function(goddessId){var bytes=this.getBytes(2);bytes.writeInt(goddessId);this.sendToServer(bytes)};EscortMgr.prototype.postStartEscort=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();if(errid!=0){UserTips.ins().showTips(errmsg)}else{this.goddess_id=bytes.readInt();this.start_time=bytes.readUnsignedInt();if(this.start_time>0){this.start_time=DateUtils.formatMiniDateTime(this.start_time)}this.end_time=bytes.readUnsignedInt();if(this.end_time>0){this.end_time=DateUtils.formatMiniDateTime(this.end_time)}this.escorted=bytes.readInt();for(var i=0;i<3;++i){this.has_item_cnt[i]=bytes.readInt()}this.reward_zslv=bytes.readInt();this.startEndTimer()}};EscortMgr.prototype.sendBuyEscort=function(){var bytes=this.getBytes(3);this.sendToServer(bytes)};EscortMgr.prototype.postBuyEscort=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();if(errid!=0){UserTips.ins().showTips(errmsg)}else{this.escorted=bytes.readInt();for(var i=0;i<3;++i){this.has_item_cnt[i]=bytes.readInt()}this.reward_zslv=bytes.readInt();this.goddess_id=0;this.start_time=0;this.end_time=0;this.startEndTimer()}};EscortMgr.prototype.sendGetBuyCost=function(){var bytes=this.getBytes(4);this.sendToServer(bytes)};EscortMgr.prototype.postGetBuyCost=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();if(errid!=0){UserTips.ins().showTips(errmsg);return[errid,0]}else{var yuanbao=bytes.readInt();return[errid,yuanbao]}};return EscortMgr}(BaseSystem);__reflect(EscortMgr.prototype,"EscortMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.escortMgr=EscortMgr.ins.bind(EscortMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var EscortGoddessItem=function(_super){__extends(EscortGoddessItem,_super);function EscortGoddessItem(){var _this=_super.call(this)||this;_this.skinName="EscortGoddessItemSkin";return _this}EscortGoddessItem.prototype.childrenCreated=function(){this.escortBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEscortBtn,this)};EscortGoddessItem.prototype.dataChanged=function(){var goddessCfg=this.data;this.list.itemRenderer=this.list.itemRenderer||ItemBase;var rewardsArr1=GlobalConfig.EscortRewardsConfig[goddessCfg.id];var reward_zslv=EscortMgr.ins().reward_zslv;var rewards;if(rewardsArr1){var rewardsArr2=rewardsArr1[reward_zslv];if(rewardsArr2==null){for(var i=0;i<99;++i){rewardsArr2=rewardsArr1[i];if(rewardsArr2==null){break}else{rewards=rewardsArr2.rewards;this.needItem=rewardsArr2.needItem}}}else{rewards=rewardsArr2.rewards;this.needItem=rewardsArr2.needItem}}if(rewards){if(!this.list.dataProvider){this.list.dataProvider=new eui.ArrayCollection(rewards)}else{var dataPro=this.list.dataProvider;dataPro.source=rewards}}this.bg.source="escort_goddess_"+goddessCfg.id+"_png";if(this.needItem){var needItemId=this.needItem.id;var needItemCount=this.needItem.count;if(needItemCount==0){this.costLabel.text=i18n("EscortGoddessItem_0");this.costLabel.textColor=65280;this.costImage.visible=false}else{var hasCount=EscortMgr.ins().has_item_cnt[goddessCfg.id-1];this.costLabel.text=hasCount.toString()+"/"+needItemCount;this.costLabel.textColor=hasCount>=needItemCount?7204498:15478664;this.costImage.visible=true}}else{this.costLabel.text=i18n("EscortGoddessItem_1");this.costLabel.textColor=65280;this.costImage.visible=false}};EscortGoddessItem.prototype.getNeedItem=function(){var goddessCfg=this.data};EscortGoddessItem.prototype.onEscortBtn=function(e){if(EscortMgr.ins().escorted>=EscortMgr.ins().getMaxProtectCount()){UserTips.ins().showTips(i18n("EscortGoddessItem_2"));return}var goddessCfg=this.data;if(this.needItem){var needItemId=this.needItem.id;var needItemCount=this.needItem.count;var hasCount=EscortMgr.ins().has_item_cnt[goddessCfg.id-1];if(hasCount<needItemCount){ViewManager.ins().open(ShopGoodsWarn).setData(needItemId,needItemCount-hasCount);return}var goddessId=goddessCfg.id;if(goddessId<3){WarnWin.show(i18n("EscortGoddessItem_3"),function(){EscortMgr.ins().sendStartEscort(goddessId)},this)}else{EscortMgr.ins().sendStartEscort(goddessId)}}};return EscortGoddessItem}(BaseItemRender);__reflect(EscortGoddessItem.prototype,"EscortGoddessItem");var EscortPanel=function(_super){__extends(EscortPanel,_super);function EscortPanel(){return _super.call(this)||this}EscortPanel.prototype.childrenCreated=function(){this.init()};EscortPanel.prototype.addShadow=function(grp,x,y){var shadow=new eui.Image(RES_DIR+"yingzi.png");shadow.x=x;shadow.y=y;grp.addChildAt(shadow,0);shadow.anchorOffsetX=57>>1;shadow.anchorOffsetY=37>>1};EscortPanel.prototype.init=function(){this.bgScroller.bounces=false;var ss=2;var poss=[[20*ss,-80*ss],[60*ss,-40*ss],[120*ss,-20*ss],[0*ss,0*ss]];var charRoleIdxs=[2,-1,1,0];var mcTypes=[CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON];var subRolesLen=SubRoles.ins().subRolesLen;for(var i=0;i<4;++i){var charRoleIdx=charRoleIdxs[i];if(charRoleIdx==-1){this.mcGoddess=new MovieClip;this.mcGoddess.scaleX=-1;this.mcGoddess.playFile("resource/res/eff/xn_01",-1,null,false);this.mcGoddess.x=poss[i][0];this.mcGoddess.y=poss[i][1];this.charGroup.addChild(this.mcGoddess);this.addShadow(this.charGroup,poss[i][0],poss[i][1])}else if(charRoleIdx<subRolesLen){var role=EntityManager.ins().getMainRole(charRoleIdx);if(role){for(var _i=0,mcTypes_1=mcTypes;_i<mcTypes_1.length;_i++){var mcType=mcTypes_1[_i];var mc=role.getMC(mcType,"r",5);if(mc){mc.x=poss[i][0];mc.y=poss[i][1];this.charGroup.addChild(mc)}}this.addShadow(this.charGroup,poss[i][0],poss[i][1])}}}this.updateUI()};EscortPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(EscortMgr.ins().postStatus,this.updateUI);this.observe(EscortMgr.ins().postEndTimeReached,this.updateUI);this.observe(EscortMgr.ins().postStartEscort,this.updateUI);this.observe(EscortMgr.ins().postBuyEscort,this.updateUI);this.observe(EscortMgr.ins().postGetBuyCost,this.onGetBuyCost);this.observe(Shop.ins().postBuyResult,this.buyCallBack);this.addTouchEvent(this.finishBtn,this.onFinishBtn);egret.startTick(this.onEnterFrame,this);EscortMgr.ins().sendGetStatus()};EscortPanel.prototype.buyCallBack=function(num){if(num>0){EscortMgr.ins().sendGetStatus()}};EscortPanel.prototype.close=function(){this.removeObserve();TimerManager.ins().removeAll(this);egret.stopTick(this.onEnterFrame,this)};EscortPanel.prototype.countDown=function(){var remainSeconds=EscortMgr.ins().getRemainSeconds();if(remainSeconds>0){this.countDownLabel.text=i18n("EscortPanel_0")+DateUtils.getFormatTimeByStyle(remainSeconds,DateUtils.STYLE_3)+")"}else{this.countDownLabel.visible=false;TimerManager.ins().remove(this.countDown,this);this.finishBtn.label=i18n("EscortPanel_1")}};EscortPanel.prototype.onEnterFrame=function(timeStamp){if(this.escortingGroup.visible){var w=this.bgGroup.width;var h=this.bgGroup.height;var speed=.2;var now=egret.getTimer();var b=1e3/speed;var d=now%b/b;this.bgGroup.scrollH=w*(1-d);this.bgGroup.scrollV=h*d}return false};EscortPanel.prototype.updateUI=function(){var hasEscort=EscortMgr.ins().hasEscort();this.escortingGroup.visible=hasEscort;this.goddessGroup.visible=!hasEscort;TimerManager.ins().remove(this.countDown,this);if(hasEscort){var playName="resource/res/eff/xn_0";var goddess_id=EscortMgr.ins().goddess_id;if(goddess_id){playName=playName+goddess_id}if(this.mcGoddess.name!=playName){this.mcGoddess.playFile(playName,-1,null,false)}this.countDownLabel.visible=true;this.countDown();TimerManager.ins().doTimer(1e3,0,this.countDown,this);var goddessCfg=GlobalConfig.EscortGoddessConfig[goddess_id];var reward_zslv=EscortMgr.ins().reward_zslv;var rewardsArr1=GlobalConfig.EscortRewardsConfig[goddess_id];var rewards;if(rewardsArr1){var rewardsArr2=rewardsArr1[reward_zslv];rewards=rewardsArr2.rewards}this.rewardsList.itemRenderer=this.rewardsList.itemRenderer||ItemBase;if(rewards){if(this.rewardsList.dataProvider==null){this.rewardsList.dataProvider=new eui.ArrayCollection(rewards)}else{var dataPro=this.rewardsList.dataProvider;dataPro.source=rewards}}var remainSeconds=EscortMgr.ins().getRemainSeconds();this.finishBtn.label=remainSeconds>0?i18n("EscortPanel_2"):i18n("EscortPanel_3");this.redPointFinishBtn.visible=remainSeconds<=0;var escorted=EscortMgr.ins().escorted;var maxCnt=EscortMgr.ins().getMaxProtectCount();this.countLabel0.text=(maxCnt-escorted).toString()+"/"+maxCnt}else{var datas=[];for(var i=1;i<=3;++i){datas.push(GlobalConfig.EscortGoddessConfig[i])}this.goddessList.removeChildren();for(var _i=0,datas_1=datas;_i<datas_1.length;_i++){var data=datas_1[_i];var item=new EscortGoddessItem;item.data=data;this.goddessList.addChild(item)}this.goddessList.layout.updateDisplayList(this.goddessList.width,this.goddessList.height);var escorted=EscortMgr.ins().escorted;var maxCnt=EscortMgr.ins().getMaxProtectCount();this.countLabel.text=(maxCnt-escorted).toString()+"/"+maxCnt;this.countLabel.textColor=escorted<maxCnt?6414844:15478664}};EscortPanel.prototype.onFinishBtn=function(){EscortMgr.ins().sendGetBuyCost()};EscortPanel.prototype.onGetBuyCost=function(params){var errid=params[0];var yuanbao=params[1];if(errid==0){if(yuanbao>0){WarnWin.show(i18n("EscortPanel_4",16711680,yuanbao),function(){EscortMgr.ins().sendBuyEscort()},this,function(){},this)}else{EscortMgr.ins().sendBuyEscort()}}};return EscortPanel}(BaseView);__reflect(EscortPanel.prototype,"EscortPanel");var ExpGoldWin=function(_super){__extends(ExpGoldWin,_super);function ExpGoldWin(){return _super.call(this)||this}ExpGoldWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="exprefineSkin"};ExpGoldWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.goUpBtn,this.onTap);this.observe(UserExpGold.ins().postExpUpdate,this.refreshShow);this.refreshShow()};ExpGoldWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.goUpBtn,this.onTap)};ExpGoldWin.prototype.refreshShow=function(){if(UserExpGold.ins().checkIsOver()){this.getAll.visible=true;this.group.visible=false}else{this.group.visible=true;this.getAll.visible=false;this.constImg.source="exprefine_json.explz_"+UserExpGold.ins().index;var str=i18n("ExpGoldWin_0")+UserExpGold.ins().checkUpLevel()+i18n("ExpGoldWin_1");this.depictLabel0.textFlow=(new egret.HtmlTextParser).parser(str);var needGold=GlobalConfig.RefinesystemExpConfig[UserExpGold.ins().index].yuanBao;if(Actor.yb>=needGold){this.goldConst.setText("<font color='#03b154'>"+UserExpGold.ins().getIndexNeedGold()+"</font>")}else{this.goldConst.setText("<font color='#f3311e'>"+UserExpGold.ins().getIndexNeedGold()+"</font>")}var endedTime=UserExpGold.ins().remainTime;this.depictLabel.text=i18n("ExpGoldWin_2")+DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}};ExpGoldWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.goUpBtn:UserExpGold.ins().checkIsCanPlay();break}};return ExpGoldWin}(BaseEuiView);__reflect(ExpGoldWin.prototype,"ExpGoldWin");ViewManager.ins().reg(ExpGoldWin,LayerManager.UI_Main);var UserExpGold=function(_super){__extends(UserExpGold,_super);function UserExpGold(){var _this=_super.call(this)||this;_this.sysId=PackageID.ExpGold;_this.regNetMsg(1,_this.doRemainTimeAndIndex);return _this}UserExpGold.ins=function(){return _super.ins.call(this)};UserExpGold.prototype.doRemainTimeAndIndex=function(bytes){this.remainTime=bytes.readUnsignedInt();this.index=bytes.readInt();this.postExpUpdate()};UserExpGold.prototype.postExpUpdate=function(){};UserExpGold.prototype.sendBuyExp=function(){this.sendBaseProto(2)};Object.defineProperty(UserExpGold.prototype,"remainTime",{get:function(){return this._remainTime},set:function(value){if(this._remainTime!=value){this._remainTime=value;TimerManager.ins().remove(this.downTime,this);TimerManager.ins().doTimer(1e3,this._remainTime,this.downTime,this)}},enumerable:true,configurable:true});UserExpGold.prototype.downTime=function(){this._remainTime-=1;if(this._remainTime<=0){this.postExpUpdate()}};UserExpGold.prototype.getIndexNeedGold=function(){return GlobalConfig.RefinesystemExpConfig[this.index].yuanBao};UserExpGold.prototype.checkIsOver=function(){if(GlobalConfig.RefinesystemExpConfig[this.index]){return false}return true};UserExpGold.prototype.checkIsCanPlay=function(){if(UserVip.ins().lv<3){UserTips.ins().showTips(i18n("UserExpGold_0"));return}var needGold=GlobalConfig.RefinesystemExpConfig[this.index].yuanBao;if(Actor.yb>=needGold){UserExpGold.ins().sendBuyExp();return}if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("UserExpGold_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("UserExpGold_2"));Recharge.ins().tryShowChargeFirstWin()};UserExpGold.prototype.isOpenBtn=function(){if(Actor.level>=60&&this.remainTime>0){return!this.checkIsOver()}return false};UserExpGold.prototype.checkUpLevel=function(){var cruLevel=Actor.level;var getExp=GlobalConfig.RefinesystemExpConfig[this.index].exp;var cruNeed=Math.ceil(GlobalConfig.ExpConfig[cruLevel].exp-Actor.exp);if(getExp>=cruNeed){++cruLevel;getExp-=cruNeed;for(cruLevel;cruLevel<150;cruLevel++){cruNeed=Math.ceil(GlobalConfig.ExpConfig[cruLevel].exp);if(getExp-cruNeed<0){break}else{getExp-=cruNeed}}}return cruLevel};return UserExpGold}(BaseSystem);__reflect(UserExpGold.prototype,"UserExpGold");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userexpgold=UserExpGold.ins.bind(UserExpGold)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ExtremeEquipModel=function(_super){__extends(ExtremeEquipModel,_super);function ExtremeEquipModel(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.selectJob=0;return _this}ExtremeEquipModel.ins=function(){return _super.ins.call(this)};Object.defineProperty(ExtremeEquipModel.prototype,"descNames",{get:function(){return[i18n("ExtremeEquipModel_0"),i18n("ExtremeEquipModel_1"),i18n("ExtremeEquipModel_2"),i18n("ExtremeEquipModel_3"),i18n("ExtremeEquipModel_4"),i18n("ExtremeEquipModel_5"),i18n("ExtremeEquipModel_6"),i18n("ExtremeEquipModel_7")]},enumerable:true,configurable:true});Object.defineProperty(ExtremeEquipModel.prototype,"positions",{get:function(){return[EquipPos.WEAPON,EquipPos.CLOTHES,EquipPos.Wrist,EquipPos.RING,EquipPos.SHOE,EquipPos.BRACELET,EquipPos.NECKLACE,EquipPos.HEAD]},enumerable:true,configurable:true});ExtremeEquipModel.prototype.getZhiZunLv=function(job,subType){var role=SubRoles.ins().getSubRoleByJob(job);var data=role.getEquipByIndex(subType);var id=data.item.configID;if(id){return data.soulLv}return 0};ExtremeEquipModel.prototype.getZhiZunLvByRoleID=function(role,subType){if(!role||subType>EquipPos.SHOE)return 0;var data=role.getEquipByIndex(subType);var id=data.item.configID;if(id){return data.soulLv}return 0};ExtremeEquipModel.prototype.isWear=function(job,subType){var role=SubRoles.ins().getSubRoleByJob(job);var data=role.getEquipByIndex(subType);var id=data.item.configID;if(id){return true}return false};ExtremeEquipModel.prototype.canOperate=function(job,subType){var role=SubRoles.ins().getSubRoleByJob(job);var data=role.getEquipByIndex(subType);var id=data.item.configID;if(id){var lv=data.soulLv;if(lv<this.getMaxZhiZunEquipLevel(ItemConfig.getSubType(data.item.itemConfig))){var cfg=GlobalConfig.ZhiZunEquipLevel[subType][lv+1];var need=cfg.materialInfo.count;var count=UserBag.ins().getBagGoodsCountById(0,cfg.materialInfo.id);return count>=need}}return false};ExtremeEquipModel.prototype.getRedPointByJob=function(job){for(var i=EquipPos.WEAPON;i<=EquipPos.SHOE;i++){if(this.canOperate(job,i))return true}return false};ExtremeEquipModel.prototype.getRedPoint=function(){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);var job=role.job;if(this.getRedPointByJob(job))return true}return false};ExtremeEquipModel.prototype.getMaxZhiZunEquipLevel=function(subType){var count=CommonUtils.getObjectLength(GlobalConfig.ZhiZunEquipLevel[subType]);return count};ExtremeEquipModel.prototype.getZhiZunSkills=function(role){var equipPos=[EquipPos.WEAPON,EquipPos.CLOTHES];var skills=[];for(var _i=0,equipPos_1=equipPos;_i<equipPos_1.length;_i++){var pos=equipPos_1[_i];var data=role.getEquipByIndex(pos);if(data.item.configID){var lv=data.soulLv;if(lv>0){var cfg=GlobalConfig.ZhiZunEquipLevel[pos][lv];if(cfg.skillId){skills.push(new SkillData(cfg.skillId))}}}}return skills};ExtremeEquipModel.prototype.getZhiZunSkill=function(job,subType){var role=SubRoles.ins().getSubRoleByJob(job);var data=role.getEquipByIndex(subType);var id=data.item.configID;if(id){var lv=data.soulLv;if(lv>0){var cfg=GlobalConfig.ZhiZunEquipLevel[subType][lv];return cfg.skillId}}return 0};ExtremeEquipModel.prototype.getZhiZunLinkLv=function(roleIndex,mainPos,soullv){var secPos=this.getLinkEquipPos(mainPos);var role=SubRoles.ins().getSubRoleByIndex(roleIndex-1);if(Assert(role,i18n("ExtremeEquipModel_8",roleIndex,mainPos,soullv)))return 0;var mainEquip=role.getEquipByIndex(mainPos);var secEquip=role.getEquipByIndex(secPos);if(mainEquip&&secEquip){return Math.min(soullv,secEquip.soulLv)}return 0};ExtremeEquipModel.prototype.getZhiZunLinkLvShow=function(roleIndex,mainPos,soullv){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);var mainEquip=role.getEquipByIndex(mainPos);if(mainEquip&&soullv){var config=GlobalConfig.ZhiZunEquipLevel[mainPos][soullv];return config.soulLinkLevel}return 1};ExtremeEquipModel.prototype.getLinkEquipPos=function(mainPos){for(var i in GlobalConfig.ZhiZunLinkLevel){if(i==mainPos.toString()){for(var j in GlobalConfig.ZhiZunLinkLevel[i]){return+j}}}return null};ExtremeEquipModel.prototype.getZhiZunLinkLevelConfig=function(pos,roleJob,next){var subType=pos;var job=roleJob;var zhiZunLv=ExtremeEquipModel.ins().getZhiZunLv(job,subType);if(!zhiZunLv)zhiZunLv=1;var secPos=ExtremeEquipModel.ins().getLinkEquipPos(subType);if(next)zhiZunLv+=1;var linkconfig=GlobalConfig.ZhiZunLinkLevel[subType][secPos][zhiZunLv];return linkconfig};ExtremeEquipModel.prototype.getZhiZunEquipLevelConfig=function(pos,level,next){var subType=pos;var zhiZunLv=level;if(!zhiZunLv)zhiZunLv=1;if(next)zhiZunLv+=1;var config=GlobalConfig.ZhiZunEquipLevel[subType][zhiZunLv];return config};ExtremeEquipModel.prototype.getSkillName=function(pos){var zzel=GlobalConfig.ZhiZunEquipLevel[pos][1];if(!zzel)return"";var skillconfig=GlobalConfig.SkillsConfig[zzel.skillId];if(!skillconfig)return"";var sdconfig=GlobalConfig.SkillsDescConfig[skillconfig.desc];if(!sdconfig)return"";return sdconfig.name};ExtremeEquipModel.prototype.getSkillDesc=function(pos){var zzel=GlobalConfig.ZhiZunEquipLevel[pos][1];if(!zzel)return"";var skillconfig=GlobalConfig.SkillsConfig[zzel.skillId];if(!skillconfig)return"";var sdconfig=GlobalConfig.SkillsDescConfig[skillconfig.desc];if(!sdconfig)return"";var desc=sdconfig.desc;desc=desc.replace("%s%",skillconfig.desc_ex[0]+"");return desc};return ExtremeEquipModel}(BaseClass);__reflect(ExtremeEquipModel.prototype,"ExtremeEquipModel");var ExtremeEquipPanel=function(_super){__extends(ExtremeEquipPanel,_super);function ExtremeEquipPanel(){return _super!==null&&_super.apply(this,arguments)||this}ExtremeEquipPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.menuList.itemRenderer=ExtremeEquipItem;this.menuListData=new ArrayCollection;this.menuList.dataProvider=this.menuListData;this.menuList.selectedIndex=0;this.addTouchEvent(this.leftBtn,this.onLeft);this.addTouchEvent(this.rightBtn,this.onRight);this.addTouchEvent(this.updateBtn,this.update);this.addTouchEvent(this["skillIcon0"],this.onClick);this.addTouchEvent(this["skillIcon1"],this.onClick);this.addTouchEvent(this["chainImg0"],this.onClick);this.addTouchEvent(this["chainImg1"],this.onClick);this.addTouchEvent(this["skillIcon2"],this.onClick);this.addTouchEvent(this["chainImg2"],this.onClick);this.menuList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this);this.addChangeEvent(this.menuScroller,this.onChange);this.observe(UserEquip.ins().postZhiZunUpgrade,this.undateView);ViewManager.ins().getView(AdvanEquipWin).isNotMove=true;this.listWidth=82*8+70;this.setRoleId(param[0]);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.jueShi)};ExtremeEquipPanel.prototype.onClick=function(e){var config;var linkconfig;var equipconfig;var level;var zhiZunLv;var sconfig;var strdesc;switch(e.currentTarget){case this["skillIcon0"]:case this["skillIcon2"]:linkconfig=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob);zhiZunLv=ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,this.menuList.selectedItem);equipconfig=ExtremeEquipModel.ins().getZhiZunEquipLevelConfig(this.menuList.selectedItem,zhiZunLv);sconfig=GlobalConfig.SkillsConfig[equipconfig.skillId];config=GlobalConfig.SkillsDescConfig[sconfig.desc];strdesc=config.desc;strdesc=strdesc.replace("%s%",sconfig.desc_ex[0]+"");ViewManager.ins().open(ExtremeSkillTipsWin,config.name+(linkconfig.level+"级"),strdesc);break;case this["chainImg0"]:case this["chainImg2"]:linkconfig=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob);ViewManager.ins().open(ExtremeSkillTipsWin,i18n("ExtremeEquipPanel_0")+(linkconfig.level+"级"),linkconfig.chainDesc);break;case this["skillIcon1"]:linkconfig=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob);zhiZunLv=ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,this.menuList.selectedItem);equipconfig=ExtremeEquipModel.ins().getZhiZunEquipLevelConfig(this.menuList.selectedItem,zhiZunLv,true);sconfig=GlobalConfig.SkillsConfig[equipconfig.skillId];config=GlobalConfig.SkillsDescConfig[sconfig.desc];strdesc=config.desc;strdesc=strdesc.replace("%s%",sconfig.desc_ex[0]+"");ViewManager.ins().open(ExtremeSkillTipsWin,config.name+(linkconfig.level+"级"),strdesc);break;case this["chainImg1"]:linkconfig=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob,true);ViewManager.ins().open(ExtremeSkillTipsWin,i18n("ExtremeEquipPanel_1")+(linkconfig.level+"级"),linkconfig.chainDesc);break}};ExtremeEquipPanel.prototype.undateView=function(){var subType=this.menuList.selectedItem;this.pos=subType;this.setRoleId(this.curRole,subType)};ExtremeEquipPanel.prototype.update=function(){var job=ExtremeEquipModel.ins().selectJob;var subType=this.menuList.selectedItem;var role=SubRoles.ins().getSubRoleByJob(job);var data=role.getEquipByIndex(subType);var id=data.item.configID;if(!id){UserTips.ins().showTips(i18n("ExtremeEquipPanel_2"));return}if(!ExtremeEquipModel.ins().canOperate(job,subType)){UserTips.ins().showTips(i18n("ExtremeEquipPanel_3"));return}UserEquip.ins().upgradeZhiZunEquip(role.index,subType)};ExtremeEquipPanel.prototype.onListChange=function(){var data=this.menuList.selectedItem;this.pos=data;this.selectEquip(data);this.selectList()};ExtremeEquipPanel.prototype.onLeft=function(){var num=82*5;var scrollH=0;scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/82)*82;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;this.onChange()};ExtremeEquipPanel.prototype.onRight=function(){var num=82*5;var scrollH=0;scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/82)*82;if(scrollH>this.listWidth-this.menuScroller.width){scrollH=this.listWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;this.onChange()};ExtremeEquipPanel.prototype.setRoleId=function(index,pos){index=index?index:0;this.curRole=index;var role=SubRoles.ins().getSubRoleByIndex(index);var job=role.job;ExtremeEquipModel.ins().selectJob=job;this.menuListData.replaceAll(ExtremeEquipModel.ins().positions);pos=pos?pos:this.pos?this.pos:EquipPos.WEAPON;this.pos=pos;this.selectEquip(pos)};ExtremeEquipPanel.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftGroup.visible=false;this.rightGroup.visible=true}else if(this.menuList.scrollH>=this.listWidth-this.menuList.width-46){this.leftGroup.visible=true;this.rightGroup.visible=false}else{this.leftGroup.visible=true;this.rightGroup.visible=true}this.updateRedPoint()};ExtremeEquipPanel.prototype.updateRedPoint=function(){this.leftRed.visible=ExtremeEquipModel.ins().getRedPoint();this.rightRed.visible=ExtremeEquipModel.ins().getRedPoint()};ExtremeEquipPanel.prototype.selectEquip=function(subType){this.extremeName.source="extreme_name_0"+subType;var job=ExtremeEquipModel.ins().selectJob;var role=SubRoles.ins().getSubRoleByJob(job);var zhiZunLv=ExtremeEquipModel.ins().getZhiZunLv(job,subType);this.cost.parent.visible=true;if(!zhiZunLv){this.attrGroup1.visible=true;this.attrGroup0.visible=false;this.updateBtn.label=i18n("ExtremeEquipPanel_4");this.updateBtn.visible=true;var preCfg=GlobalConfig.ZhiZunEquipLevel[subType][1];var preDesc=AttributeData.getAttStr(preCfg.attrs,0,1,"  :  ");this.attr2.text=preDesc;this.skillChain2.text=i18n("ExtremeEquipPanel_5",1);var sname=ExtremeEquipModel.ins().getSkillName(subType);if(sname){this.skillName2.text=sname+" "+1+"级";this["skillIcon2"].source=UserSkill.ins().getSkillIdIcon(preCfg.skillId)}var power2=Math.floor(UserBag.getAttrPower(preCfg.attrs))+preCfg.ex_power;power2+=ExtremeEquipPanel.getChainAddPower(subType,zhiZunLv,this.curRole);this.powerPanel2.setPower(power2);var itemCount=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,preCfg.materialInfo.id);var item=GlobalConfig.ItemConfig[preCfg.materialInfo.id];var count=preCfg.materialInfo.count;this.cost.text=item.name;var colorStr=void 0;if(itemCount>=count){colorStr=ColorUtil.GREEN_COLOR;this.isItemEnough=true}else{colorStr=ColorUtil.RED_COLOR;this.isItemEnough=false}this.numLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+itemCount+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+count+"</font> ");this.redPoint.visible=ExtremeEquipModel.ins().canOperate(job,subType)}else if(zhiZunLv>=ExtremeEquipModel.ins().getMaxZhiZunEquipLevel(subType)){this.attrGroup1.visible=true;this.attrGroup0.visible=false;this.updateBtn.visible=this.redPoint.visible=this.cost.parent.visible=false;var cfg=GlobalConfig.ZhiZunEquipLevel[subType][zhiZunLv];var attrDesc=AttributeData.getAttStr(cfg.attrs,0,1,"  :  ");this.attr2.text=attrDesc;this.skillChain2.text=i18n("ExtremeEquipPanel_6",ExtremeEquipModel.ins().getZhiZunLinkLvShow(role.index,subType,zhiZunLv));var sname=ExtremeEquipModel.ins().getSkillName(subType);if(sname){this.skillName2.text=sname+" "+zhiZunLv+"级";this["skillIcon2"].source=UserSkill.ins().getSkillIdIcon(cfg.skillId)}var power2=Math.floor(UserBag.getAttrPower(cfg.attrs))+cfg.ex_power;power2+=ExtremeEquipPanel.getChainAddPower(subType,zhiZunLv,this.curRole);this.powerPanel2.setPower(power2)}else{this.attrGroup1.visible=false;this.attrGroup0.visible=true;this.updateBtn.visible=this.cost.parent.visible=true;var cfg=GlobalConfig.ZhiZunEquipLevel[subType][zhiZunLv+1];var item=GlobalConfig.ItemConfig[cfg.materialInfo.id];var count=cfg.materialInfo.count;this.cost.text=item.name;var itemCount=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,cfg.materialInfo.id);var colorStr=void 0;if(itemCount>=count){colorStr=ColorUtil.GREEN_COLOR;this.isItemEnough=true}else{colorStr=ColorUtil.RED_COLOR;this.isItemEnough=false}this.numLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+itemCount+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+count+"</font> ");var attrDesc=AttributeData.getAttStr(cfg.attrs,0,1,"  :  ");var preDesc=void 0;var preCfg=void 0;if(zhiZunLv==0){preCfg=GlobalConfig.ZhiZunEquipLevel[subType][1];preDesc=AttributeData.getAttStr(preCfg.attrs,0,1,"  :  ")}else{preCfg=GlobalConfig.ZhiZunEquipLevel[subType][zhiZunLv];preDesc=AttributeData.getAttStr(preCfg.attrs,0,1,"  :  ")}this.attr0.text=preDesc;this.attr1.text=attrDesc;var power0=Math.floor(UserBag.getAttrPower(preCfg.attrs))+preCfg.ex_power;var power1=Math.floor(UserBag.getAttrPower(cfg.attrs))+cfg.ex_power;power0+=ExtremeEquipPanel.getChainAddPower(subType,zhiZunLv,this.curRole);power1+=ExtremeEquipPanel.getChainAddPower(subType,zhiZunLv,this.curRole);this.powerPanel0.setPower(power0);this.powerPanel1.setPower(power1);this.skillChain0.text=i18n("ExtremeEquipPanel_8",ExtremeEquipModel.ins().getZhiZunLinkLvShow(role.index,subType,zhiZunLv));this.skillChain1.text=i18n("ExtremeEquipPanel_9",ExtremeEquipModel.ins().getZhiZunLinkLvShow(role.index,subType,zhiZunLv+1));var sname=ExtremeEquipModel.ins().getSkillName(subType);if(sname){this.skillName0.text=sname+" "+zhiZunLv+"级";this.skillName1.text=sname+" "+(zhiZunLv+1)+"级";this["skillIcon0"].source=UserSkill.ins().getSkillIdIcon(cfg.skillId);this["skillIcon1"].source=UserSkill.ins().getSkillIdIcon(cfg.skillId)}this.redPoint.visible=ExtremeEquipModel.ins().canOperate(job,subType);this.updateBtn.label=i18n("ExtremeEquipPanel_10")}if(subType==EquipPos.WEAPON||subType==EquipPos.CLOTHES){if(!this.skill_0_0.parent){this.group0.addChild(this.skill_0_0)}if(!this.skill_1_0.parent){this.group1.addChild(this.skill_1_0)}if(!this.skill_2_0.parent){this.group3.addChild(this.skill_2_0)}}else{if(this.skill_0_0.parent)this.skill_0_0.parent.removeChild(this.skill_0_0);if(this.skill_1_0.parent)this.skill_1_0.parent.removeChild(this.skill_1_0);if(this.skill_2_0.parent)this.skill_2_0.parent.removeChild(this.skill_2_0)}this.setEff(subType);this.selectList();this.onChange()};ExtremeEquipPanel.prototype.setEff=function(subType){if(!this.mc1)this.mc1=new MovieClip;if(!this.mc1.parent)this.extreme_eff.addChild(this.mc1);if(!this.mc2)this.mc2=new MovieClip;if(!this.mc2.parent)this.extreme_eff_bottom.addChild(this.mc2);this.mc1.playFile(RES_DIR_EFF+("extrme_eff_0"+subType),-1);this.mc2.playFile(RES_DIR_EFF+"extrme_eff_bottom",-1)};ExtremeEquipPanel.prototype.selectList=function(){var count=this.menuList.dataProvider.length;for(var i=0;i<count;i++){var item=this.menuList.getElementAt(i);if(item){if(i!=this.menuList.selectedIndex){item.setSelect(false)}else{item.setSelect(true)}}}};ExtremeEquipPanel.getChainAddPower=function(subType,zhiZunLv,curRole){if(!zhiZunLv)return 0;var zzel=GlobalConfig.ZhiZunEquipLevel[subType][zhiZunLv];if(!zzel)return 0;var secPos=ExtremeEquipModel.ins().getLinkEquipPos(subType);var zzll=GlobalConfig.ZhiZunLinkLevel[subType][secPos][zzel.soulLinkLevel];if(!zzll)return 0;var temp=0;var role=SubRoles.ins().getSubRoleByIndex(curRole);if(zzll.attrs){temp+=UserBag.getAttrPower(zzll.attrs);for(var i in zzll.attrs){temp+=ItemConfig.relatePower(zzll.attrs[i],role)}}var ex_power=zzll.ex_power?zzll.ex_power:0;temp=Math.floor(temp)+ex_power;return temp};ExtremeEquipPanel.prototype.close=function(){GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack);ViewManager.ins().getView(AdvanEquipWin).isNotMove=false};return ExtremeEquipPanel}(BaseView);__reflect(ExtremeEquipPanel.prototype,"ExtremeEquipPanel");var ExtremeEquipTipsWin=function(_super){__extends(ExtremeEquipTipsWin,_super);function ExtremeEquipTipsWin(){var _this=_super.call(this)||this;_this.skinName="ExtremeEquipTipsSkin";_this.isTopLevel=true;return _this}ExtremeEquipTipsWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.posId=args[0];this.addTouchEvent(this.bgClose,this.onTouch);this.updateTips()};ExtremeEquipTipsWin.prototype.updateTips=function(){this.pos.text=Role.getEquipNameByType(this.posId);var config=GlobalConfig.ZhiZunEquipLevel[this.posId][1];var id=config.materialInfo.id;var itemConfig=GlobalConfig.ItemConfig[id];this.nameLabel.text=itemConfig.name;this.itemIcon.setData(itemConfig);this.powerPanel.setPower(config.showPower);for(var i in config.attrs){if(this["attr"+config.attrs[i].type])this["attr"+config.attrs[i].type].text=config.attrs[i].value}if(this.posId==EquipPos.WEAPON||this.posId==EquipPos.CLOTHES){this.chainName.text=ExtremeEquipModel.ins().getSkillName(this.posId);this.chainPos.textFlow=TextFlowMaker.generateTextFlow1(StringUtils.replaceStrColor(ExtremeEquipModel.ins().getSkillDesc(this.posId),"0xdd49ac"))}else{DisplayUtils.removeFromParent(this.chainGroup)}var secPos=ExtremeEquipModel.ins().getLinkEquipPos(this.posId);var zzll=GlobalConfig.ZhiZunLinkLevel[this.posId][secPos][1];this.soulAttr.textFlow=TextFlowMaker.generateTextFlow1(StringUtils.replaceStrColor(zzll.chainDesc,"0xdd49ac"))};ExtremeEquipTipsWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch)};ExtremeEquipTipsWin.prototype.onTouch=function(e){ViewManager.ins().close(this)};return ExtremeEquipTipsWin}(BaseEuiView);__reflect(ExtremeEquipTipsWin.prototype,"ExtremeEquipTipsWin");ViewManager.ins().reg(ExtremeEquipTipsWin,LayerManager.UI_Popup);var ExtremeSkillTipsWin=function(_super){__extends(ExtremeSkillTipsWin,_super);function ExtremeSkillTipsWin(){var _this=_super.call(this)||this;_this.skinName="YupeiSkillTipsNewSkin";_this.isTopLevel=true;return _this}ExtremeSkillTipsWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.nameLabel.text=args[0];this.description.textFlow=TextFlowMaker.generateTextFlow1(args[1]);this.addTouchEvent(this.bgClose,this.onTouch)};ExtremeSkillTipsWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch)};ExtremeSkillTipsWin.prototype.onTouch=function(e){ViewManager.ins().close(this)};return ExtremeSkillTipsWin}(BaseEuiView);__reflect(ExtremeSkillTipsWin.prototype,"ExtremeSkillTipsWin");ViewManager.ins().reg(ExtremeSkillTipsWin,LayerManager.UI_Main);var ExtremeEquipItem=function(_super){__extends(ExtremeEquipItem,_super);function ExtremeEquipItem(){return _super!==null&&_super.apply(this,arguments)||this}ExtremeEquipItem.prototype.dataChanged=function(){var subType=this.data;this.redPoint.visible=ExtremeEquipModel.ins().canOperate(ExtremeEquipModel.ins().selectJob,subType);var zhiZunLv=ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,subType);var desc;if(zhiZunLv<=0){desc=ExtremeEquipModel.ins().descNames[subType]}else{desc=ExtremeEquipModel.ins().descNames[subType]}this.nameLabel.text=desc;this.selectIcon.visible=this.selected;this.itemIcon.source="icon_extreme_0"+subType};ExtremeEquipItem.prototype.setSelect=function(isSelect){this.selectIcon.visible=isSelect};return ExtremeEquipItem}(ItemRenderer);__reflect(ExtremeEquipItem.prototype,"ExtremeEquipItem");var FanTiGuanzhuWin=function(_super){__extends(FanTiGuanzhuWin,_super);function FanTiGuanzhuWin(){var _this=_super.call(this)||this;_this.skinName="fantiguanzhuSkin";_this.isTopLevel=true;return _this}FanTiGuanzhuWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.itemlist.itemRenderer=ItemBase};FanTiGuanzhuWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.bg,this.onTap);this.addTouchEvent(this.guanzhufbBtn,this.onTap);this.initDataShow()};FanTiGuanzhuWin.prototype.initDataShow=function(){var rewardList=GlobalConfig.QzoneShareConfig[15];this.itemlist.dataProvider=new eui.ArrayCollection(rewardList.awards)};FanTiGuanzhuWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bg:case this.closeBtn:ViewManager.ins().close(this);break;case this.guanzhufbBtn:window.open("https://www.facebook.com/103173315068974/","newwindow");break}};return FanTiGuanzhuWin}(BaseEuiView);__reflect(FanTiGuanzhuWin.prototype,"FanTiGuanzhuWin");ViewManager.ins().reg(FanTiGuanzhuWin,LayerManager.UI_Main);var FanTiSuperVipWin=function(_super){__extends(FanTiSuperVipWin,_super);function FanTiSuperVipWin(){var _this=_super.call(this)||this;_this.dayrechargeNum=1e5;_this.totalrechargeNum=5e5;_this.skinName="fantisuperVipSkin";_this.isTopLevel=true;return _this}FanTiSuperVipWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};FanTiSuperVipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bg,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.goRechargeBtn,this.onTap);this.notlinetxt.visible=this.notwechattxt.visible=true;this.linetxt.visible=this.wechattxt.visible=false;this.group1.visible=this.group2.visible=true;this.group3.visible=false;this.initDataShow()};FanTiSuperVipWin.prototype.initDataShow=function(){var vipData=UserVip.ins();var rechargedata=Recharge.ins().getRechargeData(0);var config=GlobalConfig.VipConfig[vipData.lv];var curNeedYb=vipData.exp;this.value1.text="("+rechargedata.curDayPay+"/100000)";this.value2.text="("+curNeedYb+"/500000)";this.isShowWechatTxt(rechargedata.curDayPay,curNeedYb)};FanTiSuperVipWin.prototype.isShowWechatTxt=function(daypay,totalpay){if(daypay>=this.dayrechargeNum||totalpay>=this.totalrechargeNum){this.linetxt.visible=this.wechattxt.visible=true;this.notlinetxt.visible=this.notwechattxt.visible=false;this.group1.visible=this.group2.visible=false;this.group3.visible=true}};FanTiSuperVipWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bg:case this.closeBtn:ViewManager.ins().close(this);break;case this.goRechargeBtn:ViewManager.ins().open(Recharge1Win);break}};return FanTiSuperVipWin}(BaseEuiView);__reflect(FanTiSuperVipWin.prototype,"FanTiSuperVipWin");ViewManager.ins().reg(FanTiSuperVipWin,LayerManager.UI_Main);var FbModel=function(){function FbModel(){}FbModel.prototype.parser=function(bytes){this.fbID=bytes.readInt();this.useCount=bytes.readShort();this.vipBuyCount=bytes.readShort();this.vipHoldCount=bytes.readShort();this.isPass=bytes.readBoolean()};FbModel.prototype.getCount=function(){if(Assert(!isNaN(this.fbID),"fbid is undefined")){return 0}var config=GlobalConfig.DailyFubenConfig[this.fbID];if(Assert(config,"DailyFubenConfig is null")){return 0}if(config.zsLevel>0){if(UserZs.ins().lv<config.zsLevel)return 0}else{if(Actor.level<config.levelLimit)return 0}return config.freeCount+this.vipBuyCount+this.vipHoldCount-this.useCount};FbModel.prototype.getPlayCount=function(){if(Assert(!isNaN(this.fbID),"fbid is undefined")){return 0}var config=GlobalConfig.DailyFubenConfig[this.fbID];if(Assert(config,"DailyFubenConfig is null")){return 0}return config.freeCount+this.vipBuyCount+this.vipHoldCount-this.useCount};FbModel.prototype.getNextVip=function(){if(Assert(!isNaN(this.fbID),"fbid is undefined")){return-1}var config=GlobalConfig.DailyFubenConfig[this.fbID];if(Assert(config,"DailyFubenConfig is null")){return-1}for(var i in config.vipBuyCount){if(this.useCount-config.freeCount-config.vipBuyCount[i]<0)return parseInt(i)}return-1};FbModel.prototype.getResetCount=function(){var vip=UserVip.ins().lv;var config=GlobalConfig.DailyFubenConfig[this.fbID];return config.vipBuyCount[vip]-(this.useCount-config.freeCount)};return FbModel}();__reflect(FbModel.prototype,"FbModel");var FbRedPoint=function(_super){__extends(FbRedPoint,_super);function FbRedPoint(){var _this=_super.call(this)||this;_this.isOpen=true;_this.registerTab(0,UserFb.ins().postFbInfoInit,UserFb.ins().postUpDataInfo,DieGuide.ins().postdieGuide,Actor.ins().postExp);_this.registerTab(1,UserFb.ins().postFbExpInfo,HardFb.ins().postInfo);_this.registerTab(2,UserFb2.ins().postUpDataInfo);_this.registerTab(3,BattleCC.ins().postOpenInfo,Actor.ins().postLevelChange,PaoDianCC.ins().postOpenInfo,BattleGround.ins().postOpenInfo);_this.registerTab(4,UserZs.ins().postZsLv,GameApp.ins().postZeroInit,UserFb.ins().postGuardInfo);_this.registerTab(5,UserFb.ins().postFbRingInfo);return _this}FbRedPoint.prototype.getTabRedPoint=function(tab){if(tab==0)return UserFb.ins().hasCount();else if(tab==1)return UserFb.ins().fbExpRed()||HardFb.ins().getRedPoint();else if(tab==2)return SkyLevelModel.ins().cruLevel>1&&SkyLevelModel.ins().dayReward==1||SkyLevelModel.ins().lotteryRemainTimes>0;else if(tab==3)return BattleCC.ins().checkRedPoint()||PaoDianCC.ins().checkRedPoint()||BattleGround.ins().checkRedPoint();else if(tab==4)return GuardWeaponModel.ins().canChallenge();else if(tab==5)return SpecialRing.ins().fireRingRedPoint();return false};return FbRedPoint}(RedPointBase);__reflect(FbRedPoint.prototype,"FbRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.fbredpoint=FbRedPoint.ins.bind(FbRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var HardFb=function(_super){__extends(HardFb,_super);function HardFb(){var _this=_super.call(this)||this;_this.world_first_reward_ids=[];_this.world_reward_ids=[];_this.stage_reward_ids=[];_this.world_first_reward_avail_ids=[];_this.world_reward_avail_ids=[];_this.player_list=[];_this.sysId=PackageID.HardFb;_this.regNetMsg(1,_this.postInfo);_this.regNetMsg(2,_this.postPlayerList);return _this}HardFb.ins=function(){return _super.ins.call(this)};HardFb.prototype.getMaxLevel=function(){if(this.maxLevel==null){var maxLevel=0;var cfg=GlobalConfig.ChapterHardConfig;for(var k in cfg){if(""+parseInt(k)==k){maxLevel+=1}}this.maxLevel=maxLevel}return this.maxLevel};HardFb.prototype.getConfigByLevel=function(id){var cfgs=GlobalConfig.ChapterHardConfig;for(var k in cfgs){var cfg=cfgs[k];if(cfg.id==id){return cfg}}return null};HardFb.prototype.canGetWorldFirstReward=function(){return this.world_reward_avail_ids!=null&&this.world_reward_avail_ids.length>0||this.world_first_reward_avail_ids!=null&&this.world_first_reward_avail_ids.length>0};HardFb.prototype.canGetFirstReward=function(){var cfgs=GlobalConfig.ChapterHardFirstConfig;for(var k in cfgs){if(""+parseInt(k)==k){var cfg=cfgs[k];var id=cfg.id;var get=this.pass_id>=cfg.check;var got=this.stage_reward_ids&&this.stage_reward_ids.indexOf(id)>=0;if(get&&!got){return true}}}return false};HardFb.prototype.canFreeSweep=function(){var canSweep=this.pass_id>=1;var hasFreeSweep=this.left_free_sweep_cnt>0;return canSweep&&hasFreeSweep};HardFb.prototype.getRedPoint=function(){return this.canGetFirstReward()||this.canGetWorldFirstReward()||this.canFreeSweep()};HardFb.prototype.readIntArray=function(bytes){var count=bytes.readShort();var result=[];for(var i=0;i<count;++i){result.push(bytes.readInt())}return result};HardFb.prototype.sendGetInfo=function(){this.sendBaseProto(1)};HardFb.prototype.send_get_first_reward=function(id){var bytes=this.getBytes(5);bytes.writeInt(id);this.sendToServer(bytes)};HardFb.prototype.send_get_world_reward=function(id){var bytes=this.getBytes(6);bytes.writeInt(id);this.sendToServer(bytes)};HardFb.prototype.send_get_stage_reward=function(id){var bytes=this.getBytes(7);bytes.writeInt(id);this.sendToServer(bytes)};HardFb.prototype.postInfo=function(bytes){this.chapter_level=bytes.readInt();this.pass_id=bytes.readInt();this.left_free_sweep_cnt=bytes.readInt();this.left_yb_sweep_cnt=bytes.readInt();this.world_first_reward_ids=this.readIntArray(bytes);this.world_reward_ids=this.readIntArray(bytes);this.stage_reward_ids=this.readIntArray(bytes);this.world_first_reward_avail_ids=this.readIntArray(bytes);this.world_reward_avail_ids=this.readIntArray(bytes)};HardFb.prototype.sendGetPlayerList=function(){this.sendBaseProto(2)};HardFb.prototype.postPlayerList=function(bytes){var count=bytes.readShort();var result=[];for(var i=0;i<count;++i){var id=bytes.readShort();var actorId=bytes.readInt();var actorName=bytes.readString();var pass_id=bytes.readInt();result.push({id:id,actorId:actorId,actorName:actorName,pass_id:pass_id})}this.player_list=result};HardFb.prototype.sendChallenge=function(){this.sendBaseProto(3)};HardFb.prototype.sendSweep=function(useYb){var bytes=this.getBytes(4);bytes.writeByte(useYb);this.sendToServer(bytes)};return HardFb}(BaseSystem);__reflect(HardFb.prototype,"HardFb");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.hardFb=HardFb.ins.bind(HardFb)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var MapType;(function(MapType){MapType[MapType["chapterMap"]=0]="chapterMap";MapType[MapType["bigMap"]=1]="bigMap"})(MapType||(MapType={}));window["MapType"]=MapType;var SpeakType;(function(SpeakType){SpeakType[SpeakType["appear"]=1]="appear";SpeakType[SpeakType["hit"]=2]="hit";SpeakType[SpeakType["die"]=3]="die"})(SpeakType||(SpeakType={}));window["SpeakType"]=SpeakType;var MonsterSpeak=function(_super){__extends(MonsterSpeak,_super);function MonsterSpeak(){var _this=_super.call(this)||this;_this.speakDic={};_this.observe(GameLogic.ins().postHpChange,function(_a){var target=_a[0],value=_a[1];if(GameMap.fubenID!=40001)return;if(target instanceof CharRole)return;_this.trigger(target.infoModel.configID,value>0?SpeakType.hit:SpeakType.die)});return _this}MonsterSpeak.ins=function(){return _super.ins.call(this)};MonsterSpeak.prototype.clear=function(){this.speakDic={}};MonsterSpeak.prototype.trigger=function(monsterID,action){if(this.speakDic[monsterID]&&this.speakDic[monsterID][action]){return}if(!GlobalConfig.MonsterSpeakConfig)return;var config=GlobalConfig.MonsterSpeakConfig[monsterID];if(config&&config[action]){this.postMonsterSpeak(config[action].speak);this.speakDic[monsterID]=this.speakDic[monsterID]||{};this.speakDic[monsterID][action]=1}};MonsterSpeak.prototype.postMonsterSpeak=function(tips){return tips};return MonsterSpeak}(BaseSystem);__reflect(MonsterSpeak.prototype,"MonsterSpeak");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.monsterSpeak=MonsterSpeak.ins.bind(MonsterSpeak)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SkyLevelModel=function(){function SkyLevelModel(){this.cruLevel=1;this.lastPass=false;this.stageLevel=1;this.dayReward=1;this.limitTime=180;this.rewardTimes=0}SkyLevelModel.ins=function(){if(!this._instance){this._instance=new SkyLevelModel}return this._instance};Object.defineProperty(SkyLevelModel.prototype,"lotteryRemainTimes",{get:function(){var remain=0;var cfg;if(this.cruLevel!=0&&!this.lastPass){cfg=GlobalConfig.FbChallengeConfig[this.cruLevel-1];if(this.cruLevel-1<GlobalConfig.FbChallengeBaseConfig.LotteryOpenLevel)return 0}else{var len=Object.keys(GlobalConfig.FbChallengeConfig).length;cfg=GlobalConfig.FbChallengeConfig[len]}if(!cfg)return 0;remain=cfg.lotteryCount-this.lotteryUseTimes;return remain},enumerable:true,configurable:true});SkyLevelModel.prototype.isGetLotteryAward=function(index){return(this.lotteryIndexs>>index&1)==1};SkyLevelModel.prototype.getNextOpenLevel=function(){var cfgList=GlobalConfig.FbChallengeConfig;for(var id in cfgList){if(cfgList[id].id>=this.cruLevel&&cfgList[id].showIcon){return cfgList[id]}}return null};SkyLevelModel.prototype.getCurOpenLevel=function(){var cfgList=GlobalConfig.FbChallengeConfig;for(var id in cfgList){if(cfgList[id].id==this.cruLevel){return cfgList[id]}}return null};SkyLevelModel.prototype.getIsopenNext=function(){var cfgList=GlobalConfig.FbChallengeConfig;var cfg=cfgList[this.cruLevel];var zs=UserZs.ins()?UserZs.ins().lv:0;if(Actor.level>=cfg.levelLimit&&zs>=cfg.zsLevelLimit)return true;return false};SkyLevelModel.prototype.getSkyLevelList=function(){var dataList=[];var info=GlobalConfig.FbChallengeConfig;var cruInfo=info[this.cruLevel];var stageList=this.getStageList();var len=CommonUtils.getObjectLength(stageList);for(var str in stageList){var cfg=stageList[str];if(this.checkIsPushInlist(cruInfo.layer,cfg.layer,len)){dataList.push(cfg);if(dataList.length>=6){break}}}dataList.reverse();return dataList};SkyLevelModel.prototype.setLimtTimeDown=function(num){this.limitTime=num;TimerManager.ins().remove(this.timeDown,this);TimerManager.ins().doTimer(1e3,num,this.timeDown,this)};SkyLevelModel.prototype.timeDown=function(){this.limitTime--;if(this.limitTime<0){this.limitTime=0;TimerManager.ins().remove(this.timeDown,this)}};SkyLevelModel.prototype.checkIsPushInlist=function(id,layeId,len){if(id<=4){return true}else if(id>4){var downNum=len-id>=3?3:len-id;var upNum=6-downNum;var minLv=id-upNum;var maxLv=id+downNum;return layeId<=maxLv&&layeId>minLv}};SkyLevelModel.prototype.getStageList=function(){var info=GlobalConfig.FbChallengeConfig;var cruInfo=info[this.cruLevel];this.stageLevel=cruInfo.group;var list=[];if(!cruInfo){return list}for(var str in info){var data=info[str];if(data.group==cruInfo.group){list.push(data)}}return list};SkyLevelModel.prototype.setCruLevelInfo=function(level){if(level>0){this.cruLevel=level;this.lastPass=false}else{this.cruLevel=CommonUtils.getObjectLength(GlobalConfig.FbChallengeConfig);this.lastPass=true}};return SkyLevelModel}();__reflect(SkyLevelModel.prototype,"SkyLevelModel");var DynamicChange=function(){function DynamicChange(){this._dataCache=[];this._pUpdate=new ProxyUpdate(this._dataCache)}Object.defineProperty(DynamicChange.prototype,"pUpdate",{get:function(){return this._pUpdate},enumerable:true,configurable:true});DynamicChange.prototype.getCacheData=function(key){if(this._dataCache[key]){return this._dataCache[key]}return null};DynamicChange.prototype.clearCache=function(){var keys=Object.keys(this._dataCache);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];this._dataCache[key]=null;delete this._dataCache[key]}};DynamicChange.prototype.getCacheKeyInfos=function(){var results=[];var keys=Object.keys(this._dataCache);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];var k=this._dataCache[key];results.push(k)}return results};DynamicChange.prototype.isCache=function(key){return this._dataCache[key]};return DynamicChange}();__reflect(DynamicChange.prototype,"DynamicChange");var UserFb2=function(_super){__extends(UserFb2,_super);function UserFb2(){var _this=_super.call(this)||this;_this.sysId=PackageID.FbChallenge;_this.regNetMsg(1,_this.postUpDataInfo);_this.regNetMsg(2,_this.postRewardStatu);_this.regNetMsg(3,_this.doGetFbTime);_this.regNetMsg(4,_this.postGetReward);_this.regNetMsg(5,_this.postLotteryReward);return _this}UserFb2.ins=function(){return _super.ins.call(this)};UserFb2.prototype.sendChallenge=function(){this.sendBaseProto(1)};UserFb2.prototype.sendrequestDayReward=function(){this.sendBaseProto(2)};UserFb2.prototype.postUpDataInfo=function(bytes){SkyLevelModel.ins().setCruLevelInfo(bytes.readInt());SkyLevelModel.ins().dayReward=bytes.readShort();SkyLevelModel.ins().lotteryIndexs=bytes.readInt();SkyLevelModel.ins().lotteryUseTimes=bytes.readInt()};UserFb2.prototype.postRewardStatu=function(bytes){var count=bytes.readShort();SkyLevelModel.ins().dayRewardList=[];for(var i=0;i<count;i++){var subType=bytes.readInt();var subId=bytes.readInt();var subCount=bytes.readInt();SkyLevelModel.ins().dayRewardList[i]=[subType,subId,subCount]}SkyLevelModel.ins().rewardTimes=Math.ceil((count-12)/12)};UserFb2.prototype.doGetFbTime=function(bytes){SkyLevelModel.ins().setLimtTimeDown(bytes.readShort())};UserFb2.prototype.sendGetDayReward=function(){this.sendBaseProto(4)};UserFb2.prototype.sendBeginLottery=function(){this.sendBaseProto(5)};UserFb2.prototype.sendGetReward=function(){this.sendBaseProto(6)};UserFb2.prototype.postLotteryReward=function(bytes){SkyLevelModel.ins().lotteryUseTimes=bytes.readInt();SkyLevelModel.ins().lotteryAwardIndex=bytes.readInt()};UserFb2.prototype.postGetReward=function(bytes){};return UserFb2}(BaseSystem);__reflect(UserFb2.prototype,"UserFb2");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userfb2=UserFb2.ins.bind(UserFb2)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var WaveDropData=function(){function WaveDropData(){this.drops=[]}WaveDropData.prototype.parser=function(bytes){var count=1;for(var i=0;i<count;i++){this.drops[i]=this.drops[i]||new RewardData;this.drops[i].parser(bytes)}this.drops.length=count};return WaveDropData}();__reflect(WaveDropData.prototype,"WaveDropData");var BabelLotteryWin=function(_super){__extends(BabelLotteryWin,_super);function BabelLotteryWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="tttZhuanpan";return _this}BabelLotteryWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addCustomEvent();this.updateView()};BabelLotteryWin.prototype.addCustomEvent=function(){this.addTouchEvent(this.choujiangBtn,this.getLottery);this.addTouchEvent(this.closeBtn,this.close);this.observe(UserFb2.ins().postLotteryReward,this.onGetRewards);this.observe(UserFb2.ins().postUpDataInfo,this.refreshView)};BabelLotteryWin.prototype.getLottery=function(){if(SkyLevelModel.ins().lotteryRemainTimes==0){UserTips.ins().showTips(i18n("BabelLotteryWin_0"))}else if(this.rolling){UserTips.ins().showTips(i18n("BabelLotteryWin_1"))}else{UserFb2.ins().sendBeginLottery()}};BabelLotteryWin.prototype.onGetRewards=function(){this.beginLottery(SkyLevelModel.ins().lotteryAwardIndex)};BabelLotteryWin.prototype.refreshView=function(){var _this=this;if(SkyLevelModel.ins().lotteryUseTimes%10==0){setTimeout(function(){_this.updateView()},2e3)}else{this.updateView()}};BabelLotteryWin.prototype.beginLottery=function(index){var _this=this;var rotat=360*4+(index-1)*36;var tween=egret.Tween.get(this.tttzhi);this.rolling=true;tween.to({rotation:rotat},4e3,egret.Ease.circOut).call(function(){UserFb2.ins().sendGetReward();_this.flyItem(_this["item"+(index-1)]);setTimeout(function(){_this.rolling=false;_this.refreshView()},2e3)},this)};BabelLotteryWin.prototype.flyItem=function(item){var itemBase=new ItemBase;itemBase.x=item.x;itemBase.y=item.y;itemBase.data=item.itemIcon.data;itemBase.anchorOffsetX=itemBase.width/2;itemBase.anchorOffsetY=itemBase.height/2;item.parent.addChild(itemBase);GameLogic.ins().postFlyItemEx(itemBase)};BabelLotteryWin.prototype.updateView=function(){this.num.text=SkyLevelModel.ins().lotteryRemainTimes.toString();var index=SkyLevelModel.ins().lotteryUseTimes;var m=parseInt((index/10).toString())*10+10;var max=CommonUtils.getObjectLength(GlobalConfig.FbChallengeConfig);if(m>max){m=max}var cfg=GlobalConfig.FbChallengeLotteryConfig[m];if(!cfg){return}var count=cfg.group.length;for(var i=0;i<count;i++){var item=this["item"+i];item.itemIcon.data=cfg.group[i];var isGet=SkyLevelModel.ins().isGetLotteryAward(i+1);item.rewardState(isGet)}};return BabelLotteryWin}(BaseEuiView);__reflect(BabelLotteryWin.prototype,"BabelLotteryWin");ViewManager.ins().reg(BabelLotteryWin,LayerManager.UI_Main);var d_launchX=180;window["d_launchX"]=d_launchX;var d_launchY=500;window["d_launchY"]=d_launchY;var d_firstX=0;window["d_firstX"]=d_firstX;var d_firstY=0;window["d_firstY"]=d_firstY;var d_distantX=77;window["d_distantX"]=d_distantX;var d_distantY=93;window["d_distantY"]=d_distantY;var d_depotX=320;window["d_depotX"]=d_depotX;var d_depotY=620;window["d_depotY"]=d_depotY;var d_waitTime=50;window["d_waitTime"]=d_waitTime;var ChallengeDayRewardWin=function(_super){__extends(ChallengeDayRewardWin,_super);function ChallengeDayRewardWin(){var _this=_super.call(this)||this;_this.arr=[];_this.items=[];_this.maxCount=12;_this.isTopLevel=true;_this.skinName="chuangtianguanDayReward";return _this}ChallengeDayRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.GetRewardBtn0,this.challenge);this.addTouchEvent(this.bgClose,this.closeCB);this.addTouchEvent(this.closeBtn,this.closeCB);this.observe(UserFb2.ins().postRewardStatu,this.setBtnStatu);UserFb2.ins().sendrequestDayReward()};ChallengeDayRewardWin.prototype.challenge=function(){var func=function(){UserFb2.ins().sendGetDayReward()};this.playGet(func);this.canClicck=false};ChallengeDayRewardWin.prototype.setBtnStatu=function(){if(SkyLevelModel.ins().rewardTimes>=1){this.GetRewardBtn0.label=i18n("ChallengeDayRewardWin_0",SkyLevelModel.ins().rewardTimes)}else{this.GetRewardBtn0.label=i18n("ChallengeDayRewardWin_1")}this.arr=SkyLevelModel.ins().dayRewardList.slice();this.playResult();var level=SkyLevelModel.ins().cruLevel;var cfg=GlobalConfig.FbChallengeConfig[level];var dayRewardBuff=cfg.dayRewardBuff||[];var count=dayRewardBuff[0]&&dayRewardBuff[0].count||0;this.plusGroup.visible=count>0;this.plus.text=count.toString()};ChallengeDayRewardWin.prototype.playResult=function(fun){var _this=this;var count=this.arr.length>this.maxCount?this.maxCount:this.arr.length;for(var i=0;i<count;i++){this.items[i]=this.createItem(this.arr[i]);var t=egret.Tween.get(this.items[i]);this.items[i].x=i%4*d_distantX+d_firstX;this.items[i].y=Math.floor(i/4)*d_distantY+d_firstY;this.items[i].alpha=0;t.wait(i*d_waitTime).to({alpha:1},200).call(function(){count--;if(count==0){if(fun!=undefined){fun()}_this.canClicck=true}})}};ChallengeDayRewardWin.prototype.playGet=function(fun){var _this=this;var count=this.arr.length>this.maxCount?this.maxCount:this.arr.length;for(var i=0;i<count;i++){if(!this.items[i])continue;var t=egret.Tween.get(this.items[i]);t.to({y:d_depotY,x:d_depotX,scaleX:0,scaleY:0},300-Math.floor(i/4)*50).call(function(){count--;if(count==0){if(fun!=undefined){fun()}_this.releaseAllItem()}})}};ChallengeDayRewardWin.prototype.createItem=function(data){var item=new ItemBase;this.listCon.addChild(item);item.data={type:data[0],count:data[2],id:data[1]};item.x=d_launchX;item.y=d_launchY;return item};ChallengeDayRewardWin.prototype.releaseAllItem=function(){for(var k in this.items){this.items[k].destruct();this.listCon.removeChild(this.items[k])}this.items=[];if(SkyLevelModel.ins().rewardTimes==0){ViewManager.ins().close(ChallengeDayRewardWin)}};ChallengeDayRewardWin.prototype.closeCB=function(e){var _this=this;if(!this.canClicck){return}this.canClicck=false;var func=function(){ViewManager.ins().close(_this)};this.playGet(func)};return ChallengeDayRewardWin}(BaseEuiView);__reflect(ChallengeDayRewardWin.prototype,"ChallengeDayRewardWin");ViewManager.ins().reg(ChallengeDayRewardWin,LayerManager.UI_Main);var ChallengeInfoPanel=function(_super){__extends(ChallengeInfoPanel,_super);function ChallengeInfoPanel(){return _super.call(this)||this}ChallengeInfoPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ChuangtianguanBloodSkin";this.list.itemRenderer=ItemBase};ChallengeInfoPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var dalay=GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU?Hungu.ins().getHunShouFbLeftTime():SkyLevelModel.ins().limitTime;this.time.text=DateUtils.getFormatBySecond(dalay,3);TimerManager.ins().doTimer(1e3,dalay,this.setTimeLimit,this);this.refushInfo()};ChallengeInfoPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};ChallengeInfoPanel.prototype.refushInfo=function(){var info=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel+1];if(info){this.levelLimit.text=info.zsLevelLimit>0?i18n("ChallengeInfoPanel_0",info.zsLevelLimit):""+i18n("ChallengeInfoPanel_1",info.levelLimit);this.setTimeLimit()}};ChallengeInfoPanel.prototype.setTimeLimit=function(){var dalay=GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU?Hungu.ins().getHunShouFbLeftTime():SkyLevelModel.ins().limitTime;this.time.text=DateUtils.getFormatBySecond(dalay,3)};return ChallengeInfoPanel}(BaseEuiView);__reflect(ChallengeInfoPanel.prototype,"ChallengeInfoPanel");ViewManager.ins().reg(ChallengeInfoPanel,LayerManager.Game_Main);var assert=egret.assert;window["assert"]=assert;var FBChallengePanel=function(_super){__extends(FBChallengePanel,_super);function FBChallengePanel(){var _this=_super.call(this)||this;_this.name=i18n("FBChallengePanel_0");return _this}FBChallengePanel.prototype.childrenCreated=function(){this.list.itemRenderer=SkyItemRenderer;this.iconList.itemRenderer=ItemBase;this.iconList0.itemRenderer=ItemBase};FBChallengePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.challengeBtn,this.challenge);this.addTouchEvent(this.challengeBtn0,this.getDayRewward);this.addTouchEvent(this.jump,this.onClick);this.addTouchEvent(this.choujiang,this.lotto);this.refushPanelInfo();this.observe(FbRedPoint.ins().postTabs,this.updateRedPoint);this.observe(UserFb2.ins().postGetReward,this.updateReward);this.observe(Rank.ins().postRankingData,this.initRanking);this.observe(UserFb2.ins().postUpDataInfo,this.updateRedPointStyle);Rank.ins().sendGetRankingData(RankDataType.TYPE_FUWENTA);this.updateRedPoint(2);this.showRewwardLabel()};FBChallengePanel.prototype.updateRedPointStyle=function(){this.redPoint0.visible=SkyLevelModel.ins().cruLevel>1&&SkyLevelModel.ins().dayReward==1;this.redPoint1.visible=SkyLevelModel.ins().lotteryRemainTimes>0;this.updateTowerState()};FBChallengePanel.prototype.lotto=function(e){if(SkyLevelModel.ins().cruLevel==0&&SkyLevelModel.ins().rewardTimes==0){UserTips.ins().showTips(i18n("FBChallengePanel_1"))}else{if(SkyLevelModel.ins().lastPass&&SkyLevelModel.ins().lotteryRemainTimes==0){console.log("SkyLevelModel.ins().lastPass == true && SkyLevelModel.ins().lotteryRemainTimes == 0");return}ViewManager.ins().open(BabelLotteryWin)}};FBChallengePanel.prototype.destructor=function(){this.removeObserve();this.removeTouchEvent(this.challengeBtn,this.challenge);this.removeTouchEvent(this.challengeBtn0,this.getDayRewward);this.removeTouchEvent(this.jump,this.onClick)};FBChallengePanel.prototype.updateReward=function(){this.showRewwardLabel()};FBChallengePanel.prototype.initRanking=function(model){if(model.type!=RankDataType.TYPE_FUWENTA){return}this.rankModel=model;var rankDataList=model.getDataList();for(var i=1;i<=3;i++){var rankdata=rankDataList[i-1];if(rankdata){this["name"+(i-1)].text=rankdata.player;var info=GlobalConfig.FbChallengeConfig[rankdata.count];if(!Assert(info,i18n("FBChallengePanel_2",rankdata.count))){this["num"+(i-1)].text=i18n("FBChallengePanel_3",info.group,info.layer)}else{this["num"+(i-1)].text=""}}else{this["rankImg"+(i-1)].visible=this["name"+(i-1)].visible=this["num"+(i-1)].visible=false}}var tet=this.jump.text;this.jump.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+tet)};FBChallengePanel.prototype.refushPanelInfo=function(){var dataList=SkyLevelModel.ins().getSkyLevelList();this.list.dataProvider=new eui.ArrayCollection(dataList);this.nameLabel.text=UserFb.ins().getFbChName(SkyLevelModel.ins().stageLevel);var model=SkyLevelModel.ins();var curCfg=model.getCurOpenLevel();var nextCfg=model.getNextOpenLevel();if(nextCfg){var nextName=UserFb.ins().getFbChName(nextCfg.group);var str=i18n("FBChallengePanel_4",nextName,nextCfg.layer);var des="";if(curCfg.buffDescribe){var endstr="";this.itemicon.desc=i18n("FBChallengePanel_8",nextName,nextCfg.layer);if(nextCfg.showIcon){this.itemicon.data=nextCfg.showIcon}var type=curCfg.buffDescribe[0];var value=curCfg.buffDescribe[1];switch(type){case 1:endstr=i18n("FBChallengePanel_20",value);break;case 2:endstr=i18n("FBChallengePanel_21",value);break;case 3:endstr=i18n("FBChallengePanel_22",value);break;case 4:endstr=i18n("FBChallengePanel_23",value);break}this.unlock.text=endstr}else if(nextCfg.equipPos){des=i18n("FBChallengePanel_5",nextCfg.equipPos);this.noOpenTF.text=des;this.unlock.text=i18n("FBChallengePanel_6");this.itemicon.runeName=des;this.itemicon.desc2=i18n("FBChallengePanel_7",nextName,nextCfg.layer);this.itemicon.data=nextCfg.showIcon}else{this.itemicon.desc=i18n("FBChallengePanel_8",nextName,nextCfg.layer);this.itemicon.data=nextCfg.showIcon;var cfg=GlobalConfig.ItemConfig[nextCfg.showIcon];var runeType=ItemConfig.getQuality(cfg);var endstr=i18n("FBChallengePanel_9");if(runeType==FBChallengePanel.RunType)endstr=i18n("FBChallengePanel_10");this.unlock.text=endstr}this.openDesc.text=str}else{this.topGroup.visible=false;this.buttomGroup.verticalCenter=0}var info=GlobalConfig.FbChallengeConfig[model.cruLevel];if(info){this.nowrawed.text=i18n("FBChallengePanel_11",info.layer);var zsstr="";var zslevel=info.zsLevelLimit;if(zslevel)zsstr=zslevel?zslevel.toString()+i18n("FBChallengePanel_12"):"";this.limit.text=i18n("FBChallengePanel_13",zsstr,info.levelLimit);this.iconList.dataProvider=new eui.ArrayCollection([info.passReward[0]]);this.iconList0.dataProvider=new eui.ArrayCollection([info.passReward[1]]);this.expText.text=info.passReward[2]?""+info.passReward[2].count:"";var flag=Actor.level>=info.levelLimit&&UserZs.ins().lv>=info.zsLevelLimit;this.limit.visible=!flag;this.challengeBtn.visible=flag;if(SkyLevelModel.ins().lastPass){this.challengeBtn.label="已通关";this.challengeBtn.currentState="disabled"}this.endImg.visible=info.layer<=4}};FBChallengePanel.prototype.updateRedPoint=function(tab){if(tab==2){this.redPoint0.visible=SkyLevelModel.ins().cruLevel>1&&SkyLevelModel.ins().dayReward==1;this.redPoint1.visible=SkyLevelModel.ins().lotteryRemainTimes>0;this.updateTowerState()}};FBChallengePanel.prototype.updateTowerState=function(){var isShow=true;if(SkyLevelModel.ins().cruLevel!=0&&SkyLevelModel.ins().cruLevel-1<GlobalConfig.FbChallengeBaseConfig.LotteryOpenLevel){isShow=false}this.dailyGift0.visible=isShow;this.choujiang.visible=isShow};FBChallengePanel.prototype.challenge=function(){if(UserFb.ins().checkInFB())return;if(SkyLevelModel.ins().lastPass){UserTips.ins().showTips(i18n("FBChallengePanel_14"));return}UserFb2.ins().sendChallenge();ViewManager.ins().closeTopLevel()};FBChallengePanel.prototype.getDayRewward=function(){if(SkyLevelModel.ins().cruLevel<=1){UserTips.ins().showTips(i18n("FBChallengePanel_15"));return}if(SkyLevelModel.ins().dayReward<1){UserTips.ins().showTips(i18n("FBChallengePanel_16"));return}else if(SkyLevelModel.ins().dayReward==2){UserTips.ins().showTips(i18n("FBChallengePanel_17"));return}ViewManager.ins().open(ChallengeDayRewardWin)};FBChallengePanel.prototype.onClick=function(e){switch(e.currentTarget){case this.jump:if(this.rankModel)ViewManager.ins().open(FBChallengeRankWin,this.rankModel);break}};FBChallengePanel.prototype.showRewwardLabel=function(){var tips="";if(SkyLevelModel.ins().dayReward==1){tips=i18n("FBChallengePanel_18")}else{tips=i18n("FBChallengePanel_19")}this.dailyGift.text=tips};FBChallengePanel.RunType=3;return FBChallengePanel}(BaseView);__reflect(FBChallengePanel.prototype,"FBChallengePanel");var FBChallengeRankItem=function(_super){__extends(FBChallengeRankItem,_super);function FBChallengeRankItem(){var _this=_super.call(this)||this;_this.skinName="ChuangtianguanRankItem";return _this}FBChallengeRankItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};FBChallengeRankItem.prototype.dataChanged=function(){if(!this.data)return;if(this.data.pos>3){this.rankImg.visible=false;this.rank.visible=!this.rankImg.visible;this.rank.text=this.data.pos+""}else{this.rankImg.visible=true;this.rank.visible=!this.rankImg.visible;this.rankImg.source="paihang"+this.data.pos}this.vip.visible=this.data.vip;this.nameLabel.text=this.data.player;if(!this.data.count){return}var info=GlobalConfig.FbChallengeConfig[this.data.count];var name=UserFb.ins().getFbChName(info.group);this.cengNum.text=i18n("FBChallengeRankItem_0",name,info.layer)};FBChallengeRankItem.prototype.destruct=function(){};return FBChallengeRankItem}(BaseItemRender);__reflect(FBChallengeRankItem.prototype,"FBChallengeRankItem");var FBChallengeRankWin=function(_super){__extends(FBChallengeRankWin,_super);function FBChallengeRankWin(){var _this=_super.call(this)||this;_this.skinName="ChuangtianguanRankSkin";return _this}FBChallengeRankWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};FBChallengeRankWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.bgClose,this.onClick);this.addTouchEndEvent(this.closeBtn,this.onClick);this.rankModel=param[0];this.list0.itemRenderer=FBChallengeRankItem;this.init()};FBChallengeRankWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick);this.removeObserve()};FBChallengeRankWin.prototype.init=function(){var copyList=this.rankModel.getDataList();var rankDataList=[];for(var i in copyList){if(!copyList[i].count)break;rankDataList.push(copyList[i])}this.list0.dataProvider=new eui.ArrayCollection(rankDataList);var myRankData=rankDataList[this.rankModel.selfPos-1];var info;var name;if(myRankData){info=GlobalConfig.FbChallengeConfig[myRankData.count];name=UserFb.ins().getFbChName(info.group);this.myRank.text=i18n("FBChallengeRankWin_0")+this.rankModel.selfPos}else{var skModel=SkyLevelModel.ins();info=GlobalConfig.FbChallengeConfig[skModel.cruLevel];name=UserFb.ins().getFbChName(info.group);this.myRank.text=i18n("FBChallengeRankWin_1")}if(info&&name)this.myNum.text=i18n("FBChallengeRankWin_2",name,info.layer)};FBChallengeRankWin.prototype.onClick=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};return FBChallengeRankWin}(BaseEuiView);__reflect(FBChallengeRankWin.prototype,"FBChallengeRankWin");ViewManager.ins().reg(FBChallengeRankWin,LayerManager.UI_Popup);var FBCountDown=function(_super){__extends(FBCountDown,_super);function FBCountDown(){var _this=_super.call(this)||this;_this._count=1;_this.skinName="FBCountDownSkin";return _this}FBCountDown.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}switch(GameMap.fbType){case UserFb.FB_TYPE_PEAKED:if(args[0])this._count=args[0];this.bgImg.source="peakness_start_fight";break;default:return}TimerManager.ins().doTimer(1e3,this._count+1,this.upFun,this);this.upFun()};FBCountDown.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}TimerManager.ins().removeAll(this)};FBCountDown.prototype.upFun=function(){this.countDown.text=this._count+"";this._count--;if(this._count<0)ViewManager.ins().close(FBCountDown)};FBCountDown.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}switch(GameMap.fbType){case UserFb.FB_TYPE_PEAKED:break;default:return false}return true};return FBCountDown}(BaseEuiView);__reflect(FBCountDown.prototype,"FBCountDown");ViewManager.ins().reg(FBCountDown,LayerManager.UI_Popup);var FbExpPanel=function(_super){__extends(FbExpPanel,_super);function FbExpPanel(){var _this=_super.call(this)||this;_this.braF=0;_this.braT=-1;_this.braR0=-1;_this.name=i18n("FbExpPanel_0");return _this}FbExpPanel.prototype.open=function(){this.addTouchEvent(this,this.onTap);this.observe(UserFb.ins().postFbExpInfo,this.onUpdate);this.onUpdate()};FbExpPanel.prototype.close=function(){this.removeTouchEvent(this,this.onTap);this.removeObserve();DisplayUtils.removeFromParent(this.eff);this.eff=null;this.removeEventListener(egret.Event.ENTER_FRAME,this.g2FreeReliveAni,this)};FbExpPanel.prototype.onUpdate=function(){var fbExp=UserFb.ins().fbExp;var index=0;if(!fbExp.cid&&!fbExp.sid){if(fbExp.useTime<=this.getChangeNum()){index=0;this.currentState="challenge"}else{index=2;this.currentState="sdfb"}}else{if(fbExp.cid){index=1;this.currentState="free"}else{index=3;this.currentState="sdget"}}this.validateNow();this.onInitIndex(index)};FbExpPanel.prototype.getChangeNum=function(lv){if(lv==undefined)lv=UserVip.ins().lv;var count=GlobalConfig.ExpFubenBaseConfig.freeCount;return(GlobalConfig.ExpFubenBaseConfig.vipCount[lv]||0)+count};FbExpPanel.prototype.getSdNum=function(vip){return GlobalConfig.ExpFubenBaseConfig.freeCount+GlobalConfig.ExpFubenBaseConfig.vipCount[vip]};FbExpPanel.prototype.onInitIndex=function(index){var fbExp=UserFb.ins().fbExp;var fbId=UserFb.ins().getExpFbId();var discount=GlobalConfig.MonthCardConfig.expFubenPrecent/100;var addValue=Recharge.ins().getIsForeve()?1+discount:1;var exp=Math.floor(GlobalConfig.ExpFubenConfig[fbId].exp*addValue);this.freedG2.visible=false;this.g2FreeRelive.visible=false;if(index==0){this.lbTime.text=i18n("FbExpPanel_1",this.getChangeNum()-fbExp.useTime);this.lbExp.text=""+exp;if(this.getChangeNum()>fbExp.useTime){this.btnChallenge.enabled=true}else{this.btnChallenge.enabled=false;var nextLv=UserVip.ins().lv+1;var nextTime=this.getChangeNum(nextLv);while(nextTime!=undefined&&nextTime<=fbExp.useTime){nextLv+=1;nextTime=this.getChangeNum(nextLv);if(GlobalConfig.ExpFubenBaseConfig.vipCount[nextLv]==undefined){break}}if(nextTime-fbExp.useTime>0){this.lbTime.text=i18n("FbExpPanel_2",nextLv,nextTime-fbExp.useTime)}}}else if(index==2){this.barGroup.visible=false;this.btnSD.visible=true;this.bar.value=0;this.lbExp.text=""+exp;var sdTime=this.getSdNum(UserVip.ins().lv);if(fbExp.sdTime>=(sdTime||0)){var nextLv=UserVip.ins().lv+1;var nextTime=this.getSdNum(nextLv);while(nextTime!=undefined&&nextTime<=sdTime){nextLv+=1;nextTime=this.getSdNum(nextLv)}this.lbVip0.visible=false;if(nextTime&&nextTime>sdTime){this.lbVip.textFlow=TextFlowMaker.generateTextFlow1(i18n("FbExpPanel_3",nextLv,nextTime-sdTime));this.lbVip.visible=true;this.btnSD.enabled=false}else if(nextTime==undefined){this.lbVip.textFlow=TextFlowMaker.generateTextFlow1(i18n("FbExpPanel_4"));this.lbVip.visible=true;this.btnSD.enabled=false}else{this.lbVip.visible=false;this.btnSD.enabled=true}}else{this.lbVip.visible=false;this.lbVip0.visible=true;this.lbVip0.textFlow=TextFlowMaker.generateTextFlow1(i18n("FbExpPanel_5",sdTime-fbExp.sdTime));this.btnSD.enabled=true}}else if(index==1||index==3){var sdLeftTime=this.getChangeNum()-fbExp.useTime+1;this.lbTime.text=""+sdLeftTime;var exp_1=GlobalConfig.ExpFubenConfig[fbExp.cid||fbExp.sid].exp*addValue;for(var i=0;i<3;i++){this["lbExp"+i].textFlow=TextFlowMaker.generateTextFlow1(i18n("FbExpPanel_6",exp_1*(i+1)));var needGold=0;needGold=GlobalConfig.ExpFubenBaseConfig.recPrice[i];this["gold"+i].setPrice(needGold);this["btnGet"+i].enabled=index==1||sdLeftTime>0}this.g1.visible=this.g2.visible=true;this["gold"+2].visible=true;if(fbExp.isfirstT==0){this["gold"+2].setPrice(0);this["gold"+2].visible=false;this.freedG2.visible=true;this.g2FreeRelive.visible=true;if(!this.eff){this.eff=new MovieClip;this.eff.scaleX=.75;this.eff.scaleY=.75;this.eff.touchEnabled=false;this.eff.x=this.btnGet2.x+this.btnGet2.width/2;this.eff.y=this.btnGet2.y+this.btnGet2.height/2;this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);this.g2.addChild(this.eff)}this.addEventListener(egret.Event.ENTER_FRAME,this.g2FreeReliveAni,this)}}};FbExpPanel.prototype.g2FreeReliveAni=function(){var now=egret.getTimer();if(this.braT==-1){this.braT=now;this.braR0=this.g2FreeRelive.right}else{var time=this.braT;var pass=now-time;this.braT=now;this.braF+=pass/2e3;this.braF%=1;if(this.g2FreeRelive.visible){var offsetx=50*(1-2*Math.abs(.5-this.braF));this.g2FreeRelive.right=this.braR0+offsetx}}};FbExpPanel.prototype.onTap=function(e){var tar=e.target;if(this.checkBtnGet(tar)){}else if(tar==this.btnChallenge){if(Actor.level<GlobalConfig.ExpFubenBaseConfig.openLv){UserTips.ins().showTips(i18n("FbExpPanel_7",GlobalConfig.ExpFubenBaseConfig.openLv));return}if(UserFb.ins().checkInFB())return;UserFb.ins().sendChallengeExpFb()}else if(tar==this.btnSD){if(this.barGroup.visible==false){this.barGroup.visible=true;this.btnSD.visible=false;this.lbVip.visible=false;this.lbVip0.visible=false;this.bar.maximum=100;this.bar.value=0;egret.Tween.get(this.bar).to({value:100},1500).call(function(){UserFb.ins().sendSaodang()})}}};FbExpPanel.prototype.checkBtnGet=function(tar){var _this=this;var fbExp=UserFb.ins().fbExp;var index=0;var ActorMaxlevel=Object.keys(GlobalConfig.ExpConfig).length;if(Actor.level>=ActorMaxlevel&&Actor.exp>=GlobalConfig.ExpConfig[ActorMaxlevel].exp){var warnWin=WarnWin.show(i18n("FbExpPanel_8"),null,null,null,null,"sure");warnWin.setBtnLabel(i18n("FbExpPanel_9"));return}if(tar==this.btnGet0){index=1}else if(tar==this.btnGet1){index=2}else if(tar==this.btnGet2){index=3}if(index>0){var type_2=fbExp.cid?0:1;var cost=GlobalConfig.ExpFubenBaseConfig.recPrice[index-1];if(Actor.yb<cost&&fbExp.isfirstT!=0){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("FbExpPanel_10"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("FbExpPanel_11"));return}if(index!=3&&Setting.ins().getValue(ClientSet.expFirst)==0){if(index==1){this.sendGetAward(type_2,index,tar);DisplayUtils.removeFromParent(this.eff);this.eff=null}else{var str=i18n("FbExpPanel_12",index);if(cost!=0)str=i18n("FbExpPanel_13",cost,index);var win=WarnWin.show(str,function(){_this.sendGetAward(type_2,index,tar);Setting.ins().setValue(ClientSet.expFirst,1);DisplayUtils.removeFromParent(_this.eff);_this.eff=null},this);win.setBtnLabel(i18n("FbExpPanel_14"))}return}if(cost==0){this.sendGetAward(type_2,index,tar)}else{if(index==3&&fbExp.isfirstT==0){this.sendGetAward(type_2,index,tar);Setting.ins().setValue(ClientSet.expFirst,1);DisplayUtils.removeFromParent(this.eff);this.removeEventListener(egret.Event.ENTER_FRAME,this.g2FreeReliveAni,this);this.eff=null}else{var win=WarnWin.show(i18n("FbExpPanel_15",cost,index),function(){this.sendGetAward(type_2,index,tar);Setting.ins().setValue(ClientSet.expFirst,1);DisplayUtils.removeFromParent(this.eff);this.removeEventListener(egret.Event.ENTER_FRAME,this.g2FreeReliveAni,this);this.eff=null},this);win.setBtnLabel(i18n("FbExpPanel_16"))}}}return index>0};FbExpPanel.prototype.sendGetAward=function(type,index,tar){var fbExp=UserFb.ins().fbExp;var config=GlobalConfig.ExpFubenConfig[fbExp.cid||fbExp.sid];if(!config)return;var exp=config.exp;var flyTime=this.getFlyTime(exp*index);var count=Math.floor(flyTime/15);TimerManager.ins().doTimer(15,count,function(){UserFb.ins().postExpFly(tar.parent.localToGlobal(tar.x+tar.width/2,tar.y+tar.height/2));if(index>1){UserFb.ins().postExpFly(tar.parent.localToGlobal(tar.x+tar.width/2,tar.y+tar.height/2))}if(index>2){UserFb.ins().postExpFly(tar.parent.localToGlobal(tar.x+tar.width/2,tar.y+tar.height/2))}},this);egret.Tween.get(tar).wait(1100).call(function(){UserFb.ins().sendGetAwardMul(type,index)})};FbExpPanel.prototype.getFlyTime=function(exp){var addLevel=0;var oldLevel=Actor.level;var oldExp=Actor.exp;var maxExp=Math.ceil(GlobalConfig.ExpConfig[oldLevel].exp);while(exp>0&&exp>maxExp-oldExp){addLevel+=1;oldLevel+=1;exp-=maxExp-oldExp;maxExp=Math.ceil(GlobalConfig.ExpConfig[oldLevel].exp);oldExp=0}if(addLevel==0){return 400}return(addLevel+1)*400-200};return FbExpPanel}(BaseView);__reflect(FbExpPanel.prototype,"FbExpPanel");var FbWin=function(_super){__extends(FbWin,_super);function FbWin(){var _this=_super.call(this)||this;_this.fbDataList=[];_this.lastSelectIndex=-1;_this.skinName="DailyFbSkin";_this.isTopLevel=true;_this.fbDataList=UserFb.ins().fbDataList.slice();_this.updateFbList();return _this}FbWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var index=param[0]==undefined?0:param[0];switch(index){case 4:if(!UserFb.ins().isTeamFBOpen()){UserTips.ins().showTips(i18n("FbWin_0",GlobalConfig.TeamFuBenBaseConfig.needLv,GlobalConfig.TeamFuBenBaseConfig.openDay));return false}break;case 2:var info=GlobalConfig.WinOpenConfig[32];if(Actor.level<info.openLevel){UserTips.ins().showTips(i18n("FbWin_1",info.openLevel));return false}break;case 1:if(Actor.level<GlobalConfig.ExpFubenBaseConfig.openLv){UserTips.ins().showTips(i18n("FbWin_17",GlobalConfig.ExpFubenBaseConfig.openLv));return false}break;case 0:if(Actor.level<10){UserTips.ins().showTips(i18n("FbWin_3"));return false}break}if(!FbWin.isClose)ViewManager.ins().close(LiLianWin);FbWin.isClose=false;return true};FbWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var btn=this.tab.getElementAt(4)};FbWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.fbList,this.onTap);this.addTouchEvent(this.help,this.onTap);this.observe(UserFb.ins().postFbInfoInit,this.updateFbList);this.observe(UserFb.ins().postUpDataInfo,this.updateFbList);this.observe(FbRedPoint.ins().postTabs,this.updateRedPoint);this.observe(UserFb.ins().postShowRedChange,this.updateRedPoint);this.observe(UserFb.ins().postUpDataInfo,this.updateRedPoint);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.checkIsOpen);this.updateFbList();TimerManager.ins().doTimer(120,1,this.updateFbList,this);var index=param[0]==undefined?0:param[0];var index2=param[1]==undefined?0:param[1];this.viewStack.selectedIndex=index;this.tab.selectedIndex=index;this.setOpenIndex(index,index2);this.updateRedPoint()};FbWin.prototype.updateRedPoint=function(){this.redPoint0.visible=FbRedPoint.ins().getRedPoint(0);this.redPoint1.visible=this.updateRcFbRedPoint();this.redPoint2.visible=FbRedPoint.ins().getRedPoint(2);this.redPoint3.visible=FbRedPoint.ins().getRedPoint(3);this.redPoint4.visible=UserFb.ins().checkTFRed()};FbWin.prototype.updateRcFbRedPoint=function(){return FbRedPoint.ins().getRedPoint(1)||HardFb.ins().getRedPoint()||SpecialRing.ins().fireRingRedPoint()||FbRedPoint.ins().getRedPoint(4)||Hungu.ins().showHunShouRed()};FbWin.prototype.updateFbList=function(){for(var i=0;i<this.fbDataList.length;i++){if(this.fbList.numChildren<i+1){this.fbList.addChildAt(new FbItem,i)}var item=this.fbList.getChildAt(i);item.data=this.fbDataList[i]}};FbWin.prototype.onTap=function(e){switch(e.currentTarget){case this.help:ViewManager.ins().open(RuneTowerTipsWin);break;case this.closeBtn:ViewManager.ins().close(this);break;default:if(e.target instanceof eui.Button){var fbID=e.target["data"];var fbConfig=GlobalConfig.DailyFubenConfig[fbID];if(e.target.name=="add"){this.Sweep(fbID)}else if(e.target.name=="double"){this.DoubleSweep(fbID)}else{var fbInfos=UserFb.ins().getFbDataById(fbID);if(fbInfos.getCount()<=0){UserTips.ins().showTips(i18n("FbWin_4"))}else if(fbConfig.levelLimit>Actor.level){UserTips.ins().showTips(i18n("FbWin_5"))}else{var isPass=UserFb.ins().fbModel[fbID].isPass;if(Recharge.ins().franchise&&isPass){UserFb.ins().sendChallenge(fbID)}else{if(UserFb.ins().checkInFB())return;UserFb.ins().sendChallenge(fbConfig.id)}}}ViewManager.ins().close(LimitTaskView)}if(e.target.name=="monthCardBtn"){ViewManager.ins().open(FuliWin,"FranchiseWin")}}};FbWin.prototype.Sweep=function(fbID){var fbConfig=GlobalConfig.DailyFubenConfig[fbID];var discount=GlobalConfig.MonthCardConfig.sweepPrecent/100;var addValue=Recharge.ins().monthDay>0?1-discount:1;var buyPrice=fbConfig.buyPrice[UserFb.ins().getFbDataById(fbID).vipBuyCount]*addValue;if(!(Actor.yb>=buyPrice)){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("FbWin_9"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("FbWin_10"));return}DieGuide.ins().setClick(fbID);var index=this.fbDataList.lastIndexOf(fbID);this.fbList.getChildAt(index).starSaoDang(0)};FbWin.prototype.DoubleSweep=function(fbID){var fbConfig=GlobalConfig.DailyFubenConfig[fbID];var discount=GlobalConfig.MonthCardConfig.sweepPrecent/100;var addValue=Recharge.ins().monthDay>0?1-discount:1;var buyPrice=fbConfig.buyDoublePrice[UserFb.ins().getFbDataById(fbID).vipBuyCount]*addValue;if(!(Actor.yb>=buyPrice)){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("FbWin_12"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("FbWin_13"));return}DieGuide.ins().setClick(fbID);var index=this.fbDataList.lastIndexOf(fbID);this.fbList.getChildAt(index).starSaoDang(1)};FbWin.prototype.setOpenIndex=function(selectedIndex,selectedIndex2){if(!this.checkIndexOpen(selectedIndex)){this.setOpenIndex(this.lastSelectIndex);this.tab.selectedIndex=this.lastSelectIndex;return}if(this.lastSelectIndex>-1){switch(this.lastSelectIndex){case 1:break;case 2:break}}this.lastSelectIndex=selectedIndex;this.help.visible=false;switch(selectedIndex){case 4:this.teamfb.open();break;case 3:this.playWayPanel.open();break;case 2:this.help.visible=true;this.fbChallengePanel.open();break;case 1:this.rcFbWin.open(selectedIndex2);break;case 0:this.updateFbList();break}};FbWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex)};FbWin.prototype.checkIsOpen=function(e){var tab=e.target;if(!this.checkIndexOpen(tab.selectedIndex)){e.preventDefault();return}if(UserFb.ins().isCloseFbEntrance&&(tab.selectedIndex==3||tab.selectedIndex==4)){UserTips.ins().showTips(i18n("FbWin_15"));e.preventDefault();return}ViewManager.ins().close(LiLianWin);ViewManager.ins().close(LimitTaskView)};FbWin.prototype.checkIndexOpen=function(index){if(index==2){var info=GlobalConfig.WinOpenConfig[32];if(Actor.level<info.openLevel){UserTips.ins().showTips(i18n("FbWin_16",info.openLevel));return false}}else if(index==1){if(Actor.level<GlobalConfig.ExpFubenBaseConfig.openLv){UserTips.ins().showTips(i18n("FbWin_17",GlobalConfig.ExpFubenBaseConfig.openLv));return false}}else if(index==4){if(!UserFb.ins().isTeamFBOpen()){UserTips.ins().showTips(i18n("FbWin_18",GlobalConfig.TeamFuBenBaseConfig.needLv,GlobalConfig.TeamFuBenBaseConfig.openDay));return false}}return true};return FbWin}(BaseEuiView);__reflect(FbWin.prototype,"FbWin");ViewManager.ins().reg(FbWin,LayerManager.UI_Main);var GuanQiaTipsWin=function(_super){__extends(GuanQiaTipsWin,_super);function GuanQiaTipsWin(){var _this=_super.call(this)||this;_this.chapter=0;_this.skinName="CheckItemTipsSkin";_this.item0=new ItemBase;_this.item0.x=64;_this.item0.y=46;_this.item0.scaleX=_this.item0.scaleY=.8;_this.reward.addChild(_this.item0);_this.item0.isShowName(false);_this.addTouchEvent(_this.rewardBtn,_this.onTap);_this.observe(UserFb.ins().postZhangJieAwardChange,_this.reflashChapter);_this.observe(UserFb.ins().postGuanqiaWroldReward,_this.reflashChapter);_this.rightIcon.visible=false;_this.chargeEff1=new MovieClip;_this.chargeEff1.x=100;_this.chargeEff1.y=127;_this.chargeEff1.scaleX=.5;_this.chargeEff1.scaleY=.5;_this.addChild(_this.chargeEff1);return _this}GuanQiaTipsWin.prototype.reflashChapter=function(){this.update(this.chapter)};GuanQiaTipsWin.prototype.updateDir=function(isLeft){this.leftIcon.visible=isLeft;this.rightIcon.visible=!isLeft};GuanQiaTipsWin.prototype.update=function(chapter){this.chapter=chapter;var config=GlobalConfig.WorldRewardConfig[chapter];var lastConfig=GlobalConfig.WorldRewardConfig[chapter-1];var laseLevel=1;if(lastConfig){laseLevel=lastConfig.needLevel+1}this.item0.data=config.rewards[0];var lastChapter=0;lastChapter=laseLevel-UserFb.ins().guanqiaID;if(UserFb.ins().guanqiaID<=config.needLevel){if(lastChapter>0){this.rew.text=i18n("GuanQiaTipsWin_0",config.name,lastChapter)}else{this.rew.text=i18n("GuanQiaTipsWin_1",config.needLevel-UserFb.ins().guanqiaID+1)}this.rew.visible=true;this.rewardBtn.visible=false;this.chargeEff1.visible=false;this.chargeEff1.stop()}else{this.rewardBtn.visible=true;if(UserFb.ins().isGetReceiveBox(chapter)){this.rew.text="";this.rewardBtn.enabled=false;this.chargeEff1.visible=false;this.chargeEff1.stop();this.rew.visible=true;this.rewardBtn.label=i18n("GuanQiaTipsWin_2");this.rewardBtn.touchEnabled=false}else{this.rewardBtn.enabled=true;this.rew.visible=false;this.rewardBtn.label=i18n("GuanQiaTipsWin_3");this.rewardBtn.touchEnabled=true;this.chargeEff1.visible=true;this.chargeEff1.playFile(RES_DIR_EFF+"chargeff1",-1)}}};GuanQiaTipsWin.prototype.onTap=function(e){switch(e.currentTarget){case this.rewardBtn:UserFb.ins().sendGuanqiaWroldReward(this.chapter);break}};return GuanQiaTipsWin}(BaseView);__reflect(GuanQiaTipsWin.prototype,"GuanQiaTipsWin");var GuanQiaWordMapWin=function(_super){__extends(GuanQiaWordMapWin,_super);function GuanQiaWordMapWin(){var _this=_super.call(this)||this;_this.rewardItemChapter=-1;_this.pass=0;_this.isTopLevel=true;return _this}GuanQiaWordMapWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="CheckInfoSkin";this.bg.source="chapterworld_jpg";this.mapGroup=new eui.Group;this.map.addChild(this.mapGroup);this.mapItemArr=[];this.bigMapGroup=new eui.Group;this.map.addChild(this.bigMapGroup);this.bigMapItemArr=[];this.initBigMapItem();this.changeMap(MapType.chapterMap,-1)};GuanQiaWordMapWin.prototype.changeMap=function(type,id){if(id===void 0){id=-1}if(this.type==type)return;switch(type){case MapType.bigMap:this.map.removeChild(this.mapGroup);this.map.addChild(this.bigMapGroup);this.bg.source="bigworld_jpg";this.backtobig.visible=false;var allcfg=GlobalConfig.AllWorldConfig[UserFb.ins().groupID];var offX=allcfg.position.x+80-this.mapScroller.width/2;var offY=allcfg.position.y+80-this.mapScroller.height/2;if(offX+this.map.width>=960){offX=960-this.map.width}if(offY+this.map.height>=1010){offY=1010-this.map.height}this.map.scrollH=offX>0?offX:0;this.map.scrollV=offY>0?offY:0;this.rewordBtnGroup.x=490;break;default:this.map.removeChild(this.bigMapGroup);this.map.addChild(this.mapGroup);this.bg.source="chapterworld_jpg";this.backtobig.visible=true;this.initMapItem(id);var offsetY=0;var mHeight=745;if(this.rewardItemChapter!=-1){var posY=GlobalConfig.WorldRewardConfig[this.rewardItemChapter].position.y;offsetY=posY-450+75}else{offsetY=860-mHeight}if(offsetY+mHeight>860){offsetY=860-mHeight}this.map.scrollV=offsetY>0?offsetY:0;this.map.scrollH=0;this.rewordBtnGroup.x=410;break}this.type=type};GuanQiaWordMapWin.prototype.initBigMapItem=function(){this.bigMapItemArr=[];var config=GlobalConfig.AllWorldConfig;for(var k in config){var panel=new GuanQiaWorldBigMapItem;panel.x=config[k].position.x;panel.y=config[k].position.y;panel.update(config[k].id);this.bigMapGroup.addChild(panel);this.bigMapItemArr.push(panel)}};GuanQiaWordMapWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this.addTouchEvent(this.getRewordBtn,this.onTap);this.addTouchEvent(this.backtobig,this.onClick);this.observe(UserFb.ins().postGuanqiaWroldReward,this.upDateItemGroup);this.upDateItemGroup()};GuanQiaWordMapWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.close.call(this,param);while(this.bigMapItemArr.length!=0){var panel=this.bigMapItemArr.pop();panel.close()}this.clearMapItem()};GuanQiaWordMapWin.prototype.onClick=function(e){switch(e.currentTarget){case this.backtobig:this.changeMap(MapType.bigMap);break}};GuanQiaWordMapWin.prototype.onTap=function(e){switch(e.currentTarget){case this.getRewordBtn:if(UserBag.ins().getSurplusCount()>=4)UserFb.ins().sendGetAward();else UserTips.ins().showTips(i18n("GuanQiaWordMapWin_0"));break}};GuanQiaWordMapWin.prototype.clearMapItem=function(){while(this.mapItemArr.length!=0){var panel=this.mapItemArr.pop();this.mapGroup.removeChild(panel);panel.close()}this.rewardItemChapter=-1};GuanQiaWordMapWin.prototype.initMapItem=function(groupId){if(groupId===void 0){groupId=-1}this.clearMapItem();var chapterId=-1;if(groupId==-1){var config=GlobalConfig.WorldRewardConfig;for(var k in config){if(UserFb.ins().guanqiaID>config[k].needLevel&&!UserFb.ins().isGetReceiveBox(config[k].id)){groupId=config[k].groupId;chapterId=config[k].id;break}}if(groupId==-1)groupId=UserFb.ins().groupID}var groups=GlobalConfig.AllWorldConfig[groupId].mapGroup;this.WorldMapItem=[];for(var i=0;i<groups.length;i++){this.WorldMapItem.push(GlobalConfig.WorldRewardConfig[groups[i]])}for(var k in this.WorldMapItem){var panel=new GuanQiaWorldMapItem;panel.x=this.WorldMapItem[k].position.x;panel.y=this.WorldMapItem[k].position.y;panel.chapter=this.WorldMapItem[k].id;this.mapGroup.addChild(panel);this.mapItemArr.push(panel);if(panel.rewardChapter!=-1)this.rewardItemChapter=panel.rewardChapter}};GuanQiaWordMapWin.prototype.upDateItemGroup=function(){this.pass=UserFb.ins().getWorldGuanQiaBox();var config=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward];var guanqiaID=UserFb.ins().guanqiaID;var preConfig=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward-1];var needLevel=preConfig?config.needLevel-preConfig.needLevel:config.needLevel;var curLevel=UserFb.ins().guanqiaID-(preConfig?preConfig.needLevel:0)-1;var state=curLevel>=needLevel;this.rewordBtnGroup.visible=state;this.getRewordBtn.enabled=state;this.goldTxt2.text=UserFb.ins().goldEff+i18n("GuanQiaWordMapWin_1");this.expTxt2.text=UserFb.ins().expEff+i18n("GuanQiaWordMapWin_2");this.goldTxt0.text="";this.expTxt0.text=""};return GuanQiaWordMapWin}(BaseEuiView);__reflect(GuanQiaWordMapWin.prototype,"GuanQiaWordMapWin");ViewManager.ins().reg(GuanQiaWordMapWin,LayerManager.UI_Main);var GuanQiaWorldBigMapItem=function(_super){__extends(GuanQiaWorldBigMapItem,_super);function GuanQiaWorldBigMapItem(){var _this=_super.call(this)||this;_this.chapterBig=0;_this.skinName="CheckBigItemSkin";_this.observe(UserFb.ins().postZhangJieAwardChange,_this.reflashChapter);_this.observe(UserFb.ins().postGuanqiaWroldReward,_this.reflashChapter);_this.addTouchEvent(_this,_this.onClick);var job=fixJob(SubRoles.ins().getSubRoleByIndex(0).job);var sex=fixSex(SubRoles.ins().getSubRoleByIndex(0).sex);_this.rolelocation.source="head_"+job+sex;return _this}GuanQiaWorldBigMapItem.prototype.onClick=function(e){var win=ViewManager.ins().getView(GuanQiaWordMapWin);win.changeMap(MapType.chapterMap,this.chapterBig)};GuanQiaWorldBigMapItem.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this,this.onClick);egret.Tween.removeTweens(this.roleHeadGroup)};GuanQiaWorldBigMapItem.prototype.reflashChapter=function(){this.update(this.chapterBig)};GuanQiaWorldBigMapItem.prototype.update=function(chapter){this.chapterBig=chapter;var start=1;var last;var allcfg=GlobalConfig.AllWorldConfig[chapter];var allLastcfg=GlobalConfig.AllWorldConfig[chapter-1];var len=allcfg.mapGroup.length;var lastCfg=GlobalConfig.WorldRewardConfig[allcfg.mapGroup[len-1]];var cfg;last=lastCfg.needLevel;if(allLastcfg){len=allLastcfg.mapGroup.length;cfg=GlobalConfig.WorldRewardConfig[allLastcfg.mapGroup[len-1]];start=cfg.needLevel+1}this.nameTxt.text=allcfg?allcfg.id+"."+allcfg.name:"";this.chapterCount.text=i18n("GuanQiaWorldBigMapItem_0",start,last);var groupY=this.roleHeadGroup.y;var offY=groupY-10;egret.Tween.removeTweens(this.roleHeadGroup);if(UserFb.ins().groupID==allcfg.id){this.roleHeadGroup.visible=true;egret.Tween.get(this.roleHeadGroup,{loop:true}).to({y:offY},1e3).to({y:groupY},1e3)}else{this.roleHeadGroup.visible=false}var b=false;if(UserFb.ins().guanqiaID<start)b=false;else{for(var i=0;i<allcfg.mapGroup.length;i++){cfg=GlobalConfig.WorldRewardConfig[allcfg.mapGroup[i]];if(UserFb.ins().guanqiaID>cfg.needLevel&&!UserFb.ins().isGetReceiveBox(allcfg.mapGroup[i])){b=true;break}}}this.redPointBox.visible=b};return GuanQiaWorldBigMapItem}(BaseView);__reflect(GuanQiaWorldBigMapItem.prototype,"GuanQiaWorldBigMapItem");var GuanQiaWorldMapItem=function(_super){__extends(GuanQiaWorldMapItem,_super);function GuanQiaWorldMapItem(){var _this=_super.call(this)||this;_this.chapter=0;_this.rewardChapter=-1;_this.skinName="CheckMapItemSkin";_this.observe(UserFb.ins().postZhangJieAwardChange,_this.reflashChapter);_this.observe(UserFb.ins().postGuanqiaWroldReward,_this.reflashChapter);_this.addTouchEvent(_this,_this.onClick);_this.mc=new MovieClip;_this.mc.x=_this.mc.y=32;_this.mc.scaleX=.45;_this.mc.scaleY=1.2;_this.rewardGroup.addChild(_this.mc);return _this}GuanQiaWorldMapItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reflashChapter()};GuanQiaWorldMapItem.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this,this.onClick);egret.Tween.removeTweens(this.rewardGroup)};GuanQiaWorldMapItem.prototype.onClick=function(e){var config=GlobalConfig.WorldRewardConfig[this.chapter];if(UserFb.ins().guanqiaID>config.needLevel)UserFb.ins().sendGuanqiaWroldReward(this.chapter);else if(!UserFb.ins().isGetReceiveBox(this.chapter))UserTips.ins().showTips(i18n("GuanQiaWorldMapItem_0",config.needLevel-UserFb.ins().guanqiaID+1))};GuanQiaWorldMapItem.prototype.reflashChapter=function(){this.update(this.chapter)};GuanQiaWorldMapItem.prototype.update=function(chapter){this.chapter=chapter;this.rewardChapter=-1;var config=GlobalConfig.WorldRewardConfig[chapter];var lastConfig=GlobalConfig.WorldRewardConfig[chapter-1];this.itemIcon.setData(GlobalConfig.ItemConfig[config.rewards[0].id]);var laseLevel=1;if(lastConfig){laseLevel=lastConfig.needLevel+1}this.nameTxt.text=config?config.id+"."+config.name:"";this.chapterCount.text=i18n("GuanQiaWorldMapItem_1",laseLevel,config.needLevel);if(UserFb.ins().guanqiaID<=config.needLevel&&UserFb.ins().guanqiaID>=laseLevel){this.box.source=config.icon+"c"}else{this.box.source=config.icon}var lastChapter=0;lastChapter=laseLevel-UserFb.ins().guanqiaID;this.passImg.visible=false;var groupY=this.rewardGroup.y;var offY=groupY-10;egret.Tween.removeTweens(this.rewardGroup);if(UserFb.ins().guanqiaID>config.needLevel){if(UserFb.ins().isGetReceiveBox(chapter)){this.mc.visible=false;this.mc.stop();this.rewardGroup.visible=false;this.passImg.visible=true}else{this.rewardGroup.visible=true;this.mc.visible=true;this.rewardChapter=chapter;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);egret.Tween.get(this.rewardGroup,{loop:true}).to({y:offY},1e3).to({y:groupY},1e3)}}else{this.rewardGroup.visible=UserFb.ins().guanqiaID<=config.needLevel&&UserFb.ins().guanqiaID>=laseLevel;this.mc.visible=false;this.mc.stop()}};return GuanQiaWorldMapItem}(BaseView);__reflect(GuanQiaWorldMapItem.prototype,"GuanQiaWorldMapItem");var GuanQiaWorldRewardWin=function(_super){__extends(GuanQiaWorldRewardWin,_super);function GuanQiaWorldRewardWin(){var _this=_super.call(this)||this;_this.isReceive=false;_this.pass=0;_this.rewardCount=0;return _this}GuanQiaWorldRewardWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="CheckWorldRewardSkin";this.isTopLevel=true};GuanQiaWorldRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.update(param[0])};GuanQiaWorldRewardWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.close.call(this,param);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap)};GuanQiaWorldRewardWin.prototype.update=function(pass){this.isReceive=UserFb.ins().isReceiveBox(pass);this.pass=pass>0?pass:1;var config=GlobalConfig.WorldRewardConfig[this.pass];this.rewardCount=config.rewards.length;this.specialItem0.data=config.rewards[0];this.specialItem1.data=config.rewards[1];this.specialItem2.data=config.rewards[2];this.specialItem3.data=config.rewards[3];var levelStr;var chapterStr;if(pass>1){var lastConfig=GlobalConfig.WorldRewardConfig[this.pass-1];levelStr=this.getLevelStr(lastConfig.needLevel,config.needLevel);chapterStr=lastConfig.needLevel+1+"-"+config.needLevel}else{levelStr=this.getLevelStr(config.needLevel-1,config.needLevel);chapterStr=""+config.needLevel}this.requireLabel.text=i18n("GuanQiaWorldRewardWin_0",chapterStr,levelStr);if(this.isReceive)this.closeBtn0.label=i18n("GuanQiaWorldRewardWin_1");else this.closeBtn0.label=i18n("GuanQiaWorldRewardWin_2")};GuanQiaWorldRewardWin.prototype.getLevelStr=function(value,total){return value*10+1+"-"+total*10};GuanQiaWorldRewardWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.closeBtn0:if(this.isReceive)this.sendReceiveReward();else UserTips.ins().showTips(i18n("GuanQiaWorldRewardWin_3"));ViewManager.ins().close(this);break}};GuanQiaWorldRewardWin.prototype.sendReceiveReward=function(){if(UserBag.ins().getSurplusCount()>=this.rewardCount)UserFb.ins().sendGuanqiaWroldReward(this.pass);else UserTips.ins().showTips(i18n("GuanQiaWorldRewardWin_4"))};return GuanQiaWorldRewardWin}(BaseEuiView);__reflect(GuanQiaWorldRewardWin.prototype,"GuanQiaWorldRewardWin");ViewManager.ins().reg(GuanQiaWorldRewardWin,LayerManager.UI_Popup);var HardFbFirstRewardItem=function(_super){__extends(HardFbFirstRewardItem,_super);function HardFbFirstRewardItem(){var _this=_super.call(this)||this;_this._needUpdate=false;return _this}HardFbFirstRewardItem.prototype.destruct=function(){};HardFbFirstRewardItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.itemList.itemRenderer=ItemBase;this.itemList0.itemRenderer=ItemBase;this.btnGo.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGo,this);this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGet,this);this.btnGo0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGo0,this);this.btnGet0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGet0,this)};Object.defineProperty(HardFbFirstRewardItem.prototype,"needUpdate",{set:function(v){this._needUpdate=true;if(this.visible){this.checkNeedUpdate()}},enumerable:true,configurable:true});HardFbFirstRewardItem.prototype.checkNeedUpdate=function(){if(this._needUpdate){this.dataChanged();this._needUpdate=false}};HardFbFirstRewardItem.prototype.$setVisible=function(v){_super.prototype.$setVisible.call(this,v);if(v){this.checkNeedUpdate()}};HardFbFirstRewardItem.prototype.dataChanged=function(){var cfg=this.data;var mgr=HardFb.ins();this.labelNeedFloor.text=""+cfg.check;this.itemList.dataProvider=new eui.ArrayCollection(cfg.worldFirstRewardShow);this.itemList0.dataProvider=new eui.ArrayCollection(cfg.worldRewardShow);var actorName="";var player_list=HardFb.ins().player_list;var firstCompleted=false;if(player_list){var playerInfo=player_list[cfg.id-1];if(playerInfo){actorName=playerInfo.actorName;firstCompleted=playerInfo.actorName!=null&&playerInfo.actorName!=""}}this.labelPlayerName.text=actorName;var id=cfg.id;var get=HardFb.ins().world_first_reward_avail_ids.indexOf(id)>=0;var got=HardFb.ins().world_first_reward_ids.indexOf(id)>=0;this.btnGet.visible=get;var otherFirst=!get&&!got&&firstCompleted;this.btnGot.visible=got||otherFirst;if(this.btnGot.visible){this.btnGot.label=otherFirst?i18n("HardFbFirstRewardItem_1"):i18n("HardFbFirstRewardItem_0")}this.btnGo.visible=!get&&!got;this.redPoint.visible=get;var get0=HardFb.ins().world_reward_avail_ids.indexOf(id)>=0;var got0=HardFb.ins().world_reward_ids.indexOf(id)>=0;this.btnGet0.visible=get0;this.btnGot0.visible=got0;this.btnGo0.visible=!get0&&!got0;this.redPoint0.visible=get0};HardFbFirstRewardItem.prototype.updatePlayerList=function(){this.dataChanged()};HardFbFirstRewardItem.prototype.onBtnGet=function(){HardFb.ins().send_get_first_reward(this.data.id);this.btnGet.visible=false;this.btnGot.visible=true;this.btnGo.visible=false;this.redPoint.visible=this.btnGet.visible;this.checkAllGray()};HardFbFirstRewardItem.prototype.onBtnGo=function(){ViewManager.ins().close(HardFbRewardWin);TimerManager.ins().doNext(function(){ViewManager.ins().open(FbWin,1,2)},this)};HardFbFirstRewardItem.prototype.onBtnGet0=function(){HardFb.ins().send_get_world_reward(this.data.id);this.btnGet0.visible=false;this.btnGot0.visible=true;this.btnGo0.visible=false;this.redPoint0.visible=this.btnGet0.visible;this.checkAllGray()};HardFbFirstRewardItem.prototype.onBtnGo0=function(){this.onBtnGo()};HardFbFirstRewardItem.prototype.checkAllGray=function(){if(this.btnGot.visible&&this.btnGot0.visible){HardFbRewardWin.instance.moveDown2(this.data.id)}};return HardFbFirstRewardItem}(BaseItemRender);__reflect(HardFbFirstRewardItem.prototype,"HardFbFirstRewardItem");var HardFbPanel=function(_super){__extends(HardFbPanel,_super);function HardFbPanel(){var _this=_super.call(this)||this;_this.name=i18n("HardFbPanel_0");HardFbPanel.instance=_this;return _this}HardFbPanel.prototype.open=function(){this.observe(HardFb.ins().postInfo,this.onUpdate);this.observe(Rank.ins().postRankingData,this.onRankingData);this.listRewards.dataProvider=new eui.ArrayCollection(HardFb.ins().getConfigByLevel(1).passRewardShow);this.listRewards.itemRenderer=ItemBase;this.groupNoMoreFloor.visible=false;this.labelFloor.text="";this.rpFirstRewards.visible=false;this.rpFreeSweep.visible=false;this.btnNoMoreChallenge.visible=false;this.groupSweep.visible=true;this.labelSweepFloor.text="";this.labelNeedFirstFloor.visible=false;this.groupFreeSweep.visible=false;this.labelFreeSweepCount.text="";this.groupSweepCount.visible=true;this.labelSweepCount.text="";this.labelSweepYb.text="";this.groupVip.visible=false;this.name1.text=this.name2.text=this.name3.text="";this.num1.text=this.num2.text=this.num3.text="";this.addTouchEvent(this.help,this.onHelp);this.addTouchEvent(this.btnFirstRewards,this.onBtnFirstRewards);this.addTouchEvent(this.btnChallenge,this.onBtnChallenge);this.addTouchEvent(this.btnViewRank,this.onBtnViewRank);this.addTouchEvent(this.btnSweep,this.onBtnSweep);HardFb.ins().sendGetInfo();Rank.ins().sendGetRankingData(RankDataType.TYPE_HARD_FB)};HardFbPanel.prototype.close=function(){this.removeTouchEvent(this.help,this.onHelp);this.removeTouchEvent(this.btnFirstRewards,this.onBtnFirstRewards);this.removeTouchEvent(this.btnChallenge,this.onBtnChallenge);this.removeTouchEvent(this.btnViewRank,this.onBtnViewRank);this.removeObserve();TimerManager.ins().removeAll(this)};HardFbPanel.prototype.onHelp=function(){ViewManager.ins().open(ZsBossRuleSpeak,61)};HardFbPanel.prototype.onRankingData=function(rankModel){if(rankModel.type!=RankDataType.TYPE_HARD_FB){return}var names=[this.name1,this.name2,this.name3];var nums=[this.num1,this.num2,this.num3];for(var i=0;i<3;++i){var data=rankModel.getDataList(i);if(data){names[i].text=data.player;nums[i].text=i18n("HardFbPanel_1",data.value)}}};HardFbPanel.prototype.onUpdate=function(){var mgr=HardFb.ins();var noMoreLevel=mgr.getMaxLevel()<=mgr.pass_id;var displayLevelId=noMoreLevel?mgr.pass_id:mgr.pass_id+1;this.groupNoMoreFloor.visible=noMoreLevel;this.labelFloor.text=""+displayLevelId;this.rpFirstRewards.visible=mgr.canGetFirstReward()||mgr.canGetWorldFirstReward();this.btnNoMoreChallenge.visible=noMoreLevel;this.btnChallenge.visible=!noMoreLevel;var passRewardShow=mgr.getConfigByLevel(displayLevelId).passRewardShow;this.listRewards.dataProvider=new eui.ArrayCollection(passRewardShow);var canSweep=mgr.pass_id>=1;this.btnSweep.touchEnabled=true;this.btnSweep.enabled=canSweep;this.groupSweep.visible=canSweep;this.labelNeedFirstFloor.visible=!canSweep;this.labelSweepFloor.text=""+mgr.pass_id;var hasFreeSweep=mgr.left_free_sweep_cnt>0;var hasBuySweep=mgr.left_yb_sweep_cnt>0;this.rpFreeSweep.visible=mgr.canFreeSweep();this.groupFreeSweep.visible=hasFreeSweep;this.labelFreeSweepCount.text=""+mgr.left_free_sweep_cnt;this.groupSweepCount.visible=!hasFreeSweep&&hasBuySweep;this.labelSweepCount.text=""+mgr.left_yb_sweep_cnt;this.labelSweepYb.text=GlobalConfig.ChapterHardBaseConfig.sweepYb.toString();if(!hasFreeSweep&&!hasBuySweep){var myVip=UserVip.ins().lv;var vipCfgs=GlobalConfig.VipConfig;var maxVipLevel=Object.keys(GlobalConfig.VipConfig).length;var curVipSweepBuy=0;var myVipCfg=vipCfgs[myVip];if(myVipCfg){curVipSweepBuy=myVipCfg.chapterSweepBuy}var nextVipLevel=myVip;var nextVipSweepBuy=curVipSweepBuy;for(var i=myVip+1;i<=maxVipLevel;++i){var cfg=vipCfgs[i];if(cfg){if(cfg.chapterSweepBuy>curVipSweepBuy){nextVipSweepBuy=cfg.chapterSweepBuy;nextVipLevel=i;break}}}if(nextVipSweepBuy>curVipSweepBuy){this.groupVip.visible=true;this.labelVip.text=""+nextVipLevel;this.labelVipCount.text=""+(nextVipSweepBuy-curVipSweepBuy);this.labelVipYb.text=""+GlobalConfig.ChapterHardBaseConfig.sweepYb.toString()}else{this.groupVip.visible=false;this.groupSweepCount.visible=true}}this.validateNow()};HardFbPanel.prototype.onBtnFirstRewards=function(){ViewManager.ins().open(HardFbRewardWin)};HardFbPanel.prototype.onBtnChallenge=function(){var pass_id=HardFb.ins().pass_id;var guanqiaID=UserFb.ins().guanqiaID;if(pass_id>=guanqiaID){UserTips.ins().showTips(i18n("RcFbWin_3",pass_id+1))}else{HardFb.ins().sendChallenge();ViewManager.ins().close(FbWin)}};HardFbPanel.prototype.onBtnViewRank=function(){ViewManager.ins().open(HardFbRankWin)};HardFbPanel.prototype.onBtnSweep=function(){var hasFreeSweep=HardFb.ins().left_free_sweep_cnt>0;this.btnSweep.touchEnabled=false;HardFb.ins().sendSweep(hasFreeSweep?0:1);TimerManager.ins().doTimer(2e3,1,this.restoreBtnSweep,this)};HardFbPanel.prototype.restoreBtnSweep=function(){this.btnSweep.touchEnabled=true};return HardFbPanel}(BaseView);__reflect(HardFbPanel.prototype,"HardFbPanel");var HardFbRankItem=function(_super){__extends(HardFbRankItem,_super);function HardFbRankItem(){return _super.call(this)||this}HardFbRankItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};HardFbRankItem.prototype.dataChanged=function(){var data=this.data;if(!data)return;if(data.pos>3){this.rankImg.visible=false;this.rank.visible=!this.rankImg.visible;this.rank.text=data.pos+""}else{this.rankImg.visible=true;this.rank.visible=!this.rankImg.visible;this.rankImg.source="paihang"+data.pos}this.vip.visible=data.vip;this.nameLabel.text=data.player;this.cengNum.text=i18n("HardFbRankItem_0",data.value)};HardFbRankItem.prototype.destruct=function(){};return HardFbRankItem}(BaseItemRender);__reflect(HardFbRankItem.prototype,"HardFbRankItem");var HardFbRankWin=function(_super){__extends(HardFbRankWin,_super);function HardFbRankWin(){var _this=_super.call(this)||this;_this.skinName="HardFbRankWinSkin";return _this}HardFbRankWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};HardFbRankWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Rank.ins().postRankingData,this.onRankingData);this.addTouchEvent(this.bgClose,this.onClick);this.addTouchEvent(this.closeBtn,this.onClick);this.rankModel=param[0];this.scroller.viewport=this.list0;this.list0.itemRenderer=HardFbRankItem;this.init()};HardFbRankWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick);this.removeObserve()};HardFbRankWin.prototype.init=function(){this.updateList()};HardFbRankWin.prototype.updateList=function(){var rankModel=Rank.ins().getRankModel(RankDataType.TYPE_HARD_FB);this.list0.dataProvider=new eui.ArrayCollection(rankModel.getDataList());this.myRank.text=""+rankModel.selfPos;this.myNum.text=""+HardFb.ins().pass_id};HardFbRankWin.prototype.onRankingData=function(data){if(data.type==RankDataType.TYPE_HARD_FB){this.updateList()}};HardFbRankWin.prototype.onClick=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};return HardFbRankWin}(BaseEuiView);__reflect(HardFbRankWin.prototype,"HardFbRankWin");ViewManager.ins().reg(HardFbRankWin,LayerManager.UI_Popup);var HardFbResultWin=function(_super){__extends(HardFbResultWin,_super);function HardFbResultWin(){var _this=_super.call(this)||this;_this.repeatTimes=5;return _this}HardFbResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="HardFbResultSkin";this.listItem.itemRenderer=ItemBase;this.listData0=new eui.ArrayCollection;this.list0.itemRenderer=DefeatItem};HardFbResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);var result=param[0];this.bg.source=result?"win_png":"lost_png";this.title.source=result?"win_02":"lost_02";DieGuide.ins().postdieGuide(result);var closeTime=5;this.s=this.repeatTimes=closeTime;var rewards=param[1];if(param[2])this.txt.text=param[2];UserFb.ins().isQuite=true;if(param[3]instanceof Function){this.closeFunc=param[3]}else{if(param[3]==false){UserFb.ins().isQuite=param[3]}}this.txt.visible=result!=0;this.defeat.visible=result==0;this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.continueBtn,this.onTap);if(result==0){this.continueBtn.visible=false;this.continueBtn.parent.removeChild(this.continueBtn);this.updateDefeatList()}else if(result==1){this.continueBtn.label=i18n("HardFbResultWin_0",this.s);TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateContinueBtnLabel,this)}if(rewards){this.setRewardList(rewards)}else{this.setRewardList()}};HardFbResultWin.prototype.setRewardList=function(rewards){if(rewards===void 0){rewards=[]}var coinData=[];var itemData=[];var soulData=[];var material=[];var rewardList=[];for(var i=0;i<rewards.length;i++){var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];if(ItemConfig.getType(itemConfig)==1){if(material.length){var ishave=false;for(var j=0;j<material.length;j++){if(material[j].id==rewards[i].id){material[j].count+=rewards[i].count;ishave=true;break}}if(!ishave)material.push(rewards[i])}else{material.push(rewards[i])}continue}if(rewards[i].type==0){coinData.push(rewards[i])}else{itemData.push(rewards[i])}}this.scrollerGroup.height=324;coinData.sort(this.RuleSort);itemData.sort(this.RuleSortByItem);rewardList=soulData.concat(coinData,material,itemData);this.listItem.dataProvider=new eui.ArrayCollection(rewardList)};HardFbResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateContinueBtnLabel,this);this.removeTouchEvent(this.closeBtn,this.onTap);if(GameMap.fubenID>0){if(UserFb.ins().isQuite){UserFb.ins().sendExitFb()}}if(this.closeFunc){this.closeFunc();this.closeFunc=null}if(SkyLevelModel.ins().lotteryRemainTimes>0&&GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){ViewManager.ins().open(BabelLotteryWin)}};HardFbResultWin.prototype.nextChallenge=function(){UserFb.ins().sendExitFb();HardFb.ins().sendChallenge();UserFb.ins().isQuite=false;ViewManager.ins().close(this)};HardFbResultWin.prototype.updateContinueBtnLabel=function(){this.s--;if(this.s<=0){this.nextChallenge();return}this.continueBtn.label=i18n("HardFbResultWin_0",this.s)};HardFbResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);ViewManager.ins().open(FbWin,1,2);break;case this.continueBtn:this.nextChallenge();break}};HardFbResultWin.prototype.updateDefeatList=function(){var gainWay=[];for(var i in GlobalConfig.DeathGuideConfig){var cfg=GlobalConfig.DeathGuideConfig[i];if(UserZs.ins().lv<=cfg.zslv||Actor.level<=cfg.lv){for(var j in cfg.gainWay){if(cfg.gainWay[j][0]==16){var pic_img=DieGuide.ins().getOpenRoles();if(pic_img){var desConfig=GlobalConfig.DeathgainWayConfig[cfg.gainWay[j][0]];desConfig.itemId=pic_img;gainWay.push(cfg.gainWay[j][0])}continue}if(cfg.gainWay[j][0]==14||cfg.gainWay[j][0]==20){var maxVipLv=Object.keys(GlobalConfig.VipConfig).length;if(UserVip.ins().lv>=maxVipLv){continue}}gainWay.push(cfg.gainWay[j][0])}break}}this.listData0.source=gainWay;this.list0.dataProvider=this.listData0};HardFbResultWin.prototype.RuleSort=function(a,b){if(a.id<b.id)return-1;else return 1};HardFbResultWin.prototype.RuleSortByItem=function(a,b){var aItem=GlobalConfig.ItemConfig[a.id];var bItem=GlobalConfig.ItemConfig[b.id];var aq=ItemConfig.getQuality(aItem);var bq=ItemConfig.getQuality(bItem);if(aq>bq)return-1;else if(aq<bq)return 1;else{return 0}};HardFbResultWin.lastLotteryRemainTimes=0;return HardFbResultWin}(BaseEuiView);__reflect(HardFbResultWin.prototype,"HardFbResultWin");ViewManager.ins().reg(HardFbResultWin,LayerManager.UI_Popup);var HardFbRewardItem=function(_super){__extends(HardFbRewardItem,_super);function HardFbRewardItem(){return _super.call(this)||this}HardFbRewardItem.prototype.destruct=function(){};HardFbRewardItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.itemList.itemRenderer=ItemBase;this.btnGo.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGo,this);this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGet,this)};HardFbRewardItem.prototype.dataChanged=function(){var cfg=this.data;var mgr=HardFb.ins();this.labelNeedFloor.text=""+cfg.check;this.labelNowAndNeedFloor.text=""+mgr.pass_id+"/"+cfg.check;this.itemList.dataProvider=new eui.ArrayCollection(cfg.stageRewardShow);var id=cfg.id;var get=HardFb.ins().pass_id>=cfg.check;var got=HardFb.ins().stage_reward_ids.indexOf(id)>=0;this.btnGet.visible=get&&!got;this.btnGot.visible=got;this.btnGo.visible=!get&&!got;this.redPoint.visible=this.btnGet.visible};HardFbRewardItem.prototype.onBtnGet=function(){HardFb.ins().send_get_stage_reward(this.data.id);this.btnGet.visible=false;this.btnGot.visible=true;this.btnGo.visible=false;this.redPoint.visible=this.btnGet.visible;this.checkAllGray()};HardFbRewardItem.prototype.checkAllGray=function(){if(this.btnGot.visible){HardFbRewardWin.instance.moveDown1(this.data.id)}};HardFbRewardItem.prototype.onBtnGo=function(){ViewManager.ins().close(HardFbRewardWin);TimerManager.ins().doNext(function(){ViewManager.ins().open(FbWin,1,2)},this)};return HardFbRewardItem}(BaseItemRender);__reflect(HardFbRewardItem.prototype,"HardFbRewardItem");var HardFbRewardWin=function(_super){__extends(HardFbRewardWin,_super);function HardFbRewardWin(){var _this=_super.call(this)||this;_this.skinName="HardFbRewardSkin";_this.isTopLevel=true;HardFbRewardWin.instance=_this;return _this}HardFbRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var cfgs=GlobalConfig.ChapterHardFirstConfig;var arr1=[];var arr2=[];for(var k in cfgs){if(""+parseInt(k)==k){arr1.push(cfgs[k]);arr2.push(cfgs[k])}}arr1.sort(function(cfg1,cfg2){var got1=HardFb.ins().stage_reward_ids.indexOf(cfg1.id)>=0;var got2=HardFb.ins().stage_reward_ids.indexOf(cfg2.id)>=0;if(got1!=got2){return got1?1:-1}else{return cfg1.id-cfg2.id}});this.arr1=arr1;this.arr2=arr2;this.dataArr1=new eui.ArrayCollection(arr1);this.dataArr2=new eui.ArrayCollection(arr2);this.scrollerReward.viewport=this.listReward;this.listReward.itemRenderer=HardFbRewardItem;this.scrollerFirstReward.viewport=this.listFirstReward;this.listFirstReward.itemRenderer=HardFbFirstRewardItem;this.addTouchEvent(this.closeBtn,this.onCloseBtn);this.addTouchEvent(this.btnViewRank,this.onBtnViewRank);this.addTouchEvent(this.tab,this.onTabChange);this.observe(HardFb.ins().postPlayerList,this.updatePlayerList);HardFb.ins().sendGetPlayerList();this.redPoint1.visible=HardFb.ins().canGetFirstReward();this.redPoint2.visible=HardFb.ins().canGetWorldFirstReward();this.onTabChange()};HardFbRewardWin.prototype.onTabChange=function(){if(this.tab.selectedIndex==0){if(this.listReward.dataProvider==null){this.listReward.dataProvider=this.dataArr1}this.redPoint1.visible=false;this.title.text=i18n("HardFbRewardWin_0")}else{if(this.listFirstReward.dataProvider==null){this.arr2.sort(function(cfg1,cfg2){var id1=cfg1.id;var id2=cfg2.id;var player_list=HardFb.ins().player_list;var firstCompleted1=false;var firstCompleted2=false;if(player_list){var playerInfo=player_list[id1-1];if(playerInfo){firstCompleted1=playerInfo.actorName!=null&&playerInfo.actorName!=""}var playerInfo=player_list[id2-1];if(playerInfo){firstCompleted2=playerInfo.actorName!=null&&playerInfo.actorName!=""}}var get_1=HardFb.ins().world_first_reward_avail_ids.indexOf(id1)>=0;var got_1=HardFb.ins().world_first_reward_ids.indexOf(id1)>=0;var otherFirst1=!get_1&&!got_1&&firstCompleted1;var got01=HardFb.ins().world_reward_ids.indexOf(id1)>=0;var allgray1=(otherFirst1||got_1)&&got01;var get_2=HardFb.ins().world_first_reward_avail_ids.indexOf(id2)>=0;var got_2=HardFb.ins().world_first_reward_ids.indexOf(id2)>=0;var otherFirst2=!get_2&&!got_2&&firstCompleted2;var got02=HardFb.ins().world_reward_ids.indexOf(id2)>=0;var allgray2=(otherFirst2||got_2)&&got02;if(allgray1!=allgray2){return allgray1?1:-1}else{return cfg1.id-cfg2.id}});this.dataArr2=new eui.ArrayCollection(this.arr2);this.listFirstReward.dataProvider=this.dataArr2}this.redPoint2.visible=false;this.title.text=i18n("HardFbRewardWin_1")}};HardFbRewardWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onCloseBtn);this.removeTouchEvent(this.btnViewRank,this.onBtnViewRank);this.removeTouchEvent(this.tab,this.onTabChange);this.removeObserve()};HardFbRewardWin.prototype.updatePlayerList=function(){};HardFbRewardWin.prototype.onCloseBtn=function(){ViewManager.ins().close(this)};HardFbRewardWin.prototype.onBtnViewRank=function(){ViewManager.ins().open(HardFbRankWin)};HardFbRewardWin.prototype.moveDown1=function(id){var arr1=this.arr1;for(var i=0,c=arr1.length;i<c;++i){if(arr1[i].id==id){arr1.push(arr1.splice(i,1)[0])}}this.dataArr1=new eui.ArrayCollection(arr1);this.listReward.dataProvider=this.dataArr1};HardFbRewardWin.prototype.moveDown2=function(id){var arr2=this.arr2;for(var i=0,c=arr2.length;i<c;++i){if(arr2[i].id==id){arr2.push(arr2.splice(i,1)[0])}}this.dataArr2=new eui.ArrayCollection(arr2);this.listFirstReward.dataProvider=this.dataArr2};return HardFbRewardWin}(BaseEuiView);__reflect(HardFbRewardWin.prototype,"HardFbRewardWin");ViewManager.ins().reg(HardFbRewardWin,LayerManager.UI_Main);var PlayWayPanel=function(_super){__extends(PlayWayPanel,_super);function PlayWayPanel(){var _this=_super.call(this)||this;_this.name=i18n("PlayWayPanel_0");return _this}PlayWayPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);for(var i=1;i<=3;i++){var str=this["info"+i].text;TextFlowMaker.generateTextFlow1("|U:&T:"+str)}var str1=GlobalConfig.NewWorldBossBaseConfig.openTips;var str2=GlobalConfig.CampBattleConfig.openTips;var str3=GlobalConfig.PassionPointConfig.openTips;if(!GameServer.serverOpenDay){}else{var tmp1=str1.split(i18n("PlayWayPanel_2"));this.time1.textFlow=TextFlowMaker.generateTextFlow1(i18n("PlayWayPanel_3",tmp1[1]));var tmp2=str2.split(i18n("PlayWayPanel_19"));this.time2.textFlow=TextFlowMaker.generateTextFlow1(i18n("PlayWayPanel_20",tmp2[1]));var tmp3=str3.split(i18n("PlayWayPanel_19"));this.time3.textFlow=TextFlowMaker.generateTextFlow1(i18n("PlayWayPanel_20",tmp3[1]))}for(var i=1;i<=3;i++)this["info"+i].textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this["info"+i].text)};PlayWayPanel.prototype.open=function(){this.addTouchEvent(this,this.onTap);this.observe(BattleCC.ins().postOpenInfo,this.updateBattleRed);this.observe(Actor.ins().postLevelChange,this.updateBattleRed);this.observe(Actor.ins().postLevelChange,this.updatePaoDianRed);this.observe(PaoDianCC.ins().postOpenInfo,this.updatePaoDianRed);this.observe(BattleGround.ins().postOpenInfo,this.updatePaoDianRed);this.updateBattleRed();this.updatePaoDianRed()};PlayWayPanel.prototype.updateBattleRed=function(){this.redPoint2.visible=BattleCC.ins().checkRedPoint()};PlayWayPanel.prototype.updatePaoDianRed=function(){this.redPoint0.visible=PaoDianCC.ins().checkRedPoint()};PlayWayPanel.prototype.close=function(){this.removeTouchEvent(this,this.onTap);this.removeObserve()};PlayWayPanel.prototype.onTap=function(e){if(KfArenaSys.ins().isKFMacthing()){UserTips.ins().showCenterTips(i18n("PlayWayPanel_4"));return}switch(e.target){case this.btn1:UserBoss.ins().toNewWorldBoss();break;case this.btn2:BattleCC.ins().toBattleCC();break;case this.btn3:PaoDianCC.ins().toPaoDianCC();break;case this.info1:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[18].text);break;case this.info2:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[17].text);break;case this.info3:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[20].text);break}};return PlayWayPanel}(BaseView);__reflect(PlayWayPanel.prototype,"PlayWayPanel");var RcFbWin=function(_super){__extends(RcFbWin,_super);function RcFbWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;return _this}RcFbWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};RcFbWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(FbRedPoint.ins().postTabs,this.updateRedPoint);this.observe(HardFb.ins().postInfo,this.updateRedPoint);this.addTouchEvent(this.btn_exp,this.onBtnExp);this.addTouchEvent(this.btn_hard,this.onBtnHard);this.addTouchEvent(this.btn_sd,this.onBtnsd);this.addTouchEvent(this.btn_cbp,this.onBtncbp);this.addTouchEvent(this.btn_nmrq,this.onBtnnmrq);var index=param[0]==undefined?0:param[0];this.viewStack.selectedIndex=0;this.onInit();if(index==1){this.fireRingFbResult()}else if(index==2){this.onBtnHard()}};RcFbWin.prototype.onInit=function(){this.fbExpPanel.open();this.updateRedPoint();this.selectIcon_1.visible=true;this.selectIcon_2.visible=false;this.selectIcon_3.visible=false;this.selectIcon_4.visible=false;this.navBtn=[this.btn_exp,this.btn_sd,this.btn_cbp,this.btn_nmrq]};RcFbWin.prototype.updateRedPoint=function(){this.expRedPoint.visible=FbRedPoint.ins().getRedPoint(1);this.hardRedPoint.visible=HardFb.ins().getRedPoint();this.sdRedPoint.visible=SpecialRing.ins().fireRingRedPoint();this.cbpRedPoint.visible=FbRedPoint.ins().getRedPoint(4);this.nmrqRedPoint.visible=Hungu.ins().showHunShouRed()};RcFbWin.prototype.fireRingFbResult=function(){this.onBtnsd()};RcFbWin.prototype.onSelectedIcon=function(index){for(var i=1;i<=this.navBtn.length;i++){if(index!=i){this["selectIcon_"+i].visible=false}else this["selectIcon_"+i].visible=true}};RcFbWin.prototype.onBtnExp=function(){this.viewStack.selectedIndex=0;this.fbExpPanel.open();this.onSelectedIcon(1)};RcFbWin.prototype.onBtnHard=function(){var openGuanqia=GlobalConfig.ChapterHardBaseConfig.openGuanqia;if(UserFb.ins().guanqiaID>openGuanqia){this.viewStack.selectedIndex=1;this.hardFbPanel.open();this.onSelectedIcon(2)}else{UserTips.ins().showTips(i18n("RcFbWin_2",openGuanqia));return}};RcFbWin.prototype.onBtnsd=function(){if(SpecialRing.ins().checkRingOpen()&&SpecialRing.ins().isFireRingFuse()){this.viewStack.selectedIndex=2;this.FireRingFb.open();this.onSelectedIcon(3)}else{UserTips.ins().showTips(i18n("RcFbWin_1"));return}};RcFbWin.prototype.onBtncbp=function(){if(!GuardWeaponModel.ins().isOpen()){UserTips.ins().showTips(GuardWeaponModel.ins().getDesc())}else{this.viewStack.selectedIndex=3;this.guardWeaponPanel.open();this.onSelectedIcon(4)}};RcFbWin.prototype.onBtnnmrq=function(){if(!Hungu.ins().isHunShouFBOpen()){UserTips.ins().showTips(i18n("RcFbWin_0",GlobalConfig.HunGuConf.needZsLv,GlobalConfig.HunGuConf.fbOpenDay))}else{this.viewStack.selectedIndex=4;this.challengeHunshou.open();this.onSelectedIcon(5)}};RcFbWin.prototype.onTap=function(e){switch(e.currentTarget){}};RcFbWin.prototype.close=function(){this.removeTouchEvent(this.btn_exp,this.onBtnExp);this.removeTouchEvent(this.btn_hard,this.onBtnHard);this.removeTouchEvent(this.btn_sd,this.onBtnsd);this.removeTouchEvent(this.btn_cbp,this.onBtncbp);this.removeTouchEvent(this.btn_nmrq,this.onBtnnmrq)};return RcFbWin}(BaseEuiView);__reflect(RcFbWin.prototype,"RcFbWin");ViewManager.ins().reg(RcFbWin,LayerManager.UI_Main);var SkyItemRenderer=function(_super){__extends(SkyItemRenderer,_super);function SkyItemRenderer(){var _this=_super.call(this)||this;_this.touchEnabled=false;_this.skinName="chuangtianguanItem";return _this}SkyItemRenderer.prototype.dataChanged=function(){var info=this.data;if(info){this.passAllTip0.text=info.layer+i18n("SkyItemRenderer_0");this.currentState=info.id==SkyLevelModel.ins().cruLevel?"down":"up"}};return SkyItemRenderer}(eui.ItemRenderer);__reflect(SkyItemRenderer.prototype,"SkyItemRenderer");var BabelLotteryItem=function(_super){__extends(BabelLotteryItem,_super);function BabelLotteryItem(){return _super.call(this)||this}BabelLotteryItem.prototype.rewardState=function(isGet){if(isGet){this.currentState="yilingqu"}else{this.currentState="weilingqu"}};return BabelLotteryItem}(BaseComponent);__reflect(BabelLotteryItem.prototype,"BabelLotteryItem");var HunShouFBWin=function(_super){__extends(HunShouFBWin,_super);function HunShouFBWin(){return _super.call(this)||this}HunShouFBWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.itemList.itemRenderer=ItemBase};HunShouFBWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(Hungu.ins().postHunShouFBInfo,this.update);this.observe(Hungu.ins().postSweepHunShouFB,this.updateTimes);this.addTouchEvent(this,this.onTouch);this.update()};HunShouFBWin.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this,this.onTouch)};HunShouFBWin.prototype.update=function(){this.updateTimes();var id=Hungu.ins().hunShouFBPassID?Hungu.ins().hunShouFBPassID+1:1;this._isMax=false;if(id>Object.keys(GlobalConfig.FsFbConfig).length){this._isMax=true;id--}var cfg=GlobalConfig.FsFbConfig[id];this._zsLvEough=UserZs.ins().lv>=cfg.zsLevelLimit;this.zsLimit.textFlow=TextFlowMaker.generateTextFlow(i18n("HunShouFBWin_0",this._zsLvEough?3532331:16711680,cfg.zsLevelLimit));if(!this._collect){this._collect=new ArrayCollection;this.itemList.dataProvider=this._collect}this._collect.source=cfg.award;this.btnSweep.visible=GlobalConfig.HunGuConf.sweepLayer<=Hungu.ins().hunShouFBPassID;this.sweepInfoText.visible=this.sweepInfo.visible=this.btnSweep.visible;this.btnChallenge.visible=!this._isMax;this.btnChallenge.horizontalCenter=this.btnSweep.visible?109:0;this.max.visible=this._isMax;this.zsLimit.visible=!this._isMax;if(this.sweepInfo.visible)this.sweepInfo.text=Hungu.ins().hunShouFBPassID+"";this.bossName.text=cfg.fbName;if(!this._bossMc){this._bossMc=ObjectPool.pop("MovieClip");this.Boss.addChild(this._bossMc)}this._bossMc.playFile(RES_DIR_MONSTER+("monster"+GlobalConfig.MonstersConfig[cfg.monster].avatar+"_3s"),-1)};HunShouFBWin.prototype.updateTimes=function(){this.lbTime.textFlow=TextFlowMaker.generateTextFlow("|c:"+(Hungu.ins().hunShouFBTimes?3532331:16711680)+"&T:"+Hungu.ins().hunShouFBTimes+"|")};HunShouFBWin.prototype.onTouch=function(e){switch(e.target){case this.btnSweep:case this.btnChallenge:if(KfArenaSys.ins().isKFMacthing()){UserTips.ins().showCenterTips(i18n("HunShouFBWin_1"));return}if(!Hungu.ins().hunShouFBTimes){UserTips.ins().showTips(i18n("HunShouFBWin_2"));return}if(e.target==this.btnSweep)Hungu.ins().sweepHunShouFB();else{if(!this._zsLvEough)UserTips.ins().showTips(i18n("HunShouFBWin_3"));else if(this._isMax)UserTips.ins().showTips(i18n("HunShouFBWin_4"));else{Hungu.ins().enterHunShouFB();ViewManager.ins().close(LadderWin)}}break}};return HunShouFBWin}(BaseEuiView);__reflect(HunShouFBWin.prototype,"HunShouFBWin");var HunShouSweepWin=function(_super){__extends(HunShouSweepWin,_super);function HunShouSweepWin(){var _this=_super.call(this)||this;_this.skinName="hunshouSweepSkin";return _this}HunShouSweepWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};HunShouSweepWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._id=args[0];this._rewards=args[1];this.addTouchEvent(this,this.onTouch);this.update()};HunShouSweepWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch)};HunShouSweepWin.prototype.update=function(){this.reward.dataProvider=new ArrayCollection(this._rewards);this.times.textFlow=TextFlowMaker.generateTextFlow("|c:"+(Hungu.ins().hunShouFBTimes?3532331:16711680)+"&T:"+Hungu.ins().hunShouFBTimes+"|");this.fbName.text=GlobalConfig.FsFbConfig[this._id].fbName};HunShouSweepWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.nextBtn:if(!Hungu.ins().hunShouFBTimes){UserTips.ins().showTips(i18n("HunShouSweepWin_0"));return}Hungu.ins().sweepHunShouFB();break}};return HunShouSweepWin}(BaseEuiView);__reflect(HunShouSweepWin.prototype,"HunShouSweepWin");ViewManager.ins().reg(HunShouSweepWin,LayerManager.UI_Popup);var FriendListWin=function(_super){__extends(FriendListWin,_super);function FriendListWin(){var _this=_super.call(this)||this;_this.skinName="friendListSkin";_this.isTopLevel=true;return _this}FriendListWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=FriendItemRender};FriendListWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._des=args[0];this.addTouchEvent(this,this.onTouch);this.addTouchEvent(this.list,this.onListTap);this.observe(Friends.ins().postFriendChange,this.update,this);this.update()};FriendListWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeTouchEvent(this.list,this.onListTap);this.removeObserve()};FriendListWin.prototype.update=function(){if(!this._collect){this._collect=new ArrayCollection;this.list.dataProvider=this._collect}this._collect.source=Friends.ins().friendsList.source};FriendListWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};FriendListWin.prototype.onListTap=function(e){var selectedItem=this.list.selectedItem;if(selectedItem){Friends.ins().sendChat(selectedItem.id,this._des,1);UserTips.ins().showCenterTips(i18n("FriendListWin_0"))}};return FriendListWin}(BaseEuiView);__reflect(FriendListWin.prototype,"FriendListWin");ViewManager.ins().reg(FriendListWin,LayerManager.UI_Popup);var MemberInfoWin=function(_super){__extends(MemberInfoWin,_super);function MemberInfoWin(){var _this=_super.call(this)||this;_this.skinName="memberInfoSkin";_this.isTopLevel=true;return _this}MemberInfoWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._data=args[0];this.addTouchEvent(this,this.onTouch);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.update()};MemberInfoWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeObserve()};MemberInfoWin.prototype.update=function(){var job=fixJob(this._data.job);var sex=fixSex(this._data.sex);this.imgBg.source=ChatListItemRenderer.HEAD_BG[sex];this.imgHead.source="head_"+job+sex;this.labelName.text=this._data.roleName;this.labelLv.text=(this._data.zs?this._data.zs+i18n("MemberInfoWin_0"):"")+this._data.lv+i18n("MemberInfoWin_1");this.btnRemove.visible=UserFb.ins().isTFCaptain};MemberInfoWin.prototype.onTouch=function(e){switch(e.target){case this.btnInfo:UserReadPlayer.ins().sendFindPlayer(this._data.roleID);break;case this.btnRemove:UserFb.ins().sendOutTFRoom(this._data.roleID);ViewManager.ins().close(this);break;case this.closeBtn:ViewManager.ins().close(this);break}};MemberInfoWin.prototype.openOtherPlayerView=function(otherPlayerData){ViewManager.ins().open(TeamFBCheckRoleWin,otherPlayerData)};return MemberInfoWin}(BaseEuiView);__reflect(MemberInfoWin.prototype,"MemberInfoWin");ViewManager.ins().reg(MemberInfoWin,LayerManager.UI_Popup);var TeamFBCheckRoleWin=function(_super){__extends(TeamFBCheckRoleWin,_super);function TeamFBCheckRoleWin(){var _this=_super.call(this)||this;_this.skinName="teamFbCheckSkin";_this.isTopLevel=true;return _this}TeamFBCheckRoleWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.viewStack.selectedIndex=0};TeamFBCheckRoleWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.otherPlayerData=param[0];this.roleSelect.otherPlayerData=this.otherPlayerData;this.nameTxt.text=this.otherPlayerData.name;this.roleSelect.open();this.addTouchEvent(this,this.onClick);this.addChangeEvent(this.roleSelect,this.onChange);this.roleSelect.setCurRole(0);this.setRoleInfo()};TeamFBCheckRoleWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onClick);this.roleInfoPanel.clear()};TeamFBCheckRoleWin.prototype.destoryView=function(){_super.prototype.destoryView.call(this);this.roleSelect.close();this.roleInfoPanel.close()};TeamFBCheckRoleWin.prototype.setRoleInfo=function(){var tempData=this.otherPlayerData.roleData[0];var server="[S"+this.otherPlayerData.serverId+"]";if(!this.otherPlayerData.serverId||this.otherPlayerData.serverId==LocationProperty.srvid)server="";this.nameTxt.text=this.otherPlayerData.name+server;this.guildNameText.x=this.nameTxt.x+this.nameTxt.textWidth+10;this.guildNameText.text=this.otherPlayerData.guildName?i18n("TeamFBCheckRoleWin_0",this.otherPlayerData.guildName):"";var strLv=this.otherPlayerData.zhuan?i18n("TeamFBCheckRoleWin_1",this.otherPlayerData.zhuan):"";this.levelText.text=i18n("TeamFBCheckRoleWin_2",strLv,this.otherPlayerData.level);var job=fixJob(tempData.job);var sex=fixSex(tempData.sex);this.headIcon.source="head_"+job+sex;var lv=this.otherPlayerData.lilianLv;var config=GlobalConfig.TrainLevelConfig[lv];this.jueweiIcon.source="juewei_1_"+config.type+"_png"};TeamFBCheckRoleWin.prototype.onChange=function(e){this.setView(this.roleSelect.getCurRole())};TeamFBCheckRoleWin.prototype.setView=function(id){if(id===void 0){id=0}this.roleInfoPanel.curRole=this.roleSelect.getCurRole();this.roleInfoPanel.open(this.otherPlayerData)};TeamFBCheckRoleWin.prototype.onClick=function(e){switch(e.target){case this.closeBtn1:ViewManager.ins().close(this);break}};return TeamFBCheckRoleWin}(BaseEuiView);__reflect(TeamFBCheckRoleWin.prototype,"TeamFBCheckRoleWin");ViewManager.ins().reg(TeamFBCheckRoleWin,LayerManager.UI_Popup);var TeamFbFightWin=function(_super){__extends(TeamFbFightWin,_super);function TeamFbFightWin(){var _this=_super.call(this)||this;_this.skinName="teamFbFightSkin";return _this}TeamFbFightWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.teamFbMember.touchEnabled=false;this.teamFbMember.touchChildren=false;this.gonglveTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.gonglveTxt.text)};TeamFbFightWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.observe(UserFb.ins().postFbTime,this.setTime);TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1e3,0,this.update,this);this.setTime([UserFb.ins().curFbID,UserFb.ins().curFbLeftTime]);this.updateFbName();this.update()};TeamFbFightWin.prototype.close=function(){};TeamFbFightWin.prototype.updateFbName=function(){var cfg;for(var key in GlobalConfig.TeamFuBenConfig){cfg=GlobalConfig.TeamFuBenConfig[key];if(cfg.fbid==GameMap.fubenID){this.teamFbName.source=cfg.nameImg;this._roomID=cfg.id;break}}};TeamFbFightWin.prototype.setTime=function(args){TimerManager.ins().remove(this.updateLeftTime,this);if(GameMap.fbType==UserFb.FB_TEAM){this._leftTime=args[1];this.updateLeftTime();TimerManager.ins().doTimer(1e3,0,this.updateLeftTime,this)}};TeamFbFightWin.prototype.updateLeftTime=function(){this.leftTimeTxt.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4);if(this._leftTime<=0){TimerManager.ins().remove(this.updateLeftTime,this);return}this._leftTime--};TeamFbFightWin.prototype.onTouch=function(e){switch(e.target){case this.target1:case this.target2:case this.target3:case this.target4:case this.boss:if(e.target.data&&e.target.data.infoModel){SysSetting.ins().setValue("mapClickTx",0);SysSetting.ins().setValue("mapClickTy",0);GameLogic.ins().postChangeAttrPoint(e.target.data.infoModel.handle)}break;case this.gonglveTxt:ViewManager.ins().open(TeamFbGuideWin,this._roomID);break}};TeamFbFightWin.prototype.update=function(){var char;var roleList=EntityManager.ins().getAllEntity();var roleModel;var infoModel;var teamMembers=[];var teamRoles=[];var monsters=[];var boss;for(var i in roleList){char=roleList[i];infoModel=char.infoModel;if(!infoModel)continue;if(infoModel.type==EntityType.Role||infoModel.type==EntityType.LadderPlayer){roleModel=infoModel;if(roleModel.masterHandle!=Actor.handle){var index=teamMembers.indexOf(roleModel.masterHandle);if(index==-1){teamMembers.push(roleModel.masterHandle);teamRoles[teamRoles.length]=[char]}else{teamRoles[index].push(char)}}}else if(infoModel.type==EntityType.Monster&&infoModel.getAtt(AttributeType.atHp)>0){var monsterConfig=GlobalConfig.MonstersConfig[infoModel.configID];if(!monsterConfig)continue;if(monsterConfig.type==4||monsterConfig.type==3)continue;var isBoss=monsterConfig.type==1;if(!isBoss&&!infoModel.masterHandle&&monsters.length<4)monsters.push(char);if(isBoss)boss=char}}this.teamFbMember.visible=teamRoles.length>0;var tLen=teamRoles.length;var item;for(var i=0;i<2;i++){item=this["member"+(i+1)];if(i+1<=tLen){item.visible=true;item.data=teamRoles[i]}else item.visible=false}var monster;var len=monsters.length;for(var i=1;i<5;i++){monster=this["target"+i];if(i<=len){this.teamFbTarget.addChild(monster);monster.data=monsters[i-1]}else DisplayUtils.removeFromParent(monster)}if(boss){this.boss.data=boss;this.teamFbTarget.addChildAt(this.boss,Math.ceil(this.teamFbTarget.numChildren/2))}else DisplayUtils.removeFromParent(this.boss)};return TeamFbFightWin}(BaseEuiView);__reflect(TeamFbFightWin.prototype,"TeamFbFightWin");ViewManager.ins().reg(TeamFbFightWin,LayerManager.UI_Main);var TeamFbFriendInviteWin=function(_super){__extends(TeamFbFriendInviteWin,_super);function TeamFbFriendInviteWin(){var _this=_super.call(this)||this;_this.skinName="TeamFbFriendInviteWinSKin";_this.isTopLevel=true;return _this}TeamFbFriendInviteWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.friendTeamInvitelist.itemRenderer=TeamFbInviteItemRender1;this.friendTeamInvitelist.dataProvider=Friends.ins().inviteMsgList;this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.AllrefuseBtn,this.onTouch);this.observe(Friends.ins().postInviteMsgListIsNull,this.closeView)};TeamFbFriendInviteWin.prototype.close=function(){};TeamFbFriendInviteWin.prototype.closeView=function(){ViewManager.ins().close(this)};TeamFbFriendInviteWin.prototype.onTouch=function(e){var self=this;switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.AllrefuseBtn:Friends.ins().inviteMsgListSource=[];Friends.ins().inviteMsgList.source=[];Friends.ins().postInviteMsgListIsNull();TimerManager.ins().doTimer(200,1,function(){ViewManager.ins().close(self)},this);break}};return TeamFbFriendInviteWin}(BaseEuiView);__reflect(TeamFbFriendInviteWin.prototype,"TeamFbFriendInviteWin");ViewManager.ins().reg(TeamFbFriendInviteWin,LayerManager.UI_Popup);var TeamFbGuideWin=function(_super){__extends(TeamFbGuideWin,_super);function TeamFbGuideWin(){var _this=_super.call(this)||this;_this.skinName="teamFbGuideSkin";return _this}TeamFbGuideWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=TeamFbGuideItemrender};TeamFbGuideWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._roomId=args[0];this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.update()};TeamFbGuideWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch);this.removeTouchEvent(this.closeBtn,this.onTouch)};TeamFbGuideWin.prototype.update=function(){this.fbName.text=GlobalConfig.TeamFuBenConfig[this._roomId].name;if(!this._collect){this._collect=new ArrayCollection;this.list.dataProvider=this._collect}var len=Object.keys(GlobalConfig.TeamFuBenGuideConfig[this._roomId]).length;var datas=[];for(var i=1;i<=len;i++)datas.push(GlobalConfig.TeamFuBenGuideConfig[this._roomId][i]);this._collect.source=datas};TeamFbGuideWin.prototype.onTouch=function(e){ViewManager.ins().close(this)};return TeamFbGuideWin}(BaseEuiView);__reflect(TeamFbGuideWin.prototype,"TeamFbGuideWin");ViewManager.ins().reg(TeamFbGuideWin,LayerManager.UI_Main);var TeamFbInviteWin=function(_super){__extends(TeamFbInviteWin,_super);function TeamFbInviteWin(){var _this=_super.call(this)||this;_this._deDes="";_this.skinName="teamFbInviteSkin";_this.isTopLevel=true;return _this}TeamFbInviteWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._deDes=args[0];this._room=args[1];this._configID=args[2];this.input.text=this._deDes;this.input.maxChars=40;this.addTouchEvent(this,this.onTouch);Friends.ins().sendFriendsList()};TeamFbInviteWin.prototype.close=function(){};TeamFbInviteWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.worldInviteBtn:var t=UserFb.ins().getTfInviteCD();if(t>0){UserTips.ins().showTips(i18n("TeamFbInviteWin_0",t));return}UserFb.ins().sendTfSysInvite(this.getDes()+i18n("TeamFbInviteWin_1",UserFb.ins().tfRoomID,65280));ViewManager.ins().close(this);break;case this.friendInviteBtn:ViewManager.ins().open(FriendListWin,this.getDes()+i18n("TeamFbInviteWin_2",UserFb.ins().tfRoomID,65280));ViewManager.ins().close(this);break}};TeamFbInviteWin.prototype.getDes=function(){var str=!this.input.text?this._deDes:this.input.text;var nameStr=i18n("TeamFbInviteWin_4",2933499,Actor.myName);if(str==this._deDes)str=str.replace(i18n("TeamFbInviteWin_3"),nameStr);else str=nameStr+str;return str};return TeamFbInviteWin}(BaseEuiView);__reflect(TeamFbInviteWin.prototype,"TeamFbInviteWin");ViewManager.ins().reg(TeamFbInviteWin,LayerManager.UI_Popup);var TeamFbNewPanel=function(_super){__extends(TeamFbNewPanel,_super);function TeamFbNewPanel(){var _this=_super.call(this)||this;_this._index=0;return _this}TeamFbNewPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.Fblist.itemRenderer=TeamFbItemRender;this.showCount()};TeamFbNewPanel.prototype.showCount=function(){var maxAwardCount=UserFb.ins().getTeamfbAwardCountMax();var maxHelpCount=GlobalConfig.TeamFuBenBaseConfig.maxHelpCount;this.awardCountTxt.text=UserFb.ins().awardCount.toString()+"/"+maxAwardCount.toString();this.helpCountTxt.text=UserFb.ins().helpCount.toString()+"/"+maxHelpCount.toString()};TeamFbNewPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(UserFb.ins().postFTRoomPassInfo,this.update);MessageCenter.ins().addListener(UserFb.TEAM_FB_WIN_REFLASH_PANEL,this.listFresh,this);this._firstOpen=true;this.update()};TeamFbNewPanel.prototype.close=function(){MessageCenter.ins().removeListener(UserFb.TEAM_FB_WIN_REFLASH_PANEL,this.listFresh,this);this.removeObserve();TimerManager.ins().removeAll(this)};TeamFbNewPanel.prototype.listFresh=function(obj,param){if(!this._collect)return;if(obj.itemIndex==this._collect.length-1){var itemHeight=UserFb.TF_EXPAND_HEIGHT-UserFb.TF_SIMLPE_HEIGHT;if(param==true){this.Fblist.scrollV=this.Fblist.contentHeight-this.Fblist.height+itemHeight}else{this.Fblist.scrollV=this.Fblist.contentHeight-this.Fblist.height-itemHeight}this.Fblist.validateNow()}};TeamFbNewPanel.prototype.update=function(){if(!this._collect){this._collect=new ArrayCollection;this.Fblist.dataProvider=this._collect}var len=Object.keys(GlobalConfig.TeamFuBenConfig).length;var source=[];var index=0;var open;for(var i=0;i<len;i++){open=GlobalConfig.TeamFuBenConfig[i+1].id==UserFb.ins().tfOpenID;if(open)this._index=i;source.push({config:GlobalConfig.TeamFuBenConfig[i+1],passID:UserFb.ins().tfPassID,open:open})}this._collect.source=source;this.Fblist.validateNow();if(this._firstOpen){this._firstOpen=false;TimerManager.ins().doTimer(50,1,this.selectCanChallege,this);this.selectCanChallege()}};TeamFbNewPanel.prototype.selectCanChallege=function(){var off=(this._index+1)*UserFb.TF_SIMLPE_HEIGHT-this.Fblist.height+UserFb.TF_EXPAND_HEIGHT-UserFb.TF_SIMLPE_HEIGHT;this.Fblist.scrollV=off>0?off:0;this.Fblist.validateNow()};return TeamFbNewPanel}(BaseEuiView);__reflect(TeamFbNewPanel.prototype,"TeamFbNewPanel");var TeamFbResultWin=function(_super){__extends(TeamFbResultWin,_super);function TeamFbResultWin(){var _this=_super.call(this)||this;_this._result=0;_this.skinName="teamFbResultSkin";_this.isTopLevel=true;return _this}TeamFbResultWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.listItem.itemRenderer=ItemBase;this.listChallenger.itemRenderer=ChallengerHeadItemRender;this.listAssistant.itemRenderer=AssistantHeadItemRender;this.list0.itemRenderer=DefeatItem};TeamFbResultWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._configID=args[0];this._result=args[1];this._list=args[2];this.addTouchEvent(this,this.onTouch);this.update()};TeamFbResultWin.prototype.close=function(){};TeamFbResultWin.prototype.showReward=function(showRewards){if(showRewards===void 0){showRewards=[]}var hasPrivi=Recharge.ins().franchise>0;var rewards=showRewards;if(hasPrivi){rewards=deepCopy(rewards);for(var _i=0,rewards_1=rewards;_i<rewards_1.length;_i++){var reward=rewards_1[_i];reward.count*=2}}this.listItem.dataProvider=new ArrayCollection(rewards)};TeamFbResultWin.prototype.update=function(){var rewardShow=GlobalConfig.TeamFuBenConfig[this._configID].rewardShow;this.title.source=this._result?"result_json.win_02":"result_json.lost_02";this.bg.source=this._result?"win_png":"lost_png";this.win.visible=this._result>0;this.defeat.visible=this._result==0;this._hasCaptain=false;var helpList=[];var vo;var isHelp;var isCaptain;for(var i=0;i<this._list.length;i++){if(this._list[i].position==2){vo=this._list.splice(i,1)[0];helpList.push(vo);if(vo.roleID==Actor.actorID){rewardShow=GlobalConfig.TeamFuBenConfig[this._configID].helpReward;isHelp=true}i--}else if(this._list[i].position==1){if(this._list[i].roleID==Actor.actorID){rewardShow=GlobalConfig.TeamFuBenConfig[this._configID].rewardShow;isCaptain=true}this._hasCaptain=true}else if(this._list[i].position==3){if(this._list[i].roleID==Actor.actorID){rewardShow=[]}}else if(this._list[i].position==4){if(this._list[i].roleID==Actor.actorID){rewardShow=GlobalConfig.TeamFuBenConfig[this._configID].rewardShow}}}this.showReward(rewardShow);this.labelItem.visible=rewardShow.length>0?true:false;this.labelAssistant.visible=helpList.length>0?true:false;this.assResultTxt.visible=isHelp;if(this._result==0)this.updateDefeatList();this.listChallenger.dataProvider=new ArrayCollection(this._list);var len=helpList.length;var newList=[];for(var i=0;i<len;i++)newList.push({vo:helpList[i],id:this._configID});this.listAssistant.dataProvider=new ArrayCollection(newList);this.closeBtn.visible=isCaptain&&this._result==1;this.closeBtn.horizontalCenter=0;this.challengeBtn.visible=false;this._exitTime=5;TimerManager.ins().doTimer(1e3,0,this.repeate,this);this.repeate()};TeamFbResultWin.prototype.updateDefeatList=function(){var gainWay=[];for(var i in GlobalConfig.DeathGuideConfig){var cfg=GlobalConfig.DeathGuideConfig[i];if(UserZs.ins().lv<=cfg.zslv||Actor.level<=cfg.lv){for(var j in cfg.gainWay){if(cfg.gainWay[j][0]==16){var pic_img=DieGuide.ins().getOpenRoles();if(pic_img){var desConfig=GlobalConfig.DeathgainWayConfig[cfg.gainWay[j][0]];desConfig.itemId=pic_img;gainWay.push(cfg.gainWay[j][0])}continue}gainWay.push(cfg.gainWay[j][0])}break}}this.list0.dataProvider=new ArrayCollection(gainWay)};TeamFbResultWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:this.exitFb();break;case this.challengeBtn:this.exitFb(1);break;case this.openRole:case this.openRole1:ViewManager.ins().close(this);ViewManager.ins().open(NewRoleWin);break}};TeamFbResultWin.prototype.repeate=function(){this.closeBtn.label=i18n("TeamFbResultWin_0")+this._exitTime+"秒)";this.assResultTxt.text=i18n("TeamFbResultWin_1")+this._exitTime+"秒）";if(this._exitTime<=0){TimerManager.ins().removeAll(this);this.exitFb();return}this._exitTime--};TeamFbResultWin.prototype.exitFb=function(type){if(type===void 0){type=0}if(this._result==0)UserFb.ins().sendExitFb();else{if(this._hasCaptain)UserFb.ins().sendExitTFFb(type,this._configID);else UserFb.ins().sendExitFb()}ViewManager.ins().close(this)};return TeamFbResultWin}(BaseEuiView);__reflect(TeamFbResultWin.prototype,"TeamFbResultWin");ViewManager.ins().reg(TeamFbResultWin,LayerManager.UI_Popup);var TeamFbRoomWin=function(_super){__extends(TeamFbRoomWin,_super);function TeamFbRoomWin(){var _this=_super.call(this)||this;_this._state=0;_this._room=0;_this._isHost=true;_this.requestingRobot=false;_this.clicked=false;_this.skinName="teamFbRoomSkin";_this.isTopLevel=true;return _this}TeamFbRoomWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.itemList.itemRenderer=ItemBase};TeamFbRoomWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._state=args[0];this._config=GlobalConfig.TeamFuBenConfig[args[1]];this._room=args[2];this._isHost=args[3];this.observe(UserFb.ins().postFTRoomChange,this.onRoomInfoChange);this.observe(UserFb.ins().postCreateTFRoomSuccess,this.createSuccess);this.addTouchEvent(this,this.onTouch);this.addTouchEvent(this.arrowLast,this.onTouch);this.addTouchEvent(this.arrowNext,this.onTouch);this.update();this.onRoomInfoChange();ViewManager.ins().open(ChatMainUI)};TeamFbRoomWin.prototype.close=function(){ViewManager.ins().close(ChatMainUI);TimerManager.ins().removeAll(this)};TeamFbRoomWin.prototype.createSuccess=function(){this._room=UserFb.ins().tfRoomID;this.onRoomInfoChange()};TeamFbRoomWin.prototype.update=function(){if(!this._collect){this._collect=new ArrayCollection;this.itemList.dataProvider=this._collect}this.showReward(this._config.rewardShow);this.fbName.text=this._config.name;this.passTxt.visible=false;this.infoText.visible=false;this.roleGroup.visible=true;this.challengeBtn.visible=false;this.fastGameBtn.visible=false;this.leader.visible=this.member1.visible=this.member2.visible=false;if(this._state==0){this.roleGroup.visible=false;this.infoText.visible=true;this.infoText.textFlow=TextFlowMaker.generateTextFlow(i18n("TeamFbRoomWin_0",GlobalConfig.TeamFuBenConfig[this._config.id-1].name))}else{this.challengeBtn.visible=true;this.fastGameBtn.visible=true;if(this._room<=0)UserFb.ins().sendCreateTFRoom(this._config.id)}var maxAwardCount=UserFb.ins().getTeamfbAwardCountMax();var maxHelpCount=GlobalConfig.TeamFuBenBaseConfig.maxHelpCount;if(this._isHost){this.awardCountGroup.visible=true;this.awardCountTxt.text=UserFb.ins().awardCount.toString()+"/"+maxAwardCount.toString();this.joinerGroup.visible=false}else{this.awardCountGroup.visible=false;this.joinerGroup.visible=true;this.cb1.label=i18n("TeamFbRoomWin_1")+UserFb.ins().awardCount+"/"+maxAwardCount;this.cb2.label=i18n("TeamFbRoomWin_2")+UserFb.ins().helpCount+"/"+maxHelpCount;if(UserFb.ins().awardCount>0){this.cb1.selected=true;this.cb2.selected=false;this.sendChangeJob(4)}else if(UserFb.ins().helpCount>0){this.cb1.selected=false;this.cb2.selected=true;this.sendChangeJob(2)}else{this.cb1.selected=false;this.cb2.selected=false;this.sendChangeJob(3)}this.cb1.touchEnabled=UserFb.ins().awardCount>0?true:false;this.cb2.touchEnabled=UserFb.ins().helpCount>0?true:false;this.addTouchEvent(this.cb1,this.onTouch);this.addTouchEvent(this.cb2,this.onTouch)}this.arrowLast.visible=this._config.id>1&&this._isHost;this.arrowNext.visible=this._config.id<10&&this._isHost&&this._config.id<UserFb.ins().tfOpenID;this.member1.hideWing();this.member2.hideWing();this.leader.hideWing()};TeamFbRoomWin.prototype.showReward=function(showRewards){if(showRewards===void 0){showRewards=[]}var hasPrivi=Recharge.ins().franchise>0;var rewards=showRewards;if(hasPrivi){rewards=deepCopy(rewards);for(var _i=0,rewards_2=rewards;_i<rewards_2.length;_i++){var reward=rewards_2[_i];reward.count*=2}}this._collect.source=rewards;this.itemList.x=500/2-90*rewards.length/2};TeamFbRoomWin.prototype.onRoomInfoChange=function(){if(!this._room)return;var len=UserFb.ins().tfMembers?UserFb.ins().tfMembers.length:0;var vo,role;var arr=[this.member1,this.member2];for(var i=0;i<len;i++){if(UserFb.ins().tfMembers[i].position==1)this.leader.data={vo:UserFb.ins().tfMembers[i],configID:this._config.id};else{role=arr.shift();role.data={vo:UserFb.ins().tfMembers[i],configID:this._config.id}}}len=arr.length;for(var i=0;i<len;i++)arr[i].data={vo:null,configID:this._config.id};arr.length=0;arr=null;this.member1.visible=this.member1.data!=null;this.member2.visible=this.member2.data!=null;this.leader.visible=this.leader.data!=null;var roomFull=this.member1.data!=null&&this.member1.data.vo!=null&&this.member2.data!=null&&this.member2.data.vo!=null&&this.leader.data!=null&&this.leader.data.vo!=null;this.fastGameBtn.visible=!roomFull;this.challengeBtn.horizontalCenter=roomFull?0:-100;if(this.requestingRobot||roomFull){this.fastGameBtn.enabled=false;this.fastGameBtn.label=i18n("TeamFbRoomWin_3")}else{this.fastGameBtn.enabled=true;this.fastGameBtn.label=i18n("TeamFbRoomWin_4")}};TeamFbRoomWin.prototype.sendChangeJob=function(job){UserFb.ins().sendChangeJob(this._room,job);switch(job){case 1:case 4:this.showReward(this._config.rewardShow);break;case 2:this.showReward(this._config.helpReward);break;case 3:this.showReward();break}};TeamFbRoomWin.prototype.reqRobot=function(){UserFb.ins().sendReqRobot()};TeamFbRoomWin.prototype.onTouch=function(e){switch(e.target){case this.cb1:var job=3;if(this.cb1.selected){job=4;if(this.cb2.selected){this.cb2.selected=false}}this.sendChangeJob(job);break;case this.cb2:var job=3;if(this.cb2.selected){job=2;if(this.cb1.selected){this.cb1.selected=false}}this.sendChangeJob(job);break;case this.challengeBtn:if(!UserFb.ins().isTFCaptain){UserTips.ins().showTips(i18n("TeamFbRoomWin_6"));return}if(UserFb.ins().checkInFB())return;UserFb.ins().sendBeginTF();ViewManager.ins().close(TeamFbRoomWin);break;case this.fastGameBtn:if(!UserFb.ins().isTFCaptain){UserTips.ins().showTips(i18n("TeamFbRoomWin_7"));return}var str=GlobalConfig.TeamFuBenBaseConfig.inviteText.replace("{0}",this._config.name);var nameStr=i18n("TeamFbRoomWin_12",2933499,Actor.myName);str=str.replace(i18n("TeamFbRoomWin_8"),nameStr);UserFb.ins().sendTfSysInvite(str+i18n("TeamFbRoomWin_9",UserFb.ins().tfRoomID,65280));var robotAddTime=this._config.robotAddTime;if(Recharge.ins().franchise>0){robotAddTime=this._config.priviRobotAddTime}this.requestingRobot=true;TimerManager.ins().doTimer(robotAddTime[0]*1e3,1,this.reqRobot,this);TimerManager.ins().doTimer(robotAddTime[1]*1e3,1,function(){this.reqRobot();this.requestingRobot=false},this);this.fastGameBtn.enabled=false;this.fastGameBtn.label=i18n("TeamFbRoomWin_10");break;case this.closeBtn0:if(this._state==1){WarnWin.show(i18n("TeamFbRoomWin_11"),function(){UserFb.ins().sendExitTFRoom();ViewManager.ins().close(TeamFbRoomWin)},this)}else ViewManager.ins().close(this);break;case this.arrowLast:this.onArrow(0);break;case this.arrowNext:this.onArrow(1);break}};TeamFbRoomWin.prototype.onArrow=function(p){if(p===void 0){p=0}if(!this.clicked){var self=this;UserFb.ins().sendChangeRoom(p);self.clicked=true;setTimeout(function(){self.clicked=false},200)}};return TeamFbRoomWin}(BaseEuiView);__reflect(TeamFbRoomWin.prototype,"TeamFbRoomWin");ViewManager.ins().reg(TeamFbRoomWin,LayerManager.UI_Popup);var AssistantHeadItemRender=function(_super){__extends(AssistantHeadItemRender,_super);function AssistantHeadItemRender(){var _this=_super.call(this)||this;_this.skinName="assistantHeadSkin";return _this}AssistantHeadItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};AssistantHeadItemRender.prototype.dataChanged=function(){var job=fixJob(this.data.vo.job);var sex=fixSex(this.data.vo.sex);this.Name.text=this.data.vo.roleName;this.imgBg.source=ChatListItemRenderer.HEAD_BG[sex];this.imgHead.source="head_"+job+sex;this.charm.text=i18n("AssistantHeadItemRender_0",GlobalConfig.TeamFuBenConfig[this.data.id].chiv)};return AssistantHeadItemRender}(BaseItemRender);__reflect(AssistantHeadItemRender.prototype,"AssistantHeadItemRender");var ChallengerHeadItemRender=function(_super){__extends(ChallengerHeadItemRender,_super);function ChallengerHeadItemRender(){var _this=_super.call(this)||this;_this.skinName="challengerHeadSkin";return _this}ChallengerHeadItemRender.prototype.dataChanged=function(){var job=fixJob(this.data.job);var sex=fixSex(this.data.sex);this.Name.text=this.data.roleName;this.imgBg.source=ChatListItemRenderer.HEAD_BG[sex];this.imgHead.source="head_"+job+sex};return ChallengerHeadItemRender}(BaseItemRender);__reflect(ChallengerHeadItemRender.prototype,"ChallengerHeadItemRender");var FriendItemRender=function(_super){__extends(FriendItemRender,_super);function FriendItemRender(){var _this=_super.call(this)||this;_this.skinName="friendItemSkin";return _this}FriendItemRender.prototype.dataChanged=function(){var job=fixJob(this.data.job);var sex=fixSex(this.data.sex);this.labelName.text=this.data.name;this.imgBg.source=ChatListItemRenderer.HEAD_BG[sex];this.imgHead.source="head_"+job+sex;this.labelGuild.text=this.data.guildName?this.data.guildName:"";this.labelLv.text=(this.data.zs?this.data.zs+i18n("FriendItemRender_0"):"")+this.data.lv+i18n("FriendItemRender_1")};return FriendItemRender}(BaseItemRender);__reflect(FriendItemRender.prototype,"FriendItemRender");var TeamFbGuideItemrender=function(_super){__extends(TeamFbGuideItemrender,_super);function TeamFbGuideItemrender(){return _super.call(this)||this}TeamFbGuideItemrender.prototype.dataChanged=function(){var cfg=this.data;this.monHeadImg.source=cfg.monHead;this.nameTxt.text=cfg.monName;this.dangerLvTxt.textFlow=TextFlowMaker.generateTextFlow(cfg.dangerLv);this.guideTxt.textFlow=TextFlowMaker.generateTextFlow(cfg.guideText)};return TeamFbGuideItemrender}(BaseItemRender);__reflect(TeamFbGuideItemrender.prototype,"TeamFbGuideItemrender");var TeamFbInviteItemRender1=function(_super){__extends(TeamFbInviteItemRender1,_super);function TeamFbInviteItemRender1(){var _this=_super.call(this)||this;_this.skinName="TeamFbFriendInviteItemSkin";return _this}TeamFbInviteItemRender1.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this);this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){Friends.ins().FriendsInviteMsgDel(_this.data.msg);Friends.ins().removeInviteMsgListSourceAt(_this.data.msg);ViewManager.ins().close(TeamFbFriendInviteWin)},this);this.btn_no.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){Friends.ins().removeInviteMsgListSourceAt(_this.data.msg)},this)};TeamFbInviteItemRender1.prototype.dataChanged=function(){var msg=this.data.msg;var rolename=msg.substring(0,msg.indexOf(i18n("TeamFbInviteItemRender_1")));var newrolename=rolename.replace("2933499","0x03b154");var fbname=msg.substring(msg.indexOf(i18n("TeamFbInviteItemRender_1"))+3,msg.indexOf(i18n("TeamFbInviteItemRender_3")));var newfbname=i18n("TeamFbInviteItemRender_4")+fbname+"|";var nowshowMsg=newrolename+i18n("TeamFbInviteItemRender_1")+newfbname+i18n("TeamFbInviteItemRender_3")+i18n("TeamFbInviteItemRender_2");this.label.textFlow=TextFlowMaker.generateTextFlow1(nowshowMsg)};return TeamFbInviteItemRender1}(BaseItemRender);__reflect(TeamFbInviteItemRender1.prototype,"TeamFbInviteItemRender1");var TeamFbItemRender=function(_super){__extends(TeamFbItemRender,_super);function TeamFbItemRender(){var _this=_super.call(this)||this;_this._isShow=false;_this.skinName="teamFbItem";return _this}TeamFbItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.Rewardlist.itemRenderer=ItemBase;this.gonglveTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.gonglveTxt.text)};TeamFbItemRender.prototype.dataChanged=function(){var hasPrivi=Recharge.ins().franchise>0;this.labelPrivi.visible=hasPrivi;this.nameImg.source=this.data.config.nameImg;this.fbDesc.textFlow=TextFlowMaker.generateTextFlow(this.data.config.infoText);this.head.source=this.data.config.bossImg;var rewards=this.data.config.rewardShow;if(hasPrivi){rewards=deepCopy(rewards);for(var _i=0,rewards_3=rewards;_i<rewards_3.length;_i++){var reward=rewards_3[_i];reward.count*=2}}this.Rewardlist.dataProvider=new ArrayCollection(rewards);this.nameTxt.text=this.data.config.bossName;this.fbImg.source=this.data.config.guanqiaImg;if(this.data.config.lv){this.condTxt.text=this.data.config.lv+i18n("TeamFbItemRender_0");if(Actor.level>=this.data.config.lv){this.condTxt.visible=false}else{this.condTxt.visible=true}}else if(this.data.config.zslv){var zs=UserZs.ins()?UserZs.ins().lv:0;this.condTxt.text=this.data.config.zslv+i18n("TeamFbItemRender_1");if(zs>=this.data.config.zslv){this.condTxt.visible=false}else{this.condTxt.visible=true}}this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.updateStates();if(this.data.open){this._isShow=true;this.currentState="zhankai"}};TeamFbItemRender.prototype.updateStates=function(){this.lock.visible=this.data.config.id>UserFb.ins().tfOpenID;this.unlock.visible=!this.lock.visible;this.createRoomBtn.visible=true;this.done.visible=false};TeamFbItemRender.prototype.onTap=function(e){if(e.target==this.fbImg){this._isShow=!this._isShow;this.currentState=this._isShow?"zhankai":"normal";MessageCenter.ins().dispatch(UserFb.TEAM_FB_WIN_REFLASH_PANEL,this,this._isShow)}else if(e.target==this.createRoomBtn){if(GameMap.fbType!=0){UserTips.ins().showTips(i18n("TeamFbItemRender_2"));return}if(UserFb.ins().isAutoPkBoss()){UserTips.ins().showCenterTips(i18n("TeamFbItemRender_11"));return}if(this.data.config.id>UserFb.ins().tfOpenID){if(this.data.config.lv){if(Actor.level<this.data.config.lv){UserTips.ins().showTips(i18n("TeamFbItemRender_4")+this.data.config.lv+i18n("TeamFbItemRender_3"));return}else{UserTips.ins().showTips(i18n("TeamFbItemRender_5"));return}}else if(this.data.config.zslv){var zs=UserZs.ins()?UserZs.ins().lv:0;if(zs<this.data.config.zslv){UserTips.ins().showTips(i18n("TeamFbItemRender_7")+this.data.config.zslv+i18n("TeamFbItemRender_6"));return}else{UserTips.ins().showTips(i18n("TeamFbItemRender_8"));return}}}else{var count=UserFb.ins().awardCount;if(count<=0){UserTips.ins().showTips(i18n("TeamFbItemRender_9"));return}}if(KfArenaSys.ins().isKFMacthing()){UserTips.ins().showCenterTips(i18n("TeamFbItemRender_10"));return}ViewManager.ins().open(TeamFbRoomWin,this.state,this.data.config.id,0,true)}else if(e.target==this.gonglveTxt)ViewManager.ins().open(TeamFbGuideWin,this.data.config.id)};Object.defineProperty(TeamFbItemRender.prototype,"state",{get:function(){if(this.data.config.id<=UserFb.ins().tfOpenID)return 1;else return 0},enumerable:true,configurable:true});TeamFbItemRender.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};return TeamFbItemRender}(BaseItemRender);__reflect(TeamFbItemRender.prototype,"TeamFbItemRender");var TeamFbMemberItemRender=function(_super){__extends(TeamFbMemberItemRender,_super);function TeamFbMemberItemRender(){var _this=_super.call(this)||this;_this.skinName="teamFbMemberSkin";return _this}TeamFbMemberItemRender.prototype.dataChanged=function(){var roleList=this.data;this.fuhuoImg.visible=false;var len=roleList.length;var hasRole;for(var i=0;i<len;i++){if(roleList[i].infoModel.getAtt(AttributeType.atHp)>0){hasRole=true;this.updateRole(roleList[i]);break}}if(!hasRole){this.updateRole(roleList[0]);this.fuhuoImg.visible=true}};TeamFbMemberItemRender.prototype.updateRole=function(role){var info=role.infoModel;this.roleName.text=info.name;this.roleHead.source="yuanhead"+info.job+info.sex};return TeamFbMemberItemRender}(BaseItemRender);__reflect(TeamFbMemberItemRender.prototype,"TeamFbMemberItemRender");var TeamFbRankItemRender=function(_super){__extends(TeamFbRankItemRender,_super);function TeamFbRankItemRender(){var _this=_super.call(this)||this;_this.skinName="teamFbRankItem";return _this}TeamFbRankItemRender.prototype.dataChanged=function(){if(this.data){this.member.visible=true;this.noteam.visible=false;this.fubenName.text=GlobalConfig.TeamFuBenConfig[this.data.configID].name;var img=void 0;var lbl=void 0;var len=this.data.members.length;for(var i=0;i<3;i++){img=this["img"+i];lbl=this["nameTxt"+i];if(i+1<=len){img.source=this.data.members[i].position==1?"tfb_leader":this.data.members[0].position==2?"tfb_assistant":"";lbl.text=this.data.members[i].roleName}else{img.source="";lbl.text=""}}}else{this.member.visible=false;this.noteam.visible=true}};return TeamFbRankItemRender}(BaseItemRender);__reflect(TeamFbRankItemRender.prototype,"TeamFbRankItemRender");var TeamFbRoleItemRender=function(_super){__extends(TeamFbRoleItemRender,_super);function TeamFbRoleItemRender(){var _this=_super.call(this)||this;_this.skinName="teamFbRoleItem";_this.touchEnabled=false;return _this}TeamFbRoleItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};TeamFbRoleItemRender.prototype.onTouch=function(e){switch(e.target){case this.invite:case this.nomember:if(!UserFb.ins().isTFCaptain){UserTips.ins().showTips(i18n("TeamFbRoleItemRender_0"));return}ViewManager.ins().open(TeamFbInviteWin,GlobalConfig.TeamFuBenBaseConfig.inviteText.replace("{0}",GlobalConfig.TeamFuBenConfig[this.data.configID].name),UserFb.ins().tfRoomID,this.data.configID);break;case this.body:if(this.data.vo.roleID!=Actor.actorID)ViewManager.ins().open(MemberInfoWin,this.data.vo);break}};TeamFbRoleItemRender.prototype.dataChanged=function(){if(!this.data.vo){this.nomember.visible=this.invite.visible=true;this.bodyMc.visible=this.position.visible=this.weaponMc.visible=this.wingMc.visible=false;this.roleName.text=i18n("TeamFbRoleItemRender_1")}else{this.nomember.visible=this.invite.visible=false;this.position.visible=this.bodyMc.visible=this.weaponMc.visible=true;var vo=this.data.vo;this.roleName.text=vo.roleName;switch(vo.position){case 1:this.position.source="tfb_leader";break;case 2:this.position.source="tfb_assistant";break;case 3:case 4:this.position.source=null;break}this.body.source=this.weapon.source=this.wing.source=null;this.bodyMc.removeChildren();this.weaponMc.removeChildren();this.wingMc.removeChildren();var bodyRes="";var weaponRes="";var wingRes="";var clothCfg=GlobalConfig.EquipConfig[vo.cloth];if(clothCfg){var fileName=clothCfg.appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",vo.job+"")}if(fileName.indexOf("903")>0){bodyRes=(vo.cloth>0?fileName+"_":"body"+vo.job+"00_")+vo.sex+"_c"}else{bodyRes=(vo.cloth>0?fileName:"body"+vo.job+"00")+"_c"}}var weaponCfg=GlobalConfig.EquipConfig[vo.weapon];if(weaponCfg){var fileName=weaponCfg.appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",vo.job+"")}weaponRes=vo.weapon>0?fileName+"_"+vo.sex+"_c":""}var wingCfg=GlobalConfig.WingLevelConfig[vo.wingLv];if(wingCfg){wingRes=vo.wingLv>=0?wingCfg.appearance:""}if(vo.pos1>0){bodyRes=getZhuangbanById(vo.pos1).res+"_c"}if(vo.pos2>0){weaponRes=getZhuangbanById(vo.pos2).res+"_"+vo.sex+"_c"}if(vo.pos3>0){wingRes=getZhuangbanById(vo.pos3).res}if(!bodyRes){bodyRes=getDefaultBody(vo.job)+"_c"}this._body=imageToMc(this.body,bodyRes,this.bodyMc);imageToMc(this.weapon,weaponRes,this.weaponMc,this._body);imageToMc(this.wing,wingRes,this.wingMc,this._body)}};TeamFbRoleItemRender.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};TeamFbRoleItemRender.prototype.hideWing=function(){this.wing.visible=this.wingMc.visible=false};return TeamFbRoleItemRender}(BaseItemRender);__reflect(TeamFbRoleItemRender.prototype,"TeamFbRoleItemRender");var TeamFbTargetItemRender=function(_super){__extends(TeamFbTargetItemRender,_super);function TeamFbTargetItemRender(){var _this=_super.call(this)||this;_this.skinName="teamFbTargetSkin";_this.touchEnabled=true;_this.touchChildren=false;return _this}TeamFbTargetItemRender.prototype.dataChanged=function(){var monster=this.data;var config=GlobalConfig.MonstersConfig[monster.infoModel.configID];this.roleName.text=config.name;if(this.checkMonHead(config))this.roleHead.source="monhead"+config.head+"_png";if(GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==monster.infoModel.handle){this.addAttEffect();this.targetName.visible=true;this.targetSelect.visible=true}else{this.removeAttEffect();this.targetName.visible=false;this.targetSelect.visible=false}};TeamFbTargetItemRender.prototype.checkMonHead=function(config){if(Assert(config.head,i18n("TeamFbTargetItemRender_0",config.id,config.name)))return false;return true};TeamFbTargetItemRender.prototype.addAttEffect=function(){if(!this.attEffect){this.attEffect=new MovieClip;this.attEffect.x=49;this.attEffect.y=28;this.attEffect.playFile(RES_DIR_EFF+"FightingEff",-1);this.addChild(this.attEffect)}};TeamFbTargetItemRender.prototype.removeAttEffect=function(){if(this.attEffect){this.attEffect.destroy();this.attEffect=null}};return TeamFbTargetItemRender}(BaseItemRender);__reflect(TeamFbTargetItemRender.prototype,"TeamFbTargetItemRender");var TeamFuBenRoleVo=function(){function TeamFuBenRoleVo(){}TeamFuBenRoleVo.prototype.parse=function(bytes){this.roleID=bytes.readInt();this.position=bytes.readByte();this.roleName=bytes.readString();this.job=bytes.readByte();this.sex=bytes.readByte();this.cloth=bytes.readInt();this.weapon=bytes.readInt();this.wingLv=bytes.readInt();this.wingState=bytes.readByte();this.pos1=bytes.readInt();this.pos2=bytes.readInt();this.pos3=bytes.readInt();this.zs=bytes.readInt();this.lv=bytes.readInt()};return TeamFuBenRoleVo}();__reflect(TeamFuBenRoleVo.prototype,"TeamFuBenRoleVo");var BossResultWin=function(_super){__extends(BossResultWin,_super);function BossResultWin(){var _this=_super.call(this)||this;_this.repeatTimes=5;return _this}BossResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="BossResultSkin";this.listItem.itemRenderer=ItemBase;this.rankrewardlistItem.itemRenderer=ItemBase;this.listData0=new eui.ArrayCollection;this.winnerEff=new MovieClip;this.winnerEff.x=41;this.winnerEff.y=41;this.winnerEff.touchEnabled=false};BossResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this._fbType=GameMap.fbType;var result=param[0];this.bg.source="win_png";this.closeBtn.name=i18n("BossResultWin_0");this.title.source="win_02";this.bosshomeGroup.visible=false;var closeTime=5;if(GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS){closeTime=10}this.s=this.repeatTimes=closeTime;this.updateCloseBtnLabel();TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var rewards=param[0];if(param[1]){var isBelong=param[1][0];if(isBelong){if(!this.winnerEff.parent)this.effGroup.addChild(this.winnerEff);this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1)}var tname=param[1][1]||"";var strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];tname=StringUtils.replaceStr(tname,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+"");this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(tname);this.labelItem.text=isBelong?i18n("BossResultWin_1"):i18n("BossResultWin_2");this.roleIcon.icon=param[1][2];this.roleIcon["jobImg"].visible=false}else{this.belongTxt.text=""}this.addTouchEvent(this.closeBtn,this.onTap);if(rewards)this.setRewardList(rewards);else this.setRewardList();this.newBossHomeshow()};BossResultWin.prototype.newBossHomeshow=function(){if(this._fbType==UserFb.FB_TYPE_HOMEBOSS){this.winnerGroup.visible=false;this.bosshomeGroup.visible=true;this.showRanklist();this.showRankReward()}else{this.winnerGroup.visible=true;this.bosshomeGroup.visible=false}};BossResultWin.prototype.showRanklist=function(){this.dataPro=new eui.ArrayCollection;this.ranklist.itemRenderer=DropDownListItem;this.ranklist.dataProvider=this.dataPro;var dataArr=UserBoss.ins().rank?UserBoss.ins().rank.concat():[];var showArr=dataArr.slice(0,3);this.dataPro.replaceAll(showArr)};BossResultWin.prototype.showRankReward=function(){var rewardList=[];var rankdataArr=UserBoss.ins().rank?UserBoss.ins().rank.concat():[];var length=rankdataArr.length;if(rankdataArr.length>=3)length=3};BossResultWin.prototype.setRewardList=function(rewards){if(rewards===void 0){rewards=[]}var coinData=[];var emblemData=[];var itemData=[];this.labelItem.visible=true;var soulData=[];var rewardList=[];for(var i=0;i<rewards.length;i++){var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];if(ItemConfig.getType(itemConfig)==1){if(emblemData.length){var ishave=false;for(var j=0;j<emblemData.length;j++){if(emblemData[j].id==rewards[i].id){emblemData[j].count+=rewards[i].count;ishave=true;break}}if(!ishave)emblemData.push(rewards[i])}else{emblemData.push(rewards[i])}continue}if(rewards[i].type==0){if(rewards[i].id==MoneyConst.soul){soulData.push(rewards[i])}else{coinData.push(rewards[i])}}else{itemData.push(rewards[i])}}itemData.sort(this.RuleSortByItem);rewardList=soulData.concat(coinData,emblemData,itemData);this.listItem.dataProvider=new eui.ArrayCollection(rewardList)};BossResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateCloseBtnLabel,this);this.removeTouchEvent(this.closeBtn,this.onTap);if(GameMap.fubenID>0){if(UserFb.ins().isQuite&&this._fbType!=UserFb.FB_TYPE_ZHUANSHENGBOSS){UserFb.ins().sendExitFb()}}if(this._fbType==UserFb.FB_TYPE_HOMEBOSS){ViewManager.ins().open(BossWin,5)}if(this.closeFunc){this.closeFunc();this.closeFunc=null}};BossResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)ViewManager.ins().close(this);this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"};BossResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};BossResultWin.prototype.RuleSortByItem=function(a,b){var aItem=GlobalConfig.ItemConfig[a.id];var bItem=GlobalConfig.ItemConfig[b.id];var aq=ItemConfig.getQuality(aItem);var bq=ItemConfig.getQuality(bItem);if(aq>bq)return-1;else if(aq<bq)return 1;else{return 0}};return BossResultWin}(BaseEuiView);__reflect(BossResultWin.prototype,"BossResultWin");ViewManager.ins().reg(BossResultWin,LayerManager.UI_Popup);var CityResultWin=function(_super){__extends(CityResultWin,_super);function CityResultWin(){return _super.call(this)||this}CityResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="CityResultSkin";this.listItem.itemRenderer=ItemBase;this.listData0=new eui.ArrayCollection;this.winnerEff=new MovieClip;this.winnerEff.x=41;this.winnerEff.y=41;this.winnerEff.touchEnabled=false};CityResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this.addTouchEvent(this.closeBtn,this.onTap);this.bg.source="win_png";this.closeBtn.label=i18n("CityResultWin_0");this.title.source="win_02";if(param[1]){var isBelong=param[1][0];if(isBelong){if(!this.winnerEff.parent)this.effGroup.addChild(this.winnerEff);this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1)}var tname=param[1][1]||"";var strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];tname=StringUtils.replaceStr(tname,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+"");this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(tname);this.labelItem.text=isBelong?i18n("CityResultWin_1"):i18n("CityResultWin_2");this.roleIcon.icon=param[1][2];this.roleIcon["jobImg"].visible=false}var rewards=param[0];if(rewards)this.setRewardList(rewards)};CityResultWin.prototype.setRewardList=function(rewards){if(rewards===void 0){rewards=[]}var coinData=[];var emblemData=[];var itemData=[];var soulData=[];var rewardList=[];for(var i=0;i<rewards.length;i++){var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];if(ItemConfig.getType(itemConfig)==1){if(emblemData.length){var ishave=false;for(var j=0;j<emblemData.length;j++){if(emblemData[j].id==rewards[i].id){emblemData[j].count+=rewards[i].count;ishave=true;break}}if(!ishave)emblemData.push(rewards[i])}else{emblemData.push(rewards[i])}continue}if(rewards[i].type==0){if(rewards[i].id==MoneyConst.soul){soulData.push(rewards[i])}else{coinData.push(rewards[i])}}else{itemData.push(rewards[i])}}itemData.sort(this.RuleSortByItem);rewardList=soulData.concat(coinData,emblemData,itemData);this.listItem.dataProvider=new eui.ArrayCollection(rewardList)};CityResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap)};CityResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};CityResultWin.prototype.RuleSortByItem=function(a,b){var aItem=GlobalConfig.ItemConfig[a.id];var bItem=GlobalConfig.ItemConfig[b.id];var aq=ItemConfig.getQuality(aItem);var bq=ItemConfig.getQuality(bItem);if(aq>bq)return-1;else if(aq<bq)return 1;else{return 0}};return CityResultWin}(BaseEuiView);__reflect(CityResultWin.prototype,"CityResultWin");ViewManager.ins().reg(CityResultWin,LayerManager.UI_Popup);var ExpFbResultWin=function(_super){__extends(ExpFbResultWin,_super);function ExpFbResultWin(){var _this=_super.call(this)||this;_this.s=11;_this.skinName="jyjiangli";_this.lbExp=BitmapNumber.ins().createNumPic(0,"r0",5);_this.lbExp.y=97;_this.lbExp.x=180;_this.mainGroup.addChild(_this.lbExp);return _this}ExpFbResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnGet,this.onTouch);this.observe(UserFb.ins().postFbExpInfo,this.update);this.update();this.s=9;this.btnGet.name=i18n("ExpFbResultWin_0");this.updateCloseBtnLabel();TimerManager.ins().doTimer(1e3,this.s,this.updateCloseBtnLabel,this)};ExpFbResultWin.prototype.onTouch=function(){ViewManager.ins().close(this)};ExpFbResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)ViewManager.ins().close(this);this.btnGet.label=this.btnGet.name+"("+this.s+"s)"};ExpFbResultWin.prototype.close=function(){this.removeObserve();TimerManager.ins().remove(this.updateCloseBtnLabel,this);ViewManager.ins().open(FbWin,1);UserFb.ins().sendExitFb()};ExpFbResultWin.prototype.update=function(){var fbExp=UserFb.ins().fbExp;var config=GlobalConfig.ExpFubenConfig[fbExp.cid||fbExp.sid];if(config){var discount=GlobalConfig.MonthCardConfig.expFubenPrecent/100;var addValue=Recharge.ins().getIsForeve()?1+discount:1;this.setExp(Math.ceil(config.exp*addValue))}};ExpFbResultWin.prototype.setExp=function(exp){BitmapNumber.ins().changeNum(this.lbExp,exp,"r0",5);this.lbExp.anchorOffsetX=this.lbExp.width/2};return ExpFbResultWin}(BaseEuiView);__reflect(ExpFbResultWin.prototype,"ExpFbResultWin");ViewManager.ins().reg(ExpFbResultWin,LayerManager.UI_Popup);var FireResultWin=function(_super){__extends(FireResultWin,_super);function FireResultWin(){var _this=_super.call(this)||this;_this.s=11;_this.skinName="LYRFbResultSkin";_this.lbExp=BitmapNumber.ins().createNumPic(0,"r0",5);_this.lbExp.y=103;_this.lbExp.x=171;_this.mainGroup.addChild(_this.lbExp);return _this}FireResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnGet,this.onTouch);this.s=9;this.btnGet.name=i18n("FireResultWin_0");this.updateCloseBtnLabel();this.setExp();TimerManager.ins().doTimer(1e3,this.s,this.updateCloseBtnLabel,this)};FireResultWin.prototype.onTouch=function(){ViewManager.ins().close(this)};FireResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)ViewManager.ins().close(this);this.btnGet.label=this.btnGet.name+"("+this.s+"s)"};FireResultWin.prototype.close=function(){this.removeObserve();TimerManager.ins().remove(this.updateCloseBtnLabel,this);ViewManager.ins().open(FbWin,1,1);UserFb.ins().sendExitFb()};FireResultWin.prototype.setExp=function(){var exp=GlobalConfig.ActorExRingFubenConfig.reward[0].count;BitmapNumber.ins().changeNum(this.lbExp,exp,"r0",5)};return FireResultWin}(BaseEuiView);__reflect(FireResultWin.prototype,"FireResultWin");ViewManager.ins().reg(FireResultWin,LayerManager.UI_Popup);var MaterialResultWin=function(_super){__extends(MaterialResultWin,_super);function MaterialResultWin(){var _this=_super.call(this)||this;_this.winResult=0;_this.repeatTimes=5;return _this}MaterialResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="DailyFbResultSkin";this.listItem.itemRenderer=ItemBase;this.listData0=new eui.ArrayCollection;this.list0.itemRenderer=DefeatItem};MaterialResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this._fbType=GameMap.fbType;var result=param[0];this.winResult=result;this.bg.source=result?"win_png":"lost_png";this.closeBtn.name=result?i18n("MaterialResultWin_0"):i18n("MaterialResultWin_1");this.title.source=result?"win_02":"lost_02";DieGuide.ins().postdieGuide(result);var closeTime=5;this.s=this.repeatTimes=closeTime;this.updateCloseBtnLabel();TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var rewards=param[1];if(param[2])this.txt.text=param[2];this.txt.visible=result!=0;this.defeat.visible=result==0;this.addTouchEvent(this.closeBtn,this.onTap);if(result==0){this.updateDefeatList()}if(rewards)this.setRewardList(rewards)};MaterialResultWin.prototype.setRewardList=function(rewards){if(rewards===void 0){rewards=[]}var material=[];for(var i=0;i<rewards.length;i++){var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];if(ItemConfig.getType(itemConfig)==1){material.push(rewards[i])}}this.listItem.dataProvider=new eui.ArrayCollection(material)};MaterialResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateCloseBtnLabel,this);this.removeTouchEvent(this.closeBtn,this.onTap);UserFb.ins().sendExitFb();if(this._fbType==UserFb.FB_TYPE_MATERIAL)ViewManager.ins().open(FbWin,0)};MaterialResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)ViewManager.ins().close(this);this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"};MaterialResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};MaterialResultWin.prototype.updateDefeatList=function(){var gainWay=[];for(var i in GlobalConfig.DeathGuideConfig){var cfg=GlobalConfig.DeathGuideConfig[i];if(UserZs.ins().lv<=cfg.zslv||Actor.level<=cfg.lv){for(var j in cfg.gainWay){if(cfg.gainWay[j][0]==16){var pic_img=DieGuide.ins().getOpenRoles();if(pic_img){var desConfig=GlobalConfig.DeathgainWayConfig[cfg.gainWay[j][0]];desConfig.itemId=pic_img;gainWay.push(cfg.gainWay[j][0])}continue}gainWay.push(cfg.gainWay[j][0])}break}}this.listData0.source=gainWay;this.list0.dataProvider=this.listData0};return MaterialResultWin}(BaseEuiView);__reflect(MaterialResultWin.prototype,"MaterialResultWin");ViewManager.ins().reg(MaterialResultWin,LayerManager.UI_Popup);var NewWorldBossResultPanel=function(_super){__extends(NewWorldBossResultPanel,_super);function NewWorldBossResultPanel(){return _super.call(this)||this}NewWorldBossResultPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="wpkResultSkin";this.winnerEff=new MovieClip;this.winnerEff.x=41;this.winnerEff.y=41;this.winnerEff.touchEnabled=false};NewWorldBossResultPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.init()};NewWorldBossResultPanel.prototype.init=function(){if(!this.winnerEff.parent)this.effGroup.addChild(this.winnerEff);this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1);this.s=20;var data=UserBoss.ins().newWorldBossData;this.myrank.text=data.rank?data.rank+"":i18n("NewWorldBossResultPanel_0");this.rankList.itemRenderer=NewWorldBossResultRender;this.rankList.itemRendererSkinName="wpkResultRenderSkin";var rankData=data.rankList.concat();rankData.length>3?rankData.length=3:null;for(var i=0;i<rankData.length;i++){rankData[i].rank=i+1}this.rankList.dataProvider=new eui.ArrayCollection(rankData);this.time.text=DateUtils.getFormatBySecond(data.totalTime,DateUtils.TIME_FORMAT_10);this.weidao.text=data.lastKillRoleName;if(data.randomRoleName&&data.randomAwards&&data.randomAwards.length){this.lucky.visible=true;this.luckyName.text=data.randomRoleName;this.luckyGift.text=GlobalConfig.ItemConfig[data.randomAwards[0].id].name}else{this.lucky.visible=false}this.updateBtn();TimerManager.ins().doTimer(1e3,this.s,this.updateCloseBtnLabel,this);UserFb.ins().isQuite=true};NewWorldBossResultPanel.prototype.onTap=function(e){ViewManager.ins().close(this);UserFb.ins().sendExitFb()};NewWorldBossResultPanel.prototype.updateCloseBtnLabel=function(){this.s>0&&this.s--;if(this.s<=0){ViewManager.ins().close(this);UserFb.ins().sendExitFb()}this.updateBtn()};NewWorldBossResultPanel.prototype.updateBtn=function(){this.closeBtn.label=i18n("NewWorldBossResultPanel_1",this.s)};NewWorldBossResultPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);TimerManager.ins().removeAll(this)};return NewWorldBossResultPanel}(BaseEuiView);__reflect(NewWorldBossResultPanel.prototype,"NewWorldBossResultPanel");ViewManager.ins().reg(NewWorldBossResultPanel,LayerManager.UI_Popup);var NewWorldBossResultRender=function(_super){__extends(NewWorldBossResultRender,_super);function NewWorldBossResultRender(){return _super.call(this)||this}NewWorldBossResultRender.prototype.dataChanged=function(){var data=this.data;this.nameTxt.text=data.roleName;this.valueTxt.text=Math.floor(data.value)+"";this.paihang.source=data.rank<=3?"paihangs"+data.rank:""};return NewWorldBossResultRender}(BaseItemRender);__reflect(NewWorldBossResultRender.prototype,"NewWorldBossResultRender");var PersonalResultWin=function(_super){__extends(PersonalResultWin,_super);function PersonalResultWin(){var _this=_super.call(this)||this;_this.repeatTimes=5;return _this}PersonalResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="PersonalBossResultSkin";this.listCoin.itemRenderer=ResultCoinItem;this.listItem.itemRenderer=ItemBase;this.listData0=new eui.ArrayCollection;this.list0.itemRenderer=DefeatItem};PersonalResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this._fbType=GameMap.fbType;var result=param[0];this.bg.source=result?"win_png":"lost_png";this.closeBtn.name=result?i18n("PersonalResultWin_0"):i18n("PersonalResultWin_1");this.title.source=result?"win_02":"lost_02";DieGuide.ins().postdieGuide(result);var closeTime=5;this.s=this.repeatTimes=closeTime;this.updateCloseBtnLabel();TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var rewards=param[1];if(param[2])this.txt.text=param[2];if(GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON)this.txt.text=i18n("PersonalResultWin_2",GuardWeaponModel.ins().getKillWave());UserFb.ins().isQuite=true;if(param[3]instanceof Function){this.closeFunc=param[3]}this.txt.visible=result!=0;this.defeat.visible=result==0;this.addTouchEvent(this.closeBtn,this.onTap);if(result==0)this.updateDefeatList();if(rewards)this.setRewardList(rewards);else this.setRewardList()};PersonalResultWin.prototype.setRewardList=function(rewards){if(rewards===void 0){rewards=[]}var coinData=[];var itemData=[];var soulData=[];var material=[];var rewardList=[];for(var i=0;i<rewards.length;i++){var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];if(ItemConfig.getType(itemConfig)==1){if(material.length){var ishave=false;for(var j=0;j<material.length;j++){if(material[j].id==rewards[i].id){material[j].count+=rewards[i].count;ishave=true;break}}if(!ishave)material.push(rewards[i])}else{material.push(rewards[i])}continue}if(rewards[i].type==0){coinData.push(rewards[i])}else{itemData.push(rewards[i])}}this.labelItem.text=i18n("PersonalResultWin_3");this.labelItem.height=itemData.length>0?20:0;this.labelItem.visible=itemData.length>0;coinData.sort(this.RuleSort);itemData.sort(this.RuleSortByItem);this.listCoin.dataProvider=new eui.ArrayCollection(coinData);rewardList=soulData.concat(coinData,material,itemData);this.listItem.dataProvider=new eui.ArrayCollection(rewardList)};PersonalResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateCloseBtnLabel,this);this.removeTouchEvent(this.closeBtn,this.onTap);if(GameMap.fubenID>0){if(UserFb.ins().isQuite){UserFb.ins().sendExitFb()}}if(this.closeFunc){this.closeFunc();this.closeFunc=null}};PersonalResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)ViewManager.ins().close(this);this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"};PersonalResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};PersonalResultWin.prototype.updateDefeatList=function(){var gainWay=[];for(var i in GlobalConfig.DeathGuideConfig){var cfg=GlobalConfig.DeathGuideConfig[i];if(UserZs.ins().lv<=cfg.zslv||Actor.level<=cfg.lv){for(var j in cfg.gainWay){if(cfg.gainWay[j][0]==14){var rch=Recharge.ins().getRechargeData(0);if(rch.num&&rch.num!=2){if(UserVip.ins().lv>=Object.keys(GlobalConfig.VipConfig).length)continue}}else if(cfg.gainWay[j][0]==16){var pic_img=DieGuide.ins().getOpenRoles();if(pic_img){var desConfig=GlobalConfig.DeathgainWayConfig[cfg.gainWay[j][0]];desConfig.itemId=pic_img;gainWay.push(cfg.gainWay[j][0])}continue}gainWay.push(cfg.gainWay[j][0])}break}}this.listData0.source=gainWay;this.list0.dataProvider=this.listData0};PersonalResultWin.prototype.RuleSort=function(a,b){if(a.id<b.id)return-1;else return 1};PersonalResultWin.prototype.RuleSortByItem=function(a,b){var aItem=GlobalConfig.ItemConfig[a.id];var bItem=GlobalConfig.ItemConfig[b.id];var aq=ItemConfig.getQuality(aItem);var bq=ItemConfig.getQuality(bItem);if(aq>bq)return-1;else if(aq<bq)return 1;else{return 0}};return PersonalResultWin}(BaseEuiView);__reflect(PersonalResultWin.prototype,"PersonalResultWin");ViewManager.ins().reg(PersonalResultWin,LayerManager.UI_Popup);var ResultCoinItem=function(_super){__extends(ResultCoinItem,_super);function ResultCoinItem(){var _this=_super.call(this)||this;_this.skinName="ResultCoinItemSkin";return _this}ResultCoinItem.prototype.dataChanged=function(){var data=this.data;this.labelInfo.size=20;this.labelInfo.text=i18n("ResultCoinItem_0",RewardData.getCurrencyName(data.id));this.imgCoin.source=RewardData.getCurrencyRes(data.id);this.imgCoin0.source=RewardData.getCurrencyRes(data.id);this.labelCount.text=""+data.count;var plusCount=data.plusCount||0;this.labelPlus.text=plusCount>0?plusCount.toString():"";this.plusGroup.visible=plusCount>0;this.labelInfo.x=0;this.imgCoin.x=this.labelInfo.x+this.labelInfo.textWidth;this.labelCount.x=this.imgCoin.x+this.imgCoin.width;this.plusGroup.x=this.labelCount.x+this.labelCount.width+50};return ResultCoinItem}(eui.ItemRenderer);__reflect(ResultCoinItem.prototype,"ResultCoinItem");var ResultWin=function(_super){__extends(ResultWin,_super);function ResultWin(){var _this=_super.call(this)||this;_this.winResult=0;_this.repeatTimes=5;_this.isBossResult=false;return _this}ResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ResultSkin";this.listCoin.itemRenderer=ResultCoinItem;this.listItem.itemRenderer=ItemBase;this.listEmblem.itemRenderer=ItemBase;this.listData0=new eui.ArrayCollection;this.list0.itemRenderer=DefeatItem;this.winnerEff=new MovieClip;this.winnerEff.x=41;this.winnerEff.y=41;this.winnerEff.touchEnabled=false};ResultWin.prototype.sortFunc=function(a,b){if(a.type==1&&b.type==1){var aItem=GlobalConfig.ItemConfig[a.id];var bItem=GlobalConfig.ItemConfig[b.id];var aq=ItemConfig.getQuality(aItem);var bq=ItemConfig.getQuality(aItem);if(aq>bq)return-1;else if(aq<bq)return 1;else{if(aItem.level>bItem.level)return-1;else if(aItem.level<bItem.level)return 1}}else{if(a.type<b.type)return-1;else if(a.type>b.type)return 1}return 0};ResultWin.prototype.showRune=function(result){if(GameMap.fbType!=UserFb.FB_TYPE_TIAOZHAN){this.nune.visible=false;return}if(!result){this.nune.visible=false;return}var fbconfig=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel-1];if(!fbconfig||!fbconfig.showIcon){this.nune.visible=false;return}var item_config=GlobalConfig.ItemConfig[fbconfig.showIcon];var quality=ItemConfig.getQuality(item_config);if(quality==FBChallengePanel.RunType){this.nune.visible=false;return}this.nune.visible=true;this.scrollerGroup.y+=this.nune.height*3/2;var desc="";if(fbconfig.equipPos){this.nuneLock.visible=true;desc=i18n("ResultWin_0");this.oldValue.text=(fbconfig.equipPos-1).toString();this.newValue.text=fbconfig.equipPos.toString()}else{this.nuneLock.visible=false;desc=i18n("ResultWin_1");this.nuneValue.text=fbconfig.describe}this.nameLabel.text=desc;this.nuneValue.visible=!this.nuneLock.visible};ResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this._fbType=GameMap.fbType;this.doublePrice.visible=false;var result=param[0];this.winResult=result;this.bg.source=result?"win_png":"lost_png";this.closeBtn.name=result?i18n("ResultWin_2"):i18n("ResultWin_3");this.title.source=result?"win_02":"lost_02";DieGuide.ins().postdieGuide(result);this.showRune(result);var closeTime=GameMap.fbType==UserFb.FB_TYPE_EXP?15:5;if(GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS||GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS){closeTime=10}else if(GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS){closeTime=21}this.s=this.repeatTimes=closeTime;this.updateCloseBtnLabel();if(!CityCC.ins().isCity)TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var rewards=param[1];if(param[2])this.txt.text=param[2];UserFb.ins().isQuite=true;if(param[3]instanceof Function){this.closeFunc=param[3]}else{if(param[3]==false){UserFb.ins().isQuite=param[3]}}if(CityCC.ins().isCity)UserFb.ins().isQuite=false;if(param[4]){var isBelong=param[4][0];if(isBelong){if(!this.winnerEff.parent)this.effGroup.addChild(this.winnerEff);this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1)}var tname=param[4][1]||"";var strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];tname=StringUtils.replaceStr(tname,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+"");this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(tname);this.labelItem.text=isBelong?i18n("ResultWin_4"):i18n("ResultWin_5");this.isBossResult=true;this.roleIcon.icon=param[4][2];this.roleIcon["jobImg"].visible=false;this.txt.text=""}else{this.belongTxt.text=""}this.txt.visible=result!=0;this.defeat.visible=result==0;this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.rewardBtn,this.onTap);this.addTouchEvent(this.openRole,this.onTap);this.addTouchEvent(this.openRole1,this.onTap);this.openRole.visible=false;this.defeat.y=210;this.closeBtn.x=90;if(result==0){if(GameMap.fubenID!=0)this.defeat.y=110;this.updateDefeatList()}if(GameMap.fubenID!=0&&result==1){if(GameMap.fbType==UserFb.FB_TYPE_EXP){this.closeBtn.label=i18n("ResultWin_6")}else if(GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){var model=SkyLevelModel.ins();var info=GlobalConfig.FbChallengeConfig[model.cruLevel];if(info){if(UserZs.ins().lv>=info.zsLevelLimit&&Actor.level>=info.levelLimit&&SkyLevelModel.ins().lotteryRemainTimes==0){this.rewardBtn.visible=true;this.closeBtn.x=0;if(info.layer==1){this.rewardBtn.label=i18n("ResultWin_7");this.rewardBtn.width=130}else{this.rewardBtn.label=i18n("ResultWin_8",info.layer);this.rewardBtn.width=180}}else{this.rewardBtn.visible=false;this.closeBtn.x=90}}else{this.rewardBtn.visible=false;this.closeBtn.x=90}}else if(GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS){this.winnerGroup.visible=false;this.closeBtn.visible=false;this.rewardBtn.visible=false;this.txt.visible=false;this.wpkBoss.visible=true;this.wpkBoss.open()}else if(GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU){this.closeBtn.name=i18n("ResultWin_9");this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)";var layer=Hungu.ins().hunShouFBPassID;var isMax=layer>=Object.keys(GlobalConfig.FsFbConfig).length;if(!isMax){this.rewardBtn.visible=true;this.closeBtn.x=0;this.rewardBtn.label=i18n("ResultWin_10",layer+1)}else{this.rewardBtn.visible=false;this.closeBtn.x=90}}else{this.rewardBtn.visible=false}}else{this.rewardBtn.visible=false}if(rewards)this.setRewardList(rewards);else this.setRewardList()};ResultWin.prototype.setRewardList=function(rewards){if(rewards===void 0){rewards=[]}var coinData=[];var emblemData=[];var itemData=[];if(this.isBossResult){this.winnerGroup.visible=true;this.scrollerGroup.y+=60;this.scrollerGroup.height=336;this.labelEmblem.height=0;this.labelItem.height=20;this.labelEmblem.visible=false;this.labelItem.visible=true;var soulData=[];var rewardList=[];for(var i=0;i<rewards.length;i++){var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];if(ItemConfig.getType(itemConfig)==1){if(ResultWin.filterFb.indexOf(GameMap.fbType)!=-1){emblemData.push(rewards[i])}else{if(emblemData.length){var ishave=false;for(var j=0;j<emblemData.length;j++){if(emblemData[j].id==rewards[i].id){emblemData[j].count+=rewards[i].count;ishave=true;break}}if(!ishave)emblemData.push(rewards[i])}else{emblemData.push(rewards[i])}}continue}if(rewards[i].type==0){if(rewards[i].id==MoneyConst.soul){soulData.push(rewards[i])}else{coinData.push(rewards[i])}}else{itemData.push(rewards[i])}}itemData.sort(this.RuleSortByItem);rewardList=soulData.concat(coinData,emblemData,itemData);this.listItem.dataProvider=new eui.ArrayCollection(rewardList)}else{var soulData=[];var material=[];var rewardList=[];for(var i=0;i<rewards.length;i++){var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];if(ItemConfig.getType(itemConfig)==1){if(ResultWin.filterFb.indexOf(GameMap.fbType)!=-1){material.push(rewards[i])}else{if(material.length){var ishave=false;for(var j=0;j<material.length;j++){if(material[j].id==rewards[i].id){material[j].count+=rewards[i].count;ishave=true;break}}if(!ishave)material.push(rewards[i])}else{material.push(rewards[i])}}continue}if(rewards[i].type==0){coinData.push(rewards[i])}else{var conf=GlobalConfig.ItemConfig[rewards[i].id];var type=ItemConfig.getType(conf);if(type==ItemType.TYPE_6){itemData.push(rewards[i])}else{itemData.push(rewards[i])}}}this.winnerGroup.visible=false;this.scrollerGroup.height=324;this.labelItem.text=i18n("ResultWin_11");this.labelEmblem.height=emblemData.length>0?20:0;this.labelItem.height=itemData.length>0?20:0;this.labelEmblem.visible=emblemData.length>0;this.labelItem.visible=itemData.length>0;coinData.sort(this.RuleSort);itemData.sort(this.RuleSortByItem);this.listCoin.dataProvider=new eui.ArrayCollection(coinData);this.listEmblem.dataProvider=new eui.ArrayCollection(emblemData);rewardList=soulData.concat(coinData,material,itemData);this.listItem.dataProvider=new eui.ArrayCollection(rewardList)}};ResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateCloseBtnLabel,this);this.wpkBoss.close();for(var i=1;i<6;i++){this.removeTouchEvent(this["img"+i],this.onTap)}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.openRole,this.onTap);this.removeTouchEvent(this.openRole1,this.onTap);if(GameMap.fubenID>0){if(UserFb.ins().isQuite){UserFb.ins().sendExitFb()}}if(this._fbType==UserFb.FB_TYPE_MATERIAL){ViewManager.ins().open(FbWin,0)}else if(this._fbType==UserFb.FB_TYPE_GUILD_BOSS){}else if(this._fbType==UserFb.FB_TYPE_HOMEBOSS){ViewManager.ins().open(BossWin,5)}if(this.closeFunc){this.closeFunc();this.closeFunc=null}if(this.bossmc){DisplayUtils.removeFromParent(this.bossmc);this.bossmc=null}if(SkyLevelModel.ins().lotteryRemainTimes>0&&GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){ViewManager.ins().open(BabelLotteryWin)}};ResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)ViewManager.ins().close(this);if(CityCC.ins().isCity)this.closeBtn.label=""+this.closeBtn.name;else this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"};ResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:if(GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU){if(!Hungu.ins().hunShouFBTimes){UserTips.ins().showTips(i18n("ResultWin_12"));return}if(UserZs.ins().lv<GlobalConfig.FsFbConfig[Hungu.ins().hunShouFBPassID+1].zsLevelLimit)UserTips.ins().showTips(i18n("ResultWin_13"));else{Hungu.ins().enterHunShouFB();UserFb.ins().isQuite=false}}else{UserFb2.ins().sendChallenge();UserFb.ins().isQuite=false}ViewManager.ins().close(this);break;case this.openRole:case this.openRole1:ViewManager.ins().close(this);ViewManager.ins().open(NewRoleWin);break}};ResultWin.prototype.updateDefeatList=function(){var gainWay=[];for(var i in GlobalConfig.DeathGuideConfig){var cfg=GlobalConfig.DeathGuideConfig[i];if(UserZs.ins().lv<=cfg.zslv||Actor.level<=cfg.lv){for(var j in cfg.gainWay){if(cfg.gainWay[j][0]==16){var pic_img=DieGuide.ins().getOpenRoles();if(pic_img){var desConfig=GlobalConfig.DeathgainWayConfig[cfg.gainWay[j][0]];desConfig.itemId=pic_img;gainWay.push(cfg.gainWay[j][0])}continue}gainWay.push(cfg.gainWay[j][0])}break}}this.listData0.source=gainWay;this.list0.dataProvider=this.listData0};ResultWin.prototype.RuleSort=function(a,b){if(a.id<b.id)return-1;else return 1};ResultWin.prototype.RuleSortByItem=function(a,b){var aItem=GlobalConfig.ItemConfig[a.id];var bItem=GlobalConfig.ItemConfig[b.id];var aq=ItemConfig.getQuality(aItem);var bq=ItemConfig.getQuality(bItem);if(aq>bq)return-1;else if(aq<bq)return 1;else{return 0}};ResultWin.filterFb=[UserFb.FB_TYPE_MATERIAL];return ResultWin}(BaseEuiView);__reflect(ResultWin.prototype,"ResultWin");ViewManager.ins().reg(ResultWin,LayerManager.UI_Popup);var TongResultWin=function(_super){__extends(TongResultWin,_super);function TongResultWin(){var _this=_super.call(this)||this;_this.repeatTimes=5;return _this}TongResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ChuangtianguanResultSkin";this.listCoin.itemRenderer=ResultCoinItem;this.listItem.itemRenderer=ItemBase;this.listItemExtra.itemRenderer=ItemBase;this.listData0=new eui.ArrayCollection;this.list0.itemRenderer=DefeatItem};TongResultWin.prototype.showRune=function(result){if(GameMap.fbType!=UserFb.FB_TYPE_TIAOZHAN){this.nune.visible=false;return}if(!result){this.nune.visible=false;return}var fbconfig=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel-1];if(!fbconfig||!fbconfig.showIcon){this.nune.visible=false;return}var item_config=GlobalConfig.ItemConfig[fbconfig.showIcon];var quality=ItemConfig.getQuality(item_config);if(quality==FBChallengePanel.RunType){this.nune.visible=false;return}this.nune.visible=true;this.scrollerGroup.y+=this.nune.height*3/2;var desc="";if(fbconfig.equipPos){this.nuneLock.visible=true;desc=i18n("TongResultWin_0");this.oldValue.text=(fbconfig.equipPos-1).toString();this.newValue.text=fbconfig.equipPos.toString()}else{this.nuneLock.visible=false;desc=i18n("TongResultWin_1");this.nuneValue.text=fbconfig.describe}this.nameLabel.text=desc;this.nuneValue.visible=!this.nuneLock.visible};TongResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);var result=param[0];this.bg.source=result?"win_png":"lost_png";this.closeBtn.name=result?i18n("TongResultWin_2"):i18n("TongResultWin_3");this.title.source=result?"win_02":"lost_02";this.closeBtn.label=result?i18n("TongResultWin_4"):i18n("TongResultWin_5");DieGuide.ins().postdieGuide(result);this.showRune(result);var closeTime=5;this.s=this.repeatTimes=closeTime;var rewards=param[1];var extraRewards=param[4]||[];this.extraGroup.visible=extraRewards.length>0;if(param[2])this.txt.text=param[2];UserFb.ins().isQuite=true;if(param[3]instanceof Function){this.closeFunc=param[3]}else{if(param[3]==false){UserFb.ins().isQuite=param[3]}}this.txt.visible=result!=0;this.defeat.visible=result==0;this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.rewardBtn,this.onTap);if(result==0){this.rewardBtn.visible=false;this.updateDefeatList()}else if(result==1){var model=SkyLevelModel.ins();var info=GlobalConfig.FbChallengeConfig[model.cruLevel];if(info){var lotteryRemainTimes=SkyLevelModel.ins().lotteryRemainTimes;if(UserZs.ins().lv>=info.zsLevelLimit&&Actor.level>=info.levelLimit&&lotteryRemainTimes<=TongResultWin.lastLotteryRemainTimes){this.rewardBtn.visible=true;this.closeBtn.x=0;if(info.layer==1){this.rewardBtn.label=i18n("TongResultWin_6");this.rewardBtn.width=130}else{this.rewardBtn.label=i18n("TongResultWin_7",info.layer,this.s);this.rewardBtn.width=200;this.layer=info.layer;TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateRewardbtnLabel,this)}}else{this.rewardBtn.visible=false;this.closeBtn.x=90}TongResultWin.lastLotteryRemainTimes=lotteryRemainTimes}else{this.rewardBtn.visible=false;this.closeBtn.x=90}}if(rewards)this.setRewardList(rewards,extraRewards);else this.setRewardList()};TongResultWin.prototype.setRewardList=function(rewards,extraRewards){if(rewards===void 0){rewards=[]}if(extraRewards===void 0){extraRewards=[]}var coinData=[];var itemData=[];var soulData=[];var material=[];var rewardList=[];for(var i=0;i<rewards.length;i++){var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];if(ItemConfig.getType(itemConfig)==1){if(material.length){var ishave=false;for(var j=0;j<material.length;j++){if(material[j].id==rewards[i].id){material[j].count+=rewards[i].count;ishave=true;break}}if(!ishave)material.push(rewards[i])}else{material.push(rewards[i])}continue}if(rewards[i].type==0){coinData.push(rewards[i])}else{itemData.push(rewards[i])}}var level=SkyLevelModel.ins().cruLevel;var cfg=GlobalConfig.FbChallengeConfig[level];var clearRewardBuff2=cfg.clearRewardBuff2||[];var clearRewardBuff3=cfg.clearRewardBuff3||[];var coinDataPlus=[];var needShowCoin=true;if(level>0){for(var k in coinData){var data=coinData[k];var p=0;if(clearRewardBuff2.length>0&&data.id==clearRewardBuff2[0].id){p=clearRewardBuff2[0].count;needShowCoin=false}if(clearRewardBuff3.length>0&&data.id==clearRewardBuff3[0].id){p=clearRewardBuff3[0].count;needShowCoin=false}var temp={id:data.id,type:data.type,count:data.count,plusCount:p};coinDataPlus.push(temp)}}this.scrollerGroup.height=392;this.labelItem.text=i18n("TongResultWin_8");this.labelItem.height=itemData.length>0?20:0;this.labelItem.visible=itemData.length>0;coinData.sort(this.RuleSort);coinDataPlus.sort(this.RuleSort);itemData.sort(this.RuleSortByItem);this.listCoin.dataProvider=new eui.ArrayCollection(coinDataPlus);if(needShowCoin){rewardList=soulData.concat(coinData,material,itemData)}else{rewardList=soulData.concat(material,itemData)}this.listItem.dataProvider=new eui.ArrayCollection(rewardList);this.listItemExtra.dataProvider=new eui.ArrayCollection(extraRewards)};TongResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateCloseBtnLabel,this);TimerManager.ins().remove(this.updateRewardbtnLabel,this);this.removeTouchEvent(this.closeBtn,this.onTap);if(GameMap.fubenID>0){if(UserFb.ins().isQuite){UserFb.ins().sendExitFb()}}if(this.closeFunc){this.closeFunc();this.closeFunc=null}if(SkyLevelModel.ins().lotteryRemainTimes>0&&GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){ViewManager.ins().open(BabelLotteryWin)}};TongResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)ViewManager.ins().close(this);this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"};TongResultWin.prototype.updateRewardbtnLabel=function(){this.s--;if(this.s<=0){UserFb2.ins().sendChallenge();UserFb.ins().isQuite=false;ViewManager.ins().close(this)}this.rewardBtn.label=i18n("TongResultWin_9",this.layer,this.s)};TongResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:UserFb2.ins().sendChallenge();UserFb.ins().isQuite=false;ViewManager.ins().close(this);break}};TongResultWin.prototype.updateDefeatList=function(){var gainWay=[];for(var i in GlobalConfig.DeathGuideConfig){var cfg=GlobalConfig.DeathGuideConfig[i];if(UserZs.ins().lv<=cfg.zslv||Actor.level<=cfg.lv){for(var j in cfg.gainWay){if(cfg.gainWay[j][0]==16){var pic_img=DieGuide.ins().getOpenRoles();if(pic_img){var desConfig=GlobalConfig.DeathgainWayConfig[cfg.gainWay[j][0]];desConfig.itemId=pic_img;gainWay.push(cfg.gainWay[j][0])}continue}if(cfg.gainWay[j][0]==14||cfg.gainWay[j][0]==20){var maxVipLv=Object.keys(GlobalConfig.VipConfig).length;if(UserVip.ins().lv>=maxVipLv){continue}}gainWay.push(cfg.gainWay[j][0])}break}}this.listData0.source=gainWay;this.list0.dataProvider=this.listData0};TongResultWin.prototype.RuleSort=function(a,b){if(a.id<b.id)return-1;else return 1};TongResultWin.prototype.RuleSortByItem=function(a,b){var aItem=GlobalConfig.ItemConfig[a.id];var bItem=GlobalConfig.ItemConfig[b.id];var aq=ItemConfig.getQuality(aItem);var bq=ItemConfig.getQuality(bItem);if(aq>bq)return-1;else if(aq<bq)return 1;else{return 0}};TongResultWin.lastLotteryRemainTimes=0;return TongResultWin}(BaseEuiView);__reflect(TongResultWin.prototype,"TongResultWin");ViewManager.ins().reg(TongResultWin,LayerManager.UI_Popup);var FirstRank=function(_super){__extends(FirstRank,_super);function FirstRank(){var _this=_super.call(this)||this;_this.actType=4;_this.defualtType=RankDataType.TYPE_BAOSHI;_this.isClickInto=false;_this.isLastHour=false;_this.hadShowLastHourTip=false;_this.lastCheckTime=undefined;_this.targetRank=[20,10,5,3,1];_this.observe(Rank.ins().postRankingData,_this.postRankData);return _this}FirstRank.ins=function(){if(this._instance==null){this._instance=new FirstRank}return this._instance};Object.defineProperty(FirstRank,"FINISHED_TIP",{get:function(){if(this._FINISHED_TIP==null){this._FINISHED_TIP=i18n("FirstRank_0")}return this._FINISHED_TIP},enumerable:true,configurable:true});FirstRank.prototype.sendGetRankData=function(){if(this.isOver()){Rank.ins().sendGetRankingData(this.defualtType)}else{Rank.ins().sendGetRankingData(this.getCurRankType())}};FirstRank.prototype.postRankData=function(model){if(model&&model.type==this.getCurRankType()){this.curRankModel=model;if(this.isLastHour&&!this.hadShowLastHourTip&&!UserFb.ins().checkInFB(true)){this.hadShowLastHourTip=true;ViewManager.ins().open(FirstRankTipWin,this.curRankModel)}}if(model&&model.type==this.getCurRankType()&&this.isClickInto){console.log("FirstRank onPostRankData type = "+model.type+"  count "+model.getDataList().length);var infoWin=ViewManager.ins().getView(FirstRankInfoWin);if(!infoWin){var win=ViewManager.ins().getView(FirstRankWin);if(!win){ViewManager.ins().open(FirstRankWin,model)}else{win.updateShow()}}}return model};FirstRank.prototype.getCurRankType=function(id){if(id===void 0){id=null}var type=-10;if(id==null){id=this.getCurRankId()}if(GlobalConfig.FirstRankConfig[id]){type=GlobalConfig.FirstRankConfig[id].rankType}else{console.log("FirstRank config is not exist ,id = "+id)}return type};FirstRank.prototype.getCurRankId=function(){var actId=-1;var openId=this.getOpenRankActId();var datas=this.getOpenActDatas();var cfg=GlobalConfig.FirstRankConfig;for(var _i=0,datas_2=datas;_i<datas_2.length;_i++){var v=datas_2[_i];if(v&&cfg[v.id]&&v.id==openId){actId=v.id;break}}return actId};FirstRank.prototype.getOpenRankActId=function(){var actId=-1;var openDay=GameServer.serverOpenDay;var cfg=GlobalConfig.ActivityConfig;var frc=GlobalConfig.FirstRankConfig;for(var id in cfg){if(cfg[id]&&frc[id]&&cfg[id].startTime&&cfg[id].endTime&&cfg[id].activityType==this.actType){var reg=/\d+/g;var str1=cfg[id].startTime.match(reg);var str2=cfg[id].endTime.match(reg);if(str1&&str2&&str1.length>0&&str2.length>0){var startDay=parseInt(str1[0]);var endDay=parseInt(str2[0]);if(startDay<=openDay&&openDay<endDay){actId=cfg[id].Id;break}}}}return actId};FirstRank.prototype.getOpenActDatas=function(){var datas=[];for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k]||Activity.ins().activityData[k].pageStyle||Activity.ins().activityData[k].timeType==ActivityDataFactory.TimeType_Total){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(data&&data.activityType&&data.activityType==ActivityType.Nesting)continue;if(!ErrorLog.Assert(data,"ActivityWin  data   "+k)){datas.push(data)}}}return datas};FirstRank.prototype.hasReward=function(){var rankId=this.getCurRankId();var cfg=GlobalConfig.FirstRankConfig[rankId];if(cfg){var rewardActId=cfg.rewardActId||-1;var activityData=this.getDataByActId(rewardActId);var rewardCfg=GlobalConfig.ActivityType1Config[rewardActId];var showIdx=0;if(rewardCfg&&activityData){for(var index in rewardCfg){showIdx=parseInt(index);var type=activityData.getRewardStateById(showIdx);if(type==Activity.CanGet){return true}}}}return false};FirstRank.prototype.getEndTime=function(){var data=this.getDataByActId(this.getCurRankId());var endTime=data?data.endTime:0;var time=Math.floor((DateUtils.formatMiniDateTime(endTime)-GameServer.serverTime)/1e3);return time};FirstRank.prototype.getDataByActId=function(actId){var data=Activity.ins().getActivityDataById(actId);return data};FirstRank.prototype.isOver=function(){return FirstRank.ins().getCurRankType()<=-1};FirstRank.prototype.getMyRanKTxt=function(){var rankTxt="";var myRank="";var value=-1;if(!this.curRankModel)return rankTxt;var rankModel=this.curRankModel;var rankDataList=this.curRankModel.getDataList();if(rankModel&&rankModel.selfPos&&rankModel.selfPos<=20&&rankDataList[rankModel.selfPos-1]){var data=rankDataList[rankModel.selfPos-1];myRank=rankModel.selfPos+"";var rankType=this.getCurRankType();value=this.getValue(rankType,0,data);rankTxt=i18n("FirstRank_1")+ColorUtil.GREEN_COLOR_N+i18n("FirstRank_2")+myRank+i18n("FirstRank_3")+this.getLevelTitleByType(rankType)+i18n("FirstRank_6")+ColorUtil.GREEN_COLOR_N+"&T:"+value+"|"}else{var rankType=this.getCurRankType();value=this.getValue(rankType,1,null);rankTxt=i18n("FirstRank_4")+ColorUtil.GREEN_COLOR_N+i18n("FirstRank_5")+this.getLevelTitleByType(rankType)+i18n("FirstRank_7")+ColorUtil.GREEN_COLOR_N+"&T:"+value+"|"}return rankTxt};FirstRank.prototype.getValue=function(rankType,isLocal,data){var value=0;if(isLocal==0&&data==null)return value;switch(rankType){case RankDataType.TYPE_SHAPESHIFTING:if(isLocal){value=ShapeShiftingMgr.ins().getTotalPower()}else{value=data.value}break;case RankDataType.TYPE_XIANYU:if(isLocal){value=Activity.ins().myDabiaoInfo?Activity.ins().myDabiaoInfo:UserMiji.ins().getTotelXYPower()}else{value=data.value}break;case RankDataType.TYPE_SCORE:if(isLocal){value=UserBag.ins().getEquipsScoreByRolesOfBody()}else{value=data.value}break;case RankDataType.TYPE_ZS:if(isLocal){value=UserZs.ins().lv}else{value=data.zslevel}break;case RankDataType.TYPE_BOOK:if(isLocal){value=Book.ins().getBookPowerNumEx()}else{value=data.value}break;case RankDataType.TYPE_WING:if(isLocal){value=WingsData.getWingAllLevel()}else{value=data.value}break;case RankDataType.TYPE_LONGHUN:if(isLocal){value=LongHunData.getLongHunAllLevel()}else{value=data.value}break;case RankDataType.TYPE_BAOSHI:if(isLocal){value=Role.getAllForgeLevelByType(PackageID.Zhuling)}else{value=data.value}break;case RankDataType.TYPE_COPY:if(isLocal){value=SkyLevelModel.ins().cruLevel}else{value=data.count}break;case RankDataType.TYPE_PASS:if(isLocal){value=UserFb.ins().guanqiaID}else{value=data.count}break}return value};FirstRank.prototype.getLevelTitleByType=function(type){var cfg=GlobalConfig.FirstRankConfig;for(var id in cfg){if(cfg[id]&&cfg[id].rankType==type){return cfg[id].levelTitle+": "}}return": "};FirstRank.prototype.checkLastHour=function(){var type=this.getCurRankType();var today=(new Date).getDate();if(this.lastCheckTime!=today){this.lastCheckTime=today;this.isLastHour=false;this.hadShowLastHourTip=false}if(type<=-1||!OpenSystem.ins().checkSysOpen(SystemType.CHONGBANG)){this.isLastHour=false;this.hadShowLastHourTip=false}else{var time=this.getEndTime();if(time<=3600){this.isLastHour=true;if(!this.hadShowLastHourTip){Rank.ins().sendGetRankingData(type)}}else{this.isLastHour=false}}if(!TimerManager.ins().isExists(this.checkLastHour,this)){TimerManager.ins().doTimer(6e4,1,this.checkLastHour,this)}};FirstRank.prototype.getTargetRank=function(){var data=this.curRankModel;if(!data){return-1}var rankDataList=this.curRankModel.getDataList();var selfPos=data.selfPos||1e4;if(selfPos==1){return-1}for(var i=0;i<this.targetRank.length;i++){var t=this.targetRank[i];if(selfPos>t){if(rankDataList[t-1]){return t}else{continue}}}return-1};FirstRank.prototype.getDec=function(target){if(target===void 0){target=1}var rankModel=this.curRankModel;var rankType=this.getCurRankType();var rankDataList=this.curRankModel.getDataList();var myValue=0;if(rankModel&&rankModel.selfPos&&rankModel.selfPos<=20&&rankDataList[rankModel.selfPos-1]){var data=rankDataList[rankModel.selfPos-1];myValue=this.getValue(rankType,0,data)}else{var rankType_1=this.getCurRankType();myValue=this.getValue(rankType_1,1,null)}var targetData=rankDataList[target-1];var targetValue=this.getValue(rankType,0,targetData);var dec=Math.max(targetValue-myValue+1,0);return dec};FirstRank.IMAGE_RANK="1";FirstRank.IMAGE_TITLE="2";FirstRank.IMAGE_BG="3";return FirstRank}(BaseSystem);__reflect(FirstRank.prototype,"FirstRank");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.firstRank=FirstRank.ins.bind(FirstRank)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var FirstRankInfoWin=function(_super){__extends(FirstRankInfoWin,_super);function FirstRankInfoWin(){var _this=_super.call(this)||this;_this.xianyuType=24;_this.showId=-1;_this.lastOpenDay1=-1;_this.isUpdatedActData=false;_this.isTopLevel=true;_this.skinName="FirstRankInfoSkin";_this.visible=false;return _this}FirstRankInfoWin.prototype.initUI=function(){var list=this.listPlayers;list.dataProvider=new ArrayCollection([]);list.itemRenderer=FirstRankPlayerItem};FirstRankInfoWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(ChannelMgr.ins().isRechargeHidden()){this.btnGiftPackShop.visible=false}else{this.btnGiftPackShop.visible=true}if(param&&param[0]!=null){this.addTouchEvent(this.btnClose,this.onClose);this.addTouchEvent(this.btnClose1,this.onClose);this.addTouchEvent(this.rectClose,this.onClose);this.addTouchEvent(this.btnGiftPackShop,this.openShop);this.rolePanel.setState("nohead");this.lastOpenDay1=GameServer.serverOpenDay;this.isUpdatedActData=false;var model=param[0];var selectedId=this.getRankIdByType(model.type);var curRankId=FirstRank.ins().getCurRankId();this.showRankModel=model;this.showId=selectedId;if(selectedId==curRankId){this.observe(Activity.ins().postActivityIsGetAwards,this.updateShow);this.observe(GameServer.ins().postServerOpenDay,this.onNewOpenDay);this.currentState="unend";this.updateShow()}else if(selectedId<curRankId){this.currentState="ended";this.updateShow()}}};FirstRankInfoWin.prototype.getRankIdByType=function(type){var rankId=-1;var frc=GlobalConfig.FirstRankConfig;for(var id in frc){if(type==frc[id].rankType){rankId=frc[id].id;break}}return rankId};FirstRankInfoWin.prototype.updateShow=function(){var rankModel=this.showRankModel;var listData=rankModel?rankModel.getDataList():[];var data=[];for(var i=0;listData&&i<20&&i<listData.length;++i){data.push(listData[i])}var dataPro=this.listPlayers.dataProvider;dataPro.replaceAll(data);this.lblNoOne.visible=data.length==0?true:false;var cfg=GlobalConfig.FirstRankConfig[this.showId];if(cfg&&cfg.rewardActId!=null){this.imgRankBg.source=cfg.source+FirstRank.IMAGE_BG;this.imgTitle.source=cfg.source+FirstRank.IMAGE_TITLE;var rankTxt=FirstRank.ins().getMyRanKTxt();this.lblMyRank.textFlow=TextFlowMaker.generateTextFlow(rankTxt);var rewardActId=cfg.rewardActId;var activityData=FirstRank.ins().getDataByActId(rewardActId);var rewardCfg=GlobalConfig.ActivityType1Config[rewardActId];var showIdx=-1;var firstNotReach=-1;var firstCanGet=-1;if(rewardCfg&&activityData){for(var index in rewardCfg){showIdx=parseInt(index);var type=activityData.getRewardStateById(showIdx);if(rankModel.type==this.xianyuType){if(type==Activity.NotReached&&firstNotReach<0){firstNotReach=showIdx}else if(type==Activity.CanGet){firstCanGet=showIdx;break}}else{if(type==Activity.NotReached){break}else if(type==Activity.CanGet){break}}}if(rankModel.type==this.xianyuType){if(firstCanGet>0){showIdx=firstCanGet}else if(firstNotReach>0){showIdx=firstNotReach}}var showCfg=rewardCfg[showIdx];if(showCfg){this.rewardPanel.data=showCfg}}}this.setEndTime();this.showTarget()};FirstRankInfoWin.prototype.setEndTime=function(){this.lblEndTime.visible=true;if(FirstRank.ins().isOver()){this.lblEndTime.text=FirstRank.FINISHED_TIP}else{if(this.showId==FirstRank.ins().getCurRankId()){this.endTime=FirstRank.ins().getEndTime();this.lblEndTime.text=DateUtils.getFormatBySecond(this.endTime,DateUtils.TIME_FORMAT_5,3);if(!TimerManager.ins().isExists(this.timeGo,this)){TimerManager.ins().doTimer(1e3,0,this.timeGo,this)}}else{this.lblEndTime.text=FirstRank.FINISHED_TIP}}};FirstRankInfoWin.prototype.timeGo=function(){this.endTime--;this.lblEndTime.text=DateUtils.getFormatBySecond(this.endTime,DateUtils.TIME_FORMAT_5,3);if(this.endTime<0){TimerManager.ins().removeAll(this);this.lblEndTime.text=FirstRank.FINISHED_TIP}};FirstRankInfoWin.prototype.onNewOpenDay=function(){var _this=this;TimerManager.ins().doTimer(5e3,1,function(){if(FirstRank.ins().isOver()){}else{FirstRank.ins().sendGetRankData();_this.observe(Rank.ins().postRankingData,_this.postRankData)}},this)};FirstRankInfoWin.prototype.postRankData=function(model){if(model&&model.type==FirstRank.ins().getCurRankType()){this.showId=this.getRankIdByType(model.type);this.showRankModel=model;this.updateShow()}return model};FirstRankInfoWin.prototype.openShop=function(){if(FirstRank.ins().isOver()){UserTips.ins().showTips(FirstRank.FINISHED_TIP)}else if(OpenSystem.ins().checkSysOpen(SystemType.XIANGOUSHANGDIAN)){ViewManager.ins().open(GiftPackWin)}else{UserTips.ins().showTips(i18n("FirstRankInfoWin_0"))}};FirstRankInfoWin.prototype.onClose=function(){this.close()};FirstRankInfoWin.prototype.close=function(){this.removeTouchEvent(this.btnClose,this.onClose);this.removeTouchEvent(this.btnClose1,this.onClose);this.removeTouchEvent(this.rectClose,this.onClose);this.removeTouchEvent(this.btnGiftPackShop,this.openShop);this.removeObserve();TimerManager.ins().removeAll(this);ViewManager.ins().close(this);if(this.lastOpenDay1!=GameServer.serverOpenDay){FirstRank.ins().sendGetRankData()}};FirstRankInfoWin.prototype.showTarget=function(){var curRankId=FirstRank.ins().getCurRankId();var rank=FirstRank.ins().getTargetRank();this.targetGroup.visible=curRankId>-1&&rank>0&&this.showId==curRankId;if(this.targetGroup.visible==false){return}this.target.text=rank.toString();this.decNum.text=FirstRank.ins().getDec(rank).toString();var cfg=GlobalConfig.FirstRankConfig[curRankId];var levelUnit=cfg.levelUnit;this.rankType.text=levelUnit;var rewards=GlobalConfig.ActivityType4Config[curRankId][rank].rewards;var bigReward=rewards[0];var type=bigReward.type;var id=bigReward.id;var count=bigReward.count;if(type==0){this.reward.text=count.toString()+RewardData.getCurrencyName(id)}else if(type==1){var itemConfig=GlobalConfig.ItemConfig[id];var itemName=itemConfig.name;this.reward.text=itemName+"X"+count.toString()}};return FirstRankInfoWin}(BaseEuiView);__reflect(FirstRankInfoWin.prototype,"FirstRankInfoWin");ViewManager.ins().reg(FirstRankInfoWin,LayerManager.UI_Main);var FirstRankListItem=function(_super){__extends(FirstRankListItem,_super);function FirstRankListItem(){var _this=_super.call(this)||this;_this.finishedImg="marry_gift2";_this.unFinishedImg="scitembg";_this.skinName="FirstRankListItemSkin";return _this}FirstRankListItem.prototype.dataChanged=function(){var data=this.data;if(!data)return;TimerManager.ins().removeAll(this);this.imgRankName.source="";this.imgTitle.source="";this.groupPlaying.visible=false;this.groupInfo.visible=false;this.lblPlayer.visible=false;this.groupDay.visible=false;this.imgEnded.visible=false;this.lblPlayer.text="";this.groupAll.alpha=1;this.imgBg.source=this.unFinishedImg;this.imgBg.scale9Grid=new egret.Rectangle(30,29,8,5);var cfg=GlobalConfig.FirstRankConfig;var source=cfg[data.Id]?cfg[data.Id].source:"";this.imgRankName.source=source+FirstRank.IMAGE_RANK;this.imgTitle.source=source+FirstRank.IMAGE_TITLE;var dayNum=1;var frc=GlobalConfig.FirstRankConfig;for(var id in frc){if(frc[id]&&frc[id].id==data.Id){break}dayNum++}var curRankId=FirstRank.ins().getCurRankId();this.imgDay.source="firstrankday"+dayNum;if(data.Id<curRankId||FirstRank.ins().isOver()){this.imgEnded.visible=true;this.imgBg.source=this.finishedImg;this.imgBg.scale9Grid=new egret.Rectangle(28,29,120,80);this.groupInfo1.visible=true;var player="";var type=FirstRank.ins().getCurRankType(data.Id);var rankModel=Rank.ins().rankModel[type];if(rankModel){var listData=rankModel.getDataList();if(listData&&listData.length>0){player=listData[0]&&listData[0].player?listData[0].player:""}}this.lblPlayer1.text=player}else if(data.Id==curRankId){this.groupPlaying.visible=true;this.groupInfo.visible=true;this.lblPlayer.visible=true;this.groupInfo1.visible=false;var svrTime=Math.floor(GameServer.serverTime/1e3);var endTime=FirstRank.ins().getEndTime()+svrTime;this.lblEndTime.text=DateUtils.getFormatBySecond(endTime,DateUtils.TIME_FORMAT_13)+i18n("FirstRankListItem_0");var player="";var rankModel=FirstRank.ins().curRankModel;if(rankModel){var listData=rankModel.getDataList();if(listData&&listData.length>0){player=listData[0]&&listData[0].player?listData[0].player:""}}this.lblPlayer.text=player;this.groupDay.visible=true}else if(data.Id>curRankId){this.groupAll.alpha=.35;this.groupDay.visible=true;this.groupInfo1.visible=false}};return FirstRankListItem}(BaseItemRender);__reflect(FirstRankListItem.prototype,"FirstRankListItem");var FirstRankPlayerItem=function(_super){__extends(FirstRankPlayerItem,_super);function FirstRankPlayerItem(){var _this=_super.call(this)||this;_this.skinName="FirstRankPlayerItemSkin";var list=_this.listReward;list.itemRenderer=ItemBase;list.dataProvider=new ArrayCollection([]);return _this}FirstRankPlayerItem.prototype.dataChanged=function(){var data=this.data;if(!data)return;this.imgRankNum.visible=false;this.lblRankNum.visible=false;this.listReward.x=248;var view=ViewManager.ins().getView(FirstRankInfoWin);var rankModel=view?view.showRankModel:null;var rankType=rankModel?rankModel.type:-1;this.lblPlayer.text=data.player;var rankNum=this.itemIndex+1;if(this.itemIndex==0){var source="";var cfg=GlobalConfig.FirstRankConfig;for(var id_2 in cfg){if(cfg[id_2].rankType==rankType){source=cfg[id_2].source+FirstRank.IMAGE_TITLE;break}}}if(this.itemIndex<3){this.imgRankNum.source="paihang"+rankNum;this.imgRankNum.visible=true}else{this.lblRankNum.text=i18n("FirstRankPlayerItem_0")+rankNum+i18n("FirstRankPlayerItem_1");this.lblRankNum.visible=true;var RankColor=0;if(rankNum>4){RankColor=16250061}else{RankColor=16378897}}var tag=FirstRank.ins().getLevelTitleByType(rankType);var valueTxt=FirstRank.ins().getValue(rankType,0,data);this.lblTag.textFlow=TextFlowMaker.generateTextFlow(tag+i18n("FirstRankPlayerItem_2")+valueTxt+"|");var id=view?view.showId:-1;var typeCfg=GlobalConfig.ActivityType4Config;if(typeCfg&&typeCfg[id]&&typeCfg[id][rankNum]){var rewards=typeCfg[id][rankNum].rewards;var rewardData=[];for(var k in rewards){if(rewards[k]&&rewards[k].id){rewardData.push(rewards[k])}}var dataPro=this.listReward.dataProvider;dataPro.replaceAll(rewardData)}};return FirstRankPlayerItem}(BaseItemRender);__reflect(FirstRankPlayerItem.prototype,"FirstRankPlayerItem");var FirstRankRewardPanel=function(_super){__extends(FirstRankRewardPanel,_super);function FirstRankRewardPanel(){var _this=_super.call(this)||this;_this.skinName="FirstRankRewardSkin";_this.init();return _this}FirstRankRewardPanel.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);this.isGet=true};FirstRankRewardPanel.prototype.onClick=function(e){switch(e.target){case this.btnGet:var view=ViewManager.ins().getView(FirstRankInfoWin);if(view&&view.endTime<=0){UserTips.ins().showTips(FirstRank.FINISHED_TIP);return}var config=void 0;var ins=void 0;if(GlobalConfig.PActivityBtnConfig[this.actId]){config=GlobalConfig.PActivityType1Config[this.actId][this.index];ins=PActivity.ins()}else if(GlobalConfig.ActivityType1Config[this.actId]){config=GlobalConfig.ActivityType1Config[this.actId][this.index];ins=Activity.ins()}else{return}if(this.isGet){ins.sendReward(this.actId,this.index)}else{var tipsLevel=0;var unit_fen=i18n("FirstRankRewardPanel_0");var unit_jie=i18n("FirstRankRewardPanel_1");var unit_ji=i18n("FirstRankRewardPanel_2");var unit_xing=i18n("FirstRankRewardPanel_3");var unit_guan=i18n("FirstRankRewardPanel_4");var unit="";switch(config.showType){case ShowType.LEVEL:if(Actor.level<config.level){unit=unit_ji;tipsLevel=config.level-Actor.level}else if(UserZs.ins().lv<config.zslevel){tipsLevel=config.zslevel-UserZs.ins().lv}break;case ShowType.WING:if(WingsData.getWingAllLevel()<config.wingLv){unit=unit_jie;tipsLevel=config.wingLv-WingsData.getWingAllLevel()}break;case ShowType.ZHUZAO:if(Role.getAllForgeLevelByType(PackageID.Zhuling)<config.zzLv){unit=unit_xing;tipsLevel=config.zzLv-Role.getAllForgeLevelByType(PackageID.Zhuling)}break;case ShowType.LONGHUN:if(LongHunData.getLongHunAllLevel()<config.lhLv){unit=unit_ji;tipsLevel=config.lhLv-LongHunData.getLongHunAllLevel()}break;case ShowType.BOOK:var power=Book.ins().getBookPowerNumEx();if(power<config.tjPower){tipsLevel=config.tjPower-power}break;case ShowType.EQUIP:var point=UserBag.ins().getEquipsScoreByRolesOfBody();if(point<config.equipPower)tipsLevel=config.equipPower-point;break;case ShowType.RING:var lvl=0;var data=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(data&&data.level)lvl=data.level;if(lvl<config.huoyanRingLv){tipsLevel=config.huoyanRingLv-lvl}break;case ShowType.SAMSARA:if(Actor.samsaraLv<config.lunhLv)tipsLevel=config.lunhLv-Actor.samsaraLv;break;case ShowType.TONGGUAN:if(UserFb.ins().guanqiaID<config.tgNum){unit=unit_guan;tipsLevel=config.tgNum-UserFb.ins().guanqiaID}break;case ShowType.FUWENTA:var level=SkyLevelModel.ins().cruLevel-1;if(level<config.fwtLv){unit=unit_fen;tipsLevel=config.fwtLv-level}break;case ShowType.SHENJIANG:if(ShapeShiftingMgr.ins().getTotalPower()<config.sjPower){unit=unit_jie;tipsLevel=config.sjPower-ShapeShiftingMgr.ins().getTotalPower()}break;case ShowType.XIANYU:UserTips.ins().showTips(i18n("FirstRankRewardPanel_5"));return}if(!tipsLevel){Activity.ins().sendReward(this.actId,this.index);return}if(config.showType==ShowType.LEVEL&&UserZs.ins().lv<config.zslevel)UserTips.ins().showTips(+tipsLevel+i18n("FirstRankRewardPanel_6"));else if(config.showType==ShowType.BOOK)UserTips.ins().showTips(i18n("FirstRankRewardPanel_7")+tipsLevel+i18n("FirstRankRewardPanel_8"));else if(config.showType==ShowType.EQUIP||config.showType==ShowType.FUWENTA)UserTips.ins().showTips(i18n("FirstRankRewardPanel_9")+tipsLevel+i18n("FirstRankRewardPanel_10"));else UserTips.ins().showTips(i18n("FirstRankRewardPanel_11")+tipsLevel+unit+i18n("FirstRankRewardPanel_12"))}break}};FirstRankRewardPanel.prototype.dataChanged=function(){if(!this.data)return;var config=this.data;var data;if(GlobalConfig.PActivityBtnConfig[config.Id]){data=PActivity.ins().getActivityDataById(config.Id)}else{data=Activity.ins().getActivityDataById(config.Id)}this.ActivityShowType(config);var role=SubRoles.ins().getSubRoleByIndex(0);var idx=0;for(var i=0;i<3;i++){this["item"+i].visible=false}for(var i=0;i<config.rewards.length;i++){var rd=config.rewards[i];if(rd.job&&rd.job!=role.job)continue;this["item"+idx].visible=true;this["item"+idx].data={type:rd.type,count:rd.count,id:rd.id};idx++}var btnType=data.getRewardStateById(config.index);switch(btnType){case Activity.NotReached:this.currentState="uncan";this.isGet=false;break;case Activity.CanGet:this.currentState="can";break;case Activity.Geted:this.currentState="hadGet";this.isGet=false;break}this.actId=config.Id;this.index=config.index;this.validateNow()};FirstRankRewardPanel.prototype.getRedPoint=function(config){switch(config.showType){case ShowType.LEVEL:var lv=config.level?config.level:0;var zslv=config.zslevel?config.zslevel:0;if(Actor.level>=lv&&UserZs.ins().lv>=zslv)return true;break;case ShowType.LEVEL:if(WingsData.getWingAllLevel()>=config.wingLv)return true;break;case ShowType.ZHUZAO:if(Role.getAllForgeLevelByType(PackageID.Zhuling)>=config.zzLv)return true;break;case ShowType.LONGHUN:if(LongHunData.getLongHunAllLevel()>=config.lhLv)return true;break;case ShowType.BOOK:var power=Book.ins().getBookPowerNumEx();if(power>=config.tjPower)return true;break;case ShowType.EQUIP:var point=UserBag.ins().getEquipsScoreByRolesOfBody();if(point>=config.equipPower)return true;break;case ShowType.RING:var lvl=0;var data=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(data&&data.level)lvl=data.level;return lvl>=config.huoyanRingLv;case ShowType.SAMSARA:if(Actor.samsaraLv>=config.lunhLv)return true;break;case ShowType.TONGGUAN:if(UserFb.ins().guanqiaID>=config.tgNum)return true;break;case ShowType.FUWENTA:var level=SkyLevelModel.ins().cruLevel-1;if(level>=config.fwtLv)return true;break;case ShowType.SHENJIANG:if(ShapeShiftingMgr.ins().getTotalPower()>=config.sjPower)return true;break;default:return false}};FirstRankRewardPanel.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};FirstRankRewardPanel.prototype.ActivityShowType=function(config){this.groupOld.visible=true;this.xianyuCond.visible=false;switch(config.showType){case ShowType.LEVEL:this.lvName.text=i18n("FirstRankRewardPanel_13");if(!config.zslevel)this.lvName0.text=config.level+"";else{this.lvName0.text=config.zslevel+i18n("FirstRankRewardPanel_14")}if(config.Id==15){this.lvName.text=i18n("FirstRankRewardPanel_15");this.lvName0.text=config.zslevel+i18n("FirstRankRewardPanel_16")}break;case ShowType.WING:this.lvName.text=i18n("FirstRankRewardPanel_17");this.lvName0.text=config.wingLv+"";break;case ShowType.ZHUZAO:this.lvName.text=i18n("FirstRankRewardPanel_18");this.lvName0.text=config.zzLv+"";break;case ShowType.LONGHUN:this.lvName.text=i18n("FirstRankRewardPanel_19");this.lvName0.text=config.lhLv+"";break;case ShowType.BOOK:this.lvName.text=i18n("FirstRankRewardPanel_20");this.lvName0.text=config.tjPower+"";break;case ShowType.EQUIP:this.lvName.text=i18n("FirstRankRewardPanel_21");this.lvName0.text=config.equipPower+"";break;case ShowType.RING:this.lvName.text=i18n("FirstRankRewardPanel_22");var level=config.huoyanRingLv;var stage=SpecialRing.ins().getRingStair(level);var star=SpecialRing.ins().getRingStar(level);this.lvName0.text=stage+i18n("FirstRankRewardPanel_23")+star+i18n("FirstRankRewardPanel_24");break;case ShowType.SAMSARA:this.lvName.text=i18n("FirstRankRewardPanel_25");var lv1=SamsaraModel.ins().getSamsara(config.lunhLv);var lv2=SamsaraModel.ins().getSamsaraLv(config.lunhLv);var desc=SamsaraModel.ins().getSamsaraDesc(lv1)+"·"+SamsaraModel.ins().getSamsaraLvDesc(lv2);this.lvName0.textFlow=TextFlowMaker.generateTextFlow1(config.lunhLv+"\n|S:16&T:"+desc);break;case ShowType.ZHANLING:this.lvName.text=i18n("FirstRankRewardPanel_26");var lv=config.zhanlingLv;this.lvName0.text=Math.ceil(lv/10)+i18n("FirstRankRewardPanel_27")+(lv%10==0?lv?10:0:lv%10)+i18n("FirstRankRewardPanel_28");break;case ShowType.XIANYU:this.groupOld.visible=false;this.xianyuCond.visible=true;var xianyuziseNum=config.xianyuziseNum;var xianyuLv=config.xianyuLv;var xianyuNum=config.xianyuNum;var str="";if(xianyuNum){str=i18n("FirstRankRewardPanel_29",xianyuNum)}if(xianyuziseNum){str=i18n("FirstRankRewardPanel_30",xianyuziseNum)}if(xianyuLv){str=i18n("FirstRankRewardPanel_31",xianyuLv)}this.xianyu.textFlow=(new egret.HtmlTextParser).parser(str);break;case ShowType.TONGGUAN:this.lvName.text=i18n("FirstRankRewardPanel_32");this.lvName0.text=config.tgNum+"";break;case ShowType.FUWENTA:this.lvName.text=i18n("FirstRankRewardPanel_33");this.lvName0.text=config.fwtLv+"";break;case ShowType.SHENJIANG:this.lvName.text=i18n("FirstRankRewardPanel_35");this.lvName0.text=config.sjPower+"";break}};return FirstRankRewardPanel}(BaseItemRender);__reflect(FirstRankRewardPanel.prototype,"FirstRankRewardPanel");var FirstRankTipWin=function(_super){__extends(FirstRankTipWin,_super);function FirstRankTipWin(){var _this=_super.call(this)||this;_this.showId=-1;_this.isTopLevel=true;_this.skinName="FirstRankTipSkin";_this.visible=false;return _this}FirstRankTipWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.initUI()};FirstRankTipWin.prototype.initUI=function(){if(this.showId>-1){this.updateShow()}};FirstRankTipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(param&&param[0]){this.addTouchEvent(this.btnTo0,this.onTouch);this.addTouchEvent(this.btnTo1,this.onTouch);this.addTouchEvent(this.bgClose,this.onTouch);this.model=param[0];this.showId=this.getRankIdByType(this.model.type);this.updateShow()}else{this.close()}};FirstRankTipWin.prototype.updateShow=function(){if(!this.imgTitle||!this.title){return}var cfg=GlobalConfig.FirstRankConfig[this.showId];this.imgTitle.source=cfg.source+FirstRank.IMAGE_TITLE;this.title.text=cfg.textTitle||""};FirstRankTipWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.btnTo0:ViewManager.ins().open(GiftPackWin);break;case this.btnTo1:ViewManager.ins().open(FirstRankInfoWin,this.model);break;case this.bgClose:break}this.close()};FirstRankTipWin.prototype.close=function(){this.removeTouchEvent(this.btnTo0,this.onTouch);this.removeTouchEvent(this.btnTo1,this.onTouch);this.removeTouchEvent(this.bgClose,this.onTouch);ViewManager.ins().close(this)};FirstRankTipWin.prototype.getRankIdByType=function(type){var rankId=-1;var frc=GlobalConfig.FirstRankConfig;for(var id in frc){if(type==frc[id].rankType){rankId=frc[id].id;break}}return rankId};return FirstRankTipWin}(BaseEuiView);__reflect(FirstRankTipWin.prototype,"FirstRankTipWin");ViewManager.ins().reg(FirstRankTipWin,LayerManager.UI_Popup);var FirstRankWin=function(_super){__extends(FirstRankWin,_super);function FirstRankWin(){var _this=_super.call(this)||this;_this.selectedType=-1;_this.isTopLevel=true;_this.skinName="FirstRankSkin";_this.visible=false;return _this}FirstRankWin.prototype.initList=function(){var list=this.listRank;list.dataProvider=new ArrayCollection([]);list.itemRenderer=FirstRankListItem};FirstRankWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}FirstRank.ins().isClickInto=true;this.addTouchEvent(this.btnClose,this.onClose);this.addTouchEvent(this.btnClose0,this.onClose);this.addTouchEvent(this.listRank,this.onTouchList);this.observe(Rank.ins().postRankingData,this.onPostRankData);this.observe(GameServer.ins().postServerOpenDay,this.onNewServerDay);this.observe(ShapeShiftingMgr.ins().postShapeShiftingUpgradeBreak,this.updateShow);this.observe(UserMiji.ins().postMijiChange,this.updateShow);this.observe(Actor.ins().postPowerChange,this.updateShow);this.observe(UserZs.ins().postZsLv,this.updateShow);this.observe(Wing.ins().postWingUpgrade,this.updateShow);this.observe(Book.ins().postDataChange,this.updateShow);this.observe(LongHun.ins().postStageUpgrade,this.updateShow);this.observe(UserForge.ins().postForgeUpdate,this.updateShow);this.observe(Actor.ins().postLevelChange,this.updateShow);this.rolePanel.setState("nohead");this.initList();this.updateShow();this.reqRank()};FirstRankWin.prototype.onTouchList=function(e){if(e&&e.currentTarget==this.listRank){var data=this.listRank.selectedItem;if(data&&data.Id!=null){if(data.Id>FirstRank.ins().getCurRankId()&&!FirstRank.ins().isOver()){UserTips.ins().showTips(i18n("FirstRankWin_0"));return}var frc=GlobalConfig.FirstRankConfig[data.Id];if(frc){if(frc.rankType==FirstRank.ins().getCurRankType()){ViewManager.ins().open(FirstRankInfoWin,FirstRank.ins().curRankModel)}else{this.selectedType=frc.rankType;Rank.ins().sendGetRankingData(frc.rankType)}}}}};FirstRankWin.prototype.onPostRankData=function(model){if(model&&model.type==this.selectedType){ViewManager.ins().open(FirstRankInfoWin,model)}else{var dataProvider=this.listRank.dataProvider;dataProvider.refresh()}};FirstRankWin.prototype.onNewServerDay=function(){var _this=this;console.log("FirstRankWin onNewServerDay");TimerManager.ins().doTimer(5e3,1,function(){if(FirstRank.ins().isOver()){_this.updateShow()}else{FirstRank.ins().sendGetRankData()}},this)};FirstRankWin.prototype.updateShow=function(){var curRankId=FirstRank.ins().getCurRankId();var rankEnded=[];var rankUnend=[];var cfg=GlobalConfig.ActivityConfig;var frc=GlobalConfig.FirstRankConfig;var listData=[];for(var k in cfg){if(cfg[k].activityType==4&&cfg[k].tabName&&frc[cfg[k].Id]){if(cfg[k].Id<curRankId||FirstRank.ins().isOver()){rankEnded.push(cfg[k])}else{rankUnend.push(cfg[k])}}}listData=listData.concat(rankUnend,rankEnded);var dataProvider=this.listRank.dataProvider;dataProvider.replaceAll(listData);FirstRank.ins().showRankData=listData;if(FirstRank.ins().isOver()){this.lblEndTime.text=FirstRank.FINISHED_TIP}else{this.endTime=FirstRank.ins().getEndTime();this.lblEndTime.text=DateUtils.getFormatBySecond(this.endTime,DateUtils.TIME_FORMAT_5,3);if(!TimerManager.ins().isExists(this.timeGo,this)){TimerManager.ins().doTimer(1e3,0,this.timeGo,this)}}};FirstRankWin.prototype.reqRank=function(){var data=FirstRank.ins().showRankData;var curRankId=FirstRank.ins().getCurRankId();for(var _i=0,data_4=data;_i<data_4.length;_i++){var v=data_4[_i];if(v.Id<curRankId){var type=FirstRank.ins().getCurRankType(v.Id);var model=Rank.ins().rankModel[type];if(!model){Rank.ins().sendGetRankingData(type)}}}};FirstRankWin.prototype.timeGo=function(){this.endTime--;this.lblEndTime.text=DateUtils.getFormatBySecond(this.endTime,DateUtils.TIME_FORMAT_5,3);if(this.endTime<0){TimerManager.ins().removeAll(this);this.lblEndTime.text=FirstRank.FINISHED_TIP}};FirstRankWin.prototype.onClose=function(){this.close()};FirstRankWin.prototype.close=function(){this.removeTouchEvent(this.btnClose,this.onClose);this.removeTouchEvent(this.btnClose0,this.onClose);this.removeTouchEvent(this.listRank,this.onTouchList);this.removeObserve();TimerManager.ins().removeAll(this);_super.prototype.close.call(this);ViewManager.ins().close(this);FirstRank.ins().isClickInto=false};return FirstRankWin}(BaseEuiView);__reflect(FirstRankWin.prototype,"FirstRankWin");ViewManager.ins().reg(FirstRankWin,LayerManager.UI_Main);var UserForge=function(_super){__extends(UserForge,_super);function UserForge(){var _this=_super.call(this)||this;_this.sysId=PackageID.strongthen;_this.regNetMsg(2,_this.doForgeUpdata);_this.regNetMsg(5,_this.postMeltItem);_this.observe(UserBag.ins().postItemAdd,_this.delaySeekItem);_this.observe(UserBag.ins().postItemDel,_this.delaySeekItem);_this.observe(UserBag.ins().postItemChange,_this.delaySeekItem);_this.observe(Actor.ins().postSoulChange,_this.delaySeekItem);return _this}Object.defineProperty(UserForge,"CONDITION_ZHUZAO",{get:function(){return GlobalConfig.StoneOpenConfig[0].openLv},enumerable:true,configurable:true});UserForge.ins=function(){return _super.ins.call(this)};UserForge.prototype.doForgeUpdata=function(bytes){var roleId=bytes.readShort();var index=SubRoles.ins().getSubRoleByIndex(roleId).parseForgeChange(bytes,this.sysId);this.postForgeUpdate(this.sysId,index)};UserForge.prototype.postForgeUpdate=function(sysid,index){if(index===void 0){index=0}return[sysid,index]};UserForge.prototype.postForgeTips=function(b){return b?1:0};UserForge.prototype.sendUpGrade=function(roleId,pos){var bytes=this.getBytes(2);bytes.writeShort(roleId);bytes.writeShort(pos);this.sendToServer(bytes)};UserForge.prototype.delaySeekItem=function(){if(!TimerManager.ins().isExists(this.seekForgeItem,this))TimerManager.ins().doTimer(60,1,this.seekForgeItem,this)};UserForge.prototype.seekForgeItem=function(){var isReturn=false;var len=UserBag.ins().getBagItemNum(0);for(var i=0;i<len;i++){var item=UserBag.ins().getBagGoodsByIndex(0,i);switch(item.itemConfig.id){case 200002:isReturn=this.forgeHint(0,item.count);break;case 200003:isReturn=this.forgeHint(ForgeWin.Page_Select_ZhuLing,item.count);break}if(isReturn)break}if(!isReturn){isReturn=this.forgeHint(ForgeWin.Page_Select_Gem,Actor.soul)}if(!isReturn){for(var roleIndex=0;roleIndex<SubRoles.ins().subRolesLen;roleIndex++){isReturn=Weapons.ins().checkRedPoint(roleIndex);if(isReturn)break}}this.postForgeTips(isReturn)};UserForge.prototype.getForgeConfigByPos=function(pos,lv,configType){var config=this.getForgeConfig(configType);return config[pos]&&config[pos][lv]};UserForge.prototype.getForgeConfig=function(configType){this.forgeConfigDic=this.forgeConfigDic||{};if(!this.forgeConfigDic[configType]){var list=void 0;switch(configType){case ForgeWin.Page_Select_Boost:list=GlobalConfig.EnhanceAttrConfig;break;case ForgeWin.Page_Select_ZhuLing:list=GlobalConfig.ZhulingAttrConfig;break;case ForgeWin.Page_Select_Gem:list=GlobalConfig.StoneLevelConfig;break;case 3:break}var config=this.forgeConfigDic[configType]={};for(var index in list){var conf=list[index];if(!config[conf.posId]){config[conf.posId]={}}config[conf.posId][conf.level]=list[index]}}return this.forgeConfigDic[configType]};UserForge.prototype.getEnhanceCostConfigByLv=function(lv){var list=GlobalConfig.EnhanceCostConfig;return list[lv]};UserForge.prototype.getStoneLevelCostConfigByLv=function(lv){var list=GlobalConfig.StoneLevelCostConfig;var index;for(index in list){var config=list[index];if(config.level==lv)return config}return null};UserForge.prototype.getZhulingCostConfigByLv=function(lv){var list=GlobalConfig.ZhulingCostConfig;var index;for(index in list){var config=list[index];if(config.level==lv)return config}return null};UserForge.prototype.jingLianCanUp=function(){var len=SubRoles.ins().subRolesLen;var b=false;for(var roleIndex=0;roleIndex<len;roleIndex++){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);var index=role.getMinEquipIndexByType(1);var lv=role.getEquipByIndex(index).zhuling;var costNum=UserForge.ins().getZhulingCostConfigByLv(lv+1).count;if(costNum){var goodId=UserForge.ins().getZhulingCostConfigByLv(lv+1).itemId;var goodsNum=UserBag.ins().getBagGoodsCountById(0,goodId);if(goodsNum>=costNum){b=true;break}}}return b};UserForge.prototype.getTupoCostConfigByLv=function(lv){return null};UserForge.prototype.forgeHint=function(type,itemNum){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);var index=role.getMinEquipIndexByType(type);var lv=this.getForgeLv(type,role,index);var costNum=this.getForgeCount(type,lv);if(costNum){if(itemNum>=costNum){if(type!=ForgeWin.Page_Select_Gem){UserForge.ins().postForgeTips(true);return true}else{if(Actor.level>=UserForge.CONDITION_ZHUZAO){UserForge.ins().postForgeTips(true);return true}}}}}UserForge.ins().postForgeTips(false);return false};UserForge.prototype.getForgeLv=function(type,role,index){switch(type){case ForgeWin.Page_Select_Boost:return role.getEquipByIndex(index).strengthen;case ForgeWin.Page_Select_ZhuLing:return role.getEquipByIndex(index).zhuling;case ForgeWin.Page_Select_Gem:return role.getEquipByIndex(index).gem;case 3:return role.getEquipByIndex(index).tupo}};UserForge.prototype.getForgeCount=function(type,lv){switch(type){case ForgeWin.Page_Select_Boost:var boostConfig=this.getEnhanceCostConfigByLv(lv+1);if(boostConfig)return boostConfig.stoneNum;break;case ForgeWin.Page_Select_ZhuLing:var zhulingConfig=this.getZhulingCostConfigByLv(lv+1);if(zhulingConfig)return zhulingConfig.count;break;case ForgeWin.Page_Select_Gem:var gemConfig=this.getStoneLevelCostConfigByLv(lv+1);if(gemConfig)return gemConfig.soulNum;break;case 3:var tupoConfig=this.getTupoCostConfigByLv(lv+1);if(tupoConfig)return tupoConfig.count;break}return 0};UserForge.prototype.countAllBoostAttr=function(roleId,type,pos,next){if(pos===void 0){pos=0}if(next===void 0){next=false}var attrList=[];var roleData=SubRoles.ins().getSubRoleByIndex(roleId);for(var i=0;i<UserEquip.FOEGE_MAX;i++){var cfg=null;var level=this.getForgeLv(type,roleData,i);if(next&&pos==i){level+=1}cfg=UserForge.ins().getForgeConfigByPos(i,level,type);if(cfg&&cfg.attr){attrList=UserForge.AttrAddition(cfg.attr,attrList)}}return attrList};UserForge.prototype.isMaxForge=function(role,index){for(var i=0;i<8;i++){var level=this.getForgeLv(index,role,index);var nextConfig=UserForge.ins().getForgeConfigByPos(index,level+1,index);if(!nextConfig)return false}return true};UserForge.AttrAddition=function(attr1,attr2){var len1=attr1.length;var len2=attr2.length;var attrList=[];var attr;for(var i=0;i<len1;i++){attr=AttributeData.copyAttrbute(attr1[i]);attrList.push(attr)}for(var k=0;k<len2;k++){var flag=false;for(var i=0;i<attrList.length;i++){if(attr2[k].type==attrList[i].type){attrList[i].value=attrList[i].value+attr2[k].value;flag=true}}if(!flag){attr=AttributeData.copyAttrbute(attr2[k]);attrList.push(attr)}}return attrList};UserForge.prototype.sendMeltItem=function(arr){var bytes=this.getBytes(5);bytes.writeShort(arr.length);for(var i in arr){bytes.writeInt(arr[i].configID);bytes.writeInt(arr[i].count)}this.sendToServer(bytes)};UserForge.prototype.postMeltItem=function(){};return UserForge}(BaseSystem);__reflect(UserForge.prototype,"UserForge");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userforge=UserForge.ins.bind(UserForge)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UserGem=function(_super){__extends(UserGem,_super);function UserGem(){var _this=_super.call(this)||this;_this.sysId=PackageID.Gem;_this.regNetMsg(2,_this.postForgeUpdata);return _this}UserGem.ins=function(){return _super.ins.call(this)};UserGem.prototype.postForgeUpdata=function(bytes){var roleId=bytes.readShort();var model=SubRoles.ins().getSubRoleByIndex(roleId);var index=model.parseForgeChange(bytes,this.sysId);UserForge.ins().postForgeUpdate(this.sysId,index)};UserGem.prototype.sendUpGrade=function(roleId,pos){var bytes=this.getBytes(2);bytes.writeShort(roleId);bytes.writeShort(pos);this.sendToServer(bytes)};UserGem.ROLL_NUM=8;return UserGem}(BaseSystem);__reflect(UserGem.prototype,"UserGem");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.usergem=UserGem.ins.bind(UserGem)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UserTupo=function(_super){__extends(UserTupo,_super);function UserTupo(){var _this=_super.call(this)||this;_this.sysId=PackageID.Tupo;_this.regNetMsg(2,_this.postForgeUpdata);return _this}UserTupo.ins=function(){return _super.ins.call(this)};UserTupo.prototype.postForgeUpdata=function(bytes){var roleId=bytes.readShort();var model=SubRoles.ins().getSubRoleByIndex(roleId);model.parseForgeChange(bytes,this.sysId);UserForge.ins().postForgeUpdate(this.sysId)};UserTupo.prototype.sendUpGrade=function(roleId,pos){var bytes=this.getBytes(2);bytes.writeShort(roleId);bytes.writeShort(pos);this.sendToServer(bytes)};return UserTupo}(BaseSystem);__reflect(UserTupo.prototype,"UserTupo");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.usertupo=UserTupo.ins.bind(UserTupo)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UserZhuLing=function(_super){__extends(UserZhuLing,_super);function UserZhuLing(){var _this=_super.call(this)||this;_this.sysId=PackageID.Zhuling;_this.regNetMsg(2,_this.postForgeUpdata);return _this}UserZhuLing.ins=function(){return _super.ins.call(this)};UserZhuLing.prototype.postForgeUpdata=function(bytes){var roleId=bytes.readShort();var model=SubRoles.ins().getSubRoleByIndex(roleId);var index=model.parseForgeChange(bytes,this.sysId);UserForge.ins().postForgeUpdate(this.sysId,index)};UserZhuLing.prototype.sendUpGrade=function(roleId,pos){var bytes=this.getBytes(2);bytes.writeShort(roleId);bytes.writeShort(pos);this.sendToServer(bytes)};return UserZhuLing}(BaseSystem);__reflect(UserZhuLing.prototype,"UserZhuLing");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userzhuling=UserZhuLing.ins.bind(UserZhuLing)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ProxyUpdate=function(){function ProxyUpdate(cache){this._cache=cache}ProxyUpdate.prototype.isArray=function(key){return key instanceof Array};ProxyUpdate.prototype.isObject=function(key){return key.indexOf("object")>-1};ProxyUpdate.prototype.isNormal=function(key){var isAt=key.indexOf("@")>-1;var isDot=key.indexOf(".")>-1;var isUnderline=key.indexOf("_")>-1;return!isAt&&!isDot&&!isUnderline};ProxyUpdate.prototype.isAddToArray=function(key){return key=="@a"};ProxyUpdate.prototype.isRemoveToArray=function(key){var arr=key.split("_");return arr.length<=3&&arr[0]=="@d"};ProxyUpdate.prototype.isFilter=function(key){var arr=key.split("_");return arr[0]=="@f"};ProxyUpdate.prototype.isNumeric=function(v){return parseFloat(v).toString()==v.toString()};ProxyUpdate.prototype._updateObject=function(name,value,cacheData){var arr=name.split(".");if(arr[0]=="@a"||arr[0]=="@s"){cacheData[arr[1]]=value}else if(arr[0]=="@d"){delete cacheData[arr[1]]}};ProxyUpdate.prototype._getFilterObject=function(filter,cacheData){if(cacheData){var arr=filter.split("_");if(arr.length==3&&arr[0]=="@f"&&this.isArray(cacheData)){var key=arr[1];var value=arr[2];for(var i=0;i<cacheData.length;i++){var v=cacheData[i];if(arr.length==3&&this.isObject(v.toString())){var cacheValue=v[key];if(cacheValue){if(value[0]=="@"){value=value.replace("@","")}if(value==cacheValue){return v}}}}}}return null};ProxyUpdate.prototype._addObjectToArray=function(cacheData,changeValue){if(this.isArray(changeValue)){for(var i=0;i<changeValue.length;i++){cacheData.push(changeValue[i])}}else{cacheData.push(changeValue)}};ProxyUpdate.prototype._removeObjectFromArray=function(cacheData,key,changeValue){var arr=key.split("_");if(arr.length<=3&&arr[0]=="@d"){if(this.isArray(cacheData)){var count=cacheData.length;for(var i=count-1;i>=0;i--){var cacheDataItem=cacheData[i];if(arr.length==3){if(cacheDataItem.hasOwnProperty(arr[1])){var val=arr[2];if(val[0]=="@"){val=val.replace("@","")}if(val==cacheDataItem[arr[1]]){cacheData.splice(i,1)}}}else if(arr.length==2&&cacheDataItem.hasOwnProperty(arr[1])){if(changeValue==cacheDataItem[arr[1]]){cacheData.splice(i,1)}}else if(arr.length==1){if(changeValue==cacheDataItem){cacheData.splice(i,1)}}}}}};ProxyUpdate.prototype.update=function(key,data){this._cache[key]=data;if(data.hasOwnProperty("c")){var cdata=data["c"];var keys=Object.keys(cdata);for(var i=0,len=keys.length;i<len;i++){var k1=keys[i];if(this._cache[k1]){this._update(this._cache[k1],cdata[k1]);MessageCenter.ins().dispatch(k1+"_HttpUpdate")}}}};ProxyUpdate.prototype._update=function(cacheData,changeData){if(cacheData&&changeData&&this.isObject(changeData.toString())){var keys=Object.keys(changeData);for(var i=0,len=keys.length;i<len;i++){var k=keys[i];var v=changeData[k];if(this.isNormal(k)&&this.isObject(v.toString())){if(cacheData.hasOwnProperty(k)){this._update(cacheData[k],v)}}else if(this.isNormal(k)&&this.isNumeric(v)){var cv=cacheData[k];cacheData[k]=cv+v}else if(this.isNormal(k)){cacheData[k]=v}else if(this.isAddToArray(k)){this._addObjectToArray(cacheData,v)}else if(this.isRemoveToArray(k)){this._removeObjectFromArray(cacheData,k,v)}else if(this.isFilter(k)){var subCacheData=this._getFilterObject(k,cacheData);if(subCacheData){this._update(subCacheData,v)}}else{this._updateObject(k,v,cacheData)}}}};return ProxyUpdate}();__reflect(ProxyUpdate.prototype,"ProxyUpdate");var ForgeConst;(function(ForgeConst){ForgeConst.CAN_FORGE_EQUIP=[EquipPos.WEAPON,EquipPos.HEAD,EquipPos.CLOTHES,EquipPos.NECKLACE,EquipPos.Wrist,EquipPos.BRACELET,EquipPos.RING,EquipPos.SHOE];ForgeConst.EQUIP_POS_TO_SUB=[];ForgeConst.EQUIP_POS_TO_SUB[EquipPos.WEAPON]=0;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.HEAD]=1;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.CLOTHES]=2;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.NECKLACE]=3;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.Wrist]=4;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.BRACELET]=5;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.RING]=6;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.SHOE]=7;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]=8;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.HAT]=9;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.VIZARD]=10;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.CLOAK]=11;ForgeConst.EQUIP_POS_TO_SUB[EquipPos.SHIELD]=12})(ForgeConst||(ForgeConst={}));window["ForgeConst"]=ForgeConst;var ForgeRedPoint=function(_super){__extends(ForgeRedPoint,_super);function ForgeRedPoint(){var _this=_super.call(this)||this;_this.roleTabs={};_this.flexible={};_this.tabs={};_this.roleTabs={};_this.flexible={};_this.redPoint=false;_this.associated(_this.postForgeRedPoint,_this.postForgeBoostRedPoint,_this.postForgeZhulingRedPoint,_this.postForgeGemRedPoint,_this.postForgeWeaponRedPoint);_this.associated(_this.postForgeBoostRedPoint,UserForge.ins().postForgeUpdate,UserForge.ins().postForgeTips);_this.associated(_this.postForgeZhulingRedPoint,UserForge.ins().postForgeUpdate,UserForge.ins().postForgeTips);_this.associated(_this.postForgeGemRedPoint,UserForge.ins().postForgeUpdate,UserForge.ins().postForgeTips);_this.associated(_this.postForgeWeaponRedPoint,UserForge.ins().postForgeUpdate,UserForge.ins().postForgeTips,Weapons.ins().postWeaponsUse,Weapons.ins().postWeaponsFlexibleAct,Weapons.ins().postWeaponsInfo);return _this}ForgeRedPoint.prototype.postForgeRedPoint=function(){var old=this.redPoint;this.redPoint=this.tabs[ForgeWin.Page_Select_Boost]||this.tabs[ForgeWin.Page_Select_ZhuLing]||this.tabs[ForgeWin.Page_Select_Gem]||this.tabs[ForgeWin.Page_Select_Weapon];return old!=this.redPoint};ForgeRedPoint.prototype.getRedPoint=function(tab){return this.tabs[tab]};ForgeRedPoint.prototype.getFlexibleRoleRedPoint=function(tab){return this.flexible[tab]};ForgeRedPoint.prototype.postForgeBoostRedPoint=function(){var tab=ForgeWin.Page_Select_Boost;var old=this.tabs[tab];var b=false;var len=SubRoles.ins().subRolesLen;for(var roleIndex=0;roleIndex<len;roleIndex++){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);var index=role.getMinEquipIndexByType(tab);var lv=role.getEquipByIndex(index).strengthen;var boostConfig=UserForge.ins().getEnhanceCostConfigByLv(lv+1);if(boostConfig){var costNum=boostConfig.stoneNum;if(costNum){var goodId=boostConfig.stoneId;var goodsNum=UserBag.ins().getBagGoodsCountById(0,goodId);if(goodsNum>=costNum){var isRed=UserForge.ins().isMaxForge(role,tab);if(isRed){b=true}}if(!this.roleTabs[tab])this.roleTabs[tab]={};this.roleTabs[tab][roleIndex]=goodsNum>=costNum}}}this.tabs[tab]=b;return old!=b};ForgeRedPoint.prototype.postForgeZhulingRedPoint=function(){var tab=ForgeWin.Page_Select_ZhuLing;var old=this.tabs[tab];var b=false;var len=SubRoles.ins().subRolesLen;for(var roleIndex=0;roleIndex<len;roleIndex++){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);var index=role.getMinEquipIndexByType(tab);var lv=role.getEquipByIndex(index).zhuling;var zhulingConfig=UserForge.ins().getZhulingCostConfigByLv(lv+1);if(zhulingConfig){var costNum=zhulingConfig.count;if(costNum){var goodId=zhulingConfig.itemId;var goodsNum=UserBag.ins().getBagGoodsCountById(0,goodId);if(goodsNum>=costNum){var isRed=UserForge.ins().isMaxForge(role,tab);if(isRed){b=true}}if(!this.roleTabs[tab])this.roleTabs[tab]={};this.roleTabs[tab][roleIndex]=goodsNum>=costNum}}}this.tabs[tab]=b;return old!=b};ForgeRedPoint.prototype.postForgeGemRedPoint=function(){if(Actor.level<GlobalConfig.StoneOpenConfig[0].openLv)return false;var tab=ForgeWin.Page_Select_Gem;var old=this.tabs[tab];var b=false;var len=SubRoles.ins().subRolesLen;for(var roleIndex=0;roleIndex<len;roleIndex++){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);var index=role.getMinEquipIndexByType(tab);var lv=role.getEquipByIndex(index).gem;var gemConfig=UserForge.ins().getStoneLevelCostConfigByLv(lv+1);if(gemConfig){var costNum=gemConfig.soulNum;if(costNum){var goodId=gemConfig.stoneId;var goodsNum=Actor.soul;if(goodsNum>=costNum){var isRed=UserForge.ins().isMaxForge(role,tab);if(isRed){b=true}}if(!this.roleTabs[tab])this.roleTabs[tab]={};this.roleTabs[tab][roleIndex]=goodsNum>=costNum}}}this.tabs[tab]=b;return old!=b};ForgeRedPoint.prototype.postForgeWeaponRedPoint=function(){var tab=ForgeWin.Page_Select_Weapon;var ispost=false;var b=false;var len=SubRoles.ins().subRolesLen;for(var roleIndex=0;roleIndex<len;roleIndex++){var weapRedPoint=Weapons.ins().checkRedPoint(roleIndex);if(weapRedPoint)b=weapRedPoint;if(!this.roleTabs[tab])this.roleTabs[tab]={};if(!ispost&&this.roleTabs[tab][roleIndex]!=weapRedPoint)ispost=true;var flexRedPoint=this.getFlexibleRedPoint(roleIndex);this.flexible[roleIndex]=flexRedPoint;this.roleTabs[tab][roleIndex]=weapRedPoint}this.tabs[tab]=b;return ispost};ForgeRedPoint.prototype.getFlexibleRedPointOnly=function(roleId,id){var role=SubRoles.ins().getSubRoleByIndex(roleId);var fb=role.weapons.getFlexibleData();if(role.weapons.flexibleCount<=fb.length){return false}var ws=role.weapons.getSoulInfoData();var weaponsIds=[];for(var k in ws){if(ws[k]&&ws[k].id){weaponsIds.push(ws[k].id)}}if(fb.indexOf(id)==-1){return true}return false};ForgeRedPoint.prototype.getFlexibleRedPoint=function(i){var role=SubRoles.ins().getSubRoleByIndex(i);var fb=role.weapons.getFlexibleData();if(role.weapons.flexibleCount<=fb.length){return false}var ws=role.weapons.getSoulInfoData();var weaponsIds=[];for(var k in ws){if(ws[k]&&ws[k].id){weaponsIds.push(ws[k].id)}}for(var j=0;j<weaponsIds.length;j++){if(fb.indexOf(weaponsIds[j])==-1){return true}}if(role.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum)return true;return false};return ForgeRedPoint}(BaseSystem);__reflect(ForgeRedPoint.prototype,"ForgeRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.forgeredpoint=ForgeRedPoint.ins.bind(ForgeRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var CastingPosItemRender=function(_super){__extends(CastingPosItemRender,_super);function CastingPosItemRender(){var _this=_super.call(this)||this;_this.statuList=["open","select","dark"];_this.skinName="castingpositemrenderskin";return _this}CastingPosItemRender.prototype.setShowStatu=function(statu){this.currentState=this.statuList[statu]};return CastingPosItemRender}(BaseView);__reflect(CastingPosItemRender.prototype,"CastingPosItemRender");var Castingposlist=function(_super){__extends(Castingposlist,_super);function Castingposlist(){var _this=_super.call(this)||this;_this.skinName="castingposlistskin";return _this}Castingposlist.prototype.setShow=function(pos,level,isMax){this.currentState="pos_"+pos;var index=isMax?UserGem.ROLL_NUM:level%UserGem.ROLL_NUM;for(var i=0;i<UserGem.ROLL_NUM;i++){var statu=0;if(index>i){statu=0}else if(index==i){statu=1}else{statu=2}this["item"+i].setShowStatu(statu);if(this["line_"+i]){this["line_"+i].source=statu==0?"zhuzaoxian":"zhuzaoxianbg"}}};return Castingposlist}(BaseView);__reflect(Castingposlist.prototype,"Castingposlist");var CircleRunBoostView=function(_super){__extends(CircleRunBoostView,_super);function CircleRunBoostView(){var _this=_super.call(this)||this;_this.equipSource=["xduanzao_20","xduanzao_21","xduanzao_22","xduanzao_23","xduanzao_24","xduanzao_24","xduanzao_25","xduanzao_25"];_this.nameBg=["xduanzao_10_png","xduanzao_11_png"];_this.skinName="CircleRunBoostSkin";_this.itemList=[];var n=CircleRunView.EQUIP_COUNT;while(n--){_this.itemList[n]=_this["item"+n]}_this["item0"].itemName.source="xduanzao_12_png";_this["item1"].itemName.source="xduanzao_13_png";_this["item2"].itemName.source="xduanzao_14_png";_this["item3"].itemName.source="xduanzao_15_png";_this["item4"].itemName.source="xduanzao_16_png";_this["item5"].itemName.source="xduanzao_16_png";_this["item6"].itemName.source="xduanzao_17_png";_this["item7"].itemName.source="xduanzao_17_png";return _this}Object.defineProperty(CircleRunBoostView.prototype,"type",{get:function(){return this._type},set:function(value){this._type=value;for(var i=0;i<this.itemList.length;i++){this.itemList[i].setType(this._type)}this.setValue()},enumerable:true,configurable:true});CircleRunBoostView.prototype.setValue=function(){var model=SubRoles.ins().getSubRoleByIndex(this.curRole);var n=this.itemList.length;for(var i=0;i<n;i++){var num=0;switch(this._type){case 0:num=model.getEquipByIndex(i).strengthen;break}this.itemList[i].setValue(num)}};CircleRunBoostView.prototype.turnItem=function(pos){this.equip.source=this.equipSource[pos];this.setNameBg(pos)};CircleRunBoostView.prototype.setNameBg=function(pos){var len=this.itemList.length;for(var i=0;i<len;i++){if(i==pos)this.itemList[i].setSource(this.nameBg[1]);else this.itemList[i].setSource(this.nameBg[0])}};return CircleRunBoostView}(BaseView);__reflect(CircleRunBoostView.prototype,"CircleRunBoostView");var CircleRunGemView=function(_super){__extends(CircleRunGemView,_super);function CircleRunGemView(){var _this=_super.call(this)||this;_this.skinName="CircleRunGemSkin";_this.itemList=[];var n=CircleRunView.EQUIP_COUNT;while(n--){_this.itemList[n]=_this["item"+n]}_this["item0"].item.source="forge_00_png";_this["item1"].item.source="forge_01_png";_this["item2"].item.source="forge_02_png";_this["item3"].item.source="forge_03_png";_this["item4"].item.source="forge_04_png";_this["item5"].item.source="forge_05_png";_this["item6"].item.source="forge_06_png";_this["item7"].item.source="forge_07_png";return _this}Object.defineProperty(CircleRunGemView.prototype,"type",{get:function(){return this._type},set:function(value){this._type=value;for(var i=0;i<this.itemList.length;i++){this.itemList[i].setType(this._type)}this.setValue()},enumerable:true,configurable:true});CircleRunGemView.prototype.setValue=function(){var model=SubRoles.ins().getSubRoleByIndex(this.curRole);var n=this.itemList.length;for(var i=0;i<n;i++){var num=0;switch(this._type){case 1:num=model.getEquipByIndex(i).gem;break}this.itemList[i].setValue(num)}};CircleRunGemView.prototype.turnItem=function(pos){this.setItemSelect(pos)};CircleRunGemView.prototype.setItemSelect=function(pos){var len=this.itemList.length;for(var i=0;i<len;i++){if(i==pos)this.itemList[i].isSelectEff(true);else this.itemList[i].isSelectEff(false)}};return CircleRunGemView}(BaseView);__reflect(CircleRunGemView.prototype,"CircleRunGemView");var CircleRunView=function(_super){__extends(CircleRunView,_super);function CircleRunView(){var _this=_super.call(this)||this;_this.boostView=new CircleRunBoostView;_this.addChild(_this.boostView);_this.gemView=new CircleRunGemView;_this.addChild(_this.gemView);_this.zhulingView=new CircleRunZhulingView;_this.addChild(_this.zhulingView);return _this}Object.defineProperty(CircleRunView.prototype,"type",{get:function(){return this._type},set:function(value){this._type=value;this.boostView.visible=false;this.gemView.visible=false;this.zhulingView.visible=false;switch(this._type){case 0:this.boostView.visible=true;this.boostView.type=value;break;case 1:this.gemView.visible=true;this.gemView.type=value;break;case 2:this.zhulingView.visible=true;this.zhulingView.type=value;break;case 3:break}this.setValue()},enumerable:true,configurable:true});CircleRunView.prototype.setCurRole=function(value){this._curRole=value;this.boostView.curRole=value;this.gemView.curRole=value;this.zhulingView.curRole=value};CircleRunView.prototype.getCurRole=function(){return this._curRole};CircleRunView.prototype.setValue=function(){switch(this._type){case 0:this.boostView.setValue();break;case 1:this.gemView.setValue();break;case 2:this.zhulingView.setValue();break;case 3:break}};CircleRunView.prototype.turnItem=function(pos){switch(this._type){case 0:this.boostView.turnItem(pos);break;case 1:this.gemView.turnItem(pos);break;case 2:this.zhulingView.turnItem(pos);break;case 3:break}};CircleRunView.BOOST=0;CircleRunView.GEM=1;CircleRunView.ZHU_LING=2;CircleRunView.EQUIP_COUNT=8;return CircleRunView}(BaseView);__reflect(CircleRunView.prototype,"CircleRunView");var CircleRunZhulingView=function(_super){__extends(CircleRunZhulingView,_super);function CircleRunZhulingView(){var _this=_super.call(this)||this;_this.skinName="CircleRunZhulingSkin";_this.itemList=[];var n=CircleRunView.EQUIP_COUNT;while(n--){_this.itemList[n]=_this["item"+n]}_this["item0"].item.source="forge_00_png";_this["item1"].item.source="forge_01_png";_this["item2"].item.source="forge_02_png";_this["item3"].item.source="forge_03_png";_this["item4"].item.source="forge_04_png";_this["item5"].item.source="forge_05_png";_this["item6"].item.source="forge_06_png";_this["item7"].item.source="forge_07_png";return _this}Object.defineProperty(CircleRunZhulingView.prototype,"type",{get:function(){return this._type},set:function(value){this._type=value;for(var i=0;i<this.itemList.length;i++){this.itemList[i].setType(this._type)}this.setValue()},enumerable:true,configurable:true});CircleRunZhulingView.prototype.setValue=function(){var model=SubRoles.ins().getSubRoleByIndex(this.curRole);var n=this.itemList.length;for(var i=0;i<n;i++){var num=0;switch(this._type){case 2:num=model.getEquipByIndex(i).zhuling;break}this.itemList[i].setValue(num)}};CircleRunZhulingView.prototype.turnItem=function(pos){this.setItemSelect(pos)};CircleRunZhulingView.prototype.setItemSelect=function(pos){var len=this.itemList.length;for(var i=0;i<len;i++){if(i==pos)this.itemList[i].isSelectEff(true);else this.itemList[i].isSelectEff(false)}};return CircleRunZhulingView}(BaseView);__reflect(CircleRunZhulingView.prototype,"CircleRunZhulingView");var Tween=egret.Tween;window["Tween"]=Tween;var ForgeBoostPanel=function(_super){__extends(ForgeBoostPanel,_super);function ForgeBoostPanel(){var _this=_super.call(this)||this;_this.isMax=false;_this.isAutoUp=false;_this.itemNum=0;_this.startPos=0;_this.name=i18n("ForgeBoostPanel_0");return _this}ForgeBoostPanel.prototype.childrenCreated=function(){this.initUI()};ForgeBoostPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.upGradeBtn.label=i18n("ForgeBoostPanel_1");this.curPanel=ForgeWin.Page_Select_Boost;this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>");this.eff=new MovieClip;this.eff.x=this.upGradeBtn.width/2;this.eff.y=this.upGradeBtn.height/2;this.eff.touchEnabled=false};ForgeBoostPanel.prototype.getGuildButton=function(){this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);this.eff.x=this.upGradeBtn.width/2;this.eff.y=this.upGradeBtn.height/2;if(!this.eff.parent)this.upGradeBtn.addChild(this.eff);return this.upGradeBtn};ForgeBoostPanel.prototype.open=function(pos,lv){this.addTouchEvent(this.upGradeBtn,this.onTouch);this.addTouchEvent(this.upGradeBtn0,this.onTouch);this.addTouchEvent(this.getItemTxt,this.onGetItem);this.observe(UserBag.ins().postItemAdd,this.setCount);this.observe(UserBag.ins().postItemChange,this.setCount);this.observe(Actor.ins().postLevelChange,this.setView);this.isMax=false;this.setView();this.changeData(pos,lv);this.stopAutoUp()};ForgeBoostPanel.prototype.close=function(){this.removeTouchEvent(this.upGradeBtn,this.onTouch);this.removeTouchEvent(this.getItemTxt,this.onGetItem);DisplayUtils.removeFromParent(this.eff);this.stopAutoUp()};ForgeBoostPanel.prototype.setView=function(){DisplayUtils.removeFromParent(this.eff)};ForgeBoostPanel.prototype.onTouch=function(e){switch(e.target){case this.upGradeBtn:DisplayUtils.removeFromParent(this.eff);var costConfig=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);if(!costConfig)return;if(this.itemNum>=costConfig.stoneNum){SoundUtil.ins().playEffect(SoundUtil.FORGE);UserForge.ins().sendUpGrade(this.curRole,this.pos)}else{UserWarn.ins().setBuyGoodsWarn(costConfig.stoneId,costConfig.stoneNum-this.itemNum)}break;case this.upGradeBtn0:if(!this.isAutoUp){this.isAutoUp=true;this.startPos=this.pos;if(!this.autoUpStarEx()){this.isAutoUp=false;this.materialNotEnough();return}var forgeSuccessEff_1;if(!forgeSuccessEff_1){forgeSuccessEff_1=new MovieClip;forgeSuccessEff_1.x=this.itemGroup.width/2+110;forgeSuccessEff_1.y=this.itemGroup.height/2;this.itemGroup.addChild(forgeSuccessEff_1)}forgeSuccessEff_1.playFile(RES_DIR_EFF+"qianghua2",1,function(){DisplayUtils.removeFromParent(forgeSuccessEff_1)})}break}};ForgeBoostPanel.prototype.stopAutoUp=function(){this.isAutoUp=false;if(this.upGradeBtn0)this.upGradeBtn0.label=i18n("ForgeBoostPanel_4");egret.Tween.removeTweens(this.upGradeBtn0)};ForgeBoostPanel.prototype.stopAutoUpEx=function(){this.isAutoUp=false;TimerManager.ins().remove(this.stopAutoUpEx,this)};ForgeBoostPanel.prototype.materialNotEnough=function(){var costConfig=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);if(!costConfig){UserTips.ins().showTips(i18n("ForgeBoostPanel_5"));return}if(this.itemNum>=costConfig.stoneNum){}else{UserWarn.ins().setBuyGoodsWarn(costConfig.stoneId,costConfig.stoneNum-this.itemNum)}};ForgeBoostPanel.prototype.autoUpBack=function(index){if(this.isAutoUp){var costConfig=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);if(!costConfig)return;if(this.itemNum<costConfig.stoneNum){this.isAutoUp=false;this.materialNotEnough();return}if(this.startPos==index){this.isAutoUp=false;return}UserForge.ins().sendUpGrade(this.curRole,index)}};ForgeBoostPanel.prototype.autoUpStarEx=function(){var costConfig=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);if(!costConfig)return false;if(this.itemNum>=costConfig.stoneNum){SoundUtil.ins().playEffect(SoundUtil.FORGE);UserForge.ins().sendUpGrade(this.curRole,this.pos)}else{this.upGradeBtn0.label=i18n("ForgeBoostPanel_8");return false}return true};ForgeBoostPanel.prototype.autoUpStar=function(){var costConfig=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);if(!costConfig)return;if(this.itemNum>=costConfig.stoneNum){UserForge.ins().sendUpGrade(this.curRole,this.pos);if(this.pos==7){this.isAutoUp=false;this.upGradeBtn0.label=i18n("ForgeBoostPanel_9");TimerManager.ins().remove(this.autoUpStar,this)}}else{this.isAutoUp=false;this.upGradeBtn0.label=i18n("ForgeBoostPanel_10");TimerManager.ins().remove(this.autoUpStar,this)}};ForgeBoostPanel.prototype.onGetItem=function(e){UserWarn.ins().setBuyGoodsWarn(UserForge.ins().getEnhanceCostConfigByLv(this.lv+1).stoneId,1)};ForgeBoostPanel.prototype.changeData=function(pos,lv,bool){if(bool===void 0){bool=true}this.pos=pos;this.lv=lv;var attrList=UserForge.ins().countAllBoostAttr(this.curRole,this.curPanel);this.setAttrData(attrList);this.setPower();this.setSlectedInfo();if(bool){this.setCount();this.upGradeBtn.touchEnabled=true}else{this.upGradeBtn.touchEnabled=false}};ForgeBoostPanel.prototype.setPower=function(){var model=SubRoles.ins().getSubRoleByIndex(this.curRole);this._totalPower=model.getForgeTotalPower(this.curPanel);this.powerPanel.setPower(this._totalPower)};ForgeBoostPanel.prototype.setSlectedInfo=function(){var roleData=SubRoles.ins().getSubRoleByIndex(this.curRole);var equipData=roleData.equipsData;for(var i=0;i<UserEquip.FOEGE_MAX;i++){var level=equipData[i].strengthen;this["level_"+i].text=level>0?"+"+level:"";this["show"+(i+1)].visible=i==this.pos;this["lianjiexian"+i].visible=i==this.pos}};ForgeBoostPanel.prototype.setAttrData=function(attrList){var nextConfig;var len=attrList.length;attrList.sort(AttributeData.sortAttribute);for(var i=0;i<4;i++){this["attr"+i].text=len>i?AttributeData.getAttStrByType(attrList[i],.5):""}nextConfig=UserForge.ins().getForgeConfigByPos(this.pos,this.lv+1,this.curPanel);if(nextConfig){this.isMax=false;var str="";var addList=UserForge.ins().countAllBoostAttr(this.curRole,this.curPanel,this.pos,true);addList.sort(AttributeData.sortAttribute);for(var i=0;i<4;i++){if(len>i){var attr=attrList[i];str=this.getAttrByType(addList,attr)}this["arrow"+i].visible=str.length>0;this["addAttr"+i].text=str}}else{this.isMax=true;for(var i=0;i<4;i++){this["arrow"+i].visible=false;this["addAttr"+i].text=""}}this.upInfo.visible=!this.isMax;this.maxDesc.visible=this.isMax};ForgeBoostPanel.prototype.setCount=function(){var costConfig=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);var cost=0;if(costConfig){this.itemNum=UserBag.ins().getBagGoodsCountById(0,costConfig.stoneId);cost=costConfig.stoneNum}var colorStr="";if(this.itemNum>=cost)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;var color2=ColorUtil.UI_ITEMNUMBER_BULE_N;this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+this.itemNum+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+cost+"</font> ")};ForgeBoostPanel.prototype.getAttrByType=function(attrs,attr){var len=attrs.length;for(var i=0;i<len;i++){if(attrs[i].type==attr.type&&attrs[i].value!=attr.value){return""+attrs[i].value}}return""};return ForgeBoostPanel}(BaseEuiView);__reflect(ForgeBoostPanel.prototype,"ForgeBoostPanel");var ForgeGemPanel=function(_super){__extends(ForgeGemPanel,_super);function ForgeGemPanel(){var _this=_super.call(this)||this;_this.curPanel=3;_this.isMax=false;_this.isAutoUp=false;_this.itemNum=0;_this.itemArr=[];_this.eqIndexItems=[];_this.isPlay=false;_this.name=i18n("ForgeGemPanel_0");_this.curPanel=ForgeWin.Page_Select_Gem;return _this}ForgeGemPanel.prototype.childrenCreated=function(){this.initUI()};ForgeGemPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>")};ForgeGemPanel.prototype.open=function(pos,lv){this.addTouchEvent(this.upGradeBtn,this.onTouch);this.addTouchEvent(this.getItemTxt,this.onGetItem);for(var i=0;i<UserEquip.FOEGE_MAX;i++){this.eqIndexItems.push(this["item"+i]);this["item"+i].select.visible=i==pos?true:false;this.addTouchEvent(this["item"+i],this.onSelectItem)}this.observe(UserBag.ins().postItemAdd,this.setCount);this.observe(UserBag.ins().postItemChange,this.setCount);this.observe(UserGem.ins().postForgeUpdata,this.updateCallBack);this.isMax=false;this.changeData(pos,lv,true,true);this.stopAutoUp();this.cleanEff();this.playEff()};ForgeGemPanel.prototype.close=function(){this.removeTouchEvent(this.upGradeBtn,this.onTouch);this.removeTouchEvent(this.getItemTxt,this.onGetItem);this.removeObserve();this.stopAutoUp()};ForgeGemPanel.prototype.onTouch=function(e){switch(e.target){case this.upGradeBtn:if(this.costConfig&&this.itemNum>=this.costConfig.soulNum){UserGem.ins().sendUpGrade(this.curRole,this.pos);SoundUtil.ins().playEffect(SoundUtil.FORGE)}else{UserWarn.ins().setBuyGoodsWarn(this.costConfig.stoneId,this.costConfig.soulNum-this.itemNum)}break}};ForgeGemPanel.prototype.onItemTouch=function(e){var role=SubRoles.ins().getSubRoleByIndex(this.curRole);var pos=Number(e.currentTarget.name);this.changeData(pos,role.getEquipByIndex(pos).gem)};ForgeGemPanel.prototype.stopAutoUp=function(){this.isAutoUp=false;TimerManager.ins().remove(this.autoUpStar,this)};ForgeGemPanel.prototype.autoUpStar=function(){if(this.costConfig&&this.itemNum>=this.costConfig.soulNum){UserGem.ins().sendUpGrade(this.curRole,this.pos);SoundUtil.ins().playEffect(SoundUtil.FORGE)}else{this.isAutoUp=false;TimerManager.ins().remove(this.autoUpStar,this)}};ForgeGemPanel.prototype.setPower=function(){var model=SubRoles.ins().getSubRoleByIndex(this.curRole);this._totalPower=model.getForgeTotalPower(this.curPanel);this.powerPanel.setPower(this._totalPower)};ForgeGemPanel.prototype.changeData=function(pos,lv,bool,ini){if(bool===void 0){bool=true}if(ini===void 0){ini=false}this.pos=pos;this.lv=lv;this.setPower();if(bool){this.setCount()}this.updateItem(ini);this.setAttrData()};ForgeGemPanel.prototype.playEff=function(){var _this=this;if(this.isPlay){return}var effSour="jljdt";this.isPlay=true;var speed=1;var leff=new MovieClip;leff.playFile(RES_DIR_EFF+effSour,-1);this.leftEff.addChild(leff);leff.scaleX=0;leff.scaleY=.6;var reff=new MovieClip;reff.playFile(RES_DIR_EFF+effSour,-1);this.rightEff.addChild(reff);reff.scaleX=0;reff.scaleY=.6;var beff=new MovieClip;beff.playFile(RES_DIR_EFF+effSour,-1);this.buttonEff.addChild(beff);beff.x+=5;beff.scaleX=0;beff.scaleY=.6;beff.$setRotation(90);var leftEff2=new MovieClip;leftEff2.playFile(RES_DIR_EFF+effSour,-1);this.leftEff2.addChild(leftEff2);leftEff2.scaleX=0;leftEff2.scaleY=.4;var rightEff2=new MovieClip;rightEff2.playFile(RES_DIR_EFF+effSour,-1);this.rightEff2.addChild(rightEff2);rightEff2.scaleX=0;rightEff2.scaleY=.4;var obliqueleft=new MovieClip;obliqueleft.playFile(RES_DIR_EFF+effSour,-1);this.obliqueleft.addChild(obliqueleft);obliqueleft.scaleX=0;obliqueleft.scaleY=.4;var obliqueright=new MovieClip;obliqueright.playFile(RES_DIR_EFF+effSour,-1);this.obliqueright.addChild(obliqueright);obliqueright.scaleX=0;obliqueright.scaleY=.4;var leftEff3=new MovieClip;leftEff3.playFile(RES_DIR_EFF+effSour,-1);this.leftEff3.addChild(leftEff3);leftEff3.scaleX=0;leftEff3.scaleY=.4;var rightEff3=new MovieClip;rightEff3.playFile(RES_DIR_EFF+effSour,-1);this.rightEff3.addChild(rightEff3);rightEff3.scaleX=0;rightEff3.scaleY=.4;var obliqueleft2=new MovieClip;obliqueleft2.playFile(RES_DIR_EFF+effSour,-1);this.obliqueleft2.addChild(obliqueleft2);obliqueleft2.scaleX=0;obliqueleft2.scaleY=.4;var obliqueright2=new MovieClip;obliqueright2.playFile(RES_DIR_EFF+effSour,-1);this.obliqueright2.addChild(obliqueright2);obliqueright2.scaleX=0;obliqueright2.scaleY=.4;var leftEff4=new MovieClip;leftEff4.playFile(RES_DIR_EFF+effSour,-1);this.leftEff4.addChild(leftEff4);leftEff4.scaleX=0;leftEff4.scaleY=.4;var rightEff4=new MovieClip;rightEff4.playFile(RES_DIR_EFF+effSour,-1);this.rightEff4.addChild(rightEff4);rightEff4.scaleX=0;rightEff4.scaleY=.4;var maxX=.19;var maxX2=.09;var maxX3=.023;var maxX4=.15;var t1=egret.Tween.get(leff);var t2=egret.Tween.get(reff);t2.to({scaleX:maxX},250*speed);t1.to({scaleX:maxX},250*speed).call(function(){var t3=egret.Tween.get(beff);t3.to({scaleX:.162},250*speed).call(function(){var t4=egret.Tween.get(leftEff2);var t5=egret.Tween.get(rightEff2);t5.to({scaleX:maxX2},250*speed);t4.to({scaleX:maxX2},250*speed).call(function(){var t6=egret.Tween.get(obliqueleft);var t7=egret.Tween.get(obliqueright);t7.to({scaleX:maxX3},50*speed);t6.to({scaleX:maxX3},50*speed).call(function(){var t8=egret.Tween.get(leftEff3);var t9=egret.Tween.get(rightEff3);t9.to({scaleX:maxX4},250*speed);t8.to({scaleX:maxX4},250*speed).call(function(){var t10=egret.Tween.get(obliqueleft2);var t11=egret.Tween.get(obliqueright2);t11.to({scaleX:maxX3},50*speed);t10.to({scaleX:maxX3},50*speed).call(function(){var t12=egret.Tween.get(leftEff4);var t13=egret.Tween.get(rightEff4);t13.to({scaleX:maxX2},250*speed);t12.to({scaleX:maxX2},250*speed).call(function(){_this.isPlay=false})})})})})})})};ForgeGemPanel.prototype.cleanEff=function(){this.leftEff.removeChildren();this.rightEff.removeChildren();this.buttonEff.removeChildren();this.leftEff2.removeChildren();this.rightEff2.removeChildren();this.obliqueleft.removeChildren();this.obliqueright.removeChildren();this.leftEff3.removeChildren();this.rightEff3.removeChildren();this.obliqueleft2.removeChildren();this.obliqueright2.removeChildren();this.leftEff4.removeChildren();this.rightEff4.removeChildren()};ForgeGemPanel.prototype.updateCallBack=function(){var _this=this;var mc=new MovieClip;mc.x=this.new.x+this.new.width/2;mc.y=this.new.y+this.new.height/2;this.itemGroup2.addChild(mc);mc.playFile(RES_DIR_EFF+"forgeSuccess",1,function(){var roleData=SubRoles.ins().getSubRoleByIndex(_this.curRole);var equipData=roleData.equipsData;_this.now.updateItem(equipData[_this.pos].item.itemConfig,_this.pos,equipData[_this.pos].gem,_this.itemNum,false);_this.new.updateItem(equipData[_this.pos].item.itemConfig,_this.pos,equipData[_this.pos].gem+1,_this.itemNum,false)})};ForgeGemPanel.prototype.updateItem=function(ini){var roleData=SubRoles.ins().getSubRoleByIndex(this.curRole);var equipData=roleData.equipsData;for(var i=0;i<UserEquip.FOEGE_MAX;i++){var level=equipData[i].gem;var iNum=this.itemNum;if(ini&&i==this.pos){var openConfig=GlobalConfig.StoneOpenConfig[i];if(Actor.level>=openConfig.openLv){this.lv=equipData[this.pos].gem;this["item"+i].select.visible=true;this.xjyl.visible=false}this.now.updateItem(equipData[i].item.itemConfig,i,level,this.itemNum,false);this.new.updateItem(equipData[i].item.itemConfig,i,level+1,this.itemNum,false)}if(!iNum){var eqId=equipData[i].gem?equipData[i].gem:1;var cfg=GlobalConfig.StoneLevelCostConfig[eqId];if(cfg){iNum=UserBag.ins().getBagGoodsCountById(0,cfg.stoneId)}}this["item"+i].data={item:equipData[i].item.itemConfig,pos:i,lv:equipData[i].gem,itemNum:iNum}}};ForgeGemPanel.prototype.onSelectItem=function(e){var index=this.eqIndexItems.indexOf(e.currentTarget);if(index==-1)return;if(this.isPlay){this.isPlay=false;this.cleanEff()}var showIndex=this.pos;for(var i=0;i<UserEquip.FOEGE_MAX;i++){if(this["item"+i].select.visible)showIndex=i;this["item"+i].select.visible=false}var isSelect=false;var roleData=SubRoles.ins().getSubRoleByIndex(this.curRole);var equipData=roleData.equipsData;var openConfig=GlobalConfig.StoneOpenConfig[index];var tips="";switch(e.currentTarget){case this["item"+index]:if(Actor.level>=openConfig.openLv){this.cleanEff();this.playEff();this.pos=index;this.lv=equipData[this.pos].gem;isSelect=true;this["item"+index].select.visible=true;this.xjyl.visible=false;this.now.updateItem(equipData[index].item.itemConfig,index,equipData[index].gem,this.itemNum,false);this.new.updateItem(equipData[index].item.itemConfig,index,equipData[index].gem+1,this.itemNum,false)}else{tips=openConfig.openLv+i18n("ForgeGemPanel_4")}break}if(!isSelect){this["item"+showIndex].select.visible=true;UserTips.ins().showTips(tips)}this.setAttrData();this.setCount()};ForgeGemPanel.prototype.setAttrData=function(){var cruCfg;cruCfg=UserForge.ins().getForgeConfigByPos(this.pos,this.lv,this.curPanel);var attrList=cruCfg.attr||[];var len=attrList.length;attrList.sort(AttributeData.sortAttribute);for(var i=0;i<4;i++){this["attr"+i].text=len>i?AttributeData.getAttStrByType(attrList[i],.5):""}var nextConfig;nextConfig=UserForge.ins().getForgeConfigByPos(this.pos,this.lv+1,this.curPanel);var str="";if(nextConfig){this.isMax=false;var addList=nextConfig.attr||[];addList.sort(AttributeData.sortAttribute);for(var i=0;i<4;i++){var str_1="";if(len>i){var attr=attrList[i];str_1=this.getAttrByType(addList,attr)}this["arrow"+i].visible=str_1.length>0;this["addAttr"+i].text=str_1}}else{this.isMax=true;for(var i=0;i<4;i++){this["arrow"+i].visible=false;this["addAttr"+i].text=""}}this.attr.text=str;this.upInfo.visible=!this.isMax;this.maxDesc.visible=this.isMax;if(this.maxDesc.visible){this.now.hideAdd();this.new.hideAdd()}};ForgeGemPanel.prototype.onGetItem=function(e){UserWarn.ins().setBuyGoodsWarn(this.costConfig.stoneId,1)};ForgeGemPanel.prototype.setCount=function(){this.costConfig=UserForge.ins().getStoneLevelCostConfigByLv(this.lv+1);var cost=0;if(this.costConfig){this.itemNum=Actor.soul;cost=this.costConfig.soulNum}var colorStr="";if(this.itemNum>=cost)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+this.itemNum+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+cost+"</font> ");this.buyStoneUpdateItem()};ForgeGemPanel.prototype.buyStoneUpdateItem=function(){this.updateItem()};ForgeGemPanel.prototype.getAttrByType=function(attrs,attr){if(!attr)return"";var len=attrs.length;for(var i=0;i<len;i++){if(attrs[i].type==attr.type&&attrs[i].value!=attr.value){return""+attrs[i].value}}return""};return ForgeGemPanel}(BaseEuiView);__reflect(ForgeGemPanel.prototype,"ForgeGemPanel");var ForgeItem=function(_super){__extends(ForgeItem,_super);function ForgeItem(){return _super.call(this)||this}ForgeItem.prototype.childrenCreated=function(){};ForgeItem.prototype.getSource=function(){return this._source};ForgeItem.prototype.getSourceName=function(){return this._sourceName};ForgeItem.prototype.setSource=function(value){if(this._source==value)return;this._source=value;this.item.source=this._source};ForgeItem.prototype.setSourceName=function(value){if(this._sourceName==value)return;this._sourceName=value;this.item.source=this._sourceName};ForgeItem.prototype.isSelect=function(value){this.select.visible=value;return value};ForgeItem.prototype.isSelectEff=function(value){if(!this.parent)return;if(!this.selectEff){this.selectEff=new MovieClip;this.selectEff.x=40;this.selectEff.y=38;this.selectEff.playFile(RES_DIR_EFF+"zhuling",-1)}if(!this.selectEff.parent&&value)this.addChildAt(this.selectEff,2);value?this.selectEff.play(-1):this.selectEff.stop();this.selectEff.visible=value;return value};ForgeItem.prototype.setValue=function(num){switch(this._type){case 0:this.boost.text="+"+num;break;case 1:this.gem.text="+"+num;break;case 2:this.zhuling.text="+"+num;break;case 3:this.tupo.text=num+i18n("ForgeItem_0");break}};ForgeItem.prototype.getType=function(){return this._type};ForgeItem.prototype.setType=function(value){if(this._type==value)return;this._type=value;switch(this._type){case 0:this.boost.visible=true;this.itemName.visible=true;this.gem.visible=false;this.zhuling.visible=false;this.tupo.visible=false;this.isSelect(false);this.labelBg.visible=false;break;case 1:this.boost.visible=false;this.itemName.visible=false;this.gem.visible=true;this.zhuling.visible=false;this.tupo.visible=false;this.labelBg.visible=true;break;case 2:this.boost.visible=false;this.itemName.visible=false;this.gem.visible=false;this.zhuling.visible=true;this.tupo.visible=false;this.labelBg.visible=true;break;case 3:this.boost.visible=false;this.itemName.visible=false;this.gem.visible=false;this.zhuling.visible=false;this.tupo.visible=true;this.labelBg.visible=true;break}};return ForgeItem}(BaseComponent);__reflect(ForgeItem.prototype,"ForgeItem");var ForgeTipsWin=function(_super){__extends(ForgeTipsWin,_super);function ForgeTipsWin(){return _super.call(this)||this}ForgeTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="forgeTips"};ForgeTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.attr=param[0];this.attrStr=param[1];this.addTouchEndEvent(this,this.otherClose);this.attrTxt.text=this.attrStr;this.attrTxt0.text="";for(var i=0;i<this.attr.length;i++){this.attrTxt0.text+=this.attr[i]+(i==this.attr.length-1?"":"\n")}this.background.height=this.attrTxt.textHeight+60;this.group.y=this.group.height/2-this.background.height/2};ForgeTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};ForgeTipsWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};return ForgeTipsWin}(BaseEuiView);__reflect(ForgeTipsWin.prototype,"ForgeTipsWin");ViewManager.ins().reg(ForgeTipsWin,LayerManager.UI_Popup);var ForgeTupoPanel=function(_super){__extends(ForgeTupoPanel,_super);function ForgeTupoPanel(){return _super.call(this)||this}return ForgeTupoPanel}(BaseView);__reflect(ForgeTupoPanel.prototype,"ForgeTupoPanel");var ForgeWin=function(_super){__extends(ForgeWin,_super);function ForgeWin(){var _this=_super.call(this)||this;_this.skinName="forgeskin";_this.isTopLevel=true;return _this}ForgeWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.viewStack.selectedIndex=ForgeWin.Page_Select_Boost;this.tab.dataProvider=this.viewStack;this.mc=new MovieClip;this.mc.x=240;this.mc.y=400;this.mcList=[];for(var i=0;i<8;i++){var mcp=new MovieClip;mcp.x=240;mcp.y=400;this.mcList.push(mcp)}};ForgeWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.tab.selectedIndex=this.viewStack.selectedIndex=param[0];if(param[1]!=undefined){this.roleSelect.setCurRole(parseInt(param[1]+""))}this.setRoleId(this.roleSelect.getCurRole());this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.closeBtn0,this.onTouch);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.addChangeEvent(this.roleSelect,this.onChange);this.observe(UserForge.ins().postForgeUpdate,this.onEvent);this.observe(ForgeRedPoint.ins().postForgeBoostRedPoint,this.delayRedPoint);this.observe(ForgeRedPoint.ins().postForgeZhulingRedPoint,this.delayRedPoint);this.observe(ForgeRedPoint.ins().postForgeGemRedPoint,this.delayRedPoint);this.observe(ForgeRedPoint.ins().postForgeWeaponRedPoint,this.delayRedPoint)};ForgeWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var num=this.viewStack.numChildren;for(var i=0;i<num;i++){this.viewStack.getChildAt(i).close()}var uiview2=ViewManager.ins().getView(UIView2);if(uiview2)uiview2.closeNav(UIView2.NAV_SMITH);DisplayUtils.removeFromParent(this.mc);for(var i=0;i<8;i++){DisplayUtils.removeFromParent(this.mcList[i])}};ForgeWin.prototype.onTouch=function(e){ViewManager.ins().close(ForgeWin)};ForgeWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex);this.redPointEx()};ForgeWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(e.currentTarget.selectedIndex)){e.preventDefault();return}};ForgeWin.prototype.setOpenIndex=function(selectedIndex,roleChange){var index=0;var role=SubRoles.ins().getSubRoleByIndex(this.roleSelect.getCurRole());var change=true;this.roleSelect.setState("yhead");this.roleSelect.showNormalPower();this.roleSelect.refreshPower(this.roleSelect._curRole);switch(selectedIndex){case ForgeWin.Page_Select_Boost:index=role.getMinEquipIndexByType(0);this.boostPanel.open(index,role.getEquipByIndex(index).strengthen);break;case ForgeWin.Page_Select_Gem:index=role.getMinEquipIndexByType(ForgeWin.Page_Select_Gem);if(Actor.level>=GlobalConfig.StoneOpenConfig[0].openLv){this.gemPanel.open(index,role.getEquipByIndex(index).gem)}else{change=false;UserTips.ins().showTips(i18n("ForgeWin_0")+GlobalConfig.StoneOpenConfig[0].openLv+i18n("ForgeWin_1"))}break;case ForgeWin.Page_Select_ZhuLing:index=role.getMinEquipIndexByType(ForgeWin.Page_Select_ZhuLing);this.zhulingPanel.open(index,role.getEquipByIndex(index).zhuling);break;case ForgeWin.Page_Select_Weapon:var func=function(roleId){var role=SubRoles.ins().getSubRoleByIndex(roleId);var power=role.getWeaponTotalPower();return power};this.roleSelect.showOtherPower(func);this.roleSelect.refreshPower(this.roleSelect._curRole);change=OpenSystem.ins().checkSysOpen(SystemType.WEAPONS);if(change){if(roleChange){if(this.weaponsoul.isShowSoul()){this.weaponsoul.open(this.roleSelect.getCurRole(),false)}else{this.weaponsoul.open(this.roleSelect.getCurRole(),true)}}else{this.weaponsoul.open(this.roleSelect.getCurRole(),true)}}else{UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.WEAPONS))}break;case ForgeWin.PageSelectSamsara:this.roleSelect.setState("nohead");break}if(!change)this.tab.selectedIndex=this.viewStack.selectedIndex;if(this.tab.selectedIndex!=this.viewStack.selectedIndex){this.checkAutoBtn()}};ForgeWin.prototype.checkIsOpen=function(index){switch(index){case ForgeWin.Page_Select_Boost:break;case ForgeWin.Page_Select_Gem:if(Actor.level<GlobalConfig.StoneOpenConfig[0].openLv){UserTips.ins().showTips(i18n("ForgeWin_2")+GlobalConfig.StoneOpenConfig[0].openLv+i18n("ForgeWin_3"));return false}break;case ForgeWin.Page_Select_ZhuLing:break;case ForgeWin.Page_Select_Weapon:if(!OpenSystem.ins().checkSysOpen(SystemType.WEAPONS)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.WEAPONS));return false}break}return true};ForgeWin.prototype.checkAutoBtn=function(){if(this.boostPanel.isAutoUp){this.boostPanel.stopAutoUp()}if(this.zhulingPanel.isAutoUp){this.zhulingPanel.stopAutoUp()}};ForgeWin.prototype.onEvent=function(para){var _this=this;var packageID=para[0];var index=para[1];var lastIndex=0;var role=SubRoles.ins().getSubRoleByIndex(this.roleSelect.getCurRole());switch(packageID){case PackageID.strongthen:if(ForgeWin.Page_Select_Boost==this.viewStack.selectedIndex){if(!this.boostPanel.isAutoUp){this.mcList[index].x=index%2*434+40;this.mcList[index].y=Math.floor(index/2)*120+35;this.mcList[index].playFile(RES_DIR_EFF+"forgeSuccess",1);this.boostPanel.itemGroup.addChild(this.mcList[index])}index=role.getMinEquipIndexByType(0);this.boostPanel.changeData(index,role.getEquipByIndex(index).strengthen);this.boostPanel.autoUpBack(index)}break;case PackageID.Gem:break;case PackageID.Zhuling:if(ForgeWin.Page_Select_ZhuLing==this.viewStack.selectedIndex){if(!this.zhulingPanel.isAutoUp){this.mcList[index].x=this.zhulingPanel["kuang"+index].x+this.zhulingPanel["kuang"+index].width/2;this.mcList[index].y=this.zhulingPanel["kuang"+index].y+this.zhulingPanel["kuang"+index].height/2;this.mcList[index].playFile(RES_DIR_EFF+"forgeSuccess",1);this.zhulingPanel.itemGroup.addChild(this.mcList[index])}index=role.getMinEquipIndexByType(ForgeWin.Page_Select_ZhuLing);this.zhulingPanel.changeData(index,role.getEquipByIndex(index).zhuling);this.zhulingPanel.autoUpBack(index)}break}TimerManager.ins().doTimer(200,1,function(){switch(packageID){case PackageID.strongthen:break;case PackageID.Gem:if(ForgeWin.Page_Select_Gem==_this.viewStack.selectedIndex){_this.gemPanel.changeData(index,role.getEquipByIndex(index).gem)}break;case PackageID.Zhuling:break}},this);this.redPointEx()};ForgeWin.prototype.delayRedPoint=function(){if(!TimerManager.ins().isExists(this.redPointEx,this))TimerManager.ins().doTimer(60,1,this.redPointEx,this)};ForgeWin.prototype.redPointEx=function(){var roleRedPoint=[false,false,false];for(var i=0;i<roleRedPoint.length;i++){this.roleSelect.showRedPoint(i,roleRedPoint[i])}for(var i=0;i<4;i++){if(ForgeRedPoint.ins().roleTabs[i]&&this.tab.selectedIndex==i){for(var j=0;j<SubRoles.ins().subRolesLen;j++){this.roleSelect.showRedPoint(j,ForgeRedPoint.ins().roleTabs[i][j]);if(i==ForgeWin.Page_Select_Weapon){if(this.weaponsoul.isShowSoul()){this.roleSelect.showRedPoint(j,ForgeRedPoint.ins().getFlexibleRoleRedPoint(j))}}}}this["redPoint"+i].visible=false;this["redPoint"+i].visible=ForgeRedPoint.ins().getRedPoint(i)}};ForgeWin.prototype.redPoint=function(){var len=SubRoles.ins().subRolesLen;var roleRedPoint=[false,false,false];for(var i=0;i<roleRedPoint.length;i++){this.roleSelect.showRedPoint(i,roleRedPoint[i]);this["redPoint"+i].visible=false}this.redPoint3.visible=false;for(var roleIndex=0;roleIndex<len;roleIndex++){for(var i=0;i<3;i++){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);var index=role.getMinEquipIndexByType(i);var lv=this.getForgeLv(i,role,index);var costNum=this.getForgeIdOrCount(i,lv,0);if(costNum){var goodId=this.getForgeIdOrCount(i,lv,1);var goodsNum=void 0;if(i==ForgeWin.Page_Select_Gem){goodsNum=Actor.soul}else{goodsNum=UserBag.ins().getBagGoodsCountById(0,goodId)}if(goodsNum>=costNum){if(this.tab.selectedIndex==i)this.roleSelect.showRedPoint(roleIndex,true);if(i!=ForgeWin.Page_Select_Gem)this["redPoint"+i].visible=true;else{if(Actor.level>=GlobalConfig.StoneOpenConfig[0].openLv)this["redPoint"+i].visible=true}if(this["redPoint"+i].visible){var r=SubRoles.ins().getSubRoleByIndex(this.roleSelect.getCurRole());this["redPoint"+i].visible=UserForge.ins().isMaxForge(r,i)}}}}var weapRedPoint=Weapons.ins().checkRedPoint(roleIndex);if(!this.redPoint3.visible){this.redPoint3.visible=weapRedPoint}if(this.tab.selectedIndex==ForgeWin.Page_Select_Weapon)this.roleSelect.showRedPoint(roleIndex,weapRedPoint)}};ForgeWin.prototype.getForgeLv=function(type,role,index){switch(type){case ForgeWin.Page_Select_Boost:return role.getEquipByIndex(index).strengthen;case ForgeWin.Page_Select_ZhuLing:return role.getEquipByIndex(index).zhuling;case ForgeWin.Page_Select_Gem:return role.getEquipByIndex(index).gem;case 3:return role.getEquipByIndex(index).tupo}};ForgeWin.prototype.getForgeIdOrCount=function(type,lv,idOCount){switch(type){case ForgeWin.Page_Select_Boost:var boostConfig=UserForge.ins().getEnhanceCostConfigByLv(lv+1);if(boostConfig){if(idOCount)return boostConfig.stoneId;else return boostConfig.stoneNum}break;case ForgeWin.Page_Select_ZhuLing:var zhulingConfig=UserForge.ins().getZhulingCostConfigByLv(lv+1);if(zhulingConfig){if(idOCount)return zhulingConfig.itemId;else return zhulingConfig.count}break;case ForgeWin.Page_Select_Gem:var gemConfig=UserForge.ins().getStoneLevelCostConfigByLv(lv+1);if(gemConfig){if(idOCount)return gemConfig.stoneId;else return gemConfig.soulNum}break;case 3:var tupoConfig=UserForge.ins().getTupoCostConfigByLv(lv+1);if(tupoConfig){if(idOCount)return tupoConfig.itemId;else return tupoConfig.count}break}return 0};ForgeWin.prototype.onChange=function(e){this.setRoleId(this.roleSelect.getCurRole(),true)};ForgeWin.prototype.setRoleId=function(roleId,roleChange){this.boostPanel.curRole=this.gemPanel.curRole=this.zhulingPanel.curRole=roleId;this.setOpenIndex(this.viewStack.selectedIndex,roleChange);this.redPointEx()};ForgeWin.Page_Select_Boost=0;ForgeWin.Page_Select_Gem=1;ForgeWin.Page_Select_ZhuLing=2;ForgeWin.Page_Select_Weapon=3;ForgeWin.PageSelectSamsara=4;return ForgeWin}(BaseEuiView);__reflect(ForgeWin.prototype,"ForgeWin");ViewManager.ins().reg(ForgeWin,LayerManager.UI_Main);var ForgeZhulingPanel=function(_super){__extends(ForgeZhulingPanel,_super);function ForgeZhulingPanel(){var _this=_super.call(this)||this;_this.isMax=false;_this.isAutoUp=false;_this.itemNum=0;_this.startPos=0;_this.name=i18n("ForgeZhulingPanel_0");_this.curPanel=ForgeWin.Page_Select_ZhuLing;return _this}ForgeZhulingPanel.prototype.childrenCreated=function(){this.initUI()};ForgeZhulingPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>")};ForgeZhulingPanel.prototype.open=function(pos,lv){this.addTouchEvent(this.upGradeBtn,this.onTouch);this.addTouchEvent(this.upGradeBtn0,this.onTouch);this.addTouchEvent(this.getItemTxt,this.onGetItem);this.observe(UserBag.ins().postItemAdd,this.setCount);this.observe(UserBag.ins().postItemChange,this.setCount);this.observe(Actor.ins().postLevelChange,this.setView);this.isMax=false;this.setView();this.createBitMapNum();this.changeData(pos,lv);this.stopAutoUp();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.jingDiao)};ForgeZhulingPanel.prototype.close=function(){this.removeTouchEvent(this.upGradeBtn,this.onTouch);this.removeTouchEvent(this.getItemTxt,this.onGetItem);this.removeObserve();this.stopAutoUp();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};ForgeZhulingPanel.prototype.setView=function(){};ForgeZhulingPanel.prototype.onTouch=function(e){switch(e.target){case this.upGradeBtn:if(this.costConfig&&this.itemNum>=this.costConfig.count){UserZhuLing.ins().sendUpGrade(this.curRole,this.pos);SoundUtil.ins().playEffect(SoundUtil.FORGE)}else{UserWarn.ins().setBuyGoodsWarn(this.costConfig.itemId,1)}break;case this.upGradeBtn0:if(!this.isAutoUp){this.isAutoUp=true;this.startPos=this.pos;if(!this.autoUpStarEx()){UserTips.ins().showTips(i18n("ForgeZhulingPanel_1"));this.isAutoUp=false}}break}};ForgeZhulingPanel.prototype.stopAutoUp=function(){this.isAutoUp=false;if(this.upGradeBtn0)this.upGradeBtn0.label=i18n("ForgeZhulingPanel_3");TimerManager.ins().remove(this.autoUpStar,this)};ForgeZhulingPanel.prototype.autoUpBack=function(index){if(this.isAutoUp){var costConfig=UserForge.ins().getZhulingCostConfigByLv(this.lv+1);if(!costConfig)return;if(this.itemNum<costConfig.count){this.isAutoUp=false;UserTips.ins().showTips(i18n("ForgeZhulingPanel_4"));return}if(this.startPos==index){this.isAutoUp=false;return}UserZhuLing.ins().sendUpGrade(this.curRole,index)}};ForgeZhulingPanel.prototype.autoUpStarEx=function(){var costConfig=UserForge.ins().getZhulingCostConfigByLv(this.lv+1);if(!costConfig)return false;if(this.itemNum>=costConfig.count){UserZhuLing.ins().sendUpGrade(this.curRole,this.pos);SoundUtil.ins().playEffect(SoundUtil.FORGE)}else{this.upGradeBtn0.label=i18n("ForgeZhulingPanel_6");return false}return true};ForgeZhulingPanel.prototype.autoUpStar=function(){if(this.costConfig&&this.itemNum>=this.costConfig.count){UserZhuLing.ins().sendUpGrade(this.curRole,this.pos);if(this.pos==7){this.isAutoUp=false;this.upGradeBtn0.label=i18n("ForgeZhulingPanel_7");TimerManager.ins().remove(this.autoUpStar,this)}}else{this.isAutoUp=false;this.upGradeBtn0.label=i18n("ForgeZhulingPanel_8");TimerManager.ins().remove(this.autoUpStar,this)}};ForgeZhulingPanel.prototype.onGetItem=function(e){UserWarn.ins().setBuyGoodsWarn(this.costConfig.itemId,1)};ForgeZhulingPanel.prototype.changeData=function(pos,lv,bool){if(bool===void 0){bool=true}this.pos=pos;this.lv=lv;var attrList=UserForge.ins().countAllBoostAttr(this.curRole,this.curPanel);this.setAttrData(attrList);this.setPower();this.setSlectedInfo();this.updateLevel();if(bool){this.setCount()}};ForgeZhulingPanel.prototype.setPower=function(){var model=SubRoles.ins().getSubRoleByIndex(this.curRole);this._totalPower=model.getForgeTotalPower(this.curPanel);this.powerPanel.setPower(this._totalPower)};ForgeZhulingPanel.prototype.createBitMapNum=function(){for(var i=0;i<UserEquip.FOEGE_MAX;i++){this["level_"+i].text="0"}};ForgeZhulingPanel.prototype.updateLevel=function(){var roleData=SubRoles.ins().getSubRoleByIndex(this.curRole);var equipData=roleData.equipsData;for(var i=0;i<UserEquip.FOEGE_MAX;i++){var level=equipData[i].zhuling;this["level_"+i].visible=level>0?true:false;this["level_"+i].text=level.toString()}};ForgeZhulingPanel.prototype.setSlectedInfo=function(){var roleData=SubRoles.ins().getSubRoleByIndex(this.curRole);var equipData=roleData.equipsData;for(var i=0;i<UserEquip.FOEGE_MAX;i++){this["selectIcon"+i].visible=i==this.pos;if(i==0){}else{this["line"+(i-1)].source=i<=this.pos?"jinglianline1":"jinglianline0";this["jinglianed"+i].visible=i<=this.pos?true:false}}};ForgeZhulingPanel.prototype.setAttrData=function(attrList){var nextConfig;var len=attrList.length;attrList.sort(AttributeData.sortAttribute);for(var i=0;i<4;i++){this["attr"+i].text=len>i?AttributeData.getAttStrByType(attrList[i],.5):""}nextConfig=UserForge.ins().getForgeConfigByPos(this.pos,this.lv+1,this.curPanel);if(nextConfig){this.isMax=false;var addList=UserForge.ins().countAllBoostAttr(this.curRole,this.curPanel,this.pos,true);addList.sort(AttributeData.sortAttribute);for(var i=0;i<4;i++){var str="";if(len>i){var attr=attrList[i];str=this.getAttrByType(addList,attr)}this["arrow"+i].visible=str.length>0;this["addattr"+i].text=str}}else{this.isMax=true;for(var i=0;i<4;i++){this["arrow"+i].visible=false;this["addattr"+i].text=""}}this.maxDesc.visible=this.isMax;this.upInfo.visible=!this.isMax};ForgeZhulingPanel.prototype.setCount=function(){this.costConfig=UserForge.ins().getZhulingCostConfigByLv(this.lv+1);var cost=0;if(this.costConfig){this.itemNum=UserBag.ins().getBagGoodsCountById(0,this.costConfig.itemId);cost=this.costConfig.count}var colorStr="";if(this.itemNum>=cost)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+this.itemNum+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+cost+"</font> ")};ForgeZhulingPanel.prototype.getAttrByType=function(attrs,attr){var len=attrs.length;for(var i=0;i<len;i++){if(attrs[i].type==attr.type&&attrs[i].value!=attr.value){return""+attrs[i].value}}return""};return ForgeZhulingPanel}(BaseEuiView);__reflect(ForgeZhulingPanel.prototype,"ForgeZhulingPanel");var Friends=function(_super){__extends(Friends,_super);function Friends(){var _this=_super.call(this)||this;_this.friendsList=new eui.ArrayCollection;_this.recentList=new eui.ArrayCollection;_this.appList=new eui.ArrayCollection;_this.blackList=new eui.ArrayCollection;_this.inviteMsgList=new eui.ArrayCollection;_this.isDebug=false;_this.inviteMsgListSource=[];_this.chatList={};_this.newMsg={};_this.currentId=-1;_this.sysId=PackageID.Friends;_this.regNetMsg(7,_this.doAddListMsg);_this.regNetMsg(3,_this.doAppList);_this.regNetMsg(4,_this.doBlackList);_this.regNetMsg(13,_this.doChatAdd);_this.regNetMsg(1,_this.doFriendsList);_this.regNetMsg(10,_this.doFriendsStateChange);_this.regNetMsg(14,_this.doRecentChatList);_this.regNetMsg(9,_this.doRemoveListMsg);_this.regNetMsg(2,_this.doRencentList);_this.regNetMsg(11,_this.postSendResult);_this.regNetMsg(15,_this.doFriendsMarryChange);return _this}Friends.ins=function(){return _super.ins.call(this)};Friends.prototype.initLogin=function(){this.sendAppList()};Friends.prototype.log=function(msg){if(this.isDebug)debug.log(msg)};Friends.prototype.sendFriendsList=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};Friends.prototype.sendRecentList=function(){var bytes=this.getBytes(2);this.sendToServer(bytes)};Friends.prototype.sendAppList=function(){var bytes=this.getBytes(3);this.sendToServer(bytes)};Friends.prototype.sendBlackList=function(){var bytes=this.getBytes(4);this.sendToServer(bytes)};Friends.prototype.sendAddFriend=function(userId,userName){if(Actor.level<GlobalConfig.FriendLimit.chatLv){UserTips.ins().showTips(GlobalConfig.FriendLimit.chatLv+i18n("Friends_0"));return}if(this.indexOfBlackList(userId)!=-1){UserTips.ins().showTips(i18n("Friends_1"));return}for(var _i=0,_a=this.blackList.source;_i<_a.length;_i++){var value=_a[_i];var fd=value;if(fd.name==userName){UserTips.ins().showTips(i18n("Friends_2"));return}}var bytes=this.getBytes(5);bytes.writeInt(userId);bytes.writeString(userName);this.sendToServer(bytes)};Friends.prototype.sendAddBlackList=function(userId,userName){if(Actor.level<GlobalConfig.FriendLimit.chatLv){UserTips.ins().showTips(GlobalConfig.FriendLimit.chatLv+i18n("Friends_3"));return}var bytes=this.getBytes(6);bytes.writeInt(userId);bytes.writeString(userName);this.sendToServer(bytes)};Friends.prototype.sendAgreeApp=function(userId,agree){var bytes=this.getBytes(8);bytes.writeInt(userId);bytes.writeByte(agree);this.sendToServer(bytes)};Friends.prototype.sendDelete=function(type,userId){var bytes=this.getBytes(9);bytes.writeByte(type);bytes.writeInt(userId);this.sendToServer(bytes)};Friends.prototype.sendChat=function(userId,str,type){if(type===void 0){type=0}var bytes=this.getBytes(11);bytes.writeInt(userId);bytes.writeString(str);bytes.writeByte(type);this.sendToServer(bytes);ReportData.getIns().reportChat(str,1)};Friends.prototype.sendRecentChat=function(userId){var bytes=this.getBytes(14);bytes.writeInt(userId);this.sendToServer(bytes)};Friends.prototype.doFriendsList=function(bytes){this.paserList(1,bytes);this.postFriendChange()};Friends.prototype.doRencentList=function(bytes){this.paserList(2,bytes);this.postFriendChange()};Friends.prototype.doAppList=function(bytes){this.paserList(3,bytes);this.postFriendChange()};Friends.prototype.doBlackList=function(bytes){this.paserList(4,bytes);this.postFriendChange()};Friends.prototype.doAddListMsg=function(bytes){var type=bytes.readByte();this.paserAddData(type,bytes);this.postFriendChange()};Friends.prototype.doRemoveListMsg=function(bytes){var type=bytes.readByte();var userId=bytes.readInt();this.paserRemoveData(type,userId);this.postFriendChange()};Friends.prototype.doFriendsStateChange=function(bytes){var userId=bytes.readUnsignedInt();var online=bytes.readByte();this.paserOnlineChange(userId,online);this.postFriendChange()};Friends.prototype.postSendResult=function(bytes){var result=bytes.readByte();if(result==0){var userId=bytes.readUnsignedInt();var date=bytes.readInt();var msg=bytes.readString();var extendType=bytes.readInt();this.paserChatMsg(1,userId,date,msg,extendType,bytes);this.postFriendChange()}else if(result==1){UserTips.ins().showDownTips(i18n("Chat_9"))}return result};Friends.prototype.doChatAdd=function(bytes){var userId=bytes.readUnsignedInt();var date=bytes.readInt();var msg=bytes.readString();var extendType=bytes.readInt();this.paserChatMsg(0,userId,date,msg,extendType,bytes);if(msg.match(i18n("Friends_5"))){this.postFriendInviteTeam(0,userId,date,msg)}this.postFriendChange()};Friends.prototype.doRecentChatList=function(bytes){this.paserRecentMsg(bytes);this.postFriendChange()};Friends.prototype.doFriendsMarryChange=function(bytes){var userId=bytes.readUnsignedInt();var married=bytes.readByte();this.paserMarryChange(userId,married);this.postFriendChange()};Friends.prototype.postFriendChange=function(){return 0};Friends.prototype.postFriendInviteTeam=function(type,userId,date,msg){this.inviteMsg=msg;var idxFriend=this.indexOfFriendList(userId);var fd;var md;if(idxFriend>-1){fd=this.friendsList.getItemAt(idxFriend);md=new FriendData(1);md.id=Actor.actorID;md.job=SubRoles.ins().getSubRoleByIndex(0).job;md.sex=SubRoles.ins().getSubRoleByIndex(0).sex;md.power=Actor.power}var inviteMsgChatData=new ChatData(fd,md,date,msg);this.pushOnlyInviteList(inviteMsgChatData);this.inviteMsgList.source=this.inviteMsgListSource};Friends.prototype.pushOnlyInviteList=function(inviteMsgChatData){for(var item in this.inviteMsgListSource){if(inviteMsgChatData.msg==this.inviteMsgListSource[item].msg){if(inviteMsgChatData.date>=this.inviteMsgListSource[item].date){this.inviteMsgListSource[item]=inviteMsgChatData;return}}else continue}this.inviteMsgListSource.push(inviteMsgChatData)};Friends.prototype.removeInviteMsgListSourceAt=function(msg){var index=0;for(var item in this.inviteMsgListSource){if(msg==this.inviteMsgListSource[item].msg){index=Number(item);break}}this.inviteMsgList.removeItemAt(index);if(this.inviteMsgList.source.length==0)this.postInviteMsgListIsNull()};Friends.prototype.postInviteMsgListIsNull=function(){};Friends.prototype.postCloseFriendList=function(){};Friends.prototype.postChatToFriend=function(friendId){return friendId};Friends.prototype.indexOfFriendList=function(userId){var rtn=-1;for(var i=0;i<this.friendsList.length;i++){var fd=this.friendsList.getItemAt(i);if(fd&&fd.id==userId){rtn=i;break}}return rtn};Friends.prototype.indexOfBlackList=function(userId){var rtn=-1;for(var i=0;i<this.blackList.length;i++){var fd=this.blackList.getItemAt(i);if(fd&&fd.id==userId){rtn=i;break}}return rtn};Friends.prototype.indexOfRecentList=function(userId){var rtn=-1;for(var i=0;i<this.recentList.length;i++){var fd=this.recentList.getItemAt(i);if(fd&&fd.id==userId){rtn=i;break}}return rtn};Friends.prototype.indexOfAppList=function(userId){var rtn=-1;for(var i=0;i<this.appList.length;i++){var fd=this.appList.getItemAt(i);if(fd&&fd.id==userId){rtn=i;break}}return rtn};Friends.prototype.sortRecentList=function(){};Friends.prototype.sortFriendList=function(){var source=this.friendsList.source;var sourceOnline=[];var sourceOffline=[];source.forEach(function(element){if(element.online==1){sourceOnline.push(element)}else{sourceOffline.push(element)}});sourceOnline.sort(function(a,b){if(b.zs!=a.zs)return b.zs-a.zs;return b.lv-a.lv});sourceOffline.sort(function(a,b){if(b.zs!=a.zs)return b.zs-a.zs;return b.lv-a.lv});source=sourceOnline.concat(sourceOffline);this.friendsList.replaceAll(source)};Friends.prototype.sortAppList=function(){var source=this.appList.source;source.sort(function(a,b){return b.power-a.power});this.appList.replaceAll(source)};Friends.prototype.paserList=function(type,bytes){var source=[];var len=bytes.readInt();for(var i=0;i<len;i++){var fd=new FriendData(type,bytes);source.push(fd)}switch(type){case 1:this.friendsList.source=source;this.sortFriendList();break;case 2:this.recentList.source=source;this.sortRecentList();break;case 3:if(source.length>Friends.MAXNUM)source=source.slice(source.length-Friends.MAXNUM,Friends.MAXNUM);this.appList.source=source;this.sortAppList();break;case 4:this.blackList.replaceAll(source);break}};Friends.prototype.paserAddData=function(type,bytes){var fd=new FriendData(type,bytes);var listName=["friendsList","recentList","appList","blackList"][type-1];var idx=-1;if(type==1){idx=this.indexOfFriendList(fd.id)}else if(type==2){idx=this.indexOfRecentList(fd.id)}else if(type==3){idx=this.indexOfAppList(fd.id)}else if(type==4){idx=this.indexOfBlackList(fd.id);this.paserRemoveData(1,fd.id);this.paserRemoveData(2,fd.id);this.paserRemoveData(3,fd.id);Chat.ins().removeChatWithId(fd.id);Guild.ins().removeMsgWithId(fd.id)}if(this[listName]&&type!=2){if(idx>-1){this[listName].replaceItemAt(fd,idx)}else{this[listName].addItemAt(fd,0)}}this.sortFriendList();this.sortRecentList();this.sortAppList()};Friends.prototype.paserRemoveData=function(type,userId){var listName=["friendsList","recentList","appList","blackList"][type-1];var idx=-1;if(this[listName]){if(type==1){idx=this.indexOfFriendList(userId);this.newMsg[userId]=false}else if(type==2){idx=this.indexOfRecentList(userId);this.newMsg[userId]=false}else if(type==3){idx=this.indexOfAppList(userId)}else if(type==4){idx=this.indexOfBlackList(userId)}if(idx>-1){this[listName].removeItemAt(idx)}}};Friends.prototype.paserOnlineChange=function(userId,online){var idx=this.indexOfFriendList(userId);if(idx>-1){var fd=this.friendsList.getItemAt(idx);if(fd.id==userId){fd.online=online;if(fd.online==0){this.friendsList.replaceItemAt(fd,idx)}else{this.friendsList.removeItemAt(idx);this.friendsList.addItemAt(fd,0)}}}};Friends.prototype.paserMarryChange=function(userId,married){var idx=this.indexOfFriendList(userId);if(idx>-1){var fd=this.friendsList.getItemAt(idx);if(fd.id==userId){fd.married=married}}};Friends.prototype.paserChatMsg=function(type,userId,date,msg,extendType,bytes){if(this.indexOfBlackList(userId)>-1){return}if(type==0&&this.currentId!=userId){this.newMsg[userId]=true}var idxFriend=this.indexOfFriendList(userId);if(idxFriend>-1){var fd=this.friendsList.getItemAt(idxFriend);var md=new FriendData(1);md.id=Actor.actorID;md.job=SubRoles.ins().getSubRoleByIndex(0).job;md.sex=SubRoles.ins().getSubRoleByIndex(0).sex;md.power=Actor.power;if(type==0){fd.addChat(new ChatData(fd,md,date,msg,extendType,bytes))}else if(type==1){fd.addChat(new ChatData(md,fd,date,msg,extendType,bytes))}}var idxRecent=this.indexOfRecentList(userId);if(idxRecent>-1){var fd=this.recentList.getItemAt(idxRecent);fd.lastMsg=msg;this.recentList.removeItemAt(idxRecent);this.recentList.addItemAt(fd,0)}else if(idxFriend>-1){var fd=this.friendsList.getItemAt(idxFriend);fd.lastMsg=msg;this.recentList.addItemAt(fd,0)}else{debug.log(i18n("Friends_4"));debug.log("id:"+userId+"/ msg:"+msg)}this.sortFriendList();this.sortRecentList();this.sortAppList()};Friends.prototype.paserRecentMsg=function(bytes){var len=bytes.readByte();for(var i=0;i<len;i++){var userId=bytes.readByte();var date=bytes.readInt();var msg=bytes.readString();if(this.indexOfBlackList(userId)==-1){for(var n=0;i<this.recentList.length;i++){var fd=this.recentList.getItemAt(n);if(fd.id==userId){fd.lastMsg=msg;fd.offLineSec=date;break}}}}};Friends.prototype.getFriendIndex=function(id){var index=0;while(true){var data=this.friendsList.getItemAt(index);if(!data)return-1;if(data.id==id)return index;index++}};Friends.prototype.FriendsInviteMsgDel=function(str){if(str&&str.indexOf("|E:")>=0){var index=str.indexOf("|E:");str=str.slice(index+3,Number.MAX_VALUE);var list=void 0;if(str.indexOf(",")>=0)list=str.split(",");else if(str.indexOf("*")>=0)list=str.split("*");if(!list||list.length<=0)return;switch(list[0]){case"1":UserFb.ins().sendEnterTFRoom(+list[1]);break}}};Friends.MAXNUM=100;Friends.CLOSS_FRIEND_LIST_BUTTON="CLOSS_FRIEND_LIST_BUTTON";return Friends}(BaseSystem);__reflect(Friends.prototype,"Friends");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.friends=Friends.ins.bind(Friends)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var FriendData=function(){function FriendData(type,bytes){if(bytes===void 0){bytes=null}this._offLineSec=0;this.married=0;this.appDate=0;this._redPoint=false;this.msgMaxLen=50;this.lastMsg="";this.lastMsgDate=0;this.lastMsgData_local=0;this.type=type;if(bytes){this.id=bytes.readUnsignedInt();this.name=bytes.readString();this.guildName=bytes.readString();this.online=bytes.readUnsignedByte();this.job=bytes.readUnsignedByte();this.sex=bytes.readUnsignedByte();this.vip=bytes.readUnsignedByte();this.lv=bytes.readUnsignedByte();this.zs=bytes.readUnsignedByte();this.monthCard=bytes.readUnsignedByte();this.ladderLv=bytes.readUnsignedByte();this.isLastWeekLadder=bytes.readUnsignedByte();this.power=bytes.readInt();switch(type){case 1:var n=bytes.readInt()||0;this.offLineSec=n;break;case 2:this.lastMsgDate=bytes.readInt();break;case 3:var d=bytes.readInt()||0;this.appDate=d;break;case 4:break}this.married=bytes.readUnsignedByte()}}Object.defineProperty(FriendData.prototype,"offLineSec",{get:function(){var rtn=0;try{var nowTs=Date.now()/1e3;rtn=Math.floor(this._offLineSec+(nowTs-this._updateTs))}catch(e){debug.log(i18n("FriendData_0"));debug.log(e)}return rtn},set:function(value){this._offLineSec=value;this._updateTs=Date.now()/1e3},enumerable:true,configurable:true});Object.defineProperty(FriendData.prototype,"redPoint",{get:function(){var rtn=this._redPoint;this._redPoint=false;return rtn},enumerable:true,configurable:true});Object.defineProperty(FriendData.prototype,"acMsg",{get:function(){if(Friends.ins().chatList[this.id]==null){Friends.ins().chatList[this.id]=new eui.ArrayCollection}return Friends.ins().chatList[this.id]},set:function(value){Friends.ins().chatList[this.id]=value},enumerable:true,configurable:true});FriendData.prototype.addChat=function(data){var self=this;this._redPoint=data.fromActor.id==this.id;if(this.acMsg.length==0){data.showDate=true}else{for(var i=self.acMsg.length-1;i>=0;--i){var oldData=self.acMsg.getItemAt(i);if(data.date-oldData.date>300){data.showDate=true}if(oldData.showDate){break}}}self.acMsg.addItem(data);self.lastMsgData_local=Date.now();if(self.acMsg.length>this.msgMaxLen){self.acMsg.removeItemAt(0)}};return FriendData}();__reflect(FriendData.prototype,"FriendData");var ChatData=function(){function ChatData(fromActor,toActor,date,msg,extendType,bytes){this.date=0;this.msg="";this.extendType=0;this.showDate=false;this.fromActor=fromActor;this.toActor=toActor;this.date=date;this.msg=msg;this.extendType=extendType||ChatData.CHAT_COMMON;if(this.extendType==ChatData.CHAT_CAI_KUANG_HELP_REVENGE){this.data=new MineRecord;this.data.parser(bytes)}}Object.defineProperty(ChatData.prototype,"dateStr",{get:function(){var rtn="";rtn=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(this.date)/1e3,8);rtn=StringUtils.complementByChar(rtn,16);return rtn},enumerable:true,configurable:true});ChatData.CHAT_COMMON=0;ChatData.CHAT_CAI_KUANG_HELP_REVENGE=1;return ChatData}();__reflect(ChatData.prototype,"ChatData");var BlackListWin=function(_super){__extends(BlackListWin,_super);function BlackListWin(){var _this=_super.call(this)||this;_this.name=i18n("BlackListWin_0");return _this}BlackListWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.list_blackList.itemRenderer=BlackListItemRender;this.list_blackList.dataProvider=Friends.ins().blackList;this.observe(Friends.ins().postFriendChange,this.updateView);Friends.ins().sendBlackList();this.updateView()};BlackListWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeObserve();WatcherUtil.removeFromArrayCollection(this.list_blackList.dataProvider);this.list_blackList.dataProvider=null};BlackListWin.prototype.onTap=function(evt){switch(evt.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(BlackListWin);break}};BlackListWin.prototype.updateView=function(){this.label_num.text=+this.list_blackList.dataProvider.length+"/"+GlobalConfig.FriendLimit.blacklistLen;if(this.group_pingbi)this.group_pingbi.visible=Friends.ins().blackList.length==0};return BlackListWin}(BaseComponent);__reflect(BlackListWin.prototype,"BlackListWin");ViewManager.ins().reg(BlackListWin,LayerManager.UI_Main);var FriendBgWin=function(_super){__extends(FriendBgWin,_super);function FriendBgWin(){var _this=_super.call(this)||this;_this.skinName="FriendsWinSkin";_this.isTopLevel=true;_this.tab.dataProvider=_this.viewStack;return _this}FriendBgWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var index=param[0]?param[0]:0;var chatIndex=0;if(index==0){chatIndex=param[1]?param[1]:0}this.viewStack.selectedIndex=index;this.addTouchEvent(this.btnClose,this.onTap);this.addTouchEvent(this.closeBg,this.onTap);this.addChangeEvent(this.tab,this.onTap);Friends.ins().sendFriendsList();this.friendPanel.open();this.friendChatPanel.open(chatIndex);this.friendAppListPanel.open();this.blackListPanel.open();this.mailPanel.open();this.updateRedPoint();this.observe(Friends.ins().postFriendChange,this.updateRedPoint);this.observe(UserMail.ins().postMailDetail,this.updateRedPoint);this.observe(UserMail.ins().postMailData,this.updateRedPoint)};FriendBgWin.prototype.close=function(){_super.prototype.close.call(this);this.friendPanel.close();this.friendChatPanel.close();this.friendAppListPanel.close();this.blackListPanel.close();this.mailPanel.close();WatcherUtil.removeFromArrayCollection(this.tab.dataProvider)};FriendBgWin.prototype.onShowdMailPoint=function(){if(UserMail.ins().mailData){this.mailRedPoint.visible=UserMail.ins().getUnreadMail()>0}else{this.mailRedPoint.visible=false}};FriendBgWin.prototype.updateRedPoint=function(){this.applyRedPoint.visible=Friends.ins().appList.length>0;this.onShowdMailPoint()};FriendBgWin.prototype.onTap=function(e){switch(e.target){case this.closeBg:case this.btnClose:ViewManager.ins().close(this);break;case this.tab:break}};return FriendBgWin}(BaseEuiView);__reflect(FriendBgWin.prototype,"FriendBgWin");ViewManager.ins().reg(FriendBgWin,LayerManager.UI_Popup);var FriendChatPanel=function(_super){__extends(FriendChatPanel,_super);function FriendChatPanel(){var _this=_super.call(this)||this;_this.name=i18n("FriendChatPanel_0");return _this}FriendChatPanel.prototype.childrenCreated=function(){this.listFriend.dataProvider=null;this.listChat.dataProvider=null;this.listFriend.itemRenderer=FriendHeadItem;this.listChat.itemRenderer=FriendsChatItemRender};FriendChatPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}Friends.ins().sendFriendsList();Friends.ins().sendRecentList();this.listFriend.selectedIndex=param[0]?param[0]:0;this.addChangeEvent(this.listFriend,this.onChange);this.addTouchEvent(this.btnSend,this.onTap);this.observe(Friends.ins().postFriendChange,this.updateView);this.observe(Friends.ins().postChatToFriend,this.updateView);this.addTouchEvent(this.listChat,this.onListTap);this.onChange()};FriendChatPanel.prototype.close=function(){this.removeTouchEvent(this.listChat,this.onListTap);WatcherUtil.removeFromArrayCollection(this.listChat.dataProvider);WatcherUtil.removeFromArrayCollection(this.listFriend.dataProvider);this.listFriend.dataProvider=null;this.listChat.dataProvider=null;this.$onClose()};FriendChatPanel.prototype.onListTap=function(){var selectedItem=this.listChat.selectedItem;if(!selectedItem||!(selectedItem instanceof ChatData))return;if(selectedItem.extendType==ChatData.CHAT_CAI_KUANG_HELP_REVENGE){ViewManager.ins().open(MineRobWin,selectedItem);return}var str=selectedItem.msg;if(str&&str.indexOf("|E:")>=0)this.onLink(str)};FriendChatPanel.prototype.onLink=function(str){var index=str.indexOf("|E:");str=str.slice(index+3,Number.MAX_VALUE);var list;if(str.indexOf(",")>=0)list=str.split(",");else if(str.indexOf("*")>=0)list=str.split("*");if(!list||list.length<=0)return;switch(list[0]){case"1":UserFb.ins().sendEnterTFRoom(+list[1]);break;case"4":ViewManager.ins().close(FriendBgWin);ViewManager.ins().open(MarriedMainWin,+list[1]);break}};FriendChatPanel.prototype.updateView=function(){this.listFriend.dataProvider=Friends.ins().friendsList;var data=this.listFriend.selectedItem;if(data){this.currentState="chat";var idx=Friends.ins().indexOfFriendList(data.id);if(this.listChat.dataProvider){WatcherUtil.removeFromArrayCollection(this.listChat.dataProvider)}this.listChat.dataProvider=Friends.ins().friendsList.getItemAt(idx).acMsg;this.scroller.viewport.validateNow();if(this.scroller.viewport.contentHeight>this.scroller.height){this.scroller.viewport.scrollV=this.scroller.viewport.contentHeight-this.scroller.height}}else{this.currentState="nofriend"}};FriendChatPanel.prototype.onChange=function(){this.updateView();var data=this.listFriend.selectedItem;if(data)Friends.ins().sendRecentChat(data.id)};FriendChatPanel.prototype.onTap=function(e){switch(e.target){case this.btnSend:var data=this.listFriend.selectedItem;if(!data)return;if(Actor.level<GlobalConfig.FriendLimit.chatLv){UserTips.ins().showTips(GlobalConfig.FriendLimit.chatLv+i18n("FriendChatPanel_2"))}else if(this.input.text.length>GlobalConfig.FriendLimit.contentLimit){UserTips.ins().showTips(i18n("FriendChatPanel_3"))}else if(this.input.text.length>0){Friends.ins().sendChat(data.id,this.input.text+"");this.input.text=""}break}};return FriendChatPanel}(BaseComponent);__reflect(FriendChatPanel.prototype,"FriendChatPanel");var FriendListPanel=function(_super){__extends(FriendListPanel,_super);function FriendListPanel(){var _this=_super.call(this)||this;_this.name=i18n("FriendListPanel_0");return _this}FriendListPanel.prototype.childrenCreated=function(){this.list.itemRenderer=FriendListItemRender};FriendListPanel.prototype.open=function(){this.updateView();this.readMsg();this.addTouchEvent(this.btnFind,this.onTap)};FriendListPanel.prototype.readMsg=function(){for(var key in Friends.ins().newMsg){Friends.ins().newMsg[key]=false}};FriendListPanel.prototype.close=function(){this.$onClose();WatcherUtil.removeFromArrayCollection(this.list.dataProvider);this.list.dataProvider=null};FriendListPanel.prototype.updateView=function(){this.list.dataProvider=Friends.ins().friendsList};FriendListPanel.prototype.onTap=function(e){switch(e.target){case this.btnFind:ViewManager.ins().open(FriendsAddWin);break}};return FriendListPanel}(BaseComponent);__reflect(FriendListPanel.prototype,"FriendListPanel");var FriendsAddWin=function(_super){__extends(FriendsAddWin,_super);function FriendsAddWin(){var _this=_super.call(this)||this;_this.skinName="FriendsAddWinSkin";return _this}FriendsAddWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btn_add,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.shadow,this.onTap);this.observe(Friends.ins().postFriendChange,this.updateView)};FriendsAddWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};FriendsAddWin.prototype.onTap=function(evt){switch(evt.target){case this.closeBtn0:ViewManager.ins().close(FriendsAddWin);break;case this.btn_add:if(this.editText_name.text==Actor.myName){UserTips.ins().showTips(i18n("FriendsAddWin_0"));return}if(this.editText_name.text!=""){Friends.ins().sendAddFriend(0,this.editText_name.text)}ViewManager.ins().close(FriendsAddWin);break;case this.shadow:ViewManager.ins().close(this);break}};FriendsAddWin.prototype.updateView=function(){};return FriendsAddWin}(BaseEuiView);__reflect(FriendsAddWin.prototype,"FriendsAddWin");ViewManager.ins().reg(FriendsAddWin,LayerManager.UI_Popup);var FriendsAppListWin=function(_super){__extends(FriendsAppListWin,_super);function FriendsAppListWin(){var _this=_super.call(this)||this;_this.panelList=[];_this.name=i18n("FriendsAppListWin_0");return _this}FriendsAppListWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btn_allNo,this.onTap);this.addTouchEvent(this.btn_allYes,this.onTap);this.list_appList.itemRenderer=FriendAppListItemRender;this.list_appList.dataProvider=Friends.ins().appList;this.observe(Friends.ins().postFriendChange,this.updateView);this.updateView();this.panelList=Friends.ins().appList.source};FriendsAppListWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.btn_allNo,this.onTap);this.removeTouchEvent(this.btn_allYes,this.onTap);this.removeObserve();WatcherUtil.removeFromArrayCollection(this.list_appList.dataProvider);this.list_appList.dataProvider=null};FriendsAppListWin.prototype.onTap=function(evt){switch(evt.target){case this.btn_allYes:for(var _i=0,_a=this.panelList;_i<_a.length;_i++){var item=_a[_i];Friends.ins().sendAgreeApp(item.id,1)}break;case this.btn_allNo:for(var _b=0,_c=this.panelList;_b<_c.length;_b++){var item=_c[_b];Friends.ins().sendAgreeApp(item.id,0)}break}};FriendsAppListWin.prototype.updateView=function(){if(this.group_shenqing)this.group_shenqing.visible=Friends.ins().appList.length==0};return FriendsAppListWin}(BaseComponent);__reflect(FriendsAppListWin.prototype,"FriendsAppListWin");ViewManager.ins().reg(FriendsAppListWin,LayerManager.UI_Main);var BlackListItemRender=function(_super){__extends(BlackListItemRender,_super);function BlackListItemRender(){return _super.call(this)||this}BlackListItemRender.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this);this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){Friends.ins().sendDelete(4,_this.data.id);e.stopPropagation();e.stopImmediatePropagation()},this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(_this.data)ViewManager.ins().open(PlayerTipsWin,_this.data)},this)};BlackListItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.label_name.text=data.name+"("+(data.zs>0?data.zs+i18n("BlackListItemRender_0"):"")+data.lv+i18n("BlackListItemRender_1");var job=fixJob(data.job);var sex=fixSex(data.sex);this.img_userIcon.source="head_"+job+sex+(data.online==1?"":"b");this.labelGuild.text=data.guildName;this.headBg.source=ChatListItemRenderer.HEAD_BG[data.sex]};return BlackListItemRender}(BaseItemRender);__reflect(BlackListItemRender.prototype,"BlackListItemRender");var FriendAppListItemRender=function(_super){__extends(FriendAppListItemRender,_super);function FriendAppListItemRender(){var _this=_super.call(this)||this;_this.skinName="FriendsAppListItemSkin";return _this}FriendAppListItemRender.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this);this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){Friends.ins().sendAgreeApp(_this.data.id,1);e.stopPropagation();e.stopImmediatePropagation()},this);this.btn_no.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){Friends.ins().sendAgreeApp(_this.data.id,0);e.stopPropagation();e.stopImmediatePropagation()},this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(_this.data)ViewManager.ins().open(PlayerTipsWin,_this.data)},this)};FriendAppListItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.label_name.text=data.name+"("+(data.zs>0?data.zs+i18n("FriendAppListItemRender_0"):"")+data.lv+i18n("FriendAppListItemRender_1");var job=fixJob(data.job);var sex=fixSex(data.sex);this.img_userIcon.source="head_"+job+sex;this.labelGuild.text=data.guildName;var num_0=Math.floor(data.vip/10)||0;var num_1=data.vip%10||0;if(num_0){this.img_vipLv0.source="xvip_4"+num_0+"_png"}else{this.img_vipLv0.source=null}this.img_vipLv1.source="xvip_4"+num_1+"_png";this.headBg.source=ChatListItemRenderer.HEAD_BG[data.sex]};return FriendAppListItemRender}(BaseItemRender);__reflect(FriendAppListItemRender.prototype,"FriendAppListItemRender");var FriendHeadItem=function(_super){__extends(FriendHeadItem,_super);function FriendHeadItem(){return _super.call(this)||this}FriendHeadItem.prototype.dataChanged=function(){var data=this.data;this.label_name.text=data.name;var job=fixJob(data.job);var sex=fixSex(data.sex);this.img_userIcon.source="head_"+job+sex;this.imgBg.source=ChatListItemRenderer.HEAD_BG[data.sex]};return FriendHeadItem}(BaseItemRender);__reflect(FriendHeadItem.prototype,"FriendHeadItem");var FriendListItemRender=function(_super){__extends(FriendListItemRender,_super);function FriendListItemRender(){var _this=_super.call(this)||this;_this.skinName="FriendsItemSkin";return _this}FriendListItemRender.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this);if(!this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){MessageCenter.ins().removeAll(_this)},this)}this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){Friends.ins().postChatToFriend(_this.data.id);e.stopPropagation();e.stopImmediatePropagation()},this);this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){WarnWin.show(i18n("FriendListItemRender_0",_this.data.name),function(){Friends.ins().sendDelete(1,_this.data.id)},_this);e.stopPropagation();e.stopImmediatePropagation()},this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(_this.data)ViewManager.ins().open(PlayerTipsWin,_this.data)},this)};FriendListItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.label_name.text=data.name+"("+(data.zs>0?data.zs+i18n("FriendListItemRender_1"):"")+data.lv+i18n("FriendListItemRender_2");this.label_power.text=i18n("FriendListItemRender_3")+data.power;this.labelGuild.text=data.guildName;if(data.online==1){this.label_lastLogin.text=i18n("FriendListItemRender_4");this.label_lastLogin.textColor=2610714}else{this.label_lastLogin.text=DateUtils.getFormatBySecond(Math.max(data.offLineSec,60),4);this.label_lastLogin.textColor=16579836}var job=fixJob(data.job);var sex=fixSex(data.sex);this.img_userIcon.source="head_"+job+sex+(data.online==1?"":"b");this.headBg.source=ChatListItemRenderer.HEAD_BG[data.sex]};return FriendListItemRender}(BaseItemRender);__reflect(FriendListItemRender.prototype,"FriendListItemRender");var FriendRecentListItemRender=function(_super){__extends(FriendRecentListItemRender,_super);function FriendRecentListItemRender(){return _super.call(this)||this}FriendRecentListItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};FriendRecentListItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.label_name.text=data.name+"("+(data.zs>0?data.zs+i18n("FriendRecentListItemRender_0"):"")+data.lv+i18n("FriendRecentListItemRender_1");this.label_lastChat.text=data.lastMsg;var job=fixJob(data.job);var sex=fixSex(data.sex);this.img_userIcon.source="head_"+job+sex+(data.online==1?"":"b");this.redPoint.visible=Friends.ins().newMsg[data.id]};return FriendRecentListItemRender}(BaseItemRender);__reflect(FriendRecentListItemRender.prototype,"FriendRecentListItemRender");var FriendsChatItemRender=function(_super){__extends(FriendsChatItemRender,_super);function FriendsChatItemRender(){return _super.call(this)||this}FriendsChatItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);if(this.label_msg){this.label_msg.wordWrap=false}};FriendsChatItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;var nameColor;var textColor;if(data.fromActor.id==Actor.actorID){data.fromActor.name=Actor.myName;nameColor="0x15F2B9";textColor="0xFFFFFF"}else{nameColor=data.fromActor.sex?"0xFD686F":"0x2CC2F8";textColor="0xFFFFFF"}this.label_date.text=data.dateStr;var str=i18n("FriendsChatItemRender_0",nameColor,data.fromActor.name,textColor,data.msg);this.label_msg.textFlow=TextFlowMaker.generateTextFlow1(str)};return FriendsChatItemRender}(BaseItemRender);__reflect(FriendsChatItemRender.prototype,"FriendsChatItemRender");var UserFuLi=function(_super){__extends(UserFuLi,_super);function UserFuLi(){var _this=_super.call(this)||this;_this.playNum=0;_this.boxOn=0;_this.addCoefficient=1;_this.exp=0;_this.boxInfo=0;_this.baoji=0;_this.isOpen=[];_this.sysId=PackageID.moneyTree;_this.regNetMsg(1,_this.doMoneyTreeInfo);_this.regNetMsg(2,_this.doPalyBack);_this.regNetMsg(3,_this.doGetRewardBack);return _this}UserFuLi.ins=function(){return _super.ins.call(this)};UserFuLi.prototype.sendPlayYaoYao=function(){this.sendBaseProto(2)};UserFuLi.prototype.sendGetCaseReward=function(id){var bytes=this.getBytes(3);bytes.writeInt(id);this.sendToServer(bytes)};UserFuLi.prototype.doMoneyTreeInfo=function(bytes){this.playNum=bytes.readUnsignedShort();this.boxOn=bytes.readUnsignedShort();this.addCoefficient=bytes.readUnsignedShort();this.exp=bytes.readUnsignedShort();this.boxInfo=bytes.readInt();this.postMoneyInfoChange()};UserFuLi.prototype.postMoneyInfoChange=function(param){if(param===void 0){param=null}return param};UserFuLi.prototype.doPalyBack=function(bytes){this.playNum=bytes.readUnsignedShort();this.boxOn=bytes.readUnsignedShort();this.addCoefficient=bytes.readUnsignedShort();this.exp=bytes.readUnsignedShort();this.baoji=bytes.readUnsignedShort();this.postMoneyInfoChange([false,this.baoji])};UserFuLi.prototype.doGetRewardBack=function(bytes){this.boxInfo=bytes.readInt();this.postMoneyInfoChange()};UserFuLi.prototype.getOrderByIndex=function(index){if(index===void 0){index=0}var num=this.boxInfo>>index&1;return num};UserFuLi.prototype.getNowCoefficientinfo=function(index){if(index===void 0){index=0}var config=GlobalConfig.CashCowAmplitudeConfig;for(var k in config){if(config[k].level==this.addCoefficient+index){return config[k]}}return null};Object.defineProperty(UserFuLi.prototype,"maxNum",{get:function(){return this.checkCashCowBasicLenght(10)},enumerable:true,configurable:true});Object.defineProperty(UserFuLi.prototype,"cruMaxNum",{get:function(){return this.checkCashCowBasicLenght()},enumerable:true,configurable:true});UserFuLi.prototype.getIndexCost=function(){var config=GlobalConfig.CashCowBasicConfig;for(var k in config){if(config[k].time==this.boxOn+1){return config[k]}}return null};UserFuLi.prototype.getBoxInfoByIndex=function(index){var config=GlobalConfig.CashCowBoxConfig;for(var k in config){if(config[k].index==index){return config[k]}}return null};UserFuLi.prototype.checkCashCowBasicLenght=function(lv){if(lv===void 0){lv=0}if(lv==0){lv=UserVip.ins().lv}var config=GlobalConfig.CashCowLimitConfig;for(var k in config){if(config[k].vip==lv){return config[k].maxTime}}return 0};UserFuLi.prototype.checkBoxIsCanget=function(index){var data=this.getBoxInfoByIndex(index);if(data.time<=this.playNum){if(this.getOrderByIndex(index-1)<=0){return true}}return false};return UserFuLi}(BaseSystem);__reflect(UserFuLi.prototype,"UserFuLi");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userfuli=UserFuLi.ins.bind(UserFuLi)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UserFuLiHongbao=function(_super){__extends(UserFuLiHongbao,_super);function UserFuLiHongbao(){var _this=_super.call(this)||this;_this.DailySysOpen=0;_this.curCount=0;_this.nearGetTimes=0;_this.nearNormalValue=0;_this.nearGetRechargeValue=0;_this.curDayRecharge=0;_this.curEnvelope=0;_this.curDayRechargeSuccess=0;_this.logs=[];_this.lastLeftTime=0;_this.getLeftTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(UserFuLiHongbao.ins().nearGetTimes+GlobalConfig.DailyRedEnvelope.cd)-GameServer.serverTime)/1e3);return 0>=t&&(t=0),t};_this.IsNormalGet=function(){return UserFuLiHongbao.ins().IsCount()&&UserFuLiHongbao.ins().getLeftTime()==0};_this.IsExtraGet=function(){return this.curDayRecharge&&!this.curDayRechargeSuccess};_this.IsEnvelope=function(){if(this.IsCount()){if(this.getLeftTime()==0){return true}}return false};_this.sysId=PackageID.FuliHongbao;_this.regNetMsg(3,_this.doDailyEnvelopeInfo);_this.regNetMsg(4,_this.doDailyEnvelopeLogs);return _this}UserFuLiHongbao.ins=function(){return _super.ins.call(this)};UserFuLiHongbao.prototype.doDailyEnvelopeInfo=function(bytes){this.DailySysOpen=bytes.readByte();this.curCount=bytes.readByte();this.nearGetTimes=bytes.readInt();this.nearNormalValue=bytes.readInt();this.nearGetRechargeValue=bytes.readInt();this.curDayRecharge=bytes.readByte();this.curEnvelope=bytes.readByte();this.curDayRechargeSuccess=bytes.readByte();this.lastLeftTime=this.getLeftTime();this.postDailyEnvelopeInfo();TimerManager.ins().remove(this.checkLeftTime,this);TimerManager.ins().doTimer(1e4,0,this.checkLeftTime,this)};UserFuLiHongbao.prototype.checkLeftTime=function(){var leftTime=this.getLeftTime();if(this.lastLeftTime>0&&leftTime<=0){this.postLeftTimeZero()}this.lastLeftTime=leftTime};UserFuLiHongbao.prototype.postLeftTimeZero=function(){};UserFuLiHongbao.prototype.postDailyEnvelopeInfo=function(){};UserFuLiHongbao.prototype.doDailyEnvelopeLogs=function(bytes){var count=bytes.readShort();var logs=[];for(var i=0;i<count;++i){logs.push({name:bytes.readString(),value:bytes.readInt()})}this.logs=logs;this.postDailyEnvelopeLogs()};UserFuLiHongbao.prototype.postDailyEnvelopeLogs=function(){};UserFuLiHongbao.prototype.sendDailyEnvelope=function(type){var bytes=this.getBytes(5);bytes.writeByte(type);this.sendToServer(bytes)};UserFuLiHongbao.prototype.sendDailyEnvelopeLogs=function(){this.sendBaseProto(6)};UserFuLiHongbao.prototype.openCheck=function(){if(!UserFuLiHongbao.ins().DailySysOpen)return UserTips.ins().showTips(i18n("UserFuLiHongbao_0")),false;if(!UserFuLiHongbao.ins().checkLvOpen()){var t=Math.floor(GlobalConfig.DailyRedEnvelope.openZslv/1e3),e=GlobalConfig.DailyRedEnvelope.openZslv%1e3;return UserTips.ins().showTips(t+i18n("UserFuLiHongbao_1")+e+i18n("UserFuLiHongbao_2")),false}return true};UserFuLiHongbao.prototype.isShowRedPoint=function(){return this.checkSysOpen()&&!this.curDayRechargeSuccess};UserFuLiHongbao.prototype.canShowIcon=function(){return this.checkSysOpen()&&(this.IsNormalGet()||this.IsExtraGet())};UserFuLiHongbao.prototype.checkSysOpen=function(){return this.DailySysOpen&&this.checkLvOpen()?true:false};UserFuLiHongbao.prototype.checkLvOpen=function(){var t=Math.floor(GlobalConfig.DailyRedEnvelope.openZslv/1e3),e=GlobalConfig.DailyRedEnvelope.openZslv%1e3;return UserZs.ins().lv>=t&&Actor.level>=e};UserFuLiHongbao.prototype.IsCount=function(){return this.curCount<GlobalConfig.DailyRedEnvelope.lottery?true:false};return UserFuLiHongbao}(BaseSystem);__reflect(UserFuLiHongbao.prototype,"UserFuLiHongbao");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userFuliHongbao=UserFuLiHongbao.ins.bind(UserFuLiHongbao)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var FuliWin=function(_super){__extends(FuliWin,_super);function FuliWin(){var _this=_super.call(this)||this;_this.skinName="FuliMainSkin";_this.isTopLevel=true;return _this}FuliWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.iconList.itemRenderer=FuliActBtnRenderer;this.allPanelsObj=[DailyCheckInPanel,FuliHongbaoPanel,SevenDayLogWin,LevelupRewardsPanel,MonthCardWin,FranchiseWin,TimeCardWin,GameNoticePanle,CdkeyPanle];this.allPanels=[];this.initAllPanels();this.panels=[];this.arrList=new eui.ArrayCollection};FuliWin.prototype.open=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addChangeEvent(this.listBar,this.onChange);this.addChangeEvent(this.iconList,this.onClickMenu);this.observe(Notice.ins().postGameNotice,this.updateMenuList);this.observe(DailyCheckIn.ins().postCheckInData,this.updateMenuList);this.observe(Activity.ins().postSevendayAwardCallback,this.updateMenuList);this.observe(Recharge.ins().postFranchiseInfo,this.updateMenuList);this.observe(Activity.ins().postActivityIsGetAwards,this.updateMenuList);this.observe(LevelupRewardsSys.ins().postRewardsStatus,this.updateMenuList);this.observe(LevelupRewardsSys.ins().postRewardId,this.updateMenuList);this.observe(TimeCardMgr.ins().postInfo,this.updateMenuList);this.observe(UserVip.ins().postVipDailyRewards,this.updateMenuList);this.observe(UserVip.ins().postUpdateVipData,this.updateMenuList);this.observe(TrainGift.ins().postChangeState,this.updateMenuList);this.observe(Notice.ins().postChangeState,this.updateMenuList);this.observe(BaoZang.ins().postChapterData,this.updateMenuList);this.observe(BaoZang.ins().postFuwentaData,this.updateMenuList);this.index=0;if(param[0]&&typeof param[0]=="string"){this.initFunc=function(){var panelToShow=param[0];for(var i=0,c=_this.panels.length;i<c;++i){if(_this.panels[i]==panelToShow){_this.index=i;break}}_this.setScroll(_this.index)}}else if(param[0]&&typeof param[0]=="number"){this.initFunc=function(){var panelToShow=param[0];for(var i=0,c=_this.panels.length;i<c;++i){if(i==param[0]){_this.index=i;break}}_this.setScroll(_this.index)}}else if(param[0]===undefined){this.initFunc=function(){for(var i=0;i<_this._datas.length;i++){var canGet=FuliActBtnRenderer.canGet(_this._datas[i].type);if(canGet){_this.index=i;break}}_this.setScroll(_this.index)}}this.updateMenuList([true],param[1])};FuliWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curPanel.close()};FuliWin.prototype.initAllPanels=function(){var cfg;for(var k in GlobalConfig.WelfareConfig){cfg=GlobalConfig.WelfareConfig[k];this.allPanels.push(cfg.openView[0])}};FuliWin.prototype.updateMenuList=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._datas=[];this.panels=this.allPanels;var change=false;var baoji=0;var cfg;if(param&&param[0]){if(param[0][0])change=param[0][0];if(param[0][1])baoji=param[0][1]}for(var k in GlobalConfig.WelfareConfig){cfg=GlobalConfig.WelfareConfig[k];this._datas.push(cfg)}if(!TrainGift.ins().isOpen()){this.removePanelByType(11)}var isSuccess=true;for(var i in GlobalConfig.LoginRewardsConfig){var config=GlobalConfig.LoginRewardsConfig[i];if((Activity.ins().isAwards>>config.day&1)==0){isSuccess=false;break}}if(isSuccess){this.removePanelByType(2)}if(!UserFuLiHongbao.ins().checkSysOpen()){this.removePanelByType(8)}if(!LevelupRewardsSys.ins().hasRewardLeft()){this.removePanelByType(7)}var isOpen=OpenSystem.ins().checkSysOpen(SystemType.TIMECARD);if(true){this.removePanelByType(9)}if(ChannelMgr.ins().isRechargeHidden()){this.removePanelByType(3);this.removePanelByType(4);this.removePanelByType(5);this.removePanelByType(10)}if(!BaoZang.ins().baoZangIsOpen(BaoZang.TYPE_BZ.chapter)){this.removePanelByType(13)}if(!BaoZang.ins().baoZangIsOpen(BaoZang.TYPE_BZ.fuwenta)){this.removePanelByType(14)}this.arrList.replaceAll(this._datas);if(this.initFunc){this.initFunc();this.initFunc=null}this.iconList.selectedIndex=this.index;this.iconList.dataProvider=this.arrList;if(change){this.curId=this.iconList.selectedIndex;this.updateDetail(param[1])}this.btnNum=this._datas.length;this.onChange()};FuliWin.prototype.removePanelByType=function(type){var cfg;this.panels=[];for(var i=0,j=0;i<this._datas.length;j++){cfg=this._datas[i];if(cfg.type==type){this._datas.splice(i,1)}else{var panel=this.allPanels[this._datas[i].id];if(panel){this.panels.push(panel)}i++}}};FuliWin.prototype.onClickMenu=function(e){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this.curId=this.iconList.selectedIndex;this.index=this.curId;this.updateDetail()};FuliWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};FuliWin.prototype.onChange=function(){};FuliWin.prototype.updateDetail=function(parma){if(this.curPanel){DisplayUtils.removeFromParent(this.curPanel);this.curPanel.close()}var curpanel=this.panels[this.curId];this.curPanel=new window[curpanel];if(!UserFuLi.ins().isOpen[this.curId]){UserFuLi.ins().isOpen[this.curId]=true;this.updateMenuList()}var isShowTimeCardPanel=this.curPanel instanceof TimeCardWin;this.timeCardCurrencyPanel.visible=isShowTimeCardPanel;this.roleSelect.visible=!isShowTimeCardPanel;if(this.curPanel){this.curPanel.left=0;this.curPanel.right=0;this.curPanel.top=0;this.curPanel.bottom=0;this.info.addChild(this.curPanel);this.curPanel.open(parma)}};FuliWin.prototype.setScroll=function(index){if(index===void 0){index=0}var itemWidth=87;var groupWidth=this.listBar.width;var maxWidth=this._datas.length*itemWidth;var maxScrollH=maxWidth-groupWidth;var scrollH=index*87;this.listGroup.scrollH=scrollH<=maxScrollH?scrollH:maxScrollH};FuliWin.prototype.getPanelByClass=function(key){var cls=egret.getDefinitionByName(key);if(cls&&cls instanceof Function&&this.curPanel instanceof cls){return this.curPanel}return null};return FuliWin}(BaseEuiView);__reflect(FuliWin.prototype,"FuliWin");ViewManager.ins().reg(FuliWin,LayerManager.UI_Main);var CdkeyPanle=function(_super){__extends(CdkeyPanle,_super);function CdkeyPanle(){var _this=_super.call(this)||this;_this.skinName="CDkeySkin";_this.input.maxChars=28;return _this}CdkeyPanle.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.sendBtn,this.onTap)};CdkeyPanle.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.sendBtn,this.onTap)};CdkeyPanle.prototype.onTap=function(e){switch(e.currentTarget){case this.sendBtn:CDKey.ins().sendCdkey(this.input.text);break}};return CdkeyPanle}(BaseView);__reflect(CdkeyPanle.prototype,"CdkeyPanle");var Http=function(_super){__extends(Http,_super);function Http(){return _super.call(this)||this}Http.ins=function(){return _super.ins.call(this)};Http.prototype.send=function(paramUrl,resType,method,onComplete,onError,onProgress){var request=new egret.HttpRequest;request.responseType=resType?egret.HttpResponseType.TEXT:egret.HttpResponseType.ARRAY_BUFFER;request.open(paramUrl,method?egret.HttpMethod.GET:egret.HttpMethod.POST);request.once(egret.Event.COMPLETE,onComplete,this);request.once(egret.IOErrorEvent.IO_ERROR,onError?onError:function(){},this);request.once(egret.ProgressEvent.PROGRESS,onProgress?onProgress:function(){},this);request.send()};return Http}(BaseClass);__reflect(Http.prototype,"Http");var FuliHongbaoItemRenderer=function(_super){__extends(FuliHongbaoItemRenderer,_super);function FuliHongbaoItemRenderer(){var _this=_super.call(this)||this;_this.skinName="FuliHongbaoItemSkin";return _this}FuliHongbaoItemRenderer.prototype.dataChanged=function(){var d=this.data;var str=i18n("FuliHongbaoItemRenderer_2")+d["name"]+"|"+i18n("FuliHongbaoItemRenderer_3")+i18n("FuliHongbaoItemRenderer_0")+"|"+i18n("FuliHongbaoItemRenderer_4")+d["value"]+"|"+i18n("FuliHongbaoItemRenderer_5")+i18n("FuliHongbaoItemRenderer_1")+"|";var tf=TextFlowMaker.generateTextFlow1(str);this.label.textFlow=tf};return FuliHongbaoItemRenderer}(BaseItemRender);__reflect(FuliHongbaoItemRenderer.prototype,"FuliHongbaoItemRenderer");var FuliHongbaoPanel=function(_super){__extends(FuliHongbaoPanel,_super);function FuliHongbaoPanel(){var _this=_super.call(this)||this;_this.skinName="FuliHongbaoPanelSkin";return _this}FuliHongbaoPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnQiang,this.onBtnQiang);this.addTouchEvent(this.btnExtraGet,this.onBtnExtraGet);this.refreshLogs();TimerManager.ins().doTimer(1e4,0,this.refreshLogs,this);this.refreshUI();this.observe(UserFuLiHongbao.ins().postDailyEnvelopeLogs,this.updateLogs);this.observe(UserFuLiHongbao.ins().postDailyEnvelopeInfo,this.refreshUI);TimerManager.ins().doTimer(1e3,0,this.refreshTimeTimer,this);this.listHistory.itemRenderer=FuliHongbaoItemRenderer};FuliHongbaoPanel.prototype.refreshUI=function(){var fh=UserFuLiHongbao.ins();this.groupQiang.visible=fh.IsEnvelope();this.groupDetail.visible=!fh.IsEnvelope();this.labelQiangNum.text=(GlobalConfig.DailyRedEnvelope.lottery-fh.curCount).toString();this.labelYuanbao1.text=fh.nearNormalValue.toString();this.labelYuanbao2.text=fh.nearGetRechargeValue.toString();this.btnExtraGet.visible=!fh.curDayRechargeSuccess;this.refreshTime()};FuliHongbaoPanel.prototype.refreshTimeTimer=function(){this.refreshTime();if(UserFuLiHongbao.ins().getLeftTime()==0){this.refreshUI()}};FuliHongbaoPanel.prototype.refreshTime=function(){var lt=UserFuLiHongbao.ins().getLeftTime();var stime=Math.floor(lt/60).toString()+i18n("FuliHongbaoPanel_0")+(lt%60).toString()+i18n("FuliHongbaoPanel_1");this.labelTime.text=stime};FuliHongbaoPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.refreshTimeTimer,this);TimerManager.ins().remove(this.refreshLogs,this)};FuliHongbaoPanel.prototype.onBtnQiang=function(){UserFuLiHongbao.ins().sendDailyEnvelope(2)};FuliHongbaoPanel.prototype.onBtnExtraGet=function(){var fh=UserFuLiHongbao.ins();if(fh.IsExtraGet()){UserFuLiHongbao.ins().sendDailyEnvelope(1)}else{WarnWin.show(i18n("FuliHongbaoPanel_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this)}};FuliHongbaoPanel.prototype.refreshLogs=function(){UserFuLiHongbao.ins().sendDailyEnvelopeLogs()};FuliHongbaoPanel.prototype.updateLogs=function(){var logs=UserFuLiHongbao.ins().logs;this.listHistory.dataProvider=new eui.ArrayCollection(logs)};return FuliHongbaoPanel}(BaseView);__reflect(FuliHongbaoPanel.prototype,"FuliHongbaoPanel");var GameNoticePanle=function(_super){__extends(GameNoticePanle,_super);function GameNoticePanle(){var _this=_super.call(this)||this;_this.DESC_LENGTH=300;_this.skinName="gameNoticeSkin";_this.observe(Notice.ins().postChangeNotice,_this.changeDesc);return _this}GameNoticePanle.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};GameNoticePanle.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.changeDesc();if(UserFuLi.ins().isOpenNotice){UserFuLi.ins().isOpenNotice=false;Notice.ins().postGameNotice();Notice.ins().setNoticeOPen()}this.observe(Activity.ins().postActivityIsGetAwards,this.update);this.addTouchEvent(this,this.onTouch);this.update()};GameNoticePanle.prototype.update=function(){var cfgs=GlobalConfig.WelfareConfig;var cfg=null;for(var k in cfgs){if(cfgs[k].type==5){cfg=cfgs[k]}}this._cfg=cfg;var activity=Activity.ins().getActivityDataById(this._cfg.activityId?this._cfg.activityId:0);if(activity){this.updataReward.visible=true;this.suerBtn.enabled=activity.canReward();this.redPoint.visible=this.suerBtn.enabled;if(activity.getRewardStateById(1)==Activity.Geted){this.yilingqu.visible=true;this.suerBtn.visible=false}else{this.yilingqu.visible=false;this.suerBtn.visible=true}if(!this._collect){this._collect=new ArrayCollection;this.reward.dataProvider=this._collect}this._collect.source=GlobalConfig.ActivityType1Config[this._cfg.activityId][1].rewards}else this.updataReward.visible=false};GameNoticePanle.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();this.removeTouchEvent(this,this.onTouch)};GameNoticePanle.prototype.onTouch=function(e){switch(e.target){case this.suerBtn:Activity.ins().sendReward(this._cfg.activityId,1);break}};GameNoticePanle.prototype.changeDesc=function(){var _this=this;var str=GlobalConfig.HelpInfoConfig[5].text;var strList=str.split("_");this.title.textFlow=TextFlowMaker.generateTextFlow(strList[0]);Notice.ins().getNotice(function(data){_this.desc.textFlow=TextFlowMaker.generateTextFlow(data.notice||strList[1])})};return GameNoticePanle}(BaseView);__reflect(GameNoticePanle.prototype,"GameNoticePanle");var MoneyTreeBoxWin=function(_super){__extends(MoneyTreeBoxWin,_super);function MoneyTreeBoxWin(){var _this=_super.call(this)||this;_this.dataList=[];return _this}MoneyTreeBoxWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="MoneyTreeBoxSkin";this.list.itemRenderer=ItemBase};MoneyTreeBoxWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.sure,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn1,this.onTap);this.index=param[0];var data=UserFuLi.ins().getBoxInfoByIndex(this.index);this.desc.text=i18n("MoneyTreeBoxWin_0")+data.time+i18n("MoneyTreeBoxWin_1");this.creatRewardList(data.box);this.list.dataProvider=new eui.ArrayCollection(this.dataList);this.sure.enabled=UserFuLi.ins().playNum>=data.time};MoneyTreeBoxWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.sure,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn1,this.onTap)};MoneyTreeBoxWin.prototype.creatRewardList=function(count){var item;for(var i=0;i<3;i++){if(!this.dataList[i]){item=new RewardData;item.type=0;item.id=1;this.dataList.push(item)}else{item=this.dataList[i]}item.count=count[i]}};MoneyTreeBoxWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn1:ViewManager.ins().close(this);break;case this.sure:UserFuLi.ins().sendGetCaseReward(this.index);ViewManager.ins().close(this);break}};return MoneyTreeBoxWin}(BaseEuiView);__reflect(MoneyTreeBoxWin.prototype,"MoneyTreeBoxWin");ViewManager.ins().reg(MoneyTreeBoxWin,LayerManager.UI_Main);var MoneyTreePanel=function(_super){__extends(MoneyTreePanel,_super);function MoneyTreePanel(){var _this=_super.call(this)||this;_this.posY=180;_this.skinName="MoneyTreeSkin";_this.mc1=new MovieClip;_this.mc1.x=140;_this.mc1.y=46;_this.mc2=new MovieClip;_this.mc2.x=222;_this.mc2.y=46;_this.mc3=new MovieClip;_this.mc3.x=370;_this.mc3.y=46;_this.expMc=new MovieClip;_this.expMc.x=376;_this.expMc.y=_this.posY;_this.addChildAt(_this.expMc,3);_this.baojiMc=new MovieClip;_this.baojiMc.x=207;_this.baojiMc.y=270;_this.movieExp=new MovieClip;return _this}MoneyTreePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Notice.ins().postGameNotice,this.refushInfo);this.observe(UserFuLi.ins().postMoneyInfoChange,this.refushInfo);this.addTouchEvent(this.goUpBtn,this.onTap);this.addTouchEvent(this.image1,this.onTap);this.addTouchEvent(this.image2,this.onTap);this.addTouchEvent(this.image3,this.onTap);this.addTouchEvent(this.descBtn,this.onTap);this.addTouchEvent(this.expMc,this.onTap);this.refushInfo([true]);this.expMc.playFile(RES_DIR_EFF+"moneytreebar")};MoneyTreePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.goUpBtn,this.onTap);this.removeTouchEvent(this.image1,this.onTap);this.removeTouchEvent(this.image2,this.onTap);this.removeTouchEvent(this.image3,this.onTap);this.removeTouchEvent(this.descBtn,this.onTap)};MoneyTreePanel.prototype.onTap=function(e){switch(e.currentTarget){case this.goUpBtn:if(UserFuLi.ins().playNum>=UserFuLi.ins().cruMaxNum){if(UserVip.ins().lv>=10){UserTips.ins().showTips(i18n("MoneyTreePanel_1"))}else{UserTips.ins().showTips(i18n("MoneyTreePanel_2"))}return}if(Actor.yb>=this.costNum){UserFuLi.ins().sendPlayYaoYao();return}if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("MoneyTreePanel_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("MoneyTreePanel_4"));break;case this.image1:ViewManager.ins().open(MoneyTreeBoxWin,1);break;case this.image2:ViewManager.ins().open(MoneyTreeBoxWin,2);break;case this.image3:ViewManager.ins().open(MoneyTreeBoxWin,3);break;case this.descBtn:ViewManager.ins().open(ZsBossRuleSpeak,6);break;case this.expMc:ViewManager.ins().open(ZsBossRuleSpeak,6);break}};MoneyTreePanel.prototype.refushInfo=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var boo=false;var baoji=0;var model=UserFuLi.ins();var info=model.getIndexCost();var nowAdd=model.getNowCoefficientinfo();var nextAdd=model.getNowCoefficientinfo(1);if(param&&param[0]){if(param[0][0])boo=param[0][0];if(param[0][1])baoji=param[0][1]}if(model.playNum==model.maxNum){}else{this.costNum=info.yuanbao}if(!boo)this.moveExpMc();var value=0;if(nextAdd==null){}else{value=60*(1/-2+1-model.exp/nextAdd.needExp)}this.refushBoxInfo();if(baoji>1){this.baojiMc.playFile(RES_DIR_EFF+"moneytreecrit",1);this.addChild(this.baojiMc)}};MoneyTreePanel.prototype.moveExpMc=function(){this.movieExp.x=189;this.movieExp.y=257;this.movieExp.playFile(RES_DIR_EFF+"moneytreeexp",1);this.addChild(this.movieExp);var t=egret.Tween.get(this.movieExp);t.to({y:180,x:376},420)};MoneyTreePanel.prototype.refushBoxInfo=function(){var model=UserFuLi.ins();for(var i=1;i<4;i++){var mc=this["mc"+i];if(model.checkBoxIsCanget(i)){this.playEffect(mc)}else{if(mc.parent){DisplayUtils.removeFromParent(mc)}}}};MoneyTreePanel.prototype.playEffect=function(mc){mc.playFile(RES_DIR_EFF+"taskBox",100);this.addChild(mc)};MoneyTreePanel.MAXNUMBER=50;return MoneyTreePanel}(BaseView);__reflect(MoneyTreePanel.prototype,"MoneyTreePanel");var NextDayLoginWin=function(_super){__extends(NextDayLoginWin,_super);function NextDayLoginWin(){var _this=_super.call(this)||this;_this.skinName="nextDaySkin";return _this}NextDayLoginWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.sendBtn,this.onTap);this.item.data={count:500,id:2,type:0}};NextDayLoginWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.sendBtn,this.onTap)};NextDayLoginWin.prototype.onTap=function(e){switch(e.currentTarget){case this.sendBtn:if(Activity.ins().nextDayState==1){Activity.ins().sendNextDayReward()}else if(Activity.ins().nextDayState==2){UserTips.ins().showTips(StringUtils.addColor(i18n("NextDayLoginWin_0"),15937822))}else{UserTips.ins().showTips(StringUtils.addColor(i18n("NextDayLoginWin_1"),15937822))}break}};return NextDayLoginWin}(BaseView);__reflect(NextDayLoginWin.prototype,"NextDayLoginWin");var GameLogic=function(_super){__extends(GameLogic,_super);function GameLogic(){var _this=_super.call(this)||this;_this.noticeInfo={};_this.MONSTER_RADIUS=2;_this.MONSTER_LEN=_this.MONSTER_RADIUS*2+1;_this.inSkillPreview=false;_this.currHandle=0;_this.currAttackHandle=0;_this.rPosindex=[];_this.guanqiaId=0;_this.sysId=PackageID.Default;_this.regNetMsg(2,_this.postSubRoleChange);_this.regNetMsg(3,_this.postEnterMap);_this.regNetMsg(4,_this.postCreateOtherEntity);_this.regNetMsg(5,_this.doGoldChange);_this.regNetMsg(8,_this.doSubRoleAtt);_this.regNetMsg(9,_this.postHpChange);_this.regNetMsg(10,_this.doRemoveEntity);_this.regNetMsg(11,_this.doMoveEntity);_this.regNetMsg(12,_this.doStopMoveEntity);_this.regNetMsg(13,_this.doSyncPos);_this.regNetMsg(15,_this.postMpChange);_this.regNetMsg(17,_this.doTips);_this.regNetMsg(18,_this.doFirstRegister);_this.regNetMsg(20,_this.doDieNotice);_this.regNetMsg(21,_this.postGuildChange);_this.regNetMsg(22,_this.postRename);_this.regNetMsg(24,_this.postOtherAttChange);_this.regNetMsg(25,_this.doPaoPao);_this.regNetMsg(26,_this.doNeiGongChange);_this.regNetMsg(27,_this.doSubRoleExtAtt);_this.regNetMsg(31,_this.doFindPath);_this.regNetMsg(32,_this.doBloodNumShow);_this.regNetMsg(33,_this.doChangeTarget);_this.regNetMsg(34,_this.doAddMonsterConfig);_this.regNetMsg(35,_this.doZeroInit);_this.regNetMsg(36,_this.postChangeCamp);_this.regNetMsg(39,_this.postGetFubenMoveEvents);_this.regNetMsg(40,_this.postSendFubenMoveEvents);_this.regNetMsg(252,_this.postCacheProtoList);_this.regNetMsg(255,_this.postHeartbeat);KeyboardUtils.ins().addKeyDown(_this.test,_this);_this.radiusMap=[];var len=_this.MONSTER_RADIUS*2+1;for(var i=0;i<len;i++){_this.radiusMap[i]=[]}return _this}GameLogic.ins=function(){return _super.ins.call(this)};GameLogic.prototype.initLogin=function(){this.sendHeartbeat();this.startHeartbeatCheck()};GameLogic.prototype.sendNewRole=function(job,sex){var bytes=this.getBytes(2);bytes.writeByte(job);bytes.writeByte(sex);this.sendToServer(bytes)};GameLogic.prototype.sendHeartbeat=function(){var _this=this;if(this.heartBeatTimer)return;var f=function(){var bytes=_this.getBytes(255);_this.sendToServer(bytes)};this.heartBeatTimer=new egret.Timer(1e3*15);this.heartBeatTimer.addEventListener(egret.TimerEvent.TIMER,f,this);this.heartBeatTimer.start()};GameLogic.prototype.startHeartbeatCheck=function(){if(this.heartBeatCheckTimer)return;this.heartBeatCheckTimer=new egret.Timer(1e3*30);this.heartBeatCheckTimer.addEventListener(egret.TimerEvent.TIMER,this.checkHeartbeat,this);this.heartBeatCheckTimer.start()};GameLogic.prototype.stopHeartbeatCheck=function(){if(this.heartBeatCheckTimer){this.heartBeatCheckTimer.removeEventListener(egret.TimerEvent.TIMER,this.checkHeartbeat,this);this.heartBeatCheckTimer.stop();this.heartBeatCheckTimer=null}};GameLogic.prototype.checkHeartbeat=function(){if(!GameSocket.ins().svrHeartbeatGot){this.stopHeartbeatCheck();GameSocket.ins().heartbeatFailedReconn()}GameSocket.ins().svrHeartbeatGot=false};GameLogic.prototype.postHeartbeat=function(bytes){GameSocket.ins().onSvrHeartbeat()};GameLogic.prototype.sendGMCommad=function(str){var bytes=this.getBytes(0);bytes.writeString(str);this.sendToServer(bytes)};GameLogic.prototype.postSubRoleChange=function(bytes){SubRoles.ins().doSubRole(bytes)};GameLogic.prototype.postEnterMap=function(bytes){DropHelp.clearDrop();GameMap.parser(bytes);HejiMoreEffPlayer.ins().stop();RoleAI.ins().clear();MonsterSpeak.ins().clear();MineFight.ins().stop();MineData.ins().removeAll();SoundUtil.ins().stopChannels();EntityManager.ins().removeAll();EntityHideBody.ins().changeScene();EntityShowMgr.ins().changeScene();TimerManager.ins().removeAll(GameMap);TimerManager.ins().removeAll(SkillEffPlayer);TimerManager.ins().remove(this.shakeMapView,this);this.gamescene.map.clearAllLayer();this.gamescene.map.changeMap();console.log("===============enterMap: fubenID = "+GameMap.fubenID+", GameMap.fbType = "+GameMap.fbType);if(GameMap.fubenID==0){UserFb.ins().pkGqboss=false;if(Encounter.ins().willBossID){Encounter.ins().createBoss();PlayFun.ins().upDataWillBoss(Encounter.ins().willBossID)}}else if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS){}else{ViewManager.ins().closeTopLevel()}ViewManager.ins().close(BossBloodPanel);ViewManager.ins().close(TargetPlayerBigBloodPanel);GuildWar.ins().getModel().clearGuildWarList();UserBoss.ins().clearWorldBossList();SoundUtil.ins().changeSceneSound();TargetListCC.ins().clear();if(!SoundUtil.WINDOW_OPEN&&(GameMap.lastFbId!=GameMap.fubenID||GameMap.fubenID)){SoundUtil.ins().playEffect(SoundUtil.SCENE)}};GameLogic.prototype.postCreateOtherEntity=function(bytes){var entityType=bytes.readShort();var handle=bytes.readDouble();bytes.position-=10;var model;var target;if(entityType==EntityType.Monster||entityType==EntityType.CollectionMonst){model=new EntityModel;model.parser(bytes)}else if(entityType==EntityType.Role){model=new Role;model.parserBase(bytes);model.parserOtherRole(bytes,true)}else if(entityType==EntityType.LadderPlayer){model=new Role;model.parserBase(bytes);model.parserOtherRole(bytes,false);if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){model.masterHandle=model.handle}}else if(entityType==EntityType.DropItem){model=new CharModel;model.parserBase(bytes);model.parserItemData(bytes)}if(!model){return false}EntityManager.ins().removeByHandle(handle);EntityHideBody.ins().onCreateEntity(model);LoadingTimeoutMgr.ins().beginStep(LoadingTimeoutMgr.STEPID_ROLES_INTO_MAP);target=this.createEntityByModel(model);LoadingTimeoutMgr.ins().endStep(LoadingTimeoutMgr.STEPID_ROLES_INTO_MAP);this.afterCreateOtherEntity(entityType,model,target);return model};GameLogic.prototype.afterCreateOtherEntity=function(entityType,model,target){if(entityType==EntityType.Monster||entityType==EntityType.CollectionMonst){if(GameMap.fbType==UserFb.FB_TYPE_EXP){UserFb.ins().expMonterCount+=1}if(GameMap.sceneInMine()){if(target)target.visible=false}MonsterSpeak.ins().trigger(model.configID,SpeakType.appear)}else if(entityType==EntityType.Role){if(GuildWar.ins().getModel().checkinAppoint()||GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS){if(model.guildID!=Guild.ins().guildID){GuildWar.ins().getModel().changecanPlayList(model.masterHandle)}else{GuildWar.ins().getModel().setMyGuildNum(model.masterHandle)}}if(BattleGround.ins().isPaoDian){if(model.guildID!=Guild.ins().guildID){BattleGround.ins().changecanPlayList(model.masterHandle)}}if(MineFight.ins().isFighting&&target){target.visible=false}}else if(entityType==EntityType.LadderPlayer){if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){UserFb.ins().guideBossPlayerId=model.configID;UserFb.ins().guideBossPlayerJob=model.job;UserFb.ins().guideBossPlayerSex=model.sex;UserFb.ins().guideBossPlayerName=model.name;if(UserFb.ins().guideBossKill==0){UserBoss.ins().postBelongChange(model.masterHandle)}}}};GameLogic.prototype.doGoldChange=function(bytes){var type=bytes.readShort();if(type==1){var newGold=bytes.readNumber();Actor.ins().postGoldChange(newGold)}else if(type==4){var num=bytes.readNumber();Actor.ins().postSoulChange(num)}else if(type==7){Actor.ins().postFeatsChange(bytes.readNumber())}else if(type==9){var oldRune=Actor.runeShatter;Actor.runeShatter=bytes.readNumber();if(Actor.runeShatter-oldRune>0){UserTips.ins().showTips(i18n("GameLogic_0")+i18n("GameLogic_1",Actor.runeShatter-oldRune))}this.postRuneShatter()}else if(type==MoneyConst.piece){var oldValue=Actor.runeExchange;Actor.runeExchange=bytes.readNumber();if(oldValue&&Actor.runeExchange-oldValue>0){UserTips.ins().showTips(i18n("GameLogic_2",Actor.runeExchange-oldValue,RewardData.getCurrencyName(MoneyConst.piece)))}this.postRuneExchange()}else if(type==11){var together=bytes.readNumber();Actor.ins().postUpdateTogeatter(together,1)}else if(type==12){var together=bytes.readNumber();Actor.ins().postUpdateTogeatter(together,2)}else if(type==MoneyConst.weiWang)Actor.ins().postWeiWang(bytes.readNumber());else if(type==MoneyConst.chip){Actor.ins().postChip(bytes.readNumber())}else{var newYb=bytes.readNumber();Actor.ins().postYbChange(newYb)}};GameLogic.prototype.postRuneShatter=function(){};GameLogic.prototype.postRuneExchange=function(){};GameLogic.prototype.postLevelBarChange=function(lv){return lv};GameLogic.prototype.postAdjustMapPos=function(){};GameLogic.prototype.doSubRoleAtt=function(bytes){SubRoles.ins().doSubRoleAtt(bytes)};GameLogic.prototype.postHpChange=function(bytes){var handle=bytes.readDouble();var hp=bytes.readDouble();var target=EntityManager.ins().getEntityByHandle(handle);if(!target)return false;var model=target.infoModel;var oldHp=model.getAtt(AttributeType.atHp);model.setAtt(AttributeType.atHp,hp);target.updateBlood();if(hp<=0){RoleAI.ins().checkPlayDieSound(target);DropHelp.tempDropPoint.x=Math.floor(target.x/GameMap.CELL_SIZE);DropHelp.tempDropPoint.y=Math.floor(target.y/GameMap.CELL_SIZE)}else{if(model.type==EntityType.Role&&!target.nameVisible)target.showNameAndHp()}return[target,hp,oldHp]};GameLogic.prototype.doNeiGongChange=function(bytes){var handle=bytes.readDouble();var neigong=bytes.readDouble();var target=EntityManager.ins().getEntityByHandle(handle);if(target&&target.infoModel){target.infoModel.setAtt(AttributeType.cruNeiGong,neigong);target.updateNeiGong()}};GameLogic.prototype.postEntityHpChange=function(target,source,type,value){if(source&&source.team==Team.My||target&&target.team==Team.My){if(type==DamageTypes.Heji){var gsv=ViewManager.ins().getView(GameSceneView);DisplayUtils.shakeItHeji(gsv.map,30,700,3)}}return[target,source,type,value]};GameLogic.prototype.doRemoveEntity=function(bytes){var handle=bytes.readDouble();var entity=EntityManager.ins().getEntityByHandle(handle);if(!entity)return;if(entity instanceof CharRole){if(entity.infoModel&&entity.infoModel.type==EntityType.LadderPlayer){if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){if(UserFb.ins().guideBossKill==0){this.removeEntity(handle);UserBoss.ins().postBelongChange(Actor.handle,handle,entity.infoModel.name);UserFb.ins().guideBossKill+=1}else{EntityManager.ins().removeByHandle(handle,false,true);entity.onDead(function(){entity.deadDelay()});GuideUtils.ins().clickOut();UserFb.ins().guideBossKill+=1;UserBoss.ins().weixieList.length=0;UserBoss.ins().postHasAttackChange(0)}}else{this.removeEntity(handle)}}else{EntityManager.ins().removeByHandle(handle);if(BattleGround.ins().isPaoDian&&entity.infoModel){BattleGround.ins().changecanPlayList(entity.infoModel.masterHandle,false)}}}else if(entity instanceof CharItem2){EntityManager.ins().removeByHandle(handle)}else{this.removeEntity(handle);if(entity&&entity.team!=Team.My){var isPlayStand=false;var nextList=EntityManager.ins().screeningTargetByPos(entity,true);if(!nextList||nextList.length==0){isPlayStand=true}else{if(GameMap.fbType==UserFb.FB_TYPE_GUILD_WAR){var char=EntityManager.ins().getEntityByHandle(GameLogic.ins().currAttackHandle);if(!char||char.infoModel.getAtt(AttributeType.atHp)<=0){isPlayStand=true}}}if(isPlayStand){var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var _i=0,mylist_6=mylist;_i<mylist_6.length;_i++){var char=mylist_6[_i];if(char.action!=EntityAction.RUN&&char.action!=EntityAction.DIE)char.playAction(EntityAction.STAND)}}if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS||GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){if(entity.parent){var point=entity.parent.localToGlobal(entity.x,entity.y);UserFb.ins().postExpFly(point,50)}}}if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){UserBoss.ins().attHandle=0;if(UserFb.ins().guideBossKill){UserBoss.ins().winner=Actor.myName}GuideUtils.ins().clickOut();GameLogic.ins().postChangeTarget(0)}}this.postRemoveEntity(handle,entity)};GameLogic.prototype.postRemoveEntity=function(handle,entity){return[handle,entity]};GameLogic.prototype.removeEntity=function(handle){var entity=EntityManager.ins().getEntityByHandle(handle);if(entity&&entity.infoModel.getAtt(AttributeType.atHp)<=0){EntityManager.ins().removeByHandle(handle,false,true);entity.playAction(EntityAction.HIT);entity.stopMove();entity.onDead(function(){entity.deadDelay();var t=egret.Tween.get(entity.dieTweenObj);t.wait(1e3).to({alpha:0},1e3).call(function(){DisplayUtils.removeFromParent(entity)})})}else{EntityManager.ins().removeByHandle(handle,true,true)}};GameLogic.prototype.doMoveEntity=function(bytes){var handle=bytes.readDouble();var target=EntityManager.ins().getEntityByHandle(handle);if(!target)return;var tx=bytes.readInt();var ty=bytes.readInt();if(target.x==tx&&target.y==ty)return;GameMap.moveEntity(target,tx,ty,true,true)};GameLogic.prototype.postGetFubenMoveEvents=function(bytes){var handle=bytes.readDouble();var self_x=Math.floor(bytes.readInt()/GameMap.CELL_SIZE);var self_y=Math.floor(bytes.readInt()/GameMap.CELL_SIZE);var target_x=Math.floor(bytes.readInt()/GameMap.CELL_SIZE);var target_y=Math.floor(bytes.readInt()/GameMap.CELL_SIZE);var speed=bytes.readDouble();var target=EntityManager.ins().getEntityByHandle(handle);if(target&&target.isJumping()){this.sendFubenMoveEventsToServer(handle,self_x,self_y,null,speed);return}var path=GameMap.aStar.getPatch(self_x,self_y,target_x,target_y,false,true);if(!path){path=[new AStarNode(target_x,target_y,24)]}this.sendFubenMoveEventsToServer(handle,self_x,self_y,path,speed)};GameLogic.prototype.sendFubenMoveEventsToServer=function(handle,self_x,self_y,path,moveSpeed){var len=path?path.length:0;var bytes=this.getBytes(39);bytes.writeDouble(handle);bytes.writeInt(len);var moveSpeedGridPerSec=moveSpeed/1e3;for(var i=0;i<len;i++){var node=path[i];bytes.writeInt(node.nDir);bytes.writeInt(node.nX*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1));bytes.writeInt(node.nY*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1));var distanceInGrid=0;if(i==len-1){distanceInGrid=Math.sqrt((self_x-node.nX)*(self_x-node.nX)+(self_y-node.nY)*(self_y-node.nY))}else{distanceInGrid=Math.sqrt((path[i+1].nX-node.nX)*(path[i+1].nX-node.nX)+(path[i+1].nY-node.nY)*(path[i+1].nY-node.nY))}var moveSpeed=moveSpeedGridPerSec;if(AStar.isJump(node.nDir)){moveSpeed*=AStar.JUMP_SPEED}else if(AStar.isSprint(node.nDir)){moveSpeed*=AStar.SPRINT_SPEED}var intervalInSec=distanceInGrid/moveSpeed;bytes.writeDouble(intervalInSec)}this.sendToServer(bytes)};GameLogic.prototype.sendEntityMove=function(handle,targetXInPixel,targetYInPixel){var bytes=this.getBytes(11);bytes.writeDouble(handle);bytes.writeInt(targetXInPixel);bytes.writeInt(targetYInPixel);this.sendToServer(bytes)};GameLogic.prototype.postSendFubenMoveEvents=function(bytes){var handle=bytes.readDouble();var target=EntityManager.ins().getEntityByHandle(handle);if(target){var self_x=bytes.readInt();var self_y=bytes.readInt();var target_x=bytes.readInt();var target_y=bytes.readInt();var tick=bytes.readDouble();var startTimer=egret.getTimer();var len=bytes.readInt();var evnts=[];for(var i=0;i<len;++i){var type=bytes.readInt();var x=bytes.readInt();var y=bytes.readInt();var ts=bytes.readDouble();evnts.push({type:type,pos:{x:x,y:y},ts:ts,endTimer:startTimer+(ts-tick)*1e3})}var paths=[];for(var _i=0,evnts_1=evnts;_i<evnts_1.length;_i++){var evnt=evnts_1[_i];if(evnt.ts>tick){paths.push(new AStarNode(Math.floor(evnt.pos.x/GameMap.CELL_SIZE),Math.floor(evnt.pos.y/GameMap.CELL_SIZE),evnt.type,evnt.endTimer))}}GameLogic.ins().postMoveEntity(target,paths,true)}};GameLogic.prototype.doStopMoveEntity=function(bytes){var handle=bytes.readDouble();var target=EntityManager.ins().getEntityByHandle(handle);if(target){target.stopMove();if(target.infoModel.getAtt(AttributeType.atHp)>0){target.playAction(EntityAction.STAND)}target.x=bytes.readInt();target.y=bytes.readInt();if(target==EntityManager.ins().getNoDieRole()){GameLogic.ins().postMoveCamera()}}};GameLogic.prototype.doSyncPos=function(bytes){var _this=this;var handle=bytes.readDouble();var target=EntityManager.ins().getEntityByHandle(handle);var type=bytes.readShort();if(target){target.stopMove();var posX=bytes.readInt();var posY=bytes.readInt();var t=void 0;switch(type){case 0:target.playAction(EntityAction.STAND);target.x=posX;target.y=posY;if(target.isMy)egret.callLater(function(){_this.postMoveCamera()},this);break;case 1:target.playAction(EntityAction.RUN);t=egret.Tween.get(target.moveTweenObj);t.to({x:posX,y:posY},bytes.readInt()).call(function(){target.playAction(EntityAction.STAND)});break;case 2:target.playAction(EntityAction.STAND);t=egret.Tween.get(target.moveTweenObj);t.to({x:posX,y:posY},bytes.readInt());break}}};GameLogic.prototype.postMoveCamera=function(){var entity=EntityManager.ins().getNoDieRole();if(!entity)return false;return[entity.x,entity.y,GameMap.mapID,GameMap.fubenID]};GameLogic.prototype.sendSyncServerTime=function(){this.sendBaseProto(14)};GameLogic.prototype.postMpChange=function(bytes){var handle=bytes.readDouble();var mp=bytes.readDouble();var target=EntityManager.ins().getEntityByHandle(handle);var model;if(target){model=target.infoModel;model.setAtt(AttributeType.atMp,mp)}return model};GameLogic.prototype.postExpMc=function(mon){return mon};GameLogic.prototype.doTips=function(bytes){var strTips=GlobalConfig.ServerTips[bytes.readInt()].tips;UserTips.ins().showTips(strTips)};GameLogic.prototype.doFirstRegister=function(bytes){ViewManager.ins().open(WelcomeWin)};GameLogic.prototype.doDieNotice=function(bytes){};GameLogic.prototype.postGuildChange=function(bytes){return[bytes.readInt(),bytes.readString()]};GameLogic.prototype.postOtherAttChange=function(bytes){var target=EntityManager.ins().getEntityByHandle(bytes.readDouble());if(!target||!target.infoModel)return false;var len=bytes.readShort();for(var i=0;i<len;i++)target.infoModel.setAtt(bytes.readInt(),bytes.readDouble());return target};GameLogic.prototype.doPaoPao=function(bytes){var handle=bytes.readDouble();var id=bytes.readInt();var target=EntityManager.ins().getEntityByHandle(handle);if(target)target.addPaoPao(id)};GameLogic.prototype.doSubRoleExtAtt=function(bytes){SubRoles.ins().doSubRoleExtAtt(bytes)};GameLogic.prototype.sendRename=function(name){var bytes=this.getBytes(22);bytes.writeString(name);this.sendToServer(bytes)};GameLogic.prototype.postRename=function(bytes){var result=bytes.readByte();if(result==0){GameSocket.ins().close();ViewManager.ins().close(RenameWin);alert(i18n("GameLogic_7"));ChannelMgr.ins().reload()}else{RoleMgr.ins().showErrorTips(result)}};GameLogic.prototype.postChangeAttrPoint=function(handle){var bytes=this.getBytes(25);bytes.writeDouble(handle);this.sendToServer(bytes);GuildWar.ins().getModel().clickTime=1;BattleGround.ins().clickTime=1;BattleGround.ins().attHandle=handle};GameLogic.prototype.doFindPath=function(bytes){var handle=bytes.readDouble();var sx=Math.floor(bytes.readInt()/GameMap.CELL_SIZE);var sy=Math.floor(bytes.readInt()/GameMap.CELL_SIZE);var endX=bytes.readInt();var endY=bytes.readInt();var tx=Math.floor(endX/GameMap.CELL_SIZE);var ty=Math.floor(endY/GameMap.CELL_SIZE);var path=GameMap.getPatch(sx,sy,tx,ty);if(!path){}this.sendFindPathToServer(handle,path)};GameLogic.prototype.sendFindPathToServer=function(handle,path,isLastGrip){if(isLastGrip===void 0){isLastGrip=true}var len=path?path.length:0;var bytes=this.getBytes(31);bytes.writeDouble(handle);bytes.writeInt(len);for(var i=0;i<len;i++){if(i==0&&!isLastGrip){bytes.writeInt(path[i].nX);bytes.writeInt(path[i].nY)}else{bytes.writeInt(path[i].nX*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1));bytes.writeInt(path[i].nY*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1))}}this.sendToServer(bytes)};GameLogic.prototype.doBloodNumShow=function(bytes){var targetHandle=bytes.readDouble();var sourceHandle=bytes.readDouble();var value=Math.ceil(bytes.readDouble())*-1;var type=bytes.readUnsignedInt();var charSource=EntityManager.ins().getEntityByHandle(sourceHandle);if(!charSource){return}var charTarget=EntityManager.ins().getEntityByHandle(targetHandle);if(!charTarget){return}if(charTarget.team==Team.My&&charTarget.infoModel.type==EntityType.Monster){if(value<0)return}if(!(charTarget instanceof CharRole)){charTarget.shakeIt()}GameLogic.ins().postEntityHpChange(charTarget,charSource,type,value)};GameLogic.prototype.doChangeTarget=function(bytes){var sourceHandle=bytes.readDouble();var targetHandle=bytes.readDouble();this.postAllAtkTarget(sourceHandle,targetHandle);var char=EntityManager.ins().getEntityByHandle(sourceHandle);if(char&&char.infoModel&&char.infoModel.masterHandle==Actor.handle)this.postAtkTarget(targetHandle);if(CityCC.ins().isCity||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||BattleGround.ins().isPaoDian||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena){TargetListCC.ins().postTargetList(sourceHandle,targetHandle);return}if(GameMap.fbType!=UserFb.FB_TYPE_GUILD_WAR&&GameMap.fbType!=UserFb.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=UserFb.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=UserFb.FB_TYPE_HOMEBOSS&&GameMap.fbType!=UserFb.FB_TYPE_GUIDEBOSS||targetHandle==0){if(char&&char==EntityManager.ins().getNoDieRole())GameLogic.ins().currAttackHandle=targetHandle;return}var target=EntityManager.ins().getEntityByHandle(targetHandle);if(target&&target.infoModel&&target.infoModel.masterHandle>0){var source=EntityManager.ins().getEntityByHandle(sourceHandle);if(source&&source.infoModel&&source.infoModel.masterHandle==Actor.handle){this.postChangeTarget(target.infoModel.masterHandle)}if(source&&source.infoModel){var sources=EntityManager.ins().getMasterList(source.infoModel.masterHandle);if(target.infoModel.masterHandle==Actor.handle&&sources){for(var k in sources){if(!(sources[k]instanceof CharRole))continue;sources[k].setNameTxtColor(ColorUtil.ROLENAME_COLOR_YELLOW)}if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){if(UserBoss.ins().weixieList[0]!=source.infoModel.masterHandle){var tname=source.infoModel.name;if(source.infoModel.type==EntityType.LadderPlayer){var strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];tname=StringUtils.replaceStr(tname,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+"")}if(UserFb.ins().guideBossKill)UserTips.ins().showCenterTips(i18n("GameLogic_11",tname))}UserBoss.ins().weixieList.length=0;UserBoss.ins().changeWeiXieList(source.infoModel.masterHandle);UserBoss.ins().postHasAttackChange(0)}}}}else{var sourceHd=EntityManager.ins().getEntityByHandle(sourceHandle);if(sourceHd&&sourceHd.infoModel){if(sourceHd.infoModel.masterHandle==Actor.handle){if(target&&target.infoModel){this.postChangeTarget(target.infoModel.masterHandle)}else{this.postChangeTarget(0)}}}}};GameLogic.prototype.postChangeTarget=function(handle){GameLogic.ins().currAttackHandle=handle};GameLogic.prototype.postAtkTarget=function(handle){this.currHandle=handle};GameLogic.prototype.postAllAtkTarget=function(sourceHandle,targetHandle){return[sourceHandle,targetHandle]};GameLogic.prototype.test=function(keyCode){if(keyCode==Keyboard.KC_TAB){}if(keyCode==Keyboard.BRACE_R){}if(keyCode==Keyboard.BRACE_L){}if(keyCode==Keyboard.BACKSLASH){}if(keyCode==Keyboard.I){}if(keyCode==Keyboard.O){}if(keyCode==Keyboard.P){}if(keyCode==Keyboard.SPACE){AutoTestMgr.ins().paused=!AutoTestMgr.ins().paused}if(keyCode==Keyboard.BACK_QUOTE){if(!ViewManager.ins().isShow(WarnWin)){var infoStr=window["clientVersion"]||"undefined";infoStr+=i18n("GameLogic_12",GameServer.serverOpenDay+1);infoStr+=i18n("GameLogic_13",LocationProperty.srvid);WarnWin.show(infoStr,null,this,null,null,"sure")}else{ViewManager.ins().close(WarnWin)}}};GameLogic.prototype.startPkBoss=function(){UserFb.ins().autoPk()};GameLogic.prototype.createEntityByModel=function(model){var param=[];for(var _i=1;_i<arguments.length;_i++){param[_i-1]=arguments[_i]}var target=EntityManager.ins().createEntity(model,param);if(target){this.addEntity(target);if(RoleAI.ins().inStoryMode){target.visible=false}}return target};GameLogic.prototype.addEntity=function(target){if(target instanceof CharRole){target.showBlood(target.isMy||target.team==Team.WillEntity);target.showNeigong(target.isMy);target.dir=target.x>=GameMap.MAX_WIDTH>>1?6:2}else if(target instanceof CharMonster&&GlobalConfig.MonstersConfig[target.infoModel.configID]&&GlobalConfig.MonstersConfig[target.infoModel.configID].type==3){target.dir=target.x>=GameMap.MAX_WIDTH>>1?6:2}this.gamescene.map.addEntity(target)};GameLogic.prototype.playSkillEff=function(skill,self,targets,hitFun){if(hitFun===void 0){hitFun=null}var rtn=300;if(skill.wordEff&&self.team==Team.My){UserSkill.ins().postShowSkillWord(skill.wordEff+"");if(UserSkill.ins().hejiLevel>0){if(UserSkill.ins().isHejiSkill(skill.configID)){UserSkill.ins().hejiEnable=false;UserSkill.ins().setHejiCD(-1);UserSkill.ins().postHejiRemove()}}}if(targets.length==1&&self!=targets[0]||targets.length>1){self.dir=DirUtil.get8DirBy2Point(self,targets[0])}if(skill&&skill.actionType){var needStand=false;if(self instanceof CharRole){if(self.lastSS){needStand=true}else{needStand=false}}else{needStand=true}self.playAction(skill.actionType,needStand?function(){if(self.action!=EntityAction.DIE){self.playAction(EntityAction.STAND)}}:null)}if(!ViewManager.ins().isShow(GameSceneView)){return 0}if(self&&self.team==Team.My){if(skill&&skill.repelDistance){TimerManager.ins().doTimer(350,1,this.shakeMapView,this)}}var showList=[14];var skillId=Math.floor(skill.configID/1e3);if(showList.indexOf(skillId)<0&&!EntityShowMgr.ins().checkShowSkillEffect()){if(self.infoModel.masterHandle&&!self.isMy&&!targets[0].isMy){return}}if(skill.effectId){if(self.infoModel.type==EntityType.Monster){if(GlobalConfig.FlameStamp.skillId.indexOf(skill.configID)!=-1)self.usedLyMarkSkill()}if(self.getIsShowBody()){if(!targets[0]){console.log("GameLogic.ts 1211 target == null; skillid = "+skill.id)}SkillEffPlayer.play(skill.effectId,self,[targets[0]],hitFun,1,null,"",undefined,targets)}else{if(hitFun){hitFun()}return 0}}else{if(hitFun){hitFun()}return 0}switch(skill.effType){case EffectType.AnyAngle:return 700}return rtn};GameLogic.prototype.shakeMapView=function(){var gsv=ViewManager.ins().getView(GameSceneView);DisplayUtils.shakeIt(gsv.map,5,250,2)};GameLogic.prototype.shakeMapView2=function(){var gsv=ViewManager.ins().getView(GameSceneView);DisplayUtils.shakeItHeji(gsv.map,10,250,1)};GameLogic.prototype.addOutEff=function(xPos,yPos){var transModel=new TransferModel;transModel.configID=0;transModel.x=xPos;transModel.y=yPos;transModel.type=EntityType.Transfer;EntityManager.ins().createEntity(transModel)};GameLogic.prototype.removeOutEff=function(){EntityManager.ins().removeTransferById(0)};Object.defineProperty(GameLogic.prototype,"gamescene",{get:function(){return ViewManager.ins().getView(GameSceneView)},enumerable:true,configurable:true});GameLogic.prototype.createGuanqiaMonster=function(isAll,isElite){if(isAll===void 0){isAll=true}if(isElite===void 0){isElite=false}this.guanqiaId=UserFb.ins().guanqiaID;if(!GameMap.sceneInMain())return;var count=Math.ceil(UserFb.ins().waveMonsterCount*Math.random());var monsterTypeLen=UserFb.ins().waveMonsterId.length;var eliteCount=EntityManager.ins().getEntityByMonsterId(UserFb.ins().eliteMonsterId).length;var monsterCount=EntityManager.ins().getTeamCount(Team.Monster)-eliteCount;if(monsterCount>3&&!isElite){return}count=10-monsterCount;for(var i=0;i<monsterTypeLen;i++){var len=isAll?UserFb.ins().rPos[i].length:1;if(len>3){len=3}count=Math.ceil(count/len);var eliteBoo=isElite;for(var j=0;j<len;j++){if(!this.rPosindex[i]||this.rPosindex[i]>=UserFb.ins().rPos[i].length)this.rPosindex[i]=0;var index=this.rPosindex[i];var radiusMap=[];var p=UserFb.ins().rPos[i][index];var startX=p.x-this.MONSTER_RADIUS;var startY=p.y-this.MONSTER_RADIUS;this.writeMap(radiusMap,startX,startY,count);for(var tempX=0;tempX<this.MONSTER_LEN;tempX++){for(var tempY=0;tempY<this.MONSTER_LEN;tempY++){if(!radiusMap[tempX])continue;var tempP=radiusMap[tempX][tempY];if(!tempP)continue;var model=void 0;if(isElite&&eliteBoo&&eliteCount<5){model=UserFb.ins().createMonster(UserFb.ins().eliteMonsterId);model.isElite=true;eliteBoo=false;eliteCount+=1}else{var monId=UserFb.ins().waveMonsterId[i];model=UserFb.ins().createMonster(monId)}model.x=(startX+tempX)*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);model.y=(startY+tempY)*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);var wp=isNaN(UserFb.ins().wanderpercent)?5e3:UserFb.ins().wanderpercent;model.isWander=Math.random()*1e4<wp;var monster=this.createEntityByModel(model);monster.AI_STATE=AI_State.Patrol;if(model.effect)monster.addHalo(GlobalConfig.EffectConfig[model.effect].fileName)}}this.rPosindex[i]++}}if(GameMap.sceneInMain())RoleAI.ins().start()};GameLogic.prototype.writeMap=function(map,startX,startY,count){var runTime=0;while(count>0){runTime++;if(runTime>200){debug.log(i18n("GameLogic_14",this.guanqiaId));return}var tx=MathUtils.limitInteger(0,this.MONSTER_LEN-1);var ty=MathUtils.limitInteger(0,this.MONSTER_LEN-1);if(!map[tx])map[tx]=[];if(!map[tx][ty]){var canMove=GameMap.checkWalkable(startX+tx,startY+ty);if(canMove){map[tx][ty]=1;count--}}}};GameLogic.prototype.postHookStateChange=function(value){this.hookState=value;return value};GameLogic.prototype.postMoveEntity=function(entity,asNode,isGrip){if(isGrip===void 0){isGrip=true}return[entity,asNode,isGrip]};GameLogic.calculateRealAttribute=function(target,type,self,passiveAttr){if(passiveAttr===void 0){passiveAttr={}}var value=target.infoModel.getAtt(type);var buffs=target.buffList;var buff;for(var i in buffs){buff=buffs[i];var mh=EntityManager.ins().getRootMasterHandle(self.infoModel.handle);if((buff.effConfig.type==SkillEffType.AdditionalAttributes||buff.effConfig.type==SkillEffType.HostAddAttributes&&buff.hostsHandle&&buff.hostsHandle.indexOf(mh)>=0)&&buff.effConfig.args.d==type){if(buff.multRate)value+=buff.value*buff.multRate;else value+=buff.value}}var exValue=passiveAttr[type]?passiveAttr[type]:0;return value+exValue};GameLogic.triggerAttr=function(selfTarget,type,passiveAttr){if(passiveAttr===void 0){passiveAttr={}}var attrValue=selfTarget.infoModel.attributeData[type]||0;attrValue+=passiveAttr[type]?passiveAttr[type]:0;if(attrValue){var r=Math.random();if(r<attrValue/1e4){return true}}return false};GameLogic.triggerExAttr=function(selfTarget,type){var attrValue=selfTarget.infoModel.attributeExData[type];if(attrValue){var r=Math.random();if(r<attrValue/1e4){return true}}return false};GameLogic.triggerCrit=function(selfTarget,target,addValue){if(addValue===void 0){addValue=0}var crit=selfTarget.infoModel.getAtt(AttributeType.atCrit);if(selfTarget.buffList[60003]){var skillEff=selfTarget.buffList[60003].effConfig;crit=crit+Math.floor(skillEff.args.c/1e4*crit)}var attrValue=crit-target.infoModel.getAtt(AttributeType.atTough)+addValue;if(attrValue>0){var r=Math.random();if(r<attrValue/1e4){return true}}return false};GameLogic.triggerMiss=function(selfTarget,target){var hit=selfTarget.infoModel.getExAtt(ExAttributeType.eatHit);var miss=target.infoModel.getExAtt(ExAttributeType.eatMiss);var min=Math.min(miss-hit,4e3);if(min>0){var r=Math.random();if(r<min/1e4){return true}}return false};GameLogic.triggerValue=function(value){if(value){var r=Math.random();if(r<value/1e4){return true}}return false};GameLogic.prototype.postViewOpen=function(b,n){if(n===void 0){n=true}return[b,n]};GameLogic.prototype.doAddMonsterConfig=function(bytes){var config=JSON.parse(bytes.readString());for(var i in config){GlobalConfig.MonstersConfig[i]=config[i]}};GameLogic.prototype.doZeroInit=function(bytes){GameApp.ins().postZeroInit()};GameLogic.prototype.postChangeCamp=function(bytes){var handle=bytes.readDouble();var target=EntityManager.ins().getEntityByHandle(handle);if(target&&target.infoModel){target.infoModel.camp=bytes.readInt();if(target.infoModel.masterHandle==Actor.handle){BattleCC.ins().camp=target.infoModel.camp;BattleCC.ins().postEnterSuccess()}target.setCharName(target.infoModel.guildAndName)}this.refreshName()};GameLogic.prototype.refreshName=function(){var entityList=EntityManager.ins().getAllEntity();for(var i in entityList){var entity=entityList[i];if(entity.parent&&entity.infoModel&&entity.infoModel.type==EntityType.Role){entity.setCharName(entity.infoModel.guildAndName);entity.setBarColor()}}};GameLogic.skyBallCheck=function(target){if(this.triggerExAttr(target,ExAttributeType.eatAllCrit)){var effBuff=void 0;effBuff=ObjectPool.pop("EntityBuff");effBuff.effConfig=GlobalConfig.EffectsConfig[SkillConst.EFF_SKY_BALL];effBuff.addTime=egret.getTimer();effBuff.endTime=effBuff.addTime+target.infoModel.getExAtt(ExAttributeType.eatAllCritTime);target.addBuff(effBuff);return true}return false};GameLogic.prototype.postFlyItem=function(item){return item};GameLogic.prototype.postFlyItemEx=function(item){return item};GameLogic.prototype.stopAI=function(){this.sendBaseProto(33)};GameLogic.prototype.sendGetOtherAttr=function(masterHandles){var bytes=this.getBytes(34);bytes.writeShort(masterHandles.length);for(var i=0;i<masterHandles.length;i++){bytes.writeDouble(masterHandles[i])}this.sendToServer(bytes)};GameLogic.prototype.showAllPlayers=function(){var entities=EntityManager.ins().getAllEntity();for(var key in entities){var entity=entities[key];if(entity instanceof CharRole||entity instanceof CharMonster&&entity.infoModel.avatar==1e4){entity.visible=true}}};GameLogic.prototype.showNearPlayers=function(){var myEntity=EntityManager.ins().getMainRole(0);if(myEntity){var entities=EntityManager.ins().getAllEntity();var d2=8*8*64*64;for(var key in entities){var entity=entities[key];if((entity instanceof CharRole||entity instanceof CharMonster&&entity.infoModel&&entity.infoModel.avatar==1e4)&&entity.team!=Team.My){var xx=entity.x-myEntity.x;var yy=entity.y-myEntity.y;entity.visible=xx*xx+yy*yy<=d2}}}};GameLogic.prototype.postNotice=function(){};GameLogic.prototype.postCacheProtoList=function(bytes){var cnt=bytes.readShort();for(var i=0;i<cnt;i++){var len=bytes.readShort();var pack=new GameByteArray;bytes.readBytes(pack,pack.position,len);var sysId=pack.readUnsignedByte();var msgId=pack.readUnsignedByte();GameSocket.ins().dispatch(sysId,msgId,pack)}};GameLogic.HOOK_STATE_HOOK=0;GameLogic.HOOK_STATE_FIND_ENMENY=1;GameLogic.showNearPlayers=true;return GameLogic}(BaseSystem);__reflect(GameLogic.prototype,"GameLogic");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.gamelogic=GameLogic.ins.bind(GameLogic)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var MainAniPart=function(_super){__extends(MainAniPart,_super);function MainAniPart(src){var _this=_super.call(this,src)||this;var size=64;if(src=="resource/image/public/explode.png"){size=450}_this.width=size;_this.height=size;_this.anchorOffsetX=size/2;_this.anchorOffsetY=size/2;return _this}return MainAniPart}(eui.Image);__reflect(MainAniPart.prototype,"MainAniPart");var MainAniPartAni=function(_super){__extends(MainAniPartAni,_super);function MainAniPartAni(src){var _this=_super.call(this)||this;_this.source=src;return _this}MainAniPartAni.prototype.resume=function(){this.playFile(this.source,-1)};MainAniPartAni.prototype.pause=function(){this.stop()};return MainAniPartAni}(MovieClip);__reflect(MainAniPartAni.prototype,"MainAniPartAni");var MainAniMgr=function(){function MainAniMgr(){this.partCache={};this.partCacheAni={};this.endPts={yuanbao:{x:0,y:0},gold:{x:0,y:0},player:{x:0,y:0},bag:{x:0,y:0}};this.enterFrameReg=false;this.uepTmpPt=new egret.Point;this.uepTmpPt2=new egret.Point;this.endPtUpdated=false}MainAniMgr.ins=function(){if(this.singleton==null){this.singleton=new MainAniMgr}return this.singleton};MainAniMgr.prototype.getPart=function(src){var partList=this.partCache[src];if(partList==null){partList=[];this.partCache[src]=partList}var part;if(partList.length>0){part=partList.pop()}else{part=new MainAniPart(src)}LayerManager.Main_Ani.addChild(part);return part};MainAniMgr.prototype.recyclePart=function(part){var src=part.source;var partList=this.partCache[src];if(partList==null){partList=[];this.partCache[src]=partList}part.parent.removeChild(part);partList.push(part)};MainAniMgr.prototype.getAni=function(src){var partList=this.partCacheAni[src];if(partList==null){partList=[];this.partCacheAni[src]=partList}var part;if(partList.length>0){part=partList.pop()}else{part=new MainAniPartAni(src)}part.resume();LayerManager.Main_Ani.addChild(part);return part};MainAniMgr.prototype.recycleAni=function(part){var src=part.source;var partList=this.partCacheAni[src];if(partList==null){partList=[];this.partCache[src]=partList}part.pause();part.parent.removeChild(part);partList.push(part)};MainAniMgr.prototype.playDrop=function(src,isAni,count,stageX,stageY,endPt,baseScale,delay){if(endPt===void 0){endPt="yuanbao"}if(baseScale===void 0){baseScale=.7}if(delay===void 0){delay=0}this.updateEndPt();if(!this.enterFrameReg){LayerManager.Main_Ani.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this);this.enterFrameReg=true}var scale=1;scale*=baseScale;var now=egret.getTimer();this.now=now;var playTime=endPt=="player"?450:1e3;var localPt=LayerManager.Main_Ani.globalToLocal(stageX,stageY);var part;if(isAni){part=this.getAni(src)}else{part=this.getPart(src)}part.endPt=null;part.scale0=baseScale;part.scale1=.6;part.t=now;part.t0=now+delay;part.t1=now+delay+playTime;part.x0=localPt.x;part.y0=localPt.y;part.endPt=endPt;part.updateFunc=this.updatePart;this.updatePart(part)};MainAniMgr.prototype.playExplode=function(src,count,stageX,stageY,baseScale,delay){if(baseScale===void 0){baseScale=1}if(delay===void 0){delay=0}if(!this.enterFrameReg){LayerManager.Main_Ani.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this);this.enterFrameReg=true}var now=egret.getTimer();this.now=now;var playTime=450;var localPt=LayerManager.Main_Ani.globalToLocal(stageX,stageY);var x0=localPt.x;var y0=localPt.y;var partExplode=this.getPart("resource/image/public/explode.png");partExplode.scale1=1.5;partExplode.t=now;partExplode.t0=now+delay;partExplode.t1=now+delay+250;partExplode.x=x0;partExplode.y=y0;partExplode.updateFunc=this.updateExplode;this.updateExplode(partExplode);for(var i=0;i<count;++i){var part=this.getAni(src);part.scale0=baseScale;part.scale1=.8*baseScale*(1+Math.random()*.3);part.t=now;var delay1=Math.random()*400;part.t0=now+delay+delay1;part.t1=now+delay+delay1+playTime;part.rotation=360*Math.random();part.x0=x0;part.y0=y0;var angle=Math.random()*Math.PI*2;var radius=400*Math.random();part.x1=x0+Math.sin(angle)*radius;part.y1=y0+Math.cos(angle)*radius;part.updateFunc=this.updatePartAni;this.updatePartAni(part)}};MainAniMgr.prototype.updateEndPt=function(){var role=SubRoles.ins().getSubRoleByIndex(0);if(role){var mainRole=EntityManager.ins().getEntityByHandle(role.handle);if(mainRole&&mainRole.parent){var gp=mainRole.parent.localToGlobal(mainRole.x,mainRole.y,this.uepTmpPt);var lp=LayerManager.Main_Ani.globalToLocal(gp.x,gp.y,this.uepTmpPt2);this.endPts.player.x=lp.x;this.endPts.player.y=lp.y}}if(!this.endPtUpdated){var imgYuanBao=PlayFunView.instance.imgYuanBao;var imgGold=PlayFunView.instance.imgGold;var imgBag=UIView2.instance.getBagBtn();if(imgYuanBao&&imgYuanBao.parent){var gp=imgYuanBao.parent.localToGlobal(imgYuanBao.x-6,imgYuanBao.y-3,this.uepTmpPt);var lp=LayerManager.Main_Ani.globalToLocal(gp.x,gp.y,this.uepTmpPt2);this.endPts.yuanbao.x=lp.x;this.endPts.yuanbao.y=lp.y}if(imgGold&&imgGold.parent){var gp=imgGold.parent.localToGlobal(imgGold.x-8,imgGold.y,this.uepTmpPt);var lp=LayerManager.Main_Ani.globalToLocal(gp.x,gp.y,this.uepTmpPt2);this.endPts.gold.x=lp.x;this.endPts.gold.y=lp.y}if(imgBag&&imgBag.parent){var gp=imgBag.parent.localToGlobal(imgBag.x+imgBag.width/2,imgBag.y+imgBag.height/2,this.uepTmpPt);var lp=LayerManager.Main_Ani.globalToLocal(gp.x,gp.y,this.uepTmpPt2);this.endPts.bag.x=lp.x;this.endPts.bag.y=lp.y}this.endPtUpdated=true}};MainAniMgr.prototype.playEndAni=function(part){var imgTarget=null;var endPt=part.endPt;if(endPt=="yuanbao"){imgTarget=PlayFunView.instance.imgYuanBao}else if(endPt=="gold"){imgTarget=PlayFunView.instance.imgGold}else if(endPt=="bag"){imgTarget=UIView2.instance.getBagBtn()}if(imgTarget!=null){Tween.removeTweens(imgTarget);var scale=endPt=="bag"?1.2:1.5;Tween.get(imgTarget).to({scaleX:scale,scaleY:scale},200).to({scaleX:1,scaleY:1},200)}};MainAniMgr.prototype.updatePart=function(part){var now=this.now;if(now>part.t1){this.playEndAni(part);if(part instanceof MainAniPart){this.recyclePart(part)}else{this.recycleAni(part)}return}part.alpha=1;var x0=part.x0;var y0=part.y0;var sf=(now-part.t)/200;if(sf>1){sf=1}var scale0=1-(1-sf)*(1-sf);if(now<part.t0){part.x=x0;part.y=y0;var scale=part.scale0;scale*=scale0;part.scaleX=part.scaleY=scale;return}var f=(now-part.t0)/(part.t1-part.t0);var g=f;var x1=this.endPts[part.endPt].x;var y1=this.endPts[part.endPt].y;var scale=part.scale0+(part.scale1-part.scale0)*g;scale*=scale0;part.scaleX=part.scaleY=scale;if(part.endPt=="player"){g=Math.pow(g,2);var cx=(x0+x1)/2;var cy=(y0+y1)/2;var radius=Math.sqrt(Math.pow(x1-x0,2)+Math.pow(y1-y0,2))/2;var a0=Math.acos((y0-y1)/(radius*2));if(x0<x1){a0*=-1}var a=a0+g*Math.PI;part.x=cx+radius*Math.sin(a);part.y=cy+radius*Math.cos(a)}else{var m1=4,m2=1.4;if(g<.5){g=.5*Math.pow(g*2,m1)}else{g=1-.5*Math.pow(1-(g-.5)*2,m1+(g-.5)*2*(m2-m1))}part.x=x0+(x1-x0)*g;part.y=y0+(y1-y0)*g}};MainAniMgr.prototype.updatePartAni=function(part){var now=this.now;if(now>part.t1){this.recycleAni(part);return}var x0=part.x0;var y0=part.y0;var x1=part.x1;var y1=part.y1;if(now<part.t0){part.alpha=0;return}var f=(now-part.t0)/(part.t1-part.t0);var scale=1;scale*=part.scale1;part.scaleX=scale;part.scaleY=scale;var fa1=.2,fa2=.7;if(f<fa1){var fa=f/fa1;part.alpha=1-Math.pow(1-fa,3)}else if(f<fa2){part.alpha=1}else{var fa=(f-fa2)/(1-fa2);part.alpha=1-Math.pow(fa,2)}var fp=1-Math.pow(1-f,1.5);part.x=x0+(x1-x0)*fp;part.y=y0+(y1-y0)*fp};MainAniMgr.prototype.updateExplode=function(part){var now=this.now;if(now>part.t1){this.recyclePart(part);return}var x0=part.x0;var y0=part.y0;if(now<part.t0){part.alpha=0;return}var f=(now-part.t0)/(part.t1-part.t0);var scale=1-Math.pow(1-f,3);scale*=part.scale1;part.scaleX=scale;part.scaleY=scale;var fa1=.2,fa2=.7;if(f<fa1){var fa=f/fa1;part.alpha=1-Math.pow(1-fa,3)}else if(f<fa2){part.alpha=1}else{var fa=(f-fa2)/(1-fa2);part.alpha=1-Math.pow(fa,2)}};MainAniMgr.prototype.onEnterFrame=function(){this.now=egret.getTimer();this.updateEndPt();var layer=LayerManager.Main_Ani;var parts=[];var partsAni=[];for(var i=0,c=layer.numChildren;i<c;++i){var child=layer.getChildAt(i);if(child instanceof MainAniPart){parts.push(child)}else if(child instanceof MainAniPartAni){partsAni.push(child)}}if(parts.length==0&&partsAni.length==0){LayerManager.Main_Ani.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this);this.enterFrameReg=false}for(var _i=0,parts_1=parts;_i<parts_1.length;_i++){var part=parts_1[_i];part.updateFunc.apply(this,[part])}for(var _a=0,partsAni_1=partsAni;_a<partsAni_1.length;_a++){var partAni=partsAni_1[_a];partAni.updateFunc.apply(this,[partAni])}};MainAniMgr.MAX_PART_NUM=50;return MainAniMgr}();__reflect(MainAniMgr.prototype,"MainAniMgr");var MainScene=function(_super){__extends(MainScene,_super);function MainScene(){return _super.call(this)||this}MainScene.prototype.onEnter=function(){_super.prototype.onEnter.call(this);this.addLayerAt(LayerManager.Game_Bg,1);this.addLayerAt(LayerManager.Game_Main,2);this.addLayer(LayerManager.Main_View);this.addLayer(LayerManager.Main_Ani);this.addLayer(LayerManager.UI_Main);this.addLayer(LayerManager.UI_Main2);this.addLayer(LayerManager.UI_Popup);this.addLayer(LayerManager.UI_Tips);ViewManager.ins().open(GameSceneView);ViewManager.ins().open(UIView2);ViewManager.ins().open(ChatMainUI);ViewManager.ins().open(TipsView);SoundManager.ins().stopBg();GameApp.ins().postLoginInit();if(DeviceUtils.IsMobile){egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchPlaySound,this)}};MainScene.prototype.onTouchPlaySound=function(){egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchPlaySound,this);SoundUtil.ins().playEffect(SoundUtil.WINDOW)};MainScene.prototype.onExit=function(){_super.prototype.onExit.call(this)};return MainScene}(BaseScene);__reflect(MainScene.prototype,"MainScene");var DamageTypes;(function(DamageTypes){DamageTypes[DamageTypes["BLANK"]=0]="BLANK";DamageTypes[DamageTypes["HIT"]=1]="HIT";DamageTypes[DamageTypes["CRIT"]=2]="CRIT";DamageTypes[DamageTypes["Dodge"]=4]="Dodge";DamageTypes[DamageTypes["Lucky"]=8]="Lucky";DamageTypes[DamageTypes["Heji"]=16]="Heji";DamageTypes[DamageTypes["Fujia"]=32]="Fujia";DamageTypes[DamageTypes["Deter"]=64]="Deter";DamageTypes[DamageTypes["Lianji"]=128]="Lianji";DamageTypes[DamageTypes["ZhuiMing"]=256]="ZhuiMing";DamageTypes[DamageTypes["ZhiMing"]=512]="ZhiMing"})(DamageTypes||(DamageTypes={}));window["DamageTypes"]=DamageTypes;var EffectType;(function(EffectType){EffectType[EffectType["Targer"]=0]="Targer";EffectType[EffectType["Self"]=1]="Self";EffectType[EffectType["Ballistic"]=2]="Ballistic";EffectType[EffectType["AnyAngle"]=3]="AnyAngle";EffectType[EffectType["Sustain"]=4]="Sustain";EffectType[EffectType["Range"]=5]="Range";EffectType[EffectType["Sector"]=6]="Sector"})(EffectType||(EffectType={}));window["EffectType"]=EffectType;var EquipAddAttrType;(function(EquipAddAttrType){EquipAddAttrType[EquipAddAttrType["EquipSlotType_Weapon"]=0]="EquipSlotType_Weapon";EquipAddAttrType[EquipAddAttrType["EquipSlotType_Helmet"]=1]="EquipSlotType_Helmet";EquipAddAttrType[EquipAddAttrType["EquipSlotType_Coat"]=2]="EquipSlotType_Coat";EquipAddAttrType[EquipAddAttrType["EquipSlotType_Necklace"]=3]="EquipSlotType_Necklace";EquipAddAttrType[EquipAddAttrType["EquipSlotType_Accessory1"]=4]="EquipSlotType_Accessory1";EquipAddAttrType[EquipAddAttrType["EquipSlotType_Accessory2"]=5]="EquipSlotType_Accessory2";EquipAddAttrType[EquipAddAttrType["EquipSlotType_Ring1"]=6]="EquipSlotType_Ring1";EquipAddAttrType[EquipAddAttrType["EquipSlotType_Ring2"]=7]="EquipSlotType_Ring2";EquipAddAttrType[EquipAddAttrType["EquipSlotType_Dzi"]=8]="EquipSlotType_Dzi";EquipAddAttrType[EquipAddAttrType["EquipSlotType_Max"]=9]="EquipSlotType_Max"})(EquipAddAttrType||(EquipAddAttrType={}));window["EquipAddAttrType"]=EquipAddAttrType;var ExAttributeType;(function(ExAttributeType){ExAttributeType[ExAttributeType["eatReflectProbability"]=0]="eatReflectProbability";ExAttributeType[ExAttributeType["eatReflectRate"]=1]="eatReflectRate";ExAttributeType[ExAttributeType["eatIgnoreReflect"]=2]="eatIgnoreReflect";ExAttributeType[ExAttributeType["eatGodBlessProbability"]=3]="eatGodBlessProbability";ExAttributeType[ExAttributeType["eatGodBlessRate"]=4]="eatGodBlessRate";ExAttributeType[ExAttributeType["eatDeathCurseProbability"]=5]="eatDeathCurseProbability";ExAttributeType[ExAttributeType["eatDeathCurseDamageIncrease"]=6]="eatDeathCurseDamageIncrease";ExAttributeType[ExAttributeType["eatDeathCurseTime"]=7]="eatDeathCurseTime";ExAttributeType[ExAttributeType["eatAllCrit"]=8]="eatAllCrit";ExAttributeType[ExAttributeType["eatAllCritTime"]=9]="eatAllCritTime";ExAttributeType[ExAttributeType["eatBeHitTimesDodge"]=10]="eatBeHitTimesDodge";ExAttributeType[ExAttributeType["eatAttackTimesCrit"]=11]="eatAttackTimesCrit";ExAttributeType[ExAttributeType["eatAttackAddHpProbability"]=12]="eatAttackAddHpProbability";ExAttributeType[ExAttributeType["eatAttackAddHpValue"]=13]="eatAttackAddHpValue";ExAttributeType[ExAttributeType["eatAddToWarriorDamageInc"]=14]="eatAddToWarriorDamageInc";ExAttributeType[ExAttributeType["eatAddToMageDamageInc"]=15]="eatAddToMageDamageInc";ExAttributeType[ExAttributeType["eatAddToTaoistDamageInc"]=16]="eatAddToTaoistDamageInc";ExAttributeType[ExAttributeType["eatSubWarriorDamageInc"]=17]="eatSubWarriorDamageInc";ExAttributeType[ExAttributeType["eatSubMageDamageInc"]=18]="eatSubMageDamageInc";ExAttributeType[ExAttributeType["eatSubTaoistDamageInc"]=19]="eatSubTaoistDamageInc";ExAttributeType[ExAttributeType["eatTogetherHitFree"]=20]="eatTogetherHitFree";ExAttributeType[ExAttributeType["eatTogetherHitMonDamageInc"]=21]="eatTogetherHitMonDamageInc";ExAttributeType[ExAttributeType["eatTogetherHitRoleDamageInc"]=22]="eatTogetherHitRoleDamageInc";ExAttributeType[ExAttributeType["eatTogetherHitCdSub"]=23]="eatTogetherHitCdSub";ExAttributeType[ExAttributeType["eatAdditionalHarm"]=24]="eatAdditionalHarm";ExAttributeType[ExAttributeType["eatReductionHarm"]=25]="eatReductionHarm";ExAttributeType[ExAttributeType["eatMiss"]=26]="eatMiss";ExAttributeType[ExAttributeType["eatBaseSkillExArg"]=27]="eatBaseSkillExArg";ExAttributeType[ExAttributeType["eatMultipleCrit"]=28]="eatMultipleCrit";ExAttributeType[ExAttributeType["eatMultipleCritCoeff"]=29]="eatMultipleCritCoeff";ExAttributeType[ExAttributeType["atMultipleCritHurt"]=30]="atMultipleCritHurt";ExAttributeType[ExAttributeType["eatAddWarriorDamageInc"]=31]="eatAddWarriorDamageInc";ExAttributeType[ExAttributeType["eatAddMageDamageInc"]=32]="eatAddMageDamageInc";ExAttributeType[ExAttributeType["eatAddTaoistDamageInc"]=33]="eatAddTaoistDamageInc";ExAttributeType[ExAttributeType["eatMultipleCritTime"]=34]="eatMultipleCritTime";ExAttributeType[ExAttributeType["eatAttackAddHpTime"]=35]="eatAttackAddHpTime";ExAttributeType[ExAttributeType["eatStunTime"]=36]="eatStunTime";ExAttributeType[ExAttributeType["eatGodPowerCd"]=37]="eatGodPowerCd";ExAttributeType[ExAttributeType["eatGodPowerProbability"]=38]="eatGodPowerProbability";ExAttributeType[ExAttributeType["eatGodPowerDamageIncrease"]=39]="eatGodPowerDamageIncrease";ExAttributeType[ExAttributeType["eatHpLtAddBuffId"]=40]="eatHpLtAddBuffId";ExAttributeType[ExAttributeType["eatHpLtAddBuffCd"]=41]="eatHpLtAddBuffCd";ExAttributeType[ExAttributeType["eatHit"]=42]="eatHit";ExAttributeType[ExAttributeType["eatSkillVamirePro"]=43]="eatSkillVamirePro";ExAttributeType[ExAttributeType["eatWarriorPeakDamageInc"]=44]="eatWarriorPeakDamageInc";ExAttributeType[ExAttributeType["eatMagePeakDamageInc"]=45]="eatMagePeakDamageInc";ExAttributeType[ExAttributeType["eatTaoistPeakDamageInc"]=46]="eatTaoistPeakDamageInc";ExAttributeType[ExAttributeType["eatPetSkillLevel"]=47]="eatPetSkillLevel";ExAttributeType[ExAttributeType["eatPetAttackInc"]=48]="eatPetAttackInc";ExAttributeType[ExAttributeType["eatSkillAddArgA"]=49]="eatSkillAddArgA";ExAttributeType[ExAttributeType["eatSkillAddArgB"]=50]="eatSkillAddArgB";ExAttributeType[ExAttributeType["eatResistDeathCd"]=51]="eatResistDeathCd";ExAttributeType[ExAttributeType["eatResistDeathPro"]=52]="eatResistDeathPro";ExAttributeType[ExAttributeType["eatResistDeathRate"]=53]="eatResistDeathRate";ExAttributeType[ExAttributeType["eatCritHpLt"]=54]="eatCritHpLt";ExAttributeType[ExAttributeType["eatCritHpLtAddDamage"]=55]="eatCritHpLtAddDamage";ExAttributeType[ExAttributeType["eatMiJiKNHpPer"]=56]="eatMiJiKNHpPer";ExAttributeType[ExAttributeType["eatMiJiKNHpSubPer"]=57]="eatMiJiKNHpSubPer";ExAttributeType[ExAttributeType["eatMiJiKNDamPer"]=58]="eatMiJiKNDamPer";ExAttributeType[ExAttributeType["eatMiJiZHDamPer"]=59]="eatMiJiZHDamPer";ExAttributeType[ExAttributeType["eatMiJiZHTime"]=60]="eatMiJiZHTime";ExAttributeType[ExAttributeType["eatMiJiBQHpTime"]=61]="eatMiJiBQHpTime";ExAttributeType[ExAttributeType["eatMiJiBQHpPer"]=62]="eatMiJiBQHpPer";ExAttributeType[ExAttributeType["eatMiJiBQBuffId"]=63]="eatMiJiBQBuffId";ExAttributeType[ExAttributeType["eatCount"]=64]="eatCount"})(ExAttributeType||(ExAttributeType={}));window["ExAttributeType"]=ExAttributeType;var SkillEffType;(function(SkillEffType){SkillEffType[SkillEffType["AdditionalDamage"]=1]="AdditionalDamage";SkillEffType[SkillEffType["AddBlood"]=2]="AddBlood";SkillEffType[SkillEffType["AdditionalAttributes"]=3]="AdditionalAttributes";SkillEffType[SkillEffType["AdditionalState"]=4]="AdditionalState";SkillEffType[SkillEffType["Summon"]=5]="Summon";SkillEffType[SkillEffType["Other"]=6]="Other";SkillEffType[SkillEffType["HostAddAttributes"]=7]="HostAddAttributes";SkillEffType[SkillEffType["SuperArmor"]=8]="SuperArmor"})(SkillEffType||(SkillEffType={}));window["SkillEffType"]=SkillEffType;var DropHelp=function(){function DropHelp(){}DropHelp.init=function(parent,parName){this.dropContainer=parent;this.dropNameContainer=parName;MessageCenter.addListener(Encounter.ins().postCreateDrop,this.addDrop,this)};DropHelp.getMaxDropNum=function(){return this.isTweenItemFb()?64:8};DropHelp.isTweenItemFb=function(){return GameMap.fbType==UserFb.FB_TYPE_MATERIAL||GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS&&OpenSystem.ins().checkSysOpen(SystemType.QUICKDROP)||Encounter.ins().isEncounter()||((GameMap.fbType==UserFb.FB_TYPE_PERSONAL||GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN)&&GameServer.serverOpenDay>0||GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON||GameMap.fbType==UserFb.FB_TYPE_KF_BOSS||GameMap.fbType==UserFb.FB_ID_MINE||GameMap.fbType==UserFb.FB_TYPE_HARD_FB)};DropHelp.start=function(entity){this.mainEntity=entity?entity:EntityManager.ins().getNoDieRole();if(DropHelp.isTweenItemFb()){TimerManager.ins().doTimer(800,1,this.delayTweenItem,this)}else{TimerManager.ins().doTimer(100,0,this.findDrop,this)}this.starting=true};DropHelp.stop=function(){TimerManager.ins().removeAll(this);this.starting=false;RoleAI.ins().isFindDrop=false};DropHelp.delayTweenItem=function(){if(!DropHelp.getItemCount()){this.callDropCb();return}var entity=this.mainEntity;if(!entity){this.clearDrop();return}var first=true;for(var key in this.itemPos){DropHelp.tweenItem(this.itemPos[key],entity,key,first);first=false}};DropHelp.tweenItem=function(item,role,key,callCb){if(item==null){DebugUtils.warn(i18n("DropHelp_0"));return}DisplayUtils.removeFromParent(item);item.setItemParent(DropHelp.dropNameContainer);console.log(item.id+" "+item.name);var t=egret.Tween.get(item);var randowNum=Math.random()*500+200;if(item.id==2){t.wait(randowNum).call(function(){item.alpha=0;if(item.parent){var stagePt=item.parent.localToGlobal(item.x,item.y,this.tiTmpPt);MainAniMgr.ins().playDrop("resource/image/item/icgoods121.png",false,item.count,stagePt.x,stagePt.y,"player",1)}egret.Tween.removeTweens(item);DisplayUtils.removeFromParent(item);item.destruct();delete DropHelp.itemPos[key];if(callCb){DropHelp.callDropCb()}},DropHelp)}else{t.wait(randowNum).to({x:role.x,y:role.y-50,alpha:0},450,egret.Ease.backIn).call(function(){egret.Tween.removeTweens(item);DisplayUtils.removeFromParent(item);item.destruct();delete DropHelp.itemPos[key];if(callCb){DropHelp.callDropCb()}},DropHelp)}};DropHelp.getItemCount=function(){return DropHelp.itemPos?Object.keys(DropHelp.itemPos).length:0};DropHelp.addDrop=function(arr){var x_Grid=arr[0],y_Grid=arr[1],itemData=arr[2];this.addDropImpl(x_Grid,y_Grid,itemData)};DropHelp.addDropImpl=function(x_Grid,y_Grid,itemData){var charItem=ObjectPool.pop("CharItem2");charItem.visible=true;charItem.alpha=1;charItem.setData(itemData);var x_g=0;var y_g=0;var i=0;var flag="|";if(this.itemPos[x_Grid+flag+y_Grid]||!GameMap.checkWalkable(x_Grid,y_Grid)){for(i=0;i<this.orderX.length;i++){x_g=x_Grid+this.orderX[i];y_g=y_Grid+this.orderY[i];if(GameMap.checkWalkable(x_g,y_g)==false)continue;if(this.itemPos[x_g+flag+y_g]==null)break}if(i>=this.orderX.length){var index=2;var b=true;while(b){for(var i_15=x_Grid-index;i_15<x_Grid+index&&b;i_15++){for(var j=y_Grid-index;j<y_Grid+index&&b;j++){x_g=i_15;y_g=j;if(GameMap.checkWalkable(x_g,y_g)==false)continue;if(this.itemPos[x_g+flag+y_g]==null)b=false}}index++;if(index>=30){return}}}}else{x_g=x_Grid;y_g=y_Grid}charItem.x=GameMap.grip2Point(x_g);charItem.y=GameMap.grip2Point(y_g);this.itemPos[x_g+flag+y_g]=charItem;GameLogic.ins().addEntity(charItem);charItem.addRoatEffect();charItem.addFloatEffect();if(charItem.isRedEquip()&&itemData.id!=200007){charItem.addRedEquipEffect("equiplighteff")}else if(charItem.itemQuality==5){charItem.addRedEquipEffect("equiplightgoldeff")}};DropHelp.clearAllDropTween=function(){if(!this.itemPos)return;var value=null;for(var key in this.itemPos){value=this.itemPos[key];if(value&&value instanceof CharItem2){value.removeRoatEffect()}}};DropHelp.clearDrop=function(){DropHelp.clearAllDropTween();this.stop();for(var key in this.itemPos){DisplayUtils.removeFromParent(this.itemPos[key]);if(this.itemPos[key])this.itemPos[key].destruct();ObjectPool.push(this.itemPos[key]);delete this.itemPos[key]}this.curTarget=null;if(this.completeFunc){this.completeFunc.func.call(this.completeFunc.funcThis);this.completeFunc=null}};DropHelp.findDrop=function(){var role=this.mainEntity;if(!role)return;var mylist=EntityManager.ins().getEntityByTeam(Team.My);if(this.curTarget){if(!role||role.action==EntityAction.RUN||role.atking){if(role&&role.action==EntityAction.RUN){if(role.x==this.lastPoint.x&&role.y==this.lastPoint.y){role.playAction(EntityAction.STAND)}else{this.lastPoint.x=role.x;this.lastPoint.y=role.y}}return}}RoleAI.ins().isFindDrop=true;if(mylist.length>1){var len=SubRoles.ins().subRolesLen;var index=0;var dirs=[-1,1];for(var j=0;j<mylist.length;j++){var element=mylist[j];if(element==role||element.action==EntityAction.RUN)continue;var selfMaster=role;if(element.infoModel.masterHandle){var ms=EntityManager.ins().getEntityByHandle(element.infoModel.masterHandle);if(ms){selfMaster=ms}}if(mylist.length==2){dirs=[0]}var p=DirUtil.getGridByDir(selfMaster.dir+dirs[index]!=null?dirs[index]:0);index+=1;GameMap.moveEntity(element,selfMaster.x+p.x,selfMaster.y+p.y)}}if(egret.getTimer()-this.waitTime<200){return}var target=null;if(this.curTarget){target=this.curTarget;if(MathUtils.getDistance(role.x,role.y,target.x,target.y)<GameMap.CELL_SIZE>>1){for(var i in this.itemPos){if(this.itemPos[i]==target){var dropItem=this.itemPos[i];if(dropItem&&dropItem instanceof CharItem2){dropItem.removeRoatEffect()}delete this.itemPos[i];break}}egret.Tween.get(target).wait(100).call(function(){if(target&&target.parent){var p=target.parent.localToGlobal(target.x,target.y);GameLogic.ins().postFlyItem({item:target,gp:p});DisplayUtils.removeFromParent(target)}target=null});this.curTarget=null;this.waitTime=egret.getTimer();return}else this.curTarget=null}var tar=null;var xb=Number.MAX_VALUE;for(var i in this.itemPos){target=this.itemPos[i];var dist=MathUtils.getDistance(role.x,role.y,target.x,target.y);if(xb>dist){xb=dist;tar=this.itemPos[i]}}if(tar){this.curTarget=tar;GameMap.moveEntity(role,tar.x,tar.y,false,true);return}this.checkDrop();if(GameMap.fubenID==0){UserFb.ins().sendGetReward()}};DropHelp.callDropCb=function(){if(this.completeFunc){this.completeFunc.func.call(this.completeFunc.funcThis);this.completeFunc=null}};DropHelp.checkDrop=function(){if(!this.getItemCount()){this.stop();if(this.completeFunc){this.completeFunc.func.call(this.completeFunc.funcThis);this.completeFunc=null}return}};DropHelp.addCompleteFunc=function(f,funcThis){this.completeFunc={func:f,funcThis:funcThis}};DropHelp.tempDropPoint=new egret.Point;DropHelp.itemPos={};DropHelp.orderX=[-1,1,-1,0,1,-1,0,1];DropHelp.orderY=[0,0,1,1,1,-1,-1,-1];DropHelp.waitTime=0;DropHelp.tiTmpPt=new egret.Point;DropHelp.lastPoint=new egret.Point;return DropHelp}();__reflect(DropHelp.prototype,"DropHelp");var EaseToFollowUtils=function(){function EaseToFollowUtils(){}EaseToFollowUtils.startTweenMove=function(followers,followTarget,callback,finishFunc){var itemsTemp=[];EaseToFollowUtils.followTarget=followTarget;if(typeof followers=="object"){for(var key in followers){itemsTemp.push(followers[key])}}else if(Array.isArray(followers)){itemsTemp=followers}EaseToFollowUtils.arrowArray=itemsTemp;EaseToFollowUtils.callBack=callback;EaseToFollowUtils.finishFunc=finishFunc;TimerManager.ins().remove(EaseToFollowUtils.onEnterFrame,EaseToFollowUtils);TimerManager.ins().doTimer(10,0,EaseToFollowUtils.onEnterFrame,EaseToFollowUtils)};EaseToFollowUtils.onEnterFrame=function(){if(Assert(EaseToFollowUtils.followTarget,"the easeToFollow followTarget is null"))return;var items=EaseToFollowUtils.arrowArray;var isLine=items.length<5;for(var i=0;i<items.length;i++){if(i>0&&isLine){EaseToFollowUtils.calEvery(items[i-1].x,items[i-1].y,items[i])}else{if(items[i]==null)return;EaseToFollowUtils.calEvery(EaseToFollowUtils.followTarget.x,EaseToFollowUtils.followTarget.y-50,items[i])}}};EaseToFollowUtils.calEvery=function(targetX,targetY,currentArrow){EaseToFollowUtils.dx=targetX-currentArrow.x;EaseToFollowUtils.dy=targetY-currentArrow.y;if(Math.abs(EaseToFollowUtils.dx)<30&&Math.abs(EaseToFollowUtils.dy)<30){EaseToFollowUtils.vx=0;EaseToFollowUtils.vy=0;var index=EaseToFollowUtils.arrowArray.indexOf(currentArrow);if(index>-1){EaseToFollowUtils.arrowArray.splice(index,1);if(EaseToFollowUtils.callBack){EaseToFollowUtils.callBack(currentArrow)}}if(EaseToFollowUtils.arrowArray.length==0){EaseToFollowUtils.dispose(currentArrow);return}}else{EaseToFollowUtils.easing+=.004;EaseToFollowUtils.vx=EaseToFollowUtils.dx*EaseToFollowUtils.easing;EaseToFollowUtils.vy=EaseToFollowUtils.dy*EaseToFollowUtils.easing}currentArrow.x+=EaseToFollowUtils.vx;currentArrow.y+=EaseToFollowUtils.vy};EaseToFollowUtils.dispose=function(item){TimerManager.ins().remove(EaseToFollowUtils.onEnterFrame,EaseToFollowUtils);EaseToFollowUtils.followTarget=null;EaseToFollowUtils.callBack=null;EaseToFollowUtils.arrowArray=[];EaseToFollowUtils.easing=.04;if(EaseToFollowUtils.finishFunc){EaseToFollowUtils.finishFunc();EaseToFollowUtils.finishFunc=null}};EaseToFollowUtils.easing=.04;EaseToFollowUtils.vx=0;EaseToFollowUtils.vy=0;EaseToFollowUtils.isFirst=true;return EaseToFollowUtils}();__reflect(EaseToFollowUtils.prototype,"EaseToFollowUtils");var GameBlackView=function(_super){__extends(GameBlackView,_super);function GameBlackView(){return _super.call(this)||this}GameBlackView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.bg=new eui.Image("gameBlackViewBg_jpg");this.bg.horizontalCenter=0;this.bg.verticalCenter=0;this.addChild(this.bg)};GameBlackView.prototype.destoryView=function(){};return GameBlackView}(BaseEuiView);__reflect(GameBlackView.prototype,"GameBlackView");ViewManager.ins().reg(GameBlackView,LayerManager.Game_Main);var GameSceneView=function(_super){__extends(GameSceneView,_super);function GameSceneView(){var _this=_super.call(this)||this;_this.skillWordList=[];_this.mijingpassTime=0;_this._shap=new egret.Shape;_this.webglChecked=false;_this.storyGot=false;_this.gwStartTimes=0;_this.leftTimeMj=0;_this._miCurFloor=0;_this.leftTime=0;_this.isStartTime=false;_this.leftFlyExp=0;_this.curAddExp=0;_this.curExp=0;GameSceneView.instance=_this;return _this}GameSceneView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GameFightSceneSkin";this.touchEnabled=false;this.map=new MapView;this.map.initMap();this.addChildAt(this.map,0);this.pkBossBtn.touchEnabled=true;this.pkBossBtn.visible=false;this.input=new eui.TextInput;this.input.visible=false;this.input.text=i18n("GameSceneView_0");this.input.y=300;this.addChild(this.input);this.escBtn.visible=false;this.skillWordImg=new eui.Image;this.skillWordImg.x=100;this.skillWordImg.visible=false;this.skillWordImg.touchEnabled=false;this.addChild(this.skillWordImg);this.leftTimePic=BitmapNumber.ins().createNumPic(0,"r0",5);this.leftTimePic.x=90;this.leftTimePic.y=38;this.guildBossGroup.addChild(this.leftTimePic);this.GwRankGroup.addChild(this._shap);this.GwRankGroup.visible=false;this._shap.rotation=-90;this._shap.x=48;this._shap.y=50;this.schedule.mask=this._shap;this.riseupBtn.visible=false};GameSceneView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this.observe(GameLogic.ins().postHookStateChange,this.upDataGuajiState);this.observe(GameLogic.ins().postHpChange,this.updateExpGroup);this.observe(UserSkill.ins().postShowSkillWord,this.showSkillWord);this.observe(UserFb.ins().postFbExpTotal,this.updateKill);this.observe(GameLogic.ins().postEnterMap,this.onEnterMap);this.observe(UserFb.ins().postFbTime,this.onSetTime);this.observe(GameLogic.ins().postViewOpen,this.onViewOpen);this.observe(GodWeaponCC.ins().postFubenInfo,this.updateMijingAdd);this.observe(Actor.ins().postExp,this.expChange);this.addTouchEvent(this.pkBossBtn,this.onTap);this.addTouchEvent(this.riseup,this.onTap)};GameSceneView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.close.call(this,param);this.skillWordList=[];egret.Tween.removeTweens(this.skillWordImg);this.skillWordImg.visible=false;TimerManager.ins().remove(this.updateTime,this);TimerManager.ins().remove(this.updateMijingTime,this);this.mijingpassTime=0};GameSceneView.prototype.expChange=function(exp){if(GameMap.fbType!=UserFb.FB_TYPE_GUANQIABOSS&&GameMap.fbType!=UserFb.FB_TYPE_TIAOZHAN||!exp)return;var role=EntityManager.ins().getNoDieRole();if(!role)return;var blood=new egret.DisplayObjectContainer;BitmapNumber.ins().changeNum(blood,"j+"+exp,"g3",3.5,0);blood.anchorOffsetX=blood.width/2;blood.y=role.y-role.typeface-30;blood.x=role.x;blood.scaleX=blood.scaleY=1;this.map.addChild(blood);egret.Tween.get(blood).to({y:blood.y-80,scaleX:2,scaleY:2},200).to({scaleX:1.2,scaleY:1.2},100).wait(1e3).to({alpha:0,y:blood.y-140},1e3).call(function(){DisplayUtils.removeFromParent(blood)})};GameSceneView.prototype.onViewOpen=function(param){var tag=param[0];var needBg=param[1];var playfun=ViewManager.ins().getView(PlayFunView);if(playfun){playfun.topMask.visible=false}if(tag==1){if(this.map.parent){if(egret.Capabilities.isMobile==true&&needBg){ViewManager.ins().open(GameBlackView);this.removeChild(this.map)}else{if(playfun){playfun.topMask.visible=true}}}}else{if(!this.map.parent){this.addChildAt(this.map,0)}ViewManager.ins().close(GameBlackView)}};GameSceneView.prototype.onEnterMap=function(){if(!this.webglChecked){this.webglChecked=true;setTimeout(function(){if(egret.Capabilities.renderMode!="webgl"){WarnWin.show(i18n("GameSceneView_1"),function(){},this,undefined,undefined,"sure")}},2e3)}MijiGuideMgr.ins();DressGuideMgr.ins();if(window["__g_removeLoadBg"]){window["__g_removeLoadBg"]();window["__g_removeLoadBg"]=undefined}ViewManager.ins().close(ConnectingWin);TimerManager.ins().remove(this.updateTime,this);ViewManager.ins().close(GwMijingRiseUpView);TimerManager.ins().remove(this.updateMijingTime,this);this.mijingpassTime=0;this.isStartTime=false;if(GameMap.fbType==UserFb.FB_TYPE_EXP){this.curExp=0;if(!this.expTxt){this.expTxt=BitmapNumber.ins().createNumPic(0,"r0",5);this.expTxt.x=this.flyExpGroup.width/2;this.expTxt.y=65;this.flyExpGroup.addChild(this.expTxt)}this.updateKill();this.setExp(this.curExp);this.leftFlyExp=0;this.totleExp.source="chuangtianguan_json.fbljjy";this.killNumImg.source="chuangtianguan_json.fbjsgw";this.flyExpGroup.visible=true;this.flyExpGroup1.visible=true}else{this.flyExpGroup.visible=false;this.flyExpGroup1.visible=false}this.guildBossGroup.visible=false;if(UserSkill.ins().hejiLevel>=0)this.checkHJState();if(GameMap.fbType==UserFb.FB_TYPE_MIJING){this.GwRankGroup.visible=false;this.showMijing()}else{this.GwRankGroup.visible=false}if(GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON){ViewManager.ins().open(GuardMainUI)}else{ViewManager.ins().close(GuardMainUI);ViewManager.ins().close(GuardCallBossWin)}LoginMgr.ins().initAntiAddctionTimer();if(UserFb.ins().guanqiaID>5&&GameMap.fbType==0){if(!this.storyGot){this.storyGot=true}}var notGuanQia=GameMap.fbType!=UserFb.FB_TYPE_GUANQIABOSS&&GameMap.lastFbTyp!=UserFb.FB_TYPE_GUANQIABOSS;var mapChanged=GameMap.lastFbTyp==UserFb.FB_TYPE_GUANQIABOSS&&GameMap.hasTransfer;GameMap.hasTransfer=false;if(GameMap.fbType==UserFb.FB_TYPE_ZHENGBA){GameSceneView.endCloudAni()}else if(notGuanQia||mapChanged){if(!ViewManager.ins().hasTopView()){GameSceneView.playCloudAni()}}EasyLoading.ins().hideLoading()};GameSceneView.playCloudAni=function(autoEndCloudAni){if(autoEndCloudAni===void 0){autoEndCloudAni=true}var uiView2=ViewManager.ins().getView(UIView2);if(uiView2&&!GameSceneView.playingCloudAni){GameSceneView.playingCloudAni=true;var cloudLeft=uiView2.cloudLeft;var cloudRight=uiView2.cloudRight;var offset=Math.floor(cloudLeft.parent.width-580)/2;cloudLeft.x=offset-580;cloudLeft.alpha=0;cloudLeft.visible=true;cloudRight.x=offset+580;cloudRight.alpha=0;cloudRight.visible=true;Tween.removeTweens(cloudLeft);Tween.removeTweens(cloudRight);Tween.get(cloudLeft).to({x:offset+50,alpha:1},600,egret.Ease.quadOut).wait(0).call(function(){if(autoEndCloudAni){GameSceneView.endCloudAni()}});Tween.get(cloudRight).to({x:offset-50,alpha:1},600,egret.Ease.quadOut).wait(0)}};GameSceneView.endCloudAni=function(){var uiView2=ViewManager.ins().getView(UIView2);if(uiView2){var cloudLeft=uiView2.cloudLeft;var cloudRight=uiView2.cloudRight;var offset=Math.floor(cloudLeft.parent.width-580)/2;cloudLeft.x=offset+50;cloudLeft.alpha=1;cloudLeft.visible=true;cloudRight.x=offset-50;cloudRight.alpha=1;cloudRight.visible=true;Tween.get(cloudLeft).to({x:offset-580,alpha:0},1800,egret.Ease.quadIn).call(function(){GameSceneView.playingCloudAni=false;cloudLeft.visible=false});Tween.get(cloudRight).to({x:offset+580,alpha:0},1800,egret.Ease.quadIn).call(function(){cloudRight.visible=false})}};GameSceneView.prototype.checkHJState=function(){ViewManager.ins().close(BtnHejiWin)};GameSceneView.prototype.updateMijingAdd=function(){if(GameMap.fbType==UserFb.FB_TYPE_MIJING){var data=GodWeaponCC.ins().fubenInfoData;var list=data.listData;for(var i=0;i<list.length;i++){if(list[i].config.fbId==GameMap.fubenID){UserFb.ins().oldMijingPoint=list[i].curPoint;break}}}};GameSceneView.prototype.showMijing=function(){var config=GlobalConfig.GodWeaponBaseConfig;var curJoinFloor=1;var confF;for(var key in GlobalConfig.GodWeaponFubenConfig){if(GlobalConfig.GodWeaponFubenConfig[key].fbId==GameMap.fubenID){curJoinFloor=parseInt(key);confF=GlobalConfig.GodWeaponFubenConfig[key];break}}this._miCurFloor=curJoinFloor;var data=GodWeaponCC.ins().fubenInfoData;if(data){var list=data.listData;for(var i=0;i<list.length;i++){if(list[i].config.fbId==GameMap.fubenID){UserFb.ins().oldMijingPoint=list[i].curPoint;break}}}else{GodWeaponCC.ins().requestFubenInfo()}};GameSceneView.prototype.removeMiingTimeFun=function(){TimerManager.ins().remove(this.updateMijingTime,this)};GameSceneView.prototype.updateMijingTime=function(){if(this.leftTimeMj<=0){ViewManager.ins().close(GwMijingRiseUpView);this.mijingpassTime=0;UserFb.ins().sendExitFb();ViewManager.ins().open(GwResultView,GameMap.fubenID,4);TimerManager.ins().remove(this.updateMijingTime,this);return}else{var passNum=360-this.leftTimeMj;var maxNum=void 0;for(var i=0;i<GlobalConfig.GodWeaponBaseConfig.fbGrade.length;i++){if(passNum<=GlobalConfig.GodWeaponBaseConfig.fbGrade[i]){this.mijingpassTime=GlobalConfig.GodWeaponBaseConfig.fbGrade[i]-passNum;maxNum=GodWeaponCC.ins().getPinfenTime(i);UserFb.ins().mijingFingfen=i+1;UserFb.ins().mijingUseTime=passNum;this.updateMijingTimeView(maxNum,i);break}}this.leftTimeMj=360-(Math.floor((new Date).getTime()/1e3)-this.gwStartTimes)}};GameSceneView.prototype.updateMijingTimeView=function(maxNum,mjIndex){if(!this.GwRankGroup.visible){this.GwRankGroup.visible=true;this.schedule.source="godweapon_rankschedule";this.rankbg.source="GodWeapon_rankball"}var angle=360*this.mijingpassTime/maxNum;if(angle==360){angle=0}else if(angle==0){angle=360}DisplayUtils.drawCir(this._shap,this.schedule.width/2,360-angle,true);this.rank.source="godweapon_rank"+(mjIndex+1);this.time.text=DateUtils.getFormatBySecond(this.mijingpassTime,DateUtils.TIME_FORMAT_1);var str;str=GlobalConfig.GodWeaponBaseConfig.fbGrade[mjIndex]+i18n("GameSceneView_4");var strP="";switch(mjIndex+1){case 1:strP="完美";break;case 2:strP="优秀";break;case 3:strP="良好";break;case 4:strP="及格";break}this.requireTime.textFlow=(new egret.HtmlTextParser).parser(str+i18n("GameSceneView_5")+strP+i18n("GameSceneView_6"));var floorConfig=GlobalConfig.GodWeaponFubenConfig[this._miCurFloor];if(floorConfig){var obj=floorConfig.award[mjIndex+1];if(obj){this.rewardExp.text=""+obj[0].count}else{this.rewardExp.text=""}}else{this.rewardExp.text=""}};GameSceneView.prototype.setMJPingfen=function(point){var sourStr="godweapon_rank"+point;if(this.rank.source!=sourStr){this.rank.source=sourStr}};GameSceneView.prototype.upDataGuajiState=function(value){if(GameMap.fubenID!=0&&value==1){value=0}if(GameLogic.ins().inSkillPreview){value=null}this.stateImg.source=value?"zy_20":""};GameSceneView.prototype.onSetTime=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(GameMap.fbType==UserFb.FB_TYPE_GUILD_BOSS){if(param&&param[0]){this.leftTime=param[0][1];this.leftTimeImg.source="lastcount";this.guildBossGroup.visible=true;if(!this.isStartTime){TimerManager.ins().doTimer(1e3,0,this.updateTime,this);this.isStartTime=true;this.updateTime()}}}else if(GameMap.fbType==UserFb.FB_TYPE_MIJING){if(param&&param[0]){this.leftTimeMj=param[0][1];if(this.leftTimeMj>=2){this.leftTimeMj=this.leftTimeMj-2}this.gwStartTimes=Math.floor((new Date).getTime()/1e3)-(360-this.leftTimeMj);TimerManager.ins().doTimer(1e3,0,this.updateMijingTime,this);this.updateMijingTime()}}};GameSceneView.prototype.updateTime=function(){if(this.leftTime<0){TimerManager.ins().remove(this.updateTime,this);this.isStartTime=false;this.guildBossGroup.visible=false;BitmapNumber.ins().changeNum(this.leftTimePic,0,"r0",5);UserFb.ins().sendExitFb();return}BitmapNumber.ins().changeNum(this.leftTimePic,this.leftTime,"r0",5);this.leftTime--};GameSceneView.prototype.updateKill=function(){this.lbNum.textFlow=TextFlowMaker.generateTextFlow1(i18n("GameSceneView_11",UserFb.ins().expMonterCountKill,UserFb.ins().fbExpTotal))};GameSceneView.prototype.flyExp=function(point,exp){var _this=this;var movieExp=new eui.Image;movieExp.source="point2";movieExp.anchorOffsetX=20;movieExp.anchorOffsetY=20;movieExp.x=point.x;movieExp.y=point.y;this.addChild(movieExp);var _x=this.flyExpGroup.x+this.expTxt.x;var _y=this.flyExpGroup.y+this.expTxt.y+this.expTxt.height/2;var t=egret.Tween.get(movieExp);t.to({x:_x,y:_y,alpha:.5},800).call(function(){_this.addExp(exp);_this.removeChild(movieExp);egret.Tween.removeTweens(movieExp)},this);var tt=egret.Tween.get(movieExp,{loop:true});tt.to({rotation:movieExp.rotation+360},800)};GameSceneView.prototype.rollExp=function(){var addExp=this.leftFlyExp>this.curAddExp?this.curAddExp:this.leftFlyExp;this.leftFlyExp=this.leftFlyExp-addExp;this.curExp+=addExp;this.setExp(this.curExp);if(this.leftFlyExp<=0){TimerManager.ins().remove(this.rollExp,this)}};GameSceneView.prototype.addExp=function(exp){this.leftFlyExp+=exp;this.curAddExp=Math.floor(this.leftFlyExp/10);if(!TimerManager.ins().isExists(this.rollExp,this)){TimerManager.ins().doTimer(30,0,this.rollExp,this)}};GameSceneView.prototype.setExp=function(exp){BitmapNumber.ins().changeNum(this.expTxt,exp,"r0",5);this.expTxt.anchorOffsetX=this.expTxt.width/2};GameSceneView.prototype.updateExpGroup=function(_a){var target=_a[0],value=_a[1];if(value>0||GameMap.fbType!=UserFb.FB_TYPE_EXP)return;var configID=target.infoModel.configID;var config=GlobalConfig.ExpFbMonsterConfig[configID];if(!config)return;var parent=target.parent;if(!parent){var role=EntityManager.ins().getNoDieRole();if(role)parent=role.parent}if(parent){var discount=GlobalConfig.MonthCardConfig.expFubenPrecent/100;var addValue=Recharge.ins().getIsForeve()?1+discount:1;var point=parent.localToGlobal(target.x,target.y);this.flyExp(point,Math.ceil(config.exp*addValue))}this.updateKill()};GameSceneView.prototype.onTap=function(e){switch(e.currentTarget){case this.pkBossBtn:break;case this.escBtn:break;case this.riseup:ViewManager.ins().open(GwMijingRiseUpView);break}};GameSceneView.prototype.onEscBtn=function(){if(GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON){ViewManager.ins().open(GuardQuitTips);return}if(MineFight.ins().isFighting){UserTips.ins().showTips(i18n("GameSceneView_7"));return}if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS)PlayFun.ins().closeAuto();if(ZsBoss.ins().isZsBossFb(GameMap.fubenID))UserBoss.ins().ShowTip=true;if(GuildWar.ins().getModel().checkinAppoint()){ViewManager.ins().open(GuileWarReliveWin,3);return}if(BattleCC.ins().isBattle()){WarnWin.show(i18n("GameSceneView_8"),function(){UserFb.ins().sendExitFb()},this);return}if(PaoDianCC.ins().isPaoDian){WarnWin.show(i18n("GameSceneView_9"),function(){UserFb.ins().sendExitFb()},this);return}if(BattleGround.ins().isPaoDian){WarnWin.show(i18n("GameSceneView_13"),function(){UserFb.ins().sendExitFb()},this);return}if(KfArenaSys.ins().isKFArena){WarnWin.show(i18n("GameSceneView_10"),function(){UserFb.ins().sendExitFb()},this);return}if(GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS){if(BossHomeSys.ins().nowrebornCd-GameServer.serverTime/1e3>0){WarnWin.show(i18n("GameSceneView_12",Math.ceil(BossHomeSys.ins().nowrebornCd-GameServer.serverTime/1e3)),function(){UserFb.ins().sendExitFb()},this)}else{WarnWin.show(i18n("GameSceneView_12",GlobalConfig.WorldBossBaseConfig.challengeCd[UserBoss.BOSS_SUBTYPE_HOMEBOSS-1]),function(){UserFb.ins().sendExitFb()},this)}return}WarnWin.show(i18n("GameSceneView_13"),function(){UserFb.ins().sendExitFb()},this);TimerManager.ins().remove(this.updateMijingTime,this);this.mijingpassTime=0};GameSceneView.prototype.showSkillWord=function(img){if(!img)return;egret.Tween.removeTweens(this.skillWordImg);var t=egret.Tween.get(this.skillWordImg);this.skillWordImg.source=null;this.skillWordImg.source=img;this.skillWordImg.visible=true;this.skillWordImg.scaleX=3;this.skillWordImg.scaleY=3;this.skillWordImg.alpha=1;this.skillWordImg.y=250;t.to({y:250,scaleX:1,scaleY:1},200).wait(600).to({alpha:0},350)};GameSceneView.prototype.destoryView=function(){};return GameSceneView}(BaseEuiView);__reflect(GameSceneView.prototype,"GameSceneView");ViewManager.ins().reg(GameSceneView,LayerManager.Game_Bg);var BloodLabel=function(_super){__extends(BloodLabel,_super);function BloodLabel(){var _this=_super.call(this)||this;_this.urlDic={256:"wydEffectIcon",512:["j0z","j4z","j5z"]};_this.containers=[];_this.imgs=[];return _this}BloodLabel.ins=function(){return _super.ins.call(this)};BloodLabel.prototype.createBloodLabel=function(dtype,num,type,offset,offsetY,job){if(offset===void 0){offset=0}if(offsetY===void 0){offsetY=0}if(job===void 0){job=1}var blood=this.getContainer();blood.createBlood(dtype,num,type,offset,offsetY,job);return blood};BloodLabel.prototype.getTypeUrl=function(_type,job){if(job===void 0){job=1}var url=this.urlDic[_type];if(url){if(typeof url!="string"){return url[job-1]}return url}};BloodLabel.prototype.getImage=function(){return this.imgs.pop()||new eui.Image};BloodLabel.prototype.getContainer=function(){return this.containers.pop()||new BloodContainer};BloodLabel.prototype.pushImage=function(img){if(img&&this.imgs.indexOf(img)==-1)this.imgs.push(img)};BloodLabel.prototype.pushContainer=function(container){if(container&&this.containers.indexOf(container)==-1)this.containers.push(container)};return BloodLabel}(BaseClass);__reflect(BloodLabel.prototype,"BloodLabel");var BloodContainer=function(_super){__extends(BloodContainer,_super);function BloodContainer(){var _this=_super.call(this)||this;_this.offset=3;_this._fly=0;_this._originX=0;_this._originY=0;return _this}BloodContainer.prototype.createBlood=function(dtype,num,type,offset,offsetY,job){if(offset===void 0){offset=0}if(offsetY===void 0){offsetY=0}if(job===void 0){job=1}if((dtype&DamageTypes.ZhuiMing)==DamageTypes.ZhuiMing)this.addImage(DamageTypes.ZhuiMing,job);if((dtype&DamageTypes.ZhiMing)==DamageTypes.ZhiMing)this.addImage(DamageTypes.ZhiMing,job);this.addBmpNumber(num,type,offset,offsetY);this.resetPosition()};BloodContainer.prototype.addImage=function(dtype,job){if(job===void 0){job=1}var url=BloodLabel.ins().getTypeUrl(dtype,job);if(!url){console.log(i18n("BloodLabel_0",dtype));return}var img=BloodLabel.ins().getImage();img.addEventListener(egret.Event.COMPLETE,this.onLoaded,this);img.width=NaN;img.height=NaN;img.source=url;this.addChild(img)};Object.defineProperty(BloodContainer.prototype,"fly_p",{get:function(){return this._fly},set:function(f){this._fly=f;if(f>=0&&f<=.2){this.scaleX=this.scaleY=-100*Math.pow(f-.1,2)+1.8}if(f>.2){this.scaleX=this.scaleY=-.2*Math.pow(f-.1,2)+.8}if(f>=0&&f<=.4){this.y=this.originY-(120*f+39)}if(f>.4&&f<=.6){this.y=this.originY-(10*f+84)}if(f>.6){this.y=this.originY-(100*f+30)}if(f>.6){this.alpha=-1.2*f+1.6}},enumerable:true,configurable:true});Object.defineProperty(BloodContainer.prototype,"originX",{get:function(){return this._originX},set:function(X){this._originX=X},enumerable:true,configurable:true});Object.defineProperty(BloodContainer.prototype,"originY",{get:function(){return this._originY},set:function(Y){this._originY=Y},enumerable:true,configurable:true});BloodContainer.prototype.addBmpNumber=function(num,type,offset,offsetY){if(offset===void 0){offset=0}if(offsetY===void 0){offsetY=0}if(this.bmpContainer){BitmapNumber.ins().changeNum(this.bmpContainer,num,type,offset,offsetY)}else{this.bmpContainer=BitmapNumber.ins().createNumPic(num,type,offset,offsetY)}this.addChild(this.bmpContainer)};BloodContainer.prototype.onLoaded=function(e){var img=e.currentTarget;img.removeEventListener(egret.Event.COMPLETE,this.onLoaded,this);this.resetPosition()};BloodContainer.prototype.resetPosition=function(){var w=0;var h=0;var num=this.numChildren;for(var i=0;i<num;i++){var ch=this.getChildAt(i);ch.x=w;w+=ch.width+this.offset;h=Math.max(h,ch.height)}for(var i=0;i<num;i++){var ch=this.getChildAt(i);ch.y=(h-ch.height)/2}this.width=w-this.offset;this.height=h};BloodContainer.prototype.destroy=function(){while(this.numChildren){var ch=this.removeChildAt(this.numChildren-1);if(ch instanceof eui.Image){ch.removeEventListener(egret.Event.COMPLETE,this.onLoaded,this);BloodLabel.ins().pushImage(ch)}else if(ch instanceof egret.DisplayObjectContainer){BitmapNumber.ins().desstroyNumPic(ch)}}this.bmpContainer=null;BloodLabel.ins().pushContainer(this)};return BloodContainer}(egret.DisplayObjectContainer);__reflect(BloodContainer.prototype,"BloodContainer");var BloodView=function(_super){__extends(BloodView,_super);function BloodView(){var _this=_super.call(this)||this;_this.offY=0;_this.offsetY=0;_this._lastType=0;_this.bloodNum=50;_this.tempBloodViews=[];_this.tick=0;_this.delayCount=0;MessageCenter.addListener(GameLogic.ins().postEntityHpChange,_this.showBlood,_this);egret.startTick(function(){_this.tick++;return false},_this);TimerManager.ins().doTimer(1e3,0,function(){var t=_this.tick;_this.tick=0;if(_this.delayCount<=0){_this.delayCount--;return}if(t>=25)_this.bloodNum=50;else if(t>=15)_this.bloodNum=10;else if(t>=10)_this.bloodNum=5;else _this.bloodNum=0;if(t<25){_this.delayCount=5}},_this);return _this}BloodView.prototype.showBlood=function(_a){var target=_a[0],source=_a[1],type=_a[2],value=_a[3];if(this.tempBloodViews.length>=this.bloodNum){var blood_1=this.tempBloodViews[0];if(blood_1){egret.Tween.removeTweens(blood_1);DisplayUtils.removeFromParent(blood_1);this.destroyBlood(blood_1)}}if(!target||!source)return;if(target.team!=Team.My&&source.team!=Team.My)return;if(target.team==Team.My)type=1;var isDeter=type&DamageTypes.Deter&&source.isMy;var isCrit=type&DamageTypes.CRIT&&!isDeter;var isLucky=type&DamageTypes.Lucky;var isHeji=type&DamageTypes.Heji;var isMiss=type&DamageTypes.Dodge;var isZhiMing=type&DamageTypes.ZhiMing;if(isZhiMing)isCrit=false;this.offY=EntityManager.CHAR_DEFAULT_TYPEFACE-target.typeface;if(this._lastType!=type)this.offsetY=0;this._lastType=type;if(value==0&&!isMiss)return;var chartype="";if(source instanceof CharRole){switch(source.infoModel.job){case JobConst.ZhanShi:chartype="j"+(isCrit||isDeter?0:1);break;case JobConst.FaShi:chartype="j"+(isCrit||isDeter?4:2);break;case JobConst.DaoShi:chartype="j"+(isCrit||isDeter?5:3);break}}else if(source instanceof CharMonster){chartype="j3";var monsterCfg=GlobalConfig.MonstersConfig[source.infoModel.configID];if(monsterCfg&&monsterCfg.type==MonsterType.Ring){chartype="j9";isCrit=true}}if(isHeji||isLucky){chartype="j0"}var numType=target.team==Team.My?"2":chartype;if(isMiss){numType="j0"}var sv="";if(isMiss){sv="s"}else if(isHeji){sv=value<0?"+"+Math.abs(value):"h"+(value>>0)+""}else{sv=value<0?"+"+Math.abs(value):(isCrit?"b":isDeter?"d":isLucky?"b":"")+(value>>0)+""}var st=value<0?"g3":numType;var offsetX=3.5;type&DamageTypes.Fujia||type&DamageTypes.Lianji?this.offsetY+=25:this.offsetY=0;var offsety=this.offsetY;var blood=BloodLabel.ins().createBloodLabel(type,sv,st,offsetX,offsety,source.infoModel.job||1);blood.touchChildren=false;if(type&DamageTypes.Heji){this.addChildAt(blood,1e3)}else{this.addChild(blood)}blood.x=target.x-blood.width/2;blood.y=target.y-50-offsety;var isAddBlood=value<0;if(chartype=="6"){isAddBlood=true}this.floatImg(blood,type,target,source,isAddBlood);this.tempBloodViews.push(blood)};BloodView.prototype.removeFloatTarget=function(floatTarger){DisplayUtils.removeFromParent(floatTarger);this.destroyBlood(floatTarger)};BloodView.prototype.injuredCritLucky=function(floatTarger,t){floatTarger.scaleX=floatTarger.scaleY=BloodView.sc_s0;var posY1=floatTarger.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-80)/2;var posY2=floatTarger.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-30);floatTarger.y=posY1;t.to({y:posY2,scaleX:BloodView.sc_s1,scaleY:BloodView.sc_s1},BloodView.sc_sp1,BloodView.sc_fun1).wait(BloodView.sc_sp2).to({alpha:0,scaleX:BloodView.sc_s2,scaleY:BloodView.sc_s2},BloodView.sc_sp3,BloodView.sc_fun2).call(this.removeFloatTarget,this,[floatTarger])};BloodView.prototype.injured=function(floatTarger,t){floatTarger.scaleX=floatTarger.scaleY=BloodView.sn_s0;var posY1=floatTarger.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-80)/2;var posY2=floatTarger.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-30);floatTarger.y=posY1;t.to({y:posY2,scaleX:BloodView.sn_s1,scaleY:BloodView.sn_s1},BloodView.sn_sp1,BloodView.sn_fun1).wait(BloodView.sn_sp2).to({alpha:0,scaleX:BloodView.sn_s2,scaleY:BloodView.sn_s2},BloodView.sn_sp3,BloodView.sn_fun2).call(this.removeFloatTarget,this,[floatTarger])};BloodView.prototype.atkCritLucky=function(floatTarger,t){var posX=0;var posX2=0;floatTarger.x+=BloodView.c_posX2;floatTarger.scaleX=floatTarger.scaleY=BloodView.c_s0;floatTarger.y=floatTarger.y-BloodView.c_posY1+this.offY;floatTarger.alpha=BloodView.c_alpha0;var endY=floatTarger.y-BloodView.c_posY2;floatTarger.anchorOffsetX=floatTarger.width/2;floatTarger.anchorOffsetY=floatTarger.height/2;floatTarger["originX"]=floatTarger.x;floatTarger["originY"]=floatTarger.y;floatTarger["fly_p"]=0;t.to({fly_p:1},1e3,null).call(this.removeFloatTarget,this,[floatTarger])};BloodView.prototype.atkHeJi=function(floatTarger,t){var posX=0;var posX2=0;var map=ViewManager.gamescene.map;var point=this.localToGlobal();point.x=StageUtils.ins().getWidth()/2;map.globalToLocal(point.x,point.y,point);var ranX=Math.random()*100-50;var ranY=Math.random()*200-100;floatTarger.x=point.x-100-floatTarger.width/2+ranX;floatTarger.x+=BloodView.h_posX1;posX=floatTarger.x+BloodView.h_posX2;posX2=floatTarger.x+BloodView.h_posX3;floatTarger.scaleX=floatTarger.scaleY=BloodView.h_s0;floatTarger.y=floatTarger.y-BloodView.h_posY1+this.offY+ranY;floatTarger.alpha=BloodView.h_alpha0;var endY=floatTarger.y-BloodView.h_posY2;t.to({x:posX,y:endY,scaleX:BloodView.h_s1,scaleY:BloodView.h_s1,alpha:BloodView.h_alpha1},BloodView.h_sp1,BloodView.h_fun1).to({scaleX:BloodView.h_s2,scaleY:BloodView.h_s2,alpha:BloodView.h_alpha2},BloodView.h_sp2,BloodView.h_fun2).to({scaleX:BloodView.h_s3,scaleY:BloodView.h_s3,alpha:BloodView.h_alpha3},BloodView.h_sp3,BloodView.h_fun3).wait(100).to({alpha:BloodView.h_alpha4,y:floatTarger.y+BloodView.h_posY3,x:posX2,scaleX:BloodView.h_s4,scaleY:BloodView.h_s4},BloodView.h_sp4,BloodView.h_fun4).to({alpha:BloodView.h_alpha5,y:floatTarger.y+BloodView.h_posY4,scaleX:BloodView.h_s5,scaleY:BloodView.h_s5},BloodView.h_sp5,BloodView.h_fun5).call(this.removeFloatTarget,this,[floatTarger])};BloodView.prototype.atk=function(floatTarger,t){var posX=0;var posX2=0;floatTarger.x+=BloodView.posX1;posX=floatTarger.x+BloodView.posX2;posX2=floatTarger.x+BloodView.posX3;floatTarger.scaleX=floatTarger.scaleY=BloodView.s4;floatTarger.y=floatTarger.y+BloodView.posY1+this.offY;floatTarger.alpha=BloodView.alpha7;floatTarger.anchorOffsetX=floatTarger.width/2;floatTarger.anchorOffsetY=floatTarger.height/2;floatTarger["originX"]=floatTarger.x-60;floatTarger["originY"]=floatTarger.y;floatTarger["fly_p"]=0;t.to({fly_p:1},1e3,null).call(this.removeFloatTarget,this,[floatTarger])};BloodView.prototype.floatImg=function(floatTarger,type,target,source,isAddBlood){var t=egret.Tween.get(floatTarger);if(source==null||target["team"]==Team.My){if((type&DamageTypes.CRIT)==DamageTypes.CRIT||(type&DamageTypes.Lucky)==DamageTypes.Lucky){this.injuredCritLucky(floatTarger,t)}else{this.injured(floatTarger,t)}}else{var isDeter=(type&DamageTypes.Deter)==DamageTypes.Deter&&source&&source.isMy;var showBigDater=isDeter&&(type&DamageTypes.CRIT)==DamageTypes.CRIT;if(showBigDater||(type&DamageTypes.CRIT)==DamageTypes.CRIT||(type&DamageTypes.Lucky)==DamageTypes.Lucky){this.atkCritLucky(floatTarger,t)}else if((type&DamageTypes.Heji)==DamageTypes.Heji){this.atkHeJi(floatTarger,t)}else{this.atk(floatTarger,t)}}};BloodView.prototype.destroyBlood=function(blood){blood.x=0;blood.y=0;blood.alpha=1;blood.scaleX=blood.scaleY=1;blood.touchChildren=true;if(blood instanceof BloodContainer){blood.destroy()}else{BitmapNumber.ins().desstroyNumPic(blood)}var index=this.tempBloodViews.indexOf(blood);if(~index){this.tempBloodViews.splice(index,1)}};BloodView.sp1=40;BloodView.sp2=40;BloodView.sp3=90;BloodView.sp4=90;BloodView.sp0=720;BloodView.fun1=egret.Ease.circInOut;BloodView.fun2=egret.Ease.backOut;BloodView.fun3=egret.Ease.quadInOut;BloodView.fun4=null;BloodView.fun5=egret.Ease.sineIn;BloodView.s0=.2;BloodView.s1=.4;BloodView.s2=.5;BloodView.s3=.55;BloodView.s4=.6;BloodView.s5=.6;BloodView.posX4=20;BloodView.posX5=30;BloodView.posX6=40;BloodView.posX7=60;BloodView.posX8=70;BloodView.posX9=80;BloodView.posY4=-20;BloodView.posY5=-30;BloodView.posY6=-40;BloodView.posY7=-60;BloodView.posY8=-40;BloodView.posY9=-10;BloodView.alpha6=.8;BloodView.alpha7=1;BloodView.alpha8=.5;BloodView.alpha9=.5;BloodView.sp6=90;BloodView.sp7=90;BloodView.sp8=80;BloodView.sp9=80;BloodView.fun6=null;BloodView.fun7=null;BloodView.fun8=null;BloodView.fun9=null;BloodView.s6=.6;BloodView.s7=.6;BloodView.s8=.4;BloodView.s9=.3;BloodView.posX1=90;BloodView.posX2=0;BloodView.posX3=0;BloodView.posY1=-60;BloodView.posY2=-60;BloodView.posY3=0;BloodView.alpha0=0;BloodView.alpha1=.3;BloodView.alpha2=.32;BloodView.alpha3=.35;BloodView.alpha4=.38;BloodView.alpha5=0;BloodView.startX=70;BloodView.startY=75;BloodView.changeTime1=300;BloodView.changeTime2=1e3;BloodView.changeY=.5;BloodView.bigScale=3;BloodView.endScale=.6;BloodView.bigAlpha=1;BloodView.endAlpha1=1;BloodView.endAlpha2=.3;BloodView.endTime1=600;BloodView.endTime2=500;BloodView.c_sp1=80;BloodView.c_sp2=200;BloodView.c_sp3=200;BloodView.c_sp4=500;BloodView.c_sp5=1200;BloodView.c_fun1=egret.Ease.circInOut;BloodView.c_fun2=egret.Ease.circInOut;BloodView.c_fun3=egret.Ease.sineIn;BloodView.c_fun4=null;BloodView.c_fun5=egret.Ease.sineIn;BloodView.c_s0=.1;BloodView.c_s1=.8;BloodView.c_s2=.8;BloodView.c_s3=.8;BloodView.c_s4=.6;BloodView.c_s5=.1;BloodView.c_posX1=0;BloodView.c_posX2=200;BloodView.c_posX3=120;BloodView.c_posY1=120;BloodView.c_posY2=10;BloodView.c_posY3=200;BloodView.c_posY4=10;BloodView.c_alpha0=1;BloodView.c_alpha1=1;BloodView.c_alpha2=1;BloodView.c_alpha3=.7;BloodView.c_alpha4=0;BloodView.c_alpha5=0;BloodView.h_sp1=80;BloodView.h_sp2=300;BloodView.h_sp3=200;BloodView.h_sp4=1e3;BloodView.h_sp5=1200;BloodView.h_fun1=egret.Ease.circInOut;BloodView.h_fun2=egret.Ease.circInOut;BloodView.h_fun3=egret.Ease.sineIn;BloodView.h_fun4=null;BloodView.h_fun5=egret.Ease.sineIn;BloodView.h_s0=.1;BloodView.h_s1=1.2;BloodView.h_s2=1.2;BloodView.h_s3=1.2;BloodView.h_s4=1.2;BloodView.h_s5=1.2;BloodView.h_posX1=0;BloodView.h_posX2=100;BloodView.h_posX3=120;BloodView.h_posY1=150;BloodView.h_posY2=10;BloodView.h_posY3=-30;BloodView.h_posY4=-30;BloodView.h_alpha0=1;BloodView.h_alpha1=1;BloodView.h_alpha2=1;BloodView.h_alpha3=.6;BloodView.h_alpha4=0;BloodView.h_alpha5=0;BloodView.NORMAL_SCALE_1=1.1;BloodView.NORMAL_SCALE_2=.95;BloodView.sn_sp1=600;BloodView.sn_sp2=200;BloodView.sn_sp3=200;BloodView.sn_fun1=null;BloodView.sn_fun2=null;BloodView.sn_s0=1;BloodView.sn_s1=1.3;BloodView.sn_s2=1.3;BloodView.sc_sp1=600;BloodView.sc_sp2=200;BloodView.sc_sp3=200;BloodView.sc_fun1=null;BloodView.sc_fun2=null;BloodView.sc_s0=1.5;BloodView.sc_s1=1.5;BloodView.sc_s2=1.5;BloodView.C_END_DES=0;BloodView.C_YPOS1=120;BloodView.C_YPOS2=0;BloodView.C_YPOS3=-20;BloodView.C_WAIT1=200;BloodView.C_SPEED1=100;BloodView.C_SPEED2=600;return BloodView}(egret.DisplayObjectContainer);__reflect(BloodView.prototype,"BloodView");var UIView1=function(_super){__extends(UIView1,_super);function UIView1(){var _this=_super.call(this)||this;_this.ft=new FrameTick;return _this}UIView1.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="UIView1Skin";this.touchEnabled=false};UIView1.prototype.initData=function(){if(this.ft.checkAndTick(0))return;CommonUtils.labelIsOverLenght(this.goldTxt,Actor.gold);CommonUtils.labelIsOverLenght(this.ybTxt,Actor.yb);this.nameTxt.text=Actor.myName;this.expChange()};UIView1.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this.observe(GameLogic.ins().postSubRoleChange,this.initData);this.observe(Actor.ins().postGoldChange,this.initData);this.observe(Actor.ins().postYbChange,this.initData);this.observe(Actor.ins().postNameChange,this.initData);this.observe(Actor.ins().postPowerChange,this.initData);this.observe(Actor.ins().postLevelChange,this.expChange);this.addTouchEvent(this.recharge,this.onClick);this.addTouchEvent(this.recharge0,this.onClick);this.initData()};UIView1.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.close.call(this,param);this.removeTouchEvent(this.recharge,this.onClick);this.removeTouchEvent(this.recharge0,this.onClick);this.removeObserve()};UIView1.prototype.onClick=function(e){switch(e.currentTarget){case this.recharge:Recharge.ins().tryShowChargeFirstWin();break;case this.recharge0:if(GameServer.serverOpenDay<2){UserTips.ins().showTips(i18n("UIView1_0"));return}ViewManager.ins().open(FuliWin);break}};UIView1.prototype.expChange=function(){var lv=Actor.level;var zs=UserZs.ins()?UserZs.ins().lv:0;var strLv=i18n("UIView1_3")+(zs?zs+i18n("UIView1_1"):"")+"|";strLv=strLv+lv+i18n("UIView1_2");this.lvTxt.textFlow=TextFlowMaker.generateTextFlow(strLv)};return UIView1}(BaseEuiView);__reflect(UIView1.prototype,"UIView1");ViewManager.ins().reg(UIView1,LayerManager.UI_Popup);var UIView2=function(_super){__extends(UIView2,_super);function UIView2(){var _this=_super.call(this)||this;_this.lastLevel=0;_this.flyExpLevel=[];_this.sstime=0;_this.lastBagFull=undefined;_this.lastEnergy=-1;_this.lastMapID=1;_this.lastEffID=0;_this.viewOpenType=0;_this.canClick=true;_this.tiTmpPt=new egret.Point(0,0);_this._shapParent=new eui.Component;_this._shap=new egret.Shape;_this.radius=0;_this._curAngle=0;_this._toAngle=0;_this._oldAngle=360;_this.hejibntMc={1:"zs_jneff",2:"fs_jneff",3:"ds_jneff"};UIView2.instance=_this;_this.touchEnabled=false;return _this}UIView2.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="UIView2Skin";this.expBar.slideDuration=0;this.escBtn.visible=false;this.navBtn=[this.roleBtn,this.furnaceBtn,this.taskBtn,this.forgingBtn,this.bagBtn];for(var i=0;i<this.navBtn.length;i++){this.navBtn[i]["redPoint"].visible=false}this.navBind=[RoleWin,SkillWin,LiLianWin,ForgeWin,BagWin];this.hjbgMc=new MovieClip;this.hjbgMc.x=51;this.hjbgMc.y=51;this.hjbgMc.touchEnabled=false;this.hjMc=new MovieClip;this.hjMc.x=51;this.hjMc.y=51;this.hjMc.touchEnabled=false;this.yellowCircle.touchEnabled=false;this.blackCircle.touchEnabled=false;this.yellowCircle.visible=false;this.blackCircle.visible=false;this.taskItemImg=new eui.Image;this.taskItemImg.x=250;this.taskItemImg.y=730;this.taskItemImg.visible=false;this.flyItemGroup.addChild(this.taskItemImg);this.backMc=new MovieClip;this.backMc.x=50;this.backMc.y=50;this.isExitUsedItem=false;this.isItemCountChange=false;this.backBtnGroup.visible=false;this.powerGroup.visible=true;this.autoHeji.visible=true;this.guanqiatips.visible=true;this.backBtnGroup.touchEnabled=this.backMc.touchEnabled=false;this.guanqiaBar.slideDuration=0;this.guanQicMc=new MovieClip;this.guanQicMc.touchEnabled=false;this.guanQiaLineMc=new MovieClip;this.guanQiaLineMc.x=83;this.guanQiaLineMc.y=107;this.guanQiaLineMc.touchEnabled=false;this.groupGuanqia.touchEnabled=false;this.expBallMc=new MovieClip;this.expBallMc.x=80;this.expBallMc.y=86;this.expBallMc.touchEnabled=false;var icon=new GuangqiaIconRule(0,this.groupGuanqia);this.upDataGuanQiaInfo();if(GameSceneView.playingCloudAni){GameSceneView.endCloudAni()}this.checkHejiOpen();this.grpGuanqiaBagFull.visible=false;TimerManager.ins().doTimer(1e3,0,this.checkGuanqiaBagFull,this)};UIView2.prototype.checkGuanqiaBagFull=function(){var thisBagFull=UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH;if(thisBagFull!==this.lastBagFull){if(thisBagFull){this.grpGuanqiaBagFull.visible=true}else{this.grpGuanqiaBagFull.visible=false}}this.lastBagFull=thisBagFull};UIView2.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this.lastLevel=Actor.level||0;for(var i=0;i<this.navBtn.length;i++){this.addTouchEvent(this.navBtn[i],this.onClick)}this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.powerGroup,this.onClick);this.addTouchEvent(this.lockImg,this.onClick);this.addTouchEvent(this.btnTest,this.onClick);this.addTouchEvent(this.heji,this.onTap);this.addTouchEvent(this.escBtn,this.onEscBtn);this.observe(UserFb.ins().postGuanqiaInfo,this.upDataGuanQiaInfo);this.observe(UserFb.ins().postFbInfoInit,this.updateAutoPKBoss);this.observe(Actor.ins().postExp,this.expChange);this.observe(Actor.ins().postInit,this.expChange);this.observe(UserRole.ins().postRoleHint,this.showRoleBtnRedPoint);this.observe(GameLogic.ins().postMpChange,this.updateHuShen);this.observe(GameLogic.ins().postCreateOtherEntity,this.updateHuShen);this.observe(GameLogic.ins().postHpChange,this.flyGQBossExpToBar);this.observe(UserTask.ins().postParabolicItem,this.runItem);this.observe(UserBag.ins().postItemCountChange,this.showBagBtnRedPoint);this.observe(ForgeRedPoint.ins().postForgeRedPoint,this.showForgingBtnRedPoint);this.observe(UserBag.ins().postBagWillFull,this.setBagTips);this.observe(UserBag.ins().postHasItemCanUse,this.setIsExitUsedItem);this.observe(UserBoss.ins().postBossAppear,this.onBossAppear);this.observe(MonsterSpeak.ins().postMonsterSpeak,this.onMonsterSpeak);this.observe(UserFb.ins().postExpFly,this.flyExpToBar);this.observe(Encounter.ins().postFightResult,this.onFightResult);this.observe(NeiGong.ins().postNeiGongDataChange,this.startUpdateRedPoint);this.observe(UserJingMai.ins().postUpdate,this.startUpdateRedPoint);this.observe(UserBag.ins().postItemAdd,this.startUpdateRedPoint);this.observe(UserZs.ins().postZsData,this.startUpdateRedPoint);this.observe(Actor.ins().postLevelChange,this.onLevelChange);this.observe(Actor.ins().postGoldChange,this.startUpdateRedPoint);this.observe(UserSkill.ins().postSkillUpgradeAll,this.startUpdateRedPoint);this.observe(ZhanLing.ins().postZhanLingComposeItem,this.startUpdateRedPoint);this.observe(ZhanLing.ins().postZhanLingInfo,this.startUpdateRedPoint);this.observe(ZhanLing.ins().postZhanLingUpExp,this.startUpdateRedPoint);this.observe(ZhanLing.ins().postZhanLingDrug,this.startUpdateRedPoint);this.observe(ZhanLing.ins().postZhanLingWear,this.startUpdateRedPoint);this.observe(GameLogic.ins().postViewOpen,this.checkViewOpen);this.observe(UserBag.ins().postItemAdd,this.setLilianRedPoint);this.observe(LiLian.ins().postLilianData,this.setLilianRedPoint);this.observe(LiLian.ins().postNobilityData,this.setLilianRedPoint);this.observe(UserTask.ins().postTaskChangeData,this.setLilianRedPoint);this.observe(Artifact.ins().postNewArtifactUpdate,this.setLilianRedPoint);this.observe(Artifact.ins().postNewArtifactInit,this.setLilianRedPoint);this.observe(BookRedPoint.ins().postRedPoint,this.setLilianRedPoint);this.observe(Actor.ins().postLevelChange,this.setLilianRedPoint);this.observe(LiLian.ins().postJadeLv,this.setLilianRedPoint);this.observe(UserBag.ins().postItemChange,this.setLilianRedPoint);this.observe(UserSkill.ins().postHejiRemove,this.resetHejiCd);this.observe(UserSkill.ins().postHejiStartCD,this.resetHejiCd);this.observe(UserSkill.ins().postHejiUpdate,this.checkHejiOpen);this.observe(LiLian.ins().postGetLilianReward,this.lilianRewardFlash);this.observe(Guild.ins().postGuildCreate,this.setRedPiont);this.observe(Guild.ins().postProcessJoin,this.setRedPiont);this.observe(GameLogic.ins().postFlyItem,this.flyItemToBag);this.observe(GameLogic.ins().postFlyItemEx,this.flyItemToBagEx);this.observe(Recharge.ins().postRecharge1Data,this.setRedPiont);this.observe(UserBag.ins().postItemAdd,this.setRedPiont);this.observe(UserBag.ins().postItemDel,this.setRedPiont);this.observe(UserBag.ins().postItemChange,this.setRedPiont);this.observe(GameLogic.ins().postEnterMap,this.cleanPowerGuilderEff);this.observe(UserFb.ins().postGuanKaIdChange,this.showAdvanceTitle);this.observe(Actor.ins().postLevelChange,this.showAdvanceTitle);this.observe(GameLogic.ins().postEnterMap,this.initescBtn);this.powerGroup.addChild(this._shapParent);this._shapParent.addChild(this._shap);this.yellowCircle.mask=this._shapParent;this.checkHejiOpen();if(UserSkill.ins().hejiLevel>0)UserSkill.ins().postHejiStartCD();this.startUpdateRedPoint();this.showForgingBtnRedPoint();this.setSSTime(-1);this.guanqiaBtn2.visible=false;this.guanqiaBtn1.visible=true;this.addTouchEvent(this.guanqiaBtn1,this.onTaskTrace);this.addTouchEvent(this.guanqiaBtn1,this.guanqiaBtnClick);this.addTouchEvent(this.guanqiaBtn2,this.onTaskTrace);this.addTouchEvent(this.guanqiaBtn2,this.guanqiaBtnClick);this.observe(UserFb.ins().postAutoPk,this.GuanQiaEffLogic);this.observe(UserFb.ins().postAutoPk2,this.GuanQiaEffLogic);this.observe(GameLogic.ins().postExpMc,this.addExpFlyMc);this.observe(GameLogic.ins().postEnterMap,this.upDataGuanqia);this.observe(UserFb.ins().postAddEnergy,this.upDataGuanqia);this.observe(ShapeShiftingMgr.ins().postShapeStart,this.onShapeStart);this.observe(ShapeShiftingMgr.ins().postShapeStartClient,this.onShapeStart);this.observe(ShapeShiftingMgr.ins().postShapeEnd,this.onShapeEnd);this.observe(ShapeShiftingMgr.ins().postShapeEndClient,this.onShapeEnd)};UIView2.prototype.countTime=function(){this.sstime-=1;this.setSSTime(this.sstime)};UIView2.prototype.setSSTime=function(time){if(time===void 0){time=-1}if(time>-1){this.ssTime.text=time+"s"}else{this.ssTime.text="";this.sstime=GlobalConfig.ShapeShiftingBaseConfig.time;TimerManager.ins().remove(this.countTime,this)}};UIView2.prototype.onShapeStart=function(param){this.setClickDelay();var isMe=param;if(!isMe){return}if(ShapeShiftingMgr.ins().getIsInShape()==false){return}if(!this.bianshenMc){this.bianshenGroup.removeChildren();var mc=new MovieClip;this.bianshenGroup.addChild(mc);mc.playFile(RES_DIR_EFF+"zdf_bszeff",-1);this.bianshenMc=mc}this.setSSTime(-1);var c=GlobalConfig.ShapeShiftingBaseConfig.time;this.setSSTime(c);TimerManager.ins().doTimer(1e3,c,this.countTime,this)};UIView2.prototype.onShapeEnd=function(){this.setClickDelay();this.bianshenGroup.removeChildren();this.bianshenMc=null;this.setSSTime(-1)};UIView2.prototype.upDataExpMcBall=function(){var value=UserFb.ins().currentEnergy;var total=UserFb.ins().energy;this.setGuanQiaBar(value,total)};UIView2.prototype.setGuanQiaBar=function(cur,total){var curValue=cur;var maxValue=total;if(curValue>=maxValue)curValue=maxValue;this.guanqiaBar.value=curValue;this.guanqiaBar.maximum=maxValue;this.guanqiaBar.labelFunction=function(){return""}};UIView2.prototype.addExpFlyMc=function(mon){var _this=this;if(GameMap.fbType==UserFb.FB_TYPE_EXP)return;if(!UserFb.ins().checkGuanqiaIconShow()){UserFb.ins().postAddEnergy();return}var movieExp=new eui.Image;movieExp.source="point";movieExp.anchorOffsetX=20;movieExp.anchorOffsetY=20;var map=ViewManager.gamescene.map;var point=this.localToGlobal();map.globalToLocal(point.x,point.y,point);movieExp.x=mon.x-point.x;movieExp.y=mon.y-point.y;this.addChild(movieExp);var tweenX=this.groupGuanqia.x+60;var tweenY=this.groupGuanqia.y+60;var t=egret.Tween.get(movieExp);t.to({x:tweenX,y:tweenY,alpha:.5},600).call(function(){UserFb.ins().postAddEnergy();_this.removeChild(movieExp);egret.Tween.removeTweens(movieExp)},this);var tt=egret.Tween.get(movieExp,{loop:true});tt.to({rotation:movieExp.rotation+360},800)};UIView2.prototype.playGuanQiaDoorMc=function(){if(!this.eyesMc)this.eyesMc=new MovieClip;if(!this.eyesMc.parent){this.guanqiaEff1.addChild(this.eyesMc);this.eyesMc.x=0;this.eyesMc.y=0}this.eyesMc.playFile(RES_DIR_EFF+"guankaeye",1)};UIView2.prototype.upDataGuanQiaInfo=function(){this.upDataGuanqia()};UIView2.prototype.showAdvanceTitle=function(){var len=SubRoles.ins().subRolesLen;var charRole;for(var i=0;i<len;i++){charRole=EntityManager.ins().getMainRole(i);if(charRole)charRole.setAdvanceTitle()}};UIView2.prototype.initescBtn=function(){if(GameMap.sceneInMain()||GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS||GameMap.fbType==UserFb.FB_TYPE_CITY||GameMap.fbType==UserFb.FB_TYPE_FIRE_RING||GameMap.fbType==UserFb.FB_TYPE_PEAK){this.escBtn.visible=false;this.guanqiatips.visible=true;this.autoPkBoss.visible=true;this.guanqiaBtn1.visible=true}else{this.escBtn.visible=true;this.guanqiatips.visible=false;this.autoPkBoss.visible=false;this.guanqiaBtn1.visible=false}};UIView2.prototype.upDataGuanqia=function(){var gqID=UserFb.ins().guanqiaID;if(gqID>=0&&GameMap.sceneInMain()){this.upDataExpMcBall();if(UserFb.ins().energy&&UserFb.ins().currentEnergy>=UserFb.ins().energy){this.guanqiaBtn1.visible=false;this.guanqiaBtn2.visible=true;if(this.guanQicMc&&!this.guanQicMc.parent){var mapID=GameMap.mapID;if(mapID!=this.lastMapID){this.lastMapID=mapID;this.lastEffID+=1;if(this.lastEffID>9){this.lastEffID=0}}var res="guankabtn"+this.lastEffID;this.guanQicMc.playFile(RES_DIR_EFF+res,-1);this.guanQicMc.x=3;this.guanQicMc.y=-16;this.guanqiaEff0.addChild(this.guanQicMc);this.guanqiaEff0.touchEnabled=this.guanQicMc.touchEnabled=false}}else{if(UserFb.ins().energy>0&&this.lastEnergy!=UserFb.ins().currentEnergy&&this.lastEnergy!=-1){this.playGuanQiaDoorMc()}this.guanqiaBtn1.visible=true;this.guanqiaBtn2.visible=false;DisplayUtils.removeFromParent(this.guanQicMc)}this.lastEnergy=UserFb.ins().currentEnergy}else{if(gqID>0){if(gqID<GlobalConfig.OpenSystemConfig[SystemType.CHALLENGE].opencheck){this.guanqiaBtn1.visible=true;DisplayUtils.removeFromParent(this.guanQicMc)}else{if(this.guanQicMc&&!this.guanQicMc.parent){this.guanqiaBtn1.visible=true}else{this.guanqiaBtn1.visible=false}}}else if(!GameMap.sceneInMain()){this.guanqiaBtn1.visible=true;DisplayUtils.removeFromParent(this.guanQicMc)}else{this.guanqiaBtn1.visible=false}this.guanqiaBtn2.visible=false;this.lastEnergy=-1}if(gqID<GlobalConfig.OpenSystemConfig[SystemType.CHALLENGE].opencheck)this.pkBossBtnGroup.visible=false;else this.pkBossBtnGroup.visible=true;this.updateAutoPKBoss()};UIView2.prototype.updateAutoPKBoss=function(){if(UserFb.ins().checkInOtherFB(false)){this.autoPkBoss.visible=false}else if(UserFb.ins().guanqiaID<GlobalConfig.OpenSystemConfig[SystemType.CHALLENGE].opencheck){this.autoPkBoss.visible=false}else{this.autoPkBoss.visible=true}};UIView2.prototype.onTaskTrace=function(e){var data=UserTask.ins().taskTrace;if(data&&data.state==0){var config=UserTask.ins().getAchieveConfById(data.id);switch(config.control){case GuideType.ChallengeBoss:case GuideType.AutoPk:if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){return}if(UserFb.ins().currentEnergy<UserFb.ins().energy){UserTips.ins().showTaskTips(i18n("UIView2_0"))}if(config.control==GuideType.AutoPk){Hint.ins().postKillBoss(config)}break;case GuideType.KillDeer:var text=i18n("UIView2_1",config.target-data.value);UserTips.ins().showTaskTips(text);break}}};UIView2.prototype.guanqiaBtnClick=function(e){this.grpGuanqiaBagFull.visible=false;if(UserFb.ins().guanqiaID>=GlobalConfig.InstanceBaseConfig.maxCheckPoint){UserTips.ins().showCenterTips(i18n("UIView2_2"));return}if(UserFb.ins().checkInOtherFB()){return}if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin)}else{if(UserFb.ins().currentEnergy>=UserFb.ins().energy){this.GuanQiacleanEff();UserFb.ins().autoPk();UserFb.ins().firstAutoGuilder=UserFb.ins().guanqiaID==GlobalConfig.OpenSystemConfig[SystemType.CHALLENGE].opencheck-1}else{}}};UIView2.prototype.GuanQiaEffLogic=function(){var _this=this;if(this.guanqiaBtn1&&UserFb.ins().showAutoPk==0){UserFb.ins().showAutoPk=1;if(!this.arrow){this.arrow=new GuideArrow2;this.arrow.touchEnabled=false;this.arrow.touchChildren=false;this.arrow.lab.text=i18n("UIView2_4");this.arrow.setDirection(1);this.parent.addChildAt(this.arrow,1e4);var point=this.guanqiaBtn1.localToGlobal();this.parent.globalToLocal(point.x,point.y,point);this.arrow.x=point.x+this.guanqiaBtn1.width*.8+14;this.arrow.y=point.y+this.guanqiaBtn1.height*.8/2+22;if(!this.eff){this.eff=new MovieClip;this.eff.playFile(RES_DIR_EFF+"guideff",-1);this.groupGuanqia.addChild(this.eff);this.eff.x=this.guanqiaBtn1.x+this.guanqiaBtn1.width*.8/2+8;this.eff.y=this.guanqiaBtn1.y+this.guanqiaBtn1.height*.8/2+12}egret.Tween.get(this,{loop:false}).wait(5e3).call(function(){UserFb.ins().showAutoPk=-1;DisplayUtils.removeFromParent(_this.eff);DisplayUtils.removeFromParent(_this.arrow);if(_this.arrow)egret.Tween.removeTweens(_this.arrow);_this.arrow=null;_this.eff=null})}}else if(this.pkBossBtnGroup&&UserFb.ins().showAutoPk2==0){UserFb.ins().showAutoPk2=1;if(!this.arrow){this.arrow=new GuideArrow2;this.arrow.touchEnabled=false;this.arrow.lab.text=i18n("UIView2_5");this.addChild(this.arrow);var point=this.pkBossBtnGroup.localToGlobal();this.globalToLocal(point.x,point.y,point);this.arrow.x=point.x+50;this.arrow.y=point.y+23;this.arrow.setDirection(1);if(!this.eff){this.eff=new MovieClip;this.eff.playFile(RES_DIR_EFF+"guideff",-1);this.groupGuanqia.addChild(this.eff);this.eff.x=this.pkBossBtnGroup.x;this.eff.y=this.pkBossBtnGroup.y}egret.Tween.get(this,{loop:false}).wait(5e3).call(function(){UserFb.ins().showAutoPk2=-1;DisplayUtils.removeFromParent(_this.eff);DisplayUtils.removeFromParent(_this.arrow);if(_this.arrow)egret.Tween.removeTweens(_this.arrow);_this.arrow=null;_this.eff=null})}}};UIView2.prototype.GuanQiacleanEff=function(){UserFb.ins().showAutoPk=-1;UserFb.ins().showAutoPk2=-1;DisplayUtils.removeFromParent(this.eff);DisplayUtils.removeFromParent(this.arrow);if(this.arrow)egret.Tween.removeTweens(this.arrow);this.arrow=null;this.eff=null};UIView2.prototype.checkHejiOpen=function(){if(UserSkill.ins().hejiLevel>0){this.powerGroup.touchEnabled=true;this.lockImg.visible=false;this.hejiskill.visible=true;var job=SubRoles.ins().getFirstJob();this.hejiskill.source="zjmhejijob"+job;this.autoHeji.visible=this.viewOpenType!=1}else{this.powerGroup.touchEnabled=false;this.lockImg.visible=true;this.hejiskill.visible=false;this.autoHeji.visible=false}var cur=SysSetting.ins().getBool(SysSetting.AUTO_HEJI);this.hejiState(cur)};UIView2.prototype.onTap=function(){var cur=SysSetting.ins().getBool(SysSetting.AUTO_HEJI);SysSetting.ins().setBool(SysSetting.AUTO_HEJI,!cur);this.hejiState(!cur)};UIView2.prototype.hejiState=function(state){this.heji.icon=!state?"noheji_png":"heji_png"};UIView2.prototype.checkViewOpen=function(param){var type=param[0];this.viewOpenType=type;if(type==1){this.backBtnGroup.visible=true;this.powerGroup.visible=false;this.autoHeji.visible=false;this.groupGuanqia.visible=true;if(!this.backMc.parent){this.backMc.playFile(RES_DIR_EFF+"fanhuibtneff",-1);this.backBtnGroup.addChild(this.backMc)}}else{this.backBtnGroup.visible=false;this.powerGroup.visible=true;this.autoHeji.visible=UserSkill.ins().hejiLevel>0;this.groupGuanqia.visible=true;DisplayUtils.removeFromParent(this.backMc)}this.checkShowHejiIcon(type)};UIView2.prototype.checkShowHejiIcon=function(type){if(Artifact.ins().openHeji==2){if(type==0){TimerManager.ins().doTimer(50,1,this.showHejiIcon,this)}else{TimerManager.ins().remove(this.showHejiIcon,this)}}};UIView2.prototype.showHejiIcon=function(){if(Artifact.ins().openHeji==2&&UserSkill.ins().hejiLevel>0){var role=SubRoles.ins().getSubRoleByIndex(0);if(!role)return;Artifact.ins().openHeji=-1;var job=role.job;var config=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel];var curSkill=new SkillData(config.skill_id[job-1]);var icon_1=new eui.Image(curSkill.id+"_png");icon_1.anchorOffsetX=32;icon_1.anchorOffsetY=32;icon_1.scaleX=4;icon_1.scaleY=4;icon_1.x=this.width/2;icon_1.y=this.height/2;this.addChild(icon_1);var toX=this.powerGroup.x+this.powerGroup.width/2;var toY=this.powerGroup.y+this.powerGroup.height/2;egret.Tween.get(icon_1).to({scaleX:1,scaleY:1},200).to({x:toX,y:toY},600).to({scaleX:0,scaleY:0},200).call(function(){icon_1.parent.removeChild(icon_1)})}};UIView2.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this)};UIView2.prototype.showRoleBtnRedPoint=function(b){this.roleBtn["redPoint"].visible=b>0};UIView2.prototype.showBagBtnRedPoint=function(b){this.isItemCountChange=b>0;this.setRedPiont()};UIView2.prototype.showForgingBtnRedPoint=function(){this.forgingBtn["redPoint"].visible=ForgeRedPoint.ins().redPoint};UIView2.prototype.setLilianRedPoint=function(){var lilian=LiLian.ins();var isMaxLevel=LiLian.ins().getNobilityIsMaxLevel();var flag=lilian.getLilianShenGongStast()||Artifact.ins().showRedPoint()||lilian.checkXunZhangOpen()&&lilian.getNobilityIsUpGrade()&&!isMaxLevel||Artifact.ins().showRedPoint()||BookRedPoint.ins().redpoint||lilian.checkJadeRed();this.taskBtn["redPoint"].visible=flag};UIView2.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:SoundUtil.ins().playEffect(SoundUtil.WINDOW);var view=ViewManager.ins().getView(RoleWin);if(view&&view.getWingPanelInfo()){view.doOpenHintWin(2)}else{ViewManager.ins().closeLastTopView()}break;case this.btnTest:break;case this.lockImg:UserTips.ins().showTips(i18n("UIView2_6",UserSkill.ACTIVE_LEVEL));break;case this.powerGroup:if(ShapeShiftingMgr.ins().getIsInShape()==true){return}if(!this.canClick){return}if(UserSkill.ins().hejiLevel<=0){return}if(!this.hjMc||!this.hjMc.parent){UserTips.ins().showTips(i18n("UIView2_7"));return}this.cleanPowerGuilderEff();var state=this.useHejiSkill();if(state==-1){UserTips.ins().showTips(i18n("UIView2_8"))}else if(state==-2){UserTips.ins().showTips(i18n("UIView2_9"))}else if(state==-3){UserTips.ins().showTips(i18n("UIView2_10"))}break;default:var index=this.navBtn.indexOf(e.currentTarget);if(this.navBtn[index].selected){var win=this.openWindow(index);if(!win){this.navBtn[index].selected=false}}else{this.closeWindow(index)}for(var i=0;i<this.navBtn.length;i++){if(index!=i){this.closeWindow(i)}}break}};UIView2.prototype.onEscBtn=function(){GameSceneView.instance.onEscBtn()};UIView2.prototype.useHejiSkill=function(){if(UserSkill.ins().hejiEnable&&this.canClick){var skill=UserSkill.ins().getHejiSkillId();var role=EntityManager.ins().getNoDieRole();if(!role){return}if(GameMap.fbType==UserFb.FB_TYPE_GUILD_WAR||GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS||CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||BattleGround.ins().isPaoDian){var handle=GameLogic.ins().currHandle;var entity=EntityManager.ins().getEntityByHandle(handle);if(!handle||!entity||entity.infoModel.getAtt(AttributeType.atHp)<=0){return-2}}this.canClick=false;TimerManager.ins().doTimer(1500,1,this.setClickDelay,this);if(GameMap.fubenID!=0&&!GameMap.sceneInMine()){var len=SubRoles.ins().subRolesLen;var charRole=void 0;var isStraight=false;for(var i=0;i<len;i++){charRole=EntityManager.ins().getMainRole(i);if(charRole&&charRole.infoModel&&charRole.infoModel.getAtt(AttributeType.atHp)>0){break}}if(charRole.hasEffById(1)){isStraight=true}if(isStraight||charRole.hasBuff(51001)||charRole.hasBuff(14001)||charRole.hasBuff(70001)){return-3}UserSkill.ins().sendUseHejiSkill()}else{UserSkill.ins().fieldUse=true}}else{}};UIView2.prototype.setClickDelay=function(){this.canClick=true};UIView2.prototype.openWindow=function(index){if(KFServerSys.ins().checkIsKFBattle(i18n("UIView2_15"))){return}return ViewManager.ins().open(this.navBind[index])};UIView2.prototype.closeWindow=function(index){ViewManager.ins().close(this.navBind[index])};UIView2.prototype.expChange=function(exp,force){var _this=this;if(force===void 0){force=false}if(!force&&GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS)return;if(!this.lastLevel){this.lastLevel=Actor.level}var isNew=this.flyExpLevel.length==0;if(this.flyExpLevel.length){this.flyExpLevel[this.flyExpLevel.length-1][0]=Actor.level;this.flyExpLevel[this.flyExpLevel.length-1][1]=Actor.exp}else{this.flyExpLevel.push([Actor.level,Actor.exp])}var newLv=this.flyExpLevel[0][0];var newExp=this.flyExpLevel[0][1];if(this.lastLevel<newLv){if(!this.expBar["tween_count"]||isNew){var maxExp_1=Math.ceil(GlobalConfig.ExpConfig[this.lastLevel].exp);egret.Tween.removeTweens(this.expBar);var tween=egret.Tween.get(this.expBar);tween.to({value:this.expBar.maximum},300).wait(100).call(function(){_this.expBar.maximum=maxExp_1;_this.expBar.value=0;_this.lastLevel+=1;GameLogic.ins().postLevelBarChange(_this.lastLevel);SoundUtil.ins().playEffect(SoundUtil.LEVEL_UP);_this.expChange()},this)}}else{egret.Tween.removeTweens(this.expBar);var maxExp=Math.ceil(GlobalConfig.ExpConfig[newLv].exp);if(this.expBar.maximum!=maxExp){this.expBar.maximum=maxExp}var tween=egret.Tween.get(this.expBar);tween.to({value:newExp},400);this.flyExpLevel.shift()}};UIView2.prototype.closeNav=function(index){this.navBtn[index].selected=false};UIView2.prototype.updateHuShen=function(model){};UIView2.prototype.onBossAppear=function(){if(GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU)return;this.showEffectTips("zdbossskin_json.bosstishi")};UIView2.prototype.onMonsterSpeak=function(tips){this.showEffectTips(tips)};UIView2.prototype.onFightResult=function(result){if(result){this.showEffectTips("pktishi_png")}else{this.showEffectTips("pktishi1_png")}};UIView2.prototype.showEffectTips=function(tipsStr){var _this=this;this.tips.touchEnabled=false;this.tips.source=tipsStr;egret.Tween.removeTweens(this.tips);this.tips.visible=true;this.tips.alpha=1;egret.Tween.get(this.tips).wait(4e3).to({alpha:0},1e3).call(function(){_this.tips.visible=false})};UIView2.prototype.lilianUpgradeSuccess=function(soureArr){var self=this;var _loop_16=function(i){var img=new eui.Image;img.source=soureArr[i];img.x=261+i*63;img.y=200;self.addChild(img);img.visible=false;var tween=egret.Tween.get(img);tween.wait(130*i).to({visible:true},1).to({x:326,y:730},900).call(function(){self.removeChild(img)})};for(var i=0;i<3;i++){_loop_16(i)}};UIView2.prototype.lilianGetRankSuccess=function(soure){var self=this;var img=new eui.Image;img.source=soure;img.x=260;img.y=100;this.addChild(img);var tween=egret.Tween.get(img);tween.to({x:326,y:730},1e3).call(function(){self.removeChild(img)})};UIView2.prototype.runItem=function(){var data=UserTask.ins().taskTrace;var awardList=UserTask.ins().getAchieveConfById(data.id).awardList;this.runStrat(awardList,0)};UIView2.prototype.runStrat=function(awardList,index){var str="";var awardId=awardList[index].id;var awardType=awardList[index].type;var awardCount=awardList[index].count;var isAni=false;if(awardType==0){switch(awardId){case MoneyConst.exp:str="";return;case MoneyConst.gold:str="resource/res/eff/coinfly_eff";isAni=true;break;case MoneyConst.yuanbao:str="resource/image/item/"+"icgoods121.png";break}}else{str="resource/image/item/"+""+awardId+".png"}var taskTraceBtn=PlayFunView.instance.taskTraceBtn;if(!taskTraceBtn||!taskTraceBtn.parent){return}var stagePt=taskTraceBtn.parent.localToGlobal(taskTraceBtn.x,taskTraceBtn.y,this.tiTmpPt);var num=0;var endPt="";if(awardType==0){if(awardId==MoneyConst.gold){num=Math.ceil(40*Math.pow(awardCount/1e5,.37));endPt="gold"}if(awardId==MoneyConst.yuanbao){num=Math.ceil(awardCount/10);endPt="yuanbao"}}else{endPt="bag";num=Math.ceil(30*Math.pow(awardCount/1e3,.45))}if(num>50){num=50}if(num>0){var btnw=taskTraceBtn.width;var btnh=taskTraceBtn.height;for(var i=0;i<num;++i){MainAniMgr.ins().playDrop(str,isAni,1,stagePt.x+btnw*Math.random(),stagePt.y+btnh*Math.random(),endPt,undefined,i==0?0:(num-1)*500/10*Math.random())}}this.taskItemImg.visible=false};UIView2.prototype.setBagTips=function(result){var self=this;if(!this.bagBtn.visible){this.groupBagTips.visible=false;return}this.groupBagTips.visible=result>0;if(result){if(result==2){this.tipsText.text=i18n("UIView2_16")}else if(result==-1){this.tipsText.text=i18n("UIView2_17");this.groupBagTips.visible=true;setTimeout(function(){if(self.tipsText.text==i18n("UIView2_17")){self.groupBagTips.visible=false;self.tipsText.text=""}},4e3)}else{this.tipsText.text=i18n("UIView2_19")}}};UIView2.prototype.setIsExitUsedItem=function(result){this.isExitUsedItem=UserBag.ins().getIsExitUsedItem();this.setRedPiont()};UIView2.prototype.setRedPiont=function(b){if(b){this.bagBtn["redPoint"].visible=b;return}if(this.isExitUsedItem||this.isItemCountChange||UserBag.ins().getBagGoodsCountByType(8)||UserBag.ins().getBagGoodsCountByType(12)||UserBag.ins().getRuneBagGoodsCountByType(8)||MergeCC.ins().isOpen()&&MergeCC.ins().redPoint()){this.bagBtn["redPoint"].visible=true}else{this.bagBtn["redPoint"].visible=false}};UIView2.prototype.resetHejiCd=function(){this.reset();this.hjMc.stop();this.hjbgMc.stop();DisplayUtils.removeFromParent(this.hjMc);DisplayUtils.removeFromParent(this.hjbgMc);this.yellowCircle.visible=true;this.blackCircle.visible=true;this._shap.graphics.clear();if(!TimerManager.ins().isExists(this.showAni,this))TimerManager.ins().doTimer(500,0,this.showAni,this);this.drawProgress(0)};UIView2.prototype.reset=function(){this._curAngle=0;this._toAngle=0;this._oldAngle=360;UserSkill.ins().hejiEnable=false;UserSkill.ins().fieldUse=false;this.radius=this.powerGroup.width>>1};UIView2.prototype.showAni=function(){var skill=UserSkill.ins().getHejiSkillId();if(ShapeShiftingMgr.ins().getIsInShape()==true){UserSkill.ins().hejiCD+=500;return}var cdPercent=1-(UserSkill.ins().hejiCD-GameServer.serverTime)/(skill.cd-UserSkill.ins().reduceCD);var count=360*cdPercent;this.drawProgress(count)};UIView2.prototype.drawProgress=function(toPos,isTween){if(isTween===void 0){isTween=true}if(toPos>360){toPos=360}if(ShapeShiftingMgr.ins().getIsInShape()==true){toPos=0;this.curAngle=0;UserSkill.ins().hejiEnable=false}if(toPos<0)toPos=0;if(toPos==0||this.curAngle==360){if(this.curAngle==360){UserSkill.ins().hejiEnable=true;this.addAutoUse();this.addPowerEff()}egret.Tween.removeTweens(this);return}this.removeAutoUse();this._toAngle=toPos;this._shapParent.x=this._shapParent.y=this.radius;this._shap.rotation=-90;egret.Tween.removeTweens(this);egret.Tween.get(this).to({curAngle:this._toAngle},500).call(function(){if(this.curAngle==360){UserSkill.ins().hejiEnable=true;this.addAutoUse()}},this)};UIView2.prototype.addPowerEff=function(){if(!this.hjMc.isPlaying){var job=SubRoles.ins().getFirstJob();var res=this.hejibntMc[job];this.hjMc.playFile(RES_DIR_EFF+res,-1)}if(!this.hjbgMc.isPlaying){this.hjbgMc.playFile(RES_DIR_EFF+"zdf_jncf_eff",1)}if(this.hjMc&&this.hjMc.parent)return;this.hejiMcGroup.addChild(this.hjMc);this.hejiMcGroup.addChild(this.hjbgMc);this.powerGuilderEff();this.yellowCircle.visible=false;this.blackCircle.visible=false};UIView2.prototype.powerGuilderEff=function(){if(UserFb.ins().guanqiaID>16){this.cleanPowerGuilderEff();return}if(!UserFb.ins().pkGqboss){this.cleanPowerGuilderEff();return}if(!this.arrow){this.arrow=new GuideArrow2;this.arrow.touchEnabled=false;this.arrow.lab.text=i18n("UIView2_20");this.powerGroup.addChild(this.arrow);this.arrow.x=40;this.arrow.y=this.powerGroup.height/2+10;this.arrow.setDirection(0);if(!this.eff){this.eff=new MovieClip;this.eff.playFile(RES_DIR_EFF+"guideff",-1);this.powerGroup.addChild(this.eff);this.eff.x=this.powerGroup.width/2;this.eff.y=this.powerGroup.height/2}var self_7=this;egret.Tween.get(this.powerGroup,{loop:false}).wait(5e3).call(function(){self_7.cleanPowerGuilderEff()})}};UIView2.prototype.cleanPowerGuilderEff=function(){if(this.arrow)egret.Tween.removeTweens(this.arrow);if(this.eff)egret.Tween.removeTweens(this.eff);DisplayUtils.removeFromParent(this.arrow);DisplayUtils.removeFromParent(this.eff);this.removeAutoUse();this.arrow=null;this.eff=null};UIView2.prototype.addAutoUse=function(){if(UserSkill.ins().hejiEnable&&this.checkIsAutoUse()){if(!TimerManager.ins().isExists(this.autoUseHeji,this)){TimerManager.ins().doTimer(400,0,this.autoUseHeji,this)}}};UIView2.prototype.checkIsAutoUse=function(){var handle=GameLogic.ins().currHandle;var entity=EntityManager.ins().getEntityByHandle(handle);return entity&&entity.infoModel.type!=EntityType.CollectionMonst&&SysSetting.ins().getBool(SysSetting.AUTO_HEJI)||SysSetting.ins().getBool(SysSetting.AUTO_HEJI)&&(GameMap.fbType!=UserFb.FB_TYPE_HOMEBOSS&&GameMap.fbType!=UserFb.FB_TYPE_NEW_WORLD_BOSS&&GameMap.fbType!=UserFb.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=UserFb.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=UserFb.FB_TYPE_GUILD_WAR&&GameMap.fbType!=UserFb.FB_TYPE_PEAKED&&GameMap.fbType!=UserFb.FB_TYPE_KF_BOSS&&!CityCC.ins().isCity&&!BattleCC.ins().isBattle()&&!PaoDianCC.ins().isPaoDian&&!BattleGround.ins().isPaoDian&&!GwBoss.ins().isGwBoss&&!GwBoss.ins().isGwTopBoss&&!DarkMjBoss.ins().isDarkBoss)};UIView2.prototype.removeAutoUse=function(){TimerManager.ins().remove(this.autoUseHeji,this)};UIView2.prototype.autoUseHeji=function(){this.useHejiSkill()};Object.defineProperty(UIView2.prototype,"curAngle",{get:function(){return this._curAngle},set:function(value){this._curAngle=value;DisplayUtils.drawCir(this._shap,this.radius,this._curAngle)},enumerable:true,configurable:true});UIView2.prototype.jingMaiCanUp=function(){var data;for(var i in SubRoles.ins().roles){data=SubRoles.ins().roles[i].jingMaiData;if(data.jingMaiCanUp()){var openLevel=GlobalConfig.JingMaiCommonConfig.openLevel;if(Actor.level>=openLevel)return true}}return false};UIView2.prototype.getToggleBtn=function(index){this.validateNow();return this.navBtn[index]};UIView2.prototype.lilianRewardFlash=function(source){var self=this;var len=source.length;var _loop_17=function(i){var img=new eui.Image;img.source=source[i];img.x=74+i*91;img.y=260;self.addChild(img);img.visible=false;img.scaleX=img.scaleY=1;var tween=egret.Tween.get(img);tween.wait(130*i).to({visible:true},1).to({x:441,y:872,scaleX:.6,scaleY:.6},900).call(function(){self.removeChild(img)})};for(var i=0;i<len;i++){_loop_17(i)}};UIView2.prototype.onLevelChange=function(){var lv=Actor.level;if(lv==10){ChannelNet.ins().checkShowWin()}this.startUpdateRedPoint()};UIView2.prototype.startUpdateRedPoint=function(){if(!TimerManager.ins().isExists(this.updateRedPoint,this))TimerManager.ins().doTimer(50,1,this.updateRedPoint,this)};UIView2.prototype.updateRedPoint=function(){var b=false;if(UserFb.ins().guanqiaID>2&&(this.and(UserSkill.ins().canGrewupSkill())||this.jingMaiCanUp()))b=true;if(!b)b=UserMiji.ins().isMjiSum();if(!b)b=ZhanLing.ins().checkRedPoint();this.furnaceBtn["redPoint"].visible=b};UIView2.prototype.and=function(list){for(var k in list){if(list[k]==true)return true}return false};UIView2.prototype.getBagBtn=function(){return this.bagBtn};UIView2.prototype.flyGQBossExpToBar=function(_a){var _this=this;var target=_a[0],value=_a[1];if(GameMap.fbType||value>0)return;var movieExp=new eui.Image;movieExp.source="point2";movieExp.anchorOffsetX=20;movieExp.anchorOffsetY=20;movieExp.x=100;movieExp.y=100;this.addChild(movieExp);var _x=Math.ceil(StageUtils.ins().getWidth()/2);var _y=Math.ceil(StageUtils.ins().getHeight())+60;var t=egret.Tween.get(movieExp);t.to({x:_x,y:_y,alpha:.5},800).call(function(){_this.removeChild(movieExp);egret.Tween.removeTweens(movieExp)},this);var tt=egret.Tween.get(movieExp,{loop:true});tt.to({rotation:movieExp.rotation+360},800)};UIView2.prototype.flyExpToBar=function(_a){var _this=this;var from=_a[0],count=_a[1],delay=_a[2];var point=this.globalToLocal(from.x,from.y);var _x=this.expBar.x+this.expBar.width/2;var _y=this.expBar.y;var endPoint=new egret.Point(_x,_y);var _loop_18=function(i){var center=egret.Point.interpolate(point,endPoint,MathUtils.limit(.2,.8));center.x+=MathUtils.limitInteger(-100,100);center.y+=MathUtils.limitInteger(-100,100);var movieExp=new eui.Image;movieExp.source="point2";movieExp.anchorOffsetX=20;movieExp.anchorOffsetY=20;movieExp.x=point.x;movieExp.y=point.y;this_13.addChild(movieExp);var bezier=Bezier.pop(point,endPoint);bezier.display=movieExp;bezier.centerPoint=center;bezier.start(1e3,function(){Bezier.push(bezier);_this.removeChild(movieExp);egret.Tween.removeTweens(movieExp);if(!i)_this.expChange(0,true)},this_13,i*delay);egret.Tween.get(movieExp).to({alpha:.5},1e3);var tt=egret.Tween.get(movieExp,{loop:true});tt.to({rotation:movieExp.rotation+360},500)};var this_13=this;for(var i=0;i<count;i++){_loop_18(i)}};UIView2.prototype.flyItemToBag=function(_a){var item=_a.item,gp=_a.gp;if(!ViewManager.ins().hasTopView())return;var p=this.bagBtn.parent.localToGlobal(this.bagBtn.x+this.bagBtn.width/2,this.bagBtn.y+this.bagBtn.height/2);item.reset();item.setItemParent(this);item.x=gp.x;item.y=gp.y;egret.Tween.get(item).to({x:p.x,y:p.y},1700,egret.Ease.sineOut).call(function(){DisplayUtils.removeFromParent(item);item.destruct();ObjectPool.push(item)})};UIView2.prototype.flyItemToBagEx=function(item){if(item.parent){var p1=item.parent.localToGlobal(item.x,item.y);var p2=this.bagBtn.parent.localToGlobal(this.bagBtn.x+this.bagBtn.width/2-item.width/4,this.bagBtn.y+this.bagBtn.height/2-item.width/4);DisplayUtils.removeFromParent(item);item.x=p1.x;item.y=p1.y;this.addChild(item);egret.Tween.get(item).to({x:p2.x,y:p2.y},1700,egret.Ease.sineOut).call(function(){DisplayUtils.removeFromParent(item)})}else{DisplayUtils.removeFromParent(item)}};UIView2.prototype.playUIEff=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};UIView2.prototype.isHideNavBtn=function(boo){for(var _i=0,_a=this.navBtn;_i<_a.length;_i++){var btn=_a[_i];btn.visible=boo}this.expBar.visible=boo};UIView2.NAV_ROLE=0;UIView2.NAV_SKILL=1;UIView2.NAV_LILIAN=2;UIView2.NAV_SMITH=3;UIView2.NAV_BAG=4;UIView2.NAV_STRENGTH=5;__decorate([callLater],UIView2.prototype,"setLilianRedPoint",null);return UIView2}(BaseEuiView);__reflect(UIView2.prototype,"UIView2");ViewManager.ins().reg(UIView2,LayerManager.UI_Popup);var GiftPackBtnMgr=function(_super){__extends(GiftPackBtnMgr,_super);function GiftPackBtnMgr(){var _this=_super.call(this)||this;_this._btnList={};_this.observe(GiftPackMgr.ins().postGetInfo,_this.updateBtnsVisible);return _this}GiftPackBtnMgr.ins=function(){if(this._ins==null){this._ins=new GiftPackBtnMgr}return this._ins};GiftPackBtnMgr.prototype.addBtn=function(btn,winId){if(!btn||!GlobalConfig.WinOpenConfig[winId]){return}if(ChannelMgr.ins().isRechargeHidden()){btn.visible=false;return}else{btn.visible=true}var list=this._btnList;list[btn.hashCode]={btn:btn,winId:winId,index:-1};console.log("GiftPackBtnMgr addBtn winId = "+winId);this.updateBtnsVisible()};GiftPackBtnMgr.prototype.updateBtnsVisible=function(){var list=this._btnList;var data=GiftPackMgr.ins().getPageData();for(var hc in list){if(!list[hc]||!list[hc].btn){continue}var btn=list[hc].btn;var winId=list[hc].winId;btn.visible=false;var gpc=GlobalConfig.GiftPackConfig;for(var id in gpc){if(gpc[id]&&gpc[id][1]&&gpc[id][1].winId==winId){for(var index in data){if(data[index].id==parseInt(id)){btn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onOpenGiftPackWin,this);btn.addEventListener(egret.TouchEvent.TOUCH_END,this.onOpenGiftPackWin,this);list[hc].index=parseInt(index);if(!ChannelMgr.ins().isRechargeHidden()){btn.visible=true}else{btn.visible=false}this.shake(btn)}}break}}}};GiftPackBtnMgr.prototype.onOpenGiftPackWin=function(e){var list=this._btnList;for(var hc in list){if(list[hc]&&list[hc].btn&&e.currentTarget==list[hc].btn){ViewManager.ins().open(GiftPackWin,list[hc].index);break}}};GiftPackBtnMgr.prototype.removeBtn=function(btn){var list=this._btnList;if(btn&&list[btn.hashCode]){egret.Tween.removeTweens(btn);btn.visible=false;btn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onOpenGiftPackWin,this);list[btn.hashCode]=null;delete list[btn.hashCode]}};GiftPackBtnMgr.prototype.shake=function(btn){if(!btn)return;egret.Tween.removeTweens(btn);var tw=egret.Tween.get(btn,{loop:true});tw.to({rotation:20},50).to({rotation:-20},100).to({rotation:10},100).to({rotation:-10},100).to({rotation:0},80).wait(2e3)};return GiftPackBtnMgr}(BaseSystem);__reflect(GiftPackBtnMgr.prototype,"GiftPackBtnMgr");var GiftPackMgr=function(_super){__extends(GiftPackMgr,_super);function GiftPackMgr(){var _this=_super.call(this)||this;_this.buyInfo={};_this.todayOpenIds=[];_this.waitIds=[];_this.showId=-1;_this.isFirst=true;_this.waitShowTime=60;_this.sysId=PackageID.GiftPack;_this.regNetMsg(1,_this.postGetInfo);_this.regNetMsg(2,_this.postBuyGiftPack);_this.regNetMsg(5,_this.postShowInfo);_this.observe(Actor.ins().postLevelChange,_this.sendGetInfo);_this.observe(UserFb.ins().postGuanKaIdChange,_this.sendGetInfo);_this.observe(UserFb.ins().postGuanKaIdChange,_this.checkOpenIds);_this.observe(UserTask.ins().postUpdteTaskTrace,_this.checkOpenIds);_this.observe(Actor.ins().postPowerChange,_this.checkOpenIds);_this.observe(UserZs.ins().postZsLv,_this.checkOpenIds);return _this}GiftPackMgr.ins=function(){return _super.ins.call(this)};GiftPackMgr.prototype.sendGetInfo=function(){var bytes=this.getBytes(1);this.sendToServer(bytes);this.removeObserve()};GiftPackMgr.prototype.postGetInfo=function(bytes){if(!OpenSystem.ins().checkSysOpen(SystemType.XIANGOUSHANGDIAN)){return}if(ChannelMgr.ins().isRechargeHidden()){return}var buyInfo={};this.waitIds=[];var count1=bytes.readInt();for(var i=1;i<=count1;++i){var id=bytes.readInt();if(buyInfo[id]==null){buyInfo[id]={}}if(buyInfo[id]["startTime"]==null){var startTime=bytes.readInt();buyInfo[id]["startTime"]=startTime}if(buyInfo[id]["packInfo"]==null){buyInfo[id]["packInfo"]={}}var count2=bytes.readInt();for(var index=1;index<=count2;++index){if(buyInfo[id]["packInfo"][index]==null){buyInfo[id]["packInfo"][index]=bytes.readInt()}}}var waitCount=bytes.readInt();for(var i=0;i<waitCount;i++){this.waitIds.push(bytes.readInt())}this.buyInfo=buyInfo;this.checkOpenIds()};GiftPackMgr.prototype.checkOpenIds=function(){var newWaitIds=[];var gpc=GlobalConfig.GiftPackConfig;var pageId=-1;var buyInfo=this.buyInfo;var idsStr="";for(var id in buyInfo){var idNum=parseInt(id);if(gpc[id]&&gpc[id][1]&&gpc[id][1].Id){if(WinOpenMgr.ins().isOpen(gpc[id][1].winId)&&buyInfo[id].startTime==0){var preId=idNum-1;if(gpc[id][1].chainId&&gpc[preId]&&gpc[preId][1]&&gpc[preId][1].chainId&&gpc[id][1].chainId==gpc[preId][1].chainId&&buyInfo[preId]&&buyInfo[preId].startTime>=0){continue}if(this.waitIds.indexOf(idNum)==-1){newWaitIds.push(idNum);idsStr+=" "+idNum}}}}console.log("newWaitIds :"+idsStr);if(newWaitIds.length>0){this.sendNewWaitIds(newWaitIds)}};GiftPackMgr.prototype.sendBuyGiftPack=function(id,index){var bytes=this.getBytes(2);bytes.writeInt(id);bytes.writeInt(index);this.sendToServer(bytes)};GiftPackMgr.prototype.postBuyGiftPack=function(bytes){var id=bytes.readInt();var index=bytes.readInt();var buyCount=bytes.readInt();var err_code=bytes.readInt();var err_msg=bytes.readString();if(err_code==0){var info=this.buyInfo[id];if(info&&info.packInfo&&info.packInfo[index]!=null){info.packInfo[index]=buyCount}var view=ViewManager.ins().getView(GiftPackWarnWin);if(this.isToShow(id)&&!view){this.sendHadShowId(id);this.removeShowTimer()}}UserTips.ins().showTips(err_msg)};GiftPackMgr.prototype.sendNewWaitIds=function(ids){if(ids&&ids.length>0){var bytes=this.getBytes(4);bytes.writeInt(ids.length);for(var i=0;i<ids.length;++i){var id=ids[i];bytes.writeInt(id)}this.sendToServer(bytes)}};GiftPackMgr.prototype.sendHadShowId=function(showId){if(showId>0&&this.isToShow(showId)){console.log("GiftPackMgr sendShowId id = "+showId);var bytes=this.getBytes(5);bytes.writeInt(showId);this.sendToServer(bytes)}};GiftPackMgr.prototype.postShowInfo=function(bytes){var showId=bytes.readInt();this.todayOpenIds=[];var todayOpenCnt=bytes.readInt();for(var i=0;i<todayOpenCnt;i++){var id=bytes.readInt();var status_1=bytes.readInt();this.todayOpenIds.push({id:id,status:status_1})}console.log("GiftPackMgr postShowInfo showId = "+showId);this.showId=showId;if(showId>0&&this.isToShow(showId)){this.addShowTimer()}};GiftPackMgr.prototype.isToShow=function(id){var config=GlobalConfig.GiftPackConfig[id];if(config&&config[1].type==1){return true}var ids=this.todayOpenIds;for(var _i=0,ids_1=ids;_i<ids_1.length;_i++){var v=ids_1[_i];if(v&&v.id==id){return v.status==0}}return false};GiftPackMgr.prototype.addShowTimer=function(){if(!TimerManager.ins().isExists(this.showTimerGo,this)){if(this.isFirst){this.isFirst=false;this.waitShowTime=DateUtils.SECOND_PER_MUNITE}else{var cfg=GlobalConfig.GiftPackBaseConfig;this.waitShowTime=cfg&&cfg.waitShowTime&&cfg.waitShowTime.value?cfg.waitShowTime.value:DateUtils.SECOND_PER_MUNITE*10}TimerManager.ins().doTimer(1e3,0,this.showTimerGo,this)}};GiftPackMgr.prototype.showTimerGo=function(){this.waitShowTime--;if(this.waitShowTime%100==0)console.log("GiftPackMgr waitShowTime = "+this.waitShowTime+" showId = "+this.showId);if(this.waitShowTime<=0){if(GameMap.sceneInMain()){var view=ViewManager.ins().getView(GiftPackWin);if(view){this.sendHadShowId(this.showId);this.removeShowTimer()}else if(!ViewManager.ins().hasTopView()&&!this.hasOtherWinOpen()){var showIndex=this.getShowIndex();if(this.showId>0&&this.isToShow(this.showId)&&showIndex>=0){ViewManager.ins().open(GiftPackWarnWin,this.sendHadShowId,this,showIndex)}this.removeShowTimer()}else{this.waitShowTime=DateUtils.SECOND_PER_MUNITE}}else{this.waitShowTime=DateUtils.SECOND_PER_MUNITE}}};GiftPackMgr.prototype.hasOtherWinOpen=function(){var waitWins=[NewStoryWin,OfflineRewardWin,LimitStartTipsView];for(var _i=0,waitWins_1=waitWins;_i<waitWins_1.length;_i++){var w=waitWins_1[_i];if(ViewManager.ins().getView(w)){return true}}return false};GiftPackMgr.prototype.removeShowTimer=function(){TimerManager.ins().remove(this.showTimerGo,this)};GiftPackMgr.prototype.getPageData=function(){var data=[];var rankPackId=this.getRankPackId();if(rankPackId>0){data.push({id:rankPackId,pageId:1})}var gpc=GlobalConfig.GiftPackConfig;var buyInfo=this.buyInfo;for(var id in buyInfo){if(gpc[id]&&gpc[id][1]&&gpc[id][1].Id){var cfg=gpc[id][1];if(buyInfo[id].startTime>0){data.push({id:cfg.Id,pageId:cfg.pageId})}}}return data};GiftPackMgr.prototype.getShowIndex=function(){var index=-1;var data=this.getPageData();for(var idx=0;idx<data.length;++idx){if(data[idx].id==this.showId){index=idx;break}}return index};GiftPackMgr.prototype.getRankPackId=function(){var actId=FirstRank.ins().getCurRankId();var frc=GlobalConfig.FirstRankConfig[actId];var id=frc&&frc.packId?frc.packId:-1;return id};GiftPackMgr.prototype.isRankPackById=function(packId){var cfg=GlobalConfig.FirstRankConfig;for(var id in cfg){if(cfg[id]&&cfg[id].packId==packId){return true}}return false};GiftPackMgr.prototype.getPackDataById=function(id){var data=[];var cfg;if(this.isRankPackById(id)){cfg=GlobalConfig.ActivityType2Config[id]}else{cfg=GlobalConfig.GiftPackConfig[id]}if(cfg){for(var index in cfg){if(cfg[index]&&cfg[index].price){data.push(cfg[index])}}}return data};GiftPackMgr.prototype.getEndTime=function(id){var endTime=0;var cfg=GlobalConfig.GiftPackConfig[id];var startTime=this.buyInfo[id]?this.buyInfo[id].startTime:0;if(cfg&&cfg[1]&&cfg[1].limitDays&&startTime!=null){endTime=cfg[1].limitDays*DateUtils.SECOND_PER_DAY+startTime;endTime=endTime-Math.floor(GameServer.serverTime/1e3)}return endTime>0?endTime:0};GiftPackMgr.prototype.canBuy=function(){var info=this.getPageData();for(var i=0;i<info.length;++i){if(this.canBuyByPackId(info[i].id)){return true}}return false};GiftPackMgr.prototype.canBuyByPackId=function(id){var cfg;var isRankPack=this.isRankPackById(id);if(isRankPack){cfg=GlobalConfig.ActivityType2Config[id]}else{cfg=GlobalConfig.GiftPackConfig[id]}var info=this.buyInfo[id];var openDay=GameServer.serverOpenDay;if(cfg&&info&&(info.startTime>0||info.startTime==0&&isRankPack)&&info.packInfo){for(var index in cfg){if(cfg[index]&&info.packInfo[index]!=null&&cfg[index].count>info.packInfo[index]){return true}}}return false};return GiftPackMgr}(BaseSystem);__reflect(GiftPackMgr.prototype,"GiftPackMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.giftPack=GiftPackMgr.ins.bind(GiftPackMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GiftPackItemRenderer=function(_super){__extends(GiftPackItemRenderer,_super);function GiftPackItemRenderer(){var _this=_super.call(this)||this;_this.isCanBuy=false;_this.skinName="GiftPackItemSkin";var list=_this.listItem;list.dataProvider=new ArrayCollection([]);list.itemRenderer=ItemBase;return _this}GiftPackItemRenderer.prototype.dataChanged=function(){var data=this.data;if(!data)return;this.isCanBuy=false;this.btnBuy.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnBuy,this);this.redPoint.visible=false;this.groupPrice.visible=true;this.groupVip.visible=true;this.lblLeftCount.visible=false;if(data.discount){this.groupDisc.visible=true;var ten=10;var num=Math.floor(data.discount/ten);var remainder=data.discount%ten;this.bitDiscNum.text=""+num+(remainder==0?"":"."+remainder)+i18n("GiftPackItemRenderer_0")}else{this.groupDisc.visible=false}this.lblVipLv.text=data.vip?i18n("GiftPackItemRenderer_7")+data.vip:i18n("GiftPackItemRenderer_7")+"0";this.lblOldPrice.text=""+data.originalPrice;var info=GiftPackMgr.ins().buyInfo[data.Id];this.btnBuy.skinName="GiftPackBtnBuySkin";var str="";if(info&&info.packInfo&&info.packInfo[data.index]!=null){var leftCount=Math.max(0,data.count-info.packInfo[data.index]);if(leftCount>0){this.isCanBuy=true;str=""+data.price;this.redPoint.visible=true;this.lblLeftCount.visible=true;var leftText=i18n("GiftPackItemRenderer_1")+i18n("GiftPackItemRenderer_6")+ColorUtil.GREEN_COLOR_N+"&T:"+leftCount+"|/"+data.count+" )";this.lblLeftCount.textFlow=TextFlowMaker.generateTextFlow(leftText)}else{str=i18n("GiftPackItemRenderer_2");this.btnBuy.skinName="Btn42Skin";this.groupPrice.visible=false}}this.btnBuy.label=str;var rewardData=[];for(var k in data.rewards){if(data.rewards[k]&&data.rewards[k].id){rewardData.push(data.rewards[k])}}var dataProvider=this.listItem.dataProvider;this.listItem.dataProvider.replaceAll(rewardData);this.btnBuy.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnBuy,this)};GiftPackItemRenderer.prototype.onBtnBuy=function(){var data=this.data;if(!data)return;if(this.isCanBuy){if(data.vip!=null&&UserVip.ins().lv>=data.vip||data.vip==null){GiftPackMgr.ins().sendBuyGiftPack(data.Id,data.index)}else{var warnWin=WarnWin.show(i18n("GiftPackItemRenderer_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GiftPackItemRenderer_4"))}}else{UserTips.ins().showTips(i18n("GiftPackItemRenderer_5"))}};return GiftPackItemRenderer}(BaseItemRender);__reflect(GiftPackItemRenderer.prototype,"GiftPackItemRenderer");var GiftPackPageRenderer=function(_super){__extends(GiftPackPageRenderer,_super);function GiftPackPageRenderer(){var _this=_super.call(this)||this;_this.skinName="GiftPackPageItemSkin";DisplayUtils.removeFromParent(_this.mc);_this.mc=null;return _this}GiftPackPageRenderer.prototype.dataChanged=function(){var pageInfo=this.data;if(pageInfo==null)return;this.redPoint.visible=false;var cfg=GlobalConfig.GiftPackPageIconConfig;var source="";var pageId=pageInfo.pageId;var id=pageInfo.id;this.imgPage.source=cfg[pageId]&&cfg[pageId].source?cfg[pageId].source:"";this.redPoint.visible=GiftPackMgr.ins().canBuyByPackId(id);if(this.selected){if(!this.mc){this.mc=new MovieClip;this.mc.x=45;this.mc.y=53}this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1);this.addChild(this.mc)}else{if(this.mc){DisplayUtils.removeFromParent(this.mc);this.mc=null}}};return GiftPackPageRenderer}(BaseItemRender);__reflect(GiftPackPageRenderer.prototype,"GiftPackPageRenderer");var GiftPackWarnWin=function(_super){__extends(GiftPackWarnWin,_super);function GiftPackWarnWin(){var _this=_super.call(this)||this;_this.showIndex=-1;_this.packData=[];_this.skinName="GiftPackWarnSkin";_this.visible=false;var list=_this.listPack;list.itemRenderer=GiftPackItemRenderer;list.dataProvider=new ArrayCollection([]);_this.observe(GiftPackMgr.ins().postGetInfo,_this.updateShow);_this.observe(GiftPackMgr.ins().postShowInfo,_this.updateShow);_this.observe(GiftPackMgr.ins().postBuyGiftPack,_this.updateShow);return _this}GiftPackWarnWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(ChannelMgr.ins().isRechargeHidden()){return false}else{return true}};GiftPackWarnWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnClose,this.onClose);this.addTouchEvent(this.btnMore,this.onOpenGiftPackWin);if(param){var showIndex=param[2];this.cbObj={fun:param[0],thisObj:param[1],packId:-1};this.showIndex=showIndex;var pageData=GiftPackMgr.ins().getPageData();if(pageData&&pageData.length&&pageData[showIndex]){var cfg=GlobalConfig.GiftPackPageIconConfig[pageData[showIndex].pageId];this.imgPackTitle.source=cfg&&cfg.titleSource?cfg.titleSource:"";var packId=pageData[showIndex].id;this.cbObj.packId=packId;this.packData=GiftPackMgr.ins().getPackDataById(packId);if(this.packData&&this.packData.length){this.visible=true;this.updateShow()}}}};GiftPackWarnWin.prototype.updateShow=function(){if(this.packData&&this.packData.length){var dataProvoder=this.listPack.dataProvider;dataProvoder.replaceAll(this.packData)}};GiftPackWarnWin.prototype.onOpenGiftPackWin=function(){this.onClose();var view=ViewManager.ins().getView(GiftPackWin);if(!view){ViewManager.ins().open(GiftPackWin,this.showIndex)}};GiftPackWarnWin.prototype.onClose=function(){if(this.cbObj&&this.cbObj.fun&&this.cbObj.thisObj&&this.cbObj.packId){this.cbObj.fun.call(this.cbObj.thisObj,this.cbObj.packId)}this.close()};GiftPackWarnWin.prototype.close=function(){this.removeTouchEvent(this.btnClose,this.onClose);this.removeTouchEvent(this.btnMore,this.onClose);this.removeObserve();_super.prototype.close.call(this);ViewManager.ins().close(this)};return GiftPackWarnWin}(BaseEuiView);__reflect(GiftPackWarnWin.prototype,"GiftPackWarnWin");ViewManager.ins().reg(GiftPackWarnWin,LayerManager.UI_Popup);var GiftPackWin=function(_super){__extends(GiftPackWin,_super);function GiftPackWin(){var _this=_super.call(this)||this;_this.showIndex=0;_this.endTime=0;_this.lastEndedId=-1;_this.isTopLevel=true;_this.skinName="GiftPackSkin";return _this}GiftPackWin.prototype.initUI=function(){var listPack=this.listPack;var listPage=this.listPage;listPage.itemRenderer=GiftPackPageRenderer;listPage.dataProvider=new ArrayCollection([])};GiftPackWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnClose,this.onTab);this.addTouchEvent(this.listPage,this.onTab);this.observe(GameServer.ins().postServerOpenDay,this.onPageList);this.observe(Activity.ins().postActivityIsGetAwards,this.onPageList);this.observe(GiftPackMgr.ins().postGetInfo,this.onPageList);this.observe(GiftPackMgr.ins().postBuyGiftPack,this.onPageList);this.roleSelect.setState("nohead");this.startShow(param)};GiftPackWin.prototype.startShow=function(param){this.showIndex=param&&param[0]>=0?param[0]:0;this.listPage.selectedIndex=this.showIndex;this.moveToSelectedPage(this.showIndex);this.updatePageData();this.updateShow()};GiftPackWin.prototype.moveToSelectedPage=function(index){var scroller=this.scrollPage;index=Math.max(0,index-2);var distance=index*93;TimerManager.ins().doTimer(40,1,function(){scroller.viewport.scrollH=distance},this)};GiftPackWin.prototype.onTab=function(e){if(!e||!e.currentTarget)return;switch(e.currentTarget){case this.btnClose:this.close();break;case this.listPage:this.onPageList();break}};GiftPackWin.prototype.onPageList=function(){this.showIndex=this.listPage.selectedIndex;this.updatePageData();this.listPage.selectedIndex=this.showIndex;this.updateShow()};GiftPackWin.prototype.updatePageData=function(){var dataPro=this.listPage.dataProvider;var pageData=GiftPackMgr.ins().getPageData();dataPro.replaceAll(pageData);if(pageData.length){this.lblNoPackTip.visible=false;this.groupTopTip.visible=true}else{this.lblNoPackTip.visible=true;this.groupTopTip.visible=false}};GiftPackWin.prototype.updateShow=function(){var pageInfo=this.listPage.selectedItem;if(pageInfo&&pageInfo.id){var packId=pageInfo.id;var data=[];data=GiftPackMgr.ins().getPackDataById(packId);this.listPack.removeChildren();for(var _i=0,data_5=data;_i<data_5.length;_i++){var d=data_5[_i];var item=new GiftPackItemRenderer;item.data=d;this.listPack.addChild(item)}this.listPack.layout.updateDisplayList(this.listPack.width,this.listPack.height);if(GiftPackMgr.ins().isRankPackById(packId)){this.endTime=FirstRank.ins().getEndTime();var cfg=GlobalConfig.ActivityConfig[packId];this.lblDesc.text=cfg?cfg.desc:""}else{this.endTime=GiftPackMgr.ins().getEndTime(packId);var cfg=GlobalConfig.GiftPackConfig[packId];this.lblDesc.text=cfg&&cfg[1]?cfg[1].desc:""}this.setTimeText();if(!TimerManager.ins().isExists(this.timeGo,this)){TimerManager.ins().doTimer(1e3,0,this.timeGo,this)}}};GiftPackWin.prototype.timeGo=function(){this.endTime--;this.setTimeText();if(this.endTime<0){TimerManager.ins().remove(this.timeGo,this);this.startShow(null);var pageInfo=this.listPage.selectedItem;if(pageInfo&&pageInfo.id>0&&pageInfo.id!=this.lastEndedId){this.lastEndedId=pageInfo.id;GiftPackMgr.ins().sendGetInfo();console.log("GiftPackWin this.lastEndId = "+this.lastEndedId)}}};GiftPackWin.prototype.setTimeText=function(){this.lblEndTime.textFlow=TextFlowMaker.generateTextFlow(i18n("GiftPackWin_0")+ColorUtil.GREEN_COLOR_N+"&T:"+DateUtils.getFormatBySecond(this.endTime,DateUtils.TIME_FORMAT_5,3)+"|")};GiftPackWin.prototype.onClose=function(){this.close()};GiftPackWin.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this.btnClose,this.onTab);this.removeTouchEvent(this.listPage,this.onTab);TimerManager.ins().removeAll(this);ViewManager.ins().close(this);_super.prototype.close.call(this)};return GiftPackWin}(BaseEuiView);__reflect(GiftPackWin.prototype,"GiftPackWin");ViewManager.ins().reg(GiftPackWin,LayerManager.UI_Main);var GodWeaponCC=function(_super){__extends(GodWeaponCC,_super);function GodWeaponCC(){var _this=_super.call(this)||this;_this.curExp=0;_this._firstExp=true;_this.weaponDataAry=[];_this._isFirst=false;_this.exattrDesObj={43:i18n("GodWeaponCC_0"),48:i18n("GodWeaponCC_1"),44:i18n("GodWeaponCC_2"),45:i18n("GodWeaponCC_3"),46:i18n("GodWeaponCC_4"),47:i18n("GodWeaponCC_5")};_this.sysId=PackageID.GodWeapon;_this.gwTask=new GwTaskData;_this.regNetMsg(1,_this.postUpdateExp);_this.regNetMsg(2,_this.postUpdateInfo);_this.regNetMsg(6,_this.postFubenInfo);_this.regNetMsg(9,_this.postRankInfo);_this.regNetMsg(13,_this.doGetAward);_this.regNetMsg(10,_this.postGwTask);return _this}GodWeaponCC.ins=function(){return _super.ins.call(this)};GodWeaponCC.prototype.createData=function(){if(this._isFirst==false){this.initData();this._isFirst=true}};GodWeaponCC.prototype.initData=function(){this.maxSkillIdAry=[];this.weaponDataAry=[];this.allSkillData={};this.allSkillData2={};this.allGodItemData={};for(var key in GlobalConfig.GodWeaponLineConfig){var tempObj={};var tempObj2={};var data=GlobalConfig.GodWeaponLineConfig[key];this.allSkillData[key]=tempObj;this.allSkillData2[key]=tempObj2;var maxId=0;for(var i in data){var skillData=new GwSkillData;skillData.skillId=parseInt(i);skillData.skillLv=0;skillData.config=data[i];skillData.weaponId=parseInt(key);tempObj2[skillData.skillId]=skillData;tempObj[skillData.config.skinId]=skillData;maxId++}this.maxSkillIdAry.push(maxId);var aryItem=[];for(var j=0;j<GlobalConfig.GodWeaponBaseConfig.weaponItemCount;j++){var item=new GwItem;item.pos=j+1;item.itemId=undefined;item.config=null;item.weaponId=parseInt(key);aryItem.push(item)}this.allGodItemData[key]=aryItem}this.gwSkillConfig={};for(var key in GlobalConfig.GWSkillReviseConfig){var data=GlobalConfig.GWSkillReviseConfig[key];if(!this.gwSkillConfig[data.skill])this.gwSkillConfig[data.skill]={};this.gwSkillConfig[data.skill][data.gwIndex]=data}};GodWeaponCC.prototype.godWeaponIsOpen=function(){return UserZs.ins().lv>=GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel&&GameServer.serverOpenDay+1>=GlobalConfig.GodWeaponBaseConfig.openDay};GodWeaponCC.prototype.getReviseBySkill=function(skillId){if(!this.allSkillData2)return null;var weaponId=(""+skillId).charAt(0);var skillData=this.allSkillData2[weaponId];if(!skillData)return null;var skill=Math.floor(skillId/1e3);var skills=[];for(var skillIdx in skillData){var data=skillData[skillIdx];if(data.config.skill==skill){if(data.skillLv==0){continue}var lv=data.skillLv+data.addLv;var index=data.skillId*1e3+lv;if(this.gwSkillConfig[skill]&&this.gwSkillConfig[skill][index]){skills.push(this.gwSkillConfig[skill][index])}}}return skills};GodWeaponCC.prototype.getJobGWNewSkill=function(job){if(!this.allSkillData2)return null;var skillData=this.allSkillData2[job];if(!skillData)return null;var roleData=SubRoles.ins().getSubRoleByJob(job);if(!roleData)return null;if(!roleData.godWeaponSkills)roleData.godWeaponSkills=[];var count=0;for(var skillIdx in skillData){var data=skillData[skillIdx];if(data.config.newskill||data.config.passiveskill){var skill=data.config.newskill||data.config.passiveskill;var skillId=skill*1e3+(data.skillLv+data.addLv);roleData.godWeaponSkills[count]=roleData.godWeaponSkills[count]||new SkillData(skillId);roleData.godWeaponSkills[count].configID=skillId;count+=1}}return roleData.godWeaponSkills};GodWeaponCC.prototype.getWeaponSkinIdData=function(weaponId,skinId){return this.allSkillData[weaponId][skinId]};GodWeaponCC.prototype.getWeaponSkillidData=function(weaponId,skillId){return this.allSkillData2[weaponId][skillId]};GodWeaponCC.prototype.getGodItemData=function(weaponId,pos){return this.allGodItemData[weaponId][pos-1]};GodWeaponCC.prototype.postUpdateExp=function(bytes){var oldExp=this.curExp;this.curExp=bytes.readInt();if(!this._firstExp){if(this.curExp-oldExp>0)UserTips.ins().showTips(i18n("GodWeaponCC_6",this.curExp-oldExp))}this._firstExp=false};GodWeaponCC.prototype.postUpdateInfo=function(bytes){this.createData();var count=bytes.readInt();var data;for(var i=0;i<count;i++){if(this.weaponDataAry[i]){data=this.weaponDataAry[i];data.parse(bytes)}else{data=new GodWeaponData(bytes);this.weaponDataAry.push(data)}}this.weaponDataAry.sort(function(a,b){if(a.weaponId<b.weaponId)return-1;return 1})};GodWeaponCC.prototype.getWeaponData=function(weaponId){if(this.weaponDataAry){for(var _i=0,_a=this.weaponDataAry;_i<_a.length;_i++){var data=_a[_i];if(data.weaponId==weaponId)return data}}return null};GodWeaponCC.prototype.upSkill=function(weaponId,skillId){var bytes=this.getBytes(3);bytes.writeInt(weaponId);bytes.writeInt(skillId);this.sendToServer(bytes)};GodWeaponCC.prototype.inlayItem=function(weaponId,pos,itemId){var bytes=this.getBytes(4);bytes.writeInt(weaponId);bytes.writeInt(pos);bytes.writeInt(itemId);this.sendToServer(bytes)};GodWeaponCC.prototype.upWeapon=function(value){var bytes=this.getBytes(5);bytes.writeInt(value);this.sendToServer(bytes)};GodWeaponCC.prototype.hadRedPoint=function(){this.createData();var b=false;if(GameServer.serverOpenDay<GlobalConfig.GodWeaponBaseConfig.openDay){return b}if(GodWeaponRedPoint.ins().gwTaskRed){b=true}else{for(var i=0;i<this.weaponDataAry.length;i++){if(this.weaponDataAry[i]&&this.weaponDataAry[i].hasRedPoint==true||this.getSwRedPoint(this.weaponDataAry[i].weaponId)){b=true;break}}}b=b||this.mijintHadRedPoint()||this.maxLvRedPoint();return b};GodWeaponCC.prototype.maxLvRedPoint=function(){if(!this.weaponDataAry)return false;var tempData=this.weaponDataAry.concat();tempData.sort(function(a,b){return a.curLv-b.curLv});var dataMax=tempData[tempData.length-1];if(dataMax&&dataMax.config&&GodWeaponCC.ins().curExp>=dataMax.config.everyExp*2){return true}else{return false}};GodWeaponCC.prototype.mijintHadRedPoint=function(){if(this.godWeaponIsOpen()&&this.fubenInfoData&&this.fubenInfoData.hadChallengeNum>0){return true}else{return false}};GodWeaponCC.prototype.getSwRedPoint=function(weaponId){var ary=this.allGodItemData[weaponId];var data;for(var i=0;i<ary.length;i++){data=ary[i];if(data.isOpen&&!data.itemId&&GwShengWuChooseView.getGwItemType(data).length>0){return true}}return false};GodWeaponCC.prototype.gwAddAttr=function(weaponId){var weaponData=this.getWeaponData(weaponId+1);if(!weaponData)return[];var gwAry=weaponData.addAttr.concat();var dataSkill;var i=0;var j=0;for(i=0;i<this.maxSkillIdAry[weaponId];i++){dataSkill=this.getWeaponSkillidData(weaponId+1,i+1);if(dataSkill.skillLv+dataSkill.addLv>0){if(dataSkill.config.attr){for(j=0;j<dataSkill.config.attr.length;j++){var objData={value:0,type:0};objData.value=dataSkill.config.attr[j].value*(dataSkill.skillLv+dataSkill.addLv);objData.type=dataSkill.config.attr[j].type;gwAry.push(objData)}}}}var aryGw=this.allGodItemData[weaponId+1];for(i=0;i<aryGw.length;i++){if(aryGw[i].itemId){for(j=0;j<aryGw[i].config.attr.length;j++){var objData={value:0,type:0};objData.value=aryGw[i].config.attr[j].value;objData.type=aryGw[i].config.attr[j].type;gwAry.push(objData)}}}var addAry=[];for(i=0;i<gwAry.length;i++){var b=false;for(j=0;j<addAry.length;j++){if(addAry[j].type==gwAry[i].type){addAry[j].value+=gwAry[i].value;b=false;break}else{b=true}}if(b==true||addAry.length==0){var objData={value:gwAry[i].value,type:gwAry[i].type};addAry.push(objData)}}return addAry};GodWeaponCC.prototype.postFubenInfo=function(bytes){if(!this.fubenInfoData){this.fubenInfoData=new GwFubenData}this.fubenInfoData.parse(bytes)};GodWeaponCC.prototype.postRankInfo=function(bytes){if(!this.rankInfoDataAry){this.rankInfoDataAry=[]}var count=bytes.readInt();var data;for(var i=0;i<count;i++){data=this.rankInfoDataAry[i];if(!data){data=new GwRankInfoData;this.rankInfoDataAry[i]=data}data.parse(bytes)}this.rankInfoDataAry.sort(this.sortFun)};GodWeaponCC.prototype.sortFun=function(a,b){return a.rank-b.rank};GodWeaponCC.prototype.postGwTask=function(bytes){this.gwTask.parser(bytes)};GodWeaponCC.prototype.requestFubenInfo=function(){var bytes=this.getBytes(6);this.sendToServer(bytes)};GodWeaponCC.prototype.joinFuben=function(value){var bytes=this.getBytes(7);bytes.writeInt(value);this.sendToServer(bytes)};GodWeaponCC.prototype.buybuff=function(type){var bytes=this.getBytes(8);bytes.writeInt(type);this.sendToServer(bytes)};GodWeaponCC.prototype.requestRanInfo=function(){var bytes=this.getBytes(9);this.sendToServer(bytes)};GodWeaponCC.prototype.doGetAward=function(bytes){var win=bytes.readByte();var curPoint=bytes.readByte();if(ViewManager.gamescene){ViewManager.gamescene.removeMiingTimeFun();ViewManager.gamescene.setMJPingfen(curPoint)}if(win){ViewManager.ins().open(GwResultView,GameMap.fubenID,curPoint,UserFb.ins().mijingUseTime)}else{ViewManager.ins().open(GwResultView,GameMap.fubenID,4)}};GodWeaponCC.prototype.requestGetAward=function(){var bytes=this.getBytes(13);this.sendToServer(bytes)};GodWeaponCC.prototype.requestReceiveTask=function(job){var bytes=this.getBytes(11);bytes.writeInt(job);this.sendToServer(bytes)};GodWeaponCC.prototype.requestActiveWeapon=function(){this.sendBaseProto(12)};GodWeaponCC.prototype.getPinfenTime=function(index){var time;if(!this._timeMijinAry){this._timeMijinAry=[];for(var key in GlobalConfig.GodWeaponBaseConfig.fbGrade){if(time){this._timeMijinAry.push(GlobalConfig.GodWeaponBaseConfig.fbGrade[key]-time);time=GlobalConfig.GodWeaponBaseConfig.fbGrade[key]}else{time=GlobalConfig.GodWeaponBaseConfig.fbGrade[key];this._timeMijinAry.push(time)}}}return this._timeMijinAry[index]};GodWeaponCC.prototype.weaponIsActive=function(weaponId){this.createData();if(this.weaponDataAry){for(var _i=0,_a=this.weaponDataAry;_i<_a.length;_i++){var data=_a[_i];if(data.weaponId==weaponId)return true}}return false};GodWeaponCC.prototype.taskIsOpen=function(){if(GameServer.serverOpenDay+1>=GlobalConfig.GodWeaponBaseConfig.openDay){return true}return false};GodWeaponCC.prototype.sendReset=function(id){var bytes=this.getBytes(14);bytes.writeInt(id);this.sendToServer(bytes)};return GodWeaponCC}(BaseSystem);__reflect(GodWeaponCC.prototype,"GodWeaponCC");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.godWeaponCC=GodWeaponCC.ins.bind(GodWeaponCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GodWeaponItemCC=function(_super){__extends(GodWeaponItemCC,_super);function GodWeaponItemCC(){var _this=_super.call(this)||this;_this.sysId=PackageID.GodWeaponItem;_this.regNetMsg(1,_this.postCompound);_this.regNetMsg(2,_this.postFuse);return _this}GodWeaponItemCC.prototype.requestCompound=function(itemId1,itemId2,itemId3){var bytes=this.getBytes(1);bytes.writeInt(itemId1);bytes.writeInt(itemId2);bytes.writeInt(itemId3);this.sendToServer(bytes)};GodWeaponItemCC.prototype.postCompound=function(bytes){var isSuccess=bytes.readBoolean();var num=bytes.readShort();var itemId=bytes.readInt();return{id:itemId,isSuccess:isSuccess}};GodWeaponItemCC.prototype.requestFuse=function(itemId1,itemId2,itemId3){var bytes=this.getBytes(2);bytes.writeInt(itemId1);bytes.writeInt(itemId2);bytes.writeShort(itemId3);this.sendToServer(bytes)};GodWeaponItemCC.prototype.postFuse=function(bytes){var isSuccess=bytes.readBoolean();var itemId=0;if(isSuccess){var num=bytes.readShort();itemId=bytes.readInt()}return{id:itemId,isSuccess:isSuccess}};GodWeaponItemCC.ins=function(){return _super.ins.call(this)};return GodWeaponItemCC}(BaseSystem);__reflect(GodWeaponItemCC.prototype,"GodWeaponItemCC");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.godWeaponItemCC=GodWeaponItemCC.ins.bind(GodWeaponItemCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GodWeaponData=function(){function GodWeaponData(bytes){this.parse(bytes)}GodWeaponData.prototype.parse=function(bytes){this.weaponId=bytes.readInt();this.curLv=bytes.readInt();this.curExp=bytes.readInt();this.skillPoint=bytes.readInt();this.openCount=bytes.readInt();if(this.openCount<=0&&this.openSkillAry&&this.openSkillAry.length>0){var len=this.openSkillAry.length;for(var i=0;i<len;i++)this.openSkillAry[i].skillLv=0}this.openSkillAry=[];var data;var skillId;for(var i=0;i<this.openCount;i++){skillId=bytes.readInt();data=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,skillId);data.addLv=0;data.skillLv=bytes.readInt();this.openSkillAry.push(data)}for(var key in GodWeaponCC.ins().allSkillData2[this.weaponId]){if(GodWeaponCC.ins().allSkillData2[this.weaponId][key].skillLv==0){GodWeaponCC.ins().allSkillData2[this.weaponId][key].addLv=0}}this.inlayCount=bytes.readInt();var item;var pos;for(var i=0;i<this.inlayCount;i++){pos=bytes.readInt();item=GodWeaponCC.ins().getGodItemData(this.weaponId,pos);item.itemId=bytes.readInt();for(var j=0;j<item.config.skill.length;j++){var dataTemp=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,item.config.skill[j]);dataTemp.addLv+=1}}this.config=GlobalConfig.GodWeaponLevelConfig[this.curLv]};Object.defineProperty(GodWeaponData.prototype,"hasRedPoint",{get:function(){if(this.skillPoint>0){return true}return false},enumerable:true,configurable:true});Object.defineProperty(GodWeaponData.prototype,"addAttr",{get:function(){return this.config["attr"+this.weaponId]==null?[]:this.config["attr"+this.weaponId]},enumerable:true,configurable:true});GodWeaponData.prototype.getResetPoint=function(){var len=this.openSkillAry?this.openSkillAry.length:0;var count=0;for(var i=0;i<len;i++)count+=this.openSkillAry[i].skillLv;return count};GodWeaponData.prototype.getWeaponName=function(){switch(this.weaponId){case 1:return i18n("GodWeaponData_0");case 2:return i18n("GodWeaponData_1");case 3:return i18n("GodWeaponData_2")}return""};return GodWeaponData}();__reflect(GodWeaponData.prototype,"GodWeaponData");var GwSkillData=function(){function GwSkillData(id,lv){this._skillLv=0;this.addLv=0;this.skillId=id;this.skillLv=lv}Object.defineProperty(GwSkillData.prototype,"skillLv",{get:function(){return this._skillLv},set:function(value){this._skillLv=value},enumerable:true,configurable:true});GwSkillData.prototype.lvLabel=function(b){if(b===void 0){b=false}var cur=this._skillLv+this.addLv;var max;if(!this.isOpen){max=this._skillLv!=0?this.config.upLevel+this.addLv:this.addLv}else{max=this.config.upLevel+this.addLv}if(b){return""+cur}else{return cur+"/"+max}};Object.defineProperty(GwSkillData.prototype,"skillPower",{get:function(){var power=this.config.exPower||0;var cur=this._skillLv+this.addLv;return power*cur},enumerable:true,configurable:true});GwSkillData.prototype.addAttrValyeType=function(lvN){var str="";if(this.config.attr){for(var i=0;i<this.config.attr.length;i++){if(str.length>0){str+="\n"}str+=AttributeData.getAttrStrByType(this.config.attr[i].type)+i18n("GodWeaponData_3")+('<font color="#03b154">'+this.config.attr[i].value*lvN+"</font>")}}return str};GwSkillData.prototype.addExAttrstr=function(lvN){var str="";if(this.config.exattr){var des="";var addDes="";for(var i=0;i<this.config.exattr.length;i++){if(str.length>0){str+="\n"}des=GodWeaponCC.ins().exattrDesObj[this.config.exattr[i].type];switch(this.config.exattr[i].type){case 43:case 48:addDes='<font color="#03b154">'+this.config.exattr[i].value*lvN/100+"</font>";break;case 44:case 45:case 46:addDes='<font color="#03b154">'+(1+this.config.exattr[i].value*lvN/100)+"</font>";break;case 47:var effectConfig=GlobalConfig.EffectsConfig[100400+this.config.exattr[i].value*lvN];if(effectConfig&&effectConfig.args){addDes='<font color="#03b154">'+effectConfig.args.a*100+"</font>"}break}des=des.replace("%s%",addDes);str+=des}}return str};GwSkillData.prototype.addatrStr=function(value){this._addStr="";var lvN=value+this.addLv;this._addStr+=this.addAttrValyeType(lvN);this._addStr+=this.addExAttrstr(lvN);var skillId;var data;if(this.config.newskill){skillId=this.config.newskill*1e3+lvN;data=new SkillData(skillId);if(this._addStr.length>0){this._addStr+="\n"}this._addStr+=this.getSkillDataDes(data)}if(this.config.passiveskill){skillId=this.config.passiveskill*1e3+lvN;data=new SkillData(skillId);if(this._addStr.length>0){this._addStr+="\n"}this._addStr+=this.getSkillDataDes(data)}this._addStr+=this.specialSkill(lvN);return this._addStr};GwSkillData.prototype.getSkillDataDes=function(data){var levelConfig=data.config||GlobalConfig.SkillsConfig[data.lv1ConfigID];if(Assert(levelConfig,i18n("GodWeaponData_6",data.configID))){return""}var config=GlobalConfig.SkillsDescConfig[levelConfig.desc];var str=config?config.desc:"";if(!str.length||!levelConfig.desc_ex)return str;var len=levelConfig.desc_ex.length;for(var i=0;i<len;i++){str=str.replace("%s%",'<font color="#03b154">'+levelConfig.desc_ex[i]+"</font>")}return str};GwSkillData.prototype.specialSkill=function(value){var lvN=value+this.addLv;var str="";if(this.config.skill){var config=void 0;var index=this.skillId*1e3+lvN;for(var key in GlobalConfig.GWSkillReviseConfig){config=GlobalConfig.GWSkillReviseConfig[key];if(config.skill==this.config.skill&&config.gwIndex==index){str=config.desc;break}}}return str};Object.defineProperty(GwSkillData.prototype,"isOpen",{get:function(){var b=true;if(this.config.condition){for(var key in this.config.condition){var data=void 0;if(parseInt(key)==0){data=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(key)+1)}else{data=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(key))}if(data.skillLv<this.config.condition[key]){b=false;break}}return b}else{return b}},enumerable:true,configurable:true});Object.defineProperty(GwSkillData.prototype,"openTip",{get:function(){if(!this._openTip){this._openTip="";if(this.skillId==GodWeaponCC.ins().maxSkillIdAry[this.weaponId-1]){this._openTip=i18n("GodWeaponData_7")}else{for(var key in this.config.condition){var data=void 0;if(parseInt(key)==0){data=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(key)+1)}else{data=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(key))}if(this._openTip.length>0){this._openTip+="\n"}this._openTip+=data.config.skillName+i18n("GodWeaponData_8",this.config.condition[key])}}}return this._openTip},enumerable:true,configurable:true});return GwSkillData}();__reflect(GwSkillData.prototype,"GwSkillData");var GwItem=function(){function GwItem(){this.isCur=false}Object.defineProperty(GwItem.prototype,"itemId",{get:function(){return this._itemId},set:function(value){this._itemId=value;this.config=GlobalConfig.GodweaponItemConfig[this.itemId];this.itemConfig=GlobalConfig.ItemConfig[this.itemId]},enumerable:true,configurable:true});Object.defineProperty(GwItem.prototype,"openLv",{get:function(){return GlobalConfig.GodWeaponBaseConfig.openLevel[this.pos-1]},enumerable:true,configurable:true});Object.defineProperty(GwItem.prototype,"isOpen",{get:function(){var weaponData=GodWeaponCC.ins().getWeaponData(this.weaponId);if(weaponData&&weaponData.curLv<this.openLv){return false}return true},enumerable:true,configurable:true});Object.defineProperty(GwItem.prototype,"addatrStr",{get:function(){if(this._addStr==null){this._addStr="";for(var i=0;i<this.config.attr.length;i++){if(this._addStr.length>0){this._addStr+="\n"}this._addStr+=AttributeData.getAttrStrByType(this.config.attr[i].type)+" +"+this.config.attr[i].value}}return this._addStr},enumerable:true,configurable:true});Object.defineProperty(GwItem.prototype,"skillName",{get:function(){if(this._skillName==null){this._skillName="";for(var i=0;i<this.config.skill.length;i++){if(this._skillName.length>0){this._skillName+="、"}this._skillName+=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,this.config.skill[i]).config.skillName}}return this._skillName},enumerable:true,configurable:true});Object.defineProperty(GwItem.prototype,"skillPower",{get:function(){if(!this._skillPower){this._skillPower=0;var data=void 0;for(var i=0;i<this.config.skill.length;i++){data=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,this.config.skill[i]);if(data.config.exPower){this._skillPower+=data.config.exPower}if(data.config.attr){var dataList=[];for(var j=0;j<data.config.attr.length;j++){dataList.push(new AttributeData(data.config.attr[j].type,data.config.attr[j].value))}this._skillPower+=UserBag.getAttrPower(dataList)}}}return this._skillPower},enumerable:true,configurable:true});Object.defineProperty(GwItem.prototype,"power",{get:function(){if(!this._power){this._power=0;this._power+=this.skillPower;var data=[];for(var i=0;i<this.config.attr.length;i++){data.push(new AttributeData(this.config.attr[i].type,this.config.attr[i].value))}this._power+=UserBag.getAttrPower(data)}return this._power},enumerable:true,configurable:true});return GwItem}();__reflect(GwItem.prototype,"GwItem");var GodweaponItemData=function(){function GodweaponItemData(id,count,quality){this.id=id;this.count=count;this.quality=quality}return GodweaponItemData}();__reflect(GodweaponItemData.prototype,"GodweaponItemData");var GodweaponItemModel=function(_super){__extends(GodweaponItemModel,_super);function GodweaponItemModel(){return _super!==null&&_super.apply(this,arguments)||this}GodweaponItemModel.ins=function(){return _super.ins.call(this)};GodweaponItemModel.prototype.init=function(){if(this._qualityItemMap||this._jobItemMap)return;this._qualityItemMap={};this._jobItemMap={};for(var i in GlobalConfig.GodweaponItemConfig){var cfg=GlobalConfig.GodweaponItemConfig[i];var item=GlobalConfig.ItemConfig[cfg.id];var quality=ItemConfig.getQuality(item);if(quality<4){var ary=this._qualityItemMap[quality];if(ary==undefined){ary=[]}ary.push(cfg.id);this._qualityItemMap[quality]=ary}else if(quality==4){if(!cfg.skill||cfg.skill.length<=1){var job=ItemConfig.getJob(item);var dataAry=this._jobItemMap[job];if(dataAry==undefined){dataAry=[]}dataAry.push(cfg.id);this._jobItemMap[job]=dataAry}}}};Object.defineProperty(GodweaponItemModel.prototype,"qualityItemMap",{get:function(){if(!this._qualityItemMap){this.init()}return this._qualityItemMap},enumerable:true,configurable:true});Object.defineProperty(GodweaponItemModel.prototype,"jobItemMap",{get:function(){if(!this._jobItemMap){this.init()}return this._jobItemMap},enumerable:true,configurable:true});GodweaponItemModel.prototype.isCanCompound=function(){var canCompound=false;var qualityItemMap=this.qualityItemMap;for(var i in qualityItemMap){if(parseInt(i)<4){canCompound=this.checkNum(qualityItemMap[i]);if(canCompound)return canCompound}}return canCompound};GodweaponItemModel.prototype.checkNum=function(itemList){var count=itemList.length;var itemCount=0;for(var i=0;i<count;i++){itemCount+=UserBag.ins().getBagGoodsCountById(0,itemList[i])}return itemCount>=3};GodweaponItemModel.prototype.getCompoundItemList=function(){var list={};var canCompound=false;var qualityItemMap=this.qualityItemMap;for(var i in qualityItemMap){canCompound=this.checkNum(qualityItemMap[i]);if(canCompound){list[i]=this.getItemList(qualityItemMap[i])}}return list};GodweaponItemModel.prototype.filterCompoundItemList=function(data,list){var result=[];for(var i in list){var cfg=new GodweaponItemData(list[i].id,list[i].count,list[i].quality);if(cfg.quality==data.quality){if(cfg.id==data.id){if(cfg.count>1){cfg.count--;result.push(cfg)}}else{result.push(cfg)}}}return result};GodweaponItemModel.prototype.toList=function(list){var ary=[];for(var i in list){ary=ary.concat(list[i])}return ary};GodweaponItemModel.prototype.getItemList=function(itemList){var count=itemList.length;var ary=[];for(var i=0;i<count;i++){var itemId=itemList[i];var itemCount=UserBag.ins().getBagGoodsCountById(0,itemId);var quality=ItemConfig.getQuality(GlobalConfig.ItemConfig[itemId]);if(itemCount>0){ary.push(new GodweaponItemData(itemId,itemCount,quality))}}return ary};GodweaponItemModel.prototype.isCanFuse=function(){var canFuse=false;return canFuse};GodweaponItemModel.prototype.checkFuseNum=function(itemList){var count=0;var itemCount=0;for(var i=0;i<itemList.length;i++){itemCount=UserBag.ins().getBagGoodsCountById(0,itemList[i]);if(itemCount>0){count++;if(count>1){return true}}}return false};GodweaponItemModel.prototype.getFuseItemList=function(){var list={};var canFuse=false;var jobItemMap=this.jobItemMap;for(var i in jobItemMap){canFuse=this.checkFuseNum(jobItemMap[i]);if(canFuse){list[i]=this.getJobFuseItemList(jobItemMap[i])}}return list};GodweaponItemModel.prototype.getJobFuseItemList=function(itemList){var count=itemList.length;var ary=[];for(var i=0;i<count;i++){var id=itemList[i];var quality=ItemConfig.getQuality(GlobalConfig.ItemConfig[id]);var itemCount=UserBag.ins().getBagGoodsCountById(0,itemList[i]);if(itemCount>0){ary.push(new GodweaponItemData(id,itemCount,quality))}}return ary};GodweaponItemModel.prototype.filterFuseItemList=function(data,list){var result=[];var targetJob=ItemConfig.getJob(GlobalConfig.ItemConfig[data.id]);for(var i in list){var cfg=new GodweaponItemData(list[i].id,list[i].count,list[i].quality);var job=ItemConfig.getJob(GlobalConfig.ItemConfig[cfg.id]);if(targetJob==job&&data.id!=cfg.id){result.push(cfg)}}return result};GodweaponItemModel.prototype.getFuseTargetItem=function(itemId1,itemId2){var job=ItemConfig.getJob(GlobalConfig.ItemConfig[itemId1]);var itemId=4e5+job*1e4+Math.max(itemId1,itemId2)-Math.min(itemId1,itemId2)+100*(Math.min(itemId1,itemId2)%20);return itemId};return GodweaponItemModel}(BaseClass);__reflect(GodweaponItemModel.prototype,"GodweaponItemModel");var GodWeaponRedPoint=function(_super){__extends(GodWeaponRedPoint,_super);function GodWeaponRedPoint(){var _this=_super.call(this)||this;_this.gwTaskRed=false;_this.gwTaskRed1=false;_this.gwTaskRed2=false;_this.gwTaskRed3=false;_this.godWeaponRed=false;_this.gwMjRed=false;_this.gwSbRed=false;_this.gwSbRed1=false;_this.gwSbRed2=false;_this.gwSbRed3=false;_this.gwBossRp=false;_this.gwItem=false;_this.associated(_this.postGodWeapon,_this.postGwSb,_this.postGwMj,_this.postgGwBossRp,_this.postGodWeaponItem);_this.associated(_this.postGwSb,_this.postGwTab1,_this.postGwTab2,_this.postGwTab3);_this.associated(_this.postGwTask,GodWeaponCC.ins().postGwTask,GodWeaponCC.ins().postUpdateInfo,GameLogic.ins().postSubRoleChange);_this.associated(_this.postGwMj,GodWeaponCC.ins().postFubenInfo);_this.associated(_this.postGwTab1,_this.postGwTask,GodWeaponCC.ins().postUpdateInfo,GodWeaponCC.ins().postUpdateExp);_this.associated(_this.postGwTab2,_this.postGwTask,GodWeaponCC.ins().postUpdateInfo,GodWeaponCC.ins().postUpdateExp);_this.associated(_this.postGwTab3,_this.postGwTask,GodWeaponCC.ins().postUpdateInfo,GodWeaponCC.ins().postUpdateExp);_this.associated(_this.postgGwBossRp,UserBoss.ins().postWorldBoss,GodWeaponCC.ins().postUpdateInfo,UserBoss.ins().postWorldNotice,UserBoss.ins().postUpdateWorldPlayList,Actor.ins().postYbChange,UserBag.ins().postItemDel,UserBag.ins().postItemAdd);_this.associated(_this.postGodWeaponItem,UserBag.ins().postItemAdd,UserBag.ins().postItemDel,UserBag.ins().postItemCountChange);return _this}GodWeaponRedPoint.prototype.postGodWeaponItem=function(){return false};GodWeaponRedPoint.prototype.postGodWeapon=function(){var oldv=this.godWeaponRed;this.godWeaponRed=this.gwSbRed||this.gwMjRed||this.gwItem||this.gwBossRp;return oldv!=this.godWeaponRed};GodWeaponRedPoint.prototype.postGwSb=function(){var oldv=this.gwSbRed;this.gwSbRed=this.gwSbRed1||this.gwSbRed2||this.gwSbRed3;return oldv!=this.gwSbRed};GodWeaponRedPoint.prototype.postGwTab1=function(){var oldv=this.gwSbRed1;if(this.gwTaskRed1){this.gwSbRed1=true}else if(GodWeaponCC.ins().getWeaponData(1)){this.gwSbRed1=GodWeaponCC.ins().maxLvRedPoint()||GodWeaponCC.ins().getWeaponData(1).hasRedPoint||GodWeaponCC.ins().getSwRedPoint(1);if(!this.gwSbRed1)this.gwSbRed1=GodWeaponCC.ins().weaponIsActive(1)&&GodWeaponCC.ins().maxLvRedPoint()}else{this.gwSbRed1=false}return oldv!=this.gwSbRed1};GodWeaponRedPoint.prototype.postGwTab2=function(){var oldv=this.gwSbRed2;if(this.gwTaskRed2){this.gwSbRed2=true}else if(GodWeaponCC.ins().getWeaponData(2)){this.gwSbRed2=GodWeaponCC.ins().maxLvRedPoint()||GodWeaponCC.ins().getWeaponData(2).hasRedPoint||GodWeaponCC.ins().getSwRedPoint(2);if(!this.gwSbRed2)this.gwSbRed2=GodWeaponCC.ins().weaponIsActive(2)&&GodWeaponCC.ins().maxLvRedPoint()}else{this.gwSbRed2=false}return oldv!=this.gwSbRed2};GodWeaponRedPoint.prototype.postGwTab3=function(){var oldv=this.gwSbRed3;if(this.gwTaskRed3){this.gwSbRed3=true}else if(GodWeaponCC.ins().getWeaponData(3)){this.gwSbRed3=GodWeaponCC.ins().maxLvRedPoint()||GodWeaponCC.ins().getWeaponData(3).hasRedPoint||GodWeaponCC.ins().getSwRedPoint(3);if(!this.gwSbRed3)this.gwSbRed3=GodWeaponCC.ins().weaponIsActive(3)&&GodWeaponCC.ins().maxLvRedPoint()}else{this.gwSbRed3=false}return oldv!=this.gwSbRed3};GodWeaponRedPoint.prototype.postGwMj=function(){var oldv=this.gwMjRed;this.gwMjRed=GodWeaponCC.ins().mijintHadRedPoint();return oldv!=this.gwMjRed};GodWeaponRedPoint.prototype.postGwTask=function(){var oldv=this.gwTaskRed;this.gwTaskRed=false;if(GodWeaponCC.ins().taskIsOpen()){var gwTask=GodWeaponCC.ins().gwTask;if(gwTask.statue==GwTaskData.DONE||gwTask.statue==GwTaskData.FINISH){this.gwTaskRed=true}else if(gwTask.taskIdx==0&&SubRoles.ins().subRolesLen>GodWeaponCC.ins().weaponDataAry.length){this.gwTaskRed=true}if(this.gwTaskRed){for(var i=1;i<=3;i++){if(GodWeaponCC.ins().getWeaponData(i)){this["gwTaskRed"+i]=false}else if(SubRoles.ins().getSubRoleByJob(i)&&gwTask.taskIdx==0||gwTask.weapon==i){this["gwTaskRed"+i]=true}else{this["gwTaskRed"+i]=false}}}else{this.gwTaskRed1=false;this.gwTaskRed2=false;this.gwTaskRed3=false}}return true};GodWeaponRedPoint.prototype.postgGwBossRp=function(){var oldv=this.gwBossRp;this.gwBossRp=GodWeaponCC.ins().godWeaponIsOpen()&&(UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_GODWEAPON)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP));return oldv!=this.gwBossRp};return GodWeaponRedPoint}(BaseSystem);__reflect(GodWeaponRedPoint.prototype,"GodWeaponRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.godweaponRedPoint=GodWeaponRedPoint.ins.bind(GodWeaponRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GwFubenData=function(){function GwFubenData(){}GwFubenData.prototype.parse=function(bytes){this.hadBuyData=[];this.hadChallengeNum=bytes.readInt();this.vipBuyNum=bytes.readInt();this.hadPass=bytes.readInt();this.curPoint=bytes.readInt();var count=bytes.readInt();for(var i=0;i<count;i++){var tempA=[];tempA.push(bytes.readInt());tempA.push(bytes.readInt());this.hadBuyData[i]=tempA}this.getList()};Object.defineProperty(GwFubenData.prototype,"hadPass",{get:function(){return this._hadPass},set:function(value){this._hadPass=value},enumerable:true,configurable:true});GwFubenData.prototype.getList=function(){var maxNum=this.getMaxGird();var endNum;if(this.curPoint==1){endNum=Math.min(this._hadPass+1,maxNum)}else{endNum=this._hadPass}this.listData=[];var data;for(var i=endNum;i>0;i--){data=new GwfubenFloorData;data.gridNum=i;if(data.gridNum>this._hadPass){data.curPoint=0}else if(data.gridNum==this._hadPass){data.curPoint=this.curPoint}else{data.curPoint=1}this.listData.push(data)}};GwFubenData.prototype.getMaxGird=function(){if(!this._maxGird){this._maxGird=0;for(var key in GlobalConfig.GodWeaponFubenConfig){this._maxGird++}}return this._maxGird};GwFubenData.prototype.buyTypeData=function(type){for(var i=0;i<this.hadBuyData.length;i++){if(this.hadBuyData[i][0]==type){return this.hadBuyData[i]}}return[type,0]};Object.defineProperty(GwFubenData.prototype,"getBuyCount",{get:function(){var num=0;for(var i=0;i<this.hadBuyData.length;i++){num+=this.hadBuyData[i][1]}return num},enumerable:true,configurable:true});return GwFubenData}();__reflect(GwFubenData.prototype,"GwFubenData");var GwfubenFloorData=function(){function GwfubenFloorData(){}Object.defineProperty(GwfubenFloorData.prototype,"gridNum",{get:function(){return this._gridNum},set:function(value){this._gridNum=value;this.config=GlobalConfig.GodWeaponFubenConfig[value]},enumerable:true,configurable:true});return GwfubenFloorData}();__reflect(GwfubenFloorData.prototype,"GwfubenFloorData");var GwRankInfoData=function(){function GwRankInfoData(){}GwRankInfoData.prototype.parse=function(bytes){this.rank=bytes.readInt();this.nameStr=bytes.readString();var num=bytes.readInt();this.floorNum=Math.floor(num/1e4);this.timeNum=1e4-num%1e4};GwRankInfoData.prototype.getgetTimeStr=function(){var str="";str=DateUtils.getFormatBySecond(this.timeNum,DateUtils.TIME_FORMAT_3);return str};return GwRankInfoData}();__reflect(GwRankInfoData.prototype,"GwRankInfoData");var GwTaskData=function(){function GwTaskData(){}GwTaskData.prototype.parser=function(bytes){this.weaponIdx=bytes.readInt();this.weapon=bytes.readInt();this.taskIdx=bytes.readInt();this.progress=bytes.readInt();this.statue=bytes.readInt()};GwTaskData.DOING=0;GwTaskData.DONE=1;GwTaskData.FINISH=2;return GwTaskData}();__reflect(GwTaskData.prototype,"GwTaskData");var GodweaponItem=function(_super){__extends(GodweaponItem,_super);function GodweaponItem(){return _super!==null&&_super.apply(this,arguments)||this}GodweaponItem.prototype.dataChanged=function(){var item=GlobalConfig.ItemConfig[this.data.id];this.shengwuImg.source=item.icon+"_png";this.shengwuName.text=item.name;this.shengwuName.textColor=ItemConfig.getQualityColor(item);this.shengwuName.strokeColor=ItemConfig.getQualityStrokeColor(item);this.frame.source="godweapon_quality"+(ItemConfig.getQuality(item)+1);this.imgJob.source="job"+ItemConfig.getJob(item)+"Item";if(this.data.count){this.count.text=this.data.count}else{this.count.text=""}};return GodweaponItem}(BaseItemRender);__reflect(GodweaponItem.prototype,"GodweaponItem");var GodweaponItemMixView=function(_super){__extends(GodweaponItemMixView,_super);function GodweaponItemMixView(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.isHintEffectPlay=false;_this.isPlay=false;_this.COMPOUND_STATE="mix";_this.FUSE_STATE="ultramix";_this.PAGE_SIZE=5;return _this}GodweaponItemMixView.prototype.open=function(){this.mix1.touchChildren=false;this.mix2.touchChildren=false;this.mix3.touchChildren=false;this.targetGroup.touchChildren=false;this.mix.enabled=false;this.list.itemRenderer=GodweaponItem;this.labelEffect=new MovieClip;this.labelEffect.scaleX=.6;this.labelEffect.scaleY=.5;this.labelEffect.touchEnabled=false;this.hintEffect=new MovieClip;this.hintEffect.touchEnabled=false;this.descTxt.alpha=1;this.MaterialItemId=ItemConst.GODWEAPON_ITEM;this.addCustomEvent();this.updateView()};GodweaponItemMixView.prototype.close=function(){this.cleanTween()};GodweaponItemMixView.prototype.addCustomEvent=function(){this.addTouchEvent(this.turn,this.changeState);this.addTouchEvent(this.leftButton,this.prevPage);this.addTouchEvent(this.rightButton,this.nextPage);this.addTouchEvent(this.mix1,this.touchMixItem);this.addTouchEvent(this.mix2,this.touchMixItem);this.addTouchEvent(this.mix3,this.touchMixItem);this.addTouchEvent(this.targetGroup,this.touchTargetItem);this.addTouchEvent(this.mix,this.operate);this.addTouchEvent(this.mixMaterial,this.onTouch);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this);this.observe(GodWeaponItemCC.ins().postCompound,this.onCompound);this.observe(GodWeaponItemCC.ins().postFuse,this.onFuse)};GodweaponItemMixView.prototype.operate=function(){if(!this.mix.enabled)return;if(this.currentState==this.FUSE_STATE){GodWeaponItemCC.ins().requestFuse(this.mixData1.id,this.mixData2.id,this.isMaterial?1:0)}else{GodWeaponItemCC.ins().requestCompound(this.mixData1.id,this.mixData2.id,this.mixData3.id)}};GodweaponItemMixView.prototype.onCompound=function(data){var _this=this;this.mix.enabled=false;this.isMaterial=false;this.addEffect();TimerManager.ins().doTimerDelay(300,0,1,function(){_this.addEffect(function(){_this.updateView();_this.updateTargetItem(data.id);_this.addResultEffect(data.isSuccess,data.id,true)})},this)};GodweaponItemMixView.prototype.addResultEffect=function(success,id,isForceFly){var _this=this;if(isForceFly===void 0){isForceFly=false}var effect=new MovieClip;effect.x=this.targetGroup.width/2;this.targetGroup.addChild(effect);var effectPath;if(success){effectPath=RES_DIR_EFF+"forgeSuccess";effect.y=this.targetGroup.height/2-15}else{effectPath=RES_DIR_EFF+"litboom";effect.y=this.targetGroup.height/2}effect.playFile(effectPath,1,function(){if(!isForceFly){_this.cleanEff()}if(id&&(isForceFly||success)){_this.flyItem(id)}})};GodweaponItemMixView.prototype.playEff=function(fun){var _this=this;if(this.isPlay){return}var effSour=RES_DIR_EFF+"jljdt";this.isPlay=true;var speed=1;var leff=new MovieClip;leff.playFile(effSour,-1);this.leftEff.addChild(leff);leff.scaleX=0;leff.scaleY=.6;var reff=new MovieClip;reff.playFile(effSour,-1);this.rightEff.addChild(reff);reff.scaleX=0;reff.scaleY=.6;var beff=new MovieClip;beff.playFile(effSour,-1);this.buttonEff.addChild(beff);beff.x+=14;beff.scaleX=0;beff.scaleY=.6;beff.$setRotation(90);var maxX=.23;var t1=egret.Tween.get(leff);var t2=egret.Tween.get(reff);t2.to({scaleX:maxX},250*speed);t1.to({scaleX:maxX},250*speed).call(function(){var t3=egret.Tween.get(beff);t3.to({scaleX:.35},250*speed).call(function(){_this.isPlay=false;if(fun)fun.call(_this)})})};GodweaponItemMixView.prototype.cleanEff=function(){this.leftEff.removeChildren();this.rightEff.removeChildren();this.buttonEff.removeChildren()};GodweaponItemMixView.prototype.addEffect=function(fun){var _this=this;var effect=new MovieClip;effect.scaleX=3;effect.scaleY=3;effect.x=this.targetGroup.width/2-4;effect.y=this.targetGroup.height/2-7;this.targetGroup.addChild(effect);var path=DisplayUtils.getEffectPath("forceguildeff");effect.playFile(path,1,function(){if(fun)fun.call(_this)})};GodweaponItemMixView.prototype.onFuse=function(data){var _this=this;this.mix.enabled=false;this.isMaterial=false;var success=data.isSuccess;var weaponData;if(!success&&this.mixData1){weaponData=new GodweaponItemData(this.mixData1.id,this.mixData1.count,this.mixData1.quality)}this.playEff(function(){_this.updateView();_this.updateTargetItem(data.id);if(!success&&weaponData){_this.updateMixItem(1,weaponData);if(_this.mixData1&&_this.currentState==_this.FUSE_STATE){_this.dataSource=new PageArray(_this.updateMixData(),_this.PAGE_SIZE);_this.setPageData()}}_this.addResultEffect(success,data.id)})};GodweaponItemMixView.prototype.flyItem=function(itemId){var itemBase=new ItemBase;itemBase.x=this.targetGroup.x;itemBase.y=this.targetGroup.y;itemBase.data=itemId;itemBase.anchorOffsetX=itemBase.width/2;itemBase.anchorOffsetY=itemBase.height/2;this.targetGroup.parent.addChild(itemBase);GameLogic.ins().postFlyItemEx(itemBase)};GodweaponItemMixView.prototype.touchMixItem=function(e){var group=e.target;var index=1;if(group==this.mix1){index=1}else if(group==this.mix2){index=2}else if(group==this.mix3){index=3}if(!this["mixData"+index]){this.addHintEffect()}this.updateMixItem(index);if(this.currentState!=this.FUSE_STATE){this.setCompoundState(false)}else{this.updateTargetItem();if(index==1)this.updateMixItem(2)}this.dataSource=new PageArray(this.updateMixData(),this.PAGE_SIZE);this.setPageData()};GodweaponItemMixView.prototype.touchTargetItem=function(){var isFuse=this.isCanFuse();if(!isFuse)this.updateTargetItem()};GodweaponItemMixView.prototype.updateTargetItem=function(itemId){if(itemId===void 0){itemId=0}if(itemId){var item=GlobalConfig.ItemConfig[itemId];this.targetImg.visible=true;this.targetImg.source=item.icon+"_png";this.targetLabel.text=item.name;this.targetLabel.textColor=ItemConfig.getQualityColor(item);this.targetLabel.strokeColor=ItemConfig.getQualityStrokeColor(item)}else{var isCanCompound=this.isCanCompound();this.setCompoundState(isCanCompound);this.targetLabel.textColor=13746831;this.targetImg.source="";this.targetImg.visible=false}};GodweaponItemMixView.prototype.setCompoundState=function(isCanCompound){var desc;if(isCanCompound){desc=i18n("GodWeaponItemMixView_0")}else{desc=""}this.targetLabel.text=desc;this.targetRandom.visible=isCanCompound;this.mixline0Effect.visible=isCanCompound;this.mixline1Effect.visible=isCanCompound};GodweaponItemMixView.prototype.updateMixItem=function(itemIndex,itemData){if(itemData===void 0){itemData=null}var img=this["mix"+itemIndex+"Img"];var label=this["mix"+itemIndex+"Name"];if(itemData){img.visible=true;var item=GlobalConfig.ItemConfig[itemData.id];img.source=item.icon+"_png";label.text=item.name;label.textColor=ItemConfig.getQualityColor(item);label.strokeColor=ItemConfig.getQualityStrokeColor(item)}else{label.text="";img.visible=false}this["mixData"+itemIndex]=itemData};GodweaponItemMixView.prototype.addHintEffect=function(){var _this=this;if(this.isHintEffectPlay)return;DisplayUtils.removeFromParent(this.hintEffect);this.list.addChild(this.hintEffect);this.isHintEffectPlay=true;this.hintEffect.x=241;this.hintEffect.y=49;var path=DisplayUtils.getEffectPath("mixhint");this.hintEffect.playFile(path,1,function(){_this.isHintEffectPlay=false})};GodweaponItemMixView.prototype.onListChange=function(){var data=this.list.selectedItem;var isSuccess=this.setMixData(data);if(isSuccess){var isFuse=this.isCanFuse();if(!isFuse)this.updateTargetItem();this.dataSource=new PageArray(this.updateMixData(),this.PAGE_SIZE);this.setPageData()}else{UserTips.ins().showTips(i18n("GodWeaponItemMixView_1"))}};GodweaponItemMixView.prototype.setMixData=function(data){if(this.currentState==this.FUSE_STATE){var isFuse=this.isCanFuse();if(isFuse)return false;var index=1;if(!this.mixData1){this.mixData1=data;index=1}else if(!this.mixData2){this.mixData2=data;index=2}this.updateMixItem(index,data);return true}else{var isCompound=this.isCanCompound();if(isCompound)return false;var index=1;if(!this.mixData1){this.mixData1=data;index=1}else if(!this.mixData2){this.mixData2=data;index=2}else if(!this.mixData3){this.mixData3=data;index=3}this.updateMixItem(index,data);return true}};GodweaponItemMixView.prototype.isCanCompound=function(){return this.mixData1&&this.mixData2&&this.mixData3&&this.currentState!=this.FUSE_STATE};GodweaponItemMixView.prototype.isCanFuse=function(){return this.mixData1&&this.mixData2&&this.currentState==this.FUSE_STATE};GodweaponItemMixView.prototype.updateMixData=function(){var result=this.dataList.concat();if(this.currentState==this.FUSE_STATE){if(this.mixData1){result=GodweaponItemModel.ins().filterFuseItemList(this.mixData1,result)}if(this.mixData2){result=GodweaponItemModel.ins().filterFuseItemList(this.mixData2,result)}var isFuse=this.isCanFuse();this.mix.enabled=isFuse;if(isFuse)this.updateTargetItem(GodweaponItemModel.ins().getFuseTargetItem(this.mixData1.id,this.mixData2.id))}else{if(this.mixData1){result=GodweaponItemModel.ins().filterCompoundItemList(this.mixData1,result)}if(this.mixData2){result=GodweaponItemModel.ins().filterCompoundItemList(this.mixData2,result)}if(this.mixData3){result=GodweaponItemModel.ins().filterCompoundItemList(this.mixData3,result)}this.mix.enabled=this.isCanCompound()}return result};GodweaponItemMixView.prototype.changeState=function(){if(this.currentState==this.FUSE_STATE){this.currentState=this.COMPOUND_STATE}else{this.currentState=this.FUSE_STATE}this.updateView()};GodweaponItemMixView.prototype.prevPage=function(){this.dataSource.prev();this.setPageData()};GodweaponItemMixView.prototype.nextPage=function(){this.dataSource.next();this.setPageData()};GodweaponItemMixView.prototype.setPageData=function(){this.leftButton.visible=this.dataSource.havePre();this.rightButton.visible=this.dataSource.haveNext();this.list.dataProvider=new ArrayCollection(this.dataSource.pageData)};GodweaponItemMixView.prototype.clearView=function(){for(var i=1;i<4;i++){this["mixData"+i]=null;this.updateMixItem(i)}this.updateTargetItem()};GodweaponItemMixView.prototype.updateView=function(){var data;var labelDesc;var isCanOperate;this.clearView();if(this.currentState==this.FUSE_STATE){data=GodweaponItemModel.ins().getFuseItemList();labelDesc=i18n("GodWeaponItemMixView_2");isCanOperate=GodweaponItemModel.ins().isCanCompound();this.startTween()}else{data=GodweaponItemModel.ins().getCompoundItemList();labelDesc=i18n("GodWeaponItemMixView_3");isCanOperate=GodweaponItemModel.ins().isCanFuse();this.cleanTween()}if(isCanOperate){this.addLabelEffect()}else{this.removeLabelEffect()}this.turn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+labelDesc+"</u></a>");this.dataList=GodweaponItemModel.ins().toList(data);this.noItemDesc.visible=this.dataList.length==0;this.dataSource=new PageArray(this.dataList,this.PAGE_SIZE);this.setPageData();this.updateShengWu()};GodweaponItemMixView.prototype.addLabelEffect=function(){var _this=this;TimerManager.ins().doNext(function(){DisplayUtils.removeFromParent(_this.labelEffect);_this.labelEffect.x=_this.turn.x+45;_this.labelEffect.y=_this.turn.y+11;_this.labelEffect.scaleX=_this.labelEffect.scaleX=.7;if(_this.labelEffect.parent==null){_this.turn.parent.addChild(_this.labelEffect)}_this.labelEffect.playFile(RES_DIR_EFF+"chargeff1",-1)},this)};GodweaponItemMixView.prototype.removeLabelEffect=function(){this.labelEffect.stop();DisplayUtils.removeFromParent(this.labelEffect)};GodweaponItemMixView.prototype.onTouch=function(e){switch(e.currentTarget){case this.mixMaterial:if(this.isMaterial){this.isMaterial=false;this.addShengWu()}else{var itemData=UserBag.ins().getBagItemById(this.MaterialItemId);if(itemData){this.isMaterial=true;this.addShengWu()}else{this.isMaterial=false;UserWarn.ins().setBuyGoodsWarn(this.MaterialItemId)}}break}};GodweaponItemMixView.prototype.updateShengWu=function(){this.descTxt.text=this.isMaterial?i18n("GodWeaponItemMixView_5"):i18n("GodWeaponItemMixView_6");if(this.isMaterial){this.setLight(this.mixMaterialImg);this.setLight(this.mixlabel)}else{this.setGray(this.mixMaterialImg);this.setGray(this.mixlabel)}};GodweaponItemMixView.prototype.addShengWu=function(){this.updateShengWu();if(this.isMaterial){this.cleanTween()}else{this.startTween()}};GodweaponItemMixView.prototype.startTween=function(){if(!this.isMaterial){this.cleanTween();this.descTxt.alpha=0;this.playTween()}};GodweaponItemMixView.prototype.playTween=function(){if(this.tw)return;this.tw=egret.Tween.get(this.descTxt,{loop:true});var alpha=this.descTxt.alpha?0:1;this.tw.to({alpha:alpha},600).to({alpha:1-alpha},600)};GodweaponItemMixView.prototype.cleanTween=function(){this.descTxt.alpha=1;if(this.tw)egret.Tween.removeTweens(this.descTxt);this.tw=null};GodweaponItemMixView.prototype.setGray=function(pic){var colorMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];pic.filters=[new egret.ColorMatrixFilter(colorMatrix)];this.materialTxt.visible=this.materialTxtImg.visible=true};GodweaponItemMixView.prototype.setLight=function(pic){pic.filters=[];this.materialTxt.visible=this.materialTxtImg.visible=false};return GodweaponItemMixView}(BaseView);__reflect(GodweaponItemMixView.prototype,"GodweaponItemMixView");var GodWeaponWin=function(_super){__extends(GodWeaponWin,_super);function GodWeaponWin(){var _this=_super.call(this)||this;_this._selectIndex=-1;return _this}GodWeaponWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GwSkin";this.isTopLevel=true;this.gwRp.visible=false;this.mjRp.visible=false;this.gwBossRp.visible=false};GodWeaponWin.openCheck=function(){if(UserZs.ins().lv>=GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel){if(GameServer.serverOpenDay+1>=GlobalConfig.GodWeaponBaseConfig.openDay){return true}else{UserTips.ins().showTips(i18n("GodWeaponWin_4",GlobalConfig.GodWeaponBaseConfig.openDay));return false}}else{UserTips.ins().showTips(i18n("GodWeaponWin_3",GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel));return false}};GodWeaponWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(GodWeaponRedPoint.ins().postGwMj,this.updateRedPoint);this.observe(GodWeaponRedPoint.ins().postGwSb,this.updateRedPoint);this.observe(GodWeaponRedPoint.ins().postgGwBossRp,this.updateRedPoint);this.observe(GodWeaponRedPoint.ins().postGodWeaponItem,this.updateRedPoint);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.help,this.onTap);this.gwadImg.visible=false;this.gwadImg.source="";this.tab.visible=true;this.timeBp.visible=false;this.addChangeEvent(this.tab,this.itemTouchHandler);this.addChangingEvent(this.tab,this.itemTouching);if(param[0]&&this.checkIsOpen(param[0])){this.viewStack.selectedIndex=param[0];this.selectIndex=this.tab.selectedIndex=param[0]}else{this.viewStack.selectedIndex=0;this.selectIndex=this.tab.selectedIndex=0}this.updateRedPoint()};GodWeaponWin.prototype.gwTimeShow=function(){var days=GlobalConfig.GodWeaponBaseConfig.openDay-GameServer.serverOpenDay;var totalNum=days*DateUtils.SECOND_PER_DAY;this.totalNumber=totalNum-DateUtils.getTodayPassedSecond();this.updateAward();var num=this.totalNumber;TimerManager.ins().doTimer(1e3,num,this.updateAward,this)};GodWeaponWin.prototype.updateAward=function(){if(this.totalNumber<=0){TimerManager.ins().remove(this.updateAward,this);this.updateOpen();return}var str=DateUtils.getFormatBySecond(this.totalNumber,DateUtils.TIME_FORMAT_1);var temp=str.split(":");str=temp.join(".");this.timeBp.text=str;this.totalNumber--};GodWeaponWin.prototype.updateOpen=function(){this.gwadImg.visible=false;this.gwadImg.source="";this.tab.visible=true;this.timeBp.visible=false;this.viewStack.selectedIndex=0;this.selectIndex=0};GodWeaponWin.prototype.updateRedPoint=function(){this.gwRp.visible=GodWeaponRedPoint.ins().gwSbRed;this.mjRp.visible=GodWeaponRedPoint.ins().gwMjRed;this.gwBossRp.visible=GodWeaponRedPoint.ins().gwBossRp;this.mixRp.visible=GodWeaponRedPoint.ins().gwItem};GodWeaponWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this._selectIndex>-1)this.viewStack.getChildAt(this._selectIndex)["close"]()};Object.defineProperty(GodWeaponWin.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(value){if(this._selectIndex>-1){this.viewStack.getChildAt(this._selectIndex)["close"]()}this._selectIndex=value;this.viewStack.getChildAt(this._selectIndex)["open"]();if(this._selectIndex==3){this.help.visible=true}else{this.help.visible=false}},enumerable:true,configurable:true});GodWeaponWin.prototype.itemTouchHandler=function(e){this.selectIndex=this.tab.selectedIndex};GodWeaponWin.prototype.itemTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};GodWeaponWin.prototype.checkIsOpen=function(selectIndex){if(selectIndex>=1){if(UserZs.ins().lv>=GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel&&GameServer.serverOpenDay+1>=GlobalConfig.GodWeaponBaseConfig.openDay){return true}else{if(UserZs.ins().lv<GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel){UserTips.ins().showTips(i18n("GodWeaponWin_0",GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel))}else if(GameServer.serverOpenDay<GlobalConfig.GodWeaponBaseConfig.openDay){UserTips.ins().showTips(i18n("GodWeaponWin_1",GlobalConfig.GodWeaponBaseConfig.openDay))}return false}}return true};GodWeaponWin.prototype.onTap=function(e){var tar=e.currentTarget;switch(tar){case this.closeBtn:ViewManager.ins().close(this);break;case this.help:if(this._selectIndex==3)ViewManager.ins().open(ZsBossRuleSpeak,23);break}};return GodWeaponWin}(BaseEuiView);__reflect(GodWeaponWin.prototype,"GodWeaponWin");ViewManager.ins().reg(GodWeaponWin,LayerManager.UI_Main);var GwAddAttrView=function(_super){__extends(GwAddAttrView,_super);function GwAddAttrView(){return _super.call(this)||this}GwAddAttrView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GwAttrskin";this._ary=new eui.ArrayCollection;this.list.dataProvider=this._ary;this.list.itemRenderer=GwAddAttrRender};GwAddAttrView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._ary.replaceAll(GodWeaponCC.ins().gwAddAttr(param[0]));this.addTouchEvent(this.rect,this.onTap);switch(param[0]){case 0:this.GwName.text=i18n("GwAddAttrView_0");break;case 1:this.GwName.text=i18n("GwAddAttrView_1");break;case 2:this.GwName.text=i18n("GwAddAttrView_2");break}};GwAddAttrView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list.dataProvider=null;this.removeTouchEvent(this.rect,this.onTap)};GwAddAttrView.prototype.onTap=function(e){ViewManager.ins().close(this)};return GwAddAttrView}(BaseEuiView);__reflect(GwAddAttrView.prototype,"GwAddAttrView");var GwAddAttrRender=function(_super){__extends(GwAddAttrRender,_super);function GwAddAttrRender(){return _super.call(this)||this}GwAddAttrRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);if(!this.data){return}this._thisData=this.data;this.labelInfo.text=AttributeData.getAttrStrByType(this._thisData.type)+"："+this._thisData.value};return GwAddAttrRender}(BaseItemRender);__reflect(GwAddAttrRender.prototype,"GwAddAttrRender");ViewManager.ins().reg(GwAddAttrView,LayerManager.UI_Popup);var GwBossChallengeView=function(_super){__extends(GwBossChallengeView,_super);function GwBossChallengeView(){var _this=_super.call(this)||this;_this._cdTime=0;_this.skinName="GwBossChallengeSkin";return _this}GwBossChallengeView.prototype.childrenCreated=function(){this.reward.itemRenderer=ItemBase;this._awardAC=new eui.ArrayCollection;this.reward.dataProvider=this._awardAC};GwBossChallengeView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.notBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.challengeBtn,this.onTap);this._bossData=param[0];this.initView()};GwBossChallengeView.prototype.initView=function(){var data=this._bossData;var config=GlobalConfig.WorldBossConfig[data.id];this.title.text=config.showName;this._awardAC.source=config.showReward.concat();var needYb=GlobalConfig.WorldBossBaseConfig.challengeItemYb[config.type-1];this.yuanbao.text=""+needYb;var itemId=GlobalConfig.WorldBossBaseConfig.challengeItem[config.type-1];this.ticket.source=itemId+"_png";var item=UserBag.ins().getBagGoodsByTypeAndId(0,itemId);var count=0;if(item)count=item.count;this.num.text=""+count;if(count)this.num.textColor=ColorUtil.GREEN_COLOR_N;else this.num.textColor=ColorUtil.RED_COLOR_N;var endTime=Math.ceil((UserBoss.ins().worldBossCd[config.type]-egret.getTimer())/1e3);if(endTime>0){this.leftCDText.visible=true;this.updateCDTime(endTime)}else{this.leftCDText.visible=false}};GwBossChallengeView.prototype.updateCDTime=function(cd){this._cdTime=cd;TimerManager.ins().remove(this.updateBtnLabel,this);if(cd>0)TimerManager.ins().doTimer(1e3,cd,this.updateBtnLabel,this);this.updateBtnLabel()};GwBossChallengeView.prototype.updateBtnLabel=function(){this.leftCDText.text=i18n("GwBossChallengeView_0",this._cdTime);this._cdTime-=1;if(this._cdTime<=0)this.leftCDText.text=""};GwBossChallengeView.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.notBtn||tar==this.bgClose||tar==this.closeBtn){ViewManager.ins().close(this)}else if(tar==this.challengeBtn){this.onChallenge()}};GwBossChallengeView.prototype.onChallenge=function(){if(UserFb.ins().checkInFB())return false;var config=GlobalConfig.WorldBossConfig[this._bossData.id];if(this._bossData.canInto){if(this._bossData.isDie){UserTips.ins().showTips(i18n("GwBossChallengeView_1"))}else if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH)}else{var endTime=Math.ceil((UserBoss.ins().worldBossCd[config.type]-egret.getTimer())/1e3);if(endTime>0){UserTips.ins().showTips(i18n("GwBossChallengeView_2",endTime));return false}var needYb=GlobalConfig.WorldBossBaseConfig.challengeItemYb[config.type-1];var itemId=GlobalConfig.WorldBossBaseConfig.challengeItem[config.type-1];var item=UserBag.ins().getBagGoodsByTypeAndId(0,itemId);if((!item||!item.count)&&Actor.yb<needYb){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("GwBossChallengeView_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GwBossChallengeView_4"))}ViewManager.ins().close(this);return false}UserBoss.ins().sendChallengWorldBoss(this._bossData.id,config.type);ViewManager.ins().close(this);return true}}else{UserTips.ins().showTips(i18n("GwBossChallengeView_5"))}return false};GwBossChallengeView.prototype.close=function(){};return GwBossChallengeView}(BaseEuiView);__reflect(GwBossChallengeView.prototype,"GwBossChallengeView");ViewManager.ins().reg(GwBossChallengeView,LayerManager.UI_Popup);var GwBossItem=function(_super){__extends(GwBossItem,_super);function GwBossItem(){var _this=_super.call(this)||this;_this.states=["cannot","already","havetime"];_this.addEventListener(egret.Event.REMOVED_FROM_STAGE,_this.onRemove,_this);return _this}GwBossItem.prototype.dataChanged=function(){var data=this.data;var config=GlobalConfig.WorldBossConfig[data.id];this.fbname.text=config.showName;if(this.selected)this.bg0.visible=true;else this.bg0.visible=false;this.enabled=true;TimerManager.ins().remove(this.updateTime,this);if(data.canChallenge){this.currentState=this.states[1]}else if(data.isDie&&data.canInto){this.updateTime();TimerManager.ins().doTimer(1e3,0,this.updateTime,this);this.currentState=this.states[2]}else{this.enabled=false;this.currentState=this.states[0]}this.levelNeed.text=i18n("GwBossItem_1",config.zsLevel[0],config.zsLevel[1])};GwBossItem.prototype.updateTime=function(){var time=this.data.relieveTime-egret.getTimer();this.timeTxt.text=""+DateUtils.getFormatBySecond(Math.floor(time/1e3),1);if(time<=0){TimerManager.ins().remove(this.updateTime,this);this.timeTxt.text=""}};GwBossItem.prototype.onRemove=function(e){TimerManager.ins().remove(this.updateTime,this)};return GwBossItem}(BaseItemRender);__reflect(GwBossItem.prototype,"GwBossItem");var GwBossView=function(_super){__extends(GwBossView,_super);function GwBossView(){var _this=_super.call(this)||this;_this.numToStr=[i18n("GwBossView_0"),i18n("GwBossView_1"),i18n("GwBossView_2"),i18n("GwBossView_3"),i18n("GwBossView_4")];return _this}GwBossView.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>");this.remindTpis.touchEnabled=true};GwBossView.prototype.open=function(){this.addTouchEvent(this.gw0,this.onTap);this.addTouchEvent(this.gw1,this.onTap);this.addTouchEvent(this.gw2,this.onTap);this.addTouchEvent(this.tower,this.onTap);this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this);this.observe(UserZs.ins().postZsLv,this.initData);this.observe(UserBoss.ins().postWorldBoss,this.onUpdateBoss);TimerManager.ins().doTimer(3e3,0,this.onUpdateTime,this);TimerManager.ins().doTimer(1e3,0,this.onUpdateDieTime,this);this.initData()};GwBossView.prototype.onUpdateTime=function(){UserBoss.ins().sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_GODWEAPON);UserBoss.ins().sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP)};GwBossView.prototype.onUpdateDieTime=function(){this.initData()};GwBossView.prototype.initData=function(){var gwList=(UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON]||[]).concat();gwList.sort(this.compareFn);var topList=(UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP]||[]).concat();topList.sort(this.compareFn);var gwType=0;for(var i=0;i<gwList.length;i++){var data=gwList[i];var config=GlobalConfig.WorldBossConfig[data.id];var infoTxt=i18n("GwBossView_5",config.zsLevel[0],config.zsLevel[1]);this["redPoint"+i].visible=false;gwType=config.type;if(data.canInto){this.setGwState(i,2);if(data.isDie){var time=data.relieveTime-egret.getTimer();time=time<0?0:time;infoTxt+="\n"+DateUtils.getFormatBySecond(Math.floor(time/1e3),1)}else{this["redPoint"+i].visible=this.checkCanInto1(config.type)&&UserBoss.ins().getBossRemindByIndex(data.id)}}else{this.setGwState(i,0)}this["info"+i].text=infoTxt}for(var i=0;i<topList.length;i++){var data=topList[i];var config=GlobalConfig.WorldBossConfig[data.id];var infoTxt=i18n("GwBossView_6",this.numToStr[i],config.zsLevel[0],config.zsLevel[1]);this["towerRedPoint"+i].visible=false;if(data.canInto){this.setTopState(i,2);if(data.isDie){var time=data.relieveTime-egret.getTimer();time=time<0?0:time;infoTxt+="\n"+DateUtils.getFormatBySecond(Math.floor(time/1e3),1)}else{this["towerRedPoint"+i].visible=this.checkCanInto(config.type)&&UserBoss.ins().getBossRemindByIndex(data.id)}}else{this.setTopState(i,0)}this["towerInfo"+i].text=infoTxt}this.leftTime.text=i18n("GwBossView_7",UserBoss.ins().worldBossBelongTime[gwType]);if(UserBoss.ins().worldBossBelongTime[gwType]<=0){UserBoss.ins().isShowWarn=true}};GwBossView.prototype.checkCanInto=function(type){var itemId=GlobalConfig.WorldBossBaseConfig.challengeItem[type-1];var item=UserBag.ins().getBagGoodsByTypeAndId(0,itemId);if(item&&item.count)return true;return false};GwBossView.prototype.checkCanInto1=function(type){return UserBoss.ins().worldBossBelongTime[type]>0};GwBossView.prototype.setGwState=function(index,state){var states=["locked","normal","selected"];this["img"+index].source="gw_field_"+states[state]+"_"+index;this["titleBg"+index].source="gw_title_bg_"+(state==0?1:0);this["title"+index].source="gw_title_"+(state==0?"locked_":"")+(index+1);this["info"+index].textColor=state==0?11119017:65280};GwBossView.prototype.setTopState=function(index,state){this["tower"+index].visible=state!=0;this["towerInfo"+index].textColor=state==0?11119017:65280};GwBossView.prototype.onUpdateBoss=function(_type){if(_type==UserBoss.BOSS_SUBTYPE_GODWEAPON||_type==UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP){this.initData()}};GwBossView.prototype.compareFn=function(a,b){if(a.id<b.id){return-1}else{return 1}};GwBossView.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,UserBoss.BOSS_SUBTYPE_GODWEAPON)};GwBossView.prototype.close=function(){this.removeTouchEvent(this.gw0,this.onTap);this.removeTouchEvent(this.gw1,this.onTap);this.removeTouchEvent(this.gw2,this.onTap);this.removeTouchEvent(this.tower,this.onTap);this.remindTpis.removeEventListener(egret.TextEvent.LINK,this.onLink,this);this.removeObserve();TimerManager.ins().removeAll(this)};GwBossView.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.tower){var gwList=(UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP]||[]).concat();for(var _i=0,gwList_1=gwList;_i<gwList_1.length;_i++){var data=gwList_1[_i];if(data.canInto){ViewManager.ins().open(GwBossChallengeView,data)}}return}var index=this.getClickGwIndex(tar);if(index>-1){var gwList=(UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON]||[]).concat();gwList.sort(this.compareFn);if(gwList[index]&&gwList[index].canInto){var bossData=gwList[index];var config=GlobalConfig.WorldBossConfig[bossData.id];if(bossData.isDie){UserTips.ins().showTips(i18n("GwBossView_8"))}else if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH)}else{var endTime=Math.ceil((UserBoss.ins().worldBossCd[config.type]-egret.getTimer())/1e3);if(endTime>0){UserTips.ins().showTips(i18n("GwBossView_9",endTime));return false}UserBoss.ins().sendChallengWorldBoss(bossData.id,config.type);EasyLoading.ins().showLoading(5)}}}else{index=this.getClickTowerIndex(tar);if(index>-1){var gwList=(UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP]||[]).concat();gwList.sort(this.compareFn);if(gwList[index].canInto){ViewManager.ins().open(GwBossChallengeView,gwList[index])}}}};GwBossView.prototype.getClickTowerIndex=function(tar){for(var i=0;i<5;i++){if(tar==this["tower"+i])return i}return-1};GwBossView.prototype.getClickGwIndex=function(tar){for(var i=0;i<3;i++){if(tar==this["gw"+i])return i}return-1};return GwBossView}(BaseView);__reflect(GwBossView.prototype,"GwBossView");var AStar=function(){function AStar(map){if(map===void 0){map=null}this.m_nMarkTag=0;AStar.checkInit();if(map){this.initFromMap(map)}}AStar.isSprint=function(nDir){return nDir>=8&&nDir<24};AStar.isJump=function(nDir){return nDir>=24};AStar.checkInit=function(){if(!this.inited){this.inited=false;var mc=this.AS_MOVECOST;var cwp=this.CHECK_WALKABLE_POSES;var nxv=this.NEIGHBORPOS_X_VALUES;var nyv=this.NEIGHBORPOS_Y_VALUES;var cnt=nxv.length;for(var i=0;i<cnt;++i){cwp.push([nxv[i],nyv[i]])}var dirxs=[];var dirys=[];for(var i=0;i<16;++i){var angle=Math.PI*2/16*i;dirxs[i]=Math.sin(angle);dirys[i]=Math.cos(angle)}var SPRINT_RATE=.85;for(var i=0;i<16;++i){var dx=Math.round(dirxs[i]*AStar.SPRINT_LEN);var dy=Math.round(dirys[i]*AStar.SPRINT_LEN);nxv.push(dx);nyv.push(dy);var divideNum=Math.max(Math.abs(dx),Math.abs(dy));var ddx=dx/divideNum;var ddy=dy/divideNum;var walkPoses=[];for(var j=0;j<=divideNum;++j){var mx=Math.round(j*ddx);var my=Math.round(j*ddy);walkPoses.push(mx,my)}cwp.push(walkPoses);mc.push(Math.round(Math.sqrt(dx*dx+dy*dy)*10*SPRINT_RATE))}var JUMP_RATE=1.25;var jumpLens=[8,10,12];for(var _i=0,jumpLens_1=jumpLens;_i<jumpLens_1.length;_i++){var jumpLen=jumpLens_1[_i];for(var i=0;i<16;++i){var dx=Math.round(dirxs[i]*jumpLen);var dy=Math.round(dirys[i]*jumpLen);nxv.push(dx);nyv.push(dy);cwp.push([dx,dy]);mc.push(Math.round(Math.sqrt(dx*dx+dy*dy)*10*JUMP_RATE))}}}};AStar.prototype.initFromMap=function(map){var nOldCount=0;if(this.m_ASMapCells)nOldCount=this.m_ASMapCells.length;else this.m_ASMapCells=[];this.m_nWidth=map.numCols;this.m_nHeight=map.numRows;var nNewCount=this.m_nWidth*this.m_nHeight;if(nNewCount>this.m_ASMapCells.length)this.m_ASMapCells.length=nNewCount;for(var i=nOldCount;i<nNewCount;++i){this.m_ASMapCells[i]=new ASMapCell}var x,y,idx;var cell;idx=0;for(y=0;y<this.m_nHeight;++y){for(x=0;x<this.m_nWidth;++x){cell=this.m_ASMapCells[idx];cell.X=x;cell.Y=y;cell.CanNotMove=!map.isWalkableTile(x,y);idx++}}};AStar.prototype.getPatch=function(fromX,fromY,targetX,targetY,noJumpSprint,serverGetPath){if(serverGetPath===void 0){serverGetPath=false}var canJumpAndSprint=GameMap.fbType==0&&!noJumpSprint||serverGetPath;if(fromX==targetX&&fromY==targetY)return null;if(fromX<0||fromX>=this.m_nWidth||fromY<0||fromY>=this.m_nHeight)debug.log(i18n("AStar_0")+fromX+", "+fromY+")");if(targetX<0||targetX>=this.m_nWidth||targetY<0||targetY>=this.m_nHeight)debug.log(i18n("AStar_1")+targetX+", "+targetY+")");var ac=this.m_ASMapCells[targetY*this.m_nWidth+targetX];if(!ac){return null}this.reset(fromX,fromY);if(!canJumpAndSprint&&this.pathLine({x:fromX,y:fromY},{x:targetX,y:targetY})){return[new AStarNode(targetX,targetY,DirUtil.get8DirBy2Point({x:fromX,y:fromY},{x:targetX,y:targetY}))]}var boPathFound=false;var nCurX=fromX;var nCurY=fromY;var curCell=this.m_ASMapCells[nCurY*this.m_nWidth+nCurX];if(!curCell)return null;curCell.GCost=0;curCell.LastX=-1;curCell.LastY=-1;curCell.X=nCurX;curCell.Y=nCurY;curCell.MarkTag=this.m_nMarkTag;curCell.HCost=Math.abs(targetX-fromX)+Math.abs(targetY-fromY)*10;var i;var nX,nY;var cell;while(true){if(nCurX==targetX&&nCurY==targetY){boPathFound=true;break}if(curCell.State!=ASMapCell.CSCLOSE){this.closeCell(curCell)}var N=AStar.NEIGHBORPOS_X_VALUES.length;if(!canJumpAndSprint){N=8}for(i=0;i<N;++i){nX=nCurX+AStar.NEIGHBORPOS_X_VALUES[i];nY=nCurY+AStar.NEIGHBORPOS_Y_VALUES[i];if(nX<0||nX>=this.m_nWidth||nY<0||nY>=this.m_nHeight)continue;cell=this.m_ASMapCells[nY*this.m_nWidth+nX];if(canJumpAndSprint&&!this.canMoveTo(nCurX,nCurY,i)||!canJumpAndSprint&&cell.CanNotMove){continue}if(cell.MarkTag!=this.m_nMarkTag||cell.State==ASMapCell.CSNONE){cell.MarkTag=this.m_nMarkTag;cell.LastX=nCurX;cell.LastY=nCurY;cell.btDir=i;cell.GCost=curCell.GCost+AStar.AS_MOVECOST[i];cell.HCost=Math.abs(targetX-nX)+Math.abs(targetY-nY)*10;this.openCell(cell)}else if(cell.State==ASMapCell.CSOPEN){if(cell.GCost>curCell.GCost+AStar.AS_MOVECOST[i]){cell.LastX=nCurX;cell.LastY=nCurY;cell.btDir=i;cell.GCost=curCell.GCost+AStar.AS_MOVECOST[i];this.reopenCell(cell)}}}curCell=this.m_LastOpenCell;if(curCell==null)break;nCurX=curCell.X;nCurY=curCell.Y}if(boPathFound){var sprintCD=0;var Result=new Array;var lastNode=void 0;var hasJump=false;while(true){if(canJumpAndSprint){lastNode=new AStarNode(curCell.X,curCell.Y,curCell.btDir);if(AStar.isJump(lastNode.nDir)){hasJump=true}Result.push(lastNode);sprintCD=0}else{if(lastNode&&curCell&&lastNode.nDir==curCell.btDir){}else{lastNode=new AStarNode(curCell.X,curCell.Y,curCell.btDir);Result.push(lastNode)}}curCell=this.m_ASMapCells[curCell.LastY*this.m_nWidth+curCell.LastX];if(curCell.LastX<=0&&curCell.LastY<=0||curCell.MarkTag!=this.m_nMarkTag)break}if(hasJump){var dx=fromX-targetX;var dy=fromY-targetY;var minJumpLen=8;if(dx*dx+dy*dy<=minJumpLen*minJumpLen){return[new AStarNode(targetX,targetY,24)]}}return Result}if(canJumpAndSprint){return[new AStarNode(targetX,targetY,24)]}else{return null}};AStar.prototype.canMoveTo=function(x,y,dir){var cwp=AStar.CHECK_WALKABLE_POSES[dir];for(var i=0,c=cwp.length/2;i<c;++i){var nX=x+cwp[i*2];var nY=y+cwp[i*2+1];var cell=this.m_ASMapCells[nY*this.m_nWidth+nX];if(cell.CanNotMove){return false}}return true};AStar.prototype.walkTowards=function(walkPt,walkLen,x2,y2){var dx=x2-walkPt.x;var dy=y2-walkPt.y;if(dx!=0&&dy!=0){walkPt.x+=Math.round((dx>0?.7:-.7)*walkLen);walkPt.y+=Math.round((dy>0?.7:-.7)*walkLen)}else{walkPt.x+=Math.round((dx>0?1:-1)*walkLen);walkPt.y+=Math.round((dy>0?1:-1)*walkLen)}};AStar.prototype.getWalkedLen=function(x1,y1,x2,y2){var wx=Math.abs(x1-x2);var wy=Math.abs(y1-y2);var walkedLen=0;if(wx>0&&wy>0){return Math.round(wx*.7+wy*.7)}else{return Math.max(wx,wy)}};AStar.prototype.pathLine=function(pt1,pt2){var last=pt1;var k=0;if(pt2.x==pt1.x)k=1;else k=(pt2.y-pt1.y)*1/(pt2.x-pt1.x);var b=pt2.y-k*pt2.x;var dx=pt2.x>pt1.x?1:-1;var dy=pt2.y>pt1.y?1:-1;var px=pt1.x+(dx>0?1:0);var loop=Math.abs(pt1.x-pt2.x);var pos=pt2;for(var i=0;i<=loop;i++,px+=dx){if(i!=loop){pos.x=dx>0?px:px-1;pos.y=Math.floor(k*pos.x+b)}if(last.y!=pos.y){for(var j=last.y+dy;;j+=dy){if(!GameMap.checkWalkable(last.x,j)){return false}if(j==pos.y)break}}if(i!=loop){if(!GameMap.checkWalkable(pos.x,pos.y)){return false}}last=pos}return true};AStar.prototype.reset=function(cX,cY){var cell=this.m_ASMapCells[cY*this.m_nWidth+cX];if(!cell)return;cell.LastX=0;cell.LastY=0;cell.HCost=0;cell.GCost=0;cell.FValue=0;cell.State=0;cell.Prev=null;cell.Next=null;cell.btDir=0;this.m_LastOpenCell=null;this.m_nMarkTag=this.m_nMarkTag+1};AStar.prototype.closeCell=function(cell){if(cell.State==ASMapCell.CSOPEN){if(cell.Prev)cell.Prev.Next=cell.Next;if(cell.Next)cell.Next.Prev=cell.Prev;if(cell==this.m_LastOpenCell)this.m_LastOpenCell=cell.Prev}cell.State=ASMapCell.CSCLOSE};AStar.prototype.openCell=function(cell){cell.State=ASMapCell.CSOPEN;var nFValue=cell.HCost+cell.GCost;cell.FValue=nFValue;var lastCell=this.m_LastOpenCell;if(!lastCell){this.m_LastOpenCell=cell;cell.Prev=null;cell.Next=null}else{while(lastCell.FValue<nFValue){if(lastCell.Prev==null){lastCell.Prev=cell;cell.Prev=null;cell.Next=lastCell;return}lastCell=lastCell.Prev}cell.Prev=lastCell;if(lastCell.Next){cell.Next=lastCell.Next;lastCell.Next.Prev=cell;lastCell.Next=cell}else{cell.Next=null;lastCell.Next=cell;this.m_LastOpenCell=cell}}};AStar.prototype.reopenCell=function(cell){var nFValue=cell.HCost+cell.GCost;cell.FValue=nFValue;var nextCell=cell.Next;if(nextCell&&nextCell.FValue>nFValue){do{nextCell=nextCell.Next}while(nextCell&&nextCell.FValue>nFValue);if(cell.Prev)cell.Prev.Next=cell.Next;if(cell.Next)cell.Next.Prev=cell.Prev;if(nextCell){cell.Next=nextCell;if(nextCell.Prev){cell.Prev=nextCell.Prev;nextCell.Prev.Next=cell}else cell.Prev=null;nextCell.Prev=cell}else{cell.Prev=this.m_LastOpenCell;cell.Next=null;this.m_LastOpenCell.Next=cell;this.m_LastOpenCell=cell}}};AStar.RMOVECOST=14;AStar.DMOVECOST=10;AStar.AS_MOVECOST=[10,14,10,14,10,14,10,14];AStar.NEIGHBORPOS_X_VALUES=[0,1,1,1,0,-1,-1,-1];AStar.NEIGHBORPOS_Y_VALUES=[-1,-1,0,1,1,1,0,-1];AStar.CHECK_WALKABLE_POSES=[];AStar.TYPE_WALK=0;AStar.TYPE_JUMP=1;AStar.TYPE_SPRINT=2;AStar.JUMP_SPEED=2;AStar.SPRINT_SPEED=3;AStar.inited=false;AStar.SPRINT_LEN=4;AStar.JUMP_HEIGHT=5*64;return AStar}();__reflect(AStar.prototype,"AStar");var ASMapCell=function(){function ASMapCell(){}ASMapCell.CSNONE=0;ASMapCell.CSOPEN=1;ASMapCell.CSCLOSE=2;return ASMapCell}();__reflect(ASMapCell.prototype,"ASMapCell");window.Main=Main;