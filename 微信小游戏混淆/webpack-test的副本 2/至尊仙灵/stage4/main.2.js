var egret=window.egret;var __reflect=this&&this.__reflect||function(p,c,t){p.__class__=c,t?t.push(c):t=[c],p.__types__=p.__types__?t.concat(p.__types__):t;window[c]=p.constructor};var __extends=this&&this.__extends||function __extends(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r};var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var GwMijingRankView=function(_super){__extends(GwMijingRankView,_super);function GwMijingRankView(){var _this=_super.call(this)||this;_this.skinName="GwMijingRankSkin";return _this}GwMijingRankView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.touchEnabled=true;this.addTouchEvent(this.bgClose,this.touchHandler);this.addTouchEvent(this.closeBtn,this.touchHandler);this._ary=new eui.ArrayCollection;this.list.dataProvider=this._ary;this.list.itemRenderer=GwMijingRankItemRender};GwMijingRankView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._ary.replaceAll(GodWeaponCC.ins().rankInfoDataAry)};GwMijingRankView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.touchHandler);this.removeTouchEvent(this.closeBtn,this.touchHandler);this.list.dataProvider=null};GwMijingRankView.prototype.touchHandler=function(e){ViewManager.ins().close(this)};return GwMijingRankView}(BaseEuiView);__reflect(GwMijingRankView.prototype,"GwMijingRankView");var GwMijingRankItemRender=function(_super){__extends(GwMijingRankItemRender,_super);function GwMijingRankItemRender(){return _super.call(this)||this}GwMijingRankItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);if(!this.data){return}this._thisData=this.data;this.playerName.text=this._thisData.nameStr;this.storeyCount.text=i18n("GwMijingRankView_0",this._thisData.floorNum);this.time.text=this._thisData.getgetTimeStr();if(this._thisData.rank<=3){this.rank.visible=false;this.qiansan.visible=true;this.qiansan.source="paihang"+this._thisData.rank}else{this.rank.text=""+this._thisData.rank;this.rank.visible=true;this.qiansan.visible=false}};return GwMijingRankItemRender}(BaseItemRender);__reflect(GwMijingRankItemRender.prototype,"GwMijingRankItemRender");ViewManager.ins().reg(GwMijingRankView,LayerManager.UI_Popup);var GwMijingRiseUpView=function(_super){__extends(GwMijingRiseUpView,_super);function GwMijingRiseUpView(){var _this=_super.call(this)||this;_this.isMax1=false;_this.isMax2=false;return _this}GwMijingRiseUpView.prototype.initUI=function(){this.skinName="GwRiseUpSkin"};GwMijingRiseUpView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.gold.selected=true;this.addTouchEvent(this.gold,this.onTap);this.addTouchEvent(this.yuanbao,this.onTap);this.addTouchEvent(this.sureBtn,this.onTap);this.addTouchEvent(this.cancelBtn,this.onTap);this.observe(GodWeaponCC.ins().postFubenInfo,this.updateView);this.updateView()};GwMijingRiseUpView.prototype.updateView=function(){var data=GodWeaponCC.ins().fubenInfoData;var addNum=data.getBuyCount*10;this.now.text=i18n("GwMijingRiseUpView_0",addNum);this.goldCost.text=GlobalConfig.GodWeaponBaseConfig.buyBuff[0].moneyCount+"";this.yuanbaoCost.text=GlobalConfig.GodWeaponBaseConfig.buyBuff[1].moneyCount+"";var dataType=data.buyTypeData(1);if(dataType[1]>=GlobalConfig.GodWeaponBaseConfig.buyBuff[0].maxCount){this.gold.visible=false;this.goldImg.visible=false;this.goldCost.visible=false;this.goldText.text=i18n("GwMijingRiseUpView_1");this.isMax1=true;this.gold.selected=false}dataType=data.buyTypeData(2);if(dataType[1]>=GlobalConfig.GodWeaponBaseConfig.buyBuff[1].maxCount){this.yuanbao.visible=false;this.yuanbaoCost.visible=false;this.yuanbaoImg.visible=false;this.yuanbaoText.text=i18n("GwMijingRiseUpView_2");this.isMax2=true}};GwMijingRiseUpView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.gold,this.onTap);this.removeTouchEvent(this.yuanbao,this.onTap);this.removeTouchEvent(this.cancelBtn,this.onTap);this.removeTouchEvent(this.cancelBtn,this.onTap);this.removeObserve()};GwMijingRiseUpView.prototype.onTap=function(e){switch(e.target){case this.gold:this.yuanbao.selected=false;this.gold.selected=true;break;case this.yuanbao:this.yuanbao.selected=true;this.gold.selected=false;break;case this.cancelBtn:ViewManager.ins().close(this);break;case this.sureBtn:if(this.isMax2&&this.isMax1){UserTips.ins().showTips(i18n("GwMijingRiseUpView_3"));return}if(!this.yuanbao.selected&&!this.gold.selected){UserTips.ins().showTips(i18n("GwMijingRiseUpView_4"));return}if(this.gold.selected){if(Actor.gold<GlobalConfig.GodWeaponBaseConfig.buyBuff[0].moneyCount){UserTips.ins().showCenterTips(i18n("GwMijingRiseUpView_5"));return}}else{if(Actor.yb<GlobalConfig.GodWeaponBaseConfig.buyBuff[1].moneyCount){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("GwMijingRiseUpView_6"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GwMijingRiseUpView_7"));return}}GodWeaponCC.ins().buybuff(this.gold.selected?1:2);var maxCount=GlobalConfig.GodWeaponBaseConfig.buyBuff[1].maxCount+GlobalConfig.GodWeaponBaseConfig.buyBuff[0].maxCount;if(GodWeaponCC.ins().fubenInfoData.getBuyCount==maxCount-1){ViewManager.ins().close(this)}break}};return GwMijingRiseUpView}(BaseEuiView);__reflect(GwMijingRiseUpView.prototype,"GwMijingRiseUpView");ViewManager.ins().reg(GwMijingRiseUpView,LayerManager.UI_Popup);var GwResetWin=function(_super){__extends(GwResetWin,_super);function GwResetWin(){var _this=_super.call(this)||this;_this.skinName="GwResetSkin";_this.isTopLevel=true;return _this}GwResetWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.price.setType(MoneyConst.yuanbao)};GwResetWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgclose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.resetBtn,this.onTouch);this.price.setPrice(GlobalConfig.GodWeaponBaseConfig.skillResetCost);this._dataWeapon=args[0];var point=this._dataWeapon.getResetPoint();this.resetDesc.text=point>0?i18n("GwResetWin_0",point):i18n("GwResetWin_1");this.gwName.text=this._dataWeapon.getWeaponName();this.resetBtn.enabled=point>0&&Actor.yb>=GlobalConfig.GodWeaponBaseConfig.skillResetCost};GwResetWin.prototype.onTouch=function(e){switch(e.target){case this.bgclose:case this.closeBtn:ViewManager.ins().close(this);break;case this.resetBtn:GodWeaponCC.ins().sendReset(this._dataWeapon.weaponId);ViewManager.ins().close(this);break}};return GwResetWin}(BaseEuiView);__reflect(GwResetWin.prototype,"GwResetWin");ViewManager.ins().reg(GwResetWin,LayerManager.UI_Main);var GwResultView=function(_super){__extends(GwResultView,_super);function GwResultView(){var _this=_super.call(this)||this;_this._pFNum=4;_this.secNum=5;return _this}GwResultView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GwResultSkin";this.addTouchEvent(this.closeBtn,this.touchHandler);this.addTouchEvent(this.get,this.touchHandler);this.addTouchEvent(this.closenoget,this.touchHandler);this._ary=new eui.ArrayCollection;this.listCoin.dataProvider=this._ary;this.listCoin.itemRenderer=MijingItemBase2};GwResultView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._fubenId=param[0];this._pFNum=param[1];var useTime=param[2]==null?-1:param[2];var conf;var floor;for(var key in GlobalConfig.GodWeaponFubenConfig){if(GlobalConfig.GodWeaponFubenConfig[key].fbId==this._fubenId){conf=GlobalConfig.GodWeaponFubenConfig[key];floor=parseInt(key);break}}var b;if(useTime==-1){this.time.text=i18n("GwResultView_0");this.gaptime.visible=false;this.get.visible=true;this.closenoget.visible=true;this.closeBtn.visible=false;this.noget.visible=true;b=false}else{this.time.text=DateUtils.getFormatBySecond(useTime,DateUtils.TIME_FORMAT_3);if(this._pFNum!=1){this.gaptime.visible=true;this.get.visible=true;this.closenoget.visible=true;this.closeBtn.visible=false;var numTime=Math.abs(useTime-GlobalConfig.GodWeaponBaseConfig.fbGrade[0]);this.gaptime.text=i18n("GwResultView_1",numTime);this.noget.visible=true;b=false}else{this.gaptime.visible=false;this.get.visible=false;this.closenoget.visible=false;this.closeBtn.visible=true;this.noget.visible=false;b=true}}this._isB=b;var ary=conf.award[this._pFNum].concat();var num=UserFb.ins().oldMijingPoint;if(UserFb.ins().oldMijingPoint!=1&&this._pFNum==1){var firstAry=conf.firstAward.concat();ary=ary.concat(firstAry)}var newAry=[];for(var i=0;i<ary.length;i++){var data=new MijinglistData;data.data=ary[i];data.index=i+1;data.start=conf.award[1].length;data.floorNum=floor;newAry.push(data)}this._ary.replaceAll(newAry);this.rank.source="godweapon_rank"+this._pFNum;if(b){this.updateCloseBtnLabel();var temp=this.secNum;TimerManager.ins().doTimer(1e3,temp,this.updateCloseBtnLabel,this)}};GwResultView.prototype.updateCloseBtnLabel=function(){this.secNum--;if(this.secNum<=0){ViewManager.ins().close(this);GodWeaponCC.ins().requestGetAward()}this.closeBtn.label=i18n("GwResultView_2",this.secNum)};GwResultView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.touchHandler);this.removeTouchEvent(this.get,this.touchHandler);this.removeTouchEvent(this.closenoget,this.touchHandler);this.listCoin.dataProvider=null;TimerManager.ins().remove(this.updateCloseBtnLabel,this);if(GameMap.fubenID>0){UserFb.ins().sendExitFb()}if(GameMap.fbType==UserFb.FB_TYPE_MIJING){ViewManager.ins().open(GodWeaponWin,1)}};GwResultView.prototype.touchHandler=function(e){if(e.currentTarget==this.closeBtn){GodWeaponCC.ins().requestGetAward();ViewManager.ins().close(this)}else if(e.currentTarget==this.get){GodWeaponCC.ins().requestGetAward();ViewManager.ins().close(this)}else if(e.currentTarget==this.closenoget){ViewManager.ins().close(this)}};return GwResultView}(BaseEuiView);__reflect(GwResultView.prototype,"GwResultView");ViewManager.ins().reg(GwResultView,LayerManager.UI_Popup);var MijingItemBase2=function(_super){__extends(MijingItemBase2,_super);function MijingItemBase2(){return _super.call(this)||this}MijingItemBase2.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);this.getImg.visible=false};return MijingItemBase2}(MijingItemBase);__reflect(MijingItemBase2.prototype,"MijingItemBase2");var GwShengWuChooseView=function(_super){__extends(GwShengWuChooseView,_super);function GwShengWuChooseView(){return _super.call(this)||this}GwShengWuChooseView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GwShengWuChooseSkin";this._aryDate=new eui.ArrayCollection;this.list.dataProvider=this._aryDate;this.list.itemRenderer=GwShengwurenderItem};GwShengWuChooseView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._data=param[0];this.addTouchEvent(this.bgClose,this.closeHandler);this.addTouchEvent(this.closeBtn,this.closeHandler);this.addTouchEvent(this.list,this.clickHandler);this.updateView()};GwShengWuChooseView.prototype.updateView=function(){var temp=GwShengWuChooseView.getGwItemType(this._data);temp.sort(this.sortFun);if(this._data.itemId){var tempData=new GwItem;tempData.itemId=this._data.itemId;tempData.weaponId=this._data.weaponId;tempData.isCur=true;temp.unshift(tempData)}if(temp.length==0){this.tipLabel2.visible=true}else{this.tipLabel2.visible=false}this._aryDate.replaceAll(temp)};GwShengWuChooseView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.closeHandler);this.removeTouchEvent(this.closeBtn,this.closeHandler);this.removeTouchEvent(this.list,this.clickHandler);this.list.dataProvider=null};GwShengWuChooseView.prototype.closeHandler=function(e){ViewManager.ins().close(this)};GwShengWuChooseView.prototype.clickHandler=function(e){if(e.target instanceof eui.Button){var tempRender=e.target.parent;GodWeaponCC.ins().inlayItem(this._data.weaponId,this._data.pos,tempRender.datathis.itemId);ViewManager.ins().close(this)}};GwShengWuChooseView.getGwItemType=function(_data){var temp=[];var itemData=UserBag.ins().bagModel[UserBag.BAG_TYPE_OTHTER];var j=0;if(itemData){for(var i=0;i<itemData.length;i++){var type=ItemConfig.getType(itemData[i].itemConfig);var job=ItemConfig.getJob(itemData[i].itemConfig);if(ItemConfig.getType(itemData[i].itemConfig)==15&&ItemConfig.getJob(itemData[i].itemConfig)==_data.weaponId){for(j=0;j<itemData[i].count;j++){var tempData=new GwItem;tempData.itemId=itemData[i].configID;tempData.weaponId=_data.weaponId;temp.push(tempData)}}}}var tempGw=GodWeaponCC.ins().allGodItemData[_data.weaponId];tempGw=tempGw.concat();var objdata={};for(j=0;j<tempGw.length;j++){if(tempGw[j].itemId){if(objdata[tempGw[j].itemId]==undefined){objdata[tempGw[j].itemId]=1}else{objdata[tempGw[j].itemId]++}}}for(j=0;j<tempGw.length;j++){if(tempGw[j].itemId){if(tempGw[j].config.onlyOne){var only=tempGw[j].config.onlyOne;if(tempGw[j].config.onlyOne==objdata[tempGw[j].itemId]){GwShengWuChooseView.deleteItemData(tempGw[j].itemId,temp);delete objdata[tempGw[j].itemId]}}}}return temp};GwShengWuChooseView.prototype.sortFun=function(a,b){return b.power-a.power};GwShengWuChooseView.deleteItemData=function(id,temp){for(var i=0;i<temp.length;i++){if(temp[i].itemId==id){temp.splice(i--,1)}}};return GwShengWuChooseView}(BaseEuiView);__reflect(GwShengWuChooseView.prototype,"GwShengWuChooseView");ViewManager.ins().reg(GwShengWuChooseView,LayerManager.UI_Popup);var GwShengwurenderItem=function(_super){__extends(GwShengwurenderItem,_super);function GwShengwurenderItem(){var _this=_super.call(this)||this;_this.qualityName=[i18n("GwShengWuChooseView_1"),i18n("GwShengWuChooseView_2"),i18n("GwShengWuChooseView_3"),i18n("GwShengWuChooseView_4")];_this.skinName="GWChooseItemSkin";_this.best.visible=false;return _this}GwShengwurenderItem.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);if(!this.data){return}this.datathis=this.data;var qualityNum=ItemConfig.getQuality(this.datathis.itemConfig);this.nameTxt.text=this.datathis.itemConfig.name;this.nameTxt.textColor=ItemConfig.getQualityColor(this.datathis.itemConfig);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(this.datathis.itemConfig);this.attr.text=this.datathis.addatrStr;this.power.text=i18n("GwShengWuChooseView_5",this.datathis.power);this.itemIcon.imgJob.source="job"+this.datathis.weaponId+"Item";this.itemIcon.imgIcon.source=this.datathis.itemConfig.icon+"_png";this.itemIcon.imgBg.source="quality"+qualityNum;if(qualityNum-1<0){this.quality.text=this.qualityName[0]}else{this.quality.text=this.qualityName[qualityNum-1]}this.quality.textColor=ItemConfig.getQualityColor(this.datathis.itemConfig);this.quality.strokeColor=ItemConfig.getQualityStrokeColor(this.datathis.itemConfig);this.addNameLb.text=i18n("GwShengWuChooseView_6",this.datathis.skillName);if(this.datathis.isCur==true){this.now.visible=true;this.changeBtn.visible=false}else{this.now.visible=false;this.changeBtn.visible=true}};return GwShengwurenderItem}(BaseItemRender);__reflect(GwShengwurenderItem.prototype,"GwShengwurenderItem");var Gwshengwuitem_icon=function(_super){__extends(Gwshengwuitem_icon,_super);function Gwshengwuitem_icon(){return _super.call(this)||this}return Gwshengwuitem_icon}(eui.Component);__reflect(Gwshengwuitem_icon.prototype,"Gwshengwuitem_icon");var GwSkillTipView=function(_super){__extends(GwSkillTipView,_super);function GwSkillTipView(){return _super.call(this)||this}GwSkillTipView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GwSkillTipSkin";this.bgClose.touchEnabled=true};GwSkillTipView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._dataInfo=param[0];this.addTouchEvent(this.update,this.touchHandler);this.addTouchEvent(this.bgClose,this.closeHandler);this.observe(GodWeaponCC.ins().postUpdateInfo,this.updateView);this.updateView()};GwSkillTipView.prototype.updateView=function(){var curWeapon=GodWeaponCC.ins().getWeaponData(this._dataInfo.weaponId);if(this._dataInfo.skillId==16){this.currentState="max";if(this._dataInfo.isOpen){this.update.visible=true;this.pointCount.visible=true;this.unlockDesc.visible=false;this.unlcokTitle.visible=false;this.validateNow();if(!curWeapon||curWeapon.skillPoint==0){this.pointCount.textFlow=(new egret.HtmlTextParser).parser(i18n("GwSkillTipView_0"))}else{this.pointCount.textFlow=(new egret.HtmlTextParser).parser(i18n("GwSkillTipView_1")+curWeapon.skillPoint)}if(this._dataInfo.skillLv==0){this.nowskillDesc.text=i18n("GwSkillTipView_2",this._dataInfo.config.skillName);this.ultraskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addExAttrstr(1))}else{this.nowskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addAttrValyeType(this._dataInfo.skillLv));this.ultraskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addExAttrstr(this._dataInfo.skillLv))}this.nextskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addAttrValyeType(this._dataInfo.skillLv+1));this.skillImg.source=this._dataInfo.config.iconId+"_N"}else{this.validateNow();this.update.visible=false;this.pointCount.visible=false;this.unlcokTitle.visible=true;this.unlockDesc.visible=true;this.unlockDesc.text=this._dataInfo.openTip;this.skillImg.source=this._dataInfo.config.iconId+"_L";this.nowskillDesc.text=i18n("GwSkillTipView_3",this._dataInfo.config.skillName);this.ultraskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addExAttrstr(1));this.nextskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addAttrValyeType(this._dataInfo.skillLv+1))}}else{if(this._dataInfo.isOpen){this.validateNow();if(this._dataInfo.skillLv<this._dataInfo.config.upLevel){this.currentState="normal";if(!curWeapon||curWeapon.skillPoint==0){this.pointCount.textFlow=(new egret.HtmlTextParser).parser(i18n("GwSkillTipView_4"))}else{this.pointCount.textFlow=(new egret.HtmlTextParser).parser(i18n("GwSkillTipView_5")+curWeapon.skillPoint)}}else{this.currentState="fullLv"}if(this._dataInfo.skillLv==0){this.nowskillDesc.text=i18n("GwSkillTipView_6",this._dataInfo.config.skillName)}else{this.nowskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addatrStr(this._dataInfo.skillLv));if(this._dataInfo.config.skill){this.nowskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.specialSkill(this._dataInfo.skillLv))}this.descTextAlign(this.nowskillDesc)}this.nextskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addatrStr(this._dataInfo.skillLv+1));if(this._dataInfo.config.skill){this.nextskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.specialSkill(this._dataInfo.skillLv+1))}this.descTextAlign(this.nextskillDesc);this.skillImg.source=this._dataInfo.config.iconId+"_N"}else{this.validateNow();this.currentState="lock";this.nowskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.config.lockDesc);this.descTextAlign(this.nowskillDesc);this.unlockDesc.text=this._dataInfo.openTip;this.skillImg.source=this._dataInfo.config.iconId+"_L"}}this.skillName.text=this._dataInfo.config.skillName;if(this._dataInfo.skillId==16){this.lvCount.text=this._dataInfo.lvLabel(true)}else{this.lvCount.text=this._dataInfo.lvLabel()}var weaponData=GodWeaponCC.ins().getWeaponData(this._dataInfo.weaponId);var num=weaponData&&weaponData.skillPoint||0;if(num<=0){this.update.enabled=false}else{this.update.enabled=true}};GwSkillTipView.prototype.descTextAlign=function(txt){if(this._dataInfo.config.attr){txt.textAlign="center"}else{if(txt.numLines>=2){txt.textAlign="left"}else{txt.textAlign="center"}}};GwSkillTipView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.update,this.touchHandler);this.removeTouchEvent(this.bgClose,this.closeHandler)};GwSkillTipView.prototype.touchHandler=function(e){if(this._dataInfo.skillLv>=this._dataInfo.config.upLevel){UserTips.ins().showTips(i18n("GwSkillTipView_8"));return}var weaponData=GodWeaponCC.ins().getWeaponData(this._dataInfo.weaponId);var num=weaponData&&weaponData.skillPoint||0;if(num<=0){UserTips.ins().showTips(i18n("GwSkillTipView_9"));return}GodWeaponCC.ins().gwshowTips=true;GodWeaponCC.ins().roleshowTips=SubRoles.ins().subRolesLen;GodWeaponCC.ins().upSkill(this._dataInfo.weaponId,this._dataInfo.skillId)};GwSkillTipView.prototype.closeHandler=function(e){ViewManager.ins().close(this)};return GwSkillTipView}(BaseEuiView);__reflect(GwSkillTipView.prototype,"GwSkillTipView");ViewManager.ins().reg(GwSkillTipView,LayerManager.UI_Popup);var GwTaskView=function(_super){__extends(GwTaskView,_super);function GwTaskView(){var _this=_super.call(this)||this;_this._state=0;_this._weaponId=1;_this.weaponTxt=[i18n("GwTaskView_0"),i18n("GwTaskView_1"),i18n("GwTaskView_2")];_this.skinName="GwTaskSkin";return _this}GwTaskView.prototype.open=function(index){this.addTouchEndEvent(this.btn,this.onTap);this.setSelectIndex(index)};GwTaskView.prototype.close=function(){this.removeTouchEvent(this.btn,this.onTap)};GwTaskView.prototype.setSelectIndex=function(index){var weaponId=this._weaponId=index+1;this.initSkill();var taskTip=i18n("GwTaskView_3",this.weaponTxt[index]);var btnTxt=[i18n("GwTaskView_4"),i18n("GwTaskView_5"),i18n("GwTaskView_6"),i18n("GwTaskView_7")];this.BG.source="godweapon_weaponBG"+weaponId+"_jpg";var nameImg=["zhanshi","fashi","daoshi"];for(var i=0;i<=2;i++){var img=this[nameImg[i]];if(i==index)img.visible=true;else img.visible=false}var tipsTxt=["renwuchushi","renwuneirong","quanbuwancheng"];for(var _i=0,tipsTxt_1=tipsTxt;_i<tipsTxt_1.length;_i++){var key=tipsTxt_1[_i];this[key].visible=false}var gwTask=GodWeaponCC.ins().gwTask;if(!GodWeaponCC.ins().weaponIsActive(weaponId)){if(gwTask.taskIdx&&gwTask.weapon==weaponId){var config=GlobalConfig.GodWeaponTaskConfig[gwTask.weaponIdx][gwTask.taskIdx];if(gwTask.statue==GwTaskData.DOING){taskTip+=i18n("GwTaskView_14",gwTask.taskIdx-1);this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(taskTip);this.renwuneirong.visible=true;this.renwuneirong.textFlow=TextFlowMaker.generateTextFlow1(i18n("GwTaskView_15",gwTask.taskIdx,config.desc,config.itemName[gwTask.weapon-1]||"",gwTask.progress,config.target));this.btn.label=btnTxt[1];this._state=1;this.removeTaskMc()}else if(gwTask.statue==GwTaskData.DONE){taskTip+=i18n("GwTaskView_16",gwTask.taskIdx-1);this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(taskTip);this.renwuneirong.visible=true;this.renwuneirong.textFlow=TextFlowMaker.generateTextFlow1(i18n("GwTaskView_17",gwTask.taskIdx,config.desc,config.itemName[gwTask.weapon-1]||"",gwTask.progress,config.target));this.btn.label=btnTxt[2];this._state=2;this.addTaskMc()}else{taskTip+=i18n("GwTaskView_18",gwTask.taskIdx);this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(taskTip);this.quanbuwancheng.visible=true;this.btn.label=btnTxt[3];this._state=3;this.addTaskMc()}}else{this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(taskTip);this.renwuchushi.visible=true;this.btn.label=btnTxt[0];this._state=0;this.removeTaskMc()}}};GwTaskView.prototype.addTaskMc=function(){this.validateNow();this.taskMc=this.taskMc||ObjectPool.pop("MovieClip");this.taskMc.x=this.btn.width/2;this.taskMc.y=this.btn.height/2;this.taskMc.scaleX=1;this.taskMc.scaleY=.85;this.taskMc.touchEnabled=false;this.btn.addChild(this.taskMc);this.taskMc.playFile(RES_DIR_EFF+"chargeff1",-1)};GwTaskView.prototype.removeTaskMc=function(){TimerManager.ins().removeAll(this);if(this.taskMc&&this.taskMc.parent){this.taskMc.parent.removeChild(this.taskMc);this.taskMc.destroy()}this.taskMc=null};GwTaskView.prototype.initSkill=function(){var weaponId=this._weaponId;var skills=GlobalConfig.GodWeaponBaseConfig.noticeSkillId[weaponId-1];var configs=GlobalConfig.GodWeaponLineConfig[weaponId];var index=0;for(var _i=0,skills_3=skills;_i<skills_3.length;_i++){var skillId=skills_3[_i];var data=GodWeaponCC.ins().getWeaponSkinIdData(weaponId,configs[skillId].skinId);this["item"+index].imgLight=true;this["item"+index].updateView(data,weaponId-1);this["skillName"+index].text=configs[skillId].skillName;this["skillDesc"+index].text=configs[skillId].lockDesc;index+=1}};GwTaskView.prototype.onTap=function(e){var _this=this;var tar=e.currentTarget;var gwTask=GodWeaponCC.ins().gwTask;if(tar==this.btn){if(this._state==0){var role=SubRoles.ins().getSubRoleByJob(this._weaponId);if(!role){var jobNames=["0",i18n("GwTaskView_8"),i18n("GwTaskView_9"),i18n("GwTaskView_10")];UserTips.ins().showTips(i18n("GwTaskView_11",jobNames[this._weaponId]));return}if(!gwTask.weapon){WarnWin.show(i18n("GwTaskView_12",this.weaponTxt[this._weaponId-1]),function(){GodWeaponCC.ins().requestReceiveTask(_this._weaponId)},this)}else{UserTips.ins().showTips(i18n("GwTaskView_13"))}}else if(this._state==1){var config=GlobalConfig.GodWeaponTaskConfig[gwTask.weaponIdx][gwTask.taskIdx];if(config.controlTarget){ViewManager.ins().open(config.controlTarget[0],config.controlTarget[1])}}else if(this._state==2||this._state==3){GodWeaponCC.ins().requestActiveWeapon();if(this._state==2){this.taskComMc=this.taskComMc||ObjectPool.pop("MovieClip");this.taskComMc.playFile(RES_DIR_EFF+"complete",1,function(){if(_this.taskComMc.parent){_this.taskComMc.parent.removeChild(_this.taskComMc);_this.taskComMc.destroy();_this.taskComMc=null}});this.taskComMc.y=this.btn.y-110;this.taskComMc.x=this.btn.x-this.btn.width/2;this.GwTask.addChild(this.taskComMc)}}}};return GwTaskView}(BaseView);__reflect(GwTaskView.prototype,"GwTaskView");var GwWeaponView=function(_super){__extends(GwWeaponView,_super);function GwWeaponView(){var _this=_super.call(this)||this;_this._selectIndex=0;return _this}GwWeaponView.prototype.childrenCreated=function(){this.clickRect.touchEnabled=true;this.expschedule.mask=this.maskRect;this.detailBtn.touchEnabled=true;this.maskPro.touchEnabled=false;this.progressImg.mask=this.maskPro;this.progressHeadImg=new eui.Image;this.exp.addChild(this.progressHeadImg);this.progressHeadImg.y=35;this.rpImg0.visible=false;this.rpImg1.visible=false;this.rpImg2.visible=false;this.rpImgExp.visible=false;this.reset.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.reset.text)};GwWeaponView.prototype.open=function(){this.addTouchEvent(this.weapon0,this.touchHandler);this.addTouchEvent(this.weapon1,this.touchHandler);this.addTouchEvent(this.weapon2,this.touchHandler);this.clickRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickRectBegin,this);this.clickRect.addEventListener(egret.TouchEvent.TOUCH_END,this.onClickRectEnd,this);this.addTouchEvent(this.detailBtn,this.touchHandler);this.addTouchEvent(this.reset,this.touchHandler);this.observe(GodWeaponCC.ins().postUpdateInfo,this.updateView);this.observe(GodWeaponCC.ins().postUpdateExp,this.updateGwExp);this.observe(GodWeaponCC.ins().postGwTask,this.updateView);this.observe(GodWeaponRedPoint.ins().postGwTab1,this.showRedPoint);this.observe(GodWeaponRedPoint.ins().postGwTab2,this.showRedPoint);this.observe(GodWeaponRedPoint.ins().postGwTab3,this.showRedPoint);for(var i=1;i<=5;i++){this["shengwu"+i].touchEnabled=true;this["shengwu"+i].touchChildren=false;this.addTouchEvent(this["shengwu"+i],this.touchHandler)}this.selectIndex=this.getSelectedIndex();this.godweaponskill.open();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.tianMing)};GwWeaponView.prototype.onClickRectBegin=function(obj,event){this.addWeaponExp();if(!TimerManager.ins().isExists(this.addWeaponExp,this)){TimerManager.ins().doTimer(200,0,this.addWeaponExp,this)}};GwWeaponView.prototype.onClickRectEnd=function(obj,event){TimerManager.ins().remove(this.addWeaponExp,this)};GwWeaponView.prototype.addWeaponExp=function(){var dataWeapon=GodWeaponCC.ins().getWeaponData(this.selectIndex+1);if(dataWeapon&&dataWeapon.config.everyExp>GodWeaponCC.ins().curExp){UserTips.ins().showTips(i18n("GwWeaponView_2"));return}GodWeaponCC.ins().gwshowTips=true;GodWeaponCC.ins().roleshowTips=SubRoles.ins().subRolesLen;GodWeaponCC.ins().upWeapon(this.selectIndex+1)};GwWeaponView.prototype.getSelectedIndex=function(index){if(index==undefined){if(GodWeaponCC.ins().gwTask.taskIdx){index=GodWeaponCC.ins().gwTask.weapon-1}else{index=0}}return index};Object.defineProperty(GwWeaponView.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(value){this._selectIndex=value;var actived=GodWeaponCC.ins().weaponIsActive(value+1);if(actived){this.showWeapon()}else{this.showTask()}this.selectBtnImage();this.showRedPoint();this.reset.visible=actived},enumerable:true,configurable:true});GwWeaponView.prototype.showTask=function(){this.currentState="task";this.gwTask.open(this._selectIndex)};GwWeaponView.prototype.showWeapon=function(){this.currentState="active";this.validateNow();var value=this._selectIndex;this._curWeapon=GodWeaponCC.ins().getWeaponData(value+1);this.godweaponskill.selectIndex=value;var index=value+1;this.weaponName.source="godweapon_name"+index;this.needExp.text="("+this._curWeapon.curExp+"/"+this._curWeapon.config.exp+")";var level=i18n("Level_0");this.lvCount.text=""+this._curWeapon.curLv+level;if(this._curWeapon.skillPoint==0){this.curPointLabel.textFlow=(new egret.HtmlTextParser).parser(i18n("GwWeaponView_0"))}else{this.curPointLabel.textFlow=(new egret.HtmlTextParser).parser(i18n("GwWeaponView_1")+this._curWeapon.skillPoint)}this.updateGwExp();this.expschedule.visible=true;var num=this._curWeapon.config.everyExp;var totalNum=num*2;var curExp=GodWeaponCC.ins().curExp;var newScaleY;if(curExp<totalNum){newScaleY=1*curExp/totalNum;if(newScaleY<0){newScaleY=0}}else{newScaleY=1}var t=egret.Tween.get(this.maskRect);t.to({scaleY:newScaleY},200);this.updateGodItemView();this.progressHeadImg.source="godweapon_expfront";newScaleY=1*this._curWeapon.curExp/this._curWeapon.config.exp;t=egret.Tween.get(this.maskPro,{onChange:this.funcChange,onChangeObj:this});t.to({scaleX:newScaleY},200)};GwWeaponView.prototype.selectBtnImage=function(){this["selectIcon"+this._selectIndex].visible=true;switch(this._selectIndex){case 0:this["selectIcon1"].visible=false;this["selectIcon2"].visible=false;break;case 1:this["selectIcon0"].visible=false;this["selectIcon2"].visible=false;break;case 2:this["selectIcon0"].visible=false;this["selectIcon1"].visible=false;break}};GwWeaponView.prototype.showRedPoint=function(){var b=GodWeaponCC.ins().maxLvRedPoint();if(b){this.rpImg0.visible=GodWeaponCC.ins().weaponIsActive(1)?true:false;this.rpImg1.visible=GodWeaponCC.ins().weaponIsActive(2)?true:false;this.rpImg2.visible=GodWeaponCC.ins().weaponIsActive(3)?true:false;this.rpImgExp.visible=true}else{this.rpImg0.visible=GodWeaponRedPoint.ins().gwSbRed1;this.rpImg1.visible=GodWeaponRedPoint.ins().gwSbRed2;this.rpImg2.visible=GodWeaponRedPoint.ins().gwSbRed3;this.rpImgExp.visible=false}};GwWeaponView.prototype.funcChange=function(){if(341*this.maskPro.scaleX<18){this.progressHeadImg.x=120;this.progressHeadImg.scaleX=1*(341*this.maskPro.scaleX)/18}else{this.progressHeadImg.x=120+341*this.maskPro.scaleX-18;this.progressHeadImg.scaleX=1}};GwWeaponView.prototype.updateGodItemView=function(){for(var i=0;i<5;i++){this["shengwu"+(i+1)].updateView(GodWeaponCC.ins().getGodItemData(this._selectIndex+1,i+1))}};GwWeaponView.prototype.updatePower=function(){var ary=GodWeaponCC.ins().gwAddAttr(this.selectIndex);var data=[];for(var i=0;i<ary.length;i++){data.push(new AttributeData(ary[i].type,ary[i].value))}var power=UserBag.getAttrPower(data);if(GodWeaponCC.ins().weaponIsActive(this._selectIndex+1)){var addPoser=0;var dataGw=void 0;var max=GodWeaponCC.ins().maxSkillIdAry[this.selectIndex];for(var i=0;i<max;i++){dataGw=GodWeaponCC.ins().getWeaponSkinIdData(this.selectIndex+1,i);if(dataGw.isOpen){addPoser+=dataGw.skillPower}}power+=addPoser}this.power.setPower(power)};GwWeaponView.prototype.updateView=function(){this.selectIndex=this.selectIndex};GwWeaponView.prototype.updateGwExp=function(){this.updatePower();this.expcount.text=""+GodWeaponCC.ins().curExp};GwWeaponView.prototype.touchHandler=function(e){if(e.target instanceof eui.Button){switch(e.target){case this.weapon0:this.selectIndex=0;break;case this.weapon1:this.selectIndex=1;break;case this.weapon2:this.selectIndex=2;break}}else if(e.target instanceof GwshengwuItem){var index=void 0;switch(e.target){case this.shengwu1:index=1;break;case this.shengwu2:index=2;break;case this.shengwu3:index=3;break;case this.shengwu4:index=4;break;case this.shengwu5:index=5;break}this.inlayItem(index)}else if(e.target==this.detailBtn){ViewManager.ins().open(GwAddAttrView,this.selectIndex)}else if(e.target==this.reset)ViewManager.ins().open(GwResetWin,GodWeaponCC.ins().getWeaponData(this.selectIndex+1))};GwWeaponView.prototype.inlayItem=function(index){var data=GodWeaponCC.ins().getGodItemData(this._selectIndex+1,index);if(data.isOpen){ViewManager.ins().open(GwShengWuChooseView,data)}else{UserTips.ins().showTips(i18n("GwWeaponView_3",data.openLv))}};GwWeaponView.prototype.close=function(){this.godweaponskill.close();this.removeTouchEvent(this.weapon0,this.touchHandler);this.removeTouchEvent(this.weapon1,this.touchHandler);this.removeTouchEvent(this.weapon2,this.touchHandler);this.clickRect.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickRectBegin,this);this.clickRect.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClickRectEnd,this);TimerManager.ins().remove(this.addWeaponExp,this);this.removeTouchEvent(this.detailBtn,this.touchHandler);for(var i=1;i<=5;i++){this.removeTouchEvent(this["shengwu"+i],this.touchHandler)}this.removeObserve();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};return GwWeaponView}(BaseView);__reflect(GwWeaponView.prototype,"GwWeaponView");var GwshengwuItem=function(_super){__extends(GwshengwuItem,_super);function GwshengwuItem(){return _super.call(this)||this}Object.defineProperty(GwshengwuItem.prototype,"className",{get:function(){return this._className},set:function(v){this._className=v},enumerable:true,configurable:true});GwshengwuItem.prototype.updateView=function(data){this.data=data;if(data){if(data.isOpen){if(data.itemConfig){this.shengwuImg.source=data.itemConfig.icon+"_png";this.shengwuImg.visible=true;this.add.visible=false;this.rpImgAdd.visible=false;this.frame.source="godweapon_quality"+(ItemConfig.getQuality(data.itemConfig)+1)}else{this.shengwuImg.visible=false;this.add.visible=true;this.frame.source="godweapon_quality1";if(GwShengWuChooseView.getGwItemType(data).length<=0){this.rpImgAdd.visible=false}else{this.rpImgAdd.visible=true}}}else{this.shengwuImg.visible=false;this.add.visible=false;this.rpImgAdd.visible=false;this.frame.source="godweapon_quality0"}}else{this.frame.source="godweapon_quality0";this.add.visible=false;this.shengwuImg.visible=false;this.rpImgAdd.visible=false}};return GwshengwuItem}(eui.Component);__reflect(GwshengwuItem.prototype,"GwshengwuItem");var GwGodWeaponSkillView=function(_super){__extends(GwGodWeaponSkillView,_super);function GwGodWeaponSkillView(){var _this=_super.call(this)||this;_this.max=16;return _this}GwGodWeaponSkillView.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.touchEnabled=false};GwGodWeaponSkillView.prototype.open=function(){this.addTouchEvent(this,this.touchHandler)};Object.defineProperty(GwGodWeaponSkillView.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(weaponId){this._selectIndex=weaponId;this.updateView(weaponId)},enumerable:true,configurable:true});GwGodWeaponSkillView.prototype.updateView=function(weaponId){switch(weaponId+1){case 1:this.skill_wp1.visible=true;this.skill_wp2.visible=false;this.skill_wp3.visible=false;break;case 2:this.skill_wp1.visible=false;this.skill_wp2.visible=true;this.skill_wp3.visible=false;break;case 3:this.skill_wp1.visible=false;this.skill_wp2.visible=false;this.skill_wp3.visible=true;break}this.updateWp(weaponId)};GwGodWeaponSkillView.prototype.updateWp=function(weaponId){var itemV;var data;var unlocks=[];for(var i=0;i<this.max;i++){itemV=this.getWpSkill(weaponId+1,i);data=GodWeaponCC.ins().getWeaponSkinIdData(weaponId+1,i);itemV.updateView(data,weaponId);if(data&&data.isOpen&&data.config.lineId){for(var j=0;j<data.config.lineId.length;j++){this["wp"+(weaponId+1)+"_lock"+data.config.lineId[j]].visible=false;this["wp"+(weaponId+1)+"_unlock"+data.config.lineId[j]].visible=true;if(unlocks.indexOf(data.config.lineId[j])==-1)unlocks.push(data.config.lineId[j])}}else if(unlocks.indexOf(i)==-1){this["wp"+(weaponId+1)+"_lock"+i].visible=true;this["wp"+(weaponId+1)+"_unlock"+i].visible=false}}};GwGodWeaponSkillView.prototype.touchHandler=function(e){if(e.target instanceof GwWeaponSkillIcon){var data=e.target.dataThis;ViewManager.ins().open(GwSkillTipView,e.target.dataThis)}};GwGodWeaponSkillView.prototype.getWpSkill=function(weaponId,skillId){return this["wp"+weaponId+"_skill"+skillId]};GwGodWeaponSkillView.prototype.getWpLine=function(weaponId,lineId){return this["wp"+weaponId+"_line"+lineId]};GwGodWeaponSkillView.prototype.close=function(){this.removeTouchEvent(this,this.touchHandler);for(var i=0;i<3;i++){var itemV=void 0;for(var j=0;j<this.max;j++){itemV=this.getWpSkill(i+1,j);itemV.close()}}};return GwGodWeaponSkillView}(BaseView);__reflect(GwGodWeaponSkillView.prototype,"GwGodWeaponSkillView");var GwWeaponSkillIcon=function(_super){__extends(GwWeaponSkillIcon,_super);function GwWeaponSkillIcon(){var _this=_super.call(this)||this;_this._isFirst=false;_this.imgLight=false;_this.skinName="GwItemSkin";_this.touchChildren=false;_this.glowImg.visible=false;_this._effect=new MovieClip;_this.addChildAt(_this._effect,3);_this.touchChildren=false;return _this}GwWeaponSkillIcon.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.touchChildren=false};GwWeaponSkillIcon.prototype.updateView=function(data,weaponId){this.dataThis=data;if(this._isFirst==false){this.validateNow();this._isFirst=true}if(data.isOpen||this.imgLight){var weaponData=GodWeaponCC.ins().getWeaponData(weaponId+1);if(data.skillLv<data.config.upLevel&&weaponData&&weaponData.skillPoint>0){if(!this._effect.name){this._effect.playFile(RES_DIR_EFF+"actIconCircle",-1);this._effect.x=45;this._effect.y=47}switch(this.dataThis.skillId){case 16:case 15:case 14:case 13:this._effect.scaleX=this._effect.scaleY=.9;break;default:this._effect.scaleX=this._effect.scaleY=.55;break}}else{this._effect.dispose()}this.Img.source=data.config.iconId+"_N"}else{this.glowImg.visible=false;this.Img.source=data.config.iconId+"_L";if(this._effect)this._effect.dispose()}if(data.addLv>0||data.skillLv>0||data.isOpen){this.lvCount.visible=true;this.lvFrame.visible=true;if(data.addLv>0){this.lvCount.textColor=3531373}if(this.dataThis.skillId==16){this.lvCount.text=data.lvLabel(true)}else{this.lvCount.text=data.lvLabel()}}else{this.lvCount.visible=false;this.lvFrame.visible=false}};GwWeaponSkillIcon.prototype.close=function(){this.dataThis=null;this._effect.dispose()};return GwWeaponSkillIcon}(BaseView);__reflect(GwWeaponSkillIcon.prototype,"GwWeaponSkillIcon");var GodWingRedPoint=function(_super){__extends(GodWingRedPoint,_super);function GodWingRedPoint(){var _this=_super.call(this)||this;_this.roleTabs={};_this.tabs={};_this.roleTabs={};_this.redPoint=false;_this.associated(_this.postGodWingRedPoint,_this.postGodWingItem);_this.associated(_this.postGodWingItem,Wing.ins().postWingWear,Wing.ins().postGodWingData,Wing.ins().postWingUpgrade,Wing.ins().postActivate,UserBag.ins().postItemChange,UserBag.ins().postItemAdd);_this.associated(_this.postGodWingCompose,UserBag.ins().postItemChange,UserBag.ins().postItemAdd);return _this}GodWingRedPoint.prototype.postGodWingRedPoint=function(){var oldv=this.redPoint;this.redPoint=this.tabs[0]||this.tabs[1];return oldv!=this.redPoint};GodWingRedPoint.prototype.postGodWingItem=function(){var tab=0;if(!this.roleTabs[tab])this.roleTabs[tab]={};var len=3;for(var roleIndex=0;roleIndex<len;roleIndex++){if(!this.roleTabs[tab])this.roleTabs[tab]={};this.roleTabs[tab][roleIndex]=Wing.ins().isWearGodWing(roleIndex)}this.tabs[tab]=false;for(var i in this.roleTabs[tab]){if(this.roleTabs[tab][i])this.tabs[tab]=true}return true};GodWingRedPoint.prototype.postGodWingCompose=function(){var tab=1;this.tabs[tab]=Wing.ins().isComposeGodWingAll();if(!this.roleTabs[tab])this.roleTabs[tab]={};return true};GodWingRedPoint.prototype.postGodWingTransfer=function(){var tab=2;if(!this.roleTabs[tab])this.roleTabs[tab]={};this.tabs[tab]=Boolean(UserBag.ins().getBagGoodsByType(ItemType.TYPE_16))};GodWingRedPoint.prototype.getGodWingRedPoint=function(){if(GameServer.serverOpenDay+1<GlobalConfig.WingCommonConfig.openDay){return false}for(var i=0;i<SubRoles.ins().subRolesLen;i++){var wingsData=SubRoles.ins().getSubRoleByIndex(i).wingsData;if(wingsData.openStatus){return this.redPoint}}return false};return GodWingRedPoint}(BaseSystem);__reflect(GodWingRedPoint.prototype,"GodWingRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.godwingredpoint=GodWingRedPoint.ins.bind(GodWingRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GodWingComposeItem=function(_super){__extends(GodWingComposeItem,_super);function GodWingComposeItem(){var _this=_super.call(this)||this;_this.skinName="ShenYuComposeItem";return _this}GodWingComposeItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};GodWingComposeItem.prototype.dataChanged=function(){if(!this.data)return;var suitConfig=this.data.suitConfig;var slot=this.data.slot;var gl=GlobalConfig.GodWingLevelConfig[suitConfig.lv][slot];var config=GlobalConfig.ItemConfig[gl.itemId];this.nameTxt.text=config.name};GodWingComposeItem.prototype.setRedPoint=function(b){this.redPoint.visible=b};GodWingComposeItem.prototype.destruct=function(){};return GodWingComposeItem}(BaseItemRender);__reflect(GodWingComposeItem.prototype,"GodWingComposeItem");var GodWingComposePanel=function(_super){__extends(GodWingComposePanel,_super);function GodWingComposePanel(){return _super.call(this)||this}GodWingComposePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.compose,this.onClick);this.removeObserve();for(var i=0;i<Wing.GodWingMaxSlot;i++){this.removeTouchEvent(this["item"+i],this.onSlot)}};GodWingComposePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.compose,this.onClick);this.addTouchEvent(this.now,this.onClick);this.addTouchEndEvent(this.next,this.onClick);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this);this.observe(GodWingRedPoint.ins().postGodWingCompose,this.updateItem);this.slot=1;for(var i in GlobalConfig.GodWingSuitConfig){this.curIndex=GlobalConfig.GodWingSuitConfig[i].lv;break}for(var i=0;i<Wing.GodWingMaxSlot;i++){this.addTouchEvent(this["item"+i],this.onSlot);this["item"+i].setSelect(false)}this["item"+0].setSelect(true);this.list.itemRenderer=GodWingComposeItem;this.itemList=new eui.ArrayCollection([]);this.updateGodWing()};GodWingComposePanel.prototype.onListTap=function(e){if(e&&e.itemRenderer&&e.item){var suit=e.item;this.curIndex=suit.suitConfig.lv;this.updateItem()}};GodWingComposePanel.prototype.onSlot=function(e){for(var i=0;i<Wing.GodWingMaxSlot;i++){if(e.currentTarget==this["item"+i]){this["item"+i].setSelect(true);this.slot=i+1;this.updateItem()}else{this["item"+i].setSelect(false)}}};GodWingComposePanel.prototype.onClick=function(e){switch(e.currentTarget){case this.compose:var gwconfig=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];if(Wing.ins().isComposeGodWingOnly(gwconfig.itemId)){var glconfig=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];Wing.ins().sendWingCompose(2,glconfig.itemId)}else{UserTips.ins().showTips(i18n("GodWingComposePanel_0"))}break;case this.now:var gwConfig=void 0;if(e.currentTarget.data instanceof ItemConfig){var cfg_3=e.currentTarget.data;var itemdata=UserBag.ins().getBagItemById(cfg_3.id);var count=itemdata?itemdata.count:0;ViewManager.ins().open(ItemDetailedWin,0,cfg_3.id,count)}else{var cfg_4=e.currentTarget.data;gwConfig=GlobalConfig.GodWingItemConfig[cfg_4.itemId];ViewManager.ins().open(GodWingTipsWin,gwConfig)}break;case this.next:var cfg=e.currentTarget.data;gwConfig=GlobalConfig.GodWingItemConfig[cfg.itemId];ViewManager.ins().open(GodWingTipsWin,gwConfig);break}};GodWingComposePanel.prototype.updateGodWing=function(){this.dataList=[];var slot=1;for(var i in GlobalConfig.GodWingSuitConfig){var suitConfig=GlobalConfig.GodWingSuitConfig[i];this.dataList.push({slot:slot,suitConfig:suitConfig})}this.itemList.replaceAll(this.dataList);this.list.dataProvider=this.itemList;this.list.validateNow();this.list.selectedIndex=0;this.updateItem()};GodWingComposePanel.prototype.updateItem=function(){var glconfig=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];var mysum=0;var totalsum=0;this["power0"].visible=this["attr0"].visible=false;if(glconfig){this.next.data=glconfig;this.next.setCountVisible(false);var gwconfig=GlobalConfig.GodWingItemConfig[glconfig.itemId];gwconfig=GlobalConfig.GodWingItemConfig[gwconfig.composeItem.id];if(!gwconfig){gwconfig=GlobalConfig.GodWingItemConfig[glconfig.itemId];var itemconfig=GlobalConfig.ItemConfig[gwconfig.composeItem.id];this.now.data=itemconfig;this.now.setCountVisible(false);var attrtext=AttributeData.getAttStr(gwconfig.attr,0,1,"：")+"\n";attrtext+=AttributeData.getExAttrNameByAttrbute(gwconfig.exattr[0],true);this["attr0"].text=attrtext;var power0=Math.floor(UserBag.getAttrPower(gwconfig.attr));this["power0"].text=i18n("GodWingComposePanel_1",power0+gwconfig.exPower);var itemdata=UserBag.ins().getBagItemById(itemconfig.id);mysum=itemdata?itemdata.count:0;totalsum=gwconfig.composeItem.count;this["power0"].visible=this["attr0"].visible=true}else{var prelevel=Wing.ins().getPreLevel(this.curIndex);var preconfig=GlobalConfig.GodWingLevelConfig[prelevel][this.slot];this.now.data=preconfig;this.now.setCountVisible(false);var pregwconfig=GlobalConfig.GodWingItemConfig[preconfig.itemId];var preattrtext=AttributeData.getAttStr(pregwconfig.attr,0,1,"：")+"\n";preattrtext+=AttributeData.getExAttrNameByAttrbute(pregwconfig.exattr[0],true);this["attr1"].text=preattrtext;var power1=Math.floor(UserBag.getAttrPower(pregwconfig.attr));this["power1"].text=i18n("GodWingComposePanel_2",power1+pregwconfig.exPower);gwconfig=GlobalConfig.GodWingItemConfig[glconfig.itemId];var attrtext=AttributeData.getAttStr(gwconfig.attr,0,1,"：")+"\n";attrtext+=AttributeData.getExAttrNameByAttrbute(gwconfig.exattr[0],true);this["attr2"].text=attrtext;var power2=Math.floor(UserBag.getAttrPower(gwconfig.attr));this["power2"].text=i18n("GodWingComposePanel_3",power2+gwconfig.exPower);var itemdata=UserBag.ins().getBagItemById(gwconfig.composeItem.id);mysum=itemdata?itemdata.count:0;totalsum=gwconfig.composeItem.count}}this["attr1"].visible=this["attr2"].visible=!this["attr0"].visible;this["power1"].visible=this["power2"].visible=!this["power0"].visible;var colorStr;if(mysum>=totalsum)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N;this.number.textFlow=TextFlowMaker.generateTextFlow1(i18n("GodWingComposePanel_4",colorStr,mysum,totalsum));for(var i=0;i<this.dataList.length;i++){this.dataList[i].slot=this.slot}this.itemList.replaceAll(this.dataList);this.list.dataProvider=this.itemList;this.updateRedPoint();this.updateGodWingItem()};GodWingComposePanel.prototype.updateGodWingItem=function(){for(var i=0;i<Wing.GodWingMaxSlot;i++){var glconfig=GlobalConfig.GodWingLevelConfig[this.curIndex][i+1];var config=GlobalConfig.GodWingItemConfig[glconfig.itemId];this["item"+i].data=config;this["item"+i].setImgIcon("sybg"+(i+1));this["item"+i].setCountVisible(false);this["item"+i].setNameVisible(false)}};GodWingComposePanel.prototype.updateRedPoint=function(){var gwconfig=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];this.redPoint.visible=Wing.ins().isComposeGodWingOnly(gwconfig.itemId);for(var i=0;i<this.list.numElements;i++){var render=this.list.getVirtualElementAt(i);var slotdata=this.list.dataProvider.getItemAt(i);var b=Wing.ins().isComposeGodWingLevel(slotdata.suitConfig.lv,this.slot);render.setRedPoint(b)}for(var i=1;i<=Wing.GodWingMaxSlot;i++){var b=Wing.ins().isComposeGodWingSlot(this.curIndex,i);this["item"+(i-1)].updateRedPoint(b)}};return GodWingComposePanel}(BaseView);__reflect(GodWingComposePanel.prototype,"GodWingComposePanel");var GodWingItem=function(_super){__extends(GodWingItem,_super);function GodWingItem(){var _this=_super.call(this)||this;_this.skinName="ShenYuItem";return _this}GodWingItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};GodWingItem.prototype.setSelect=function(b){this.select.visible=b};GodWingItem.prototype.dataChanged=function(){if(!this.data)return;this.itemId=0;this.itemIcon.imgJob.visible=false;this.itemIcon.imgIcon.source="";if(this.data instanceof GodWingItemConfig){var gitem=this.data;var itemConfig=GlobalConfig.ItemConfig[gitem.itemId];this.itemIcon.imgIcon.source=itemConfig.icon+"_png";this.nameTxt.text=itemConfig.name;this.itemId=gitem.itemId;this.itemIcon.imgBg.source="quality"+ItemConfig.getQuality(itemConfig);this.nameTxt.textColor=ItemConfig.getQualityColor(itemConfig);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig)}else if(this.data instanceof ItemData){var itemdata=this.data;var itemConfig=GlobalConfig.ItemConfig[itemdata._configID];this.itemIcon.imgIcon.source=itemConfig.icon+"_png";this.nameTxt.text=itemConfig.name;this.itemId=itemConfig.id;this.count.text=itemdata.count+"";this.itemIcon.imgBg.source="quality"+ItemConfig.getQuality(itemConfig);this.nameTxt.textColor=ItemConfig.getQualityColor(itemConfig);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig)}else if(this.data instanceof ItemConfig){var config=this.data;this.itemIcon.imgIcon.source=config.icon+"_png";this.nameTxt.text=config.name;this.itemId=config.id;this.itemIcon.imgBg.source="quality"+ItemConfig.getQuality(config);this.nameTxt.textColor=ItemConfig.getQualityColor(config);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(config)}else if(this.data instanceof GodWingSuitConfig){var config=this.data;if(!config.skillname){for(var k in GlobalConfig.GodWingSuitConfig){if(GlobalConfig.GodWingSuitConfig[k].skillname){config=GlobalConfig.GodWingSuitConfig[k];this.data=config;break}}}this.itemIcon.imgIcon.source=config.skillicon;this.nameTxt.text=config.skillname}else if(this.data instanceof GodWingLevelConfig){var config=this.data;var cfg=GlobalConfig.ItemConfig[config.itemId];this.itemIcon.imgIcon.source=cfg.icon+"_png";this.nameTxt.text=cfg.name;this.itemIcon.imgBg.source="quality"+ItemConfig.getQuality(cfg);this.nameTxt.textColor=ItemConfig.getQualityColor(cfg);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(cfg)}this.itemIcon.imgIcon.visible=this.itemIcon.imgIcon.source?true:false};GodWingItem.prototype.setCountVisible=function(b){this.count.visible=b};GodWingItem.prototype.setNameVisible=function(b){this.nameTxt.visible=b;if(!b)this.setQuality("quality0")};GodWingItem.prototype.setImgIcon=function(img){this.itemIcon.imgIcon.source=img;this.itemIcon.imgJob.visible=false;this.itemIcon.imgIcon.visible=this.itemIcon.imgIcon.source?true:false};GodWingItem.prototype.updateRedPoint=function(b){this.redPoint.visible=b};GodWingItem.prototype.setNameText=function(str){this.nameTxt.text=str};GodWingItem.prototype.setQuality=function(str){this.itemIcon.imgBg.source=str};GodWingItem.prototype.destruct=function(){};return GodWingItem}(BaseItemRender);__reflect(GodWingItem.prototype,"GodWingItem");var GodWingPanel=function(_super){__extends(GodWingPanel,_super);function GodWingPanel(){return _super.call(this)||this}GodWingPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.attr,this.onClick);this.addTouchEndEvent(this.skill,this.onTouch);this.addTouchEndEvent(this.replace,this.onClick);this.addTouchEndEvent(this.replace0,this.onClick);this.addTouchEndEvent(this.getItemTxt,this.onClick);this.observe(GodWingRedPoint.ins().postGodWingItem,this.updateItem);for(var i=0;i<Wing.GodWingMaxSlot;i++){this.addTouchEvent(this["item"+i],this.onTab)}this.slot=1;this.updateGodWing()};GodWingPanel.prototype.onTab=function(e){for(var i=0;i<Wing.GodWingMaxSlot;i++){if(e.currentTarget==this["item"+i]){this.slot=i+1;this["item"+i].setSelect(true);this.updateGodWing()}else{this["item"+i].setSelect(false)}}};GodWingPanel.prototype.onClick=function(e){switch(e.target){case this.attr:ViewManager.ins().open(GodWingSuitTipsWin,this.curRole);break;case this.replace:var gwconfig=this["item"+(this.slot-1)].data;if(gwconfig){gwconfig=GlobalConfig.GodWingLevelConfig[gwconfig.level][gwconfig.slot];if(!Wing.ins().wearItemRedPoint(this.curRole,this.slot)){UserTips.ins().showTips(i18n("GodWingPanel_0"));return}var itemid=Wing.ins().getWearItem(this.curRole,this.slot);if(!itemid)itemid=gwconfig.itemId;Wing.ins().sendWingWear(this.curRole,itemid)}break;case this.replace0:if(Wing.ins().isQuicComposeGodWing(this.curRole,this.slot)){var gwconfig_1=Wing.ins().getCurLevelItemId(this.curRole,this.slot);if(!gwconfig_1){var level=Wing.ins().getStartLevel(this.slot);gwconfig_1=GlobalConfig.GodWingLevelConfig[level][this.slot]}else{var level=Wing.ins().getNextLevel(gwconfig_1.level);gwconfig_1=GlobalConfig.GodWingLevelConfig[level][this.slot]}if(!Wing.ins().checkGodWingLevel(this.curRole,gwconfig_1.itemId)){UserTips.ins().showTips(i18n("GodWingPanel_1"));return}if(!Wing.ins().checkGodWingItem(this.curRole,gwconfig_1.itemId,this.slot)){UserTips.ins().showTips(i18n("GodWingPanel_2"));return}Wing.ins().sendWingCompose(1,gwconfig_1.itemId,this.curRole)}else{UserTips.ins().showTips(i18n("GodWingPanel_3"))}break;case this.getItemTxt:var cfg=this["item"+(this.slot-1)].data;if(cfg){cfg=GlobalConfig.GodWingItemConfig[cfg.itemId];var gayId=cfg.itemId;if(!Wing.ins().getGodWing(this.curRole).getLevel(this.slot)){if(cfg instanceof GodWingItemConfig)gayId=cfg.composeItem.id}UserWarn.ins().setBuyGoodsWarn(gayId)}break}};GodWingPanel.prototype.onTouch=function(e){switch(e.currentTarget){case this.skill:ViewManager.ins().open(GodWingSkillTipsWin,this.skill.data,this.isActive);break}};GodWingPanel.prototype.updateGodWing=function(){this.updateItem()};GodWingPanel.prototype.updateItem=function(){var gw=Wing.ins().getGodWing(this.curRole);var gwdata=gw.getData();var level=gw.getLevel(this.slot);this.attr0.visible=level?false:true;this.attr1.visible=this.attr2.visible=!this.attr0.visible;this.state0.visible=this.power0.visible=this.attr0.visible;this.power1.visible=this.power2.visible=!this.power0.visible;this.state1.visible=this.state2.visible=!this.state0.visible;this.attr3.visible=this.power3.visible=this.state3.visible=false;if(level&&!Wing.ins().getNextLevel(level)){this.attr3.visible=this.power3.visible=this.state3.visible=true;for(var i=0;i<3;i++){this["attr"+i].visible=this["power"+i].visible=this["state"+i].visible=!this.attr3.visible}}var gitem;var nextgitem;var percent=0;var suitsum=gw.getSuitSum();if(suitsum>=Wing.GodWingMaxSlot){var minLevel=gw.getSuitLevel();var tmp=GlobalConfig.GodWingSuitConfig[minLevel];if(tmp)percent=tmp.precent/1e4}if(this.attr0.visible){var idx=Wing.ins().getStartLevel(this.slot);var wl=GlobalConfig.GodWingLevelConfig[idx][this.slot];gitem=GlobalConfig.GodWingItemConfig[wl.itemId];var power0=Math.floor(UserBag.getAttrPower(gitem.attr));this.power0.text=i18n("GodWingPanel_4",power0+gitem.exPower);this.power0.visible=true;this.attr0.text=AttributeData.getAttStr(gitem.attr,0,1,"：");var attrtext=AttributeData.getAttStr(gitem.attr,0,1,"：")+"\n";attrtext+=AttributeData.getExAttrNameByAttrbute(gitem.exattr[0],true);this.attr0.text=attrtext}if(this.attr1.visible){var glconfig=Wing.ins().getCurLevelItemId(this.curRole,this.slot);if(glconfig){gitem=GlobalConfig.GodWingItemConfig[glconfig.itemId];var newAttr=AttributeData.getPercentAttr(gitem.attr,percent);var power1=Math.floor(UserBag.getAttrPower(newAttr));this.power1.text=i18n("GodWingPanel_5",power1+gitem.exPower);var attrtext=AttributeData.getAttStr(gitem.attr,0,1,"：")+"\n";attrtext+=AttributeData.getExAttrNameByAttrbute(gitem.exattr[0],true);this.attr1.text=attrtext}glconfig=Wing.ins().getNextLevelItemId(this.curRole,this.slot);if(glconfig){nextgitem=GlobalConfig.GodWingItemConfig[glconfig.itemId];var newAttr=AttributeData.getPercentAttr(nextgitem.attr,percent);var power2=Math.floor(UserBag.getAttrPower(newAttr));this.power2.text=i18n("GodWingPanel_6",power2+nextgitem.exPower);var attrtext=AttributeData.getAttStr(nextgitem.attr,0,1,"：")+"\n";attrtext+=AttributeData.getExAttrNameByAttrbute(nextgitem.exattr[0],true);this.attr2.text=attrtext}}if(this.attr3.visible){var glconfig=Wing.ins().getCurLevelItemId(this.curRole,this.slot);gitem=GlobalConfig.GodWingItemConfig[glconfig.itemId];var newAttr=AttributeData.getPercentAttr(gitem.attr,percent);var power0=Math.floor(UserBag.getAttrPower(newAttr));this.power3.text=i18n("GodWingPanel_7",power0+gitem.exPower);this.power3.visible=true;this.attr3.text=AttributeData.getAttStr(gitem.attr,0,1,"：");var attrtext=AttributeData.getAttStr(gitem.attr,0,1,"：")+"\n";attrtext+=AttributeData.getExAttrNameByAttrbute(gitem.exattr[0],true);this.attr3.text=attrtext}var costItem=gitem;this.costImg0.visible=this.cost0.visible=true;if(!this.attr0.visible){var nextLv=Wing.ins().getNextLevel(gitem.level);if(nextLv){var nextcfg=GlobalConfig.GodWingLevelConfig[nextLv][this.slot];costItem=GlobalConfig.GodWingItemConfig[nextcfg.itemId]}else{this.costImg0.visible=this.cost0.visible=false}}this.updateCost(costItem);for(var i=0;i<4;i++){this["item"+i].data=null;this["item"+i].setSelect(false);this["item"+i].setCountVisible(false);var isShow_1=Wing.ins().getGodWing(this.curRole).getLevel(i+1);this["item"+i].setNameVisible(isShow_1)}this["item"+(this.slot-1)].data=gitem;if(!Wing.ins().getCurLevelItemId(this.curRole,this.slot)){this["item"+(this.slot-1)].setImgIcon("sybg"+this.slot)}this["item"+(this.slot-1)].setSelect(true);this["item"+(this.slot-1)].setCountVisible(false);var isShow=Wing.ins().getGodWing(this.curRole).getLevel(this.slot);this["item"+(this.slot-1)].setNameVisible(isShow);for(var i=1;i<=4;i++){if(i!=this.slot){var itemlevel=void 0;var islock=false;if(gwdata[i]){itemlevel=gwdata[i].level;islock=true}else{itemlevel=Wing.ins().getStartLevel(i)}var cfg=GlobalConfig.GodWingLevelConfig[itemlevel][i];var gitem_1=GlobalConfig.GodWingItemConfig[cfg.itemId];if(gitem_1){this["item"+(i-1)].data=gitem_1;if(!islock){this["item"+(i-1)].setImgIcon("sybg"+i);this["item"+(i-1)].setQuality("quality0")}}}}this.updatePower();this.updateRedPoint();this.updateSkill()};GodWingPanel.prototype.setNnactive=function(){for(var k in GlobalConfig.GodWingSuitConfig){var config=GlobalConfig.GodWingSuitConfig[k];this.skill.data=config;this.skill.setCountVisible(false);this.skill.setImgIcon("sy100000");break}};GodWingPanel.prototype.updateSkill=function(){var gw=Wing.ins().getGodWing(this.curRole);var gwsconfig;var suitLevel=gw.getSuitLevel();this.isActive=false;if(!suitLevel){this.setNnactive();return 0}else{var sconfig=GlobalConfig.GodWingSuitConfig[suitLevel];if(sconfig.skillname){this.isActive=true}gwsconfig=sconfig}this.skill.data=gwsconfig;this.skill.setCountVisible(false);if(!this.isActive){this.skill.setImgIcon("sy100000");for(var k in GlobalConfig.GodWingSuitConfig){var gsconfig=GlobalConfig.GodWingSuitConfig[k];if(gsconfig.skillname)this.skill.setNameText(gsconfig.skillname)}}};GodWingPanel.prototype.updateCost=function(gitem){if(!gitem)return;var itemData=UserBag.ins().getBagItemById(gitem.composeItem.id);var costItemLen=itemData?itemData.count:0;var myLevel=Wing.ins().getGodWing(this.curRole).getLevel(this.slot);if(myLevel){var lcfg=GlobalConfig.GodWingLevelConfig[myLevel][this.slot];if(lcfg.itemId==gitem.composeItem.id)costItemLen+=1}var itemconfig=GlobalConfig.ItemConfig[gitem.composeItem.id];this.costImg0.source=itemconfig.icon+"_png";this.costImg0.visible=false;var colorStr;if(costItemLen>=gitem.composeItem.count)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N;this.cost0.textFlow=TextFlowMaker.generateTextFlow1(i18n("GodWingPanel_9",colorStr,costItemLen,gitem.composeItem.count));this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt.text);var it=GlobalConfig.ItemConfig[gitem.composeItem.id];colorStr=ItemConfig.getQualityColor(it);this.costName.textFlow=TextFlowMaker.generateTextFlow1(i18n("GodWingPanel_8",colorStr,it.name,4740980,":"))};GodWingPanel.prototype.updateRedPoint=function(){for(var i=0;i<Wing.GodWingMaxSlot;i++){this["item"+i].updateRedPoint(Wing.ins().gridRedPoint(this.curRole,i+1))}this.redPointReplace.visible=Wing.ins().wearItemRedPoint(this.curRole,this.slot);this.redPointReplace0.visible=Wing.ins().quickComposeRedPoint(this.curRole,this.slot)};GodWingPanel.prototype.updatePower=function(){var gw=Wing.ins().getGodWing(this.curRole);var gwdata=gw.getData();var powers=0;var percent=0;var suitsum=gw.getSuitSum();if(suitsum>=Wing.GodWingMaxSlot){var minLevel=gw.getSuitLevel();var tmp=GlobalConfig.GodWingSuitConfig[minLevel];if(tmp)percent=tmp.precent/1e4}for(var k in gwdata){var glconfig=GlobalConfig.GodWingLevelConfig[gwdata[k].level][gwdata[k].slot];var gwconfig=GlobalConfig.GodWingItemConfig[glconfig.itemId];var exPower=gwconfig.exPower?gwconfig.exPower:0;var newAttr=AttributeData.getPercentAttr(gwconfig.attr,percent);powers+=Math.floor(UserBag.getAttrPower(newAttr))+exPower}this.powerPanel.setPower(powers)};return GodWingPanel}(BaseView);__reflect(GodWingPanel.prototype,"GodWingPanel");var GodWingSkillTipsWin=function(_super){__extends(GodWingSkillTipsWin,_super);function GodWingSkillTipsWin(){var _this=_super.call(this)||this;_this.skinName="ShenYuSkillTipsSkin";return _this}GodWingSkillTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};GodWingSkillTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.bgClose,this.onClick);this.gwsConfig=param[0];var isActive=param[1];for(var i in GlobalConfig.GodWingSuitConfig){var suitconfig=GlobalConfig.GodWingSuitConfig[i];if(suitconfig.skillname&&suitconfig.lv>this.gwsConfig.lv){this.nextConfig=suitconfig;break}}if(!isActive){this.currentState="unactive"}else{if(this.nextConfig){this.currentState="active"}else{this.currentState="max"}}this.validateNow();this.updateDesc()};GodWingSkillTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeObserve()};GodWingSkillTipsWin.prototype.onClick=function(){ViewManager.ins().close(this)};GodWingSkillTipsWin.prototype.updateDesc=function(){this.setCurDesc();this.setNextDesc()};GodWingSkillTipsWin.prototype.setCurDesc=function(){this.icon.data=this.gwsConfig;this.icon.setNameVisible(false);this.icon.setCountVisible(false);this.content.textFlow=TextFlowMaker.generateTextFlow1(this.gwsConfig.skilldesc);this.lv.text=i18n("GodWingSkillTipsWin_0")+this.gwsConfig.skilllevel;var glc=GlobalConfig.GodWingLevelConfig[this.gwsConfig.lv][1];var showlv=GlobalConfig.GodWingItemConfig[glc.itemId].showlv;this.condition.text=i18n("GodWingSkillTipsWin_1",showlv)};GodWingSkillTipsWin.prototype.setNextDesc=function(){if(!this.nextConfig)return;this.icon0.data=this.nextConfig;this.icon0.setNameVisible(false);this.icon0.setCountVisible(false);this.content0.textFlow=TextFlowMaker.generateTextFlow1(this.nextConfig.skilldesc);this.lv0.text=i18n("GodWingSkillTipsWin_2")+this.nextConfig.skilllevel+"";var glc=GlobalConfig.GodWingLevelConfig[this.nextConfig.lv][1];var showlv=GlobalConfig.GodWingItemConfig[glc.itemId].showlv;this.condition0.text=i18n("GodWingSkillTipsWin_3",this.nextConfig.lv)};return GodWingSkillTipsWin}(BaseEuiView);__reflect(GodWingSkillTipsWin.prototype,"GodWingSkillTipsWin");ViewManager.ins().reg(GodWingSkillTipsWin,LayerManager.UI_Popup);var GodWingSuitTipsWin=function(_super){__extends(GodWingSuitTipsWin,_super);function GodWingSuitTipsWin(){var _this=_super.call(this)||this;_this.skinName="ShenYuSuitTipsSkin";return _this}GodWingSuitTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};GodWingSuitTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.bgClose,this.onClick);this.roleIndex=param[0];var mySuitLevel=Wing.ins().getGodWing(this.roleIndex).getSuitLevel();var nextSuitLevel=0;if(mySuitLevel){nextSuitLevel=Wing.ins().getNextLevel(mySuitLevel)}this.gwsConfig=GlobalConfig.GodWingSuitConfig[mySuitLevel];if(!this.gwsConfig){for(var i in GlobalConfig.GodWingSuitConfig){this.gwsConfig=GlobalConfig.GodWingSuitConfig[i];break}}if(!mySuitLevel){this.currentState="unactive"}else{this.nextConfig=GlobalConfig.GodWingSuitConfig[nextSuitLevel];if(this.nextConfig){this.currentState="active"}else{this.currentState="max"}}this.validateNow();this.updateDesc()};GodWingSuitTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeObserve()};GodWingSuitTipsWin.prototype.onClick=function(){ViewManager.ins().close(this)};GodWingSuitTipsWin.prototype.updateDesc=function(){this.setCurDesc();this.setNextDesc()};GodWingSuitTipsWin.prototype.setCurDesc=function(){if(this.currentState=="unactive"){var precent=Math.floor(this.gwsConfig.precent/100);var totalSum=Wing.GodWingMaxSlot;var mySum=Wing.ins().getGodWing(this.roleIndex).getSuitSum();this.content0.text=i18n("GodWingSuitTipsWin_0",mySum,totalSum,precent);this.name0.text=this.gwsConfig.suitname}else if(this.currentState=="max"){var precent=Math.floor(this.gwsConfig.precent/100);this.content0.text=i18n("GodWingSuitTipsWin_1",precent);this.name0.text=this.gwsConfig.suitname}else{var precent=Math.floor(this.gwsConfig.precent/100);this.content0.text=i18n("GodWingSuitTipsWin_2",precent);this.name0.text=this.gwsConfig.suitname}};GodWingSuitTipsWin.prototype.setNextDesc=function(){if(this.currentState=="active"){var precent=Math.floor(this.nextConfig.precent/100);var totalSum=Wing.GodWingMaxSlot;var slotData=Wing.ins().calcGodWingSlot(this.roleIndex);var mySum=0;for(var i=0;i<slotData.length;i++){if(slotData[i].level>=this.nextConfig.lv){mySum++}}var glc=GlobalConfig.GodWingLevelConfig[this.nextConfig.lv][1];var showLv=GlobalConfig.GodWingItemConfig[glc.itemId].showlv;this.content1.text=i18n("GodWingSuitTipsWin_3",showLv,mySum,totalSum,precent);this.name1.text=this.nextConfig.suitname}};return GodWingSuitTipsWin}(BaseEuiView);__reflect(GodWingSuitTipsWin.prototype,"GodWingSuitTipsWin");ViewManager.ins().reg(GodWingSuitTipsWin,LayerManager.UI_Popup);var GodWingTipsWin=function(_super){__extends(GodWingTipsWin,_super);function GodWingTipsWin(){var _this=_super.call(this)||this;_this.skinName="ShenYuTipsSkin";return _this}GodWingTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};GodWingTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.bgClose,this.otherClose);this.gwConfig=param[0];this.updateTips()};GodWingTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose)};GodWingTipsWin.prototype.otherClose=function(evt){ViewManager.ins().close(GodWingTipsWin)};GodWingTipsWin.prototype.updateTips=function(){var cfg=GlobalConfig.ItemConfig[this.gwConfig.itemId];this.nameLabel.text=cfg.name;this.type.text=Wing.ins().getNameFromSlot(this.gwConfig.slot);this.lv.text=i18n("GodWingTipsWin_0")+this.gwConfig.level+i18n("GodWingTipsWin_1");var color=16711680;for(var i=0;i<SubRoles.ins().subRolesLen;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role&&role.wingsData.lv+1>=this.gwConfig.level){color=65280;break}}this.lv.textColor=color;this.nameLabel.textColor=ItemConfig.getQualityColor(cfg);this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(cfg);var arr=this.gwConfig.attr;var exarr=this.gwConfig.exattr;var attrStr="";var exattrStr="";var exPower=this.gwConfig.exPower;for(var i=0;i<arr.length;i++){attrStr+=AttributeData.getAttrStrByType(arr[i].type)+": ";attrStr+=arr[i].value+"\n"}for(var i=0;i<exarr.length;i++){attrStr+=AttributeData.getExtAttrStrByType(exarr[i].type)+": ";var value=exarr[i].value;if(exarr[i].type==ExAttributeType.eatMiss||exarr[i].type==ExAttributeType.eatHit){value=value/100;attrStr+=value;attrStr+="%"}attrStr+="\n"}var index=attrStr.lastIndexOf("\n");attrStr=attrStr.substring(0,index);this.attr0.text=attrStr;var totalAttr=arr;var scorePower=Math.floor(UserBag.getAttrPower(totalAttr))+exPower;this.score.text=i18n("GodWingTipsWin_2",scorePower);this.powerPanel.setPower(scorePower);this.itemIcon.data=this.gwConfig;this.itemIcon.setNameVisible(false);this.itemIcon.setCountVisible(false);this.quali.source="quali"+ItemConfig.getQuality(cfg)};return GodWingTipsWin}(BaseEuiView);__reflect(GodWingTipsWin.prototype,"GodWingTipsWin");ViewManager.ins().reg(GodWingTipsWin,LayerManager.UI_Popup);var GodWingTransferPanel=function(_super){__extends(GodWingTransferPanel,_super);function GodWingTransferPanel(){return _super.call(this)||this}GodWingTransferPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.transfer,this.onClick);this.removeTouchEvent(this.have,this.onListTap);this.removeTouchEvent(this.item0,this.onClick);this.removeObserve();this.reset();for(var i=1;i<Wing.GodWingMaxSlot;i++){this.removeTouchEvent(this["item"+i],this.onTouchItem)}};GodWingTransferPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.transfer,this.onClick);this.addTouchEvent(this.have,this.onListTap);this.addTouchEvent(this.item0,this.onClick);this.observe(UserBag.ins().postItemAdd,this.callbackUpdate);this.itemList=new eui.ArrayCollection;this.have.itemRenderer=GodWingItem;this.have.dataProvider=new eui.ArrayCollection([]);this.updateGodWing()};GodWingTransferPanel.prototype.reset=function(){for(var i=1;i<Wing.GodWingMaxSlot;i++){this.addTouchEvent(this["item"+i],this.onTouchItem);this["item"+i].setCountVisible(false);this["item"+i].setNameVisible(false);this["item"+i].setImgIcon("");this["item"+i].setSelect(false);this["item"+i].data=null}this.item0.setCountVisible(false);this.item0.setImgIcon("");this.item0.setNameVisible(false);this["item0"].data=null;this.updateBagList();this.warn.visible=this.itemList.length?false:true;this.curItemId=0;this.desId=0};GodWingTransferPanel.prototype.updateBagList=function(){var itemData=UserBag.ins().getBagGoodsByType(ItemType.TYPE_16);this.itemList.replaceAll(itemData);this.have.dataProvider=this.itemList};GodWingTransferPanel.prototype.callbackUpdate=function(){if(!this["item0"].itemId)return;var item=UserBag.ins().getBagItemById(this["item0"].itemId);if(!item){this.reset()}this.updateBagList();this.updateCost()};GodWingTransferPanel.prototype.onClick=function(e){switch(e.currentTarget){case this.transfer:if(Boolean(UserBag.ins().getBagGoodsByType(ItemType.TYPE_16))){if(this["item0"].itemId&&this.desId)Wing.ins().sendResetGodWing(this["item0"].itemId,this.desId);else UserTips.ins().showTips(i18n("GodWingTransferPanel_0"))}else{UserTips.ins().showTips(i18n("GodWingTransferPanel_1"))}break;case this.item0:if(this.curItemId){var config=GlobalConfig.GodWingItemConfig[this.curItemId];ViewManager.ins().open(GodWingTipsWin,config)}break}};GodWingTransferPanel.prototype.onTouchItem=function(e){for(var i=1;i<Wing.GodWingMaxSlot;i++){if(e.currentTarget==this["item"+i]){if(e.currentTarget.itemId){this.desId=e.currentTarget.itemId;this["item"+i].setSelect(true)}}else{this["item"+i].setSelect(false)}}};GodWingTransferPanel.prototype.onListTap=function(e){if(e&&e.currentTarget&&this.have.selectedItem){var itemdata=this.have.selectedItem;this.curItemId=itemdata._configID;var gwConfig=GlobalConfig.GodWingItemConfig[itemdata._configID];var cfg=GlobalConfig.GodWingLevelConfig[gwConfig.level];this["item0"].data=gwConfig;this.item0.setNameVisible(true);var itemcfg=GlobalConfig.ItemConfig[itemdata._configID];this["item0"].setImgIcon(itemcfg.icon+"_png");var idx=1;for(var i in cfg){if(cfg[i].slot!=gwConfig.slot){this["item"+idx].data=GlobalConfig.GodWingItemConfig[cfg[i].itemId];this["item"+idx].setNameVisible(true);this["item"+idx].setSelect(false);idx++;if(idx>3)break}}this.updateCost()}};GodWingTransferPanel.prototype.updateGodWing=function(){this.reset();this.updateCost()};GodWingTransferPanel.prototype.updateCost=function(){if(!this.curItemId){this.costImg0.visible=this.cost.visible=false;return}this.costImg0.visible=this.cost.visible=true;var config=GlobalConfig.GodWingItemConfig[this.curItemId];this.cost.text=config.needMoney+""};GodWingTransferPanel.prototype.updateRedPoint=function(){};return GodWingTransferPanel}(BaseView);__reflect(GodWingTransferPanel.prototype,"GodWingTransferPanel");var GodWingWin=function(_super){__extends(GodWingWin,_super);function GodWingWin(){var _this=_super.call(this)||this;_this.roleIndex=0;_this.skinName="ShenYuSkin";_this.isTopLevel=true;return _this}GodWingWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.addChangeEvent(this.roleSelect,this.onChange);this.observe(GodWingRedPoint.ins().postGodWingRedPoint,this.updateRedPoint);this.observe(GodWingRedPoint.ins().postGodWingItem,this.updateRedPoint);this.observe(GameLogic.ins().postSubRoleChange,this.updateRedPoint);this.roleIndex=param[0]?param[0]:0;this.roleSelect.setCurRole(this.roleIndex);this.godWingPanel.curRole=this.roleIndex;this.setOpenIndex(0);this.updateRedPoint()};GodWingWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};GodWingWin.prototype.checkIsOpen=function(index){return true};GodWingWin.prototype.onChange=function(e){this.setRoleId(this.roleSelect.getCurRole())};GodWingWin.prototype.onTabTouch=function(e){this.setOpenIndex(this.tab.selectedIndex)};GodWingWin.prototype.setRoleId=function(roleId){this.godWingPanel.curRole=roleId;this.setOpenIndex(this.viewStack.selectedIndex)};GodWingWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case 0:this.roleSelect.setState("uphead");this.godWingPanel.open();break;case 1:this.roleSelect.setState("nohead");this.godWingComposePanel.open();break;case 2:this.roleSelect.setState("nohead");this.godWingTransferPanel.open();break}this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex};GodWingWin.prototype.updateRedPoint=function(){if(!GodWingRedPoint.ins().tabs)GodWingRedPoint.ins().tabs={};this.redPoint0.visible=GodWingRedPoint.ins().tabs[0];this.redPoint1.visible=GodWingRedPoint.ins().tabs[1];if(!this.tab.selectedIndex){for(var i=0;i<SubRoles.ins().subRolesLen;i++){this.roleSelect.showRedPoint(i,GodWingRedPoint.ins().roleTabs[this.tab.selectedIndex][i])}}};return GodWingWin}(BaseEuiView);__reflect(GodWingWin.prototype,"GodWingWin");ViewManager.ins().reg(GodWingWin,LayerManager.UI_Main);var GuardMainUI=function(_super){__extends(GuardMainUI,_super);function GuardMainUI(){var _this=_super.call(this)||this;_this.isDelayBuff=false;_this.skillCd1=0;_this.skillCd2=0;_this.skillCd3=0;_this.isDelayUpdateInfo=false;_this.skinName="guardGodWeaponUISkind";return _this}GuardMainUI.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.help,this.onHelp);this.addTouchEvent(this.luckyBossBtn,this.onLuckBoss);this.addTouchEvent(this.skillBtn1,this.useSkill);this.addTouchEvent(this.skillBtn2,this.useSkill);this.addTouchEvent(this.skillBtn3,this.useSkill);this.observe(GameLogic.ins().postHpChange,this.updateHead);this.observe(GameLogic.ins().postSubRoleChange,this.updateHeadIcon);this.observe(GameLogic.ins().postSubRoleChange,this.initHp);this.observe(UserFb.ins().postGuardCopyInfo,this.delayUpdateInfo);this.observe(UserSkill.ins().postDoBuff,this.doBuff);this.observe(UserSkill.ins().postDoRemoveBuff,this.doBuff);this.observe(UserFb.ins().postGuardUseSkill,this.useSkillHandler);if(GuardWeaponModel.ins().leftTime!=undefined){this.beginTime()}else{this.observe(UserFb.ins().postGuardLeftTime,this.beginTime)}this.updateHeadIcon();this.initHp();this.updateInfo();this.skillBtn1.icon=""+GlobalConfig.GuardGodWeaponConf.sSkillIcon[0];this.skillBtn2.icon=""+GlobalConfig.GuardGodWeaponConf.sSkillIcon[1];this.skillBtn3.icon=""+GlobalConfig.GuardGodWeaponConf.sSkillIcon[2];this.skillcostnum1.text=""+GlobalConfig.GuardGodWeaponConf.sSkillCost[0];this.skillcostnum2.text=""+GlobalConfig.GuardGodWeaponConf.sSkillCost[1];this.skillcostnum3.text=""+GlobalConfig.GuardGodWeaponConf.sSkillCost[2];this.shortcutCD1=new ShortcutCD(40);this.cdGroup1.addChild(this.shortcutCD1);this.shortcutCD2=new ShortcutCD(40);this.cdGroup2.addChild(this.shortcutCD2);this.shortcutCD3=new ShortcutCD(40);this.cdGroup3.addChild(this.shortcutCD3)};GuardMainUI.prototype.close=function(){};GuardMainUI.prototype.updateHeadIcon=function(){for(var i=0;i<3;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role){this["player"+(i+1)].visible=true;this["player"+(i+1)+"touxiang"].source="yuanhead"+role.job+role.sex}else{this["player"+(i+1)].visible=false}}};GuardMainUI.prototype.onHelp=function(){ViewManager.ins().open(ZsBossRuleSpeak,29)};GuardMainUI.prototype.updateBuffInfo=function(){this.isDelayBuff=false;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){this.setBuff(i)}};GuardMainUI.prototype.doBuff=function(){if(!this.isDelayBuff){this.isDelayBuff=true;TimerManager.ins().doTimer(80,1,this.updateBuffInfo,this)}};GuardMainUI.prototype.setBuff=function(index){var role=EntityManager.ins().getMainRole(index);if(role){this["littleBuff"+(index+1)].visible=role.hasBuff(59100)}};GuardMainUI.prototype.useSkill=function(e){var btn=e.target;var index=1;switch(btn){case this.skillBtn1:index=1;break;case this.skillBtn2:index=2;break;case this.skillBtn3:index=3;if(UserSkill.ins().hejiEnable){UserTips.ins().showTips(i18n("GuardMainUI_0"));return}break}var data=GuardWeaponModel.ins().guardCopyInfo;var time=this["skillCd"+index];if(time>0){UserTips.ins().showTips(i18n("GuardMainUI_1",time))}else if(data.score<GlobalConfig.GuardGodWeaponConf.sSkillCost[index-1]){UserTips.ins().showTips(i18n("GuardMainUI_2"))}else{UserFb.ins().guardUseSkill(index)}};GuardMainUI.prototype.useSkillHandler=function(index){this["shortcutCD"+index].play(GlobalConfig.GuardGodWeaponConf.sSkillCd[index-1]);this["skillCd"+index]=GlobalConfig.GuardGodWeaponConf.sSkillCd[index-1];var str=i18n("GuardMainUI_4",GlobalConfig.GuardGodWeaponConf.sSkillUseText[index-1]);UserTips.ins().showTips(str)};GuardMainUI.prototype.delayUpdateInfo=function(){if(!this.isDelayUpdateInfo){this.isDelayUpdateInfo=true;TimerManager.ins().doTimer(200,1,this.updateInfo,this)}};GuardMainUI.prototype.updateInfo=function(){this.isDelayUpdateInfo=false;var data=GuardWeaponModel.ins().guardCopyInfo;this.refreshHints0.text="（"+data.wave+"/"+GuardWeaponModel.ins().getMaxWaves()+"）";var time;if(this.lastWave!=data.wave){time=GuardWeaponModel.ins().getWaveTime(data.wave);this.refreshHints1.text=""+time}this.lastWave=data.wave;this.dangqianbo1.text=""+data.minMonsterWave;this.dangqianbo2.text=""+data.minMonsteNums;this.zongshu2.text=""+data.monsterNum;this.zongshu0.text=""+data.score;this.redPoint.visible=GuardWeaponModel.ins().isCanCallBoss();var value;if(this.lastScore==undefined){value=data.score}else{value=data.score-this.lastScore}this.lastScore=data.score;if(value>0){var str=i18n("GuardMainUI_3",value);UserTips.ins().showTips(str)}};GuardMainUI.prototype.initHp=function(){for(var i=0;i<3;i++){var progress=this["bloodBar"+i];var role=SubRoles.ins().getSubRoleByIndex(i);if(role){this["player"+(i+1)].visible=true;var currentHp=role.getAtt(AttributeType.atHp);var maxHp=role.getAtt(AttributeType.atMaxHp);progress.maximum=100;progress.value=Math.floor(currentHp*100/maxHp)}else{this["player"+(i+1)].visible=false}}};GuardMainUI.prototype.updateHead=function(_a){var target=_a[0],hp=_a[1],oldHp=_a[2];if(!(target instanceof CharRole)||hp==oldHp)return;var role=target.infoModel;var progress=this["bloodBar"+role.index];var currentHp=role.getAtt(AttributeType.atHp);var maxHp=role.getAtt(AttributeType.atMaxHp);progress.maximum=100;progress.value=currentHp*100/maxHp;var img=this["player"+(role.index+1)+"touxiang"];if(currentHp==0){img.filters=FilterUtil.ARRAY_GRAY_FILTER;this["time"+(role.index+1)]=GlobalConfig.GuardGodWeaponConf.recoverCD}else{img.filters=null;this["time"+(role.index+1)]=0;this["CountDown"+(role.index+1)].visible=false}};GuardMainUI.prototype.setTimeLabel=function(index){this["time"+index]--;if(this["time"+index]>0){this["CountDown"+index].visible=true;this["CountDown"+index].text=this["time"+index].toString()}else{this["CountDown"+index].visible=false}};GuardMainUI.prototype.onLuckBoss=function(){ViewManager.ins().open(GuardCallBossWin)};GuardMainUI.prototype.beginTime=function(){if(this.isBegin)return;this.time=GuardWeaponModel.ins().leftTime;this.isBegin=true;TimerManager.ins().doTimer(1e3,0,this.runTime,this)};GuardMainUI.prototype.runTime=function(){this.time-=1;if(this.time>0){this.lastTime.text=DateUtils.getFormatBySecond(this.time,DateUtils.TIME_FORMAT_12)}else{this.lastTime.text="";TimerManager.ins().remove(this.runTime,this)}var str=this.refreshHints1.text;var time=+str;if(time>0){time--;this.refreshHints1.text=""+time}for(var i=1;i<=3;i++){if(this["time"+i]>0)this.setTimeLabel(i);this.setSkillCd(i)}};GuardMainUI.prototype.setSkillCd=function(index){if(this["skillCd"+index]>0){this["skillCd"+index]--}};return GuardMainUI}(BaseEuiView);__reflect(GuardMainUI.prototype,"GuardMainUI");ViewManager.ins().reg(GuardMainUI,LayerManager.UI_Main);var GuardCopyInfo=function(){function GuardCopyInfo(){this.wave=0;this.score=0;this.callBossNum=0;this.monsterNum=0;this.minMonsterWave=0;this.minMonsteNums=0}GuardCopyInfo.prototype.parser=function(wave,score,callBossNum,monsterNum,minMonsterWave,minMonsteNums){this.wave=wave;this.score=score;this.callBossNum=callBossNum;this.monsterNum=monsterNum;this.minMonsterWave=minMonsterWave;this.minMonsteNums=minMonsteNums};return GuardCopyInfo}();__reflect(GuardCopyInfo.prototype,"GuardCopyInfo");var GuardWeaponModel=function(_super){__extends(GuardWeaponModel,_super);function GuardWeaponModel(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.isShowSweep=false;_this.guardCopyInfo=new GuardCopyInfo;return _this}GuardWeaponModel.ins=function(){return _super.ins.call(this)};GuardWeaponModel.prototype.canChallenge=function(){return this.isOpen()&&GlobalConfig.GuardGodWeaponConf.dailyCount>this.challengeTimes};GuardWeaponModel.prototype.isOpen=function(){var ary=GlobalConfig.GuardGodWeaponConf.opencondition;var zsLv=ary[0];var openDay=ary[1];return UserZs.ins().lv>=zsLv&&GameServer.serverOpenDay+1>=openDay};GuardWeaponModel.prototype.getDesc=function(){var ary=GlobalConfig.GuardGodWeaponConf.opencondition;var zsLv=ary[0];var openDay=ary[1];return i18n("GuardWeaponModel_0",zsLv,openDay)};GuardWeaponModel.prototype.getMaxWaves=function(){var list=GlobalConfig.GGWWaveConf[UserZs.ins().lv]||{};return Object.keys(list).length};GuardWeaponModel.prototype.getWaveTime=function(wave){if(wave==0)return GlobalConfig.GuardGodWeaponConf.starDelayRsf;return GlobalConfig.GGWWaveConf[UserZs.ins().lv][wave].time};GuardWeaponModel.prototype.isCanCallBoss=function(){return this.getCallBossTimes()>0};GuardWeaponModel.prototype.getCallBossTimes=function(){var wave=this.guardCopyInfo.wave;var times=0;for(var i in GlobalConfig.GuardGodWeaponConf.sSummonLimit){if(wave>=+i){times+=GlobalConfig.GuardGodWeaponConf.sSummonLimit[i]}}return times-this.guardCopyInfo.callBossNum};GuardWeaponModel.prototype.callBossMoney=function(){var times=this.getCallBossTimes();return GlobalConfig.GuardGodWeaponConf.sSummonCost[times-1]};GuardWeaponModel.prototype.getKillWave=function(){return this.guardCopyInfo.wave};return GuardWeaponModel}(BaseClass);__reflect(GuardWeaponModel.prototype,"GuardWeaponModel");var GuardCallBossWin=function(_super){__extends(GuardCallBossWin,_super);function GuardCallBossWin(){var _this=_super.call(this)||this;_this.skinName="guardGodWeaponBossTips";_this.isTopLevel=true;return _this}GuardCallBossWin.prototype.open=function(){var time=GuardWeaponModel.ins().getCallBossTimes();var money=GuardWeaponModel.ins().callBossMoney();this.callTimesLable.text=""+time;if(time==0)money=0;this.zb0.text=""+money;this.time=time;this.money=money;this.addTouchEvent(this.closeBtn,this.closeWin);this.addTouchEvent(this.up,this.callBoss)};GuardCallBossWin.prototype.callBoss=function(){if(this.time>0){if(Actor.yb<this.money){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("GuardCallBossWin_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GuardCallBossWin_1"))}else{UserFb.ins().callGuardBoss()}}else{UserTips.ins().showTips(i18n("GuardCallBossWin_2"))}this.closeWin()};GuardCallBossWin.prototype.closeWin=function(){ViewManager.ins().close(this)};return GuardCallBossWin}(BaseEuiView);__reflect(GuardCallBossWin.prototype,"GuardCallBossWin");ViewManager.ins().reg(GuardCallBossWin,LayerManager.UI_Popup);var GuardLogsListRenderer=function(_super){__extends(GuardLogsListRenderer,_super);function GuardLogsListRenderer(){var _this=_super.call(this)||this;_this.skinName="UIshowDropNoticeSkin";return _this}GuardLogsListRenderer.prototype.dataChanged=function(){if(!this.data)return;var color=GlobalConfig.GuardGodWeaponConf.UIshowDrop[this.data.noticeId];color=color?color:16777215;var desc=GlobalConfig.GuardGodWeaponConf.UIshowDropNotice;desc=StringUtils.replace(desc,this.data.roleName,this.data.monsterName,i18n("GuardLogsListRenderer_0",color,this.data.itemName));this.showText.textFlow=TextFlowMaker.generateTextFlow1(desc)};return GuardLogsListRenderer}(BaseItemRender);__reflect(GuardLogsListRenderer.prototype,"GuardLogsListRenderer");var GuardQuitTips=function(_super){__extends(GuardQuitTips,_super);function GuardQuitTips(){var _this=_super.call(this)||this;_this.skinName="guardGodWeaponQuiteTip";_this.isTopLevel=true;return _this}GuardQuitTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.closeWin);this.addTouchEvent(this.BG,this.closeWin);this.addTouchEvent(this.up,this.onQuit)};GuardQuitTips.prototype.onQuit=function(){UserFb.ins().sendExitFb();this.closeWin()};GuardQuitTips.prototype.closeWin=function(){ViewManager.ins().close(this)};return GuardQuitTips}(BaseEuiView);__reflect(GuardQuitTips.prototype,"GuardQuitTips");ViewManager.ins().reg(GuardQuitTips,LayerManager.UI_Popup);var GuardRewardWin=function(_super){__extends(GuardRewardWin,_super);function GuardRewardWin(){var _this=_super.call(this)||this;_this.skinName="guardGodWeaponTishiSkin";_this.isTopLevel=true;return _this}GuardRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.closeWin);this.addTouchEvent(this.giveUp,this.closeWin)};GuardRewardWin.prototype.closeWin=function(){ViewManager.ins().close(this)};return GuardRewardWin}(BaseEuiView);__reflect(GuardRewardWin.prototype,"GuardRewardWin");ViewManager.ins().reg(GuardRewardWin,LayerManager.UI_Popup);var GuardWeaponPanel=function(_super){__extends(GuardWeaponPanel,_super);function GuardWeaponPanel(){return _super.call(this)||this}GuardWeaponPanel.prototype.childrenCreated=function(){this.itemList.itemRenderer=ItemBase;this.noticeList.itemRenderer=GuardLogsListRenderer};GuardWeaponPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnChallenge,this.challenge);this.addTouchEvent(this.help,this.onHelp);this.observe(UserFb.ins().postGuardWeaponLogs,this.updateLogs);this.observe(UserFb.ins().postGuardInfo,this.updateChallgeTimes);this.updateChallgeTimes();this.itemList.dataProvider=new eui.ArrayCollection(GlobalConfig.GuardGodWeaponConf.showReward[UserZs.ins().lv]);UserFb.ins().sendGuardWeaponLogs();this.btnChallenge.label=GuardWeaponModel.ins().isShowSweep?i18n("GuardWeaponPanel_0"):i18n("GuardWeaponPanel_1")};GuardWeaponPanel.prototype.updateChallgeTimes=function(){this.lbTime.text=(GlobalConfig.GuardGodWeaponConf.dailyCount-GuardWeaponModel.ins().challengeTimes).toString()};GuardWeaponPanel.prototype.onHelp=function(){ViewManager.ins().open(ZsBossRuleSpeak,28)};GuardWeaponPanel.prototype.challenge=function(){if(KfArenaSys.ins().isKFMacthing()){UserTips.ins().showCenterTips(i18n("GuardWeaponPanel_2"));return}if(!GuardWeaponModel.ins().isShowSweep)UserFb.ins().challengeGuard();else{if(GlobalConfig.GuardGodWeaponConf.dailyCount-GuardWeaponModel.ins().challengeTimes<=0){UserTips.ins().showCenterTips(i18n("GuardWeaponPanel_3"));return}ViewManager.ins().open(BuySpecialWin)}};GuardWeaponPanel.prototype.updateLogs=function(arr){this.noticeList.dataProvider=new eui.ArrayCollection(arr)};GuardWeaponPanel.prototype.close=function(){this.removeObserve()};return GuardWeaponPanel}(BaseView);__reflect(GuardWeaponPanel.prototype,"GuardWeaponPanel");var ShortcutCD=function(_super){__extends(ShortcutCD,_super);function ShortcutCD(radius){var _this=_super.call(this)||this;_this.setSize(radius);return _this}ShortcutCD.prototype.setSize=function(radius){this.radius=radius;this.graphics.clear();this.graphics.beginFill(0,.9);this.graphics.drawCircle(0,0,radius);this.graphics.endFill();this.maskShape=new egret.Shape;this.maskShape.graphics.clear();this.maskShape.graphics.beginFill(0,.7);this.maskShape.graphics.drawCircle(0,0,radius);this.maskShape.graphics.endFill();this.addChild(this.maskShape);this.mask=this.maskShape;this.visible=false};ShortcutCD.prototype.play=function(duration){duration*=1e3;if(duration>0){this.visible=true;this.duration=duration;this.startTime=egret.getTimer();egret.startTick(this.onUpdate,this)}};ShortcutCD.prototype.onUpdate=function(){var time=egret.getTimer();var useTime=time-this.startTime;if(useTime>=this.duration){this.stop();return false}this.maskShape.graphics.clear();this.maskShape.graphics.beginFill(0,.7);this.maskShape.graphics.moveTo(0,0);this.maskShape.graphics.lineTo(this.radius,0);this.maskShape.graphics.drawArc(0,0,this.radius,useTime/this.duration*2*Math.PI-Math.PI/2,2*Math.PI-Math.PI/2);this.maskShape.graphics.lineTo(0,0);this.maskShape.graphics.endFill();return false};ShortcutCD.prototype.stop=function(){this.visible=false;egret.stopTick(this.onUpdate,this);this.maskShape.graphics.clear()};return ShortcutCD}(egret.Sprite);__reflect(ShortcutCD.prototype,"ShortcutCD");var Guild=function(_super){__extends(Guild,_super);function Guild(){var _this=_super.call(this)||this;_this.guildID=0;_this.guildName="";_this.guildLv=0;_this._buildingLevels=[];_this.money=0;_this.notice="";_this.records=[];_this.guildListInfos=[];_this._guildMembers=[];_this.applyGuilds=[];_this._guillRoleSkillInfo=[];_this.guildTaskInfos=new eui.ArrayCollection;_this.isFirstGetMessageInfo=true;_this._memberSortType=0;_this.pageMax=1;_this.hasApply=false;_this.changeNameNum=0;_this.hasNewMsg=false;_this.sendToFireCount=[];_this.isAuto=1;_this.attrLimit=99999;_this._conCount=[];_this.sysId=PackageID.Guild;_this.regNetMsg(1,_this.postGuildInfo);_this.regNetMsg(2,_this.postGuildMembers);_this.regNetMsg(3,_this.postGuildList);_this.regNetMsg(4,_this.postGuildCreate);_this.regNetMsg(6,_this.postJoinGuild);_this.regNetMsg(7,_this.postApplyInfos);_this.regNetMsg(8,_this.postProcessJoin);_this.regNetMsg(9,_this.doChangeOffice);_this.regNetMsg(11,_this.postQuitGuild);_this.regNetMsg(12,_this.doUpdateGuildInfo);_this.regNetMsg(13,_this.postGuildMoney);_this.regNetMsg(14,_this.postChangeNotice);_this.regNetMsg(15,_this.doGuildSkillInfo);_this.regNetMsg(16,_this.postLearnGuildSkill);_this.regNetMsg(17,_this.postUpBuilding);_this.regNetMsg(18,_this.doPracticeGuildSkill);_this.regNetMsg(19,_this.doGuildTaskInfos);_this.regNetMsg(20,_this.doGuildTaskUpdate);_this.regNetMsg(22,_this.postManageList);_this.regNetMsg(23,_this.doManage);_this.regNetMsg(24,_this.postConCount);_this.regNetMsg(25,_this.postMyGuildInfo);_this.regNetMsg(26,_this.doGuildMessage);_this.regNetMsg(27,_this.postAllGuildMessage);_this.regNetMsg(28,_this.doAddGuildlimit);_this.regNetMsg(30,_this.postUpdateFire);_this.observe(GameLogic.ins().postEnterMap,_this.startCheckShow);_this.observe(GameLogic.ins().postGuildChange,_this.setGuild);_this.observe(_this.postGuildInfo,Activity.ins().updateActivity(8401));_this.observe(_this.postGuildMoney,Activity.ins().updateActivity(8401));_this.observe(_this.postUpBuilding,Activity.ins().updateActivity(8401));_this.observe(_this.postQuitGuild,Activity.ins().updateActivity(8401));_this.observe(_this.postQuitGuild,Activity.ins().updateActivity(8401));_this.observe(_this.postJoinGuild,Activity.ins().updateActivity(8401));_this.initData();return _this}Guild.prototype.initData=function(){if(!this.guildMessageInfoData)this.guildMessageInfoData=new eui.ArrayCollection;this.guildMessageInfoData.removeAll();this.isFirstGetMessageInfo=true};Guild.prototype.setGuild=function(arr){var id=arr[0],name=arr[1];if(this.guildID!=id){this.guildID=id;this.guildName=name;this.sendGuildInfo();if(this.guildID!=0){if(ViewManager.ins().isShow(GuildApplyWin)){ViewManager.ins().close(GuildApplyWin);ViewManager.ins().open(GuildMap)}}}};Guild.ins=function(){return _super.ins.call(this)};Guild.prototype.initLogin=function(){this.sendGuildInfo();this.sendMyGuildInfo()};Guild.prototype.getSkllInfoByIndex=function(index){return this._guillRoleSkillInfo[index]};Guild.prototype.getGuildMembersByIndex=function(index){return this._guildMembers[index]};Guild.prototype.getGuildTaskInfosByIndex=function(index){return this.guildTaskInfos.getItemAt(index)};Guild.prototype.getBuildingLevels=function(index){if(index===void 0){index=-1}return index==-1?this._buildingLevels:this._buildingLevels[index]};Guild.prototype.getConCount=function(index){if(index===void 0){index=-1}return index==-1?this._conCount:this._conCount[index]};Guild.prototype.sendGuildInfo=function(){this.sendBaseProto(1)};Guild.prototype.postGuildInfo=function(bytes){this._buildingLevels=[];if(bytes.readByte()==1){this.guildID=bytes.readUnsignedInt();this.guildName=bytes.readString();var len=bytes.readUnsignedByte();for(var index=0;index<len;index++){this._buildingLevels.push(bytes.readUnsignedByte())}this.money=bytes.readInt();this.notice=bytes.readString();this.doAddGuildlimit(bytes);this.guildLv=this._buildingLevels[0];this.sendGuildMembers();this.sendGuildSkillInfo();this.postUpdateFire(bytes);this.changeNameNum=bytes.readInt();return[this.guildID,this.guildName]}return false};Guild.prototype.sendGuildMembers=function(){this.sendBaseProto(2)};Guild.prototype.postGuildMembers=function(bytes){var len=bytes.readInt();this._guildMembers=[];for(var index=0;index<len;index++){var info=new GuildMemberInfo;info.roleID=bytes.readInt();info.name=bytes.readString();info.office=bytes.readUnsignedByte();info.job=bytes.readUnsignedByte();info.sex=bytes.readUnsignedByte();info.vipLevel=bytes.readInt();info.monthCard=bytes.readUnsignedByte();info.contribution=bytes.readInt();info.curContribution=bytes.readInt();info.attack=bytes.readDouble();info.downTime=bytes.readUnsignedInt();info.level=bytes.readInt();info.zsLevel=bytes.readInt();this._guildMembers.push(info);if(info.roleID==Actor.actorID){Guild.ins().myOffice=info.office}}};Guild.prototype.sendGuildList=function(page,num){this.sendBaseProto(3)};Guild.prototype.postGuildList=function(bytes){this.guildListInfos=[];var len=bytes.readInt();for(var i=0;i<len;i++){var info=new GuildListInfo;info.guildRank=i+1;info.guildID=bytes.readUnsignedInt();info.guildLevel=bytes.readUnsignedByte();info.commentLv=bytes.readUnsignedByte();info.guildMember=bytes.readInt();info.guildName=bytes.readString();info.guildPresident=bytes.readString();info.attr=bytes.readInt();this.guildListInfos.push(info)}};Guild.prototype.sendGuildCreate=function(id,name){var bytes=this.getBytes(4);bytes.writeByte(id);bytes.writeString(name);this.sendToServer(bytes)};Guild.prototype.postGuildCreate=function(bytes){var result=bytes.readUnsignedByte();if(result==0){this.guildID=bytes.readUnsignedInt();ViewManager.ins().close(GuildCreateWin);ViewManager.ins().close(GuildApplyWin);ViewManager.ins().open(GuildMap);UserTips.ins().showTips(i18n("Guild_0"));this.sendGuildInfo();return true}else if(result==1){UserTips.ins().showCenterTips(i18n("Chat_9"))}return false};Guild.prototype.sendQuitGuild=function(){this.sendBaseProto(5)};Guild.prototype.sendJoinGuild=function(guildID){var bytes=this.getBytes(6);bytes.writeInt(guildID);this.sendToServer(bytes)};Guild.prototype.postJoinGuild=function(bytes){this.hasApply=true};Guild.prototype.sendApplyInfos=function(){this.sendBaseProto(7)};Guild.prototype.postApplyInfos=function(bytes){var len=bytes.readInt();var applyPlayers=[];for(var index=0;index<len;index++){var info=new GuildApplyInfo;info.roleID=bytes.readInt();info.vipLevel=bytes.readInt();info.job=bytes.readUnsignedByte();info.sex=bytes.readUnsignedByte();info.attack=bytes.readDouble();info.name=bytes.readString();applyPlayers.push(info)}this.hasApply=len>0;return applyPlayers};Guild.prototype.sendProcessJoin=function(joinId,b){var bytes=this.getBytes(8);bytes.writeInt(joinId);bytes.writeByte(b);this.sendToServer(bytes)};Guild.prototype.postProcessJoin=function(bytes){var guildID=bytes.readUnsignedInt();var result=bytes.readUnsignedByte();var applyGuilds=this.applyGuilds;var index=applyGuilds.indexOf(guildID);if(index!=-1&&result==0){applyGuilds.splice(index,1)}if(result==1)return true;return false};Guild.prototype.sendChangeOffice=function(roleID,guildOffice){var bytes=this.getBytes(9);bytes.writeInt(roleID);bytes.writeByte(guildOffice);this.sendToServer(bytes)};Guild.prototype.doChangeOffice=function(bytes){var roleID=bytes.readInt();var newOffice=bytes.readUnsignedByte();for(var index=0;index<this._guildMembers.length;index++){var element=this.getGuildMembersByIndex(index);if(element.roleID==roleID){element.office=newOffice;return}}};Guild.prototype.sendDemise=function(){this.sendBaseProto(10)};Guild.prototype.sendKick=function(roleID){var bytes=this.getBytes(11);bytes.writeInt(roleID);this.sendToServer(bytes)};Guild.prototype.postQuitGuild=function(bytes){var roleID=bytes.readInt();if(roleID==Actor.actorID){this.clearGuildInfo();ViewManager.ins().close(GuildWin);ViewManager.ins().close(GuildMap);return true}return false};Guild.prototype.doUpdateGuildInfo=function(bytes){var flag=bytes.readUnsignedByte();switch(flag){case 1:break;case 2:this.sendGuildInfo();break;case 3:this.sendGuildMembers();break;case 4:break;case 5:this.sendApplyInfos();break;case 6:break}};Guild.prototype.sendCon=function(type){var bytes=this.getBytes(13);bytes.writeInt(type);this.sendToServer(bytes)};Guild.prototype.postGuildMoney=function(bytes){this.money=bytes.readInt()};Guild.prototype.sendChangeNotice=function(text){var bytes=this.getBytes(14);bytes.writeString(text);this.sendToServer(bytes)};Guild.prototype.postChangeNotice=function(bytes){var resule=bytes.readUnsignedByte();if(resule==0){this.notice=bytes.readString()}else if(resule==1){this.notice="";UserTips.ins().showCenterTips(i18n("Chat_9"))}};Guild.prototype.sendGuildSkillInfo=function(){this.sendBaseProto(15)};Guild.prototype.doGuildSkillInfo=function(bytes){var len=bytes.readUnsignedByte();this._guillRoleSkillInfo=[];for(var index=0;index<len;index++){var roleSkillInfo=new GuildRoleSkillInfo;var len2=bytes.readUnsignedByte();for(var j=0;j<len2;j++){var skillInfo=new GuildSkillInfo;skillInfo.level=bytes.readInt();roleSkillInfo.guildSkillInfo.push(skillInfo)}len2=bytes.readUnsignedByte();for(var k=0;k<len2;k++){var element=len2[k];var skillInfo=new GuildSkillInfo;skillInfo.level=bytes.readInt();skillInfo.exp=bytes.readInt();roleSkillInfo.practiceSkillInfo.push(skillInfo)}this._guillRoleSkillInfo.push(roleSkillInfo)}this.postGuildSkillInfo()};Guild.prototype.postGuildSkillInfo=function(){};Guild.prototype.sendLearnGuildSkill=function(roleID,skillID){var bytes=this.getBytes(16);bytes.writeShort(roleID);bytes.writeByte(skillID);this.sendToServer(bytes)};Guild.prototype.postLearnGuildSkill=function(bytes){var roleID=bytes.readShort();var skillID=bytes.readUnsignedByte();this.getSkllInfoByIndex(roleID).guildSkillInfo[skillID-1].level=bytes.readInt();this.postGuildSkillInfo();UserTips.ins().showTips(i18n("Guild_1"))};Guild.prototype.sendPracticeGuildSkill=function(roleID,skillID){var bytes=this.getBytes(18);bytes.writeShort(roleID);bytes.writeByte(skillID);this.sendToServer(bytes)};Guild.prototype.doPracticeGuildSkill=function(bytes){var roleID=bytes.readShort();var skillID=bytes.readUnsignedByte();this.getSkllInfoByIndex(roleID).practiceSkillInfo[skillID-1].level=bytes.readInt();this.getSkllInfoByIndex(roleID).practiceSkillInfo[skillID-1].exp=bytes.readInt();var add=bytes.readInt();this.postGuildSkillInfo();UserTips.ins().showTips(i18n("Guild_2",add))};Guild.prototype.sendUpBuilding=function(buildType){var bytes=this.getBytes(17);bytes.writeByte(buildType);this.sendToServer(bytes)};Guild.prototype.postUpBuilding=function(bytes){var type=bytes.readByte();this._buildingLevels[type-1]=bytes.readByte();this.guildLv=this._buildingLevels[0]};Guild.prototype.doGuildTaskInfos=function(bytes){this.guildTaskInfos.removeAll();this.initTaskInfos();var source=[];var len=bytes.readInt();for(var index=0;index<len;index++){var element=new GuildTaskInfo;element.taskID=bytes.readInt();element.param=bytes.readInt();element.state=bytes.readInt();element.stdTask=GlobalConfig.GuildTaskConfig[element.taskID];this.guildTaskInfos.addItem(element)}this.updateTaskList()};Guild.prototype.postGuildTaskUpdate=function(){};Guild.prototype.doGuildTaskUpdate=function(bytes){var id=bytes.readInt();var param=bytes.readInt();var state=bytes.readInt();for(var i=0;i<this.guildTaskInfos.length;i++){var element=this.guildTaskInfos.getItemAt(i);if(element&&element.taskID==id){element.param=param;element.state=state;break}}this.updateTaskList()};Guild.prototype.updateTaskList=function(){var source=this.guildTaskInfos.source;for(var i=source.length-1;i>=0;i--){if(source[i].stdTask.type==0)source.splice(i,1)}source.sort(this.taskInfosSortFunc);this.guildTaskInfos.replaceAll(source);this.postGuildTaskUpdate()};Guild.prototype.sendGetTaskAward=function(taskID){var bytes=this.getBytes(21);bytes.writeByte(taskID);this.sendToServer(bytes)};Guild.prototype.sendManageList=function(){this.sendBaseProto(22)};Guild.prototype.postManageList=function(bytes){this.records=[];var count=bytes.readInt();for(var i=0;i<count;i++){this.parserManage(bytes)}};Guild.prototype.doManage=function(bytes){};Guild.prototype.sendConCount=function(){this.sendBaseProto(24)};Guild.prototype.postConCount=function(bytes){var count=bytes.readUnsignedByte();for(var i=0;i<count;i++){this._conCount[i]=bytes.readInt()}};Guild.prototype.sendMyGuildInfo=function(){this.sendBaseProto(25)};Guild.prototype.postMyGuildInfo=function(bytes){this.myCon=bytes.readInt();this.myTotalCon=bytes.readInt();this.myOffice=bytes.readUnsignedByte()};Guild.prototype.sendGuildMessage=function(str){var bytes=this.getBytes(26);if(ChannelMgr.ins().isQQZoneChannel()){var isYearvip=QzoneSys.ins().isYellowYearVip()?1:0;str=str+QzoneSys.MARK_QZVIP+QzoneSys.ins().getYellowViplv()+QzoneSys.MARK_QZYEAR+isYearvip}if(ChannelMgr.ins().isQQDaTingChannel()){var isYearvip=QQDaTingSys.ins().isDaTYearVip()?1:0;var isHighvip=QQDaTingSys.ins().isDaTHighVip()?1:0;str=str+QQDaTingSys.MARK_DATVIP+QQDaTingSys.ins().getDaTViplv()+QQDaTingSys.MARK_DATHIGHVIP+isHighvip+QQDaTingSys.MARK_DATYEAR+isYearvip}bytes.writeString(str);this.sendToServer(bytes);ReportData.getIns().reportChat(str,6)};Guild.prototype.doGuildMessage=function(bytes){var result=bytes.readByte();if(result==1){UserTips.ins().showDownTips(i18n("Chat_9"))}else{var element=new GuildMessageInfo;element.parserMessage(bytes);if(Friends.ins().indexOfBlackList(element.roleId)==-1){if(this.guildMessageInfoData.length>=50){var msg=this.guildMessageInfoData.removeItemAt(0);Chat.ins().removeAllChatMsg(msg)}this.guildMessageInfoData.addItem(element);Chat.ins().insertAllChatMsg(element);Chat.ins().postNewChatMsg(element);if(element.type==1&&element.roleId!=Actor.actorID){this.hasNewMsg=true}}if(element.type==1){var msg=new ChatInfoData(null);msg.name=element.name;msg.type=7;msg.str=element.content;Chat.ins().postNewChatMsg(msg)}if(element.type==2){this.postGuildBossHaveRelive(true,element.content)}if(element.type==3&&element.content.indexOf(i18n("Guild_19"))!=-1){}else if(SysSetting.ins().getBool(SysSetting.SHOW_DANMU)){var channel="";var name_8="";var self_8=this;if(element.office>=0){channel=i18n("ChatGuildItemRender_1")+GuildLanguage.guildOfficeColor[element.office]+"&T:["+GuildLanguage.guildOffice[element.office]+"]|"}if(element.name){name_8=i18n("ChatGuildItemRender_2")+element.name+"]|"}ViewManager.ins().open(FlyingWorldView).showNotice(channel+name_8+element.content)}}};Guild.prototype.postGetNewGuildMessage=function(ele){return ele};Guild.prototype.postGuildBossHaveRelive=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}return params};Guild.prototype.sendAllGuildMessage=function(){if(!this.isFirstGetMessageInfo){return}this.isFirstGetMessageInfo=false;this.sendBaseProto(27)};Guild.prototype.postAllGuildMessage=function(bytes){this.guildMessageInfoData.removeAll();var len=bytes.readInt();for(var index=0;index<len;index++){var element=new GuildMessageInfo;element.parserMessage(bytes);if(Friends.ins().indexOfBlackList(element.roleId)==-1){this.guildMessageInfoData.addItem(element);Chat.ins().insertAllChatMsg(element)}}if(this.guildMessageInfoData.length){Chat.ins().postNewChatMsg(this.guildMessageInfoData.getItemAt(this.guildMessageInfoData.length-1))}};Guild.prototype.sendAddGuildLimit=function(auto,attr){var bytes=this.getBytes(28);bytes.writeByte(auto);bytes.writeInt(attr);this.sendToServer(bytes)};Guild.prototype.doAddGuildlimit=function(bytes){this.isAuto=bytes.readUnsignedByte();this.attrLimit=bytes.readInt()};Guild.prototype.sendToFire=function(count,itemCount){var bytes=this.getBytes(30);bytes.writeShort(count);this.sendToServer(bytes);this.sendToFireCount.push([count,itemCount])};Guild.prototype.postUpdateFire=function(bytes){this.fireDic=this.fireDic||{};var fireLvl=bytes.readShort();var fireVal=bytes.readInt();var isUpdate=this.fireDic.fireLvl!=fireLvl||this.fireDic.fireVal!=fireVal;this.fireDic.fireLvl=fireLvl;this.fireDic.fireVal=fireVal;if(isUpdate){var conf=GlobalConfig.GuildConfig;var item=UserBag.ins().getBagItemById(conf.bonfireItem);var count=item?item.count:0;for(var i=0;i<this.sendToFireCount.length;i++){if(count==this.sendToFireCount[i][1]){while(i>=0){var v=this.sendToFireCount.shift()[0];UserTips.ins().showCenterTips(i18n("Guild_3",5*v,30*v));i-=1}break}}}};Guild.prototype.sendGuildChangeName=function(nameStr){var bytes=this.getBytes(31);bytes.writeString(nameStr);this.sendToServer(bytes)};Guild.prototype.parserManage=function(bytes){if(!this.records)return;var str="";var time=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(bytes.readUnsignedInt())*.001,8);time=StringUtils.complementByChar(time,16);var type=bytes.readUnsignedByte();var param1=bytes.readInt();var param2=bytes.readInt();var param3=bytes.readInt();var name1=bytes.readString();var name2=bytes.readString();switch(type){case 1:str=time+"  ["+name1+i18n("Guild_4");break;case 2:str=time+"  ["+name1+i18n("Guild_5");break;case 3:str=time+"  ["+name1+i18n("Guild_6");break;case 4:str=time+"  ["+name1+i18n("Guild_7");break;case 5:str=time+"  ["+name1+i18n("Guild_8");break;case 6:str=time+"  ["+name1+i18n("Guild_9");break;case 7:str=time+"  ["+name1+i18n("Guild_10")+param2+(param1==2?i18n("Guild_11"):i18n("Guild_12"));break;case 8:str=time+"  ["+name1+i18n("Guild_13")+GlobalConfig.GuildConfig.buildingNames[param1-1]+i18n("Guild_14")+param2+i18n("Guild_15");break;case 9:var config=GlobalConfig.ItemConfig[param1];str=i18n("Guild_16",time,name1,ItemConfig.getQualityColor(config),config.name);break;case 10:str=time+i18n("Guild_17");break;case 11:str=time+"  ["+name1+i18n("Guild_18");break}this.records.unshift(str)};Guild.prototype.hasApplys=function(){return this.myOffice>=GuildOffice.GUILD_FUBANGZHU&&this.hasApply};Guild.prototype.clearGuildInfo=function(){this.guildID=0;this.guildName="";this.guildListInfos=[];this._guildMembers=[];this.applyGuilds=[];this.pageMax=1;this.hasNewMsg=false;this.guildMessageInfoData.removeAll();this.guildMessageInfoData.refresh()};Guild.prototype.removeMsgWithId=function(userId){var source=[];for(var i=0;i<this.guildMessageInfoData.length;i++){var msgInfo=this.guildMessageInfoData.getItemAt(i);if(msgInfo.roleId!=userId){source.push(msgInfo)}}this.guildMessageInfoData.source=source;this.guildMessageInfoData.refresh()};Guild.prototype.initTaskInfos=function(){if(this.guildTaskInfos!=null){return}var infoList=[];var dp=GlobalConfig.GuildTaskConfig;for(var key in dp){if(dp.hasOwnProperty(key)){var gtc=dp[key];var element=new GuildTaskInfo;element.taskID=gtc.id;element.param=0;element.state=0;element.stdTask=gtc;infoList.push(element)}}this.guildTaskInfos.replaceAll(infoList)};Guild.prototype.taskInfosSortFunc=function(aConfig,bConfig){if(aConfig.state==bConfig.state){if(aConfig.taskID<bConfig.taskID)return-1;if(aConfig.taskID>bConfig.taskID)return 1;return 0}if(aConfig.state==2)return 1;if(bConfig.state==2)return-1;if(aConfig.state!=2&&bConfig.state!=2){if(aConfig.taskID<bConfig.taskID)return-1;if(aConfig.taskID>bConfig.taskID)return 1}return 0};Guild.prototype.getMemberNum=function(){return this._guildMembers.length};Guild.prototype.getGuildMembers=function(sortType){if(sortType==0||this._memberSortType==sortType)return this._guildMembers;if(sortType==1)return this._guildMembers.sort(this.memberSortFunc);if(sortType==2)return this._guildMembers.sort(this.memberSortFunc2);return this._guildMembers};Guild.prototype.getOfficeNum=function(office){var len=this._guildMembers.length;var num=0;for(var index=0;index<len;index++){var element=this._guildMembers[index];if(element.office==office)num++}return num};Guild.prototype.canAppointFHZ=function(){return this.getOfficeNum(GuildOffice.GUILD_FUBANGZHU)<GlobalConfig.GuildConfig.posCounts[this.guildLv-1][1]};Guild.prototype.memberSortFunc=function(aInfo,bInfo){if(aInfo.office>bInfo.office)return-1;if(aInfo.office<bInfo.office)return 1;if(aInfo.office==bInfo.office){if(aInfo.contribution==bInfo.contribution)return 0;return aInfo.contribution>bInfo.contribution?-1:1}return 0};Guild.prototype.memberSortFunc2=function(aInfo,bInfo){if(aInfo.curContribution==bInfo.curContribution)return 0;return aInfo.curContribution>bInfo.curContribution?-1:1};Guild.prototype.checkIsInGuild=function(id){for(var k in this._guildMembers){var info=this._guildMembers[k];if(info.roleID==id){return true}}return false};Guild.prototype.startCheckShow=function(){if(GuildWar.ins().getModel().checkinAppoint()){ViewManager.ins().closeTopLevel();ViewManager.ins().open(GuildWarUiInfo)}else{ViewManager.ins().close(GuildWarUiInfo)}};Guild.prototype.isUpGradeBuilding=function(){if(Guild.ins().myOffice<GuildOffice.GUILD_FUBANGZHU){return false}var buildings=[GuildBuilding.GUILD_HALL,GuildBuilding.GUILD_LIANGONGFANG];for(var i=0;i<buildings.length;i++){var type=buildings[i];var curLevel=Guild.ins().getBuildingLevels(type-1)||0;var glc=GlobalConfig.GuildLevelConfig[type];var maxLevel=0;var dp=null;var dpNext=null;var nextMoney=0;for(var key in glc){if(glc.hasOwnProperty(key)){var element=glc[key];maxLevel=element.level>maxLevel?element.level:maxLevel;if(element.level==curLevel)dp=element;if(element.level==curLevel+1)dpNext=element}}if(dp||dpNext||type==GuildBuilding.GUILD_LIANGONGFANG){if(dpNext&&curLevel<maxLevel){nextMoney=dpNext.upFund}}if(type==GuildBuilding.GUILD_HALL&&curLevel>=maxLevel){continue}else if(type!=GuildBuilding.GUILD_HALL&&curLevel>=Guild.ins().guildLv){continue}else if(Guild.ins().money<nextMoney){continue}return true}return false};Guild.prototype.isOpen=function(){return(Actor.level||0)>=60};Guild.prototype.isInGuild=function(){return this.guildID?true:false};return Guild}(BaseSystem);__reflect(Guild.prototype,"Guild");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.guild=Guild.ins.bind(Guild)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GuildBoss=function(_super){__extends(GuildBoss,_super);function GuildBoss(){var _this=_super.call(this)||this;_this.wait=false;_this.leftTimes=0;_this.canChallenge=0;_this.isKilled=0;_this.passId=0;_this.challengeTime=0;_this.bossHP=0;_this.otherGuildId=0;_this.otherGuildName="";_this.otherGuildBossHp=0;_this.winnerId=0;_this.guildRankDic=[];_this.guildPersonRankDic=[];_this.guildBossState=0;_this.sysId=PackageID.GuildBoss;_this.regNetMsg(1,_this.postGuildBossInfoChange);_this.regNetMsg(2,_this.doRewardRecord);_this.regNetMsg(3,_this.postGuildBossDetailChange);_this.regNetMsg(4,_this.doGuildChallengeBack);_this.regNetMsg(5,_this.postGuildBossRankInfoChange);return _this}GuildBoss.ins=function(){return _super.ins.call(this)};GuildBoss.prototype.postGuildBossInfoChange=function(bytes){this.leftTimes=bytes.readInt();var count=bytes.readUnsignedByte();this.passRecord=[];for(var i=0;i<count;i++){this.passRecord[bytes.readByte()]=bytes.readByte()}this.canChallenge=bytes.readByte()};GuildBoss.prototype.doRewardRecord=function(bytes){this.isKilled=bytes.readByte();var count=bytes.readInt();var rewards=[];for(var i=0;i<count;i++){var item=new RewardData;item.parser(bytes);rewards.push(item)}TimerManager.ins().doTimer(800,1,function(){ResultManager.ins().create(GameMap.fbType,1,rewards,i18n("GuildBoss_1"))},this)};GuildBoss.prototype.postGuildBossDetailChange=function(bytes){this.passId=bytes.readInt();var time=bytes.readInt();this.challengeTime=GameServer.serverTime+time*1e3;this.bossHP=bytes.readDouble();this.otherGuildId=bytes.readInt();this.otherGuildName=bytes.readString();this.otherGuildBossHp=bytes.readDouble();this.winnerId=bytes.readInt();clearTimeout(this.wait_timer);this.wait=false};GuildBoss.prototype.doGuildChallengeBack=function(bytes){this.guildBossState=bytes.readInt();if(this.guildBossState==0){this.leftTimes--;this.postChallengeSuccess()}else if(this.guildBossState==5){this.sendGetBossInfo()}clearTimeout(this.wait_timer);this.wait=false};GuildBoss.prototype.postGuildBossRankInfoChange=function(bytes){var id=bytes.readInt();var count=bytes.readByte();this.guildRankDic[id]=[];this.guildPersonRankDic[id]=[];for(var i=0;i<count;i++){var obj=new guildBossRankData;obj.name=bytes.readString();obj.damage=bytes.readDouble();obj.rank=i+1;this.guildRankDic[id].push(obj)}count=bytes.readInt();for(var i=0;i<count;i++){var obj=new guildBossRankData;obj.name=bytes.readString();obj.damage=bytes.readDouble();obj.devote=bytes.readInt();obj.rank=i+1;this.guildPersonRankDic[id].push(obj)}};GuildBoss.prototype.sendChallengeBoss=function(type){var _this=this;if(this.wait){UserTips.ins().showTips(i18n("GuildBoss_2"));clearTimeout(this.wait_timer);this.wait_timer=setTimeout(function(){_this.wait=false},1e3);return}this.wait=true;var b=UserFb.ins().checkInFB(false);if(b){console.log("user in fb");return}var bytes=this.getBytes(1);bytes.writeByte(type);this.sendToServer(bytes)};GuildBoss.prototype.sendGetBossReward=function(id){var bytes=this.getBytes(2);bytes.writeInt(id);this.sendToServer(bytes)};GuildBoss.prototype.sendGetBossInfo=function(){this.sendBaseProto(3)};GuildBoss.prototype.sendGetBossRankInfo=function(id){var bytes=this.getBytes(5);bytes.writeInt(id);this.sendToServer(bytes)};GuildBoss.prototype.getBossRewardState=function(){for(var k in GuildBoss.ins().passRecord){if(GuildBoss.ins().passRecord[k]==1){return true}}return false};GuildBoss.prototype.getBossChallenge=function(){if(!this.isOpen())return false;if(GuildBoss.ins().leftTimes<=0)return false;for(var k in GuildBoss.ins().passRecord){if(GuildBoss.ins().passRecord[k]==0){return true}}return false};GuildBoss.prototype.isOpen=function(){return new Date(GameServer.serverTime).getDay()!=GlobalConfig.GuildBossConfig.notOpenDayOfWeek};GuildBoss.prototype.postChallengeSuccess=function(){};return GuildBoss}(BaseSystem);__reflect(GuildBoss.prototype,"GuildBoss");var guildBossRankData=function(){function guildBossRankData(){this.name="";this.damage=0;this.rank=0;this.devote=0}return guildBossRankData}();__reflect(guildBossRankData.prototype,"guildBossRankData");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.guildboss=GuildBoss.ins.bind(GuildBoss)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GuildFB=function(_super){__extends(GuildFB,_super);function GuildFB(){var _this=_super.call(this)||this;_this.bossTimer=1;_this.sysId=PackageID.GuildFB;_this.regNetMsg(1,_this.doGuildFBInfo);_this.regNetMsg(2,_this.doGuildFBRankInfo);_this.regNetMsg(3,_this.doGuildFBMaxGKInfo);_this.regNetMsg(4,_this.doGuildFBGKInfo);_this.regNetMsg(5,_this.doGuildFBChangeInfo);_this.regNetMsg(6,_this.doGuildFBRewardInfo);_this.regNetMsg(7,_this.postGuildFBBossInfo);_this.regNetMsg(8,_this.postGuildFBBossTimerEndInfo);_this.regNetMsg(9,_this.postGuildFBSweepEnd);return _this}GuildFB.ins=function(){return _super.ins.call(this)};GuildFB.prototype.getGkDatas=function(index){if(index===void 0){index=-1}return index==-1?this._gkDatas:this._gkDatas[index]};GuildFB.prototype.doGuildFBInfo=function(bytes){this.fbNum=bytes.readShort();this.sweep=bytes.readByte();this.sweepNum=bytes.readShort();this.tongguan=bytes.readByte();this.zuwei=bytes.readByte();this.nextFb=bytes.readByte();this.postGuildFubenInfo()};GuildFB.prototype.postGuildFubenInfo=function(){};GuildFB.prototype.doGuildFBRankInfo=function(bytes){this.rankDatas=[];var len=bytes.readByte();for(var i=0;i<len;i++){var info=new GuildFBRankInfo;info.rank=i+1;info.name=bytes.readString();info.guanka=bytes.readShort();this.rankDatas.push(info)}this.postGuildFubenInfo()};GuildFB.prototype.doGuildFBMaxGKInfo=function(bytes){this.isMaxGK=bytes.readByte();if(this.isMaxGK!=0){this.maxName=bytes.readString();this.maxCareer=bytes.readByte();this.maxSex=bytes.readByte();this.maxNum=bytes.readShort();this.maxZhuwei=bytes.readByte()}this.postGuildFubenInfo()};GuildFB.prototype.doGuildFBGKInfo=function(bytes){this.fbgkNum=bytes.readShort();var len=bytes.readByte();this._gkDatas=[];for(var i=0;i<len;i++){this._gkDatas.push(bytes.readString())}this.postGuildFubenInfo();this.postGuildFubenRoleInfo()};GuildFB.prototype.postGuildFubenRoleInfo=function(){};GuildFB.prototype.doGuildFBChangeInfo=function(bytes){this.change=bytes.readByte();if(ViewManager.ins().getView(GuildActivityWin)&&ViewManager.ins().getView(GuildActivityWin).isShow()){if(this.change==1){this.sendGuildFBRankInfo()}else if(this.change==2){this.sendGuildFBMaxGKInfo()}this.change=0}};GuildFB.prototype.doGuildFBRewardInfo=function(bytes){this.rewardNum=bytes.readShort();this.rewardRoleNum=bytes.readShort();this.postGuildFubenInfo()};GuildFB.prototype.postGuildFBBossInfo=function(bytes){this.bossGKNum=bytes.readShort()};GuildFB.prototype.postGuildFBBossTimerEndInfo=function(bytes){this.bossGKNum=bytes.readShort();this.bossTimer=DateUtils.formatMiniDateTime(bytes.readInt())};GuildFB.prototype.postGuildFBSweepEnd=function(bytes){};GuildFB.prototype.sendGuildFBRankInfo=function(){this.sendBaseProto(2)};GuildFB.prototype.sendGuildFBMaxGKInfo=function(){this.sendBaseProto(3)};GuildFB.prototype.sendGuildFBGKRoleInfo=function(num){var bytes=this.getBytes(4);bytes.writeShort(num);this.sendToServer(bytes)};GuildFB.prototype.sendGuildFBChallange=function(){this.sendBaseProto(5)};GuildFB.prototype.sendGuildFBSweep=function(){this.sendBaseProto(6)};GuildFB.prototype.sendGuildFBZhuwei=function(){this.sendBaseProto(7)};GuildFB.prototype.sendGuildFBReward=function(){this.sendBaseProto(8)};GuildFB.prototype.hasbtn=function(){return GameServer.serverOpenDay>0&&(this.sweep==0&&this.fbNum>0||this.tongguan==0&&this.rewardNum>0)};Object.defineProperty(GuildFB.prototype,"bossTimerEnd",{get:function(){return this.bossTimer+egret.getTimer()},enumerable:true,configurable:true});return GuildFB}(BaseSystem);__reflect(GuildFB.prototype,"GuildFB");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.guildfb=GuildFB.ins.bind(GuildFB)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GuildRedPoint=function(_super){__extends(GuildRedPoint,_super);function GuildRedPoint(){var _this=_super.call(this)||this;_this.hanghui=false;_this.sendReward=false;_this.redBag=false;_this.sczb=false;_this.hhdt=false;_this.gldt=false;_this.hhBoss=false;_this.dayReward=false;_this.guildFire=false;_this.roleTabs={};_this.roleSkillTabs={};_this.liangongRed=false;_this.roleTabs={};_this.roleSkillTabs={};_this.associated(_this.postDayReward,GuildWar.ins().postDayRewardInfo);_this.associated(_this.postSczb,_this.postDayReward,_this.postRedBag);_this.associated(_this.postSendReward,GuildWar.ins().postAssignsReward,GuildWar.ins().postSendRewardSuccess);_this.associated(_this.postRedBag,GuildWar.ins().postRedBagInfo);_this.associated(_this.postHhdt,Guild.ins().postApplyInfos,Guild.ins().postJoinGuild,Guild.ins().postMyGuildInfo,_this.postLianGongRedPoint,_this.postGldt);_this.associated(_this.postGldt,Guild.ins().postUpBuilding,Guild.ins().postManageList,Guild.ins().postGuildMoney,Guild.ins().postMyGuildInfo);_this.associated(_this.postHanghui,_this.postSendReward,_this.postSczb,_this.postHhdt,_this.postGuildFire,_this.postLianGongRedPoint,Actor.ins().postLevelChange,GuildFB.ins().postGuildFubenInfo,GuildRobber.ins().postGuildRobberInfo,GuildWar.ins().postGuildWarStarInfo,Guild.ins().postGuildInfo,_this.postHanghuiBoss);_this.associated(_this.postHanghuiBoss,GuildBoss.ins().postGuildBossDetailChange,GuildBoss.ins().postGuildBossInfoChange);_this.associated(_this.postGuildFire,UserBag.ins().postItemAdd,UserBag.ins().postItemDel,Guild.ins().postUpdateFire);_this.associated(_this.postLianGongRedPoint,Guild.ins().postLearnGuildSkill,Guild.ins().postUpBuilding,Guild.ins().postGuildSkillInfo,Guild.ins().postMyGuildInfo);return _this}GuildRedPoint.prototype.postGuildFire=function(){var oldv=this.guildFire;var conf=GlobalConfig.GuildConfig;var item=UserBag.ins().getBagItemById(conf.bonfireItem);if(item&&item.count>=(conf.bonfirecaution||1)){this.guildFire=true}else{this.guildFire=false}return this.guildFire!=oldv};GuildRedPoint.prototype.postHhdt=function(){var oldv=this.hhdt;this.hhdt=Guild.ins().hasApplys()||this.gldt;return this.hhdt!=oldv};GuildRedPoint.prototype.postGldt=function(){var oldv=this.gldt;this.gldt=Guild.ins().isUpGradeBuilding();return this.gldt!=oldv};GuildRedPoint.prototype.postDayReward=function(){var oldv=this.dayReward;this.dayReward=GuildWar.ins().getModel().canGetDay&&!GuildWar.ins().getModel().getDayReward;return this.dayReward!=oldv};GuildRedPoint.prototype.postSczb=function(){var oldv=this.sczb;this.sczb=this.dayReward||this.redBag;return this.sczb!=oldv};GuildRedPoint.prototype.postRedBag=function(){var oldv=this.redBag;this.redBag=GuildWar.ins().getModel().isHaveRedBag();return this.redBag!=oldv};GuildRedPoint.prototype.postSendReward=function(){var oldv=this.sendReward;this.sendReward=GuildWar.ins().getModel().canSendReward;return this.sendReward!=oldv};GuildRedPoint.prototype.postHanghui=function(){var oldv=this.hanghui;var t=false;if(GuildFB.ins().hasbtn())t=true;if((Guild.ins().guildID==undefined||Guild.ins().guildID==0)&&Actor.level>69)t=true;this.hanghui=t||this.sendReward||this.redBag||this.sczb||this.hhBoss||this.guildFire||this.liangongRed||GuildWar.ins().getModel().isWatStart||this.hhdt;return this.hanghui!=oldv};GuildRedPoint.prototype.postHanghuiBoss=function(){var oldv=this.hhBoss;this.hhBoss=GuildBoss.ins().getBossRewardState()||GuildBoss.ins().getBossChallenge();return this.hhBoss!=oldv};GuildRedPoint.prototype.postLianGongRedPoint=function(){this.liangongRed=false;var tab=GuildRedPoint.Tab_LianGong;var len=SubRoles.ins().subRolesLen;for(var roleIndex=0;roleIndex<len;roleIndex++){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);if(!role)continue;var roleSkillInfo=Guild.ins().getSkllInfoByIndex(role.index);if(!roleSkillInfo)continue;if(!this.roleTabs[tab])this.roleTabs[tab]={};this.roleTabs[tab][roleIndex]=false;for(var selectSkillID=1;selectSkillID<=3;selectSkillID++){if(!this.roleSkillTabs[roleIndex])this.roleSkillTabs[roleIndex]={};this.roleSkillTabs[roleIndex][selectSkillID]=false;var maxLevel=GlobalConfig.GuildCommonSkillConfig[selectSkillID].length;var level=roleSkillInfo.guildSkillInfo[selectSkillID-1].level;if(level>=maxLevel)continue;var csInfoNext=this.getCommonSkillDP(selectSkillID,level+1);if(!csInfoNext)continue;if(csInfoNext.contribute>Guild.ins().myCon){continue}if(Actor.gold<csInfoNext.money){continue}var buildLevel=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_LIANGONGFANG-1);var learnLab=buildLevel<1||level>=GlobalConfig.GuildConfig.commonSkillLevels[buildLevel-1];if(learnLab){continue}this.roleSkillTabs[roleIndex][selectSkillID]=true;this.liangongRed=true}for(var r in this.roleSkillTabs[roleIndex]){if(this.roleSkillTabs[roleIndex][r]){this.roleTabs[tab][roleIndex]=true;break}}}};GuildRedPoint.prototype.getCommonSkillDP=function(skillID,level){var infos=GlobalConfig.GuildCommonSkillConfig[skillID];if(level==0){return infos[1]}for(var key in infos){var element=infos[key];if(element.level==level)return element}return null};GuildRedPoint.Tab_LianGong=0;return GuildRedPoint}(BaseSystem);__reflect(GuildRedPoint.prototype,"GuildRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){var guildredpoint=GuildRedPoint.ins.bind(GuildRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GuildRobber=function(_super){__extends(GuildRobber,_super);function GuildRobber(){var _this=_super.call(this)||this;_this.robberNum=0;_this.robberTotal=0;_this.robberDealNum=0;_this._robberList=[];_this.robberChanllge=0;_this.isUpdateRobber=false;_this.sysId=PackageID.GuildRobber;_this.regNetMsg(1,_this.doGuildRobberInfo);_this.regNetMsg(2,_this.doGuildRobberStarts);_this.regNetMsg(3,_this.doGuildRobberSX);_this.regNetMsg(4,_this.doGuildRobberChangller);return _this}GuildRobber.ins=function(){return _super.ins.call(this)};GuildRobber.prototype.getRobberList=function(index){if(index===void 0){index=-1}return index==-1?this._robberList:this._robberList[index]};GuildRobber.prototype.doGuildRobberInfo=function(bytes){this.robberNum=bytes.readByte();if(this.robberNum>0){this.robberTotal=bytes.readByte();this.robberDealNum=bytes.readByte();this._robberList=[];for(var i=0;i<this.robberTotal;i++){var info=new RobberStartInfo;info.robberStart=bytes.readByte();info.robberType=bytes.readByte();this._robberList.push(info)}}this.postGuildRobberInfo()};GuildRobber.prototype.postGuildRobberInfo=function(){};GuildRobber.prototype.doGuildRobberStarts=function(bytes){var index=bytes.readByte();if(this._robberList.length>0){var info=this._robberList[index-1];info.robberStart=bytes.readByte()}this.robberDealNum=bytes.readByte();this.postGuildRobberInfo()};GuildRobber.prototype.doGuildRobberSX=function(bytes){this.robberNum=bytes.readByte();if(ViewManager.ins().getView(GuildMap)){this.sendRobberInfo()}else this.isUpdateRobber=true};GuildRobber.prototype.doGuildRobberChangller=function(bytes){this.robberChanllge=bytes.readByte()};GuildRobber.prototype.sendRobberInfo=function(){this.sendBaseProto(1)};GuildRobber.prototype.sendRobberChanger=function(num){var bytes=this.getBytes(2);bytes.writeByte(num);this.sendToServer(bytes)};GuildRobber.prototype.hasbtn=function(){return this.robberTotal>0&&this.robberTotal>this.robberDealNum};return GuildRobber}(BaseSystem);__reflect(GuildRobber.prototype,"GuildRobber");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.guildrobber=GuildRobber.ins.bind(GuildRobber)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GuildStore=function(_super){__extends(GuildStore,_super);function GuildStore(){var _this=_super.call(this)||this;_this.guildStoreLv=0;_this.guildStoreNum=0;_this._recordInfoAry=[];_this._guildStoreItemData=[];_this.sysId=PackageID.GuildStore;_this.regNetMsg(1,_this.postGuildStoreInfo);_this.regNetMsg(2,_this.postGuildStoreBoxInfo);_this.regNetMsg(3,_this.postGuildStoreBox);return _this}GuildStore.ins=function(){return _super.ins.call(this)};GuildStore.prototype.getRecordInfoAry=function(index){if(index===void 0){index=-1}return index==-1?this._recordInfoAry:this._recordInfoAry[index]};GuildStore.prototype.getGuildStoreItemData=function(index){if(index===void 0){index=-1}return index==-1?this._guildStoreItemData:this._guildStoreItemData[index]};GuildStore.prototype.postGuildStoreInfo=function(bytes){this.guildStoreLv=bytes.readByte();this.guildStoreNum=bytes.readByte()};GuildStore.prototype.postGuildStoreBoxInfo=function(bytes){var num=bytes.readByte();for(var i=0;i<num;i++){var info=new GuildStoreRecordInfo;info.times=bytes.readInt();info.roleName=bytes.readString();info.itemId=bytes.readInt();if(this._recordInfoAry.length>=50)this._recordInfoAry.pop();this._recordInfoAry.unshift(info)}};GuildStore.prototype.postGuildStoreBox=function(bytes){var num=bytes.readByte();this._guildStoreItemData=[];for(var i=0;i<num;i++){var info=new GuildStoreItemData;info.itemId=bytes.readInt();info.num=bytes.readInt();this._guildStoreItemData.push(info)}this.guildStoreNum-=1};GuildStore.prototype.doGuildStoreAddBoxInfo=function(bytes){this._recordInfo=new GuildStoreRecordInfo;this._recordInfo.roleName=bytes.readString();this._recordInfo.itemId=bytes.readInt()};GuildStore.prototype.getGuildStoreInfo=function(){this.sendBaseProto(1)};GuildStore.prototype.sendGuildStoreBoxInfo=function(){var bytes=this.getBytes(2);if(this._recordInfoAry==null||this._recordInfoAry.length==0){bytes.writeInt(0)}else{bytes.writeInt(this.getRecordInfoAry(0).times)}this.sendToServer(bytes)};GuildStore.prototype.sendGuildStoreBox=function(){this.sendBaseProto(3)};return GuildStore}(BaseSystem);__reflect(GuildStore.prototype,"GuildStore");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.guildstore=GuildStore.ins.bind(GuildStore)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GuildWar=function(_super){__extends(GuildWar,_super);function GuildWar(){var _this=_super.call(this)||this;_this.sysId=PackageID.GuildWar;_this.regNetMsg(1,_this.postRedBagInfo);_this.regNetMsg(2,_this.doSendRedBack);_this.regNetMsg(3,_this.doRobRedBack);_this.regNetMsg(4,_this.postJoinPlayBack);_this.regNetMsg(5,_this.doPlayNextCard);_this.regNetMsg(6,_this.doGetPointInfo);_this.regNetMsg(7,_this.doGetGongXunChange);_this.regNetMsg(8,_this.doGuildRankinfo);_this.regNetMsg(9,_this.postGuildPersonalRank);_this.regNetMsg(10,_this.doGuildWarKillInfo);_this.regNetMsg(11,_this.doGuildWarCityOwn);_this.regNetMsg(12,_this.postDayRewardInfo);_this.regNetMsg(14,_this.doMyActivityRankInfo);_this.regNetMsg(15,_this.postFlagInfoChange);_this.regNetMsg(17,_this.doGuildWarResult);_this.regNetMsg(18,_this.doHuDunInfoChange);_this.regNetMsg(19,_this.postAssignsReward);_this.regNetMsg(20,_this.postSendRewardSuccess);_this.regNetMsg(21,_this.postWinGuildInfo);_this.regNetMsg(22,_this.postGuildWarStarInfo);_this.regNetMsg(23,_this.doGuildWarDoorHuDun);_this.regNetMsg(24,_this.doLotteryInfo);_this.regNetMsg(25,_this.doGetMyPoint);_this.regNetMsg(26,_this.doRankInfoChange);_this.regNetMsg(27,_this.doChangeAttrHandle);_this.regNetMsg(28,_this.doChangeShowList);_this.regNetMsg(29,_this.doPointRewardInfo);_this.regNetMsg(31,_this.doDoorEndtime);_this.regNetMsg(32,_this.doTalkMaxPoint);_this.regNetMsg(33,_this.postKillHuman);_this.regNetMsg(34,_this.postHeFuBelong);return _this}GuildWar.ins=function(){return _super.ins.call(this)};GuildWar.prototype.getModel=function(){if(!this._guildWarModel)this._guildWarModel=new GuildWarModel;return this._guildWarModel};GuildWar.prototype.requestSendRedBag=function(num,bagNum){var bytes=this.getBytes(2);bytes.writeInt(num);bytes.writeInt(bagNum);this.sendToServer(bytes)};GuildWar.prototype.requestRobRedBag=function(){var bytes=this.getBytes(3);this.sendToServer(bytes)};GuildWar.prototype.requestJoinAc=function(){var bytes=this.getBytes(4);this.sendToServer(bytes)};GuildWar.prototype.requestPlayNextMap=function(index){var bytes=this.getBytes(5);bytes.writeByte(index);this.sendToServer(bytes)};GuildWar.prototype.requestGuildRank=function(){var bytes=this.getBytes(8);this.sendToServer(bytes)};GuildWar.prototype.requestOwnGuildRank=function(){var bytes=this.getBytes(9);this.sendToServer(bytes)};GuildWar.prototype.postGuildPersonalRank=function(bytes){var list=[];var len=bytes.readInt();for(var i=0;i<len;i++){var info=new RankGuildInfo;info.parse(bytes);list[i]=info}return list};GuildWar.prototype.requestDayReward=function(day){var bytes=this.getBytes(13);bytes.writeInt(day);this.sendToServer(bytes)};GuildWar.prototype.requestOwnMyGuildRank=function(){var bytes=this.getBytes(14);this.sendToServer(bytes)};GuildWar.prototype.requestStartGetFlag=function(){var bytes=this.getBytes(16);this.sendToServer(bytes)};GuildWar.prototype.requestWinGuildInfo=function(){var bytes=this.getBytes(21);this.sendToServer(bytes)};GuildWar.prototype.postRedBagInfo=function(bytes){this.getModel().getRedbagInfo(bytes)};GuildWar.prototype.doSendRedBack=function(bytes){if(bytes.readBoolean()){ViewManager.ins().close(RedBagWin);UserTips.ins().showTips(i18n("GuildWar_0"))}};GuildWar.prototype.doRobRedBack=function(bytes){if(bytes.readBoolean()){ViewManager.ins().close(RedBagWin);ViewManager.ins().open(RedBagDetailsWin,1)}};GuildWar.prototype.postJoinPlayBack=function(bytes){var flag=bytes.readBoolean();this.getModel().doorDie=bytes.readBoolean();this.getModel().rewardFlag=bytes.readByte();if(flag){ViewManager.ins().close(GuildWarMainWin);ViewManager.ins().close(GuildMap)}};GuildWar.prototype.doPlayNextCard=function(bytes){};GuildWar.prototype.doGetPointInfo=function(bytes){this.getModel().ownPoint=bytes.readInt();this.getModel().guildPoint=bytes.readInt();var addNum=bytes.readInt();if(addNum>0){UserTips.ins().showTips(i18n("GuildWar_2",addNum))}this.postPointUpdate()};GuildWar.prototype.postPointUpdate=function(){};GuildWar.prototype.doGetGongXunChange=function(bytes){this.getModel().gongXun=bytes.readInt();this.postPointUpdate()};GuildWar.prototype.doGuildRankinfo=function(bytes){this.getModel().decodeGuildRankInfo(bytes)};GuildWar.prototype.doGuildWarKillInfo=function(bytes){var time=bytes.readInt();this.getModel().killName=bytes.readString();this.getModel().killGuild=bytes.readString();ViewManager.ins().open(GuileWarReliveWin,2,time)};GuildWar.prototype.doGuildWarCityOwn=function(bytes){this.getModel().cityOwn=bytes.readString();this.postCityownChange()};GuildWar.prototype.postCityownChange=function(){};GuildWar.prototype.doMyActivityRankInfo=function(bytes){this.getModel().decodeMyGuildRankInfo(bytes)};GuildWar.prototype.postDayRewardInfo=function(bytes){this.getModel().canGetDay=bytes.readBoolean();this.getModel().getDayReward=bytes.readBoolean();this.getModel().rewardDay=bytes.readInt()};GuildWar.prototype.postFlagInfoChange=function(bytes){this.getModel().flagAcId=0;this.getModel().flagStatu=bytes.readShort();if(this.getModel().flagStatu==0){this.getModel().endTime=bytes.readInt()}else if(this.getModel().flagStatu==2){this.getModel().flagName=bytes.readString();this.getModel().flagAcId=bytes.readInt();this.getModel().endTime=bytes.readInt();this.getModel().flagGuild=bytes.readString();if(this.getModel().flagAcId==Actor.actorID){UserTips.ins().showTips(i18n("GuildWar_3"))}}};GuildWar.prototype.doGuildWarResult=function(bytes){this.getModel().decodeGulidWarResult(bytes)};GuildWar.prototype.doHuDunInfoChange=function(bytes){this.postHudunInfo(bytes.readInt(),bytes.readInt())};GuildWar.prototype.postHudunInfo=function(num1,num2){return[num1,num2]};GuildWar.prototype.postAssignsReward=function(bytes){this.getModel().guildWarRank=bytes.readInt();this.getModel().canSendReward=bytes.readBoolean();this.getModel().rewardFlag=bytes.readByte()};GuildWar.prototype.sendFenReward=function(num,list){var numList=this.getModel().sendNumList;var bytes=this.getBytes(20);bytes.writeInt(num);for(var i=1;i<=num;i++){bytes.writeInt(i);var index=i-1;var len=list[index].length;bytes.writeInt(len);for(var k=0;k<len;k++){var data=list[index][k];bytes.writeInt(data.roleID);bytes.writeInt(numList[index][k])}}this.sendToServer(bytes)};GuildWar.prototype.postSendRewardSuccess=function(bytes){if(bytes.readBoolean()){ViewManager.ins().close(SelectMemberRewardWin);this.getModel().canSendReward=false;UserTips.ins().showTips(i18n("GuildWar_4"))}};GuildWar.prototype.postWinGuildInfo=function(bytes){if(!this.getModel().winGuildInfo){this.getModel().winGuildInfo=new WinGuildInfo}this.getModel().winGuildInfo.parse(bytes)};GuildWar.prototype.postGuildWarStarInfo=function(bytes){this.getModel().isWatStart=bytes.readBoolean();this.getModel().startTime=bytes.readInt();this.getModel().acEndTime=bytes.readInt()};GuildWar.prototype.doGuildWarDoorHuDun=function(bytes){UserBoss.ins().curShield=bytes.readInt();UserBoss.ins().postShieldPer()};GuildWar.prototype.doLotteryInfo=function(bytes){UserBoss.ins().worldPrize=bytes.readInt();ViewManager.ins().open(WorldBossJiangLiWin,1)};GuildWar.prototype.sendPlayLotteryInfo=function(){var bytes=this.getBytes(25);this.sendToServer(bytes)};GuildWar.prototype.doRankInfoChange=function(bytes){this.getModel().rankListChange(bytes)};GuildWar.prototype.doChangeAttrHandle=function(bytes){if(GameMap.fbType!=14){return}var handle=bytes.readDouble();if(!(this.getModel().attHandle==handle)){this.getModel().attHandle=handle;EntityShowMgr.ins().showHideSomeOne(handle);debug.log("add-----------:"+handle)}this.postWeixieChange(1)};GuildWar.prototype.postWeixieChange=function(b){return b};GuildWar.prototype.postGuildRedPointChange=function(b){return b};GuildWar.prototype.doChangeShowList=function(bytes){if(GameMap.fbType!=14){return}var handle=bytes.readDouble();this.getModel().changeWeiXieList(handle,false);this.getModel().changecanPlayList(handle,false);this.getModel().setMyGuildNum(handle,false);if(this.getModel().attHandle&&this.getModel().attHandle==handle){this.getModel().attHandle=0;debug.log("cancel------------:"+handle)}};GuildWar.prototype.doPointRewardInfo=function(bytes){this.getModel().decodePointRewardInfo(bytes)};GuildWar.prototype.sendPointReward=function(){var bytes=this.getBytes(30);this.sendToServer(bytes)};GuildWar.prototype.doDoorEndtime=function(bytes){this.getModel().doEndDoorTime(bytes.readByte())};GuildWar.prototype.doGetMyPoint=function(bytes){var ran=bytes.readShort();UserBoss.ins().postLotteryRan(ran)};GuildWar.prototype.postLotteryPoint=function(n){return n};GuildWar.prototype.doTalkMaxPoint=function(bytes){var point=bytes.readInt();var name=bytes.readString();UserBoss.ins().postLotteryResult(name,point)};GuildWar.prototype.postKillHuman=function(bytes){var kill=bytes.readInt();return kill};GuildWar.prototype.postHeFuBelong=function(bytes){var len=bytes.readShort();this.GuildNameBelongs=[];for(var i=0;i<len;i++){var belong=bytes.readString();this.GuildNameBelongs.push(belong)}};GuildWar.prototype.sendHeFuBelong=function(){this.sendBaseProto(34)};GuildWar.prototype.postLotteryMaxPost=function(str,n){return[str,n]};GuildWar.prototype.postMyRankChange=function(){};GuildWar.prototype.postPointRewardChange=function(){};GuildWar.prototype.postCanplayChange=function(){};GuildWar.prototype.postRankListChange=function(){};GuildWar.prototype.postGuildNumChange=function(){};GuildWar.prototype.postSendListChange=function(){};GuildWar.prototype.postRankInfo=function(){};GuildWar.prototype.toGuildWar=function(){var b=GuildWar.ins().getModel().getIsShowGuildWarBtn()==1;if(!b){return}if(Guild.ins().guildID==undefined||Guild.ins().guildID==0){UserTips.ins().showTips(i18n("GuildWarIconRule_0"));return}GuildWar.ins().requestWinGuildInfo();ViewManager.ins().close(GuildMap);ViewManager.ins().open(GuildWarMainWin)};return GuildWar}(BaseSystem);__reflect(GuildWar.prototype,"GuildWar");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.guildwar=GuildWar.ins.bind(GuildWar)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GuildBuilding;(function(GuildBuilding){GuildBuilding[GuildBuilding["GUILD_HALL"]=1]="GUILD_HALL";GuildBuilding[GuildBuilding["GUILD_LIANGONGFANG"]=2]="GUILD_LIANGONGFANG";GuildBuilding[GuildBuilding["GUILD_SHOP"]=3]="GUILD_SHOP";GuildBuilding[GuildBuilding["GUILD_COMMENT"]=4]="GUILD_COMMENT"})(GuildBuilding||(GuildBuilding={}));window["GuildBuilding"]=GuildBuilding;var GuildLanguage=function(){function GuildLanguage(){}Object.defineProperty(GuildLanguage,"guildOffice",{get:function(){var _guildOffice=this._guildOffice;if(_guildOffice==null){_guildOffice=[i18n("GuildLanguage_0"),i18n("GuildLanguage_1"),i18n("GuildLanguage_2"),i18n("GuildLanguage_3"),i18n("GuildLanguage_4"),i18n("GuildLanguage_5"),i18n("GuildLanguage_6")];this._guildOffice=_guildOffice}return _guildOffice},enumerable:true,configurable:true});Object.defineProperty(GuildLanguage,"guildOfficeColor",{get:function(){var _guildOfficeColor=this._guildOfficeColor;if(_guildOfficeColor==null){_guildOfficeColor=["d1c3a8","00c832","1694ec","8e2abc","f4b12a","ffff00","ffff00"];this._guildOfficeColor=_guildOfficeColor}return _guildOfficeColor},enumerable:true,configurable:true});Object.defineProperty(GuildLanguage,"guildBuilding",{get:function(){var _guildBuilding=this._guildBuilding;if(_guildBuilding==null){_guildBuilding=["",i18n("GuildLanguage_7"),i18n("GuildLanguage_8")];this._guildBuilding=_guildBuilding}return _guildBuilding},enumerable:true,configurable:true});return GuildLanguage}();__reflect(GuildLanguage.prototype,"GuildLanguage");var GuildOffice;(function(GuildOffice){GuildOffice[GuildOffice["GUILD_MEMBER"]=0]="GUILD_MEMBER";GuildOffice[GuildOffice["GUILD_JINGYING"]=1]="GUILD_JINGYING";GuildOffice[GuildOffice["GUILD_TANGZHU"]=2]="GUILD_TANGZHU";GuildOffice[GuildOffice["GUILD_HUFA"]=3]="GUILD_HUFA";GuildOffice[GuildOffice["GUILD_ZHANGLAO"]=4]="GUILD_ZHANGLAO";GuildOffice[GuildOffice["GUILD_FUBANGZHU"]=5]="GUILD_FUBANGZHU";GuildOffice[GuildOffice["GUILD_BANGZHU"]=6]="GUILD_BANGZHU"})(GuildOffice||(GuildOffice={}));window["GuildOffice"]=GuildOffice;var GuildApplyInfo=function(){function GuildApplyInfo(){}return GuildApplyInfo}();__reflect(GuildApplyInfo.prototype,"GuildApplyInfo");var GuildFBModel=function(){function GuildFBModel(){this.bossTimer=1}GuildFBModel.prototype.parserBaseInfo=function(bytes){this.fbNum=bytes.readShort();this.sweep=bytes.readByte();this.sweepNum=bytes.readShort();this.tongguan=bytes.readByte();this.zuwei=bytes.readByte();this.nextFb=bytes.readByte()};GuildFBModel.prototype.parserRankInfo=function(bytes){this.rankDatas=[];var len=bytes.readByte();for(var i=0;i<len;i++){var info=new GuildFBRankInfo;info.rank=i+1;info.name=bytes.readString();info.guanka=bytes.readShort();this.rankDatas.push(info)}};GuildFBModel.prototype.parserMaxGkInfo=function(bytes){this.isMaxGK=bytes.readByte();if(this.isMaxGK!=0){this.maxName=bytes.readString();this.maxCareer=bytes.readByte();this.maxSex=bytes.readByte();this.maxNum=bytes.readShort();this.maxZhuwei=bytes.readByte()}};GuildFBModel.prototype.parserGkInfo=function(bytes){this.fbgkNum=bytes.readShort();var len=bytes.readByte();this.gkDatas=[];for(var i=0;i<len;i++){this.gkDatas.push(bytes.readString())}};GuildFBModel.prototype.parserRewardInfo=function(bytes){this.rewardNum=bytes.readShort();this.rewardRoleNum=bytes.readShort()};GuildFBModel.prototype.hasbtn=function(){return GameServer.serverOpenDay>0&&(this.sweep==0&&this.fbNum>0||this.tongguan==0&&this.rewardNum>0)};Object.defineProperty(GuildFBModel.prototype,"bossTimerEnd",{get:function(){return this.bossTimer+egret.getTimer()},enumerable:true,configurable:true});return GuildFBModel}();__reflect(GuildFBModel.prototype,"GuildFBModel");var GuildFBRankInfo=function(){function GuildFBRankInfo(){}return GuildFBRankInfo}();__reflect(GuildFBRankInfo.prototype,"GuildFBRankInfo");var GuildListInfo=function(){function GuildListInfo(){}return GuildListInfo}();__reflect(GuildListInfo.prototype,"GuildListInfo");var GuildMemberInfo=function(){function GuildMemberInfo(){this.level=0;this.zsLevel=0}GuildMemberInfo.prototype.parse=function(bytes){this.roleID=bytes.readInt();this.vipLevel=bytes.readInt();this.attack=bytes.readInt();this.sex=bytes.readUnsignedByte();this.job=bytes.readUnsignedByte();this.name=bytes.readString();this.zsLevel=bytes.readInt();this.score=bytes.readInt();this.winRate=bytes.readInt()/1e4;this.KfArenaCount=bytes.readUnsignedByte();this.isJoinkfArena=bytes.readUnsignedByte()==1};GuildMemberInfo.prototype.copyData=function(tData){for(var key in tData){this[key]=tData[key]}};return GuildMemberInfo}();__reflect(GuildMemberInfo.prototype,"GuildMemberInfo");var GuildMessageInfo=function(){function GuildMessageInfo(){this.qzviplv=0;this.isYearVip=0;this.datviplv=0;this.isdatHighVip=0;this.isdatYearVip=0}GuildMessageInfo.prototype.parserMessage=function(bytes){this.type=bytes.readUnsignedByte();this.content=bytes.readString();this.chatdate=bytes.readInt();if(this.type==1||this.type==3||this.type==4){this.roleId=bytes.readInt();this.name=bytes.readString();this.job=bytes.readUnsignedByte();this.sex=bytes.readUnsignedByte();this.vipLevel=bytes.readInt();this.monthCard=bytes.readUnsignedByte();this.office=bytes.readUnsignedByte();this.zsLevel=bytes.readUnsignedByte();this.lv=bytes.readShort();this.guildName=bytes.readString();if(this.type==4){this.record=new MineRecord;this.record.parser(bytes)}this.dealChannelDate()}};GuildMessageInfo.prototype.dealChannelDate=function(){if(ChannelMgr.ins().isQQZoneChannel()){var str=this.content.split(QzoneSys.MARK_QZVIP);this.content=str[0];var Qzmarkstr=str[1];if(Qzmarkstr){var lvstr=Qzmarkstr.split(QzoneSys.MARK_QZYEAR);if(lvstr){var qzviplvstr=lvstr[0];var qzisyearstr=lvstr[1];this.qzviplv=Number(qzviplvstr);this.isYearVip=Number(qzisyearstr)}}}if(ChannelMgr.ins().isQQDaTingChannel()){var str=this.content.split(QQDaTingSys.MARK_DATVIP);this.content=str[0];var Qzmarkstr=str[1];if(Qzmarkstr){var lvstr=Qzmarkstr.split(QQDaTingSys.MARK_DATHIGHVIP);if(lvstr){var datviplvstr=lvstr[0];var datHYMark=lvstr[1];var datHYstr=datHYMark.split(QQDaTingSys.MARK_DATYEAR);var datishighstr=datHYstr[0];var datisyearstr=datHYstr[1];this.datviplv=Number(datviplvstr);this.isdatHighVip=Number(datishighstr);this.isdatYearVip=Number(datisyearstr)}}}};return GuildMessageInfo}();__reflect(GuildMessageInfo.prototype,"GuildMessageInfo");var GuildSkillInfo=function(){function GuildSkillInfo(){}return GuildSkillInfo}();__reflect(GuildSkillInfo.prototype,"GuildSkillInfo");var GuildStoreItemData=function(){function GuildStoreItemData(){}return GuildStoreItemData}();__reflect(GuildStoreItemData.prototype,"GuildStoreItemData");var GuildStoreModel=function(){function GuildStoreModel(){this.guildStoreLv=0;this.recordInfoAry=[];this.recordMax=50}GuildStoreModel.prototype.parserBaseInfo=function(bytes){this.guildStoreLv=bytes.readByte();this.guildStoreNum=bytes.readByte()};GuildStoreModel.prototype.parserRecordInfo=function(bytes){var num=bytes.readByte();var tArray=[];var info;if(this.recordInfoAry!=null&&this.recordInfoAry.length>0&&this.recordInfoAry.length+num>this.recordMax){var tNum=this.recordMax-num>0?this.recordMax-num:0;this.recordInfoAry.length=tNum}for(var i=0;i<num;i++){info=new GuildStoreRecordInfo;info.times=bytes.readInt();info.roleName=bytes.readString();info.itemId=bytes.readInt();tArray.push(info)}this.recordInfoAry=tArray.concat(this.recordInfoAry)};GuildStoreModel.prototype.parserBoxItemInfo=function(bytes){var num=bytes.readByte();this.guildStoreItemData=[];for(var i=0;i<num;i++){var info=new GuildStoreItemData;info.itemId=bytes.readInt();info.num=bytes.readInt();this.guildStoreItemData.push(info)}};GuildStoreModel.prototype.parserRecord=function(bytes){this.recordInfo=new GuildStoreRecordInfo;this.recordInfo.roleName=bytes.readString();this.recordInfo.itemId=bytes.readInt()};return GuildStoreModel}();__reflect(GuildStoreModel.prototype,"GuildStoreModel");var GuildStoreRecordInfo=function(){function GuildStoreRecordInfo(){}return GuildStoreRecordInfo}();__reflect(GuildStoreRecordInfo.prototype,"GuildStoreRecordInfo");var GuildTaskInfo=function(){function GuildTaskInfo(){}return GuildTaskInfo}();__reflect(GuildTaskInfo.prototype,"GuildTaskInfo");var GuildWarModel=function(){function GuildWarModel(){this.guildPoint=0;this.ownPoint=0;this.gongXun=0;this.rewardDay=1;this.remainYB=-1;this.robYbNum=0;this.guildRankList=[];this.killName="";this.killGuild="";this.cityOwn=i18n("GuildWarModel_0");this.myRankList=[];this.weixieList=[];this.canPlayList=[];this.flagStatu=0;this.endTime=0;this.flagName="";this.flagAcId=0;this.flagGuild="";this.canClick=true;this._canSendReward=false;this.rewardIndex=0;this.sendList=[];this.sendNumList=[];this.rewardFlag=0;this.winGuildInfo=new WinGuildInfo;this.guildWarNumDaXie=[i18n("GuildWarModel_8"),i18n("GuildWarModel_9"),i18n("GuildWarModel_10"),i18n("GuildWarModel_11"),i18n("GuildWarModel_12"),i18n("GuildWarModel_13"),i18n("GuildWarModel_14")];this.rankList=[];this._doorEndtime=0;this.attHandle=0;this.myGuildPointRank=[];this.guildHandleList=[];this.guildNum=0}GuildWarModel.prototype.creatGuildRankReward=function(rank,index){if(index===void 0){index=-1}this.rewardList=[];var data=GlobalConfig.GuildBattleDistributionAward[rank];for(var i in data){if(data[i].rewardFlag&&!(this.rewardFlag==GuildFlag.hf)){continue}if(Number(i)==index+1){return data[i].awardShow}var award=data[i].awardShow;for(var k in award){this.checkIsHave(award[k])}}return this.rewardList};GuildWarModel.prototype.creatGuildRewardList=function(){if(this.configList){return this.configList}this.configList=[];var data=GlobalConfig.GuildBattleDistributionAward;for(var i in data){if(this.configList.lastIndexOf(data[i][1].rank)==-1){this.configList.push(data[i][1].rank)}}return this.configList};GuildWarModel.prototype.checkIsHave=function(data){var isFound=false;var len=this.rewardList.length;for(var i=0;i<len;i++){var info=this.rewardList[i];if(info.id==data.id&&info.type==data.type){isFound=true;this.rewardList[i].count+=data.count}}if(!isFound){this.rewardList.push(data)}};GuildWarModel.prototype.getRedbagInfo=function(bytes){this.remainYB=bytes.readInt();this.canSend=bytes.readBoolean();this.canRod=bytes.readBoolean();this.sendYbNum=bytes.readInt();this.maxRedNum=bytes.readInt();this.remainRedNum=bytes.readInt();var len=bytes.readInt();this.rebList=[];var info;for(var i=0;i<len;i++){info=new GuildRedRobInfo;info.parse(bytes);if(Actor.actorID==info.acId)this.robYbNum=info.robNum;this.rebList.push(info)}};GuildWarModel.prototype.isHaveRedBag=function(){return this.canSend||this.canRod};GuildWarModel.prototype.checkinAppoint=function(index,up){if(index===void 0){index=0}if(up===void 0){up=false}if(!GuildWar.ins().getModel().isWatStart||GameMap.fubenID==0||Guild.ins().guildID==0){return false}var data=GlobalConfig.GuildBattleLevel;for(var k in data){if(data[k].fbId==GameMap.fubenID){if(index==0){return true}if(up&&data[k].id>=index){return true}if(data[k].id==index){return true}return false}}return false};GuildWarModel.prototype.decodeGuildRankInfo=function(bytes){this.lastGuildName=bytes.readString();var yuan=bytes.readByte();var len=bytes.readInt();this.guildRankList=[];var info;for(var i=0;i<len;i++){info=new RankGuildInfo;info.parse(bytes);this.guildRankList.push(info)}GuildWar.ins().postRankInfo()};GuildWarModel.prototype.getNextMapName=function(next){if(next===void 0){next=1}var cruId=GameMap.fubenID;var data=GlobalConfig.GuildBattleLevel;var index=1;for(var k in data){if(next==data[k].id){index=next}}return data[index].name};GuildWarModel.prototype.getIntoNextMapGongxun=function(){var cruId=GameMap.fubenID;var data=GlobalConfig.GuildBattleLevel;var index=1;for(var k in data){if(cruId==data[k].fbId){if(data[k].id<4){index=data[k].id+1}else{return 0}}}return data[index].feats};GuildWarModel.prototype.getMapLevelInfo=function(){var cruId=GameMap.fubenID;var data=GlobalConfig.GuildBattleLevel;var index=1;for(var k in data){if(cruId==data[k].fbId){index=data[k].id}}return data[index]};GuildWarModel.prototype.decodeMyGuildRankInfo=function(bytes){var len=bytes.readInt();this.myRankList=[];var info;for(var i=0;i<len;i++){info=new MyRankGuildInfo;info.parse(bytes);this.myRankList.push(info)}GuildWar.ins().postMyRankChange()};GuildWarModel.prototype.changeWeiXieList=function(handel,add,showName){if(add===void 0){add=true}if(showName===void 0){showName=""}if(Actor.handle==handel){return}var index=this.checkListElements(handel,this.weixieList);if(add){if(index==-1){this.weixieList.push(handel);UserTips.ins().showTips(i18n("GuildWarModel_15")+showName+i18n("GuildWarModel_1"))}}else{if(index!=-1){this.weixieList.splice(index,1)}}GuildWar.ins().postWeixieChange(0)};GuildWarModel.prototype.changecanPlayList=function(handel,add){if(add===void 0){add=true}if(Actor.handle==handel){return}var index=this.checkListElements(handel,this.canPlayList);if(add){if(index==-1){this.canPlayList.push(handel)}}else{if(index!=-1){this.canPlayList.splice(index,1)}}GuildWar.ins().postCanplayChange()};GuildWarModel.prototype.decodeGulidWarResult=function(bytes){ViewManager.ins().open(GuildWarResultWin,bytes.readString(),bytes.readInt(),bytes.readInt(),bytes.readInt(),bytes.readInt())};GuildWarModel.prototype.checkListElements=function(handle,list){if(list.length<=0){return-1}for(var i=0;i<list.length;i++){if(list[i]==handle){return i}}return-1};GuildWarModel.prototype.getRewardByPoint=function(point){var rewardList=[];if(!this.dataList){this.dataList=[];var data=GlobalConfig.GuildBattlePersonalAward;for(var str in data){this.dataList.push(data[str])}}var len=this.dataList.length;for(var i=0;i<len;i++){if(point>=this.dataList[i].integral){rewardList=rewardList.concat(this.dataList[i].award)}}return rewardList};GuildWarModel.prototype.getMyPointReward=function(){var data=GlobalConfig.GuildBattlePersonalAward;var info;for(var str in data){info=data[str];if(info.id==this.pointInfo.id){return info}}return null};GuildWarModel.prototype.getMaxReward=function(){var data=GlobalConfig.GuildBattlePersonalAward;var info;var maxEgral=0;var maxInfo;for(var str in data){info=data[str];if(info.integral>maxEgral){maxEgral=info.integral;maxInfo=info}}return maxInfo};Object.defineProperty(GuildWarModel.prototype,"clickTime",{get:function(){return this._clickTime},set:function(value){this.canClick=false;this._clickTime=value;TimerManager.ins().remove(this.endTimeChangeStatu,this);TimerManager.ins().doTimer(1e3,this._clickTime,this.endTimeChangeStatu,this)},enumerable:true,configurable:true});GuildWarModel.prototype.endTimeChangeStatu=function(){--this._clickTime;if(this._clickTime<=0){this.canClick=true;TimerManager.ins().remove(this.endTimeChangeStatu,this)}};Object.defineProperty(GuildWarModel.prototype,"canSendReward",{get:function(){return Guild.ins().myOffice==GuildOffice.GUILD_BANGZHU&&this._canSendReward},set:function(b){this._canSendReward=b},enumerable:true,configurable:true});GuildWarModel.prototype.getCanSendNumByRank=function(index){if(index===void 0){index=-1}var data=GlobalConfig.GuildBattleDistributionAward[this.guildWarRank];var len=0;for(var i in data){if(data[i].rewardFlag&&!(this.rewardFlag==GuildFlag.hf)){continue}if(i==index+1+""){return data[i].count}++len}return len};GuildWarModel.prototype.checkISSendAll=function(){var len=this.getCanSendNumByRank();for(var i=0;i<len;i++){var num=this.getCanSendNumByRank(i);if(!this.sendList[i]){UserTips.ins().showTips(i18n("GuildWarModel_2"));return false}var count=0;for(var k=0;k<this.sendNumList[i].length;k++){count+=this.sendNumList[i][k]}if(num>count){UserTips.ins().showTips(i18n("GuildWarModel_3"));return false}for(var k=0;k<this.sendList[i].length;k++){if(!Guild.ins().checkIsInGuild(this.sendList[i][k].roleID)){UserTips.ins().showTips(i18n("GuildWarModel_16")+this.sendList[i][k].name+i18n("GuildWarModel_4"));return false}}}return true};Object.defineProperty(GuildWarModel.prototype,"acEndTime",{get:function(){return this._acEndTime},set:function(value){this._acEndTime=value;if(this._acEndTime>0){TimerManager.ins().remove(this.reduceTime,this);TimerManager.ins().doTimer(1e3,value,this.reduceTime,this)}},enumerable:true,configurable:true});GuildWarModel.prototype.reduceTime=function(){--this._acEndTime;if(this._acEndTime<=0){TimerManager.ins().remove(this.reduceTime,this)}};GuildWarModel.prototype.setOpenDesc=function(){if(this.startTime==0){return""}var date=new Date(this.startTime*1e3);return date.getMonth()+1+i18n("GuildWarModel_5")+date.getDate()+i18n("GuildWarModel_6")+this.guildWarNumDaXie[date.getDay()]+")"+i18n("GuildWarModel_7")};GuildWarModel.prototype.getCdByType=function(type){if(GameMap.fubenID==0){return 0}var data=GlobalConfig.GuildBattleLevel;for(var k in data){if(data[k].fbId==GameMap.fubenID){if(type==1||type==3){return data[k].switchSceneCd}}}return 0};GuildWarModel.prototype.getIsShowGuildWarBtn=function(){if(this.startTime==0||GlobalConfig.GuildBattleConst.openLevel>Actor.level){return 0}var date=new Date(this.startTime*1e3);var date2=new Date(GameServer.serverTime);if(date.getDate()==date2.getDate()&&(date2.getHours()<20||date2.getHours()==20&&date2.getMinutes()<=15)||this.isWatStart){return 1}return 0};GuildWarModel.prototype.rankListChange=function(bytes){var len=bytes.readInt();this.rankList=[];var info;for(var i=0;i<len;i++){info=new WarRankInfo;info.parse(bytes);this.rankList.push(info)}GuildWar.ins().postRankListChange()};GuildWarModel.prototype.decodePointRewardInfo=function(bytes){if(!this.pointInfo){this.pointInfo=new PointRewarddInfo}this.pointInfo.parse(bytes);GuildWar.ins().postPointRewardChange()};GuildWarModel.prototype.getSelectDataByIndex=function(index){var dataList=[];var info;var numInfo;if(this.sendList&&this.sendList[index]&&this.sendList[index].length>0){info=this.sendList[index];numInfo=this.sendNumList[index];var data=void 0;for(var i=0;i<info.length;i++){data=new SelectInfoData;data.data=info[i];data.num=numInfo[i];dataList.push(data)}}return dataList};GuildWarModel.prototype.getMyPointRankReward=function(rank){var data=GlobalConfig.GuildBattlePersonalRankAward;for(var str in data){if(data[str].rank==rank){return data[str].award}}return[]};GuildWarModel.prototype.doEndDoorTime=function(time){this._doorEndtime=time;TimerManager.ins().remove(this.timeDo,this);TimerManager.ins().doTimer(1e3,this._doorEndtime,this.timeDo,this)};GuildWarModel.prototype.timeDo=function(){--this._doorEndtime;if(this._doorEndtime<=0){this._doorEndtime=0;TimerManager.ins().remove(this.timeDo,this)}};Object.defineProperty(GuildWarModel.prototype,"doorEndtime",{get:function(){return this._doorEndtime},enumerable:true,configurable:true});GuildWarModel.prototype.getMyGuildPointRank=function(){var guildList=Guild.ins().getGuildMembers(0);var len=guildList.length;var info;var pointInfo;this.myGuildPointRank=[];for(var i=0;i<len;i++){info=guildList[i];pointInfo=new SelectInfoData;pointInfo.data=info;pointInfo.num=this.getPointByAcId(info.roleID);this.myGuildPointRank.push(pointInfo)}this.myGuildPointRank.sort(this.sort);return this.myGuildPointRank};GuildWarModel.prototype.getPointByAcId=function(acId){var len=this.myRankList.length;for(var i=0;i<len;i++){if(this.myRankList[i].roleID==acId){return this.myRankList[i].point}}return 0};GuildWarModel.prototype.sort=function(a,b){var s1=a.num;var s2=b.num;if(s1>s2)return-1;else if(s1<s2)return 1;else return 0};GuildWarModel.prototype.setMyGuildNum=function(handle,add){if(add===void 0){add=true}var index=this.checkListElements(handle,this.guildHandleList);if(add){if(index==-1){this.guildHandleList.push(handle)}}else{if(index>-1){this.guildHandleList.splice(index,1)}}this.guildNum=this.guildHandleList.length;GuildWar.ins().postGuildNumChange()};GuildWarModel.prototype.clearGuildWarList=function(){if(this.checkinAppoint()){this.weixieList=[];this.canPlayList=[];this.attHandle=0;this.guildHandleList=[]}};return GuildWarModel}();__reflect(GuildWarModel.prototype,"GuildWarModel");var GuildRedRobInfo=function(){function GuildRedRobInfo(){}GuildRedRobInfo.prototype.parse=function(bytes){this.robNum=bytes.readInt();this.robName=bytes.readString();this.acId=bytes.readInt()};return GuildRedRobInfo}();__reflect(GuildRedRobInfo.prototype,"GuildRedRobInfo");var RankGuildInfo=function(){function RankGuildInfo(){}RankGuildInfo.prototype.parse=function(bytes){this.guildName=bytes.readString();this.ownName=bytes.readString();this.guildPoint=bytes.readInt()};return RankGuildInfo}();__reflect(RankGuildInfo.prototype,"RankGuildInfo");var MyRankGuildInfo=function(){function MyRankGuildInfo(){}MyRankGuildInfo.prototype.parse=function(bytes){this.roleID=bytes.readInt();this.myName=bytes.readString();this.mapName=bytes.readString();this.point=bytes.readInt();this.attr=bytes.readInt();this.office=bytes.readInt();this.job=bytes.readInt();this.sex=bytes.readInt()};return MyRankGuildInfo}();__reflect(MyRankGuildInfo.prototype,"MyRankGuildInfo");var WinGuildInfo=function(){function WinGuildInfo(){this.guildId=0;this.guildName="";this.guildOwnName="";this.guildOwnId=0;this.guildOwnJob=0;this.guildOwnSex=0;this.clothID=0;this.wapenId=0;this.wingOpen=0;this.winId=0}WinGuildInfo.prototype.parse=function(bytes){this.guildId=bytes.readInt();this.guildName=bytes.readString();this.guildOwnName=bytes.readString();this.guildOwnId=bytes.readInt();this.guildOwnJob=bytes.readByte();this.guildOwnSex=bytes.readByte();this.clothID=bytes.readInt();this.wapenId=bytes.readInt();this.wingOpen=bytes.readInt();this.winId=bytes.readInt()};return WinGuildInfo}();__reflect(WinGuildInfo.prototype,"WinGuildInfo");var WarRankInfo=function(){function WarRankInfo(){}WarRankInfo.prototype.parse=function(bytes){this.name=bytes.readString();this.point=bytes.readInt()};return WarRankInfo}();__reflect(WarRankInfo.prototype,"WarRankInfo");var PointRewarddInfo=function(){function PointRewarddInfo(){}PointRewarddInfo.prototype.parse=function(bytes){this.isCan=bytes.readBoolean();this.id=bytes.readInt();this.point=bytes.readInt()};return PointRewarddInfo}();__reflect(PointRewarddInfo.prototype,"PointRewarddInfo");var GuildFlag;(function(GuildFlag){GuildFlag[GuildFlag["act"]=0]="act";GuildFlag[GuildFlag["hf"]=1]="hf";GuildFlag[GuildFlag["kf"]=2]="kf"})(GuildFlag||(GuildFlag={}));window["GuildFlag"]=GuildFlag;var SelectInfoData=function(){function SelectInfoData(){}return SelectInfoData}();__reflect(SelectInfoData.prototype,"SelectInfoData");var GuildRoleSkillInfo=function(){function GuildRoleSkillInfo(){this.guildSkillInfo=[];this.practiceSkillInfo=[]}return GuildRoleSkillInfo}();__reflect(GuildRoleSkillInfo.prototype,"GuildRoleSkillInfo");var RobberStartInfo=function(){function RobberStartInfo(){}return RobberStartInfo}();__reflect(RobberStartInfo.prototype,"RobberStartInfo");var GuildActityItemRender=function(_super){__extends(GuildActityItemRender,_super);function GuildActityItemRender(){var _this=_super.call(this)||this;_this.skinName="GuildActityItemSkin";return _this}GuildActityItemRender.prototype.onTap=function(e){switch(e){case this.goBtn0:this.conBtnOnCLick();break}};GuildActityItemRender.prototype.conBtnOnCLick=function(){var info=this.data;if(GuildRobber.ins().robberTotal-GuildRobber.ins().robberDealNum<=0){UserTips.ins().showTips(i18n("GuildActityItemRender_0"));return}if(info.id==1){ViewManager.ins().close(GuildActivityWin)}};GuildActityItemRender.prototype.dataChanged=function(){var info=this.data;if(info){if(info.id)this.taskIcon.source="guildActity_"+info.id;if(info.context){var content=info.context;if(info.openDay){if(GameServer.serverOpenDay<info.openDay-1){var dayStr=TextFlowMaker.getCStr(info.openDay);content=content.replace("\n",i18n("GuildActityItemRender_1",dayStr))}}this.nameLab.textFlow=TextFlowMaker.generateTextFlow1(content)}if(info.id==1){this.descLab.text=i18n("GuildActityItemRender_2",GuildRobber.ins().robberTotal-GuildRobber.ins().robberDealNum,GuildRobber.ins().robberTotal)}}};return GuildActityItemRender}(BaseItemRender);__reflect(GuildActityItemRender.prototype,"GuildActityItemRender");var GuildActityPanel=function(_super){__extends(GuildActityPanel,_super);function GuildActityPanel(){var _this=_super.call(this)||this;_this.initUI();_this.name=i18n("GuildActityPanel_0");return _this}GuildActityPanel.prototype.initUI=function(){this.skinName="GuildActitySkin";this.list.itemRenderer=GuildActityItemRender};GuildActityPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateData();this.addTouchEvent(this.list,this.onListTouch)};GuildActityPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.list,this.onListTouch)};GuildActityPanel.prototype.updateData=function(){var config=[];for(var k in GlobalConfig["GuildActivityConfig"]){var cfgg=GlobalConfig["GuildActivityConfig"][k];config.push(cfgg)}this.list.dataProvider=new eui.ArrayCollection(config)};GuildActityPanel.prototype.onListTouch=function(e){if(e.target instanceof eui.Button){var item=e.target.parent.parent;item.onTap(e.target)}};return GuildActityPanel}(BaseView);__reflect(GuildActityPanel.prototype,"GuildActityPanel");var GuildActivityWin=function(_super){__extends(GuildActivityWin,_super);function GuildActivityWin(){return _super.call(this)||this}GuildActivityWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GuildActivityBgSkin";this.tab.dataProvider=this.viewStack;this.activityPanel=new GuildActityPanel};GuildActivityWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var rtn=Guild.ins().guildID!=0;if(!rtn){UserTips.ins().showTips(i18n("GuildActivityWin_0"))}return rtn};GuildActivityWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.lastSelect=0;this.viewStack.selectedIndex=this.lastSelect;if(GameServer.serverOpenDay>=GlobalConfig["GuildActivityConfig"]["1"].openDay-1){this.viewStack.addChild(this.activityPanel)}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addChangeEvent(this.tab,this.setSelectedIndex);this.observe(GuildFB.ins().postGuildFubenInfo,this.updateRedpoint);this.viewStack.getElementAt(this.lastSelect)["open"]();this.updateRedpoint()};GuildActivityWin.prototype.updateRedpoint=function(){this.redPoint1.visible=GuildFB.ins().hasbtn()};GuildActivityWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeObserve()};GuildActivityWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break}};GuildActivityWin.prototype.setSelectedIndex=function(e){this.viewStack.getElementAt(this.lastSelect)["close"]();this.lastSelect=this.viewStack.selectedIndex;this.viewStack.getElementAt(this.lastSelect)["open"]()};return GuildActivityWin}(BaseEuiView);__reflect(GuildActivityWin.prototype,"GuildActivityWin");ViewManager.ins().reg(GuildActivityWin,LayerManager.UI_Main);var GuildAppltListItemRender=function(_super){__extends(GuildAppltListItemRender,_super);function GuildAppltListItemRender(){var _this=_super.call(this)||this;_this.skinName="MemberApplyItemSkin";return _this}GuildAppltListItemRender.prototype.onTap=function(e){if(GuildWar.ins().getModel().isWatStart){WarnWin.show(i18n("GuildAppltListItemRender_0"),function(){},this);return}switch(e){case this.ok:var commentLv=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_COMMENT-1)||0;var exmember=commentLv?GlobalConfig.GuildConfig.affairMember[commentLv-1]:0;if(Guild.ins().getMemberNum()>=GlobalConfig.GuildConfig.maxMember[Guild.ins().guildLv-1]+exmember){UserTips.ins().showTips(i18n("GuildAppltListItemRender_1"));return}Guild.ins().sendProcessJoin(this.data.roleID,1);break;case this.cancel:Guild.ins().sendProcessJoin(this.data.roleID,0);break}};GuildAppltListItemRender.prototype.dataChanged=function(){if(this.data instanceof GuildApplyInfo){var info=this.data;if(info.vipLevel>0){this.nameLab.x=162}else{this.nameLab.x=109}var name_9="<font color='#485774'>"+info.name+"</font>";this.nameLab.textFlow=(new egret.HtmlTextParser).parser(name_9);this.attack0.text=info.attack+"";var job=fixJob(info.job);var sex=fixSex(info.sex);this.myFace.source="head_"+job+sex;this.vipTitle.visible=info.vipLevel>0}};return GuildAppltListItemRender}(BaseItemRender);__reflect(GuildAppltListItemRender.prototype,"GuildAppltListItemRender");var GuildApplyListWin=function(_super){__extends(GuildApplyListWin,_super);function GuildApplyListWin(){var _this=_super.call(this)||this;_this.skinName="MemberApplySkin";_this.list.itemRenderer=GuildAppltListItemRender;_this.isTopLevel=true;return _this}GuildApplyListWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.attrNum.restrict="0-9";this.attrNum.maxChars=8};GuildApplyListWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.list,this.onListTouch);this.observe(Guild.ins().postApplyInfos,this.updateList);Guild.ins().sendApplyInfos();this.addTouchEvent(this.checkBoxs,this.onTap);this.addChangeEvent(this.attrNum,this.onTxtChange);this.checkBoxs.selected=Guild.ins().isAuto==1;this.attrNum.text=Guild.ins().attrLimit+""};GuildApplyListWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.list,this.onListTouch);this.removeTouchEvent(this.checkBoxs,this.onTap);this.attrNum.removeEventListener(egret.Event.CHANGE,this.onTxtChange,this);this.removeObserve()};GuildApplyListWin.prototype.onTxtChange=function(e){Guild.ins().sendAddGuildLimit(this.checkBoxs.selected?1:0,parseInt(this.attrNum.text))};GuildApplyListWin.prototype.updateList=function(listData){listData.sort(this.sort);this.list.dataProvider=new eui.ArrayCollection(listData)};GuildApplyListWin.prototype.onListTouch=function(e){if(e.target instanceof eui.Button){var item=e.target.parent;item.onTap(e.target)}};GuildApplyListWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.checkBoxs:this.onTxtChange(null);break}};GuildApplyListWin.prototype.sort=function(a,b){if(a.attack>b.attack)return-1;else if(a.attack<b.attack)return 1;else return 0};return GuildApplyListWin}(BaseEuiView);__reflect(GuildApplyListWin.prototype,"GuildApplyListWin");ViewManager.ins().reg(GuildApplyListWin,LayerManager.UI_Main);var GuildApplyWin=function(_super){__extends(GuildApplyWin,_super);function GuildApplyWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.dataArr=new eui.ArrayCollection([]);_this.skinName="GuildApplySkin";_this.list.itemRenderer=GuildListItemRender;_this.list.dataProvider=_this.dataArr;return _this}GuildApplyWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!Guild.ins().isOpen()){UserTips.ins().showTips(i18n("GuildMap_1"));return false}if(Guild.ins().isInGuild()){UserTips.ins().showTips(i18n("GuildApplyWin_0"));return false}return true};GuildApplyWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.createBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.list,this.onListTouch);this.observe(Guild.ins().postGuildList,this.updateList);Guild.ins().sendGuildList()};GuildApplyWin.prototype.onListTouch=function(e){if(e.target instanceof eui.Button){var item=e.target.parent;item.onTap()}};GuildApplyWin.prototype.updateList=function(){this.noGuild.visible=Guild.ins().guildListInfos.length==0;this.dataArr.replaceAll(Guild.ins().guildListInfos)};GuildApplyWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.createBtn:ViewManager.ins().open(GuildCreateWin);break}};GuildApplyWin.prototype.destoryView=function(){_super.prototype.destoryView.call(this);for(var i=0;i<this.list.numElements;i++){if(this.list.getElementAt(i))this.list.getElementAt(i).destruct()}};return GuildApplyWin}(BaseEuiView);__reflect(GuildApplyWin.prototype,"GuildApplyWin");ViewManager.ins().reg(GuildApplyWin,LayerManager.UI_Popup);var GuildBuildItemRender=function(_super){__extends(GuildBuildItemRender,_super);function GuildBuildItemRender(){var _this=_super.call(this)||this;_this._maxLevel=0;_this._curLevel=0;_this._nextMoney=0;_this.skinName="GuildManageItemSkin";return _this}GuildBuildItemRender.prototype.onTap=function(e){switch(e){case this.upBtn:var type=this.data;if(Guild.ins().myOffice<GuildOffice.GUILD_FUBANGZHU){UserTips.ins().showTips(i18n("GuildBuildItemRender_0"));return}else if(type==GuildBuilding.GUILD_HALL&&this._curLevel>=this._maxLevel){UserTips.ins().showTips(i18n("GuildBuildItemRender_1"));return}else if(type!=GuildBuilding.GUILD_HALL&&this._curLevel>=Guild.ins().guildLv){UserTips.ins().showTips(i18n("GuildBuildItemRender_2"));return}else if(Guild.ins().money<this._nextMoney){UserTips.ins().showTips(i18n("GuildBuildItemRender_3"));return}Guild.ins().sendUpBuilding(type);break}};GuildBuildItemRender.prototype.dataChanged=function(){var type=this.data;this.buildImg.visible=type==1;this._curLevel=Guild.ins().getBuildingLevels(type-1)||0;var glc=GlobalConfig.GuildLevelConfig[type];var dp=null;var dpNext=null;for(var key in glc){if(glc.hasOwnProperty(key)){var element=glc[key];this._maxLevel=element.level>this._maxLevel?element.level:this._maxLevel;if(element.level==this._curLevel)dp=element;if(element.level==this._curLevel+1)dpNext=element}}if(dp||dpNext||type==GuildBuilding.GUILD_LIANGONGFANG){this.nameLab.text=GlobalConfig.GuildConfig.buildingNames[type-1];this.levelLab.text=i18n("GuildBuildItemRender_4")+(this._curLevel==null?0:this._curLevel);if(dpNext&&this._curLevel<this._maxLevel){this._nextMoney=dpNext.upFund;this.upLevelLab.text=type==GuildBuilding.GUILD_HALL?"":i18n("GuildBuildItemRender_5",this._curLevel+1);this.money.text=Guild.ins().money+"/"+dpNext.upFund;this.needMoney.text=i18n("GuildBuildItemRender_6",dpNext.upFund/1e4+"万");this.progress.maximum=dpNext.upFund;this.progress.value=Guild.ins().money;this.progress.visible=true}else{this.upLevelLab.text=i18n("GuildBuildItemRender_7");if(dp)this.money.text=Guild.ins().money+"/"+dp.upFund;else this.money.text=i18n("GuildBuildItemRender_8");this.needMoney.text="";this.progress.visible=false}this.buildingLab.text=GlobalConfig.GuildConfig.buildingTips[type-1]}this.manege.source="guildmn"+type+"_png";if(type==GuildBuilding.GUILD_SHOP){this.progress.visible=this.progressbg.visible=this.progressblack.visible=this.levelLab.visible=this.needMoney.visible=this.money.visible=false;this.upBtn.touchEnabled=false;this.upBtn.label=i18n("GuildBuildItemRender_9");this.upBtn.currentState="disabled";this.upBtn.verticalCenter=0}this.updateRedPoint()};GuildBuildItemRender.prototype.updateRedPoint=function(){var type=this.data;if(type==GuildBuilding.GUILD_SHOP){this.redPoint.visible=false;return}if(Guild.ins().myOffice<GuildOffice.GUILD_FUBANGZHU){this.redPoint.visible=false;return}else if(type==GuildBuilding.GUILD_HALL&&this._curLevel>=this._maxLevel){this.redPoint.visible=false;return}else if(type!=GuildBuilding.GUILD_HALL&&this._curLevel>=Guild.ins().guildLv){this.redPoint.visible=false;return}else if(Guild.ins().money<this._nextMoney){this.redPoint.visible=false;return}this.redPoint.visible=true};return GuildBuildItemRender}(BaseItemRender);__reflect(GuildBuildItemRender.prototype,"GuildBuildItemRender");var GuildChangeNameView=function(_super){__extends(GuildChangeNameView,_super);function GuildChangeNameView(){var _this=_super.call(this)||this;_this.skinName="guildNameChange";return _this}GuildChangeNameView.prototype.open=function(){this.addTouchEvent(this.sureBtn,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap)};GuildChangeNameView.prototype.onTap=function(e){var tar=e.currentTarget;switch(tar){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.sureBtn:this.onChangeName();break}};GuildChangeNameView.prototype.onChangeName=function(){if(this.input.text=="")UserTips.ins().showTips(i18n("GuildChangeNameView_0"));else{Guild.ins().sendGuildChangeName(this.input.text);ViewManager.ins().close(this)}};return GuildChangeNameView}(BaseEuiView);__reflect(GuildChangeNameView.prototype,"GuildChangeNameView");ViewManager.ins().reg(GuildChangeNameView,LayerManager.UI_Popup);var GuildConWin=function(_super){__extends(GuildConWin,_super);function GuildConWin(){return _super.call(this)||this}GuildConWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GuildConSkin";this.desc0.text=i18n("GuildConWin_0")+GlobalConfig.GuildDonateConfig[1].count+i18n("GuildConWin_1");this.desc1.text=i18n("GuildConWin_2")+GlobalConfig.GuildDonateConfig[2].count+i18n("GuildConWin_3");this.info0.text=i18n("GuildConWin_4")+GlobalConfig.GuildDonateConfig[1].awardContri+i18n("GuildConWin_5")+GlobalConfig.GuildDonateConfig[1].awardFund;this.info1.text=i18n("GuildConWin_6")+GlobalConfig.GuildDonateConfig[2].awardContri+i18n("GuildConWin_7")+GlobalConfig.GuildDonateConfig[2].awardFund};GuildConWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};GuildConWin.prototype.update=function(){var num=GlobalConfig.GuildDonateConfig[1].dayCount[UserVip.ins().lv];var nextNum=GlobalConfig.GuildDonateConfig[1].dayCount[UserVip.ins().lv+1];var arr=Guild.ins().getConCount();if(arr[0]<=0){if(nextNum&&nextNum-num>0)this.count0.textFlow=(new egret.HtmlTextParser).parser("<font color='#f3311e'>尊者"+(UserVip.ins().lv+1)+i18n("GuildConWin_8")+(nextNum-num)+i18n("GuildConWin_9"));else this.count0.text=num-arr[0]+"/"+GlobalConfig.GuildDonateConfig[1].dayCount[UserVip.ins().lv];this.btn0.enabled=false}else{this.btn0.enabled=true;this.count0.text=num-arr[0]+"/"+GlobalConfig.GuildDonateConfig[1].dayCount[UserVip.ins().lv]}this.btn1.enabled=arr[1]>0;this.count1.text=GlobalConfig.GuildDonateConfig[2].dayCount-arr[1]+"/"+GlobalConfig.GuildDonateConfig[2].dayCount};GuildConWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.btn0,this.onTap);this.addTouchEvent(this.btn1,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.observe(Guild.ins().postConCount,this.update);Guild.ins().sendConCount();if(UserVip.ins().lv==0)this.btn0.label=i18n("GuildConWin_10");else this.btn0.label=i18n("GuildConWin_11")};GuildConWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.btn0,this.onTap);this.removeTouchEvent(this.btn1,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeObserve()};GuildConWin.prototype.onTap=function(e){var arr=Guild.ins().getConCount();switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.btn0:if(UserVip.ins().lv==0)ViewManager.ins().open(VipWin);else if(arr[0]<=0)UserTips.ins().showTips(i18n("GuildConWin_12"));else if(Actor.yb>=GlobalConfig.GuildDonateConfig[1].count){Guild.ins().sendCon(1)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("GuildConWin_13"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GuildConWin_14"))}ViewManager.ins().close(this)}break;case this.btn1:if(arr[1]<=0)UserTips.ins().showTips(i18n("GuildConWin_15"));else if(Actor.gold>=GlobalConfig.GuildDonateConfig[2].count){Guild.ins().sendCon(2)}else UserTips.ins().showTips(i18n("GuildConWin_16"));break;case this.bgClose:ViewManager.ins().close(this);break}};return GuildConWin}(BaseEuiView);__reflect(GuildConWin.prototype,"GuildConWin");ViewManager.ins().reg(GuildConWin,LayerManager.UI_Popup);var GuildCreateWin=function(_super){__extends(GuildCreateWin,_super);function GuildCreateWin(){var _this=_super.call(this)||this;_this.selectLevel=1;_this.createLvLimit=60;return _this}GuildCreateWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GuildBuildSkin";this.warnTxt.visible=false;this.leftLab.textFlow=(new egret.HtmlTextParser).parser(this.formatLab(1));this.rightLab.textFlow=(new egret.HtmlTextParser).parser(this.formatLab(2))};GuildCreateWin.prototype.changeSelect=function(id){this.selectLevel=id;this.selectBmp1.visible=id==1?true:false;this.selectBmp2.visible=id==2?true:false};GuildCreateWin.prototype.formatLab=function(level){var gcc=GlobalConfig.GuildCreateConfig;var gc=GlobalConfig.GuildConfig;var vipLv=gcc[level].vipLv;var vipDesc=vipLv>0?i18n("GuildCreateWin_0",vipLv):"";var tempAward=gcc[level].award==0?"\n":i18n("GuildCreateWin_1")+gcc[level].award.toString()+i18n("GuildCreateWin_2");var content="<font color='#F3311E' size='20'>"+gcc[level].level.toString()+i18n("GuildCreateWin_3")+"\n"+vipDesc+i18n("GuildCreateWin_4")+gc.maxMember[level-1]+i18n("GuildCreateWin_5")+tempAward+i18n("GuildCreateWin_6")+gcc[level].moneyCount.toString()+i18n("GuildCreateWin_7");var str="<font color='#21639E' size='16'>"+content+"</font>";return str};GuildCreateWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};GuildCreateWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var lv=param[0]||1;this.changeSelect(lv);this.addTouchEvent(this.leftLab,this.onTap);this.addTouchEvent(this.rightLab,this.onTap);this.addTouchEvent(this.okBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.warnTxt.visible=false};GuildCreateWin.prototype.onTap=function(e){var _this=this;switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.okBtn:{var gcc=GlobalConfig.GuildCreateConfig;var dp=gcc[this.selectLevel];var vipLv=gcc[dp.level].vipLv;if(UserVip.ins().lv<vipLv){var warnWin=WarnWin.show(i18n("GuildCreateWin_9"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GuildCreateWin_10"));return}if(Actor.level<60){this.warnTxt.visible=true;this.warnTxt.text=i18n("GuildCreateWin_15",this.createLvLimit);return}if(this.textInput.text=="")UserTips.ins().showTips(i18n("GuildCreateWin_11"));else if(Actor.yb<dp.moneyCount){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("GuildCreateWin_12"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GuildCreateWin_13"))}ViewManager.ins().close(this)}else{WarnWin.show(i18n("GuildCreateWin_14",dp.moneyCount,dp.level,this.textInput.text),function(){Guild.ins().sendGuildCreate(_this.selectLevel,_this.textInput.text);_this.textInput.text=""},this)}break}case this.leftLab:this.changeSelect(1);break;case this.rightLab:this.changeSelect(2);break}};return GuildCreateWin}(BaseEuiView);__reflect(GuildCreateWin.prototype,"GuildCreateWin");ViewManager.ins().reg(GuildCreateWin,LayerManager.UI_Popup);var GuildEventItenRender=function(_super){__extends(GuildEventItenRender,_super);function GuildEventItenRender(){var _this=_super.call(this)||this;_this.skinName="GuildEventItemSkin";return _this}GuildEventItenRender.prototype.dataChanged=function(){if(typeof this.data=="string"){var str=this.data;if(str&&str!="")this.info.textFlow=(new egret.HtmlTextParser).parser(str)}};return GuildEventItenRender}(BaseItemRender);__reflect(GuildEventItenRender.prototype,"GuildEventItenRender");var GuildFirePanel=function(_super){__extends(GuildFirePanel,_super);function GuildFirePanel(){var _this=_super.call(this)||this;_this.itemCount=0;return _this}GuildFirePanel.prototype.open=function(){this.addTouchEvent(this.give,this.onGive);this.observe(Guild.ins().postUpdateFire,this.update);this.update()};GuildFirePanel.prototype.close=function(){this.removeTouchEvent(this.give,this.onGive);this.removeObserve()};GuildFirePanel.prototype.update=function(){var fireDic=Guild.ins().fireDic;if(fireDic.fireLvl>0){this.firestar.visible=true}else{this.firestar.visible=false}var lv=0;while(true){if(this["lv"+lv]){this["lv"+lv].visible=fireDic.fireLvl>=lv;if(this["fire"+lv])this["fire"+lv].visible=fireDic.fireLvl==lv}else{break}lv+=1}var config=GlobalConfig.GuildBonFireConfig[fireDic.fireLvl];var nextConf=GlobalConfig.GuildBonFireConfig[fireDic.fireLvl+1];if(config){this.progressBar.maximum=config.value;this.progressBar.value=fireDic.fireVal}else{this.progressBar.maximum=100;this.progressBar.value=100}var conf=GlobalConfig.GuildConfig;var item=UserBag.ins().getBagItemById(conf.bonfireItem);if(item){this.count.text=""+item.count;this.cha.textColor=this.count.textColor=242004;this.itemCount=item.count;this.redPoint.visible=true}else{this.count.text="0";this.cha.textColor=this.count.textColor=16711680;this.itemCount=0;this.redPoint.visible=false}if(nextConf){this.desc1.textFlow=TextFlowMaker.generateTextFlow1(i18n("GuildFirePanel_0",conf.bonfireValue,conf.bonfireReward[0].count));this.desc2.textFlow=TextFlowMaker.generateTextFlow1(i18n("GuildFirePanel_1",(config.value-fireDic.fireVal)/conf.bonfireValue,nextConf.reward))}else{this.desc1.textFlow=TextFlowMaker.generateTextFlow1(i18n("GuildFirePanel_2",conf.bonfireValue,conf.bonfireReward[0].count));this.desc2.textFlow=TextFlowMaker.generateTextFlow1(i18n("GuildFirePanel_3",config.reward))}};GuildFirePanel.prototype.onGive=function(){if(this.itemCount>0){var count=GlobalConfig.GuildConfig.bonfirecount;if(this.itemCount<count)count=this.itemCount;this.itemCount-=count;Guild.ins().sendToFire(count,this.itemCount)}else{UserTips.ins().showTips(i18n("GuildFirePanel_4"))}};return GuildFirePanel}(BaseView);__reflect(GuildFirePanel.prototype,"GuildFirePanel");var GuildListItem2Render=function(_super){__extends(GuildListItem2Render,_super);function GuildListItem2Render(){var _this=_super.call(this)||this;_this.skinName="GuildListItemSkin";return _this}GuildListItem2Render.prototype.dataChanged=function(){if(this.data instanceof GuildListInfo){var info=this.data;var gc=GlobalConfig.GuildConfig;if(info&&gc){if(info.guildRank<4){this.numImg.source="guildshop_json.guildpaihang"+info.guildRank;this.numLab.visible=false;this.numImg.visible=true}else{this.numLab.text=info.guildRank+"";this.numLab.visible=true;this.numImg.visible=false}this.nameLab.textFlow=(new egret.HtmlTextParser).parser(info.guildName);this.member0.text=""+info.guildLevel;this.president.text=info.guildPresident;var commentLv=info.commentLv||0;var exmember=commentLv?GlobalConfig.GuildConfig.affairMember[commentLv-1]:0;this.member.text=info.guildMember+"/"+(gc.maxMember[info.guildLevel-1]+exmember);this.attrLab.text=""+info.attr}}};return GuildListItem2Render}(BaseItemRender);__reflect(GuildListItem2Render.prototype,"GuildListItem2Render");var GuildListItemRender=function(_super){__extends(GuildListItemRender,_super);function GuildListItemRender(){var _this=_super.call(this)||this;_this.skinName="ApplyItemSkin";return _this}GuildListItemRender.prototype.onTap=function(){if(GuildWar.ins().getModel().isWatStart){WarnWin.show(i18n("GuildListItemRender_0"),function(){},this);return}var info=this.data;if(Guild.ins().applyGuilds.indexOf(info.guildID)==-1){if(this.data.attr>Actor.power){UserTips.ins().showTips(i18n("GuildListItemRender_1"));return}this.applyBtn.enabled=false;this.applyBtn.label=i18n("GuildListItemRender_2");Guild.ins().applyGuilds.push(info.guildID);Guild.ins().sendJoinGuild(info.guildID)}};GuildListItemRender.prototype.dataChanged=function(){if(this.data instanceof GuildListInfo){var info=this.data;var gc=GlobalConfig.GuildConfig;if(info&&gc){this.numLab.text=info.guildRank+"";this.nameLab.textFlow=(new egret.HtmlTextParser).parser(info.guildName+("<font color='#dd49ac'>("+info.guildLevel+"级)</font>"));this.president.text=info.guildPresident;var exmember=info.commentLv?GlobalConfig.GuildConfig.affairMember[info.commentLv-1]:0;this.member.textColor=info.guildMember<gc.maxMember[info.guildLevel-1]+exmember?5226466:15937822;this.member.text=info.guildMember+"/"+(gc.maxMember[info.guildLevel-1]+exmember);var powers=CommonUtils.overLength(info.attr);this.attrLabel.visible=powers?true:false;if(powers)this.attrLabel.text=i18n("GuildListItemRender_3")+powers;if(Guild.ins().applyGuilds.indexOf(info.guildID)>-1){this.applyBtn.enabled=false;this.applyBtn.label=i18n("GuildListItemRender_4")}else{this.applyBtn.enabled=true;this.applyBtn.label=i18n("GuildListItemRender_5")}}}};GuildListItemRender.prototype.destruct=function(){};return GuildListItemRender}(BaseItemRender);__reflect(GuildListItemRender.prototype,"GuildListItemRender");var GuildMap=function(_super){__extends(GuildMap,_super);function GuildMap(){var _this=_super.call(this)||this;_this.isPlayOpenSound=true;return _this}GuildMap.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="GuildSkin";this.list.itemRenderer=GuildMapMemberItemRender;this.guildWarEffect2=new MovieClip;this.guildRewardEff=new MovieClip;this.guildRewardEff.touchEnabled=true};GuildMap.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!Guild.ins().isOpen()){UserTips.ins().showTips(i18n("GuildMap_1"));return false}if(!Guild.ins().isInGuild()){UserTips.ins().showTips(i18n("GuildWin_0"));return false}return true};GuildMap.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.manageBtn,this.onTap);this.addTouchEvent(this.practiseBtn,this.onTap);this.addTouchEvent(this.shopBtn,this.onTap);this.addTouchEvent(this.cityBtn,this.onTap);this.addTouchEvent(this.chatBtn,this.onTap);this.addTouchEvent(this.guildRewardEff,this.onTap);this.observe(GuildRedPoint.ins().postGuildFire,this.updateRedpoint);this.observe(GuildBoss.ins().postGuildBossDetailChange,this.updateRedpoint);this.observe(GuildBoxMgr.ins().postBoxInfoChanged,this.updateRedpoint);Guild.ins().sendMyGuildInfo();GuildWar.ins().requestGuildRank();GuildBoss.ins().sendGetBossInfo();this.updateRedpoint();if(GuildRobber.ins().isUpdateRobber){GuildRobber.ins().isUpdateRobber=false;GuildRobber.ins().sendRobberInfo()}this.observe(GuildWar.ins().postGuildWarStarInfo,this.refushGuildwarEffect);this.refushGuildwarEffect();this.observe(GuildRedPoint.ins().postSendReward,this.updateSendBtnStatu);this.updateSendBtnStatu();this.observe(GuildRedPoint.ins().postSczb,this.updateGuildPoint);this.updateGuildPoint();this.observe(GuildRedPoint.ins().postHhdt,this.hhdtRed);this.hhdtRed();this.observe(GuildRedPoint.ins().postHanghuiBoss,this.updateBossPoint);this.updateBossPoint();this.observe(Guild.ins().postGuildMembers,this.updateList);this.updateList()};GuildMap.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}DisplayUtils.removeFromParent(this.guildWarEffect2);DisplayUtils.removeFromParent(this.guildRewardEff)};GuildMap.prototype.hhdtRed=function(){this.redPoint0.visible=GuildRedPoint.ins().hhdt};GuildMap.prototype.updateRedpoint=function(){this.redPoint1.visible=GuildBoxMgr.ins().isHasReward()||GuildRedPoint.ins().guildFire||GuildRedPoint.ins().liangongRed};GuildMap.prototype.updateGuildPoint=function(){this.redPoint2.visible=GuildRedPoint.ins().sczb};GuildMap.prototype.updateBossPoint=function(){this.redPoint3.visible=GuildRedPoint.ins().hhBoss};GuildMap.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(Guild.ins().getGuildMembers(2))};GuildMap.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(GuildMap);break;case this.practiseBtn:ViewManager.ins().close(GuildMap);ViewManager.ins().open(GuildSkillWin);break;case this.manageBtn:ViewManager.ins().close(GuildMap);ViewManager.ins().open(GuildWin);break;case this.cityBtn:if(UserFb.ins().isCloseFbEntrance){UserTips.ins().showTips(i18n("GuildMap_0"))}else{GuildWar.ins().requestWinGuildInfo();ViewManager.ins().close(GuildMap);ViewManager.ins().open(GuildWarMainWin)}break;case this.shopBtn:ViewManager.ins().open(GuildBossWin);break;case this.chatBtn:ViewManager.ins().open(ChatWin);break;case this.rewardBtn:ViewManager.ins().open(SelectMemberRewardWin);break}};GuildMap.prototype.updateSendBtnStatu=function(){if(GuildRedPoint.ins().sendReward){this.rewardBtn.visible=true;this.addTouchEvent(this.rewardBtn,this.onTap);this.guildRewardEff.playFile(RES_DIR_EFF+"giftShake",-1);this.reward.addChild(this.guildRewardEff)}else{this.rewardBtn.visible=false;this.removeTouchEvent(this.rewardBtn,this.onTap);DisplayUtils.removeFromParent(this.guildRewardEff)}};GuildMap.prototype.refushGuildwarEffect=function(){if(GuildWar.ins().getModel().isWatStart){this.guildWarEffect2.playFile(RES_DIR_EFF+"swordSparkEff",-1);this.guildWarEffect2.x=28;this.guildWarEffect2.y=30;this.guildWarEffectPoint.addChild(this.guildWarEffect2)}else{DisplayUtils.removeFromParent(this.guildWarEffect2)}};return GuildMap}(BaseEuiView);__reflect(GuildMap.prototype,"GuildMap");ViewManager.ins().reg(GuildMap,LayerManager.UI_Popup);var GuildMapMemberItemRender=function(_super){__extends(GuildMapMemberItemRender,_super);function GuildMapMemberItemRender(){var _this=_super.call(this)||this;_this.skinName="gongxianitemSkin";return _this}GuildMapMemberItemRender.prototype.dataChanged=function(){if(this.data instanceof GuildMemberInfo){var info=this.data;if(info){this.nameLab.text=info.name;this.office.text=GuildLanguage.guildOffice[info.office];this.conLab.text=info.curContribution+""}}};return GuildMapMemberItemRender}(BaseItemRender);__reflect(GuildMapMemberItemRender.prototype,"GuildMapMemberItemRender");var GuildMemberItem1Render=function(_super){__extends(GuildMemberItem1Render,_super);function GuildMemberItem1Render(){var _this=_super.call(this)||this;_this.skinName="MemberItemSkin";return _this}GuildMemberItem1Render.prototype.dataChanged=function(){if(this.data instanceof GuildMemberInfo){var info=this.data;if(info){this.nameLab.text=info.name;this.office.text=GuildLanguage.guildOffice[info.office];this.conLab.text=info.contribution+"";this.monthcard.visible=false;this.vip.removeChildren();this.vip.visible=info.vipLevel>0;this.vipTitle.visible=info.vipLevel>0;if(info.vipLevel<10){this.vipNum=BitmapNumber.ins().createNumPic(info.vipLevel,"vip_v")}else{this.vipNum=BitmapNumber.ins().createNumPic(1,"vip_v");this.vipNum0=BitmapNumber.ins().createNumPic(0,"vip_v");this.vipNum0.x=33;this.vipNum0.y=-1;this.vip.addChild(this.vipNum0)}this.vipNum.x=18;this.vipNum.y=-1;this.vip.addChild(this.vipNum)}}};return GuildMemberItem1Render}(BaseItemRender);__reflect(GuildMemberItem1Render.prototype,"GuildMemberItem1Render");var GuildMemberItem2Render=function(_super){__extends(GuildMemberItem2Render,_super);function GuildMemberItem2Render(){var _this=_super.call(this)||this;_this.skinName="MemberItem2Skin";return _this}GuildMemberItem2Render.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this);if(!this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){MessageCenter.ins().removeAll(_this)},this)}this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){if(e.target instanceof eui.Button){return}if(_this.data)ViewManager.ins().open(PlayerTipsWin,_this.data)},this)};GuildMemberItem2Render.prototype.onTap=function(e){var _this=this;if(GuildWar.ins().getModel().isWatStart){WarnWin.show(i18n("GuildMemberItemRender_0"),function(){},this);return}var info=this.data;var roleID=info.roleID;switch(e){case this.impeachBtn:WarnWin.show(i18n("GuildMemberItemRender_1",GlobalConfig.GuildConfig.impeachCost),function(){if(Actor.yb>=GlobalConfig.GuildConfig.impeachCost){Guild.ins().sendDemise()}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("GuildMemberItemRender_2"),function(){Recharge.ins().tryShowChargeFirstWin()},_this,null,null,"sure");warnWin.setBtnLabel(i18n("GuildMemberItemRender_3"))}}},this);break;case this.demiseBtn:WarnWin.show(i18n("GuildMemberItemRender_4",info.name),function(){Guild.ins().sendChangeOffice(roleID,GuildOffice.GUILD_BANGZHU)},this);break;case this.downBtn:WarnWin.show(i18n("GuildMemberItemRender_5",info.name),function(){Guild.ins().sendChangeOffice(roleID,GuildOffice.GUILD_MEMBER)},this);break;case this.kickBtn:WarnWin.show(i18n("GuildMemberItemRender_6",info.name),function(){Guild.ins().sendKick(roleID)},this);break;case this.appointBtn:WarnWin.show(i18n("GuildMemberItemRender_7",info.name),function(){if(Guild.ins().canAppointFHZ()){Guild.ins().sendChangeOffice(roleID,GuildOffice.GUILD_FUBANGZHU)}else UserTips.ins().showTips(i18n("GuildMemberItemRender_8"))},this);break;default:ViewManager.ins().open(PlayerTipsWin,this.data);break}};GuildMemberItem2Render.prototype.dataChanged=function(){if(this.data instanceof GuildMemberInfo){var info=this.data;this.nameLab.textFlow=(new egret.HtmlTextParser).parser("["+GuildLanguage.guildOffice[info.office]+"]<font color='#21639E'>"+info.name+"</font>");this.conLab.text=i18n("GuildMemberItemRender_9")+info.contribution;this.attack.text=i18n("GuildMemberItemRender_10")+info.attack;var job=fixJob(info.job);var sex=fixSex(info.sex);this.face.source="head_"+job+sex;this.headBG.source=ChatListItemRenderer.HEAD_BG[info.sex];var downTime=0;var myOfiice=Guild.ins().myOffice;if(myOfiice==GuildOffice.GUILD_BANGZHU||myOfiice==GuildOffice.GUILD_FUBANGZHU){this.onLine.visible=true;if(info.downTime>0){downTime=(GameServer.serverTime-DateUtils.formatMiniDateTime(info.downTime))*.001;this.onLine.textFlow=TextFlowMaker.generateTextFlow1(i18n("GuildMemberItemRender_12",DateUtils.getFormatBySecond(downTime,7)))}else this.onLine.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildMemberItemRender_11"))}else{this.onLine.visible=false}this.group1.visible=false;this.group2.visible=false;this.group3.visible=false;this.impeachBtn.visible=downTime>=432e3;this.vip.removeChildren();this.vip.visible=info.vipLevel>0;this.vipTitle.visible=info.vipLevel>0;if(info.vipLevel<10){this.vipNum=BitmapNumber.ins().createNumPic(info.vipLevel,"vip_v")}else{this.vipNum=BitmapNumber.ins().createNumPic(1,"vip_v");this.vipNum0=BitmapNumber.ins().createNumPic(0,"vip_v");this.vipNum0.x=33;this.vipNum0.y=-1;this.vip.addChild(this.vipNum0)}this.vipNum.x=18;this.vipNum.y=-1;this.vip.addChild(this.vipNum);switch(myOfiice){case GuildOffice.GUILD_BANGZHU:{if(info.office==GuildOffice.GUILD_BANGZHU)break;else if(info.office==GuildOffice.GUILD_FUBANGZHU){this.group2.visible=true}else{this.group3.visible=true;this.appointBtn.visible=true}}break;case GuildOffice.GUILD_FUBANGZHU:if(info.office==GuildOffice.GUILD_BANGZHU){this.group1.visible=true}else if(info.office==GuildOffice.GUILD_FUBANGZHU)break;else{this.group3.visible=true;this.appointBtn.visible=false}break;case GuildOffice.GUILD_ZHANGLAO:case GuildOffice.GUILD_HUFA:case GuildOffice.GUILD_TANGZHU:if(info.office==GuildOffice.GUILD_BANGZHU)this.group1.visible=true;break;default:break}}};return GuildMemberItem2Render}(BaseItemRender);__reflect(GuildMemberItem2Render.prototype,"GuildMemberItem2Render");var GuildMosterPanel=function(_super){__extends(GuildMosterPanel,_super);function GuildMosterPanel(){var _this=_super.call(this)||this;_this.bossmc=new MovieClip;_this.bossmc.scaleX=-.5;_this.bossmc.scaleY=.5;_this.bossmc.x=0;_this.bossmc.y=0;_this.addChild(_this.bossmc);_this.staticMc=new MovieClip;_this.addChild(_this.staticMc);_this.staticMc.y=-60;_this.addTouchEvent(_this,_this.onTap);return _this}GuildMosterPanel.prototype.onTap=function(e){if(this.start.robberStart==1){UserTips.ins().showTips(i18n("GuildMosterPanel_0"));return}GuildRobber.ins().sendRobberChanger(this.index);ViewManager.ins().close(GuildMap)};GuildMosterPanel.prototype.update=function(info,bossnum,p){this.start=info;var monster="";this.bossmc.playFile(RES_DIR_EFF+("monster"+monster+"_"+p+"s"),-1);this.index=bossnum+1;this.staticMc.playFile(RES_DIR_EFF+(info.robberStart==0?"ketiaozhan":"zhandouzhong"),-1)};return GuildMosterPanel}(BaseView);__reflect(GuildMosterPanel.prototype,"GuildMosterPanel");var GuildNoticeWin=function(_super){__extends(GuildNoticeWin,_super);function GuildNoticeWin(){return _super.call(this)||this}GuildNoticeWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GuildNoticeSkin"};GuildNoticeWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.closeBtn1,this.onTap);this.addTouchEvent(this.saveBtn,this.onTap);this.addTouchEvent(this.bgrect,this.onTap);this.observe(Guild.ins().postChangeNotice,this.updateText);this.textInput.text=Guild.ins().notice};GuildNoticeWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.closeBtn1,this.onTap);this.removeTouchEvent(this.saveBtn,this.onTap);this.removeTouchEvent(this.bgrect,this.onTap)};GuildNoticeWin.prototype.updateText=function(){this.textInput.text="";ViewManager.ins().close(this)};GuildNoticeWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn0:case this.closeBtn1:case this.bgrect:ViewManager.ins().close(this);break;case this.saveBtn:Guild.ins().notice=this.textInput.text;Guild.ins().sendChangeNotice(this.textInput.text);break}};return GuildNoticeWin}(BaseEuiView);__reflect(GuildNoticeWin.prototype,"GuildNoticeWin");ViewManager.ins().reg(GuildNoticeWin,LayerManager.UI_Main);var GuildShopPanel=function(_super){__extends(GuildShopPanel,_super);function GuildShopPanel(){var _this=_super.call(this)||this;_this.isOpenEff=false;_this.initUI();return _this}GuildShopPanel.prototype.initUI=function(){this.skinName="GuildStoreWinSkin"};GuildShopPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.guildshopkaiqi,this.onTap);this.addTouchEvent(this.useBtn,this.onTap);this.addTouchEvent(this.guildMore,this.onTap);GuildStore.ins().getGuildStoreInfo();GuildStore.ins().sendGuildStoreBoxInfo();this.observe(GuildStore.ins().postGuildStoreInfo,this.onupdateData);this.observe(GuildStore.ins().postGuildStoreBox,this.onItemInfo);this.observe(GuildStore.ins().postGuildStoreBoxInfo,this.onReadInfo);this.onupdateData();this.guildshopitem_7.visible=false};GuildShopPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.guildshopkaiqi,this.onTap);this.removeTouchEvent(this.useBtn,this.onTap);this.removeTouchEvent(this.guildMore,this.onTap);this.removeObserve()};GuildShopPanel.prototype.onupdateData=function(){if(GuildStore.ins().guildStoreLv>0){this.guildshopopen.visible=true;this.guildshopclose.visible=false;this.guildshopclose.touchEnabled=false;this.guildshopopen.touchEnabled=true;if(GlobalConfig.GuildStoreConfig.needContrib>Guild.ins().myCon)this.guildshoplabel.textFlow=(new egret.HtmlTextParser).parser(Guild.ins().myCon+"");else this.guildshoplabel.textFlow=(new egret.HtmlTextParser).parser(Guild.ins().myCon+"");this.guildshopxiaolabel.text=""+GlobalConfig.GuildStoreConfig.needContrib;var totalNum=GlobalConfig.GuildStoreConfig.time[GuildStore.ins().guildStoreLv-1];var nextTotalNum=GlobalConfig.GuildStoreConfig.time[GuildStore.ins().guildStoreLv];var str="";if(GuildStore.ins().guildStoreNum<=0){str="<font color='#f3311e'>"+GuildStore.ins().guildStoreNum+"/"+totalNum+"</font>"}else{str=GuildStore.ins().guildStoreNum+"/"+totalNum}if(nextTotalNum)this.guildshopshengyulabel.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildShopPanel_0")+str);else this.guildshopshengyulabel.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildShopPanel_1")+str)}else{this.guildshopopen.visible=false;this.guildshopopen.touchEnabled=false;this.guildshopclose.touchEnabled=true;this.guildshopclose.visible=true;this.guildshopkaiqi.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildShopPanel_2"))}for(var k in GlobalConfig.GuildStoreConfig.item){this["guildshopitem_"+k].data=GlobalConfig.GuildStoreConfig.item[k]}this.guildMore.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildShopPanel_3"))};GuildShopPanel.prototype.onReadInfo=function(){var arr=GuildStore.ins().getRecordInfoAry();if(arr.length>0){this.record.visible=true;var config=GlobalConfig.ItemConfig[arr[0].itemId];var q=ItemConfig.getQualityColor(config);this.record.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildShopPanel_4",arr[0].roleName,q,config.name));if(arr.length>1){this.record1.visible=true;var config_5=GlobalConfig.ItemConfig[arr[1].itemId];this.record1.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildShopPanel_5",arr[1].roleName,q,config_5.name))}if(arr.length>2){this.record2.visible=true;var config_6=GlobalConfig.ItemConfig[arr[2].itemId];this.record2.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildShopPanel_6",arr[2].roleName,q,config_6.name))}}else{this.record.visible=false;this.record1.visible=false;this.record2.visible=false}};GuildShopPanel.prototype.onItemInfo=function(){this.guildshopitem_7.visible=true;var guildStoreItemData=GuildStore.ins().getGuildStoreItemData(0);this.guildshopitem_7.num=guildStoreItemData.num;this.guildshopitem_7.data=guildStoreItemData.itemId;this.onupdateData()};GuildShopPanel.prototype.startEff=function(){var _this=this;this.guildshopitem_7.visible=false;this.isOpenEff=true;this.openBoxEff=new MovieClip;this.openBoxEff.x=232;this.openBoxEff.y=287;this.openBoxEff.playFile(RES_DIR_EFF+"kaibaoxiang",1,function(){GuildStore.ins().sendGuildStoreBox();_this.isOpenEff=false});this.addChild(this.openBoxEff)};GuildShopPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break;case this.guildshopkaiqi:ViewManager.ins().open(GuildWin,1);break;case this.useBtn:if(GuildStore.ins().guildStoreNum<=0){UserTips.ins().showTips(i18n("GuildShopPanel_7"));return}if(GlobalConfig.GuildStoreConfig.needContrib>Guild.ins().myCon){UserTips.ins().showTips(i18n("GuildShopPanel_8"));return}if(UserBag.ins().getSurplusCount()<=0){UserTips.ins().showTips(i18n("GuildShopPanel_9"));return}if(this.isOpenEff==false)this.startEff();break;case this.guildMore:ViewManager.ins().open(GuildShopRecordWin);break}};return GuildShopPanel}(BaseComponent);__reflect(GuildShopPanel.prototype,"GuildShopPanel");var GuildShopRecordItemRender=function(_super){__extends(GuildShopRecordItemRender,_super);function GuildShopRecordItemRender(){var _this=_super.call(this)||this;_this.skinName="GuildStoreItemSkin";return _this}GuildShopRecordItemRender.prototype.dataChanged=function(){if(this.data instanceof GuildStoreRecordInfo){var config=GlobalConfig.ItemConfig[this.data.itemId];if(config)this.rank.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildShopRecordItemRender_0",this.data.roleName,ItemConfig.getQualityColor(config),config.name));else this.rank.text=""}};return GuildShopRecordItemRender}(BaseItemRender);__reflect(GuildShopRecordItemRender.prototype,"GuildShopRecordItemRender");var GuildShopRecordWin=function(_super){__extends(GuildShopRecordWin,_super);function GuildShopRecordWin(){return _super.call(this)||this}GuildShopRecordWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GuildStoreInfoSkin";this.list.itemRenderer=GuildShopRecordItemRender;this.arrList=new eui.ArrayCollection};GuildShopRecordWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.closeBtn1,this.onTap);this.arrList.replaceAll(GuildStore.ins().getRecordInfoAry());this.list.dataProvider=this.arrList};GuildShopRecordWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.closeBtn1,this.onTap)};GuildShopRecordWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn1:case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break}};return GuildShopRecordWin}(BaseEuiView);__reflect(GuildShopRecordWin.prototype,"GuildShopRecordWin");ViewManager.ins().reg(GuildShopRecordWin,LayerManager.UI_Main);var GuildSkillPanel=function(_super){__extends(GuildSkillPanel,_super);function GuildSkillPanel(){var _this=_super.call(this)||this;_this.selectBmpX=[0,23,144,265];_this.selectBmpY=[0,222,1,221];_this.curRole=0;_this.selectIconID=2;return _this}GuildSkillPanel.prototype.childrenCreated=function(){this.learnLab.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildSkillPanel_0"))};GuildSkillPanel.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var rtn=Guild.ins().guildID!=0;if(!rtn){UserTips.ins().showTips(i18n("GuildSkillPanel_1"))}return rtn};GuildSkillPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.praBtn,this.onTap);this.addTouchEvent(this.skillBmp1,this.onTap);this.addTouchEvent(this.skillBmp2,this.onTap);this.addTouchEvent(this.skillBmp3,this.onTap);this.learnLab.addEventListener(egret.TextEvent.LINK,this.onLink,this);this.observe(Guild.ins().postGuildSkillInfo,this.update);this.observe(Guild.ins().postMyGuildInfo,this.updateMyInfo);this.observe(GameLogic.ins().postSubRoleChange,this.updateRole);this.observe(Guild.ins().postGuildInfo,this.update);this.observe(GuildRedPoint.ins().postLianGongRedPoint,this.updateRedPoint);Guild.ins().sendGuildSkillInfo();Guild.ins().sendMyGuildInfo();this.praBtnMc.touchEnabled=false;this.update()};GuildSkillPanel.prototype.close=function(){};GuildSkillPanel.prototype.updateRedPoint=function(){if(!GuildRedPoint.ins().roleSkillTabs[this.curRole]){GuildRedPoint.ins().roleSkillTabs[this.curRole]={};GuildRedPoint.ins().roleSkillTabs[this.curRole][1]=false;GuildRedPoint.ins().roleSkillTabs[this.curRole][2]=false;GuildRedPoint.ins().roleSkillTabs[this.curRole][3]=false}this.redPoint1.visible=GuildRedPoint.ins().roleSkillTabs[this.curRole][1];this.redPoint2.visible=GuildRedPoint.ins().roleSkillTabs[this.curRole][2];this.redPoint3.visible=GuildRedPoint.ins().roleSkillTabs[this.curRole][3];this.updateMc()};GuildSkillPanel.prototype.onLink=function(){ViewManager.ins().open(GuildWin,1)};GuildSkillPanel.prototype.updateRole=function(){Guild.ins().sendGuildSkillInfo()};GuildSkillPanel.prototype.updateMyInfo=function(){this.praCon.text=""+Guild.ins().myCon};GuildSkillPanel.prototype.update=function(roleId){if(roleId===void 0){roleId=-1}this.curRole=roleId>-1?roleId:this.curRole;this.updateMyInfo();this.updateRedPoint();this.selectSkill(this.selectIconID)};GuildSkillPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.skillBmp1:this.selectSkill(1);this.selectSkillBmp.source="guildskill_1";break;case this.skillBmp2:this.selectSkill(2);this.selectSkillBmp.source="guildskill_2";break;case this.skillBmp3:this.selectSkill(3);this.selectSkillBmp.source="guildskill_3";break;case this.praBtn:this.learnBtnOnClick();break}};GuildSkillPanel.prototype.learnBtnOnClick=function(){var roleSkillInfo=Guild.ins().getSkllInfoByIndex(this.curRole);if(Assert(roleSkillInfo.guildSkillInfo[this.selectSkillID-1],i18n("GuildSkillPanel_2",this.curRole,this.selectSkillID))){return}var level=roleSkillInfo.guildSkillInfo[this.selectSkillID-1].level;var buildLevel=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_LIANGONGFANG-1);var maxLevel=GlobalConfig.GuildCommonSkillConfig[this.selectSkillID].length;var csInfoNext=level>=maxLevel?null:this.getCommonSkillDP(this.selectSkillID,level+1);if(buildLevel==0||level>=GlobalConfig.GuildConfig.commonSkillLevels[buildLevel-1]){UserTips.ins().showTips(i18n("GuildSkillPanel_3"));return}if(csInfoNext.contribute>Guild.ins().myCon){UserTips.ins().showTips(i18n("GuildSkillPanel_4"));return}else if(Actor.gold<csInfoNext.money){UserTips.ins().showTips(i18n("GuildSkillPanel_5"));return}Guild.ins().sendLearnGuildSkill(this.curRole,this.selectSkillID)};GuildSkillPanel.prototype.selectSkill=function(selectId){this.selectIconID=selectId;this.selectBmp.x=this.selectBmpX[selectId];this.selectBmp.y=this.selectBmpY[selectId];this.selectPraSkill(selectId)};GuildSkillPanel.prototype.getTotalPower=function(){var roleSkillInfo=Guild.ins().getSkllInfoByIndex(this.curRole);var power=0;for(var i=1;i<4;i++){var level=roleSkillInfo.guildSkillInfo[this.selectSkillID-1].level;if(level>0){var csInfoNext=this.getCommonSkillDP(i,level);power+=UserBag.getAttrPower(csInfoNext.attrs)}}return power};GuildSkillPanel.prototype.selectPraSkill=function(selectId){this.praGroup.visible=true;this.selectSkillID=selectId;this.selectSkillType=1;var roleSkillInfo=Guild.ins().getSkllInfoByIndex(this.curRole);if(!roleSkillInfo)return;var level=roleSkillInfo.guildSkillInfo[this.selectSkillID-1].level;var csInfo=this.getCommonSkillDP(this.selectSkillID,level);var maxLevel=this.getCommonSkillLength(this.selectSkillID);var buildLevel=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_LIANGONGFANG-1);this.praCurBase.textColor=level==0?7526155:14605776;this.praCurBase.text=level==0?i18n("GuildSkillPanel_6"):AttributeData.getAttStr(csInfo.attrs,0,1,"：",true);this.praName.text=GlobalConfig.GuildConfig.commonSkillNames[this.selectSkillID-1];this.learnLab.visible=buildLevel<1||level>=GlobalConfig.GuildConfig.commonSkillLevels[buildLevel-1];this.praBtn.visible=!this.learnLab.visible;if(level<maxLevel){var csInfoNext=this.getCommonSkillDP(this.selectSkillID,level+1);this.praNextLab.text=AttributeData.getAttStr(csInfoNext.attrs,0,1,"：",true);var colorStr=Guild.ins().myCon>=csInfoNext.contribute?"DEDDD0":"f3311e";var temp="<font color='#"+colorStr+"'>"+csInfoNext.contribute+"</font>";this.praCost.textFlow=(new egret.HtmlTextParser).parser(temp);this.praCost0.text=csInfoNext.money+"";this.praCost0.textColor=Actor.gold>=csInfoNext.money?14605776:15937822;this.updateMc()}else{this.praNextLab.text=i18n("GuildSkillPanel_7");this.praCost.text="0";this.praCost0.text="0";this.praCost0.textColor=14605776;DisplayUtils.removeFromParent(this.mc)}this.lvTxt.text=i18n("GuildSkillPanel_8",level)};GuildSkillPanel.prototype.updateMc=function(){if(!GuildRedPoint.ins().roleSkillTabs[this.curRole][this.selectSkillID]||this.learnLab.visible){DisplayUtils.removeFromParent(this.mc);return}if(!this.mc)this.mc=new MovieClip;if(!this.mc.parent){this.mc.x=this.praBtnMc.width/2;this.mc.y=this.praBtnMc.height/2;this.praBtnMc.addChild(this.mc)}this.mc.playFile(RES_DIR_EFF+"chargeff1",-1)};GuildSkillPanel.prototype.getCommonSkillDP=function(skillID,level){var infos=GlobalConfig.GuildCommonSkillConfig[skillID];if(level==0){return infos[1]}for(var key in infos){var element=infos[key];if(element.level==level)return element}return null};GuildSkillPanel.prototype.getCommonSkillLength=function(skillId){var infos=GlobalConfig.GuildCommonSkillConfig[skillId];var len=0;for(var key in infos){len++}return len};return GuildSkillPanel}(BaseComponent);__reflect(GuildSkillPanel.prototype,"GuildSkillPanel");var GuildSkillShopWin=function(){function GuildSkillShopWin(){}return GuildSkillShopWin}();__reflect(GuildSkillShopWin.prototype,"GuildSkillShopWin");var GuildSkillWin=function(_super){__extends(GuildSkillWin,_super);function GuildSkillWin(){var _this=_super.call(this)||this;_this.skinName="GuildSkillSkin";_this.isTopLevel=true;return _this}GuildSkillWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addChangeEvent(this.tab,this.setSelectedIndex);this.observe(GuildRedPoint.ins().postGuildFire,this.updateRed);this.observe(GuildRedPoint.ins().postLianGongRedPoint,this.updateRoleRedPoint);this.observe(GuildRedPoint.ins().postLianGongRedPoint,this.updateRed);this.observe(GuildBoxMgr.ins().postBoxInfoChanged,this.updateRed);this.lastSelect=param[0]||0;this.viewStack.selectedIndex=this.lastSelect;this.addChangeEvent(this.roleSelect,this.update);this.viewStack.getElementAt(this.lastSelect)["open"]();this.guildskill.curRole=this.roleSelect.getCurRole();this.selectedIndex(this.lastSelect);this.tab.selectedIndex=this.lastSelect;this.updateRed();this.updateRoleRedPoint()};GuildSkillWin.prototype.setSelectedIndex=function(e){this.selectedIndex(this.viewStack.selectedIndex)};GuildSkillWin.prototype.selectedIndex=function(index){if(this.lastSelect!=undefined){this.viewStack.getElementAt(this.lastSelect)["close"]()}this.lastSelect=index;this.viewStack.getElementAt(this.lastSelect)["open"]();if(this.lastSelect==0){this.roleSelect.setState("uphead")}else{this.roleSelect.setState("nohead")}};GuildSkillWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.guildskill.close();this.guildcampfire.close();ViewManager.ins().open(GuildMap)};GuildSkillWin.prototype.update=function(){if(this.guildskill){this.guildskill.update(this.roleSelect.getCurRole())}};GuildSkillWin.prototype.updateRed=function(){this.redPoint1.visible=GuildRedPoint.ins().guildFire;this.redPoint0.visible=GuildRedPoint.ins().liangongRed;this.redPoint2.visible=GuildBoxMgr.ins().isHasReward()};GuildSkillWin.prototype.updateRoleRedPoint=function(){var roleRedPoint=[false,false,false];for(var i=0;i<roleRedPoint.length;i++){this.roleSelect.showRedPoint(i,roleRedPoint[i])}for(var i=0;i<1;i++){if(GuildRedPoint.ins().roleTabs[i]){for(var j=0;j<SubRoles.ins().subRolesLen;j++){this.roleSelect.showRedPoint(j,GuildRedPoint.ins().roleTabs[i][j])}}}};GuildSkillWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!Guild.ins().getSkllInfoByIndex(0)&&!Guild.ins().fireDic){UserTips.ins().showTips(i18n("GuildSkillWin_0"));return false}return true};return GuildSkillWin}(BaseEuiView);__reflect(GuildSkillWin.prototype,"GuildSkillWin");ViewManager.ins().reg(GuildSkillWin,LayerManager.UI_Main);var GuildTaskItemRender=function(_super){__extends(GuildTaskItemRender,_super);function GuildTaskItemRender(){var _this=_super.call(this)||this;_this.skinName="GuildTaskItemSkin";return _this}GuildTaskItemRender.prototype.onTap=function(e){switch(e){case this.conBtn:case this.goBtn:this.conBtnOnCLick();break}};GuildTaskItemRender.prototype.conBtnOnCLick=function(){var info=this.data;switch(info.stdTask.type){case 31:if(info.param>=info.stdTask.target)UserTips.ins().showTips(i18n("GuildTaskItemRender_0"));else if(Actor.yb>=info.stdTask.param){Guild.ins().sendCon(info.stdTask.conID)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("GuildTaskItemRender_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GuildTaskItemRender_2"))}}break;case 32:if(info.param>=info.stdTask.target)UserTips.ins().showTips(i18n("GuildTaskItemRender_3"));else if(Actor.gold>=info.stdTask.param){Guild.ins().sendCon(info.stdTask.conID)}else UserWarn.ins().setBuyGoodsWarn(1);break;case 33:if(info.param>=info.stdTask.target)UserTips.ins().showTips(i18n("GuildTaskItemRender_4"));else if(UserBag.ins().getBagGoodsCountById(0,info.stdTask.param)>=1){Guild.ins().sendCon(info.stdTask.conID)}else UserTips.ins().showTips(i18n("GuildTaskItemRender_5"));break;default:GameGuider.guidance(info.stdTask.controlTarget[0],info.stdTask.controlTarget[1]);break}};GuildTaskItemRender.prototype.goBtnOnClick=function(){var info=this.data;switch(info.state){case 0:GameGuider.guidance(info.stdTask.controlTarget[0],info.stdTask.controlTarget[1]);break;case 1:Guild.ins().sendGetTaskAward(info.taskID);break;case 2:break}};GuildTaskItemRender.prototype.dataChanged=function(){if(this.data instanceof GuildTaskInfo){var info=this.data;if(info){this.taskIcon.source="guildtask_"+info.taskID;this.nameLab.text=info.stdTask.name;this.descLab.text=info.stdTask.desc;this.conGroup.visible=true;this.getGroup.visible=false;this.numLab.text=info.param+"/"+info.stdTask.target;this.conBtn.enabled=info.param<info.stdTask.target;if(info.param<info.stdTask.target){switch(info.stdTask.type){case 31:case 32:case 33:this.conBtn.label=i18n("GuildTaskItemRender_6");break;default:this.conBtn.label=i18n("GuildTaskItemRender_7");break}}else this.conBtn.label=i18n("GuildTaskItemRender_8")}}};return GuildTaskItemRender}(BaseItemRender);__reflect(GuildTaskItemRender.prototype,"GuildTaskItemRender");var GuildWin=function(_super){__extends(GuildWin,_super);function GuildWin(){var _this=_super.call(this)||this;_this.skinName="GuildBgSkin";_this.isTopLevel=true;return _this}GuildWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.tab.dataProvider=this.viewStack};GuildWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!Guild.ins().isOpen()){UserTips.ins().showTips(i18n("GuildMap_1"));return false}if(!Guild.ins().isInGuild()){UserTips.ins().showTips(i18n("GuildWin_0"));return false}return true};GuildWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(param&&param.length>0){this.lastSelect=param[0]||0}else this.lastSelect=0;this.viewStack.selectedIndex=this.lastSelect;this.addTouchEvent(this.help,this.onTap);this.addChangeEvent(this.tab,this.setSelectedIndex);this.observe(GuildRedPoint.ins().postGldt,this.updateRedPoint);Guild.ins().sendMyGuildInfo();Guild.ins().sendGuildMembers();this.updateRedPoint();this.viewStack.getElementAt(this.lastSelect)["open"]()};GuildWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.viewStack.getElementAt(this.lastSelect)["close"]();ViewManager.ins().open(GuildMap)};GuildWin.prototype.onTap=function(e){switch(e.currentTarget){case this.help:var helpIndex=53;if(helpIndex)ViewManager.ins().open(ZsBossRuleSpeak,helpIndex);break}};GuildWin.prototype.setSelectedIndex=function(e){this.viewStack.getElementAt(this.lastSelect)["close"]();this.lastSelect=this.viewStack.selectedIndex;this.viewStack.getElementAt(this.lastSelect)["open"]()};GuildWin.prototype.updateRedPoint=function(){this.redPoint1.visible=GuildRedPoint.ins().gldt};return GuildWin}(BaseEuiView);__reflect(GuildWin.prototype,"GuildWin");ViewManager.ins().reg(GuildWin,LayerManager.UI_Main);var GuildBossDetailWin=function(_super){__extends(GuildBossDetailWin,_super);function GuildBossDetailWin(){var _this=_super.call(this)||this;_this.index=0;_this.skinName="GuildBossTipSkin";_this.isTopLevel=true;return _this}GuildBossDetailWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};GuildBossDetailWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};GuildBossDetailWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.index=param[0];this.addTouchEvent(this.chanllage,this.onTap);this.addTouchEvent(this.chanllageOme,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.rankBtn,this.onTap);this.observe(GuildBoss.ins().postGuildBossDetailChange,this.setView);this.observe(GuildBoss.ins().postGuildBossInfoChange,this.upInfo);this.observe(GuildBoss.ins().postChallengeSuccess,this.challengeSuccess);this.observe(GuildBoss.ins().postGuildBossRankInfoChange,this.setRank);this.upInfo();GuildBoss.ins().sendGetBossRankInfo(this.index+1)};GuildBossDetailWin.prototype.upInfo=function(){GuildBoss.ins().sendGetBossInfo()};GuildBossDetailWin.prototype.setView=function(){this.chanllagecount.text=i18n("GuildBossDetailWin_0",GuildBoss.ins().leftTimes,GlobalConfig.GuildBossConfig.dayTimes);var id=GuildBoss.ins().passId;this.chanllagecount.visible=GuildBoss.ins().isOpen()&&id==this.index;this.chanllage.visible=GuildBoss.ins().isOpen()&&this.index<=id;this.cantchanllage.visible=GuildBoss.ins().isOpen()&&!this.chanllage.visible;var config=GlobalConfig.GuildBossInfoConfig[this.index+1];var bossConfig=GlobalConfig.MonstersConfig[config.boss["monId"]];this.bossname.text=bossConfig.name;this.bossImage.source=config.ShowImg;var state=GuildBoss.ins().passRecord[this.index+1];for(var i=0;i<config.passAwards.length;i++){this["itemicon"+i].isShowName(false);this["itemicon"+i].data=config.passAwards[i]}var rewardConfig=GlobalConfig.GuildBossHpAwardsConfig[this.index+1];for(var i=3;i<7;i++){this["itemicon"+i].isShowName(false);this["itemicon"+i].data=rewardConfig[i-2].awards[0]}if(this.index<id){this.bosshp.value=0;this.bosshp.maximum=0;this.rewardBar.value=100;this.rewardBar.maximum=100}else if(this.index==id){var selfValue=0;selfValue=Math.ceil((bossConfig.hp-GuildBoss.ins().bossHP)/bossConfig.hp*1e4)/100>>0;this.bosshp.maximum=100;this.bosshp.value=selfValue;this.rewardBar.value=100-selfValue;this.rewardBar.maximum=100}else{this.bosshp.value=100;this.bosshp.maximum=100;this.rewardBar.value=0;this.rewardBar.maximum=100}this.chanllage.enabled=true;this.chanllage.x=166;this.chanllageOme.visible=false;if(state==0||this.bosshp.value){if(Guild.ins().guildLv>=GlobalConfig.GuildBossConfig.radisLv&&this.chanllage.visible){this.chanllageOme.visible=true;this.chanllage.x=54}}else if(state==1){this.chanllage.label=i18n("GuildBossDetailWin_1")}else{this.chanllage.label=i18n("GuildBossDetailWin_2");this.chanllage.enabled=false}this.state.visible=!GuildBoss.ins().isOpen();if(this.state.visible){this.cantchanllage.visible=this.chanllageOme.visible=this.chanllage.visible=false}};GuildBossDetailWin.prototype.onTap=function(e){switch(e.currentTarget){case this.chanllageOme:case this.chanllage:if(GuildBoss.ins().passRecord[this.index+1]==0||this.bosshp.value){if(GuildBoss.ins().challengeTime>GameServer.serverTime){UserTips.ins().showTips(i18n("GuildBossDetailWin_4"));return}if(GuildBoss.ins().leftTimes<=0){UserTips.ins().showTips(i18n("GuildBossDetailWin_5"));return}GuildBoss.ins().sendChallengeBoss(e.currentTarget==this.chanllageOme?1:0)}else if(this.chanllage.label==i18n("GuildBossDetailWin_6")){GuildBoss.ins().sendGetBossReward(this.index+1)}break;case this.rankBtn:ViewManager.ins().open(GuildBossRankWin,this.index);break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(GuildBossDetailWin);break}};GuildBossDetailWin.prototype.challengeSuccess=function(){ViewManager.ins().close(GuildBossWin);ViewManager.ins().close(GuildMap);ViewManager.ins().close(GuildBossDetailWin)};GuildBossDetailWin.prototype.setRank=function(){var rankArr=GuildBoss.ins().guildRankDic[this.index+1];var config=GlobalConfig.GuildBossInfoConfig[this.index+1];var bossConfig=GlobalConfig.MonstersConfig[config.boss["monId"]];for(var i=0;i<3;i++){if(rankArr&&rankArr[i]){this["rankGroup"+i].visible=true;this["guildname"+i].text=rankArr[i].name;var selfValue=0;var perCount=Math.ceil(rankArr[i].damage/bossConfig.hp*1e4)/100;selfValue=perCount>100?100:perCount;this["hpbar"+i].value=selfValue;this["hpbar"+i].maximum=100;this["bosshpbg"+i].visible=this["hpbar"+i].visible=true}else{this["bosshpbg"+i].visible=this["hpbar"+i].visible=false}}};return GuildBossDetailWin}(BaseEuiView);__reflect(GuildBossDetailWin.prototype,"GuildBossDetailWin");ViewManager.ins().reg(GuildBossDetailWin,LayerManager.UI_Popup);var GuildBossItemRender=function(_super){__extends(GuildBossItemRender,_super);function GuildBossItemRender(){var _this=_super.call(this)||this;_this.skinName="GuildBossItemSkin";_this.bosshp.maximum=100;_this.bosshp.slideDuration=0;return _this}GuildBossItemRender.prototype.dataChanged=function(){var id=GuildBoss.ins().passId;var index=this.data+1;var config=GlobalConfig.GuildBossInfoConfig[index];var bossConfig=GlobalConfig.MonstersConfig[config.boss["monId"]];this.bossImage.source=config.ShowImg;if(this.data<id){this.bossname.textColor=3415973;this.bosshp.value=0;var state=GuildBoss.ins().passRecord[index];this.passImg.visible=true;this.redPoint0.visible=GuildBoss.ins().isOpen()&&state==1}else if(this.data==id){this.bossname.textColor=13746831;this.bosshp.value=Math.ceil((bossConfig.hp-GuildBoss.ins().bossHP)/bossConfig.hp*1e4)/100>>0;this.redPoint0.visible=GuildBoss.ins().isOpen()&&GuildBoss.ins().leftTimes>0?true:false;this.passImg.visible=false}else{this.bossname.textColor=13746831;this.bosshp.value=100;this.redPoint0.visible=false;this.passImg.visible=false}this.bossname.text=index+"."+bossConfig.name};GuildBossItemRender.prototype.isOpen=function(){return(new Date).getDay()!=GlobalConfig.GuildBossConfig.notOpenDayOfWeek};return GuildBossItemRender}(BaseItemRender);__reflect(GuildBossItemRender.prototype,"GuildBossItemRender");var GuildBossRankItemRender=function(_super){__extends(GuildBossRankItemRender,_super);function GuildBossRankItemRender(){var _this=_super.call(this)||this;_this.skinName="GuildBossHarmItem";return _this}GuildBossRankItemRender.prototype.dataChanged=function(){this.rank.text=this.data.rank;this.playerName.text=this.data.name;this.harm.text=this.data.damage;var isGet=false;var config=GlobalConfig.GuildBossRankConfig;var conf;for(var id in config){if(config[id].srank<=this.data.rank&&config[id].erank>=this.data.rank){isGet=true;this.reward.text=config[id].awards[0].count+"";break}if(config[id].srank==0&&config[id].erank==0)conf=config[id]}if(!isGet){this.reward.text=conf.awards[0].count+""}};return GuildBossRankItemRender}(BaseItemRender);__reflect(GuildBossRankItemRender.prototype,"GuildBossRankItemRender");var GuildBossRankWin=function(_super){__extends(GuildBossRankWin,_super);function GuildBossRankWin(){var _this=_super.call(this)||this;_this.index=0;_this.skinName="GuildBossHarmSkin";_this.isTopLevel=true;_this.list.itemRenderer=GuildBossRankItemRender;return _this}GuildBossRankWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};GuildBossRankWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};GuildBossRankWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.index=param[0];this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.setView()};GuildBossRankWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeObserve()};GuildBossRankWin.prototype.setView=function(){var arr=[];var rankArr=GuildBoss.ins().guildPersonRankDic[this.index+1]||[];for(var i=0;i<rankArr.length;i++){if(!rankArr[i])continue;if(rankArr[i].name==Actor.myName)this.myData=rankArr[i];arr.push(rankArr[i])}this.list.dataProvider=new eui.ArrayCollection(arr);if(this.myData){this.qiansan.visible=true;this.myrank.visible=true;this.myname.visible=true;this.myharm.visible=true;this.myreword.visible=true;if(this.myData.rank<=3){this.qiansan.source="guildpaihang"+this.myData.rank}else{this.qiansan.source=""}this.myrank.text=this.myData.rank+"";this.myname.text=this.myData.name;this.myharm.text=this.myData.damage+"";this.myreword.text=GuildBoss.ins().leftTimes+"/"+GlobalConfig.GuildBossConfig.dayTimes}else{this.qiansan.visible=false;this.myrank.visible=false;this.myname.visible=false;this.myharm.visible=false;this.myreword.visible=false}};GuildBossRankWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(GuildBossRankWin);break}};return GuildBossRankWin}(BaseEuiView);__reflect(GuildBossRankWin.prototype,"GuildBossRankWin");ViewManager.ins().reg(GuildBossRankWin,LayerManager.UI_Popup);var GuildBossWin=function(_super){__extends(GuildBossWin,_super);function GuildBossWin(){var _this=_super.call(this)||this;_this.bossLen=0;_this.itemLen=6;_this.arrCount=0;_this.currentArr=[];_this.currentIndex=0;return _this}GuildBossWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="guildBossSkin";this.itemArr=[];for(var i=0;i<6;i++){this.itemArr.push(this["bossItem"+i])}this.bossLen=CommonUtils.getObjectLength(GlobalConfig.GuildBossInfoConfig);this.arrCount=0;this.bossArr=[];for(var j=0;j<this.bossLen;j++){if(!this.bossArr[this.arrCount])this.bossArr[this.arrCount]=[];if(j<(this.arrCount+1)*this.itemLen){this.bossArr[this.arrCount].push(j)}else if(j==(this.arrCount+1)*this.itemLen){this.arrCount++;this.bossArr[this.arrCount]=[];this.bossArr[this.arrCount].push(j)}}};GuildBossWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};GuildBossWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.imgleft,this.onTap);this.addTouchEvent(this.imgRight,this.onTap);for(var i=0;i<this.itemLen;i++){this.addTouchEvent(this.itemArr[i],this.onItemTap)}this.observe(GuildBoss.ins().postGuildBossDetailChange,this.setView);this.observe(GuildBoss.ins().postGuildBossInfoChange,this.setView);this.observe(GuildBoss.ins().postChallengeSuccess,this.challengeSuccess);this.currentIndex=this.getRuleIndex();this.vsmodel.visible=false;GuildBoss.ins().sendGetBossInfo()};GuildBossWin.prototype.getRuleIndex=function(){var maxLen=Object.keys(GlobalConfig.GuildBossInfoConfig).length;var passId=GuildBoss.ins().passId;if(passId>=maxLen){passId-=1}return Math.floor(passId/this.itemLen)};GuildBossWin.prototype.setView=function(){var index=GuildBoss.ins().passId+1;var maxLen=Object.keys(GlobalConfig.GuildBossInfoConfig).length;index=index>=maxLen?maxLen:index;this.currentArr=this.bossArr[this.currentIndex];var cfg=GlobalConfig.GuildBossInfoConfig[index];this.fightboss.source=cfg.ShowImg;for(var i=0;i<this.itemLen;i++){if(this.currentArr[i]!=null){this.itemArr[i].data=this.currentArr[i];this.itemArr[i].visible=true}else{this.itemArr[i].visible=false}}this.selfname.text=Guild.ins().guildName;this.enemyname.text=GuildBoss.ins().otherGuildName;var maxBoss=CommonUtils.getObjectLength(GlobalConfig.GuildBossInfoConfig);var id=GuildBoss.ins().passId+1>maxBoss?maxBoss:GuildBoss.ins().passId+1;var config=GlobalConfig.GuildBossInfoConfig[id];var bossConfig=GlobalConfig.MonstersConfig[config.boss["monId"]];var selfValue=0;var emityValue=0;selfValue=Math.ceil((bossConfig.hp-GuildBoss.ins().bossHP)/bossConfig.hp*1e4)/100;this.sbhpbar.value=selfValue;this.sbhpbar.maximum=100;this.ebhpbar.value=emityValue;this.ebhpbar.maximum=100;this.state.visible=!GuildBoss.ins().isOpen();if(!this.currentIndex){this.imgleft.visible=false;this.imgRight.visible=true}else if(this.currentIndex==this.arrCount){this.imgleft.visible=true;this.imgRight.visible=false}else{this.imgleft.visible=true;this.imgRight.visible=true}};GuildBossWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(GuildBossWin);break;case this.imgleft:this.currentIndex--;if(this.currentIndex<=0){this.imgleft.visible=false}this.setView();this.imgRight.visible=true;break;case this.imgRight:this.currentIndex++;if(this.currentIndex>=this.arrCount){this.imgRight.visible=false}this.setView();this.imgleft.visible=true;break}};GuildBossWin.prototype.onItemTap=function(e){ViewManager.ins().open(GuildBossDetailWin,e.currentTarget.data)};GuildBossWin.prototype.challengeSuccess=function(){ViewManager.ins().close(GuildBossWin);ViewManager.ins().close(GuildMap)};return GuildBossWin}(BaseEuiView);__reflect(GuildBossWin.prototype,"GuildBossWin");ViewManager.ins().reg(GuildBossWin,LayerManager.UI_Popup);var DailyAwardPanel=function(_super){__extends(DailyAwardPanel,_super);function DailyAwardPanel(){return _super!==null&&_super.apply(this,arguments)||this}DailyAwardPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="DailyAwardSkin";this.isTopLevel=true;this.list.itemRenderer=ItemBase};DailyAwardPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn1,this.onTap);this.addTouchEvent(this.sure,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.list.dataProvider=new eui.ArrayCollection(GlobalConfig.GuildBattleDayAward[GuildWar.ins().getModel().rewardDay].award);if(GuildWar.ins().getModel().getDayReward){this.sure.label=i18n("DailyAwardPanel_0");this.sure.enabled=false}else{this.sure.label=i18n("DailyAwardPanel_1");this.sure.enabled=true}};DailyAwardPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn1,this.onTap);this.removeTouchEvent(this.sure,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap)};DailyAwardPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn1:ViewManager.ins().close(DailyAwardPanel);break;case this.sure:if(GuildWar.ins().getModel().getDayReward){UserTips.ins().showTips(i18n("DailyAwardPanel_2"));return}else if(!GuildWar.ins().getModel().canGetDay){UserTips.ins().showTips(i18n("DailyAwardPanel_3"));return}GuildWar.ins().requestDayReward(GuildWar.ins().getModel().rewardDay);ViewManager.ins().close(DailyAwardPanel);break;case this.bgClose:ViewManager.ins().close(this);break}};return DailyAwardPanel}(BaseEuiView);__reflect(DailyAwardPanel.prototype,"DailyAwardPanel");ViewManager.ins().reg(DailyAwardPanel,LayerManager.UI_Main);var DailypresidentAwardPanel=function(_super){__extends(DailypresidentAwardPanel,_super);function DailypresidentAwardPanel(){return _super!==null&&_super.apply(this,arguments)||this}DailypresidentAwardPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="DailypresidentAwardSkin";this.list.itemRenderer=ItemBase;this.dataArr=new eui.ArrayCollection};DailypresidentAwardPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);var data1=GlobalConfig.GuildBattleConst.occupationAward;this.dataArr.source=data1;this.list.dataProvider=this.dataArr};DailypresidentAwardPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap)};DailypresidentAwardPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};return DailypresidentAwardPanel}(BaseEuiView);__reflect(DailypresidentAwardPanel.prototype,"DailypresidentAwardPanel");ViewManager.ins().reg(DailypresidentAwardPanel,LayerManager.UI_Main);var GuildWarMainWin=function(_super){__extends(GuildWarMainWin,_super);function GuildWarMainWin(){return _super.call(this)||this}GuildWarMainWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.redEff=new MovieClip;this.enterEff=new MovieClip;this.titleEff=new MovieClip;this.skinName="GuildWarMainSkin";this.roleEff=new MovieClip;this.player.addChild(this.roleEff);this.weaponEff=new MovieClip;this.weapon.addChild(this.weaponEff)};GuildWarMainWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.practiseBtn,this.onTap);this.addTouchEvent(this.redBag,this.onTap);this.addTouchEvent(this.play,this.onTap);this.addTouchEvent(this.practiseBtn2,this.onTap);this.addTouchEvent(this.practiseBtn0,this.onTap);this.addTouchEvent(this.help,this.onTap);this.addTouchEvent(this.practiseBtn1,this.onTap);this.observe(GuildWar.ins().postDayRewardInfo,this.refushRewardStatu);this.observe(GuildWar.ins().postGuildRedPointChange,this.refushRewardStatu);this.observe(GuildWar.ins().postJoinPlayBack,this.refushStartEffect);this.practiseBtn1.visible=GuildWar.ins().getModel().guildRankList.length>0&&!GuildWar.ins().getModel().isWatStart;this.refushPanelInfo();this.refushStartEffect();this.refushTitleEffect();this.observe(GuildRedPoint.ins().postRedBag,this.updateRedBag);this.observe(GuildRedPoint.ins().postDayReward,this.updateRedBag);this.updateRedBag();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.zhengBa)};GuildWarMainWin.prototype.updateRedBag=function(){this.redBag.visible=GuildRedPoint.ins().redBag;this.redPoint0.visible=GuildRedPoint.ins().dayReward};GuildWarMainWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}ViewManager.ins().open(GuildMap);GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};GuildWarMainWin.prototype.refushPanelInfo=function(){if(GuildWar.ins().getModel().isWatStart)this.openDesc.text="";else this.openDesc.text=GuildWar.ins().getModel().setOpenDesc();this.refushRewardStatu();this.refushWinGuild()};GuildWarMainWin.prototype.refushStartEffect=function(){if(GuildWar.ins().getModel().isWatStart){this.enterEff.playFile(RES_DIR_EFF+"chargeff1",-1);this.enterEff.x=this.play.width>>1;this.enterEff.y=this.play.height>>1;this.play.addChild(this.enterEff)}else{DisplayUtils.removeFromParent(this.enterEff)}};GuildWarMainWin.prototype.refushTitleEffect=function(){this.titleEff.playFile(RES_DIR_EFF+"chenghaolcbz",-1);this.titleGroup.addChild(this.titleEff)};GuildWarMainWin.prototype.refushRewardStatu=function(){if(GuildWar.ins().getModel().canSend||GuildWar.ins().getModel().canRod){this.redEff.playFile(RES_DIR_EFF+"actIconCircle",-1);this.redEff.x=this.redEff.y=28;this.redBag.addChild(this.redEff)}else{DisplayUtils.removeFromParent(this.redEff)}};GuildWarMainWin.prototype.refushWinGuild=function(){var show=GuildWar.ins().getModel().winGuildInfo.guildId>0;this.guildOwn.visible=show;this.guildName.visible=show;this.roleEff.visible=show;this.weaponEff.visible=show;this.none.visible=!show;if(show){var data=GuildWar.ins().getModel().winGuildInfo;this.guildName.text=data.guildName;this.guildOwn.text=data.guildOwnName;var effstr=data.guildOwnSex==1?"body901_1_c":"body901_0_c";var weaponstr=data.guildOwnSex==1?"weapon215_1_c":"weapon115_0_c";this.roleEff.playFile(RES_DIR_ROLE+effstr,-1);this.weaponEff.playFile(RES_DIR_ROLE+weaponstr,-1)}};GuildWarMainWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(GuildWarMainWin);break;case this.practiseBtn:ViewManager.ins().open(GuildWarRewardWin);break;case this.redBag:if(GuildWar.ins().getModel().canRod||GuildWar.ins().getModel().canSend)ViewManager.ins().open(RedBagWin);else ViewManager.ins().open(RedBagDetailsWin);break;case this.play:if(!GuildWar.ins().getModel().isWatStart){UserTips.ins().showTips(i18n("GuildWarMainWin_0"));return}ViewManager.ins().close(GuildMap);ViewManager.ins().close(GuildWarMainWin);GuildWar.ins().requestJoinAc();break;case this.practiseBtn0:ViewManager.ins().open(DailypresidentAwardPanel);break;case this.practiseBtn2:ViewManager.ins().open(DailyAwardPanel);break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,8);break;case this.practiseBtn1:ViewManager.ins().open(GuildWarRewardWin,0,1);break}};return GuildWarMainWin}(BaseEuiView);__reflect(GuildWarMainWin.prototype,"GuildWarMainWin");ViewManager.ins().reg(GuildWarMainWin,LayerManager.UI_Main);var GuildWarMemWin=function(_super){__extends(GuildWarMemWin,_super);function GuildWarMemWin(){return _super!==null&&_super.apply(this,arguments)||this}GuildWarMemWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GuildWarMemSkin";this.list.itemRenderer=GuildWarMemListRenderer;this.data=new eui.ArrayCollection;this.isTopLevel=true};GuildWarMemWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list.dataProvider=this.data;this.observe(GuildWar.ins().postMyRankChange,this.refushList);GuildWar.ins().requestOwnMyGuildRank();this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.bgClose,this.onTap)};GuildWarMemWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeObserve()};GuildWarMemWin.prototype.refushList=function(){this.data.replaceAll(GuildWar.ins().getModel().myRankList)};GuildWarMemWin.prototype.onTap=function(e){ViewManager.ins().close(GuildWarMemWin)};return GuildWarMemWin}(BaseEuiView);__reflect(GuildWarMemWin.prototype,"GuildWarMemWin");ViewManager.ins().reg(GuildWarMemWin,LayerManager.UI_Popup);var GuildWarResultWin=function(_super){__extends(GuildWarResultWin,_super);function GuildWarResultWin(){return _super.call(this)||this}GuildWarResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="GuildWarResultSkin";this.closeBtn.label=i18n("GuildWarResultWin_0");this.list1.itemRenderer=ItemBase;this.list2.itemRenderer=ItemBase};GuildWarResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.guildName.text=param[0]==""?i18n("GuildWarResultWin_1"):param[0];this.myPoint.text=param[1]+"";this.guildPoint.text=""+param[2];this.guildRank.text=i18n("GuildWarResultWin_2")+param[3]+i18n("GuildWarResultWin_3");this.myRank.text=param[4]>0?i18n("GuildWarResultWin_4")+param[4]+i18n("GuildWarResultWin_5"):i18n("GuildWarResultWin_6");var pointReward=GuildWar.ins().getModel().getRewardByPoint(param[1]);var pointRank=GuildWar.ins().getModel().getMyPointRankReward(param[4]);this.list1.dataProvider=new eui.ArrayCollection(pointRank.concat(pointReward));this.list2.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().creatGuildRankReward(param[3]));this.s=10;this.addTouchEvent(this.closeBtn,this.onTap)};GuildWarResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap)};GuildWarResultWin.prototype.onTap=function(){ViewManager.ins().close(GuildWarResultWin)};return GuildWarResultWin}(BaseEuiView);__reflect(GuildWarResultWin.prototype,"GuildWarResultWin");ViewManager.ins().reg(GuildWarResultWin,LayerManager.UI_Popup);var GuildWarRewardWin=function(_super){__extends(GuildWarRewardWin,_super);function GuildWarRewardWin(){var _this=_super.call(this)||this;_this.type=0;return _this}GuildWarRewardWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GuildWarRewardSkin";this.isTopLevel=true};GuildWarRewardWin.prototype.addPanelList=function(){this.guildInteRankInfo=new GuildInteRankInfo;this.viewStack.addChild(this.guildInteRankInfo);this.personalInteRankInfo=new PersonalInteRankInfo;this.viewStack.addChild(this.personalInteRankInfo);this.guildInteRewardInfo=new GuildInteRewardInfo;this.viewStack.addChild(this.guildInteRewardInfo);this.personInteRewardInfo=new PersonInteRewardInfo;this.viewStack.addChild(this.personInteRewardInfo);this.cruPanel=this.viewStack.getChildAt(0);this.tab.dataProvider=this.viewStack};GuildWarRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(param&&param[1]){this.type=param[1]}this.addPanelList();if(param&&param[0])this.viewStack.selectedIndex=param[0];else this.viewStack.selectedIndex=0;this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addChangeEvent(this.tab,this.onTabTouch);this.cruPanel.open()};GuildWarRewardWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.cruPanel.close();this.viewStack.removeChildren();this.type=0};GuildWarRewardWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(GuildWarRewardWin);break}};GuildWarRewardWin.prototype.onTabTouch=function(e){if(this.cruPanel){this.cruPanel.close()}this.cruPanel=this.viewStack.selectedChild;this.cruPanel.open()};return GuildWarRewardWin}(BaseEuiView);__reflect(GuildWarRewardWin.prototype,"GuildWarRewardWin");ViewManager.ins().reg(GuildWarRewardWin,LayerManager.UI_Main);var GuildWarRulesWin=function(_super){__extends(GuildWarRulesWin,_super);function GuildWarRulesWin(){return _super!==null&&_super.apply(this,arguments)||this}GuildWarRulesWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="RuleTipsSkin";this.isTopLevel=true};GuildWarRulesWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bigBg,this.onTap);this.addTouchEvent(this.bg,this.onTap);this.addTouchEvent(this.attr,this.onTap);this.addTouchEvent(this.leftBtn,this.onTap);this.addTouchEvent(this.rightBtn,this.onTap);this.cruIndex=GuildWar.ins().getModel().getMapLevelInfo().id;this.refushInfo()};GuildWarRulesWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bigBg,this.onTap);this.removeTouchEvent(this.bg,this.onTap);this.removeTouchEvent(this.attr,this.onTap);this.removeTouchEvent(this.leftBtn,this.onTap);this.removeTouchEvent(this.rightBtn,this.onTap)};GuildWarRulesWin.prototype.refushInfo=function(){var data=GlobalConfig.GuildBattleLevel;var info=data[this.cruIndex];this.mapName.text=info.name;this.attr.textFlow=TextFlowMaker.generateTextFlow(info.help);this.rightBtn.visible=this.cruIndex<4;this.leftBtn.visible=this.cruIndex>1};GuildWarRulesWin.prototype.onTap=function(e){switch(e.currentTarget){case this.leftBtn:--this.cruIndex;this.refushInfo();break;case this.rightBtn:++this.cruIndex;this.refushInfo();break;case this.bigBg:ViewManager.ins().close(GuildWarRulesWin);break;default:ViewManager.ins().close(GuildWarRulesWin)}};return GuildWarRulesWin}(BaseEuiView);__reflect(GuildWarRulesWin.prototype,"GuildWarRulesWin");ViewManager.ins().reg(GuildWarRulesWin,LayerManager.UI_Main);var GuildwarTipsPanel=function(_super){__extends(GuildwarTipsPanel,_super);function GuildwarTipsPanel(){return _super!==null&&_super.apply(this,arguments)||this}GuildwarTipsPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GameTipsSkin";this.isTopLevel=true};GuildwarTipsPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap)};GuildwarTipsPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTap)};GuildwarTipsPanel.prototype.onTap=function(e){ViewManager.ins().close(GuildwarTipsPanel)};return GuildwarTipsPanel}(BaseEuiView);__reflect(GuildwarTipsPanel.prototype,"GuildwarTipsPanel");ViewManager.ins().reg(GuildwarTipsPanel,LayerManager.UI_Main);var GuildWarUiInfo=function(_super){__extends(GuildWarUiInfo,_super);function GuildWarUiInfo(){return _super!==null&&_super.apply(this,arguments)||this}GuildWarUiInfo.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GuildWarUiSkin";this.clickEffc=new MovieClip;this.pointEff=new MovieClip;this.pointEff.x=61;this.pointEff.y=34;this.list1.itemRenderer=GuildWarMemberHeadRender;this.list2.itemRenderer=GuildWarMemberHeadRender;this.sceneBar.maximum=300;this.sceneBar.labelFunction=function(){return""};this.bloodBar1.slideDuration=0;this.bloodBar.labelDisplay.visible=false};GuildWarUiInfo.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.Nextchengnei,this.onTap);this.addTouchEvent(this.Nextchengnei0,this.onTap);this.addTouchEvent(this.Nextdianqian,this.onTap);this.addTouchEvent(this.Nexthuanggong,this.onTap);this.observe(GameLogic.ins().postEnterMap,this.refushShowInfo);this.observe(GuildWar.ins().postPointUpdate,this.refushPoint);this.observe(GuildWar.ins().postPointRewardChange,this.refushPointReward);this.addTouchEvent(this.seeRank,this.onTap);this.observe(GuildWar.ins().postCityownChange,this.cityOwnChange);this.addTouchEvent(this.seeMyGuild,this.onTap);this.observe(GuildWar.ins().postWeixieChange,this.refushWeixieList);this.observe(GuildWar.ins().postCanplayChange,this.refushcanPlayList);this.addTouchEvent(this.list1,this.listTap);this.addTouchEvent(this.list2,this.listTap);this.addTouchEvent(this.btn,this.onTap);this.addTouchEvent(this.palaceFlag,this.onTap);this.addTouchEvent(this.help,this.onTap);this.addTouchEvent(this.mon,this.onTap);this.addTouchEvent(this.guid2,this.onTap);this.addTouchEvent(this.taskTraceBtn,this.onTap);this.observe(GuildWar.ins().postFlagInfoChange,this.refushFlagStatu);this.observe(GuildWar.ins().postHudunInfo,this.hudunChange);this.observe(GuildWar.ins().postRankListChange,this.rankListChange);this.observe(GuildWar.ins().postGuildNumChange,this.refushGuildNum);this.observe(GuildWar.ins().postJoinPlayBack,this.doorStatuChange);this.observe(GuildWar.ins().postKillHuman,this.showSkill);this.observe(GameLogic.ins().postEntityHpChange,this.updateHP);this.observe(GameLogic.ins().postChangeTarget,this.updateTarget);this.addTouchEvent(this.ruleDesc,this.onTap);this.belongGroup.visible=false;this.ruleDesc.textFlow=(new egret.HtmlTextParser).parser(i18n("GuildWarUiInfo_0"));this.refushShowInfo();this.refushPoint();this.cityOwnChange();this.refushWeixieList();this.refushcanPlayList();this.rankListChange();this.doorStatuChange();this.refushFlagStatu();this.refushGuildNum()};GuildWarUiInfo.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(ViewManager.ins().isShow(GuileWarReliveWin)){ViewManager.ins().close(GuileWarReliveWin)}if(ViewManager.ins().isShow(TargetPlayerBigBloodPanel)){ViewManager.ins().close(TargetPlayerBigBloodPanel)}this.currAttackHandle=0;TimerManager.ins().removeAll(this);DisplayUtils.removeFromParent(this.clickEffc);DisplayUtils.removeFromParent(this.pointEff);this.clearRendererItem()};GuildWarUiInfo.prototype.refushShowInfo=function(){var _this=this;this.gongxun.visible=GuildWar.ins().getModel().checkinAppoint(2);this.mon.visible=GuildWar.ins().getModel().checkinAppoint(2);this.bar1.y=this.mon.visible?99:30;this.flagGroup.visible=GuildWar.ins().getModel().checkinAppoint(4);this.flag.visible=GuildWar.ins().getModel().checkinAppoint(4);this.flag.y=103;this.scene.text=GuildWar.ins().getModel().getNextMapName(0);this.guid.visible=GuildWar.ins().getModel().checkinAppoint(2)&&GuildWar.ins().getModel().getIntoNextMapGongxun()>GuildWar.ins().getModel().gongXun;if(this.guid.visible){this.clickEffc.playFile(RES_DIR_EFF+"tapCircle");this.clickEffc.x=this.guid.x-29;this.clickEffc.y=this.guid.y+this.guid.height/2+8;this.addChild(this.clickEffc)}else{DisplayUtils.removeFromParent(this.clickEffc)}var cruInfo=GuildWar.ins().getModel().getMapLevelInfo();this.sceneBar.value=(cruInfo.id-1)*100;this.weijihuo1.visible=!(cruInfo.id>=1);this.jihuo1.visible=cruInfo.id>=1;this.weijihuo2.visible=!(cruInfo.id>=2);this.jihuo2.visible=cruInfo.id>=2;this.weijihuo3.visible=!(cruInfo.id>=3);this.jihuo3.visible=cruInfo.id>=3;this.hgweijihuo.visible=!(cruInfo.id>=4);this.hgjh.visible=cruInfo.id>=4;this.Nextdianqian.visible=false;this.Nextchengnei.visible=cruInfo.id==1;this.Nexthuanggong.visible=cruInfo.id==3;this.Nextchengnei0.visible=cruInfo.id==3;if(cruInfo.id==4){this.Nextdianqian.visible=true}this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4);TimerManager.ins().doTimer(1e3,GuildWar.ins().getModel().acEndTime,function(){_this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4)},this)};GuildWarUiInfo.prototype.refushGuildNum=function(){this.comNum.text=GuildWar.ins().getModel().guildNum+i18n("GuildWarUiInfo_3")};GuildWarUiInfo.prototype.refushPoint=function(){this.guildPoint.text=GuildWar.ins().getModel().guildPoint+"";this.ownPoint.text=GuildWar.ins().getModel().ownPoint+"";this.point.text=GuildWar.ins().getModel().gongXun+"/"+GuildWar.ins().getModel().getIntoNextMapGongxun();var cruInfo=GuildWar.ins().getModel().getMapLevelInfo();if(GuildWar.ins().getModel().gongXun>=GuildWar.ins().getModel().getIntoNextMapGongxun()){if(cruInfo.id==2){this.Nextdianqian.visible=true;this.point.visible=false;this.gongxun.visible=false}}else{if(cruInfo.id!=4){this.Nextdianqian.visible=false;this.point.visible=true}}this.refushPointReward();this.doorStatuChange()};GuildWarUiInfo.prototype.refushPointReward=function(){var info=GuildWar.ins().getModel().getMyPointReward();if(info){this.taskTraceName0.y=16;var str=i18n("GuildWarUiInfo_4")+"\r"+GuildWar.ins().getModel().ownPoint+"/"+info.integral;str+=GuildWar.ins().getModel().pointInfo.isCan?StringUtils.addColor(i18n("GuildWarUiInfo_5"),"#03b154"):"";this.taskTraceName0.textFlow=(new egret.HtmlTextParser).parser(str);var itemData=info.award[0];if(GuildWar.ins().getModel().pointInfo.isCan){this.taskTraceBtn.visible=true;this.pointEff.playFile(RES_DIR_EFF+"actIconCircle",-1);this.taskTraceBtn.addChild(this.pointEff)}else{DisplayUtils.removeFromParent(this.pointEff)}}else{this.taskTraceAwards0.visible=false;DisplayUtils.removeFromParent(this.pointEff);this.taskTraceBtn.visible=false}this.scorePoint.visible=this.pointEff.parent?true:false};GuildWarUiInfo.prototype.cityOwnChange=function(){this.guildName.text=GuildWar.ins().getModel().cityOwn==""?i18n("GuildWarUiInfo_6"):GuildWar.ins().getModel().cityOwn};GuildWarUiInfo.prototype.refushWeixieList=function(refushPlayList){if(refushPlayList===void 0){refushPlayList=0}this.list2.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().weixieList);if(refushPlayList==1){this.refushcanPlayList()}this.weixie.visible=GuildWar.ins().getModel().checkinAppoint(2,true)&&GuildWar.ins().getModel().weixieList.length>0};GuildWarUiInfo.prototype.refushcanPlayList=function(data){data=data||GuildWar.ins().getModel().canPlayList;this.list1.dataProvider=new eui.ArrayCollection(data);this.attList.visible=GuildWar.ins().getModel().checkinAppoint(2,true)&&(data.length>0||this.mon.visible)};GuildWarUiInfo.prototype.doorStatuChange=function(){this.Nextchengnei.enabled=GuildWar.ins().getModel().doorDie};GuildWarUiInfo.prototype.rankListChange=function(){var dataList=GuildWar.ins().getModel().rankList;var info;for(var i=0;i<3;i++){info=dataList[i];if(info){this["rankName"+(i+1)].text=info.name;this["rankPoint"+(i+1)].text=info.point+""}else{this["rankName"+(i+1)].text=i18n("GuildWarUiInfo_7");this["rankPoint"+(i+1)].text="0"}}};GuildWarUiInfo.prototype.refushFlagStatu=function(){TimerManager.ins().remove(this.runTime,this);this.hudun1.visible=false;if(GuildWar.ins().getModel().flagStatu==0){this.clearTimeBar();this.runTime();TimerManager.ins().doTimer(1e3,GuildWar.ins().getModel().endTime,this.runTime,this)}else if(GuildWar.ins().getModel().flagStatu==1){this.clearTimeBar();this.timeDesc.text=i18n("GuildWarUiInfo_8")}else{this.runTime();this.bloodBar.maximum=GlobalConfig.GuildBattleConst.gatherTime;TimerManager.ins().doTimer(1e3,GuildWar.ins().getModel().endTime,this.runTime,this);this.hudun1.visible=true}this.palaceFlag.enabled=GuildWar.ins().getModel().flagStatu==1;this.flagStatu.visible=GuildWar.ins().getModel().flagStatu==2&&!this.flagGroup.visible;if(this.flagStatu.visible){var t=egret.Tween.get(this.flagStatu);this.flagStatu.x=480;t.to({x:106},500).call(function(){},this)}};GuildWarUiInfo.prototype.clearTimeBar=function(){this.bloodBar.maximum=0;this.bloodBar.value=0;this.bloodBar.labelFunction=function(){return""}};GuildWarUiInfo.prototype.hudunChange=function(n){this.hudun.maximum=n[1];this.hudun.value=n[0];this.hudun.labelFunction=function(){return Math.ceil(n[0]*100/n[1])+"%"}};GuildWarUiInfo.prototype.runTime=function(){--GuildWar.ins().getModel().endTime;if(GuildWar.ins().getModel().endTime>=0){if(GuildWar.ins().getModel().flagStatu!=2){this.timeDesc.text=Math.floor(GuildWar.ins().getModel().endTime/60)+i18n("GuildWarUiInfo_9")+GuildWar.ins().getModel().endTime%60+i18n("GuildWarUiInfo_10")}else{this.timeDesc.text=GuildWar.ins().getModel().flagName+i18n("GuildWarUiInfo_11");this.bloodBar.value=GuildWar.ins().getModel().endTime;this.bloodBar.labelFunction=function(){return i18n("GuildWarUiInfo_12")+Math.floor(GuildWar.ins().getModel().endTime/60)+i18n("GuildWarUiInfo_13")+GuildWar.ins().getModel().endTime%60+i18n("GuildWarUiInfo_14")};if(this.flagStatu.visible){var str="<font color = '#FFB82A'>"+GuildWar.ins().getModel().flagName+i18n("GuildWarUiInfo_15")+Math.floor(GuildWar.ins().getModel().endTime/60)+i18n("GuildWarUiInfo_16")+GuildWar.ins().getModel().endTime%60+i18n("GuildWarUiInfo_17");this.flagTime.textFlow=(new egret.HtmlTextParser).parser(str);this.guildName1.text=i18n("GuildWarUiInfo_18")+GuildWar.ins().getModel().flagGuild}}}if(GuildWar.ins().getModel().endTime<=0){TimerManager.ins().remove(this.runTime,this)}};GuildWarUiInfo.prototype.onTap=function(e){switch(e.currentTarget){case this.Nextchengnei:case this.Nextchengnei0:case this.Nextdianqian:case this.Nexthuanggong:if(GuildWar.ins().getModel().killName!=""){UserTips.ins().showTips(i18n("GuildWarUiInfo_19"));return}if(GuildWar.ins().getModel().getIntoNextMapGongxun()>GuildWar.ins().getModel().gongXun){UserTips.ins().showTips(i18n("GuildWarUiInfo_20"));return}if(!GuildWar.ins().getModel().doorDie){UserTips.ins().showTips(i18n("GuildWarUiInfo_21"));return}var index=1;if(e.currentTarget==this.Nextchengnei||e.currentTarget==this.Nextchengnei0){index=2}else if(e.currentTarget==this.Nextdianqian){index=3}else if(e.currentTarget==this.Nexthuanggong){index=4}ViewManager.ins().open(GuileWarReliveWin,1,index);break;case this.seeRank:ViewManager.ins().open(GuildWarRewardWin);break;case this.seeMyGuild:ViewManager.ins().open(GuildWarMemWin);break;case this.btn:if(this.btn.currentState=="down"){this.refushcanPlayList([])}else{this.refushcanPlayList()}break;case this.palaceFlag:if(GuildWar.ins().getModel().flagStatu!=0){GuildWar.ins().requestStartGetFlag()}else{UserTips.ins().showTips(i18n("GuildWarUiInfo_22"))}break;case this.mon:this.clickEffc.playFile(RES_DIR_EFF+"tapCircle",1);this.clickEffc.x=63;this.clickEffc.y=302+this.mon.height/2;this.addChild(this.clickEffc);GameLogic.ins().postChangeAttrPoint(0);this.guid.visible=false;break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,7);break;case this.taskTraceBtn:if(GuildWar.ins().getModel().pointInfo.isCan)GuildWar.ins().sendPointReward();break;case this.guid2:ViewManager.ins().open(GuildwarTipsPanel);break}};GuildWarUiInfo.prototype.listTap=function(e){var list=e.currentTarget;var i=list.selectedIndex;var item=list.getVirtualElementAt(i);if(!item||!item.data)return;item.showEffect();if(!GuildWar.ins().getModel().canClick){return}if(GuildWar.ins().getModel().flagAcId==Actor.actorID){WarnWin.show(i18n("GuildWarUiInfo_23"),function(){GameLogic.ins().postChangeAttrPoint(item.data);EntityShowMgr.ins().showHideSomeOne(item.data)},this);return}GameLogic.ins().postChangeAttrPoint(item.data);if(this.guid.visible){DisplayUtils.removeFromParent(this.clickEffc)}this.guid.visible=false;if(!(GuildWar.ins().getModel().attHandle==item.data))EntityShowMgr.ins().showHideSomeOne(item.data)};GuildWarUiInfo.prototype.clearRendererItem=function(){var len=this.list1.numChildren;for(var index=0;index<len;index++){var item=this.list1.getChildAt(index);item.clearEffect()}len=this.list2.numChildren;for(var index=0;index<len;index++){var item=this.list2.getChildAt(index);item.clearEffect()}};GuildWarUiInfo.prototype.showSkill=function(value){if(!value){egret.Tween.removeTweens(this.lzlabel);egret.Tween.removeTweens(this.skillGroup);this.skillGroup.visible=false;return}if(this.skillGroup.visible){egret.Tween.removeTweens(this.lzlabel);egret.Tween.removeTweens(this.skillGroup)}this.skillGroup.visible=true;this.skillGroup.alpha=1;this.lzlabel.scaleX=this.lzlabel.scaleY=1;this.lzlabel.text=value+"";var self=this;egret.Tween.get(this.lzlabel).to({scaleX:2,scaleY:2},200).to({scaleX:1,scaleY:1},100).call(function(){egret.Tween.get(self.skillGroup).wait(1e3).to({alpha:0},1e3).call(function(){egret.Tween.removeTweens(self.lzlabel);egret.Tween.removeTweens(self.skillGroup);self.skillGroup.visible=false})})};GuildWarUiInfo.prototype.updateTarget=function(){var cruInfo=GuildWar.ins().getModel().getMapLevelInfo();if(cruInfo.id==1){this.belongGroup.visible=false}else{this.belongGroup.visible=true}if(GameLogic.ins().currAttackHandle==0){this.belongGroup.visible=false}if(GameLogic.ins().currAttackHandle!=0&&this.currAttackHandle!=GameLogic.ins().currAttackHandle){this.currAttackHandle=GameLogic.ins().currAttackHandle;var mainRoleInfo=void 0;var roleList=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(roleList&&roleList.length>0){mainRoleInfo=roleList[0].infoModel;var tname=mainRoleInfo.name;var strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];this.belongNameTxt0.textFlow=TextFlowMaker.generateTextFlow(tname);this.roleHead0.source="yuanhead"+mainRoleInfo.job+mainRoleInfo.sex;this.changeHp()}}if(this.belongGroup.visible){this.changeHp()}};GuildWarUiInfo.prototype.updateHP=function(param){var targetRole=param[0];var sourceRole=param[1];var type=param[2];var value=param[3];if(targetRole&&targetRole.infoModel.masterHandle==this.currAttackHandle){this.changeHp()}};GuildWarUiInfo.prototype.changeHp=function(){var roleList=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(roleList&&roleList.length>0){var len=roleList.length;var hpValue=0;var hpTotal=0;var neigongValue=0;var neigongTotal=0;for(var i=0;i<len;i++){var role=roleList[i];if(role){var curHp=role.infoModel.getAtt(AttributeType.atHp)||0;var maxHp=role.infoModel.getAtt(AttributeType.atMaxHp)||0;hpValue+=curHp;hpTotal+=maxHp;var curNeigong=role.infoModel.getAtt(AttributeType.cruNeiGong)||0;var maxNeigong=role.infoModel.getAtt(AttributeType.maxNeiGong)||0;neigongValue+=curNeigong;neigongTotal+=maxNeigong}}this.neigongBar1.maximum=neigongTotal;this.neigongBar1.value=neigongValue;this.bloodBar1.maximum=hpTotal;this.bloodBar1.value=hpValue;if(hpValue<=0){this.belongGroup.visible=false}}};return GuildWarUiInfo}(BaseEuiView);__reflect(GuildWarUiInfo.prototype,"GuildWarUiInfo");ViewManager.ins().reg(GuildWarUiInfo,LayerManager.UI_Main);var GuileWarReliveWin=function(_super){__extends(GuileWarReliveWin,_super);function GuileWarReliveWin(){return _super.call(this)||this}GuileWarReliveWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="SwitchCDSkin"};GuileWarReliveWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.type=param[0];this.sceneIndex=param[1];switch(this.type){case 1:this.currentState="switch";this.defaultStr=i18n("GuileWarReliveWin_0");this.s=GuildWar.ins().getModel().getCdByType(this.type);break;case 2:this.currentState="revive";this.defaultStr=i18n("GuileWarReliveWin_1");this.s=param[1];break;case 3:this.currentState="exit";this.defaultStr=i18n("GuileWarReliveWin_2");this.s=GuildWar.ins().getModel().getCdByType(this.type);break}this.addTouchEvent(this.closeBtn,this.onTap);this.timeDown.text=""+this.s+this.defaultStr;TimerManager.ins().remove(this.updateCloseBtnLabel,this);TimerManager.ins().doTimer(1e3,this.s,this.updateCloseBtnLabel,this);this.refushMapInfo()};GuileWarReliveWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);TimerManager.ins().remove(this.updateCloseBtnLabel,this);if(this.type!=1){GuildWar.ins().getModel().killName=""}};GuileWarReliveWin.prototype.refushMapInfo=function(){if(this.type==1){this.mapName.text=GuildWar.ins().getModel().getNextMapName(this.sceneIndex)}else if(this.type==2){this.killName.text=i18n("GuileWarReliveWin_3",GuildWar.ins().getModel().killName);this.guildName.text=i18n("GuileWarReliveWin_4",GuildWar.ins().getModel().killGuild)}};GuileWarReliveWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0){if(this.type==1){GuildWar.ins().requestPlayNextMap(this.sceneIndex)}if(this.type==3){UserFb.ins().sendExitFb()}ViewManager.ins().close(GuileWarReliveWin)}this.timeDown.text=""+this.s+this.defaultStr};GuileWarReliveWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(GuileWarReliveWin);break}};return GuileWarReliveWin}(BaseEuiView);__reflect(GuileWarReliveWin.prototype,"GuileWarReliveWin");ViewManager.ins().reg(GuileWarReliveWin,LayerManager.UI_Main);var SelectMemberPanelWin=function(_super){__extends(SelectMemberPanelWin,_super);function SelectMemberPanelWin(){return _super.call(this)||this}SelectMemberPanelWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="SelectMemberPanelSkin";this.list.itemRenderer=MemberItem3Renderer};SelectMemberPanelWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.index=param[0];this.maxNum=param[1];this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.list,this.onTap);this.addTouchEvent(this.sureBtn,this.onTap);GuildWar.ins().getModel().sendList[this.index]=[];GuildWar.ins().getModel().sendNumList[this.index]=[];this.selectList=[];this.numList=[];this.selectItemList=[];this.chooseNum.text=i18n("SelectMemberPanelWin_0")+this.countNum()+"/"+this.maxNum;this.sureBtn.enabled=this.selectList.length==this.maxNum;this.refushList()};SelectMemberPanelWin.prototype.refushList=function(){this.list.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().getMyGuildPointRank())};SelectMemberPanelWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.list,this.onTap);this.removeTouchEvent(this.sureBtn,this.onTap);GuildWar.ins().postSendListChange()};SelectMemberPanelWin.prototype.countNum=function(){var count=0;if(this.selectItemList){for(var k in this.selectItemList){count+=this.selectItemList[k].chooseNum}}return count};SelectMemberPanelWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(SelectMemberPanelWin);break;case this.sureBtn:this.toNumList();GuildWar.ins().getModel().sendList[this.index]=this.selectList;GuildWar.ins().getModel().sendNumList[this.index]=this.numList;ViewManager.ins().close(SelectMemberPanelWin);break;case this.list:var item=e.target.parent;if(item&&item.data){var i=this.selectItemList.lastIndexOf(item);switch(e.target){case item.btn1:--item.chooseNum;if(item.chooseNum<1){item.chooseNum=1}break;case item.btn2:if(this.countNum()>=this.maxNum){UserTips.ins().showTips(i18n("SelectMemberPanelWin_1"));return}++item.chooseNum;break;default:if(i>=0){item.checkBoxs.selected=false;item.chooseNum=0;this.selectItemList.splice(i,1)}else{if(this.countNum()>=this.maxNum){item.checkBoxs.selected=false;UserTips.ins().showTips(i18n("SelectMemberPanelWin_2"));return}item.checkBoxs.selected=true;this.selectItemList.push(item);item.chooseNum=1}}item.num1.text=item.chooseNum+"";this.setAddInfoShow(item,item.checkBoxs.selected);this.chooseNum.text=i18n("SelectMemberPanelWin_3")+this.countNum()+"/"+this.maxNum;this.sureBtn.enabled=this.countNum()==this.maxNum}break}};SelectMemberPanelWin.prototype.setAddInfoShow=function(item,show){if(show===void 0){show=false}item.btn1.visible=item.btn2.visible=item.num1.visible=item.inputBg.visible=show};SelectMemberPanelWin.prototype.toNumList=function(){if(this.selectItemList){for(var k in this.selectItemList){this.selectList.push(this.selectItemList[k].data.data);this.numList.push(this.selectItemList[k].chooseNum)}}};return SelectMemberPanelWin}(BaseEuiView);__reflect(SelectMemberPanelWin.prototype,"SelectMemberPanelWin");ViewManager.ins().reg(SelectMemberPanelWin,LayerManager.UI_Popup);var SelectMemberRewardWin=function(_super){__extends(SelectMemberRewardWin,_super);function SelectMemberRewardWin(){var _this=_super.call(this)||this;_this.dataLen=[];return _this}SelectMemberRewardWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="SelectMemberRewardSkin";this.list.itemRenderer=SelectRewardItemRenderer};SelectMemberRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}GuildWar.ins().requestOwnMyGuildRank();this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.sendReward,this.onTap);this.observe(GuildWar.ins().postSendListChange,this.refushList);this.refushPanelInfo()};SelectMemberRewardWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.sendReward,this.onTap);this.removeObserve();ViewManager.ins().open(GuildMap)};SelectMemberRewardWin.prototype.refushPanelInfo=function(){this.rankLabel.text=i18n("SelectMemberRewardWin_0")+GuildWar.ins().getModel().guildWarRank+i18n("SelectMemberRewardWin_1");this.dataLen.length=GuildWar.ins().getModel().getCanSendNumByRank();this.refushList()};SelectMemberRewardWin.prototype.refushList=function(){this.list.dataProvider=new eui.ArrayCollection(this.dataLen)};SelectMemberRewardWin.prototype.onTap=function(e){var _this=this;switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(SelectMemberRewardWin);break;case this.sendReward:TimerManager.ins().doTimer(100,1,function(){if(GuildWar.ins().getModel().checkISSendAll()){GuildWar.ins().sendFenReward(_this.dataLen.length,GuildWar.ins().getModel().sendList)}},this);break}};return SelectMemberRewardWin}(BaseEuiView);__reflect(SelectMemberRewardWin.prototype,"SelectMemberRewardWin");ViewManager.ins().reg(SelectMemberRewardWin,LayerManager.UI_Popup);var GuildInteRankInfo=function(_super){__extends(GuildInteRankInfo,_super);function GuildInteRankInfo(){var _this=_super.call(this)||this;_this.skinName="GuildInteRankSkin";_this.name=i18n("GuildInteRankInfo_0");_this.list.itemRenderer=GuildInteRankItemRenderer;_this.data=new eui.ArrayCollection([]);_this.model=GuildWar.ins().getModel();_this.lastName.text=_this.model.isWatStart?i18n("GuildInteRankInfo_1"):i18n("GuildInteRankInfo_2");_this.lastNameJie.text=_this.model.isWatStart?i18n("GuildInteRankInfo_3"):i18n("GuildInteRankInfo_4");return _this}GuildInteRankInfo.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list.dataProvider=this.data;this.observe(GuildWar.ins().postRankInfo,this.refushList);GuildWar.ins().requestGuildRank()};GuildInteRankInfo.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve()};GuildInteRankInfo.prototype.refushList=function(){this.data.replaceAll(this.model.guildRankList);if(this.model.guildRankList.length>0){this.guildName.text=this.model.guildRankList[0].guildName}else{this.guildName.text=i18n("GuildInteRankInfo_9")}};return GuildInteRankInfo}(BaseView);__reflect(GuildInteRankInfo.prototype,"GuildInteRankInfo");var GuildInteRewardInfo=function(_super){__extends(GuildInteRewardInfo,_super);function GuildInteRewardInfo(){var _this=_super.call(this)||this;_this.skinName="GuildInteRewardSkin";_this.name=i18n("GuildInteRewardInfo_0");_this.dataArr=new eui.ArrayCollection;_this.dataArr1=new eui.ArrayCollection;_this.itemList.itemRenderer=ItemBase;_this.list1.itemRenderer=GuildInteRewardItemRenderer;return _this}GuildInteRewardInfo.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var data=GuildWar.ins().getModel().creatGuildRewardList();this.dataArr1.source=data;this.list1.dataProvider=this.dataArr1;var data1=GlobalConfig.GuildBattleConst.occupationAward;this.dataArr.source=data1;this.itemList.dataProvider=this.dataArr};GuildInteRewardInfo.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.dataArr.source=null;this.dataArr1.source=null};return GuildInteRewardInfo}(BaseView);__reflect(GuildInteRewardInfo.prototype,"GuildInteRewardInfo");var PersonalInteRankInfo=function(_super){__extends(PersonalInteRankInfo,_super);function PersonalInteRankInfo(){var _this=_super.call(this)||this;_this.skinName="PersonalInteRankSkin";_this.name=i18n("PersonalInteRankInfo_0");_this.list.itemRenderer=GuildInteRankItemRenderer;_this.data=new eui.ArrayCollection([]);return _this}PersonalInteRankInfo.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list.dataProvider=this.data;this.observe(GuildWar.ins().postGuildPersonalRank,this.refushList);GuildWar.ins().requestOwnGuildRank()};PersonalInteRankInfo.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve()};PersonalInteRankInfo.prototype.refushList=function(list){this.data.replaceAll(list)};return PersonalInteRankInfo}(BaseView);__reflect(PersonalInteRankInfo.prototype,"PersonalInteRankInfo");var PersonInteRewardInfo=function(_super){__extends(PersonInteRewardInfo,_super);function PersonInteRewardInfo(){var _this=_super.call(this)||this;_this.skinName="PersonInteRewardSkin";_this.name=i18n("PersonInteRewardInfo_0");_this.list.itemRenderer=PersonRewardRenderer;_this.list1.itemRenderer=GuildInteRewardItemRenderer;_this.dataArr=new eui.ArrayCollection;_this.dataArr1=new eui.ArrayCollection;return _this}PersonInteRewardInfo.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!this.dataList){this.dataList=[];var data=GlobalConfig.GuildBattlePersonalAward;for(var str in data){this.dataList.push(data[str])}}this.dataArr.source=this.dataList;this.list.dataProvider=this.dataArr;if(!this.dataList1){this.dataList1=[];var data=GlobalConfig.GuildBattlePersonalRankAward;for(var str in data){this.dataList1.push(data[str])}}this.dataArr1.source=this.dataList1;this.list1.dataProvider=this.dataArr1};PersonInteRewardInfo.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};return PersonInteRewardInfo}(BaseView);__reflect(PersonInteRewardInfo.prototype,"PersonInteRewardInfo");var RedBagDetailsWin=function(_super){__extends(RedBagDetailsWin,_super);function RedBagDetailsWin(){return _super!==null&&_super.apply(this,arguments)||this}RedBagDetailsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="RedBagDetailsSkin";this.list.itemRenderer=RedBagRenderer;this.effect=new MovieClip;this.effect.x=244;this.effect.y=300};RedBagDetailsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.num.text=GuildWar.ins().getModel().robYbNum+"";this.list.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().rebList);if(param[0]){this.effect.playFile(RES_DIR_EFF+"yanhuaeff",1);this.addChild(this.effect)}};RedBagDetailsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);DisplayUtils.removeFromParent(this.effect)};RedBagDetailsWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(RedBagDetailsWin);break}};return RedBagDetailsWin}(BaseEuiView);__reflect(RedBagDetailsWin.prototype,"RedBagDetailsWin");ViewManager.ins().reg(RedBagDetailsWin,LayerManager.UI_Main);var RedBagWin=function(_super){__extends(RedBagWin,_super);function RedBagWin(){return _super!==null&&_super.apply(this,arguments)||this}RedBagWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="RedBagWinSkin";this.model=GuildWar.ins().getModel();this.num1.restrict="0-9";this.num2.restrict="0-9"};RedBagWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.rob,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.send,this.onTap);this.addTouchEvent(this.btn1,this.onTap);this.addTouchEvent(this.btn2,this.onTap);this.addTouchEvent(this.btn3,this.onTap);this.addTouchEvent(this.btn4,this.onTap);this.addTouchEvent(this.btn5,this.onTap);this.addTouchEvent(this.btn6,this.onTap);this.addChangeEvent(this.num1,this.onTxtChange);this.addChangeEvent(this.num2,this.onTxtChange);if(this.model.canRod){this.currentState="rob";this.refushInfo()}else{this.currentState="send";this.refushSendInfo()}};RedBagWin.prototype.onTxtChange=function(e){var _this=this;var index=1;switch(e.currentTarget){case this.num1:index=1;break;case this.num2:index=2;break}TimerManager.ins().doTimer(500,1,function(){_this.checkInputChange(index)},this)};RedBagWin.prototype.checkInputChange=function(index){var num;switch(index){case 1:num=Number(this.num1.text);if(num>this.sendYBMaxNum){num=this.sendYBMaxNum}this.sendYb=num;this.num1.text=this.sendYb+"";break;case 2:num=Number(this.num2.text);if(num>this.sendMaxNum){num=this.sendMaxNum}this.sendNum=num;this.num2.text=this.sendNum+"";break}this.checkPercentage()};RedBagWin.prototype.refushSendInfo=function(){this.sendYb=this.sendYBMaxNum=this.model.remainYB;this.sendMaxNum=this.sendNum=Guild.ins().getMemberNum();this.price.setPrice(this.sendYb);this.num1.text=this.sendYb+"";this.num2.text=this.sendNum+""};RedBagWin.prototype.refushInfo=function(){this.remainBag.text=this.model.remainRedNum+"/"+this.model.maxRedNum};RedBagWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(RedBagWin);break;case this.rob:GuildWar.ins().requestRobRedBag();break;case this.send:GuildWar.ins().requestSendRedBag(this.sendYb,this.sendNum);break;case this.btn1:--this.sendYb;if(this.sendYb<this.sendNum){this.sendYb=this.sendNum}this.num1.text=this.sendYb+"";break;case this.btn2:++this.sendYb;if(this.sendYb>this.sendYBMaxNum){this.sendYb=this.sendYBMaxNum}this.num1.text=this.sendYb+"";break;case this.btn3:--this.sendNum;if(this.sendNum<1){this.sendNum=1}this.num2.text=this.sendNum+"";break;case this.btn4:++this.sendNum;if(this.sendNum>this.sendMaxNum){this.sendNum=this.sendMaxNum}this.num2.text=this.sendNum+"";break;case this.btn5:this.sendYb=this.sendYBMaxNum;this.num1.text=this.sendYb+"";break;case this.btn6:this.sendNum=this.sendMaxNum;this.num2.text=this.sendNum+"";break}};RedBagWin.prototype.checkPercentage=function(){if(this.sendYb<this.sendNum){this.sendYb=this.sendNum;this.num1.text=this.sendYb+""}};return RedBagWin}(BaseEuiView);__reflect(RedBagWin.prototype,"RedBagWin");ViewManager.ins().reg(RedBagWin,LayerManager.UI_Main);var GuildInteRankItemRenderer=function(_super){__extends(GuildInteRankItemRenderer,_super);function GuildInteRankItemRenderer(){var _this=_super.call(this)||this;_this.skinName="GuildInteRankItemSkin";return _this}GuildInteRankItemRenderer.prototype.dataChanged=function(){this.rank.text=this.itemIndex+1+"";this.guildName.text=this.data.guildName;this.guildOwn.text=this.data.ownName;this.point.text=this.data.guildPoint};return GuildInteRankItemRenderer}(BaseItemRender);__reflect(GuildInteRankItemRenderer.prototype,"GuildInteRankItemRenderer");var GuildInteRewardItemRenderer=function(_super){__extends(GuildInteRewardItemRenderer,_super);function GuildInteRewardItemRenderer(){var _this=_super.call(this)||this;_this.skinName="GuildInteRewardItemSkin";_this.list.itemRenderer=ItemBase;return _this}GuildInteRewardItemRenderer.prototype.dataChanged=function(){if(this.itemIndex<3){this.numImg.visible=true;this.rankLabel.visible=false;this.numImg.source="guildshop_json.guildpaihang"+(this.itemIndex+1)}else{this.numImg.visible=false;this.rankLabel.visible=true;this.rankLabel.text=i18n("GuildInteRewardItemRenderer_0",this.itemIndex+1)}if(this.data.rank){this.list.dataProvider=new eui.ArrayCollection(this.data.award)}else{this.list.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().creatGuildRankReward(this.data))}};return GuildInteRewardItemRenderer}(BaseItemRender);__reflect(GuildInteRewardItemRenderer.prototype,"GuildInteRewardItemRenderer");var ByteArrayMsgByProtobuf=function(_super){__extends(ByteArrayMsgByProtobuf,_super);function ByteArrayMsgByProtobuf(){var _this=_super.call(this)||this;_this.msgClass=null;_this.protoConfig=null;_this.protoConfigSymmetry=null;_this.ProtoFile=null;_this.msgClass={};_this.protoConfig=ByteArrayMsgByProtobuf.ProtoConfig;_this.protoConfigSymmetry={};var keys=Object.keys(_this.protoConfig);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];var value=_this.protoConfig[key];_this.protoConfigSymmetry[value]=key}return _this}ByteArrayMsgByProtobuf.prototype.getMsgClass=function(key){var cls=this.msgClass[key];if(cls==null){cls=this.ProtoFile.build(key);this.msgClass[key]=cls}return cls};ByteArrayMsgByProtobuf.prototype.getMsgID=function(key){return this.protoConfigSymmetry[key]};ByteArrayMsgByProtobuf.prototype.getMsgKey=function(msgId){return this.protoConfig[msgId]};ByteArrayMsgByProtobuf.prototype.decode=function(msg){var msgID=msg.readShort();var len=msg.readShort();if(msg.bytesAvailable>=len){var bytes=new egret.ByteArray;msg.readBytes(bytes,0,len);var obj={};obj.key=this.getMsgKey(msgID);DebugUtils.start("Protobuf Decode");obj.body=this.getMsgClass(obj.key).decode(bytes.buffer);DebugUtils.stop("Protobuf Decode");Log.trace(i18n("ByteArrayMsgByProtobuf_0"),"["+msgID+" "+obj.key+"]",obj.body);return obj}return null};ByteArrayMsgByProtobuf.prototype.encode=function(msg){var msgID=this.getMsgID(msg.key);var msgBody=new(this.getMsgClass(msg.key))(msg.body);DebugUtils.start("Protobuf Encode");var bodyBytes=new egret.ByteArray(msgBody.toArrayBuffer());DebugUtils.stop("Protobuf Encode");Log.trace(i18n("ByteArrayMsgByProtobuf_1"),"["+msgID+" "+msg.key+"]",msg.body);var sendMsg=new egret.ByteArray;sendMsg.writeShort(msgID);sendMsg.writeBytes(bodyBytes);return sendMsg};ByteArrayMsgByProtobuf.ProtoConfig=null;return ByteArrayMsgByProtobuf}(ByteArrayMsg);__reflect(ByteArrayMsgByProtobuf.prototype,"ByteArrayMsgByProtobuf");var GuildWarMemListRenderer=function(_super){__extends(GuildWarMemListRenderer,_super);function GuildWarMemListRenderer(){var _this=_super.call(this)||this;_this.skinName="WarMemSkin";return _this}GuildWarMemListRenderer.prototype.dataChanged=function(){var job=fixJob(this.data.job);var sex=fixSex(this.data.sex);this.face.source="head_"+job+sex;this.nameLab.text="["+GuildLanguage.guildOffice[this.data.office]+"]";this.nameLab0.text=this.data.myName;this.conLab.text=this.data.point+"";this.attack.text=this.data.attr+"";this.onLine.text=this.data.mapName==""?i18n("GuildWarMemListRenderer_0"):this.data.mapName};return GuildWarMemListRenderer}(BaseItemRender);__reflect(GuildWarMemListRenderer.prototype,"GuildWarMemListRenderer");var MemberItem3Renderer=function(_super){__extends(MemberItem3Renderer,_super);function MemberItem3Renderer(){var _this=_super.call(this)||this;_this.chooseNum=1;_this.skinName="MemberItem3Skin";return _this}MemberItem3Renderer.prototype.dataChanged=function(){if(this.data instanceof SelectInfoData){var info=this.data;this.job.textFlow=(new egret.HtmlTextParser).parser("["+GuildLanguage.guildOffice[info.data.office]+"]");this.nameLable.text=info.data.name;this.payNum.text=""+info.num;this.attr.text=""+info.data.attack;var job=fixJob(info.data.job);var sex=fixSex(info.data.sex);this.face.source="head_"+job+sex;this.headBg.source="touxiangkuang"+sex}this.checkBoxs.selected=false;this.btn1.visible=this.btn2.visible=this.num1.visible=this.inputBg.visible=false};return MemberItem3Renderer}(BaseItemRender);__reflect(MemberItem3Renderer.prototype,"MemberItem3Renderer");var SelectRewardItemRenderer=function(_super){__extends(SelectRewardItemRenderer,_super);function SelectRewardItemRenderer(){var _this=_super.call(this)||this;_this.index=0;_this.skinName="SelectRewardItemSkin";_this.choosePeople.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);_this.list.itemRenderer=GuildWarMemberHeadRender;_this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);_this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);return _this}SelectRewardItemRenderer.prototype.dataChanged=function(){var reward=GuildWar.ins().getModel().creatGuildRankReward(GuildWar.ins().getModel().guildWarRank,this.itemIndex);this.goods.data=reward[0];this.boxname.text=GlobalConfig.ItemConfig[reward[0].id].name;this.sendNum=GuildWar.ins().getModel().getCanSendNumByRank(this.itemIndex);var data=GuildWar.ins().getModel().getSelectDataByIndex(this.itemIndex);var count=0;if(data.length>0){for(var k in data){count+=data[k].num}}this.chooseNum.text=count+"/"+this.sendNum;this.list.dataProvider=new eui.ArrayCollection(data)};SelectRewardItemRenderer.prototype.onTap=function(e){switch(e.currentTarget){case this.choosePeople:GuildWar.ins().getModel().rewardIndex=this.itemIndex;ViewManager.ins().open(SelectMemberPanelWin,this.itemIndex,this.sendNum);break;case this.rightBtn:var gap=this.list.layout["gap"];var dis=this.list.getChildAt(0);if(!dis)return;var step=dis.width+gap;var showNum=Math.ceil(this.list.width/step);this.index=Math.ceil(this.list.scrollH/step);if(this.index+showNum>=this.list.numElements)return;this.index++;egret.Tween.removeTweens(this.list);var t=egret.Tween.get(this.list);t.to({scrollH:step*this.index},100);break;case this.leftBtn:gap=this.list.layout["gap"];dis=this.list.getChildAt(0);if(!dis)return;step=dis.width+gap;showNum=Math.ceil(this.list.width/step);this.index=Math.ceil(this.list.scrollH/step);if(this.index<=0)return;this.index--;egret.Tween.removeTweens(this.list);t=egret.Tween.get(this.list);t.to({scrollH:step*this.index},100);break}};return SelectRewardItemRenderer}(BaseItemRender);__reflect(SelectRewardItemRenderer.prototype,"SelectRewardItemRenderer");var GuildBoxInfoData=function(){function GuildBoxInfoData(){}return GuildBoxInfoData}();__reflect(GuildBoxInfoData.prototype,"GuildBoxInfoData");var BoxGotInfo=function(){function BoxGotInfo(){}return BoxGotInfo}();__reflect(BoxGotInfo.prototype,"BoxGotInfo");var BoxListData=function(){function BoxListData(){}return BoxListData}();__reflect(BoxListData.prototype,"BoxListData");var GuildBoxMgr=function(_super){__extends(GuildBoxMgr,_super);function GuildBoxMgr(){var _this=_super.call(this)||this;_this.hadCount=0;_this.myBoxInfo={};_this.hadGetReward=0;_this._isAutoGet=false;_this._boxAutoGet=[];_this.boxListData=[];_this.boxData=[];_this.sysId=PackageID.Guild;_this.regNetMsg(32,_this.postUpdateBoxInfo);_this.regNetMsg(33,_this.postBoxInfo);_this.regNetMsg(34,_this.postGetBoxReward);_this.observe(Guild.ins().postQuitGuild,_this.sendGetBoxInfoReq);_this.observe(Guild.ins().doUpdateGuildInfo,_this.sendGetBoxInfoReq);return _this}GuildBoxMgr.ins=function(){if(this._instance==null){this._instance=new GuildBoxMgr}return this._instance};GuildBoxMgr.prototype.postUpdateBoxInfo=function(bytes){var boxId=bytes.readInt();var actorId=bytes.readInt();var getTime=bytes.readInt();var actorName=bytes.readString();if(this.myBoxInfo[boxId]==null){this.myBoxInfo[boxId]={}}if(this.myBoxInfo[boxId][actorId]==null){this.myBoxInfo[boxId][actorId]={}}if(this.myBoxInfo[boxId][actorId][getTime]==null){this.myBoxInfo[boxId][actorId][getTime]={getTime:0,actorName:""}}this.myBoxInfo[boxId][actorId][getTime].getTime=getTime;this.myBoxInfo[boxId][actorId][getTime].actorName=actorName;this.postBoxInfoChanged()};GuildBoxMgr.prototype.getMaxCount=function(){var vipCfg=GlobalConfig.GuildBoxVipExConfig[UserVip.ins().lv];var exCount=vipCfg&&vipCfg.exLimit?vipCfg.exLimit:0;var bsseCfg=GlobalConfig.GuildBoxBaseConfig;var baseCount=bsseCfg&&bsseCfg.baseSize&&bsseCfg.baseSize.value?bsseCfg.baseSize.value:0;var maxCount=baseCount+exCount;return maxCount};GuildBoxMgr.prototype.getShowMax=function(){var bsseCfg=GlobalConfig.GuildBoxBaseConfig;var maxCount=bsseCfg.showSize.value;return maxCount};GuildBoxMgr.prototype.sendGetBoxInfoReq=function(){var bytes=this.getBytes(33);this.sendToServer(bytes)};GuildBoxMgr.prototype.postBoxInfo=function(bytes){var boxCount=bytes.readInt();var hadReward=bytes.readInt();this.hadGetReward=hadReward;var boxInfo={};for(var i=0;i<boxCount;++i){var boxId=bytes.readInt();var actorCount=bytes.readInt();if(actorCount<=0){continue}boxInfo[boxId]={};for(var j=0;j<actorCount;++j){var actorId=bytes.readInt();var timecount=bytes.readInt();if(timecount<=0){continue}boxInfo[boxId][actorId]={};for(var k=0;k<timecount;++k){var _getTime=bytes.readInt();var getTime=bytes.readInt();boxInfo[boxId][actorId][_getTime]={getTime:0,actorName:""};boxInfo[boxId][actorId][_getTime].getTime=getTime;boxInfo[boxId][actorId][_getTime].actorName=bytes.readString()}}}this.myBoxInfo=boxInfo;this.postBoxInfoChanged()};GuildBoxMgr.prototype.sendGetRewardReq=function(boxId,actorId,getTime){var bytes=this.getBytes(34);bytes.writeInt(boxId);bytes.writeInt(actorId);bytes.writeInt(getTime);this.sendToServer(bytes)};GuildBoxMgr.prototype.postBoxInfoChanged=function(){this.getBoxData()};GuildBoxMgr.prototype.postGetBoxReward=function(bytes){var boxId=bytes.readInt();var actorId=bytes.readInt();var getTime=bytes.readInt();this.hadGetReward=bytes.readInt();var err_code=bytes.readInt();var err_msg=bytes.readString();var boxInfo=this.myBoxInfo;if(err_code==0){if(boxInfo==null||boxInfo[boxId]==null||boxInfo[boxId][actorId]==null||boxInfo[boxId][actorId][getTime]==null){return}var name_10=boxInfo[boxId][actorId][getTime].actorName;var o={getTime:-1,actorName:name_10};boxInfo[boxId][actorId][getTime]=o;var self_9=this;if(self_9._isAutoGet){self_9.autoSendGetRewardReq()}}if(err_code==6){UserTips.ins().showTips(i18n("GuildBoxMgr_1"))}this.postBoxInfoChanged()};GuildBoxMgr.prototype.autoGetBoxReward=function(){var self=this;if(self.boxListData.length<=0){UserTips.ins().showTips(i18n("GuildBoxMgr_0"));return}self._isAutoGet=true;self._boxAutoGet=[];for(var _i=0,_a=self.boxListData;_i<_a.length;_i++){var v=_a[_i];self._boxAutoGet.push({boxId:v.boxId,actorId:v.actorId,getTime:v.getTime,actorName:v.actorName})}self.autoSendGetRewardReq()};GuildBoxMgr.prototype.autoSendGetRewardReq=function(){var self=this;if(self._boxAutoGet.length>0&&self._isAutoGet){var data=self._boxAutoGet.shift();self.sendGetRewardReq(data.boxId,data.actorId,data.getTime)}else{self._isAutoGet=false}};GuildBoxMgr.prototype.getBoxData=function(){var cfg=GlobalConfig.GuildBoxBaseConfig;var timeLimit=cfg.timeLimit;var svrTime=Math.floor(GameServer.serverTime/1e3);var maxCount=this.getShowMax();var boxCanGet=[];var myBoxInfo=this.myBoxInfo;for(var boxId in myBoxInfo){var boxInfo=myBoxInfo[boxId];if(boxInfo==null){continue}for(var actorId in boxInfo){var actorInfo=boxInfo[actorId];if(actorInfo==null){continue}for(var time in actorInfo){var timeInfo=actorInfo[time];if(timeInfo==null){continue}var getTime=timeInfo.getTime;if(getTime>0){var boxListData={boxId:parseInt(boxId),actorId:parseInt(actorId),getTime:getTime,actorName:timeInfo.actorName};if(svrTime<=getTime+timeLimit.value){boxCanGet.push(boxListData)}}else{if(getTime<=-1){}}}}}boxCanGet.sort(function(a,b){var cfg_a=GlobalConfig.GuildBoxTargetConfig[a.boxId];var cfg_b=GlobalConfig.GuildBoxTargetConfig[b.boxId];if(cfg_a.priority!=cfg_b.priority)return cfg_b.priority-cfg_a.priority;else return a.getTime-b.getTime});this.boxListData=[];this.boxListData=boxCanGet};GuildBoxMgr.prototype.isHasReward=function(){return this.boxListData.length>0&&GuildBoxMgr.ins().hadGetReward<GuildBoxMgr.ins().getMaxCount()};return GuildBoxMgr}(BaseSystem);__reflect(GuildBoxMgr.prototype,"GuildBoxMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.guildBoxMgr=Guild.ins.bind(GuildBoxMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var GuildBoxDetailWin=function(_super){__extends(GuildBoxDetailWin,_super);function GuildBoxDetailWin(){var _this=_super.call(this)||this;_this.skinName="GuildBoxDetailSkin";return _this}GuildBoxDetailWin.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onClose);var cfg=GlobalConfig.HelpInfoConfig[46];var text=cfg&&cfg.text?cfg.text:"";this.lblDesc.textFlow=TextFlowMaker.generateTextFlow(text);this.lblDesc.height=this.lblDesc.textHeight;this.background.height=this.lblDesc.textHeight+80};GuildBoxDetailWin.prototype.onClose=function(){this.removeTouchEvent(this.bgClose,this.onClose);ViewManager.ins().close(this);this.close()};return GuildBoxDetailWin}(BaseEuiView);__reflect(GuildBoxDetailWin.prototype,"GuildBoxDetailWin");ViewManager.ins().reg(GuildBoxDetailWin,LayerManager.UI_Popup);var GuildBoxRewardItem=function(_super){__extends(GuildBoxRewardItem,_super);function GuildBoxRewardItem(){var _this=_super.call(this)||this;_this.skinName="GuildBoxRewardItemSkin";return _this}GuildBoxRewardItem.prototype.clearUI=function(){this.lblBoxName.text="";this.lblGetMan.text="";this.lblLeftTime.text="";this.imgHadGet.visible=false;this.btnGet.visible=false;this.groupTime.visible=false;TimerManager.ins().remove(this.runTime,this);this.itemBase.visible=false;this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGet,this)};GuildBoxRewardItem.prototype.dataChanged=function(){var data=this.data;if(!data)return;this.clearUI();var rewardData=[];var cfg=GlobalConfig.GuildBoxTargetConfig[data.boxId];var reward=cfg&&cfg.reward?cfg.reward:[];for(var i in reward){if(reward[i]&&reward[i]["id"]){rewardData.push(reward[i]);var itemBase=this.itemBase;itemBase.data=reward[i];itemBase.isShowName(false);itemBase.visible=true;break}}this.lblBoxName.text=""+cfg&&cfg.name?cfg.name:"";this.lblGetMan.text=""+data.actorName;this.imgHadGet.visible=data.getTime<=-1;this.groupTime.visible=data.getTime>0;this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGet,this);TimerManager.ins().doTimer(1e3,0,this.runTime,this);this.runTime()};GuildBoxRewardItem.prototype.runTime=function(){var data=this.data;if(!data)return;var timeLimit=GlobalConfig.GuildBoxBaseConfig.timeLimit;var svrTime=Math.floor(GameServer.serverTime/1e3);var endTime=data.getTime+timeLimit.value;var leftTime=endTime-svrTime;if(leftTime>=0){this.btnGet.visible=data.getTime>0;this.lblLeftTime.text=""+DateUtils.getFormatBySecond(leftTime,DateUtils.TIME_FORMAT_12)}else{this.btnGet.visible=false;this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGet,this);TimerManager.ins().remove(this.runTime,this)}};GuildBoxRewardItem.prototype.onBtnGet=function(){var data=this.data;if(!data)return;var cfg=GlobalConfig.GuildBoxBaseConfig;var timeLimit=cfg.timeLimit;var svrTime=GameServer.serverTime/1e3;if(svrTime<=data.getTime+timeLimit.value){GuildBoxMgr.ins().sendGetRewardReq(data.boxId,data.actorId,data.getTime)}else{UserTips.ins().showTips(i18n("GuildBoxRewardItem_0"))}};return GuildBoxRewardItem}(ItemRenderer);__reflect(GuildBoxRewardItem.prototype,"GuildBoxRewardItem");var GuildBoxRewardWin=function(_super){__extends(GuildBoxRewardWin,_super);function GuildBoxRewardWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.name=i18n("GuildBoxRewardWin_0");return _this}GuildBoxRewardWin.prototype.initList=function(){var listBox=this.listBox;listBox.itemRenderer=GuildBoxRewardItem;listBox.dataProvider=new ArrayCollection([])};GuildBoxRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnAutoGet,this.onAutoGet);this.addTouchEvent(this.btnWenHao,this.onBtnWenHao);this.addTouchEvent(this.GetMoreBtn,this.onGetMore);this.observe(GuildBoxMgr.ins().postBoxInfoChanged,this.updateShow);GuildBoxMgr.ins().sendGetBoxInfoReq();this.initList();this.updateShow();var str=i18n("GuildBoxRewardWin_9");this.GetMoreBtn.textFlow=TextFlowMaker.generateTextFlow(str)};GuildBoxRewardWin.prototype.updateShow=function(){var listBox=this.listBox;var groupNoReward=this.groupNoReward;var boxData=GuildBoxMgr.ins().boxListData;this.btnAutoGet.currentState="up";this.tips1.visible=false;this.tips0.visible=true;this.GrayRect.visible=false;this.showSizeGroup.visible=false;this.lblCanGet0.visible=false;this.GetMoreBtn.visible=false;if(boxData.length>0){listBox.visible=true;groupNoReward.visible=false;var dataProvider=listBox.dataProvider;if(boxData.length>=GlobalConfig.GuildBoxBaseConfig.showSize.value){this.showSizeTips(boxData,1);this.showSizeGroup.visible=true;var newboxData=boxData.slice(0,GlobalConfig.GuildBoxBaseConfig.showSize.value+1);dataProvider.replaceAll(newboxData)}else{dataProvider.replaceAll(boxData);this.showSizeTips(boxData,0);this.showSizeGroup.visible=true}}else{listBox.visible=false;groupNoReward.visible=true}this.groupAutoGet.visible=true;var canGetStr=i18n("GuildBoxRewardWin_1")+GuildBoxMgr.ins().hadGetReward+i18n("GuildBoxRewardWin_2")+GuildBoxMgr.ins().getMaxCount()+"|";this.lblCanGet.textFlow=TextFlowMaker.generateTextFlow(canGetStr);if(UserVip.ins().lv>=1){this.lblCanGet0.visible=true;var vipCfg=GlobalConfig.GuildBoxVipExConfig[UserVip.ins().lv];var exCount=vipCfg&&vipCfg.exLimit?vipCfg.exLimit:0;var str=i18n("GuildBoxRewardWin_8")+UserVip.ins().lv+"+"+exCount+")|";this.lblCanGet0.textFlow=TextFlowMaker.generateTextFlow(str)}if(GuildBoxMgr.ins().hadGetReward!=null&&GuildBoxMgr.ins().hadGetReward>=GuildBoxMgr.ins().getMaxCount()){this.btnAutoGet.currentState="disabled";this.tips1.visible=true;this.GrayRect.visible=true;this.tips0.visible=false;this.showSizeGroup.visible=false;if(UserVip.ins().lv<10){this.GetMoreBtn.visible=true}}};GuildBoxRewardWin.prototype.showSizeTips=function(boxData,showType){var maxShowSize=GlobalConfig.GuildBoxBaseConfig.showSize.value;var elseshowSize=boxData.length-maxShowSize;var hasshowSize=boxData.length;if(showType==1){var textStr=i18n("GuildBoxRewardWin_3")+maxShowSize+i18n("GuildBoxRewardWin_4")+elseshowSize+i18n("GuildBoxRewardWin_5");this.showSizeText.textFlow=TextFlowMaker.generateTextFlow(textStr)}else if(showType==0){var textStr=i18n("GuildBoxRewardWin_6")+hasshowSize+i18n("GuildBoxRewardWin_7");this.showSizeText.textFlow=TextFlowMaker.generateTextFlow(textStr)}};GuildBoxRewardWin.prototype.onGetMore=function(){ViewManager.ins().open(ChargeFirstWin)};GuildBoxRewardWin.prototype.onAutoGet=function(){GuildBoxMgr.ins().autoGetBoxReward()};GuildBoxRewardWin.prototype.onBtnWenHao=function(){ViewManager.ins().open(GuildBoxDetailWin)};GuildBoxRewardWin.prototype.onClose=function(){this.close()};GuildBoxRewardWin.prototype.close=function(){ViewManager.ins().close(this);_super.prototype.close.call(this)};return GuildBoxRewardWin}(BaseEuiView);__reflect(GuildBoxRewardWin.prototype,"GuildBoxRewardWin");ViewManager.ins().reg(GuildBoxRewardWin,LayerManager.UI_Main);var HeartMethod=function(_super){__extends(HeartMethod,_super);function HeartMethod(){var _this=_super.call(this)||this;_this._proShowList=[];_this.sysId=PackageID.HeartMethod;_this.regNetMsg(1,_this.postHeartInfo);_this.regNetMsg(2,_this.postHeartUpLevel);_this.regNetMsg(5,_this.postOneKeyDecompose);_this.HeartMethodInfo=[];return _this}Object.defineProperty(HeartMethod.prototype,"proShowList",{get:function(){if(!this._proShowList.length){this._proShowList=GlobalConfig.HeartMethodBaseConfig.proShowList}return this._proShowList},enumerable:true,configurable:true});HeartMethod.ins=function(){return _super.ins.call(this)};HeartMethod.prototype.heartOpenCondition=function(hearId){var config=GlobalConfig.HeartMethodConfig[hearId];if(!config.openCondition)return true;if(GameServer.serverOpenDay+1<config.openCondition.day)return false;if(UserZs.ins().lv<config.openCondition.zs)return false;return true};HeartMethod.prototype.heartUpCondition=function(roleId,hearId){var config=GlobalConfig.HeartMethodConfig[hearId];if(!config.upGradeCondition)return true;var hmdataMap=this.HeartMethodInfo[roleId];if(!hmdataMap)return false;var hmdata=hmdataMap[hearId];if(!hmdata)return false;var count=0;for(var i=0;i<hmdata.slots.length;i++){if(hmdata.slots[i])count++}if(count<config.upGradeCondition)return false;return true};HeartMethod.prototype.checkOpen=function(){if(GameServer.serverOpenDay<GlobalConfig.HeartMethodBaseConfig.serverDay-1){return false}if(UserZs.ins().lv<GlobalConfig.HeartMethodBaseConfig.zsLv){return false}return true};HeartMethod.prototype.getHeartCfg=function(item,next){if(next===void 0){next=false}var heartConfigs=GlobalConfig.HeartMethodStarConfig;if(Assert(heartConfigs,"HeartMethodStarConfig is null"))return null;var id=next?item.configID+1:item.configID;return heartConfigs[id]};HeartMethod.prototype.calcHeartSlotValue=function(roleId,id){var attrs=[];return attrs};HeartMethod.prototype.getHeartSlotItemIdWear=function(roleId,hearId,pos){var hmdataMap=this.HeartMethodInfo[roleId];if(!hmdataMap)return 0;var hmdata=hmdataMap[hearId];if(!hmdata)return 0;var itemData=UserBag.ins().getBagGoodsByType(ItemType.TYPE_18);itemData.sort(this.changeSort);for(var k in itemData){var cfg=GlobalConfig.HeartMethodStarConfig[itemData[k].configID];if(cfg.heartmethodId!=hearId)continue;var itemConfig=itemData[k].itemConfig;var lv=itemConfig.level?itemConfig.level:0;var zslv=itemConfig.zsLevel?itemConfig.zsLevel:0;if(Actor.level<lv||UserZs.ins().lv<zslv)continue;var pId=this.getSuitPosFromItemId(itemData[k].configID);if(pos==pId)return itemData[k].configID}return 0};HeartMethod.prototype.getHeartSlotItemId=function(roleId,hearId,pos){var hmdataMap=this.HeartMethodInfo[roleId];if(!hmdataMap)return 0;var hmdata=hmdataMap[hearId];if(!hmdata)return 0;if(hmdata.slots[pos-1])return hmdata.slots[pos-1];return 0};HeartMethod.prototype.calcHeartSlotChange=function(roleId,hearId,itemid){var hmdataMap=this.HeartMethodInfo[roleId];if(!hmdataMap)return 0;var hmdata=hmdataMap[hearId];if(!hmdata)return 0;var starConfig=GlobalConfig.HeartMethodStarConfig[itemid];if(!starConfig)return 0;var index=hmdata.slots.indexOf(itemid);if(index==-1)return 0;var pId=this.getSuitPosFromItemId(itemid);if(!pId)return 0;var itemData=UserBag.ins().getBagGoodsByType(ItemType.TYPE_18);itemData.sort(this.changeSort);for(var k in itemData){if(GlobalConfig.HeartMethodStarConfig[itemData[k].configID].posSort!=pId)continue;if(GlobalConfig.HeartMethodStarConfig[itemData[k].configID].heartmethodId!=hearId)continue;var itemConfig=GlobalConfig.ItemConfig[itemData[k].configID];var lv=itemConfig.level?itemConfig.level:0;var zslv=itemConfig.zsLevel?itemConfig.zsLevel:0;if(Actor.level<lv||UserZs.ins().lv<zslv)continue;var hmsConfig=GlobalConfig.HeartMethodStarConfig[itemConfig.id];if(hmsConfig.quality>starConfig.quality){return itemConfig.id}else if(hmsConfig.quality==starConfig.quality){if(hmsConfig.star>starConfig.star)return itemConfig.id}}return 0};HeartMethod.prototype.changeSort=function(a,b){if(ItemConfig.getQuality(a.itemConfig)>ItemConfig.getQuality(b.itemConfig))return-1;else{var aStar=GlobalConfig.HeartMethodStarConfig[a.configID];var bStar=GlobalConfig.HeartMethodStarConfig[b.configID];if(aStar.star>bStar.star)return-1;else return 1}};HeartMethod.prototype.getSuitPosFromItemId=function(itemid){var config=GlobalConfig.HeartMethodStarConfig[itemid];if(config)return config.posSort;return 0};HeartMethod.prototype.calcHeartSlotCost=function(itemid){var b=false;var config=GlobalConfig.HeartMethodStarConfig[itemid];if(!config||!config.nextItem)return b;var item=UserBag.ins().getBagItemById(config.costItem);if(item&&item.count>=config.costNum)b=true;return b};HeartMethod.prototype.calcHeartTotalValue=function(roleId,id){var proShowList=this.proShowList;var attrvalue=[];for(var i=0;i<proShowList.length;i++){attrvalue.push(0)}var hmdata=this.HeartMethodInfo[roleId];if(!hmdata||!hmdata[id])return attrvalue;var attrbute=this.calcHeartAttrs(roleId,id);for(var i=0;i<proShowList.length;i++){if(!proShowList[i].filter){for(var j=0;j<hmdata[id].slots.length;j++){var itemid=hmdata[id].slots[j];var cfg=GlobalConfig.HeartMethodStarConfig[itemid];if(!cfg)continue;for(var z=0;z<cfg.attr.length;z++){if(proShowList[i].id==cfg.attr[z].type){attrvalue[i]+=cfg.attr[z].value}}}for(var k=0;k<attrbute.length;k++){if(proShowList[i].id==attrbute[k].type){attrvalue[i]+=attrbute[k].value;break}}}else{var skillLv=this.calcHeartSkillLevel(roleId,id);if(skillLv){var hmscfg=GlobalConfig.HeartMethodSuitConfig[id][skillLv];if(hmscfg&&proShowList[i].id==hmscfg.attr[0].type){attrvalue[i]+=hmscfg.attr[0].value/100}}}}return attrvalue};HeartMethod.prototype.getHeartSuitCount=function(roleId,id,lv){var hmdata=this.HeartMethodInfo[roleId];if(!hmdata||!hmdata[id])return 0;var count=0;for(var i=0;i<hmdata[id].slots.length;i++){var itemid=hmdata[id].slots[i];if(!itemid)continue;var config=GlobalConfig.HeartMethodStarConfig[itemid];if(config.quality>=lv)count++}return count};HeartMethod.prototype.calcHeartSkillLevel=function(roleId,id){var level=0;var hmdata=this.HeartMethodInfo[roleId];if(!hmdata||!hmdata[id])return level;var minLv;for(var i=0;i<hmdata[id].slots.length;i++){var itemid=hmdata[id].slots[i];if(!itemid)return 0;var config=GlobalConfig.HeartMethodStarConfig[itemid];if(config){var quality=config.quality;if(!minLv||minLv>quality)minLv=quality}}if(minLv)level=minLv;return level};HeartMethod.prototype.calcHeartAttrs=function(roleId,heartId){var hminfo=this.HeartMethodInfo[roleId];var attrs=[];if(!hminfo||!hminfo[heartId]||!hminfo[heartId].id)return attrs;var hmdata=hminfo[heartId];var stagecfg=GlobalConfig.HeartMethodStageConfig[hmdata.id];if(stagecfg&&stagecfg[hmdata.stage]){var list=stagecfg[hmdata.stage].attr;for(var k in list){var att=new AttributeData;att.type=list[k].type;att.value=list[k].value;attrs.push(att)}}var hmlconfig=GlobalConfig.HeartMethodLevelConfig[hmdata.id];if(hmlconfig&&hmlconfig[hmdata.lv]){var list=hmlconfig[hmdata.lv].attr;for(var k in list){var isHave=false;for(var i=0;i<attrs.length;i++){if(attrs[i].type==list[k].type){attrs[i].value+=list[k].value;isHave=true;break}}if(!isHave){var att=new AttributeData;att.type=list[k].type;att.value=list[k].value;attrs.push(att)}}}return attrs};HeartMethod.prototype.calcHeartAttrsNext=function(roleId,heartId){var hminfo=this.HeartMethodInfo[roleId];var attrs=[];if(!hminfo||!hminfo[heartId]||!hminfo[heartId].id)return attrs;var hmdata=hminfo[heartId];var stagecfg=GlobalConfig.HeartMethodStageConfig[hmdata.id];var levelcfg=GlobalConfig.HeartMethodLevelConfig[hmdata.id];var stageAttrs=[];var levelAttrs=[];if(hmdata.isUp){if(!stagecfg[hmdata.stage+1])stageAttrs=stagecfg[hmdata.stage].attr;else stageAttrs=stagecfg[hmdata.stage+1].attr;levelAttrs=levelcfg[hmdata.lv].attr}else{stageAttrs=stagecfg[hmdata.stage].attr;if(!levelcfg[hmdata.lv+1])levelAttrs=levelcfg[hmdata.lv].attr;else levelAttrs=levelcfg[hmdata.lv+1].attr}if(stageAttrs&&stageAttrs.length){var list=stageAttrs;for(var k in list){var att=new AttributeData;att.type=list[k].type;att.value=list[k].value;attrs.push(att)}}if(levelAttrs.length){var list=levelAttrs;for(var k in list){var isHave=false;for(var i=0;i<attrs.length;i++){if(attrs[i].type==list[k].type){attrs[i].value+=list[k].value;isHave=true;break}}if(!isHave){var att=new AttributeData;att.type=list[k].type;att.value=list[k].value;attrs.push(att)}}}return attrs};HeartMethod.prototype.calcHeartCost=function(roleId,heartId){var obj=null;var hminfo=this.HeartMethodInfo[roleId];if(!hminfo||!hminfo[heartId]||!hminfo[heartId].id||this.isHeartMax(roleId,heartId)||hminfo[heartId].isUp)return obj;var lvConfig=GlobalConfig.HeartMethodLevelConfig[hminfo[heartId].id][hminfo[heartId].lv+1];if(lvConfig){obj={itemid:lvConfig.costItem,count:lvConfig.costNum}}return obj};HeartMethod.prototype.isHeartMax=function(roleId,heartId){var hminfo=this.HeartMethodInfo[roleId];if(!hminfo||!hminfo[heartId]||!hminfo[heartId].id)return false;var cfg=GlobalConfig.HeartMethodLevelConfig[hminfo[heartId].id][hminfo[heartId].lv+1];return!cfg?true:false};HeartMethod.prototype.getAttrStrByType=function(type){var str="";for(var i in this.proShowList){if(this.proShowList[i].id==type){str=this.proShowList[i].name;break}}return str};HeartMethod.prototype.sendHeartUpLevel=function(roleId,id,pos){var bytes=this.getBytes(3);bytes.writeByte(roleId);bytes.writeShort(id);bytes.writeShort(pos);this.sendToServer(bytes)};HeartMethod.prototype.sendHeartChange=function(roleId,id,pos,itemid){var bytes=this.getBytes(4);bytes.writeByte(roleId);bytes.writeShort(id);bytes.writeShort(pos);bytes.writeInt(itemid);this.sendToServer(bytes)};HeartMethod.prototype.sendOneKeyDecompose=function(heartId,uidList){var len=uidList.length;var bytes=this.getBytes(5);bytes.writeShort(heartId);bytes.writeInt(len);for(var i=0;i<len;i++){bytes.writeInt(uidList[i].configID)}this.sendToServer(bytes)};HeartMethod.prototype.postHeartInfo=function(bytes){var len=bytes.readByte();for(var i=0;i<len;i++){var roleId=bytes.readByte();if(!this.HeartMethodInfo[roleId])this.HeartMethodInfo[roleId]={};var sum=bytes.readShort();for(var j=0;j<sum;j++){var id=bytes.readShort();var lv=bytes.readShort();var isUp=bytes.readByte();var slots=bytes.readShort();var hminfo=new HearMethodData;hminfo.id=id;hminfo.lv=lv;hminfo.stage=isUp;for(var z=0;z<slots;z++){var itemid=bytes.readInt();hminfo.slots.push(itemid)}this.HeartMethodInfo[roleId][id]=hminfo}}};HeartMethod.prototype.postHeartUpLevel=function(bytes){var roleId=bytes.readUnsignedByte();if(!this.HeartMethodInfo[roleId])this.HeartMethodInfo[roleId]={};var id=bytes.readShort();var hminfo;if(!this.HeartMethodInfo[roleId][id]){hminfo=new HearMethodData;hminfo.id=id}else{hminfo=this.HeartMethodInfo[roleId][id]}var lv=bytes.readShort();hminfo.lv=lv;var isUp=bytes.readByte();hminfo.stage=isUp;var slots=bytes.readShort();hminfo.slots=[];for(var z=0;z<slots;z++){var itemid=bytes.readInt();hminfo.slots.push(itemid)}this.HeartMethodInfo[roleId][id]=hminfo};HeartMethod.prototype.postOneKeyDecompose=function(bytes){var isSuccess=bytes.readByte();var heardId=0;var len=0;if(isSuccess){heardId=bytes.readShort();len=bytes.readShort()}return[isSuccess,heardId,len]};return HeartMethod}(BaseSystem);__reflect(HeartMethod.prototype,"HeartMethod");var HearMethodData=function(){function HearMethodData(){this.id=0;this.lv=0;this.stage=0;this.slots=[]}Object.defineProperty(HearMethodData.prototype,"stage",{get:function(){if(this.isUp){return Math.floor(this.lv/10)}else{return Math.floor(this.lv/10)+1}},set:function(isUp){this.isUp=isUp},enumerable:true,configurable:true});return HearMethodData}();__reflect(HearMethodData.prototype,"HearMethodData");var HeartTypeData=function(){function HeartTypeData(){}return HeartTypeData}();__reflect(HeartTypeData.prototype,"HeartTypeData");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.heartmethod=HeartMethod.ins.bind(HeartMethod)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var HeartMethodRedPoint=function(_super){__extends(HeartMethodRedPoint,_super);function HeartMethodRedPoint(){var _this=_super.call(this)||this;_this.roleTabs={};_this.roleTabs={};_this.redPoint=false;_this.associated(_this.postHeartMethodRedPoint,_this.postHeartRoleRedPoint);_this.associated(_this.postHeartRoleRedPoint,HeartMethod.ins().postHeartInfo,HeartMethod.ins().postHeartUpLevel,HeartMethod.ins().postOneKeyDecompose,UserBag.ins().postItemCountChange,UserZs.ins().postZsLv,GameLogic.ins().postSubRoleChange);return _this}HeartMethodRedPoint.prototype.postHeartMethodRedPoint=function(){var old=this.redPoint;if(!HeartMethod.ins().checkOpen()){this.redPoint=false;return old!=this.redPoint}for(var i=0;i<SubRoles.ins().subRolesLen;i++){if(!this.roleTabs[i])continue;for(var k in this.roleTabs[i]){if(this.roleTabs[i][k]){this.redPoint=true;return this.redPoint}}}this.redPoint=false;return old!=this.redPoint};HeartMethodRedPoint.prototype.postHeartRoleRedPoint=function(){if(!HeartMethod.ins().checkOpen()){return}for(var i=0;i<SubRoles.ins().subRolesLen;i++){if(!this.roleTabs[i]){this.roleTabs[i]={}}var hmMap=HeartMethod.ins().HeartMethodInfo[i];if(!hmMap)hmMap={};for(var k in GlobalConfig.HeartMethodConfig){var hmdata=hmMap[k];if(!hmdata){if(HeartMethod.ins().heartOpenCondition(GlobalConfig.HeartMethodConfig[k].id)){this.roleTabs[i][GlobalConfig.HeartMethodConfig[k].id]=true}else{this.roleTabs[i][GlobalConfig.HeartMethodConfig[k].id]=false}continue}if(!this.roleTabs[i][hmdata.id])this.roleTabs[i][hmdata.id]=false;if(!hmdata.id){this.roleTabs[i][hmdata.id]=true}else{this.roleTabs[i][hmdata.id]=false;if(!HeartMethod.ins().heartOpenCondition(hmdata.id))continue;var cost=HeartMethod.ins().calcHeartCost(i,hmdata.id);if(cost){var idata=UserBag.ins().getBagItemById(cost.itemid);var mycount=idata?idata.count:0;this.roleTabs[i][hmdata.id]=mycount>=GlobalConfig.HeartMethodStageConfig[hmdata.id][hmdata.stage].normalCostTip;if(this.roleTabs[i][hmdata.id]){if(HeartMethod.ins().heartUpCondition(i,hmdata.id))continue;else this.roleTabs[i][hmdata.id]=false}}if(hmdata.isUp&&!HeartMethod.ins().isHeartMax(i,hmdata.id)){this.roleTabs[i][hmdata.id]=true;continue}var hmdconfig=GlobalConfig.HeartMethodConfig[hmdata.id];LIST:for(var pos=0;pos<hmdconfig.posList.length;pos++){var slotId=HeartMethod.ins().getHeartSlotItemId(i,hmdata.id,pos+1);if(slotId){if(HeartMethod.ins().calcHeartSlotCost(slotId)){this.roleTabs[i][hmdata.id]=true}else{for(var j=0;j<hmdata.slots.length;j++){var hid=hmdata.slots[j];var sId=HeartMethod.ins().calcHeartSlotChange(i,hmdata.id,hid);this.roleTabs[i][hmdata.id]=sId?true:false;if(sId)break LIST}}}else{var configId=HeartMethod.ins().getHeartSlotItemIdWear(i,hmdata.id,pos+1);this.roleTabs[i][hmdata.id]=configId?true:false;if(configId)break}}if(this.roleTabs[i][hmdata.id])continue}}}};HeartMethodRedPoint.prototype.checkHeartRedPoint=function(roleId,heartId){if(!this.roleTabs[roleId]){this.roleTabs[roleId]={}}return this.roleTabs[roleId][heartId]?true:false};return HeartMethodRedPoint}(BaseSystem);__reflect(HeartMethodRedPoint.prototype,"HeartMethodRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.heartmethodredpoint=HeartMethodRedPoint.ins.bind(HeartMethodRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var HeartMethodAttrWin=function(_super){__extends(HeartMethodAttrWin,_super);function HeartMethodAttrWin(){var _this=_super.call(this)||this;_this._lastX=0;_this.proShowList=[];_this.skinName="heartmethodAttrSkin";_this.isTopLevel=true;_this.proShowList=HeartMethod.ins().proShowList;return _this}HeartMethodAttrWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};HeartMethodAttrWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curRole=param[0];this.heartId=param[1];this.setRoleAttr(this.curRole);var len=SubRoles.ins().subRolesLen;if(len>1){this.addTouchEvent(this.leftBtn,this.onTouch);this.addTouchEvent(this.rightBtn,this.onTouch);this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.addTouchEndEvent(this.bg,this.onMove)}this.addTouchEndEvent(this,this.otherClose)};HeartMethodAttrWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var len=SubRoles.ins().subRolesLen;if(len>1){this.removeTouchEvent(this.leftBtn,this.onTouch);this.removeTouchEvent(this.rightBtn,this.onTouch);this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};HeartMethodAttrWin.prototype.onClose=function(e){ViewManager.ins().close(this)};HeartMethodAttrWin.prototype.otherClose=function(e){if(e.target==this.bg||e.target instanceof eui.Button)return;ViewManager.ins().close(this)};HeartMethodAttrWin.prototype.onMove=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=e.localX;break;case egret.TouchEvent.TOUCH_END:if(this._lastX>e.localX){if(this.curRole<2){this.curRole++;this.setRoleAttr(this.curRole);this.moveAttr(-200)}}else if(this._lastX<e.localX){if(this.curRole>0){this.curRole--;this.setRoleAttr(this.curRole);this.moveAttr(200)}}break}};HeartMethodAttrWin.prototype.moveAttr=function(num){var t=egret.Tween.get(this.attrGroup);var toNum;if(num>0)toNum=0;else toNum=242;t.to({x:this.attrGroup.x+num,alpha:0},200).to({x:toNum},200).to({x:80,alpha:1},200)};HeartMethodAttrWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.leftBtn:if(this.curRole>0){this.curRole--;this.setRoleAttr(this.curRole);this.moveAttr(200)}break;case this.rightBtn:if(this.curRole<2){this.curRole++;this.setRoleAttr(this.curRole);this.moveAttr(-200)}break}};HeartMethodAttrWin.prototype.setRoleAttr=function(roleId){var role=SubRoles.ins().getSubRoleByIndex(roleId);this.job.source="op_"+role.job;var str="";var strName="";var value=0;var i=0;var attrsList=HeartMethod.ins().calcHeartTotalValue(role.index,this.heartId);for(var j=0;j<this.proShowList.length;j++){i=this.proShowList[j].id;value=attrsList[j];if(!value)continue;if(this.proShowList[j].id==AttributeType.atZhuiMingPro)str+=value+"%";else str+=value+"";strName+=HeartMethod.ins().getAttrStrByType(i)+":";if(j<this.proShowList.length-1){str+="\n";strName+="\n"}}this.attr.text=str;this.attrName.text=strName;this.setBtn()};HeartMethodAttrWin.prototype.setBtn=function(){var len=SubRoles.ins().subRolesLen;if(len==1){this.leftBtn.visible=false;this.rightBtn.visible=false}else if(len>1){if(this.curRole==0){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.curRole==1){this.leftBtn.visible=true;if(len<3)this.rightBtn.visible=false;else this.rightBtn.visible=true}else if(this.curRole==2){this.leftBtn.visible=true;this.rightBtn.visible=false}}};return HeartMethodAttrWin}(BaseEuiView);__reflect(HeartMethodAttrWin.prototype,"HeartMethodAttrWin");ViewManager.ins().reg(HeartMethodAttrWin,LayerManager.UI_Popup);var HeartMethodDecomposeItemData=function(){function HeartMethodDecomposeItemData(){this.itemData=null;this.isSelected=false}return HeartMethodDecomposeItemData}();__reflect(HeartMethodDecomposeItemData.prototype,"HeartMethodDecomposeItemData");var HeartMethodDecomposeItemRenderer=function(_super){__extends(HeartMethodDecomposeItemRenderer,_super);function HeartMethodDecomposeItemRenderer(){var _this=_super.call(this)||this;_this.skinName="heartmethodItemSkin";return _this}HeartMethodDecomposeItemRenderer.prototype.dataChanged=function(){this.cb.touchChildren=false;this.cb.touchEnabled=false;var rdid=this.data;var itemData=rdid.itemData;if(itemData&&itemData instanceof ItemData){var rbc=HeartMethod.ins().getHeartCfg(itemData);if(rbc){this.itemIcon.data=itemData}else{this.resetView()}}else{this.resetView()}this.cb.selected=rdid.isSelected};HeartMethodDecomposeItemRenderer.prototype.resetView=function(){this.itemIcon.data=null};HeartMethodDecomposeItemRenderer.prototype.playEffect=function(){if(!this.cb.selected)return};return HeartMethodDecomposeItemRenderer}(eui.ItemRenderer);__reflect(HeartMethodDecomposeItemRenderer.prototype,"HeartMethodDecomposeItemRenderer");var HeartMethodDecomposePanel=function(_super){__extends(HeartMethodDecomposePanel,_super);function HeartMethodDecomposePanel(){var _this=_super.call(this)||this;_this.cardList=null;_this.cardCollection=null;_this.checkBoxNum=4;_this.itemListScrollV=0;_this.resolveIng=false;_this._addNum=0;_this._chipNum=0;_this.skinName="heartmethodDecomposeSkin";return _this}HeartMethodDecomposePanel.prototype.childrenCreated=function(){this.itemList.itemRenderer=HeartMethodDecomposeItemRenderer;this.itemList.useVirtualLayout=true};HeartMethodDecomposePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.checkBoxNum;i++){if(this["cb"+i]){this.addTouchEvent(this["cb"+i],this.onCBTap)}}this.addTouchEvent(this.decomposeBtn,this.onTap);this.addTouchEvent(this.itemList,this.onListTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(HeartMethod.ins().postOneKeyDecompose,this.onDecomposeResult);this.heartId=param[0];this.initCardList();this.resetCheckBox();this.updateShatter()};HeartMethodDecomposePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();this.cleanCardList()};HeartMethodDecomposePanel.prototype.onDecomposeResult=function(param){var _this=this;if(param[0]){var heardId=param[1];var len=param[2];if(len){}TimerManager.ins().doTimer(500,1,function(){_this.initCardList();_this.updateShatter();_this.updateAddShatter();_this.resolveIng=false},this)}else{UserTips.ins().showTips(i18n("HeartMethodDecomposePanel_1"))}};HeartMethodDecomposePanel.prototype.playEffect=function(){var num=this.itemList.numChildren;for(var i=0;i<num;i++){var item=this.itemList.getChildAt(i);if(item){item.playEffect()}}};HeartMethodDecomposePanel.prototype.onShatterChange=function(){this.updateShatter()};HeartMethodDecomposePanel.prototype.onListTap=function(e){if(e&&e.currentTarget){var index=this.itemList.selectedIndex;if(index<0){return}var itemRenderer=this.itemList.getVirtualElementAt(index);if(itemRenderer&&itemRenderer instanceof HeartMethodDecomposeItemRenderer&&itemRenderer.cb){var data=itemRenderer.data;if(data){data.isSelected=!data.isSelected;this.cardCollection.itemUpdated(data)}}this.itemList.selectedIndex=-1;this.updateAddShatter()}};HeartMethodDecomposePanel.prototype.onTap=function(e){if(e&&e.currentTarget){switch(e.currentTarget){case this.decomposeBtn:this.decomposeHeart();break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}}};HeartMethodDecomposePanel.prototype.decomposeHeart=function(){if(this.resolveIng)return;if(this.cardList&&this.cardList.length>0){var rbc=null;var idList=[];for(var _i=0,_a=this.cardList;_i<_a.length;_i++){var v=_a[_i];if(v&&v.isSelected&&v.itemData&&v.itemData.itemConfig){idList.push(v.itemData)}}if(idList.length>0){this.resolveIng=true;HeartMethod.ins().sendOneKeyDecompose(this.heartId,idList);return}}UserTips.ins().showTips(i18n("HeartMethodDecomposePanel_2"))};HeartMethodDecomposePanel.prototype.onCBTap=function(e){if(e&&e.currentTarget){var cb=e.currentTarget;if(cb&&cb instanceof eui.CheckBox){var tempCB=null;for(var i=0;i<this.checkBoxNum;i++){tempCB=this["cb"+i];if(tempCB&&tempCB===cb){this.setQualitySelected(i+1,cb.selected);return}}}}};HeartMethodDecomposePanel.prototype.updateShatter=function(){var splitItem=GlobalConfig.HeartMethodConfig[this.heartId].splitItem;var itemConfig=GlobalConfig.ItemConfig[splitItem];this.suipianIcon.source=itemConfig.icon+"_png";var item=UserBag.ins().getBagItemById(itemConfig.id);this.suipianNum.text=(item?item.count:0)+""};HeartMethodDecomposePanel.prototype.updateAddShatter=function(){var addNum=0;var rbc=null;if(this.cardList&&this.cardList.length>0){for(var _i=0,_a=this.cardList;_i<_a.length;_i++){var v=_a[_i];if(v&&v.isSelected&&v.itemData&&v.itemData.itemConfig){rbc=HeartMethod.ins().getHeartCfg(v.itemData);if(rbc){addNum+=rbc.splitNum}}}}this._addNum=addNum;this.suipianAdd.text=addNum?"+"+addNum:""};HeartMethodDecomposePanel.prototype.setQualitySelected=function(qua,selected){if(qua<0){for(var _i=0,_a=this.cardList;_i<_a.length;_i++){var v=_a[_i];if(v.itemData&&v.itemData.itemConfig){v.isSelected=false}}}else{for(var _b=0,_c=this.cardList;_b<_c.length;_b++){var v=_c[_b];if(v.itemData&&v.itemData.itemConfig){if(ItemConfig.getQuality(v.itemData.itemConfig)==qua){v.isSelected=selected}}}}var len=this.cardCollection.length;for(var i=0;i<len;i++){this.cardCollection.itemUpdated(this.cardList[i])}this.updateAddShatter()};HeartMethodDecomposePanel.prototype.getCheckBoxSelected=function(qualityIndex){var cb=this["cb"+(qualityIndex-1)];if(cb){return cb.selected}return false};HeartMethodDecomposePanel.prototype.resetCheckBox=function(defaultIndex){if(defaultIndex===void 0){defaultIndex=1}var cb=null;for(var i=0;i<this.checkBoxNum;i++){cb=this["cb"+i];if(cb&&cb instanceof eui.CheckBox){cb.selected=i+1==defaultIndex}}this.setQualitySelected(defaultIndex,true)};HeartMethodDecomposePanel.prototype.selectHeartItem=function(list){var hlist=[];for(var i=0;i<list.length;i++){var config=GlobalConfig.HeartMethodStarConfig[list[i].configID];if(this.heartId==config.heartmethodId)hlist.push(list[i])}return hlist};HeartMethodDecomposePanel.prototype.initCardList=function(){this.cleanCardList();this.cardList=[];var totallist=UserBag.ins().getBagGoodsByType(ItemType.TYPE_18);var list=this.selectHeartItem(totallist);if(list&&list.length>0){var rdid=null;for(var _i=0,list_10=list;_i<list_10.length;_i++){var v=list_10[_i];for(var i=0;i<v.count;i++){rdid=new HeartMethodDecomposeItemData;rdid.itemData=v;this.cardList.push(rdid)}}this.cardList.sort(this.sortList)}this.cardCollection=new eui.ArrayCollection(this.cardList);this.itemList.dataProvider=this.cardCollection};HeartMethodDecomposePanel.prototype.cleanCardList=function(){this.cardList=null;this.cardCollection=null;this.itemList.dataProvider=null};HeartMethodDecomposePanel.prototype.sortList=function(a,b){var aq=ItemConfig.getQuality(a.itemData.itemConfig);var bq=ItemConfig.getQuality(b.itemData.itemConfig);if(aq>bq)return-1;if(aq<bq)return 1;var arbc=HeartMethod.ins().getHeartCfg(a.itemData);var brbc=HeartMethod.ins().getHeartCfg(b.itemData);if(arbc.star>brbc.star)return-1;else return 1};return HeartMethodDecomposePanel}(BaseEuiView);__reflect(HeartMethodDecomposePanel.prototype,"HeartMethodDecomposePanel");ViewManager.ins().reg(HeartMethodDecomposePanel,LayerManager.UI_Popup);var HeartMethodDisplay=function(_super){__extends(HeartMethodDisplay,_super);function HeartMethodDisplay(){var _this=_super.call(this)||this;_this.skinName="heartmethodItemIconSkin";return _this}HeartMethodDisplay.prototype.dataChanged=function(){if(!this.data)return;if(this.data instanceof ItemData){var itemData=this.data;var itemCfg=GlobalConfig.ItemConfig[itemData.itemConfig.id];this.itemIcon.setData(itemCfg);var color=ItemConfig.getQualityColor(itemCfg);this.nameTF.textFlow=TextFlowMaker.generateTextFlow1(i18n("HeartMethodDisplay_0",color,itemCfg.name));this.nameTF.strokeColor=ItemConfig.getQualityStrokeColor(itemCfg)}};HeartMethodDisplay.prototype.destruct=function(){};return HeartMethodDisplay}(BaseItemRender);__reflect(HeartMethodDisplay.prototype,"HeartMethodDisplay");var HeartMethodItemRenderer=function(_super){__extends(HeartMethodItemRenderer,_super);function HeartMethodItemRenderer(){return _super.call(this)||this}HeartMethodItemRenderer.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};HeartMethodItemRenderer.prototype.dataChanged=function(){if(!this.data)return;if(this.data){if(this.data.itemid){this.itemIcon.setData(GlobalConfig.ItemConfig[this.data.itemid]);this.itemIcon.visible=true;this.blank.visible=false}else{this.itemIcon.visible=false;this.blank.source=this.data.blank;this.blank.visible=true}this.redPoint.visible=this.data.redPoint}};return HeartMethodItemRenderer}(BaseItemRender);__reflect(HeartMethodItemRenderer.prototype,"HeartMethodItemRenderer");var HeartMethodSkillTips=function(_super){__extends(HeartMethodSkillTips,_super);function HeartMethodSkillTips(){var _this=_super.call(this)||this;_this.skinName="heartmethodSkillTipSkin";return _this}HeartMethodSkillTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClick);this.observe(HeartMethod.ins().postHeartUpLevel,this.updateUI);this.roleId=param[0];this.heartId=param[1];this.updateUI()};HeartMethodSkillTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick)};HeartMethodSkillTips.prototype.onClick=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break}};HeartMethodSkillTips.prototype.updateUI=function(){var suitLv=HeartMethod.ins().calcHeartSkillLevel(this.roleId,this.heartId);var config=GlobalConfig.HeartMethodSuitConfig[this.heartId];var maxLv=Object.keys(config).length;var curConfig;if(!suitLv){this.currentState="initial";curConfig=config[1]}else if(suitLv>=maxLv){this.currentState="max";curConfig=config[maxLv]}else{this.currentState="normal";curConfig=config[suitLv]}this.validateNow();var hmcfg=GlobalConfig.HeartMethodConfig[this.heartId];if(hmcfg){this.skillName.text=hmcfg.name;this.skillShow.source=hmcfg.skillShowPic+"_jpg"}var color=ItemBase.QUALITY_COLOR[curConfig.level];this["curskillDesc0"].textFlow=TextFlowMaker.generateTextFlow1(i18n("HeartMethodSkillTips_6",color,curConfig.skillname));this["curskillDesc0"].strokeColor=ItemBase.QUALITY_STROKE_COLOR[curConfig.level];var suitCount="";var curCount=HeartMethod.ins().getHeartSuitCount(this.roleId,this.heartId,curConfig.level);var maxCount=GlobalConfig.HeartMethodConfig[this.heartId].posList.length;suitCount="("+curCount+"/"+maxCount+")";if(this.currentState=="initial"){this["curskillDesc2"].text=this.getColorDesc(curConfig.level)+suitCount;this["curskillDesc3"].text=curConfig.skilldesc}else if(this.currentState=="normal"){var nextConfig=config[suitLv+1];this["curskillDesc3"].text=curConfig.skilldesc;curCount=HeartMethod.ins().getHeartSuitCount(this.roleId,this.heartId,nextConfig.level);suitCount="("+curCount+"/"+maxCount+")";color=ItemBase.QUALITY_COLOR[nextConfig.level];this["nextskillTitle0"].textFlow=TextFlowMaker.generateTextFlow1(i18n("HeartMethodSkillTips_7",color,nextConfig.skillname));this["nextskillTitle0"].strokeColor=ItemBase.QUALITY_STROKE_COLOR[nextConfig.level];this["nextskillTitle2"].text=this.getColorDesc(nextConfig.level)+suitCount;this["nextskillTitle3"].text=nextConfig.skilldesc}else if(this.currentState=="max"){this["nextskillTitle0"].textFlow=TextFlowMaker.generateTextFlow1(i18n("HeartMethodSkillTips_8",color,curConfig.skillname));this["nextskillTitle3"].text=curConfig.skilldesc}};HeartMethodSkillTips.prototype.getColorDesc=function(quality){var str="";switch(quality){case 0:str=i18n("HeartMethodSkillTips_0");break;case 1:str=i18n("HeartMethodSkillTips_1");break;case 2:str=i18n("HeartMethodSkillTips_2");break;case 3:str=i18n("HeartMethodSkillTips_3");break;case 4:str=i18n("HeartMethodSkillTips_4");break}if(str)str=i18n("HeartMethodSkillTips_5",str);return str};return HeartMethodSkillTips}(BaseEuiView);__reflect(HeartMethodSkillTips.prototype,"HeartMethodSkillTips");ViewManager.ins().reg(HeartMethodSkillTips,LayerManager.UI_Popup);var HeartMethodTips=function(_super){__extends(HeartMethodTips,_super);function HeartMethodTips(){var _this=_super.call(this)||this;_this.skinName="heartmethodTips";return _this}HeartMethodTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClick);this.addTouchEvent(this.addStar,this.onClick);this.addTouchEvent(this.replace,this.onClick);this.observe(HeartMethod.ins().postHeartUpLevel,this.updateUI);this.roleId=param[0];this.heartId=param[1];this.id=param[2];this.updateUI()};HeartMethodTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeTouchEvent(this.addStar,this.onClick);this.removeTouchEvent(this.replace,this.onClick);DisplayUtils.removeFromParent(this.starList);this.starList=null};HeartMethodTips.prototype.onClick=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.addStar:if(this.isMax){UserTips.ins().showTips(i18n("HeartMethodTips_0"));return}if(this.isAdd){HeartMethod.ins().sendHeartUpLevel(this.roleId,this.heartId,this.pId)}else UserTips.ins().showTips(i18n("HeartMethodTips_1"));break;case this.replace:var itemid=HeartMethod.ins().calcHeartSlotChange(this.roleId,this.heartId,this.id);if(!itemid){UserTips.ins().showTips(i18n("HeartMethodTips_2"));return}if(!this.pId){UserTips.ins().showTips(i18n("HeartMethodTips_3",this.id));return}HeartMethod.ins().sendHeartChange(this.roleId,this.heartId,this.pId,itemid);break}};HeartMethodTips.prototype.updateUI=function(){this.pId=HeartMethod.ins().getSuitPosFromItemId(this.id);if(!this.pId)return;this.id=HeartMethod.ins().HeartMethodInfo[this.roleId][this.heartId].slots[this.pId-1];var config=GlobalConfig.HeartMethodStarConfig[this.id];if(!config)return;this.icon.source=config.bigIcon;if(!this.mc)this.mc=new MovieClip;if(!this.mc.parent)this.effGroup.addChild(this.mc);this.mc.playFile(RES_DIR_EFF+config.effect,-1);var itemConfig=GlobalConfig.ItemConfig[this.id];this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1(i18n("HeartMethodTips_5",ItemConfig.getQualityColor(itemConfig),itemConfig.name));this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);var power=UserBag.getAttrPower(config.attr);this.powerPanel.setPower(power);var strAttrName="";var strAttrValue="";for(var i=0;i<HeartMethod.ins().proShowList.length;i++){for(var j=0;j<config.attr.length;j++){if(HeartMethod.ins().proShowList[i].id==config.attr[j].type){var sname=HeartMethod.ins().getAttrStrByType(config.attr[j].type);if(!sname)continue;if(!config.attr[j].value)continue;strAttrName+=sname;strAttrValue+="+"+config.attr[j].value;strAttrName+="\n";strAttrValue+="\n"}}}if(strAttrName){var index=strAttrName.lastIndexOf("\n");strAttrName=strAttrName.substring(0,index)}if(strAttrValue){var index=strAttrValue.lastIndexOf("\n");strAttrValue=strAttrValue.substring(0,index)}this.attr.text=strAttrName;this.value.text=strAttrValue;var costStr="";this.isMax=false;if(config.nextItem){var itemcfg=GlobalConfig.ItemConfig[config.costItem];if(itemcfg){var color=ItemConfig.getQualityColor(itemcfg);costStr=i18n("HeartMethodTips_4",color,itemcfg.name,config.costNum);this.cost.textFlow=TextFlowMaker.generateTextFlow1(costStr)}this.isAdd=HeartMethod.ins().calcHeartSlotCost(this.id)}else{this.isMax=true;this.isAdd=false}this.cost.visible=costStr?true:false;var hmpconfig=GlobalConfig.HeartMethodPosConfig[config.posId][config.quality];if(hmpconfig){var stars=Object.keys(hmpconfig).length-1;if(!this.starList){this.starList=new StarList(stars);this.starList.horizontalCenter=0;this.starList.y=0;this.starGroup.addChild(this.starList)}else{this.starList.setlistLength(stars,config.star)}this.starList.setStarNum(config.star)}this.updateRedPoint()};HeartMethodTips.prototype.updateRedPoint=function(){this.redPoint1.visible=this.isAdd;this.redPoint2.visible=HeartMethod.ins().calcHeartSlotChange(this.roleId,this.heartId,this.id)?true:false};return HeartMethodTips}(BaseEuiView);__reflect(HeartMethodTips.prototype,"HeartMethodTips");ViewManager.ins().reg(HeartMethodTips,LayerManager.UI_Popup);var HeartMethodWin=function(_super){__extends(HeartMethodWin,_super);function HeartMethodWin(){var _this=_super.call(this)||this;_this.heartPages=[];_this.winType=[WinType.bhTianShu,WinType.xwTianShu,WinType.qlTianShu,WinType.zqTianShu];return _this}HeartMethodWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.stopIconTween();this.removeObserve();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};HeartMethodWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.stopIconTween();this.addTouchEvent(this.xiangxishuxing,this.onTap);this.addTouchEvent(this.skill,this.onTap);this.addTouchEvent(this.fenjie,this.onTap);this.addTouchEvent(this.leftBtn,this.onTap);this.addTouchEvent(this.rightBtn,this.onTap);this.addTouchEvent(this.activeBtn0,this.onTap);this.addTouchEvent(this.boostBtn,this.onTap);this.addTouchEvent(this.getItemTxt0,this.onTap);this.observe(HeartMethodRedPoint.ins().postHeartRoleRedPoint,this.updateUI);for(var i=0;i<5;i++){this.addTouchEvent(this["item"+(i+1)],this.onSlot)}var selectedIndex=param&&param[0]?param[0]:0;this.curRole=selectedIndex;this.heartId=param&&param[1]?param[1]:1;this.init();this.updateUI();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,this.winType[this.heartPos])};HeartMethodWin.prototype.onSlot=function(e){var id=this.getHeartId(this.heartPos);for(var i=0;i<5;i++){if(e.currentTarget==this["item"+(i+1)]){var slotId=HeartMethod.ins().getHeartSlotItemId(this.curRole,id,i+1);if(!slotId){var itemData=UserBag.ins().getBagGoodsByType(ItemType.TYPE_18);itemData.sort(HeartMethod.ins().changeSort);var isSend=false;for(var k in itemData){var sconfig=GlobalConfig.HeartMethodStarConfig[itemData[k].configID];if(sconfig.heartmethodId==id){var pos=GlobalConfig.HeartMethodConfig[id].posList.indexOf(sconfig.posId);if(pos!=-1&&pos==i){isSend=true;HeartMethod.ins().sendHeartChange(this.curRole,id,i+1,sconfig.posItem);break}}}if(!isSend)UserTips.ins().showTips(i18n("HeartMethodWin_0"))}else{ViewManager.ins().open(HeartMethodTips,this.curRole,id,slotId)}break}}};HeartMethodWin.prototype.onTap=function(e){var id=this.getHeartId(this.heartPos);GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,this.winType[this.heartPos]);switch(e.currentTarget){case this.boostBtn:if(this.currentState=="narmal"){if(!HeartMethod.ins().heartUpCondition(this.curRole,id)){UserTips.ins().showTips(i18n("HeartMethodWin_1"));return}if(!this.isHeartUp){UserTips.ins().showTips(i18n("HeartMethodWin_2"));return}HeartMethod.ins().sendHeartUpLevel(this.curRole,id,0)}else if(this.currentState=="stage"){HeartMethod.ins().sendHeartUpLevel(this.curRole,id,0)}break;case this.activeBtn0:this.isAct=true;HeartMethod.ins().sendHeartUpLevel(this.curRole,id,0);break;case this.xiangxishuxing:ViewManager.ins().open(HeartMethodAttrWin,this.curRole,id);break;case this.skill:ViewManager.ins().open(HeartMethodSkillTips,this.curRole,id);break;case this.fenjie:ViewManager.ins().open(HeartMethodDecomposePanel,id);break;case this.leftBtn:var preId=this.getHeartId(this.heartPos-1);var precfg=GlobalConfig.HeartMethodConfig[preId];if(precfg){this.heartPos--;this.heartId=preId;this.updateUI()}else{UserTips.ins().showTips(i18n("HeartMethodWin_3"))}GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,this.winType[this.heartPos]);break;case this.rightBtn:var nextId=this.getHeartId(this.heartPos+1);var nextcfg=GlobalConfig.HeartMethodConfig[nextId];if(nextcfg){this.heartPos++;this.heartId=nextId;this.updateUI()}else{UserTips.ins().showTips(i18n("HeartMethodWin_4"))}GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,this.winType[this.heartPos]);break;case this.getItemTxt0:if(this.conditionDesc.visible){var hmcfg=GlobalConfig.HeartMethodConfig[this.getHeartId(this.heartPos)];UserWarn.ins().setBuyGoodsWarn(hmcfg.posGainGuide)}else UserWarn.ins().setBuyGoodsWarn(this.costId);break}};HeartMethodWin.prototype.init=function(){this.showGroupY=this.showGroup.y;this.showGroupMoveY=this.showGroupY-10;this.heartPages=[];for(var k in GlobalConfig.HeartMethodConfig){this.heartPages.push(GlobalConfig.HeartMethodConfig[k])}this.heartPages.sort(function(a,b){if(a.sort<b.sort)return-1;else return 1});this.heartPos=0;for(var i=0;i<this.heartPages.length;i++){if(this.heartPages[i].id==this.heartId){this.heartPos=i;break}}};HeartMethodWin.prototype.getHeartId=function(posId){if(this.heartPages[posId])return this.heartPages[posId].id;return 0};HeartMethodWin.prototype.updateUI=function(){this.updateAct();this.updateState();this.updatePower();this.updateHeart();this.updateRedPoint();this.updateBtn()};HeartMethodWin.prototype.updateAct=function(){if(this.isAct){RewardWin.showAct(0,GlobalConfig.HeartMethodConfig[this.heartId].name,GlobalConfig.HeartMethodConfig[this.heartId].pic)}this.isAct=false};HeartMethodWin.prototype.updateBtn=function(){this.leftBtn.visible=this.rightBtn.visible=true;var id=this.getHeartId(this.heartPos-1);var cfg=GlobalConfig.HeartMethodConfig[id];if(!cfg){this.redPoint2.visible=this.leftBtn.visible=false}else{if(!HeartMethod.ins().heartOpenCondition(id)){this.redPoint2.visible=this.leftBtn.visible=false}}id=this.getHeartId(this.heartPos+1);cfg=GlobalConfig.HeartMethodConfig[id];if(!cfg){this.redPoint3.visible=this.rightBtn.visible=false}else{if(!HeartMethod.ins().heartOpenCondition(id)){this.redPoint3.visible=this.rightBtn.visible=false}}id=this.getHeartId(this.heartPos);cfg=GlobalConfig.HeartMethodConfig[id];var zslv=cfg.openCondition?cfg.openCondition.zs:GlobalConfig.HeartMethodBaseConfig.zsLv;this.sysDescText0.text=i18n("HeartMethodWin_5",cfg.openTips,zslv)};HeartMethodWin.prototype.updateState=function(){var id=this.getHeartId(this.heartPos);var hminfo=HeartMethod.ins().HeartMethodInfo[this.curRole];if(!hminfo||!hminfo[id]||!hminfo[id].id){this.currentState="open"}else if(HeartMethod.ins().isHeartMax(this.curRole,id)){this.currentState="max"}else if(hminfo[id].isUp){this.currentState="stage"}else{this.currentState="narmal"}this.validateNow()};HeartMethodWin.prototype.updatePower=function(){var id=this.getHeartId(this.heartPos);var proShowList=HeartMethod.ins().proShowList;var attrvalue=HeartMethod.ins().calcHeartTotalValue(this.curRole,id);var attr=[];for(var i=0;i<proShowList.length;i++){var at=new AttributeData;at.type=proShowList[i].id;at.value=attrvalue[i];attr.push(at)}var power=UserBag.getAttrPower(attr);var hminfo=HeartMethod.ins().HeartMethodInfo[this.curRole];if(hminfo){var hmdata=hminfo[id];if(hmdata){var hmLevelConfig=GlobalConfig.HeartMethodLevelConfig[id][hmdata.lv];if(hmLevelConfig){var lpower=hmLevelConfig.power?hmLevelConfig.power:0;power+=lpower}}}var suitLv=HeartMethod.ins().calcHeartSkillLevel(this.curRole,id);if(suitLv){var suitConfig=GlobalConfig.HeartMethodSuitConfig[id][suitLv];var expower=suitConfig.power?suitConfig.power:0;power+=expower}this.powerPanel.setPower(power)};HeartMethodWin.prototype.updateHeart=function(){var id=this.getHeartId(this.heartPos);var hminfo=HeartMethod.ins().HeartMethodInfo[this.curRole];var hmdconfig=GlobalConfig.HeartMethodConfig[id];if(hmdconfig){this.bigIcon.source=hmdconfig.pic;if(!this.bigEff)this.bigEff=new MovieClip;if(!this.bigEff.parent)this.effGroup.addChild(this.bigEff);var slv=HeartMethod.ins().calcHeartSkillLevel(this.curRole,id);if(slv){var suitConfig=GlobalConfig.HeartMethodSuitConfig[id][slv];this.bigEff.playFile(RES_DIR_EFF+suitConfig.inside,-1)}else this.bigEff.playFile(RES_DIR_EFF+hmdconfig.inside,-1)}if(hminfo&&hminfo[id]){this.heartmethodStage.visible=true;this.heartmethodStage.setValue(hminfo[id].stage);this.xinfaName.text=hmdconfig?hmdconfig.name:""}else{this.heartmethodStage.visible=false}if(hmdconfig&&hminfo&&hminfo[id]){for(var i=0;i<hmdconfig.posList.length;i++){var pId=hmdconfig.posList[i];var redPoint=false;var slotId=HeartMethod.ins().getHeartSlotItemId(this.curRole,id,i+1);redPoint=slotId?true:false;if(slotId){var isBug=true;for(var j=0;j<hminfo[id].slots.length;j++){var itemid=hminfo[id].slots[j];var sId=HeartMethod.ins().calcHeartSlotChange(this.curRole,id,itemid);redPoint=sId?true:false;if(!redPoint&&itemid)redPoint=HeartMethod.ins().calcHeartSlotCost(itemid);var hmscfg=GlobalConfig.HeartMethodStarConfig[itemid];if(hmscfg&&hmscfg.posId==pId){isBug=false;this["item"+(i+1)].data={itemid:itemid,redPoint:redPoint};break}}if(isBug){ErrorLog.Assert(!isBug,i18n("HeartMethodWin_6",this.curRole,id,i+1,pId,slotId));this["item"+(i+1)].data=null}}else{var configId=HeartMethod.ins().getHeartSlotItemIdWear(this.curRole,id,i+1);redPoint=configId?true:false;this["item"+(i+1)].data={blank:hmdconfig.blankIcon[i],redPoint:redPoint}}}var attrs=HeartMethod.ins().calcHeartAttrs(this.curRole,id);var attrsNext=HeartMethod.ins().calcHeartAttrsNext(this.curRole,id);this.curAtt0.text=AttributeData.getAttStr(attrs,0,1,"：");this.nextAtt0.text=AttributeData.getAttStr(attrsNext,0,1,"：");var cost=HeartMethod.ins().calcHeartCost(this.curRole,id);this.redPoint0.visible=false;this.isHeartUp=false;var item=void 0;if(cost){this.costId=cost.itemid;var str=this.getItemTxt0.text;this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+str);this.icon0.source=GlobalConfig.ItemConfig[cost.itemid].icon+"_png";item=UserBag.ins().getBagItemById(cost.itemid);var color="";if(item&&item.count>=cost.count){color=i18n("HeartMethodWin_8");this.redPoint0.visible=item.count>=GlobalConfig.HeartMethodStageConfig[id][hminfo[id].stage].normalCostTip;this.isHeartUp=true}else{color=i18n("HeartMethodWin_9")}var sum=item?item.count:0;var color2="|C:"+ColorUtil.UI_ITEMNUMBER_BULE_N+"&T";this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1(i18n("HeartMethodWin_10",color,sum,color2,cost.count))}if(!this.redPoint0.visible)this.redPoint0.visible=hminfo[id].isUp?true:false;if(this.currentState=="max")this.redPoint0.visible=false;else if(this.currentState=="narmal"){if(this.conditionDesc){if(HeartMethod.ins().heartUpCondition(this.curRole,id)){this["costGroup0"].visible=true}else{this["costGroup0"].visible=false}this.conditionDesc.visible=!this["costGroup0"].visible;if(this.conditionDesc.visible){this.redPoint0.visible=false;this.conditionDesc.text=i18n("HeartMethodWin_7",hmdconfig.upGradeCondition)}}}if(!this.starList){this.starList=new StarList(10);this.starList.horizontalCenter=0;this.starList.y=0;this.starGroup.addChild(this.starList)}var lv=hminfo[id].lv;if(lv>0){this.starList.setStarNum(lv%10==0?10:lv%10)}else{this.starList.setStarNum(0)}if(lv>0&&lv%10==0){if(hminfo[id].isUp){this.starList.setStarNum(10)}else{this.starList.setStarNum(0)}}}};HeartMethodWin.prototype.updateRedPoint=function(){var leftId=this.getHeartId(this.heartPos-1);var rightId=this.getHeartId(this.heartPos+1);var leftconfig=GlobalConfig.HeartMethodConfig[leftId];if(!leftconfig){this.redPoint2.visible=false}else{var b=false;for(var i=leftId;i>0;i--){if(HeartMethod.ins().heartOpenCondition(i))b=HeartMethodRedPoint.ins().checkHeartRedPoint(this.curRole,i);if(b)break}this.redPoint2.visible=b}var rightconfig=GlobalConfig.HeartMethodConfig[rightId];if(!rightconfig){this.redPoint3.visible=false}else{var b=false;var len=CommonUtils.getObjectLength(GlobalConfig.HeartMethodConfig);for(var i=rightId;i<=len;i++){if(HeartMethod.ins().heartOpenCondition(i))b=HeartMethodRedPoint.ins().checkHeartRedPoint(this.curRole,i);if(b)break}this.redPoint3.visible=b}var id=this.getHeartId(this.heartPos);this.redPoint.visible=false;var config=GlobalConfig.HeartMethodConfig[id];this.skill.source=config.skillButton};HeartMethodWin.prototype.playIconTween=function(){this.showGroup.y=this.showGroupY;egret.Tween.removeTweens(this.bigIcon);egret.Tween.get(this.bigIcon,{loop:true}).to({y:this.showGroupMoveY},1e3).to({y:this.showGroupY},1e3)};HeartMethodWin.prototype.stopIconTween=function(){egret.Tween.removeTweens(this.showGroup)};return HeartMethodWin}(BaseView);__reflect(HeartMethodWin.prototype,"HeartMethodWin");var Heirloom=function(_super){__extends(Heirloom,_super);function Heirloom(){var _this=_super.call(this)||this;_this.huntTimes=0;_this.huntBoxInfo=[];_this.huntHope=0;_this.huntFreeTimes=0;_this.huntRecords=[];_this.upRequest=false;_this.sysId=PackageID.Heirloom;_this.regNetMsg(1,_this.postHeirloomInfo);_this.regNetMsg(4,_this.doHuntBack);_this.regNetMsg(5,_this.postHuntRecord);_this.regNetMsg(7,_this.postHuntBoxInfo);return _this}Heirloom.ins=function(){return _super.ins.call(this)};Heirloom.prototype.checkRedPoint=function(){if(UserZs.ins().lv<3){return false}var len=SubRoles.ins().subRolesLen;var isShow=false;for(var i=0;i<len;i++){var curRole=SubRoles.ins().getSubRoleByIndex(i);for(var j=0;j<8;j++){var info=curRole.heirloom.getInfoBySolt(j);var config=void 0;if(info.lv){config=GlobalConfig.HeirloomEquipConfig[info.slot][info.lv]}else{config=GlobalConfig.HeirloomEquipFireConfig[j+1]}var costItemLen=0;var need=0;if(config){var expend=config.expend;if(!expend){continue}var itemData=UserBag.ins().getBagItemById(expend.id);costItemLen=itemData?itemData.count:0;need=expend.count;if(costItemLen>=need){isShow=true;break}}}if(isShow)break}return isShow};Heirloom.prototype.sendHeirloomAdd=function(slot){var bytes=this.getBytes(1);bytes.writeByte(slot);this.sendToServer(bytes)};Heirloom.prototype.sendHeirloomAct=function(roleId,slot){var bytes=this.getBytes(2);bytes.writeByte(roleId);bytes.writeByte(slot);this.sendToServer(bytes)};Heirloom.prototype.sendHeirloomUpLevel=function(roleId,slot){var bytes=this.getBytes(3);bytes.writeByte(roleId);bytes.writeByte(slot);this.upRequest=true;this.sendToServer(bytes)};Heirloom.prototype.postHeirloomInfo=function(bytes){var roleId=bytes.readUnsignedByte();var solt=bytes.readUnsignedByte();var lv=bytes.readUnsignedByte();var role=SubRoles.ins().getSubRoleByIndex(roleId);if(role){role.heirloom.update(solt,lv)}};Heirloom.prototype.sendHunt=function(times){var bytes=this.getBytes(4);bytes.writeByte(times);this.sendToServer(bytes)};Heirloom.prototype.sendHuntRecord=function(){this.sendBaseProto(5)};Heirloom.prototype.sendHuntAward=function(index){var bytes=this.getBytes(6);bytes.writeInt(index);this.sendToServer(bytes)};Heirloom.prototype.doHuntBack=function(bytes){var type=bytes.readUnsignedByte();var num=bytes.readUnsignedByte();var arr=[];for(var i=0;i<num;i++)arr[i]=[bytes.readInt(),bytes.readUnsignedByte()];if(ViewManager.ins().isShow(HuntResultWin))this.postHuntResult(type,arr,2);else{ViewManager.ins().open(HuntResultWin,type,arr,2);this.postHuntResult(type,arr,2)}};Heirloom.prototype.postHuntResult=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}return params};Heirloom.prototype.postHuntRecord=function(bytes){this.huntRecords=[];var num=bytes.readUnsignedByte();for(var i=0;i<num;i++)this.huntRecords[i]=[bytes.readString(),bytes.readInt()];this.huntRecords.reverse()};Heirloom.prototype.postHuntBoxInfo=function(bytes){var state=bytes.readInt();this.huntTimes=bytes.readInt();this.huntHope=bytes.readInt();this.huntFreeTimes=bytes.readShort();var config;var i=0;for(var k in GlobalConfig.HeirloomTreasureRewardConfig){config=GlobalConfig.HeirloomTreasureRewardConfig[k];this.huntBoxInfo[i]=state>>config.id&1?Heirloom.ISNGET:this.huntTimes>=config.needTime?Heirloom.CANGET:Heirloom.UNGET;i++}};Heirloom.prototype.getIsGetBox=function(){return this.huntBoxInfo.indexOf(Heirloom.CANGET)!=-1};Heirloom.prototype.getIsGetTen=function(){var sum=this.getHuntItemNum();return sum>=10};Heirloom.prototype.isHeirloomHuntOpen=function(){return UserZs.ins().lv>=GlobalConfig.HeirloomTreasureConfig.openZSlevel&&GameServer.serverOpenDay+1>=GlobalConfig.HeirloomTreasureConfig.openDay};Heirloom.prototype.canHuntFree=function(){var count=this.getHuntItemNum();var huntFreeTimes=this.huntFreeTimes;return count>0||huntFreeTimes>0};Heirloom.prototype.getHuntItemNum=function(){var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.HeirloomTreasureConfig.huntItem);var count=item?item.count:0;return count};Heirloom.prototype.showRedPoint=function(){return this.isHeirloomHuntOpen()&&(this.canHuntFree()||this.getIsGetBox())};Heirloom.UNGET=0;Heirloom.CANGET=1;Heirloom.ISNGET=2;return Heirloom}(BaseSystem);__reflect(Heirloom.prototype,"Heirloom");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.heirloom=Heirloom.ins.bind(Heirloom)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var HeirloomData=function(){function HeirloomData(){this.heirloomData=[]}HeirloomData.prototype.parser=function(bytes){for(var i=0;i<8;i++){var lv=bytes.readInt();if(!this.heirloomData[i])this.heirloomData[i]=new HeirloomInfo;this.heirloomData[i].setInfo(i+1,lv)}};HeirloomData.prototype.update=function(solt,lv){if(solt<=0||solt>8)return;var info=this.heirloomData[solt-1];if(info){info.setInfo(solt,lv)}};HeirloomData.prototype.getData=function(){return this.heirloomData};HeirloomData.prototype.getInfoBySolt=function(index){if(index>=0&&index<8){var info=this.heirloomData[index];if(info){return info}}return null};HeirloomData.getInfoBySoltFirst=function(index){if(index>=0&&index<8){var config=GlobalConfig.HeirloomEquipConfig[index+1][1];return config}return null};HeirloomData.getEquipName=function(index){var str="";switch(index+1){case HeirloomSlot.wq:str=i18n("HeirloomData_0");break;case HeirloomSlot.tk:str=i18n("HeirloomData_1");break;case HeirloomSlot.yf:str=i18n("HeirloomData_2");break;case HeirloomSlot.xl:str=i18n("HeirloomData_3");break;case HeirloomSlot.hw:str=i18n("HeirloomData_4");break;case HeirloomSlot.yd:str=i18n("HeirloomData_5");break;case HeirloomSlot.jz:str=i18n("HeirloomData_6");break;case HeirloomSlot.xz:str=i18n("HeirloomData_7");break}return str};HeirloomData.prototype.getSuitConfig=function(role){var hinfos=role.heirloom.getData();var minLv=0;var everyLv=true;for(var i=0;i<hinfos.length;i++){var info=hinfos[i];if(i==0)minLv=info.lv;if(!info.lv&&everyLv)everyLv=false;if(info.lv<=minLv)minLv=info.lv}var suitConfig;if(everyLv){suitConfig=GlobalConfig.HeirloomEquipSetConfig[minLv]}return suitConfig};return HeirloomData}();__reflect(HeirloomData.prototype,"HeirloomData");var HeirloomSlot;(function(HeirloomSlot){HeirloomSlot[HeirloomSlot["wq"]=1]="wq";HeirloomSlot[HeirloomSlot["tk"]=2]="tk";HeirloomSlot[HeirloomSlot["yf"]=3]="yf";HeirloomSlot[HeirloomSlot["xl"]=4]="xl";HeirloomSlot[HeirloomSlot["hw"]=5]="hw";HeirloomSlot[HeirloomSlot["yd"]=6]="yd";HeirloomSlot[HeirloomSlot["jz"]=7]="jz";HeirloomSlot[HeirloomSlot["xz"]=8]="xz"})(HeirloomSlot||(HeirloomSlot={}));window["HeirloomSlot"]=HeirloomSlot;var HeirloomInfo=function(){function HeirloomInfo(){this.slot=0;this.lv=0;this.expend={id:0,count:0};this.attr=[];this.icon=0;this.name="";this.image="";this.model="";this.skillicon="";this.skillname="";this.skilldesc="";this.attr_add=0}HeirloomInfo.prototype.setInfo=function(slot,lv){if(slot>0&&lv>0){var hleConfig=GlobalConfig.HeirloomEquipConfig[slot][lv];Assert(hleConfig,"HeirloomInfo setInfo error! slot:"+slot+",lv:"+lv);this.slot=hleConfig.slot;this.lv=hleConfig.lv;this.expend=hleConfig.expend;this.attr=hleConfig.attr;this.icon=hleConfig.icon;this.name=hleConfig.name;this.image=hleConfig.image;this.model=hleConfig.model;this.skillicon=hleConfig.skillicon;this.skillname=hleConfig.skillname;this.skilldesc=hleConfig.skilldesc;this.attr_add=hleConfig.attr_add}};return HeirloomInfo}();__reflect(HeirloomInfo.prototype,"HeirloomInfo");var HeirloomCom=function(_super){__extends(HeirloomCom,_super);function HeirloomCom(){var _this=_super.call(this)||this;_this.skinName="heirloomCom";return _this}HeirloomCom.prototype.initUI=function(){_super.prototype.initUI.call(this);this.curIndex=0};HeirloomCom.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(UserBag.ins().postItemDel,this.updateData);this.observe(UserBag.ins().postItemCountChange,this.updateData);this.observe(Heirloom.ins().postHeirloomInfo,this.updateData);this.addTouchEvent(this.rect,this.onClick);this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.getItemTxt0,this.onClick);this.addTouchEvent(this.jihuo0,this.onClick);for(var i=0;i<8;i++){this.addTouchEvent(this["item"+i],this.onTap)}this.initData()};HeirloomCom.prototype.initData=function(){this.model.visible=false;for(var i=0;i<8;i++){var config_7=HeirloomData.getInfoBySoltFirst(i);this["item"+i].data={pos:i,info:config_7};this["item"+i].cleanEff()}this["item0"].selectIcon.visible=true;var config=HeirloomData.getInfoBySoltFirst(0);this.setModel(config);this.setCost(config)};HeirloomCom.prototype.updateData=function(){var pos=this.curIndex;var config=HeirloomData.getInfoBySoltFirst(pos);this["item"+pos].data={pos:pos,info:config};this["item"+pos].cleanEff();this.setCost(config)};HeirloomCom.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<8;i++){this.removeTouchEvent(this["pos"+i],this.onTap)}this.removeTouchEvent(this.rect,this.onClick);this.removeTouchEvent(this.getItemTxt0,this.onClick);this.removeTouchEvent(this.jihuo0,this.onClick);this.removeObserve();this.removeAni()};HeirloomCom.prototype.removeAni=function(){DisplayUtils.removeFromParent(this.modelAni);this.modelAni=null};HeirloomCom.prototype.onClick=function(e){var cfg;var itemData;var config;switch(e.currentTarget){case this.rect:case this.closeBtn:ViewManager.ins().close(this);break;case this.getItemTxt0:config=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];ViewManager.ins().open(ShopGoodsWarn).setData(config.expend.id);break;case this.jihuo0:config=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];if(this.curIndex+1==HeirloomSlot.wq||this.curIndex+1==HeirloomSlot.yf){itemData=UserBag.ins().getBagItemById(config.item);if(itemData){UserTips.ins().showTips(i18n("HeirloomCom_0"));return}}itemData=UserBag.ins().getBagItemById(config.expend.id);var cost=itemData?itemData.count:0;if(cost>=config.expend.count)Heirloom.ins().sendHeirloomAdd(this.curIndex+1);else UserTips.ins().showTips(i18n("HeirloomCom_1"));break}};HeirloomCom.prototype.onTap=function(e){for(var i=0;i<8;i++){this["item"+i].selectIcon.visible=false;switch(e.currentTarget){case this["item"+i]:if(this.curIndex==i){this["item"+i].selectIcon.visible=true;break}this.curIndex=i;this["item"+i].selectIcon.visible=true;var config=HeirloomData.getInfoBySoltFirst(i);this.setModel(config);this.setCost(config);break}}};HeirloomCom.prototype.setModel=function(config){var eff="";if(!config){return}eff=config.model;if(!this.modelAni){this.modelAni=new MovieClip;this.modelAni.playFile(RES_DIR_EFF+eff,-1);this.modelAni.x=this.model.x+this.model.width/2;this.modelAni.y=this.model.y+this.model.height/2;this.model.parent.addChildAt(this.modelAni,this.model.parent.getChildIndex(this.model));return}this.modelAni.playFile(RES_DIR_EFF+eff,-1)};HeirloomCom.prototype.setCost=function(config){if(!config){return}var cfg=GlobalConfig.HeirloomEquipItemConfig[config.slot];var expend=cfg.expend;var equipConfig=GlobalConfig.ItemConfig[expend.id];if(!equipConfig){return}this.icon0.source=equipConfig.icon.toString()+"_png";var itemData=UserBag.ins().getBagItemById(expend.id);var cost=itemData?itemData.count:0;var costItemLen=cost;var colorStr="";if(costItemLen>=expend.count)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;this.countLabel0.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+costItemLen+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+expend.count+"</font> ");var labelbtn=i18n("HeirloomCom_2");if(config.slot==HeirloomSlot.wq){labelbtn=i18n("HeirloomCom_3")}else if(config.slot==HeirloomSlot.yf){labelbtn=i18n("HeirloomCom_4")}this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow(labelbtn)};return HeirloomCom}(BaseEuiView);__reflect(HeirloomCom.prototype,"HeirloomCom");ViewManager.ins().reg(HeirloomCom,LayerManager.UI_Popup);var HeirloomDownItemRenderer=function(_super){__extends(HeirloomDownItemRenderer,_super);function HeirloomDownItemRenderer(){var _this=_super.call(this)||this;_this.configID=0;return _this}HeirloomDownItemRenderer.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};HeirloomDownItemRenderer.prototype.dataChanged=function(){var itemConfig=this.data.itemConfig;var hConfig=GlobalConfig.HeirloomEquipItemConfig;for(var i in hConfig){if(hConfig[i].item==itemConfig.id){var pos=hConfig[i].pos;var info=GlobalConfig.HeirloomEquipConfig[pos][1];this.itemicon.data={pos:pos,info:info};this.itemicon.cleanEff();var costConfig=GlobalConfig.ItemConfig[hConfig[i].downitem.id];var nameLabel=costConfig.name?costConfig.name:i18n("HeirloomDownItemRenderer_0");this.desc.text=nameLabel+" x"+hConfig[i].downitem.count;break}}this.tip.visible=this.data.isSuggest;this.equipName.text=itemConfig.name;this.equipName.textColor=ItemConfig.getQualityColor(itemConfig);this.equipName.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig)};return HeirloomDownItemRenderer}(BaseItemRender);__reflect(HeirloomDownItemRenderer.prototype,"HeirloomDownItemRenderer");var HeirloomDownView=function(_super){__extends(HeirloomDownView,_super);function HeirloomDownView(){var _this=_super.call(this)||this;_this.skinName="heirloomDownSkin";_this.isTopLevel=true;return _this}HeirloomDownView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.listData=new eui.ArrayCollection;this.equipList.itemRenderer=HeirloomDownItemRenderer;this.equipList.dataProvider=this.listData;this.gainList.itemRenderer=GainGoodsItem;this.goList=new eui.ArrayCollection;this.gainList.dataProvider=this.goList};HeirloomDownView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(UserBag.ins().postItemDel,this.updateData);this.observe(UserBag.ins().postItemCountChange,this.updateData);this.observe(UserBag.ins().postUseItemSuccess,this.updateData);this.addTouchEvent(this,this.onTap);this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this);this.curInfo=param[0];this.updateData()};HeirloomDownView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this,this.onTap);this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this);this.removeObserve()};HeirloomDownView.prototype.getHeirloomSource=function(){var itemData=UserBag.ins().getBagEquipsByQuality(5,UserBag.BAG_DESC_TYPE_HEIR,UserBag.BAG_TYPE_OTHTER);for(var i=0;i<itemData.length;i++){itemData[i].isSuggest=true;for(var j=0;j<3;j++){var role=SubRoles.ins().getSubRoleByIndex(j);if(!role)break;var config=GlobalConfig.HeirloomEquipItemConfig;var isBreak=false;for(var k in config){if(config[k].item==itemData[i]._configID){var slot=config[k].pos;var info=role.heirloom.getInfoBySolt(slot-1);if(info&&info.lv>0){isBreak=false}else{itemData[i].isSuggest=false;isBreak=true}break}}if(isBreak)break}}itemData.sort(function(n1,n2){var config1=GlobalConfig.ItemConfig[n1.configID];var config2=GlobalConfig.ItemConfig[n2.configID];if(n1.isSuggest==true&&n2.isSuggest==false){return 1}if(n1.isSuggest==false&&n2.isSuggest==true){return-1}if(config1.id<config2.id){return 1}if(config1.id>config2.id){return-1}return 0});return itemData};HeirloomDownView.prototype.getHeirloomGoSource=function(){if(this.itemList){return this.itemList}var item=UserBag.ins().getBagItemById(200141);var gainConfig;if(!item){if(!this.curInfo)return this.itemList;var expendId=0;if(this.curInfo.expend){expendId=this.curInfo.expend.id}else{expendId=GlobalConfig.HeirloomEquipConfig[this.curInfo.slot][this.curInfo.lv-1].expend.id}gainConfig=GlobalConfig.GainItemConfig[expendId]}else{gainConfig=GlobalConfig.GainItemConfig[item._configID]}if(gainConfig){this.gainList.dataProvider=new eui.ArrayCollection(gainConfig.gainWay);this.itemList=gainConfig.gainWay}else{this.gainList.dataProvider=new eui.ArrayCollection([]);this.itemList=[]}return this.itemList};HeirloomDownView.prototype.updateData=function(){var source,goList;source=this.getHeirloomSource();goList=this.getHeirloomGoSource();goList=goList?goList:[];this.listData.source=source;this.goList.source=goList;var dataNum=goList.length;this.refushPos(dataNum)};HeirloomDownView.prototype.refushPos=function(len){this.contrain.height=60*len;this.equipScroller.height=310+60*(3-len)};HeirloomDownView.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;default:if(e.target instanceof eui.Button){switch(e.target.name){case"breakDown":this.onHandler(e.target.parent["data"]);break}}}};HeirloomDownView.prototype.onHandler=function(data){var itemData=[data];for(var i=0;i<itemData.length;i++){if(itemData[i]){if(UserBag.ins().sendUseItem(itemData[i]._configID,itemData[i].count)){break}}}};HeirloomDownView.prototype.onGo=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2]);ViewManager.ins().close(this)}};return HeirloomDownView}(BaseEuiView);__reflect(HeirloomDownView.prototype,"HeirloomDownView");ViewManager.ins().reg(HeirloomDownView,LayerManager.UI_Popup);var HeirloomEquipTipsWin=function(_super){__extends(HeirloomEquipTipsWin,_super);function HeirloomEquipTipsWin(){var _this=_super.call(this)||this;_this.skinName="heirloomitemtips";return _this}HeirloomEquipTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};HeirloomEquipTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curRole=param[0];this.index=param[1];if(this.curRole&&this.curRole.heirloom)this.info=this.curRole.heirloom.getInfoBySolt(this.index);if(!this.info||!this.info.lv)this.info=GlobalConfig.HeirloomEquipConfig[this.index+1][1];this.addTouchEndEvent(this.bgClose,this.onClick);this.init()};HeirloomEquipTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeObserve()};HeirloomEquipTipsWin.prototype.init=function(){this.equipItem.data={pos:this.index,info:this.info};this.equipItem.setTipsVisible();this.equipName.text=this.info.name;this.slot.text=HeirloomData.getEquipName(this.index);var attrs=this.setBasicsDesc();this.setSpecialDesc();this.setSkillDesc();var power=Math.floor(UserBag.getAttrPower(attrs));this.power.text=i18n("HeirloomEquipTipsWin_0")+power;if(this.curRole){power=this.curRole.getHeirloomSlotPower(this.index)}this.powerPanel.setPower(power)};HeirloomEquipTipsWin.prototype.onClick=function(){ViewManager.ins().close(this)};HeirloomEquipTipsWin.prototype.setBasicsDesc=function(){var attrs=[];for(var i=0;i<this.info.attr.length;i++){if(i>3){break}var ad=new AttributeData;var attr=this.info.attr[i];var str=AttributeData.getAttrStrByType(attr.type);str+="+"+attr.value;this["value"+i].text=str;ad.type=attr.type;ad.value=attr.value;attrs.push(ad)}return attrs};HeirloomEquipTipsWin.prototype.setSpecialDesc=function(){for(var i=4;i<this.info.attr.length;i++){if(this["value"+i]){var attr=this.info.attr[i];var str_2=AttributeData.getAttrStrByType(attr.type);str_2+="+"+attr.value;this["value"+i].text=str_2}}var str=HeirloomData.getEquipName(this.index);str+=i18n("HeirloomEquipTipsWin_1")+this.info.attr_add+"%";this["value6"].text=str};HeirloomEquipTipsWin.prototype.setSkillDesc=function(){var str="";if(this.info.skillname)str=this.info.skillname+"\n"+this.info.skilldesc;else str=i18n("HeirloomEquipTipsWin_2");this.skilldesc.textFlow=TextFlowMaker.generateTextFlow1(str)};return HeirloomEquipTipsWin}(BaseEuiView);__reflect(HeirloomEquipTipsWin.prototype,"HeirloomEquipTipsWin");ViewManager.ins().reg(HeirloomEquipTipsWin,LayerManager.UI_Popup);var HeirloomSkillItem=function(_super){__extends(HeirloomSkillItem,_super);function HeirloomSkillItem(){return _super.call(this)||this}HeirloomSkillItem.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="heirloomTipsSkin"};HeirloomSkillItem.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var icon=param[0];var name=param[1];var desc=param[2];this.addTouchEndEvent(this,this.onClick);this.setData(icon,name,desc)};HeirloomSkillItem.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};HeirloomSkillItem.prototype.onClick=function(evt){ViewManager.ins().close(this)};HeirloomSkillItem.prototype.setData=function(icon,name,desc){this.itemIcon.setSkillData(icon);this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1(name);this.description.textFlow=TextFlowMaker.generateTextFlow1(desc)};return HeirloomSkillItem}(BaseEuiView);__reflect(HeirloomSkillItem.prototype,"HeirloomSkillItem");ViewManager.ins().reg(HeirloomSkillItem,LayerManager.UI_Popup);var HeirloomSuit=function(_super){__extends(HeirloomSuit,_super);function HeirloomSuit(){var _this=_super.call(this)||this;_this.skinName="heirloomSuit";return _this}HeirloomSuit.prototype.initUI=function(){_super.prototype.initUI.call(this);this.model1=new MovieClip;this.model1.x=this.eff1.x;this.model1.y=this.eff1.y;this.eff1.parent.addChild(this.model1);this.model2=new MovieClip;this.model2.x=this.eff2.x;this.model2.y=this.eff2.y;this.eff2.parent.addChild(this.model2)};HeirloomSuit.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.onClick);var roleId=param[0];this.curRole=SubRoles.ins().getSubRoleByIndex(roleId);this.setData()};HeirloomSuit.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);DisplayUtils.removeFromParent(this.model1);DisplayUtils.removeFromParent(this.model2);this.model1=null;this.model2=null};HeirloomSuit.prototype.onClick=function(evt){ViewManager.ins().close(this)};HeirloomSuit.prototype.setData=function(){var hinfos=this.curRole.heirloom.getData();if(!hinfos)return null;var minlv=this.getMinEquipLv(hinfos);var strMap=this.getInfoMation(hinfos,minlv);this.setCurSuit(minlv,strMap.str1,strMap.lv1);this.setNextSuit(minlv,strMap.str2,strMap.lv2)};HeirloomSuit.prototype.setCurSuit=function(minlv,str,lvNum){if(!minlv){for(var i=0;i<8;i++){this["desc"+i].visible=false;this["attr"+i].visible=false}this.informationname0.visible=false;this.num0.visible=false;this.name0.text=i18n("HeirloomSuit_0");return}this.informationname0.textFlow=TextFlowMaker.generateTextFlow(str);var id=minlv?minlv:1;var config=GlobalConfig.HeirloomEquipSetConfig[id];for(var i=0;i<config.attr.length;i++){var cfg=config.attr[i];if(lvNum<8){this["attr"+i].textColor=ColorUtil.GRAY_COLOR2;this["desc"+i].textColor=ColorUtil.GRAY_COLOR2}this["desc"+i].text=this.getAttrName(cfg.type);var value=cfg.value;if(cfg.type==AttributeType.atCritEnhance)value+=15e3;var vtext="+"+value;if(i>=4){value/=100;vtext="+"+value+"%"}this["attr"+i].text=vtext;this["attr"+i].x=this["desc"+i].x+this["desc"+i].width}for(var i=config.attr.length;i<8;i++){this["cgroup"+i].visible=false}this.name0.text=config.name;this.num0.text="（"+lvNum+"/8）";this.model1.playFile(RES_DIR_EFF+config.neff,-1)};HeirloomSuit.prototype.setNextSuit=function(minlv,str,lvNum){this.informationname1.textFlow=TextFlowMaker.generateTextFlow(str);var id=minlv?minlv+1:1;var config=GlobalConfig.HeirloomEquipSetConfig[id];if(!config){this.name1.text=i18n("HeirloomSuit_1");this.num1.visible=false;this.informationname1.visible=false;for(var i=0;i<8;i++){this["ngroup"+i].visible=false}return}for(var i=0;i<config.attr.length;i++){var cfg=config.attr[i];this["ndesc"+i].text=this.getAttrName(cfg.type);var value=cfg.value;if(cfg.type==AttributeType.atCritEnhance)value+=15e3;var vtext="+"+value;if(i>=4){value/=100;vtext="+"+value+"%"}this["nattr"+i].text=vtext;this["nattr"+i].x=this["ndesc"+i].x+this["ndesc"+i].width}for(var i=config.attr.length;i<8;i++){this["ngroup"+i].visible=false}this.name1.text=config.name;this.num1.text="（"+lvNum+"/8）";this.model2.playFile(RES_DIR_EFF+config.neff,-1)};HeirloomSuit.prototype.getInfoMation=function(hinfos,minlv){var str1="";var str2="";var lv1=0;var lv2=0;var minlv2=minlv?minlv+1:1;for(var i=0;i<hinfos.length;i++){var info=hinfos[i];var title=HeirloomData.getEquipName(i);if(!info.lv){str1+=i18n("HeirloomSuit_10",ColorUtil.GRAY_COLOR2,title);str2+=i18n("HeirloomSuit_11",ColorUtil.GRAY_COLOR2,title)}else{if(info.lv>=minlv){lv1++;str1+=i18n("HeirloomSuit_12",ColorUtil.WHITE_COLOR2,title)}else{str1+=i18n("HeirloomSuit_13",ColorUtil.GRAY_COLOR2,title)}if(info.lv>=minlv2){lv2++;str2+=i18n("HeirloomSuit_14",ColorUtil.WHITE_COLOR2,title)}else{str2+=i18n("HeirloomSuit_15",ColorUtil.GRAY_COLOR2,title)}}}return{str1:str1,str2:str2,lv1:lv1,lv2:lv2}};HeirloomSuit.prototype.getMinEquipLv=function(hinfos){var minLv=0;var everyLv=true;for(var i=0;i<hinfos.length;i++){var info=hinfos[i];if(i==0)minLv=info.lv;if(!info.lv&&everyLv)everyLv=false;if(info.lv<=minLv)minLv=info.lv}if(!everyLv){for(var i=0;i<8;i++){this["desc"+i].textColor=ColorUtil.GRAY_COLOR2;this["attr"+i].textColor=ColorUtil.GRAY_COLOR2}}return minLv};HeirloomSuit.prototype.getAttrName=function(attType){var str="";switch(attType){case AttributeType.atAttack:str=i18n("HeirloomSuit_2");break;case AttributeType.atMaxHp:str=i18n("HeirloomSuit_3");break;case AttributeType.atDef:str=i18n("HeirloomSuit_4");break;case AttributeType.atRes:str=i18n("HeirloomSuit_5");break;case AttributeType.atRoleDamageEnhance:str=i18n("HeirloomSuit_6");break;case AttributeType.atRoleDamageReduction:str=i18n("HeirloomSuit_7");break;case AttributeType.atCritEnhance:str=i18n("HeirloomSuit_8");break;case AttributeType.atPenetrate:str=i18n("HeirloomSuit_9");break}return str};return HeirloomSuit}(BaseEuiView);__reflect(HeirloomSuit.prototype,"HeirloomSuit");ViewManager.ins().reg(HeirloomSuit,LayerManager.UI_Popup);var HeirloomWin=function(_super){__extends(HeirloomWin,_super);function HeirloomWin(){var _this=_super.call(this)||this;_this.skinName="heirloom";_this.isTopLevel=true;return _this}HeirloomWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.icon0.alpha=0;this.curIndex=0};HeirloomWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!OpenSystem.ins().checkSysOpen(SystemType.HEIRLOOM)){UserTips.ins().showTips(i18n("HeirloomWin_1"));return false}return true};HeirloomWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var selectedIndex=param?param[0]:0;this.roleSelect.setCurRole(selectedIndex);this.observe(UserBag.ins().postItemDel,this.updateData);this.observe(UserBag.ins().postItemCountChange,this.updateData);this.observe(Heirloom.ins().postHeirloomInfo,this.updateData);this.observe(Actor.ins().postPowerChange,this.refreshPower);this.addChangeEvent(this.roleSelect,this.switchRole);for(var i=0;i<8;i++){this.addTouchEvent(this["pos"+i],this.onTap)}this.addTouchEvent(this.rightBtn,this.onClick);this.addTouchEvent(this.leftBtn,this.onClick);this.addTouchEvent(this.getItemTxt,this.onClick);this.addTouchEvent(this.jihuo,this.onClick);this.addTouchEvent(this.attrSet,this.onClick);this.addTouchEvent(this.neatSet,this.onClick);this.addTouchEvent(this.skill,this.onSkill);this.addTouchEvent(this.icon0,this.onClick);this.addTouchEvent(this.closeBtn,this.onClick);this.initData();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.heirloom)};HeirloomWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<8;i++){this.removeTouchEvent(this["pos"+i],this.onTap)}this.removeTouchEvent(this.rightBtn,this.onClick);this.removeTouchEvent(this.leftBtn,this.onClick);this.removeTouchEvent(this.getItemTxt,this.onClick);this.removeTouchEvent(this.jihuo,this.onClick);this.removeTouchEvent(this.attrSet,this.onClick);this.removeTouchEvent(this.neatSet,this.onClick);this.removeTouchEvent(this.skill,this.onSkill);this.roleSelect.removeEventListener(egret.Event.CHANGE,this.switchRole,this);this.removeTouchEvent(this.icon0,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick);this.removeObserve();this.removeAni();this.clearEff();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};HeirloomWin.prototype.removeAni=function(){DisplayUtils.removeFromParent(this.modelAni);this.modelAni=null};HeirloomWin.prototype.refreshPower=function(){this.roleSelect.refreshPower(this.roleSelect._curRole)};HeirloomWin.prototype.onSkill=function(e){switch(e.currentTarget){case this.skill:ViewManager.ins().open(HeirloomSkillItem,this.skill.itemIcon.imgIcon.source,this.skill.skillname,this.skill.skilldesc);break}};HeirloomWin.prototype.onClick=function(e){switch(e.target){case this.leftBtn:this.leftBtn.visible=false;this.rightBtn.visible=true;this.pre();break;case this.rightBtn:this.rightBtn.visible=false;this.leftBtn.visible=true;this.next();break;case this.getItemTxt:var tipsPos=0;if(this.getItemTxt.text==i18n("HeirloomWin_2")){tipsPos=HeirloomSlot.wq}else if(this.getItemTxt.text==i18n("HeirloomWin_3")){tipsPos=HeirloomSlot.yf}if(tipsPos){var config=GlobalConfig.HeirloomEquipItemConfig[tipsPos];ViewManager.ins().open(ShopGoodsWarn).setData(config.item);return}if(this.getItemTxt.text==i18n("HeirloomWin_4")){ViewManager.ins().open(HeirloomCom)}else{var cr=this.roleSelect.getCurRole();var r=SubRoles.ins().getSubRoleByIndex(cr);var ifo=r.heirloom.getInfoBySolt(this.curIndex);ViewManager.ins().open(HeirloomDownView,ifo)}break;case this.jihuo:var hinfo=this.getInitInfo();var curRole=this.roleSelect.getCurRole();var role=SubRoles.ins().getSubRoleByIndex(curRole);var info=role.heirloom.getInfoBySolt(this.curIndex);var slot=this.curIndex+1;if(info&&info.lv>0){var tips=this.check(hinfo);if(tips==HeirloomWin.Heir_TIPS_1){Heirloom.ins().sendHeirloomUpLevel(curRole,slot)}else if(tips==HeirloomWin.Heir_TIPS_2){UserTips.ins().showTips(i18n("HeirloomWin_5"))}else{var config=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];ViewManager.ins().open(ShopGoodsWarn).setData(config.expend.id)}}else{var tips=this.check(hinfo);if(tips==HeirloomWin.Heir_TIPS_1){Heirloom.ins().sendHeirloomAct(curRole,slot)}else{var config=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];ViewManager.ins().open(ShopGoodsWarn).setData(config.item)}}break;case this.attrSet:var rId=this.roleSelect.getCurRole();ViewManager.ins().open(RoleAttrWin,rId);break;case this.neatSet:var roleId=this.roleSelect.getCurRole();ViewManager.ins().open(HeirloomSuit,roleId);break;case this.icon0:var rd=this.roleSelect.getCurRole();var crole=SubRoles.ins().getSubRoleByIndex(rd);ViewManager.ins().open(HeirloomEquipTipsWin,crole,this.curIndex);break;case this.closeBtn:ViewManager.ins().close(this);break}};HeirloomWin.prototype.pre=function(){var info=this.getInitInfo();this.setHeirloom(this.curIndex,HeirloomWin.Heir_LRBtn,info)};HeirloomWin.prototype.next=function(){var info=this.getInitInfo();var slot=this.curIndex+1;var level=info.lv?info.lv+1:info.lv+2;var config=this.getSlotInfoByLv(slot,level);this.setHeirloom(this.curIndex,HeirloomWin.Heir_LRBtn,config)};HeirloomWin.prototype.onTap=function(e){var curRole=this.roleSelect.getCurRole();var role=SubRoles.ins().getSubRoleByIndex(curRole);for(var i=0;i<8;i++){this["pos"+i].setSelectIconVisible(false);switch(e.currentTarget){case this["pos"+i]:if(this.curIndex==i){this["pos"+i].setSelectIconVisible(true);ViewManager.ins().open(HeirloomEquipTipsWin,role,i);break}this.curIndex=i;this.setHeirloom(i,HeirloomWin.Heir_Select);this["pos"+i].setSelectIconVisible(true);break}}};HeirloomWin.prototype.updateData=function(){var uplevel=Heirloom.ins().upRequest;this.setHeirloom(this.curIndex,HeirloomWin.Heir_Select,null,uplevel);if(uplevel)Heirloom.ins().upRequest=false;this.setSuitLvIcon();this.setRedPoint();this.updateRedPoint();this.setPower();var role=EntityManager.ins().getMainRole(this.roleSelect.getCurRole());if(role)role.setHeirloomSuitEff()};HeirloomWin.prototype.updateRedPoint=function(){for(var i=0;i<SubRoles.ins().subRolesLen;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(!role)continue;var isShowRedPoint=false;for(var j=0;j<8;j++){var info=this.getInitInfoEx(role,j);var config=void 0;if(info.lv){config=GlobalConfig.HeirloomEquipConfig[info.slot][info.lv]}else{config=GlobalConfig.HeirloomEquipFireConfig[j+1]}var costItemLen=0;var need=0;if(config){var expend=config.expend;if(!expend){continue}var itemData=UserBag.ins().getBagItemById(expend.id);costItemLen=itemData?itemData.count:0;need=expend.count}if(costItemLen>=need){isShowRedPoint=true;break}else isShowRedPoint=false}this.roleSelect.showRedPoint(i,isShowRedPoint)}};HeirloomWin.prototype.initData=function(){var info=this.getInitInfo();for(var i=0;i<8;i++){this.setHeirloom(i,HeirloomWin.Heir_Init,info)}this["pos0"].setSelectIconVisible(true);this.setSuitLvIcon();this.setRedPoint();this.setPower();this.updateRedPoint()};HeirloomWin.prototype.switchRole=function(){this.curIndex=0;this.initData()};HeirloomWin.prototype.setHeirloom=function(index,init,hinfo,uplevel){var info;if(init==HeirloomWin.Heir_Init){info=hinfo}else if(init==HeirloomWin.Heir_Select){info=this.getInitInfo(index);if(!info.lv){var cfg=GlobalConfig.HeirloomEquipConfig[index+1][1];info.skillname=cfg.skillname;info.skilldesc=cfg.skilldesc;info.skillicon=cfg.skillicon;info.name=cfg.name}}else{info=hinfo}if(info){this.setModel(init,index,info);this.setUI(init,index,info);this.setDesc(init,index,info);this.setCost(init,index,info)}if(init!=HeirloomWin.Heir_LRBtn){if(init==HeirloomWin.Heir_Init&&index>0){info=this.getInitInfo(index)}if(!info.lv){var cfg=GlobalConfig.HeirloomEquipConfig[index+1][1];info.name=cfg.name}this["pos"+index].selectIcon.visible=false;this["pos"+index].data={pos:index,info:info,uplevel:uplevel}}if(init==HeirloomWin.Heir_Init&&index==0||init==HeirloomWin.Heir_LRBtn||init==HeirloomWin.Heir_Select){var cfg=GlobalConfig.HeirloomEquipConfig[index+1][1];if(info.skillicon){cfg=info}if(cfg.skillicon){this.skill.visible=true;this.skill.data={pos:index,info:info,icon:cfg.skillicon,skillname:cfg.skillname,skilldesc:cfg.skilldesc};this.skill.cleanEff()}}};HeirloomWin.prototype.setUI=function(init,index,hinfo){var info;if(init==HeirloomWin.Heir_Init){if(index>0)return}else if(init==HeirloomWin.Heir_Select){if(this.curIndex!=index)return}else if(init==HeirloomWin.Heir_LRBtn){this.itemName.text=hinfo.name;return}info=hinfo;if(!info.expend||!info.lv)this.rightBtn.visible=false;else this.rightBtn.visible=true;this.leftBtn.visible=false;if(init==HeirloomWin.Heir_LRBtn){info=this.getInitInfo()}if(info.lv>0){this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow(i18n("HeirloomWin_6"));this.jihuo.label=i18n("HeirloomWin_8");var config=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];var itemData=UserBag.ins().getBagItemById(config.item);if(itemData){this.setEff()}else{this.clearEff()}}else{this.clearEff();var str=i18n("HeirloomWin_9");var config=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];if(config.pos==HeirloomSlot.wq){var itemData=UserBag.ins().getBagItemById(config.item);if(itemData)str=i18n("HeirloomWin_11")}else if(config.pos==HeirloomSlot.yf){var itemData=UserBag.ins().getBagItemById(config.item);if(itemData)str=i18n("HeirloomWin_12")}this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow("|U&T:"+str);this.jihuo.label=i18n("HeirloomWin_13")}if(info.skillicon){this.skill.visible=true;this.skill.data={pos:index,info:info,icon:info.skillicon,skillname:info.skillname,skilldesc:info.skilldesc};this.skill.cleanEff()}else{this.skill.visible=false}this.itemName.text=info.name};HeirloomWin.prototype.setEff=function(){if(!this.resolveMc)this.resolveMc=new MovieClip;if(!this.resolveMc.parent){this.getItemTxt.parent.addChild(this.resolveMc);this.resolveMc.playFile(RES_DIR_EFF+"chargeff1",-1);this.resolveMc.touchEnabled=false;this.resolveMc.scaleY=.6;this.resolveMc.scaleX=.6}this.resolveMc.x=this.getItemTxt.x+38;this.resolveMc.y=this.getItemTxt.y+9};HeirloomWin.prototype.clearEff=function(){DisplayUtils.removeFromParent(this.resolveMc)};HeirloomWin.prototype.setModel=function(init,index,hinfo){var eff="";var info;if(init==HeirloomWin.Heir_Init){if(index>0)return}else if(init==HeirloomWin.Heir_Select){if(this.curIndex!=index)return}this.removeAni();info=hinfo;if(info&&info.lv>0){eff=info.model}else{var config=GlobalConfig.HeirloomEquipConfig[index+1][1];eff=config.model}if(!this.modelAni){this.modelAni=new MovieClip;this.modelAni.playFile(RES_DIR_EFF+eff,-1);this.modelAni.x=this.icon0.x+this.icon0.width/2;this.modelAni.y=this.icon0.y+this.icon0.height/2;this.modelAni.touchEnabled=false;this.icon0.parent.addChildAt(this.modelAni,this.icon0.parent.getChildIndex(this.icon0));return}this.modelAni.playFile(RES_DIR_EFF+eff,-1)};HeirloomWin.prototype.setDesc=function(init,index,hinfo){var info;if(init==HeirloomWin.Heir_Init){if(index>0)return}else if(init==HeirloomWin.Heir_Select){if(this.curIndex!=index)return}info=hinfo;var attr=[];var config;if(info&&info.lv>0){attr=info.attr}else{config=GlobalConfig.HeirloomEquipConfig[index+1][1];attr=config.attr}for(var i=0;i<6;i++){switch(attr[i].type){case AttributeType.atAttack:this.desc0.text=i18n("HeirloomWin_14");this.attr0.text="+"+attr[i].value;break;case AttributeType.atMaxHp:this.desc1.text=i18n("HeirloomWin_15");this.attr1.text="+"+attr[i].value;break;case AttributeType.atDef:this.desc2.text=i18n("HeirloomWin_16");this.attr2.text="+"+attr[i].value;break;case AttributeType.atRes:this.desc3.text=i18n("HeirloomWin_17");this.attr3.text="+"+attr[i].value;break;case AttributeType.atCrit:case AttributeType.atCritHurt:this.desc4.text=i18n("HeirloomWin_18");this.attr4.text="+"+attr[i].value;break;case AttributeType.cruNeiGong:case AttributeType.maxNeiGong:this.desc5.text=i18n("HeirloomWin_19");this.attr5.text="+"+attr[i].value;break}}var swType=info.slot?info.slot:config.slot;var str="";switch(swType){case HeirloomSlot.wq:str=i18n("HeirloomWin_20");break;case HeirloomSlot.tk:str=i18n("HeirloomWin_21");break;case HeirloomSlot.yf:str=i18n("HeirloomWin_22");break;case HeirloomSlot.xl:str=i18n("HeirloomWin_23");break;case HeirloomSlot.hw:str=i18n("HeirloomWin_24");break;case HeirloomSlot.yd:str=i18n("HeirloomWin_25");break;case HeirloomSlot.jz:str=i18n("HeirloomWin_26");break;case HeirloomSlot.xz:str=i18n("HeirloomWin_27");break}var attrAdd=info.attr_add?info.attr_add:config.attr_add;this.desc6.text=str+i18n("HeirloomWin_28");this.attr6.text="+"+attrAdd+"%";this.attr6.x=this.desc6.x+this.desc6.width+20};HeirloomWin.prototype.setCost=function(init,index,hinfo){var info;if(init==HeirloomWin.Heir_Init){if(index>0)return;info=hinfo}else if(init==HeirloomWin.Heir_Select){if(this.curIndex!=index)return;info=hinfo}else if(init==HeirloomWin.Heir_LRBtn){info=this.getInitInfo()}var config;if(info.lv>0){config=GlobalConfig.HeirloomEquipConfig[info.slot][info.lv]}else{config=GlobalConfig.HeirloomEquipFireConfig[index+1]}if(config){var expend=config.expend;this.jihuo.visible=true;this.expendLabel.text=i18n("HeirloomWin_29");if(!expend){this.expendLabel.text="";this.countLabel.text=i18n("HeirloomWin_30");this.jihuo.visible=false;return}var equipConfig=GlobalConfig.ItemConfig[expend.id];if(!equipConfig){return}this.icon.source=equipConfig.icon.toString()+"_png";var itemData=UserBag.ins().getBagItemById(expend.id);var costItemLen=itemData?itemData.count:0;var colorStr="";if(costItemLen>=expend.count)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+costItemLen+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+expend.count+"</font> ")}};HeirloomWin.prototype.check=function(info){var config;var func;var costItemLen=0;var need=0;if(info.lv>0){config=GlobalConfig.HeirloomEquipConfig[info.slot][info.lv]}else{config=GlobalConfig.HeirloomEquipFireConfig[this.curIndex+1]}if(config){var expend=config.expend;if(!expend){return HeirloomWin.Heir_TIPS_2}var equipConfig=GlobalConfig.ItemConfig[expend.id];if(!equipConfig){return HeirloomWin.Heir_TIPS_0}var itemData=UserBag.ins().getBagItemById(expend.id);costItemLen=itemData?itemData.count:0;need=expend.count}if(costItemLen>=need){return HeirloomWin.Heir_TIPS_1}return HeirloomWin.Heir_TIPS_0};HeirloomWin.prototype.getInitInfoEx=function(role,index){var idx=index;var info=role.heirloom.getInfoBySolt(idx);return info};HeirloomWin.prototype.getInitInfo=function(index){var idx=index!=null?index:this.curIndex;var curRole=this.roleSelect.getCurRole();var role=SubRoles.ins().getSubRoleByIndex(curRole);var info=role.heirloom.getInfoBySolt(idx);return info};HeirloomWin.prototype.getSlotInfoByLv=function(slot,lv){var curRole=this.roleSelect.getCurRole();var role=SubRoles.ins().getSubRoleByIndex(curRole);var config=GlobalConfig.HeirloomEquipConfig[slot][lv];return config};HeirloomWin.prototype.setSuitLvIcon=function(){var curRole=this.roleSelect.getCurRole();var role=SubRoles.ins().getSubRoleByIndex(curRole);var hinfos=role.heirloom.getData();var minLv=0;var everyLv=true;for(var i=0;i<hinfos.length;i++){var info=hinfos[i];if(i==0)minLv=info.lv;if(!info.lv&&everyLv)everyLv=false;if(info.lv<=minLv)minLv=info.lv}this.neatSet.currentState=minLv.toString()};HeirloomWin.prototype.setRedPoint=function(){var isShowRedPoint=false;for(var i=0;i<8;i++){var info=this.getInitInfo(i);var config=void 0;if(info.lv){config=GlobalConfig.HeirloomEquipConfig[info.slot][info.lv]}else{config=GlobalConfig.HeirloomEquipFireConfig[i+1]}var costItemLen=0;var need=0;if(config){var expend=config.expend;if(!expend){this["pos"+i].redPoint.visible=false;continue}var itemData=UserBag.ins().getBagItemById(expend.id);costItemLen=itemData?itemData.count:0;need=expend.count}if(costItemLen>=need)this["pos"+i].redPoint.visible=true;else this["pos"+i].redPoint.visible=false;if(!this["pos"+i].redPoint.visible){var cfg=GlobalConfig.HeirloomEquipItemConfig[config.slot];var itemData=UserBag.ins().getBagItemById(cfg.item);this["pos"+i].redPoint.visible=itemData?true:false}if(!isShowRedPoint)isShowRedPoint=this["pos"+i].redPoint.visible}if(isShowRedPoint){var curRole=this.roleSelect.getCurRole();this.roleSelect.showRedPoint(curRole,isShowRedPoint)}};HeirloomWin.prototype.setPower=function(){var roleId=this.roleSelect.getCurRole();var power=SubRoles.ins().getSubRoleByIndex(roleId).getAllHeirloomPower();this.powerPanel.setPower(power)};HeirloomWin.Heir_Init=1;HeirloomWin.Heir_Select=2;HeirloomWin.Heir_LRBtn=3;HeirloomWin.Heir_TIPS_0=0;HeirloomWin.Heir_TIPS_1=1;HeirloomWin.Heir_TIPS_2=2;return HeirloomWin}(BaseEuiView);__reflect(HeirloomWin.prototype,"HeirloomWin");ViewManager.ins().reg(HeirloomWin,LayerManager.UI_Main);var HejiMoreEffPlayer=function(){function HejiMoreEffPlayer(){this.playHejiCfgCnt=8}HejiMoreEffPlayer.ins=function(){if(this._instance==null){this._instance=new HejiMoreEffPlayer}return this._instance};HejiMoreEffPlayer.prototype.checkForPlayMore=function(configs,source,target,rate){if(target===void 0){target=[]}if(rate===void 0){rate=1}if(this.isHejiConfigs(configs)){this.playMoreHejiConfigs(configs,source,target,rate)}};HejiMoreEffPlayer.prototype.isHejiConfigs=function(configs){var hejiEffId="401";if(configs&&configs[0]&&configs[0].effectId.indexOf(hejiEffId)>-1){return true}var hejiEffId2="skill405_0";if(configs&&configs[0]&&configs[0].effectId.indexOf(hejiEffId2)>-1){return true}return false};HejiMoreEffPlayer.prototype.playMoreHejiConfigs=function(configs,source,target,rate){var _this=this;if(target===void 0){target=[]}if(rate===void 0){rate=1}if(!configs)return;if(!SkillEffPlayer.setTimeout){console.warn(i18n("HejiMoreEffPlayer_0"));return}var posArr=this.createPosArr();var interTime=100;var _loop_19=function(n){TimerManager.ins().doTimer(interTime+n*interTime,1,function(){var _loop_20=function(i){var config=configs[i];config=SkillEffConfig.initValue(config);SkillEffPlayer.setTimeout(config.delay/rate,function(){if(config.type>50){return}var mc=ObjectPool.pop("MovieClip");mc.rate=config.playSpeed*(config.isRate?rate:1);var fileName=SkillEffPlayer.urlSkillEff+config.effectId;var s=fileName;mc.playFile(s,config.playCount,function(){_this.removeMC(mc)});mc.x=config.x;mc.y=config.y;mc.scaleX=config.scaleX;mc.scaleY=config.scaleY;mc.alpha=config.alpha;var layer=config.layer;var layerFun=_this["layer"+layer];if(layerFun){layerFun.call(_this,_this.setEffParam(mc,posArr,n))}},_this)};for(var i=0;i<configs.length;i++){_loop_20(i)}},this_14)};var this_14=this;for(var n=0;n<this.playHejiCfgCnt;++n){_loop_19(n)}};HejiMoreEffPlayer.prototype.stop=function(){TimerManager.ins().removeAll(this)};HejiMoreEffPlayer.prototype.setEffParam=function(mc,posArr,n){if(!posArr[n]){return null}var role=EntityManager.ins().getNoDieRole();if(!role){return null}var role_x=role.x;var role_y=role.y;return{mc:mc,x:posArr[n].x+role_x,y:posArr[n].y+role_y}};HejiMoreEffPlayer.prototype.createPosArr=function(){var rectX=380;var rectY=480;var limitWidth=100;var posArr=[];while(posArr.length<this.playHejiCfgCnt){var offsetX=Math.floor(Math.random()*rectX)-rectX/2;var offsetY=Math.floor(Math.random()*rectY)-rectY/2;var isAdd=true;for(var k in posArr){var x=posArr[k].x;var y=posArr[k].y;if(Math.abs(x-offsetX)<limitWidth&&Math.abs(y-offsetY)<limitWidth){isAdd=false;break}}if(isAdd)posArr.push({x:offsetX,y:offsetY})}posArr.sort(function(a,b){return a.y-b.y});return posArr};HejiMoreEffPlayer.prototype.layer7=function(param){if(!param||!param.mc)return;var mc=param.mc;mc.x+=param.x;mc.y+=param.y;if(!SkillEffPlayer.topLayer){console.warn(i18n("HejiMoreEffPlayer_1"));return}SkillEffPlayer.topLayer.addChild(mc)};HejiMoreEffPlayer.prototype.removeMC=function(mc){mc.destroy()};return HejiMoreEffPlayer}();__reflect(HejiMoreEffPlayer.prototype,"HejiMoreEffPlayer");var HejiProgressData=function(){function HejiProgressData(){this.id=0;this.progress=0}HejiProgressData.prototype.parser=function(bytes){this.id=bytes.readByte();this.progress=bytes.readUnsignedInt()};return HejiProgressData}();__reflect(HejiProgressData.prototype,"HejiProgressData");var HejiUseMgr=function(_super){__extends(HejiUseMgr,_super);function HejiUseMgr(){return _super!==null&&_super.apply(this,arguments)||this}HejiUseMgr.ins=function(){return _super.ins.call(this)};HejiUseMgr.prototype.register=function(root){this.root=root;this.reset();if(this.root.getSkillLvl()){this.start()}};HejiUseMgr.prototype.unregister=function(root){this.root=null;this.reset();this.stop()};HejiUseMgr.prototype.start=function(){this.stop();TimerManager.ins().doTimer(1e3,0,this.updateTime,this)};HejiUseMgr.prototype.stop=function(){TimerManager.ins().remove(this.updateTime,this)};HejiUseMgr.prototype.updateTime=function(){if(this.cool>0){this.cool-=1}};HejiUseMgr.prototype.getSkillData=function(){if(!this.root.getSkillLvl()){return null}var config=GlobalConfig.TogetherHitConfig[this.root.getSkillLvl()];var model=this.getRoles()[0];if(!model)return null;if(Assert(config,i18n("HejiUseMgr_0",this.root.getSkillLvl()))){return}var curSkill=GlobalConfig.SkillsConfig[config.skill_id[model.job-1]];return new SkillData(curSkill.id)};HejiUseMgr.prototype.getRoles=function(){return this.root.getRoles()||[]};HejiUseMgr.prototype.getMaster=function(){var roles=this.getRoles();for(var i=0;i<roles.length;i++){if(roles[i].getAtt(AttributeType.atHp)>0){return EntityManager.ins().getEntityByHandle(roles[i].handle)}}return null};HejiUseMgr.prototype.getShapeInfo=function(){var info={};if(this.root){info=this.root.getShapeInfo()||{}}return info};HejiUseMgr.prototype.canUse=function(){return this.cool<=0};HejiUseMgr.prototype.useSuccess=function(){this.cool=60};HejiUseMgr.prototype.reset=function(){this.cool=7};return HejiUseMgr}(BaseClass);__reflect(HejiUseMgr.prototype,"HejiUseMgr");var PunchEquipListItem=function(_super){__extends(PunchEquipListItem,_super);function PunchEquipListItem(){var _this=_super.call(this)||this;_this.skinName="PunchEquipChangeSkinItem";return _this}PunchEquipListItem.prototype.dataChanged=function(){if(!this.data||!this.data.itemConfig)return;var itemdata=this.data;var att=itemdata.att;var equipConfig=GlobalConfig.EquipConfig[itemdata.configID];var str1="";var str2="";this.now.visible=false;var i=0;for(var k in AttributeData.translate){if(!equipConfig[k]||equipConfig[k]<=0)continue;var tempAtt=new AttributeData(AttributeData.translate[k],equipConfig[k]);var attrStr="";attrStr=AttributeData.getAttStrByType(tempAtt,0,"  ");if(i%2==0){str1+=StringUtils.complementByChar(attrStr,32)}else{str1+=attrStr+"\n"}i++}this.attr1.textFlow=(new egret.HtmlTextParser).parser(str1);if(equipConfig.baseAttr1){str2=AttributeData.getAttStrByType(equipConfig.baseAttr1,1,"")}else{str2=AttributeData.getExtAttStrByType(equipConfig.exAttr1,1,"")}this.attr2.text=str2;this.changeBtn.visible=true;this.nameTxt.text=itemdata.itemConfig.name};PunchEquipListItem.prototype.setBtnStatu=function(){this.changeBtn.visible=false;this.now.visible=true};return PunchEquipListItem}(eui.ItemRenderer);__reflect(PunchEquipListItem.prototype,"PunchEquipListItem");var PunchEquipAttrWin=function(_super){__extends(PunchEquipAttrWin,_super);function PunchEquipAttrWin(){return _super!==null&&_super.apply(this,arguments)||this}PunchEquipAttrWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="PunchEquipAttrSkin"};PunchEquipAttrWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.setView()};PunchEquipAttrWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeObserve()};PunchEquipAttrWin.prototype.setView=function(){var attData=[];var extAttData=[];for(var i=0;i<8;i++){var item=UserSkill.ins().equipListData[i];for(var k in item.att){if(item.att[k].type!=0&&item.att[k].value!=0){var obj=item.att[k];if(!attData[obj.type]){attData[obj.type]=obj.value}else{attData[obj.type]+=obj.value}}}if(item.configID){var data=GlobalConfig.EquipConfig[item.configID];for(var m in AttributeData.translate){if(!data[m]||data[m]<=0){continue}else{var type_3=Role.getAttrTypeByName(m);if(!attData[type_3]){attData[type_3]=data[m]}else{attData[type_3]+=data[m]}}}if(data.baseAttr1){if(!attData[data.baseAttr1.type]){attData[data.baseAttr1.type]=data.baseAttr1.value}else{attData[data.baseAttr1.type]+=data.baseAttr1.value}}if(data.baseAttr2){if(!attData[data.baseAttr2.type]){attData[data.baseAttr2.type]=data.baseAttr2.value}else{attData[data.baseAttr2.type]+=data.baseAttr2.value}}if(data.exAttr1){if(!extAttData[data.exAttr1.type]){extAttData[data.exAttr1.type]=data.exAttr1.value}else{extAttData[data.exAttr1.type]+=data.exAttr1.value}}if(data["exAttr2"]){if(!extAttData[data["exAttr2"].type]){extAttData[data["exAttr2"].type]=data["exAttr2"].value}else{extAttData[data["exAttr2"].type]+=data["exAttr2"].value}}}}var str="";var attName="";var value=0;var type=0;for(var l in attData){type=Number(l);value=attData[l];attName=AttributeData.getAttrStrByType(type);if(attName.length<3)attName=AttributeData.inserteBlank(attName,4);if(type>1&&type<9){if(type==7||type==8){str+=attName+"："+value/100+"%"}else{str+=attName+"："+value}}else if(type>12&&type<15||type>15){if(type==AttributeType.atCritEnhance)str+=attName+"："+(value/100+150)+"%";else str+=attName+"："+value/100+"%"}else continue;str+="\n"}for(var l in extAttData){type=Number(l);value=extAttData[l];attName=AttributeData.getExtAttrStrByType(type);str+=attName+"："+value/100+"%";str+="\n"}if(str=="")str=i18n("PunchEquipAttrWin_0");this.baseAttr.text=str;this.anigroup.height=this.baseAttr.height+150};PunchEquipAttrWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break}};return PunchEquipAttrWin}(BaseEuiView);__reflect(PunchEquipAttrWin.prototype,"PunchEquipAttrWin");ViewManager.ins().reg(PunchEquipAttrWin,LayerManager.UI_Popup);var PunchEquipChooseWin=function(_super){__extends(PunchEquipChooseWin,_super);function PunchEquipChooseWin(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.itemList=[];_this.pos=0;return _this}PunchEquipChooseWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="PunchEquipChangeSkin";this.list.itemRenderer=PunchEquipListItem;this.wearItem=new PunchEquipListItem;this.itemGroup.addChild(this.wearItem)};PunchEquipChooseWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.pos=param[0];var wear=param[1];var data=UserSkill.ins().equipListData[this.pos];this.wearItem.data=data;this.wearItem.setBtnStatu();this.itemList=UserBag.ins().getHejiEquipsByType(this.pos);this.list.dataProvider=new eui.ArrayCollection(this.itemList);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemTap,this);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(UserSkill.ins().postHejiEquipChange,this.changeEquipSuccess);if(wear==1){this.scroll.y=232;this.scroll.height=410;this.wearItem.visible=true}else{this.scroll.y=50;this.scroll.height=590;this.wearItem.visible=false}};PunchEquipChooseWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemTap,this);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeObserve()};PunchEquipChooseWin.prototype.changeEquipSuccess=function(){ViewManager.ins().close(PunchEquipChooseWin)};PunchEquipChooseWin.prototype.itemTap=function(e){var data=UserSkill.ins().equipListData[this.pos];var item=e.item;if(data){if(data.itemConfig&&item.itemConfig.useCond!=data.itemConfig.id){var preItem=GlobalConfig.ItemConfig[data.itemConfig.id+10];UserTips.ins().showTips(i18n("PunchEquipChooseWin_0",preItem.name));return}}else{if(item.itemConfig.useCond){var preItem=GlobalConfig.ItemConfig[91e4+this.pos+1];UserTips.ins().showTips(i18n("PunchEquipChooseWin_2"));return}}var itemlv=item.itemConfig.level?item.itemConfig.level:0;var itemzslv=item.itemConfig.zsLevel?item.itemConfig.zsLevel:0;if(itemzslv>UserZs.ins().lv||itemlv>Actor.level){UserTips.ins().showTips(i18n("PunchEquipChooseWin_3",itemzslv,itemlv));return}UserSkill.ins().sendDressHejiEquip(item.handle,this.pos)};PunchEquipChooseWin.prototype.onTap=function(e){switch(e.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};return PunchEquipChooseWin}(BaseEuiView);__reflect(PunchEquipChooseWin.prototype,"PunchEquipChooseWin");ViewManager.ins().reg(PunchEquipChooseWin,LayerManager.UI_Main);var PunchEquipDetailWin=function(_super){__extends(PunchEquipDetailWin,_super);function PunchEquipDetailWin(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.offY=150;_this.data=null;_this.duanwei=[i18n("PunchEquipDetailWin_0"),i18n("PunchEquipDetailWin_1"),i18n("PunchEquipDetailWin_2")];return _this}PunchEquipDetailWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="PunchEquipTipsSkin"};PunchEquipDetailWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.data=param[0];this.forgeGroup.visible=param[1];this.forgeGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.observe(UserSkill.ins().postHejiEquipChange,this.refushInfo);this.refushInfo()};PunchEquipDetailWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.forgeGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.removeObserve()};PunchEquipDetailWin.prototype.refushInfo=function(){var config;var str1="";var str2="";config=this.data.itemConfig;var point=0;point=this.data.point;this.score.text=i18n("PunchEquipDetailWin_3")+point;var addPoint=0;this.powerPanel.setPower(Math.floor(point*(100+addPoint)/100));var atts=this.data.att;var bestDesc="";for(var i=0;i<atts.length;i++){if(atts[i].type==0)continue;var str=AttributeData.getAttrNameByAttrbute(atts[i],true);str1+=str+"\n"}var extAtts=this.data.extAtt;var hasExtAtt=false;for(var j=0;j<extAtts.length;j++){if(extAtts[j].type==0)continue;hasExtAtt=true;var str=AttributeData.getAttrNameByAttrbute(extAtts[j],true);str2+=str+"\n"}if(hasExtAtt){this.tupoDesc.visible=true;this.group.height=600;this.forgeGroup.y=530}else{this.tupoDesc.visible=false;this.group.height=600-this.offY;this.forgeGroup.y=530-this.offY}this.desc1.text=i18n("PunchEquipDetailWin_5");this.nameLabel.text=config.name;this.nameLabel.textColor=ItemConfig.getQualityColor(config);this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(config);this.itemIcon.setData(config);var chong=config.level%3;this.lv.text=config.zsLevel>0?i18n("PunchEquipDetailWin_6",config.zsLevel):i18n("PunchEquipDetailWin_7",config.level);this.attr1.text=str1;this.attr0.text=str2};PunchEquipDetailWin.prototype.onTap=function(e){switch(e.target){case this.forgeGroup:ViewManager.ins().close(PunchEquipDetailWin);ViewManager.ins().open(PunchEquipChooseWin,this.data.itemConfig.subType,1);break;default:ViewManager.ins().close(PunchEquipDetailWin)}};return PunchEquipDetailWin}(BaseEuiView);__reflect(PunchEquipDetailWin.prototype,"PunchEquipDetailWin");ViewManager.ins().reg(PunchEquipDetailWin,LayerManager.UI_Main);var PunchEquipForge=function(_super){__extends(PunchEquipForge,_super);function PunchEquipForge(){return _super.call(this)||this}PunchEquipForge.prototype.childrenCreated=function(){this.init()};PunchEquipForge.prototype.init=function(){var text=this.getItemTxt.text;this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+text);this.maxPos=8;this.mcs=[]};PunchEquipForge.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.getItemTxt,this.onClick);this.addTouchEvent(this.btn,this.onClick);this.observe(UserSkill.ins().postUpgradeForge,this.UpgradeForgeCallback);this.observe(UserEquip.ins().postSmeltEquipComplete,this.callback);this.updateDate()};PunchEquipForge.prototype.callback=function(){this.updateDate()};PunchEquipForge.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.getItemTxt,this.onClick);this.removeTouchEvent(this.btn,this.onClick);DisplayUtils.removeFromParent(this.mc);for(var i=0;i<this.mcs.length;i++){DisplayUtils.removeFromParent(this.mcs[i])}};PunchEquipForge.prototype.onClick=function(e){switch(e.currentTarget){case this.getItemTxt:UserWarn.ins().setBuyGoodsWarn(909998);break;case this.btn:var pos=UserSkill.ins().getPunchForge().calcSelectPos();var ptype=UserSkill.ins().getPunchForge().isUpgradePunchForge(pos);if(ptype==PunchEquipForgeData.TYPE_NO){UserTips.ins().showTips(i18n("PunchEquipForge_0"));return}if(ptype==PunchEquipForgeData.TYPE_MAX){UserTips.ins().showTips(i18n("PunchEquipForge_1"));return}UserSkill.ins().sendUpgradeForge(pos);break}};PunchEquipForge.prototype.UpgradeForgeCallback=function(){this.updateDate(true)};PunchEquipForge.prototype.updateDate=function(eff){var pos=UserSkill.ins().getPunchForge().calcSelectPos();var lv=0;var ptype=PunchEquipForgeData.TYPE_MAX;for(var i=0;i<this.maxPos;i++){var tmp=UserSkill.ins().getPunchForge().isUpgradePunchForge(pos);if(tmp!=PunchEquipForgeData.TYPE_MAX){ptype=0;break}}if(ptype==PunchEquipForgeData.TYPE_MAX){this.currentState="full"}else{this.currentState="normal";lv=UserSkill.ins().getPunchForge().getPunchLevel(pos)}this.validateNow();this.setSelect(pos);this.setEff();this.updateAttrDesc(pos,lv);this.updateCost(pos,lv);this.setPower();if(eff)this.setPosEff(pos)};PunchEquipForge.prototype.setPosEff=function(pos){var index=pos-1;if(index<0)index=this.maxPos-1;if(!this.mcs[index])this.mcs[index]=new MovieClip;if(!this.mcs[index].parent){this["eff"+index].addChild(this.mcs[index])}this.mcs[index].playFile(RES_DIR_EFF+"forgeSuccess",1)};PunchEquipForge.prototype.setSelect=function(pos){for(var i=0;i<this.maxPos;i++){this["pEquip"+i].visible=false;this["pELv"+i].text="+"+UserSkill.ins().getPunchForge().getPunchLevel(i)}if(this.currentState=="normal"){this["pEquip"+pos].visible=true}};PunchEquipForge.prototype.setEff=function(){if(this.currentState!="normal"){DisplayUtils.removeFromParent(this.mc);return}if(!UserSkill.ins().canSolve()){DisplayUtils.removeFromParent(this.mc);return}if(!this.mc)this.mc=new MovieClip;if(!this.mc.parent){this.getItemTxt.parent.addChild(this.mc);this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.mc.touchEnabled=false;this.mc.scaleY=.5;this.mc.scaleX=.6}this.mc.x=0;this.mc.y=0};PunchEquipForge.prototype.updateAttrDesc=function(pos,lv){if(this.currentState=="full"){var suitlv=UserSkill.ins().getPunchForge().getSuitlevel();var mconfig=GlobalConfig.PunchEquipMasterConfig[suitlv];var attrs=UserSkill.ins().getPunchForge().getAttributeData();for(var i=0;i<attrs.length;i++){if(this["attr"+i]){var str="";var value=0;for(var j=0;j<attrs.length;j++){if(attrs[j].type==attrs[i].type){value=attrs[j].value;break}}value+=mconfig.attr&&mconfig.attr[i]?mconfig.attr[i].value:0;str=AttributeData.getAttrStrByType(attrs[i].type);str+="+";str+=value;this["attr"+i].text=str}}var astr="";astr=i18n("PunchEquipForge_2");astr+=mconfig.exattr[0].value/100;this.exattr0.text=astr+"%";return}var config=GlobalConfig.PunchEquipConfig[pos][lv];if(config){var suitlv=UserSkill.ins().getPunchForge().getSuitlevel();var mconfig=GlobalConfig.PunchEquipMasterConfig[suitlv];var isActive=true;if(!mconfig){isActive=false;for(var k in GlobalConfig.PunchEquipMasterConfig){mconfig=GlobalConfig.PunchEquipMasterConfig[k];break}}var nextconfig=UserSkill.ins().getPunchForge().getPosNextLevelConfig(pos);var attrs=UserSkill.ins().getPunchForge().getAttributeData();for(var i=0;i<config.attr.length;i++){if(this["attr"+i]){var str="";var value=0;for(var j=0;j<attrs.length;j++){if(attrs[j].type==config.attr[i].type){value=attrs[j].value;break}}value+=mconfig.attr&&mconfig.attr[i]?mconfig.attr[i].value:0;str=AttributeData.getAttrStrByType(config.attr[i].type);str+="+";str+=value;this["attr"+i].text=str;if(nextconfig&&this["arrow"+i]&&this["addAttr"+i]&&nextconfig.attr[i].value){this["addAttr"+i].visible=this["arrow"+i].visible=true;var nstr="";nstr+=value+(nextconfig.attr[i].value-config.attr[i].value);this["addAttr"+i].text=nstr;this["arrow"+i].x=this["attr"+i].x+this["attr"+i].width;this["addAttr"+i].x=this["arrow"+i].x+this["arrow"+i].width}else{this["addAttr"+i].visible=this["arrow"+i].visible=false}}}var nextsuitlv=void 0;var nextmconfig=void 0;var astr="";astr=i18n("PunchEquipForge_3");if(isActive){astr+=mconfig.exattr[0].value/100;nextsuitlv=UserSkill.ins().getPunchForge().getNextSuitlevel();nextmconfig=GlobalConfig.PunchEquipMasterConfig[nextsuitlv]}else{astr+=0;nextmconfig=mconfig;nextsuitlv=suitlv}this.exattr0.text=astr+"%";this.arrow4.x=this.exattr0.x+this.exattr0.width+this.arrow4.width;this.exattr1.x=this.arrow4.x+this.arrow4.width;if(nextmconfig){this.exattr1.text=nextmconfig.exattr[0].value/100+"%";this.exattr2.x=this.exattr1.x+this.exattr1.width;var curLevel=Math.floor(UserSkill.ins().getPunchForge().level/this.maxPos);this.exattr2.text=i18n("PunchEquipForge_4",curLevel,nextsuitlv)}}else{var attrs=UserSkill.ins().getPunchForge().getAttributeData();config=GlobalConfig.PunchEquipConfig[pos][1];for(var i=0;i<config.attr.length;i++){if(this["attr"+i]){var str="";var value=0;for(var j=0;j<attrs.length;j++){if(attrs[j].type==config.attr[i].type){value=attrs[j].value;break}}str=AttributeData.getAttrStrByType(config.attr[i].type);str+="+";str+=value;this["attr"+i].text=str;if(this["arrow"+i]&&this["addAttr"+i]&&config.attr[i].value){this["addAttr"+i].visible=this["arrow"+i].visible=true;var nstr="";nstr+=config.attr[i].value;this["addAttr"+i].text=nstr;this["arrow"+i].x=this["attr"+i].x+this["attr"+i].width;this["addAttr"+i].x=this["arrow"+i].x+this["arrow"+i].width}else{this["addAttr"+i].visible=this["arrow"+i].visible=false}}}var mconfig=void 0;for(var k in GlobalConfig.PunchEquipMasterConfig){mconfig=GlobalConfig.PunchEquipMasterConfig[k];break}var astr="";astr=i18n("PunchEquipForge_5");astr+=0;this.exattr0.text=astr+"%";this.arrow4.x=this.exattr0.x+this.exattr0.width+this.arrow4.width;this.exattr1.x=this.arrow4.x+this.arrow4.width;if(mconfig){this.exattr1.text=mconfig.exattr[0].value/100+"%";this.exattr2.x=this.exattr1.x+this.exattr1.width;this.exattr2.text=i18n("PunchEquipForge_6",0,mconfig.level)}}};PunchEquipForge.prototype.updateCost=function(pos,lv){var config;if(!pos&&!lv){config=GlobalConfig.PunchEquipConfig[0][1]}else{config=UserSkill.ins().getPunchForge().getPosNextLevelConfig(pos)}if(!config){config=GlobalConfig.PunchEquipConfig[pos][1]}this.costicon.source=RewardData.getCurrencyRes(config.cost.id);var colorStr="";var ptype=UserSkill.ins().getPunchForge().isUpgradePunchForge(pos);if(ptype==PunchEquipForgeData.TYPE_OK){colorStr=ColorUtil.GREEN_COLOR;this.redPoint.visible=true}else{this.redPoint.visible=false;colorStr=ColorUtil.RED_COLOR}var count=0;if(config.cost.id==MoneyConst.punch1){count=Actor.togeatter1}else if(config.cost.id==MoneyConst.punch2){count=Actor.togeatter2}this.costcount.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+count+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+config.cost.count+"</font> ")};PunchEquipForge.prototype.setPower=function(){var attrs=UserSkill.ins().getPunchForge().getAttributeData();var powers=UserBag.getAttrPower(attrs);var suitlv=UserSkill.ins().getPunchForge().getSuitlevel();var mconfig=GlobalConfig.PunchEquipMasterConfig[suitlv];if(mconfig&&mconfig.attr){powers+=UserBag.getAttrPower(mconfig.attr);powers+=mconfig.exPower}powers*=SubRoles.ins().subRolesLen;this.powerPanel.setPower(powers)};return PunchEquipForge}(BaseView);__reflect(PunchEquipForge.prototype,"PunchEquipForge");var PunchExchangeBtn=function(_super){__extends(PunchExchangeBtn,_super);function PunchExchangeBtn(){var _this=_super.call(this)||this;_this.skinName="PunchExchangeBtnSkin";return _this}PunchExchangeBtn.prototype.dataChanged=function(){this.btnText.text=this.data.config.name;this.redPoint.visible=UserSkill.ins().getPunchExchangePageRedPoint(this.data.index)};PunchExchangeBtn.prototype.setBtnStatu=function(){};return PunchExchangeBtn}(eui.ItemRenderer);__reflect(PunchExchangeBtn.prototype,"PunchExchangeBtn");var PunchExchangeItem=function(_super){__extends(PunchExchangeItem,_super);function PunchExchangeItem(){var _this=_super.call(this)||this;_this.count=0;_this.exchangeNum=0;_this.skinName="PunchExchangeItemSkin";return _this}PunchExchangeItem.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this);this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(_this.count<_this.exchangeNum){UserTips.ins().showTips(i18n("PunchExchangeItem_0"));ViewManager.ins().open(ShopGoodsWarn).setData(_this.data.exchangeMaterial[0].id==MoneyConst.punch1?909998:909999);return}if(UserBag.ins().getSurplusCount()<1){UserTips.ins().showTips(i18n("PunchExchangeItem_1"));return}UserSkill.ins().sendExchangeHejiEquip(_this.data.id)},this);this.itemIcon0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)};PunchExchangeItem.prototype.dataChanged=function(){var item=GlobalConfig.ItemConfig[this.data.getItem.id];var material=this.data.exchangeMaterial[0];this.exchangeNum=material.count;if(material.id==MoneyConst.punch1){this.count=Actor.togeatter1}else{this.count=Actor.togeatter2}this.icon.source=RewardData.getCurrencyRes(material.id);this.redPoint.visible=UserSkill.ins().getPunchExchangeItemRedPoint(this.data.id);var str=this.data.zsLevel>0?i18n("PunchExchangeItem_2",this.data.zsLevel):i18n("PunchExchangeItem_3",this.data.level);this.nameLab.text=item.name;var color=this.count<this.exchangeNum?"#F3311E":"#03b154";this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+color+"'>"+this.count+"</font><font color = '#FEE2BC'>/"+this.exchangeNum+"</font>");this.itemConfig=item;this.itemIcon0.setData(item);if(this.data.zsLevel>0){this.goBtn.visible=UserZs.ins().lv>=this.data.zsLevel}else{this.goBtn.visible=Actor.level>=this.data.level}};PunchExchangeItem.prototype.onClick=function(){if(!this.itemConfig)return;switch(ItemConfig.getType(this.itemConfig)){case 5:ViewManager.ins().open(HejiEquipTipsWin,{id:this.itemConfig.id},false,true);break;default:UserTips.ins().showTips(i18n("PunchExchangeItem_4"))}};PunchExchangeItem.prototype.setBtnStatu=function(){};return PunchExchangeItem}(eui.ItemRenderer);__reflect(PunchExchangeItem.prototype,"PunchExchangeItem");var PunchExchangeWin=function(_super){__extends(PunchExchangeWin,_super);function PunchExchangeWin(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.currentSelect=0;return _this}PunchExchangeWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="PunchExchangeSkin";this.goturn.textFlow=[{text:i18n("PunchExchangeWin_0"),style:{underline:true}}];this.exchangelist.itemRenderer=PunchExchangeItem;this.equiplist.itemRenderer=PunchExchangeBtn;this.initMenu()};PunchExchangeWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.data=param[0];this.equiplist.addEventListener(egret.Event.CHANGING,this.checkIsOpen,this);this.observe(Actor.ins().postUpdateTogeatter,this.onListChange);this.addTouchEvent(this.goturn,this.onTap);this.equiplist.selectedIndex=this.currentSelect;this.refushInfo()};PunchExchangeWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.equiplist.removeEventListener(egret.TouchEvent.CHANGING,this.checkIsOpen,this);this.removeTouchEvent(this.goturn,this.onTap);this.removeObserve()};PunchExchangeWin.prototype.onListChange=function(egret){this.currentSelect=this.equiplist.selectedIndex;this.refushInfo()};PunchExchangeWin.prototype.initMenu=function(){this.menuArr=[];this.exchangeArr=[];var config=GlobalConfig.TogetherHitEquipPageConfig;var index=0;var zlv=UserSkill.ins().getMaxzLv();for(var k in config){var id0=config[k].id[0];var conf=GlobalConfig.TogetherHitEquipExchangeConfig[id0];if(conf.zsLevel>zlv[0]||conf.level>zlv[1]){break}this.menuArr.push({config:config[k],index:+k});this.exchangeArr[index]=[];for(var i in config[k].id){var item=GlobalConfig.TogetherHitEquipExchangeConfig[config[k].id[i]];this.exchangeArr[index].push(item)}index++}};PunchExchangeWin.prototype.refushInfo=function(){this.suipian.text=""+Actor.togeatter1;this.suipian1.text=""+Actor.togeatter2;this.equiplist.dataProvider=new eui.ArrayCollection(this.menuArr);var currentList=this.exchangeArr[this.currentSelect];this.exchangelist.dataProvider=new eui.ArrayCollection(currentList)};PunchExchangeWin.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.goturn){ViewManager.ins().open(PunchTransformWin)}};PunchExchangeWin.prototype.checkIsOpen=function(e){var list=e.target;var config=this.exchangeArr[list.selectedIndex][0];var zsLv=config.zsLevel||0;var lv=config.level;var boo=true;if(!boo){var str=Actor.level>=lv?i18n("PunchExchangeWin_1",zsLv):i18n("PunchExchangeWin_2",lv);UserTips.ins().showTips(i18n("PunchExchangeWin_3",str));e.$cancelable=true;e.preventDefault();return}else{this.onListChange(null)}};__decorate([callLater],PunchExchangeWin.prototype,"onListChange",null);return PunchExchangeWin}(BaseEuiView);__reflect(PunchExchangeWin.prototype,"PunchExchangeWin");ViewManager.ins().reg(PunchExchangeWin,LayerManager.UI_Main);var PunchExtShowWin=function(_super){__extends(PunchExtShowWin,_super);function PunchExtShowWin(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.colorGray="#dd49ac";return _this}PunchExtShowWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="PunchExtShowSkin"};PunchExtShowWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.setView()};PunchExtShowWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeObserve()};PunchExtShowWin.prototype.setView=function(){var str="";var config=GlobalConfig.TogetherHitEquipQmConfig;var currentAtt=UserSkill.ins().qimingAttrDic;var obj=new Object;var objAttLevel=0;for(var i in currentAtt){obj=currentAtt[i];objAttLevel=Number(i)}var len=obj?CommonUtils.getObjectLength(obj):0;var color=ColorUtil.BLUE_COLOR;var isGray=false;for(var k in config){for(var l in config[k]){var obj_2=config[k][l];if(Number(k)!=0){str+=i18n("PunchExtShowWin_0",ColorUtil.BLUE_COLOR,k)}else{str+=i18n("PunchExtShowWin_1",ColorUtil.BLUE_COLOR,l)}var i=0;var level=Number(k)*1e4+Number(l);for(var m in obj_2){var totalAtt=obj_2[m].exAttr;if(level>objAttLevel){color=this.colorGray;isGray=true}else if(level==objAttLevel){if(i+1>len){color=this.colorGray;isGray=true}}str+=i18n("PunchExtShowWin_2",color,obj_2[m].num,this.getDescTextFlow(obj_2[m].desc,!isGray));i++;if(i==3){str+="\n"}}}}this.baseAttr.textFlow=(new egret.HtmlTextParser).parser(str)};PunchExtShowWin.prototype.getDescTextFlow=function(desc,color){var tf=TextFlowMaker.generateTextFlow1(desc);var str="";for(var _i=0,tf_2=tf;_i<tf_2.length;_i++){var f=tf_2[_i];if(color&&f.style&&f.style.textColor!=undefined){str+="<font color="+f.style.textColor+">"+f.text+"</font>"}else{str+=f.text}}return str};PunchExtShowWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break}};return PunchExtShowWin}(BaseEuiView);__reflect(PunchExtShowWin.prototype,"PunchExtShowWin");ViewManager.ins().reg(PunchExtShowWin,LayerManager.UI_Main);var PunchResWin=function(_super){__extends(PunchResWin,_super);function PunchResWin(){var _this=_super.call(this)||this;_this.type=0;_this.isTopLevel=true;_this.skinName="PunchResSkin";return _this}PunchResWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.smeltEquips=[];this.smeltEquips.length=9;this.itemList.itemRenderer=SmeltEquipItem;this.dataInfo=new eui.ArrayCollection(this.smeltEquips);this.itemList.dataProvider=this.dataInfo};PunchResWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.type=param[0]||0;this.addTouchEvent(this.smeltBtn,this.onTap);this.addTouchEvent(this.itemList,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(UserEquip.ins().postSmeltEquipComplete,this.smeltComplete);this.observe(UserEquip.ins().postEquipCheckList,this.setItemList);this.setItemData();if(this.type!=0){this.title.text=i18n("PunchResWin_0")}};PunchResWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.smeltBtn,this.onTap);this.removeTouchEvent(this.itemList,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeObserve()};PunchResWin.prototype.smeltComplete=function(){var n=this.itemList.numChildren;while(n--){this.itemList.getChildAt(n).playEff()}this.setItemData()};PunchResWin.prototype.setItemData=function(){if(this.type==0){this.smeltEquips=UserBag.ins().getHejiOutEquips()}else if(this.type==ShapeShiftingMgr.ins().PROP_TYPE_SHAPESHIFTING){this.smeltEquips=UserBag.ins().getShapeShiftingOutEquips()}this.dataInfo.replaceAll(this.smeltEquips)};PunchResWin.prototype.setItemList=function(list){this.dataInfo.replaceAll(list);this.itemList.dataProvider=this.dataInfo};PunchResWin.prototype.onTap=function(e){switch(e.currentTarget){case this.smeltBtn:UserEquip.ins().sendSmeltEquip(this.type,this.smeltEquips);break;case this.itemList:var item=e.target;if(item&&item.data){var i=this.smeltEquips.indexOf(item.data);if(i>=0){this.smeltEquips.splice(i,1);item.data=null}}break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(PunchResWin);break}};return PunchResWin}(BaseEuiView);__reflect(PunchResWin.prototype,"PunchResWin");ViewManager.ins().reg(PunchResWin,LayerManager.UI_Popup);var PunchSkillItemRender=function(_super){__extends(PunchSkillItemRender,_super);function PunchSkillItemRender(){var _this=_super.call(this)||this;_this.skinName="PunchSkillItem";return _this}PunchSkillItemRender.prototype.setData=function(config){this.iconBG.source=config.id+"_png"};return PunchSkillItemRender}(BaseComponent);__reflect(PunchSkillItemRender.prototype,"PunchSkillItemRender");var PunchSkillTipsWin=function(_super){__extends(PunchSkillTipsWin,_super);function PunchSkillTipsWin(){return _super!==null&&_super.apply(this,arguments)||this}PunchSkillTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="PunchskillTips"};PunchSkillTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.setView()};PunchSkillTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeObserve()};PunchSkillTipsWin.prototype.setView=function(){var config=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel];var model=SubRoles.ins().getSubRoleByIndex(0);var curSkill=new SkillData(config.skill_id[model.job-1]);this.skillitem.setData(curSkill);this.nameLabel0.text=curSkill.name;this.desc0.text=curSkill.desc;var qmDic=UserSkill.ins().qimingValueDic;var i=0;for(var k in qmDic){var value=qmDic[k].value/100;var des=void 0;if(i<2){des=StringUtils.substitute(UserSkill.descArr[i],i18n("PunchSkillTipsWin_1",value*3))}else{des=StringUtils.substitute(UserSkill.descArr[i],i18n("PunchSkillTipsWin_2",value))}this["desc"+k].textFlow=TextFlowMaker.generateTextFlow1(des);i++}if(i==0){this["desc"+3].text=i18n("PunchSkillTipsWin_0")}};PunchSkillTipsWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break}};return PunchSkillTipsWin}(BaseEuiView);__reflect(PunchSkillTipsWin.prototype,"PunchSkillTipsWin");ViewManager.ins().reg(PunchSkillTipsWin,LayerManager.UI_Popup);var PunchTransformWin=function(_super){__extends(PunchTransformWin,_super);function PunchTransformWin(){var _this=_super.call(this)||this;_this.useNum=0;_this.maxNum=0;_this.skinName="PunchTransformSkin";_this.isTopLevel=true;return _this}PunchTransformWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.numLabel.restrict="0-9"};PunchTransformWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.addChangeEvent(this.numLabel,this.onTxtChange);this.observe(Actor.ins().postUpdateTogeatter,this.checkChange);this.update()};PunchTransformWin.prototype.onTxtChange=function(e){var num=Number(this.numLabel.text);if(num>this.maxNum){num=this.maxNum}else if(num<=0){num=1}this.useNum=num;this.setCount1()};PunchTransformWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeObserve()};PunchTransformWin.prototype.checkChange=function(data){if(data&&data.type==2)this.update()};PunchTransformWin.prototype.update=function(){this.count0.text=Actor.togeatter2+"";this.transformBtn.enabled=Actor.togeatter2>0;this.maxNum=Actor.togeatter2;if(this.useNum>this.maxNum){this.useNum=this.maxNum}this.setCount1()};PunchTransformWin.prototype.onTouch=function(e){switch(e.target){case this.minBtn:this.useNum=0;this.setCount1();break;case this.maxBtn:if(this.useNum>=this.maxNum){this.showTip()}this.useNum=this.maxNum;this.setCount1();break;case this.sub1Btn:this.useNum--;if(this.useNum<0){this.useNum=0}this.setCount1();break;case this.add1Btn:this.useNum++;if(this.useNum>this.maxNum){this.useNum=this.maxNum;this.showTip()}this.setCount1();break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.transformBtn:var self_10=this;var warnWin=WarnWin.show(i18n("PunchTransformWin_2"),function(){self_10.sendExchange(Actor.togeatter2)},this,function(){},this);break;case this.quicklytransformBtn:this.sendExchange(this.useNum);break}};PunchTransformWin.prototype.showTip=function(){if(this.maxNum==0){UserTips.ins().showTips(i18n("PunchTransformWin_0"))}else{UserTips.ins().showTips(i18n("PunchTransformWin_1"))}};PunchTransformWin.prototype.sendExchange=function(num){if(num===void 0){num=0}if(num>0){UserSkill.ins().sendChangeTogeatterHigh(num)}};PunchTransformWin.prototype.setCount1=function(){this.quicklytransformBtn.enabled=this.useNum>0;this.count1.text=this.useNum*GlobalConfig.TogerherHitBaseConfig.TogExgRate+"";this.numLabel.text=this.useNum+""};return PunchTransformWin}(BaseEuiView);__reflect(PunchTransformWin.prototype,"PunchTransformWin");ViewManager.ins().reg(PunchTransformWin,LayerManager.UI_Main);var Hint=function(_super){__extends(Hint,_super);function Hint(){var _this=_super.call(this)||this;_this.presceneid=-1;_this.prefbId=-1;_this.killType=0;_this.picKillBoss="";_this.observe(GameLogic.ins().postEnterMap,_this.postSeceneIn);return _this}Hint.ins=function(){return _super.ins.call(this)};Hint.prototype.checkHint=function(cfg,targetType,config,parma){if(!cfg){switch(targetType){case Hint.TARTYPE_WELCOME:this.showHint(targetType);return true;case Hint.TARTYPE_KILL_BOSS:for(var key in GlobalConfig.HintConfig){var hcf=GlobalConfig.HintConfig[key];if(hcf.target[0].guanqiaId==parma.gqid){this.showHint(targetType,hcf.image);return true}}break}return false}if(cfg){var pic=this.HitConfig(cfg,targetType);if(pic!=null){this.showHint(targetType,pic);return true}}else{for(var key in config){var cfg_5=config[key];var pic=this.HitConfig(cfg_5,targetType);if(pic!=null){this.showHint(targetType,pic);return true}}}return false};Hint.prototype.HitConfig=function(data,targetType){var cfg=data;for(var key in GlobalConfig.HintConfig){var hcf=GlobalConfig.HintConfig[key];if(hcf.targetType!=targetType)continue;switch(targetType){case Hint.TARTYPE_ACH_BEF:if(cfg.achievementId==hcf.target[0].achievementId&&cfg.taskId==hcf.target[0].taskId)if(hcf.target[0].isfull&&hcf.target[0].isfull>0&&UserBag.ins().getSurplusCount())return hcf.image;break;case Hint.TARTYPE_ACH_AFT:if(cfg.achievementId==hcf.target[0].achievementId&&cfg.taskId==hcf.target[0].taskId)return hcf.image;break;case Hint.TARTYPE_SCE_IN:if(GameMap.mapID==hcf.target[0].sceneid&&GameMap.fubenID==hcf.target[0].fbId&&this.presceneid==hcf.target[0].presceneid&&this.prefbId==hcf.target[0].prefbId)return hcf.image;break}}return null};Hint.prototype.showHint=function(targetType,pic){if(!pic&&targetType==Hint.TARTYPE_WELCOME){var cfg=GlobalConfig.HintConfig[1];pic=cfg.image;UserTips.ins().showHintTips(pic);return}if(pic&&pic!="")UserTips.ins().showHintTips(pic)};Hint.prototype.postWelcome=function(){this.checkHint(null,Hint.TARTYPE_WELCOME)};Hint.prototype.postAchievementBef=function(cfg){if(!cfg){return}this.checkHint(cfg,Hint.TARTYPE_ACH_BEF)};Hint.prototype.postAchievementAft=function(ad){if(!ad){return}var cfg;for(var key in GlobalConfig.AchievementTaskConfig){var dcfg=GlobalConfig.AchievementTaskConfig[key];if(dcfg.achievementId==ad.achievementId&&dcfg.taskId==ad.id){cfg=dcfg;break}}if(!cfg){return}this.checkHint(cfg,Hint.TARTYPE_ACH_AFT)};Hint.prototype.postSeceneIn=function(){if(this.presceneid==-1)this.presceneid=GameMap.mapID;if(this.prefbId==-1)this.prefbId=GameMap.fubenID;var cfg=GlobalConfig.ScenesConfig[GameMap.mapID];if(!cfg){return}this.checkHint(cfg,Hint.TARTYPE_SCE_IN);this.presceneid=GameMap.mapID;this.prefbId=GameMap.fubenID};Hint.prototype.postKillBoss=function(cfg){this.checkHint(cfg,Hint.TARTYPE_KILL_BOSS)};Hint.prototype.postKillBossEx=function(guanqiaId){this.checkHint(null,Hint.TARTYPE_KILL_BOSS,null,{gqid:guanqiaId})};Hint.TARTYPE_WELCOME=1;Hint.TARTYPE_ACH_BEF=2;Hint.TARTYPE_ACH_AFT=3;Hint.TARTYPE_SCE_IN=4;Hint.TARTYPE_KILL_BOSS=5;return Hint}(BaseSystem);__reflect(Hint.prototype,"Hint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.hint=Hint.ins.bind(Hint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var HintTargetData=function(){function HintTargetData(){}return HintTargetData}();__reflect(HintTargetData.prototype,"HintTargetData");var Hungu=function(_super){__extends(Hungu,_super);function Hungu(){var _this=_super.call(this)||this;_this.hunShouFBTimes=0;_this.hunShouFBPassID=0;_this.sysId=PackageID.Hungu;_this.regNetMsg(1,_this.postHunguInfo);_this.regNetMsg(2,_this.postHunguItems);_this.regNetMsg(3,_this.postHunyu);_this.regNetMsg(4,_this.postHunguItemUpgrade);_this.regNetMsg(6,_this.postSweepHunShouFB);_this.regNetMsg(7,_this.postHunShouFBInfo);_this.regNetMsg(8,_this.postHunShouFBEndTime);return _this}Hungu.ins=function(){return _super.ins.call(this)};Object.defineProperty(Hungu.prototype,"hunguData",{get:function(){if(!this._hunguData)this._hunguData=[];return this._hunguData},enumerable:true,configurable:true});Hungu.prototype.checkOpen=function(){if(GameServer.serverOpenDay<GlobalConfig.HunGuConf.openserverday-1){return false}if(UserZs.ins().lv<GlobalConfig.HunGuConf.openzhuanshenglv){return false}return true};Hungu.prototype.checkShowOpen=function(){if(GameServer.serverOpenDay<GlobalConfig.HunGuConf.openserverday-1){return false}if(UserZs.ins().lv<GlobalConfig.HunGuConf.showzhuanshenglv){return false}return true};Hungu.prototype.getHunguItemsPos=function(itemid){var pos=-1;var config=GlobalConfig.ItemConfig[itemid];if(config){pos=ItemConfig.getSubType(config)}return pos};Hungu.prototype.getHunguItemsList=function(pos){var items=[];var TotalItems=UserBag.ins().getBagGoodsByType(ItemType.TYPE_24);for(var i=0;i<TotalItems.length;i++){if(this.getHunguItemsPos(TotalItems[i].itemConfig.id)==pos)items.push(TotalItems[i])}items.sort(function(a,b){var aconfig=GlobalConfig.HunGuEquip[a.configID];var bconfig=GlobalConfig.HunGuEquip[b.configID];if(aconfig.stage>bconfig.stage)return-1;else return 1});return items};Hungu.prototype.getHunyuRedPoint=function(roleId,pos){if(!this.hunguData[roleId])return false;for(var i=0;i<this.hunguData[roleId].items[pos].hunyu.length;i++){var b=this.getHunyuKongRedPoint(roleId,pos,i);if(b)return true}return false};Hungu.prototype.getHunyuKongRedPoint=function(roleId,pos,hyPos){if(!this.hunguData[roleId])return false;if(!this.hunguData[roleId].items[pos].itemId||hyPos+1>GlobalConfig.HunGuEquip[this.hunguData[roleId].items[pos].itemId].hunyuNum)return false;var hyType=GlobalConfig.HunGuConf.hunyuType[pos][hyPos];var level=this.hunguData[roleId].items[pos].hunyu[hyPos];var hyequip=GlobalConfig.HunYuEquip[hyType][level+1];if(!hyequip)return false;if(!hyequip.cost){var costYb=GlobalConfig.HunGuConf.unlockCost[hyPos];if(Actor.yb>=costYb)return true}else{var itemData=UserBag.ins().getBagItemById(hyequip.cost.id);if(itemData&&itemData.count>=hyequip.cost.count)return true}return false};Hungu.prototype.getHunguPosHyPower=function(roleId,pos){var power=0;if(!this.hunguData[roleId]||!this.hunguData[roleId].items[pos].itemId)return power;var hgequip=GlobalConfig.HunGuEquip[this.hunguData[roleId].items[pos].itemId];if(!hgequip)return power;var kong=hgequip.hunyuNum;for(var i=0;i<kong;i++){var hyType=GlobalConfig.HunGuConf.hunyuType[pos][i];var lv=this.hunguData[roleId].items[pos].hunyu[i];var hyequip=GlobalConfig.HunYuEquip[hyType][lv];if(hyequip){power+=UserBag.getAttrPower(hyequip.attrs,SubRoles.ins().getSubRoleByIndex(roleId));var expower=hyequip.expower?hyequip.expower:0;power+=expower}}return power};Hungu.prototype.getHunguItemPower=function(itemId){var power=0;var hgequip=GlobalConfig.HunGuEquip[itemId];if(hgequip){power+=UserBag.getAttrPower(hgequip.attrs);var expower=hgequip.expower?hgequip.expower:0;power+=expower}return power};Hungu.prototype.getHunguPosPower=function(roleId,pos,suit,hy){var power=0;if(!this.hunguData[roleId])return power;var hypower=0;if(hy){hypower+=this.getHunguPosHyPower(roleId,pos)}var jcattrs=[];var itemId=this.hunguData[roleId].items[pos].itemId;var hgequip=GlobalConfig.HunGuEquip[itemId];if(hgequip){power+=UserBag.getAttrPower(hgequip.attrs,SubRoles.ins().getSubRoleByIndex(roleId));var expower=hgequip.expower?hgequip.expower:0;power+=expower;if(suit){for(var j=0;j<hgequip.attrs.length;j++){var ishave=false;for(var z=0;z<jcattrs.length;z++){if(jcattrs[z].type==hgequip.attrs[j].type){jcattrs[z].value+=hgequip.attrs[j].value;ishave=true;break}}if(!ishave){jcattrs.push(new AttributeData(hgequip.attrs[j].type,hgequip.attrs[j].value))}}}}var jcattrsEx=[];if(suit){var percent=[];for(var i in suit){for(var j in suit[i]){if(suit[i][j].count.length>=+j){var stage=suit[i][j].stage;var hgsuit=GlobalConfig.HunGuSuit[i][j][stage];if(hgsuit&&hgsuit.specialAttrs){percent.push(hgsuit.specialAttrs/1e4)}}}}if(!percent.length)percent.push(0);for(var i=0;i<percent.length;i++){for(var j=0;j<jcattrs.length;j++){if(!jcattrsEx[j])jcattrsEx[j]=new AttributeData(jcattrs[j].type,0);jcattrsEx[j].value+=jcattrs[j].value*percent[i]}}}power+=hypower+UserBag.getAttrPower(jcattrsEx);return power};Hungu.prototype.getResonancePower=function(roleId){var power=0;if(!this.hunguData[roleId])return power;var suit=this.getSuitData(roleId);for(var i in suit){for(var j in suit[i]){var stage=suit[i][j].stage;if(!stage)continue;var count=suit[i][j].count;if(count.length<+j)continue;var hgsuit=GlobalConfig.HunGuSuit[i][j][stage];if(hgsuit.attrs)power+=UserBag.getAttrPower(hgsuit.attrs,SubRoles.ins().getSubRoleByIndex(roleId));var expower=hgsuit.expower?hgsuit.expower:0;power+=expower}}return power};Hungu.prototype.getSuitData=function(roleId){var suit={};if(!this.hunguData[roleId])return suit;var posItemGroup=[];for(var k in GlobalConfig.HunGuConf.suit){if(!GlobalConfig.HunGuSuit[k])continue;posItemGroup[+k]=[];for(var i in GlobalConfig.HunGuConf.suit[k]){var iPos=GlobalConfig.HunGuConf.suit[k][i];var itemId=this.hunguData[roleId].items[iPos].itemId;if(itemId){posItemGroup[+k].push(GlobalConfig.HunGuEquip[itemId])}}posItemGroup[+k].sort(function(a,b){if(a.stage>b.stage)return-1;else return 1})}for(var i in GlobalConfig.HunGuSuit){suit[i]={};for(var j in GlobalConfig.HunGuSuit[i]){suit[i][j]={};suit[i][j].count=[];suit[i][j].stage=0;for(var z=0;z<+j;z++){if(!posItemGroup[+i][z])break;suit[i][j].count.push(posItemGroup[+i][z].id);if(!suit[i][j].stage)suit[i][j].stage=posItemGroup[+i][z].stage;if(suit[i][j].stage>posItemGroup[+i][z].stage)suit[i][j].stage=posItemGroup[+i][z].stage}}}return suit};Hungu.prototype.getHunguPosName=function(pos){return GlobalConfig.HunGuConf.hunguName[pos]};Hungu.prototype.getHunguItemQualityName=function(itemId,stage){var str="";var quality=stage;if(!quality){if(!GlobalConfig.HunGuEquip[itemId])quality=1;else quality=GlobalConfig.HunGuEquip[itemId].stage}switch(quality){case 1:str=i18n("Hungu_8");break;case 2:str=i18n("Hungu_9");break;case 3:str=i18n("Hungu_10");break;case 4:str=i18n("Hungu_11");break;case 5:str=i18n("Hungu_12");break}return str};Hungu.prototype.calcHunguTotalValue=function(roleId){var attrs=[];var hunguData=this.hunguData[roleId];if(!hunguData)return attrs;var jcattrs=[];for(var i=0;i<hunguData.items.length;i++){var itemId=hunguData.items[i].itemId;var hgequip=GlobalConfig.HunGuEquip[itemId];if(!hgequip)continue;for(var j=0;j<hgequip.attrs.length;j++){var ishave=false;for(var z=0;z<jcattrs.length;z++){if(jcattrs[z].type==hgequip.attrs[j].type){jcattrs[z].value+=hgequip.attrs[j].value;ishave=true;break}}if(!ishave){jcattrs.push(new AttributeData(hgequip.attrs[j].type,hgequip.attrs[j].value))}}for(var j=0;j<hunguData.items[i].hunyu.length;j++){if(hunguData.items[i].hunyu[j]){var hunyuType=GlobalConfig.HunGuConf.hunyuType[i][j];var level=hunguData.items[i].hunyu[j];var hyequip=GlobalConfig.HunYuEquip[hunyuType][level];for(var k=0;k<hyequip.attrs.length;k++){var ishave=false;for(var z=0;z<attrs.length;z++){if(attrs[z].type==hyequip.attrs[k].type){attrs[z].value+=hyequip.attrs[k].value;ishave=true;break}}if(!ishave){attrs.push(new AttributeData(hyequip.attrs[k].type,hyequip.attrs[k].value))}}}}}var suit=this.getSuitData(roleId);var percent=[];for(var i in suit){for(var j in suit[i]){if(suit[i][j].count.length>=+j){var stage=suit[i][j].stage;var hgsuit=GlobalConfig.HunGuSuit[i][j][stage];if(hgsuit&&hgsuit.attrs){for(var k=0;k<hgsuit.attrs.length;k++){var ishave=false;for(var z=0;z<attrs.length;z++){if(attrs[z].type==hgsuit.attrs[k].type){attrs[z].value+=hgsuit.attrs[k].value;ishave=true;break}}if(!ishave){attrs.push(new AttributeData(hgsuit.attrs[k].type,hgsuit.attrs[k].value))}}}if(hgsuit&&hgsuit.specialAttrs){percent.push(hgsuit.specialAttrs/1e4)}}}}for(var i=0;i<percent.length;i++){for(var j=0;j<jcattrs.length;j++){jcattrs[j].value*=1+percent[i]}}for(var k=0;k<jcattrs.length;k++){var ishave=false;for(var z=0;z<attrs.length;z++){if(attrs[z].type==jcattrs[k].type){attrs[z].value+=jcattrs[k].value;attrs[z].value=Math.floor(attrs[z].value);ishave=true;break}}if(!ishave){attrs.push(new AttributeData(jcattrs[k].type,Math.floor(jcattrs[k].value)))}}return attrs};Hungu.prototype.getAttrStrByType=function(type){var str="";switch(type){case AttributeType.atMaxHp:str=i18n("Hungu_13");break;case AttributeType.atAttack:str=i18n("Hungu_14");break;case AttributeType.atDef:str=i18n("Hungu_15");break;case AttributeType.atRes:str=i18n("Hungu_16");break}return str};Hungu.prototype.getCurHunguId=function(roleId,pos){var ins=Hungu.ins();var hgData=ins.hunguData[roleId];if(!hgData)return 0;var hgItem=hgData.items[pos];if(!hgItem)return 0;return hgItem.itemId};Hungu.prototype.getNextHunguId=function(roleId,pos){var ins=Hungu.ins();var hgData=ins.hunguData[roleId];if(!hgData)return 0;var hgItem=hgData.items[pos];if(!hgItem)return 0;return GlobalConfig.HunGuEquip[hgItem.itemId].nextId};Hungu.prototype.getNextHunyuLvConfig=function(roleId,pos,kong){if(!this.hunguData[roleId])return null;var hyType=GlobalConfig.HunGuConf.hunyuType[pos][kong];var lv=this.hunguData[roleId].items[pos].hunyu[kong];return GlobalConfig.HunYuEquip[hyType][lv+1]};Hungu.prototype.getUpgradeRedPoint=function(itemId){var hgequip=GlobalConfig.HunGuEquip[itemId];if(!hgequip||!hgequip.addStageCost)return false;var ins=UserBag.ins();for(var i in hgequip.addStageCost){var itemData=ins.getBagItemById(hgequip.addStageCost[i].id);if(!itemData||itemData.count<hgequip.addStageCost[i].count)return false}return true};Hungu.prototype.sendHunguItems=function(roleId,pos,itemId){var bytes=this.getBytes(2);bytes.writeByte(roleId);bytes.writeByte(pos);bytes.writeInt(itemId);this.sendToServer(bytes)};Hungu.prototype.sendHunyu=function(roleId,pos,hypos){var bytes=this.getBytes(3);bytes.writeByte(roleId);bytes.writeByte(pos);bytes.writeByte(hypos);this.sendToServer(bytes)};Hungu.prototype.sendHunguItemUpgrade=function(roleId,pos){var bytes=this.getBytes(4);bytes.writeByte(roleId);bytes.writeByte(pos);this.sendToServer(bytes)};Hungu.prototype.postHunguInfo=function(bytes){var roleSum=bytes.readByte();for(var i=0;i<roleSum;i++){var roleId=bytes.readByte();var len=bytes.readByte();var hgd=void 0;if(this.hunguData[roleId])hgd=this.hunguData[roleId];else hgd=new HunguData;for(var j=0;j<len;j++){hgd.items[j].itemId=bytes.readInt();var hys=bytes.readByte();for(var z=0;z<hys;z++){hgd.items[j].hunyu[z]=bytes.readInt()}}this.hunguData[roleId]=hgd}};Hungu.prototype.postHunguItems=function(bytes){var roleId=bytes.readByte();var pos=bytes.readByte();var itemId=bytes.readInt();if(!this.hunguData[roleId])this.hunguData[roleId]=new HunguData;var hunguData=this.hunguData[roleId];var olditemId=hunguData.items[pos].itemId;if(hunguData)hunguData.items[pos].itemId=itemId;if(olditemId==0&&itemId!=0){this.postNothing2Wear(1,pos)}if(itemId==0&&olditemId!=0){this.postWear2Noting(0,pos)}};Hungu.prototype.postNothing2Wear=function(control,pos){return[control,pos]};Hungu.prototype.postWear2Noting=function(control,pos){return[control,pos]};Hungu.prototype.postHunyu=function(bytes){var roleId=bytes.readByte();var pos=bytes.readByte();var hypos=bytes.readByte();var level=bytes.readInt();if(this.hunguData[roleId])this.hunguData[roleId].items[pos].hunyu[hypos-1]=level};Hungu.prototype.postHunguItemUpgrade=function(bytes){var roleId=bytes.readByte();var pos=bytes.readByte();var itemId=bytes.readInt();if(this.hunguData[roleId])this.hunguData[roleId].items[pos].itemId=itemId;this.postNothing2Wear(1,pos)};Hungu.prototype.enterHunShouFB=function(){this.sendBaseProto(5)};Hungu.prototype.sweepHunShouFB=function(){this.sendBaseProto(6)};Hungu.prototype.postSweepHunShouFB=function(bytes){var id=bytes.readInt();this.hunShouFBTimes=bytes.readInt();var len=bytes.readInt();var rewards=[];var reward;for(var i=0;i<len;i++){reward=new RewardData;reward.type=bytes.readInt();reward.id=bytes.readInt();reward.count=bytes.readInt();rewards.push(reward)}ViewManager.ins().open(HunShouSweepWin,id,rewards)};Hungu.prototype.postHunShouFBInfo=function(bytes){this.hunShouFBPassID=bytes.readInt();this.hunShouFBTimes=GlobalConfig.HunGuConf.dayRewardCount-bytes.readInt()};Hungu.prototype.postHunShouFBEndTime=function(bytes){this._hunShouFBEndTime=bytes.readInt()};Hungu.prototype.getHunShouFbLeftTime=function(){return Math.floor((this._hunShouFBEndTime*1e3+DateUtils.SECOND_2010*1e3-GameServer.serverTime)/1e3)};Hungu.prototype.isHunShouFBOpen=function(){return UserZs.ins().lv>=GlobalConfig.HunGuConf.needZsLv&&GameServer.serverOpenDay+1>=GlobalConfig.HunGuConf.fbOpenDay};Hungu.prototype.showHunShouFB=function(){return UserZs.ins().lv>=GlobalConfig.HunGuConf.showZsLv&&GameServer.serverOpenDay+1>=GlobalConfig.HunGuConf.fbOpenDay};Hungu.prototype.showHunShouRed=function(){if(!this.isHunShouFBOpen())return false;return this.hunShouFBTimes>0};return Hungu}(BaseSystem);__reflect(Hungu.prototype,"Hungu");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.hungu=Hungu.ins.bind(Hungu)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var HunguRedPoint=function(_super){__extends(HunguRedPoint,_super);function HunguRedPoint(){var _this=_super.call(this)||this;_this.itemPoints=[];_this.roleTabs=[];_this.redPoint=false;_this.associated(_this.postRedPoint,_this.postRoleRedPoint);_this.associated(_this.postRoleRedPoint,Hungu.ins().postHunguInfo,Hungu.ins().postHunguItems,Hungu.ins().postHunyu,Hungu.ins().postHunguItemUpgrade,UserBag.ins().postItemCountChange,UserZs.ins().postZsLv,GameLogic.ins().postSubRoleChange);return _this}HunguRedPoint.prototype.postRedPoint=function(){var old=this.redPoint;this.redPoint=false;for(var i=0;i<this.roleTabs.length;i++){if(this.roleTabs[i]){this.redPoint=true}}return old!=this.redPoint};HunguRedPoint.prototype.postRoleRedPoint=function(){var ins=Hungu.ins();for(var r=0;r<3;r++){var role=SubRoles.ins().getSubRoleByIndex(r);if(!role){this.roleTabs[r]=false;continue}for(var i=0;i<GlobalConfig.HunGuConf.equipCount;i++){this.roleTabs[r]=this.HunguItemRedPoint(role.index,i);if(this.roleTabs[r])break}}return true};HunguRedPoint.prototype.HunguItemRedPoint=function(roleId,pos){var ins=Hungu.ins();var redPoint=false;var items=ins.getHunguItemsList(pos);if(items.length){if(ins.hunguData[roleId]&&ins.hunguData[roleId].items[pos].itemId){}else{redPoint=true;return redPoint}}redPoint=ins.getHunyuRedPoint(roleId,pos);if(redPoint)return true;if(ins.hunguData[roleId]&&ins.hunguData[roleId].items[pos].itemId){redPoint=ins.getUpgradeRedPoint(ins.hunguData[roleId].items[pos].itemId);if(redPoint)return redPoint}return redPoint};return HunguRedPoint}(BaseSystem);__reflect(HunguRedPoint.prototype,"HunguRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.hunguRedPoint=HunguRedPoint.ins.bind(HunguRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var HunguData=function(){function HunguData(){}Object.defineProperty(HunguData.prototype,"items",{get:function(){if(!this._items){this._items=[];for(var i=0;i<GlobalConfig.HunGuConf.equipCount;i++){var hgi=new HungguItems;this._items.push(hgi)}}return this._items},set:function(its){this._items=its},enumerable:true,configurable:true});return HunguData}();__reflect(HunguData.prototype,"HunguData");var HungguItems=function(){function HungguItems(){this.itemId=0;this.hunyu=[];for(var i=0;i<GlobalConfig.HunGuConf.hunyuCount;i++){this.hunyu.push(0)}}return HungguItems}();__reflect(HungguItems.prototype,"HungguItems");var HGPOS;(function(HGPOS){HGPOS[HGPOS["ITEM0"]=0]="ITEM0";HGPOS[HGPOS["ITEM1"]=1]="ITEM1";HGPOS[HGPOS["ITEM2"]=2]="ITEM2";HGPOS[HGPOS["ITEM3"]=3]="ITEM3";HGPOS[HGPOS["ITEM4"]=4]="ITEM4";HGPOS[HGPOS["ITEM5"]=5]="ITEM5";HGPOS[HGPOS["ITEM6"]=6]="ITEM6";HGPOS[HGPOS["ITEM7"]=7]="ITEM7"})(HGPOS||(HGPOS={}));window["HGPOS"]=HGPOS;var HunguAttrWin=function(_super){__extends(HunguAttrWin,_super);function HunguAttrWin(){var _this=_super.call(this)||this;_this._lastX=0;_this.proShowList=[];_this.skinName="heartmethodAttrSkin";_this.isTopLevel=true;_this.proShowList=[2,4,5,6];return _this}HunguAttrWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};HunguAttrWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curRole=param[0];this.setRoleAttr(this.curRole);var len=SubRoles.ins().subRolesLen;if(len>1){this.addTouchEvent(this.leftBtn,this.onTouch);this.addTouchEvent(this.rightBtn,this.onTouch);this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.addTouchEndEvent(this.bg,this.onMove)}this.addTouchEndEvent(this,this.otherClose)};HunguAttrWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var len=SubRoles.ins().subRolesLen;if(len>1){this.removeTouchEvent(this.leftBtn,this.onTouch);this.removeTouchEvent(this.rightBtn,this.onTouch);this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};HunguAttrWin.prototype.onClose=function(e){ViewManager.ins().close(this)};HunguAttrWin.prototype.otherClose=function(e){if(e.target==this.bg||e.target instanceof eui.Button)return;ViewManager.ins().close(this)};HunguAttrWin.prototype.onMove=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=e.localX;break;case egret.TouchEvent.TOUCH_END:if(this._lastX>e.localX){if(this.curRole<2){this.curRole++;this.setRoleAttr(this.curRole);this.moveAttr(-200)}}else if(this._lastX<e.localX){if(this.curRole>0){this.curRole--;this.setRoleAttr(this.curRole);this.moveAttr(200)}}break}};HunguAttrWin.prototype.moveAttr=function(num){var t=egret.Tween.get(this.attrGroup);var toNum;if(num>0)toNum=0;else toNum=242;t.to({x:this.attrGroup.x+num,alpha:0},200).to({x:toNum},200).to({x:80,alpha:1},200)};HunguAttrWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.leftBtn:if(this.curRole>0){this.curRole--;this.setRoleAttr(this.curRole);this.moveAttr(200)}break;case this.rightBtn:if(this.curRole<2){this.curRole++;this.setRoleAttr(this.curRole);this.moveAttr(-200)}break}};HunguAttrWin.prototype.setRoleAttr=function(roleId){var role=SubRoles.ins().getSubRoleByIndex(roleId);this.job.source="op_"+role.job;var str="";var strName="";var value=0;var i=0;var attrsList=Hungu.ins().calcHunguTotalValue(role.index);for(var j=0;j<this.proShowList.length;j++){i=this.proShowList[j];value=0;for(var idx=0;idx<attrsList.length;idx++){if(attrsList[idx].type==i){value=attrsList[idx].value;break}}str+=Math.floor(value)+"";strName+=Hungu.ins().getAttrStrByType(i)+":";if(j<this.proShowList.length-1){str+="\n";strName+="\n"}}this.attr.text=str;this.attrName.text=strName;this.setBtn()};HunguAttrWin.prototype.setBtn=function(){var len=SubRoles.ins().subRolesLen;if(len==1){this.leftBtn.visible=false;this.rightBtn.visible=false}else if(len>1){if(this.curRole==0){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.curRole==1){this.leftBtn.visible=true;if(len<3)this.rightBtn.visible=false;else this.rightBtn.visible=true}else if(this.curRole==2){this.leftBtn.visible=true;this.rightBtn.visible=false}}};return HunguAttrWin}(BaseEuiView);__reflect(HunguAttrWin.prototype,"HunguAttrWin");ViewManager.ins().reg(HunguAttrWin,LayerManager.UI_Popup);var HunguChooseEquipWin=function(_super){__extends(HunguChooseEquipWin,_super);function HunguChooseEquipWin(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.itemList=[];_this.pos=0;_this.roleSelect=0;return _this}HunguChooseEquipWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="hunguChooseSkin";this.list.itemRenderer=HunguEquipChooseItem};HunguChooseEquipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(Hungu.ins().postHunguItems,this.HunguItemsCallback);this.roleSelect=param[0];this.pos=param[1];var itemId=0;this.itemGroup.visible=false;if(Hungu.ins().hunguData[this.roleSelect]){this.itemGroup.visible=true;itemId=Hungu.ins().hunguData[this.roleSelect].items[this.pos].itemId;if(itemId){this.scroll.y=160;this.scroll.height=410;this.wearItem=new HunguEquipChooseItem;this.itemGroup.addChild(this.wearItem);this.wearItem.data={id:itemId,roleId:this.roleSelect};this.wearItem.setWearVisible(true)}}this.itemList=this.getHunguItemList(this.roleSelect,this.pos);this.list.dataProvider=new eui.ArrayCollection(this.itemList);this.list.validateNow()};HunguChooseEquipWin.prototype.HunguItemsCallback=function(){ViewManager.ins().close(this)};HunguChooseEquipWin.prototype.getHunguItemList=function(roleId,pos){var itemData=UserBag.ins().getBagGoodsByType(ItemType.TYPE_24);var list=[];for(var i=0;i<itemData.length;i++){var slot=Hungu.ins().getHunguItemsPos(itemData[i].itemConfig.id);if(slot==pos)list.push({id:itemData[i].configID,roleId:this.roleSelect})}list.sort(function(a,b){var aequip=GlobalConfig.HunGuEquip[a.id];var bequip=GlobalConfig.HunGuEquip[b.id];if(aequip.stage>bequip.stage)return-1;else return 1});return list};HunguChooseEquipWin.prototype.onTap=function(e){ViewManager.ins().close(this)};return HunguChooseEquipWin}(BaseEuiView);__reflect(HunguChooseEquipWin.prototype,"HunguChooseEquipWin");ViewManager.ins().reg(HunguChooseEquipWin,LayerManager.UI_Popup);var HunguEquipChooseItem=function(_super){__extends(HunguEquipChooseItem,_super);function HunguEquipChooseItem(){var _this=_super.call(this)||this;_this.skinName="hunguChooseItem";_this.init();return _this}HunguEquipChooseItem.prototype.init=function(){this.changeBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};HunguEquipChooseItem.prototype.dataChanged=function(){if(!this.data||!this.data.id||isNaN(this.data.roleId))return;var pow=UserBag.getAttrPower(GlobalConfig.HunGuEquip[this.data.id].attrs);var expow=GlobalConfig.HunGuEquip[this.data.id].expower;expow=expow?expow:0;pow+=expow;this.now.visible=false;this.power.text=i18n("HunguEquipChooseItem_0",pow);var config=GlobalConfig.ItemConfig[this.data.id];var color=ItemConfig.getQualityColor(config);this.quality.textFlow=TextFlowMaker.generateTextFlow1(i18n("HunguEquipChooseItem_1",color,Hungu.ins().getHunguItemQualityName(config.id)));this.quality.strokeColor=ItemConfig.getQualityStrokeColor(config);this.itemIcon.setData(config);for(var i=0;i<3;i++){if(this["group"+i]&&this["attr"+i]){if(GlobalConfig.HunGuEquip[this.data.id].attrs[i]){if(!this["group"+i].parent)this.addChild(this["group"+i]);this["attr"+i].text=AttributeData.getAttrNameByAttrbute(GlobalConfig.HunGuEquip[this.data.id].attrs[i],true);if(this["betterArrow"+i]&&this["forgeAttr"+i]){this["betterArrow"+i].visible=this["forgeAttr"+i].visible=false;var j=ItemConfig.getSubType(config);if(!Hungu.ins().hunguData[this.data.roleId]||!Hungu.ins().hunguData[this.data.roleId].items[j].itemId){this["betterArrow"+i].visible=this["forgeAttr"+i].visible=true;this["forgeAttr"+i].text="+"+GlobalConfig.HunGuEquip[this.data.id].attrs[i].value}else{var itemId=Hungu.ins().hunguData[this.data.roleId].items[j].itemId;for(var z=0;z<GlobalConfig.HunGuEquip[itemId].attrs.length;z++){if(GlobalConfig.HunGuEquip[itemId].attrs[z].type==GlobalConfig.HunGuEquip[this.data.id].attrs[i].type){if(GlobalConfig.HunGuEquip[itemId].attrs[z].value>GlobalConfig.HunGuEquip[this.data.id].attrs[i].value)this["betterArrow"+i].visible=this["forgeAttr"+i].visible=true;break}}}}}else{DisplayUtils.removeFromParent(this["group"+i])}}}};HunguEquipChooseItem.prototype.setWearVisible=function(v){if(v===void 0){v=false}this.now.visible=v;this.changeBtn.visible=!this.now.visible};HunguEquipChooseItem.prototype.onClick=function(){var config=GlobalConfig.ItemConfig[this.data.id];var pos=ItemConfig.getSubType(config);Hungu.ins().sendHunguItems(this.data.roleId,pos,this.data.id)};return HunguEquipChooseItem}(eui.ItemRenderer);__reflect(HunguEquipChooseItem.prototype,"HunguEquipChooseItem");var HunguGroupItem=function(_super){__extends(HunguGroupItem,_super);function HunguGroupItem(){var _this=_super.call(this)||this;_this.skinName="hunguGroupItemSkin";return _this}HunguGroupItem.prototype.dataChanged=function(){if(!this.data)return;this.qualityName.textFlow=TextFlowMaker.generateTextFlow1(this.data.qualityName);this.posName.textFlow=TextFlowMaker.generateTextFlow1(this.data.posName);for(var i=0;i<3;i++){if(this["suit"+i]&&this.data.suits[i])this["suit"+i].textFlow=TextFlowMaker.generateTextFlow1(this.data.suits[i]);else DisplayUtils.removeFromParent(this["suit"+i])}};return HunguGroupItem}(BaseItemRender);__reflect(HunguGroupItem.prototype,"HunguGroupItem");var HunguGroupWin=function(_super){__extends(HunguGroupWin,_super);function HunguGroupWin(){var _this=_super.call(this)||this;_this.skinName="hunguGroupSkin";return _this}HunguGroupWin.prototype.childrenCreated=function(){};HunguGroupWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};HunguGroupWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);this.roleId=param[0];this.id=param[1];this.updateShow()};HunguGroupWin.prototype.updateShow=function(){this.itemData=[];this.init();var suit=Hungu.ins().getSuitData(this.roleId);if(CommonUtils.getObjectLength(suit)&&suit[this.id]){this.itemData=[];this.suit2="";this.suit4="";this.suit6="";var list=this.getPosColorName(this.id);var stages=[];for(var i in suit[this.id]){if(stages.indexOf(suit[this.id][i].stage)==-1)stages.push(suit[this.id][i].stage)}var qualityName="";for(var s=0;s<stages.length;s++){var quality=stages[s];qualityName=GlobalConfig.HunGuConf.suitName[this.id-1][quality<=1?0:quality-1];var lightPos=[];var suits=[];for(var i in GlobalConfig.HunGuSuit[this.id]){for(var j=0;j<suit[this.id][i].count.length;j++){var itemId=suit[this.id][i].count[j];var tpos=ItemConfig.getSubType(GlobalConfig.ItemConfig[itemId]);if(lightPos.indexOf(tpos)==-1)lightPos.push(tpos)}var hgsuit=GlobalConfig.HunGuSuit[this.id][i][quality];var color=0;if(suit[this.id][i].stage==quality&&suit[this.id][i].count.length>=+i)color=ColorUtil.GREEN_COLOR_N;else color=ColorUtil.GRAY_COLOR2;if(!hgsuit){hgsuit=GlobalConfig.HunGuSuit[this.id][i][1]}if(hgsuit.dec){suits.push(i18n("HunguGroupWin_3",color,i)+hgsuit.dec)}}var posName="";for(var i=0;i<list.length;i++){var color=0;if(lightPos.indexOf(list[i])==-1){color=ColorUtil.GRAY_COLOR2}else{color=ColorUtil.GREEN_COLOR_N}posName+=i18n("HunguGroupWin_14",color,Hungu.ins().getHunguPosName(list[i]))+"  "}this.itemData.push({qualityName:qualityName,posName:posName,suits:suits})}if(stages.length==1){var isShowNext=true;if(Hungu.ins().hunguData[this.roleId]){for(var i in Hungu.ins().hunguData[this.roleId].items){if(list.indexOf(Number(i))==-1)continue;var itemId=Hungu.ins().hunguData[this.roleId].items[i].itemId;if(!itemId||GlobalConfig.HunGuEquip[itemId].stage!=stages[0]){isShowNext=false;break}}}if(isShowNext){var suits2=[];for(var i in GlobalConfig.HunGuSuit[this.id]){if(!suit[this.id][+i])continue;var maxStage=CommonUtils.getObjectLength(GlobalConfig.HunGuSuit[this.id][+i]);var curStage=suit[this.id][+i].stage;if(curStage!=maxStage){var nextStage=curStage+1;var qualityName_1=GlobalConfig.HunGuConf.suitName[this.id-1][nextStage<=1?0:nextStage-1];var posName="";for(var j=0;j<list.length;j++){posName+=i18n("HunguGroupWin_15",ColorUtil.GRAY_COLOR2,Hungu.ins().getHunguPosName(list[j]))+"  "}for(var j in GlobalConfig.HunGuSuit[this.id]){var hgsuit=GlobalConfig.HunGuSuit[this.id][j][nextStage];if(hgsuit.dec){suits2.push(i18n("HunguGroupWin_7",ColorUtil.GRAY_COLOR2,j)+hgsuit.dec)}}this.itemData.push({qualityName:qualityName_1,posName:posName,suits:suits2});break}}}}}for(var i=0;i<this.itemData.length;i++){var hgitem=new HunguGroupItem;hgitem.data={qualityName:this.itemData[i].qualityName,posName:this.itemData[i].posName,suits:this.itemData[i].suits};this.content.addChild(hgitem)}};HunguGroupWin.prototype.getPosColorName=function(id){var list=[];for(var i=0;i<GlobalConfig.HunGuConf.suit[id].length;i++){list.push(GlobalConfig.HunGuConf.suit[id][i])}return list};HunguGroupWin.prototype.init=function(id){if(id===void 0){id=this.id}var specalstr=id==1?i18n("HunguGroupWin_8"):i18n("HunguGroupWin_9");var qualityName=i18n("HunguGroupWin_10",specalstr);var suitType=GlobalConfig.HunGuConf.suit[id];var posName="";this.suit2="";this.suit4="";this.suit6="";for(var i=0;i<suitType.length;i++){posName+=i18n("HunguGroupWin_16",ColorUtil.GRAY_COLOR2)+Hungu.ins().getHunguPosName(suitType[i])+"  "}var suits=[];for(var k in GlobalConfig.HunGuSuit[id]){var hgsuit=GlobalConfig.HunGuSuit[id][k][1];if(hgsuit.specialAttrs)suits.push(i18n("HunguGroupWin_11",ColorUtil.GRAY_COLOR2,k,hgsuit.specialAttrs/100));else{var valueStr="";for(var j=0;j<hgsuit.attrs.length;j++){valueStr+=AttributeData.getAttrStrByType(hgsuit.attrs[j].type)+"+"+hgsuit.attrs[j].value+"  "}if(hgsuit.dec){suits.push(i18n("HunguGroupWin_12",ColorUtil.GRAY_COLOR2,k)+hgsuit.dec)}}}this.itemData.push({qualityName:qualityName,posName:posName,suits:suits})};HunguGroupWin.prototype.onTap=function(e){ViewManager.ins().close(this)};return HunguGroupWin}(BaseEuiView);__reflect(HunguGroupWin.prototype,"HunguGroupWin");ViewManager.ins().reg(HunguGroupWin,LayerManager.UI_Popup);var HunguItemIcon=function(_super){__extends(HunguItemIcon,_super);function HunguItemIcon(){var _this=_super.call(this)||this;_this.skinName="hunyuItemSkin";return _this}HunguItemIcon.prototype.setData=function(config){this.config=config;if(config){this.icon.source=config.icon+"_png"}};return HunguItemIcon}(BaseComponent);__reflect(HunguItemIcon.prototype,"HunguItemIcon");var HunguStageWin=function(_super){__extends(HunguStageWin,_super);function HunguStageWin(){var _this=_super.call(this)||this;_this.skinName="hunguStageSkin";return _this}HunguStageWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};HunguStageWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.roleId=param[0];this.pos=param[1];this.getItemList.itemRenderer=ItemBase;this.addTouchEvent(this.lvUpBtn,this.onTouch);this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.observe(Hungu.ins().postHunguItemUpgrade,this.updateUI);this.attrNow=[this.attr1Now0,this.attr2Now0,this.attr3Now0];this.arrtNext=[this.attr1Next0,this.attr2Next0,this.attr3Next0];this.updateUI()};HunguStageWin.prototype.updateUI=function(){var ins=Hungu.ins();var curId=ins.getCurHunguId(this.roleId,this.pos);var nextId=ins.getNextHunguId(this.roleId,this.pos);var curConfig=GlobalConfig.HunGuEquip[curId];var nextConfig=GlobalConfig.HunGuEquip[nextId];for(var i in this.attrNow){if(curConfig&&curConfig.attrs[i]){this.attrNow[i].visible=true;this.attrNow[i].text=this.parserStr(curConfig.attrs[i])}else{this.attrNow[i].visible=false}if(nextConfig&&nextConfig.attrs[i]){this.arrtNext[i].visible=true;this.arrtNext[i].text=this.parserStr(nextConfig.attrs[i])}else{this.arrtNext[i].visible=false}}var curCount=curConfig&&curConfig.hunyuNum?curConfig.hunyuNum:0;var nextCount=nextConfig&&nextConfig.hunyuNum?nextConfig.hunyuNum:0;this.hunyuNow.text=i18n("HunguStageWin_0",curCount);this.hunyuNext.text=i18n("HunguStageWin_1",nextCount);this.redPoint.visible=ins.getUpgradeRedPoint(curConfig&&curConfig.id?curConfig.id:0);if(curConfig&&curConfig.addStageCost){this.getItemList.dataProvider=new eui.ArrayCollection(curConfig.addStageCost);this.getItemList.validateNow();for(var i=0;i<this.getItemList.numElements;i++){var render=this.getItemList.getVirtualElementAt(i);var itemdata=this.getItemList.dataProvider.getItemAt(i);var color=ColorUtil.GREEN_COLOR_N;var itemData=UserBag.ins().getBagItemById(itemdata.id);var curCount_3=itemData?itemData.count:0;if(curCount_3<itemdata.count){color=ColorUtil.RED_COLOR_N}render.setName(i18n("HunguStageWin_3",color,curCount_3,itemdata.count))}}if(curConfig){this.nowItemIcon.data=curConfig.id;this.nowItemIcon.isShowJob(false);this.nowItemIcon.showNum(false);var power=0;power+=UserBag.getAttrPower(curConfig.attrs);var expower=curConfig.expower?curConfig.expower:0;power+=expower;this.powerPanel0.setPower(power)}if(nextConfig){this.nextItemIcon.data=nextConfig.id;this.nextItemIcon.isShowJob(false);this.nextItemIcon.showNum(false);var power=0;power+=UserBag.getAttrPower(nextConfig.attrs);var expower=nextConfig.expower?nextConfig.expower:0;power+=expower;this.powerPanel1.setPower(power)}};HunguStageWin.prototype.parserStr=function(attr){return AttributeData.getAttrStrByType(attr.type)+":"+attr.value};HunguStageWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.lvUpBtn:if(this.redPoint.visible){Hungu.ins().sendHunguItemUpgrade(this.roleId,this.pos)}else{UserTips.ins().showTips(i18n("HunguStageWin_2"))}break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};return HunguStageWin}(BaseEuiView);__reflect(HunguStageWin.prototype,"HunguStageWin");ViewManager.ins().reg(HunguStageWin,LayerManager.UI_Popup);var HunguTipsWin=function(_super){__extends(HunguTipsWin,_super);function HunguTipsWin(){var _this=_super.call(this)||this;_this.skinName="hunguTipsSkin";return _this}HunguTipsWin.prototype.childrenCreated=function(){};HunguTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};HunguTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.currentState=param[0]?"shenshang":"putong";this.validateNow();this.addTouchEvent(this.bgClose,this.onTap);if(this.currentState=="shenshang"){this.addTouchEvent(this.takeoffBtn,this.onTap);this.addTouchEvent(this.changeBtn,this.onTap);this.addTouchEvent(this.hunyuBtn,this.onTap);this.wear=true}this.observe(Hungu.ins().postHunguItems,this.HunguItemsCallback);this.observe(Hungu.ins().postHunguItemUpgrade,this.HunguItemUpgradeCallback);this.roleId=param[1];this.itemId=param[2];this.updateUI()};HunguTipsWin.prototype.HunguItemsCallback=function(){ViewManager.ins().close(this)};HunguTipsWin.prototype.HunguItemUpgradeCallback=function(){var pos=ItemConfig.getSubType(GlobalConfig.ItemConfig[this.itemId]);this.itemId=Hungu.ins().hunguData[this.roleId].items[pos].itemId;this.updateUI()};HunguTipsWin.prototype.updateUI=function(){var config=GlobalConfig.ItemConfig[this.itemId];this.equipIcon.setData(config);var color=ItemConfig.getQualityColor(config);this.nameTxt.textFlow=TextFlowMaker.generateTextFlow1(i18n("HunguTipsWin_5",color,config.name));this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(config);var q=ItemConfig.getQuality(config);this.quali.source=q>0?"quali"+q:"";this.toubuhungu.textFlow=TextFlowMaker.generateTextFlow1(""+Hungu.ins().getHunguPosName(ItemConfig.getSubType(config)));this.fanpin.textFlow=TextFlowMaker.generateTextFlow1(""+Hungu.ins().getHunguItemQualityName(config.id));this.tongyong.textFlow=TextFlowMaker.generateTextFlow1(""+Role.getJobNameByJob(ItemConfig.getJob(config)));var power=0;var suit=Hungu.ins().getSuitData(this.roleId);if(this.wear){power+=Hungu.ins().getHunguPosPower(this.roleId,ItemConfig.getSubType(config),suit,true)}else{power+=Hungu.ins().getHunguItemPower(config.id)}this.powerPanel.setPower(power);var jcattrs=[];var exjcattrs=[];var hyattrs=[];var hgequip=GlobalConfig.HunGuEquip[this.itemId];for(var j=0;j<hgequip.attrs.length;j++){var ishave=false;for(var z=0;z<jcattrs.length;z++){if(jcattrs[z].type==hgequip.attrs[j].type){jcattrs[z].value+=hgequip.attrs[j].value;ishave=true;break}}if(!ishave){jcattrs.push(new AttributeData(hgequip.attrs[j].type,hgequip.attrs[j].value))}}if(this.wear&&Hungu.ins().hunguData[this.roleId]){var percent=[];for(var i in suit){for(var j in suit[i]){if(suit[i][j].count.length>=+j){var stage=suit[i][j].stage;var hgsuit=GlobalConfig.HunGuSuit[i][j][stage];if(hgsuit&&hgsuit.specialAttrs){percent.push(hgsuit.specialAttrs/1e4)}}}}if(percent.length){for(var i=0;i<percent.length;i++){for(var j=0;j<jcattrs.length;j++){exjcattrs.push(new AttributeData(jcattrs[j].type,Math.floor(jcattrs[j].value*percent[i])))}}}this.updateRedPoint();for(var i=0;i<Hungu.ins().hunguData[this.roleId].items[ItemConfig.getSubType(config)].hunyu.length;i++){var lv=Hungu.ins().hunguData[this.roleId].items[ItemConfig.getSubType(config)].hunyu[i];var hyType=GlobalConfig.HunGuConf.hunyuType[ItemConfig.getSubType(config)][i];var hyequip=GlobalConfig.HunYuEquip[hyType][lv];if(hyequip){for(var j=0;j<hyequip.attrs.length;j++){var ishave=false;for(var z=0;z<hyattrs.length;z++){if(hyattrs[z].type==hyequip.attrs[j].type){hyattrs[z].value+=hyequip.attrs[j].value;ishave=true;break}}if(!ishave){hyattrs.push(new AttributeData(hyequip.attrs[j].type,hyequip.attrs[j].value))}}}}}var proShowList=[2,4,5,6];var idx=0;var hidex=0;for(var i=0;i<proShowList.length;i++){if(this["attr"+i]&&this["forgeAttr"+i]){this["attr"+i].visible=this["forgeAttr"+i].visible=false}if(this["starAttr"+i]){this["starAttr"+i].visible=false}if(this["attr"+idx]&&this["forgeAttr"+idx]){this["attr"+idx].visible=this["forgeAttr"+idx].visible=false;for(var j=0;j<jcattrs.length;j++){if(jcattrs[j].type==proShowList[i]){this["attr"+idx].visible=true;this["attr"+idx].text=AttributeData.getAttStr(jcattrs[j],0,1,":");if(this.currentState=="shenshang"&&exjcattrs[j]){this["forgeAttr"+idx].visible=true;this["forgeAttr"+idx].text="+"+exjcattrs[j].value}break}}if(this["attr"+idx].visible)idx++}if(this["starAttr"+hidex]){this["starAttr"+hidex].visible=false;for(var j=0;j<hyattrs.length;j++){if(hyattrs[j].type==proShowList[i]){this["starAttr"+hidex].visible=true;this["starAttr"+hidex].text=AttributeData.getAttStr(hyattrs[j],0,1,":");break}}if(this["starAttr"+hidex].visible)hidex++}}for(var i=0;i<=3;i++){if(this["attr"+i]&&!this["attr"+i].visible){DisplayUtils.removeFromParent(this["attr"+i].parent)}if(this["starAttr"+i]&&!this["starAttr"+i].visible){DisplayUtils.removeFromParent(this["starAttr"+i])}}if(this.starAttr.numElements<=1){DisplayUtils.removeFromParent(this.starAttr)}};HunguTipsWin.prototype.updateRedPoint=function(){var config=GlobalConfig.ItemConfig[this.itemId];var pos=ItemConfig.getSubType(config);this.changeRedPoint.visible=Hungu.ins().getUpgradeRedPoint(config.id);this.forgeRedPoint.visible=Hungu.ins().getHunyuRedPoint(this.roleId,pos)};HunguTipsWin.prototype.onTap=function(e){var config=GlobalConfig.ItemConfig[this.itemId];var pos=ItemConfig.getSubType(config);switch(e.currentTarget){case this.takeoffBtn:if(this.currentState!="shenshang"){UserTips.ins().showTips(i18n("HunguTipsWin_0"));return}if(Hungu.ins().hunguData[this.roleId]&&Hungu.ins().hunguData[this.roleId].items[pos]){Hungu.ins().sendHunguItems(this.roleId,pos,0);return}else{UserTips.ins().showTips(i18n("HunguTipsWin_1"))}break;case this.changeBtn:if(Hungu.ins().getNextHunguId(this.roleId,pos))ViewManager.ins().open(HunguStageWin,this.roleId,pos);else UserTips.ins().showTips(i18n("HunguTipsWin_3"));break;case this.hunyuBtn:if(this.currentState!="shenshang"){UserTips.ins().showTips(i18n("HunguTipsWin_4"));return}ViewManager.ins().open(HunyuWin,this.roleId,this.itemId);break;case this.bgClose:ViewManager.ins().close(this);break}};return HunguTipsWin}(BaseEuiView);__reflect(HunguTipsWin.prototype,"HunguTipsWin");ViewManager.ins().reg(HunguTipsWin,LayerManager.UI_Popup);var HunguWin=function(_super){__extends(HunguWin,_super);function HunguWin(){var _this=_super.call(this)||this;_this.wireEffs=[];return _this}HunguWin.prototype.childrenCreated=function(){};HunguWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.cleanWireEff();for(var i=0;i<GlobalConfig.HunGuConf.equipCount;i++){this.cleanEff(i)}GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};HunguWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.getItemTxt0,this.onTap);this.addTouchEvent(this.executeBtn,this.onTap);this.addTouchEvent(this.executeBtn0,this.onTap);this.addTouchEvent(this.xiangxishuxing,this.onTap);this.addTouchEvent(this.fenjie,this.onTap);for(var i=0;i<GlobalConfig.HunGuConf.equipCount;i++){this.addTouchEvent(this["equip"+i],this.onSelect)}this.observe(HunguRedPoint.ins().postRoleRedPoint,this.updateUI);this.observe(Hungu.ins().postNothing2Wear,this.HunguItemsResult);this.observe(Hungu.ins().postWear2Noting,this.HunguItemsResult);this.roleId=param[0];this.pos=param[1];this.initEff();this.updateUI();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.hunPo)};HunguWin.prototype.initEff=function(){this.posXian0=[this.HGliangxianzhi0,this.HGliangxianxie0];this.posXian1=[this.HGliangxianzhi1];this.posXian2=[this.HGliangxianzhi2,this.HGliangxianxie2];this.posXian3=[this.HGliangxianzhi3,this.HGliangxianxie3];this.posXian4=[this.HGliangxianzhi4,this.HGliangxianxie4];this.posXian5=[this.HGliangxianzhi5,this.HGliangxianxie5];this.posXian6=[this.HGliangxianzhi6,this.HGliangxianxie6];this.posXian7=[this.HGliangxianzhi7,this.HGliangxianxie7];this.effectPos=[this.effectPos0,this.effectPos1,this.effectPos2,this.effectPos3,this.effectPos4,this.effectPos5,this.effectPos6,this.effectPos7];this.liangdian=[this.liangdian0,this.liangdian1,this.liangdian2,this.liangdian3,this.liangdian4,this.liangdian5,this.liangdian6,this.liangdian7];var mc=new MovieClip;mc.playFile(RES_DIR_EFF+"hguieffect1",-1);this.effect1quanshen.addChild(mc);this.updateEff()};HunguWin.prototype.updateEff=function(){var hunguData=Hungu.ins().hunguData[this.roleId];if(!hunguData){return}var isSuccess=true;for(var i=0;i<8;i++){if(hunguData.items[i].itemId){for(var j in this["posXian"+i]){this["posXian"+i][j].visible=true}if(this.liangdian&&this.liangdian[i]){this.liangdian[i].visible=true}}else{isSuccess=false}}var suitEffects=[null,this.effect2toubu,this.effect3xia];for(var s in GlobalConfig.HunGuConf.suit){var suitId=+s;if(!suitId)continue;if(suitEffects[suitId]){var suit=Hungu.ins().getSuitData(this.roleId);for(var i in suit[suitId]){if(suit[suitId][i].count.length<+i)continue;var stage=suit[suitId][i].stage;var config=GlobalConfig.HunGuSuit[suitId][i][stage];if(config.effectId){var mc=void 0;if(!suitEffects[suitId].numElements){mc=new MovieClip;suitEffects[suitId].addChild(mc)}else{mc=suitEffects[suitId].getChildAt(0)}mc.playFile(RES_DIR_EFF+config.effectId,-1)}}}}};HunguWin.prototype.onSelect=function(e){for(var i=0;i<GlobalConfig.HunGuConf.equipCount;i++){if(this["equip"+i]){this["equip"+i].select.visible=false;if(e.currentTarget==this["equip"+i]){this.pos=i;this["equip"+i].select.visible=true;var hunguData=Hungu.ins().hunguData[this.roleId];if(!hunguData||!hunguData.items[i].itemId){var itemData=Hungu.ins().getHunguItemsList(i);if(itemData.length){Hungu.ins().sendHunguItems(this.roleId,i,itemData[0].configID)}else{UserTips.ins().showTips(i18n("HunguWin_0"))}}else{ViewManager.ins().open(HunguTipsWin,true,this.roleId,hunguData.items[i].itemId)}}}}};HunguWin.prototype.updateUI=function(){var ins=Hungu.ins();var power=ins.getResonancePower(this.roleId);var suit=ins.getSuitData(this.roleId);for(var i=0;i<GlobalConfig.HunGuConf.equipCount;i++){this.updateItem(i);power+=ins.getHunguPosPower(this.roleId,i,suit,true);this.powerPanel0.setPower(power)}this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt0.text)};HunguWin.prototype.updateItem=function(index){if(index===void 0){index=0}var equipItem=this["equip"+index];if(!equipItem)return;var ins=Hungu.ins();var itemIcon=equipItem.itemIcon;itemIcon.imgJob.visible=false;equipItem.level.visible=false;itemIcon.imgIcon.source="hungu"+index;equipItem.select.visible=this.pos==index?true:false;var hunguData=ins.hunguData[this.roleId];if(hunguData&&hunguData.items[index].itemId){var itemId=hunguData.items[index].itemId;var config=GlobalConfig.ItemConfig[itemId];itemIcon.imgIcon.source=config.icon+"_png";itemIcon.imgBg.source="quality1"}else{itemIcon.imgBg.source="quality0";for(var j in this["posXian"+index]){this["posXian"+index][j].visible=false}}equipItem["redPoint"].visible=this.getRedPoint(index)};HunguWin.prototype.getRedPoint=function(pos){return HunguRedPoint.ins().HunguItemRedPoint(this.roleId,pos)};HunguWin.prototype.onTap=function(e){switch(e.currentTarget){case this.getItemTxt0:UserWarn.ins().setBuyGoodsWarn(GlobalConfig.HunGuConf.gainItemId);break;case this.executeBtn:ViewManager.ins().open(HunguGroupWin,this.roleId,1);break;case this.executeBtn0:ViewManager.ins().open(HunguGroupWin,this.roleId,2);break;case this.xiangxishuxing:ViewManager.ins().open(HunguAttrWin,this.roleId);break;case this.fenjie:ViewManager.ins().open(SmeltItemTotalWin,this.getSmeltList());break}};HunguWin.prototype.getSmeltList=function(){var list=[];var canFenjieItem=GlobalConfig.HunGuConf.canFenjieItem;for(var i in canFenjieItem){var itemData=UserBag.ins().getBagItemById(canFenjieItem[i]);if(itemData){list.push(itemData)}}return list};HunguWin.prototype.HunguItemsResult=function(arr){var control=arr[0];var pos=arr[1];if(control)this.playEff(pos);else this.cleanEff(pos)};HunguWin.prototype.cleanEff=function(ipos){if(ipos===void 0){ipos=0}for(var i in this["posXian"+ipos]){this["posXian"+ipos][i].visible=false}if(this.liangdian&&this.liangdian[ipos]){this.liangdian[ipos].visible=false}var suitId=0;for(var i in GlobalConfig.HunGuConf.suit){if(GlobalConfig.HunGuConf.suit[i]instanceof Array&&GlobalConfig.HunGuConf.suit[i].indexOf(ipos)!=-1){suitId=+i;break}}var suitEffects=[null,this.effect2toubu,this.effect3xia];if(suitEffects[suitId]){suitEffects[suitId].removeChildren()}};HunguWin.prototype.playEff=function(ipos){if(ipos===void 0){ipos=0}var playTime=1e3;var posTime=[];var tw=0;for(var i in this["posXian"+ipos]){tw+=this["posXian"+ipos][i].width;this["posXian"+ipos][i].scrollRect=new egret.Rectangle(0,0,0,this["posXian"+ipos][i].height);this["posXian"+ipos][i].visible=true}var ts=0;for(var i in this["posXian"+ipos]){if(Number(i)==this["posXian"+ipos].length-1){posTime[i]=playTime-ts}else{posTime[i]=this["posXian"+ipos][i].width/tw*playTime;ts+=posTime[i]}}this.playWireEff(this["posXian"+ipos],posTime,0,ipos);var suitEffects=[null,this.effect2toubu,this.effect3xia];var suitId=0;for(var i in GlobalConfig.HunGuConf.suit){if(GlobalConfig.HunGuConf.suit[i]instanceof Array&&GlobalConfig.HunGuConf.suit[i]&&GlobalConfig.HunGuConf.suit[i].indexOf(ipos)!=-1){suitId=+i;break}}if(suitEffects[suitId]){var suit=Hungu.ins().getSuitData(this.roleId);for(var i in suit[suitId]){if(suit[suitId][i].count.length<+i)continue;var stage=suit[suitId][i].stage;var config=GlobalConfig.HunGuSuit[suitId][i][stage];if(config.effectId){var mc=void 0;if(!suitEffects[suitId].numElements){mc=new MovieClip;suitEffects[suitId].addChild(mc)}else{mc=suitEffects[suitId].getChildAt(0)}mc.playFile(RES_DIR_EFF+config.effectId,-1)}}}};HunguWin.prototype.playWireEff=function(posXian,posTime,playIndex,ipos){var _this=this;if(playIndex===void 0){playIndex=0}if(ipos===void 0){ipos=0}if(!posXian[playIndex])return;var tw=egret.Tween.get(posXian[playIndex].scrollRect);tw.to({width:posXian[playIndex].width},posTime[playIndex]).call(function(){egret.Tween.removeTweens(tw);posXian[playIndex].scrollRect.width=posXian[playIndex].width;playIndex++;if(playIndex>=posXian.length){var mc=new MovieClip;mc.playFile(RES_DIR_EFF+"hguieffect0",1);_this.effectPos[ipos].addChild(mc);if(_this.liangdian&&_this.liangdian[ipos]){_this.liangdian[ipos].visible=true}}else{_this.playWireEff(posXian,posTime,playIndex,ipos)}},this);if(!this.wireEffs[ipos])this.wireEffs[ipos]=[];if(this.wireEffs[ipos][playIndex]){egret.Tween.removeTweens(this.wireEffs[ipos][playIndex])}this.wireEffs[ipos][playIndex]=tw};HunguWin.prototype.cleanWireEff=function(){if(!this.wireEffs)return;for(var i=0;i<this.wireEffs.length;i++){if(!this.wireEffs[i])continue;for(var j in this.wireEffs[i]){egret.Tween.removeTweens(this.wireEffs[i][j])}}};return HunguWin}(BaseView);__reflect(HunguWin.prototype,"HunguWin");var HunyuWin=function(_super){__extends(HunyuWin,_super);function HunyuWin(){var _this=_super.call(this)||this;_this.skinName="hunguJewelSkin";_this.isTopLevel=true;return _this}HunyuWin.prototype.childrenCreated=function(){};HunyuWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};HunyuWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}ViewManager.ins().close(HunguTipsWin);this.addTouchEvent(this.executeBtn0,this.onTap);this.addTouchEvent(this.executeBtn,this.onTap);this.addTouchEvent(this.getItemTxt0,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(Hungu.ins().postHunyu,this.updateShow);this.observe(Hungu.ins().postHunyu,this.playEff);for(var i=0;i<GlobalConfig.HunGuConf.hunyuCount;i++){this.addTouchEvent(this["equip"+i],this.onSelect)}this.roleId=param[0];this.itemId=param[1];this.kong=param[2]||0;this["equip"+this.kong].select.visible=true;this.updateShow()};HunyuWin.prototype.onSelect=function(e){for(var i=0;i<GlobalConfig.HunGuConf.hunyuCount;i++){var equipItem=this["equip"+i];equipItem.select.visible=false;if(equipItem&&e.currentTarget==equipItem){var config=GlobalConfig.ItemConfig[this.itemId];var pos=ItemConfig.getSubType(config);if(i+1>GlobalConfig.HunGuEquip[Hungu.ins().hunguData[this.roleId].items[pos].itemId].hunyuNum){var qualityName=Hungu.ins().getHunguItemQualityName(0,i);if(qualityName)UserTips.ins().showTips(i18n("HunyuWin_0",qualityName));this["equip"+this.kong].select.visible=true}else if(this.kong!=i){equipItem.select.visible=true;this.kong=i;this.updateShow()}else{equipItem.select.visible=true}}}};HunyuWin.prototype.updateShow=function(){this.updateAct();this.updateUI();this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt0.text)};HunyuWin.prototype.playEff=function(){var hyequipItem=this["equip"+this.kong];if(hyequipItem){var mc=new MovieClip;mc.playFile(RES_DIR_EFF+"forgeSuccess",1);hyequipItem.eff.addChild(mc)}};HunyuWin.prototype.updateUI=function(){this.hide();this.updateItems()};HunyuWin.prototype.updateItems=function(){var equipItem=this["equip"];var itemIcon=equipItem.itemIcon;var config=GlobalConfig.ItemConfig[this.itemId];itemIcon.setData(config);var pos=ItemConfig.getSubType(config);var ins=Hungu.ins();for(var i=0;i<GlobalConfig.HunGuConf.hunyuCount;i++){var hyequipItem=this["equip"+i];var openText=hyequipItem.openText;if(!hyequipItem)continue;var b=ins.getHunyuKongRedPoint(this.roleId,pos,i);hyequipItem.redPoint.visible=b;var hyitemIcon=hyequipItem.itemIcon;hyitemIcon.icon.visible=false;hyequipItem.kejihuo.visible=false;hyitemIcon.lock.visible=false;openText.visible=false;hyequipItem.level.visible=false;hyequipItem.lvBg.visible=true;var hunyuNum=GlobalConfig.HunGuEquip[ins.hunguData[this.roleId].items[pos].itemId].hunyuNum;if(i+1>hunyuNum){hyitemIcon.lock.visible=true;if(i==hunyuNum){openText.visible=true;var qualityName=Hungu.ins().getHunguItemQualityName(0,i);if(qualityName)openText.text=i18n("HunyuWin_1",qualityName)}else{hyequipItem.lvBg.visible=false}}else{hyequipItem.level.visible=true;hyitemIcon.icon.visible=true;var hylv=ins.hunguData[this.roleId].items[pos].hunyu[i];if(hylv){var hyt=GlobalConfig.HunGuConf.hunyuType[pos][i];hyitemIcon.icon.source=GlobalConfig.HunYuEquip[hyt][hylv].icon;hyequipItem.level.text=i18n("HunyuWin_2",hylv)}else{hyequipItem.level.text=i18n("HunyuWin_3",0);if(b){hyequipItem.kejihuo.visible=true;hyitemIcon.icon.visible=false;hyequipItem.lvBg.visible=false;hyequipItem.level.visible=false}}}}var power=0;if(ins.hunguData[this.roleId]&&ins.hunguData[this.roleId].items[pos].hunyu){var hyT=GlobalConfig.HunGuConf.hunyuType[pos][this.kong];for(var i=0;i<ins.hunguData[this.roleId].items[pos].hunyu.length;i++){var lv=ins.hunguData[this.roleId].items[pos].hunyu[i];var hyequip=GlobalConfig.HunYuEquip[hyT][lv];if(hyequip){power+=UserBag.getAttrPower(hyequip.attrs,SubRoles.ins().getSubRoleByIndex(this.roleId));var expower=hyequip.expower?hyequip.expower:0;power+=expower}}}this.powerPanel0.setPower(power);var hyType=GlobalConfig.HunGuConf.hunyuType[pos][this.kong];if(this.currentState=="activation"){var config_8=GlobalConfig.HunYuEquip[hyType][1];var costYb=GlobalConfig.HunGuConf.unlockCost[this.kong];var color=ColorUtil.RED_COLOR_N;if(!this.kong&&config_8.cost){this.actRMB=false;costYb=config_8.cost.count;var itemData=UserBag.ins().getBagItemById(config_8.cost.id);var myCount=itemData?itemData.count:0;if(myCount>=costYb)color=373044;this.icon0.source=GlobalConfig.ItemConfig[config_8.cost.id].icon+"_png";this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1(i18n("HunyuWin_12",color,myCount,costYb))}else{this.actRMB=true;this.icon0.source="szyuanbao";if(Actor.yb>=costYb)color=373044;this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1(i18n("HunyuWin_13",color,Actor.yb,costYb))}this.name0.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[hyType][1].name);this.att0.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[hyType][1].attrs,1)}else if(this.currentState=="max"){var lv=ins.hunguData[this.roleId].items[pos].hunyu[this.kong];this.name1.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[hyType][lv].name);this.att1.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[hyType][lv].attrs,1)}else{var lv=ins.hunguData[this.roleId].items[pos].hunyu[this.kong];this.curname.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[hyType][lv].name);this.curAtt0.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[hyType][lv].attrs,1);this.nextname.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[hyType][lv+1].name);this.nextAtt0.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[hyType][lv+1].attrs,1);var hycfg=Hungu.ins().getNextHunyuLvConfig(this.roleId,pos,this.kong);if(hycfg){var color=ColorUtil.RED_COLOR_N;var total=hycfg.cost.count;var itemData=UserBag.ins().getBagItemById(hycfg.cost.id);var curCount=itemData?itemData.count:0;if(curCount>=total)color=ColorUtil.GREEN_COLOR_N;this.countLabel1.textFlow=TextFlowMaker.generateTextFlow1(i18n("HunyuWin_14",color,curCount,total));this.icon1.source=GlobalConfig.ItemConfig[hycfg.cost.id].icon+"_png"}}};HunyuWin.prototype.hide=function(){var equipItem=this["equip"];var itemIcon=equipItem.itemIcon;equipItem.level.visible=false;for(var i=0;i<GlobalConfig.HunGuConf.hunyuCount;i++){var hyequipItem=this["equip"+i];itemIcon=hyequipItem.itemIcon;hyequipItem.level.visible=false}};HunyuWin.prototype.updateAct=function(){var ins=Hungu.ins();var config=GlobalConfig.ItemConfig[this.itemId];var pos=ItemConfig.getSubType(config);if(!ins.hunguData[this.roleId]||!ins.hunguData[this.roleId].items[pos].hunyu[this.kong]){this.currentState="activation"}else{var hyType=GlobalConfig.HunGuConf.hunyuType[pos][this.kong];var lv=ins.hunguData[this.roleId].items[pos].hunyu[this.kong];if(lv>=CommonUtils.getObjectLength(GlobalConfig.HunYuEquip[hyType])){this.currentState="max"}else{this.currentState="upgrade"}}this.validateNow()};HunyuWin.prototype.onTap=function(e){switch(e.currentTarget){case this.executeBtn0:if(this.currentState=="activation"){if(this.actRMB){var needYb=GlobalConfig.HunGuConf.unlockCost[this.kong];if(Actor.yb>=needYb){var config=GlobalConfig.ItemConfig[this.itemId];var pos=ItemConfig.getSubType(config);Hungu.ins().sendHunyu(this.roleId,pos,this.kong+1)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("HunyuWin_4"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("HunyuWin_5"))}}else{var cfg=GlobalConfig.ItemConfig[this.itemId];var ps=ItemConfig.getSubType(cfg);var hyt=GlobalConfig.HunGuConf.hunyuType[ps][this.kong];var hyeq=GlobalConfig.HunYuEquip[hyt][1];var itemData=UserBag.ins().getBagItemById(hyeq.cost.id);var myCount=itemData?itemData.count:0;if(myCount>=hyeq.cost.count){Hungu.ins().sendHunyu(this.roleId,ps,this.kong+1)}else{UserTips.ins().showTips(i18n("HunyuWin_6"))}}}else{UserTips.ins().showTips(i18n("HunyuWin_7"))}break;case this.executeBtn:if(this.currentState=="upgrade"){var config=GlobalConfig.ItemConfig[this.itemId];var pos=ItemConfig.getSubType(config);var hyequip=Hungu.ins().getNextHunyuLvConfig(this.roleId,pos,this.kong);if(hyequip&&hyequip.cost){var itemData=UserBag.ins().getBagItemById(hyequip.cost.id);var mycount=itemData?itemData.count:0;if(mycount>=hyequip.cost.count){Hungu.ins().sendHunyu(this.roleId,pos,this.kong+1)}else{UserTips.ins().showTips(i18n("HunyuWin_8"))}}else{UserTips.ins().showTips(i18n("HunyuWin_9"))}}else{UserTips.ins().showTips(i18n("HunyuWin_10"))}break;case this.getItemTxt0:if(this.currentState=="upgrade"){var config=GlobalConfig.ItemConfig[this.itemId];var pos=ItemConfig.getSubType(config);var hyType=GlobalConfig.HunGuConf.hunyuType[pos][this.kong];var lv=Hungu.ins().hunguData[this.roleId].items[pos].hunyu[this.kong];var hyequip=GlobalConfig.HunYuEquip[hyType][lv+1];if(hyequip&&hyequip.cost){UserWarn.ins().setBuyGoodsWarn(hyequip.cost.id)}}else{UserTips.ins().showTips(i18n("HunyuWin_11"))}break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};return HunyuWin}(BaseEuiView);__reflect(HunyuWin.prototype,"HunyuWin");ViewManager.ins().reg(HunyuWin,LayerManager.UI_Main);var Invest=function(_super){__extends(Invest,_super);function Invest(){var _this=_super.call(this)||this;_this.sysId=PackageID.FuliHongbao;_this.regNetMsg(1,_this.postInvestmentInfo);_this.regNetMsg(2,_this.postInvestmentReward);return _this}Invest.prototype.postInvestmentInfo=function(bytes){this.isInvestLv=bytes.readBoolean();this.isInvestLogin=bytes.readBoolean();this.investLoginReward=bytes.readInt();this.investLvReward=bytes.readInt();this.isTodayLoginReward=bytes.readBoolean();this.isInvestNewLogin=bytes.readBoolean();this.isTodayNewLoginReward=bytes.readBoolean();this.investNewLoginReward=bytes.readInt();this.isOpenNewLogin=bytes.readInt()};Invest.prototype.sendInvestmentReward=function(type,level_id){var bytes=this.getBytes(2);bytes.writeByte(type);if(type==2){bytes.writeShort(level_id)}this.sendToServer(bytes)};Invest.prototype.postInvestmentReward=function(bytes){this.errid=bytes.readInt();this.errmsg=bytes.readString();if(this.errid==1){UserTips.ins().showTips(this.errmsg)}};Invest.prototype.isHadInvestLogin=function(){return this.isInvestLogin};Invest.prototype.isHadInvestLevel=function(){return this.isInvestLv};Invest.prototype.isHadInvestNewLogin=function(){return this.isHadGetAllLoginReward()&&this.isInvestNewLogin};Invest.prototype.isOpenNewLoginInvest=function(){return this.isOpenNewLogin};Invest.prototype.isHaveLoginReward=function(){return!this.isHadGetAllLoginReward()&&!this.isTodayLoginReward};Invest.prototype.isHaveNewLoginReward=function(){return this.isHadGetAllLoginReward()&&this.isHadInvestNewLogin()&&!this.isTodayNewLoginReward};Invest.prototype.isHaveLevelReward=function(){var LevelInvestConfig=GlobalConfig.LevelInvestConfig;var investLvReward=this.investLvReward;for(var k in LevelInvestConfig){if(LevelInvestConfig[k]["reward"]){var data=LevelInvestConfig[k];if(data["levelLimit"]){if(Actor.level>=data["levelLimit"]){if(data["id"]&&!(investLvReward>>data["id"]&1)){return true}}}else if(data["zsLevelLimit"]){if(UserZs.ins().lv>=data["zsLevelLimit"]){if(data["id"]&&!(investLvReward>>data["id"]&1)){return true}}}}}return false};Invest.prototype.isReachMaxLevel=function(){var LevelInvestConfig=GlobalConfig.LevelInvestConfig;var investLvReward=this.investLvReward;for(var k in LevelInvestConfig){if(LevelInvestConfig[k]["reward"]){var data=LevelInvestConfig[k];if(data["levelLimit"]){if(Actor.level<data["levelLimit"]){return false}}else if(data["zsLevelLimit"]){if(UserZs.ins().lv<data["zsLevelLimit"]){return false}}}}return true};Invest.prototype.isHadGetAllLoginReward=function(){return this.investLoginReward>=Invest.EIGHT_DAYS};Invest.prototype.isHadGetAllNewLoginReward=function(){return this.isHadGetAllLoginReward()&&this.investNewLoginReward>=Invest.THIRTY_DAYS};Invest.prototype.isHadGetAllLevelReward=function(){return this.isReachMaxLevel()&&!this.isHaveLevelReward()};Invest.prototype.isShowNewLoginInvest=function(){return this.isOpenNewLoginInvest()&&this.isHadGetAllLoginReward()};Invest.EIGHT_DAYS=8;Invest.THIRTY_DAYS=30;return Invest}(BaseSystem);__reflect(Invest.prototype,"Invest");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.invest=Invest.ins.bind(Invest)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var DaysReturnItem=function(_super){__extends(DaysReturnItem,_super);function DaysReturnItem(){var _this=_super.call(this)||this;_this.skinName="daysReturnItemSkin";_this.itemList.itemRenderer=ItemBase;return _this}DaysReturnItem.prototype.dataChanged=function(){if(!this.data)return;this.initShow();this.updateShow()};DaysReturnItem.prototype.initShow=function(){this.getTxt.visible=false;this.redPoint.visible=false;this.dayText.visible=true;this.dayText.text=""+(this.itemIndex+1);this.day.visible=true;this.bg.source="detailbg";this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGetLoginReward,this);this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGetNewLoginReward,this)};DaysReturnItem.prototype.updateShow=function(){var ins=Invest.ins();if(ins.investLoginReward<Invest.EIGHT_DAYS){if(this.itemIndex==ins.investLoginReward&&ins.isInvestLogin){if(!ins.isTodayLoginReward){this.redPoint.visible=true;this.addEventListener(egret.TouchEvent.TOUCH_END,this.onGetLoginReward,this)}}else if(this.itemIndex<ins.investLoginReward){this.showHadGetStatus()}}else if(ins.isShowNewLoginInvest()&&ins.isInvestNewLogin){if(this.itemIndex==ins.investNewLoginReward){if(!ins.isTodayNewLoginReward){this.redPoint.visible=true;this.addEventListener(egret.TouchEvent.TOUCH_END,this.onGetNewLoginReward,this)}}else if(this.itemIndex<ins.investNewLoginReward){this.showHadGetStatus()}}this.setItemListData()};DaysReturnItem.prototype.showHadGetStatus=function(){this.getTxt.visible=true;this.bg.source="detailbg2";this.dayText.visible=false;this.day.visible=false};DaysReturnItem.prototype.setItemListData=function(){if(this.data["reward"]){this.itemList.dataProvider=new eui.ArrayCollection(this.data["reward"])}};DaysReturnItem.prototype.onGetLoginReward=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}var ins=Invest.ins();if(ins.isHadInvestLogin()){ins.sendInvestmentReward(1)}else UserTips.ins().showTips(i18n("DaysReturnItem_0"))};DaysReturnItem.prototype.onGetNewLoginReward=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}var ins=Invest.ins();if(ins.isHadInvestNewLogin()){ins.sendInvestmentReward(3)}else UserTips.ins().showTips(i18n("DaysReturnItem_1"))};return DaysReturnItem}(BaseItemRender);__reflect(DaysReturnItem.prototype,"DaysReturnItem");var InvestWin=function(_super){__extends(InvestWin,_super);function InvestWin(){var _this=_super.call(this)||this;_this.loginPrice=98;_this.levelPrice=118;_this.newLoginPrice=188;_this.curShowIndex=0;_this.SHOWINDEX_LOGIN_INVEST=0;_this.SHOWINDEX_LEVEL_INVEST=1;_this.SHOWINDEX_NEW_LOGIN_INVEST=2;_this.isTopLevel=true;_this.skinName="investSkin";return _this}InvestWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var ins=Invest.ins();this.addTouchEvent(this.closeBtn,this.close);this.addTouchEvent(this.daysIcon,this.onTap);this.addTouchEvent(this.levelIcon,this.onTap);this.observe(ins.postInvestmentInfo,this.updateShow);this.observe(ins.postInvestmentReward,this.updateShow);this.initWin();this.initLists();this.updateShow()};InvestWin.prototype.initWin=function(){var ins=Invest.ins();this.curShowIndex=ins.isShowNewLoginInvest()?this.SHOWINDEX_NEW_LOGIN_INVEST:this.SHOWINDEX_LOGIN_INVEST;this.daysIcon.visible=true;this.levelIcon.visible=true};InvestWin.prototype.initLists=function(){var daysList=this.daysList;daysList.dataProvider=new eui.ArrayCollection([]);daysList.itemRenderer=DaysReturnItem;var levelList=this.levelList;levelList.dataProvider=new eui.ArrayCollection([]);levelList.itemRenderer=LevelReturnItem};InvestWin.prototype.onTap=function(e){if(!e)return;SoundUtil.ins().playEffect(SoundUtil.WINDOW);var ins=Invest.ins();switch(e.currentTarget){case this.daysIcon:this.curShowIndex=ins.isShowNewLoginInvest()?this.SHOWINDEX_NEW_LOGIN_INVEST:this.SHOWINDEX_LOGIN_INVEST;this.updateShow();break;case this.levelIcon:this.curShowIndex=this.SHOWINDEX_LEVEL_INVEST;this.updateShow();break}};InvestWin.prototype.updateShow=function(){var showIndex=this.curShowIndex;this.updateInvestImg(showIndex);this.setInvestInfo(showIndex);this.setListsData();this.setVisibleOfIconRedPoint();this.setVisibleOfIconGroup()};InvestWin.prototype.updateInvestImg=function(showIndex){if(showIndex==this.SHOWINDEX_LOGIN_INVEST){this.setInvestImg(false,this.loginPrice,"biaoti_shibeifanli2",true)}else if(showIndex==this.SHOWINDEX_LEVEL_INVEST){this.setInvestImg(true,this.levelPrice,"biaoti_shibeishengji",true)}else if(showIndex==this.SHOWINDEX_NEW_LOGIN_INVEST){this.setInvestImg(false,this.newLoginPrice,"",false)}};InvestWin.prototype.setInvestImg=function(isLevel,price,fanLiSrc,isShowFanLi){var investCntImg="biaoti_touzi";var yuanbaoImg="biaoti_lijihuode";this.daysScroller.visible=!isLevel;this.daysSelectBg.visible=!isLevel;this.investCntImg.source=investCntImg+price;this.yuanbaoImg.source=yuanbaoImg+price;this.fanliImg.source=fanLiSrc;this.fanliImg.visible=isShowFanLi;this.levelSelectBg.visible=isLevel;this.levelScroller.visible=isLevel;if(price==this.newLoginPrice){this.daysIcon.source="zjmsanshiri"}};InvestWin.prototype.setInvestInfo=function(showIndex){var ins=Invest.ins();var price=0;var price1=0;var isInvested=false;if(showIndex==this.SHOWINDEX_LOGIN_INVEST){price=this.loginPrice;price1=450;isInvested=ins.isHadInvestLogin()}else if(showIndex==this.SHOWINDEX_LEVEL_INVEST){price=this.levelPrice;price1=540;isInvested=ins.isHadInvestLevel()}else if(showIndex==this.SHOWINDEX_NEW_LOGIN_INVEST){price=this.newLoginPrice;price1=840;isInvested=ins.isHadInvestNewLogin()}if(isInvested){this.investCnt.text=i18n("InvestWin_0");this.investPoint.visible=false;this.removeTouchEvent(this.investCnt,this.onInvest)}else{this.investCnt.text=i18n("InvestWin_1")+price+i18n("InvestWin_2");if(ChannelMgr.ins().isAnQiGeChannel()){this.investCnt.text=i18n("InvestWin_3",price1)}this.investPoint.visible=true;this.addTouchEvent(this.investCnt,this.onInvest)}};InvestWin.prototype.setListsData=function(){var ins=Invest.ins();var daysArr=[];this.daysList.itemRenderer=DaysReturnItem;var LoginConfig={};if(ins.isShowNewLoginInvest()){LoginConfig=GlobalConfig.AfterLoginInvestConfig}else{LoginConfig=GlobalConfig.LoginInvestConfig}for(var k in LoginConfig){if(LoginConfig[k]["reward"]){daysArr.push(LoginConfig[k])}}var dataProvider1=this.daysList.dataProvider;dataProvider1.replaceAll(daysArr);var levelArr0=[];var levelArr1=[];var levelArr2=[];var levelArr3=[];this.levelList.itemRenderer=LevelReturnItem;var LevelInvestConfig=GlobalConfig.LevelInvestConfig;var invest=Invest.ins();var investLvReward=invest.investLvReward;var curLevel=Actor.level;var curZsLevel=UserZs.ins().lv;var investLv=invest.isHadInvestLevel();for(var k in LevelInvestConfig){var cfg=LevelInvestConfig[k];if(cfg.reward){var canGet=false;if(cfg.levelLimit!=null){canGet=curLevel>=cfg.levelLimit}else{canGet=curZsLevel>=cfg.zsLevelLimit}if(canGet){if(investLv){if(!(investLvReward>>cfg.id&1)){levelArr0.push(cfg)}else if(investLvReward>0){levelArr3.push(cfg)}}else{levelArr1.push(cfg)}}else{levelArr2.push(cfg)}}}function cmpLIC(c1,c2){if(c1.levelLimit!=null&&c2.zsLevelLimit!=null){return-1}else if(c1.zsLevelLimit!=null&&c2.levelLimit!=null){return 1}else if(c1.zsLevelLimit!=null&&c2.zsLevelLimit!=null){return c1.zsLevelLimit-c2.zsLevelLimit}else if(c1.levelLimit!=null&&c2.levelLimit!=null){return c1.levelLimit-c2.levelLimit}return 0}levelArr1.sort(cmpLIC);levelArr2.sort(cmpLIC);levelArr3.sort(cmpLIC);levelArr0=levelArr0.concat(levelArr1,levelArr2,levelArr3);var dataProvider2=this.levelList.dataProvider;dataProvider2.replaceAll(levelArr0)};InvestWin.prototype.setVisibleOfIconGroup=function(){var ins=Invest.ins();this.levelGroup.visible=!ins.isHadGetAllLevelReward();if(ins.isHadGetAllLoginReward()&&ins.isHadGetAllNewLoginReward()){this.loginGroup.visible=false;this.levelGroup.x=0}else{this.loginGroup.visible=true;this.levelGroup.x=100}};InvestWin.prototype.setVisibleOfIconRedPoint=function(){var ins=Invest.ins();this.daysPoint.visible=!ins.isHadInvestLogin()||ins.isHaveLoginReward()||ins.isHaveNewLoginReward()||ins.investLoginReward>=Invest.EIGHT_DAYS&&!ins.isInvestNewLogin;this.levelPoint.visible=!ins.isHadInvestLevel()||ins.isHaveLevelReward()};InvestWin.prototype.onInvest=function(){var id=-1;if(this.curShowIndex==this.SHOWINDEX_LOGIN_INVEST){id=1003}else if(this.curShowIndex==this.SHOWINDEX_LEVEL_INVEST){id=1004}else if(this.curShowIndex==this.SHOWINDEX_NEW_LOGIN_INVEST){id=1005}if(id>0){Recharge.ins().showReCharge(id)}};InvestWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!OpenSystem.ins().checkSysOpen(SystemType.CHAOZHIHOUHUI)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.CHAOZHIHOUHUI));return false}if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("VipWin_13"));return false}return true};InvestWin.prototype.close=function(){this.removeTouchEvent(this.closeBtn,this.close);this.removeTouchEvent(this.daysIcon,this.onTap);this.removeTouchEvent(this.levelIcon,this.onTap);this.removeTouchEvent(this.investCnt,this.onInvest);this.removeObserve();TimerManager.ins().removeAll(this);ViewManager.ins().close(InvestWin)};return InvestWin}(BaseEuiView);__reflect(InvestWin.prototype,"InvestWin");ViewManager.ins().reg(InvestWin,LayerManager.UI_Main);var LevelReturnItem=function(_super){__extends(LevelReturnItem,_super);function LevelReturnItem(){var _this=_super.call(this)||this;_this.skinName="levelReturnItemSkin";_this.itemList.itemRenderer=ItemBase;return _this}LevelReturnItem.prototype.dataChanged=function(){if(!this.data)return;this.initShow();this.updateShow()};LevelReturnItem.prototype.initShow=function(){this.redPoint.visible=false;this.levelTxt.text="";this.getImg.source="btn60";this.getTxt.text=i18n("LevelReturnItem_0");this.biaotiImg.source="";this.biaotiImg.scaleX=1;this.biaotiImg.scaleY=1;this.getTxt.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGetLevelReward,this);this.getTxt.removeEventListener(egret.TouchEvent.TOUCH_END,this.onInvest,this)};LevelReturnItem.prototype.updateShow=function(){var curLevel=0;var getLevel=0;if(this.data["levelLimit"]){curLevel=Actor.level;getLevel=this.data["levelLimit"];this.levelShow()}else if(this.data["zsLevelLimit"]){curLevel=UserZs.ins().lv;getLevel=this.data["zsLevelLimit"];this.zslevelShow()}this.setStatus(curLevel,getLevel);this.setItemListData()};LevelReturnItem.prototype.levelShow=function(){this.biaotiImg.source="biaoti_mianfeilingqu";this.levelTxt.text=""+this.data["levelLimit"]};LevelReturnItem.prototype.zslevelShow=function(){this.biaotiImg.scaleX=1.05;this.biaotiImg.scaleY=1.1;this.biaotiImg.source="biaoti_mianfeilingqu2";this.levelTxt.text=""+this.data["zsLevelLimit"]};LevelReturnItem.prototype.setStatus=function(curLevel,getLevel){var ins=Invest.ins();var investLvReward=ins.investLvReward;if(curLevel>=getLevel){this.redPoint.visible=true;if(ins.isHadInvestLevel()){if(!(investLvReward>>this.data["id"]&1)){this.getTxt.addEventListener(egret.TouchEvent.TOUCH_END,this.onGetLevelReward,this)}else if(investLvReward>0){this.redPoint.visible=false;this.getTxt.text=i18n("LevelReturnItem_1");this.getImg.source="btn62"}}else{this.getTxt.addEventListener(egret.TouchEvent.TOUCH_END,this.onInvest,this)}}else{this.getTxt.text=i18n("LevelReturnItem_2");this.getImg.source="btn62"}};LevelReturnItem.prototype.setItemListData=function(){if(this.data["reward"]){var arr=[];var reward=this.data["reward"];for(var k=0;k<reward.length;++k){if(reward[k].job){var role=SubRoles.ins().getSubRoleByIndex(0);if(reward[k].job==role.job){arr.push(reward[k]);break}}else{arr.push(reward[k])}}this.itemList.dataProvider=new eui.ArrayCollection(arr)}};LevelReturnItem.prototype.onGetLevelReward=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}var ins=Invest.ins();var level_id=this.data["id"]!=null?this.data["id"]:-1;if(ins.isHadInvestLevel()&&level_id>0){ins.sendInvestmentReward(2,level_id)}else UserTips.ins().showTips(i18n("LevelReturnItem_3"))};LevelReturnItem.prototype.onInvest=function(){var id=1004;Recharge.ins().showReCharge(id)};return LevelReturnItem}(BaseItemRender);__reflect(LevelReturnItem.prototype,"LevelReturnItem");var Invite=function(_super){__extends(Invite,_super);function Invite(){var _this=_super.call(this)||this;_this.isHadReq=false;_this.bind_promoter_bonus="bind_promoter_bonus";_this.sysId=PackageID.Promote;_this.regNetMsg(1,_this.postBindInviter);_this.regNetMsg(2,_this.postInviteInfo);return _this}Invite.ins=function(){return _super.ins.call(this)};Invite.prototype.sendBindInviter=function(inviteID){var bytes=this.getBytes(1);bytes.writeString(inviteID);this.sendToServer(bytes)};Invite.prototype.postBindInviter=function(bytes){this.errid=bytes.readInt();this.msg=bytes.readString()};Invite.prototype.sendInviteInfoReq=function(){var bytes=this.getBytes(2);this.sendToServer(bytes)};Invite.prototype.postInviteInfo=function(bytes){this.enable=bytes.readInt();if(this.enable==1){this.is_bind_invite=bytes.readInt();if(this.is_bind_invite==0){this.is_inviter=bytes.readInt();if(this.is_inviter==1){this.children=bytes.readInt();this.amount=bytes.readInt();this.level=bytes.readInt();this.invite_manage_url=bytes.readString();this.invite_id=bytes.readString()}}}};Invite.prototype.getInviteReward=function(){var arr=[];var PromoteConfig=GlobalConfig.PromoteConfig;if(PromoteConfig[this.bind_promoter_bonus]){arr=PromoteConfig[this.bind_promoter_bonus]}return arr};return Invite}(BaseSystem);__reflect(Invite.prototype,"Invite");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.invite=Invite.ins.bind(Invite)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var InviteInfoItem1=function(_super){__extends(InviteInfoItem1,_super);function InviteInfoItem1(){var _this=_super.call(this)||this;_this.skinName="inviterItemSkin1";return _this}InviteInfoItem1.prototype.dataChanged=function(){if(!this.data)return;this.num.text=this.data+"%";this.level.text=this.itemIndex+1+""};return InviteInfoItem1}(BaseItemRender);__reflect(InviteInfoItem1.prototype,"InviteInfoItem1");var InviteInfoItem2=function(_super){__extends(InviteInfoItem2,_super);function InviteInfoItem2(){var _this=_super.call(this)||this;_this.skinName="inviterItemSkin2";return _this}InviteInfoItem2.prototype.dataChanged=function(){if(!this.data)return;this.level.text=""+(this.itemIndex+1);if(this.data&&this.data.amount){this.num1.text=this.data.amount+"";this.num2.text=this.data.children+""}};return InviteInfoItem2}(BaseItemRender);__reflect(InviteInfoItem2.prototype,"InviteInfoItem2");var InviteRewardWin=function(_super){__extends(InviteRewardWin,_super);function InviteRewardWin(){var _this=_super.call(this)||this;_this.skinName="inviteRewardSkin";return _this}InviteRewardWin.prototype.open=function(){this.addTouchEvent(this.sureBtn,this.close);this.list.itemRenderer=ItemBase;this.list.dataProvider=new eui.ArrayCollection(Invite.ins().getInviteReward());this.addTouchEvent(this.closeBtn,this.onClick)};InviteRewardWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};InviteRewardWin.prototype.close=function(){Invite.ins().is_bind_invite=1;_super.prototype.close.call(this);ViewManager.ins().close(InviteRewardWin)};return InviteRewardWin}(BaseEuiView);__reflect(InviteRewardWin.prototype,"InviteRewardWin");ViewManager.ins().reg(InviteRewardWin,LayerManager.UI_Popup);var inviterWin=function(_super){__extends(inviterWin,_super);function inviterWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="InviterSkin";return _this}inviterWin.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.close);this.addTouchEvent(this.checkBtn,this.onCheckBtn);Invite.ins().sendInviteInfoReq();this.observe(Invite.ins().postInviteInfo,this.updateData);this.list1.itemRenderer=InviteInfoItem1;this.list2.itemRenderer=InviteInfoItem2;var arr1=[];var arr2=[];var ProLvlCfg=GlobalConfig.PromoterLevelConfig;for(var i in ProLvlCfg){if(ProLvlCfg[i]&&ProLvlCfg[i].payback_rate){arr1.push(ProLvlCfg[i].payback_rate);arr2.push(ProLvlCfg[i])}}this.list1.dataProvider=new eui.ArrayCollection(arr1);this.list2.dataProvider=new eui.ArrayCollection(arr2)};inviterWin.prototype.onCheckBtn=function(){if(Invite.ins().invite_manage_url){console.log("invite_manage_url = "+Invite.ins().invite_manage_url);H5PayIFrameManager.ins().popIFrame(Invite.ins().invite_manage_url,"100%","100%","0%","0%",true,"90%","1%","10%","7%")}};inviterWin.prototype.updateData=function(){this.level.text=Invite.ins().level>0?Invite.ins().level+"":"";this.amount.text=Invite.ins().amount>0?Invite.ins().amount+"":"";this.children.text=Invite.ins().children>0?Invite.ins().children+"":""};inviterWin.prototype.close=function(){this.removeTouchEvent(this.closeBtn,this.close);_super.prototype.close.call(this);ViewManager.ins().close(inviterWin)};return inviterWin}(BaseEuiView);__reflect(inviterWin.prototype,"inviterWin");ViewManager.ins().reg(inviterWin,LayerManager.UI_Main);var WriteInviteIDWin=function(_super){__extends(WriteInviteIDWin,_super);function WriteInviteIDWin(){var _this=_super.call(this)||this;_this.promatTip=i18n("WriteInviteIDWin_0");_this.bind_promoter_bonus="bind_promoter_bonus";_this.skinName="WriteInviteIDSkin";return _this}WriteInviteIDWin.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.close);this.addTouchEvent(this.bgClose,this.close);this.addTouchEvent(this.sendBtn,this.sendInviteID);this.list.itemRenderer=ItemBase;this.input.prompt=this.promatTip;this.observe(Invite.ins().postBindInviter,this.postInviteID);this.list.dataProvider=new eui.ArrayCollection(Invite.ins().getInviteReward())};WriteInviteIDWin.prototype.sendInviteID=function(){if(this.input.text!=""&&this.input.text!=this.promatTip){Invite.ins().sendBindInviter(this.input.text)}else{UserTips.ins().showCenterTips(this.promatTip)}};WriteInviteIDWin.prototype.postInviteID=function(){if(Invite.ins().errid==0){ViewManager.ins().open(InviteRewardWin)}else{UserTips.ins().showCenterTips(Invite.ins().msg)}};WriteInviteIDWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.close);this.removeTouchEvent(this.closeBtn,this.close);_super.prototype.close.call(this);ViewManager.ins().close(WriteInviteIDWin)};return WriteInviteIDWin}(BaseEuiView);__reflect(WriteInviteIDWin.prototype,"WriteInviteIDWin");ViewManager.ins().reg(WriteInviteIDWin,LayerManager.UI_Popup);var KFBattleRedPoint=function(_super){__extends(KFBattleRedPoint,_super);function KFBattleRedPoint(){var _this=_super.call(this)||this;_this.redPoint1=0;_this.redPoint2=0;_this.redPoint=0;_this.associated(_this.postRedPoint1,WJBattlefieldSys.ins().postInfo);_this.associated(_this.postRedPoint2,KFBossRedpoint.ins().postRedPoint);_this.associated(_this.postRedPoint,_this.postRedPoint1,_this.postRedPoint2);return _this}KFBattleRedPoint.ins=function(){return _super.ins.call(this)};KFBattleRedPoint.prototype.postRedPoint1=function(){if(WJBattlefieldSys.ins().overCounts>0){this.redPoint1=1;return true}return false};KFBattleRedPoint.prototype.postRedPoint2=function(){this.redPoint2=KFBossRedpoint.ins().redpoint;return this.redPoint2};KFBattleRedPoint.prototype.postRedPoint=function(){this.redPoint=this.redPoint1+this.redPoint2;return this.redPoint};return KFBattleRedPoint}(BaseSystem);__reflect(KFBattleRedPoint.prototype,"KFBattleRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.kfBattleRedpoint=KFBattleRedPoint.ins.bind(KFBattleRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var KFServerSys=function(_super){__extends(KFServerSys,_super);function KFServerSys(){var _this=_super.call(this)||this;_this.isLinkingKF=false;_this.curServerType=ServerType.bsCommSrv;_this.isEnter=true;_this.sysId=PackageID.Login;_this.regNetMsg(9,_this.doSwitchServer);return _this}KFServerSys.ins=function(){return _super.ins.call(this)};KFServerSys.prototype.linkingKFState=function(value){this.isLinkingKF=value;if(value){ViewManager.ins().open(ServerSwitchIngWin)}else{ViewManager.ins().close(ServerSwitchIngWin)}};KFServerSys.prototype.doSwitchServer=function(bytes){var _this=this;this.kfSrvid=bytes.readInt();this.kfIp=bytes.readString();this.kfPort=bytes.readInt();this.kfLoginKey=bytes.readString();this.curServerType=bytes.readInt();this.linkingKFState(true);TimerManager.ins().doTimer(500,1,function(){_this.connectKFServer()},this)};Object.defineProperty(KFServerSys.prototype,"kfServerid",{get:function(){return this.kfSrvid},enumerable:true,configurable:true});KFServerSys.prototype.sendKFLogin=function(){var bytes=this.getBytes(9);bytes.writeInt(Actor.actorID);bytes.writeString(this.kfLoginKey);bytes.writeString(LocationProperty.pf);this.sendToServer(bytes)};Object.defineProperty(KFServerSys.prototype,"isKF",{get:function(){return this.curServerType>ServerType.bsCommSrv},enumerable:true,configurable:true});KFServerSys.prototype.connectKFServer=function(){GameSocket.ins().close();GameSocket.ins().newSocket();if(!GameSocket.ins().getSocket().connected){debug.log("kf connect to "+this.kfIp+" ,port: "+this.kfPort);GameSocket.ins().connect(this.kfIp,this.kfPort)}else{this.sendKFLogin()}WJBattlefieldSys.postSwitchServer()};KFServerSys.prototype.closeSocket=function(){this.curServerType=ServerType.bsCommSrv;this.kfSrvid=LocationProperty.srvid};KFServerSys.prototype.checkIsKFBattle=function(tips){if(this.isKF&&tips)UserTips.ins().showTips(tips);return this.isKF};return KFServerSys}(BaseSystem);__reflect(KFServerSys.prototype,"KFServerSys");var ServerType;(function(ServerType){ServerType[ServerType["bsCommSrv"]=0]="bsCommSrv";ServerType[ServerType["bsBattleSrv"]=1]="bsBattleSrv";ServerType[ServerType["bsMainBattleSrv"]=2]="bsMainBattleSrv";ServerType[ServerType["bsLianFuSrv"]=3]="bsLianFuSrv"})(ServerType||(ServerType={}));window["ServerType"]=ServerType;var KFData=function(){function KFData(){}return KFData}();__reflect(KFData.prototype,"KFData");var KFDropRecordData=function(){function KFDropRecordData(bytes){this.type=bytes.readShort();if(this.type==KFDropType.KF_BOSS){this.kfBossData(bytes)}else if(this.type==KFDropType.DEVILDOM){this.devildomData(bytes)}}KFDropRecordData.prototype.kfBossData=function(bytes){this.time=bytes.readInt();this.roleId=bytes.readInt();this.servId=bytes.readInt();this.nick=bytes.readString();this.sceneName=bytes.readString();this.bossName=bytes.readString();this.goodsId=bytes.readInt();this.time=Math.floor(DateUtils.formatMiniDateTime(this.time)/DateUtils.MS_PER_SECOND)};KFDropRecordData.prototype.devildomData=function(bytes){this.time=bytes.readInt();this.servId=bytes.readInt();this.guildName=bytes.readString();this.bossName=bytes.readString();this.goodsId=bytes.readInt();this.time=Math.floor(DateUtils.formatMiniDateTime(this.time)/DateUtils.MS_PER_SECOND)};return KFDropRecordData}();__reflect(KFDropRecordData.prototype,"KFDropRecordData");var KFDropType;(function(KFDropType){KFDropType[KFDropType["KF_BOSS"]=1]="KF_BOSS";KFDropType[KFDropType["DEVILDOM"]=2]="DEVILDOM"})(KFDropType||(KFDropType={}));window["KFDropType"]=KFDropType;var DevildomRedPoint=function(_super){__extends(DevildomRedPoint,_super);function DevildomRedPoint(){var _this=_super.call(this)||this;_this.redPoint=0;_this.redPoints=[];_this.associated(_this.postRedPoint,DevildomSys.ins().postBossInfo,DevildomSys.ins().postInfo);return _this}DevildomRedPoint.prototype.postRedPoint=function(){this.redPoint=0;var devildomSys=DevildomSys.ins();if(!devildomSys.isOpen())return;for(var id in devildomSys.killedState){this.redPoints[id]=!devildomSys.killedState[id]&&(!devildomSys.historyId||devildomSys.historyId==id)}this.redPoint=this.redPoints.indexOf(true)>-1?1:0};return DevildomRedPoint}(BaseSystem);__reflect(DevildomRedPoint.prototype,"DevildomRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.devildomRedPoint=DevildomRedPoint.ins.bind(DevildomRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var DevildomSys=function(_super){__extends(DevildomSys,_super);function DevildomSys(){var _this=_super.call(this)||this;_this.killedState=[];_this.refTime=[];_this.dropRecordDataList=[];_this.sysId=PackageID.Devildom;_this.regNetMsg(1,_this.postBossInfo);_this.regNetMsg(2,_this.postAscriptionChange);_this.regNetMsg(3,_this.postRevive);_this.regNetMsg(7,_this.doResult);_this.regNetMsg(8,_this.postInfo);_this.observe(GameLogic.ins().postEnterMap,function(){if(GameMap.fbType==UserFb.FB_TYPE_DEVILDOM_BOSS){_this.postEnterFb()}else if(GameMap.lastFbTyp==UserFb.FB_TYPE_DEVILDOM_BOSS){_this.postQuiKFb()}});_this.observe(UserBoss.ins().postBossAppear,function(){if(_this.isDevildomBattle)ViewManager.ins().open(BossBelongPanel)});return _this}DevildomSys.prototype.postBossInfo=function(bytes){var count=bytes.readShort();this.killedState=[];var refTime=[];for(var i=0;i<count;i++){var id=bytes.readShort();var time=bytes.readInt();var isKill=bytes.readBoolean();this.killedState[id]=isKill;refTime[id]=time}if(this.historyId&&this.refTime[this.historyId]&&refTime[this.historyId]!=this.refTime[this.historyId]){this.historyId=0}this.refTime=refTime.concat()};DevildomSys.prototype.postAscriptionChange=function(bytes){var oldHandle=bytes.readDouble();var nowHandle=bytes.readDouble();var oldName="";if(oldHandle>0){var oldChar=EntityManager.ins().getMasterList(oldHandle);if(oldChar&&oldChar[0]&&oldChar[0].infoModel){oldName=oldChar[0].infoModel.name}}UserBoss.ins().postBelongChange(nowHandle,oldHandle,oldName)};DevildomSys.prototype.postRevive=function(bytes){var cd=bytes.readInt();var killHandel=bytes.readDouble();if(cd>0)ViewManager.ins().open(DevildomReliveWin,cd,killHandel);else{ViewManager.ins().close(DevildomReliveWin);if(KFServerSys.ins().isKF){var yb=Actor.yb-GlobalConfig.CrossBossBase.rebornCost;Actor.ins().postYbChange(yb)}}};DevildomSys.prototype.doResult=function(bytes){var name=bytes.readString();var handel=bytes.readDouble();var isBelong=bytes.readBoolean();var len=bytes.readShort();var listReward=[];for(var i=0;i<len;i++){var awardData=new RewardData;awardData.type=bytes.readInt();awardData.id=bytes.readInt();awardData.count=bytes.readInt();listReward.push(awardData)}len=bytes.readShort();var saleListReward=[];for(var i=0;i<len;i++){var saleId=bytes.readInt();saleListReward.push(GlobalConfig.AuctionItem[saleId].item)}ViewManager.ins().open(DevildomResultWin,handel,name,isBelong,saleListReward,listReward)};DevildomSys.prototype.postInfo=function(bytes){this.historyId=bytes.readShort();var cd=bytes.readShort();this.enterCD=cd*1e3+egret.getTimer()};DevildomSys.prototype.sendClearReliveCD=function(){this.sendBaseProto(3)};DevildomSys.prototype.sendCleanBelong=function(){this.sendBaseProto(4)};DevildomSys.prototype.sendEnter=function(fbid){var bytes=this.getBytes(5);bytes.writeInt(fbid);this.sendToServer(bytes)};DevildomSys.prototype.postEnterFb=function(){this.isDevildomBattle=true};DevildomSys.prototype.postQuiKFb=function(){this.isDevildomBattle=false;ViewManager.ins().close(BossBelongPanel)};DevildomSys.prototype.isOpen=function(){return GameServer.serverOpenDay+1>=GlobalConfig.DevilBossBase.openDay&&this.isHfTerm()};DevildomSys.prototype.isHfTerm=function(){var hfTime=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime)+GlobalConfig.DevilBossBase.hefuTimeLimit*DateUtils.MS_PER_DAY;return GameServer.serverTime-hfTime>0};return DevildomSys}(BaseSystem);__reflect(DevildomSys.prototype,"DevildomSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.devildomSys=DevildomSys.ins.bind(DevildomSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var DevildomBossTab=function(_super){__extends(DevildomBossTab,_super);function DevildomBossTab(){return _super.call(this)||this}DevildomBossTab.prototype.dataChanged=function(){if(this.data.id){var devildomSys=DevildomSys.ins();this.itemIcon.source="invasion_boss_head"+(this.data.id-1);this.nameLabel.text=GlobalConfig.DevilBossConfig[this.data.id].bossName;this.redPoint.visible=DevildomRedPoint.ins().redPoints[this.data.id];this.state.visible=devildomSys.killedState[this.data.id]}};return DevildomBossTab}(BaseItemRender);__reflect(DevildomBossTab.prototype,"DevildomBossTab");var DevildomBossModel=function(_super){__extends(DevildomBossModel,_super);function DevildomBossModel(){return _super.call(this)||this}DevildomBossModel.prototype.getCurBossIdByIndex=function(index){var range=GlobalConfig.DevilBossConfig[index].openBossList;return range[0]||range[1]};DevildomBossModel.prototype.getCurFbIndex=function(){var devSys=DevildomSys.ins();if(devSys.historyId){return devSys.historyId-1}var idList=[];for(var id in devSys.killedState){if(!devSys.killedState[id])idList.push(id)}if(idList.length>0)return idList[MathUtils.limit(0,idList.length)>>0]-1;return MathUtils.limit(0,3)>>0};return DevildomBossModel}(BaseClass);__reflect(DevildomBossModel.prototype,"DevildomBossModel");var DevildomBelongAwardWin=function(_super){__extends(DevildomBelongAwardWin,_super);function DevildomBelongAwardWin(){var _this=_super.call(this)||this;_this.skinName="KFInvasionBelongSkin";return _this}DevildomBelongAwardWin.prototype.childrenCreated=function(){this.saleReward0.itemRenderer=ItemBase;this.belongReward0.itemRenderer=ItemBase};DevildomBelongAwardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.BG,this.onCloseWin);this.addTouchEvent(this.tipGroup1,this.onCloseWin);this.belongReward0.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.belongAwards));this.saleReward0.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.belongSaleAwards))};DevildomBelongAwardWin.prototype.onCloseWin=function(){ViewManager.ins().close(this)};return DevildomBelongAwardWin}(BaseEuiView);__reflect(DevildomBelongAwardWin.prototype,"DevildomBelongAwardWin");ViewManager.ins().reg(DevildomBelongAwardWin,LayerManager.UI_Popup);var DevildomBossAwardWin=function(_super){__extends(DevildomBossAwardWin,_super);function DevildomBossAwardWin(){var _this=_super.call(this)||this;_this.skinName="KFInvasionJiangLiTishiSkin";return _this}DevildomBossAwardWin.prototype.childrenCreated=function(){this.belongReward1.itemRenderer=ItemBase;this.saleReward1.itemRenderer=ItemBase;this.belongReward0.itemRenderer=ItemBase;this.saleReward0.itemRenderer=ItemBase};DevildomBossAwardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onCloseWin);this.addTouchEvent(this.giveUp,this.onCloseWin);this.belongReward1.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.belongAwards));this.saleReward1.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.belongSaleAwards));this.belongReward0.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.partAwards));this.saleReward0.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.partSaleAwards))};DevildomBossAwardWin.prototype.onCloseWin=function(){ViewManager.ins().close(this)};return DevildomBossAwardWin}(BaseEuiView);__reflect(DevildomBossAwardWin.prototype,"DevildomBossAwardWin");ViewManager.ins().reg(DevildomBossAwardWin,LayerManager.UI_Popup);var DevildomPartAwardWin=function(_super){__extends(DevildomPartAwardWin,_super);function DevildomPartAwardWin(){var _this=_super.call(this)||this;_this.skinName="KFInvasionPartSkin";return _this}DevildomPartAwardWin.prototype.childrenCreated=function(){this.saleReward.itemRenderer=ItemBase;this.belongReward.itemRenderer=ItemBase};DevildomPartAwardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.BG,this.onCloseWin);this.addTouchEvent(this.tipGroup0,this.onCloseWin);this.belongReward.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.partAwards));this.saleReward.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.partSaleAwards))};DevildomPartAwardWin.prototype.onCloseWin=function(){ViewManager.ins().close(this)};return DevildomPartAwardWin}(BaseEuiView);__reflect(DevildomPartAwardWin.prototype,"DevildomPartAwardWin");ViewManager.ins().reg(DevildomPartAwardWin,LayerManager.UI_Popup);var DevildomReliveWin=function(_super){__extends(DevildomReliveWin,_super);function DevildomReliveWin(){var _this=_super.call(this)||this;_this.remainM=0;return _this}DevildomReliveWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WorldBossGoldSkin";this.aliveNum=0};DevildomReliveWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.reliveBtn,this.onRelive);this.addTouchEvent(this.exitBtn,this.onTap);this.setWin(param[0],param[1])};DevildomReliveWin.prototype.setWin=function(cd,killerHandler){if(killerHandler>0){var killer=EntityManager.ins().getEntityByHandle(killerHandler);var str="";if(killer){var masterKiller=EntityManager.ins().getEntityByHandle(killer.infoModel.masterHandle);if(killer instanceof CharRole){str=killer.infoModel.name}else if(killer.infoModel.masterHandle&&masterKiller){str=""+masterKiller.infoModel.name}else{var boss=i18n("Boss_0");str=""+boss+killer.infoModel.name}}this.killTips.textFlow=TextFlowMaker.generateTextFlow1(i18n("DevildomReliveWin_0",2343978,str));this.alive.visible=false;if(this.alive.visible)this.alive.text=i18n("DevildomReliveWin_1",this.aliveNum)}this.reliveBtn.label=i18n("DevildomReliveWin_2",GlobalConfig.DevilBossBase.rebornCost);this.reliveTimesTxt.text=cd+i18n("DevildomReliveWin_3");this.remainM=cd;TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this)};DevildomReliveWin.prototype.refushLabel=function(){this.remainM--;this.reliveTimesTxt.text=this.remainM+i18n("DevildomReliveWin_4");if(this.remainM<0){TimerManager.ins().remove(this.refushLabel,this);this.overTime()}};DevildomReliveWin.prototype.overTime=function(){ViewManager.ins().close(this)};DevildomReliveWin.prototype.onTap=function(e){switch(e.currentTarget){case this.exitBtn:UserFb.ins().sendExitFb();break}};DevildomReliveWin.prototype.onRelive=function(e){if(this.aliveNum){DevildomSys.ins().sendClearReliveCD();return}if(GlobalFun.checkMoney(GlobalConfig.DevilBossBase.rebornCost,MoneyConst.yuanbao,i18n("DevildomReliveWin_5"))){DevildomSys.ins().sendClearReliveCD()}};return DevildomReliveWin}(BaseEuiView);__reflect(DevildomReliveWin.prototype,"DevildomReliveWin");ViewManager.ins().reg(DevildomReliveWin,LayerManager.UI_Popup);var DevildomResultWin=function(_super){__extends(DevildomResultWin,_super);function DevildomResultWin(){var _this=_super.call(this)||this;_this.quitTime=30;_this.skinName="KFInvasionResultSkin";return _this}DevildomResultWin.prototype.childrenCreated=function(){this.saleList.itemRenderer=ItemBase;this.rewardList.itemRenderer=ItemBase};DevildomResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onCloseWin);var winer=EntityManager.ins().getEntityByHandle(param[0]);if(winer){var info=winer.infoModel;var tname=info.name;tname=StringUtils.replaceStr(tname,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+"");this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(tname+"【"+info.guildName+"】");this.roleIcon.icon="yuanhead"+info.job+info.sex}else{this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(""+param[1])}this.roleIcon["jobImg"].visible=false;if(!param[2]){this.rewardLabel.text=i18n("DevildomResultWin_0")}var saleRewards=param[3];this.saleList.dataProvider=new eui.ArrayCollection(saleRewards);if(saleRewards.length==0)this.saleLabel.text=i18n("DevildomResultWin_1");var rewards=param[4];this.rewardList.dataProvider=new eui.ArrayCollection(rewards);TimerManager.ins().doTimer(1e3,this.quitTime+1,this.onTimer,this);this.onTimer()};DevildomResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this)};DevildomResultWin.prototype.onCloseWin=function(){ViewManager.ins().close(this);UserFb.ins().sendExitFb()};DevildomResultWin.prototype.onTimer=function(){this.closeBtn.label=i18n("DevildomResultWin_2",--this.quitTime);if(this.quitTime<=0){this.onCloseWin()}};return DevildomResultWin}(BaseEuiView);__reflect(DevildomResultWin.prototype,"DevildomResultWin");ViewManager.ins().reg(DevildomResultWin,LayerManager.UI_Popup);var DevildomWin=function(_super){__extends(DevildomWin,_super);function DevildomWin(){var _this=_super.call(this)||this;_this.MAX_LEN=4;_this.TAB_W=92;_this.mcScale=[1,.55,1,.8,1];_this.isTopLevel=true;_this.skinName="KFInvasionSkin";return _this}DevildomWin.prototype.initUI=function(){var tabLen=Object.keys(GlobalConfig.DevilBossConfig).length;this.leftGroup.visible=tabLen>this.MAX_LEN;this.rightGroup.visible=tabLen>this.MAX_LEN;this.refreshTime.text=GlobalConfig.DevilBossBase.startTime[0]+":"+GlobalConfig.DevilBossBase.startTime[1];this.bossBody=new MovieClip;this.bossBody.x=0;this.bossBody.y=0;this.bossGroup.addChild(this.bossBody);this.menuList.itemRenderer=DevildomBossTab;this.menuData=new eui.ArrayCollection;this.menuList.dataProvider=this.menuData};DevildomWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.seeRule,this.onTouch);this.addTouchEvent(this.challengeBtn,this.onTouch);this.addTouchEvent(this.belongBtn,this.onTouch);this.addTouchEvent(this.partBtn,this.onTouch);this.addTouchEvent(this.leftBtn,this.onTouch);this.addTouchEvent(this.rightBtn,this.onTouch);this.addChangeEvent(this.menuList,this.onChoose);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.observe(DevildomSys.ins().postBossInfo,this.initData);this.dataSys=DevildomSys.ins();var curIndex=!isNaN(param[0])?param[0]:0;this.menuList.selectedIndex=curIndex;this.selectBoss(curIndex)};DevildomWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};DevildomWin.prototype.initData=function(){this.menuData.replaceAll(CommonUtils.objectToArray(GlobalConfig.DevilBossConfig))};DevildomWin.prototype.onChange=function(){if(this.menuList.scrollH<20){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>(this.menuList.dataProvider.length-this.MAX_LEN)*88+2){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.menuList.dataProvider.length<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}};DevildomWin.prototype.onTouch=function(e){var _this=this;switch(e.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[38].text);break;case this.challengeBtn:var cd=(this.dataSys.enterCD-egret.getTimer())/1e3>>0;if(cd>0){UserTips.ins().showTips(i18n("DevildomWin_0",cd));return}var dp=GlobalConfig.DevilBossConfig[this.menuList.selectedItem.id];var zsLv=dp.levelLimit/1e3>>0;if(zsLv>UserZs.ins().lv){UserTips.ins().showTips(i18n("DevildomWin_1",zsLv));return}var lv=dp.levelLimit%1e3;if(lv>Actor.level){UserTips.ins().showTips(i18n("DevildomWin_2",lv));return}if(!DevildomSys.ins().historyId){WarnWin.show(i18n("DevildomWin_3"),function(){_this.dataSys.sendEnter(_this.menuList.selectedItem.id)},this)}else{if(DevildomSys.ins().historyId!=this.menuList.selectedItem.id){UserTips.ins().showTips(i18n("DevildomWin_4",GlobalConfig.DevilBossConfig[DevildomSys.ins().historyId].bossName));return}DevildomSys.ins().sendEnter(this.menuList.selectedItem.id)}break;case this.closeBtn:ViewManager.ins().close(this);break;case this.belongBtn:ViewManager.ins().open(DevildomBelongAwardWin);break;case this.partBtn:ViewManager.ins().open(DevildomPartAwardWin);break;case this.leftBtn:var num=this.TAB_W*this.MAX_LEN;var scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/this.TAB_W)*this.TAB_W;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:num=this.TAB_W*this.MAX_LEN;scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/this.TAB_W)*this.TAB_W;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}};DevildomWin.prototype.onChoose=function(e){this.selectBoss(this.menuList.selectedIndex)};DevildomWin.prototype.selectBoss=function(index){var curId=this.menuList.selectedItem.id;this.bossGroup.removeChildren();this.bossBody=new MovieClip;this.bossBody.x=0;this.bossBody.y=0;this.bossGroup.addChild(this.bossBody);if(curId==3){this.bossBody.x=20;this.bossBody.y=-10}if(curId==4){this.bossBody.x=30;this.bossBody.y=-10}if(curId==1){this.bossBody.x=10;this.bossBody.y=-25}if(curId==2){this.bossBody.x=10}this.bossBody.scaleX=this.bossBody.scaleY=this.mcScale[curId];var id=DevildomBossModel.ins().getCurBossIdByIndex(curId);var bossDp=GlobalConfig.MonstersConfig[id];var showBody="monster"+bossDp.avatar+"_3s";this.bossBody.playFile(RES_DIR_MONSTER+showBody,-1);this.bossName.source="invasion_boss_name"+index;this.challengeBtn.enabled=this.dataSys.killedState.length>0&&!this.dataSys.killedState[curId]};DevildomWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var boo=DevildomSys.ins().isOpen();if(!DevildomSys.ins().isHfTerm()){UserTips.ins().showTips(i18n("DevildomWin_6"))}else if(GameServer.serverOpenDay+1<GlobalConfig.DevilBossBase.openDay){UserTips.ins().showTips(i18n("DevildomWin_7"))}return boo};return DevildomWin}(BaseEuiView);__reflect(DevildomWin.prototype,"DevildomWin");ViewManager.ins().reg(DevildomWin,LayerManager.UI_Main);var KfArenaRedPoint=function(_super){__extends(KfArenaRedPoint,_super);function KfArenaRedPoint(){var _this=_super.call(this)||this;_this.redpoint_1=0;_this.redpoint_2=0;_this.redpoint_3=0;_this.associated(_this.postRedPoint,KfArenaSys.ins().postJoinRewards,KfArenaSys.ins().postPlayerInfo);return _this}KfArenaRedPoint.prototype.postRedPoint=function(){this.redpoint_1=this.redpoint_2=this.redpoint_3=this.redpoint=0;var ins=KfArenaSys.ins();if(!ins.isOpen())return 0;this.redpoint_1=ins.times>0&&ins.isStartIng!=0?ins.times:0;this.redpoint_2=ins.getJoinRedPoint();this.redpoint_3=ins.getDuanRedPoint();this.redpoint=this.redpoint_1+this.redpoint_2+this.redpoint_3;return this.redpoint};KfArenaRedPoint.ins=function(){return _super.ins.call(this)};return KfArenaRedPoint}(BaseSystem);__reflect(KfArenaRedPoint.prototype,"KfArenaRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.kfArenaRedPoint=KfArenaRedPoint.ins.bind(KfArenaRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var KfArenaSys=function(_super){__extends(KfArenaSys,_super);function KfArenaSys(){var _this=_super.call(this)||this;_this.isKFArena=false;_this.times=0;_this.duanLevel=0;_this.score=0;_this.leaderID=0;_this.inviteDataList=[];_this.worldTimeCd=0;_this.flagHandle=10011010110;_this.flagCD=0;_this.gotFirstFlag=false;_this.dailyState=-1;_this.dflCount=0;_this._openLeftTime=0;_this._openTimer=0;_this.isStartIng=0;_this.isClickInfoBtn=false;_this.square_width=4;_this.getWord="";_this.getWordOther="";_this.teamInfo=[];_this.enemyNameAndSvrid=[];_this.isShowing=false;_this.isSettedWord=false;_this.isSettedScore=false;_this.getScoreOther=0;_this.isAttackEnemy=false;_this.curCollecHandle=0;_this.isExitKFArena=false;_this.isShowMacthPanel=false;_this.flagPos={posY:20,posX:26};_this.point_type_relive=0;_this.point_type_flag=1;_this.isStopCollectFlag=true;_this.isFirst=true;_this.myRolesHandle=[];_this.sysId=PackageID.KfArena;_this.regNetMsg(1,_this.postPlayerInfo);_this.regNetMsg(2,_this.postTeamInfo);_this.regNetMsg(5,_this.postReceiveInvitation);_this.regNetMsg(7,_this.postBack);_this.regNetMsg(9,_this.postRefFlag);_this.regNetMsg(10,_this.doCollectFlag);_this.regNetMsg(11,_this.postRelive);_this.regNetMsg(13,_this.postFbInfo);_this.regNetMsg(14,_this.doResult);_this.regNetMsg(16,_this.postMacthState);_this.regNetMsg(17,_this.postChangeScore);_this.regNetMsg(19,_this.postDataInfo);_this.regNetMsg(20,_this.postKfArenaGuilds);_this.regNetMsg(21,_this.postNotice);_this.regNetMsg(23,_this.postJoinRewards);_this.regNetMsg(26,_this.postOpenKfArena);_this.regNetMsg(25,_this.postRank);_this.observe(GameLogic.ins().postEnterMap,_this.changeScene);return _this}KfArenaSys.prototype.sendCreateTeam=function(){this.sendBaseProto(1)};KfArenaSys.prototype.postPlayerInfo=function(bytes){this.times=bytes.readInt();this.duanLevel=bytes.readInt();this.score=bytes.readInt();if(!this.curMouth)this.curMouth=new kfArenaMark;this.curMouth.parse(bytes);if(!this.history)this.history=new kfArenaMark;this.history.parse(bytes)};KfArenaSys.prototype.sendPersonalMatch=function(){this.sendBaseProto(2)};KfArenaSys.prototype.postTeamInfo=function(bytes){this.leaderID=bytes.readInt();this.macthState=bytes.readInt();var len=bytes.readInt();var tfMembers=this.tfMembers||[];this.tfMembers=[];for(var i=0;i<len;i++){var vo=new KfArenaRoleVo;this.tfMembers[i]=vo;vo.parse(bytes)}this.isTFCaptain=Actor.actorID==this.leaderID;var roleIds=[];var memberNames=[];for(var _i=0,_a=this.tfMembers;_i<_a.length;_i++){var role1=_a[_i];var isNew=true;for(var _b=0,tfMembers_1=tfMembers;_b<tfMembers_1.length;_b++){var role2=tfMembers_1[_b];if(role1.roleID==role2.roleID){isNew=false;break}}if(isNew&&roleIds.indexOf(role1.roleID)==-1&&role1.roleName!=Actor.myName){memberNames.push(role1.roleName)}}if(memberNames.length&&!this.isFirst&&this.isTFCaptain){ViewManager.ins().open(kfReceiveInviteWin,memberNames);console.log("postTeamInfo memberNames ",memberNames)}this.isFirst=false};KfArenaSys.prototype.sendLeaveTeam=function(){this.sendBaseProto(3)};KfArenaSys.prototype.sendStartMacth=function(){this.sendBaseProto(4)};KfArenaSys.prototype.sendCancelMacth=function(){this.sendBaseProto(16)};KfArenaSys.prototype.sendGuilds=function(type){var bytes=this.getBytes(20);bytes.writeInt(type);this.sendToServer(bytes)};KfArenaSys.prototype.sendInvite=function(id){var bytes=this.getBytes(5);bytes.writeInt(id);this.sendToServer(bytes);this.postKfArenaDelID(id)};KfArenaSys.prototype.postKfArenaDelID=function(id){return id};KfArenaSys.prototype.postReceiveInvitation=function(bytes){var data=new KFInviteData;data.parse(bytes);if(!this.checkInviteByID(data.roleId))this.inviteDataList.push(data);if(this.inviteDataList.length>0)ViewManager.ins().open(kfReceiveInviteWin,0)};KfArenaSys.prototype.checkInviteByID=function(id){for(var i=0;i<this.inviteDataList.length;i++){if(this.inviteDataList[i].roleId==id)return true}return false};KfArenaSys.prototype.sendWorldInvite=function(){this.sendBaseProto(6)};KfArenaSys.prototype.sendRespondInvite=function(leaderId,state){var bytes=this.getBytes(7);bytes.writeInt(leaderId);bytes.writeInt(state);this.sendToServer(bytes)};KfArenaSys.prototype.postBack=function(bytes){var type=bytes.readInt();switch(type){case 1:ViewManager.ins().open(KfArenaWin,0);break}};KfArenaSys.prototype.postMacthState=function(bytes){this.macthState=bytes.readInt()};KfArenaSys.prototype.isKFMacthing=function(){return this.macthState==1&&this.isStartIng==1};KfArenaSys.prototype.postKfArenaGuilds=function(bytes){var type=bytes.readInt();var len=bytes.readInt();if(type==KFInviteType.Guild){this.guildDataList=[];for(var i=0;i<len;i++){var info=new GuildMemberInfo;info.parse(bytes);this.guildDataList.push(info)}}else if(type==KFInviteType.Friend){this.friendsDataList=[];for(var i=0;i<len;i++){var info=new GuildMemberInfo;info.parse(bytes);this.friendsDataList.push(info)}}return type};KfArenaSys.prototype.getDataList=function(type){var list=[];var temList;if(type==KFInviteType.Friend)temList=this.friendsDataList;else temList=this.guildDataList;if(!temList)return list;for(var i=0;i<temList.length;i++){if(temList[i].roleID==Actor.actorID)continue;var info=new GuildMemberInfo;info.copyData(temList[i]);list.push(info)}return list};KfArenaSys.prototype.sendJoinTeam=function(id){var bytes=this.getBytes(18);bytes.writeInt(id);this.sendToServer(bytes)};KfArenaSys.prototype.sendOutTeam=function(id){var bytes=this.getBytes(8);bytes.writeInt(id);this.sendToServer(bytes)};KfArenaSys.prototype.postRefFlag=function(bytes){var handle=bytes.readDouble();this.flagCD=bytes.readInt()*1e3+egret.getTimer();this.flagHandle=10011010110};KfArenaSys.prototype.doCollectFlag=function(bytes){var handle=bytes.readDouble();var lefttimer=bytes.readInt();this.curCollecHandle=handle;if(handle&&handle==Actor.handle&&lefttimer){ViewManager.ins().open(CollectWin,handle,0,lefttimer);GameLogic.ins().currAttackHandle=0}else ViewManager.ins().close(CollectWin)};KfArenaSys.prototype.sendCollectFlag=function(){this.isStopCollectFlag=false;if(this.isOnFlagPoint()){if(this.isTeamCollecting()){UserTips.ins().showTips(i18n("KfArenaSys_0",ColorUtil.GREEN_COLOR_N));return}else{this.sendBaseProto(10)}}else{this.sendBaseProto(10);TimerManager.ins().doTimer(500,0,this.checkIsMoveOnFlagPoint,this)}};KfArenaSys.prototype.checkIsMoveOnFlagPoint=function(){if(this.isStopCollectFlag){TimerManager.ins().remove(this.checkIsMoveOnFlagPoint,this);return}if(this.isOnFlagPoint()){TimerManager.ins().remove(this.checkIsMoveOnFlagPoint,this);if(this.isTeamCollecting()){UserTips.ins().showTips(i18n("KfArenaSys_1",ColorUtil.GREEN_COLOR_N));return}else{this.sendBaseProto(10)}}};KfArenaSys.prototype.isOnFlagPoint=function(){var myhandle=SubRoles.ins().getSubRoleByIndex(0).handle;return this.checkIsOnPoint(myhandle,this.point_type_flag,2)};KfArenaSys.prototype.isTeamCollecting=function(){if(!this.isCollecting(Actor.handle)&&TargetListCC.ins().isInMyCamp(this.myCampId,this.curCollecHandle)){return true}return false};KfArenaSys.prototype.isCollecting=function(handle){if(this.curCollecHandle==handle){return true}return false};KfArenaSys.prototype.postRelive=function(bytes){var cd=bytes.readInt();var handle=bytes.readDouble();if(cd>0){ViewManager.ins().open(KfArenaReliveWin,cd,handle)}else{ViewManager.ins().close(KfArenaReliveWin)}};KfArenaSys.prototype.postFbInfo=function(bytes){var time=bytes.readInt();this.myCampId=bytes.readByte();this.scoreA=bytes.readInt();this.scoreB=bytes.readInt();this.lastTime=bytes.readInt();this.kfReadyTime=time;this.kfLeftFightTime=this.kfReadyTime+this.lastTime;this.setPlayScore(this.scoreA,this.scoreB);ViewManager.ins().open(KfArenaFightWin);kfTransferEffMgr.ins().createTransfer()};KfArenaSys.prototype.getReadyTime=function(){return(DateUtils.formatMiniDateTime(this.kfReadyTime)-GameServer.serverTime)/DateUtils.MS_PER_SECOND>>0};KfArenaSys.prototype.getLeftFightTime=function(){return(DateUtils.formatMiniDateTime(this.kfLeftFightTime)-GameServer.serverTime)/DateUtils.MS_PER_SECOND>>0};KfArenaSys.prototype.doResult=function(bytes){var scoreA=bytes.readInt();var scoreB=bytes.readInt();this.winCamp=bytes.readShort();var len=bytes.readShort();var dtLit=[];for(var i=0;i<len;i++){var data=new KfArenaData(bytes);data.rank=i+1;dtLit.push(data)}var extAwards=[];len=bytes.readShort();for(var i=0;i<len;i++){var award=new RewardData;award.type=bytes.readInt();award.id=bytes.readInt();award.count=bytes.readInt();extAwards.push(award)}this.setPlayScore(scoreA,scoreB);dtLit=this.sortResultData(dtLit);ViewManager.ins().open(KfArenaResultWin,scoreB,scoreA,dtLit,extAwards)};KfArenaSys.prototype.sortResultData=function(dtLit){if(!dtLit||dtLit.length<=0)return dtLit;var myTeam=[];var enermyTeam=[];var teamRank=1;var enermyRank=1;for(var i=0;i<dtLit.length;++i){if(dtLit[i].camp==this.myCampId||this.isMySelf(dtLit[i].playerName,dtLit[i].servId)){dtLit[i]["rankNum"]=teamRank++;myTeam.push(dtLit[i])}else{dtLit[i]["rankNum"]=enermyRank++;enermyTeam.push(dtLit[i])}}if(dtLit[0].camp==this.myCampId||this.isMySelf(dtLit[0].playerName,dtLit[0].servId)){for(var i=0;i<enermyTeam.length;++i){myTeam.push(enermyTeam[i])}dtLit=myTeam}else{for(var i=0;i<myTeam.length;++i){enermyTeam.push(myTeam[i])}dtLit=enermyTeam}console.log("sortResultData listData:");console.log(dtLit);return dtLit};KfArenaSys.prototype.enterBattle=function(){this.sendBaseProto(15)};KfArenaSys.prototype.postChangeScore=function(bytes){var oldScoreA=this.scoreA;var oldScoreB=this.scoreB;this.scoreA=bytes.readInt();this.scoreB=bytes.readInt();this.setPlayScore(this.scoreA,this.scoreB);this.sendDataInfo(false);var getScoreA=this.scoreA-oldScoreA;var getScoreB=this.scoreB-oldScoreB;if(getScoreA>0){this.setGetScoreOther(getScoreA)}else if(getScoreB>0){this.setGetScoreOther(getScoreB)}};KfArenaSys.prototype.setGetScoreOther=function(getScoreOther){if(!this.isSettedScore){this.isSettedScore=true;this.getScoreOther=getScoreOther;this.showGetWordOther()}};KfArenaSys.prototype.setPlayScore=function(scoreA,scoreB){if(this.myCampId==1){this.teamScore=scoreA;this.enermyScore=scoreB}else{this.teamScore=scoreB;this.enermyScore=scoreA}};KfArenaSys.prototype.postDataInfo=function(bytes){var len=bytes.readShort();var rankDatas=[];for(var i=0;i<len;i++){var data=new KfArenaData;data.readRankData(bytes);rankDatas.push(data)}rankDatas=this.sortResultData(rankDatas);if(!ViewManager.ins().isShow(KfArenaInfoWin)&&this.isClickInfoBtn){this.isClickInfoBtn=false;ViewManager.ins().open(KfArenaInfoWin,rankDatas)}return rankDatas};KfArenaSys.prototype.sendDataInfo=function(isClickInfoBtn){if(isClickInfoBtn===void 0){isClickInfoBtn=true}this.isClickInfoBtn=isClickInfoBtn;this.sendBaseProto(19)};KfArenaSys.prototype.postNotice=function(bytes){if(this.isKFArena){this.showKfArenaNotice(new KfArenaNoticeData(bytes))}};KfArenaSys.prototype.isKfArenaNotice=function(str){if(str.indexOf(i18n("KfArenaSys_7").replace("|",""))>-1){return true}if(str.indexOf(i18n("KfArenaSys_8").replace("|",""))>-1){return true}if(str.indexOf(i18n("KfArenaSys_9").replace("|",""))>-1){return true}if(str.indexOf(i18n("KfArenaSys_10").replace("|",""))>-1){return true}if(str.indexOf(i18n("KfArenaSys_11").replace("|",""))>-1){return true}if(str.indexOf(i18n("KfArenaSys_12").replace("|",""))>-1){return true}return false};KfArenaSys.prototype.showKfArenaNotice=function(kfArenaNoticeData){if(!kfArenaNoticeData)return;var words={1:i18n("KfArenaSys_2"),2:i18n("KfArenaSys_3"),3:i18n("KfArenaSys_4"),4:i18n("KfArenaSys_5"),5:i18n("KfArenaSys_6")};var str="";var data=kfArenaNoticeData;var type=data.type;if(type==1){str=i18n("KfArenaSys_15")+SelectServerMgr.ins().getServerNameByID(data.servId)+"·"+data.name+i18n("KfArenaSys_7");this.setGetWord(data.name,data.servId,words[type]);this.setGetWordOther(data.name,data.servId,words[type]);this.gotFirstFlag=true}else if(type==2){str=i18n("KfArenaSys_16")+SelectServerMgr.ins().getServerNameByID(data.killerServId)+"·"+data.killerName+i18n("KfArenaSys_8")+i18n("KfArenaSys_17")+SelectServerMgr.ins().getServerNameByID(data.deadServId)+"·"+data.deadName+i18n("KfArenaSys_9");this.setGetWord(data.killerName,data.killerServId,words[type]);this.setGetWordOther(data.killerName,data.killerServId,words[type])}else if(type==3){str=i18n("KfArenaSys_18")+SelectServerMgr.ins().getServerNameByID(data.servId)+"·"+data.name+i18n("KfArenaSys_10");this.setGetWord(data.name,data.servId,words[type]);this.setGetWordOther(data.name,data.servId,words[type])}else if(type==4){str=i18n("KfArenaSys_19")+SelectServerMgr.ins().getServerNameByID(data.killerServId)+"·"+data.killerName+i18n("KfArenaSys_11")+i18n("KfArenaSys_20")+SelectServerMgr.ins().getServerNameByID(data.deadServId)+"·"+data.deadName+"！|";this.setGetWord(data.killerName,data.killerServId,words[type]);this.setGetWordOther(data.killerName,data.killerServId,words[type])}else if(type==5){str=i18n("KfArenaSys_21")+SelectServerMgr.ins().getServerNameByID(data.servId)+"·"+data.name+i18n("KfArenaSys_12");this.setGetWord(data.name,data.servId,words[type]);this.setGetWordOther(data.name,data.servId,words[type])}else{console.log("kfArenaSys showKfArenaNotice data");console.log(data)}if(str&&str!=""){ViewManager.ins().open(NoticeView).showNotice(str);Chat.ins().postSysChatMsg(new ChatSystemData(2,str))}};KfArenaSys.prototype.isMySelf=function(name,srvid){if(name==Actor.myName&&srvid==LocationProperty.srvid){return true}return false};KfArenaSys.prototype.setGetWord=function(name,srvid,word){if(!this.isShowing&&this.isMySelf(name,srvid)){this.isShowing=true;this.getWord=name+word}};KfArenaSys.prototype.setGetWordOther=function(name,srvid,word){if(!this.isSettedWord){this.isSettedWord=true;this.getWordOther=name+word;this.showGetWordOther()}};KfArenaSys.prototype.showGetWordOther=function(){if(this.isSettedWord&&this.isSettedScore){this.isSettedWord=false;this.isSettedScore=false;this.getWordOther+=i18n("KfArenaSys_13")+this.getScoreOther+i18n("KfArenaSys_14");Chat.ins().postSysChatMsg(new ChatSystemData(2,this.getWordOther))}};KfArenaSys.prototype.postRank=function(bytes){var count=bytes.readInt();if(count>0){this.rankDataList=[];for(var i=0;i<count;i++){this.rankDataList.push(new KfArenaRankData(bytes))}this.ownRank=bytes.readInt()}};KfArenaSys.prototype.sendRank=function(){this.sendBaseProto(25)};KfArenaSys.prototype.getIsJoinTeam=function(){return this.leaderID!=0};KfArenaSys.prototype.changeScene=function(){if(GameMap.fbType==UserFb.FB_TYPE_KF_ARENA){this.isKFArena=true;this.isExitKFArena=true;GameLogic.ins().refreshName()}else if(GameMap.lastFbTyp==UserFb.FB_TYPE_KF_ARENA){this.isKFArena=false;this.flagHandle=0;this.gotFirstFlag=false;ViewManager.ins().close(KfArenaFightWin);ViewManager.ins().close(KfArenaReliveWin);ViewManager.ins().open(NoticeView).removeFfArenaNotice()}console.log("KFArena isKFArena = "+this.isKFArena)};KfArenaSys.prototype.showMacthPanel=function(){if(this.isStartIng&&this.isShowMacthPanel&&!ViewManager.ins().isShow(KfArenaWin)){this.isShowMacthPanel=false;ViewManager.ins().open(KfArenaWin,0)}};KfArenaSys.prototype.checkForShowMacthPanel=function(){if(this.isExitKFArena){this.isExitKFArena=false;this.isShowMacthPanel=true;TimerManager.ins().doTimer(1e3,1,this.showMacthPanel,this)}};KfArenaSys.prototype.getDuanAwards=function(){var data=GlobalConfig.CrossArenaBase.everyDayAward;for(var i in data){if(data[i].metal==this.duanLevel){return data[i].award}}return null};KfArenaSys.prototype.getDuanName=function(isMy,score){if(isMy===void 0){isMy=true}if(score===void 0){score=0}var curScore=isMy?this.score:score;var scoreMetal=[];var metal=-1;if(GlobalConfig.CrossArenaBase.scoreMetal&&curScore>=0){scoreMetal=GlobalConfig.CrossArenaBase.scoreMetal;for(var i=1;i<scoreMetal.length;++i){if(scoreMetal[i-1]<=curScore&&curScore<scoreMetal[i]||i==scoreMetal.length-1&&scoreMetal[i]<=curScore){metal=i-1;break}}}return this.getDuanNameByIndex(metal)};KfArenaSys.prototype.getNextDuanInfo=function(score){if(score===void 0){score=0}score=score>0?score:this.score;var retObj={dname:"",num:-1};var scoreMetal=[];var metal=-1;if(GlobalConfig.CrossArenaBase.scoreMetal&&score>=0){scoreMetal=GlobalConfig.CrossArenaBase.scoreMetal;for(var i=1;i<scoreMetal.length;++i){if(scoreMetal[i-1]<=score&&score<scoreMetal[i]||i==scoreMetal.length-1&&scoreMetal[i]<=score){metal=i;break}}}var distnc=scoreMetal[metal]-score;retObj.num=distnc>0?distnc:0;retObj.dname=this.getDuanNameByIndex(metal);return retObj};KfArenaSys.prototype.getDuanNameByIndex=function(metal){var _scoreMetalDesc=GlobalConfig.CrossArenaBase["scoreMetalDesc"];if(_scoreMetalDesc){var scoreMetalDesc=_scoreMetalDesc.split("，");if(scoreMetalDesc.length<=1)scoreMetalDesc=_scoreMetalDesc.split(",");if(metal>-1&&metal<scoreMetalDesc.length&&scoreMetalDesc[metal]){return scoreMetalDesc[metal]+""}}return""};KfArenaSys.prototype.getDuanRewardByIndex=function(metal,showCnt){if(showCnt===void 0){showCnt=2}var mailId=0;var finalAward=GlobalConfig.CrossArenaBase["finalAward"]?GlobalConfig.CrossArenaBase["finalAward"]:[];if(finalAward&&metal>-1&&metal<finalAward.length&&finalAward[metal]){mailId=finalAward[metal]["mailID"]}var _attachment=[];if(GlobalConfig.MailIdConfig[mailId]&&GlobalConfig.MailIdConfig[mailId].attachment){var attachment=GlobalConfig.MailIdConfig[mailId].attachment;for(var i=0;i<attachment.length&&i<showCnt;++i){_attachment.push(attachment[i])}}return _attachment};KfArenaSys.prototype.getDuanNameCnt=function(){var _scoreMetalDesc=GlobalConfig.CrossArenaBase["scoreMetalDesc"];if(_scoreMetalDesc){var scoreMetalDesc=_scoreMetalDesc.split("，");if(scoreMetalDesc.length<=1)scoreMetalDesc=_scoreMetalDesc.split(",");return scoreMetalDesc.length}else return 0};KfArenaSys.prototype.isOpen=function(){if(this.getOpenLeftTime()<=0){return false}if(this.isAchieveOpenCfg()){if(this.isStartIng==1||this.isStartIng==0&&this._openLeftTime>0)return true}return false};KfArenaSys.prototype.isAchieveOpenCfg=function(){return GlobalConfig.CrossArenaBase.openDay<=GameServer.serverOpenDay+1&&UserZs.ins().lv>=GlobalConfig.CrossArenaBase.zhuanshengLevel};KfArenaSys.prototype.sendDailyRewards=function(){this.sendBaseProto(23)};KfArenaSys.prototype.sendJoinRewards=function(index){var bytes=this.getBytes(24);bytes.writeInt(index);this.sendToServer(bytes)};KfArenaSys.prototype.postJoinRewards=function(bytes){this.yesterdayDuan=bytes.readInt();this.dailyState=bytes.readInt();this.dflCount=bytes.readInt();this.dflState=bytes.readInt()};KfArenaSys.prototype.postOpenKfArena=function(bytes){this.isStartIng=bytes.readInt();this._openLeftTime=bytes.readInt();this._openTimer=egret.getTimer()};KfArenaSys.prototype.autoAttackAfterMove=function(){var _this=this;TimerManager.ins().doTimer(700,1,function(){if(_this.isAttackEnemy){GameLogic.ins().postChangeAttrPoint(_this.attackHandle)}else{_this.sendCollectFlag()}},this)};KfArenaSys.prototype.checkIsOnPoint=function(handle,pointType,square_width,isCheckMe){if(square_width===void 0){square_width=4}if(isCheckMe===void 0){isCheckMe=false}var role=EntityManager.ins().getEntityByHandle(handle)||EntityManager.ins().getEntityBymasterhHandle(handle);if(!role||pointType<0||square_width<0)return false;var w=square_width;var rx_Grid=Math.floor(role.x/GameMap.CELL_SIZE);var ry_Grid=Math.floor(role.y/GameMap.CELL_SIZE);var Pos=[];switch(pointType){case this.point_type_flag:Pos.push(this.flagPos);break;default:return false}for(var _i=0,Pos_1=Pos;_i<Pos_1.length;_i++){var v=Pos_1[_i];if(rx_Grid<=v.posX+w&&rx_Grid>=v.posX-w&&ry_Grid<=v.posY+w&&ry_Grid>=v.posY-w){return true}}return false};KfArenaSys.prototype.updateCampInfoByRole=function(charRole){var role1=charRole.infoModel;var name1=role1.name;var svrid1=role1.servId;var allEntity=EntityManager.ins().getAllEntity();for(var handle in allEntity){var entity=allEntity[handle];if(entity instanceof CharRole){var role2=entity.infoModel;if(role2&&entity.getHpBar()){var name2=role2.name;var localSvrId=parseInt(LocationProperty.serverID);var svrid2=role2.name==Actor.myName?localSvrId:role2.servId;if(this.isKFArena){this.sortEntityByCampId(name2,svrid2,role2.camp)}}}}};KfArenaSys.prototype.sortEntityByCampId=function(name,svrid,campId){if(!this.isKFArena||name==null||svrid==null||campId==null)return;if(campId==this.myCampId){this.teamInfo.push({name:name,svrid:svrid})}else{this.enemyNameAndSvrid.push({name:name,svrid:svrid})}};KfArenaSys.prototype.clear=function(){this.teamInfo.length=0;this.enemyNameAndSvrid.length=0;this.isStopCollectFlag=true};KfArenaSys.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3};KfArenaSys.prototype.getDuanRedPoint=function(){return this.dailyState==0?1:0};KfArenaSys.prototype.getJoinRedPoint=function(){var peakAwards=GlobalConfig.CrossArenaBase.peakAwards;var index=1;var num=0;for(var i in peakAwards){if((this.dflState>>index&1)!=1){if(this.dflCount>=peakAwards[i].count){num++}}index++}return num};KfArenaSys.myNameColor=65280;KfArenaSys.teamColor=49151;KfArenaSys.enemyColor=16724016;return KfArenaSys}(BaseSystem);__reflect(KfArenaSys.prototype,"KfArenaSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.kfArenaSys=KfArenaSys.ins.bind(KfArenaSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var kfTransferEffMgr=function(_super){__extends(kfTransferEffMgr,_super);function kfTransferEffMgr(){var _this=_super.call(this)||this;_this.myRelivePosX=0;_this.myRelivePosY=0;return _this}kfTransferEffMgr.ins=function(){if(this._instance==null){this._instance=new kfTransferEffMgr}return this._instance};kfTransferEffMgr.prototype.createTransfer=function(){this.getRoleRelivePos();if(this.myRelivePosX>0&&this.myRelivePosY>0){GameLogic.ins().addOutEff(this.myRelivePosX*GameMap.CELL_SIZE,this.myRelivePosY*GameMap.CELL_SIZE)}};kfTransferEffMgr.prototype.getRoleRelivePos=function(){var role=EntityManager.ins().getMainRole(0);if(role&&role.x&&role.y){var x_Grid=Math.floor(role.x/GameMap.CELL_SIZE);var y_Grid=Math.floor(role.y/GameMap.CELL_SIZE);this.myRelivePosX=x_Grid;this.myRelivePosY=y_Grid}};return kfTransferEffMgr}(egret.EventDispatcher);__reflect(kfTransferEffMgr.prototype,"kfTransferEffMgr");var KfArenaData=function(){function KfArenaData(bytes){if(bytes)this.readData(bytes)}KfArenaData.prototype.readData=function(bytes){this.servId=bytes.readInt();this.playerName=bytes.readString();this.killNum=bytes.readShort();this.aidNum=bytes.readShort();this.collectNum=bytes.readShort();this.curScore=bytes.readShort();this.curGetScore=bytes.readShort();this.totalScore=bytes.readShort();this.isFirstKiller=bytes.readBoolean();this.isFirstCollect=bytes.readBoolean();this.isMvp=bytes.readBoolean();this.isOnWin=bytes.readBoolean();this.isDeserter=bytes.readBoolean();this.score=bytes.readInt();this.camp=bytes.readShort()};KfArenaData.prototype.readRankData=function(bytes){this.servId=bytes.readInt();this.playerName=bytes.readString();this.killNum=bytes.readShort();this.aidNum=bytes.readShort();this.collectNum=bytes.readShort();this.curScore=bytes.readShort();this.totalScore=bytes.readInt();this.camp=bytes.readShort()};return KfArenaData}();__reflect(KfArenaData.prototype,"KfArenaData");var KfArenaNoticeData=function(){function KfArenaNoticeData(bytes){this.type=bytes.readShort();if(this.type==1||this.type==3){this.servId=bytes.readInt();this.name=bytes.readString()}else{this.killerServId=bytes.readInt();this.killerName=bytes.readString();this.deadServId=bytes.readInt();this.deadName=bytes.readString()}this.noticeId=bytes.readShort()}return KfArenaNoticeData}();__reflect(KfArenaNoticeData.prototype,"KfArenaNoticeData");var KfArenaRankData=function(){function KfArenaRankData(bytes){this.rank=bytes.readInt();this.playerId=bytes.readInt();this.score=bytes.readInt();this.vip=bytes.readInt();this.playerName=bytes.readString();this.dan=bytes.readInt();this.servId=bytes.readInt()}return KfArenaRankData}();__reflect(KfArenaRankData.prototype,"KfArenaRankData");var KfArenaRoleVo=function(){function KfArenaRoleVo(){this.curMonth=new kfArenaMark;this.history=new kfArenaMark;this.power=0;this.winRate=0}KfArenaRoleVo.prototype.parse=function(bytes){this.roleID=bytes.readInt();this.serverId=bytes.readInt();this.isonline=bytes.readInt()!=0;this.duanLevel=bytes.readInt();this.score=bytes.readInt();this.curMonth.parse(bytes);this.history.parse(bytes);this.power=bytes.readInt();this.winRate=bytes.readInt()/100;this.roleName=bytes.readString();this.job=bytes.readByte();this.sex=bytes.readByte();this.cloth=bytes.readInt();this.weapon=bytes.readInt();this.wingLv=bytes.readInt();this.wingState=bytes.readByte();this.pos1=bytes.readInt();this.pos2=bytes.readInt();this.pos3=bytes.readInt();this.zs=bytes.readInt();this.lv=bytes.readInt()};KfArenaRoleVo.prototype.isLeader=function(){return KfArenaSys.ins().leaderID==this.roleID};return KfArenaRoleVo}();__reflect(KfArenaRoleVo.prototype,"KfArenaRoleVo");var kfArenaMark=function(){function kfArenaMark(){}kfArenaMark.prototype.parse=function(bytes){this.win=bytes.readInt();this.ping=bytes.readInt();this.fail=bytes.readInt()};return kfArenaMark}();__reflect(kfArenaMark.prototype,"kfArenaMark");var KFInviteData=function(){function KFInviteData(){}KFInviteData.prototype.parse=function(bytes){this.roleId=bytes.readInt();this.name=bytes.readString();this.power=bytes.readInt();this.score=bytes.readInt();this.winRate=bytes.readInt()/100};return KFInviteData}();__reflect(KFInviteData.prototype,"KFInviteData");var KFInviteType;(function(KFInviteType){KFInviteType[KFInviteType["Friend"]=0]="Friend";KFInviteType[KFInviteType["Guild"]=1]="Guild"})(KFInviteType||(KFInviteType={}));window["KFInviteType"]=KFInviteType;var KfArenaBtn=function(_super){__extends(KfArenaBtn,_super);function KfArenaBtn(){var _this=_super.call(this)||this;_this.skinName="BtnTab0Skin";return _this}KfArenaBtn.prototype.dataChanged=function(){this.labelDisplay.text=this.data};return KfArenaBtn}(BaseItemRender);__reflect(KfArenaBtn.prototype,"KfArenaBtn");var KfArenaDataItem=function(_super){__extends(KfArenaDataItem,_super);function KfArenaDataItem(){return _super.call(this)||this}KfArenaDataItem.prototype.dataChanged=function(){var data=this.data;if(!data)return;this.rankTxt.text="";this.nameTxt.text="";this.kaTxt.text="";this.collectionTxt.text="";this.scoreTxt.text="";this.arenaIntegral.text="";this.tianshu.text="";this.mvp.visible=false;this.firstBloodImg.visible=false;this.firstCollectionImg.visible=false;this.multiwin.visible=false;this.setTxtColor();if(data instanceof KfArenaData){if(data["rankNum"]!=null){this.rankTxt.text=data["rankNum"]+""}this.nameTxt.text=data.playerName+"";this.kaTxt.text=data.killNum+"/"+data.aidNum;this.tianshu.text=data.collectNum+"";this.scoreTxt.text=data.curScore+"";this.mvp.visible=data.isMvp;if(data.score){var sign=data.totalScore>=0?"+":" ";this.arenaIntegral.text=data.score.toString()+sign+data.totalScore.toString()}else if(data.totalScore){this.arenaIntegral.text=data.totalScore.toString()}this.firstBloodImg.visible=data.isFirstKiller;this.firstCollectionImg.visible=data.isFirstCollect;this.multiwin.visible=data.isOnWin}};KfArenaDataItem.prototype.setTxtColor=function(){var color=65280;if(this.data.camp==KfArenaSys.ins().myCampId){color=KfArenaSys.teamColor}else{color=KfArenaSys.enemyColor}this.rankTxt.textColor=color;this.nameTxt.textColor=color;this.kaTxt.textColor=color;this.collectionTxt.textColor=color;this.scoreTxt.textColor=color;this.tianshu.textColor=color;this.arenaIntegral.textColor=color};return KfArenaDataItem}(BaseItemRender);__reflect(KfArenaDataItem.prototype,"KfArenaDataItem");var KfArenaDuanItemRender=function(_super){__extends(KfArenaDuanItemRender,_super);function KfArenaDuanItemRender(){var _this=_super.call(this)||this;_this.textColors=[16710568,15526141,16569017,12176636];_this.strokeColors=[8076674,4538995,2380625,5782380];_this.skinName="KfArenaDuanItemSkin";return _this}KfArenaDuanItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};KfArenaDuanItemRender.prototype.dataChanged=function(){if(!this.data)return;this.dwName.text="";this.levelImg.source="level_4";this.dwImg.source="number4";this.dwName.textColor=this.textColors[this.textColors.length-1];this.dwName.strokeColor=this.strokeColors[this.textColors.length-1];if(this.itemIndex<4){this.dwImg.source="number"+(this.itemIndex+1);this.levelImg.source="level_"+(this.itemIndex+1);this.dwName.textColor=this.textColors[this.itemIndex%4];this.dwName.strokeColor=this.strokeColors[this.itemIndex%4]}var mailId=this.data["mailID"];var rankIDx=0;var metal=0;var rank="";if(this.data["rankIDx"]){rankIDx=this.data["rankIDx"];if(rankIDx==1){rank="1"}else{var rankAward=GlobalConfig.CrossArenaBase.rankAward;if(rankAward){if(rankAward[this.itemIndex]["rankIDx"]-(parseInt(rankAward[this.itemIndex-1]["rankIDx"])+1)!=0)rank=parseInt(rankAward[this.itemIndex-1]["rankIDx"])+1+"-"+rankAward[this.itemIndex]["rankIDx"];else rank=parseInt(rankAward[this.itemIndex-1]["rankIDx"])+1+""}}this.dwName.text=i18n("KfArenaDuanItemRender_1")+rank+i18n("KfArenaDuanItemRender_0")}else if(this.data["metal"]){metal=this.data["metal"]-1;this.dwName.text=KfArenaSys.ins().getDuanNameByIndex(metal)}var _attachment=[];if(GlobalConfig.MailIdConfig[mailId]&&GlobalConfig.MailIdConfig[mailId].attachment){_attachment=GlobalConfig.MailIdConfig[mailId].attachment}this.reward.dataProvider=new eui.ArrayCollection(_attachment)};return KfArenaDuanItemRender}(BaseItemRender);__reflect(KfArenaDuanItemRender.prototype,"KfArenaDuanItemRender");var KfArenaJoinItemRender=function(_super){__extends(KfArenaJoinItemRender,_super);function KfArenaJoinItemRender(){var _this=_super.call(this)||this;_this.skinName="KfArenaJoinItemSkin";return _this}KfArenaJoinItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rewardList.itemRenderer=ItemBase};KfArenaJoinItemRender.prototype.dataChanged=function(){if(!this.data)return;this.redPoint.visible=false;this.get.visible=false;this.statusImg.visible=true;this.btnGet.visible=false;this.target.text=""+this.data.count;var state=KfArenaSys.ins().dflState;this.statusImg.source="staus_yidacheng";this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);if((state>>this.data.id&1)==1){this.get.visible=true;this.statusImg.visible=false}else{if(KfArenaSys.ins().dflCount>=this.data.count){this.btnGet.visible=true;this.statusImg.visible=false;this.redPoint.visible=true;this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)}else{this.statusImg.source="status_weidacheng"}}if(this.data.award){this.rewardList.dataProvider=new eui.ArrayCollection(this.data.award)}};KfArenaJoinItemRender.prototype.onTap=function(e){if(this.redPoint.visible)KfArenaSys.ins().sendJoinRewards(this.data.id)};KfArenaJoinItemRender.prototype.destruct=function(){this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};return KfArenaJoinItemRender}(BaseItemRender);__reflect(KfArenaJoinItemRender.prototype,"KfArenaJoinItemRender");var kfArenaMemberItemRender=function(_super){__extends(kfArenaMemberItemRender,_super);function kfArenaMemberItemRender(){var _this=_super.call(this)||this;_this.skinName="kfArenaMemberItemSkin";return _this}kfArenaMemberItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.itemData=new GuildMemberInfo;this.inviteBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};kfArenaMemberItemRender.prototype.dataChanged=function(){if(this.data instanceof GuildMemberInfo){this.itemData=this.data}if(!this.data)return;this.nameLab.text=this.itemData.name;this.powerLab.text=i18n("kfArenaMemberItemRender_0",CommonUtils.overLength(this.itemData.attack));this.scoreLab.text=i18n("kfArenaMemberItemRender_1",this.itemData.score);this.winRateLab.text=i18n("kfArenaMemberItemRender_2",this.itemData.winRate);var job=fixJob(this.itemData.job);var sex=fixSex(this.itemData.sex);this.face.source="head_"+job+sex;this.vipTitle.visible=this.itemData.vipLevel!=0};kfArenaMemberItemRender.prototype.onTap=function(e){KfArenaSys.ins().sendInvite(this.itemData.roleID)};kfArenaMemberItemRender.prototype.destruct=function(){this.inviteBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};return kfArenaMemberItemRender}(BaseItemRender);__reflect(kfArenaMemberItemRender.prototype,"kfArenaMemberItemRender");var KfArenaRankItemRender=function(_super){__extends(KfArenaRankItemRender,_super);function KfArenaRankItemRender(){return _super.call(this)||this}KfArenaRankItemRender.prototype.dataChanged=function(){if(this.data instanceof KfArenaRankData){if(this.data.rank<=3){this.rankImg.source="paihang"+this.data.rank;this.rankTxt.visible=false;this.rankImg.visible=true}else{this.rankTxt.text=this.data.rank+"";this.rankTxt.visible=true;this.rankImg.visible=false}this.player.text=this.data.playerName;this.score.text=this.data.score+"";this.seasonTitle.text=KfArenaSys.ins().getDuanName(false,this.data.score);this.serverId.text=SelectServerMgr.ins().getServerNameByID(this.data.servId);this.vip.visible=this.data.vip>0}};return KfArenaRankItemRender}(BaseItemRender);__reflect(KfArenaRankItemRender.prototype,"KfArenaRankItemRender");var kfArenaRewardItem=function(_super){__extends(kfArenaRewardItem,_super);function kfArenaRewardItem(){var _this=_super.call(this)||this;_this.scoreMetalDesc=[];_this.skinName="kfArenaRewardItemSkin";_this.reward.itemRenderer=ItemBase;return _this}kfArenaRewardItem.prototype.dataChanged=function(){if(!this.data)return;this.reward.dataProvider=new eui.ArrayCollection([]);this.dwName.text="";this.levelImg.source="level_4";this.dwImg.source="number4";var cnt=this.parent.numElements;var lastIdx=cnt-1;var metal=lastIdx-this.itemIndex;this.dwName.text=KfArenaSys.ins().getDuanNameByIndex(metal);this.dwImg.source="level"+(metal+1);var imgIdx=Math.floor(this.itemIndex/3)+1;if(imgIdx==1){this.levelImg.source="level_1"}else if(imgIdx==2){this.levelImg.source="level_3"}else if(imgIdx==3){this.levelImg.source="level_2"}else if(imgIdx==4){this.levelImg.source="level_4"}else if(imgIdx==5){this.levelImg.source="level_3"}else if(imgIdx==6){this.levelImg.source="level_2"}else if(imgIdx==7){this.levelImg.source="level_3"}this.reward.dataProvider=new eui.ArrayCollection(KfArenaSys.ins().getDuanRewardByIndex(metal,3))};return kfArenaRewardItem}(BaseItemRender);__reflect(kfArenaRewardItem.prototype,"kfArenaRewardItem");var KfArenaRoleItemRender=function(_super){__extends(KfArenaRoleItemRender,_super);function KfArenaRoleItemRender(){var _this=_super.call(this)||this;_this.skinName="teamFbRoleItem";_this.touchEnabled=false;return _this}KfArenaRoleItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};KfArenaRoleItemRender.prototype.onTouch=function(e){switch(e.target){case this.invite:case this.nomember:ViewManager.ins().open(KfArenaInviteWin);break;case this.body:if(this.data.roleID!=Actor.actorID)ViewManager.ins().open(kfArenaCheckWin,this.data);break}};KfArenaRoleItemRender.prototype.dataChanged=function(){if(!this.data){this.nomember.visible=this.invite.visible=true;this.bodyMc.visible=this.position.visible=this.weaponMc.visible=this.wingMc.visible=false;this.roleName.text=i18n("KfArenaRoleItemRender_1")}else{this.nomember.visible=this.invite.visible=false;this.position.visible=this.bodyMc.visible=this.weaponMc.visible=this.wingMc.visible=true;var vo=this.data;this.onlineLabel.visible=!vo.isonline;this.roleName.text=vo.roleName;this.position.source=vo.isLeader()?"tfb_leader":null;this.body.source=this.weapon.source=this.wing.source=null;this.bodyMc.removeChildren();this.weaponMc.removeChildren();this.wingMc.removeChildren();var bodyRes="";var weaponRes="";var wingRes="";var clothCfg=GlobalConfig.EquipConfig[vo.cloth];if(clothCfg){var fileName=clothCfg.appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",vo.job+"")}if(fileName.indexOf("903")>0){bodyRes=(vo.cloth>0?fileName+"_":"body"+vo.job+"00_")+vo.sex+"_c"}else{bodyRes=(vo.cloth>0?fileName:"body"+vo.job+"00")+"_c"}}var weaponCfg=GlobalConfig.EquipConfig[vo.weapon];if(weaponCfg){var fileName=weaponCfg.appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",vo.job+"")}weaponRes=vo.weapon>0?fileName+"_"+vo.sex+"_c":""}this.wing.visible=true;var wingCfg=GlobalConfig.WingLevelConfig[vo.wingLv];if(wingCfg){wingRes=vo.wingLv>=0?wingCfg.appearance:""}if(vo.pos1>0){bodyRes=getZhuangbanById(vo.pos1).res+"_c"}if(vo.pos2>0){weaponRes=getZhuangbanById(vo.pos2).res+"_"+vo.sex+"_c"}if(vo.pos3>0){wingRes=getZhuangbanById(vo.pos3).res}if(!bodyRes){bodyRes=getDefaultBody(vo.job)+"_c"}this._body=imageToMc(this.body,bodyRes,this.bodyMc);imageToMc(this.weapon,weaponRes,this.weaponMc,this._body);imageToMc(this.wing,wingRes,this.wingMc,this._body)}};KfArenaRoleItemRender.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)};return KfArenaRoleItemRender}(BaseItemRender);__reflect(KfArenaRoleItemRender.prototype,"KfArenaRoleItemRender");var kfArenaCheckWin=function(_super){__extends(kfArenaCheckWin,_super);function kfArenaCheckWin(){var _this=_super.call(this)||this;_this.skinName="kfArenaCheckSkin";_this.isTopLevel=true;return _this}kfArenaCheckWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.outBtn,this.onTouch);this.addTouchEvent(this.checkBtn,this.onTouch);this.data=args[0];this.update()};kfArenaCheckWin.prototype.update=function(){this.currentState=KfArenaSys.ins().isTFCaptain?"normal":"check";this.nameLab.text=this.data.roleName;this.powerLab.text=i18n("kfArenaCheckWin_0",CommonUtils.overLength(this.data.power));this.scoreLab.text=i18n("kfArenaCheckWin_1",this.data.score);this.winRateLab.text=i18n("kfArenaCheckWin_2",this.data.winRate);var job=fixJob(this.data.job);var sex=fixSex(this.data.sex);this.face.source="head_"+job+sex};kfArenaCheckWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:break;case this.outBtn:KfArenaSys.ins().sendOutTeam(this.data.roleID);break;case this.checkBtn:UserReadPlayer.ins().sendFindPlayer(this.data.roleID,this.data.serverId);break}ViewManager.ins().close(this)};return kfArenaCheckWin}(BaseEuiView);__reflect(kfArenaCheckWin.prototype,"kfArenaCheckWin");ViewManager.ins().reg(kfArenaCheckWin,LayerManager.UI_Popup);var KfArenaDuanPanel=function(_super){__extends(KfArenaDuanPanel,_super);function KfArenaDuanPanel(){var _this=_super.call(this)||this;_this.name=i18n("KfArenaDuanPanel_0");return _this}KfArenaDuanPanel.prototype.childrenCreated=function(){this.initUI()};KfArenaDuanPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.listArray=new eui.ArrayCollection;this.list.itemRenderer=KfArenaDuanItemRender;this.list.dataProvider=this.listArray;this.rewardList.itemRenderer=ItemBase};KfArenaDuanPanel.prototype.open=function(){this.observe(KfArenaSys.ins().postJoinRewards,this.update);this.update()};KfArenaDuanPanel.prototype.update=function(){this.listArray.source=GlobalConfig.CrossArenaBase.rankAward;this.rewardList.dataProvider=new eui.ArrayCollection(KfArenaSys.ins().getDuanAwards());this.redPoint.visible=KfArenaSys.ins().dailyState==0;this.btnGet.visible=KfArenaSys.ins().dailyState==0;this.get.visible=KfArenaSys.ins().dailyState==1;if(KfArenaSys.ins().dailyState==0){this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this)}else{this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this)}};KfArenaDuanPanel.prototype.onGet=function(e){KfArenaSys.ins().sendDailyRewards()};KfArenaDuanPanel.prototype.close=function(){_super.prototype.close.call(this);this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGet,this)};return KfArenaDuanPanel}(BaseEuiView);__reflect(KfArenaDuanPanel.prototype,"KfArenaDuanPanel");var KfArenaFightWin=function(_super){__extends(KfArenaFightWin,_super);function KfArenaFightWin(){var _this=_super.call(this)||this;_this.needScore=800;_this.isShowTeamGroup=true;_this.isShowEnermyGroup=true;_this.getScore=-1;_this.oldScore=0;_this.isStartFight=true;_this.skinName="KfArenaFightSkin";return _this}KfArenaFightWin.prototype.childrenCreated=function(){this.bigTimeGroup.visible=true;this.teamGroup.visible=false;this.enermyGroup.visible=false};KfArenaFightWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.modeSys=KfArenaSys.ins();this.addTouchEvent(this.seeRule,this.onTouch);this.addTouchEvent(this.infoBtn,this.onTouch);this.observe(this.modeSys.postChangeScore,this.upScore);this.observe(KfArenaSys.ins().postDataInfo,this.updateMyRankInfo);this.observe(MapView.onGridClick,this.onGridClick);this.observe(KfArenaSys.ins().showKfArenaNotice,this.showGetTip);this.score.text="0";this.rank.text="0";this.rankGroup.visible=false;this.leftTimeLbl.visible=false;this.waitTxt.visible=true;this.leftTimeLbl.visible=false;this.getTip.visible=false;this.startReadyTime();this.upScore()};KfArenaFightWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};KfArenaFightWin.prototype.onGridClick=function(){if(KfArenaSys.ins().getReadyTime()>0){UserTips.ins().showTips(i18n("KfArenaFightWin_3")+KfArenaSys.ins().getReadyTime()+i18n("KfArenaFightWin_0"))}};KfArenaFightWin.prototype.showGetTip=function(){var _this=this;var getWord=KfArenaSys.ins().getWord;if(getWord&&getWord!=""&&this.getScore>0){getWord+=i18n("KfArenaFightWin_1")+this.getScore+i18n("KfArenaFightWin_2");this.getTip.visible=true;this.getTip.textFlow=TextFlowMaker.generateTextFlow(getWord);TimerManager.ins().doTimer(3e3,1,function(){_this.getTip.visible=false;_this.getTip.text="";_this.getScore=-1;KfArenaSys.ins().getWord="";KfArenaSys.ins().isShowing=false},this)}};KfArenaFightWin.prototype.upScore=function(){var _this=this;KfArenaSys.ins().sendDataInfo(false);this.blueScore.text=this.modeSys.teamScore+"";this.redScore.text=this.modeSys.enermyScore+"";if(this.modeSys.teamScore>=this.needScore&&this.isShowTeamGroup){this.isShowTeamGroup=false;this.enermyGroup.visible=false;this.teamGroup.visible=true;TimerManager.ins().doTimer(3e3,1,function(){_this.teamGroup.visible=false},this)}if(this.modeSys.enermyScore>=this.needScore&&this.isShowEnermyGroup){this.isShowEnermyGroup=false;this.teamGroup.visible=false;this.enermyGroup.visible=true;TimerManager.ins().doTimer(3e3,1,function(){_this.enermyGroup.visible=false},this)}};KfArenaFightWin.prototype.updateMyRankInfo=function(rankDatas){this.rankGroup.visible=true;if(rankDatas&&rankDatas.length>0){for(var i=0;i<rankDatas.length;++i){if(KfArenaSys.ins().isMySelf(rankDatas[i].playerName,rankDatas[i].servId)){this.score.text=rankDatas[i].curScore>0?rankDatas[i].curScore.toString():"0";if(rankDatas[i].curScore>this.oldScore){this.getScore=rankDatas[i].curScore-this.oldScore;this.oldScore=rankDatas[i].curScore;this.showGetTip()}break}}var myRank=1;for(var i=0;i<rankDatas.length;++i){if(rankDatas[i].camp==KfArenaSys.ins().myCampId&&!KfArenaSys.ins().isMySelf(rankDatas[i].playerName,rankDatas[i].servId)){myRank=rankDatas[i].curScore>this.oldScore?myRank+1:myRank}}this.rank.text=myRank.toString()}};KfArenaFightWin.prototype.onTouch=function(e){switch(e.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[34].text);break;case this.infoBtn:KfArenaSys.ins().sendDataInfo();break}};KfArenaFightWin.prototype.startReadyTime=function(){this.readyTimeGo();var readyTime=KfArenaSys.ins().getReadyTime();if(readyTime>0){this.bigTimeGroup.visible=true;TimerManager.ins().doTimer(1e3,readyTime+1,this.readyTimeGo,this)}};KfArenaFightWin.prototype.readyTimeGo=function(){var readyTime=KfArenaSys.ins().getReadyTime();if(readyTime>0){this.countDown.text=readyTime+""}else{TimerManager.ins().remove(this.readyTimeGo,this);this.bigTimeGroup.visible=false;this.waitTxt.visible=false;this.leftTimeLbl.visible=true;if(this.isStartFight){this.isStartFight=false;this.showGuideGroup();this.startLeftFightTime()}}};KfArenaFightWin.prototype.startLeftFightTime=function(){var leftFightTime=KfArenaSys.ins().getLeftFightTime();this.leftTimeLbl.text=this.setTimeFormat(leftFightTime);TimerManager.ins().doTimer(1e3,leftFightTime+1,this.leftFightTimeGo,this)};KfArenaFightWin.prototype.leftFightTimeGo=function(){var leftFightTime=KfArenaSys.ins().getLeftFightTime();if(leftFightTime>0){this.leftTimeLbl.text=this.setTimeFormat(leftFightTime)}else{this.isStartFight=true;TimerManager.ins().remove(this.leftFightTimeGo,this)}};KfArenaFightWin.prototype.setTimeFormat=function(time){if(time<0)return"";var str="";var m=Math.floor(time/60);if(m<10)str+="0"+m.toString()+":";else str+=m.toString()+":";var s=time-m*60;if(s<10)str+="0"+s.toString();else str+=s.toString();return str};KfArenaFightWin.prototype.showGuideGroup=function(){var TargetListPanel=ViewManager.ins().getView("TargetListPanel");if(TargetListPanel)TargetListPanel.showGuideGroup()};return KfArenaFightWin}(BaseEuiView);__reflect(KfArenaFightWin.prototype,"KfArenaFightWin");ViewManager.ins().reg(KfArenaFightWin,LayerManager.UI_Main);var KfArenaInfoWin=function(_super){__extends(KfArenaInfoWin,_super);function KfArenaInfoWin(){var _this=_super.call(this)||this;_this.skinName="KfArenaInfoSkin";return _this}KfArenaInfoWin.prototype.childrenCreated=function(){this.list.itemRenderer=KfArenaDataItem;this.itemDt=new eui.ArrayCollection;this.list.dataProvider=this.itemDt};KfArenaInfoWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.sureBtn,this.onTouch);this.observe(KfArenaSys.ins().postRankInfo,this.updata);this.updata(param[0])};KfArenaInfoWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.sureBtn:ViewManager.ins().close(this);break}};KfArenaInfoWin.prototype.updata=function(dt){var modeSys=KfArenaSys.ins();this.blueScore.text=modeSys.teamScore+"";this.redScore.text=modeSys.enermyScore+"";this.itemDt.replaceAll(dt)};return KfArenaInfoWin}(BaseEuiView);__reflect(KfArenaInfoWin.prototype,"KfArenaInfoWin");ViewManager.ins().reg(KfArenaInfoWin,LayerManager.UI_Popup);var KfArenaInviteWin=function(_super){__extends(KfArenaInviteWin,_super);function KfArenaInviteWin(){var _this=_super.call(this)||this;_this.friendList=[];_this.guildList=[];_this.type=0;_this.cdTime=30;_this.skinName="kfInviteSkin";_this.isTopLevel=true;_this.listView.itemRenderer=kfArenaMemberItemRender;_this.worldInvite.textFlow=(new egret.HtmlTextParser).parser("<u>"+_this.worldInvite.text+"</u>");_this.listArray=new eui.ArrayCollection;_this.listView.dataProvider=_this.listArray;_this.tab.itemRenderer=KfArenaBtn;_this.updateTabRedPt();return _this}KfArenaInviteWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.tab.selectedIndex=0;this.addTouchEvent(this.closeBtn0,this.onTouch);this.addTouchEvent(this.worldInvite,this.onTouch);this.addTouchEvent(this.tab,this.onTabClick);this.observe(KfArenaSys.ins().postKfArenaDelID,this.update);this.observe(KfArenaSys.ins().postKfArenaGuilds,this.updateGuild);this.type=KFInviteType.Friend;KfArenaSys.ins().sendGuilds(0);KfArenaSys.ins().sendGuilds(1)};KfArenaInviteWin.prototype.updateGuild=function(type){switch(type){case KFInviteType.Friend:this.friendList=KfArenaSys.ins().getDataList(type);break;case KFInviteType.Guild:this.guildList=KfArenaSys.ins().getDataList(type);break}this.setType(this.type)};KfArenaInviteWin.prototype.onTabClick=function(e){if(e===void 0){e=null}this.setType(this.tab.selectedIndex)};KfArenaInviteWin.prototype.updateTabRedPt=function(){this.tab.dataProvider=new ArrayCollection([i18n("KfArenaInviteWin_0"),i18n("KfArenaInviteWin_1")])};KfArenaInviteWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn0:ViewManager.ins().close(this);break;case this.worldInvite:var time=egret.getTimer();var cd=(KfArenaSys.ins().worldTimeCd-time)/1e3>>0;if(cd>0){UserTips.ins().showTips(i18n("KfArenaInviteWin_2",cd))}else{KfArenaSys.ins().worldTimeCd=time+this.cdTime*1e3;KfArenaSys.ins().sendWorldInvite();UserTips.ins().showTips(i18n("KfArenaInviteWin_3"))}break}};KfArenaInviteWin.prototype.update=function(id){for(var i=this.friendList.length-1;i>=0;i--){if(this.friendList[i].id==id)this.friendList.splice(i,1)}for(var i=this.guildList.length-1;i>=0;i--){if(this.guildList[i].roleID==id)this.guildList.splice(i,1)}this.setType(this.type)};KfArenaInviteWin.prototype.setType=function(type){this.type=type;switch(type){case KFInviteType.Friend:this.listArray.source=this.friendList;this.noPlayer.visible=this.friendList.length==0;break;case KFInviteType.Guild:this.listArray.source=this.guildList;this.noPlayer.visible=this.guildList.length==0;break}};return KfArenaInviteWin}(BaseEuiView);__reflect(KfArenaInviteWin.prototype,"KfArenaInviteWin");ViewManager.ins().reg(KfArenaInviteWin,LayerManager.UI_Popup);var KfArenaJoinPanel=function(_super){__extends(KfArenaJoinPanel,_super);function KfArenaJoinPanel(){var _this=_super.call(this)||this;_this.name=i18n("KfArenaJoinPanel_0");return _this}KfArenaJoinPanel.prototype.childrenCreated=function(){this.initUI()};KfArenaJoinPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.listArray=new eui.ArrayCollection;this.list.itemRenderer=KfArenaJoinItemRender;this.list.dataProvider=this.listArray};KfArenaJoinPanel.prototype.open=function(){this.observe(KfArenaSys.ins().postJoinRewards,this.update);this.update()};KfArenaJoinPanel.prototype.update=function(){var peakAwards=GlobalConfig.CrossArenaBase.peakAwards;var tem=[];var index=1;for(var i in peakAwards){peakAwards[i].id=index;tem.push(peakAwards[i]);index++}this.listArray.source=tem;this.myRecord.text=KfArenaSys.ins().dflCount};KfArenaJoinPanel.prototype.close=function(){};return KfArenaJoinPanel}(BaseEuiView);__reflect(KfArenaJoinPanel.prototype,"KfArenaJoinPanel");var KfArenaMacthPanel=function(_super){__extends(KfArenaMacthPanel,_super);function KfArenaMacthPanel(){var _this=_super.call(this)||this;_this.remainM=0;_this.name=i18n("KfArenaMacthPanel_0");return _this}KfArenaMacthPanel.prototype.childrenCreated=function(){this.initUI()};KfArenaMacthPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.memberArr=[this.leader,this.member1,this.member2];this.dailyTime.text=""+GlobalConfig.CrossArenaBase.joinCount;this.maxTime.text=""+GlobalConfig.CrossArenaBase.maxJoinCount;this.list.itemRenderer=ItemBase;this.detail.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.detail.text+"</u>")};KfArenaMacthPanel.prototype.open=function(){this.addTouchEvent(this.disBtn,this.onTouch);this.addTouchEvent(this.macthBtn,this.onTouch);this.addTouchEvent(this.detail,this.onDetail);this.observe(KfArenaSys.ins().postPlayerInfo,this.updateInfo);this.observe(KfArenaSys.ins().postTeamInfo,this.update);this.observe(KfArenaSys.ins().postMacthState,this.update);this.observe(KfArenaSys.ins().postOpenKfArena,this.update);this.update()};KfArenaMacthPanel.prototype.update=function(){this.updateMember();this.updateInfo();this.updateBtnState()};KfArenaMacthPanel.prototype.updateMember=function(){this.roleGroup.visible=KfArenaSys.ins().getIsJoinTeam();for(var _i=0,_a=this.memberArr;_i<_a.length;_i++){var member=_a[_i];member.data=null}var tfMembers=KfArenaSys.ins().tfMembers;var index=1;if(tfMembers&&tfMembers.length){for(var i=0;i<tfMembers.length;i++){var data=tfMembers[i];var isLeader=data.isLeader();if(isLeader){this.leader.data=data}else{this.memberArr[index].data=data;index++}}}};KfArenaMacthPanel.prototype.updateInfo=function(){var ins=KfArenaSys.ins();this.scoreLabel.text=i18n("KfArenaMacthPanel_1",ins.score);this.curMonthLabel.text=ins.curMouth?i18n("KfArenaMacthPanel_2",ins.curMouth.win,ins.curMouth.ping,ins.curMouth.fail):"0";var info=KfArenaSys.ins().getNextDuanInfo();var str=i18n("KfArenaMacthPanel_3")+info.num+i18n("KfArenaMacthPanel_4")+info.dname;this.tip.textFlow=TextFlowMaker.generateTextFlow(str);this.countLabel.text=""+ins.times;this.macthingLabel.visible=ins.macthState==1;this.matchTime.visible=ins.macthState==1;this.setProgress();if(ins.macthState==1){this.startCount()}};KfArenaMacthPanel.prototype.startCount=function(){this.remainM=2*60;this.timeLabel.text=DateUtils.getFormatBySecond(this.remainM,DateUtils.TIME_FORMAT_3,2);TimerManager.ins().remove(this.refushLabel,this);TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this)};KfArenaMacthPanel.prototype.refushLabel=function(){if(this.remainM>0){this.remainM--;this.timeLabel.text=DateUtils.getFormatBySecond(this.remainM,DateUtils.TIME_FORMAT_3,2)}else{TimerManager.ins().remove(this.refushLabel,this);this.overTime()}};KfArenaMacthPanel.prototype.overTime=function(){this.matchTime.visible=false};KfArenaMacthPanel.prototype.setProgress=function(){var ins=KfArenaSys.ins();var height=this.groupProgress.height;var width=this.groupProgress.width;var curScore=ins.score;this.duanLabel.text="";var scoreMetal=[];var maxScore=10;var scope=10;var progress=0;var curScoreMetalDesc="";var metal=-1;if(GlobalConfig.CrossArenaBase.scoreMetal&&curScore>=0){scoreMetal=GlobalConfig.CrossArenaBase.scoreMetal;for(var i=1;i<scoreMetal.length;++i){if(scoreMetal[i-1]<=curScore&&curScore<scoreMetal[i]||i==scoreMetal.length-1&&scoreMetal[i]<=curScore){maxScore=scoreMetal[i];scope=scoreMetal[i]-scoreMetal[i-1];progress=curScore-scoreMetal[i-1];metal=i-1;break}}}this.dwImg.source="level"+(metal+1);this.rankScore.text=curScore+"/"+maxScore;this.duanLabel.text=KfArenaSys.ins().getDuanName();this.list.dataProvider=new eui.ArrayCollection(KfArenaSys.ins().getDuanRewardByIndex(metal,3));var angle=progress/scope;if(angle>1){angle=1}else if(angle<0){angle=0}if(this._shape==null){this._shape=new egret.Shape;this._shape.x=this.groupProgress.width/2+1;this._shape.y=this.groupProgress.height/2;this.groupProgress.addChild(this._shape)}var shape=this._shape;shape.graphics.clear();shape.graphics.lineStyle(2,194330);shape.graphics.drawArc(0,0,width/2,3*Math.PI/4,3*Math.PI/4+angle*3*Math.PI/2,false)};KfArenaMacthPanel.prototype.updateBtnState=function(){if(!KfArenaSys.ins().getIsJoinTeam()){this.disBtn.label=i18n("KfArenaMacthPanel_5");this.macthBtn.label=i18n("KfArenaMacthPanel_6");this.matchBgImg.source="dengdai_jpg";this.roleGroup.visible=false;this.redPoint.visible=KfArenaRedPoint.ins().redpoint_1>0}else{this.matchBgImg.source="chuangjianzhandui_jpg";this.roleGroup.visible=true;this.redPoint.visible=false;if(KfArenaSys.ins().isTFCaptain)this.disBtn.label=i18n("KfArenaMacthPanel_7");else this.disBtn.label=i18n("KfArenaMacthPanel_8");if(KfArenaSys.ins().macthState==1&&KfArenaSys.ins().isStartIng!=0){this.macthBtn.label=i18n("KfArenaMacthPanel_9")}else{this.macthBtn.label=i18n("KfArenaMacthPanel_10")}}};KfArenaMacthPanel.prototype.onTouch=function(e){if(this.isCancelMacth(e.target)){KfArenaSys.ins().sendCancelMacth();return}if(this.isLeaveTeam(e.target)){KfArenaSys.ins().sendLeaveTeam()}if(KfArenaSys.ins().isStartIng==0){UserTips.ins().showCenterTips(i18n("KfArenaMacthPanel_11"));return}switch(e.target){case this.disBtn:if(!KfArenaSys.ins().getIsJoinTeam()){KfArenaSys.ins().sendCreateTeam();return}break;case this.macthBtn:if(!KfArenaSys.ins().getIsJoinTeam()){KfArenaSys.ins().sendPersonalMatch();return}if(!KfArenaSys.ins().isTFCaptain){UserTips.ins().showCenterTips(i18n("KfArenaMacthPanel_13"));return}KfArenaSys.ins().sendStartMacth();break}};KfArenaMacthPanel.prototype.isLeaveTeam=function(btn){if(btn==this.disBtn&&KfArenaSys.ins().getIsJoinTeam()){return true}return false};KfArenaMacthPanel.prototype.isCancelMacth=function(btn){if(btn==this.macthBtn&&KfArenaSys.ins().macthState==1){return true}return false};KfArenaMacthPanel.prototype.onDetail=function(){ViewManager.ins().open(kfArenaRewardWin)};return KfArenaMacthPanel}(BaseEuiView);__reflect(KfArenaMacthPanel.prototype,"KfArenaMacthPanel");var KfArenaRankPanel=function(_super){__extends(KfArenaRankPanel,_super);function KfArenaRankPanel(){var _this=_super.call(this)||this;_this.isSetFirst=true;_this.name=i18n("KfArenaRankPanel_0");return _this}KfArenaRankPanel.prototype.childrenCreated=function(){this.list.itemRenderer=KfArenaRankItemRender;this.rankDatas=new eui.ArrayCollection;this.list.dataProvider=this.rankDatas;this.rank0.index=0;this.rank1.index=1;this.rank2.index=2;this.firstGroup.visible=false;this.state.visible=true;this.nodataShowGroup.visible=true;this.serverId0.text="";this.vip0.visible=false;this.firstNameTxt0.text="";this.score0.text="";this.seasonTitle0.text=""};KfArenaRankPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(KfArenaSys.ins().postRank,this.upData);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayer);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.list.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);KfArenaSys.ins().sendRank()};KfArenaRankPanel.prototype.upData=function(){var rankDataList=KfArenaSys.ins().rankDataList;if(this.firstData||!rankDataList||rankDataList.length<=0)return;var firstData=KfArenaSys.ins().rankDataList[0];this.firstData=firstData;var rankDatas=[];for(var i=1;i<rankDataList.length;++i){rankDatas.push(rankDataList[i])}this.rankDatas.replaceAll(rankDatas);this.selfPos0.text=KfArenaSys.ins().ownRank>0?KfArenaSys.ins().ownRank:i18n("KfArenaRankPanel_1");if(!firstData)return;this.firstGroup.visible=true;this.state.visible=false;this.nodataShowGroup.visible=false;this.serverId0.text=SelectServerMgr.ins().getServerNameByID(firstData.servId);this.vip0.visible=firstData.vip>0;this.firstNameTxt0.text=firstData.playerName;this.score0.text=firstData.score+"";this.seasonTitle0.text=KfArenaSys.ins().getDuanName(false,firstData.score);UserReadPlayer.ins().sendFindPlayer(firstData.playerId,firstData.servId)};KfArenaRankPanel.prototype.openOtherPlayer=function(otherPlayerData){if(this.isSetFirst){this.isSetFirst=false;this.rank0.data={otherPlayerData:otherPlayerData};this.rank1.data={otherPlayerData:otherPlayerData};this.rank2.data={otherPlayerData:otherPlayerData}}};KfArenaRankPanel.prototype.onClick=function(e){switch(e.currentTarget){case this.list:var selectedItem=this.list.selectedItem;if(selectedItem){this._openOtherWin=true;UserReadPlayer.ins().sendFindPlayer(selectedItem["playerId"],selectedItem["servId"])}break;case this.rank0:case this.rank1:case this.rank2:if(this.firstData){this._openOtherWin=true;UserReadPlayer.ins().sendFindPlayer(this.firstData.playerId,this.firstData.servId)}break}};KfArenaRankPanel.prototype.openOtherPlayerView=function(otherPlayerData){if(this._openOtherWin){this._openOtherWin=false;ViewManager.ins().open(RRoleWin,otherPlayerData)}};KfArenaRankPanel.prototype.close=function(){_super.prototype.close.call(this);this.list.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};return KfArenaRankPanel}(BaseEuiView);__reflect(KfArenaRankPanel.prototype,"KfArenaRankPanel");var KfArenaReliveWin=function(_super){__extends(KfArenaReliveWin,_super);function KfArenaReliveWin(){var _this=_super.call(this)||this;_this.remainM=0;_this.skinName="WorldBossGoldSkin";return _this}KfArenaReliveWin.prototype.childrenCreated=function(){this.reliveBtn.visible=false;this.alive.visible=false};KfArenaReliveWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setWin(param[0],param[1]);this.reliveGroup.visible=false;this.bg.height=60};KfArenaReliveWin.prototype.setWin=function(cd,killerHandler){if(killerHandler>0){var killer=EntityManager.ins().getEntityByHandle(killerHandler);var str="";if(killer){var masterKiller=EntityManager.ins().getEntityByHandle(killer.infoModel.masterHandle);if(killer instanceof CharRole){str=killer.infoModel.name}else if(killer.infoModel.masterHandle&&masterKiller){str=""+masterKiller.infoModel.name}else{var boss=i18n("Boss_0");str=""+boss+killer.infoModel.name}}this.killTips.textFlow=TextFlowMaker.generateTextFlow1(i18n("KfArenaReliveWin_0",2343978,str))}TimerManager.ins().remove(this.refushLabel,this);this.remainM=cd;this.reliveTimesTxt.text=cd+i18n("KfArenaReliveWin_1");if(cd>0){TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this)}else{this.overTime()}};KfArenaReliveWin.prototype.refushLabel=function(){if(this.remainM>0){this.remainM--;this.reliveTimesTxt.text=this.remainM+i18n("KfArenaReliveWin_2")}else{TimerManager.ins().remove(this.refushLabel,this);this.overTime()}};KfArenaReliveWin.prototype.overTime=function(){ViewManager.ins().close(KfArenaReliveWin)};return KfArenaReliveWin}(BaseEuiView);__reflect(KfArenaReliveWin.prototype,"KfArenaReliveWin");ViewManager.ins().reg(KfArenaReliveWin,LayerManager.UI_Popup);var KfArenaResultWin=function(_super){__extends(KfArenaResultWin,_super);function KfArenaResultWin(){var _this=_super.call(this)||this;_this.repeatCnt=10;_this.skinName="KfArenaResultSkin";return _this}KfArenaResultWin.prototype.childrenCreated=function(){this.extrReward.itemRenderer=ItemBase;this.list.itemRenderer=KfArenaDataItem};KfArenaResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.sureBtn,this.onTouch);this.blueScore.text=KfArenaSys.ins().teamScore;this.redScore.text=KfArenaSys.ins().enermyScore;this.list.dataProvider=new eui.ArrayCollection(param[2]);this.extrReward.dataProvider=new eui.ArrayCollection(param[3]);this.quitTime=this.repeatCnt-1;TimerManager.ins().doTimer(1e3,this.repeatCnt,this.onTime,this);if(KfArenaSys.ins().myCampId==KfArenaSys.ins().winCamp){this.tag0.source="kfwin";this.tag1.source="kflose"}else{this.tag0.source="kflose";this.tag1.source="kfwin"}var info=KfArenaSys.ins().getNextDuanInfo();var str=i18n("KfArenaResultWin_0")+info.num+i18n("KfArenaResultWin_1")+info.dname;this.tip.textFlow=TextFlowMaker.generateTextFlow(str)};KfArenaResultWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.sureBtn:this.onExit();break}};KfArenaResultWin.prototype.onTime=function(){if(this.quitTime>1){this.quitTime--;this.sureBtn.label=i18n("KfArenaResultWin_3",this.quitTime)}else{this.onExit()}};KfArenaResultWin.prototype.onExit=function(){TimerManager.ins().remove(this.onTime,this);ViewManager.ins().close(this);if(ViewManager.ins().isShow(KfArenaFightWin)){ViewManager.ins().close(KfArenaFightWin)}UserFb.ins().sendExitFb()};return KfArenaResultWin}(BaseEuiView);__reflect(KfArenaResultWin.prototype,"KfArenaResultWin");ViewManager.ins().reg(KfArenaResultWin,LayerManager.UI_Popup);var kfArenaRewardWin=function(_super){__extends(kfArenaRewardWin,_super);function kfArenaRewardWin(){var _this=_super.call(this)||this;_this.skinName="kfArenaRewardSkin";return _this}kfArenaRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.close);this.list.itemRenderer=kfArenaRewardItem;var attachments=[];var len=KfArenaSys.ins().getDuanNameCnt();for(var i=0;i<len;++i){attachments.push(i+1)}this.list.dataProvider=new eui.ArrayCollection(attachments)};kfArenaRewardWin.prototype.close=function(){_super.prototype.close.call(this);ViewManager.ins().close(this)};return kfArenaRewardWin}(BaseEuiView);__reflect(kfArenaRewardWin.prototype,"kfArenaRewardWin");ViewManager.ins().reg(kfArenaRewardWin,LayerManager.UI_Popup);var KfArenaWin=function(_super){__extends(KfArenaWin,_super);function KfArenaWin(){var _this=_super.call(this)||this;_this.skinName="KfArenaSkin";_this.isTopLevel=true;return _this}KfArenaWin.prototype.childrenCreated=function(){this.viewStack.selectedIndex=0;this.tab.dataProvider=this.viewStack};KfArenaWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.tab.selectedIndex=this.viewStack.selectedIndex=param[0];this.addTouchEvent(this.closeBtn,this.onTouch);this.addChangeEvent(this.tab,this.onTabTouch);this.addTouchEvent(this.seeRule,this.onTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.observe(KfArenaRedPoint.ins().postRedPoint,this.redPointEx);this.setOpenIndex(this.tab.selectedIndex);this.redPointEx()};KfArenaWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(e.currentTarget.selectedIndex)){e.preventDefault();return}};KfArenaWin.prototype.checkIsOpen=function(index){return true};KfArenaWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};KfArenaWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[34].text);break}};KfArenaWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex);this.redPointEx()};KfArenaWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case KfArenaWin.Page_Select_Macth:this.macthPanel.open();break;case KfArenaWin.Page_Select_Rank:this.rankPanel.open();break;case KfArenaWin.Page_Select_Join:this.joinPanel.open();break;case KfArenaWin.Page_Select_Duan:this.duanPanel.open();break}};KfArenaWin.prototype.redPointEx=function(){this.redPoint0.visible=KfArenaRedPoint.ins().redpoint_1>0;this.redPoint1.visible=false;this.redPoint2.visible=KfArenaRedPoint.ins().redpoint_2>0;this.redPoint3.visible=KfArenaRedPoint.ins().redpoint_3>0};KfArenaWin.Page_Select_Macth=0;KfArenaWin.Page_Select_Rank=1;KfArenaWin.Page_Select_Join=2;KfArenaWin.Page_Select_Duan=3;return KfArenaWin}(BaseEuiView);__reflect(KfArenaWin.prototype,"KfArenaWin");ViewManager.ins().reg(KfArenaWin,LayerManager.UI_Main);var kfReceiveInviteWin=function(_super){__extends(kfReceiveInviteWin,_super);function kfReceiveInviteWin(){var _this=_super.call(this)||this;_this.skinName="kfReceiveInviteSkin";_this.isTopLevel=true;return _this}kfReceiveInviteWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var memberNames=args[0];if(memberNames&&memberNames.length){this.currentState="newMemberView";var nameStr="";for(var i=0;i<memberNames.length;++i){nameStr+=memberNames[i];if(i<memberNames.length-1){nameStr+="、"}}this.addTouchEvent(this.notBtn,this.onClose);this.labelTips.text=nameStr+"已加入您的组队"}else{this.currentState="invitorView";this.index=args[0];this.inviteData=KfArenaSys.ins().inviteDataList[this.index];this.addTouchEvent(this.notBtn,this.onTouch);this.addTouchEvent(this.sureBtn,this.onTouch);this.update()}};kfReceiveInviteWin.prototype.update=function(){this.nameLabel.text=this.inviteData.name;this.powerLabel.text=i18n("KfReceiveInviteWin_0",this.inviteData.power);this.scoreLabel.text=i18n("KfReceiveInviteWin_1",this.inviteData.score);this.winRateLabel.text=i18n("KfReceiveInviteWin_2",this.inviteData.winRate)};kfReceiveInviteWin.prototype.onTouch=function(e){switch(e.target){case this.notBtn:KfArenaSys.ins().sendRespondInvite(this.inviteData.roleId,0);KfArenaSys.ins().inviteDataList.slice(this.index,1);ViewManager.ins().close(this);break;case this.sureBtn:KfArenaSys.ins().sendRespondInvite(this.inviteData.roleId,1);KfArenaSys.ins().inviteDataList.slice(this.index,1);ViewManager.ins().close(this);break}};kfReceiveInviteWin.prototype.onClose=function(){this.removeObserve();ViewManager.ins().close(this)};return kfReceiveInviteWin}(BaseEuiView);__reflect(kfReceiveInviteWin.prototype,"kfReceiveInviteWin");ViewManager.ins().reg(kfReceiveInviteWin,LayerManager.UI_Popup);var KFBossRedpoint=function(_super){__extends(KFBossRedpoint,_super);function KFBossRedpoint(){var _this=_super.call(this)||this;_this.redpoints=[];_this.associated(_this.postRedPoint,KFBossSys.ins().postBossInfo,KFBossSys.ins().postBossRevive,KFBossSys.ins().postInfo);return _this}KFBossRedpoint.prototype.postRedPoint=function(){this.redpoints=[];this.redpoint=0;if(!KFBossSys.ins().isOpen())return 0;for(var _i=0,_a=KFBossSys.ins().fbInfo;_i<_a.length;_i++){var info=_a[_i];if(!info)continue;var index=info.dpId;var dp=GlobalConfig.CrossBossConfig[info.dpId];var boo=UserZs.ins().lv>=dp.levelLimit[0]/1e3&&UserZs.ins().lv<=dp.levelLimit[1]/1e3;if(boo)boo=info.flagRefTimer-egret.getTimer()<0&&KFBossSys.ins().flagTimes>0||info.bossRefTimer-egret.getTimer()<0&&KFBossSys.ins().bossTimes>0;this.redpoints[info.dpId]=boo?1:0}this.redpoint=this.redpoints.indexOf(1)>-1?1:0;return this.redpoint};KFBossRedpoint.ins=function(){return _super.ins.call(this)};return KFBossRedpoint}(BaseSystem);__reflect(KFBossRedpoint.prototype,"KFBossRedpoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.kfBossRedpoint=KFBossRedpoint.ins.bind(KFBossRedpoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var KFBossSys=function(_super){__extends(KFBossSys,_super);function KFBossSys(){var _this=_super.call(this)||this;_this.fbInfo=[];_this.isKFBossBattle=false;_this.dropRecordDataList=[];_this.dropBestRecordDataList=[];_this.sysId=PackageID.KFBoss;_this.regNetMsg(1,_this.postBossInfo);_this.regNetMsg(2,_this.postAscriptionChange);_this.regNetMsg(3,_this.postRevive);_this.regNetMsg(5,_this.postBossRevive);_this.regNetMsg(7,_this.postRefFlag);_this.regNetMsg(8,_this.postCollectFlag);_this.regNetMsg(9,_this.postInfo);_this.regNetMsg(10,_this.doResult);_this.regNetMsg(11,_this.postDropList);_this.regNetMsg(12,_this.postBroadcastResult);_this.observe(UserBoss.ins().postBossAppear,function(){if(_this.isKFBossBattle)ViewManager.ins().open(BossBelongPanel)});_this.observe(UserBoss.ins().postBossDisappear,function(){if(_this.isKFBossBattle)ViewManager.ins().close(BossBelongPanel)});_this.observe(GameLogic.ins().postEnterMap,function(){if(GameMap.fbType==UserFb.FB_TYPE_KF_BOSS){_this.postEnterKFBossFb()}else if(GameMap.lastFbTyp==UserFb.FB_TYPE_KF_BOSS){_this.postQuiKFBossFb()}});return _this}KFBossSys.prototype.postBossInfo=function(bytes){var count=bytes.readShort();this.fbInfo=[];for(var i=0;i<count;i++){var info=new KFBossInfoData(bytes);this.fbInfo[info.dpId]=info}};KFBossSys.prototype.postAscriptionChange=function(bytes){var oldHandle=bytes.readDouble();var nowHandle=bytes.readDouble();var oldName="";if(oldHandle>0){var oldChar=EntityManager.ins().getMasterList(oldHandle);if(oldChar&&oldChar[0]&&oldChar[0].infoModel){oldName=oldChar[0].infoModel.name}}UserBoss.ins().postBelongChange(nowHandle,oldHandle,oldName)};KFBossSys.prototype.postRevive=function(bytes){var cd=bytes.readInt();var killHandel=bytes.readDouble();if(cd>0)ViewManager.ins().open(KFBossReliveWin,cd,killHandel);else{ViewManager.ins().close(KFBossReliveWin);if(KFServerSys.ins().isKF){var yb=Actor.yb-GlobalConfig.CrossBossBase.rebornCost;Actor.ins().postYbChange(yb)}}};KFBossSys.prototype.postBossRevive=function(bytes){var type=bytes.readShort();var id=bytes.readShort();if(this.fbInfo[id]){if(type==1)this.fbInfo[id].flagRefTimer=egret.getTimer();else if(type==2)this.fbInfo[id].bossRefTimer=egret.getTimer()}};KFBossSys.prototype.postRefFlag=function(bytes){this.flagHandle=bytes.readDouble();this.flagCD=bytes.readInt()*1e3+egret.getTimer();if(GameMap.fubenID!=GlobalConfig.CrossBossConfig[8].fbid)this.flagHandle=100010100101;else this.flagHandle=0};KFBossSys.prototype.postCollectFlag=function(bytes){var handle=bytes.readDouble();var lefttimer=bytes.readInt();if(handle&&handle==Actor.handle&&lefttimer){ViewManager.ins().open(CollectWin,handle,0,lefttimer);GameLogic.ins().currAttackHandle=0}else ViewManager.ins().close(CollectWin)};KFBossSys.prototype.postInfo=function(bytes){this.flagTimes=bytes.readShort();this.bossTimes=bytes.readShort();var cd=bytes.readShort();this.enterCD=cd*1e3+egret.getTimer();console.log("kfBossSys postInfo enterCD = "+KFBossSys.ins().enterCD+" cd = "+cd)};KFBossSys.prototype.doResult=function(bytes){var type=bytes.readShort();var awards=[];var count=bytes.readShort();var isFlag=type==1;for(var i=0;i<count;i++){var awardData=new RewardData;awardData.type=bytes.readInt();awardData.count=bytes.readInt();awardData.id=bytes.readInt();awards.push(awardData);if(awardData.type==0&&awardData.id!=1&&awardData.id!=2&&awardData.id!=MoneyConst.rune){}else if(!isFlag){DropHelp.addDrop([DropHelp.tempDropPoint.x!=0?DropHelp.tempDropPoint.x:Math.floor(EntityManager.ins().getNoDieRole().x/GameMap.CELL_SIZE),DropHelp.tempDropPoint.y!=0?DropHelp.tempDropPoint.y:Math.floor(EntityManager.ins().getNoDieRole().y/GameMap.CELL_SIZE),awardData])}}if(isFlag){ResultManager.ins().create(GameMap.fbType,awards,isFlag)}else{var f=function(){ResultManager.ins().create(GameMap.fbType,awards,isFlag)};var actor_1=EntityManager.ins().getMainRole(0);DropHelp.start(actor_1);DropHelp.addCompleteFunc(f,this)}};KFBossSys.prototype.postDropList=function(bytes){this.dropRecordDataList=[];this.dropBestRecordDataList=[];var len=bytes.readShort();for(var i=0;i<len;i++){this.dropRecordDataList.push(new KFDropRecordData(bytes))}len=bytes.readShort();for(var i=0;i<len;i++){var data=new KFDropRecordData(bytes);data.isBest=true;this.dropBestRecordDataList.push(data)}};KFBossSys.prototype.postBroadcastResult=function(bytes){var servId=bytes.readInt();var nick=bytes.readString();var handle=bytes.readDouble();var actor=EntityManager.ins().getEntityByHandle(handle);if(!actor||actor.action==EntityAction.DIE||actor==EntityManager.ins().getNoDieRole()){return"S"+servId+nick}var awards=[];var count=bytes.readShort();for(var i=0;i<count;i++){var awardData=new RewardData;awardData.type=bytes.readInt();awardData.id=bytes.readInt();awardData.count=bytes.readInt();awards.push(awardData);if(awardData.type==0&&awardData.id!=1&&awardData.id!=2&&awardData.id!=MoneyConst.rune){}else{DropHelp.addDrop([DropHelp.tempDropPoint.x!=0?DropHelp.tempDropPoint.x:Math.floor(actor.x/GameMap.CELL_SIZE),DropHelp.tempDropPoint.y!=0?DropHelp.tempDropPoint.y:Math.floor(actor.y/GameMap.CELL_SIZE),awardData])}}var f=function(){ResultManager.ins().create(GameMap.fbType,awards,false,actor)};DropHelp.start(actor);DropHelp.addCompleteFunc(f,this);return"S"+servId+nick};KFBossSys.prototype.postEnterKFBossFb=function(){this.isKFBossBattle=true;if(ViewManager.ins().isShow(BossBloodPanel))ViewManager.ins().open(BossBloodPanel);ViewManager.ins().close(KFBossShowWin);ViewManager.ins().open(KFBossSceneWin)};KFBossSys.prototype.postQuiKFBossFb=function(){ViewManager.ins().close(BossBelongPanel);this.isKFBossBattle=false;this.flagHandle=0;ViewManager.ins().close(KFBossReliveWin);ViewManager.ins().close(KFBossSceneWin)};KFBossSys.prototype.sendBossInfo=function(){this.sendBaseProto(1)};KFBossSys.prototype.sendClearReliveCD=function(){this.sendBaseProto(3)};KFBossSys.prototype.sendCleanBelong=function(){this.sendBaseProto(4)};KFBossSys.prototype.sendEnter=function(fbid){var bytes=this.getBytes(6);bytes.writeInt(fbid);this.sendToServer(bytes)};KFBossSys.prototype.sendCollectFlag=function(){this.sendBaseProto(8)};KFBossSys.prototype.sendDropList=function(){this.sendBaseProto(11)};KFBossSys.ins=function(){return _super.ins.call(this)};KFBossSys.prototype.isOpen=function(){if(!GlobalConfig.CrossBossBase.limitZsLv)GlobalConfig.CrossBossBase.limitZsLv=5;return GlobalConfig.CrossBossBase.openDay<=GameServer.serverOpenDay+1&&UserZs.ins().lv>=GlobalConfig.CrossBossBase.limitZsLv};return KFBossSys}(BaseSystem);__reflect(KFBossSys.prototype,"KFBossSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.kfBossSys=KFBossSys.ins.bind(KFBossSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var KFBossData=function(){function KFBossData(){}return KFBossData}();__reflect(KFBossData.prototype,"KFBossData");var KFBossInfoData=function(){function KFBossInfoData(bytes){this.dpId=bytes.readShort();this.serverId=bytes.readShort();this.bossRefTimer=bytes.readInt()*1e3+egret.getTimer();this.flagRefTimer=bytes.readInt()*1e3+egret.getTimer();if(this.dpId==8)this.flagRefTimer=Number.MAX_VALUE+egret.getTimer()}return KFBossInfoData}();__reflect(KFBossInfoData.prototype,"KFBossInfoData");var KFBossReliveWin=function(_super){__extends(KFBossReliveWin,_super);function KFBossReliveWin(){var _this=_super.call(this)||this;_this.remainM=0;return _this}KFBossReliveWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WorldBossGoldSkin";this.aliveNum=0};KFBossReliveWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.reliveBtn,this.onRelive);this.addTouchEvent(this.exitBtn,this.onTap);this.setWin(param[0],param[1])};KFBossReliveWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}ViewManager.ins().close(WorldBossCdWin)};KFBossReliveWin.prototype.setWin=function(cd,killerHandler){if(killerHandler>0){var killer=EntityManager.ins().getEntityByHandle(killerHandler);var str="";if(killer){var masterKiller=EntityManager.ins().getEntityByHandle(killer.infoModel.masterHandle);if(killer instanceof CharRole){str=killer.infoModel.name}else if(killer.infoModel.masterHandle&&masterKiller){str=""+masterKiller.infoModel.name}else{var boss=i18n("Boss_0");str=""+boss+killer.infoModel.name}}this.killTips.textFlow=TextFlowMaker.generateTextFlow1(i18n("KFBossReliveWin_0",2343978,str));this.alive.visible=false;if(this.alive.visible)this.alive.text=i18n("KFBossReliveWin_1",this.aliveNum)}this.reliveBtn.label=i18n("KFBossReliveWin_2",GlobalConfig.CrossBossBase.rebornCost);this.reliveTimesTxt.text=cd+i18n("KFBossReliveWin_3");TimerManager.ins().remove(this.refushLabel,this);this.remainM=cd;TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this)};KFBossReliveWin.prototype.refushLabel=function(){this.remainM--;this.reliveTimesTxt.text=this.remainM+i18n("KFBossReliveWin_4");if(this.remainM<0){TimerManager.ins().remove(this.refushLabel,this);this.overTime()}};KFBossReliveWin.prototype.overTime=function(){ViewManager.ins().close(this);ViewManager.ins().close(WorldBossCdWin)};KFBossReliveWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};KFBossReliveWin.prototype.onTap=function(e){switch(e.currentTarget){case this.exitBtn:UserFb.ins().sendExitFb();break}};KFBossReliveWin.prototype.onRelive=function(e){if(this.aliveNum){KFBossSys.ins().sendClearReliveCD();return}if(GlobalFun.checkMoney(GlobalConfig.CrossBossBase.rebornCost,MoneyConst.yuanbao,i18n("KFBossReliveWin_5")))KFBossSys.ins().sendClearReliveCD()};return KFBossReliveWin}(BaseEuiView);__reflect(KFBossReliveWin.prototype,"KFBossReliveWin");ViewManager.ins().reg(KFBossReliveWin,LayerManager.UI_Popup);var KFBossResultWin=function(_super){__extends(KFBossResultWin,_super);function KFBossResultWin(){var _this=_super.call(this)||this;_this._quitTime=0;return _this}KFBossResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="CityResultSkin";this.listItem.itemRenderer=ItemBase;this.listData0=new eui.ArrayCollection;this.winnerEff=new MovieClip;this.winnerEff.x=41;this.winnerEff.y=41;this.winnerEff.touchEnabled=false};KFBossResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this.addTouchEvent(this.closeBtn,this.onTap);this.bg.source="win_png";this.closeBtn.label=i18n("KFBossResultWin_0");this.title.source="win_02";this.roleTitleLabel.text=param[1]?i18n("KFBossResultWin_1"):i18n("KFBossResultWin_2");if(!this.winnerEff.parent)this.effGroup.addChild(this.winnerEff);this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1);var actor=param[2];var tname="";var labelItem="";var role;if(actor&&actor.infoModel&&actor.infoModel.handle!=Actor.handle){tname=actor.infoModel.name;role=actor.infoModel;labelItem=i18n("KFBossResultWin_5")}else{tname=Actor.myName;role=SubRoles.ins().getSubRoleByIndex(0);labelItem=i18n("KFBossResultWin_3")}tname=StringUtils.replaceStr(tname,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+"");this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(tname);this.labelItem.text=labelItem;if(role)this.roleIcon.icon="yuanhead"+role.job+role.sex;this.roleIcon["jobImg"].visible=false;var rewards=param[0];if(rewards)this.setRewardList(rewards);this._quitTime=6;TimerManager.ins().doTimer(1e3,this._quitTime+1,this.onTimer,this);this.onTimer()};KFBossResultWin.prototype.setRewardList=function(rewards){if(rewards===void 0){rewards=[]}var coinData=[];var emblemData=[];var itemData=[];var soulData=[];var rewardList=[];for(var i=0;i<rewards.length;i++){var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];if(ItemConfig.getType(itemConfig)==1){if(emblemData.length){var ishave=false;for(var j=0;j<emblemData.length;j++){if(emblemData[j].id==rewards[i].id){emblemData[j].count+=rewards[i].count;ishave=true;break}}if(!ishave)emblemData.push(rewards[i])}else{emblemData.push(rewards[i])}continue}if(rewards[i].type==0){if(rewards[i].id==MoneyConst.soul){soulData.push(rewards[i])}else{coinData.push(rewards[i])}}else{itemData.push(rewards[i])}}itemData.sort(this.RuleSortByItem);rewardList=soulData.concat(coinData,emblemData,itemData);this.listItem.dataProvider=new eui.ArrayCollection(rewardList)};KFBossResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap)};KFBossResultWin.prototype.onTimer=function(){this.closeBtn.label=i18n("KFBossResultWin_4",--this._quitTime);if(this._quitTime<=0){ViewManager.ins().close(this)}};KFBossResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};KFBossResultWin.prototype.RuleSortByItem=function(a,b){var aItem=GlobalConfig.ItemConfig[a.id];var bItem=GlobalConfig.ItemConfig[b.id];var aq=ItemConfig.getQuality(aItem);var bq=ItemConfig.getQuality(bItem);if(aq>bq)return-1;else if(aq<bq)return 1;else{return 0}};return KFBossResultWin}(BaseEuiView);__reflect(KFBossResultWin.prototype,"KFBossResultWin");ViewManager.ins().reg(KFBossResultWin,LayerManager.UI_Popup);var KFBossSceneWin=function(_super){__extends(KFBossSceneWin,_super);function KFBossSceneWin(){var _this=_super.call(this)||this;_this.skinName="kfBossSceneSkin";return _this}KFBossSceneWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(KFBossSys.ins().postBroadcastResult,this.bossEnd);this.endGroup.visible=false;var curFbId=GameMap.fubenID;for(var key in GlobalConfig.CrossBossConfig){if(curFbId==GlobalConfig.CrossBossConfig[key].fbid){var dp=GlobalConfig.CrossBossConfig[key];var info=KFBossSys.ins().fbInfo[dp.id];this.nameTxt.text=dp.sceneName==i18n("KFBossSceneWin_0")?i18n("KFBossSceneWin_1",info.serverId):i18n("KFBossSceneWin_2");break}}};KFBossSceneWin.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}TimerManager.ins().removeAll(this);Tween.removeTweens(this.endGroup)};KFBossSceneWin.prototype.bossEnd=function(winner){var _this=this;if(GameMap.fbType==UserFb.FB_TYPE_KF_BOSS){this.endGroup.visible=true;this.endGroup.alpha=1;this.winnerName.text=i18n("KFBossSceneWin_3",winner);TimerManager.ins().doTimer(1e4,1,function(){Tween.get(_this.endGroup).to({alpha:0},300).call(function(){_this.endGroup.visible=false})},this)}};return KFBossSceneWin}(BaseEuiView);__reflect(KFBossSceneWin.prototype,"KFBossSceneWin");ViewManager.ins().reg(KFBossSceneWin,LayerManager.UI_Main);var KFBossShowWin=function(_super){__extends(KFBossShowWin,_super);function KFBossShowWin(){var _this=_super.call(this)||this;_this.skinName="KFBossShowSkin";return _this}KFBossShowWin.prototype.childrenCreated=function(){this.boss.touchEnabled=false;this.boss.touchChildren=false;this.dropRewardList.itemRenderer=ItemBase};KFBossShowWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.challengeBtn,this.onTouch);this.addTouchEvent(this.bgClose,this.onTouch);this.fbId=args[0];this.dp=GlobalConfig.CrossBossConfig[this.fbId];this.showAward();this.showBoss();this.bossName.source="kf_name_"+this.dp.bossId};KFBossShowWin.prototype.showAward=function(){var rewardShow=this.dp.belongRewardshow;this.dropRewardList.dataProvider=new eui.ArrayCollection(rewardShow.concat())};KFBossShowWin.prototype.showBoss=function(){if(!this.bossMc){this.bossMc=ObjectPool.pop("MovieClip");this.bossMc.scaleX=-1;this.bossMc.scaleY=1;this.bossMc.x=78;this.bossMc.y=50;this.boss.addChild(this.bossMc)}var bossId=this.dp.bossId;var bossBaseConfig=GlobalConfig.MonstersConfig[bossId];this.bossMc.playFile(RES_DIR_MONSTER+("monster"+bossBaseConfig.avatar+"_3s"),-1)};KFBossShowWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.challengeBtn:var cd=(KFBossSys.ins().enterCD-egret.getTimer())/1e3>>0;if(cd>0){UserTips.ins().showTips(i18n("KFBossShowWin_0",cd));return}if(UserZs.ins().lv<this.dp.levelLimit[0]/1e3||UserZs.ins().lv>this.dp.levelLimit[1]/1e3){UserTips.ins().showTips(i18n("KFBossShowWin_1",this.dp.levelLimit[0]/1e3>>0));return}KFBossSys.ins().sendEnter(this.fbId);break}};return KFBossShowWin}(BaseEuiView);__reflect(KFBossShowWin.prototype,"KFBossShowWin");ViewManager.ins().reg(KFBossShowWin,LayerManager.UI_Popup);var KFBossUIWin=function(_super){__extends(KFBossUIWin,_super);function KFBossUIWin(){var _this=_super.call(this)||this;_this.skinName="KFbossUISkin";_this.attackList.itemRenderer=TargetMemberHeadRender;_this.attackedList.itemRenderer=TargetMemberHeadRender;return _this}KFBossUIWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}};KFBossUIWin.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}};return KFBossUIWin}(BaseEuiView);__reflect(KFBossUIWin.prototype,"KFBossUIWin");ViewManager.ins().reg(KFBossUIWin,LayerManager.UI_Main);var KFBossWin=function(_super){__extends(KFBossWin,_super);function KFBossWin(){var _this=_super.call(this)||this;_this.MAX=8;_this.isTopLevel=true;_this.skinName="KFBossSkin";_this.MAX=CommonUtils.getObjectLength(GlobalConfig.CrossBossConfig);for(var i=1;i<=_this.MAX;i++){_this["island"+i].island.source="kf_boss_area"+i;_this["island"+i].touchChildren=false;_this["island"+i].filters=FilterUtil.ARRAY_GRAY_FILTER;var dp=GlobalConfig.CrossBossConfig[i];var zsLvlimit=[dp.levelLimit[0]/1e3>>0,dp.levelLimit[1]/1e3>>0];_this["island"+i].info.text=i18n("KFBossWin_0",zsLvlimit[0],zsLvlimit[1]);_this["island"+i].info.textColor=zsLvlimit[0]<=UserZs.ins().lv&&UserZs.ins().lv<=zsLvlimit[1]?12432814:ColorUtil.RED_COLOR_N;_this["island"+i].serverInfo.visible=false}return _this}KFBossWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.observe(KFBossSys.ins().postBossInfo,this.refData);this.observe(KFBossSys.ins().postBossRevive,this.refData);this.observe(KFBossRedpoint.ins().postRedPoint,this.refRedpoint);this.upCurState();KFBossSys.ins().sendBossInfo()};KFBossWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this)};KFBossWin.prototype.upCurState=function(){if(KFBossSys.ins().fbInfo[6])this.currentState="6";else if(KFBossSys.ins().fbInfo[7])this.currentState="7";else this.currentState="5";this.refData();this.refRedpoint()};KFBossWin.prototype.refData=function(){this.flagTimes.text=KFBossSys.ins().flagTimes+"";this.bossTimes.text=KFBossSys.ins().bossTimes+"";for(var _i=0,_a=KFBossSys.ins().fbInfo;_i<_a.length;_i++){var info=_a[_i];if(!info)continue;var index=info.dpId;if(this["island"+index]){var dp=GlobalConfig.CrossBossConfig[info.dpId];this["island"+index].serverInfo.visible=true;this["island"+index].headGroup.visible=false;this["island"+index].head.source="";this["island"+index].name=info.dpId;this["island"+index].filters=[];if(info.serverId){var servers=SelectServerMgr.ins().servers;var serverName="";for(var i=0;servers&&i<servers.length;++i){if(servers[i]&&info.serverId==parseInt(servers[i].id)){serverName=servers[i].servername}}for(var _b=0,_c=["(","（"];_b<_c.length;_b++){var sep=_c[_b];var epos=serverName.indexOf(sep);if(epos>0){serverName=serverName.substr(0,epos)+"\n"+serverName.substr(epos);break}}this["island"+index].serverInfo.visible=true;this["island"+index].serverName.text=""+(info.serverId==LocationProperty.srvid?"本服":""+serverName);if(info.serverId==LocationProperty.srvid){this["island"+index].headGroup.visible=true;var roleData=SubRoles.ins().getSubRoleByIndex(0);this["island"+index].head.source="yuanhead"+roleData.job+roleData.sex}}else this["island"+index].serverInfo.visible=false}}TimerManager.ins().remove(this.onTimer,this);TimerManager.ins().doTimer(1e3,0,this.onTimer,this);this.onTimer()};KFBossWin.prototype.onTimer=function(){for(var _i=0,_a=KFBossSys.ins().fbInfo;_i<_a.length;_i++){var info=_a[_i];if(!info)continue;if(info.bossRefTimer==0)continue;var dp=GlobalConfig.CrossBossConfig[info.dpId];var t=(info.bossRefTimer-egret.getTimer())/1e3>>0;var time="";if(t>0)time="\n"+DateUtils.getFormatBySecond(t);this["island"+info.dpId].info.text=i18n("KFBossWin_2",dp.levelLimit[0]/1e3>>0,dp.levelLimit[1]/1e3>>0)+time}};KFBossWin.prototype.refRedpoint=function(){for(var _i=0,_a=KFBossSys.ins().fbInfo;_i<_a.length;_i++){var info=_a[_i];if(!info)continue;if(this["island"+info.dpId]){this["island"+info.dpId].redPoint.visible=KFBossRedpoint.ins().redpoints[info.dpId]}}};KFBossWin.prototype.onTouch=function(e){switch(e.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[33].text);break;case this.closeBtn:ViewManager.ins().close(this);break;default:if(e.target instanceof eui.Component){var fbId=parseInt(e.target.name);if(!fbId){UserTips.ins().showTips(i18n("KFBossWin_3"));return}ViewManager.ins().open(KFBossShowWin,fbId)}}};KFBossWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var boo=KFBossSys.ins().isOpen();if(!boo){if(!GlobalConfig.CrossBossBase.limitZsLv)GlobalConfig.CrossBossBase.limitZsLv=5;var level=GlobalConfig.CrossBossBase.limitZsLv;var day=GlobalConfig.CrossBossBase.openDay;UserTips.ins().showTips(i18n("KFBossWin_5",level,day))}return boo};__decorate([callLater],KFBossWin.prototype,"refData",null);__decorate([callLater],KFBossWin.prototype,"refRedpoint",null);return KFBossWin}(BaseEuiView);__reflect(KFBossWin.prototype,"KFBossWin");ViewManager.ins().reg(KFBossWin,LayerManager.UI_Main);var KFBattleWin=function(_super){__extends(KFBattleWin,_super);function KFBattleWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="KFFieldWinSkin";return _this}KFBattleWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=param[0]?param[0]:0;this.addTouchEvent(this.closeBtn,this.onTouch);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.setOpenIndex(this.oldIndex);this.observe(KFBattleRedPoint.ins().postRedPoint,this.refRedpoint);this.observe(KfArenaRedPoint.ins().postRedPoint,this.refRedpoint);this.refRedpoint()};KFBattleWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.viewStack.getElementAt(this.oldIndex))this.viewStack.getElementAt(this.oldIndex)["close"]()};KFBattleWin.prototype.onTabTouch=function(e){var index=this.tab.selectedIndex;this.setOpenIndex(index)};KFBattleWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};KFBattleWin.prototype.checkIsOpen=function(index){return true};KFBattleWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case 0:this.kffieldPanel.open();break;case 1:this.kffieldRecordPanel.open();break;case 2:this.rankPanel.open();break}if(this.oldIndex!=selectedIndex){if(this.tab.selectedIndex!=this.viewStack.selectedIndex){this.viewStack.getElementAt(this.oldIndex)["close"]();this.oldIndex=selectedIndex}}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}};KFBattleWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(KFBattleWin);break}};KFBattleWin.prototype.refRedpoint=function(){this.redPoint0.visible=KFBattleRedPoint.ins().redPoint>0||KfArenaRedPoint.ins().redpoint>0;this.redPoint1.visible=false};KFBattleWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};return KFBattleWin}(BaseEuiView);__reflect(KFBattleWin.prototype,"KFBattleWin");ViewManager.ins().reg(KFBattleWin,LayerManager.UI_Main);var KFBattlListPanel=function(_super){__extends(KFBattlListPanel,_super);function KFBattlListPanel(){var _this=_super.call(this)||this;_this.count=1;_this.name=i18n("KFBattlListPanel_0");return _this}KFBattlListPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};KFBattlListPanel.prototype.open=function(){this.addTouchEvent(this,this.onTap);this.refRedpoint()};KFBattlListPanel.prototype.onTap=function(e){switch(e.target){case this.btn0:ViewManager.ins().open(WJBattlefieldWin);break;case this.helpLink0:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[25].text);break}};KFBattlListPanel.prototype.refRedpoint=function(){for(var i=0;i<this.count;i++){this["redPoint"+i].visible=KFBattleRedPoint.ins()["postRedPoint"+(i+1)]()}};return KFBattlListPanel}(BaseComponent);__reflect(KFBattlListPanel.prototype,"KFBattlListPanel");var KffieldPanel=function(_super){__extends(KffieldPanel,_super);function KffieldPanel(){return _super.call(this)||this}KffieldPanel.prototype.open=function(){this.addTouchEvent(this,this.onTouch);this.observe(KFBattleRedPoint.ins().postRedPoint,this.refRedPoint);this.observe(DevildomRedPoint.ins().postRedPoint,this.refRedPoint);this.observe(KfArenaRedPoint.ins().postRedPoint,this.refRedPoint);this.initData();this.refRedPoint()};KffieldPanel.prototype.close=function(){this.$onClose();DisplayUtils.removeFromParent(this.kfBossMc)};KffieldPanel.prototype.onTouch=function(e){switch(e.target){case this.island0:if(KfArenaSys.ins().isKFMacthing()){UserTips.ins().showCenterTips(i18n("KffieldPanel_0"))}else{ViewManager.ins().open(KFBossWin)}break;case this.island1:ViewManager.ins().open(KfArenaWin);break;case this.island2:break;case this.island3:if(KfArenaSys.ins().isKFMacthing()){UserTips.ins().showCenterTips(i18n("KffieldPanel_1"))}else{ViewManager.ins().open(DevildomWin,DevildomBossModel.ins().getCurFbIndex())}break}};KffieldPanel.prototype.initData=function(){var _this=this;this.island0.currentState="unlock";this.island0["title"].source="kf_function_boss";this.island0["island"].source="";this.island3.currentState="unlock";egret.callLater(function(){_this.island3["title"].source="kf_function_invasion";_this.island3["island"].source="kf_field_invasion"},this);if(!this.kfBossMc){this.kfBossMc=new MovieClip;this.kfBossMc.scaleX=this.kfBossMc.scaleY=.45;this.kfBossMc.x=0;this.kfBossMc.y=35}this.island0["boossGroup"].addChild(this.kfBossMc);var showBody=GlobalConfig.CrossBossBase.showBoss?GlobalConfig.CrossBossBase.showBoss:"monster10041_3s";this.kfBossMc.playFile(RES_DIR_MONSTER+showBody,-1);egret.callLater(function(){_this.island1["title"].source="kf_function_ladder";_this.island1["island"].source="kf_field_ladder"},this);this.island1.currentState="unlock";this.island2.currentState="lock";this.island2.visible=false};KffieldPanel.prototype.refRedPoint=function(){this.island0["redPoint"].visible=KFBattleRedPoint.ins().redPoint2;this.island1["redPoint"].visible=KfArenaRedPoint.ins().redpoint;this.island3["redPoint"].visible=DevildomRedPoint.ins().redPoint};return KffieldPanel}(BaseView);__reflect(KffieldPanel.prototype,"KffieldPanel");var KffieldRecordItemReder=function(_super){__extends(KffieldRecordItemReder,_super);function KffieldRecordItemReder(){return _super.call(this)||this}KffieldRecordItemReder.prototype.dataChanged=function(){if(this.data instanceof KFDropRecordData){this.dropTime.text=DateUtils.getFormatBySecond(this.data.time,DateUtils.TIME_FORMAT_15);if(this.data.type==KFDropType.KF_BOSS){var roleStr=i18n("KffieldRecordItemReder_3",39423,this.data.nick);var item=GlobalConfig.ItemConfig[this.data.goodsId];var goodsColor=ItemConfig.getQualityColor(item);var goodsStr=i18n("KffieldRecordItemReder_4",goodsColor,item.name);var str=i18n("KffieldRecordItemReder_0",roleStr,this.data.sceneName,this.data.bossName,goodsStr);var textElement=TextFlowMaker.generateTextFlow1(str);textElement[0].style.href="event:"+this.data.roleId+"_"+this.data.servId;textElement[0].style.underline=true;textElement[4].style.href="event:"+this.data.goodsId;textElement[4].style.underline=true;this.record.textFlow=textElement}else if(this.data.type==KFDropType.DEVILDOM){var roleStr=i18n("KffieldRecordItemReder_1",65280,this.data.servId,this.data.guildName);var goodsId=GlobalConfig.AuctionItem[this.data.goodsId].item.id;var item=GlobalConfig.ItemConfig[goodsId];var goodsColor=ItemConfig.getQualityColor(item);var goodsStr=i18n("KffieldRecordItemReder_5",goodsColor,item.name);var str=i18n("KffieldRecordItemReder_2",roleStr,this.data.bossName,goodsStr);var textElement=TextFlowMaker.generateTextFlow1(str);textElement[6].style.href="event:"+goodsId;textElement[6].style.underline=true;this.record.textFlow=textElement}this.best.visible=this.data.isBest;this.record.width=!this.best.visible?390:310;this.record.addEventListener(egret.TextEvent.LINK,this.onLink,this);this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFromStage,this)}};KffieldRecordItemReder.prototype.onLink=function(e){var strArr=e.text.split("_");if(strArr.length>1){UserReadPlayer.ins().sendFindPlayer(parseInt(strArr[0]),parseInt(strArr[1]))}else{var itemconfig=GlobalConfig.ItemConfig[e.text];var type=ItemConfig.getType(itemconfig);if(itemconfig!=undefined&&itemconfig&&type!=undefined){if(ItemConfig.isEquip(itemconfig)){ViewManager.ins().open(EquipDetailedWin,1,undefined,itemconfig.id)}else if(type==ItemType.TYPE_21){ZhanLing.ins().ZhanLingItemTips(itemconfig.id)}else if(type==ItemType.TYPE_22){ViewManager.ins().open(ZhanlingZBTipWin,itemconfig.id)}else{ViewManager.ins().open(ItemDetailedWin,0,itemconfig.id)}}}};KffieldRecordItemReder.prototype.removeFromStage=function(){this.record.removeEventListener(egret.TextEvent.LINK,this.onLink,this);this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFromStage,this)};return KffieldRecordItemReder}(BaseItemRender);__reflect(KffieldRecordItemReder.prototype,"KffieldRecordItemReder");var KffieldRecordPanel=function(_super){__extends(KffieldRecordPanel,_super);function KffieldRecordPanel(){return _super.call(this)||this}KffieldRecordPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.listDt=new eui.ArrayCollection;this.list.itemRenderer=KffieldRecordItemReder;this.list.dataProvider=this.listDt};KffieldRecordPanel.prototype.open=function(){this.observe(KFBossSys.ins().postDropList,this.upList);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.upList();KFBossSys.ins().sendDropList()};KffieldRecordPanel.prototype.openOtherPlayerView=function(otherPlayerData){var win=ViewManager.ins().open(RRoleWin,otherPlayerData);win.hideEx(2)};KffieldRecordPanel.prototype.upList=function(){this.nodataShowGroup.visible=false;var list=KFBossSys.ins().dropBestRecordDataList;list=list.concat(KFBossSys.ins().dropRecordDataList);if(list.length<=0)this.nodataShowGroup.visible=true;this.listDt.replaceAll(list)};return KffieldRecordPanel}(BaseView);__reflect(KffieldRecordPanel.prototype,"KffieldRecordPanel");var PeakedRedpoint=function(_super){__extends(PeakedRedpoint,_super);function PeakedRedpoint(){var _this=_super.call(this)||this;_this.redpoint1=0;_this.redpoint2=0;_this.redpoint3=0;_this.redpoint=0;_this.associated(_this.postRedPoint,PeakedSys.ins().postSignUp,PeakedSys.ins().postState,PeakedSys.ins().postWorship,PeakedSys.ins().postKFInfoList,UserZs.ins().postZsLv);return _this}PeakedRedpoint.ins=function(){return _super.ins.call(this)};PeakedRedpoint.prototype.postRedPoint=function(){this.redpoint1=0;this.redpoint2=0;this.redpoint3=0;this.redpoint=0;if(!PeakedSys.ins().isOpen()){return this.redpoint}if(UserZs.ins().lv<GlobalConfig.PeakRaceBase.needZsLv)return this.redpoint;if(PeakedSys.ins().bfStatus==BF_PeakStatus.SignUp&&PeakedSys.ins().isSignUp==0&&PeakedSys.ins().canSignUp()){this.redpoint1=1}if(PeakedSys.ins().isKf()&&PeakedHelp.canSupport()){if(PeakedSys.ins().kfStatus>KF_PeakStatus.Knockout||PeakedSys.ins().kfStatus==KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd){this.redpoint2=GlobalConfig.PeakRaceBase.likeCount-PeakedSys.ins().kideNum}}else{if((PeakedSys.ins().bfStatus>BF_PeakStatus.Knockout||PeakedSys.ins().bfStatus==BF_PeakStatus.Knockout&&PeakedSys.ins().bfStatusIsEnd)&&PeakedSys.ins().bfStatus<BF_PeakStatus.Over&&PeakedHelp.canSupport()){this.redpoint2=GlobalConfig.PeakRaceBase.likeCount-PeakedSys.ins().kideNum}}this.redpoint3=PeakedSys.ins().worshipNum<GlobalConfig.PeakRaceBase.mobaiNum&&PeakedSys.ins().kfPlayer2Data&&PeakedSys.ins().kfPlayer2Data.winId&&PeakedSys.ins().kfStatus>=KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd?1:0;this.redpoint=this.redpoint1+this.redpoint2+this.redpoint3;return this.redpoint};return PeakedRedpoint}(BaseSystem);__reflect(PeakedRedpoint.prototype,"PeakedRedpoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.peakedRedpoint=PeakedRedpoint.ins.bind(PeakedRedpoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var PeakedSys=function(_super){__extends(PeakedSys,_super);function PeakedSys(){var _this=_super.call(this)||this;_this.player16List=[];_this.player8List=[];_this.player4List=[];_this.topRankInfoList=[];_this.betInfo=[];_this.myBattleReportList=[];_this.bfStatusIsEnd=0;_this.kfStatusIsEnd=0;_this.bfKonckReportList=[];_this.kfPlayer64List=[];_this.kfPlayer32List=[];_this.kfPlayer16List=[];_this.kfPlayer8List=[];_this.kfPlayer4List=[];_this.kfKonckReportList=[];_this.kfTopRankInfoList=[];_this.kfBetInfo=[];_this.myKFBattleReportList=[];_this.crossScene=1e4;_this.sysId=PackageID.PKCompetition;_this.regNetMsg(0,_this.postState);_this.regNetMsg(1,_this.postSignUp);_this.regNetMsg(2,_this.doPKResult);_this.regNetMsg(3,_this.postEliminateReportData);_this.regNetMsg(4,_this.postBFInfoList);_this.regNetMsg(5,_this.postTopRank);_this.regNetMsg(7,_this.postBetInfo);_this.regNetMsg(8,_this.postKFEliminateReportData);_this.regNetMsg(9,_this.postKFInfoList);_this.regNetMsg(10,_this.postKFTopRank);_this.regNetMsg(12,_this.postKFBetInfo);_this.regNetMsg(13,_this.doFbCountDown);_this.regNetMsg(14,_this.postWorship);_this.observe(GameLogic.ins().postEnterMap,function(){_this.isCrossScene()});return _this}PeakedSys.ins=function(){return _super.ins.call(this)};PeakedSys.prototype.postState=function(bytes){if(bytes){this.bfStatus=bytes.readByte();this.bfStatusIsEnd=bytes.readByte();this.kfStatus=bytes.readByte();this.kfStatusIsEnd=bytes.readByte();this.curStateTime=bytes.readInt();if(this.bfStatus==0)this.isSignUp=0}this.onPostState()};PeakedSys.prototype.onPostState=function(){var _this=this;PeakedHelp.calcTimerNode();if(this.bfStatus==BF_PeakStatus.Finals&&this.bfStatusIsEnd){var t=PeakedHelp.bfStatusTimer[BF_PeakStatus.Over]*1e3-GameServer.serverTime;if(this.kfStatus>KF_PeakStatus.None)t=0;if(t<=0)this.bfStatus=BF_PeakStatus.Over;else{TimerManager.ins().doTimer(t,1,function(){_this.bfStatus=BF_PeakStatus.Over;PeakedHelp.calcTimerNode();_this.postState(null)},this)}}if(PeakedSys.ins().isKf())PeakedSys.ins().sendKFBetInfo()};PeakedSys.prototype.postSignUp=function(bytes){this.isSignUp=bytes.readByte();this.kideNum=bytes.readInt();Actor.ins().postChip(bytes.readNumber());this.worshipNum=bytes.readByte();return this.isSignUp};PeakedSys.prototype.doPKResult=function(bytes){var result=bytes.readByte();var enemyName=bytes.readString();ViewManager.ins().open(PeakedFBResult,result,enemyName)};PeakedSys.prototype.postEliminateReportData=function(bytes){this.bfKonckRound=bytes.readShort();this.bfKonckNextTimer=bytes.readInt();this.bfKonckSurplusNum=bytes.readShort();this.bfKonckReportList=[];var count=bytes.readShort();for(var i=0;i<count;i++){var data=new KonckReportData;data.readBFData(bytes);data.round=i+1;this.bfKonckReportList.push(data)}};PeakedSys.prototype.postBFInfoList=function(bytes){var pkPlayerData;this.player16List=[];var count=bytes.readByte();for(var i=0;i<count;i++){pkPlayerData=new PeakPlayerData;pkPlayerData.readBaseData(bytes);this.player16List.push(pkPlayerData)}this.player8List=[];count=bytes.readByte();for(var i=0;i<count;i++){pkPlayerData=new PeakPlayerData;pkPlayerData.playerList=[];PeakedHelp.pushPlayerList(this.player16List,this.player16List,pkPlayerData.playerList,i);pkPlayerData.readToData(bytes);this.player8List.push(pkPlayerData)}this.player4List=[];count=bytes.readByte();for(var i=0;i<count;i++){pkPlayerData=new PeakPlayerData;pkPlayerData.playerList=[];PeakedHelp.pushPlayerList(this.player8List,this.player16List,pkPlayerData.playerList,i);pkPlayerData.readToData(bytes);this.player4List.push(pkPlayerData)}this.player2Data=new PeakPlayerData;this.player2Data.playerList=[];PeakedHelp.pushPlayerList(this.player4List,this.player16List,this.player2Data.playerList,0);this.player2Data.readToData(bytes);this.myBattleReportList=PeakedHelp.countMyRecordData()};PeakedSys.prototype.postTopRank=function(bytes){var count=bytes.readShort();this.topRankInfoList=[];for(var i=0;i<count;i++){var data=new PeakTopRankData(bytes);data.rank=i+1;this.topRankInfoList.push(data)}};PeakedSys.prototype.postBetInfo=function(bytes){var count=bytes.readByte();this.betInfo=[];for(var i=0;i<count;i++){var dt=new PeakBetData(bytes);this.betInfo.push(dt)}if(ViewManager.ins().isShow(PeakBetWin))UserTips.ins().showTips(i18n("PeakedSys_1"));ViewManager.ins().close(PeakBetWin)};PeakedSys.prototype.postKFEliminateReportData=function(bytes){this.kfKonckRound=bytes.readShort();this.kfKonckNextTimer=bytes.readInt();this.kfKonckSurplusNum=bytes.readShort();this.kfKonckReportList=[];var count=bytes.readShort();for(var i=0;i<count;i++){var data=new KonckReportData;data.readKFData(bytes);data.round=i+1;this.kfKonckReportList.push(data)}};PeakedSys.prototype.postKFInfoList=function(bytes){var pkPlayerData;this.kfPlayer64List=[];var count=bytes.readByte();for(var i=0;i<count;i++){pkPlayerData=new PeakPlayerData;pkPlayerData.readBaseData(bytes,true);this.kfPlayer64List.push(pkPlayerData)}this.kfPlayer32List=[];count=bytes.readByte();for(var i=0;i<count;i++){pkPlayerData=new PeakPlayerData;pkPlayerData.playerList=[];PeakedHelp.pushPlayerList(this.kfPlayer64List,this.kfPlayer64List,pkPlayerData.playerList,i);pkPlayerData.readToData(bytes);this.kfPlayer32List.push(pkPlayerData)}this.kfPlayer16List=[];count=bytes.readByte();for(var i=0;i<count;i++){pkPlayerData=new PeakPlayerData;pkPlayerData.playerList=[];PeakedHelp.pushPlayerList(this.kfPlayer32List,this.kfPlayer64List,pkPlayerData.playerList,i);pkPlayerData.readToData(bytes);this.kfPlayer16List.push(pkPlayerData)}this.kfPlayer8List=[];count=bytes.readByte();for(var i=0;i<count;i++){pkPlayerData=new PeakPlayerData;pkPlayerData.playerList=[];PeakedHelp.pushPlayerList(this.kfPlayer16List,this.kfPlayer64List,pkPlayerData.playerList,i);pkPlayerData.readToData(bytes);this.kfPlayer8List.push(pkPlayerData)}this.kfPlayer4List=[];count=bytes.readByte();for(var i=0;i<count;i++){pkPlayerData=new PeakPlayerData;pkPlayerData.playerList=[];PeakedHelp.pushPlayerList(this.kfPlayer8List,this.kfPlayer64List,pkPlayerData.playerList,i);pkPlayerData.readToData(bytes);this.kfPlayer4List.push(pkPlayerData)}this.kfPlayer2Data=new PeakPlayerData;this.kfPlayer2Data.playerList=[];PeakedHelp.pushPlayerList(this.kfPlayer4List,this.kfPlayer64List,this.kfPlayer2Data.playerList,0);this.kfPlayer2Data.readToData(bytes);this.myKFBattleReportList=PeakedHelp.countKFMyRecordData()};PeakedSys.prototype.postKFTopRank=function(bytes){var count=bytes.readShort();this.kfTopRankInfoList=[];for(var i=0;i<count;i++){var data=new PeakTopRankData(bytes);data.rank=i+1;this.kfTopRankInfoList.push(data)}};PeakedSys.prototype.postKFBetInfo=function(bytes){var count=bytes.readByte();this.kfBetInfo=[];for(var i=0;i<count;i++){var dt=new PeakBetData(bytes);this.kfBetInfo.push(dt)}if(ViewManager.ins().isShow(PeakBetWin))UserTips.ins().showTips(i18n("PeakedSys_2"));ViewManager.ins().close(PeakBetWin)};PeakedSys.prototype.doFbCountDown=function(bytes){var t=bytes.readInt();var curTime=Math.floor((DateUtils.formatMiniDateTime(t)-GameServer.serverTime)/1e3);egret.log(curTime);if(curTime>0)ViewManager.ins().open(FBCountDown,curTime)};PeakedSys.prototype.postWorship=function(bytes){this.worshipNum=bytes.readByte();if(!GlobalConfig.PeakRaceBase.mobaiChips)GlobalConfig.PeakRaceBase.mobaiChips=1e3;UserTips.ins().showCenterTips(i18n("PeakedSys_3",GlobalConfig.PeakRaceBase.mobaiChips))};PeakedSys.prototype.sendSignUp=function(){this.sendBaseProto(1)};PeakedSys.prototype.sendEliminateReport=function(){this.sendBaseProto(3)};PeakedSys.prototype.sendBFInfoList=function(){this.sendBaseProto(4)};PeakedSys.prototype.sendTopRank=function(){this.sendBaseProto(5)};PeakedSys.prototype.sendToLikes=function(id){var bytes=this.getBytes(6);bytes.writeInt(id);this.sendToServer(bytes)};PeakedSys.prototype.sendBet=function(id,num){var bytes=this.getBytes(7);bytes.writeInt(id);bytes.writeInt(num);this.sendToServer(bytes)};PeakedSys.prototype.sendKFEliminateReport=function(){this.sendBaseProto(8)};PeakedSys.prototype.sendKFInfoList=function(){this.sendBaseProto(9)};PeakedSys.prototype.sendKFTopRank=function(){this.sendBaseProto(10)};PeakedSys.prototype.sendKFToLikes=function(id){var bytes=this.getBytes(11);bytes.writeInt(id);this.sendToServer(bytes)};PeakedSys.prototype.sendKFBet=function(id,num){var bytes=this.getBytes(12);bytes.writeInt(id);bytes.writeInt(num);this.sendToServer(bytes)};PeakedSys.prototype.sendKFBetInfo=function(){this.sendBaseProto(13)};PeakedSys.prototype.sendWorship=function(){this.sendBaseProto(14)};PeakedSys.prototype.isOpen=function(){var b=OpenSystem.ins().checkSysOpen(SystemType.RING);var maxCount=Object.keys(GlobalConfig.ActorExRingConfig).length;var term=SpecialRing.ins().ringActiNum<maxCount;if(GameServer.serverOpenDay+1>=GlobalConfig.PeakRaceBase.openDay&&b&&!term&&this.isCanJoinThisPeriod())return true;return false};PeakedSys.prototype.isCanJoinThisPeriod=function(){var serverOpenSecond=(GameServer.serverOpenDay+1)*DateUtils.SECOND_PER_DAY;var PeakRaceBaseOpenSecond=GlobalConfig.PeakRaceBase.openDay*DateUtils.SECOND_PER_DAY;var t1=false;if(PeakedHelp.bfStatusTimer&&PeakedHelp.bfStatusTimer[BF_PeakStatus.Knockout]&&PeakedHelp.bfStatusTimer[BF_PeakStatus.Knockout]>0)t1=GameServer.serverTime/DateUtils.MS_PER_SECOND-serverOpenSecond+PeakRaceBaseOpenSecond>PeakedHelp.bfStatusTimer[BF_PeakStatus.Knockout];return!t1};PeakedSys.prototype.isKf=function(){return this.bfStatus==BF_PeakStatus.Over&&this.bfStatusIsEnd!=0||this.kfStatus>0};PeakedSys.prototype.canSignUp=function(){var t=PeakedHelp.bfStatusTimer[BF_PeakStatus.Knockout]*1e3-GameServer.serverTime;return true};PeakedSys.prototype.isKFSixteen=function(){return this.kfStatus>KF_PeakStatus.Prom32||this.kfStatus==KF_PeakStatus.Prom32&&this.kfStatusIsEnd!=0};PeakedSys.prototype.isCrossScene=function(){if(this.crossScene==2){ViewManager.ins().open(PeakedMainWin)}this.crossScene++};return PeakedSys}(BaseSystem);__reflect(PeakedSys.prototype,"PeakedSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.pkCompetitionSys=PeakedSys.ins.bind(PeakedSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var PeakedData=function(){function PeakedData(){}Object.defineProperty(PeakedData,"STATE_TYPE_CN",{get:function(){var _STATE_TYPE_CN=this._STATE_TYPE_CN;if(_STATE_TYPE_CN==null){_STATE_TYPE_CN=["","","",i18n("PeakedData_0"),i18n("PeakedData_1"),i18n("PeakedData_2"),i18n("PeakedData_3"),""];this._STATE_TYPE_CN=_STATE_TYPE_CN}return _STATE_TYPE_CN},enumerable:true,configurable:true});Object.defineProperty(PeakedData,"STATE_TYPE_AWARD_CN",{get:function(){var _STATE_TYPE_AWARD_CN=this._STATE_TYPE_AWARD_CN;if(_STATE_TYPE_AWARD_CN==null){_STATE_TYPE_AWARD_CN=["","",i18n("PeakedData_4"),i18n("PeakedData_5"),i18n("PeakedData_6"),i18n("PeakedData_7"),i18n("PeakedData_8"),i18n("PeakedData_9")];this._STATE_TYPE_AWARD_CN=_STATE_TYPE_AWARD_CN}return _STATE_TYPE_AWARD_CN},enumerable:true,configurable:true});Object.defineProperty(PeakedData,"STATE_ICON_CN",{get:function(){var _STATE_ICON_CN=this._STATE_ICON_CN;if(_STATE_ICON_CN==null){_STATE_ICON_CN=["",i18n("PeakedData_10"),i18n("PeakedData_11"),i18n("PeakedData_12"),i18n("PeakedData_13"),i18n("PeakedData_14"),i18n("PeakedData_15"),i18n("PeakedData_16")];this._STATE_ICON_CN=_STATE_ICON_CN}return _STATE_ICON_CN},enumerable:true,configurable:true});Object.defineProperty(PeakedData,"STATE_KF_TYPE_CN",{get:function(){var _STATE_KF_TYPE_CN=this._STATE_KF_TYPE_CN;if(_STATE_KF_TYPE_CN==null){_STATE_KF_TYPE_CN=["","",i18n("PeakedData_17"),i18n("PeakedData_18"),i18n("PeakedData_19"),i18n("PeakedData_20"),i18n("PeakedData_21"),i18n("PeakedData_22"),""];this._STATE_KF_TYPE_CN=_STATE_KF_TYPE_CN}return _STATE_KF_TYPE_CN},enumerable:true,configurable:true});Object.defineProperty(PeakedData,"STATE_KF_TYPE_AWARD_CN",{get:function(){var _STATE_KF_TYPE_AWARD_CN=this._STATE_KF_TYPE_AWARD_CN;if(_STATE_KF_TYPE_AWARD_CN==null){_STATE_KF_TYPE_AWARD_CN=["",i18n("PeakedData_23"),i18n("PeakedData_24"),i18n("PeakedData_25"),i18n("PeakedData_26"),i18n("PeakedData_27"),i18n("PeakedData_28"),i18n("PeakedData_29"),i18n("PeakedData_30")];this._STATE_KF_TYPE_AWARD_CN=_STATE_KF_TYPE_AWARD_CN}return _STATE_KF_TYPE_AWARD_CN},enumerable:true,configurable:true});Object.defineProperty(PeakedData,"STATE_KF_ICON_CN",{get:function(){var _STATE_KF_ICON_CN=this._STATE_KF_ICON_CN;if(_STATE_KF_ICON_CN==null){_STATE_KF_ICON_CN=[i18n("PeakedData_31"),i18n("PeakedData_32"),i18n("PeakedData_33"),i18n("PeakedData_34"),i18n("PeakedData_35"),i18n("PeakedData_36"),i18n("PeakedData_37"),i18n("PeakedData_38")];this._STATE_KF_ICON_CN=_STATE_KF_ICON_CN}return _STATE_KF_ICON_CN},enumerable:true,configurable:true});Object.defineProperty(PeakedData,"SERV_CN",{get:function(){var _SERV_CN=this._SERV_CN;if(_SERV_CN==null){_SERV_CN=[i18n("PeakedData_39"),i18n("PeakedData_40")];this._SERV_CN=_SERV_CN}return _SERV_CN},enumerable:true,configurable:true});return PeakedData}();__reflect(PeakedData.prototype,"PeakedData");var PeakPlayerData=function(){function PeakPlayerData(bytes){if(bytes)this.readBaseData(bytes)}PeakPlayerData.prototype.readBaseData=function(bytes,isKF){if(isKF===void 0){isKF=false}var count=bytes.readByte();this.playerList=[];for(var i=0;i<count;i++){var info=new PeakPlayerInfo;if(isKF)info.readKFData(bytes);else info.readData(bytes);this.playerList.push(info)}this.winId=bytes.readInt();count=bytes.readByte();this.reportList=[];for(var i=0;i<count;i++){this.reportList.push(bytes.readInt())}};PeakPlayerData.prototype.readToData=function(bytes){this.winId=bytes.readInt();var count=bytes.readByte();this.reportList=[];for(var i=0;i<count;i++){this.reportList.push(bytes.readInt())}};return PeakPlayerData}();__reflect(PeakPlayerData.prototype,"PeakPlayerData");var PeakPlayerInfo=function(){function PeakPlayerInfo(bytes){this.serverId=0;if(bytes)this.readData(bytes)}PeakPlayerInfo.prototype.readData=function(bytes){this.roleId=bytes.readInt();this.playerName=bytes.readString();this.job=bytes.readByte();this.sex=bytes.readByte();this.pos=bytes.readByte()};PeakPlayerInfo.prototype.readKFData=function(bytes){this.roleId=bytes.readInt();this.serverId=bytes.readInt();this.playerName=bytes.readString();this.job=bytes.readByte();this.sex=bytes.readByte();this.pos=bytes.readByte()};return PeakPlayerInfo}();__reflect(PeakPlayerInfo.prototype,"PeakPlayerInfo");var PeakTopRankData=function(){function PeakTopRankData(bytes){if(bytes)this.readData(bytes)}PeakTopRankData.prototype.readData=function(bytes){this.playerId=bytes.readInt();this.playerName=bytes.readString();this.servId=bytes.readInt();this.likeNum=bytes.readInt()};return PeakTopRankData}();__reflect(PeakTopRankData.prototype,"PeakTopRankData");var PeakBetData=function(){function PeakBetData(bytes){if(bytes)this.readData(bytes)}PeakBetData.prototype.readData=function(bytes){this.status=bytes.readByte();this.playerId=bytes.readInt();this.batNum=bytes.readInt()};return PeakBetData}();__reflect(PeakBetData.prototype,"PeakBetData");var PeakBattleReportData=function(){function PeakBattleReportData(){}return PeakBattleReportData}();__reflect(PeakBattleReportData.prototype,"PeakBattleReportData");var KonckReportData=function(){function KonckReportData(){}KonckReportData.prototype.readBFData=function(bytes){this.id=bytes.readInt();this.player=bytes.readString();this.result=bytes.readByte()};KonckReportData.prototype.readKFData=function(bytes){this.id=bytes.readInt();this.player=bytes.readString();this.servId=bytes.readInt();this.result=bytes.readByte()};return KonckReportData}();__reflect(KonckReportData.prototype,"KonckReportData");var BF_PeakStatus;(function(BF_PeakStatus){BF_PeakStatus[BF_PeakStatus["None"]=0]="None";BF_PeakStatus[BF_PeakStatus["SignUp"]=1]="SignUp";BF_PeakStatus[BF_PeakStatus["Knockout"]=2]="Knockout";BF_PeakStatus[BF_PeakStatus["Prom16"]=3]="Prom16";BF_PeakStatus[BF_PeakStatus["Prom8"]=4]="Prom8";BF_PeakStatus[BF_PeakStatus["Prom4"]=5]="Prom4";BF_PeakStatus[BF_PeakStatus["Finals"]=6]="Finals";BF_PeakStatus[BF_PeakStatus["Over"]=7]="Over"})(BF_PeakStatus||(BF_PeakStatus={}));window["BF_PeakStatus"]=BF_PeakStatus;var KF_PeakStatus;(function(KF_PeakStatus){KF_PeakStatus[KF_PeakStatus["None"]=0]="None";KF_PeakStatus[KF_PeakStatus["Knockout"]=1]="Knockout";KF_PeakStatus[KF_PeakStatus["Prom64"]=2]="Prom64";KF_PeakStatus[KF_PeakStatus["Prom32"]=3]="Prom32";KF_PeakStatus[KF_PeakStatus["Prom16"]=4]="Prom16";KF_PeakStatus[KF_PeakStatus["Prom8"]=5]="Prom8";KF_PeakStatus[KF_PeakStatus["Prom4"]=6]="Prom4";KF_PeakStatus[KF_PeakStatus["Finals"]=7]="Finals";KF_PeakStatus[KF_PeakStatus["Over"]=8]="Over"})(KF_PeakStatus||(KF_PeakStatus={}));window["KF_PeakStatus"]=KF_PeakStatus;var PeakedHelp=function(){function PeakedHelp(){}PeakedHelp.calcTimerNode=function(){var baseDP=GlobalConfig.PeakRaceBase;var timeDps=GlobalConfig.PeakRaceTime;var sysDt=PeakedSys.ins();this.bfStatusTimer=[];this.kfStatusTimer=[];var curTime=Math.floor(sysDt.curStateTime)||Math.floor(DateUtils.MINI_DATE_TIME_BASE/DateUtils.MS_PER_SECOND);if(PeakedSys.ins().bfStatus>=BF_PeakStatus.Finals&&PeakedSys.ins().bfStatusIsEnd){if(!GlobalConfig.PeakRaceBase.interval)GlobalConfig.PeakRaceBase.interval=14;curTime-=GlobalConfig.PeakRaceBase.interval*DateUtils.MS_PER_DAY/DateUtils.MS_PER_SECOND}this.bfStatusTimer[BF_PeakStatus.None]=curTime;this.bfStatusTimer[BF_PeakStatus.Over]=curTime+baseDP.crossRelTime;for(var status_2=1;status_2<=BF_PeakStatus.Finals;status_2++){this.bfStatusTimer[status_2]=curTime+timeDps[status_2].relTime}timeDps=GlobalConfig.PeakRaceCrossTime;this.kfStatusTimer[KF_PeakStatus.None]=curTime;for(var status_3=1;status_3<=KF_PeakStatus.Finals;status_3++){this.kfStatusTimer[status_3]=curTime+timeDps[status_3].relTime}};PeakedHelp.getTimerRuleStr=function(){var baseDP=GlobalConfig.PeakRaceBase;var colorStr=i18n("PeakedHelp_17",ColorUtil.GREEN_COLOR_N);var str=i18n("PeakedHelp_0",colorStr,baseDP.needZsLv);var TIME_FORMAT=DateUtils.TIME_FORMAT_13;var sTime=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.SignUp],TIME_FORMAT);var eTime=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Knockout],TIME_FORMAT);str+=i18n("PeakedHelp_1",colorStr,sTime,colorStr,eTime);sTime=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Knockout],TIME_FORMAT);str+=i18n("PeakedHelp_2",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Prom16],TIME_FORMAT);str+=i18n("PeakedHelp_3",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Prom8],TIME_FORMAT);str+=i18n("PeakedHelp_4",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Prom4],TIME_FORMAT);str+=i18n("PeakedHelp_5",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Finals],TIME_FORMAT);str+=i18n("PeakedHelp_6",colorStr,sTime);return str};PeakedHelp.getKFTimerRuleStr=function(){var colorStr=i18n("PeakedHelp_18",ColorUtil.GREEN_COLOR_N);var str=i18n("PeakedHelp_7");var TIME_FORMAT=DateUtils.TIME_FORMAT_13;var sTime=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Knockout],TIME_FORMAT);str+=i18n("PeakedHelp_8",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom64],TIME_FORMAT);str+=i18n("PeakedHelp_9",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom32],TIME_FORMAT);str+=i18n("PeakedHelp_10",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom16],TIME_FORMAT);str+=i18n("PeakedHelp_11",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom8],TIME_FORMAT);str+=i18n("PeakedHelp_12",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom4],TIME_FORMAT);str+=i18n("PeakedHelp_13",colorStr,sTime);sTime=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Finals],TIME_FORMAT);str+=i18n("PeakedHelp_14",colorStr,sTime);return str};PeakedHelp.calcEliminateWinNum=function(){var count=0;if(PeakedSys.ins().isKf()){for(var _i=0,_a=PeakedSys.ins().kfKonckReportList;_i<_a.length;_i++){var data=_a[_i];if(data.result)count++}}else{for(var _b=0,_c=PeakedSys.ins().bfKonckReportList;_b<_c.length;_b++){var data=_c[_b];if(data.result)count++}}return count};PeakedHelp.getPlayerData=function(group1,group2){var sys=PeakedSys.ins();if(group1==this.PK_GROUP_1){return sys.player16List[group2-1]}else if(group1==this.PK_GROUP_2){if(sys.player8List[group2-1])return sys.player8List[group2-1];else{return this.findLastDt(group2,sys.player16List)}}else if(group1==this.PK_GROUP_3){if(sys.player4List[group2-1])return sys.player4List[group2-1];else{return this.findLastDt(group2,sys.player8List)}}else{if(sys.player2Data)return sys.player2Data;else return this.findLastDt(group2,sys.player4List)}};PeakedHelp.getKFPlayerData=function(group1,group2,idx,isSixteen){if(idx===void 0){idx=0}if(isSixteen===void 0){isSixteen=false}var sys=PeakedSys.ins();if(group1==this.PK_GROUP_1){if(isSixteen){if(sys.kfPlayer16List[group2-1])return sys.kfPlayer16List[group2-1];else return this.findLastDt(group2,sys.kfPlayer64List)}else{return sys.kfPlayer64List.slice(idx*8,idx*8+8)[group2-1]}}else if(group1==this.PK_GROUP_2){if(isSixteen){if(sys.kfPlayer8List[group2-1])return sys.kfPlayer8List[group2-1];else return this.findLastDt(group2,sys.kfPlayer16List)}else{if(sys.kfPlayer32List.slice(idx*4,idx*4+4)[group2-1])return sys.kfPlayer32List.slice(idx*4,idx*4+4)[group2-1];else return this.findLastDt(group2,sys.kfPlayer64List.slice(idx*8,idx*8+8))}}else if(group1==this.PK_GROUP_3){if(isSixteen){if(sys.kfPlayer4List[group2-1])return sys.kfPlayer4List[group2-1];else return this.findLastDt(group2,sys.kfPlayer8List)}else{if(sys.kfPlayer16List.slice(idx*2,idx*2+2)[group2-1])return sys.kfPlayer16List.slice(idx*2,idx*2+2)[group2-1];else return this.findLastDt(group2,sys.kfPlayer32List.slice(idx*4,idx*4+4))}}else{if(sys.kfPlayer2Data)return sys.kfPlayer2Data;else return this.findLastDt(group2,sys.kfPlayer4List)}};PeakedHelp.findLastDt=function(ix,list){if(list&&list[(ix-1)*2+1]){var aid=list[(ix-1)*2>>0].winId;var bid=list[(ix-1)*2+1>>0].winId;var dt=new PeakPlayerData;dt.playerList=[];dt.playerList.push(this.findPlayerDtById(aid));dt.playerList.push(this.findPlayerDtById(bid));dt.reportList=[];return dt}else return null};PeakedHelp.findPlayerDtById=function(id,list){if(!list){if(PeakedSys.ins().isKf()){list=PeakedSys.ins().kfPlayer64List}else{list=PeakedSys.ins().player16List}}for(var _i=0,list_11=list;_i<list_11.length;_i++){var playerData=list_11[_i];for(var _a=0,_b=playerData.playerList;_a<_b.length;_a++){var data=_b[_a];if(id==data.roleId)return data}}};PeakedHelp.checkIsWinById=function(id,status,list){if(!list){if(PeakedSys.ins().isKf()){list=PeakedHelp.getPlayerListByStage(status)}else{list=PeakedHelp.getPlayerListByStage(status)}}for(var _i=0,list_12=list;_i<list_12.length;_i++){var data=list_12[_i];if(id==data.winId)return true}return false};PeakedHelp.getPlayerListByStage=function(curStatus){if(PeakedSys.ins().isKf()){switch(curStatus){case KF_PeakStatus.Knockout:case KF_PeakStatus.Prom64:return PeakedSys.ins().kfPlayer64List;case KF_PeakStatus.Prom32:return PeakedSys.ins().kfPlayer32List;case KF_PeakStatus.Prom16:return PeakedSys.ins().kfPlayer16List;case KF_PeakStatus.Prom8:return PeakedSys.ins().kfPlayer8List;case KF_PeakStatus.Prom4:return PeakedSys.ins().kfPlayer4List;case KF_PeakStatus.Finals:return[PeakedSys.ins().kfPlayer2Data]}}else{switch(curStatus){case BF_PeakStatus.Prom16:case BF_PeakStatus.Knockout:return PeakedSys.ins().player16List;case BF_PeakStatus.Prom8:return PeakedSys.ins().player8List;case BF_PeakStatus.Prom4:return PeakedSys.ins().player4List;case BF_PeakStatus.Finals:return[PeakedSys.ins().player2Data]}}};PeakedHelp.countMyRecordData=function(){var prm16=PeakedSys.ins().player16List;var prm8=PeakedSys.ins().player8List;var prm4=PeakedSys.ins().player4List;var prm2=PeakedSys.ins().player2Data;var collectReport=function(pkPlayerData,tReportList,stateType){var n=pkPlayerData.playerList.length;for(var i=0;i<n;i++){var pdt=pkPlayerData.playerList[i];if(pdt.roleId==Actor.actorID){var enemyName=n>1?pkPlayerData.playerList[i==0?1:0].playerName:i18n("PeakedHelp_15");if(pkPlayerData.reportList.length==0&&!pkPlayerData.playerList[1]&&stateType<PeakedSys.ins().bfStatus){var reportData=new PeakBattleReportData;reportData.stateType=stateType;reportData.playerName=enemyName;reportData.result=1;reportData.round=0;tReportList.push(reportData)}else{var round=0;for(var _i=0,_a=pkPlayerData.reportList;_i<_a.length;_i++){var pId=_a[_i];var reportData=new PeakBattleReportData;reportData.stateType=stateType;reportData.playerName=enemyName;reportData.result=pId==Actor.actorID?1:0;reportData.round=++round;tReportList.push(reportData)}}break}}};var dtList=[];for(var _i=0,prm16_1=prm16;_i<prm16_1.length;_i++){var pData=prm16_1[_i];collectReport(pData,dtList,BF_PeakStatus.Prom16)}for(var _a=0,prm8_1=prm8;_a<prm8_1.length;_a++){var pData=prm8_1[_a];collectReport(pData,dtList,BF_PeakStatus.Prom8)}for(var _b=0,prm4_1=prm4;_b<prm4_1.length;_b++){var pData=prm4_1[_b];collectReport(pData,dtList,BF_PeakStatus.Prom4)}collectReport(prm2,dtList,BF_PeakStatus.Finals);return dtList};PeakedHelp.countKFMyRecordData=function(){var prm64=PeakedSys.ins().kfPlayer64List;var prm32=PeakedSys.ins().kfPlayer32List;var prm16=PeakedSys.ins().kfPlayer16List;var prm8=PeakedSys.ins().kfPlayer8List;var prm4=PeakedSys.ins().kfPlayer4List;var prm2=PeakedSys.ins().kfPlayer2Data;var collectReport=function(pkPlayerData,tReportList,stateType){var n=pkPlayerData.playerList.length;for(var i=0;i<n;i++){var pdt=pkPlayerData.playerList[i];if(pdt.roleId==Actor.actorID){var enemyName=n>1?pkPlayerData.playerList[i==0?1:0].playerName:i18n("PeakedHelp_16");if(pkPlayerData.reportList.length==0&&!pkPlayerData.playerList[1]&&stateType<PeakedSys.ins().kfStatus){var reportData=new PeakBattleReportData;reportData.stateType=stateType;reportData.playerName=enemyName;reportData.result=1;reportData.round=0;tReportList.push(reportData)}else{var round=0;for(var _i=0,_a=pkPlayerData.reportList;_i<_a.length;_i++){var pId=_a[_i];var reportData=new PeakBattleReportData;reportData.stateType=stateType;reportData.playerName=enemyName;reportData.result=pId==Actor.actorID?1:0;reportData.round=++round;tReportList.push(reportData)}}break}}};var dtList=[];for(var _i=0,prm64_1=prm64;_i<prm64_1.length;_i++){var pData=prm64_1[_i];collectReport(pData,dtList,KF_PeakStatus.Prom64)}for(var _a=0,prm32_1=prm32;_a<prm32_1.length;_a++){var pData=prm32_1[_a];collectReport(pData,dtList,KF_PeakStatus.Prom32)}for(var _b=0,prm16_2=prm16;_b<prm16_2.length;_b++){var pData=prm16_2[_b];collectReport(pData,dtList,KF_PeakStatus.Prom16)}for(var _c=0,prm8_2=prm8;_c<prm8_2.length;_c++){var pData=prm8_2[_c];collectReport(pData,dtList,KF_PeakStatus.Prom8)}for(var _d=0,prm4_2=prm4;_d<prm4_2.length;_d++){var pData=prm4_2[_d];collectReport(pData,dtList,KF_PeakStatus.Prom4)}collectReport(prm2,dtList,KF_PeakStatus.Finals);return dtList};PeakedHelp.findBetInfoById=function(id,status,betInfoList){if(!betInfoList){var isKF=PeakedSys.ins().isKf();betInfoList=isKF?PeakedSys.ins().kfBetInfo:PeakedSys.ins().betInfo}if(!betInfoList)return null;for(var _i=0,betInfoList_1=betInfoList;_i<betInfoList_1.length;_i++){var info=betInfoList_1[_i];if(info.playerId==id&&info.status==status)return info}return null};PeakedHelp.getStatusByGroup=function(group){if(PeakedSys.ins().isKf()){if(PeakedSys.ins().isKFSixteen()){switch(group){case this.PK_GROUP_1:return KF_PeakStatus.Prom16;case this.PK_GROUP_2:return KF_PeakStatus.Prom8;case this.PK_GROUP_3:return KF_PeakStatus.Prom4;case this.PK_GROUP_4:return KF_PeakStatus.Finals}}else{switch(group){case this.PK_GROUP_1:return KF_PeakStatus.Prom64;case this.PK_GROUP_2:return KF_PeakStatus.Prom32}}}else{switch(group){case this.PK_GROUP_1:return BF_PeakStatus.Prom16;case this.PK_GROUP_2:return BF_PeakStatus.Prom8;case this.PK_GROUP_3:return BF_PeakStatus.Prom4;case this.PK_GROUP_4:return BF_PeakStatus.Finals}}};PeakedHelp.checkIsBet=function(list,group){var groupNum=parseInt(group);var isKF=PeakedSys.ins().isKf();for(var _i=0,list_13=list;_i<list_13.length;_i++){var dt=list_13[_i];if(!dt)continue;var betInfo=this.findBetInfoById(dt.roleId,this.getStatusByGroup(parseInt(group)));if(betInfo){if(isKF){if(PeakedSys.ins().isKFSixteen()){if(groupNum==this.PK_GROUP_1&&betInfo.status==KF_PeakStatus.Prom16)return true;else if(groupNum==this.PK_GROUP_2&&betInfo.status==KF_PeakStatus.Prom8)return true;else if(groupNum==this.PK_GROUP_3&&betInfo.status==KF_PeakStatus.Prom4)return true;else if(groupNum==this.PK_GROUP_4&&betInfo.status==KF_PeakStatus.Finals)return true}else{if(groupNum==this.PK_GROUP_1&&betInfo.status==KF_PeakStatus.Prom64)return true;else if(groupNum==this.PK_GROUP_2&&betInfo.status==KF_PeakStatus.Prom32)return true}}else{if(groupNum==this.PK_GROUP_1&&betInfo.status==BF_PeakStatus.Prom16)return true;else if(groupNum==this.PK_GROUP_2&&betInfo.status==BF_PeakStatus.Prom8)return true;else if(groupNum==this.PK_GROUP_3&&betInfo.status==BF_PeakStatus.Prom4)return true;else if(groupNum==this.PK_GROUP_4&&betInfo.status==BF_PeakStatus.Finals)return true}}}return false};PeakedHelp.findPlayerIndexById=function(id,list){for(var i=0;i<list.length;i++){if(list[i].roleId==id){return i}}return-1};PeakedHelp.setImgGroupSource=function(group,source){for(var i=0;i<group.numChildren;i++){var img=group.getChildAt(i);if(img)img.source=source}};PeakedHelp.statusIsOver=function(status,isKf){if(isKf){return PeakedSys.ins().kfStatus>status||PeakedSys.ins().kfStatus==status&&PeakedSys.ins().kfStatusIsEnd!=0}else{return PeakedSys.ins().bfStatus>status||PeakedSys.ins().bfStatus==status&&PeakedSys.ins().bfStatusIsEnd!=0}};PeakedHelp.statusIsOverByGroup=function(group){var isOver=false;if(PeakedSys.ins().isKf()){if(PeakedSys.ins().isKFSixteen()){if(group==this.PK_GROUP_1)isOver=PeakedHelp.statusIsOver(KF_PeakStatus.Prom16,false);else if(group==this.PK_GROUP_2)isOver=PeakedHelp.statusIsOver(KF_PeakStatus.Prom8,false);else if(group==this.PK_GROUP_3)isOver=PeakedHelp.statusIsOver(KF_PeakStatus.Prom4,false);else isOver=PeakedHelp.statusIsOver(KF_PeakStatus.Finals,false)}else{if(group==this.PK_GROUP_1)isOver=PeakedHelp.statusIsOver(KF_PeakStatus.Prom64,false);else if(group==this.PK_GROUP_2)isOver=PeakedHelp.statusIsOver(KF_PeakStatus.Prom32,false)}}else{if(group==this.PK_GROUP_1)isOver=PeakedHelp.statusIsOver(BF_PeakStatus.Prom16,false);else if(group==this.PK_GROUP_2)isOver=PeakedHelp.statusIsOver(BF_PeakStatus.Prom8,false);else if(group==this.PK_GROUP_3)isOver=PeakedHelp.statusIsOver(BF_PeakStatus.Prom4,false);else isOver=PeakedHelp.statusIsOver(BF_PeakStatus.Finals,false)}return isOver};PeakedHelp.pushPlayerList=function(toList,soList,playerList,index){if(toList[index*2]){var dt=PeakedHelp.findPlayerDtById(toList[index*2].winId,soList);if(dt)playerList.push(dt)}if(toList[index*2+1]){var dt=PeakedHelp.findPlayerDtById(toList[index*2+1].winId,soList);if(dt)playerList.push(dt)}};PeakedHelp.isSixteenById=function(id){for(var _i=0,_a=PeakedSys.ins().player16List;_i<_a.length;_i++){var dt=_a[_i];if(dt){for(var _b=0,_c=dt.playerList;_b<_c.length;_b++){var info=_c[_b];if(info.roleId==id)return true}}}return false};PeakedHelp.sortBetFun=function(a,b){if(a.status>b.status)return 1;else if(a.status<b.status)return-1;else return 0};PeakedHelp.findKFGroupById=function(id){var index=0;for(var _i=0,_a=PeakedSys.ins().kfPlayer64List;_i<_a.length;_i++){var dt=_a[_i];for(var _b=0,_c=dt.playerList;_b<_c.length;_b++){var playInfo=_c[_b];if(playInfo.roleId==id){return index/16>>0}index++}}return-1};PeakedHelp.findBetKFGroup=function(){var kfStatus=PeakedSys.ins().kfStatus;var index=0;for(var _i=0,_a=PeakedSys.ins().kfBetInfo;_i<_a.length;_i++){var dt=_a[_i];if(dt.status==KF_PeakStatus.Prom64&&kfStatus==KF_PeakStatus.Knockout||dt.status==KF_PeakStatus.Prom32&&kfStatus==KF_PeakStatus.Prom64){return this.findKFGroupById(dt.playerId)}}return-1};PeakedHelp.canSupport=function(){var curT=this.kfStatusTimer[KF_PeakStatus.None]+DateUtils.DAYS_PER_WEEK*DateUtils.SECOND_PER_DAY;if(GameServer.serverTime/DateUtils.MS_PER_SECOND>curT&&PeakedSys.ins().kfStatus>=KF_PeakStatus.Finals&&PeakedSys.ins().kfStatusIsEnd){return false}return true};PeakedHelp.PK_GROUP_1=1;PeakedHelp.PK_GROUP_2=2;PeakedHelp.PK_GROUP_3=3;PeakedHelp.PK_GROUP_4=4;return PeakedHelp}();__reflect(PeakedHelp.prototype,"PeakedHelp");var PeakAwardItemRender=function(_super){__extends(PeakAwardItemRender,_super);function PeakAwardItemRender(){return _super.call(this)||this}PeakAwardItemRender.prototype.childrenCreated=function(){this.awardslist.itemRenderer=ItemBase};PeakAwardItemRender.prototype.dataChanged=function(){if(this.data instanceof PeakRaceTime){this.typeLabel.text=PeakedData.STATE_TYPE_AWARD_CN[this.data.status]}else if(this.data instanceof PeakRaceCrossTime){this.typeLabel.text=PeakedData.STATE_KF_TYPE_AWARD_CN[this.data.status]}var mailConfig=GlobalConfig.MailIdConfig[this.data.loseMail];this.awardslist.dataProvider=new eui.ArrayCollection(mailConfig.attachment)};return PeakAwardItemRender}(BaseItemRender);__reflect(PeakAwardItemRender.prototype,"PeakAwardItemRender");var PeakKnockoutItemItemRender=function(_super){__extends(PeakKnockoutItemItemRender,_super);function PeakKnockoutItemItemRender(){return _super.call(this)||this}PeakKnockoutItemItemRender.prototype.dataChanged=function(){if(this.data){var typeStr=this.data.servId?i18n("PeakKnockoutItemItemRender_0"):i18n("PeakKnockoutItemItemRender_1");this.infoLabel.text=i18n("PeakKnockoutItemItemRender_2",typeStr,this.data.round);this.playerName.text=this.data.player?this.data.player:i18n("PeakKnockoutItemItemRender_3");this.playerName.name=this.data.id;if(this.data.result){this.result.textColor=ColorUtil.GREEN_COLOR_N;this.result.text=i18n("PeakKnockoutItemItemRender_4")}else{this.result.textColor=ColorUtil.RED_COLOR_N;this.result.text=i18n("PeakKnockoutItemItemRender_5")}}};return PeakKnockoutItemItemRender}(BaseItemRender);__reflect(PeakKnockoutItemItemRender.prototype,"PeakKnockoutItemItemRender");var PeakMyBattleRecordItemRender=function(_super){__extends(PeakMyBattleRecordItemRender,_super);function PeakMyBattleRecordItemRender(){return _super.call(this)||this}PeakMyBattleRecordItemRender.prototype.dataChanged=function(){if(this.data.playerName){var exRound=this.data.round?i18n("PeakMyBattleRecordItemRender_0",this.data.round):"";if(PeakedSys.ins().isKf()){this.roundInfo.text=""+PeakedData.SERV_CN[1]+PeakedData.STATE_KF_TYPE_CN[this.data.stateType]+" "+exRound}else{this.roundInfo.text=""+PeakedData.SERV_CN[0]+PeakedData.STATE_TYPE_CN[this.data.stateType]+" "+exRound}this.enemyLabel.text=this.data.playerName;this.result.text=this.data.result?i18n("PeakMyBattleRecordItemRender_1"):i18n("PeakMyBattleRecordItemRender_2");this.result.textColor=this.data.result?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N}};return PeakMyBattleRecordItemRender}(BaseItemRender);__reflect(PeakMyBattleRecordItemRender.prototype,"PeakMyBattleRecordItemRender");var PeakMyBetItemRender=function(_super){__extends(PeakMyBetItemRender,_super);function PeakMyBetItemRender(){return _super.call(this)||this}PeakMyBetItemRender.prototype.dataChanged=function(){if(this.data instanceof PeakBetData){if(PeakedSys.ins().isKf()){this.round.text=PeakedData.SERV_CN[1]+PeakedData.STATE_KF_TYPE_CN[this.data.status]}else{this.round.text=PeakedData.SERV_CN[0]+PeakedData.STATE_TYPE_CN[this.data.status]}var playDt=PeakedHelp.findPlayerDtById(this.data.playerId);var ext="";if(PeakedHelp.statusIsOver(this.data.status,PeakedSys.ins().isKf())){if(PeakedHelp.checkIsWinById(this.data.playerId,this.data.status)){ext=i18n("PeakMyBetItemRender_0",ColorUtil.GREEN_COLOR_N,this.data.batNum)}else{ext=i18n("PeakMyBetItemRender_1",ColorUtil.RED_COLOR_N,this.data.batNum)}}else if(PeakedHelp.checkIsWinById(this.data.playerId,this.data.status)){ext=i18n("PeakMyBetItemRender_2",ColorUtil.GREEN_COLOR_N,this.data.batNum)}else{ext=i18n("PeakMyBetItemRender_3")}this.infoLabel.textFlow=TextFlowMaker.generateTextFlow1(i18n("PeakMyBetItemRender_4",playDt.playerName,this.data.batNum,ext))}};return PeakMyBetItemRender}(BaseItemRender);__reflect(PeakMyBetItemRender.prototype,"PeakMyBetItemRender");var PeakTopRankItemRender=function(_super){__extends(PeakTopRankItemRender,_super);function PeakTopRankItemRender(){return _super.call(this)||this}PeakTopRankItemRender.prototype.dataChanged=function(){if(this.data instanceof PeakTopRankData){this.nameLabel.text=this.data.playerName;this.score.text=this.data.likeNum*GlobalConfig.PeakRaceBase.likeScore+"";this.supportBtn.visible=PeakedHelp.canSupport();if(PeakedSys.ins().kideNum>=GlobalConfig.PeakRaceBase.likeCount){this.supportBtn.enabled=false}if(this.data.rank<=3){this.rankImg.source="paihang"+this.data.rank;this.rank.text=""}else{this.rank.text=this.data.rank+"";this.rankImg.source=""}}};return PeakTopRankItemRender}(BaseItemRender);__reflect(PeakTopRankItemRender.prototype,"PeakTopRankItemRender");var PeakViewBattleReportItemRender=function(_super){__extends(PeakViewBattleReportItemRender,_super);function PeakViewBattleReportItemRender(){return _super.call(this)||this}PeakViewBattleReportItemRender.prototype.dataChanged=function(){if(this.data){this.roundTxt.text=i18n("PeakViewBattleReportItemRender_0",this.data.round);this.player.text=this.data.winer;this.noOpen.visible=false;this.infoGroup.visible=true}else{this.noOpen.visible=true;this.infoGroup.visible=false}};return PeakViewBattleReportItemRender}(BaseItemRender);__reflect(PeakViewBattleReportItemRender.prototype,"PeakViewBattleReportItemRender");var PeakAwardPanel=function(_super){__extends(PeakAwardPanel,_super);function PeakAwardPanel(){return _super.call(this)||this}PeakAwardPanel.prototype.childrenCreated=function(){this.List0.itemRenderer=PeakAwardItemRender;this.List1.itemRenderer=PeakAwardItemRender;this._listDt1=new eui.ArrayCollection;this._listDt2=new eui.ArrayCollection;this.List0.dataProvider=this._listDt1;this.List1.dataProvider=this._listDt2;this.Img0.source="peakness_danfusai";this.Img1.source="peakness_kuafusai"};PeakAwardPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var bfAwardDtList=[];for(var key in GlobalConfig.PeakRaceTime){var dp=GlobalConfig.PeakRaceTime[key];if(dp.loseMail)bfAwardDtList.push(dp)}var first=new PeakRaceTime;first.loseMail=GlobalConfig.PeakRaceBase.winMail;first.status=BF_PeakStatus.Over;bfAwardDtList.push(first);bfAwardDtList.reverse();this._listDt1.replaceAll(bfAwardDtList);bfAwardDtList=[];for(var key in GlobalConfig.PeakRaceCrossTime){var dp=GlobalConfig.PeakRaceCrossTime[key];if(dp.loseMail)bfAwardDtList.push(dp)}var KFfirst=new PeakRaceCrossTime;KFfirst.loseMail=GlobalConfig.PeakRaceBase.crossWinMail;KFfirst.status=KF_PeakStatus.Over;bfAwardDtList.push(KFfirst);bfAwardDtList.reverse();this._listDt2.replaceAll(bfAwardDtList);this.showFirst()};PeakAwardPanel.prototype.showFirst=function(){if(PeakedSys.ins().bfStatus<=BF_PeakStatus.Finals){this.Img0.source="peakness_danfusai";this.Img1.source="peakness_kuafusai";this.List0.dataProvider=this._listDt1;this.List1.dataProvider=this._listDt2}else{this.Img0.source="peakness_kuafusai";this.Img1.source="peakness_danfusai";this.List0.dataProvider=this._listDt2;this.List1.dataProvider=this._listDt1}};PeakAwardPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};return PeakAwardPanel}(BaseView);__reflect(PeakAwardPanel.prototype,"PeakAwardPanel");var PeakChipMallPanel=function(_super){__extends(PeakChipMallPanel,_super);function PeakChipMallPanel(){return _super.call(this)||this}PeakChipMallPanel.prototype.childrenCreated=function(){this.listView.itemRenderer=HonorMarketItemRenderer;this.dataArr=new eui.ArrayCollection;this.listView.dataProvider=this.dataArr};PeakChipMallPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.getWay,this.onGetway);this.observe(Shop.ins().postRefresMedalMessage,this.updateData);this.observe(Actor.ins().postChip,this.callback);this.observe(Shop.ins().postUpdateBuyMedal,this.callback);Shop.ins().sendMedalMessage()};PeakChipMallPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.$onClose();this.removeTouchEvent(this.getWay,this.onGetway)};PeakChipMallPanel.prototype.callback=function(){Shop.ins().sendMedalMessage()};PeakChipMallPanel.prototype.onGetway=function(){};PeakChipMallPanel.prototype.updateData=function(){var arr=[];var dataProvider=GlobalConfig.FeatsStore;for(var k in dataProvider){if(dataProvider[k].shopType==2)continue;var isPush=true;if(dataProvider[k].buyType==FEATS_TYPE.forever&&Shop.ins().medalData){for(var i in Shop.ins().medalData.exchangeCount){if(dataProvider[k].index==Number(i)&&dataProvider[k].daycount){if(Shop.ins().medalData.exchangeCount[i]>=dataProvider[k].daycount){isPush=false}break}}}if(isPush)arr.push(dataProvider[k])}this.dataArr.replaceAll(arr);this.myLabel.text=Actor.chip+"";var text=this.getWay.text;this.getWay.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+text)};return PeakChipMallPanel}(BaseView);__reflect(PeakChipMallPanel.prototype,"PeakChipMallPanel");var PeakedFBResult=function(_super){__extends(PeakedFBResult,_super);function PeakedFBResult(){var _this=_super.call(this)||this;_this.AUTO_QUIT_TIME=5;_this._curTime=0;_this.skinName="PeakedNessResultSkin";return _this}PeakedFBResult.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.quitBtn,this.onQuit);var player=param[1];var str="";if(param[0]){this.bg.source="win_png";this.result.source="win_02";this.resultImg.source="peakness_win";this.win.visible=true;this.lose.visible=false;this.winPlayer.text=player}else{this.bg.source="lost_png";this.result.source="lost_02";this.resultImg.source="peakness_lose";this.win.visible=false;this.lose.visible=true;this.losePlayer.text=player}TimerManager.ins().doTimer(1e3,this.AUTO_QUIT_TIME,this.onTick,this);this._curTime=this.AUTO_QUIT_TIME;this.onTick()};PeakedFBResult.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.onTick,this)};PeakedFBResult.prototype.onTick=function(){this.quitBtn.label=i18n("PeakedFBResult_0",--this._curTime);if(this._curTime<0){this.onQuit()}};PeakedFBResult.prototype.onQuit=function(){UserFb.ins().sendExitFb();ViewManager.ins().close(PeakedFBResult);if(PeakedSys.ins().isKf()){PeakedSys.ins().crossScene=1}else{TimerManager.ins().doTimer(300,1,function(){ViewManager.ins().open(PeakedMainWin)},this)}};return PeakedFBResult}(BaseEuiView);__reflect(PeakedFBResult.prototype,"PeakedFBResult");ViewManager.ins().reg(PeakedFBResult,LayerManager.UI_Popup);var PeakedMainWin=function(_super){__extends(PeakedMainWin,_super);function PeakedMainWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="PeakednessWinSkin";return _this}PeakedMainWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=param[0]?param[0]:0;this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.addTouchEvent(this.help,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.setOpenIndex(this.oldIndex);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.observe(PeakedRedpoint.ins().postRedPoint,this.refRedpoint)};PeakedMainWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.viewStack.getElementAt(this.oldIndex)){this.viewStack.getElementAt(this.oldIndex)["close"]()}};PeakedMainWin.prototype.openOtherPlayerView=function(otherPlayerData){if(this.oldIndex==4)return;var hasTopRank=ViewManager.ins().isShow(PeakTopRankWin);if(hasTopRank)ViewManager.ins().close(PeakTopRankWin);var win=ViewManager.ins().open(RRoleWin,otherPlayerData);win.hideEx(1);win.closeFun=function(){if(hasTopRank)ViewManager.ins().open(PeakTopRankWin)}};PeakedMainWin.prototype.onTabTouch=function(e){var index=this.tab.selectedIndex;this.setOpenIndex(index)};PeakedMainWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};PeakedMainWin.prototype.checkIsOpen=function(index){return true};PeakedMainWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case 0:this.peakedPanel.open();break;case 1:this.peakAwardPanel.open();break;case 2:this.peakedMallPanel.open();break;case 3:this.peakChipMallPanel.open();break;case 4:this.worshipChampionPanel.open();break}if(this.oldIndex!=selectedIndex){this.viewStack.getElementAt(this.oldIndex)["close"]();this.oldIndex=selectedIndex}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}};PeakedMainWin.prototype.onTouch=function(e){switch(e.target){case this.help:var helpId=PeakedSys.ins().isKf()?32:31;ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[helpId].text);break;case this.closeBtn:ViewManager.ins().close(this);break}};PeakedMainWin.prototype.refRedpoint=function(){this.redPoint0.visible=PeakedRedpoint.ins().redpoint1>0;this.redPoint1.visible=false;this.redPoint2.visible=false;this.redPoint3.visible=false;this.redPoint4.visible=PeakedRedpoint.ins().redpoint3>0};PeakedMainWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(PeakedSys.ins().isOpen())return true;else{UserTips.ins().showTips(i18n("PeakedMainWin_0"));return false}};return PeakedMainWin}(BaseEuiView);__reflect(PeakedMainWin.prototype,"PeakedMainWin");ViewManager.ins().reg(PeakedMainWin,LayerManager.UI_Main);var PeakedMallPanel=function(_super){__extends(PeakedMallPanel,_super);function PeakedMallPanel(){return _super.call(this)||this}PeakedMallPanel.prototype.childrenCreated=function(){this.listView.itemRenderer=HonorMarketItemRenderer;this.dataArr=new eui.ArrayCollection;this.listView.dataProvider=this.dataArr};PeakedMallPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.getWay,this.onGetway);this.observe(Shop.ins().postRefresMedalMessage,this.updateData);this.observe(Shop.ins().postUpdateBuyMedal,this.callback);Shop.ins().sendMedalMessage()};PeakedMallPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.getWay,this.onGetway);this.$onClose()};PeakedMallPanel.prototype.callback=function(){Shop.ins().sendMedalMessage()};PeakedMallPanel.prototype.onGetway=function(){};PeakedMallPanel.prototype.updateData=function(){var arr=[];var dataProvider=GlobalConfig.FeatsStore;for(var k in dataProvider){if(dataProvider[k].shopType==1)continue;var isPush=true;if(dataProvider[k].buyType==FEATS_TYPE.forever&&Shop.ins().medalData){for(var i in Shop.ins().medalData.exchangeCount){if(dataProvider[k].index==Number(i)&&dataProvider[k].daycount){if(Shop.ins().medalData.exchangeCount[i]>=dataProvider[k].daycount){isPush=false}break}}}if(isPush)arr.push(dataProvider[k])}this.dataArr.replaceAll(arr);this.myLabel.text=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.PeakRaceBase.exchangeItems[0])+""};return PeakedMallPanel}(BaseView);__reflect(PeakedMallPanel.prototype,"PeakedMallPanel");var PeakedPanel=function(_super){__extends(PeakedPanel,_super);function PeakedPanel(){return _super.call(this)||this}PeakedPanel.prototype.childrenCreated=function(){};PeakedPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(PeakedSys.ins().postState,this.upCurState);this.upCurState()};PeakedPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.$onClose();if(this._curPanel){this._curPanel["close"]();DisplayUtils.removeFromParent(this._curPanel)}};PeakedPanel.prototype.upCurState=function(){if(this._curPanel){this._curPanel["close"]();DisplayUtils.removeFromParent(this._curPanel)}if(PeakedSys.ins().isKf()){var curStatus=PeakedSys.ins().kfStatus;if(curStatus==KF_PeakStatus.Knockout){if(PeakedSys.ins().kfStatusIsEnd){curStatus=KF_PeakStatus.Prom64}}switch(curStatus){case KF_PeakStatus.None:case KF_PeakStatus.Knockout:if(!this.signupPanel)this.signupPanel=new SignupPanel;this._curPanel=this.signupPanel;break;case KF_PeakStatus.Prom64:case KF_PeakStatus.Prom32:case KF_PeakStatus.Prom16:case KF_PeakStatus.Prom8:case KF_PeakStatus.Prom4:case KF_PeakStatus.Finals:if(!this.sixteenPanel)this.sixteenPanel=new SixteenPanel;this._curPanel=this.sixteenPanel;break}}else{var curStatus=PeakedSys.ins().bfStatus;if(curStatus==BF_PeakStatus.Knockout){if(PeakedSys.ins().bfStatusIsEnd)curStatus=BF_PeakStatus.Prom16;else if(!PeakedSys.ins().isSignUp){UserTips.ins().showTips(i18n("PeakedPanel_0"));curStatus=BF_PeakStatus.SignUp}}switch(curStatus){case BF_PeakStatus.None:case BF_PeakStatus.SignUp:case BF_PeakStatus.Knockout:if(!this.signupPanel)this.signupPanel=new SignupPanel;this._curPanel=this.signupPanel;break;case BF_PeakStatus.Prom16:case BF_PeakStatus.Prom8:case BF_PeakStatus.Prom4:case BF_PeakStatus.Finals:case BF_PeakStatus.Over:if(!this.sixteenPanel)this.sixteenPanel=new SixteenPanel;this._curPanel=this.sixteenPanel;break}}if(this._curPanel){this.addChild(this._curPanel);this._curPanel["open"]()}};return PeakedPanel}(BaseView);__reflect(PeakedPanel.prototype,"PeakedPanel");var SignupPanel=function(_super){__extends(SignupPanel,_super);function SignupPanel(){var _this=_super.call(this)||this;_this.curKonckRound=0;_this.skinName="SignupSkin";_this.left=0;_this.right=0;_this.top=0;_this.bottom=0;return _this}SignupPanel.prototype.childrenCreated=function(){this.eliminateInfoList.itemRenderer=PeakKnockoutItemItemRender;this._eliminateInfoDt=new eui.ArrayCollection;this.eliminateInfoList.dataProvider=this._eliminateInfoDt;this.rewardList.itemRenderer=ItemBase;var knockOutTime=DateUtils.getFormatBySecond(GlobalConfig.PeakRaceBase.KnockOutTime,DateUtils.TIME_FORMAT_10);this.info.text=i18n("SignupPanel_0",GlobalConfig.PeakRaceBase.signUpLose,knockOutTime);this.signUpRuleTxt0.visible=false};SignupPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(PeakedSys.ins().postState,this.upCurState);this.observe(PeakedSys.ins().postSignUp,this.upSignUpState);this.observe(PeakedRedpoint.ins().postRedPoint,this.refRedPoint);this.observe(PeakedSys.ins().postEliminateReportData,this.upEliminateReport);this.observe(PeakedSys.ins().postKFEliminateReportData,this.upEliminateReport);this.addTouchEvent(this.signUpBtn,this.onTouch);this.addTouchEvent(this.eliminateInfoList,this.onTouch);PeakedRedpoint.ins().postRedPoint();if(PeakedSys.ins().isKf()){var state=PeakedSys.ins().kfStatus;if(state==KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd==0){this.observe(PeakedSys.ins().postBFInfoList,this.upCurState);PeakedSys.ins().sendBFInfoList()}else this.upCurState()}else this.upCurState()};SignupPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.$onClose();this.removeTouchEvent(this.signUpBtn,this.onTouch);this.removeTouchEvent(this.eliminateInfoList,this.onTouch);TimerManager.ins().remove(this.onTime,this)};SignupPanel.prototype.onTouch=function(e){switch(e.target){case this.signUpBtn:if(PeakedRedpoint.ins().redpoint1>0){PeakedSys.ins().sendSignUp()}else if(PeakedSys.ins().bfStatus==BF_PeakStatus.Knockout&&!PeakedSys.ins().isSignUp){UserTips.ins().showTips(i18n("SignupPanel_2"))}else if(UserZs.ins().lv<GlobalConfig.PeakRaceBase.needZsLv){UserTips.ins().showTips(i18n("SignupPanel_3",GlobalConfig.PeakRaceBase.needZsLv))}else{UserTips.ins().showTips(i18n("SignupPanel_4"))}break;case this.eliminateInfoList:break;default:if(e.target instanceof eui.Label&&e.target.parent instanceof PeakKnockoutItemItemRender&&e.target.name){var info=e.target.parent.data;if(info)UserReadPlayer.ins().sendFindPlayer(e.target.name,info.servId);else UserReadPlayer.ins().sendFindPlayer(e.target.name)}}};SignupPanel.prototype.upCurState=function(){if(PeakedSys.ins().isKf()){var state=PeakedSys.ins().kfStatus;if(state==KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd==0){if(!PeakedSys.ins().isSignUp){UserTips.ins().showTips(i18n("SignupPanel_5"));state=KF_PeakStatus.None}else if(!PeakedHelp.isSixteenById(Actor.actorID)){UserTips.ins().showTips(i18n("SignupPanel_6"));state=KF_PeakStatus.None}}switch(state){case KF_PeakStatus.None:this.signGroup.visible=true;this.knockoutGroup.visible=false;this.signUpBtn.visible=false;this.signed.visible=false;this.signUpRuleTxt.textFlow=TextFlowMaker.generateTextFlow(PeakedHelp.getKFTimerRuleStr());this.signUpRuleTxt0.visible=false;this.rewardList.dataProvider=new eui.ArrayCollection(GlobalConfig.PeakRaceBase.croosRewards);break;case KF_PeakStatus.Knockout:this.signGroup.visible=false;this.knockoutGroup.visible=true;this.signUpBtn.visible=false;this.signed.visible=false;PeakedSys.ins().sendKFEliminateReport();break;case KF_PeakStatus.Prom64:case KF_PeakStatus.Prom32:case KF_PeakStatus.Prom16:case KF_PeakStatus.Prom8:case KF_PeakStatus.Prom4:case KF_PeakStatus.Finals:break}}else{var state=PeakedSys.ins().bfStatus;if(state==BF_PeakStatus.Knockout&&!PeakedSys.ins().isSignUp){state=BF_PeakStatus.SignUp;this.signUpBtn.visible=false}switch(state){case BF_PeakStatus.None:case BF_PeakStatus.SignUp:this.signGroup.visible=true;this.knockoutGroup.visible=false;if(PeakedSys.ins().isSignUp){this.signed.visible=true;this.signUpBtn.visible=false}else{this.signUpBtn.visible=true;this.signUpBtn.label=i18n("SignupPanel_9");this.signed.visible=false}if(state==BF_PeakStatus.None)this.signUpBtn.visible=false;this.signUpRuleTxt.textFlow=TextFlowMaker.generateTextFlow(PeakedHelp.getTimerRuleStr());this.signUpRuleTxt0.visible=true;this.rewardList.dataProvider=new eui.ArrayCollection(GlobalConfig.PeakRaceBase.singleRewards);break;case BF_PeakStatus.Knockout:this.signGroup.visible=false;this.knockoutGroup.visible=true;PeakedSys.ins().sendEliminateReport();break;case BF_PeakStatus.Prom16:case BF_PeakStatus.Prom8:case BF_PeakStatus.Prom4:case BF_PeakStatus.Finals:break}}};SignupPanel.prototype.upSignUpState=function(state){if(state===void 0){state=-1}if(PeakedSys.ins().isSignUp){this.signed.visible=true;this.signUpBtn.visible=false;if(state!=-1)UserTips.ins().showTips(i18n("SignupPanel_11"))}};SignupPanel.prototype.upEliminateReport=function(){var sysDt=PeakedSys.ins();var reportList=sysDt.isKf()?sysDt.kfKonckReportList:sysDt.bfKonckReportList;this.curKonckRound=sysDt.isKf()?sysDt.kfKonckRound:sysDt.bfKonckRound;var surplusNum=sysDt.isKf()?sysDt.kfKonckSurplusNum:sysDt.bfKonckSurplusNum;this._eliminateInfoDt.replaceAll(reportList);DisplayUtils.scrollerToBottom(this.eliminateListScroller);var record=i18n("SignupPanel_12");var winNum=PeakedHelp.calcEliminateWinNum();if(reportList.length-winNum>=GlobalConfig.PeakRaceBase.signUpLose){record=i18n("SignupPanel_13",ColorUtil.RED_COLOR_N);this.nextStartCountdownLabel.visible=false;this.state2.visible=false}else{var loseNum=this.curKonckRound-winNum<0?0:this.curKonckRound-winNum;record+=i18n("SignupPanel_14",winNum,loseNum);TimerManager.ins().remove(this.onTime,this);TimerManager.ins().doTimer(1e3,0,this.onTime,this);this.onTime(true);this.state2.visible=true}this.eliminateInfoLabel.textFlow=TextFlowMaker.generateTextFlow1(i18n("SignupPanel_15",this.curKonckRound,surplusNum,record))};SignupPanel.prototype.onTime=function(isInt){if(isInt===void 0){isInt=false}var kNextTimer=PeakedSys.ins().isKf()?PeakedSys.ins().kfKonckNextTimer:PeakedSys.ins().bfKonckNextTimer;var nexttimer=Math.floor((DateUtils.formatMiniDateTime(kNextTimer)-GameServer.serverTime)/1e3);if(nexttimer>0){this.nextStartCountdownLabel.text=DateUtils.getFormatBySecond(nexttimer)}else{TimerManager.ins().remove(this.onTime,this);this.nextStartCountdownLabel.text="";if(!isInt){}}};SignupPanel.prototype.refRedPoint=function(){this.redPoint.visible=PeakedRedpoint.ins().redpoint1>0};__decorate([callLater],SignupPanel.prototype,"upCurState",null);return SignupPanel}(BaseView);__reflect(SignupPanel.prototype,"SignupPanel");var SixteenPanel=function(_super){__extends(SixteenPanel,_super);function SixteenPanel(){var _this=_super.call(this)||this;_this._curGroup=0;_this.MAX=16;_this.PK_GROUP_0=0;_this.PK_GROUP_1=1;_this.PK_GROUP_2=2;_this.PK_GROUP_3=3;_this.hasBed=false;_this.lastStatus=0;_this.skinName="SixteenSkin";_this.left=0;_this.right=0;_this.top=0;_this.bottom=0;return _this}SixteenPanel.prototype.childrenCreated=function(){this._linkGroupList=[];this._linkGroupList[this.PK_GROUP_0]=[];this._linkGroupList[this.PK_GROUP_1]=[];this._linkGroupList[this.PK_GROUP_2]=[];this._linkGroupList[this.PK_GROUP_3]=[];this._vsBtnList=[];this._vsBtnList[this.PK_GROUP_1]=[];this._vsBtnList[this.PK_GROUP_2]=[];this._vsBtnList[this.PK_GROUP_3]=[];this._playerLabelList=[];for(var i=1;i<=this.MAX;i++){var actBtn1=this["actState_1_"+i];var actBtn2=this["actState_2_"+i];var actBtn3=this["actState_3_"+i];if(actBtn1){actBtn1.name=this.PK_GROUP_1+"_"+i;actBtn1.currentState="view";this._vsBtnList[this.PK_GROUP_1].push(actBtn1);actBtn1.visible=false}if(actBtn2){actBtn2.name=this.PK_GROUP_2+"_"+i;actBtn2.currentState="view";this._vsBtnList[this.PK_GROUP_2].push(actBtn2);actBtn2.visible=false}if(actBtn3){actBtn3.name=this.PK_GROUP_3+"_"+i;actBtn3.currentState="view";this._vsBtnList[this.PK_GROUP_3].push(actBtn3);actBtn3.visible=false}this["player"+(i-1)].text="---";this["player"+(i-1)].name="";this._playerLabelList.push(this["player"+(i-1)]);var line0=this["link_0_"+i];var line1=this["link_1_"+i];var line2=this["link_2_"+i];var line3=this["link_3_"+i];if(line0)this._linkGroupList[this.PK_GROUP_0].push(line0);if(line1)this._linkGroupList[this.PK_GROUP_1].push(line1);if(line2)this._linkGroupList[this.PK_GROUP_2].push(line2);if(line3)this._linkGroupList[this.PK_GROUP_3].push(line3);this.finals.touchChildren=false}this.groupBtnSelect0.touchEnabled=false;this.groupBtnSelect1.touchEnabled=false;this.groupBtnSelect2.touchEnabled=false;this.groupBtnSelect3.touchEnabled=false};SixteenPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(PeakedSys.ins().postState,this.upCurState);this.observe(PeakedSys.ins().postBetInfo,this.refBetState);this.observe(PeakedSys.ins().postKFBetInfo,this.refBetState);this.observe(PeakedSys.ins().postBFInfoList,this.upSixteenData);this.observe(PeakedSys.ins().postKFInfoList,this.upSixteenData);this.observe(PeakedRedpoint.ins().postRedPoint,this.refRedpoint);for(var _a=0,_b=this._vsBtnList;_a<_b.length;_a++){var btns=_b[_a];if(btns){for(var _c=0,btns_2=btns;_c<btns_2.length;_c++){var btn=btns_2[_c];this.addTouchEvent(btn,this.onTouchBtn)}}}for(var _d=0,_e=this._playerLabelList;_d<_e.length;_d++){var player=_e[_d];this.addTouchEvent(player,this.onTouchPlayer)}this.addTouchEvent(this.myRecord,this.onTouch);this.addTouchEvent(this.myBet,this.onTouch);this.addTouchEvent(this.topRank,this.onTouch);this.addTouchEvent(this.groupBtn1,this.onChargeTab);this.addTouchEvent(this.groupBtn2,this.onChargeTab);this.addTouchEvent(this.groupBtn3,this.onChargeTab);this.addTouchEvent(this.groupBtn0,this.onChargeTab);this.addTouchEvent(this.finals,this.onTouch);this.addTouchEvent(this.vewChampScore,this.onTouch);this.clearGroupSelect();PeakedRedpoint.ins().postRedPoint();this.upCurState()};SixteenPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var _a=0,_b=this._vsBtnList;_a<_b.length;_a++){var btns=_b[_a];if(!btns)continue;for(var _c=0,btns_3=btns;_c<btns_3.length;_c++){var btn=btns_3[_c];this.removeTouchEvent(btn,this.onTouchBtn)}}for(var _d=0,_e=this._playerLabelList;_d<_e.length;_d++){var player=_e[_d];this.removeTouchEvent(player,this.onTouchPlayer)}this.removeTouchEvent(this.myRecord,this.onTouch);this.removeTouchEvent(this.myBet,this.onTouch);this.removeTouchEvent(this.topRank,this.onTouch);this.removeTouchEvent(this.groupBtn1,this.onChargeTab);this.removeTouchEvent(this.groupBtn2,this.onChargeTab);this.removeTouchEvent(this.groupBtn3,this.onChargeTab);this.removeTouchEvent(this.groupBtn0,this.onChargeTab);this.removeTouchEvent(this.finals,this.onTouch);this.removeTouchEvent(this.vewChampScore,this.onTouch);this.$onClose();this.peakEff.stop();DisplayUtils.removeFromParent(this.peakEff)};SixteenPanel.prototype.upCurState=function(){if(!this.peakEff){this.peakEff=new MovieClip;this.peakEff.x=83;this.peakEff.y=283;this.peakEff.touchEnabled=false}this.peakEff.playFile(RES_DIR_EFF+"dianfengjuesai",-1);this.competion.addChild(this.peakEff);this.peakEff.visible=true;if(PeakedSys.ins().isKf()){if(PeakedSys.ins().isKFSixteen()){this.currentState="kf"}else{this.currentState="kf_four";this.peakEff.stop();DisplayUtils.removeFromParent(this.peakEff)}this.upKf16Data()}else{this.currentState="bf"}this.upStateData()};SixteenPanel.prototype.upStateData=function(){var time=0;if(PeakedSys.ins().isKf()){var state=PeakedSys.ins().kfStatus;if(state==KF_PeakStatus.Finals&&PeakedSys.ins().kfStatusIsEnd!=0){this.singleTimeInfoLabel.text="";this.timerGroup.visible=false}else{if(PeakedSys.ins().kfStatusIsEnd)state++;time=PeakedHelp.kfStatusTimer[state];this.singleTimeInfoLabel.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_13)+" "+PeakedData.STATE_KF_TYPE_CN[state]}PeakedSys.ins().sendKFInfoList()}else{var state=PeakedSys.ins().bfStatus;if(state==0)return;if(state==BF_PeakStatus.Finals&&PeakedSys.ins().bfStatusIsEnd!=0){this.singleTimeInfoLabel.text="";this.timerGroup.visible=false}else{if(PeakedSys.ins().bfStatusIsEnd)state++;time=PeakedHelp.bfStatusTimer[state];this.singleTimeInfoLabel.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_13)+" "+PeakedData.STATE_TYPE_CN[state]}PeakedSys.ins().sendBFInfoList()}if(this.timerGroup.visible){for(var i=1;i<=5;i++){this["gameTime"+i+"Txt"].text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_14);time+=GlobalConfig.PeakRaceBase.promInterval}}};SixteenPanel.prototype.refBetState=function(){var bfStatus=PeakedSys.ins().bfStatus;var kfStatus=PeakedSys.ins().kfStatus;var isKf=PeakedSys.ins().isKf();if(isKf){if(kfStatus!=this.lastStatus)this.hasBed=false;this.lastStatus=kfStatus}else{if(bfStatus!=this.lastStatus)this.hasBed=false;this.lastStatus=bfStatus}bfStatus=PeakedSys.ins().bfStatusIsEnd?bfStatus+1:bfStatus;kfStatus=PeakedSys.ins().kfStatusIsEnd?kfStatus+1:kfStatus;if((PeakedSys.ins().bfStatus+1==BF_PeakStatus.Finals||PeakedSys.ins().kfStatus+1==KF_PeakStatus.Finals)&&PeakedSys.ins().bfStatusIsEnd){var playData=void 0;if(isKf){playData=PeakedHelp.getKFPlayerData(4,1,this._curGroup,PeakedSys.ins().isKFSixteen())}else{playData=PeakedHelp.getPlayerData(4,1)}if(playData&&PeakedHelp.checkIsBet(playData.playerList,"4")){this.vewChampScore.textFlow=TextFlowMaker.generateTextFlow1(i18n("SixteenPanel_0"))}else this.vewChampScore.textFlow=TextFlowMaker.generateTextFlow1(i18n("SixteenPanel_1"))}else this.vewChampScore.textFlow=TextFlowMaker.generateTextFlow1(i18n("SixteenPanel_2"));if(!isKf){this.vewChampScore.visible=bfStatus>BF_PeakStatus.Prom4}else this.vewChampScore.visible=kfStatus>KF_PeakStatus.Prom4;for(var type in this._vsBtnList){var canBet=false;if(isKf){if(PeakedSys.ins().isKFSixteen()){canBet=type==this.PK_GROUP_1+""&&kfStatus==KF_PeakStatus.Prom16||type==this.PK_GROUP_2+""&&kfStatus==KF_PeakStatus.Prom8||type==this.PK_GROUP_3+""&&kfStatus==KF_PeakStatus.Prom4;for(var _i=0,_a=this._vsBtnList[type];_i<_a.length;_i++){var btn=_a[_i];btn.visible=type==this.PK_GROUP_1+""&&kfStatus>=KF_PeakStatus.Prom16||type==this.PK_GROUP_2+""&&kfStatus>=KF_PeakStatus.Prom8||type==this.PK_GROUP_3+""&&kfStatus>=KF_PeakStatus.Prom4}}else{canBet=type==this.PK_GROUP_1+""&&kfStatus==KF_PeakStatus.Prom64||type==this.PK_GROUP_2+""&&kfStatus==KF_PeakStatus.Prom32;for(var _b=0,_c=this._vsBtnList[type];_b<_c.length;_b++){var btn=_c[_b];btn.visible=type==this.PK_GROUP_1+""&&kfStatus>=KF_PeakStatus.Prom64||type==this.PK_GROUP_2+""&&kfStatus>=KF_PeakStatus.Prom32}}}else{canBet=type==this.PK_GROUP_1+""&&bfStatus==BF_PeakStatus.Prom16||type==this.PK_GROUP_2+""&&bfStatus==BF_PeakStatus.Prom8||type==this.PK_GROUP_3+""&&bfStatus==BF_PeakStatus.Prom4;for(var _d=0,_e=this._vsBtnList[type];_d<_e.length;_d++){var btn=_e[_d];btn.visible=type==this.PK_GROUP_1+""&&bfStatus>=BF_PeakStatus.Prom16||type==this.PK_GROUP_2+""&&bfStatus>=BF_PeakStatus.Prom8||type==this.PK_GROUP_3+""&&bfStatus>=BF_PeakStatus.Prom4}}if(isKf)canBet=canBet&&PeakedSys.ins().kfStatusIsEnd!=0;else canBet=canBet&&PeakedSys.ins().bfStatusIsEnd!=0;for(var _f=0,_g=this._vsBtnList[type];_f<_g.length;_f++){var btn=_g[_f];if(!btn)continue;if(canBet){var groupArr=btn.name.split("_");var playData=void 0;if(isKf){playData=PeakedHelp.getKFPlayerData(+groupArr[0],+groupArr[1],this._curGroup,PeakedSys.ins().isKFSixteen())}else{playData=PeakedHelp.getPlayerData(+groupArr[0],+groupArr[1])}if(playData&&PeakedHelp.checkIsBet(playData.playerList,type)){btn.currentState="beted";this.hasBed=true;break}else{btn.currentState="bet"}}else{btn.currentState="view"}}if(canBet&&this.hasBed){for(var _h=0,_j=this._vsBtnList[type];_h<_j.length;_h++){var btn=_j[_h];if(btn.currentState=="bet")btn.currentState="view"}}}};SixteenPanel.prototype.upSixteenData=function(){if(PeakedSys.ins().isKf()){if(this.currentState=="kf_four"){var betGroup=PeakedHelp.findBetKFGroup();if(betGroup>-1)this._curGroup=betGroup;else this._curGroup=PeakedHelp.findKFGroupById(Actor.actorID);this._curGroup=this._curGroup<0?0:this._curGroup;if(this["groupBtnSelect"+this._curGroup])this["groupBtnSelect"+this._curGroup].visible=true}this.upKf16Data()}else this.up16Data(PeakedSys.ins().player16List)};SixteenPanel.prototype.upKf16Data=function(){if(PeakedSys.ins().isKFSixteen()){this.up16Data(PeakedSys.ins().kfPlayer16List)}else if(PeakedSys.ins().kfPlayer64List)this.up16Data(PeakedSys.ins().kfPlayer64List.slice(this._curGroup*this.MAX>>1,this._curGroup*this.MAX+this.MAX>>1))};SixteenPanel.prototype.up16Data=function(list){this.clearPlayer();if(list){for(var i=0;i<this.MAX;i++){if(i%2==0){var data=list[i/2];if(data&&data.playerList[0]){this["player"+i].text=""+data.playerList[0].playerName;this["player"+i].name=data.playerList[0].playerName+"_"+data.playerList[0].roleId;if(data.playerList[0].roleId==Actor.actorID)this["player"+i].textColor=ColorUtil.GREEN_COLOR_N;else this["player"+i].textColor=16708269}if(data&&data.playerList[1]){this["player"+(i+1)].text=""+data.playerList[1].playerName;this["player"+(i+1)].name=data.playerList[1].playerName+"_"+data.playerList[1].roleId;if(data.playerList[1].roleId==Actor.actorID)this["player"+(i+1)].textColor=ColorUtil.GREEN_COLOR_N;else this["player"+(i+1)].textColor=16708269}}}}var playerData;if(PeakedSys.ins().isKf()){if(PeakedSys.ins().isKFSixteen()){var championData=PeakedSys.ins().kfPlayer2Data;if(championData)playerData=PeakedHelp.findPlayerDtById(championData.winId,PeakedSys.ins().kfPlayer64List)}}else{var championData=PeakedSys.ins().player2Data;if(championData)playerData=PeakedHelp.findPlayerDtById(championData.winId,PeakedSys.ins().player16List)}if(playerData){this.championFace.source="yuanhead"+playerData.job+playerData.sex;this.championNameLabel.text=playerData.playerName;this.championNameLabel.name=playerData.playerName+"_"+playerData.roleId;this.competion.visible=false;this.finals.visible=true}else{this.championFace.source="";this.championNameLabel.text="";this.championNameLabel.name="";this.competion.visible=true;this.finals.visible=false}this.upLink();this.refBetState()};SixteenPanel.prototype.upLink=function(){this.clearLink();var sys=PeakedSys.ins();var lists=[];if(sys.isKf()){if(PeakedSys.ins().isKFSixteen()){lists=[sys.kfPlayer16List,sys.kfPlayer8List,sys.kfPlayer4List,[sys.kfPlayer2Data]]}else{lists=[sys.kfPlayer64List.slice(this._curGroup*this.MAX>>1,this._curGroup*this.MAX+this.MAX>>1),sys.kfPlayer32List.slice(this._curGroup*this.MAX>>2,this._curGroup*this.MAX+this.MAX>>2),sys.kfPlayer16List.slice(this._curGroup*this.MAX>>3,this._curGroup*this.MAX+this.MAX>>3),sys.kfPlayer8List.slice(this._curGroup*this.MAX>>4,this._curGroup*this.MAX+this.MAX>>4)]}}else{lists=[sys.player16List,sys.player8List,sys.player4List,[sys.player2Data]]}var nx=0;for(var _i=0,lists_1=lists;_i<lists_1.length;_i++){var list=lists_1[_i];if(list&&this._linkGroupList[nx].length>0){var ix=0;for(var _a=0,list_14=list;_a<list_14.length;_a++){var dt=list_14[_a];if(!dt)continue;if(PeakedHelp.findPlayerIndexById(dt.winId,dt.playerList)==0){PeakedHelp.setImgGroupSource(this._linkGroupList[nx][ix*2],"line_light")}else if(PeakedHelp.findPlayerIndexById(dt.winId,dt.playerList)==1){PeakedHelp.setImgGroupSource(this._linkGroupList[nx][ix*2+1],"line_light")}ix++}}nx++}};SixteenPanel.prototype.onTouchPlayer=function(e){var label=e.target;if(label.name){var arr=label.name.split("_");if(Actor.myName==arr[0]){ViewManager.ins().open(RoleWin);return}var info=PeakedHelp.findPlayerDtById(+arr[1]);if(info)UserReadPlayer.ins().sendFindPlayer(arr[1],info.serverId);else UserReadPlayer.ins().sendFindPlayer(arr[1])}};SixteenPanel.prototype.onTouchBtn=function(e){var actbtn=e.target.parent;var nameStr=actbtn.name;var groupArr=nameStr.split("_");switch(actbtn.currentState){case"view":ViewManager.ins().open(PeakViewBattleReportWin,+groupArr[0],+groupArr[1],this._curGroup);break;case"bet":ViewManager.ins().open(PeakBetWin,+groupArr[0],+groupArr[1],this._curGroup);break;case"beted":break}};SixteenPanel.prototype.onTouch=function(e){switch(e.target){case this.finals:var arr=this.championNameLabel.name.split("_");if(Actor.myName==arr[0]){ViewManager.ins().open(RoleWin);return}var info=PeakedHelp.findPlayerDtById(+arr[1]);if(info)UserReadPlayer.ins().sendFindPlayer(arr[1],info.serverId);else UserReadPlayer.ins().sendFindPlayer(arr[1]);break;case this.vewChampScore:if(this.vewChampScore.text==i18n("SixteenPanel_5"))ViewManager.ins().open(PeakViewBattleReportWin,4,1,this._curGroup);else if(this.vewChampScore.text==i18n("SixteenPanel_6")){ViewManager.ins().open(PeakBetWin,4,1,this._curGroup)}break;case this.myRecord:ViewManager.ins().open(PeakMyBattleRecordWin,this._curGroup);break;case this.myBet:ViewManager.ins().open(PeakMyBetRecordWin);break;case this.topRank:ViewManager.ins().open(PeakTopRankWin);break}};SixteenPanel.prototype.onChargeTab=function(e){this.clearGroupSelect();switch(e.target){case this.groupBtn0:this._curGroup=0;this.groupBtnSelect0.visible=true;this.upKf16Data();break;case this.groupBtn1:this._curGroup=1;this.groupBtnSelect1.visible=true;this.upKf16Data();break;case this.groupBtn2:this._curGroup=2;this.groupBtnSelect2.visible=true;this.upKf16Data();break;case this.groupBtn3:this._curGroup=3;this.groupBtnSelect3.visible=true;this.upKf16Data();break}};SixteenPanel.prototype.refRedpoint=function(){this.topRankRedpoint.visible=PeakedRedpoint.ins().redpoint2>0};SixteenPanel.prototype.clearLink=function(){for(var i=0;i<this.MAX;i++){if(this._linkGroupList[this.PK_GROUP_0][i])PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_0][i],"line_black");if(this._linkGroupList[this.PK_GROUP_1][i])PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_1][i],"line_black");if(this._linkGroupList[this.PK_GROUP_2][i])PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_2][i],"line_black");if(this._linkGroupList[this.PK_GROUP_3][i])PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_3][i],"line_black")}};SixteenPanel.prototype.clearPlayer=function(){for(var i=1;i<=this.MAX;i++){this["player"+(i-1)].text="";this["player"+(i-1)].name=""}};SixteenPanel.prototype.clearGroupSelect=function(){this.groupBtnSelect0.visible=false;this.groupBtnSelect1.visible=false;this.groupBtnSelect2.visible=false;this.groupBtnSelect3.visible=false};__decorate([callLater],SixteenPanel.prototype,"upStateData",null);__decorate([callLater],SixteenPanel.prototype,"upKf16Data",null);return SixteenPanel}(BaseView);__reflect(SixteenPanel.prototype,"SixteenPanel");var WorshipChampionPanel=function(_super){__extends(WorshipChampionPanel,_super);function WorshipChampionPanel(){return _super.call(this)||this}WorshipChampionPanel.prototype.childrenCreated=function(){this.praiseGroup0.touchChildren=false;this.praiseGroup1.touchChildren=false;this.praiseGroup2.touchChildren=false};WorshipChampionPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Actor.ins().postChip,this.upData);this.observe(PeakedSys.ins().postWorship,this.upData);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.addTouchEvent(this.shipBtn,this.onTouch);this.addTouchEvent(this.praiseGroup0,this.onTouch);this.addTouchEvent(this.praiseGroup1,this.onTouch);this.addTouchEvent(this.praiseGroup2,this.onTouch);this.isEff=false;this.initData();this.upData()};WorshipChampionPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._openOtherWin=false;if(this.titleMc){this.titleMc.destroy();this.titleMc=null}this.$onClose();TimerManager.ins().removeAll(this);DisplayUtils.removeFromParent(this.weaponEff0);DisplayUtils.removeFromParent(this.weaponEff1);DisplayUtils.removeFromParent(this.weaponEff2);DisplayUtils.removeFromParent(this.bodyEff0);DisplayUtils.removeFromParent(this.bodyEff1);DisplayUtils.removeFromParent(this.bodyEff2);if(this.yanHuaMc){this.yanHuaMc.destroy();this.yanHuaMc=null}};WorshipChampionPanel.prototype.initData=function(){if(PeakedSys.ins().kfPlayer2Data&&PeakedSys.ins().kfPlayer2Data.winId&&PeakedSys.ins().kfStatus>=KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd){var info=PeakedHelp.findPlayerDtById(PeakedSys.ins().kfPlayer2Data.winId);if(info)UserReadPlayer.ins().sendFindPlayer(info.roleId,info.serverId);this.shipBtn.enabled=true;this.chipLabel.visible=true;this.countLabel.visible=true}else{this.shipBtn.enabled=false;this.chipLabel.visible=false;this.countLabel.visible=false}for(var i=0;i<3;i++){this["praiseGroup"+i].visible=false}this.name0.text=i18n("WorshipChampionPanel_0");this.chipLabel.text=i18n("WorshipChampionPanel_1",GlobalConfig.PeakRaceBase.mobaiChips);if(!this.titleMc){this.titleMc=ObjectPool.pop("MovieClip");this.titleMc.x=this.titleMcGroup.x;this.titleMc.y=this.titleMcGroup.y}this.titleGroup.addChild(this.titleMc);var eff=RES_DIR_EFF+"chenghao1qiang";this.titleMc.playFile(eff,-1)};WorshipChampionPanel.prototype.upData=function(){var peakBaseDp=GlobalConfig.PeakRaceBase;if(!peakBaseDp.mobaiNum)peakBaseDp.mobaiNum=10;var color=PeakedSys.ins().worshipNum<peakBaseDp.mobaiNum?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N;var str=i18n("WorshipChampionPanel_2",color,PeakedSys.ins().worshipNum,peakBaseDp.mobaiNum);this.countLabel.textFlow=TextFlowMaker.generateTextFlow1(str);if(this.isEff)this.playYHEff()};WorshipChampionPanel.prototype.playYHEff=function(){if(this.yanHuaMc){this.yanHuaMc.destroy();this.yanHuaMc=null}this.yanHuaMc=new MovieClip;this.yanHuaMc.x=270;this.yanHuaMc.y=335;this.addChildAt(this.yanHuaMc,this.numChildren+1);this.yanHuaMc.playFile(RES_DIR_EFF+"yanhuaeff",2);this.isEff=false};WorshipChampionPanel.prototype.onTouch=function(e){switch(e.target){case this.shipBtn:if(PeakedSys.ins().worshipNum>=GlobalConfig.PeakRaceBase.mobaiNum){UserTips.ins().showTips(i18n("WorshipChampionPanel_3"));return}if(!PeakedSys.ins().kfPlayer2Data.winId){UserTips.ins().showTips(i18n("WorshipChampionPanel_4"));return}this.isEff=true;PeakedSys.ins().sendWorship();break;case this.praiseGroup0:case this.praiseGroup1:case this.praiseGroup2:var info=PeakedHelp.findPlayerDtById(PeakedSys.ins().kfPlayer2Data.winId);if(info)UserReadPlayer.ins().sendFindPlayer(info.roleId,info.serverId);break}};WorshipChampionPanel.prototype.openOtherPlayerView=function(otherPlayerData){this.otherPlayerData=otherPlayerData;if(this._openOtherWin){var win=ViewManager.ins().open(RRoleWin,otherPlayerData);win.hideEx(1);this._openOtherWin=false}else{this.startShowZhanling();this._openOtherWin=true;for(var index=0;index<otherPlayerData.roleData.length;index++){this["praiseGroup"+index].visible=true;var role=otherPlayerData.roleData[index];var zb=role.zhuangbei;var isHaveBody=void 0;var bodyId=zb[0];var weaponId=zb[1];var weaponConf=role.getEquipByIndex(0);var weaponConfId=weaponConf.item.configID;var bodyConf=role.getEquipByIndex(2);var bodyConfId=bodyConf.item.configID;var bodyRes="";var weaponRes="";var wingRes="";this["name"+index].text="S."+otherPlayerData.serverId+otherPlayerData.name;if(weaponConfId>0){var fileName=GlobalConfig.EquipConfig[weaponConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}weaponRes=fileName+"_"+role.sex+"_c"}if(bodyConfId>0){var fileName=GlobalConfig.EquipConfig[bodyConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}if(fileName.indexOf("903")>0){bodyRes=fileName+"_"+role.sex+"_c"}else{bodyRes=fileName+"_c"}isHaveBody=true}if(!isHaveBody){bodyRes=getDefaultBody(role.job)+"_c"}if(weaponId>0){weaponRes=getZhuangbanById(weaponId).res+"_"+role.sex+"_c"}if(bodyId>0){bodyRes=getZhuangbanById(bodyId).res+"_c"}var wingdata=role.wingsData;var id=zb[2];if(id>0){wingRes=GlobalConfig.ZhuangBanId[id].res}else if(wingdata.openStatus){wingRes=GlobalConfig.WingLevelConfig[wingdata.lv].appearance}this._body=imageToMc(this["bodyImg"+index],bodyRes,this["bodyMc"+index]);imageToMc(this["weaponImg"+index],weaponRes,this["weaponMc"+index],this._body);imageToMc(this["wingImg"+index],wingRes,this["wingMc"+index],this._body);this.setEffect(role.getEquipByIndex(2).item.configID,"bPos"+index+"_",role.sex,this["bodyEffect"+index],this["bodyEff"+index])}}};WorshipChampionPanel.prototype.setEffect=function(id,imgStr,sex,soulEffGroup,suitEff){if(!suitEff)suitEff=new MovieClip;var cfg=GlobalConfig.EquipWithEffConfig[id+"_"+sex];if(cfg){suitEff.scaleX=suitEff.scaleY=cfg.scaling;if(!suitEff.parent)soulEffGroup.addChild(suitEff);suitEff.x=this[imgStr+sex].x+cfg.offX;suitEff.y=this[imgStr+sex].y+cfg.offY;suitEff.playFile(RES_DIR_EFF+cfg.inShowEff,-1)}else if(suitEff.parent)suitEff.parent.removeChild(suitEff)};WorshipChampionPanel.prototype.showZhanling=function(otherPlayerData){var zhanlingID=otherPlayerData.zhanlingID;var zhanlingLevel=otherPlayerData.zhanlingLevel;if(zhanlingLevel<0)return;var config=GlobalConfig.ZhanLingLevel[zhanlingID][zhanlingLevel];this.warfileName=config.appearance;if(!this.warMc){this.warMc=new MovieClip;this.warMc.x=450;this.warMc.y=220;this.praiseGroup0.addChildAt(this.warMc,0);this.warMc.playFile(RES_DIR_MONSTER+this.warfileName+"_4s",-1);this.warMc.touchEnabled=false}var anchorOffset=GlobalConfig.ZhanLingConfig.anchorOffset||[];this.warMc.anchorOffsetX=anchorOffset[0]||0;this.warMc.anchorOffsetY=anchorOffset[1]||0;TimerManager.ins().remove(this.startShowZhanling,this);TimerManager.ins().doTimer(200,1,this.playZhanLingAttack,this)};WorshipChampionPanel.prototype.playZhanLingAttack=function(){var _this=this;if(this.warMc){var s=RES_DIR_MONSTER+this.warfileName+"_4"+EntityAction.ATTACK;this.warMc.playFile(s,1,function(){var src=RES_DIR_MONSTER+_this.warfileName+"_4"+EntityAction.STAND;_this.warMc.playFile(src,-1,null,false);TimerManager.ins().remove(_this.playZhanLingAttack,_this);TimerManager.ins().doTimer(2800,1,_this.hideZhanling,_this)},false)}};WorshipChampionPanel.prototype.hideZhanling=function(){var _this=this;if(this.warMc){egret.Tween.get(this.warMc).to({alpha:0},GlobalConfig.ZhanLingConfig.disappearTime||1500).call(function(){DisplayUtils.removeFromParent(_this.warMc);_this.warMc.destroy();_this.warMc=null;TimerManager.ins().remove(_this.hideZhanling,_this);TimerManager.ins().doTimer(7e3,1,_this.startShowZhanling,_this)})}};WorshipChampionPanel.prototype.startShowZhanling=function(){this.showZhanling(this.otherPlayerData)};return WorshipChampionPanel}(BaseView);__reflect(WorshipChampionPanel.prototype,"WorshipChampionPanel");var PeakBetWin=function(_super){__extends(PeakBetWin,_super);function PeakBetWin(){var _this=_super.call(this)||this;_this.skinName="BetSkin";_this.numLabel.restrict="0-9";_this.numLabel.maxChars=8;_this.arrow0.visible=false;_this.arrow1.visible=false;_this.aPlayerGroup=_this.face0.parent;_this.aPlayerGroup.touchChildren=false;_this.bPlayerGroup=_this.face1.parent;_this.bPlayerGroup.touchChildren=false;return _this}PeakBetWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.betBtn,this.onTouch);this.addTouchEvent(this.maxBtn,this.onTouch);this.addTouchEvent(this.aPlayerGroup,this.onTouch);this.addTouchEvent(this.bPlayerGroup,this.onTouch);this.addChangeEvent(this.numLabel,this.changeInput);var group1=param[0];var group2=param[1];var isSixteen=PeakedSys.ins().isKFSixteen();var playData=PeakedSys.ins().isKf()?PeakedHelp.getKFPlayerData(group1,group2,param[2],isSixteen):PeakedHelp.getPlayerData(group1,group2);if(playData){var Adata=playData.playerList[0];this.face0.source=Adata?"yuanhead"+Adata.job+Adata.sex:"";this.name0.text=Adata?Adata.playerName:"---";this.select0.name=Adata?Adata.roleId+"":"";var Bdata=playData.playerList[1];this.face1.source=Bdata?"yuanhead"+Bdata.job+Bdata.sex:"";this.name1.text=Bdata?Bdata.playerName:"---";this.select1.name=Bdata?Bdata.roleId+"":""}this.select0.visible=this.select1.visible=false;var maxNum=Actor.chip;var dpMax=PeakedSys.ins().isKf()?GlobalConfig.PeakRaceCrossTime[PeakedSys.ins().kfStatus+1].maxBett:GlobalConfig.PeakRaceTime[PeakedSys.ins().bfStatus+1].maxBett;this._maxNum=maxNum>dpMax?dpMax:maxNum;this.changeInput(null)};PeakBetWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTouch);this.removeTouchEvent(this.closeBtn,this.onTouch);this.removeTouchEvent(this.betBtn,this.onTouch);this.removeTouchEvent(this.maxBtn,this.onTouch);this.addChangingEvent(this.numLabel,this.changeInput)};PeakBetWin.prototype.changeInput=function(e){var curNum=parseInt(this.numLabel.text);if(e==null)curNum=this._maxNum;if(curNum<0){curNum=0}else if(curNum>this._maxNum){curNum=this._maxNum}this.numLabel.text=curNum+""};PeakBetWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.betBtn:var chipNum=parseInt(this.numLabel.text);if(this._curId){if(chipNum<=0){UserTips.ins().showTips(i18n("PeakBetWin_1"));return}if(PeakedSys.ins().isKf()){PeakedSys.ins().sendKFBet(this._curId,chipNum)}else{PeakedSys.ins().sendBet(this._curId,chipNum)}}else UserTips.ins().showTips(i18n("PeakBetWin_2"));break;case this.maxBtn:this.changeInput(null);break;case this.aPlayerGroup:if(this.select0.name){this.select0.visible=true;this.select1.visible=false;this.arrow0.visible=true;this.arrow1.visible=false;this._curId=parseInt(this.select0.name)}break;case this.bPlayerGroup:if(this.select1.name){this.select1.visible=true;this.select0.visible=false;this.arrow0.visible=false;this.arrow1.visible=true;this._curId=parseInt(this.select1.name)}break}};PeakBetWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var group1=param[0];var group2=param[1];var isSixteen=PeakedSys.ins().isKFSixteen();var playData=PeakedSys.ins().isKf()?PeakedHelp.getKFPlayerData(group1,group2,param[2],isSixteen):PeakedHelp.getPlayerData(group1,group2);if(playData&&playData.playerList.length>1){return true}else if(playData&&playData.playerList.length==1){UserTips.ins().showTips(i18n("PeakBetWin_3"));return false}else{UserTips.ins().showTips(i18n("PeakBetWin_4"));return false}};return PeakBetWin}(BaseEuiView);__reflect(PeakBetWin.prototype,"PeakBetWin");ViewManager.ins().reg(PeakBetWin,LayerManager.UI_Popup);var PeakMyBattleRecordWin=function(_super){__extends(PeakMyBattleRecordWin,_super);function PeakMyBattleRecordWin(){return _super.call(this)||this}PeakMyBattleRecordWin.prototype.initUI=function(){this.skinName="MyRecordSkin";this.list.itemRenderer=PeakMyBattleRecordItemRender};PeakMyBattleRecordWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.closeBtn,this.onClose);this.addTouchEvent(this.list,this.onTouchList);var listDt=[];var sys=PeakedSys.ins();if(PeakedSys.ins().isKf()){listDt=PeakedSys.ins().myKFBattleReportList;listDt=PeakedHelp.countKFMyRecordData()}else listDt=PeakedSys.ins().myBattleReportList;this.list.dataProvider=new eui.ArrayCollection(listDt);DisplayUtils.scrollerToBottom(this.scrollerList)};PeakMyBattleRecordWin.prototype.onClose=function(e){ViewManager.ins().close(this)};PeakMyBattleRecordWin.prototype.onTouchList=function(e){if(e.target instanceof eui.Label&&e.target.parent instanceof PeakMyBattleRecordItemRender){var data=e.target.parent.data;if(data)UserReadPlayer.ins().sendFindPlayer(data.roleId)}};return PeakMyBattleRecordWin}(BaseEuiView);__reflect(PeakMyBattleRecordWin.prototype,"PeakMyBattleRecordWin");ViewManager.ins().reg(PeakMyBattleRecordWin,LayerManager.UI_Popup);var PeakMyBetRecordWin=function(_super){__extends(PeakMyBetRecordWin,_super);function PeakMyBetRecordWin(){return _super.call(this)||this}PeakMyBetRecordWin.prototype.initUI=function(){this.skinName="MyBetRecordSkin";this.list.itemRenderer=PeakMyBetItemRender};PeakMyBetRecordWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.closeBtn,this.onClose);this.observe(PeakedSys.ins().postKFBetInfo,this.updata);this.updata()};PeakMyBetRecordWin.prototype.onClose=function(e){ViewManager.ins().close(this)};PeakMyBetRecordWin.prototype.updata=function(){var list=[];var count=0;var getNum=0;var betInfo=PeakedSys.ins().isKf()?PeakedSys.ins().kfBetInfo:PeakedSys.ins().betInfo;if(betInfo){for(var _i=0,betInfo_1=betInfo;_i<betInfo_1.length;_i++){var info=betInfo_1[_i];count+=info.batNum;list.push(info);if(PeakedHelp.statusIsOver(info.status,PeakedSys.ins().isKf())){if(PeakedHelp.checkIsWinById(info.playerId,info.status))getNum+=info.batNum;else getNum-=info.batNum}}}var extS=getNum>0?i18n("PeakMyBetRecordWin_0",ColorUtil.GREEN_COLOR_N,getNum):i18n("PeakMyBetRecordWin_1",ColorUtil.RED_COLOR_N,-getNum);if(getNum==0)extS="";var str=i18n("PeakMyBetRecordWin_2",list.length,ColorUtil.GREEN_COLOR_N,count,extS);this.infoLabel.textFlow=TextFlowMaker.generateTextFlow1(str);list.sort(PeakedHelp.sortBetFun);this.list.dataProvider=new eui.ArrayCollection(list);DisplayUtils.scrollerToBottom(this.scrollerList)};return PeakMyBetRecordWin}(BaseEuiView);__reflect(PeakMyBetRecordWin.prototype,"PeakMyBetRecordWin");ViewManager.ins().reg(PeakMyBetRecordWin,LayerManager.UI_Popup);var PeakTopRankWin=function(_super){__extends(PeakTopRankWin,_super);function PeakTopRankWin(){var _this=_super.call(this)||this;_this.skinName="SupportRankSkin";return _this}PeakTopRankWin.prototype.initUI=function(){this.list.itemRenderer=PeakTopRankItemRender;this._listDt=new eui.ArrayCollection;this.list.dataProvider=this._listDt};PeakTopRankWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(PeakedSys.ins().postSignUp,this.onSingUp);this.observe(PeakedSys.ins().postTopRank,this.upList);this.observe(PeakedSys.ins().postKFTopRank,this.upList);this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.list,this.onTouch);this.onSingUp()};PeakTopRankWin.prototype.onSingUp=function(){if(PeakedSys.ins().isKf()){PeakedSys.ins().sendKFTopRank()}else{PeakedSys.ins().sendTopRank()}};PeakTopRankWin.prototype.upList=function(){if(PeakedSys.ins().isKf()){this._listDt.replaceAll(PeakedSys.ins().kfTopRankInfoList)}else{this._listDt.replaceAll(PeakedSys.ins().topRankInfoList)}};PeakTopRankWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;default:if(e.target.parent instanceof PeakTopRankItemRender){var data=e.target.parent.data;if(e.target instanceof eui.Button){if(PeakedSys.ins().isKf()){PeakedSys.ins().sendKFToLikes(data.playerId)}else{PeakedSys.ins().sendToLikes(data.playerId)}}else if(e.target instanceof eui.Label){UserReadPlayer.ins().sendFindPlayer(data.playerId,data.servId)}}}};return PeakTopRankWin}(BaseEuiView);__reflect(PeakTopRankWin.prototype,"PeakTopRankWin");ViewManager.ins().reg(PeakTopRankWin,LayerManager.UI_Popup);var PeakViewBattleReportWin=function(_super){__extends(PeakViewBattleReportWin,_super);function PeakViewBattleReportWin(){return _super.call(this)||this}PeakViewBattleReportWin.prototype.initUI=function(){this.skinName="WarReportSkin";this.list.itemRenderer=PeakViewBattleReportItemRender};PeakViewBattleReportWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.closeBtn,this.onClose);var group1=param[0];var group2=param[1];var isSixteen=PeakedSys.ins().isKFSixteen();var playData=PeakedSys.ins().isKf()?PeakedHelp.getKFPlayerData(group1,group2,param[2],isSixteen):PeakedHelp.getPlayerData(group1,group2);var listDt=[];var aScore=0;var bScore=0;var promWin=GlobalConfig.PeakRaceBase.promWin;if(!promWin)promWin=3;if(playData){if(playData.playerList.length==0){this.AnameTxt.text=i18n("PeakViewBattleReportWin_0");this.BnameTxt.text=i18n("PeakViewBattleReportWin_1")}else{if(playData.playerList[0])this.AnameTxt.text=playData.playerList[0].playerName;if(playData.playerList[1])this.BnameTxt.text=playData.playerList[1].playerName;else this.BnameTxt.text=i18n("PeakViewBattleReportWin_2");var isOver=PeakedHelp.statusIsOverByGroup(group1);for(var i=0;i<5;i++){var data=void 0;if(playData.reportList[i]){data={};data.winer=PeakedHelp.findPlayerDtById(playData.reportList[i]).playerName;data.round=i+1;if(playData.reportList[i]==playData.playerList[0].roleId){aScore++}else bScore++}else if(isOver)continue;listDt[i]=data;if(aScore>=promWin||bScore>=promWin)break}}}else{this.AnameTxt.text=i18n("PeakViewBattleReportWin_3");this.BnameTxt.text=i18n("PeakViewBattleReportWin_4")}if(playData&&playData.reportList.length==0&&!playData.playerList[1])aScore=promWin;this.score.text=aScore+"."+bScore;this.list.dataProvider=new eui.ArrayCollection(listDt)};PeakViewBattleReportWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClose);this.removeTouchEvent(this.closeBtn,this.onClose)};PeakViewBattleReportWin.prototype.onClose=function(e){ViewManager.ins().close(this)};return PeakViewBattleReportWin}(BaseEuiView);__reflect(PeakViewBattleReportWin.prototype,"PeakViewBattleReportWin");ViewManager.ins().reg(PeakViewBattleReportWin,LayerManager.UI_Popup);var CollectWin=function(_super){__extends(CollectWin,_super);function CollectWin(){var _this=_super.call(this)||this;_this.skinName="CollectSkin";_this.progressBar.labelFunction=function(value,maximum){return""};return _this}CollectWin.prototype.childrenCreated=function(){this.progressBar.value=0;this.progressBar.visible=false;this.bgmc=new MovieClip;this.bgmc.playFile(RES_DIR_EFF+"jindutiaoeff1",-1);this.bgmc.scaleY=2;this.bgmc.scaleX=1.25;this.effGroup.width=234;this.effGroup.height=19;this.effGroup.scrollEnabled=true;this.effGroup.addChild(this.bgmc)};CollectWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.state.text=i18n("CollectWin_0",Actor.myName);Tween.removeTweens(this.effGroup);var wid=234;this.effGroup.width=Math.max(0,Math.floor(wid*param[1]/param[2]));Tween.get(this.effGroup).to({width:wid},(param[2]-param[1])*1e3)};CollectWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}Tween.removeTweens(this.effGroup)};return CollectWin}(BaseEuiView);__reflect(CollectWin.prototype,"CollectWin");ViewManager.ins().reg(CollectWin,LayerManager.UI_Main);var ReliveWin=function(_super){__extends(ReliveWin,_super);function ReliveWin(){var _this=_super.call(this)||this;_this.remainM=0;_this.skinName="ReliveSkin";return _this}ReliveWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.remainM=param[0];var killer=param[1];if(killer)this.killTips.textFlow=(new egret.HtmlTextParser).parser(i18n("ReliveWin_0",StringUtils.addColor(killer,"#23C42A")));this.reliveTimesTxt.text=this.remainM+i18n("ReliveWin_1");TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this)};ReliveWin.prototype.refushLabel=function(){this.remainM--;this.reliveTimesTxt.text=this.remainM+i18n("ReliveWin_2");if(this.remainM<=0){TimerManager.ins().remove(this.refushLabel,this);this.overTime()}};ReliveWin.prototype.overTime=function(){ViewManager.ins().close(this)};return ReliveWin}(BaseEuiView);__reflect(ReliveWin.prototype,"ReliveWin");ViewManager.ins().reg(ReliveWin,LayerManager.UI_Popup);var ServerSwitchIngWin=function(_super){__extends(ServerSwitchIngWin,_super);function ServerSwitchIngWin(){var _this=_super.call(this)||this;_this.wait=1.5;_this.skinName="KFSwitchServerSkin";return _this}ServerSwitchIngWin.prototype.open=function(){var _this=this;var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.bar.value=0;var goTime=0;TimerManager.ins().doTimer(20,0,function(){goTime+=20;var value=goTime/1e3/_this.wait*100;_this.bar.value=value;_this.switchLabel.text=KFServerSys.ins().kfServerid==LocationProperty.srvid?i18n("ServerSwitchIngWin_0"):i18n("ServerSwitchIngWin_1")},this)};ServerSwitchIngWin.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.bar.value=100;KFServerSys.ins().isEnter=!KFServerSys.ins().isEnter;TimerManager.ins().removeAll(this)};return ServerSwitchIngWin}(BaseEuiView);__reflect(ServerSwitchIngWin.prototype,"ServerSwitchIngWin");ViewManager.ins().reg(ServerSwitchIngWin,LayerManager.UI_Popup);var SmallMapPanel=function(_super){__extends(SmallMapPanel,_super);function SmallMapPanel(limit_W,limit_H){if(limit_W===void 0){limit_W=200}var _this=_super.call(this)||this;_this._fixedMaxNum=0;_this._limit_width=200;_this._limit_height=0;_this.R_Scale=.58;_this.MOVE_DELAY=300;_this.flagRes=["wj_gray_flag_icon","wj_green_flag_icon","wj_red_flag_icon"];_this.entityRes=["wj_green_point","wj_blue_point"];if(limit_W)_this._limit_width=limit_W;if(limit_H)_this._limit_height=limit_H;return _this}SmallMapPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.signList=[];this.initUI()};SmallMapPanel.prototype.onMapComplete=function(e){if(this._limit_width)this.R_Scale=this._limit_width/this.mapBg.width;else if(this._limit_height)this.R_Scale=this._limit_height/this.mapBg.height;this.mapBg.width*=this.R_Scale;this.mapBg.height*=this.R_Scale;this.frameImg.width=this.mapBg.width;this.frameImg.height=this.mapBg.height;this.initFixedP()};SmallMapPanel.prototype.open=function(type){this._curSceneType=type;this.observe(GameLogic.ins().postCreateOtherEntity,this.calcPlayMainEntityList);this.observe(WJBattlefieldSys.ins().postRefCampFlag,this.refreshFixedP);this.calcPlayMainEntityList();this.refreshCoordinate();this.refreshFixedP();TimerManager.ins().doTimer(this.MOVE_DELAY,0,this.refreshCoordinate,this)};SmallMapPanel.prototype.close=function(){this.removeObserve();this.signList=[];TimerManager.ins().remove(this.refreshCoordinate,this)};SmallMapPanel.prototype.initUI=function(){this._fixedList=[];switch(this._curSceneType){case SmallSceneType.WJBattle:this._fixedMaxNum=3;for(var i=0;i<this._fixedMaxNum;i++){this._fixedList[i]=new eui.Image;this._fixedList[i].source=this.flagRes[0];this._fixedList[i].anchorOffsetX=this._fixedList[i].width>>1;this._fixedList[i].anchorOffsetY=this._fixedList[i].height;var pos=GlobalConfig.WujiBaseConfig.flagPoint[i];this._fixedList[i].x=pos.x*GameMap.CELL_SIZE/10*this.R_Scale;this._fixedList[i].y=pos.y*GameMap.CELL_SIZE/10*this.R_Scale;this.addChild(this._fixedList[i])}break}this.mapBg=new eui.Image;this.mapBg.source="map/"+GameMap.getFileName()+"/small.jpg";this.mapBg.addEventListener(egret.Event.COMPLETE,this.onMapComplete,this);this.addChildAt(this.mapBg,0)};SmallMapPanel.prototype.initFixedP=function(){switch(this._curSceneType){case SmallSceneType.WJBattle:for(var i=0;i<this._fixedMaxNum;i++){var pos=GlobalConfig.WujiBaseConfig.flagPoint[i];this._fixedList[i].x=pos.x*GameMap.CELL_SIZE/10*this.R_Scale;this._fixedList[i].y=pos.y*GameMap.CELL_SIZE/10*this.R_Scale}break}};SmallMapPanel.prototype.refreshFixedP=function(){switch(this._curSceneType){case SmallSceneType.WJBattle:for(var i=0;i<this._fixedMaxNum;i++){if(WJBattlefieldSys.ins().flagInfos[i+1]){this._fixedList[i].source=WJBattlefieldSys.ins().flagInfos[i+1]==100?this.flagRes[1]:this.flagRes[2]}else this._fixedList[i].source=this.flagRes[0]}break}};SmallMapPanel.prototype.refreshCoordinate=function(){};SmallMapPanel.prototype.calcPlayMainEntityList=function(){var list={};var teams={};var entityList=EntityManager.ins().getAllEntity();for(var i in entityList){var entity=entityList[i];if(entity&&entity.infoModel){if(entity.infoModel.type!=EntityType.Role)continue;var role=entity.infoModel;if(!teams[role.name])teams[role.name]=[];teams[role.name].push(entity)}}for(var s in teams){var team=teams[s];team.sort(function(a,b){if(a.infoModel.job<b.infoModel.job)return-1;if(a.infoModel.job>b.infoModel.job)return 1;return 0});var mainEntity=team[0];list[mainEntity.infoModel.handle]=mainEntity}this._entityList=list;return list};return SmallMapPanel}(BaseView);__reflect(SmallMapPanel.prototype,"SmallMapPanel");var SmallSceneType;(function(SmallSceneType){SmallSceneType[SmallSceneType["WJBattle"]=0]="WJBattle"})(SmallSceneType||(SmallSceneType={}));window["SmallSceneType"]=SmallSceneType;var WJBattlefieldSys=function(_super){__extends(WJBattlefieldSys,_super);function WJBattlefieldSys(){var _this=_super.call(this)||this;_this.campAScores=0;_this.campBScores=0;_this.flagInfos=[];_this.overCounts=0;_this.matchingTime=0;_this.isWJBattle=false;_this.isActiveQuit=false;_this.sysId=PackageID.WJBattle;_this.regNetMsg(0,_this.postStateInfo);_this.regNetMsg(1,_this.postMatchData);_this.regNetMsg(2,_this.doCancelMatch);_this.regNetMsg(3,_this.postEnterFbInfo);_this.regNetMsg(4,_this.doBattleResult);_this.regNetMsg(5,_this.postRefCampScores);_this.regNetMsg(6,_this.postRefCampFlag);_this.regNetMsg(7,_this.postFirstKiller);_this.regNetMsg(8,_this.postInfo);_this.regNetMsg(9,_this.postChatInfo);_this.regNetMsg(10,_this.doViewDataInfo);_this.regNetMsg(11,_this.postRemain);_this.regNetMsg(12,_this.postMyData);_this.observe(GameLogic.ins().postEnterMap,function(){if(_this.isWJBattle&&GameMap.fubenID!=52e3)_this.quitWJBattle()});return _this}WJBattlefieldSys.ins=function(){return _super.ins.call(this)};WJBattlefieldSys.prototype.postStateInfo=function(bytes){this.isOpen=bytes.readByte()>0?true:false;this._prepStartTime=bytes.readInt();this._startTime=bytes.readInt();this._endTime=bytes.readInt()};WJBattlefieldSys.prototype.postMatchData=function(bytes){ViewManager.ins().open(WJBattlefieldMatchPanel)};WJBattlefieldSys.prototype.doCancelMatch=function(bytes){ViewManager.ins().close(WJBattlefieldMatchPanel);WJBattlefieldSys.ins().matchingTime=0};WJBattlefieldSys.prototype.postEnterFbInfo=function(bytes){var startTimeStamp=bytes.readInt();this.myCampId=bytes.readInt();this.campAScores=bytes.readInt();this.campBScores=bytes.readInt();this.flagHandle=[];var num=bytes.readByte();for(var i=0;i<num;i++){this.flagHandle[bytes.readByte()]=bytes.readDouble()}this.isWJBattle=true;WJBattlefieldSys.ins().matchingTime=0;ViewManager.ins().close(WJBattlefieldWin);ViewManager.ins().open(WJBattlefieldMainUI);ViewManager.ins().open(WJBattlefieldStartCountdownPanel);KFServerSys.ins().linkingKFState(false)};WJBattlefieldSys.prototype.doBattleResult=function(bytes){var AScores=bytes.readInt();var BScores=bytes.readInt();this.resultMyInfoData=[];this.resultEnemyInfoData=[];var num=bytes.readByte();for(var i=0;i<num;i++){var data=new WJBattleData;data.readResultData(bytes);data.isResult=true;if(data.camp==this.myCampId){this.resultMyInfoData.push(data)}else{this.resultEnemyInfoData.push(data)}}ViewManager.ins().open(WJBattlefieldResultWin,AScores,BScores,this.resultMyInfoData,this.resultEnemyInfoData)};WJBattlefieldSys.prototype.postRefCampScores=function(bytes){this.campAScores=bytes.readInt();this.campBScores=bytes.readInt()};WJBattlefieldSys.prototype.postRefCampFlag=function(bytes){var n=bytes.readByte();this.flagInfos[n]=bytes.readInt()};WJBattlefieldSys.prototype.postFirstKiller=function(bytes){};WJBattlefieldSys.prototype.postInfo=function(bytes){var _this=this;this.overCounts=bytes.readInt();var isBattle=bytes.readByte();if(isBattle&&!this.isActiveQuit){WarnWin.show(i18n("WJBattlefieldSys_0"),function(){_this.sendEnter()},this,null,null,"sure")}this.isActiveQuit=false};WJBattlefieldSys.prototype.postChatInfo=function(bytes){var servId=bytes.readInt();var playerName=bytes.readString();var msg=bytes.readString();var content="s"+servId+"."+playerName+":"+msg;return content};WJBattlefieldSys.prototype.doViewDataInfo=function(bytes){var num=bytes.readByte();var myList=[];var enemyList=[];for(var i=0;i<num;i++){var data=new WJBattleData;data.readViewData(bytes);data.isResult=false;if(data.camp==this.myCampId){myList.push(data)}else{enemyList.push(data)}}ViewManager.ins().open(WJBattlefieldDataWin,myList,enemyList)};WJBattlefieldSys.prototype.postRemain=function(bytes){var cd=bytes.readShort();ViewManager.ins().open(ReliveWin,cd,i18n("WJBattlefieldSys_1"))};WJBattlefieldSys.prototype.postMyData=function(bytes){this.myData=new WJBattleData;this.myData.readMyData(bytes);return this.myData};WJBattlefieldSys.prototype.sendMatch=function(isDown){var bytes=this.getBytes(1);bytes.writeShort(isDown?1:0);this.sendToServer(bytes)};WJBattlefieldSys.prototype.sendEnter=function(){this.sendBaseProto(3)};WJBattlefieldSys.prototype.sendCancelMatch=function(){this.sendBaseProto(2)};WJBattlefieldSys.prototype.sendChatInfo=function(msg){var bytes=this.getBytes(9);bytes.writeString(msg);this.sendToServer(bytes)};WJBattlefieldSys.prototype.sendViewDataInfo=function(){this.sendBaseProto(10)};WJBattlefieldSys.prototype.quitWJBattle=function(){this.isWJBattle=false;this.myCampId=0;this.campAScores=0;this.campBScores=0;ViewManager.ins().close(WJBattlefieldMainUI);ViewManager.ins().close(WJBattlefieldResultWin);this.isActiveQuit=true};WJBattlefieldSys.postSwitchServer=function(){ViewManager.ins().close(WJBattlefieldMatchPanel)};WJBattlefieldSys.prototype.getPrepStartTimeStamp=function(){return this._prepStartTime-egret.getTimer()};WJBattlefieldSys.prototype.getStartTime=function(){return Math.floor((DateUtils.formatMiniDateTime(this._startTime)-GameServer.serverTime)/1e3)};WJBattlefieldSys.prototype.getEndTime=function(){return Math.floor((DateUtils.formatMiniDateTime(this._endTime)-GameServer.serverTime)/1e3)};WJBattlefieldSys.prototype.getMatchingTime=function(){if(this.matchingTime==0)return 0;return this.matchingTime+egret.getTimer()/1e3>>0};return WJBattlefieldSys}(BaseSystem);__reflect(WJBattlefieldSys.prototype,"WJBattlefieldSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.wjBattlefieldSys=WJBattlefieldSys.ins.bind(WJBattlefieldSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var WJBattleRedPoint=function(_super){__extends(WJBattleRedPoint,_super);function WJBattleRedPoint(){return _super.call(this)||this}return WJBattleRedPoint}(BaseSystem);__reflect(WJBattleRedPoint.prototype,"WJBattleRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){var wjBattleRedpoint=WJBattleRedPoint.ins.bind(WJBattleRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var WJBattleData=function(){function WJBattleData(){this.isFirstKiller=0;this.isMVP=0;this.isResult=false}WJBattleData.prototype.readResultData=function(bytes){this.servId=bytes.readInt();this.playerName=bytes.readString();this.camp=bytes.readInt();this.killNum=bytes.readInt();this.killedNum=bytes.readInt();this.assistsNum=bytes.readInt();this.collectFlagNum=bytes.readInt();this.isFirstKiller=bytes.readByte();this.isMVP=bytes.readByte()};WJBattleData.prototype.readViewData=function(bytes){this.servId=bytes.readInt();this.playerName=bytes.readString();this.camp=bytes.readInt();this.killNum=bytes.readInt();this.killedNum=bytes.readInt();this.assistsNum=bytes.readInt();this.collectFlagNum=bytes.readInt();this.isFirstKiller=bytes.readByte()};WJBattleData.prototype.readMyData=function(bytes){this.killNum=bytes.readInt();this.killedNum=bytes.readInt();this.assistsNum=bytes.readInt();this.collectFlagNum=bytes.readInt()};return WJBattleData}();__reflect(WJBattleData.prototype,"WJBattleData");var WJCampType;(function(WJCampType){WJCampType[WJCampType["ME"]=100]="ME";WJCampType[WJCampType["ENEMY"]=200]="ENEMY"})(WJCampType||(WJCampType={}));window["WJCampType"]=WJCampType;var WJBattleChatItem=function(_super){__extends(WJBattleChatItem,_super);function WJBattleChatItem(){return _super.call(this)||this}WJBattleChatItem.prototype.dataChanged=function(){this.msg.text=this.data};return WJBattleChatItem}(BaseItemRender);__reflect(WJBattleChatItem.prototype,"WJBattleChatItem");var WJBattleDataItem=function(_super){__extends(WJBattleDataItem,_super);function WJBattleDataItem(){return _super.call(this)||this}WJBattleDataItem.prototype.dataChanged=function(){if(this.data instanceof WJBattleData){var dt=this.data;if(dt.isResult){this.currentState="result"}else{this.currentState="data"}this.nickLabel.text=dt.playerName;this.numLabel.text=dt.killNum+"/"+dt.killedNum+"/"+dt.assistsNum;this.collectFlagLabel.text=dt.collectFlagNum+"";this.firstKillImg.visible=dt.isFirstKiller>0;this.mvpImg.visible=dt.isMVP>0;this.mvpImg.source=dt.camp==WJBattlefieldSys.ins().myCampId?"wj_mvp_green":"wj_mvp_red";this.honorLabel.text="";this.bg.source=dt.camp==WJBattlefieldSys.ins().myCampId?"wj_data_item_bg2":"wj_data_item_bg1"}};return WJBattleDataItem}(BaseItemRender);__reflect(WJBattleDataItem.prototype,"WJBattleDataItem");var WJBattleNoticeItem=function(_super){__extends(WJBattleNoticeItem,_super);function WJBattleNoticeItem(){return _super.call(this)||this}WJBattleNoticeItem.prototype.dataChanged=function(){this.txtLabel.text=this.data};return WJBattleNoticeItem}(BaseItemRender);__reflect(WJBattleNoticeItem.prototype,"WJBattleNoticeItem");var WJBattleSChatItem=function(_super){__extends(WJBattleSChatItem,_super);function WJBattleSChatItem(){var _this=_super.call(this)||this;_this.touchChildren=false;return _this}WJBattleSChatItem.prototype.dataChanged=function(){this.msg.text=this.data};return WJBattleSChatItem}(BaseItemRender);__reflect(WJBattleSChatItem.prototype,"WJBattleSChatItem");var WJBattlefieldTrusteeshipAi=function(_super){__extends(WJBattlefieldTrusteeshipAi,_super);function WJBattlefieldTrusteeshipAi(){var _this=_super.call(this)||this;_this.AI_INTERVAL=1e3;return _this}WJBattlefieldTrusteeshipAi.ins=function(){return _super.ins.call(this)};WJBattlefieldTrusteeshipAi.prototype.startAi=function(){if(!WJBattlefieldSys.ins().isWJBattle)return;MessageCenter.addListener(MapView.moveComplete,this.moveEnd,this);TimerManager.ins().doTimer(this.AI_INTERVAL,0,this.runLogic,this);this.state=TrusteeshipAiState.Normal};WJBattlefieldTrusteeshipAi.prototype.closeAi=function(){MessageCenter.ins().removeAll(this);TimerManager.ins().remove(this.runLogic,this);var mainRole=EntityManager.ins().getNoDieRole();mainRole.stopMove();mainRole.playAction(EntityAction.STAND)};WJBattlefieldTrusteeshipAi.prototype.runLogic=function(){var mainRole=EntityManager.ins().getNoDieRole();if(mainRole.AI_STATE!=AI_State.Stand)return;switch(this.state){case TrusteeshipAiState.Normal:var flagData=this.findCanCollectFlag();if(flagData){if(this.checkCanCollectByDis(flagData)){this.state=TrusteeshipAiState.Collect;for(var i=0;i<3;i++){var flagInfos=WJBattlefieldSys.ins().flagInfos[i+1];if(flagInfos&&flagInfos==WJBattlefieldSys.ins().myCampId)continue;var nearFlagHandle=this.findNearFlag();if(nearFlagHandle){GameLogic.ins().postChangeAttrPoint(nearFlagHandle)}break}}else{GameMap.moveTo(flagData.x,flagData.y)}}else{var flagDt=this.findCampFlag();GameMap.moveTo(flagDt.x,flagDt.y)}break;case TrusteeshipAiState.Collect:break;case TrusteeshipAiState.Attack:var enemy=this.checkNearbyEnemy();if(enemy&&enemy.infoModel){GameLogic.ins().postChangeAttrPoint(enemy.infoModel.handle)}else{this.state=TrusteeshipAiState.Normal}break}};WJBattlefieldTrusteeshipAi.prototype.moveEnd=function(e){if(e.team!=Team.My)return;var flagData=this.findCanCollectFlag();if(flagData){this.state=TrusteeshipAiState.Collect}else{this.state=TrusteeshipAiState.Attack}};WJBattlefieldTrusteeshipAi.prototype.findCanCollectFlag=function(){var list=[];var count=3;var mainRole=EntityManager.ins().getNoDieRole();for(var i=0;i<count;i++){if(true){var flagData={};flagData.distance=MathUtils.getDistance(mainRole.x,mainRole.y,flagData.x,flagData.y);list.push(flagData)}}var compareFn=function(a,b){if(a.distance>b.distance)return 1;else if(a.distance<b.distance)return-1;else return 0};list.sort(compareFn);if(list.length)return list[0];return null};WJBattlefieldTrusteeshipAi.prototype.findCampFlag=function(){var list=[];var count=3;var mainRole=EntityManager.ins().getNoDieRole();for(var i=0;i<count;i++){if(true){var flagData={};list.push(flagData)}}if(list.length)return list[MathUtils.limit(0,list.length-1)];return null};WJBattlefieldTrusteeshipAi.prototype.findNearFlag=function(){var disList=[];var mainRole=EntityManager.ins().getNoDieRole();if(!mainRole)return 0;for(var _i=0,_a=WJBattlefieldSys.ins().flagHandle;_i<_a.length;_i++){var index=_a[_i];var handle=WJBattlefieldSys.ins().flagHandle[index];var entity=EntityManager.ins().getEntityByHandle(handle);if(entity&&entity.infoModel){if(WJBattlefieldSys.ins().flagInfos[index]&&WJBattlefieldSys.ins().flagInfos[index]==WJBattlefieldSys.ins().myCampId)continue;var dis=MathUtils.getDistance(entity.x,entity.y,mainRole.x,mainRole.y);disList[WJBattlefieldSys.ins().flagHandle.indexOf(handle)]=dis}}disList.sort(Algorithm.sortAsc);if(disList[1])return WJBattlefieldSys.ins().flagHandle[disList[1]];return 0};WJBattlefieldTrusteeshipAi.prototype.checkNearbyEnemy=function(){var mainRole=EntityManager.ins().getNoDieRole();var range=6;var list=EntityManager.ins().screeningTargetByPos(mainRole,false,4,range);for(var n=list.length-1;n>-1;n--){if(list[n]&&list[n].infoModel&&list[n].infoModel.camp==WJBattlefieldSys.ins().myCampId){list.splice(n,1)}}if(list.length)return list[MathUtils.limit(0,list.length-1)];return null};WJBattlefieldTrusteeshipAi.prototype.checkCanCollectByDis=function(flagData){var mainRole=EntityManager.ins().getNoDieRole();var distance=MathUtils.getDistance(mainRole.x,mainRole.y,flagData.x,flagData.y);return distance<=50};return WJBattlefieldTrusteeshipAi}(BaseClass);__reflect(WJBattlefieldTrusteeshipAi.prototype,"WJBattlefieldTrusteeshipAi");var TrusteeshipAiState;(function(TrusteeshipAiState){TrusteeshipAiState[TrusteeshipAiState["Normal"]=0]="Normal";TrusteeshipAiState[TrusteeshipAiState["Collect"]=1]="Collect";TrusteeshipAiState[TrusteeshipAiState["Attack"]=2]="Attack"})(TrusteeshipAiState||(TrusteeshipAiState={}));window["TrusteeshipAiState"]=TrusteeshipAiState;var WJBattlefieldDataWin=function(_super){__extends(WJBattlefieldDataWin,_super);function WJBattlefieldDataWin(){var _this=_super.call(this)||this;_this.skinName="WJBattleDataSkin";_this.currentState="data";return _this}WJBattlefieldDataWin.prototype.initUI=function(){this.myList.itemRenderer=WJBattleDataItem;this._myScore=BitmapNumber.ins().createNumPic(0,"1",5);this._myScore.x=95;this._myScore.y=100;this.group.addChild(this._myScore);this._enemyScore=BitmapNumber.ins().createNumPic(0,"1",5);this._enemyScore.x=300;this._enemyScore.y=100;this.group.addChild(this._enemyScore)};WJBattlefieldDataWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);var mydatas=args[0];var enemydatas=args[1];this.myList.dataProvider=new eui.ArrayCollection(mydatas);this.enemyList.dataProvider=new eui.ArrayCollection(enemydatas);BitmapNumber.ins().changeNum(this._myScore,WJBattlefieldSys.ins().campAScores,"1",5);BitmapNumber.ins().changeNum(this._enemyScore,WJBattlefieldSys.ins().campBScores,"1",5)};WJBattlefieldDataWin.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}WatcherUtil.removeFromArrayCollection(this.myList.dataProvider);this.myList.dataProvider=null;WatcherUtil.removeFromArrayCollection(this.enemyList.dataProvider);this.enemyList.dataProvider=null};WJBattlefieldDataWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};return WJBattlefieldDataWin}(BaseEuiView);__reflect(WJBattlefieldDataWin.prototype,"WJBattlefieldDataWin");ViewManager.ins().reg(WJBattlefieldDataWin,LayerManager.UI_Popup);var WJBattlefieldMainUI=function(_super){__extends(WJBattlefieldMainUI,_super);function WJBattlefieldMainUI(){var _this=_super.call(this)||this;_this.flagRes=["wj_gray_flag","wj_green_flag","wj_red_flag"];_this.skinName="WJBattleMainUISkin";return _this}WJBattlefieldMainUI.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.sChatBtn,this.onTouch);this.addTouchEvent(this.flag1,this.onTouch);this.addTouchEvent(this.flag2,this.onTouch);this.addTouchEvent(this.flag3,this.onTouch);this.addTouchEvent(this.sChatList,this.sendChat);this.addTouchEvent(this.viewArea,this.onTouch);this.observe(WJBattlefieldSys.ins().postChatInfo,this.pushChatInfo);this.observe(WJBattlefieldSys.ins().postMyData,this.upMydata);this.observe(WJBattlefieldSys.ins().postRefCampScores,this.refScores);this.observe(WJBattlefieldSys.ins().postRefCampFlag,this.refFlag);this.minMap.open(SmallSceneType.WJBattle);this.startActTime();this.upMydata();this.refScores();this.refFlag();if(ViewManager.ins().isShow(UIView2))ViewManager.ins().getView(UIView2).isHideNavBtn(false)};WJBattlefieldMainUI.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.minMap.close();ViewManager.ins().close(TargetListPanel);TimerManager.ins().removeAll(this);if(ViewManager.ins().isShow(UIView2))ViewManager.ins().getView(UIView2).isHideNavBtn(true)};WJBattlefieldMainUI.prototype.initUI=function(){this.sChatList.itemRenderer=WJBattleSChatItem;this.chatList.itemRenderer=WJBattleChatItem;this._sChatData=new eui.ArrayCollection;this.sChatList.dataProvider=this._sChatData;this._chatData=new eui.ArrayCollection;this.chatList.dataProvider=this._chatData;this.winTermLabel.text=i18n("WJBattlefieldMainUI_0",GlobalConfig.WujiBaseConfig.winScore);this._sChatData.replaceAll(GlobalConfig.WujiBaseConfig.quickChat);this.myScoreBar.maximum=GlobalConfig.WujiBaseConfig.winScore;this.enemyScoreBar.maximum=GlobalConfig.WujiBaseConfig.winScore};WJBattlefieldMainUI.prototype.upMydata=function(data){this.killTxt.text=!data?"0":data.killNum+"";this.deadTxt.text=!data?"0":data.killedNum+"";this.collectTxt.text=!data?"0":data.collectFlagNum+"";this.assistsTxt.text=!data?"0":data.assistsNum+""};WJBattlefieldMainUI.prototype.refScores=function(){this.myScoreLabel.text=WJBattlefieldSys.ins().campAScores+"";this.enemyScoreLabel.text=WJBattlefieldSys.ins().campBScores+"";this.myScoreBar.value=WJBattlefieldSys.ins().campAScores;this.enemyScoreBar.value=WJBattlefieldSys.ins().campBScores};WJBattlefieldMainUI.prototype.refFlag=function(){for(var i=0;i<3;i++){var camp=WJBattlefieldSys.ins().flagInfos[i];if(camp){this["flag"+(i+1)].icon=camp==WJBattlefieldSys.ins().myCampId?this.flagRes[1]:this.flagRes[2]}else this["flag"+(i+1)].icon=this.flagRes[0]}};WJBattlefieldMainUI.prototype.onTouch=function(e){switch(e.target){case this.sChatBtn:this.sChatGroup.visible=!this.sChatGroup.visible;break;case this.flag1:GameLogic.ins().postChangeAttrPoint(WJBattlefieldSys.ins().flagHandle[1]);break;case this.flag2:GameLogic.ins().postChangeAttrPoint(WJBattlefieldSys.ins().flagHandle[2]);break;case this.flag3:GameLogic.ins().postChangeAttrPoint(WJBattlefieldSys.ins().flagHandle[3]);break;case this.viewArea:WJBattlefieldSys.ins().sendViewDataInfo();break}};WJBattlefieldMainUI.prototype.sendChat=function(e){if(e.target instanceof WJBattleSChatItem){var item=e.target;item.bg.scaleX=item.bg.scaleY=.9;WJBattlefieldSys.ins().sendChatInfo(e.target.data);this.sChatGroup.visible=false}};WJBattlefieldMainUI.prototype.startActTime=function(){TimerManager.ins().doTimer(1e3,0,this.onTick,this)};WJBattlefieldMainUI.prototype.onTick=function(){var time=WJBattlefieldSys.ins().getEndTime();this.overTimerLabel.text=DateUtils.getFormatBySecond(time)};WJBattlefieldMainUI.prototype.pushChatInfo=function(msg){this._chatData.addItem(msg);if(this._chatData.length>3)this._chatData.removeItemAt(0)};return WJBattlefieldMainUI}(BaseEuiView);__reflect(WJBattlefieldMainUI.prototype,"WJBattlefieldMainUI");ViewManager.ins().reg(WJBattlefieldMainUI,LayerManager.UI_Popup);var WJBattlefieldMatchPanel=function(_super){__extends(WJBattlefieldMatchPanel,_super);function WJBattlefieldMatchPanel(){var _this=_super.call(this)||this;_this.matchTick=0;_this.matchingStrs=[".","..","..."];_this.skinName="WJBattleMatchSkin";return _this}WJBattlefieldMatchPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.cancelBtn,this.onTouch);this.addTouchEvent(this.minBtn,this.onTouch);this.startMatch()};WJBattlefieldMatchPanel.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}TimerManager.ins().removeAll(this)};WJBattlefieldMatchPanel.prototype.miniUI=function(){ViewManager.ins().close(this);WJBattlefieldSys.ins().matchingTime=this.matchTick-egret.getTimer()/1e3};WJBattlefieldMatchPanel.prototype.onTouch=function(e){switch(e.currentTarget){case this.cancelBtn:WJBattlefieldSys.ins().sendCancelMatch();break;case this.minBtn:this.miniUI();break}};WJBattlefieldMatchPanel.prototype.startMatch=function(){var _this=this;this.matchTick=WJBattlefieldSys.ins().getMatchingTime();this.overTimersLabel.text=DateUtils.getFormatBySecond(this.matchTick>>1);TimerManager.ins().doTimer(500,0,function(){_this.matchTick++;_this.matchLabel.text=i18n("WJBattlefieldMatchPanel_0",_this.matchingStrs[_this.matchTick%3]);_this.overTimersLabel.text=DateUtils.getFormatBySecond(_this.matchTick>>1)},this)};return WJBattlefieldMatchPanel}(BaseEuiView);__reflect(WJBattlefieldMatchPanel.prototype,"WJBattlefieldMatchPanel");ViewManager.ins().reg(WJBattlefieldMatchPanel,LayerManager.UI_Popup);var WJBattlefieldResultWin=function(_super){__extends(WJBattlefieldResultWin,_super);function WJBattlefieldResultWin(){var _this=_super.call(this)||this;_this.skinName="WJBattleDataSkin";_this.currentState="result";return _this}WJBattlefieldResultWin.prototype.initUI=function(){this.myList.itemRenderer=WJBattleDataItem;this._myScore=BitmapNumber.ins().createNumPic(0,"1",5);this._myScore.x=95;this._myScore.y=100;this.group.addChild(this._myScore);this._enemyScore=BitmapNumber.ins().createNumPic(0,"1",5);this._enemyScore.x=300;this._enemyScore.y=100;this.group.addChild(this._enemyScore);this.addExclusionWin(egret.getQualifiedClassName(WJBattlefieldDataWin))};WJBattlefieldResultWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTouch);this.upData(args[0],args[1],args[2],args[3])};WJBattlefieldResultWin.prototype.upData=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var AScores=args[0];var BScores=args[1];var mydatas=args[2];var enemydatas=args[3];this.myList.dataProvider=new eui.ArrayCollection(mydatas);this.enemyList.dataProvider=new eui.ArrayCollection(enemydatas);BitmapNumber.ins().changeNum(this._myScore,AScores,"1",5);BitmapNumber.ins().changeNum(this._enemyScore,BScores,"1",5);if(AScores>BScores){this.myResult.source="wjBattle_json.wj_winning";this.enemyResult.source="wjBattle_json.wj_fail"}else{this.enemyResult.source="wjBattle_json.wj_winning";this.myResult.source="wjBattle_json.wj_fail"}};WJBattlefieldResultWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.quitBtn:UserFb.ins().sendExitFb();break}};__decorate([callLater],WJBattlefieldResultWin.prototype,"upData",null);return WJBattlefieldResultWin}(BaseEuiView);__reflect(WJBattlefieldResultWin.prototype,"WJBattlefieldResultWin");ViewManager.ins().reg(WJBattlefieldResultWin,LayerManager.UI_Popup);var WJBattlefieldStartCountdownPanel=function(_super){__extends(WJBattlefieldStartCountdownPanel,_super);function WJBattlefieldStartCountdownPanel(){var _this=_super.call(this)||this;_this._maxCount=3;_this.skinName="WJBattleStartTipSkin";return _this}WJBattlefieldStartCountdownPanel.prototype.initUI=function(){this._count=BitmapNumber.ins().createNumPic(0,"8",5);this._count.x=105;this._count.y=350;this.addChild(this._count)};WJBattlefieldStartCountdownPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}TimerManager.ins().doTimer(1e3,this._maxCount+1,this.countdownFun,this);this.countdownFun()};WJBattlefieldStartCountdownPanel.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}TimerManager.ins().remove(this.countdownFun,this)};WJBattlefieldStartCountdownPanel.prototype.countdownFun=function(){if(this._maxCount<=0){ViewManager.ins().close(this);return}BitmapNumber.ins().changeNum(this._count,this._maxCount,"8",5);this._maxCount--};return WJBattlefieldStartCountdownPanel}(BaseEuiView);__reflect(WJBattlefieldStartCountdownPanel.prototype,"WJBattlefieldStartCountdownPanel");ViewManager.ins().reg(WJBattlefieldStartCountdownPanel,LayerManager.UI_Popup);var WJBattlefieldWin=function(_super){__extends(WJBattlefieldWin,_super);function WJBattlefieldWin(){var _this=_super.call(this)||this;_this.skinName="WJBattleSkin";_this.isTopLevel=true;return _this}WJBattlefieldWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.getAwardBtn,this.onTouch);this.addTouchEvent(this.matchBtn,this.onTouch);this.addTouchEvent(this.shopLink,this.onTouch);this.addTouchEvent(this.viewArea,this.onTouch);this.upData()};WJBattlefieldWin.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}};WJBattlefieldWin.prototype.initUI=function(){this.awardList.itemRenderer=ItemBase;this.shopLink.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.shopLink.text)};WJBattlefieldWin.prototype.upData=function(){this.timesLabel.text=i18n("WJBattlefieldWin_0",WJBattlefieldSys.ins().overCounts)};WJBattlefieldWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.getAwardBtn:break;case this.matchBtn:if(WJBattlefieldSys.ins().matchingTime==0){WJBattlefieldSys.ins().sendMatch(this.autoCheckBox.selected)}else{ViewManager.ins().open(WJBattlefieldMatchPanel)}break;case this.shopLink:ViewManager.ins().open(ShopWin);break;case this.viewArea:WJBattlefieldSys.ins().sendViewDataInfo();break}};return WJBattlefieldWin}(BaseEuiView);__reflect(WJBattlefieldWin.prototype,"WJBattlefieldWin");ViewManager.ins().reg(WJBattlefieldWin,LayerManager.UI_Main);var WJBattleMinMapPanel=function(_super){__extends(WJBattleMinMapPanel,_super);function WJBattleMinMapPanel(){var _this=_super.call(this)||this;_this.flagRes=["wj_gray_flag_icon","wj_green_flag_icon","wj_red_flag_icon"];_this.entityRes=["wj_green_point","wj_blue_point"];return _this}WJBattleMinMapPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.signList=[]};WJBattleMinMapPanel.prototype.open=function(){TimerManager.ins().doTimer(300,0,this.refreshCoordinate,this);this.observe(WJBattlefieldSys.ins().postRefCampFlag,this.refreshFlag,this)};WJBattleMinMapPanel.prototype.close=function(){TimerManager.ins().removeAll(this);this.removeObserve();this.signList=[]};WJBattleMinMapPanel.prototype.refreshFlag=function(){for(var i=0;i<3;i++){if(WJBattlefieldSys.ins().flagInfos[i+1]){this["flag"+(i+1)].source=WJBattlefieldSys.ins().flagInfos[i+1]==100?this.flagRes[1]:this.flagRes[2]}else this["flag"+(i+1)].source=this.flagRes[0]}};WJBattleMinMapPanel.prototype.refreshCoordinate=function(){var list=EntityManager.ins().getAllEntity();for(var i in list){var entity=list[i];if(entity.infoModel&&!this.signList[entity.infoModel.handle]){var isFlag=false;if(isFlag){}else{var entityImg=new eui.Image(this.entityRes[0]);entityImg.x=entity.x/10>>0;entityImg.y=entity.y/10>>0;this.addChild(entityImg);this.signList[entity.infoModel.handle]=entityImg}}this.signList[entity.infoModel.handle].x=entity.x/10>>0;this.signList[entity.infoModel.handle].y=entity.y/10>>0}};return WJBattleMinMapPanel}(BaseView);__reflect(WJBattleMinMapPanel.prototype,"WJBattleMinMapPanel");var KuaFuRankData=function(){function KuaFuRankData(){this.actorId=0;this.rmb=0;this.rank=0;this.serverId=0;this.roleName="";this.job=0;this.sex=0}return KuaFuRankData}();__reflect(KuaFuRankData.prototype,"KuaFuRankData");var KfCostRankItemRender=function(_super){__extends(KfCostRankItemRender,_super);function KfCostRankItemRender(){var _this=_super.call(this)||this;_this.skinName="ISCostRankItemSkin";_this.init();return _this}KfCostRankItemRender.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};KfCostRankItemRender.prototype.onClick=function(e){};KfCostRankItemRender.prototype.dataChanged=function(){if(this.data&&this.data instanceof KuaFuRankData){this.pos.text=this.data.rank+"";this.player.text="s"+this.data.serverId+"."+this.data.roleName;this.value.text=i18n("KfCostRankItemRender_0",this.data.rmb)}};return KfCostRankItemRender}(BaseItemRender);__reflect(KfCostRankItemRender.prototype,"KfCostRankItemRender");var KfCostRankRewardItemRender=function(_super){__extends(KfCostRankRewardItemRender,_super);function KfCostRankRewardItemRender(){var _this=_super.call(this)||this;_this.skinName="ISCostRewardItemSkin";_this.init();return _this}KfCostRankRewardItemRender.prototype.init=function(){this.reward.itemRenderer=ItemBase};KfCostRankRewardItemRender.prototype.onClick=function(e){};KfCostRankRewardItemRender.prototype.dataChanged=function(){if(!this.data)return;var data=this.data;this.pos.text=data.rank+"";this.need.text=data.desc;this.reward.dataProvider=new eui.ArrayCollection(data.rewards)};return KfCostRankRewardItemRender}(BaseItemRender);__reflect(KfCostRankRewardItemRender.prototype,"KfCostRankRewardItemRender");var KfRankPanel=function(_super){__extends(KfRankPanel,_super);function KfRankPanel(){var _this=_super.call(this)||this;_this._time=0;_this.actorIds=[];return _this}KfRankPanel.prototype.childrenCreated=function(){};KfRankPanel.prototype.close=function(){this.removeObserve();TimerManager.ins().removeAll(this)};KfRankPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Activity.ins().postKuaFuRank,this.updateData);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.addTouchEvent(this.rechargeBtn,this.onClick);TimerManager.ins().doTimer(1e3,0,this.setTime,this);this.activityID=param[0];this.list.itemRenderer=KfCostRankItemRender;this.listdata=new eui.ArrayCollection;this.list.dataProvider=this.listdata;Activity.ins().sendKuaFuRank(this.activityID)};KfRankPanel.prototype.onClick=function(e){switch(e.currentTarget){case this.rechargeBtn:ViewManager.ins().open(Recharge1Win);break}};KfRankPanel.prototype.updateData=function(){var actData=Activity.ins().activityData[this.activityID];if(!actData)return;var rankList=actData.GetRankList();if(rankList.length){this.currentState="normal"}else{this.currentState="none"}this.validateNow();this.myNumber.text=actData.mycost+"";this.myRanking.text=i18n("KfRankPanel_0");if(this.currentState=="none"){return}var otherPlayerDatas=[];var len=rankList.length>3?rankList.length:3;this.actorIds=[];var myRank=0;for(var i=0;i<len;i++){var kfdata=rankList[i];if(i<3){if(kfdata&&kfdata.actorId){var actD={actorId:kfdata.actorId,serverId:kfdata.serverId};this.actorIds.push(actD);this["playName"+i].text="s"+kfdata.serverId+"."+kfdata.roleName;this["recharge"+i].text=i18n("KfRankPanel_1",kfdata.rmb);this["playName"+i].visible=this["recharge"+i].visible=true}else{var actD={actorId:0,serverId:0};this.actorIds.push(actD);this["playName"+i].visible=this["recharge"+i].visible=false}this["rank"+i].data=null}else{if(kfdata)otherPlayerDatas.push(kfdata)}if(kfdata&&Actor.actorID==kfdata.actorId)myRank=kfdata.rank}for(var r=0;r<this.actorIds.length;r++){if(this.actorIds[r]&&this.actorIds[r].actorId){UserReadPlayer.ins().sendFindPlayer(this.actorIds[r].actorId,this.actorIds[r].serverId)}}this.listdata.replaceAll(otherPlayerDatas);this._time=actData.getleftTime();this.myNumber.text=actData.mycost+"";this.myRanking.text=myRank?myRank+"":i18n("KfRankPanel_2");var scro=this.list.parent;scro.stopAnimation();this.list.scrollV=0;this.setTime()};KfRankPanel.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};KfRankPanel.prototype.openOtherPlayerView=function(otherPlayerData){if(otherPlayerData){for(var i=0;i<this.actorIds.length;i++){if(this.actorIds[i].actorId==otherPlayerData.id)this["rank"+i].data={otherPlayerData:otherPlayerData}}}};return KfRankPanel}(BaseComponent);__reflect(KfRankPanel.prototype,"KfRankPanel");var KfRankRewardPanel=function(_super){__extends(KfRankRewardPanel,_super);function KfRankRewardPanel(){var _this=_super.call(this)||this;_this._time=0;return _this}KfRankRewardPanel.prototype.childrenCreated=function(){};KfRankRewardPanel.prototype.close=function(){this.removeObserve();TimerManager.ins().removeAll(this)};KfRankRewardPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.activityID=param[0];this.list.itemRenderer=KfCostRankRewardItemRender;this.listdata=new eui.ArrayCollection;this.list.dataProvider=this.listdata;this.updateData()};KfRankRewardPanel.prototype.updateData=function(){var actData=Activity.ins().activityData[this.activityID];if(!actData)return;var config=GlobalConfig.ActivityType19Config[this.activityID];var arr=[];for(var k in config){var rank="";rank=config[k].range[0]==config[k].range[1]?""+config[k].range[0]:config[k].range[0]+"-"+config[k].range[1];var desc=config[k].condition?i18n("KfRankRewardPanel_0",config[k].condition):"";var rewards=config[k].rewards;var arrdata={rank:rank,desc:desc,rewards:rewards};arr.push(arrdata)}this.listdata.replaceAll(arr);this._time=actData.getleftTime();var scro=this.list.parent;scro.stopAnimation();this.list.scrollV=0;this.setTime();var actConfig=GlobalConfig.ActivityConfig[this.activityID];this.actInfo.textFlow=TextFlowMaker.generateTextFlow1(""+actConfig.desc)};KfRankRewardPanel.prototype.setTime=function(){if(this._time>0){this._time-=1;this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}};return KfRankRewardPanel}(BaseComponent);__reflect(KfRankRewardPanel.prototype,"KfRankRewardPanel");var Ladder=function(_super){__extends(Ladder,_super);function Ladder(){var _this=_super.call(this)||this;_this.isCanReward=false;_this.upLevel=0;_this.upId=0;_this.upWin=0;_this.todayBuyTime=0;_this.upWeekRank=0;_this.upRankList=[];_this._actorInfo=[];_this.sysId=PackageID.Ladder;_this.regNetMsg(1,_this.doLadderInfo);_this.regNetMsg(2,_this.doGetPlayer);_this.regNetMsg(3,_this.doPlayResule);_this.regNetMsg(5,_this.postRankInfoList);_this.regNetMsg(6,_this.doChallageNum);return _this}Ladder.ins=function(){return _super.ins.call(this)};Ladder.prototype.getActorInfo=function(index){if(index===void 0){index=-1}return index==-1?this._actorInfo:this._actorInfo[index]};Ladder.prototype.sendGetSomeOne=function(){this.sendBaseProto(2)};Ladder.prototype.sendStarPlay=function(id,type){var bytes=this.getBytes(3);bytes.writeInt(type);bytes.writeInt(id);this.sendToServer(bytes);this._actorInfo=[]};Ladder.prototype.sendGetWeekReward=function(){this.sendBaseProto(4)};Ladder.prototype.sendGetRankInfo=function(){this.sendBaseProto(5)};Ladder.prototype.sendBuyChallgeTime=function(){this.sendBaseProto(6)};Ladder.prototype.doLadderInfo=function(bytes){this.docodeInfo(bytes)};Ladder.prototype.postTadderChange=function(){};Ladder.prototype.doGetPlayer=function(bytes){var type=bytes.readInt();var id=bytes.readInt();this._actorInfo.length=0;this._actorInfo.push(type,id);if(id>0){this._actorInfo.push(bytes.readString());this._actorInfo.push(bytes.readByte());this._actorInfo.push(bytes.readByte());this._actorInfo.push(bytes.readInt());this._actorInfo.push(bytes.readInt())}this.postGetPlayer(type,id)};Ladder.prototype.postGetPlayer=function(type,id){};Ladder.prototype.doPlayResule=function(bytes){this.doPlayResult(bytes)};Ladder.prototype.postRankInfoList=function(bytes){var rankModel=Rank.ins().getRankModel(RankDataType.TYPE_LADDER);var n=bytes.readShort();rankModel.getDataList().length=n;var arr=rankModel.getDataList();var i=0;for(i=0;i<n;++i){this.setRankData(arr,i,bytes)}var rankInfo=this.getMyRankInfo(arr);rankModel.selfPos=rankInfo?rankInfo.pos:0;this.upRankList=[];this.upweekLength=0;n=bytes.readShort();for(i=0;i<n;++i){this.setRankData(this.upRankList,i,bytes,true)}this.fillingList();return rankModel};Ladder.prototype.setRankData=function(list,index,bytes,setRank){if(setRank===void 0){setRank=false}if(!(index in list))list[index]=new RankDataLadder;list[index].parser(bytes,null);list[index].pos=index+1;if(setRank&&list[index].id==Actor.actorID){this.upWeekRank=list[index].pos}};Ladder.prototype.doChallageNum=function(bytes){this.todayBuyTime=bytes.readInt()};Ladder.prototype.docodeInfo=function(bytes){this.isOpen=bytes.readBoolean();this.level=bytes.readInt();this.nowId=bytes.readInt();this.challgeNum=bytes.readInt();var time=bytes.readInt();this.challgeCd=time*1e3+egret.getTimer();this.winNum=bytes.readInt();this.lianWin=bytes.readBoolean();this.playUpTime=bytes.readBoolean();if(this.playUpTime){this.isCanReward=bytes.readBoolean();this.upLevel=bytes.readInt();this.upId=bytes.readInt();this.upWin=bytes.readInt()}Ladder.ins().postTadderChange()};Ladder.prototype.doPlayResult=function(bytes){var isWin=bytes.readBoolean();var num=bytes.readShort();var list=[];var item;for(var i=0;i<num;i++){item=new RewardData;item.parser(bytes);list.push(item)}var upLevel=bytes.readInt();var upId=bytes.readInt();var upStar=bytes.readInt();TimerManager.ins().doTimer(1e3,1,function(){ViewManager.ins().open(LadderResultWin,isWin,list.reverse(),upLevel,upId,upStar)},this)};Ladder.prototype.fillingList=function(){if(this.upweekLength==0){this.upweekLength=this.checkObjListLength()}var len=this.upweekLength-this.upRankList.length;if(len>0){for(var i=1;i<len;i++){this.upRankList.push(null)}}if(!this.configList){this.configList=this.cloneConfigDataList(GlobalConfig.TianTiDanConfig);this.configList.reverse()}};Ladder.prototype.getUpRankList=function(){var list=[];for(var index in this.upRankList){if(this.upRankList[index]){list.push(this.upRankList[index])}}return list};Ladder.prototype.checkObjListLength=function(){for(var i=1;i<200;i++){if(!GlobalConfig.TianTiRankAwardConfig[i+""]){return i}}return 0};Ladder.prototype.getMyRankInfo=function(itemList){for(var i=0;i<itemList.length;i++){if(itemList[i].id==Actor.actorID){return itemList[i]}}return null};Ladder.prototype.getLevelDuanWeiLength=function(level){var len=0;var list=GlobalConfig.TianTiDanConfig;for(var id in list[level+""]){if(list[level+""][id]){len++}}return len};Ladder.prototype.getDuanWeiDesc=function(){var str="";var config=this.getLevelConfig();if(config){str=config.showLevel+this.getZhongwenNumber(config.showDan)+i18n("Ladder_0")}return str};Ladder.prototype.getLevelConfig=function(level,ids){if(level===void 0){level=-1}if(ids===void 0){ids=-1}if(level==-1){level=this.level}if(ids==-1){ids=this.nowId}var list=GlobalConfig.TianTiDanConfig;for(var id in list[level+""]){if(list[level+""][id].id==ids){return list[level+""][id]}}return null};Ladder.prototype.creatRewardData=function(data){var item;item=new RewardData;item.count=data.count;item.type=data.type;item.id=data.id;return item};Ladder.prototype.getZhongwenNumber=function(i){var str="";switch(i){case 1:str=i18n("Ladder_1");break;case 2:str=i18n("Ladder_2");break;case 3:str=i18n("Ladder_3");break;case 4:str=i18n("Ladder_4");break;case 5:str=i18n("Ladder_5");break;case 6:str=i18n("Ladder_6");break;case 7:str=i18n("Ladder_7");break;case 8:str=i18n("Ladder_8");break;case 9:str=i18n("Ladder_9");break;case 10:str=i18n("Ladder_10");break}return str};Ladder.prototype.cloneConfigDataList=function(list){var returnList=[];var item;for(var i in list){for(var j in list[i]){item=new TianTiDanConfig;item.level=parseInt(i);item.id=list[i][j].id;item.showStar=list[i][j].showStar;item.showDan=list[i][j].showDan;item.showLevel=list[i][j].showLevel;item.winAward=list[i][j].winAward;item.danAward=list[i][j].danAward;if(this.checkIshaveOne(returnList,item)){returnList.push(item)}}}return returnList};Ladder.prototype.checkRedShow=function(){if(this.challgeNum>0&&this.isOpen){return 1}return 0};Ladder.prototype.checkIshaveOne=function(list,item){var len=list.length;for(var i=0;i<len;i++){if(list[i].level==item.level){return false}}return true};Ladder.prototype.getStatuByLevel=function(level){var str;switch(level){case 1:str=3;break;case 2:str=4;break;case 3:str=5;break;case 4:str=0;break}return str};return Ladder}(BaseSystem);__reflect(Ladder.prototype,"Ladder");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.ladder=Ladder.ins.bind(Ladder)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var LadderChallengeWin=function(_super){__extends(LadderChallengeWin,_super);function LadderChallengeWin(){var _this=_super.call(this)||this;_this.roleInfoList=[[[2,1],[1,0]],[[1,0],[3,1]],[[3,1],[2,1]],[[2,1],[3,1]]];_this.sendCount=0;_this.skinName="ChallengeSkin";return _this}LadderChallengeWin.prototype.initUI=function(){this.tweenObj={index:0};this.otherHead.scrollRect=new egret.Rectangle(-1,-1,84,84);this.scrollHead.scrollRect=new egret.Rectangle(-1,-56,84,84);this.otherMask=this.otherHead.scrollRect;this.scrollMask=this.scrollHead.scrollRect;this.posY=this.otherMask.y;this.posYImg=this.scrollHead.y;this.posYScroll=this.scrollMask.y};LadderChallengeWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Rank.ins().postRankingData,this.updataHeadInfo);this.observe(Ladder.ins().postGetPlayer,this.onGetPlayer);Ladder.ins().sendGetSomeOne();this.setMyHead();this.startScrollHead();this.ingImg.visible=true;this.robotLabel1.visible=false;this.robotLabel2.visible=false;this.enterTime.visible=false;PlayFun.ins().closeAuto()};LadderChallengeWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.stopScrollHead();this.removeObserve();this.ingImg.visible=true;this.enterTime.visible=false};LadderChallengeWin.prototype.onGetPlayer=function(){var playerType=Ladder.ins().getActorInfo(0);var TYPE_ROBOT=1;if(playerType==TYPE_ROBOT){var config=Ladder.ins().getLevelConfig();if(config.level>1){this.ingImg.visible=false;this.robotLabel1.visible=true;this.robotLabel2.visible=true}}};LadderChallengeWin.prototype.setMyHead=function(){var model=SubRoles.ins().getSubRoleByIndex(0);var job=fixJob(model.job);var sex=fixSex(model.sex);this.myhead.source="head_"+job+sex;var config=Ladder.ins().getLevelConfig();this.myname.text=Actor.myName;this.mylv.text=i18n("LadderChallengeWin_0",config.showLevel,config.showDan||"")};LadderChallengeWin.prototype.startScrollHead=function(){this.rollTime=0;this.otherMask.y=this.posY;this.scrollMask.y=this.posYScroll;this.scrollHead.y=this.posYImg;this.refushROllInfo(0);egret.Tween.get(this.tweenObj,{loop:true}).to({index:this.rollTime+1},20).call(this.startScroll,this)};LadderChallengeWin.prototype.stopScrollHead=function(){egret.Tween.removeTweens(this.tweenObj)};LadderChallengeWin.prototype.startScroll=function(){this.otherMask.y+=2;this.scrollMask.y+=2;this.scrollHead.y-=1;this.otherHead.scrollRect=this.otherMask;this.scrollHead.scrollRect=this.scrollMask;this.rollTime++;if(this.rollTime%27==0){this.otherMask.y=this.posY;this.scrollMask.y=this.posYScroll;this.scrollHead.y=this.posYImg;this.otherHead.scrollRect=this.otherMask;this.scrollHead.scrollRect=this.scrollMask;this.refushROllInfo(this.rollTime/27);if(this.rollTime/27==4){this.scrollHead.source="";this.rollOver()}}};LadderChallengeWin.prototype.updataHeadInfo=function(rankModel){if(rankModel.type!=RankDataType.TYPE_POWER||rankModel.type!=RankDataType.TYPE_BAOSHI||rankModel.type!=RankDataType.TYPE_LONGHUN||rankModel.type!=RankDataType.TYPE_WING||rankModel.type!=RankDataType.TYPE_BOOK||rankModel.type!=RankDataType.TYPE_ZS||rankModel.type!=RankDataType.TYPE_SCORE)return;if(rankModel.type==RankDataType.TYPE_POWER)this.refushROllInfo(0)};LadderChallengeWin.prototype.rollOver=function(){this.stopScrollHead();this.ingImg.visible=false;this.enterTime.visible=true;this.rollTime=3;this.enterTime.text=i18n("LadderChallengeWin_1",this.rollTime);if(Ladder.ins().getActorInfo(1)==0&&Ladder.ins().getActorInfo(0)==0){UserTips.ins().showTips(i18n("LadderChallengeWin_2"));ViewManager.ins().close(this)}else{TimerManager.ins().doTimer(1e3,0,this.refushLabel,this)}};LadderChallengeWin.prototype.refushLabel=function(){this.rollTime--;this.enterTime.text=i18n("LadderChallengeWin_3",this.rollTime);if(this.rollTime<1){this.sendStarPlay();TimerManager.ins().remove(this.refushLabel,this)}};LadderChallengeWin.prototype.refushROllInfo=function(num){if(num>3){this.showPointPlayerInfo();return}var mathLevel=Ladder.ins().level;var mathId=Math.floor(Math.random()*Ladder.ins().getLevelDuanWeiLength(mathLevel));var config=Ladder.ins().getLevelConfig(mathLevel,mathId);this.otherlv.text=i18n("LadderChallengeWin_4",config.showLevel,config.showDan||"");var list=this.roleInfoList[num];var job=fixJob(list[0][0]);var sex=fixSex(list[0][1]);this.otherHead.source="head_"+job+sex;job=fixJob(list[1][0]);sex=fixSex(list[1][1]);this.scrollHead.source="head_"+job+sex;var data=this.getRankListOne();if(data==null){return}};LadderChallengeWin.prototype.showPointPlayerInfo=function(){var info=Ladder.ins().getActorInfo();if(info.length==0||info[1]==0&&info[0]==0){return}var job=fixJob(info[3]);var sex=fixSex(info[4]);this.otherHead.source="head_"+job+sex;this.scrollHead.source="";var config=Ladder.ins().getLevelConfig(info[5],info[6]);this.otherlv.text=i18n("LadderChallengeWin_5",config.showLevel,config.showDan||"");this.othername.textFlow=TextFlowMaker.generateTextFlow1(info[2])};LadderChallengeWin.prototype.sendStarPlay=function(){Ladder.ins().sendStarPlay(Ladder.ins().getActorInfo(1),Ladder.ins().getActorInfo(0));ViewManager.ins().close(LadderWin);ViewManager.ins().close(this);GameSceneView.playCloudAni(false)};LadderChallengeWin.prototype.getRankListOne=function(){var rankModel=Rank.ins().getRankModel(RankDataType.TYPE_POWER);if(rankModel&&rankModel.getDataList().length<=0){if(this.sendCount<2){Rank.ins().sendGetRankingData(RankDataType.TYPE_POWER);this.sendCount++;return null}return null}this.sendCount=0;var arr=rankModel.getDataList();var randData=arr[Math.floor(Math.random()*arr.length)];if(randData&&randData.id==Actor.actorID){if(arr.length==1){return randData}return this.getRankListOne()}return randData};return LadderChallengeWin}(BaseEuiView);__reflect(LadderChallengeWin.prototype,"LadderChallengeWin");ViewManager.ins().reg(LadderChallengeWin,LayerManager.UI_Popup);var LadderInfoPanel=function(_super){__extends(LadderInfoPanel,_super);function LadderInfoPanel(){var _this=_super.call(this)||this;_this.name=i18n("LadderInfoPanel_0");return _this}LadderInfoPanel.prototype.childrenCreated=function(){this.rewardList.itemRenderer=ItemBase};LadderInfoPanel.prototype.open=function(){this.buyTime.textFlow=(new egret.HtmlTextParser).parser(i18n("LadderInfoPanel_1"));this.showNomber.textFlow=(new egret.HtmlTextParser).parser(i18n("LadderInfoPanel_2"));this.showReward.textFlow=(new egret.HtmlTextParser).parser(i18n("LadderInfoPanel_3"));this.showNomber0.textFlow=(new egret.HtmlTextParser).parser(i18n("LadderInfoPanel_4"));this.addTouchEvent(this.flowPlayer,this.onTap);this.addTouchEvent(this.buyTime,this.onTap);this.addTouchEvent(this.showNomber,this.onTap);this.addTouchEvent(this.showReward,this.onTap);this.addTouchEvent(this.showNomber0,this.onTap);this.observe(Ladder.ins().postTadderChange,this.tadderInfoChange);this.observe(Ladder.ins().postRankInfoList,this.tadderInfoChange);Ladder.ins().sendGetRankInfo();this.tadderInfoChange()};LadderInfoPanel.prototype.$onClose=function(){_super.prototype.$onClose.call(this);TimerManager.ins().removeAll(this)};LadderInfoPanel.prototype.updateTime=function(){var v=Ladder.ins().challgeNum;var mv=GlobalConfig.TianTiConstConfig.maxRestoreChallengesCount;var color=v>0?"03b154":"f3311e";var time=Math.round((Ladder.ins().challgeCd-egret.getTimer())/1e3);time=time<=0?0:time;var str=v>=mv?i18n("LadderInfoPanel_5"):i18n("LadderInfoPanel_6",DateUtils.getFormatBySecond(time));this.lastNum.textFlow=(new egret.HtmlTextParser).parser(i18n("LadderInfoPanel_7",color,v,mv,str))};LadderInfoPanel.prototype.tadderInfoChange=function(){TimerManager.ins().remove(this.updateTime,this);TimerManager.ins().doTimer(500,0,this.updateTime,this);this.updateTime();var rankModel=Rank.ins().rankModel[RankDataType.TYPE_LADDER];if(rankModel)this.winNum0.text=rankModel.selfPos>0?""+rankModel.selfPos:i18n("LadderInfoPanel_8");this.winNum.text=""+Ladder.ins().winNum;this.duanwei.text=Ladder.ins().getDuanWeiDesc();var config=Ladder.ins().getLevelConfig();if(config){this.rewardList.dataProvider=new eui.ArrayCollection(config.danAward)}this.winImg.visible=Ladder.ins().lianWin;this.starInfo.updataStarInfo(config);this.starInfo.setLvAndRank(config);this.noOpenDesc.visible=!Ladder.ins().isOpen;this.openInfo.visible=Ladder.ins().isOpen};LadderInfoPanel.prototype.onTap=function(e){ViewManager.ins().close(LimitTaskView);switch(e.currentTarget){case this.flowPlayer:if(UserFb.ins().checkInFB())return;if(Ladder.ins().challgeNum<=0){UserTips.ins().showTips(i18n("LadderInfoPanel_9"));return}if(ViewManager.ins().isShow(LadderChallengeWin)){return}ViewManager.ins().open(LadderChallengeWin);break;case this.buyTime:if(Ladder.ins().todayBuyTime==GlobalConfig.TianTiConstConfig.maxBuyChallengesCount){UserTips.ins().showTips(i18n("LadderInfoPanel_10"));return}if(Actor.yb<GlobalConfig.TianTiConstConfig.buyChallengesCountYuanBao){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("LadderInfoPanel_11"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("LadderInfoPanel_12"));return}WarnWin.show(i18n("LadderInfoPanel_13",GlobalConfig.TianTiConstConfig.buyChallengesCountYuanBao)+i18n("LadderInfoPanel_14",Ladder.ins().todayBuyTime,GlobalConfig.TianTiConstConfig.maxBuyChallengesCount),function(){Ladder.ins().sendBuyChallgeTime()},this);break;case this.showReward:ViewManager.ins().open(LadderRewardShowWin);break;case this.showNomber:ViewManager.ins().open(LadderLastRankWin,1);break;case this.showNomber0:if(Ladder.ins().upLevel>0)ViewManager.ins().open(LadderLastRankWin,0);else UserTips.ins().showTips(i18n("LadderInfoPanel_15"));break}};return LadderInfoPanel}(BaseComponent);__reflect(LadderInfoPanel.prototype,"LadderInfoPanel");var LadderLastRankWin=function(_super){__extends(LadderLastRankWin,_super);function LadderLastRankWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="ladderinforankingskin";return _this}LadderLastRankWin.prototype.createChildren=function(){this.list.itemRenderer=LadderRankItemRenderer};LadderLastRankWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var type=param[0];this.setPanelInfo(type);this.titleDesc.text=type==1?i18n("LadderLastRankWin_0"):i18n("LadderLastRankWin_1");this.rankDesc.text=type==1?i18n("LadderLastRankWin_2"):i18n("LadderLastRankWin_3");this.addTouchEvent(this.closeBtn,this.onTap)};LadderLastRankWin.prototype.close=function(){this.removeTouchEvent(this.closeBtn,this.onTap)};LadderLastRankWin.prototype.onTap=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break}};LadderLastRankWin.prototype.setPanelInfo=function(type){var config=Ladder.ins().getLevelConfig();if(type==1){var rankModel=Rank.ins().rankModel[RankDataType.TYPE_LADDER];this.list.dataProvider=new eui.ArrayCollection(rankModel.getDataList()?rankModel.getDataList():[]);this.myRank.text=rankModel.selfPos>0?i18n("LadderLastRankWin_4",rankModel.selfPos):i18n("LadderLastRankWin_5");this.WinNum.text=i18n("LadderLastRankWin_6",Ladder.ins().winNum);this.myDwIng.source="ladder_rank_"+Ladder.ins().level;config=Ladder.ins().getLevelConfig()}else{this.list.dataProvider=new eui.ArrayCollection(Ladder.ins().getUpRankList());this.myRank.text=Ladder.ins().upWeekRank>0?i18n("LadderLastRankWin_7",Ladder.ins().upWeekRank):i18n("LadderLastRankWin_8");this.WinNum.text=i18n("LadderLastRankWin_9",Ladder.ins().upWin);this.myDwIng.source="ladder_rank_"+Ladder.ins().upLevel;config=Ladder.ins().getLevelConfig(Ladder.ins().upLevel,Ladder.ins().upId)}if(config.showDan>0){this.levelBg.visible=true;this.level.source="laddergradnum_"+config.showDan}else{this.levelBg.visible=false;this.level.source=null}};return LadderLastRankWin}(BaseEuiView);__reflect(LadderLastRankWin.prototype,"LadderLastRankWin");ViewManager.ins().reg(LadderLastRankWin,LayerManager.UI_Main);var LadderRankItemRenderer=function(_super){__extends(LadderRankItemRenderer,_super);function LadderRankItemRenderer(){var _this=_super.call(this)||this;_this.skinName="TiantiRankItem";return _this}LadderRankItemRenderer.prototype.dataChanged=function(){var rankData=this.data;if(rankData.pos<=3){this.rankImg.source="paihang"+rankData.pos;this.rank.text=""}else{this.rank.text=rankData.pos+"";this.rankImg.source=""}this.nameLabel.text=rankData.player;this.nameLabel.textColor=rankData.id==Actor.actorID?16411915:16708269;this.winNum.text=rankData.winNum+i18n("LadderRankItemRenderer_0");this.dwImg.source="ladder_rank_"+rankData.challgeLevel;var config=Ladder.ins().getLevelConfig(rankData.challgeLevel,rankData.challgeId);if(config&&config.showDan>0){this.level.source="laddergradnum_"+config.showDan;this.levelBg.visible=true}else{this.level.source=null;this.levelBg.visible=false}};return LadderRankItemRenderer}(BaseItemRender);__reflect(LadderRankItemRenderer.prototype,"LadderRankItemRenderer");var LadderResultWin=function(_super){__extends(LadderResultWin,_super);function LadderResultWin(){var _this=_super.call(this)||this;_this.skinName="ladderresultwinskin";return _this}LadderResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.listData=new eui.ArrayCollection;this.mc=new MovieClip;this.mc.scaleX=this.mc.scaleY=1.2;this.starList.addChildAt(this.mc,0)};LadderResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}_super.prototype.open.call(this,param);this.isWin=param[0];var list=param[1];var upLevel=param[2];var upId=param[3];var upStar=param[4];this.bg.source=this.isWin?"win_png":"lost_png";this.result.source=this.isWin?"win_02":"lost_02";this.sureBtn.name=this.isWin?i18n("LadderResultWin_0"):i18n("LadderResultWin_1");this.s=5;this.updateCloseBtnLabel();TimerManager.ins().doTimer(1e3,5,this.updateCloseBtnLabel,this);this.listData.source=list;this.list.dataProvider=this.listData;this.refushStarInfo(upLevel,upId,upStar);this.addTouchEvent(this.sureBtn,this.onTap);this.playEffect()};LadderResultWin.prototype.playEffect=function(){if(!this.isWin)return;this.mc.playFile(RES_DIR_EFF+"laddercircle",-1);this.mc.x=this.starList.width>>1;this.mc.y=this.starList.height>>1};LadderResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateCloseBtnLabel,this);this.removeTouchEvent(this.sureBtn,this.onTap);egret.Tween.removeTweens(this.starList);DisplayUtils.removeFromParent(this.mc);if(GameMap.fubenID>0){UserFb.ins().sendExitFb();ViewManager.ins().open(LadderWin,1)}};LadderResultWin.prototype.refushStarInfo=function(level,id,starNum){var info=Ladder.ins().getLevelConfig(level,id);this.upLevel=level;this.upId=id;this.starList.updataStarInfo(info);this.lastlevel=info.showDan;this.lastRank=info.level;this.star1.visible=false;this.star2.visible=false;for(var i=0;i<starNum;i++){this["star"+(i+1)].visible=true;this["star"+(i+1)].currentState=this.isWin?"light":"black"}this.upStar.visible=Ladder.ins().getLevelConfig().showDan>0;if(starNum>0){var self_11=this;var playFun_1=function(){TimerManager.ins().remove(playFun_1,self_11);self_11.setStarInfoChange(info.showStar,starNum)};TimerManager.ins().doTimer(500,1,playFun_1,self_11)}};LadderResultWin.prototype.setStarInfoChange=function(index,num){if(num>0){this.starList.upStarStatu(index+1,num,this.isWin)}};LadderResultWin.prototype.cheackIsChangeLevel=function(num){var _this=this;if(this.upLevel==Ladder.ins().level&&this.upId==Ladder.ins().nowId){return}var t=egret.Tween.get(this.starList);t.to({alpha:1},300).call(function(){if(_this.isWin){if(num>=1){_this.starList.upStarStatu(1,num,_this.isWin)}}var info=Ladder.ins().getLevelConfig();var currentLevel=info.showDan;var currentRank=info.level;if(_this.lastRank<currentRank){_this.starList.showRankUp(currentRank);_this.starList.showLvUp(currentLevel)}else{if(_this.lastlevel<currentLevel){_this.starList.showLvDown(currentLevel)}else if(_this.lastlevel>currentLevel){_this.starList.showLvUp(currentLevel)}}_this.starList.updataStarInfo(info,false);egret.Tween.removeTweens(_this.starList)},this)};LadderResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.sureBtn:ViewManager.ins().close(this);break}};LadderResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)ViewManager.ins().close(this);this.sureBtn.label=this.sureBtn.name+"("+this.s+"s)"};return LadderResultWin}(BaseEuiView);__reflect(LadderResultWin.prototype,"LadderResultWin");ViewManager.ins().reg(LadderResultWin,LayerManager.UI_Popup);var LadderRewardShowWin=function(_super){__extends(LadderRewardShowWin,_super);function LadderRewardShowWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="ladderinforewardskin";return _this}LadderRewardShowWin.prototype.createChildren=function(){this.list0.itemRenderer=LastWeekRankItemRenderer;this.list1.itemRenderer=ItemBase;this.addTouchEvent(this.closeBtn,this.onTap)};LadderRewardShowWin.prototype.open=function(){this.setPanelInfo()};LadderRewardShowWin.prototype.close=function(){this.removeTouchEvent(this.closeBtn,this.onTap)};LadderRewardShowWin.prototype.onTap=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break}};LadderRewardShowWin.prototype.setPanelInfo=function(){var data=Ladder.ins().upRankList;if(data.length>5){data=data.slice(0,5)}this.list0.dataProvider=new eui.ArrayCollection(data);var duanwei=Ladder.ins().configList;var reward=this.getRewardDataList(duanwei);this.list1.dataProvider=new eui.ArrayCollection(reward);this.winNum.text=i18n("LadderRewardShowWin_0",Ladder.ins().upWin);this.winNum0.text=i18n("LadderRewardShowWin_1")+(Ladder.ins().upWeekRank>0?""+Ladder.ins().upWeekRank:i18n("LadderRewardShowWin_2"));if(Ladder.ins().playUpTime){this.upImg.source="ladder_rank_"+Ladder.ins().upLevel;var config=Ladder.ins().getLevelConfig(Ladder.ins().upLevel,Ladder.ins().upId);if(config.showDan>0){this.levelbg.visible=true;this.level.source="laddergradnum_"+config.showDan}else{this.levelbg.visible=false;this.level.source=null}}else{this.upImg.source="ladder_rank_1";this.level.source="laddergradnum_"+5}};LadderRewardShowWin.prototype.getRewardDataList=function(cfgList){var list=[];for(var i=0;i<cfgList.length;i++){list=list.concat(cfgList[i].danAward)}return list};LadderRewardShowWin.openCheck=function(){if(!Ladder.ins().configList){UserTips.ins().showTips(i18n("LadderRewardShowWin_3"));return false}return true};return LadderRewardShowWin}(BaseEuiView);__reflect(LadderRewardShowWin.prototype,"LadderRewardShowWin");ViewManager.ins().reg(LadderRewardShowWin,LayerManager.UI_Main);var LadderWin=function(_super){__extends(LadderWin,_super);function LadderWin(){var _this=_super.call(this)||this;_this.skinName="ladderwinskin";_this.isTopLevel=true;return _this}LadderWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.help,this.onTap);this.addChangingEvent(this.tab,this.onTabTouching);this.addChangeEvent(this.tab,this.selectIndexChange);this.addChangingEvent(this.tab,this.checkIsBack);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(Mine.ins().postRedPoint,this.updateMineRedPoint);this.observe(UserFb.ins().postShowRedChange,this.refushredPoint);this.observe(Hungu.ins().postHunShouFBInfo,this.refushredPoint);this.observe(Hungu.ins().postSweepHunShouFB,this.refushredPoint);this.observe(EscortMgr.ins().postStatus,this.refushredPoint);this.observe(EscortMgr.ins().postStartEscort,this.refushredPoint);this.observe(EscortMgr.ins().postEndTimeReached,this.refushredPoint);this.observe(EscortMgr.ins().postBuyEscort,this.refushredPoint);var index=param[0]?param[0]:0;this.tab.selectedIndex=index;this.viewStack.selectedIndex=index;this.selectIndexChange();this.refushredPoint()};LadderWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.Event.CHANGING,this.onTabTouching,this.tab)};LadderWin.prototype.selectIndexChange=function(e){if(e===void 0){e=null}var selectedPanel=this.viewStack.getChildAt(this.tab.selectedIndex);if(selectedPanel instanceof EncounterInfoWin){this.zaoyu.open()}else if(selectedPanel instanceof LadderInfoPanel){this.ladder.open()}else if(selectedPanel instanceof MinePanel){this.wakuang.open()}else if(selectedPanel instanceof EscortPanel){this.escortPanel.open()}this.title.source="biaoti_jingji"+this.tab.selectedIndex};LadderWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};LadderWin.prototype.checkIsOpen=function(index){return true};LadderWin.prototype.refushredPoint=function(){this.redPoint1.visible=!!Encounter.ins().isHasRed();this.redPoint2.visible=Ladder.ins().isCanReward||Ladder.ins().isOpen?Ladder.ins().challgeNum>0:false;this.redPoint3.visible=Mine.redpointCheck();this.redPoint4.visible=EscortMgr.ins().checkRedPoint()};LadderWin.prototype.updateMineRedPoint=function(num){this.redPoint3.visible=!!num};LadderWin.prototype.onTap=function(e){switch(e.currentTarget){case this.help:if(this.tab.selectedIndex==0){ViewManager.ins().open(ZsBossRuleSpeak,10)}else if(this.tab.selectedIndex==1){ViewManager.ins().open(ZsBossRuleSpeak,4)}else if(this.tab.selectedIndex==2){ViewManager.ins().open(ZsBossRuleSpeak,14)}else if(this.tab.selectedIndex==3){ViewManager.ins().open(ZsBossRuleSpeak,50)}else if(this.tab.selectedIndex==4){}break;case this.closeBtn:ViewManager.ins().close(this);break}};LadderWin.prototype.checkIsBack=function(e){var tab=e.target;if(!LadderWin.openCheck([tab.selectedIndex])){e.$cancelable=true;e.preventDefault()}else{ViewManager.ins().close(LimitTaskView)}};LadderWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var index=param[0]?param[0]:0;if(index==0){var v_1=GlobalConfig.SkirmishBaseConfig.openLevel;var b=UserFb.ins().guanqiaID>=v_1;if(!b)UserTips.ins().showTips(i18n("LadderWin_0",v_1));return b}if(index==1){var v_2=GlobalConfig.TianTiConstConfig.openLevel;var b=Actor.level>=v_2;if(!b)UserTips.ins().showTips(i18n("LadderWin_1",v_2));return b}else if(index==2){var b=Mine.openCheck(true);return b}else if(index==3){var roleLevel=Actor.level;var v=GlobalConfig.EscortBaseConfig.openlevel;var b=roleLevel>=v;if(!b){UserTips.ins().showTips(i18n("LadderWin_2",v))}return b}else if(index==4){var b=true;return b}};return LadderWin}(BaseEuiView);__reflect(LadderWin.prototype,"LadderWin");ViewManager.ins().reg(LadderWin,LayerManager.UI_Main);var LastWeekRankItemRenderer=function(_super){__extends(LastWeekRankItemRenderer,_super);function LastWeekRankItemRenderer(){return _super.call(this)||this}LastWeekRankItemRenderer.prototype.dataChanged=function(){this.index=this.itemIndex+1;if(this.index<=3){this.rankImg.source="paihang"+this.index;this.rank.text=""}else{this.rank.text=this.index+"";this.rankImg.source=""}if(this.data instanceof RankDataLadder){var rankData=this.data;this.dwImg.source="ladder_rank_"+rankData.challgeLevel;this.nameLabel.text=rankData.player;this.winNum.text=rankData.winNum+i18n("LastWeekRankItemRenderer_0");var job=fixJob(rankData.job);var sex=fixSex(rankData.sex);this.head.source="head_"+job+sex;var config=Ladder.ins().getLevelConfig(rankData.challgeLevel,rankData.challgeId);this.item1.data=Ladder.ins().creatRewardData(GlobalConfig.TianTiRankAwardConfig[this.index+""].award[0]);this.level.text=config.showDan+"";this.setlevelInfo(rankData.challgeLevel<4);if(this.index==1){}}else if(this.data instanceof TianTiDanConfig){var danConfig=this.data;this.winNum.text="";this.nameLabel.text=danConfig.showLevel+i18n("LastWeekRankItemRenderer_1");this.item1.data=Ladder.ins().creatRewardData(danConfig.danAward[0]);this.setlevelInfo(true);this.dwImg.source="ladder_rank_"+danConfig.level;this.level.text=danConfig.showDan+"";this.setlevelInfo(false);this.rankImg.source="";this.rank.text=""}else{this.winNum.text="";this.nameLabel.text=i18n("LastWeekRankItemRenderer_2")+this.index+i18n("LastWeekRankItemRenderer_3");this.item1.data=Ladder.ins().creatRewardData(GlobalConfig.TianTiRankAwardConfig[this.index+""].award[0]);this.dwImg.source="ladder_rank_4";this.setlevelInfo(false);if(this.index==1){}}};LastWeekRankItemRenderer.prototype.setlevelInfo=function(boo){this.levelBg.visible=this.level.visible=boo};return LastWeekRankItemRenderer}(BaseItemRender);__reflect(LastWeekRankItemRenderer.prototype,"LastWeekRankItemRenderer");var LevelUpWayWin=function(_super){__extends(LevelUpWayWin,_super);function LevelUpWayWin(){var _this=_super.call(this)||this;_this.gainWay=[[i18n("LevelUpWayWin_0"),"GuanQiaRewardWin",0,3],[i18n("LevelUpWayWin_1"),"FbWin",2,5],[i18n("LevelUpWayWin_2"),"LadderWin",0,4],[i18n("LevelUpWayWin_3"),"FbWin",1,5]];return _this}LevelUpWayWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="LevelUpWaySkin";this.gainList.itemRenderer=GainGoodsItem};LevelUpWayWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.gainList.dataProvider=new eui.ArrayCollection(this.gainWay);this.gainList.validateNow();for(var i=0;i<this.gainList.numElements;i++){var gitem=this.gainList.getElementAt(i);if(gitem){var isOpen=false;var needLv=void 0;var needZs=void 0;var guanka=void 0;if(i<=0){isOpen=true}else if(i==1){isOpen=UserZs.ins().lv>=GlobalConfig.FbChallengeConfig[1].zsLevelLimit&&Actor.level>=GlobalConfig.FbChallengeConfig[1].levelLimit;needLv=GlobalConfig.FbChallengeConfig[1].levelLimit;needZs=GlobalConfig.FbChallengeConfig[1].zsLevelLimit}else if(i==2){isOpen=UserFb.ins().guanqiaID>=GlobalConfig.SkirmishBaseConfig.openLevel;guanka=GlobalConfig.SkirmishBaseConfig.openLevel}else if(i==3){isOpen=Actor.level>=GlobalConfig.ExpFubenBaseConfig.openLv;needLv=GlobalConfig.ExpFubenBaseConfig.openLv}gitem.gainData(isOpen,this.gainWay[i][3],{needLv:needLv,needZs:needZs,guanka:guanka})}}};LevelUpWayWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this)};LevelUpWayWin.prototype.onTouchList=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){ViewManager.ins().closeTopLevel();if(item[1]=="GuanQiaRewardWin"){if(UserFb.ins().guanqiaID<GlobalConfig.OpenSystemConfig[SystemType.CHALLENGE].opencheck){UserFb.ins().setAutoPk();ViewManager.ins().close(LevelUpWayWin);return}PlayFun.ins().openAuto();GameGuider.challengeBoss();ViewManager.ins().close(LevelUpWayWin);return}GameGuider.guidance(item[1],item[2]);ViewManager.ins().close(LevelUpWayWin)}};LevelUpWayWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};return LevelUpWayWin}(BaseEuiView);__reflect(LevelUpWayWin.prototype,"LevelUpWayWin");ViewManager.ins().reg(LevelUpWayWin,LayerManager.UI_Popup);var LevelupRewardsData=function(){function LevelupRewardsData(){}LevelupRewardsData.prototype.parse=function(bytes){this.id=bytes.readInt();this.status=bytes.readInt()};return LevelupRewardsData}();__reflect(LevelupRewardsData.prototype,"LevelupRewardsData");var LevelupRewardsSys=function(_super){__extends(LevelupRewardsSys,_super);function LevelupRewardsSys(){var _this=_super.call(this)||this;_this.rewardsList=[];_this.sysId=PackageID.LevelupRewards;_this.regNetMsg(1,_this.postRewardsStatus);_this.regNetMsg(2,_this.postRewardId);_this.observe(UserZs.ins().postZsLv,_this.sendRewardsStatusReq);_this.observe(Actor.ins().postLevelChange,_this.sendRewardsStatusReq);return _this}LevelupRewardsSys.prototype.sendRewardsStatusReq=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};LevelupRewardsSys.prototype.postRewardsStatus=function(bytes){var len=bytes.readInt();var rewardsList=[];for(var i=0;i<len;++i){var rewardData=new LevelupRewardsData;rewardData.parse(bytes);rewardsList.push(rewardData)}rewardsList=this.sortRewardList(rewardsList);rewardsList=this.classifyRewardsListByStatus(rewardsList);this.rewardsList=rewardsList;return rewardsList};LevelupRewardsSys.prototype.sortRewardList=function(rewardsList){if(!rewardsList)return[];rewardsList.sort(function(a,b){return a.id-b.id});return rewardsList};LevelupRewardsSys.prototype.classifyRewardsListByStatus=function(rewardsList){if(!rewardsList)return[];var hadGetRewards=[];var waitToGetRewards=[];for(var i=0;i<rewardsList.length;++i){if(rewardsList[i].status==RewardsStatus.STATUS_HAD_GET){hadGetRewards.push(rewardsList[i])}else{waitToGetRewards.push(rewardsList[i])}}return waitToGetRewards.concat(hadGetRewards)};LevelupRewardsSys.prototype.sendRewardId=function(getId){var bytes=this.getBytes(2);bytes.writeInt(getId);this.sendToServer(bytes)};LevelupRewardsSys.prototype.postRewardId=function(bytes){this.errCode=bytes.readInt();this.getId=bytes.readInt();if(this.errCode==0){var rewardsList=this.setRewardStatus(this.getId,RewardsStatus.STATUS_HAD_GET);rewardsList=this.sortRewardList(rewardsList);rewardsList=this.classifyRewardsListByStatus(rewardsList);this.rewardsList=rewardsList}};LevelupRewardsSys.prototype.setRewardStatus=function(id,status){var rewardsList=this.rewardsList;rewardsList.forEach(function(reward){if(reward&&reward.id==id){reward.status=status}});return rewardsList};LevelupRewardsSys.prototype.isEnableGetRewards=function(){if(this.rewardsList==null||this.rewardsList.length<=0){this.sendRewardsStatusReq();return}var isEnableGet=false;var rewardsList=this.rewardsList;rewardsList.forEach(function(reward){if(reward&&reward.status==RewardsStatus.STATUS_ABLE_GET){isEnableGet=true}});return isEnableGet};LevelupRewardsSys.prototype.hasRewardLeft=function(){var result=false;var list=this.rewardsList;for(var _i=0,list_15=list;_i<list_15.length;_i++){var val=list_15[_i];if(val&&(val.status==0||val.status==2)){result=true;break}}return result};return LevelupRewardsSys}(BaseSystem);__reflect(LevelupRewardsSys.prototype,"LevelupRewardsSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.levelupRewards=LevelupRewardsSys.ins.bind(LevelupRewardsSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var RewardsStatus;(function(RewardsStatus){RewardsStatus[RewardsStatus["STATUS_ABLE_GET"]=0]="STATUS_ABLE_GET";RewardsStatus[RewardsStatus["STATUS_HAD_GET"]=1]="STATUS_HAD_GET";RewardsStatus[RewardsStatus["STATUS_DISABLE_GET"]=2]="STATUS_DISABLE_GET"})(RewardsStatus||(RewardsStatus={}));window["RewardsStatus"]=RewardsStatus;var LevelupRewardsPanel=function(_super){__extends(LevelupRewardsPanel,_super);function LevelupRewardsPanel(){var _this=_super.call(this)||this;_this.skinName="LevelupRewardsSkin";return _this}LevelupRewardsPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(LevelupRewardsSys.ins().postRewardId,this.updateShow);this.initList();this.setLevelTxt();this.setRewardsData()};LevelupRewardsPanel.prototype.initList=function(){var content=this.content;content.dataProvider=new ArrayCollection([]);content.itemRenderer=LevelupRewardsRenderer};LevelupRewardsPanel.prototype.setLevelTxt=function(){var levelTxt="";if(UserZs.ins().lv>0){levelTxt+=UserZs.ins().lv+i18n("LevelupRewardsPanel_0")}if(Actor.level>0){levelTxt+=Actor.level+i18n("LevelupRewardsPanel_1")}this.myAttrValue.text=levelTxt};LevelupRewardsPanel.prototype.updateShow=function(){this.setLevelTxt();TimerManager.ins().doTimer(300,1,this.setRewardsData,this);if(this.isGetRewardFailed()){this.onGetRewardFailed()}};LevelupRewardsPanel.prototype.setRewardsData=function(){var rewardsList=LevelupRewardsSys.ins().rewardsList;var rewardsData=[];var LevelupRewards=GlobalConfig.LevelupRewards;if(LevelupRewards){rewardsList.forEach(function(reward){if(reward&&reward.id){rewardsData.push(LevelupRewards[reward.id])}});var dataPro=this.content.dataProvider;dataPro.replaceAll(rewardsData)}};LevelupRewardsPanel.prototype.isGetRewardFailed=function(){if(LevelupRewardsSys.ins().errCode!=0){return true}return false};LevelupRewardsPanel.prototype.onGetRewardFailed=function(){var errCode=LevelupRewardsSys.ins().errCode;if(errCode==1){UserTips.ins().showTips(i18n("LevelupRewardsPanel_2"))}else if(errCode==2){UserTips.ins().showTips(i18n("LevelupRewardsPanel_3"))}};LevelupRewardsPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();TimerManager.ins().removeAll(this)};return LevelupRewardsPanel}(ActivityPanel);__reflect(LevelupRewardsPanel.prototype,"LevelupRewardsPanel");var LevelupRewardsRenderer=function(_super){__extends(LevelupRewardsRenderer,_super);function LevelupRewardsRenderer(){var _this=_super.call(this)||this;_this.skinName="LevelupRewardsItemSkin";_this.itemList.itemRenderer=ItemBase;return _this}LevelupRewardsRenderer.prototype.dataChanged=function(){if(!this.data)return;this.initUI();this.updateShow()};LevelupRewardsRenderer.prototype.initUI=function(){this.redPoint.visible=false;this.levelTxt.text="";this.btnGet.skinName="Btn60Skin";this.btnGet.label=i18n("LevelupRewardsRenderer_0");this.biaotiImg.source="";this.biaotiImg.scaleX=1;this.biaotiImg.scaleY=1;this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)};LevelupRewardsRenderer.prototype.updateShow=function(){var curLevel=-1;var getLevel=-1;var rewardsList=LevelupRewardsSys.ins().rewardsList;var status=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].status:RewardsStatus.STATUS_DISABLE_GET;if(this.data["level"]){curLevel=Actor.level;getLevel=this.data["level"];this.levelShow()}else if(this.data["zslevel"]){curLevel=UserZs.ins().lv;getLevel=this.data["zslevel"];this.zslevelShow()}this.setRewardStatus(curLevel,getLevel,status);this.setItemListData()};LevelupRewardsRenderer.prototype.levelShow=function(){this.biaotiImg.source="biaoti_mianfeilingqu";this.levelTxt.text=""+this.data["level"]};LevelupRewardsRenderer.prototype.zslevelShow=function(){this.biaotiImg.scaleX=1.05;this.biaotiImg.scaleY=1.1;this.biaotiImg.source="biaoti_mianfeilingqu2";this.levelTxt.text=""+this.data["zslevel"]};LevelupRewardsRenderer.prototype.setRewardStatus=function(curLevel,getLevel,status){this.btnGet.enabled=true;if(curLevel>=getLevel){this.redPoint.visible=true;if(status==RewardsStatus.STATUS_ABLE_GET){this.btnGet.currentState="up";this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)}else if(status==RewardsStatus.STATUS_HAD_GET){this.redPoint.visible=false;this.btnGet.enabled=false;this.btnGet.label=i18n("LevelupRewardsRenderer_1");this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled"}}else{this.btnGet.enabled=false;this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled";this.btnGet.label=i18n("LevelupRewardsRenderer_2")}};LevelupRewardsRenderer.prototype.setItemListData=function(){if(this.data["rewards"]){var rewards=this.data["rewards"];var d=[];var role=SubRoles.ins().getSubRoleByIndex(0);var job=role?role.job:1;for(var i=0;i<rewards.length;i++){if(!rewards[i])continue;if(rewards[i].job!=null&&rewards[i].job==job||rewards[i].job==null){d.push(rewards[i])}}this.itemList.dataProvider=new eui.ArrayCollection(d)}};LevelupRewardsRenderer.prototype.onGetReward=function(){this.btnGet.currentState="down";if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}var rewardsList=LevelupRewardsSys.ins().rewardsList;var id=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].id:-1;if(id>=0){LevelupRewardsSys.ins().sendRewardId(id);if(this.data["level"]==50){DressGuideMgr.ins().toStep(1)}}else{UserTips.ins().showTips(i18n("LevelupRewardsRenderer_3"))}};return LevelupRewardsRenderer}(BaseItemRender);__reflect(LevelupRewardsRenderer.prototype,"LevelupRewardsRenderer");var LiLian=function(_super){__extends(LiLian,_super);function LiLian(){var _this=_super.call(this)||this;_this.lilianReward=0;_this.nobilityIsUpGrade=0;_this.nobilityLv=0;_this.xunzhangJF=0;_this.liLianExpDay=0;_this.liLianExpDayReward=0;_this.jadeLv=0;_this.isShow=false;_this.isXZShow=false;_this.skillCfgList=[];_this.sysId=PackageID.Train;_this.regNetMsg(1,_this.postLilianData);_this.regNetMsg(5,_this.postNobilityData);_this.regNetMsg(3,_this.postTrainsDayAward);_this.regNetMsg(10,_this.postJadeLv);return _this}LiLian.ins=function(){return _super.ins.call(this)};LiLian.prototype.sendLilianUpgrade=function(){this.sendBaseProto(1)};LiLian.prototype.sendNobilityUpgrade=function(){this.sendBaseProto(6)};LiLian.prototype.sendNobilityStageUpgrade=function(){this.sendBaseProto(7)};LiLian.prototype.sendGetLilianReward=function(){this.sendBaseProto(2)};LiLian.prototype.postLilianData=function(bytes){var lv=bytes.readInt();this.liLianExp=bytes.readInt();this.lilianReward=bytes.readInt();this.liLianExpDay=bytes.readInt();this.liLianExpDayReward=bytes.readInt();var flag=false;if(lv>this.liLianLv||this.checkShowRedPoint2())flag=true;this.liLianLv=lv;UserTask.ins().postUpdataTaskPoint();if(flag){this.upDateRole()}if(!this.getTraining)return{flag:true};else return{flag:false}};LiLian.prototype.upDateRole=function(){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var entity=EntityManager.ins().getMainRole(i);if(entity){var model=SubRoles.ins().getSubRoleByIndex(i);model.lilianLv=this.liLianLv;entity.setCharName(model.guildAndName);entity.setLilian(model.lilianUrl)}}};LiLian.prototype.postNobilityData=function(bytes){this.isXZShow=false;var level=bytes.readInt();var lvChange=this.nobilityLv!=level;this.nobilityLv=level;return{refush:lvChange}};LiLian.prototype.postTrainsDayAward=function(bytes){var b=bytes.readBoolean();this.getTraining=false;return b};LiLian.prototype.sendTrainsDayAward=function(index){var bytes=this.getBytes(3);bytes.writeInt(index);this.sendToServer(bytes)};LiLian.prototype.setXunzhangJF=function(value){if(this.xunzhangJF!=value){if(this.xunzhangJF>0){var u64=value-this.xunzhangJF;var addFeats=parseInt(u64.toString());if(addFeats>0){var str=i18n("LiLian_0")+addFeats+i18n("LiLian_1");UserTips.ins().showTips(str)}}this.xunzhangJF=value}};LiLian.prototype.getLiLianStast=function(){if(this.getLilianShenGongStast()){return true}if(this.getNobilityIsUpGrade()&&!this.getNobilityIsMaxLevel){return this.getNobilityIsUpGrade()}if(Artifact.ins().showRedPoint()){return true}if(UserTask.ins().getIsHaveChengjiuReward()){return true}if(this.checkJueWeiOpen()&&this.getNobilityIsUpGrade()&&!this.getNobilityIsMaxLevel()){return true}if(this.checkJadeRed())return true;return this.checkShowRedPoint2()};LiLian.prototype.checkJueWeiOpen=function(){var id=GlobalConfig.TrainBaseConfig.actImbaId;if(Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(id))){return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(id)).open}return false};LiLian.prototype.checkXunZhangOpen=function(){var id=GlobalConfig.KnighthoodBasicConfig.actImbaId;if(Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(id))){return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(id)).open}return false};LiLian.prototype.checkBookOpen=function(){return OpenSystem.ins().checkSysOpen(SystemType.BOOK)};LiLian.prototype.checkShowRedPoint2=function(){if(this.lilianReward<=0){return false}var data=GlobalConfig.GuanYinAwardConfig[this.lilianReward];return this.liLianLv>=data.level};LiLian.prototype.getLilianActiveState=function(){var id=GlobalConfig.TrainBaseConfig.actImbaId;if(Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(id))){return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(id)).open}return false};LiLian.prototype.getLilianShenGongStast=function(){if(!this.getLilianActiveState())return false;var config=GlobalConfig.TrainLevelConfig[this.liLianLv+1];if(config&&this.liLianExp>=config.exp){return true}return this.checkShowRedPoint2()};LiLian.prototype.getLilianBtnState=function(){if(!this.getLilianActiveState())return false;var config=GlobalConfig.TrainLevelConfig[this.liLianLv+1];if(config&&this.liLianExp>=config.exp){return true}return false};LiLian.prototype.getNobilityIsUpGrade=function(){var config=GlobalConfig.KnighthoodConfig[this.nobilityLv];for(var i=0;i<config.achievementIds.length;i++){var taskid=config.achievementIds[i].taskId;if(taskid>0){var data=UserTask.ins().getAchieveByTaskId(taskid);if(data){var cfg=UserTask.ins().getAchieveConfById(data.id);if(cfg.target>data.value){return false}}else{return false}}}return true};LiLian.prototype.getNobilityIsMaxLevel=function(){var config=GlobalConfig.KnighthoodConfig[this.nobilityLv+1];return config?false:true};LiLian.prototype.getAllChengjiuData=function(){if(this._achievementTaskAllConfig)return this._achievementTaskAllConfig;this._achievementTaskAllConfig=[];var configs=GlobalConfig.AchievementTaskConfig;for(var key in GlobalConfig.AchievementTaskConfig){if(configs[key].achievementType>0){this._achievementTaskAllConfig.push(configs[key])}}this._achievementTaskAllConfig.sort(LiLian.sort);return this._achievementTaskAllConfig};LiLian.sort=function(a,b){if(a.achievementType>b.achievementType)return 1;else if(a.achievementType<b.achievementType)return-1;else return 0};LiLian.prototype.getChengjiuData=function(type){var configArr=this.getAllChengjiuData();var reArr=[];for(var _i=0,configArr_3=configArr;_i<configArr_3.length;_i++){var config=configArr_3[_i];if(config.achievementType==type){reArr.push(config)}}return reArr};LiLian.prototype.chengjiuMaxData=function(){if(this._chengjiuMaxData)return this._chengjiuMaxData;this._chengjiuMaxData=[];var configArr=this.getAllChengjiuData();var tmpType=-1;for(var _i=0,configArr_4=configArr;_i<configArr_4.length;_i++){var config=configArr_4[_i];if(tmpType!=config.achievementType){tmpType=config.achievementType;this._chengjiuMaxData.push(tmpType)}}return this._chengjiuMaxData};LiLian.prototype.getPower=function(){var cfg=GlobalConfig.TrainLevelConfig[this.liLianLv];return cfg?cfg.power:0};LiLian.prototype.getCruLevelSkillCfg=function(isNext){if(isNext===void 0){isNext=false}var list=GlobalConfig.TrainLevelAwardConfig;if(this.skillCfgList.length<=0){for(var cfg in list){this.skillCfgList.push(list[cfg])}}var crucfg=null;for(var _i=0,_a=this.skillCfgList;_i<_a.length;_i++){var cfg=_a[_i];if(cfg.level>this.liLianLv){crucfg=cfg;break}}if(isNext){return crucfg}var id=crucfg?crucfg.id-1:0;return list[id]};LiLian.prototype.postGetLilianReward=function(sourceList){return sourceList};LiLian.prototype.getTrainDayAwardConfigs=function(openDay){var keys=Object.keys(GlobalConfig.TrainDayAwardConfig);keys.sort(this.setSortTrainAwards);for(var i=0;i<keys.length;i++){if(openDay>=Number(keys[i]))return GlobalConfig.TrainDayAwardConfig[keys[i]]}return null};LiLian.prototype.jadeUpgrade=function(){this.sendBaseProto(10)};LiLian.prototype.setSortTrainAwards=function(a,b){if(Number(a)>Number(b))return-1;else return 1};LiLian.prototype.isGetTrainDayAward=function(id){var config=this.getTrainDayAwardConfigs(GameServer.serverOpenDay+1);if(!config||!config[id])return false;if(this.liLianExpDayReward>>id&1){}else{if(this.liLianExpDay>=config[id].score){return true}else{}}return false};LiLian.prototype.isGetTrainDayAwardAll=function(){if(!this.getLilianActiveState())return false;var config=this.getTrainDayAwardConfigs(GameServer.serverOpenDay+1);if(!config)return false;for(var k in config){if(this.liLianExpDayReward>>+k&1){}else{if(this.liLianExpDay>=config[+k].score){return true}else{}}}return false};LiLian.prototype.postJadeLv=function(bytes){this.jadeLv=bytes.readInt()};LiLian.prototype.isJadeMax=function(){return this.jadeLv>=Object.keys(GlobalConfig.YuPeiConfig).length-1};LiLian.prototype.checkJadeRed=function(){return false;if(Actor.level<GlobalConfig.YuPeiBasicConfig.openLv)return false;if(this.isJadeMax())return false;var cfg=GlobalConfig.YuPeiConfig[this.jadeLv];if(cfg.item_id==undefined||cfg.item_id<=0)return true;var itemData=UserBag.ins().getBagItemById(cfg.item_id);if(itemData&&itemData.count>=cfg.count)return true;return false};return LiLian}(BaseSystem);__reflect(LiLian.prototype,"LiLian");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.lilian=LiLian.ins.bind(LiLian)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var WeiWangCC=function(_super){__extends(WeiWangCC,_super);function WeiWangCC(){var _this=_super.call(this)||this;_this._weiWangBack=0;_this.sysId=PackageID.WeiWang;_this.regNetMsg(1,_this.postWeiWangBack);return _this}WeiWangCC.ins=function(){return _super.ins.call(this)};WeiWangCC.prototype.postWeiWangBack=function(bytes){this._weiWangBack=bytes.readInt()};Object.defineProperty(WeiWangCC.prototype,"weiWangBack",{get:function(){return this._weiWangBack},enumerable:true,configurable:true});WeiWangCC.prototype.sendFindWeiWang=function(){this.sendBaseProto(2)};WeiWangCC.prototype.getWeiWangCfg=function(wei){var len=Object.keys(GlobalConfig.PrestigeLevel).length;for(var i=1;i<=len;i++){if(wei<GlobalConfig.PrestigeLevel[i].exp)return GlobalConfig.PrestigeLevel[i-1]}return GlobalConfig.PrestigeLevel[wei?len:1]};Object.defineProperty(WeiWangCC.prototype,"isOpen",{get:function(){return Actor.level<GlobalConfig.PrestigeBase.openLevel||GameServer.serverOpenDay<GlobalConfig.PrestigeBase.openDay-1?false:true},enumerable:true,configurable:true});return WeiWangCC}(BaseSystem);__reflect(WeiWangCC.prototype,"WeiWangCC");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.weiWang=WeiWangCC.ins.bind(WeiWangCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ChengjiuPanel=function(_super){__extends(ChengjiuPanel,_super);function ChengjiuPanel(){var _this=_super.call(this)||this;_this._chengjiuData=[];_this.skinName="ChengjiuPanelSkin";_this.name=i18n("ChengjiuPanel_0");return _this}ChengjiuPanel.prototype.createChildren=function(){_super.prototype.createChildren.call(this);this.list.itemRenderer=ChengjiuItem;this.list.dataProvider=this.listArrColl=new eui.ArrayCollection;this.tab.itemRenderer=ChengjiuTagItem;this.tabArrColl=new eui.ArrayCollection(LiLian.ins().chengjiuMaxData());this.tab.dataProvider=this.tabArrColl;this.tab.visible=false};ChengjiuPanel.prototype.open=function(){this.addTouchEvent(this.list,this.onTab);this.addChangeEvent(this.tab,this.onTabChange);this.observe(UserTask.ins().postTaskChangeData,this.updateAchieve);this.tab.visible=true;this.tab.selectedIndex=0;this.updateAchieve()};ChengjiuPanel.prototype.close=function(){this.removeTouchEvent(this.list,this.onTab);this.removeObserve()};ChengjiuPanel.prototype.onTab=function(e){if(!(e.target instanceof eui.Button))return;var item=e.target.parent;switch(item.btn.labelDisplay.text){case i18n("ChengjiuPanel_1"):GameGuider.taskGuidance(item.id,1);break;case i18n("ChengjiuPanel_2"):UserTask.ins().sendGetAchieve(item.achievementId);break}};ChengjiuPanel.prototype.onTabChange=function(evt){this.listArrColl.source=UserTask.ins().getChengjiuDataByType(this.tab.selectedItem)};ChengjiuPanel.prototype.updateAchieve=function(){this.tabArrColl.replaceAll(LiLian.ins().chengjiuMaxData());this.nextCanTab(this.tab.selectedItem);this.listArrColl.source=UserTask.ins().getChengjiuDataByType(this.tab.selectedItem)};ChengjiuPanel.prototype.nextCanTab=function(type){if(!this.canReceive(type)){var curTabImdex=this.tab.selectedIndex;for(var i=0,tabNum=this.tab.numChildren;i<tabNum;i++){this.tab.selectedIndex=i;if(this.canReceive(this.tab.selectedItem))return}this.tab.selectedIndex=curTabImdex}};ChengjiuPanel.prototype.canReceive=function(type){var listData=UserTask.ins().getChengjiuDataByType(type);for(var i in listData){if(listData[i].state==1)return true}return false};return ChengjiuPanel}(BaseView);__reflect(ChengjiuPanel.prototype,"ChengjiuPanel");var ChengjiuTagItem=function(_super){__extends(ChengjiuTagItem,_super);function ChengjiuTagItem(){var _this=_super.call(this)||this;_this.skinName="ChengjiuTagSkin";return _this}ChengjiuTagItem.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);this.nameImg.source="task_json.name_"+this.data;this.redPoint.visible=UserTask.ins().getIsHaveChengjiuRewardBytype(this.data)};return ChengjiuTagItem}(BaseItemRender);__reflect(ChengjiuTagItem.prototype,"ChengjiuTagItem");var ChengjiuItem=function(_super){__extends(ChengjiuItem,_super);function ChengjiuItem(){var _this=_super.call(this)||this;_this.skinName="ChengjiuItemSkin";_this.mc=_this.mc||new MovieClip;_this.mc.x=_this.btn.x+46;_this.mc.y=_this.btn.y+45;_this.mc.scaleY=.8;_this.mc.scaleX=.9;_this.list.itemRenderer=ItemBase;return _this}ChengjiuItem.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var achieveConf=UserTask.ins().getAchieveConfById(this.data.id);this.id=this.data.id;this.achievementId=this.data.achievementId;this.list.dataProvider=new eui.ArrayCollection(achieveConf.awardList);this.titleTF.textFlow=TextFlowMaker.generateTextFlow(achieveConf.name);var str=i18n("ChengjiuPanel_4",CommonUtils.overLengthChange(this.data.value),CommonUtils.overLengthChange(achieveConf.target));this.progressTF.textFlow=TextFlowMaker.generateTextFlow(str);this.btn.visible=true;if(this.mc&&this.mc.parent){DisplayUtils.removeFromParent(this.mc)}switch(this.data.state){case 0:this.btn.labelDisplay.text=i18n("ChengjiuPanel_5");this.btn.enabled=true;if(achieveConf.control==0){this.btn.visible=false}break;case 1:this.btn.labelDisplay.text=i18n("ChengjiuPanel_6");this.btn.enabled=true;if(this.mc){this.mc.playFile(RES_DIR_EFF+"normalbtn",-1);this.addChild(this.mc)}break;case 2:this.btn.labelDisplay.text=i18n("ChengjiuPanel_7");this.btn.enabled=false;break}};return ChengjiuItem}(BaseItemRender);__reflect(ChengjiuItem.prototype,"ChengjiuItem");var JadeItem=function(_super){__extends(JadeItem,_super);function JadeItem(){var _this=_super.call(this)||this;_this.perLevel=11;_this._oldLevel=-1;_this._oldJade=0;_this._mcList=[];return _this}JadeItem.prototype.setLevel=function(level,showFire){var _this=this;if(level==this._oldLevel)return;this._oldLevel=level;var jade=Math.floor(level/(this.perLevel*9));var phase=(Math.floor(level/this.perLevel)+1)%9;this.skinName="YuPei"+jade+"Skin";if(phase==0)phase=9;if(this._nexMc&&this._nexMc.parent)this._nexMc.parent.removeChild(this._nexMc);var mc;var showNext;for(var i=1;i<=9;i++){mc=this._mcList[i-1];if(mc&&mc.parent)mc.parent.removeChild(mc);if(this._oldJade!=jade&&mc)mc.stop();if(i>1)this["line"+(i-2)].visible=false;showNext=false;if(i<=phase){if(i<phase||level%this.perLevel==10){if(!mc){mc=new MovieClip;this._mcList[i-1]=mc}this["processEff"+(i-1)].addChild(mc);if(i==phase&&showFire){if(!mc.isPlaying){var t=egret.Tween.get(this);mc.playFile(RES_DIR_EFF+"bally3",1,null,false);t.wait(800).call(function(){_this._mcList[phase-1].playFile(RES_DIR_EFF+"ballb2",-1)})}}else if(!mc.isPlaying)mc.playFile(RES_DIR_EFF+"ballb2",-1);if(i>1)this["line"+(i-2)].visible=true}else showNext=true}else showNext=!this._nexMc||!this._nexMc.parent;if(showNext){if(!this._nexMc)this._nexMc=new MovieClip;this["processEff"+(i-1)].addChild(this._nexMc);if(!this._nexMc.isPlaying)this._nexMc.playFile(RES_DIR_EFF+"ballb1",-1);if(i>1)this["line"+(i-2)].visible=true}}this._oldJade=jade};JadeItem.prototype.close=function(){_super.prototype.close.call(this);Tween.removeTweens(this);var len=this._mcList.length;for(var i=0;i<len;i++){this._mcList[i].dispose();this._mcList[i]=null}this._mcList.length=0;this._mcList=null;if(this._nexMc){this._nexMc.dispose();this._nexMc=null}};return JadeItem}(BaseComponent);__reflect(JadeItem.prototype,"JadeItem");var JadePanel=function(_super){__extends(JadePanel,_super);function JadePanel(){var _this=_super.call(this)||this;_this._starList=null;_this._oldLevel=0;_this.isTopLevel=true;return _this}JadePanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this._starList=new StarList(10);this._starList.x=15;this._starList.y=0;this.starGroup.addChild(this._starList);this._iconY=this.yupei.y;this._iconMoveY=this.yupei.y-10};JadePanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._oldLevel=LiLian.ins().jadeLv;this.observe(LiLian.ins().postJadeLv,this.update);this.observe(UserBag.ins().postItemAdd,this.updateMaterial);this.observe(UserBag.ins().postItemChange,this.updateMaterial);this.addTouchEvent(this,this.onTouch);this.update();this.playIconTween()};JadePanel.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this,this.onTouch);this.stopIconTween()};JadePanel.prototype.playIconTween=function(){this.yupei.y=this._iconY;egret.Tween.removeTweens(this.yupei);egret.Tween.get(this.yupei,{loop:true}).to({y:this._iconMoveY},1e3).to({y:this._iconY},1e3)};JadePanel.prototype.stopIconTween=function(){egret.Tween.removeTweens(this.yupei)};JadePanel.prototype.update=function(){var level=LiLian.ins().jadeLv;var objAtts=[];var cfg=GlobalConfig.YuPeiConfig[level];var per=0;var attr;for(var k in cfg.attrs){attr=cfg.attrs[k];if(attr.type==AttributeType.atYuPeiDeterDam)per=Math.floor(attr.value/1e4*100);objAtts.push(new AttributeData(attr.type,attr.value))}this.powerPanel.setPower(UserBag.getAttrPower(objAtts));var phase=Math.floor(level/GlobalConfig.YuPeiBasicConfig.perLevel)+1;this.stairImg.setValue(phase);var isMax=LiLian.ins().isJadeMax();var isUpgrade;if(isMax){this.maxGroup.visible=false;this.maxLevel.visible=this.maxShowGroup.visible=true;this.maxCurAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："))}else{this.maxGroup.visible=true;isUpgrade=this._oldLevel!=level;this._starList.setStarNum(level%GlobalConfig.YuPeiBasicConfig.perLevel,isUpgrade?1:0);this._oldLevel=level;this.updateMaterial();this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："));objAtts=[];var nextCfg=GlobalConfig.YuPeiConfig[level+1];for(var k in nextCfg.attrs)objAtts.push(new AttributeData(nextCfg.attrs[k].type,nextCfg.attrs[k].value));this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："))}this.yupei.setLevel(level,isUpgrade&&level%GlobalConfig.YuPeiBasicConfig.perLevel==10)};JadePanel.prototype.updateMaterial=function(){var isMax=LiLian.ins().isJadeMax();if(isMax)return;var level=LiLian.ins().jadeLv;var str="";this._materialEn=true;var cfg=GlobalConfig.YuPeiConfig[level];if(cfg.item_id>0){var item=GlobalConfig.ItemConfig[cfg.item_id];var itemData=UserBag.ins().getBagItemById(cfg.item_id);var count=itemData?itemData.count:0;str=i18n("JadePanel_0")+item.name+i18n("JadePanel_4")+(count<cfg.count?"0xFF0000":"0x00FF00")+"&T:"+count+"|/"+cfg.count;this._materialEn=count>=cfg.count}this.material.textFlow=TextFlowMaker.generateTextFlow1(str);this.redPoint.visible=LiLian.ins().checkJadeRed();this.upgradeBtn.label=this._materialEn?level%GlobalConfig.YuPeiBasicConfig.perLevel==10?i18n("JadePanel_1"):i18n("JadePanel_2"):i18n("JadePanel_3");this.upgradeBtn.visible=!isMax};JadePanel.prototype.onTouch=function(e){switch(e.target){case this.upgradeBtn:if(!this._materialEn){UserWarn.ins().setBuyGoodsWarn(GlobalConfig.YuPeiConfig[LiLian.ins().jadeLv].item_id);return}LiLian.ins().jadeUpgrade();break;case this.closeBtn:ViewManager.ins().close(LiLianWin);break;case this.deter:ViewManager.ins().open(JadeSkillWin);break}};return JadePanel}(BaseEuiView);__reflect(JadePanel.prototype,"JadePanel");var JadeSkillWin=function(_super){__extends(JadeSkillWin,_super);function JadeSkillWin(){var _this=_super.call(this)||this;_this.skinName="YupeiSkillTipsSkin";return _this}JadeSkillWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);var cfg=GlobalConfig.YuPeiConfig[LiLian.ins().jadeLv];var per="0";for(var k in cfg.attrs){if(cfg.attrs[k].type==AttributeType.atYuPeiDeterDam){per=(cfg.attrs[k].value/100).toFixed(1);break}}this.content.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.YuPeiBasicConfig.deterDesc.replace("{0}",per+"%"))};JadeSkillWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose)};JadeSkillWin.prototype.onClose=function(e){ViewManager.ins().close(this)};return JadeSkillWin}(BaseEuiView);__reflect(JadeSkillWin.prototype,"JadeSkillWin");ViewManager.ins().reg(JadeSkillWin,LayerManager.UI_Main);var LiLianItem=function(_super){__extends(LiLianItem,_super);function LiLianItem(){var _this=_super.call(this)||this;_this.skinName="LiLianItemSkin";_this.isClose=false;_this.goOnTxt.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+_this.goOnTxt.text+"</u></a>");_this.goOnTxt.touchEnabled=true;return _this}LiLianItem.prototype.dataChanged=function(){var data=this.data;if(data){var config=GlobalConfig.DailyConfig[data.id];this.nameTxt.text=config.name;var interval=config.interval||1;this.descTxt.textFlow=TextFlowMaker.generateTextFlow(i18n("LiLianItem_1")+Math.floor(data.value/interval)+"/"+Math.floor(config.target/interval)+"|");this.liLianNumTxt.text=config.trainExp+i18n("LiLianItem_0");if(data.state>0){this.sureImg.visible=true;this.goOnTxt.visible=false}else{this.sureImg.visible=false;this.goOnTxt.visible=true}if(data.id==1||data.id==3||data.id==4||data.id==5||data.id==6||data.id==7||data.id==8||data.id==9||data.id==10){this.isClose=true}}};return LiLianItem}(BaseItemRender);__reflect(LiLianItem.prototype,"LiLianItem");var LiLianTips=function(_super){__extends(LiLianTips,_super);function LiLianTips(){return _super!==null&&_super.apply(this,arguments)||this}LiLianTips.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="LiLianTipsSkin";this.isTopLevel=true};LiLianTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.setPanel()};LiLianTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeObserve()};LiLianTips.prototype.setPanel=function(){var config=LiLian.ins().getCruLevelSkillCfg();var nextConfig=LiLian.ins().getCruLevelSkillCfg(true);if(config){this.skillIcon.source=config.icon+"";this.skillName.text=config.skillname;this.cruDesc.textFlow=TextFlowMaker.generateTextFlow(config.desc);var levelConfig=GlobalConfig.TrainLevelConfig[config.level];var str="·"+levelConfig.trainName;this.currTrainName.textFlow=TextFlowMaker.generateTextFlow(str)}if(nextConfig){this.nextDesc.textFlow=TextFlowMaker.generateTextFlow(nextConfig.desc);var nextLevelConfig=GlobalConfig.TrainLevelConfig[nextConfig.level];var str1="·"+nextLevelConfig.trainName;this.nextTrainName.textFlow=TextFlowMaker.generateTextFlow(str1)}else{this.nextDesc.text=""}};LiLianTips.prototype.onTap=function(e){ViewManager.ins().close(LiLianTips)};return LiLianTips}(BaseEuiView);__reflect(LiLianTips.prototype,"LiLianTips");ViewManager.ins().reg(LiLianTips,LayerManager.UI_Popup);var LiLianWin=function(_super){__extends(LiLianWin,_super);function LiLianWin(){var _this=_super.call(this)||this;_this.oldIndex=LiLianWin.JUEWEI;_this.skinName="LiLianWinSkin";_this.isTopLevel=true;return _this}LiLianWin.prototype.initUI=function(){_super.prototype.initUI.call(this);var index=LiLianWin.JUEWEI;if(!LiLian.ins().checkJueWeiOpen()){index=LiLianWin.SHENQI}this.viewStack.selectedIndex=index;this.tab.dataProvider=this.viewStack;this.tab.validateNow()};LiLianWin.prototype.destoryView=function(){_super.prototype.destoryView.call(this)};LiLianWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var selectedIndex=param[0]==undefined?LiLianWin.SHENQI:param[0];switch(selectedIndex){case LiLianWin.SHENQI:break;case LiLianWin.JUEWEI:if(!LiLian.ins().checkJueWeiOpen()){UserTips.ins().showTips(i18n("LiLianWin_0"));return false}break;case LiLianWin.XUNZHANG:if(!LiLian.ins().checkXunZhangOpen()){UserTips.ins().showTips(i18n("LiLianWin_1"));return false}break;case LiLianWin.BOOK:if(!LiLian.ins().checkBookOpen()){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOOK));return false}break;case LiLianWin.WEIWANG:if(!WeiWangCC.ins().isOpen){UserTips.ins().showTips(i18n("LiLianWin_4",GlobalConfig.PrestigeBase.openDay,GlobalConfig.PrestigeBase.openLevel));return false}break}return true};LiLianWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTapTouching);this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.help,this.onTouch);this.observe(LiLian.ins().postLilianData,this.delayRedPoint);this.observe(LiLian.ins().postNobilityData,this.delayRedPoint);this.observe(UserTask.ins().postTaskChangeData,this.delayRedPoint);this.observe(Artifact.ins().postNewArtifactUpdate,this.delayRedPoint);this.observe(Artifact.ins().postNewArtifactInit,this.delayRedPoint);this.observe(BookRedPoint.ins().postRedPoint,this.delayRedPoint);this.observe(BookRedPoint.ins().postLvlUp,this.delayRedPoint);this.observe(Box.ins().postUpdateData,this.delayRedPoint);this.observe(Box.ins().postUpdateFreeBox,this.delayRedPoint);this.observe(LiLian.ins().postJadeLv,this.delayRedPoint);this.observe(UserBag.ins().postItemAdd,this.delayRedPoint);this.observe(UserBag.ins().postItemChange,this.delayRedPoint);var index=LiLianWin.JUEWEI;if(!LiLian.ins().checkJueWeiOpen()){index=LiLianWin.SHENQI}if(param[0]){index=param[0]}this._ext=param[1];this.help.visible=false;this.setOpenTabIndex(index)};LiLianWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var num=this.viewStack.numChildren;for(var i=0;i<num;i++){this.viewStack.getChildAt(i).close()}var uiview2=ViewManager.ins().getView(UIView2);if(uiview2)uiview2.closeNav(UIView2.NAV_LILIAN)};LiLianWin.prototype.setOpenTabIndex=function(index){this.tab.selectedIndex=this.viewStack.selectedIndex=index;this.setOpenIndex(index);this.setRedPoint()};LiLianWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.help:break}};LiLianWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex)};LiLianWin.prototype.setOpenIndex=function(selectedIndex){var id=0;switch(selectedIndex){case LiLianWin.SHENQI:this.artifactWin.open();break;case LiLianWin.JUEWEI:if(LiLian.ins().checkJueWeiOpen()){this.liLianPanel.open()}else{UserTips.ins().showTips(i18n("LiLianWin_5"));this.tab.selectedIndex=this.oldIndex}break;case LiLianWin.XUNZHANG:if(LiLian.ins().checkXunZhangOpen()){this.xunzhangPanel.open()}else{UserTips.ins().showTips(i18n("LiLianWin_6"));this.tab.selectedIndex=this.oldIndex}break;case LiLianWin.BOOK:if(LiLian.ins().checkBookOpen()){if(this._ext){this.bookPanel.open(this._ext);this._ext=null}else{this.bookPanel.open()}}else{UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOOK));this.tab.selectedIndex=this.oldIndex}break;case LiLianWin.WEIWANG:if(WeiWangCC.ins().isOpen)this.WeiWang.open();else{UserTips.ins().showTips(i18n("LiLianWin_9",GlobalConfig.PrestigeBase.openDay,GlobalConfig.PrestigeBase.openLevel));this.tab.selectedIndex=this.oldIndex}break}this.oldIndex=this.tab.selectedIndex};LiLianWin.prototype.delayRedPoint=function(){if(!TimerManager.ins().isExists(this.setRedPoint,this))TimerManager.ins().doTimer(60,1,this.setRedPoint,this)};LiLianWin.prototype.setRedPoint=function(){var lilian=LiLian.ins();this.redPoint0.visible=Artifact.ins().showRedPoint();this.redPoint1.visible=lilian.getLilianShenGongStast()||lilian.isGetTrainDayAwardAll();var isMaxLevel=LiLian.ins().getNobilityIsMaxLevel();this.redPoint2.visible=lilian.checkXunZhangOpen()&&lilian.getNobilityIsUpGrade()&&!isMaxLevel;this.redPoint3.visible=BookRedPoint.ins().redpoint||BookRedPoint.ins().canLvlUp;this.redPoint4.visible=false};LiLianWin.prototype.onTapTouching=function(e){if(!LiLianWin.openCheck(e.currentTarget.selectedIndex)){e.preventDefault();return}ViewManager.ins().close(LimitTaskView)};LiLianWin.SHENQI=1;LiLianWin.JUEWEI=0;LiLianWin.XUNZHANG=2;LiLianWin.BOOK=3;LiLianWin.WEIWANG=4;return LiLianWin}(BaseEuiView);__reflect(LiLianWin.prototype,"LiLianWin");ViewManager.ins().reg(LiLianWin,LayerManager.UI_Main);var NewLilianWin=function(_super){__extends(NewLilianWin,_super);function NewLilianWin(){var _this=_super.call(this)||this;_this.barbc=new ProgressBarEff;_this.name=i18n("NewLilianWin_0");_this.isTopLevel=true;return _this}NewLilianWin.prototype.childrenCreated=function(){this.list.itemRenderer=LiLianItem;this.itemList.itemRenderer=ItemBase;this.barbc.setWidth(525);this.barbc.x=3;this.barbc.y=-15;this.expGroup.addChild(this.barbc);this.eff=new MovieClip;this.eff.x=476;this.eff.y=51;this.eff.scaleX=.85;this.eff.scaleY=.8;this.eff.touchEnabled=false;this.item4.isShowName(false);this.trainMc={}};NewLilianWin.prototype.open=function(){this.addTouchEvent(this.list,this.onListTouch);this.addTouchEvent(this.upgradeBtn,this.onUpgrade);this.addTouchEvent(this.UplevelBtn0,this.onActive);this.addTouchEvent(this.reward,this.sendGetReward);this.observe(UserTask.ins().postTaskChangeData,this.setWinData);this.observe(LiLian.ins().postLilianData,this.onListChange);this.observe(LiLian.ins().postTrainsDayAward,this.updateProgress);for(var i=1;i<=4;i++){this.addTouchEvent(this["isget"+i],this.onGiftClick)}this.barbc.reset();this.setWinData();this.showActPanel();this.activeTipsTxt0.text=i18n("NewLilianWin_1")};NewLilianWin.prototype.close=function(){this.removeTouchEvent(this.list,this.onListTouch);this.removeTouchEvent(this.upgradeBtn,this.onUpgrade);this.removeTouchEvent(this.UplevelBtn0,this.onActive);this.removeTouchEvent(this.reward,this.sendGetReward);DisplayUtils.removeFromParent(this.eff);for(var i in this.trainMc){DisplayUtils.removeFromParent(this.trainMc[i])}for(var i=1;i<=4;i++){this.removeTouchEvent(this["isget"+i],this.onGiftClick)}};NewLilianWin.prototype.sendGetReward=function(){if(UserBag.ins().getSurplusCount()>=1){LiLian.ins().sendGetLilianReward()}else UserTips.ins().showTips(i18n("NewLilianWin_2"))};NewLilianWin.prototype.showActPanel=function(){this.Activation.visible=false;this.showAct.visible=!this.Activation.visible};NewLilianWin.prototype.onActive=function(e){switch(e.currentTarget){case this.UplevelBtn0:if(!LiLian.ins().getLilianActiveState()){UserTips.ins().showTips(i18n("NewLilianWin_3"));e.$cancelable=true;e.preventDefault()}break}};NewLilianWin.prototype.onGiftClick=function(e){for(var i=1;i<=4;i++){if(e.currentTarget==this["isget"+i]){var itemicon=this["gift"+i].getItemIcon();LiLian.ins().getTraining=true;this.flyItem(itemicon);LiLian.ins().sendTrainsDayAward(i);break}}};NewLilianWin.prototype.flyItem=function(itemicon){var flyItem=new eui.Image(itemicon.imgIcon.source);flyItem.x=itemicon.imgIcon.x;flyItem.y=itemicon.imgIcon.y;flyItem.width=itemicon.imgIcon.width;flyItem.height=itemicon.imgIcon.height;flyItem.scaleX=itemicon.imgIcon.scaleX;flyItem.scaleY=itemicon.imgIcon.scaleY;itemicon.imgIcon.parent.addChild(flyItem);GameLogic.ins().postFlyItemEx(flyItem)};NewLilianWin.prototype.onUpgrade=function(e){var config=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv+1];if(!config)return;var exp=LiLian.ins().liLianExp;if(exp>=config.exp){LiLian.ins().sendLilianUpgrade()}else{UserTips.ins().showTips(i18n("NewLilianWin_4"))}};NewLilianWin.prototype.onSeeSkill=function(e){ViewManager.ins().open(LiLianTips)};NewLilianWin.prototype.onListTouch=function(e){if(e.target instanceof eui.Label){var item=e.target.parent;if(!item.isClose){ViewManager.ins().close(LiLianWin)}FbWin.isClose=item.isClose;GameGuider.taskGuidance(item.data.id,0);ViewManager.ins().close(LimitTaskView)}};NewLilianWin.prototype.onListChange=function(map){var flag=map.flag;if(flag){this.lilianUpgradeSuccess();this.setWinData()}this.showActPanel();if(LiLian.ins().isShow){var config=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv+1];var img="juewei"+"_"+config.type+"_1";RewardWin.showAct(0,config.trainName,img+"_png")}};NewLilianWin.prototype.setWinData=function(){var lv=LiLian.ins().liLianLv;this._totalPower=LiLian.ins().getPower();this.powerPanel.setPower(this._totalPower);var config=GlobalConfig.TrainLevelConfig[lv];if(ErrorLog.Assert(config,"LiLianPanel  config is null  lv = "+lv)){return}var imgType=config.type>14?14:config.type;this.imgMedal.source="juewei_1_"+imgType+"_png";this.levelImg.source=config.img?config.img:"juewei_0_"+imgType+"_png";this.levelLabel.text=i18n("NewLilianWin_5",config.trainlevel);var skillcfg=LiLian.ins().getCruLevelSkillCfg();this.attrTxt.text=AttributeData.getAttStr(config.attrAward,0,1,"：");var nextConfig=GlobalConfig.TrainLevelConfig[lv+1];if(nextConfig){var str="";for(var i=0;i<nextConfig.attrAward.length;i++){str+=nextConfig.attrAward[i].value;if(i<nextConfig.attrAward.length-1)str+="\n"}this.nextTxt.text=str;this.itemList.dataProvider=new eui.ArrayCollection(nextConfig.itemAward);this.currentState="nomax";var tempStr=config.trainlevel==1?nextConfig.trainName:"";this.levelLabel0.text=i18n("NewLilianWin_6",nextConfig.trainlevel,tempStr)}else{this.currentState="max";this.itemList.dataProvider=new eui.ArrayCollection([])}this.expChange();var taskList=UserTask.ins().task;this.list.dataProvider=new eui.ArrayCollection(taskList);this.list.validateNow();this.addRewardRefush();this.updateProgress()};NewLilianWin.prototype.addRewardRefush=function(){if(LiLian.ins().lilianReward>0){this.addReward.visible=true;var liliangReward=LiLian.ins().lilianReward;var tlac=GlobalConfig.GuanYinAwardConfig;var data=tlac[liliangReward];if(Assert(data,i18n("NewLilianWin_7"))){return}var itemData=new ItemData;itemData.configID=data.award.id;this.item4.data=itemData;this.reward.visible=this.reward.enabled=LiLian.ins().checkShowRedPoint2();this.tipsGroup.visible=!this.reward.visible;this.targetLevel.text=data.level-LiLian.ins().liLianLv+""}else{this.addReward.visible=false;this.reward.enabled=false;this.tipsGroup.visible=false}};NewLilianWin.prototype.expChange=function(){var config=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv+1];if(!config)config=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv];var maxExp=config.exp;var exp=LiLian.ins().liLianExp;var boo=exp>=maxExp;if(boo){this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.eff.parent)this.upInfo.addChild(this.eff)}else{DisplayUtils.removeFromParent(this.eff)}this.barbc.setData(exp,maxExp);this.redPoint.visible=LiLian.ins().getLilianBtnState();this.redPoint0.visible=LiLian.ins().checkShowRedPoint2()};NewLilianWin.prototype.lilianUpgradeSuccess=function(){var len=this.itemList.dataProvider.length;var resource=[];for(var i=0;i<len;i++){var item=this.itemList.getVirtualElementAt(i);resource.push(item.getItemSoure())}LiLian.ins().postGetLilianReward(resource)};NewLilianWin.prototype.updateProgress=function(){var train=LiLian.ins().getTrainDayAwardConfigs(GameServer.serverOpenDay+1);if(train){this.lilianed.text=LiLian.ins().liLianExpDay+"";for(var i in train){var config=train[i];if(config){this["lilian"+i].text=i18n("NewLilianWin_8",config.score);var cfg=GlobalConfig.ItemConfig[config.reward[0].id];this["gift"+i].data={id:config.reward[0].id,type:config.reward[0].type,count:config.reward[0].count};this["gift"+i].isShowName(false);this["bar"+i].maximum=100;this["lingqu"+i].touchEnabled=false;if(LiLian.ins().liLianExpDayReward>>config.id&1){this["bar"+i].value=100;this["lingqu"+i].visible=true;this["isget"+i].touchEnabled=false}else{this["lingqu"+i].visible=false;if(LiLian.ins().liLianExpDay>=config.score){this["bar"+i].value=100;this["isget"+i].touchEnabled=true}else{var preconfig=train[Number(i)-1];var expday=LiLian.ins().liLianExpDay;var totalscore=config.score;if(preconfig){expday=LiLian.ins().liLianExpDay-preconfig.score;totalscore=config.score-preconfig.score}expday=expday>0?expday:0;this["bar"+i].value=Math.floor(expday/totalscore*100);this["isget"+i].touchEnabled=false}}this.updateTrainEff(config.id)}}}};NewLilianWin.prototype.updateTrainEff=function(id){if(!this.trainMc[id])this.trainMc[id]=new MovieClip;var b=LiLian.ins().isGetTrainDayAward(id);this["redPoint"+id].visible=b;if(b){if(!this.trainMc[id].parent){this["eff"+id].parent.addChild(this.trainMc[id]);this.trainMc[id].playFile(RES_DIR_EFF+"openRole1",-1);this.trainMc[id].x=this["eff"+id].x;this.trainMc[id].y=this["eff"+id].y}}else{DisplayUtils.removeFromParent(this.trainMc[id])}};return NewLilianWin}(BaseEuiView);__reflect(NewLilianWin.prototype,"NewLilianWin");ViewManager.ins().reg(NewLilianWin,LayerManager.UI_Popup);var NobilityItem=function(_super){__extends(NobilityItem,_super);function NobilityItem(){var _this=_super.call(this)||this;_this.skinName="NobilityItemSkin";_this.goOnTxt.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+_this.goOnTxt.text+"</u></a>");_this.goOnTxt.touchEnabled=true;return _this}NobilityItem.prototype.dataChanged=function(){var data=this.data;if(data){var config=UserTask.ins().getAchieveConfById(data.id);var str=config.name+i18n("NobilityItem_0")+data.value+"/"+config.target+")|";this.nameTxt.textFlow=TextFlowMaker.generateTextFlow(str);if(data.state>0){this.sureImg.visible=true;this.goOnTxt.visible=false}else{this.sureImg.visible=false;this.goOnTxt.visible=Boolean(config.control)}}};return NobilityItem}(BaseItemRender);__reflect(NobilityItem.prototype,"NobilityItem");var NobilityPanel=function(_super){__extends(NobilityPanel,_super);function NobilityPanel(){var _this=_super.call(this)||this;_this._totalPower=0;_this.skinName="NobilitySkin";_this.name=i18n("NobilityPanel_0");return _this}NobilityPanel.prototype.childrenCreated=function(){this.list.itemRenderer=NobilityItem;this.totalPower=BitmapNumber.ins().createNumPic(0,"1");this.totalPower.x=182;this.totalPower.y=63;this.addChild(this.totalPower);this.promoteeff=new MovieClip;this.promoteeff.x=214;this.promoteeff.y=260};NobilityPanel.prototype.open=function(){this.addTouchEvent(this.list,this.onListTouch);this.addTouchEvent(this.sureBtn,this.onUpgrade);this.observe(UserTask.ins().postTaskChangeData,this.setData);this.observe(LiLian.ins().postNobilityData,this.setData);this.setData()};NobilityPanel.prototype.close=function(){this.removeTouchEvent(this.list,this.onListTouch);this.removeTouchEvent(this.sureBtn,this.onUpgrade);this.removeObserve()};NobilityPanel.prototype.onListTouch=function(e){if(e.target instanceof eui.Label){var item=e.target.parent;GameGuider.taskGuidance(item.data.id,1)}};NobilityPanel.prototype.onUpgrade=function(e){if(LiLian.ins().getNobilityIsUpGrade())LiLian.ins().sendNobilityUpgrade();else UserTips.ins().showTips(i18n("NobilityPanel_1"))};NobilityPanel.prototype.setData=function(){var lv=LiLian.ins().nobilityLv;lv>=0&&lv!=null?lv:lv=0;var config=GlobalConfig.KnighthoodConfig[lv];this.lvTxt.text=config.desc;this.attrTxt.text=AttributeData.getAttStr(config.attrs,0,1,"：");var power=UserBag.getAttrPower(config.attrs);if(power>this._totalPower&&this._totalPower>0)this.playEff();this._totalPower=power;BitmapNumber.ins().changeNum(this.totalPower,this._totalPower*SubRoles.ins().subRolesLen,"1");var list=[];for(var i=0;i<config.achievementIds.length;i++){list.push(UserTask.ins().getAchieveByTaskId(config.achievementIds[i]["taskId"]))}this.list.dataProvider=new eui.ArrayCollection(list);var nextConfig=GlobalConfig.KnighthoodConfig[lv+1];if(nextConfig){this.nextAttrTxt.text=AttributeData.getAttStr(nextConfig.attrs,0,1,"：");if(LiLian.ins().getNobilityIsUpGrade()){this.mc=this.mc||new MovieClip;this.mc.x=215;this.mc.y=507;this.mc.playFile(RES_DIR_EFF+"normalbtn",-1);this.addChild(this.mc)}else{if(this.mc){DisplayUtils.removeFromParent(this.mc)}}}else{if(this.mc){DisplayUtils.removeFromParent(this.mc)}this.nextGroup.visible=false;this.lvTxt.horizontalCenter=0;this.attrTitleTxt.horizontalCenter=0;this.attrTxt.horizontalCenter=0;this.completely.visible=true}};NobilityPanel.prototype.playEff=function(){this.promoteeff.playFile(RES_DIR_EFF+"promoteeff",1);this.addChild(this.promoteeff)};return NobilityPanel}(BaseView);__reflect(NobilityPanel.prototype,"NobilityPanel");var XunzhangPanel=function(_super){__extends(XunzhangPanel,_super);function XunzhangPanel(){var _this=_super.call(this)||this;_this.lastEffId=0;_this.name=i18n("XunzhangPanel_0");return _this}XunzhangPanel.prototype.childrenCreated=function(){this.initUI()};XunzhangPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.starList=new StarList(10,0,60);this.starList.x=-5;this.starList.y=-40;this.starList.scaleX=.7;this.starList.scaleY=.7;this.eff=new MovieClip;this.eff.scaleX=1;this.eff.scaleY=1;this.eff.touchEnabled=false;this.taskList.itemRenderer=XunZhangTaskItemRenderer;this.XunzhangEff=new MovieClip;this.xunzhangMcGroup.addChild(this.XunzhangEff)};XunzhangPanel.prototype.open=function(){this.group.addChild(this.starList);this.addTouchEvent(this.btn,this.onTab);this.addTouchEvent(this.UplevelBtn1,this.onTab);this.observe(LiLian.ins().postNobilityData,this.update);this.observe(UserTask.ins().postTaskChangeData,this.setTaskList);this.taskList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListTouch,this);this.update()};XunzhangPanel.prototype.close=function(){this.removeTouchEvent(this.btn,this.onTab);this.removeObserve();this.taskList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onListTouch,this);DisplayUtils.removeFromParent(this.eff);TimerManager.ins().removeAll(this)};XunzhangPanel.prototype.onListTouch=function(e){var item=e.target.parent;if(item.data){GameGuider.taskGuidance(item.data.id,1)}};XunzhangPanel.prototype.onTab=function(evt){switch(evt.currentTarget){case this.btn:this.onBtnDeal();break}};XunzhangPanel.prototype.onBtnDeal=function(){if(LiLian.ins().getNobilityIsUpGrade()){LiLian.ins().sendNobilityUpgrade()}else{UserTips.ins().showTips(i18n("XunzhangPanel_1"))}};XunzhangPanel.prototype.setTaskList=function(){var lv=LiLian.ins().nobilityLv;var config=GlobalConfig.KnighthoodConfig[lv];this.nameTF.text=config.type;if(this.lastEffId!=config.effid){if(!GlobalConfig.DefineEff[config.effid]){egret.log(config.effid+i18n("XunzhangPanel_2"));return}var effSoure=GlobalConfig.DefineEff[config.effid].souce;this.XunzhangEff.playFile(RES_DIR_EFF+effSoure,-1);this.lastEffId=config.effid;if(effSoure=="xunzhang010"){this.XunzhangEff.scaleX=this.XunzhangEff.scaleX*.8;this.XunzhangEff.scaleY=this.XunzhangEff.scaleY*.8}this.stageImg.source="jieji"+config.effid%100+"_png"}var list=[];for(var i=0;i<config.achievementIds.length;i++){var taskid=config.achievementIds[i].taskId;if(taskid>0){list.push(UserTask.ins().getAchieveByTaskId(taskid))}}this.taskList.dataProvider=new eui.ArrayCollection(list);TimerManager.ins().doTimer(100,1,this.refreshEff,this)};XunzhangPanel.prototype.refreshEff=function(){var lv=LiLian.ins().nobilityLv;DisplayUtils.removeFromParent(this.eff);if(lv==0){var boo=this.taskList.numChildren>0;for(var i=0;i<this.taskList.numChildren;i++){var item=this.taskList.getChildAt(i);if(item.currentState=="goon"){boo=false;break}}if(boo){this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.eff.parent){this.eff.x=this.btn.x+this.btn.width/2;this.eff.y=this.btn.y+this.btn.height/2;this.showAct.addChild(this.eff)}}else{DisplayUtils.removeFromParent(this.eff)}}};XunzhangPanel.prototype.showActPanel=function(){this.Activation.visible=false;this.showAct.visible=!this.Activation.visible};XunzhangPanel.prototype.update=function(map){var refush=false;refush=map?map.refush:false;this.showActPanel();var lv=LiLian.ins().nobilityLv;var config=GlobalConfig.KnighthoodConfig[lv];if(LiLian.ins().isXZShow){var img=config.effid;RewardWin.showAct(0,config.desc,"j"+img+"_png");LiLian.ins().isXZShow=false}if(LiLian.ins().checkJueWeiOpen()){this.com1.visible=true;this.com2.visible=true;this.group.visible=true}else{this.com1.visible=false;this.com2.visible=false;this.group.visible=false;return}this.nameTF.text=config.type;var spaing=GlobalConfig.KnighthoodBasicConfig.perLevel;var stage=Math.ceil((lv-spaing)/(spaing+1)+1);var star=lv-(spaing+(stage-2)*(spaing+1)+1);this.starList.setStarNum(star,Number(refush));this.btn.label=i18n("XunzhangPanel_3");if(lv>0&&(lv-spaing)%(spaing+1)==0){this.btn.label=i18n("XunzhangPanel_4")}this.com1.updateInfo1(config,this.starList.starNum);config=GlobalConfig.KnighthoodConfig[lv+1];this.btn.visible=true;this.manjiTF.visible=false;this.com2.visible=true;this.arrow.visible=true;if(config){this.com1.x=10;this.com2.updateInfo2(config,this.starList.starNum)}else{this.btn.visible=false;this.manjiTF.visible=true;this.com2.visible=false;this.arrow.visible=false;this.taskList.visible=false;this.com1.x=137;this.group.y=440}this.setTaskList()};XunzhangPanel.prototype.getPower=function(){var lv=LiLian.ins().nobilityLv;var config=GlobalConfig.KnighthoodConfig[lv];return UserBag.getAttrPower(config.attrs)};return XunzhangPanel}(BaseEuiView);__reflect(XunzhangPanel.prototype,"XunzhangPanel");var XunzhangItem=function(_super){__extends(XunzhangItem,_super);function XunzhangItem(){return _super.call(this)||this}XunzhangItem.prototype.childrenCreated=function(){};XunzhangItem.prototype.updateInfo1=function(conf,starNum,isStageUpgrade){if(isStageUpgrade===void 0){isStageUpgrade=false}var attrs=conf.attrs;var str=AttributeData.getAttStr1(attrs,AttributeFormat.FORMAT_1());if(conf["exattrs"]&&conf["exattrs"].length>0){for(var i=0;i<conf["exattrs"].length;i++){str+="\n";str+=AttributeData.getExAttrNameByAttrbute(conf["exattrs"][i],true)+"\n"}}this.attrTxt.textFlow=TextFlowMaker.generateTextFlow(str);this.addNameTF(this.nameTF,conf,starNum,isStageUpgrade)};XunzhangItem.prototype.updateInfo2=function(conf,starNum,isStageUpgrade){if(isStageUpgrade===void 0){isStageUpgrade=false}var attrs=conf.attrs;var str=AttributeData.getAttStr1(attrs,AttributeFormat.FORMAT_2());if(conf["exattrs"]&&conf["exattrs"].length>0){str+="\n";for(var i=0;i<conf["exattrs"].length;i++){str+=AttributeData.getExAttrNameByAttrbute(conf["exattrs"][i],true,"：",242004)+"\n"}}this.attrTxt.textFlow=TextFlowMaker.generateTextFlow(str);this.addNameTF(this.nameTF,conf,starNum+1,isStageUpgrade)};XunzhangItem.prototype.addNameTF=function(label,conf,starNum,isStageUpgrade){if(isStageUpgrade===void 0){isStageUpgrade=false}if(!label)return;if(starNum>9)starNum=9;if(isStageUpgrade)starNum=0;label.text=conf.desc};return XunzhangItem}(BaseComponent);__reflect(XunzhangItem.prototype,"XunzhangItem");var XunZhangTaskItemRenderer=function(_super){__extends(XunZhangTaskItemRenderer,_super);function XunZhangTaskItemRenderer(){var _this=_super.call(this)||this;_this.skinName="XunzhangTaskSkin";return _this}XunZhangTaskItemRenderer.prototype.dataChanged=function(){var data=this.data;if(data){var config=UserTask.ins().getAchieveConfById(data.id);this.nameTF.textFlow=TextFlowMaker.generateTextFlow(config.name);var value=Math.min(data.value,config.target);this.expLabel.text=value+"/"+config.target;this.expBar.maximum=config.target;this.expBar.value=value;this.taskIcon.source="xunzhang"+data.achievementId+"_png";if(data.value>=config.target){this.currentState="done"}else{this.currentState="goon"}}};return XunZhangTaskItemRenderer}(BaseItemRender);__reflect(XunZhangTaskItemRenderer.prototype,"XunZhangTaskItemRenderer");var WeiWangItemRender=function(_super){__extends(WeiWangItemRender,_super);function WeiWangItemRender(){var _this=_super.call(this)||this;_this.skinName="WeiWangItemSkin";return _this}WeiWangItemRender.prototype.dataChanged=function(){var cfg=this.data;this.title.source=cfg.res;this.value.text=cfg.exp+""};return WeiWangItemRender}(BaseItemRender);__reflect(WeiWangItemRender.prototype,"WeiWangItemRender");var WeiWangOverViewWin=function(_super){__extends(WeiWangOverViewWin,_super);function WeiWangOverViewWin(){var _this=_super.call(this)||this;_this.skinName="WeiWangOverViewSkin";return _this}WeiWangOverViewWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=WeiWangItemRender};WeiWangOverViewWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onOtherClose);this.addTouchEvent(this.closeBtn,this.onOtherClose);this.update()};WeiWangOverViewWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onOtherClose);this.removeTouchEvent(this.closeBtn,this.onOtherClose)};WeiWangOverViewWin.prototype.update=function(){var arr=[];var len=Object.keys(GlobalConfig.PrestigeLevel).length;for(var i=1;i<=len;i++)arr.push(GlobalConfig.PrestigeLevel[i]);this.list.dataProvider=new eui.ArrayCollection(arr.reverse())};WeiWangOverViewWin.prototype.onOtherClose=function(e){ViewManager.ins().close(this)};return WeiWangOverViewWin}(BaseEuiView);__reflect(WeiWangOverViewWin.prototype,"WeiWangOverViewWin");ViewManager.ins().reg(WeiWangOverViewWin,LayerManager.UI_Popup);var WeiWangPanel=function(_super){__extends(WeiWangPanel,_super);function WeiWangPanel(){return _super.call(this)||this}WeiWangPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt.text);this.findItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.findItemTxt.text);this.overViewTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.overViewTxt.text)};WeiWangPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.observe(Actor.ins().postWeiWang,this.update);this.observe(WeiWangCC.ins().postWeiWangBack,this.updateBack);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.observe(Rank.ins().postRankingData,this.updateRank);this.update();this.updateBack();Rank.ins().sendGetRankingData(RankDataType.TYPE_WEIWANG);this.updateRank(Rank.ins().getRankModel(RankDataType.TYPE_WEIWANG))};WeiWangPanel.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeObserve();this.removeEffect();if(this._topThree)this._topThree.length=0;this._topThree=null};WeiWangPanel.prototype.updateRank=function(rankModel){if(rankModel&&rankModel.type!=RankDataType.TYPE_WEIWANG)return;var ranks=rankModel?rankModel.getDataList():null;var count=ranks?ranks.length:0;var data;var index;this._topThree=[];for(var i=1;i<=3;i++){index=i-1;if(i<=count){data=ranks[index];this["praiseGroup"+index].visible=true;this["name"+index].text=data.player;this._topThree[index]=data.id;this["bodyImg"+index].name=data.id+"";UserReadPlayer.ins().sendFindPlayer(data.id)}else{this["praiseGroup"+index].visible=false;this["name"+index].text=i18n("WeiWangPanel_0")}}index=this._topThree.indexOf(Actor.actorID);this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PrestigeBase.skillTips[index==-1?0:index+1])};WeiWangPanel.prototype.update=function(){this._weiWangCfg=WeiWangCC.ins().getWeiWangCfg(Actor.weiWang);var isMax=this._weiWangCfg.level==Object.keys(GlobalConfig.PrestigeLevel).length;this.notMaxGroup.visible=!isMax;this.maxShowGroup.visible=isMax;var objAtts=[];for(var k in this._weiWangCfg.attr)objAtts.push(new AttributeData(this._weiWangCfg.attr[k].type,this._weiWangCfg.attr[k].value));var nextCfg;if(!isMax){this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："));objAtts=[];nextCfg=GlobalConfig.PrestigeLevel[this._weiWangCfg.level+1];for(var k in nextCfg.attr)objAtts.push(new AttributeData(nextCfg.attr[k].type,nextCfg.attr[k].value));this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："))}else{this.maxCurAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："))}if(this._weiWangCfg.retrieve)this.info.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PrestigeBase.recycle.replace("{0}",this._weiWangCfg.retrieve+""));else this.info.text="";this.expBar.maximum=nextCfg?nextCfg.exp:this._weiWangCfg.exp;this.expBar.value=Actor.weiWang;this.expLabel.text=Actor.weiWang+"/"+(Actor.weiWang>this.expBar.maximum?"???":this.expBar.maximum);this.myTitle.source=this._weiWangCfg.res};WeiWangPanel.prototype.updateBack=function(){this.findItemTxt.visible=WeiWangCC.ins().weiWangBack>0;if(this.findItemTxt.visible){if(!this._backEff)this._backEff=ObjectPool.pop("MovieClip");if(!this._backEff.parent){this.findItemTxt.parent.addChild(this._backEff);this._backEff.x=this.findItemTxt.x+this.findItemTxt.width/2;this._backEff.y=this.findItemTxt.y+this.findItemTxt.height/2;this._backEff.touchEnabled=false;this._backEff.scaleY=.5;this._backEff.scaleX=.6}if(!this._backEff.isPlaying)this._backEff.playFile(RES_DIR_EFF+"chargeff1",-1)}else this.removeEffect()};WeiWangPanel.prototype.removeEffect=function(){if(this._backEff){DisplayUtils.removeFromParent(this._backEff);this._backEff.destroy();this._backEff=null}};WeiWangPanel.prototype.onTouch=function(e){var _this=this;switch(e.target){case this.getItemTxt:UserWarn.ins().setBuyGoodsWarn(MoneyConst.weiWang);break;case this.findItemTxt:WarnWin.show(i18n("WeiWangPanel_1",WeiWangCC.ins().weiWangBack*GlobalConfig.PrestigeBase.cost,WeiWangCC.ins().weiWangBack),function(){if(Actor.yb<WeiWangCC.ins().weiWangBack*GlobalConfig.PrestigeBase.cost){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("WeiWangPanel_2"),function(){Recharge.ins().tryShowChargeFirstWin()},_this,null,null,"sure");warnWin.setBtnLabel(i18n("WeiWangPanel_3"))}}else WeiWangCC.ins().sendFindWeiWang()},this);break;case this.overViewTxt:ViewManager.ins().open(WeiWangOverViewWin);break;case this.closeBtn:ViewManager.ins().close(LiLianWin);break;case this.title0:ViewManager.ins().open(WeiWangTitleTipsWin,GlobalConfig.PrestigeBase.topThree[0]);break;case this.title1:ViewManager.ins().open(WeiWangTitleTipsWin,GlobalConfig.PrestigeBase.topThree[1]);break;case this.title2:ViewManager.ins().open(WeiWangTitleTipsWin,GlobalConfig.PrestigeBase.topThree[2]);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[24].text);break;case this.bodyImg0:case this.bodyImg1:case this.bodyImg2:this._openOtherWin=true;UserReadPlayer.ins().sendFindPlayer(Number(e.target.name));break;case this.checkBtn:ViewManager.ins().open(RankingWin,RankDataType.TYPE_WEIWANG);break}};WeiWangPanel.prototype.openOtherPlayerView=function(otherPlayerData){if(this._openOtherWin){ViewManager.ins().open(RRoleWin,otherPlayerData);this._openOtherWin=false}else{var index=this._topThree.indexOf(otherPlayerData.id);if(index<0)return;var role=otherPlayerData.roleData[0];var zb=role.zhuangbei;var isHaveBody=void 0;var bodyId=zb[0];var weaponId=zb[1];var weaponConf=role.getEquipByIndex(0);var weaponConfId=weaponConf.item.configID;var bodyConf=role.getEquipByIndex(2);var bodyConfId=bodyConf.item.configID;var bodyRes="";var weaponRes="";var wingRes="";if(weaponConfId>0){var fileName=GlobalConfig.EquipConfig[weaponConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}weaponRes=fileName+"_"+role.sex+"_c"}if(bodyConfId>0){var fileName=GlobalConfig.EquipConfig[bodyConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}if(fileName.indexOf("903")>0){bodyRes=fileName+"_"+role.sex+"_c"}else{bodyRes=fileName+"_c"}isHaveBody=true}if(!isHaveBody){bodyRes=getDefaultBody(role.job)+"_c"}if(weaponId>0){weaponRes=this.getZhuangbanById(weaponId).res+"_"+role.sex+"_c"}if(bodyId>0){bodyRes=this.getZhuangbanById(bodyId).res+"_c"}var wingdata=role.wingsData;var id=zb[2];if(id>0){wingRes=GlobalConfig.ZhuangBanId[id].res}else if(wingdata.openStatus){wingRes=GlobalConfig.WingLevelConfig[wingdata.lv].appearance}this._body=imageToMc(this["bodyImg"+index],bodyRes,this["bodyMc"+index]);imageToMc(this["weaponImg"+index],weaponRes,this["weaponMc"+index],this._body);imageToMc(this["wingImg"+index],wingRes,this["wingMc"+index],this._body)}};WeiWangPanel.prototype.getZhuangbanById=function(id){for(var k in GlobalConfig.ZhuangBanId){if(GlobalConfig.ZhuangBanId[k].id==id)return GlobalConfig.ZhuangBanId[k]}return null};return WeiWangPanel}(BaseEuiView);__reflect(WeiWangPanel.prototype,"WeiWangPanel");var WeiWangTitleTipsWin=function(_super){__extends(WeiWangTitleTipsWin,_super);function WeiWangTitleTipsWin(){var _this=_super.call(this)||this;_this.skinName="WeiWangTitleTipsSkin";return _this}WeiWangTitleTipsWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onOtherClose);this.title.source=args[0].res;this.content.textFlow=TextFlowMaker.generateTextFlow1(args[0].des)};WeiWangTitleTipsWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onOtherClose)};WeiWangTitleTipsWin.prototype.onOtherClose=function(e){ViewManager.ins().close(this)};return WeiWangTitleTipsWin}(BaseEuiView);__reflect(WeiWangTitleTipsWin.prototype,"WeiWangTitleTipsWin");ViewManager.ins().reg(WeiWangTitleTipsWin,LayerManager.UI_Popup);var ChannelCfgOverwrite=function(){function ChannelCfgOverwrite(){}ChannelCfgOverwrite.overwriteCfgs=function(){var chnName=this.channelCfgName;if(chnName!=null&&chnName!=""){var channelCfgOverwrite=GlobalConfig.channelCfgOverwrite;var myOverwriteKeys=channelCfgOverwrite[chnName];if(myOverwriteKeys){for(var _i=0,myOverwriteKeys_1=myOverwriteKeys;_i<myOverwriteKeys_1.length;_i++){var k=myOverwriteKeys_1[_i];var originK=k.substr(0,k.length-1-chnName.length);GlobalConfig[originK]=GlobalConfig[k]}}}};ChannelCfgOverwrite.channelCfgName="";return ChannelCfgOverwrite}();__reflect(ChannelCfgOverwrite.prototype,"ChannelCfgOverwrite");var Gmsy=null;window["Gmsy"]=Gmsy;var ChannelMgr=function(_super){__extends(ChannelMgr,_super);function ChannelMgr(){var _this=_super.call(this)||this;_this.main_channel="0";_this.sub_channel="1";_this.platID=window["isIOS_AppStore"]==true?"104":"105";_this.extern_args="{}";_this.channelSDKParams={kuQu:{productCode:"73178095330227275509210521721269"},TianYuYou:{productCode:"55437386280104854034180587207522"},SanTang:{productCode:"41463723339696639997897822301165"},MeiShengYuan:{andGameName:"",andGameInfo:"pdsg",iosGameName:"",iosGameInfo:"lytxios"},"511Wan":{game_id:549},youmaH5:{productCode:"99173748865305755698645614659349"},youmaApp:{productCode:"63383372199418495392772295590417"},xianxiaquickH5:{productCode:"31100021525696794712737398326020"}};return _this}ChannelMgr.ins=function(){if(this._singleton==null){this._singleton=new ChannelMgr}return this._singleton};ChannelMgr.prototype.reload=function(){if(egret.Capabilities.runtimeType==egret.RuntimeType.WXGAME){var wx=window["wx"];if(typeof wx!="undefined"){wx.exitMiniProgram({success:function(){},fail:function(){},complete:function(){}})}}if(egret.Capabilities.runtimeType==egret.RuntimeType.QQGAME){var qq=window["qq"];if(typeof qq!="undefined"){qq.exitMiniProgram({success:function(){},fail:function(){},complete:function(){}})}}else{location.reload(true)}};ChannelMgr.prototype.isDev=function(){return this.main_channel=="0"||this.main_channel=="14"};ChannelMgr.prototype.isQA=function(){return this.main_channel=="11"||this.main_channel=="15"};ChannelMgr.prototype.extractChannels=function(s){var ccode=GetUrlParam("channelCode")||"1";var channels=s.split(",");this.main_channel=channels[0];this.sub_channel=channels[1];this.platID=channels[2];if(this.isYaoShengChannel()){this.platID="104"}if(this.isQuickH5SDKChannel()){this.getQuickh5channelCode(ccode)}};ChannelMgr.prototype.getQuickh5channelCode=function(ccode){this.sub_channel=ccode};ChannelMgr.prototype.getDeviceID=function(){if(DeviceUtils.deviceOS==DEVICE_OS.ANDROID){return"102"}else if(DeviceUtils.deviceOS==DEVICE_OS.IOS){return"103"}return ChannelMgr.ins().platID};ChannelMgr.prototype.getChannel=function(cb){this.getChannelNew();var self=this;if(JsNativeCallMgr.hasMethod("getChannel")){JsNativeCallMgr.callMethod("getChannel",function(flag_channels){var channels=flag_channels;self.extractChannels(channels);cb()});return}else{var c2="";var c=GetUrlChannel();var a=c.split("_");if(a[0]){c2+=a[0]+","}else{c2+="0,"}if(a[1]){c2+=a[1]+","}else{c2+="1,"}c2+=ChannelMgr.ins().platID;this.extractChannels(c2)}if(ChannelMgr.ins().isHuanYouChannel()){this.platID=Recharge.platIds["channel"].toString()}if(ChannelMgr.ins().isYouMaH5Channel()){this.platID="105"}cb()};ChannelMgr.prototype.getChannelNew=function(){var c=GetUrlChannel();var a=c.split("_");if(a[0]){this.main_channel=a[0]}if(a[1]){this.sub_channel=a[1]}var p=GetUrlParam("plat");if(p){this.platID=p}};ChannelMgr.prototype.isDiMaiChannel=function(){if(this.main_channel=="20112"){return true}return false};ChannelMgr.prototype.isAnQiGeChannel=function(){if(this.main_channel=="20121"){return true}return false};ChannelMgr.prototype.isHuanYouChannel=function(){if(this.main_channel=="10003"){return true}return false};ChannelMgr.prototype.isHuanYouChannel2=function(){if(this.main_channel=="10038"){return true}return false};ChannelMgr.prototype.isYiXuChannel=function(){if(this.main_channel=="10016"){return true}return false};ChannelMgr.prototype.isJiuChengChannel=function(){if(this.main_channel=="10017"){return true}return false};ChannelMgr.prototype.isChuDongChannel=function(){if(this.main_channel=="10018"){return true}return false};ChannelMgr.prototype.isKuQuChannel=function(){if(this.main_channel=="10020"){return true}return false};ChannelMgr.prototype.isMiJuChannel=function(){if(this.main_channel=="10021"){return true}return false};ChannelMgr.prototype.isChongChongChannel=function(){if(this.main_channel=="10022"){return true}return false};ChannelMgr.prototype.isGuoHaiChannel=function(){if(this.main_channel=="10023"){return true}return false};ChannelMgr.prototype.isZiXiaChannel=function(){if(this.main_channel=="10024"){return true}return false};ChannelMgr.prototype.is1758Channel=function(){if(this.main_channel=="10025"){return true}return false};ChannelMgr.prototype.isTianYuYouChannel=function(){if(this.main_channel=="10026"){return true}return false};ChannelMgr.prototype.isGuoPanChannel=function(){if(this.main_channel=="10027"){return true}return false};ChannelMgr.prototype.isMeiShengYuanChannel=function(){if(this.main_channel=="10028"){return true}return false};ChannelMgr.prototype.isMeiShengYuanChannelAndroid=function(){if(this.main_channel=="10028"&&this.platID=="102"){return true}return false};ChannelMgr.prototype.isMeiShengYuanChannelH5=function(){if(this.main_channel=="10028"&&this.platID=="105"){return true}return false};ChannelMgr.prototype.isYouXiFanChannel=function(){if(this.main_channel=="10029"){return true}return false};ChannelMgr.prototype.isYiYouChannel=function(){if(this.main_channel=="10030"){return true}return false};ChannelMgr.prototype.isSanTangChannel=function(){if(this.main_channel=="10031"){return true}return false};ChannelMgr.prototype.isXianTuChannel=function(){if(this.main_channel=="10032"){return true}return false};ChannelMgr.prototype.is511WanChannel=function(){if(this.main_channel=="10033"){return true}return false};ChannelMgr.prototype.isYouMaAppChannel=function(){if(this.main_channel=="10034"&&(ChannelMgr.ins().platID=="102"||ChannelMgr.ins().platID=="103")){return true}return false};ChannelMgr.prototype.isYouMaH5Channel=function(){if(this.main_channel=="10034"&&ChannelMgr.ins().platID=="105"){return true}return false};ChannelMgr.prototype.isYaoShengChannel=function(){if(this.main_channel=="10035"){return true}return false};ChannelMgr.prototype.isYouTuoBangChannel=function(){if(this.main_channel=="10036"){return true}return false};ChannelMgr.prototype.isQQSmallGameChannel=function(){if(this.main_channel=="20120"||this.main_channel=="20127"){return true}return false};ChannelMgr.prototype.isQQSmallGameChannel1=function(){if(this.main_channel=="20120"){return true}return false};ChannelMgr.prototype.isQQSmallGameChannel2=function(){if(this.main_channel=="20127"){return true}return false};ChannelMgr.prototype.isWXSmallGameChannel=function(){if(this.isWXSmallGameChannel1()||this.isWXSmallGameChannel2()||this.isWXSmallGameChannel3()){return true}return false};ChannelMgr.prototype.isWXSmallGameChannel1=function(){if(this.main_channel=="20122"){return true}return false};ChannelMgr.prototype.isWXSmallGameChannel2=function(){if(this.main_channel=="20128"){return true}return false};ChannelMgr.prototype.isWXSmallGameChannel3=function(){if(this.main_channel=="20129"){return true}return false};ChannelMgr.prototype.isLKChannel=function(){if(this.main_channel=="0"||this.main_channel=="10000"||this.main_channel=="10001"||this.main_channel=="10004"){return true}return false};ChannelMgr.prototype.isThirdChannel=function(){var res=this.isHuanYouChannel()||this.isThirdChannelPay();return res};ChannelMgr.prototype.isNeedSubmitID=function(){if(this.main_channel=="20001"){return true}return LoginMgr.ins().needAntiAddiction()};ChannelMgr.prototype.isXianXiaQuickAppChannel=function(){if(this.main_channel=="20106"){return true}return false};ChannelMgr.prototype.isDouYinChannel=function(){if(this.main_channel=="20107"){return true}return false};ChannelMgr.prototype.isTencGDTChannel=function(){if(this.main_channel=="20108"||this.main_channel=="20110"){return true}return false};ChannelMgr.prototype.isThirdChannelPay=function(){var res=this.isQuickAppSDKChannel()||this.isChuDongChannel()||this.isQuickH5SDKChannel()||this.isMiJuChannel()||this.isChongChongChannel()||this.isGuoPanChannel()||this.isZiXiaChannel()||this.is1758Channel()||this.isMeiShengYuanChannel()||this.isYouXiFanChannel()||this.isXianTuChannel()||this.is511WanChannel()||this.isYiYouChannel()||this.isYaoShengChannel()||this.isYouTuoBangChannel()||this.isHuanYouChannel2()||this.isDiMaiChannel()||this.isJuHeAppChannel()||this.isQQZoneChannel()||this.isQQDaTingChannel()||this.isFKYLCChannel()||this.isAWYCChannel()||this.isQQSmallGameChannel()||this.isAnQiGeChannel()||this.isDouYuChannel()||this.isWXSmallGameChannel()||this.is52ggChannel()||this.isTongChengChannel()||this.isDuoYouChannel();return res};ChannelMgr.prototype.isSelfChannelPay=function(){var res=this.isXianKunQiYuan();return res};ChannelMgr.prototype.isQuickAppSDKChannel=function(){var res=this.isYiXuChannel()||this.isJiuChengChannel()||this.isGuoHaiChannel()||this.isYouMaAppChannel()||this.isXianXiaQuickAppChannel();return res};ChannelMgr.prototype.isQuickH5SDKChannel=function(){var res=this.isxianxiaQuickH5Channel()||this.isKuQuChannel()||this.isTianYuYouChannel()||this.isSanTangChannel()||this.isYouMaH5Channel();return res};ChannelMgr.prototype.isxianxiaQuickH5Channel=function(){return this.main_channel=="20116"};ChannelMgr.prototype.isFKYLCChannel=function(){return this.main_channel=="20117"};ChannelMgr.prototype.isAWYCChannel=function(){return this.main_channel=="20118"};ChannelMgr.prototype.isXianKunQiYuan=function(){return this.main_channel=="20100"};ChannelMgr.prototype.isJiuYou=function(){return this.main_channel=="20106"&&this.sub_channel=="9"};ChannelMgr.prototype.isYYB=function(){return this.main_channel=="20106"&&this.sub_channel=="32"};ChannelMgr.prototype.isJuHeAppChannel=function(){return this.main_channel=="20113"||this.main_channel=="20114"};ChannelMgr.prototype.isQQZoneChannel=function(){return this.main_channel=="20115"};ChannelMgr.prototype.isQQDaTingChannel=function(){return this.main_channel=="20119"};ChannelMgr.prototype.isDouYuChannel=function(){return this.main_channel=="20123"};ChannelMgr.prototype.is52ggChannel=function(){return this.main_channel=="20124"};ChannelMgr.prototype.isTongChengChannel=function(){return this.main_channel=="20125"};ChannelMgr.prototype.isDuoYouChannel=function(){return this.main_channel=="20126"};ChannelMgr.prototype.isNoSoundChannel=function(){return false};ChannelMgr.prototype.isRechargeHidden=function(){var b=this.main_channel=="13";if(ChannelMgr.ins().isWXSmallGameChannel()){b=!qingjs.instance.canPay()}else if(ChannelMgr.ins().isQQSmallGameChannel()){var env=window["qq"];var res=env.getSystemInfoSync();var platform_1=res.platform;console.log("channel "+ChannelMgr.ins().main_channel+" platform:"+platform_1);if(platform_1.indexOf("iOS")>-1||platform_1.indexOf("IOS")>-1||platform_1.indexOf("ios")>-1){b=true}}else if(!Recharge.ins().open){b=true}return b};ChannelMgr.prototype.isBeautyHidden=function(){return this.isAWYCChannel()||this.isFKYLCChannel()};ChannelMgr.prototype.isAndroid=function(){var agent=navigator.userAgent.toLowerCase();if(Recharge.ins().plat=="and"||agent.indexOf("android")!=-1){return true}return false};ChannelMgr.prototype.getProductCode=function(){if(this.isKuQuChannel()){return this.channelSDKParams["kuQu"].productCode}else if(this.isTianYuYouChannel()){return this.channelSDKParams["TianYuYou"].productCode}else if(this.isSanTangChannel()){return this.channelSDKParams["SanTang"].productCode}else if(this.isYouMaH5Channel()){return this.channelSDKParams["youmaH5"].productCode}else if(this.isYouMaAppChannel()){return this.channelSDKParams["youmaApp"].productCode}else if(this.isxianxiaQuickH5Channel()){return this.channelSDKParams["xianxiaquickH5"].productCode}};ChannelMgr.prototype.channelReport=function(type){if(type===void 0){type=1}var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}console.log(args);if(ChannelMgr.ins().isDouYinChannel()||ChannelMgr.ins().isTencGDTChannel()){switch(type){case 0:if(JsNativeCallMgr.hasMethod("myDotEvent")){JsNativeCallMgr.callMethod.apply(JsNativeCallMgr,["myDotEvent",function(){}].concat(args));return}break;case 5:if(JsNativeCallMgr.hasMethod("Register")){JsNativeCallMgr.callMethod.apply(JsNativeCallMgr,["Register",function(){}].concat(args));return}break;case 6:if(JsNativeCallMgr.hasMethod("Purchase")){JsNativeCallMgr.callMethod.apply(JsNativeCallMgr,["Purchase",function(){}].concat(args));return}break;case 2:if(JsNativeCallMgr.hasMethod("CreateGameRole")){JsNativeCallMgr.callMethod.apply(JsNativeCallMgr,["CreateGameRole",function(){}].concat(args));return}break;case 7:if(JsNativeCallMgr.hasMethod("Login")){JsNativeCallMgr.callMethod.apply(JsNativeCallMgr,["Login",function(){}].concat(args));return}break;case 4:if(JsNativeCallMgr.hasMethod("UpdateLevel")){JsNativeCallMgr.callMethod.apply(JsNativeCallMgr,["UpdateLevel",function(){}].concat(args));return}break}return}var self=this;var serverId=LocationProperty.srvid;var serverName=SelectServerMgr.ins().getServerNameByID(LocationProperty.srvid);var gameRoleName=Actor.myName;var gameRoleID=Actor.actorID;var isCreated=LocationProperty.isCreated?1:0;if(ChannelMgr.ins().isQuickAppSDKChannel()){if(JsNativeCallMgr.hasMethod("login")){console.log("【"+ChannelMgr.ins().main_channel+"】 Js2JavaInterface.login:{serverId:"+serverId+" serverName:"+serverName+" gameRoleName:"+gameRoleName+" gameRoleID:"+gameRoleID+" isCreated:"+isCreated+"}");JsNativeCallMgr.callMethod("login",function(){},serverId,serverName,gameRoleName,gameRoleID,isCreated);return}}if(ChannelMgr.ins().isJuHeAppChannel()){var roleVip=UserVip.ins().lv||0;if(JsNativeCallMgr.hasMethod("login")){console.log("【"+ChannelMgr.ins().main_channel+"】 Js2JavaInterface.login:{serverId:"+serverId+" serverName:"+serverName+" gameRoleName:"+gameRoleName+" gameRoleID:"+gameRoleID+" isCreated:"+isCreated+"}");JsNativeCallMgr.callMethod("login",function(){},serverId,serverName,gameRoleName,gameRoleID,isCreated,Actor.level,roleVip,Actor.yb);return}}else if(ChannelMgr.ins().isDuoYouChannel()){this.DuoYouChannelReport(serverId,serverName,gameRoleID,gameRoleName)}else if(ChannelMgr.ins().isDiMaiChannel()){this.DiMaichannelReport(type,serverId,serverName,gameRoleID,gameRoleName,args)}else if(ChannelMgr.ins().isAnQiGeChannel()){var MethodStr=args[0];this.AnQiGeChannelReport(MethodStr)}else if(ChannelMgr.ins().isDouYuChannel()){this.DouYuChannelReport(type)}else if(ChannelMgr.ins().isTongChengChannel()){this.TongChengChannelReport(type)}else if(ChannelMgr.ins().isFKYLCChannel()){ChannelNet.ins().sendChannelInfo(ChannelMgr.ins().extern_args)}else if(ChannelMgr.ins().isAWYCChannel()){var newuser=0;switch(type){case 2:newuser=1;ChannelNet.ins().sendChannelInfo(ChannelMgr.ins().extern_args);break;case 3:break}var sdk=window["AWY_SDK"];if(!sdk){console.log("channel 20118 sdk = null before report");return}sdk.serverLoginStat({serverid:serverId,newuser:newuser})}else if(ChannelMgr.ins().isQQSmallGameChannel()){if(type==2){var param={server_id:serverId,server_name:serverName,nickname:gameRoleName};console.log("channel "+ChannelMgr.ins().main_channel+" dyb.createRole param:"+JSON.stringify(param));dyb.createRole(param,function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.createRole callback:"+JSON.stringify(callback))})}else if(type==3){ChannelNet.ins().sendChannelInfo(ChannelMgr.ins().extern_args)}}else if(ChannelMgr.ins().isWXSmallGameChannel()){var param={roleId:Actor.actorID.toString(),roleName:Actor.myName,roleLevel:Actor.level,serverId:serverId.toString(),serverName:serverName,roleVip:UserVip.ins().lv,rolePower:Actor.power,reportType:"createrole"};if(type==2){param["reportType"]="createrole"}else if(type==3){param["reportType"]="entergame"}else if(type==4){param["reportType"]="roleupgrade"}console.log("channel "+ChannelMgr.ins().main_channel+" qingjs.instance.reportRoleInfo param:"+JSON.stringify(param));qingjs.instance.reportRoleInfo(param,function(result){console.log("channel "+ChannelMgr.ins().main_channel+" qingjs.instance.reportRoleInfo result:"+JSON.stringify(result));var canPay=qingjs.instance.canPay();console.log("channel "+ChannelMgr.ins().main_channel+" qingjs.instance.canPay() = "+canPay);Recharge.ins().postChangeRecharge(canPay)})}else if(ChannelMgr.ins().isQuickH5SDKChannel()){this.QuickH5ChannelReport(type)}};ChannelMgr.prototype.DuoYouChannelReport=function(serverId,serverName,gameRoleID,gameRoleName){var data={};var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);ChannelNet.ins().sendChannelInfo(ChannelMgr.ins().extern_args)};ChannelMgr.prototype.DiMaichannelReport=function(type,serverId,serverName,gameRoleID,gameRoleName){var args=[];for(var _i=5;_i<arguments.length;_i++){args[_i-5]=arguments[_i]}var infoType="";var roleVip=UserVip.ins().lv.toString();var role=SubRoles.ins().getSubRoleByIndex(0);var roleData={};var guildname="";var zslv=0;if(role&&role.guildName){guildname=role.guildName}else{guildname="无"}if(UserZs.ins().lv){zslv=UserZs.ins().lv}else{zslv=0}switch(type){case 1:infoType="serverSeclet";roleData={info_type:infoType,server_id:serverId,server_name:serverName};break;case 2:infoType="roleCreate";roleData={info_type:infoType,server_id:serverId,server_name:serverName,role_id:gameRoleID||"0",role_name:gameRoleName||"无",role_level:Actor.level||"0",role_createtime:args[0]||"0"};break;case 3:infoType="enterGame";roleData={info_type:infoType,server_id:serverId,server_name:serverName,role_id:gameRoleID||"0",role_name:gameRoleName||"无",role_level:Actor.level||"0",role_createtime:args[0]||"0",role_vip:roleVip||"0",role_fightvalue:Actor.power||"0",role_partyname:guildname||"无",role_extra:{rolezslv:zslv}};break;case 4:infoType="roleUplevel";roleData={info_type:infoType,server_id:serverId,server_name:serverName,role_id:gameRoleID||"0",role_name:gameRoleName||"无",role_level:Actor.level||"0",role_createtime:args[0]||"0",role_leveltime:args[1]||"0",role_vip:roleVip||"0",role_fightvalue:Actor.power||"0",role_partyname:guildname||"无",role_extra:{rolezslv:zslv}};break}glSdk.submitRoleInfo(roleData)};ChannelMgr.prototype.AnQiGeChannelReport=function(Method){var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var param={Ugameid:obj["Ugameid"],Uid:obj["Uid"],Serverid:LocationProperty.srvid,ServerName:LocationProperty.srvName,Roleid:Actor.actorID,RoleName:Actor.myName,Method:Method,Time:GameServer.serverTime};window.parent.postMessage(param,"*")};ChannelMgr.prototype.DouYuChannelReport=function(type){var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var data={};sqsdk=window["SQ_SDK"];var now=new Date;switch(type){case 1:data={game_id:obj["game_id"],c_game_id:obj["c_game_id"],uid:obj["uid"],sid:LocationProperty.srvid,server_name:LocationProperty.srvName,guid:obj["guid"],time:GameServer.serverTime/1e3||now.getTime()/1e3};sqsdk.postServer(data);break;case 2:data={game_id:obj["game_id"],c_game_id:obj["c_game_id"],uid:obj["uid"],sid:LocationProperty.srvid,role_id:Actor.actorID,role_name:Actor.myName,guid:obj["guid"],time:GameServer.serverTime/1e3||now.getTime()/1e3,fdata:obj["fdata"]};console.log("========CREATE_ROLE 222data:",data);sqsdk.postRole(data);break;case 4:var zslv=UserZs.ins().lv||0;data={game_id:obj["game_id"],c_game_id:obj["c_game_id"],uid:obj["uid"],sid:LocationProperty.srvid,role_id:Actor.actorID,role_name:Actor.myName,level:Actor.level||"0",turn:zslv,fight:Actor.power||"0",guid:obj["guid"],time:GameServer.serverTime/1e3,ext:""};sqsdk.postLevel(data);break}};ChannelMgr.prototype.TongChengChannelReport=function(type){var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var data={};var now=new Date;switch(type){case 1:TCYSDK.start("TCYSDK_LOGIN",{AppId:obj["AppId"],ServerId:LocationProperty.srvid});break;case 2:case 4:TCYSDK.start("TCYSDK_PUT_ROLE",{AppId:obj["AppId"],ServerId:LocationProperty.srvid,RoleName:Actor.myName,GameLevel:Actor.level,CreateTime:GameServer.serverTime/1e3||now.getTime()/1e3});break}};ChannelMgr.prototype.QuickH5ChannelReport=function(type){var iscreaterole=false;var rolecreatetime=0;var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);if(type==2){iscreaterole=true;rolecreatetime=GameServer.serverTime}var roleInfo={isCreateRole:iscreaterole,roleCreateTime:rolecreatetime,uid:obj["uid"],username:obj["username"],serverId:LocationProperty.srvid,serverName:LocationProperty.srvName,userRoleName:Actor.myName||"无",userRoleId:Actor.actorID||"0",userRoleBalance:Actor.yb||"0",vipLevel:UserVip.ins().lv||"0",userRoleLevel:Actor.level||"0",partyId:Guild.ins().guildID||"0",partyName:Guild.ins().guildName||"无",gameRolePower:Actor.power||"0"};var roleInfoJson=JSON.stringify(roleInfo);QuickSDK.uploadGameRoleInfo(roleInfoJson,function(response){})};ChannelMgr.prototype.getChongChongUserInfo=function(){var info={dataType:1,moneyNum:Actor.yb,partyID:Guild.ins().guildID,partyName:Guild.ins().guildName,roleID:Actor.actorID,roleLevel:Actor.level,roleName:Actor.myName,serverId:LocationProperty.srvid,serverName:LocationProperty.srvName,vip:UserVip.ins().lv};return info};ChannelMgr.prototype.channelSDKInit=function(){if(ChannelMgr.ins().isHuanYouChannel()&&!Recharge.huanyouPayInited){if(typeof HySDK!="undefined"){if(HySDK.init){HySDK.init();Recharge.huanyouPayInited=true}else{alert("HySDK.init = null")}}else{alert("typeof(HySDK)==undefined")}return}if(ChannelMgr.ins().isHuanYouChannel2()&&!Recharge.huanyouPayInited){if(typeof HySDK!="undefined"){if(HySDK.init){HySDK.init();Recharge.huanyouPayInited=true}else{alert("HySDK.init = null")}}else{alert("typeof(HySDK)==undefined")}return}if(ChannelMgr.ins().isChuDongChannel()&&!Recharge.chudongPayInited){window["__paySuccess"]=function(){Recharge.ins().showReCharge(Recharge.ins().product_id)};window["__payError"]=function(){WarnWin.show(i18n("ChannelMgr_18"),null,null,null,null,"sure")};window["__payClose"]=function(){WarnWin.show(i18n("ChannelMgr_19"),null,null,null,null,"sure")};Recharge.chudongPayInited=true;return}if(this.isMeiShengYuanChannelH5()&&!Recharge.meishengyuanPayInited){var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);Gmsy=new Msysdk({appid:obj["appid"],from:obj["from"],userid:obj["userid"]});Gmsy.ready([function(){console.log("Gmsy.ready callback")}]);window["MSYfollow"]=Gmsy.checkfocus();window["MSYshare"]=Gmsy.showstatus(obj["appid"]);Gmsy.onShareOK(function(){console.log(i18n("ChannelMgr_20"));ChannelNet.ins().sendShareEnd(7)});Recharge.meishengyuanPayInited=true;return}if(ChannelMgr.ins().isYouTuoBangChannel()&&!Recharge.youtuobangPayInited){YDPAY.init({appID:window["YTB_appID"],openKey:window["YTB_openKey"],appVersion:"1",channelId:"10036",initCallback:function(res){if(res.type=="INIT_OK"){console.log("10036 pay_sdk INIT_SUCCESS");Recharge.youtuobangPayInited=true}else{console.log("10036 pay_sdk INIT_FAIL")}}});return}};ChannelMgr.prototype.channelReLoad=function(){if(ChannelMgr.ins().is1758Channel()){var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var data={appKey:obj["appKey"],hlmy_gw:obj["hlmy_gw"]};window["HLMY_SDK"].reload(data)}};ChannelMgr.prototype.shouldShowSaveAccount=function(){if(DeviceUtils.IsPC){return false}if(ChannelMgr.ins().platID!="102"&&ChannelMgr.ins().platID!="103"){return false}if(this.isThirdChannel()){return false}var plat=Recharge.ins().plat;if(plat=="dev"){return false}return true};ChannelMgr.prototype.saveCountImage=function(userName,pwd){var self=this;if(!this.shouldShowSaveAccount()){return}var a=0;SaveNewCountWin.show(i18n("ChannelMgr_21")+userName+i18n("ChannelMgr_22")+pwd+i18n("ChannelMgr_23"),function(){setTimeout(function(){a=1},200);if(a==1){ViewManager.ins().close(SaveNewCountWin)}else{if(JsNativeCallMgr.hasMethod("saveScreenShoot")){window["saveCallbackFunc"]=function(s){ViewManager.ins().close(SaveNewCountWin);if(s==0){SaveNewCountWin.show(i18n("ChannelMgr_24"),function(){ViewManager.ins().close(SaveNewCountWin)},self,null,null,"sure")}};JsNativeCallMgr.callMethod("saveScreenShoot",function(){});return}}},self,null,null,"sure")};ChannelMgr.prototype.getDistEnv=function(){var url=document.URL;var t1=url.indexOf("://");if(t1>=0){url=url.substr(t1+3)}var t2=url.indexOf("?");if(t2>=0){url=url.substr(0,t2)}var tokens=url.split("/");if(tokens[0]=="cdnlytj.lkgame.com"){return tokens[tokens.length-2]}return""};ChannelMgr.prototype.getFullChannel=function(){if(this.isQQSmallGameChannel()){return"20120_1"}return this.main_channel+"_"+this.sub_channel};ChannelMgr.prototype.QuickH5logout=function(){QuickSDK.logout(function(logoutObject){console.log("Game:成功退出游戏")})};return ChannelMgr}(egret.EventDispatcher);__reflect(ChannelMgr.prototype,"ChannelMgr");var ChannelNet=function(_super){__extends(ChannelNet,_super);function ChannelNet(){var _this=_super.call(this)||this;_this.award_count=[];_this.ad_info={};_this.offline_cnt=0;_this.login_days=1;_this.open=0;_this.sum_cash=0;_this.showSmallGameActivity=false;_this.cashGiftInfo=[];_this.cashGift_left_period=0;_this.loginGift_left_period=0;_this.inviteInfo={};_this.clickGiftInfo={};_this.friendGiftInfo={};_this.curShareType=1;_this.curImgUrl="";_this.curTitle="";_this.curContent="";_this.showOnced=false;_this.loginGot=false;_this.cashGot=false;_this.sysId=PackageID.Promote;_this.regNetMsg(3,_this.postShareStart);_this.regNetMsg(4,_this.postShareEnd);_this.regNetMsg(5,_this.GetChannelInfo);_this.regNetMsg(6,_this.postAdInfo);_this.regNetMsg(7,_this.postAdRewardRes);_this.regNetMsg(8,_this.postLoginInfo);_this.regNetMsg(9,_this.postOpenLoginRedPacket);_this.regNetMsg(10,_this.postWithdrawLoginCash);_this.regNetMsg(11,_this.postCashGiftInfo);_this.regNetMsg(12,_this.postCheckCashGift);_this.regNetMsg(13,_this.postWithdrawGiftCash);_this.regNetMsg(14,_this.postInviteInfo);_this.regNetMsg(15,_this.postInviteReward);_this.regNetMsg(16,_this.postClickGiftInfo);_this.regNetMsg(17,_this.postClickGiftReward);_this.regNetMsg(18,_this.postFriendGiftInfo);_this.regNetMsg(19,_this.postFriendGiftReward);return _this}ChannelNet.ins=function(){return _super.ins.call(this)};ChannelNet.prototype.channelShareInit=function(){var self=this;if(ChannelMgr.ins().isQQSmallGameChannel()){var openId=ChannelNet.ins().getOpenId();ChannelNet.ins().sendLoginInfo(openId);ChannelNet.ins().sendGetCashGiftInfo(openId)}if(ChannelMgr.ins().isFKYLCChannel()){console.log("channel 20117 sdk channelShareInit");var cfg=GlobalConfig.QzoneShareConfig[8];var title=cfg.title;var img=cfg.img_url;var content=cfg.content;var success=function(){console.log("channel 20117 share success:ChannelNet.ins().sendShareEnd(8)");self.sendShareEnd(8);self.sendShareStart(8)};var failed=function(){console.log("channel 20117 share cancel")};console.log("channel 20117 sdk config");var sdk=window["HORTOR_AGENT"];if(!sdk){console.log("channel 20117 sdk = null L38");return}sdk.config({gameId:"wlmz",share:{timeline:{title:title,imgUrl:img,success:success,cancel:failed},friend:{title:title,desc:content,imgUrl:img,success:success,cancel:failed}}});if(window["20117follow"]==true){self.sendShareEnd(9)}console.log("channel 20117 sdk getSVIPIcon:");sdk.getSVIPIcon(function(res){var msg=res.errMsg;var isCps=res.isCps;var buttonIcon=res.buttonIcon||"nothing";console.log("channel 20117 sdk getSVIPIcon msg:"+msg+" isCps:"+isCps+" buttonIcon:"+buttonIcon);if(msg=="success"&&isCps){window["20117SVIP"]=buttonIcon;console.log("channel 20117 sdk 20117SVIP = :"+buttonIcon)}})}else if(ChannelMgr.ins().isAWYCChannel()){console.log("channel 20118 sdk channelShareInit");var sdk_1=window["AWY_SDK"];if(!sdk_1){console.log("channel 20118 sdk = null L64");return}var success_1=function(){console.log("channel 20118 share success:ChannelNet.ins().sendShareEnd(10)");self.sendShareEnd(10);self.sendShareStart(10)};sdk_1.config(845,function(){success_1()},function(){});var cfg=GlobalConfig.QzoneShareConfig[10];var title=cfg.title;var img=cfg.img_url;var content=cfg.content;sdk_1.shareDesc(content);sdk_1.shareTitle(title);sdk_1.shareIcon(img);sdk_1.checkSVIP(function(v){var isAdd=v.isAdd,isCPS=v.isCPS;if(!isCPS){if(isAdd){window["20118SVIP"]="connectSVIP"}else{window["20118SVIP"]="addSVIP"}}});if(!window["20118chid"]&&window["20118focus"]){self.sendShareEnd(11)}if(window["20118verify"]){self.sendShareEnd(12)}}else if(ChannelMgr.ins().isWXSmallGameChannel()){var cfg=GlobalConfig.QzoneShareConfig[8];var img_2=cfg.img_url;var wx=window["wx"];var title_1=i18n("ChannelNet_4");if(ChannelMgr.ins().isWXSmallGameChannel2()){title_1=i18n("ChannelNet_5")}else if(ChannelMgr.ins().isWXSmallGameChannel3()){title_1=i18n("ChannelNet_6")}if(typeof wx!="undefined"){wx.onShareAppMessage(function(){return{title:title_1,imageUrl:img_2,query:qingjs.instance.getShareToken(),success:function(res){},fail:function(res){}}})}}else if(ChannelMgr.ins().isQQSmallGameChannel()){var openid=ChannelNet.ins().getOpenId();var main_channel=ChannelMgr.ins().main_channel;var param={title:"少年请留步，您的神武掉了",imageUrl:"https://cdnlytj.lkgame.com/game_space/lytj/download/img/share_"+main_channel+"_2.jpg",query:"invitor_open_id="+openid};dyb.onShare(param,function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.onShare param:"+JSON.stringify(param));console.log("channel "+ChannelMgr.ins().main_channel+" dyb.onShare callback:"+JSON.stringify(callback))})}};ChannelNet.prototype.sendShareStart=function(type){var bytes=this.getBytes(3);bytes.writeInt(type);this.sendToServer(bytes)};ChannelNet.prototype.sendShareEnd=function(type){this.curShareType=type;var bytes=this.getBytes(4);bytes.writeInt(type);this.sendToServer(bytes)};ChannelNet.prototype.sendChannelInfo=function(str){console.log("channel "+ChannelMgr.ins().main_channel+" sendChannelInfo:"+str);var bytes=this.getBytes(5);bytes.writeString(str);this.sendToServer(bytes)};ChannelNet.prototype.GetChannelInfo=function(bytes){var str_body=bytes.readString();var strObj=JSON.parse(str_body);if(ChannelMgr.ins().isDuoYouChannel()){var data_6=strObj;dy_jh_sdk.uploadRole(data_6,function(result){console.log("lkgame dy_jh_sdk uploadRole:",data_6)})}};ChannelNet.prototype.sendAdInfo=function(channel){console.log("channel "+ChannelMgr.ins().main_channel+" sendAdInfo");var bytes=this.getBytes(6);bytes.writeString(channel);this.sendToServer(bytes)};ChannelNet.prototype.sendAdReward=function(channel,type,id){if(id===void 0){id=0}console.log("channel "+ChannelMgr.ins().main_channel+" sendAdReward type:"+type+" id:"+id);var bytes=this.getBytes(7);bytes.writeString(channel);bytes.writeByte(type);bytes.writeByte(id);this.sendToServer(bytes)};ChannelNet.prototype.sendLoginInfo=function(open_id){console.log("channel "+ChannelMgr.ins().main_channel+" sendLoginInfo open_id:"+open_id);var bytes=this.getBytes(8);bytes.writeString(open_id);this.sendToServer(bytes)};ChannelNet.prototype.sendOpenLoginRedPacket=function(open_id){console.log("channel "+ChannelMgr.ins().main_channel+" sendOpenLoginRedPacket open_id:"+open_id);var bytes=this.getBytes(9);bytes.writeString(open_id);this.sendToServer(bytes)};ChannelNet.prototype.sendWithdrawLoginCash=function(open_id){console.log("channel "+ChannelMgr.ins().main_channel+" sendWithdrawLoginCash open_id:"+open_id);var bytes=this.getBytes(10);bytes.writeString(open_id);this.sendToServer(bytes)};ChannelNet.prototype.sendGetCashGiftInfo=function(open_id){console.log("channel "+ChannelMgr.ins().main_channel+" sendGetCashGiftInfo open_id:"+open_id);var bytes=this.getBytes(11);bytes.writeString(open_id);this.sendToServer(bytes)};ChannelNet.prototype.sendCheckCashGift=function(open_id,gift_id){console.log("channel "+ChannelMgr.ins().main_channel+" sendCheckCashGift open_id:"+open_id+" gift_id:"+gift_id);var bytes=this.getBytes(12);bytes.writeString(open_id);bytes.writeInt(gift_id);this.sendToServer(bytes)};ChannelNet.prototype.sendWithdrawGiftCash=function(open_id,gift_id){console.log("channel "+ChannelMgr.ins().main_channel+" sendWithdrawGiftCash open_id:"+open_id+" gift_id:"+gift_id);var bytes=this.getBytes(13);bytes.writeString(open_id);bytes.writeInt(gift_id);this.sendToServer(bytes)};ChannelNet.prototype.sendGetInviteInfo=function(){console.log("channel "+ChannelMgr.ins().main_channel+" sendGetInviteInfo");var bytes=this.getBytes(14);this.sendToServer(bytes)};ChannelNet.prototype.sendGetInviteReward=function(index){console.log("channel "+ChannelMgr.ins().main_channel+" sendGetInviteReward index = "+index);var bytes=this.getBytes(15);bytes.writeInt(index);this.sendToServer(bytes)};ChannelNet.prototype.sendGetClickGiftInfo=function(){console.log("channel "+ChannelMgr.ins().main_channel+" sendGetClickGiftInfo");var bytes=this.getBytes(16);this.sendToServer(bytes)};ChannelNet.prototype.sendGetClickGiftReward=function(id){console.log("channel "+ChannelMgr.ins().main_channel+" sendGetClickGiftReward");var bytes=this.getBytes(17);bytes.writeInt(id);this.sendToServer(bytes)};ChannelNet.prototype.sendGetFriendGiftInfo=function(){console.log("channel "+ChannelMgr.ins().main_channel+" sendGetFriendGiftInfo");var bytes=this.getBytes(18);this.sendToServer(bytes)};ChannelNet.prototype.sendGetFriendGiftReward=function(id){console.log("channel "+ChannelMgr.ins().main_channel+" sendGetFriendGiftReward");var bytes=this.getBytes(19);bytes.writeInt(id);this.sendToServer(bytes)};ChannelNet.prototype.postShareStart=function(bytes){var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code!=0){WarnWin.show(error_msg?error_msg:"error_code="+error_code,function(){},this,undefined,undefined,"sure");return}var type=bytes.readInt();var share_cnt=bytes.readInt();this.award_count[type]=share_cnt;var desc=bytes.readString();var img_url=bytes.readString();var title=bytes.readString();var content=bytes.readString();if(type==1){this.showShare(type,share_cnt,desc,img_url,title,content)}else if(type==2){this.showShortCut(type,share_cnt,desc)}else if(type==3){this.showShare1758(type,share_cnt,desc,img_url,title,content)}else if(type==4){this.showFollow1758(type,share_cnt,desc,img_url,title,content)}else if(type==6){this.showShareMSY(type,share_cnt,desc,img_url,title,content)}else if(type==7){this.showFollowMSY(type,share_cnt,desc,img_url,title,content)}else if(type==8){this.showShare20117(type,share_cnt,desc,img_url,title,content)}else if(type==9){this.showFollow20117(type,share_cnt,desc,img_url,title,content)}else if(type==10){this.showShare20118(type,share_cnt,desc,img_url,title,content)}else if(type==11){this.showFollow20118(type,share_cnt,desc,img_url,title,content)}return[type,share_cnt]};ChannelNet.prototype.showShare=function(type,share_cnt,desc,img_url,title,content){var self=this;this.curImgUrl=img_url;this.curTitle=title;this.curContent=content;WarnWin.show(desc,function(){self.sendShareEnd(type)},this,undefined,undefined,"sure")};ChannelNet.prototype.showShareMSY=function(type,share_cnt,desc,img_url,title,content){if(!ChannelMgr.ins().isMeiShengYuanChannelH5()){return}if(!Gmsy){ChannelMgr.ins().channelSDKInit();return}Gmsy.share(function(data){})};ChannelNet.prototype.showShare1758=function(type,share_cnt,desc,img_url,title,content){if(!ChannelMgr.ins().is1758Channel()){return}var self=this;this.curImgUrl=img_url;this.curTitle=title;this.curContent=content;var obj={server_id:LocationProperty.srvid,actor_id:Actor.actorID};WarnWin.show(desc,function(){window["HLMY_SDK"].setShareInfo({state:JSON.stringify(obj),type:"",tipInfo:true,reward:[]})},this,undefined,undefined,"sure")};ChannelNet.prototype.showFollow1758=function(type,share_cnt,desc,img_url,title,content){if(!ChannelMgr.ins().is1758Channel()){return}WarnWin.show(desc,function(){window["HLMY_SDK"].follow()},this,undefined,undefined,"sure")};ChannelNet.prototype.showFollowMSY=function(type,share_cnt,desc,img_url,title,content){if(!ChannelMgr.ins().isMeiShengYuanChannelH5()){return}if(!Gmsy){ChannelMgr.ins().channelSDKInit();return}Gmsy.focus();console.log("Gmsy.focus()")};ChannelNet.prototype.showShare20117=function(type,share_cnt,desc,img_url,title,content){if(!ChannelMgr.ins().isFKYLCChannel()){return}LoginMgr.openView(InviteWin,type,share_cnt)};ChannelNet.prototype.showFollow20117=function(type,share_cnt,desc,img_url,title,content){LoginMgr.openView(FollowWin,type)};ChannelNet.prototype.showShare20118=function(type,share_cnt,desc,img_url,title,content){if(!ChannelMgr.ins().isAWYCChannel()){return}LoginMgr.openView(InviteWin,type,share_cnt)};ChannelNet.prototype.showFollow20118=function(type,share_cnt,desc,img_url,title,content){LoginMgr.openView(FollowWin,type)};ChannelNet.prototype.showShortCut=function(type,share_cnt,desc){var self=this;WarnWin.show(desc,function(){if(ChannelMgr.ins().isChuDongChannel()&&typeof mqq!="undefined"){mqq.ui.addShortcut({action:"web",title:i18n("ChannelNet_0"),icon:window["OPEN_DATA"].appicon,url:window["OPEN_DATA"].jumpurl,callback:function(argus){console.log("mqq.ui.addShortcut callback");console.log(argus);if(argus["result"]!=0){WarnWin.show(argus.message?argus.message:"result="+argus["result"],function(){},this,undefined,undefined,"sure")}else{self.sendShareEnd(type)}}})}else{setTimeout(function(){WarnWin.show(i18n("ChannelNet_1"),function(){self.sendShareEnd(type)},this,undefined,undefined)},200)}},this,undefined,undefined,"sure")};ChannelNet.prototype.postShareEnd=function(bytes){var error_code=bytes.readInt();var error_msg=bytes.readString();var type=bytes.readInt();if(ChannelMgr.ins().is1758Channel()||ChannelMgr.ins().isMeiShengYuanChannelH5()){if(!error_code){console.log("doShareEnd: 1758 share or follow get award successfully");console.log("doShareEnd: msy share or follow get award successfully")}return error_code}if(ChannelMgr.ins().isFKYLCChannel()||ChannelMgr.ins().isAWYCChannel()||ChannelMgr.ins().isQQSmallGameChannel()){if(!error_code){console.log("doShareEnd: channel="+ChannelMgr.ins().main_channel+"_"+ChannelMgr.ins().sub_channel+" share_type="+type+" get award successfully")}return error_code}console.log("doShareEnd: error_code = "+error_code+", error_msg = "+error_msg);WarnWin.show(error_msg?error_msg:"error_code="+error_code,function(){},this,undefined,undefined,"sure");if(this.curShareType==1){if(ChannelMgr.ins().isChuDongChannel()&&typeof mqq!="undefined"){var self=this;mqq.ui.setOnShareHandler(function(type){console.log("mqq.ui.setOnShareHandler callback");mqq.ui.shareMessage({title:self.curTitle,desc:self.curContent,share_type:type,share_url:window["OPEN_DATA"].shareurl,image_url:window["OPEN_DATA"].appicon,back:true},function(result){console.log("mqq.ui.shareMessage callback");console.log(result)})});mqq.ui.showShareMenu({title:self.curTitle,desc:self.curContent,share_url:window["OPEN_DATA"].shareurl,image_url:window["OPEN_DATA"].appicon},function(result){console.log("mqq.ui.showShareMenu callback");console.log(result)})}else{alert(i18n("ChannelNet_2"))}}return error_code};ChannelNet.prototype.postAdInfo=function(bytes){var channel=bytes.readString();var count=bytes.readByte();this.ad_info={};var arr=[];for(var i=0;i<count;i++){var id=bytes.readByte();var state=bytes.readByte();arr[id]=state}this.ad_info[channel]=arr;this.offline_cnt=bytes.readByte();console.log("postAdInfo this.ad_Info:"+JSON.stringify(this.ad_info)+"\nthis.offline_cnt:"+this.offline_cnt);return[0,channel,adType.ad]};ChannelNet.prototype.postAdRewardRes=function(bytes){var errid=bytes.readByte();var channel=bytes.readString();var type=bytes.readByte();var id=bytes.readByte();if(type==adType.ad){if(!this.ad_info){this.ad_info={}}if(!this.ad_info[channel]){this.ad_info[channel]=[]}this.ad_info[channel][id]=1}if(errid==0&&type==adType.offline){WarnWin.show(i18n("ChannelNet_3",GlobalConfig.SmallGameBaseConfig.offlinePlus),function(){},this)}console.log("postAdRewardRes errid:"+errid+" channel:"+channel+" type:"+type+" id:"+id);return[errid,channel,type]};ChannelNet.prototype.postLoginInfo=function(bytes){var error_code=bytes.readInt();var left_period=bytes.readInt();var login_days=bytes.readInt();var open=bytes.readByte();var get_count=bytes.readInt();var left_count=bytes.readShort();var sum_cash=bytes.readShort();var withdraw_count=bytes.readShort();var withdraw_record=[];for(var i=0;i<withdraw_count;i++){var login_day=bytes.readShort();withdraw_record.push(login_day)}this.login_days=login_days;this.open=open;this.sum_cash=sum_cash;this.loginGift_left_period=left_period;this.loginGot=true;console.log("postLoginInfo error_code:"+error_code+" left_period:"+left_period+" login_days:"+login_days+" open:"+open+" get_count:"+get_count+" left_count:"+left_count+" sum_cash:"+sum_cash+" withdraw_count:"+withdraw_count+" withdraw_record:"+JSON.stringify(withdraw_record));if(!this.cashGot){return}if(left_period<=0){return}this.checkShowWin()};ChannelNet.prototype.postOpenLoginRedPacket=function(bytes){var error_code=bytes.readInt();var login_days=bytes.readInt();var cash=bytes.readInt();var sum_cash=bytes.readInt();console.log("postOpenLoginRedPacket error_code:"+error_code+" login_days:"+login_days+" cash:"+cash+" sum_cash:"+sum_cash);if(error_code==0){this.open=1;this.sum_cash=sum_cash}return[error_code,login_days,cash,sum_cash]};ChannelNet.prototype.postWithdrawLoginCash=function(bytes){var error_code=bytes.readInt();var login_days=bytes.readInt();var sum_cash=bytes.readInt();if(error_code==0){this.sum_cash=sum_cash}console.log("postWithdrawLoginCash error_code:"+error_code+" login_days:"+login_days+" sum_cash:"+sum_cash);return[error_code,login_days,sum_cash]};ChannelNet.prototype.postCashGiftInfo=function(bytes){var error_code=bytes.readInt();var left_period=bytes.readInt();var count=bytes.readInt();var cashGiftInfo=[];for(var i=0;i<count;i++){var gift_id=bytes.readInt();var buyed=bytes.readByte();var left_count=bytes.readInt();var sum_cash=bytes.readInt();var withdrew=bytes.readByte();cashGiftInfo[gift_id]={gift_id:gift_id,buyed:buyed,left_count:left_count,sum_cash:sum_cash,withdrew:withdrew}}this.cashGiftInfo=cashGiftInfo;this.cashGift_left_period=left_period;this.cashGot=true;console.log("postCashGiftInfo error_code:"+error_code+" CashGiftInfo:"+JSON.stringify(cashGiftInfo)+" left_period:"+left_period);if(!this.loginGot){return}if(left_period<=0){return}this.checkShowWin()};ChannelNet.prototype.postCheckCashGift=function(bytes){var error_code=bytes.readInt();var gift_id=bytes.readInt();console.log("postCheckCashGift error_code:"+error_code+" gift_id:"+gift_id);return[error_code,gift_id]};ChannelNet.prototype.postWithdrawGiftCash=function(bytes){var error_code=bytes.readInt();var gift_id=bytes.readInt();if(error_code==0){this.cashGiftInfo[gift_id].withdrew=1}console.log("postWithdrawGiftCash error_code:"+error_code+" gift_id:"+gift_id);return[error_code,gift_id]};ChannelNet.prototype.postInviteInfo=function(bytes){var error_code=bytes.readInt();var count=bytes.readInt();var got=bytes.readByte();if(error_code==0){this.inviteInfo={count:count,got:got}}console.log("postInviteInfo error_code:"+error_code+" count:"+count+" got:"+got);return[error_code,count,got]};ChannelNet.prototype.postInviteReward=function(bytes){var result=bytes.readInt();var index=bytes.readInt();if(result==0){this.inviteInfo["got"]=1}console.log("postInviteReward result:"+result+" index:"+index);return[result,index]};ChannelNet.prototype.postClickGiftInfo=function(bytes){var error_code=bytes.readInt();var today_cnt=bytes.readInt();var sum_cnt=bytes.readInt();var count=bytes.readInt();var gotArr=[];for(var i=0;i<count;i++){var index=bytes.readInt();gotArr.push(index)}if(error_code==0){this.clickGiftInfo={today_cnt:today_cnt,sum_cnt:sum_cnt,gotArr:gotArr}}console.log("postClickGiftInfo error_code:"+error_code+" today_cnt:"+today_cnt+" sum_cnt:"+sum_cnt+" gotArr:"+JSON.stringify(gotArr));return[error_code,today_cnt,sum_cnt,gotArr]};ChannelNet.prototype.postClickGiftReward=function(bytes){var error_code=bytes.readInt();var id=bytes.readInt();if(error_code==0){var gotArr=this.clickGiftInfo["gotArr"]||[];gotArr.push(id);this.clickGiftInfo["gotArr"]=gotArr}console.log("postClickGiftReward error_code:"+error_code+" id:"+id);return[error_code,id]};ChannelNet.prototype.postFriendGiftInfo=function(bytes){var error_code=bytes.readInt();var count=bytes.readInt();var info={};for(var i=0;i<count;i++){var id=bytes.readInt();var c=bytes.readInt();var status=bytes.readByte();info[id]={id:id,count:c,status:status}}if(error_code==0){this.friendGiftInfo=info}console.log("postFriendGiftInfo error_code:"+error_code+" friendGiftInfo:"+JSON.stringify(info));return[error_code,info]};ChannelNet.prototype.postFriendGiftReward=function(bytes){var error_code=bytes.readInt();var id=bytes.readInt();if(error_code==0){this.friendGiftInfo[id].status=1}console.log("postFriendGiftReward error_code:"+error_code+" id:"+id);return[error_code,id]};ChannelNet.prototype.getAdState=function(channel,id){return this.ad_info[channel]&&this.ad_info[channel][id]||0};ChannelNet.prototype.canGetAward=function(type){if(type===void 0){type=1}var c=this.award_count[type]||0;var limit=GlobalConfig.QzoneShareConfig[type].max_count;return c<limit};ChannelNet.prototype.canGetAdAward=function(type){if(type===void 0){type=0}var b=false;switch(type){case adType.ad:var channel=ChannelMgr.ins().getFullChannel();var cfg=GlobalConfig.AdRewardConfig[channel];for(var i in cfg){var conf=cfg[i];var id=conf.id;var state=this.getAdState(channel,id);if(state==0){b=true}}break;case adType.offline:var c=this.offline_cnt;var limit=GlobalConfig.SmallGameBaseConfig.offlineLimit;if(c<limit){b=true}break}return b};ChannelNet.prototype.playQQadVedio=function(type,cb){var adUnitId;switch(type){case adType.ad:adUnitId="99a660b058c9896d03d56ba97208fa4b";if(ChannelMgr.ins().isQQSmallGameChannel2()){adUnitId="9857a5ea957c643e095104d21a495b37"}break;case adType.offline:adUnitId="e1e0f8927cc273661c5b657a8f09b734";if(ChannelMgr.ins().isQQSmallGameChannel2()){adUnitId="09f107685fb5b0c2737dea744c324d08"}break}var videoAd=window["qq"].createRewardedVideoAd({adUnitId:adUnitId});videoAd.onError(function(res){console.log("videoAd onError",res)});videoAd.onLoad(function(res){console.log("videoAd onLoad",res)});videoAd.onClose(function(res){console.log("videoAd onClose",res);var isEnded=res.isEnded;if(isEnded){if(cb){console.log("video onClose cb()");cb()}dyb.advertisement("close",function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.advertisement(close):"+JSON.stringify(callback))})}videoAd.offClose(videoAd.onClose())});videoAd.load().then(function(){console.log("video load success");videoAd.show().then(function(){console.log("video show success");dyb.advertisement("show",function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.advertisement(show):"+JSON.stringify(callback))})}).catch(function(err){console.log("video show fail")})}).catch(function(err){console.log("video load fail")})};ChannelNet.prototype.getOpenId=function(){if(!ChannelMgr.ins().isQQSmallGameChannel()){return"openIdNull"}var str=window["DybUserInfo"]||"{}";var info=JSON.parse(str);var user=info.user;var openid=user&&user.openid||"openIdNull";return openid};ChannelNet.prototype.showLoginRedPoint=function(){var v=this.sum_cash/100;var login_days=this.login_days;var conf=GlobalConfig.LoginRebateConfig;var draw=conf[login_days]&&conf[login_days].draw||0;var b=draw==1&&v>0;return this.open==0||b};ChannelNet.prototype.showRechargeRedPoint=function(){var cfg=GlobalConfig.GiftRebateConfig;for(var k in cfg){var c=cfg[k];var giftId=c.id;var cashGiftInfo=this.cashGiftInfo[giftId];var buyed=cashGiftInfo&&cashGiftInfo.buyed||0;var withdrew=cashGiftInfo&&cashGiftInfo.withdrew||0;var b=!buyed||!withdrew;if(b){return b}}return false};ChannelNet.prototype.getClickGiftRewardState=function(id){var state=0;var gotArr=this.clickGiftInfo["gotArr"]||[];var got=gotArr.indexOf(id)>-1;if(got){state=2}else{var cfg=GlobalConfig.InviteClickGiftConfig[id];if(!cfg){return state}var count=cfg.count;var cur=this.clickGiftInfo["sum_cnt"]||0;if(cur>=count){state=1}else{state=0}}return state};ChannelNet.prototype.getFriendGiftRewardState=function(id){var state=0;var info=this.friendGiftInfo[id]||{};var got=info["status"]==1;if(got){state=2}else{var cfg=GlobalConfig.InviteFriendGiftConfig[id];if(!cfg){return state}var count=cfg.count;var cur=info["count"]||0;if(cur>=count){state=1}else{state=0}}return state};ChannelNet.prototype.qqSmallGameShare=function(){var openid=ChannelNet.ins().getOpenId();var main_channel=ChannelMgr.ins().main_channel;var param={title:"少侠，超保险修仙要不要来？",imageUrl:"https://cdnlytj.lkgame.com/game_space/lytj/download/img/share_"+main_channel+"_1.jpg",query:"invitor_open_id="+openid};dyb.share(param,function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.share param:"+JSON.stringify(param));console.log("channel "+ChannelMgr.ins().main_channel+" dyb.share callback:"+JSON.stringify(callback))})};ChannelNet.prototype.showInviteRedPoint=function(){var cfg=GlobalConfig.InviteGiftConfig;var rewards=cfg[1].rewards;var sum=cfg[1].count;var count=this.inviteInfo["count"]||0;var got=this.inviteInfo["got"]||0;if(count>=sum){if(got){return false}else{return true}}else{return false}};ChannelNet.prototype.showClickGiftRedPoint=function(){var cfg=GlobalConfig.InviteClickGiftConfig;for(var k in cfg){var id=cfg[k].id;var state=this.getClickGiftRewardState(id);if(state==1){return true}}return false};ChannelNet.prototype.showFriendGiftRedPoint=function(){var cfg=GlobalConfig.InviteFriendGiftConfig;for(var k in cfg){var id=cfg[k].id;var state=this.getFriendGiftRewardState(id);if(state==1){return true}}return false};ChannelNet.prototype.postShowIcon=function(){};ChannelNet.prototype.hideShare=function(){return false};ChannelNet.prototype.checkShowWin=function(){if(!ChannelMgr.ins().isQQSmallGameChannel()){return}if(OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)&&!ChannelMgr.ins().isRechargeHidden()){LoginMgr.getItem("SMALL_GAME_ACTIVITY_SHOWN",function(v){var now=GameServer.serverTime;var date=new Date(now);var day=date.getDate();if(v&&v!=""&&v!="null"&&v!="NULL"&&v!="undefined"){if(v!=day.toString()){LoginMgr.setItem("SMALL_GAME_ACTIVITY_SHOWN",day.toString());LoginMgr.openView(SmallGameHongBaoWin)}}else{LoginMgr.setItem("SMALL_GAME_ACTIVITY_SHOWN",day.toString());LoginMgr.openView(SmallGameHongBaoWin)}})}};return ChannelNet}(BaseSystem);__reflect(ChannelNet.prototype,"ChannelNet");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.channelNet=ChannelNet.ins.bind(ChannelNet)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var QQsmallgameActivityType;(function(QQsmallgameActivityType){QQsmallgameActivityType[QQsmallgameActivityType["invite"]=1]="invite";QQsmallgameActivityType[QQsmallgameActivityType["subscribe"]=2]="subscribe";QQsmallgameActivityType[QQsmallgameActivityType["addToDesktop"]=3]="addToDesktop";QQsmallgameActivityType[QQsmallgameActivityType["ad"]=4]="ad";QQsmallgameActivityType[QQsmallgameActivityType["hongbao"]=5]="hongbao";QQsmallgameActivityType[QQsmallgameActivityType["recharge"]=6]="recharge"})(QQsmallgameActivityType||(QQsmallgameActivityType={}));window["QQsmallgameActivityType"]=QQsmallgameActivityType;var adType;(function(adType){adType[adType["offline"]=0]="offline";adType[adType["ad"]=1]="ad"})(adType||(adType={}));window["adType"]=adType;var awardType;(function(awardType){awardType[awardType["qqSubscribe"]=13]="qqSubscribe";awardType[awardType["qqAddToDeskTop"]=14]="qqAddToDeskTop"})(awardType||(awardType={}));window["awardType"]=awardType;var ErrorEvent2=function(_super){__extends(ErrorEvent2,_super);function ErrorEvent2(s){var _this=_super.call(this,s)||this;_this.errorText="";return _this}return ErrorEvent2}(egret.Event);__reflect(ErrorEvent2.prototype,"ErrorEvent2");var LoadingTimeoutMgr=function(){function LoadingTimeoutMgr(){this.recordCnt=20;this.default_seconds=10}LoadingTimeoutMgr.ins=function(){if(this.singleton==null){this.singleton=new LoadingTimeoutMgr}return this.singleton};LoadingTimeoutMgr.prototype.pushRecentNetId=function(sysId,msgId){if(!sysId||!msgId)return;while(LoadingTimeoutMgr.recentNetIds.length>this.recordCnt-1){LoadingTimeoutMgr.recentNetIds.shift()}LoadingTimeoutMgr.recentNetIds.push(sysId+"-"+msgId)};LoadingTimeoutMgr.prototype.beginStep=function(stepId){if(!stepId||stepId<0)return;var beginStepIds=LoadingTimeoutMgr.beginStepIds;if(!beginStepIds[stepId]){beginStepIds[stepId]=(new Date).getTime()}};LoadingTimeoutMgr.prototype.endStep=function(stepId){LoadingTimeoutMgr.ins().timer();if(LoadingTimeoutMgr.beginStepIds[stepId])LoadingTimeoutMgr.beginStepIds[stepId]=null};LoadingTimeoutMgr.prototype.timer=function(){var beginStepIds=LoadingTimeoutMgr.beginStepIds;for(var stepId in beginStepIds){if(!stepId||!beginStepIds[stepId])continue;var beginTime=beginStepIds[stepId];var endTime=(new Date).getTime();var limitTime=LoadingTimeoutMgr.stepsInfo[stepId]?LoadingTimeoutMgr.stepsInfo[stepId].seconds:this.default_seconds;if((endTime-beginTime)/1e3>limitTime){LoadingTimeoutMgr.ins().reportTimeout(parseInt(stepId))}}};LoadingTimeoutMgr.prototype.reportTimeout=function(stepId){console.log("reportTimeout stepId = "+stepId);var userName="";if(LoginMgr.ins().userName)userName=LoginMgr.ins().userName;var infoObj={stepId:stepId,desc:LoadingTimeoutMgr.stepsInfo[stepId].desc,userid:userName,recentNetIds:LoadingTimeoutMgr.recentNetIds};this.sendInfo(infoObj)};LoadingTimeoutMgr.prototype.sendInfo=function(info){var request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;request.open(LoginMgr.preUrl+"send_client_status.php",egret.HttpMethod.GET);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.send(info);request.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this);request.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this);request.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)};LoadingTimeoutMgr.prototype.onPostComplete=function(event){console.log("report complete post ")};LoadingTimeoutMgr.prototype.onPostIOError=function(event){console.log("report IOError post : ",event)};LoadingTimeoutMgr.prototype.onPostProgress=function(event){};LoadingTimeoutMgr.STEPID_LOAD_RESOURCE=1;LoadingTimeoutMgr.STEPID_GET_SERVERS_LIST=2;LoadingTimeoutMgr.STEPID_GET_SERVER_IP=3;LoadingTimeoutMgr.STEPID_ENTER_GAME=4;LoadingTimeoutMgr.STEPID_GET_ROLES_LIST=5;LoadingTimeoutMgr.STEPID_CREATE_ROLES=6;LoadingTimeoutMgr.STEPID_ROLES_INTO_MAP=7;LoadingTimeoutMgr.stepsInfo={1:{desc:"加载资源->加载完成",seconds:10},2:{desc:"加载完成->获取游戏服务器列表成功",seconds:1},3:{desc:"获取游戏服务器列表成功->获取具体服务器地址成功",seconds:1},4:{desc:"点击进入游戏->连接游戏服务器",seconds:1},5:{desc:"连接游戏服务器成功->获取用户角色列表",seconds:3},6:{desc:"创建角色->进入地图",seconds:1},7:{desc:"获取用户角色列表成功->进入地图",seconds:1}};LoadingTimeoutMgr.recentNetIds=[];LoadingTimeoutMgr.beginStepIds={};return LoadingTimeoutMgr}();__reflect(LoadingTimeoutMgr.prototype,"LoadingTimeoutMgr");var g_login_session="";window["g_login_session"]=g_login_session;var g_auto_login=false;window["g_auto_login"]=g_auto_login;var LoginMgr=function(_super){__extends(LoginMgr,_super);function LoginMgr(){var _this=_super.call(this)||this;_this.userName="";_this.isSavePwd=true;_this.hadOpenLoginSkin=false;_this.errorTxt="";_this.errorEvent2=new ErrorEvent2(LoginMgr.EVENT_LOGIN_ERROR);_this.hadOpenLoginWin=false;_this.autoRetryCount=0;_this.antiAddctionInited=false;_this.lastATCheckTick=null;_this.lastATCheckSecInDay=null;_this.AT_START_DAY_SEC=8*3600;_this.AT_END_DAY_SEC=22*3600;_this.AT_CAN_PLAY_TIME=5400;_this.AT_HINT_SECS=[10*60,5*60,3*60,2*60,1*60];egret.ExternalInterface.addCallback("localStorageGetItemCb",LoginMgr.getItemCB);return _this}LoginMgr.ins=function(){if(this._LoginMgr==null){this._LoginMgr=new LoginMgr}return this._LoginMgr};LoginMgr.onResLoaded=function(){this.resLoaded=true;this.openViewQueue()};LoginMgr.openViewQueue=function(){for(var _i=0,_a=this.viewQueue;_i<_a.length;_i++){var vq=_a[_i];ViewManager.ins().open.apply(ViewManager.ins(),vq)}this.viewQueue=[]};LoginMgr.openView=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}if(this.resLoaded){ViewManager.ins().open.apply(ViewManager.ins(),params)}else{this.viewQueue.push(params)}};LoginMgr.getItemCB=function(ret){console.log("getItemCB",ret);var p=ret.indexOf(",");var idx=ret.substr(0,p);ret=ret.substr(p+1,ret.length-p-1);if(LoginMgr.__getItemCB!=null&&LoginMgr.__getItemCB[idx]!=null){LoginMgr.__getItemCB[idx](ret);delete LoginMgr.__getItemCB[idx]}};LoginMgr.checkAutoTestParam=function(key,cb){var autoTestSavedUserID=GetUrlParam(key);if(autoTestSavedUserID!=null&&autoTestSavedUserID!=""){if(cb){cb(autoTestSavedUserID)}return true}return false};LoginMgr.getItem=function(key,cb){if(key=="__savedUserID"&&this.checkAutoTestParam("__atsuid",cb)){return}if(key=="__savedPwd"&&this.checkAutoTestParam("__atspwd",cb)){return}if(Recharge.ins().plat=="as"&&!ChannelMgr.ins().isYaoShengChannel()){if(LoginMgr.__getItemCB==null){LoginMgr.__getItemCB={}}if(LoginMgr["localStorageGetItem_idx"]==null){LoginMgr["localStorageGetItem_idx"]=0}LoginMgr["localStorageGetItem_idx"]++;LoginMgr.__getItemCB[""+LoginMgr["localStorageGetItem_idx"]]=cb;egret.ExternalInterface.call("localStorageGetItem",LoginMgr["localStorageGetItem_idx"]+","+key)}else{var v=egret.localStorage.getItem(key);if(cb)cb(v)}};LoginMgr.setItem=function(key,value){if(Recharge.ins().plat=="as"&&!ChannelMgr.ins().isYaoShengChannel()){egret.ExternalInterface.call("localStorageSetItem",key+","+value)}else{egret.localStorage.setItem(key,value)}};LoginMgr.prototype.checkEnv=function(){if(Recharge.ins().plat=="as"){LoginMgr.isIOS=true}else{LoginMgr.isIOS=false}};LoginMgr.sendRequest=function(reqUrl,data,onComplete,onCompleteObj,onIoError,onIoErrorObj,method){if(method===void 0){method="POST"}var request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;request.open(reqUrl,method);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.send(data);request.addEventListener(egret.Event.COMPLETE,onComplete,onCompleteObj);request.addEventListener(egret.IOErrorEvent.IO_ERROR,onIoError,onIoErrorObj)};LoginMgr.request=function(reqUrl,data,success,fail,method){if(method===void 0){method="POST"}this.sendRequest(reqUrl,data,function(event){var request=event.currentTarget;try{var response=JSON.parse(request.response);if(response&&response.errcode==0){success(response)}else{console.error(reqUrl+", response: "+request.response);fail(response)}}catch(e){console.error(reqUrl+", response: "+request.response);console.error(e);fail(request.response)}},this,function(event){fail(null)},this,method)};LoginMgr.prototype.getSession=function(){var _this=this;LoginMgr.openView(ConnectingWin);LoginMgr.request(LoginMgr.preUrl+"session.php",undefined,function(response){ViewManager.ins().close(ConnectingWin);g_login_session=response.session;_this.autoLogin()},function(response){ViewManager.ins().close(ConnectingWin);_this.sendErrorText(i18n("LoginMgr_1"));LoginMgr.openView(LoginFailedWin)},"GET")};LoginMgr.prototype.autoLogin=function(){var __this=this;this.autoRetryCount=0;LoginMgr.getItem("__savedUserID",function(userid){LoginMgr.getItem("__savedPwd",function(pwd){if(ChannelMgr.ins().isThirdChannel()){__this.postUserInfo(userid,pwd);return}if(userid!=null&&userid!=""){if(pwd!=null&&pwd!=""){g_auto_login=true;__this.postUserInfo(userid,pwd)}else{LoginMgr.openView(LoginWin)}}else{if(LoginMgr.isIOS){LoginMgr.openView(LoginWin)}else{g_auto_login=true;RegisterMgr.isn().autoRegister()}}})})};LoginMgr.prototype.postUserInfo=function(accInput,pwdInput){this.postedAccInput=accInput;this.postedPwdInput=pwdInput;if(ChannelMgr.ins().isDiMaiChannel()==true){this.postDiMaiUserInfo();return}if(ChannelMgr.ins().isAnQiGeChannel()==true){this.postAnQiGeUserInfo();return}if(ChannelMgr.ins().isDouYuChannel()==true){this.postDouYuUserInfo();return}if(ChannelMgr.ins().is52ggChannel()==true){this.post52ggUserInfo();return}if(ChannelMgr.ins().isTongChengChannel()==true){this.postTongChengUserInfo();return}if(ChannelMgr.ins().isQQZoneChannel()==true){this.postQQZoneUserInfo();return}if(ChannelMgr.ins().isQQDaTingChannel()==true){this.postQQDaTingUserInfo();return}if(ChannelMgr.ins().isHuanYouChannel()==true){this.postHuanYouUserInfo();return}if(ChannelMgr.ins().isHuanYouChannel2()==true){this.postHuanYouUserInfo();return}if(ChannelMgr.ins().isJuHeAppChannel()==true){this.postJuHe();return}if(ChannelMgr.ins().isQuickAppSDKChannel()==true){this.postQuickAppUserInfo();return}if(ChannelMgr.ins().isChuDongChannel()==true){this.postChuDongUserInfo();return}if(ChannelMgr.ins().isQuickH5SDKChannel()==true){this.postQuickh5UserInfo();return}if(ChannelMgr.ins().isMiJuChannel()==true){this.postMiJuUserInfo();return}if(ChannelMgr.ins().isGuoPanChannel()==true){this.postGuoPanUserInfo();return}if(ChannelMgr.ins().isMeiShengYuanChannel()==true){this.postMeiShengYuanUserInfo();return}if(ChannelMgr.ins().isYouXiFanChannel()==true){this.postYouXiFanUserInfo();return}if(ChannelMgr.ins().isXianTuChannel()==true){this.postXianTuUserInfo();return}if(ChannelMgr.ins().isYiYouChannel()==true){this.postYiYouUserInfo();return}if(ChannelMgr.ins().isChongChongChannel()){this.postChongChongUserInfo();return}if(ChannelMgr.ins().isZiXiaChannel()){this.postZiXiaUserInfo();return}if(ChannelMgr.ins().is511WanChannel()){this.post511WanUserInfo();return}if(ChannelMgr.ins().is1758Channel()){this.post1758UserInfo();return}if(ChannelMgr.ins().isYouTuoBangChannel()){this.postYouTuoBangUserInfo();return}if(ChannelMgr.ins().isFKYLCChannel()){this.postFKYLCUserInfo();return}if(ChannelMgr.ins().isAWYCChannel()){this.postAWYUserInfo();return}if(ChannelMgr.ins().isQQSmallGameChannel()){this.postQQSmallGameUserInfo();return}if(ChannelMgr.ins().isWXSmallGameChannel()){this.postWXSmallGameUserInfo();return}if(ChannelMgr.ins().isDuoYouChannel()){this.postDuoYouUserInfo();return}if(g_auto_login){this._postUserInfo(accInput,pwdInput);if(window["isIOS_AppStore"]==true){LoginMgr.openView(ConnectingWin)}}else{this._postUserInfo(accInput,pwdInput)}};LoginMgr.prototype.sendLoginReq=function(params){var _this=this;LoginMgr.request(LoginMgr.preUrl+"login.php",params,function(response){var username=response.username||_this.userName;var pwd=_this.pwd;LocationProperty.accountUserID=response.userid;LocationProperty.openID=username;LocationProperty.password=md5_lytj.hex_md5(pwd).toLowerCase();LoginMgr.setItem("__savedUserID",username);if(_this.isSavePwd){LoginMgr.setItem("__savedPwd",pwd)}if(_this.hadOpenLoginSkin){ViewManager.ins().close(LoginWin);ViewManager.ins().close(ConnectingWin)}LoginMgr.openView(StartGameWin);SelectServerMgr.ins().getServersInfo();if(ChannelMgr.ins().isYiYouChannel()){var code=response.gametoken;if(code){ChannelMgr.ins().channelReport(code)}else{alert(i18n("LoginMgr_7"))}}if(ChannelMgr.ins().isDouYinChannel()){ChannelMgr.ins().channelReport(7,response.userid)}if(ChannelMgr.ins().isAWYCChannel()){var str=ChannelMgr.ins().extern_args||"{}";var obj=JSON.parse(str);var channel_username=response.channel_username||"no_channel_username";obj["userId"]=channel_username;ChannelMgr.ins().extern_args=JSON.stringify(obj);console.log("channel 20118 extern_args = "+ChannelMgr.ins().extern_args)}},function(response){if(response&&response.info){if(!ViewManager.ins().isShow(LoginWin)){LoginMgr.openView(LoginWin)}_this.sendErrorText(response.info)}else{_this.autoRetry();_this.sendErrorText(i18n("LoginMgr_9"))}})};LoginMgr.prototype._postUserInfo=function(accInput,pwdInput){this.hadSend=true;var params="type=login&username="+accInput+"&pass="+pwdInput+"&vercode=1234&session="+g_login_session;params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=accInput;this.pwd=pwdInput;console.log("postUserInfo ",params);this.sendLoginReq(params)};LoginMgr.prototype.postHuanYouUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var username=GetUrlParam("username");var pid=GetUrlParam("pid");var gid=GetUrlParam("gid");var obj={username:username,pid:pid,gid:gid};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=username;this.pwd="HuanYouNoPWD";console.log("postHuanYouUserInfo ",params);this.sendLoginReq(params)};LoginMgr.prototype.postDiMaiUserInfo=function(){var _this=this;this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];console.log("postDiMaiUserInfo start");var params="type=channel_login&vercode=1234&session="+g_login_session;var userInfo;if(typeof glSdk!="undefined"){glSdk.getUserInfo(function(res){userInfo=res;console.log("postDiMaiUserInfo userInfo:",userInfo);var userInfoObj=userInfo;var obj={pid:userInfoObj.pid,gid:userInfoObj.gid,mid:userInfoObj.mid,access_token:userInfoObj.accessToken,server_id:userInfoObj.serverId};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();params+="&pid="+obj.pid+"&gid="+obj.gid+"&mid="+obj.mid+"&accessToken="+obj.access_token+"&serverId="+obj.server_id;_this.userName="DiMaiUser";_this.pwd="DiMaiNoPWD";console.log("postDiMaiUserInfo params:",params);_this.sendLoginReq(params)})}};LoginMgr.prototype.postAnQiGeUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var Ugameid=GetUrlParam("Ugameid");var Uid=GetUrlParam("Uid");var Time=GetUrlParam("Time");var Sign=GetUrlParam("Sign");var obj={Ugameid:Ugameid,Uid:Uid,Time:Time,Sign:Sign};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName="AnQiGeUser";this.pwd="AnQiGepwd";console.log("postAnQiGeUserInfo【"+ChannelMgr.ins().main_channel+"_"+ChannelMgr.ins().sub_channel+"】 ",params);this.sendLoginReq(params)};LoginMgr.prototype.postDouYuUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var uid=GetUrlParam("uid");var is_adult=GetUrlParam("is_adult");var pt_vip=GetUrlParam("pt_vip");var game_id=GetUrlParam("game_id");var c_game_id=GetUrlParam("c_game_id");var fdata=GetUrlParam("fdata");var guid=GetUrlParam("guid");var device_info=GetUrlParam("device_info");var time=GetUrlParam("time");var sign=GetUrlParam("sign");var params="type=channel_login&vercode=1234&session="+g_login_session;var obj={uid:uid,is_adult:is_adult,pt_vip:pt_vip,game_id:game_id,c_game_id:c_game_id,fdata:fdata,guid:guid,device_info:device_info,time:time,sign:sign};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName="DouYuUser";this.pwd="DouYupwd";console.log("postDouYuUserInfo【"+ChannelMgr.ins().main_channel+"_"+ChannelMgr.ins().sub_channel+"】 ",params);this.sendLoginReq(params)};LoginMgr.prototype.post52ggUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var channelExt=GetUrlParam("channelExt");var game_appid=GetUrlParam("game_appid");var user_id=GetUrlParam("user_id");var sdklogindomain=GetUrlParam("sdklogindomain");var sdkloginmodel=GetUrlParam("sdkloginmodel");var sign=GetUrlParam("sign");var params="type=channel_login&vercode=1234&session="+g_login_session;var obj={channelExt:channelExt,game_appid:game_appid,user_id:user_id,sdklogindomain:sdklogindomain,sdkloginmodel:sdkloginmodel,sign:sign};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName="52ggUser";this.pwd="52ggpwd";console.log("post52ggUserInfo【"+ChannelMgr.ins().main_channel+"_"+ChannelMgr.ins().sub_channel+"】 ",params);this.sendLoginReq(params)};LoginMgr.prototype.postTongChengUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var AppId=GetUrlParam("AppId");var UserId=GetUrlParam("UserId");var NickName=GetUrlParam("NickName");var Timestamp=GetUrlParam("Timestamp");var Ext=GetUrlParam("Ext");var Sign=GetUrlParam("Sign");var params="type=channel_login&vercode=1234&session="+g_login_session;var obj={AppId:AppId,UserId:UserId,NickName:NickName,Timestamp:Timestamp,Ext:Ext,Sign:Sign};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName="TongChengYouUser";this.pwd="TongChengYoupwd";console.log("postTongChengYouUserInfo【"+ChannelMgr.ins().main_channel+"_"+ChannelMgr.ins().sub_channel+"】 ",params);this.sendLoginReq(params)};LoginMgr.prototype.postQuickAppUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var username=GetUrlParam("username");var uid=GetUrlParam("uid");var token=GetUrlParam("token");var obj={username:username,uid:uid,token:token};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();if(ChannelMgr.ins().isYouMaAppChannel()){var pd=ChannelMgr.ins().getProductCode();params+="&productCode="+pd;var obj2={username:username,uid:uid,token:token,productCode:pd};ChannelMgr.ins().extern_args=JSON.stringify(obj2)}this.userName=username;this.pwd="QuickAppNoPWD";console.log("postQuickAppUserInfo【"+ChannelMgr.ins().main_channel+"_"+ChannelMgr.ins().sub_channel+"】 ",params);this.sendLoginReq(params)};LoginMgr.prototype.postJuHe=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var username=GetUrlParam("channel_openid");var uid=GetUrlParam("user_id");var token=GetUrlParam("token");var obj={username:username,uid:uid,token:token};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=username;this.pwd="juheAPPpwd";console.log("postJuheUserInfo【"+ChannelMgr.ins().main_channel+"_"+ChannelMgr.ins().sub_channel+"】 ",params);this.sendLoginReq(params)};LoginMgr.prototype.postQQZoneUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;if(urlParams){params+="&"+urlParams}var seqid=GetUrlParam("seqid");var openid=GetUrlParam("openid");var openkey=GetUrlParam("openkey");var platform=GetUrlParam("platform");var pf=GetUrlParam("pf");var pfkey=GetUrlParam("pfkey");var serverid=GetUrlParam("serverid");var s=GetUrlParam("s");var obj={openid:openid,seqid:seqid,openkey:openkey,platform:platform,pf:pf,pfkey:pfkey,serverid:serverid,s:s};ChannelMgr.ins().extern_args=JSON.stringify(obj);params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName="QQZoneUsername";this.pwd="QQZoneNoPWD";console.log("postQQZoneUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postQQDaTingUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;if(urlParams){params+="&"+urlParams}var appid=GetUrlParam("appid");var openid=GetUrlParam("openid");var openkey=GetUrlParam("openkey");var platform=GetUrlParam("platform");var pf=GetUrlParam("pf");var pfkey=GetUrlParam("pfkey");var serverid=GetUrlParam("serverid");var sig=GetUrlParam("sig");var obj={openid:openid,appid:appid,openkey:openkey,platform:platform,pf:pf,pfkey:pfkey,serverid:serverid,sig:sig};ChannelMgr.ins().extern_args=JSON.stringify(obj);params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName="QQDaTingUsername";this.pwd="QQDaTingNoPWD";console.log("postQQDaTingUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postChuDongUserInfo=function(){this.hadSend=true;var url=window["OPEN_DATA"].appurl.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var appid=window["OPEN_DATA"].appid;var openid=window["OPEN_DATA"].openid;var openkey=window["OPEN_DATA"].openkey;var zoneid=window["OPEN_DATA"].platform;var qua=window["OPEN_DATA"].qua;var pf=window["OPEN_DATA"].pf;var obj={openid:openid,zoneid:zoneid,appid:appid,itemid:"",count:1,qua:qua,pf:pf,openkey:openkey};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}var plat=zoneid==2?103:102;params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+plat;params+="&appid="+appid;this.userName=openid;this.pwd="ChuDongNoPWD";console.log("postChuDongUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postQuickh5UserInfo=function(){var self=this;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;console.log("postQuickh5 urlParams:",urlParams);var cb=function(data){var uid=data.uid;var username=data.username;var token=data.token;var isLogin=data.isLogin;var channeId=data.channeId;var obj={uid:uid,username:username,token:token,isLogin:isLogin,channeId:channeId};ChannelMgr.ins().extern_args=JSON.stringify(obj);params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();params+="&uid="+uid+"&username="+username+"&token="+token+"&isLogin="+isLogin+"&channeId="+channeId;if(ChannelMgr.ins().isYouMaH5Channel()){var pd=ChannelMgr.ins().getProductCode();var obj2={uid:uid,username:username,token:token,isLogin:isLogin,channeId:channeId,productCode:pd};ChannelMgr.ins().extern_args=JSON.stringify(obj2)}self.userName=username;self.pwd="Quickh5NoPWD";console.log("postQuickh5UserInfo["+ChannelMgr.ins().main_channel+"]:",params);self.hadSend=true;self.sendLoginReq(params)};QuickSDK.login(function(res){var message;if(res.status){console.log(i18n("LoginMgr_4")+res.data.uid);cb(res.data)}else{console.log(i18n("LoginMgr_5")+res.message);WarnWin.show(i18n("LoginMgr_6")+res.message,null,null,null,null,"sure")}})};LoginMgr.prototype.postMiJuUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var username=GetUrlParam("nickname");var token=GetUrlParam("token");var pid=GetUrlParam("pid");var obj={username:username,token:token,pid:pid};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=username;this.pwd="MiJuNoPWD";console.log("postMiJuUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postChongChongUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var uid=GetUrlParam("uid");var token=GetUrlParam("token");var userName=GetUrlParam("userName");var obj={uid:uid,token:token,userName:userName};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=userName;this.pwd="ChongChongNoPWD";console.log("postChongChongUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postMeiShengYuanUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var plat=GetUrlParam("plat");var obj={};if(plat&&(plat=="102"||plat=="103")){var uid=GetUrlParam("uid");var token=GetUrlParam("token");obj={uid:uid,token:token}}else{var appid=GetUrlParam("appid");var userid=GetUrlParam("userid");var from=GetUrlParam("from")||"msy";obj={appid:appid,userid:userid,from:from}}ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName="meishengyuan";this.pwd="MeiShengYuanNoPWD";console.log("postMeiShengYuanUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postYouXiFanUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var sessionId=GetUrlParam("sessionId");var userName=GetUrlParam("userName");var appId=GetUrlParam("appId");var pid=GetUrlParam("pid");var id=GetUrlParam("id");var obj={sessionId:sessionId,userName:userName,appId:appId,pid:pid,id:id};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=id;this.pwd="YouXiFanNoPWD";console.log("postYouXiFanUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postXianTuUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var uid=GetUrlParam("uid");var token=GetUrlParam("token");var obj={uid:uid,token:token};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=uid;this.pwd="XianTuNoPWD";console.log("postXianTuUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postYiYouUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var userId=GetUrlParam("userId");var accessToken=GetUrlParam("accessToken");var expires=GetUrlParam("expires");var obj={userId:userId,accessToken:accessToken,expires:expires};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=userId;this.pwd="YiYouNoPWD";console.log("postYiYouUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postGuoPanUserInfo=function(){console.log("postGuoPanUserInfo location.href:"+location.href);this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="type=channel_login&vercode=1234&session="+g_login_session;var appid=GetUrlParam("guopanAppId");var uid=GetUrlParam("loginUin");var token=GetUrlParam("loginToken");var username=GetUrlParam("accountName");var time="";var sign="";var uid2=GetUrlParam("game_uin");var time2=GetUrlParam("time");var sign2=GetUrlParam("sign");if(uid2){uid=uid2}if(time2){time=time2}if(sign2){sign=sign2}var obj={appid:appid,uid:uid,token:token,username:username};ChannelMgr.ins().extern_args=JSON.stringify(obj);params+="&appid="+appid+"&uid="+uid+"&token="+token+"&username="+username+"&time="+time+"&sign="+sign;params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=username;this.pwd="GuoPanNoPWD";console.log("postGuoPanUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postZiXiaUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="vercode=1234&session="+g_login_session;var uid=GetUrlParam("uid");var platfrom=GetUrlParam("platfrom");var gkey=GetUrlParam("gkey");var skey=GetUrlParam("skey");var is_adult=GetUrlParam("is_adult");var back_url=GetUrlParam("back_url");var type=GetUrlParam("type");var obj={uid:uid,platfrom:platfrom,gkey:gkey,skey:skey,is_adult:is_adult,back_url:back_url,type:type};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&type=channel_login&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=uid;this.pwd="ZiXiaNoPWD";console.log("postZiXiaUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postFKYLCUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="vercode=1234&session="+g_login_session;var userId=GetUrlParam("userId");var isSubscribe=GetUrlParam("isSubscribe")||"false";if(isSubscribe=="false"){window["20117follow"]=false}else if(isSubscribe=="true"){window["20117follow"]=true}else{window["20117follow"]=false}console.log("channel 20117 isSubscribe = "+isSubscribe);var obj={userId:userId,main_channel:ChannelMgr.ins().main_channel,sub_channel:ChannelMgr.ins().sub_channel};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&type=channel_login&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=userId;this.pwd="FKYLCNoPWD";console.log("postFKYLCUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postAWYUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="vercode=1234&session="+g_login_session;var token=GetUrlParam("token");var fuid=GetUrlParam("fuid");var focus=GetUrlParam("focus");var chid=GetUrlParam("chid");var verify=GetUrlParam("verify");var wallow=GetUrlParam("wallow");window["20118focus"]=focus==1||false;window["20118chid"]=chid||false;window["20118verify"]=verify==1||false;window["20118wallow"]=wallow==1||false;var obj={token:token,main_channel:ChannelMgr.ins().main_channel,sub_channel:ChannelMgr.ins().sub_channel};ChannelMgr.ins().extern_args=JSON.stringify(obj);console.log("channel 20118 extern_args = "+ChannelMgr.ins().extern_args);if(urlParams){params+="&"+urlParams}params+="&type=channel_login&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=token;this.pwd="AWYNoPWD";console.log("postAWYUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postQQSmallGameUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="vercode=1234&session="+g_login_session;var main_channel=ChannelMgr.ins().main_channel;var str=window["DybUserInfo"]||"";if(!str){var self_12=this;dyb.getDybUserInfo(function(callback){var str=JSON.stringify(callback);console.log("getDybUserInfo:"+str);window["DybUserInfo"]=str;var openid=callback.user.openid;var param={title:"少年请留步，您的神武掉了",imageUrl:"https://cdnlytj.lkgame.com/game_space/lytj/download/img/share_"+main_channel+"_2.jpg",query:"invitor_open_id="+openid};dyb.onShare(param,function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.onShare param:"+JSON.stringify(param));console.log("channel "+ChannelMgr.ins().main_channel+" dyb.onShare callback:"+JSON.stringify(callback))});self_12.postQQSmallGameUserInfo()});return}var info=JSON.parse(str);var user=info.user;var openid=user&&user.openid||0;var sign=user&&user.sign||"undefined";params+="&openid="+openid+"&sign="+sign;var obj={open_id:openid,invitor_open_id:egret.getOption("invitor_open_id")||"",main_channel:main_channel,sub_channel:ChannelMgr.ins().sub_channel};str=JSON.stringify(obj);ChannelMgr.ins().extern_args=str;console.log("channel "+ChannelMgr.ins().main_channel+" extern_args = "+ChannelMgr.ins().extern_args);if(urlParams){params+="&"+urlParams}params+="&type=channel_login&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=openid;this.pwd="QQSmallGameNoPWD";console.log("postQQSmallGameUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postWXSmallGameUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="vercode=1234&session="+g_login_session;var str=window["qingjsUserInfo"]||"";if(!str){var self_13=this;qingjs.instance.login({},function(loginResult){console.log("登录结束回调数据");console.log(loginResult);window["qingjsUserInfo"]=JSON.stringify(loginResult);self_13.postWXSmallGameUserInfo()});return}var info=JSON.parse(str);var code=info.code;var uid=info.uid||0;var token=info.token||0;var message=info.message||"";params+="&code="+code+"&uid="+uid+"&token="+token+"&message="+message;ChannelMgr.ins().extern_args=str;console.log("channel "+ChannelMgr.ins().main_channel+" extern_args = "+ChannelMgr.ins().extern_args);if(urlParams){params+="&"+urlParams}params+="&type=channel_login&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=uid;this.pwd="WXSmallGameNoPWD";console.log("postWXSmallGameUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postDuoYouUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];console.log("postDuoYouUserInfo start");var params="type=channel_login&vercode=1234&session="+g_login_session;var userInfo;var self=this;if(typeof dy_jh_sdk!="undefined"){dy_jh_sdk.h5UserInfo({},function(user_info){console.log("postDuoYouUserInfo userInfo:",user_info);var userInfoObj=user_info;var obj={app_id:userInfoObj.app_id,user_id:userInfoObj.user_id,user_name:userInfoObj.user_name,extra:userInfoObj.extra,sign:userInfoObj.sign,main_channel:ChannelMgr.ins().main_channel};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();params+="&app_id="+obj.app_id+"&user_id="+obj.user_id+"&user_name="+obj.user_name+"&extra="+obj.extra+"&sign="+obj.sign;self.userName="DuoyouUser";self.pwd="DuoyouPWD";console.log("postDuoyouUserInfo params:",params);self.sendLoginReq(params)})}};LoginMgr.prototype.post511WanUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="vercode=1234&session="+g_login_session;var uid=GetUrlParam("uid");var time=GetUrlParam("time");var sign=GetUrlParam("sign");var obj={uid:uid,time:time,sign:sign};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&type=channel_login&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=uid;this.pwd="511WanNoPWD";console.log("post511WanUserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.postYouTuoBangUserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="vercode=1234&session="+g_login_session;if(urlParams){params+="&"+urlParams}var YTB_DATA=window["YTB_DATA"];if(YTB_DATA){ChannelMgr.ins().extern_args=JSON.stringify(YTB_DATA);var username=YTB_DATA.username;var uid=YTB_DATA.uid;var password=YTB_DATA.password;var tel=YTB_DATA.tel;var sign=YTB_DATA.sign;var ts=YTB_DATA.ts;if(username){params+="&username="+username}if(uid){params+="&uid="+uid}if(password){params+="&password="+password}if(tel){params+="&tel="+tel}if(sign){params+="&sign="+sign}if(ts){params+="&ts="+ts}params+="&type=channel_login&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=uid;this.pwd="YouTuoBangNoPWD";console.log("postYouTuoBangUserInfo",params);this.sendLoginReq(params)}else{console.log("window[YTB_DATA] = null!")}};LoginMgr.prototype.post1758UserInfo=function(){this.hadSend=true;var url=location.href.split("?");var urlParams=url[1];var params="vercode=1234&session="+g_login_session;var appKey=GetUrlParam("appKey");var userToken=GetUrlParam("userToken");var state=GetUrlParam("state");var hlmy_gw=GetUrlParam("hlmy_gw");var hlmy_gp=GetUrlParam("hlmy_gp");var nonce=GetUrlParam("nonce");var timestamp=GetUrlParam("timestamp");var sign=GetUrlParam("sign");var gid=window["1758gid"];var obj={appKey:appKey,userToken:userToken,state:state,hlmy_gw:hlmy_gw,hlmy_gp:hlmy_gp,nonce:nonce,timestamp:timestamp,sign:sign,gid:gid};ChannelMgr.ins().extern_args=JSON.stringify(obj);if(urlParams){params+="&"+urlParams}params+="&gid="+gid;params+="&type=channel_login&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();this.userName=userToken;this.pwd="1758NoPWD";console.log("post1758UserInfo",params);this.sendLoginReq(params)};LoginMgr.prototype.autoRetry=function(){var _this=this;console.log("RegisterMgr autoRetry 1");if(this.autoRetryCount<10){console.log("RegisterMgr autoRetry 2");this.autoRetryCount+=1;TimerManager.ins().doTimer(this.autoRetryCount*300,1,function(){_this.postUserInfo(_this.postedAccInput,_this.postedPwdInput)},this)}else{console.log("RegisterMgr autoRetry 3");if(ViewManager.ins().getView(LoginWin)==null){ChannelMgr.ins().reload()}}};LoginMgr.prototype.sendErrorText=function(errorText){if(this.errorEvent2==null){this.errorEvent2=new ErrorEvent2(LoginMgr.EVENT_LOGIN_ERROR)}g_auto_login=false;this.errorEvent2.errorText=errorText;this.dispatchEventWith(LoginMgr.EVENT_LOGIN_ERROR,false,this.errorEvent2)};LoginMgr.prototype.sendSubmitRealName=function(real_name,identify){var params="type=submit_realname&real_name="+encodeURIComponent(real_name)+"&identify="+identify+"&session="+g_login_session;var request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;request.open(LoginMgr.preUrl+"login.php",egret.HttpMethod.POST);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.addEventListener(egret.Event.COMPLETE,function(event){console.log(event)},this);request.send(params);this.realNameReq=request};LoginMgr.prototype.sendGetAccountInfo=function(callback){var params="type=get_account_info&session="+g_login_session;var request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;request.open(LoginMgr.preUrl+"login.php",egret.HttpMethod.POST);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.addEventListener(egret.Event.COMPLETE,function(event){var request=event.currentTarget;try{var response=JSON.parse(request.response);if(response){LoginMgr.ins().isRealName=response.is_real_name;LoginMgr.ins().game_time=response.game_time;LoginMgr.ins().age=response.age;LoginMgr.ins().is_older_user=response.is_older_user;LoginMgr.ins().server_time=response.server_time;LoginMgr.ins().game_time_tick=egret.getTimer()}}catch(e){console.log("ERROR: ",request)}callback()},this);request.send(params);this.getAccountInfoReq=request};LoginMgr.prototype.checkAntiAddiction=function(){if(this.age>=18||this.is_older_user){return null}if(this.game_time>=this.AT_CAN_PLAY_TIME){return i18n("LoginMgr_11")}if(this.server_time!=null&&this.server_time.length>=14){var hour=parseInt(this.server_time.substr(8,2));if(hour>=22||hour<8){return i18n("LoginMgr_12")}}return null};LoginMgr.prototype.needAntiAddiction=function(){return this.anti_addiction==1&&(this.age==null||this.age<18)};LoginMgr.prototype.initAntiAddctionTimer=function(){if(!this.antiAddctionInited){this.antiAddctionInited=true;var self=this;if(self.needAntiAddiction()&&!self.is_older_user){this.sendGetAccountInfo(function(){console.log("game_time = "+self.game_time);TimerManager.ins().doTimer(1e4,0,self.antiAddictionTimer,self)})}}};LoginMgr.prototype.stopAntiAddictionTimer=function(){TimerManager.ins().remove(this.antiAddictionTimer,this);this.antiAddctionInited=false};LoginMgr.prototype.antiAddictionTimer=function(){if(this.needAntiAddiction()){var nowDaySec=DateUtils.getTodayPassedSecond();if(this.lastATCheckSecInDay==null){this.lastATCheckSecInDay=nowDaySec-20}for(var _i=0,_a=this.AT_HINT_SECS;_i<_a.length;_i++){var hintSecBefore=_a[_i];var hintSec=this.AT_END_DAY_SEC-hintSecBefore;if(this.lastATCheckSecInDay<hintSec&&hintSec<=nowDaySec){UserTips.ins().showTips(i18n("LoginMgr_13")+hintSecBefore/60+i18n("LoginMgr_14"))}}var closeApp=function(){ChannelMgr.ins().reload()};var hintSec=this.AT_END_DAY_SEC;if(this.lastATCheckSecInDay<hintSec&&hintSec<=nowDaySec){WarnWin.show(i18n("LoginMgr_15"),closeApp,this,closeApp,this,"sure");this.stopAntiAddictionTimer()}var nowTick=egret.getTimer();if(this.lastATCheckTick==null){this.lastATCheckTick=nowTick-24*3600*1e3}var gameTimeEndTick=(this.AT_CAN_PLAY_TIME-this.game_time)*1e3+this.game_time_tick;for(var _b=0,_c=this.AT_HINT_SECS;_b<_c.length;_b++){var hintSecBefore=_c[_b];var hintTick=gameTimeEndTick-hintSecBefore*1e3;if(this.lastATCheckTick<hintTick&&hintTick<=nowTick){UserTips.ins().showTips(i18n("LoginMgr_16")+hintSecBefore/60+i18n("LoginMgr_17"))}}if(this.lastATCheckTick<gameTimeEndTick&&gameTimeEndTick<=nowTick){WarnWin.show(i18n("LoginMgr_18"),closeApp,this,closeApp,this,"sure");this.stopAntiAddictionTimer()}this.lastATCheckSecInDay=nowDaySec;this.lastATCheckTick=nowTick}};LoginMgr.isIOS=false;LoginMgr.IMG_CLOSE_EYE="closeEye";LoginMgr.IMG_OPEN_EYE="openEye";LoginMgr.EVENT_LOGIN_ERROR="EVENT_LOGIN_ERROR";LoginMgr.EVENT_REMOVE_GIVE_SELECT="EVENT_REMOVE_GIVE_SELECT";LoginMgr.EVENT_SHOW_XIANYU_NAME="EVENT_SHOW_XIANYU_NAME";LoginMgr.preUrl=window["loginUrl"];LoginMgr.resLoaded=false;LoginMgr.viewQueue=[];return LoginMgr}(egret.EventDispatcher);__reflect(LoginMgr.prototype,"LoginMgr");var ModifyPwdMgr=function(_super){__extends(ModifyPwdMgr,_super);function ModifyPwdMgr(){var _this=_super.call(this)||this;_this.errorEvent2=new ErrorEvent2(ModifyPwdMgr.eventString);return _this}ModifyPwdMgr.ins=function(){if(this._ModifyPwdMgr==null){this._ModifyPwdMgr=new ModifyPwdMgr}return this._ModifyPwdMgr};Object.defineProperty(ModifyPwdMgr,"successWord",{get:function(){var _successWord=this._successWord;if(_successWord==null){_successWord=i18n("ModifyPwdMgr_0");this._successWord=_successWord}return _successWord},enumerable:true,configurable:true});ModifyPwdMgr.prototype.postUserInfo=function(accInput,pwdInput0,pwdInput1,pwdInput2){var _this=this;this.userName=accInput;this.pwd=pwdInput1;var params="type=modifypasswd&username="+accInput+"&pass="+pwdInput0+"&new_pass="+pwdInput1+"&new_pass2="+pwdInput2+"&vercode=1234&session="+g_login_session;params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();LoginMgr.request(LoginMgr.preUrl+"login.php",params,function(response){var userid=_this.userName;LoginMgr.setItem("__savedUserID",userid);if(LoginMgr.ins().isSavePwd){var pwd=_this.pwd;LoginMgr.setItem("__savedPwd",pwd)}_this.sendErrorText(ModifyPwdMgr.successWord)},function(response){var errorInfo="";if(response&&response["info"]){errorInfo=response.info}console.log(i18n("ModifyPwdMgr_1")+errorInfo);_this.sendErrorText(errorInfo)})};ModifyPwdMgr.prototype.sendErrorText=function(errorText){if(this.errorEvent2==null){this.errorEvent2=new ErrorEvent2(ModifyPwdMgr.eventString)}this.errorEvent2.errorText=errorText;this.dispatchEventWith(ModifyPwdMgr.eventString,false,this.errorEvent2)};ModifyPwdMgr.eventString="ModifyPwdMgr";return ModifyPwdMgr}(egret.EventDispatcher);__reflect(ModifyPwdMgr.prototype,"ModifyPwdMgr");var RegisterMgr=function(_super){__extends(RegisterMgr,_super);function RegisterMgr(){var _this=_super.call(this)||this;_this.hadOpenRegisterWin=false;_this.errorEvent2=new ErrorEvent2(RegisterMgr.EVENT_REGISTER_ERROR);_this.isAutoRegister=false;_this.autoRetryCount=0;return _this}RegisterMgr.isn=function(){if(this._registerMgr==null){this._registerMgr=new RegisterMgr}return this._registerMgr};RegisterMgr.prototype.autoRegister=function(){this.isAutoRegister=true;if(g_auto_login){this.autoRetryCount=0;this.createUserInfo();this.postUserInfo(this.userName,this.pwd)}};RegisterMgr.prototype.register=function(acc,pwd){this.isAutoRegister=false;this.postUserInfo(acc,pwd)};RegisterMgr.prototype.createUserInfo=function(){var baseChars="1234567890qwertyuiopasdfghjklzxcvbnm";var count=baseChars.length-1;var len=6;var userName="";var pwd="";for(var i=0;i<len;++i){var mname=baseChars[Math.floor(Math.random()*count)];userName+=mname;var mpwd=baseChars[Math.floor(Math.random()*count)];pwd+=mpwd}console.log("createUserInfo userName = "+userName+"  pwd = "+pwd);this.userName=userName;this.pwd=pwd};RegisterMgr.prototype.postUserInfo=function(accInput,pwdInput){var _this=this;this.userName=accInput;this.pwd=pwdInput;this.hadSend=true;var params="type=reg&username="+accInput+"&pass="+pwdInput+"&repass="+pwdInput+"&vercode=1234&session="+g_login_session;params+="&main_channel="+ChannelMgr.ins().main_channel+"&sub_channel="+ChannelMgr.ins().sub_channel+"&plat="+ChannelMgr.ins().getDeviceID();LoginMgr.request(LoginMgr.preUrl+"login.php",params,function(response){LoginMgr.setItem("__hideShowAccount","0");LoginMgr.setItem("timestamp","");LoginMgr.setItem("__savedUserID",_this.userName);if(LoginMgr.ins().isSavePwd){LoginMgr.setItem("__savedPwd",_this.pwd)}if(ChannelMgr.ins().isDouYinChannel()){ChannelMgr.ins().channelReport(5)}if(ChannelMgr.ins().isTencGDTChannel()){ChannelMgr.ins().channelReport(5)}LoginMgr.ins().postUserInfo(_this.userName,_this.pwd);if(_this.hadOpenRegisterWin){ViewManager.ins().close(RegisterWin)}var self=_this;var t=500;if(g_auto_login){t+=1024}setTimeout(function(){ChannelMgr.ins().saveCountImage(self.userName,self.pwd)},t)},function(response){var errorInfo="";if(response&&response["info"]){errorInfo=response.info}console.log(i18n("RegisterMgr_0"),errorInfo);_this.autoRetry();_this.sendErrorText(i18n("RegisterMgr_1")+errorInfo)})};RegisterMgr.prototype.autoRetry=function(){var _this=this;console.log("RegisterMgr autoRetry 1");if(this.isAutoRegister){console.log("RegisterMgr autoRetry 2");this.autoRetryCount+=1;TimerManager.ins().doTimer(this.autoRetryCount*300,1,function(){_this.createUserInfo();_this.postUserInfo(_this.userName,_this.pwd)},this)}};RegisterMgr.prototype.sendErrorText=function(errorText){if(this.errorEvent2==null){this.errorEvent2=new ErrorEvent2(RegisterMgr.EVENT_REGISTER_ERROR)}g_auto_login=false;this.errorEvent2.errorText=errorText;this.dispatchEventWith(RegisterMgr.EVENT_REGISTER_ERROR,false,this.errorEvent2)};RegisterMgr.EVENT_REGISTER_ERROR="EVENT_REGISTER_ERROR";return RegisterMgr}(egret.EventDispatcher);__reflect(RegisterMgr.prototype,"RegisterMgr");var SelectServerMgr=function(_super){__extends(SelectServerMgr,_super);function SelectServerMgr(){var _this=_super.call(this)||this;_this.servers=[];_this.serverMap={};_this.serverInfo={blockNameArr:[i18n("SelectServerMgr_0"),i18n("SelectServerMgr_1")],serversArr:[]};_this.last_login_serverid=-1;_this.recommended_server_id=-1;_this.cbInfo={fun:null,thisObj:null};_this.isSelectServerOK=false;_this.serverName="";_this.serverStatus=0;return _this}SelectServerMgr.ins=function(){if(this._selectServerMgr==null){this._selectServerMgr=new SelectServerMgr}return this._selectServerMgr};SelectServerMgr.prototype.sendServerName=function(serverName){console.log("SelectServerMgr sendServerName serverName");LocationProperty.srvName=serverName;this.serverName=serverName;this.dispatchEventWith(SelectServerMgr.EVENT_SEND_SERVERNAME,false,serverName)};SelectServerMgr.prototype.getServerStatus=function(name){if(name===void 0){name=""}if(!name){name=this.serverName}for(var k in this.servers){if(this.servers[k].servername==name){return this.servers[k].status}}return 2};SelectServerMgr.prototype.getServerInfo=function(name){if(name===void 0){name=""}if(!name){name=this.serverName}for(var k in this.servers){if(this.servers[k].servername==name){return this.servers[k]}}return null};SelectServerMgr.prototype.sendSelectServerOk=function(){this.dispatchEventWith(SelectServerMgr.EVENT_SELECT_SERVER_COMPLETED,false)};SelectServerMgr.prototype.getServersInfo=function(){var _this=this;var params="type=getservers&session="+g_login_session;LoginMgr.request(LoginMgr.preUrl+"login.php",params,function(response){if(response.is_real_name!=null){LoginMgr.ins().isRealName=response.is_real_name;LoginMgr.ins().anti_addiction=response.anti_addiction;LoginMgr.ins().game_time=response.game_time;LoginMgr.ins().age=response.age;LoginMgr.ins().is_older_user=response.is_older_user;LoginMgr.ins().server_time=response.server_time;LoginMgr.ins().game_time_tick=egret.getTimer();LoginMgr.ins().is_user_agreement_open=response.is_user_agreement_open}_this.servers=response.servers;ServerLocalStorage.updateAll(_this.servers);_this.serverMap={};for(var _i=0,_a=response.servers;_i<_a.length;_i++){var v=_a[_i];_this.serverMap[v.serverid]=v}_this.serverInfo.serversArr[1]=_this.servers;for(var i=0;_this.servers&&i<_this.servers.length;++i){var max=i;var k=i;for(;k<_this.servers.length;++k){if(parseInt(_this.servers[k].id)>parseInt(_this.servers[max].id)){max=k}}if(max!=i){var temp=_this.servers[i];_this.servers[i]=_this.servers[max];_this.servers[max]=temp}}if(response.client_ip){Recharge.client_ip=response.client_ip}var __atssid=GetUrlParam("__atssid");if(__atssid!=null&&__atssid!=""){var srvid=parseInt(__atssid);_this.sendSelectServerID(srvid);return}_this.setLastSelectedServer(parseInt(response.last_login_serverid),parseInt(response.recommended_server_id),response)},function(response){})};SelectServerMgr.prototype.setServerAddr=function(serverAddr,serverID,serverPort,channelName){LocationProperty.serverIP=serverAddr;LocationProperty.srvid=serverID;LocationProperty.serverPort=serverPort;ChannelCfgOverwrite.channelCfgName=channelName};SelectServerMgr.prototype.setLastSelectedServer=function(last_login_serverid,recommended_server_id,response){var _this=this;if(last_login_serverid===void 0){last_login_serverid=-1}this.recommended_server_id=recommended_server_id;var serverName="";if(last_login_serverid&&last_login_serverid>0){this.last_login_serverid=last_login_serverid;if(this.servers&&this.servers.length>0){for(var idx in this.servers){if(parseInt(this.servers[idx].id)==last_login_serverid){serverName=this.servers[idx].servername;this.isSelectServerOK=true;this.sendSelectServerOk();ServerLocalStorage.setCurServer(this.servers[idx].servername);ServerLocalStorage.addServer(this.servers[idx]);console.log(this.servers[idx]);this.serverInfo.serversArr[0]?this.serverInfo.serversArr[0].unshift(this.servers[idx]):this.serverInfo.serversArr[0]=[this.servers[idx]];ServerLocalStorage.getData(function(v){_this.serverInfo.serversArr[0]=v;_this.dispatchEventWith(SelectServerMgr.EVENT_UPDATE_SERVER,false)});var serverid=this.getServerId(response.last_login_serverid);this.setServerAddr(response.last_login_host,serverid,response.last_login_port,response.last_login_channelname);break}}}else{serverName=i18n("SelectServerMgr_2")}}if(serverName==null||serverName==""){if(this.servers&&this.servers.length>0){for(var _i=0,_a=this.servers;_i<_a.length;_i++){var svr=_a[_i];if(svr.serverid==recommended_server_id){serverName=svr.servername;break}}console.log("SelectServerMgr setLastSelectedServer choose recommended_server_id =>  : "+recommended_server_id);this.sendSelectServerID(recommended_server_id)}else{serverName=i18n("SelectServerMgr_3")}}this.sendServerName(serverName)};SelectServerMgr.prototype.sendSelectServerID=function(id){var _this=this;this.isSelectServerOK=false;LoadingTimeoutMgr.ins().beginStep(LoadingTimeoutMgr.STEPID_GET_SERVER_IP);var params="type=selectserver&session="+g_login_session+"&id="+id;console.log("sendSelectServerID  selected serverid = "+id);LoginMgr.request(LoginMgr.preUrl+"login.php",params,function(response){if(response.serverid&&response.host&&response.port){var channelname="";var svrInfo=_this.serverMap[response.serverid];if(svrInfo!=null&&svrInfo.channelname!=null){channelname=svrInfo.channelname}_this.setServerAddr(response.host,_this.getServerId(response.serverid),response.port,channelname);for(var i=0;_this.servers&&i<_this.servers.length;++i){if(_this.servers[i].id==response.id){ServerLocalStorage.setCurServer(_this.servers[i].servername);_this.sendServerName(_this.servers[i].servername);break}}ServerLocalStorage.getData(function(v){_this.serverInfo.serversArr[0]=v;_this.dispatchEventWith(SelectServerMgr.EVENT_UPDATE_SERVER,false)});_this.isSelectServerOK=true;_this.sendSelectServerOk();var cbInfo=_this.cbInfo;if(cbInfo&&cbInfo.fun&&cbInfo.thisObj){console.log(i18n("SelectServerMgr_4"));var fun=cbInfo.fun;var thisObj=cbInfo.thisObj;fun.call(thisObj);cbInfo.fun=null;cbInfo.thisObj=null}}},function(response){if(response){if(response.errcode==2){alert(i18n("SelectServerMgr_5"));ChannelMgr.ins().reload()}else if(response.info){alert(response.info)}}})};SelectServerMgr.prototype.sendRecommendedServerId=function(cbFun,thisObj){if(cbFun===void 0){cbFun=null}if(thisObj===void 0){thisObj=null}var servers=this.servers;var recommended_server_id=this.recommended_server_id;for(var _i=0,servers_1=servers;_i<servers_1.length;_i++){var svr=servers_1[_i];if(parseInt(svr.serverid)==recommended_server_id){this.sendSelectServerID(recommended_server_id);this.sendServerName(svr.servername);if(this.cbInfo){this.cbInfo.fun=cbFun;this.cbInfo.thisObj=thisObj}break}}};SelectServerMgr.prototype.getServerNameByID=function(id){var serverName=LocationProperty.srvName;var servers=this.serverInfo.serversArr[1];if(servers&&servers.length>0){for(var i=0;i<servers.length;++i){if(servers[i]&&servers[i]["id"]==id){serverName=servers[i]["servername"];break}}}return serverName};SelectServerMgr.prototype.getServerId=function(id){var servers=this.serverInfo.serversArr[1];if(servers&&servers.length>0){for(var i=0;i<servers.length;++i){if(servers[i]&&servers[i]["id"]==id){return servers[i].serverid}}}return id};SelectServerMgr.EVENT_SEND_SERVERNAME="SelectServerMgr";SelectServerMgr.EVENT_UPDATE_SERVER="UpdateServer";SelectServerMgr.EVENT_SELECT_SERVER_COMPLETED="EVENT_SELECT_SERVER_COMPLETED";return SelectServerMgr}(egret.EventDispatcher);__reflect(SelectServerMgr.prototype,"SelectServerMgr");var ServerLocalStorage=function(){function ServerLocalStorage(server){this.id=Number(server.id);this.serverid=Number(server.serverid);this.servername=server.servername;this.type=Number(server.type);this.status=Number(server.status);this.newflag=Number(server.newflag);this.channelname=server.channelname}ServerLocalStorage.getCurServer=function(cb){LoginMgr.getItem(ServerLocalStorage.server,function(v){cb(v||"")})};ServerLocalStorage.setCurServer=function(v){LoginMgr.setItem(ServerLocalStorage.server,v||"")};ServerLocalStorage.getData=function(cb){LoginMgr.getItem(ServerLocalStorage.user,function(userId){LoginMgr.getItem(ServerLocalStorage.key+userId,function(v){var d=null;if(v&&v!=""){d=JSON.parse(v)}if(!d){d=[];LoginMgr.setItem(ServerLocalStorage.key+userId,JSON.stringify(d))}cb(d)})})};ServerLocalStorage.setData=function(newValue){LoginMgr.getItem(ServerLocalStorage.user,function(userId){LoginMgr.setItem(ServerLocalStorage.key+userId,JSON.stringify(newValue))})};ServerLocalStorage.addServer=function(server){if(server.serverid==undefined||server.servername==undefined)return;server=ServerLocalStorage.createItem(server);ServerLocalStorage.getData(function(servers){var i;for(i=0;i<servers.length;i++){if(servers[i].serverid==server.serverid&&servers[i].servername==server.servername){servers[i]=servers[0];servers[0]=server;break}}if(i==servers.length)servers.unshift(server);ServerLocalStorage.setData(servers)})};ServerLocalStorage.createItem=function(server){return new ServerLocalStorage(server)};ServerLocalStorage.updateAll=function(s){ServerLocalStorage.getData(function(d){var h={};var r=[];for(var i=0;i<d.length;i++){if(!(d[i].servername in h)){h[d[i].servername]=true;r.push(d[i]);for(var j=0;j<s.length;j++){if(d[i].serverid==s[j].serverid&&d[i].servername==s[j].servername){d[i].channelname=s[j].channelname;d[i].newflag=s[j].newflag;d[i].status=s[j].status;d[i].type=s[j].type;d[i].id=s[j].id;break}}}}ServerLocalStorage.setData(r)})};ServerLocalStorage.key="_SelectServer_";ServerLocalStorage.user="__savedUserID";ServerLocalStorage.server="_LoginServer_";return ServerLocalStorage}();__reflect(ServerLocalStorage.prototype,"ServerLocalStorage");var Server=function(){function Server(){}return Server}();__reflect(Server.prototype,"Server");var BlockListItem=function(_super){__extends(BlockListItem,_super);function BlockListItem(){var _this=_super.call(this)||this;_this.skinName="blockListItemSkin";return _this}BlockListItem.prototype.dataChanged=function(){var data=this.data;if(data){this.blockName.text=data}this.setState(this.selected)};BlockListItem.prototype.setState=function(selected){if(selected===void 0){selected=false}this.selectedGroup.visible=selected;this.unselectImg.visible=!selected;if(selected){this.blockName.textColor=16642778;this.blockName.size=26}else{this.blockName.textColor=4871002;this.blockName.size=25}};return BlockListItem}(BaseItemRender);__reflect(BlockListItem.prototype,"BlockListItem");var ConnectingWin=function(_super){__extends(ConnectingWin,_super);function ConnectingWin(){var _this=_super.call(this)||this;_this.loadingC=0;if(window["isIOS_AppStore"]==true){egret.ExternalInterface.call("AppStoreVer_Close_PreLoading_Bg","")}return _this}ConnectingWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}Main.reposUI(this);this.skinName="ConnectingWinSkin";this.dealWithChannel();TimerManager.ins().doTimer(250,0,this.updateLabelLoading,this)};ConnectingWin.prototype.dealWithChannel=function(){if(ChannelMgr.ins().isBeautyHidden()){this.bg.source="bg.jpg"}else if(window["isSmallGame"]){}else if(window["wlmzlang"]=="cht"){this.bg.source="bgcht.jpg"}else{this.bg.source="bg.jpg"}};ConnectingWin.prototype.close=function(){TimerManager.ins().remove(this.updateLabelLoading,this);_super.prototype.close.call(this)};ConnectingWin.prototype.updateLabelLoading=function(){this.loadingC+=1;if(this.loadingC>3){this.loadingC=1}var s="";for(var i=0,c=this.loadingC;i<c;++i){s+="."}this.labelLoading.text=s};return ConnectingWin}(BaseEuiView);__reflect(ConnectingWin.prototype,"ConnectingWin");var LoginFailedWin=function(_super){__extends(LoginFailedWin,_super);function LoginFailedWin(){var _this=_super.call(this)||this;_this.secs=5;_this.skinName="LoginFailedWinSkin";return _this}LoginFailedWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var msg=param[0];if(msg!=null){this.labelMsg.text=msg}ViewManager.ins().close(ConnectingWin);Main.reposUI(this);this.addTouchEvent(this,this.onTap);this.countDown();TimerManager.ins().remove(this.countDown,this);TimerManager.ins().doTimer(1e3,0,this.countDown,this);this.setReconnectingVisible(false)};LoginFailedWin.prototype.countDown=function(){this.labelCountDown.text=this.secs.toString();if(this.secs<=0){this.onTap()}this.secs-=1};LoginFailedWin.prototype.setReconnectingVisible=function(v){this.grpReconnect.visible=v};LoginFailedWin.prototype.onTap=function(){var _this=this;if(window["isSmallGame"]){TimerManager.ins().remove(this.countDown,this);TimerManager.ins().doTimer(1e3,1,function(){_this.setReconnectingVisible(true);GameSocket.ins().newSocket();RoleMgr.ins().connectServer()},this)}else{ChannelMgr.ins().reload()}};LoginFailedWin.prototype.close=function(){_super.prototype.close.call(this)};return LoginFailedWin}(BaseEuiView);__reflect(LoginFailedWin.prototype,"LoginFailedWin");var LoginWin=function(_super){__extends(LoginWin,_super);function LoginWin(){var _this=_super.call(this)||this;_this.skinName="LoginSkin";return _this}LoginWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var __this=this;LoginMgr.ins().hadOpenLoginSkin=true;this.visible=!g_auto_login;Main.reposUI(this);this.hadSend=false;LoginMgr.ins().isSavePwd=true;this.centerTipsGroup.visible=false;this.bgClose.width=StageUtils.ins().getStage().width+10;LoginMgr.getItem("__savedUserID",function(userid){LoginMgr.getItem("__savedPwd",function(pwd){__this.accInput.prompt=i18n("LoginWin_0");__this.pwdInput.prompt=i18n("LoginWin_1");__this.loginBtn.label=i18n("LoginWin_2");if(userid!=null&&userid!=""){__this.accInput.text=userid}if(pwd!=null&&pwd!=""){__this.pwdInput.text=pwd;LoginMgr.ins().isSavePwd=true}else{LoginMgr.ins().isSavePwd=false}if(userid==null||userid==""){LoginMgr.ins().isSavePwd=true}if(LoginMgr.ins().isSavePwd){__this.recordImg.visible=true}else{__this.recordImg.visible=false}})});this.addTouchEvent(this.recordBtn,this.onRecordImg);this.addTouchEvent(this.registerLbl,this.onToRegister);this.addTouchEvent(this.loginBtn,this.onLoginBtn);this.addTouchEvent(this.modifyPwdBtn,this.onToModifyPwdWin);this.pwdInput.inputType=egret.TextFieldInputType.PASSWORD;this.pwdInput.displayAsPassword=true;this.addTouchEvent(this.eyeImg,this.onChangeEyeImg);LoginMgr.ins().addEventListener(LoginMgr.EVENT_LOGIN_ERROR,this.onLoginError,this);if(g_auto_login){this.removeTouchEvent(this.registerLbl,this.onToRegister);this.showCenterTips(null,i18n("LoginWin_3"))}};LoginWin.prototype.onChangeEyeImg=function(){if(this.eyeImg.source==LoginMgr.IMG_CLOSE_EYE){this.eyeImg.source=LoginMgr.IMG_OPEN_EYE;this.pwdInput.inputType=egret.TextFieldInputType.TEXT;this.pwdInput.displayAsPassword=false}else{this.eyeImg.source=LoginMgr.IMG_CLOSE_EYE;this.pwdInput.inputType=egret.TextFieldInputType.PASSWORD;this.pwdInput.displayAsPassword=true}};LoginWin.prototype.onRecordImg=function(){var userid=this.accInput.text;LoginMgr.setItem("__savedUserID",userid);if(LoginMgr.ins().isSavePwd){this.recordImg.visible=false;LoginMgr.ins().isSavePwd=false;LoginMgr.setItem("__savedPwd","")}else{this.recordImg.visible=true;LoginMgr.ins().isSavePwd=true;var pwd=this.pwdInput.text;if(pwd!=null&&pwd!=""){LoginMgr.setItem("__savedPwd",pwd)}}};LoginWin.prototype.onToRegister=function(){ViewManager.ins().close(LoginWin);ViewManager.ins().close(ConnectingWin);LoginMgr.openView(RegisterWin)};LoginWin.prototype.onToModifyPwdWin=function(){ViewManager.ins().close(LoginWin);ViewManager.ins().close(ConnectingWin);LoginMgr.openView(ModifyPwdWin)};LoginWin.prototype.onLoginError=function(ErrorEvent2,text){if(text===void 0){text=""}this.loginBtn.enabled=true;if(!g_auto_login){this.addTouchEndEvent(this.registerLbl,this.onToRegister)}this.showCenterTips(ErrorEvent2,text)};LoginWin.prototype.showCenterTips=function(ErrorEvent2,text){if(text===void 0){text=""}if(ErrorEvent2!=null){this.centerTips.text=ErrorEvent2.data.errorText}else{this.centerTips.text=text}this.centerTips.alpha=1;this.centerTipsGroup.visible=true;if(g_auto_login){this.centerTipsGroup.bottom=23}else{this.centerTipsGroup.bottom=269;var __this_1=this;__this_1.centerTips.y=0;egret.Tween.get(this.centerTips).to({y:-240},1200,egret.Ease.sineIn);egret.setTimeout(function(){egret.Tween.get(__this_1.centerTips).to({alpha:0},500,egret.Ease.sineIn)},__this_1,1200);egret.setTimeout(function(){__this_1.centerTipsGroup.visible=false},__this_1,1700)}};LoginWin.prototype.onLoginBtn=function(){if(this.accInput.text==""){this.showCenterTips(null,i18n("LoginWin_4"));return}if(this.pwdInput.text==""){this.showCenterTips(null,i18n("LoginWin_5"));return}LoginMgr.ins().postUserInfo(this.accInput.text,this.pwdInput.text);this.loginBtn.enabled=false};LoginWin.prototype.close=function(){LoginMgr.ins().hadOpenLoginSkin=false;LoginMgr.ins().removeEventListener(LoginMgr.EVENT_LOGIN_ERROR,this.onLoginError,this);_super.prototype.close.call(this)};return LoginWin}(BaseEuiView);__reflect(LoginWin.prototype,"LoginWin");var ModifyPwdWin=function(_super){__extends(ModifyPwdWin,_super);function ModifyPwdWin(){var _this=_super.call(this)||this;_this.skinName="ModifyPwdSkin";return _this}ModifyPwdWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var __this=this;Main.reposUI(this);this.centerTipsGroup.visible=false;this.bgClose.width=StageUtils.ins().getStage().width+10;LoginMgr.getItem("__savedUserID",function(savedUserID){__this.accInput.text=savedUserID});this.addTouchEvent(this.backBtn,this.onToLoginWin);this.addTouchEvent(this.modufyPwdBtn,this.onModifyPwdBtn);this.addTouchEvent(this.eyeImg0,this.onChangeEyeImg);this.addTouchEvent(this.eyeImg1,this.onChangeEyeImg);this.addTouchEvent(this.eyeImg2,this.onChangeEyeImg);ModifyPwdMgr.ins().addEventListener(ModifyPwdMgr.eventString,this.showCenterTips,this)};ModifyPwdWin.prototype.onChangeEyeImg=function(e){var eyeImg=null;var pwdInput=null;if(!e)return;switch(e.target){case this.eyeImg0:eyeImg=this.eyeImg0;pwdInput=this.pwdInput0;break;case this.eyeImg1:eyeImg=this.eyeImg1;pwdInput=this.pwdInput1;break;case this.eyeImg2:eyeImg=this.eyeImg2;pwdInput=this.pwdInput2;break}if(!eyeImg||!pwdInput)return;if(eyeImg.source==LoginMgr.IMG_CLOSE_EYE){eyeImg.source=LoginMgr.IMG_OPEN_EYE;pwdInput.inputType=egret.TextFieldInputType.TEXT;pwdInput.displayAsPassword=false}else{eyeImg.source=LoginMgr.IMG_CLOSE_EYE;pwdInput.inputType=egret.TextFieldInputType.PASSWORD;pwdInput.displayAsPassword=true}};ModifyPwdWin.prototype.onToLoginWin=function(){ViewManager.ins().close(ModifyPwdWin);LoginMgr.openView(LoginWin)};ModifyPwdWin.prototype.onModifyPwdBtn=function(){if(this.accInput.text==""){this.showCenterTips(null,i18n("ModifyPwdWin_0"));return}if(this.pwdInput0.text==""){this.showCenterTips(null,i18n("ModifyPwdWin_1"));return}if(this.pwdInput1.text==""){this.showCenterTips(null,i18n("ModifyPwdWin_2"));return}if(this.pwdInput2.text==""){this.showCenterTips(null,i18n("ModifyPwdWin_3"));return}ModifyPwdMgr.ins().postUserInfo(this.accInput.text,this.pwdInput0.text,this.pwdInput1.text,this.pwdInput2.text)};ModifyPwdWin.prototype.showCenterTips=function(ErrorEvent2,errorText){if(errorText===void 0){errorText=""}if(ErrorEvent2!=null){this.centerTips.text=ErrorEvent2.data.errorText}else{this.centerTips.text=errorText}this.centerTips.alpha=1;this.centerTipsGroup.visible=true;this.centerTipsGroup.verticalCenter=85.5;this.centerTips.y=0;var __this=this;egret.Tween.get(this.centerTips).to({y:-240},1700,egret.Ease.sineIn);egret.setTimeout(function(){egret.Tween.get(__this.centerTips).to({alpha:0},500,egret.Ease.sineIn)},__this,1200);egret.setTimeout(function(){__this.centerTipsGroup.visible=false;if(this.centerTips.text==ModifyPwdMgr.successWord){TimerManager.ins().doTimer(10,1,__this.onToLoginWin,__this)}},__this,1700)};ModifyPwdWin.prototype.close=function(){ModifyPwdMgr.ins().removeEventListener(ModifyPwdMgr.eventString,this.showCenterTips,this);_super.prototype.close.call(this)};return ModifyPwdWin}(BaseEuiView);__reflect(ModifyPwdWin.prototype,"ModifyPwdWin");var NoticeWin=function(_super){__extends(NoticeWin,_super);function NoticeWin(){var _this=_super.call(this)||this;_this.index=0;_this.skinName="NoticeSkin";return _this}NoticeWin.prototype.open=function(){Main.reposUI(this);this.bgClose.width=StageUtils.ins().getStage().width+10;this.addChangeEvent(this.tab,this.onTabTouch);this.bgClose.addEventListener(egret.TouchEvent.TOUCH_END,this.close,this);this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.close,this);this.observe(GameLogic.ins().postNotice,this.update);this.tab.selectedIndex=0;this.index=0;this.update()};NoticeWin.prototype.update=function(){this.showNotice(this.index+1);var arr=[];for(var i=0;i<=2;i++){var noticeInfo=GameLogic.ins().noticeInfo[i+1];var title=noticeInfo&&noticeInfo.title||null;var item=this.tab.dataProvider.getItemAt(i);if(title){arr[i]=title}else{arr[i]=item}}this.tab.dataProvider=new eui.ArrayCollection(arr)};NoticeWin.prototype.onTabTouch=function(e){var i=e.currentTarget.selectedIndex;this.index=i;this.showNotice(i+1)};NoticeWin.prototype.showNotice=function(notice_type){if(notice_type===void 0){notice_type=1}var noticeInfo=GameLogic.ins().noticeInfo[notice_type];if(!noticeInfo){}var info=noticeInfo&&noticeInfo["info"]||i18n("NoticeWin_0");this.textInfo.textFlow=TextFlowMaker.generateTextFlow(info,true)};NoticeWin.prototype.close=function(){this.bgClose.removeEventListener(egret.TouchEvent.TOUCH_END,this.close,this);this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.close,this);ViewManager.ins().close(NoticeWin);_super.prototype.close.call(this)};return NoticeWin}(BaseEuiView);__reflect(NoticeWin.prototype,"NoticeWin");var RegisterWin=function(_super){__extends(RegisterWin,_super);function RegisterWin(){var _this=_super.call(this)||this;_this.skinName="RegisterSkin";return _this}RegisterWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}RegisterMgr.isn().hadOpenRegisterWin=true;Main.reposUI(this);this.bgClose.width=StageUtils.ins().getStage().width+10;this.visible=!g_auto_login;this.hadSend=false;this.addTouchEvent(this.backBtn,this.onToLogin);this.addTouchEvent(this.registerBtn,this.onRegisterBtn);this.centerTipsGroup.visible=false;this.eyeImg.source=LoginMgr.IMG_OPEN_EYE;this.pwdInput.inputType=egret.TextFieldInputType.TEXT;this.pwdInput.displayAsPassword=false;this.addTouchEvent(this.eyeImg,this.onChangeEyeImg);RegisterMgr.isn().createUserInfo();this.accInput.text=RegisterMgr.isn().userName;this.pwdInput.text=RegisterMgr.isn().pwd;RegisterMgr.isn().addEventListener(RegisterMgr.EVENT_REGISTER_ERROR,this.onRegisterError,this)};RegisterWin.prototype.onChangeEyeImg=function(){if(this.eyeImg.source==LoginMgr.IMG_CLOSE_EYE){this.eyeImg.source=LoginMgr.IMG_OPEN_EYE;this.pwdInput.inputType=egret.TextFieldInputType.TEXT;this.pwdInput.displayAsPassword=false}else{this.eyeImg.source=LoginMgr.IMG_CLOSE_EYE;this.pwdInput.inputType=egret.TextFieldInputType.PASSWORD;this.pwdInput.displayAsPassword=true}};RegisterWin.prototype.onToLogin=function(){ViewManager.ins().close(RegisterWin);LoginMgr.openView(LoginWin)};RegisterWin.prototype.onRegisterBtn=function(){if(this.accInput.text==""){this.showCenterTips(null,i18n("RegisterWin_0"));return}if(this.pwdInput.text==""){this.showCenterTips(null,i18n("RegisterWin_1"));return}RegisterMgr.isn().register(this.accInput.text,this.pwdInput.text);this.registerBtn.enabled=false};RegisterWin.prototype.onRegisterError=function(ErrorEvent2,errorText){if(errorText===void 0){errorText=""}this.registerBtn.enabled=true;this.showCenterTips(ErrorEvent2,errorText)};RegisterWin.prototype.showCenterTips=function(ErrorEvent2,errorText){if(errorText===void 0){errorText=""}if(ErrorEvent2!=null){this.centerTips.text=ErrorEvent2.data.errorText}else{this.centerTips.text=errorText}this.centerTips.alpha=1;this.centerTipsGroup.visible=true;this.centerTipsGroup.verticalCenter=85.5;this.centerTips.y=0;var __this=this;egret.Tween.get(this.centerTips).to({y:-240},1700,egret.Ease.sineIn);egret.setTimeout(function(){egret.Tween.get(__this.centerTips).to({alpha:0},500,egret.Ease.sineIn)},__this,1200);egret.setTimeout(function(){__this.centerTipsGroup.visible=false},__this,1700)};RegisterWin.prototype.close=function(){RegisterMgr.isn().hadOpenRegisterWin=false;RegisterMgr.isn().removeEventListener(RegisterMgr.EVENT_REGISTER_ERROR,this.onRegisterError,this);_super.prototype.close.call(this)};return RegisterWin}(BaseEuiView);__reflect(RegisterWin.prototype,"RegisterWin");var SelectServerItem=function(_super){__extends(SelectServerItem,_super);function SelectServerItem(){var _this=_super.call(this)||this;_this.skinName="ServerListItemSkin";return _this}SelectServerItem.prototype.dataChanged=function(){var data=this.data;if(data){this.selectedImg.visible=this.selected;this.serverSpecStatus.source="";var s=data.servername;if(data.newflag==1){this.serverSpecStatus.source="label_new"}switch(data.status){case 0:this.serverStatus.source="status_green";break;case 1:this.serverStatus.source="status_red";this.serverSpecStatus.source="label_full";break;case 2:this.serverStatus.source="status_gray";break}this.serverName.text=s;this.setState(this.selected)}};SelectServerItem.prototype.setState=function(selected){if(selected===void 0){selected=false}if(selected){this.serverName.textColor=10758473}else{this.serverName.textColor=5389901}};return SelectServerItem}(BaseItemRender);__reflect(SelectServerItem.prototype,"SelectServerItem");var SelectServerWin=function(_super){__extends(SelectServerWin,_super);function SelectServerWin(){var _this=_super.call(this)||this;_this.skinName="SelectServerWinSkin";return _this}SelectServerWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}Main.reposUI(this);this.bgClose.width=StageUtils.ins().getStage().width+10;this.blockList.scrollV=0;this.blockList.selectedIndex=0;this.blockList.scrollH=0;this.blockList.itemRenderer=BlockListItem;this.blockList.dataProvider=new eui.ArrayCollection(SelectServerMgr.ins().serverInfo.blockNameArr);this.blockList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectBlock,this);this.serverList.scrollV=0;this.serverList.selectedIndex=0;this.serverList.itemRenderer=SelectServerItem;this.serverList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectServer,this);SelectServerMgr.ins().addEventListener(SelectServerMgr.EVENT_UPDATE_SERVER,this.onSelectBlock,this);SelectServerMgr.ins().getServersInfo();SelectServerMgr.ins().addEventListener(SelectServerMgr.EVENT_SEND_SERVERNAME,this.onSelectBlock,this);TimerManager.ins().doTimer(40,1,this.onSelectBlock,this);this.bgClose.addEventListener(egret.TouchEvent.TOUCH_END,this.onBgClose,this)};SelectServerWin.prototype.onSelectBlock=function(e){console.log("SelectServerWin onSelectBlock");var selectedIndex=this.blockList.selectedIndex;var children=this.blockList.$children;if(children){for(var idx in children){var blockListItem=children[idx];var selected=parseInt(idx)==selectedIndex;blockListItem.setState(selected)}}if(selectedIndex<SelectServerMgr.ins().serverInfo.serversArr.length){this.serverList.dataProvider=new eui.ArrayCollection(SelectServerMgr.ins().serverInfo.serversArr[selectedIndex]);this.serverList.selectedIndex=0;TimerManager.ins().doTimer(40,1,this.onSelectServer,this)}};SelectServerWin.prototype.onSelectServer=function(e){var selectedIndex=this.serverList.selectedIndex;var children=this.serverList.$children;if(children){for(var idx in children){var selectServerItem=children[idx];var selected=selectServerItem.selected;selectServerItem.selectedGroup.visible=selected;selectServerItem.setState(selected)}}if(e&&e.target==this.serverList){ViewManager.ins().close(SelectServerWin);SelectServerMgr.ins().sendSelectServerID(e.item.id);SelectServerMgr.ins().sendServerName(e.item.servername)}};SelectServerWin.prototype.onBgClose=function(){if(!SelectServerMgr.ins().serverName){SelectServerMgr.ins().sendRecommendedServerId()}ViewManager.ins().close(SelectServerWin)};SelectServerWin.prototype.close=function(){this.bgClose.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBgClose,this);this.serverList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectServer,this);this.blockList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectBlock,this);SelectServerMgr.ins().removeEventListener(SelectServerMgr.EVENT_SEND_SERVERNAME,this.onSelectBlock,this);_super.prototype.close.call(this)};return SelectServerWin}(BaseEuiView);__reflect(SelectServerWin.prototype,"SelectServerWin");var StartGameWin=function(_super){__extends(StartGameWin,_super);function StartGameWin(){var _this=_super.call(this)||this;_this.serverListData=[];_this.showNoticeByClick=false;_this.noServerTxt=i18n("StartGameWin_0");_this.roleAni0=null;if(!window["isSmallGame"]){RES.getRes("loginBg1_jpg");RES.getRes("loginBg2_jpg")}_this.skinName="StartGameWinSkin";return _this}StartGameWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}Main.reposUI(this);this.scroller0.width=StageUtils.ins().getStage().width+10;this.scroller.width=StageUtils.ins().getStage().width+10;if(window["isSmallGame"]){this.currentState="20120"}else{this.currentState="normal"}if(ChannelMgr.ins().isAnQiGeChannel()){this.t1.visible=this.t2.visible=false}this.addTouchEvent(this,this.onClick);this.addTouchEvent(this.selectBtn,this.onSelectBtn);this.addTouchEvent(this.reLoginBtn,this.onReLoginBtn);this.addTouchEvent(this.enterBtn,this.checkServer);this.addTouchEvent(this.noticeBtn,this.onClickedNotice);this.addTouchEvent(this.btnViewAccount,this.onViewAccount);this.btnViewAccount.visible=false;this.centerTipsGroup.visible=false;this.updateBtnVA();this.addTouchEvent(this.labelPolicy1,this.onTouchLabelPolicy1);this.addTouchEvent(this.labelPolicy2,this.onTouchLabelPolicy2);this.btnViewAccount.visible=false;this.showServer();SelectServerMgr.ins().addEventListener(SelectServerMgr.EVENT_SELECT_SERVER_COMPLETED,this.onSelectServerOK,this);SelectServerMgr.ins().addEventListener(SelectServerMgr.EVENT_SEND_SERVERNAME,this.onGetServerName,this);LoadingTimeoutMgr.ins().beginStep(LoadingTimeoutMgr.STEPID_GET_SERVERS_LIST);TimerManager.ins().doTimer(500,1,function(){SelectServerMgr.ins().getServersInfo()},this);var mc=ObjectPool.pop("MovieClip");mc.playFileRes2("stargame_eff","stargame_eff_json","stargame_eff_png",-1);this.enterBtnGroup.addChild(mc);this.showClientVersion();this.dealWithChannel();this.reqNotice();this.playDragonBGAni();var __atsal=GetUrlParam("__atsal");var __th_at=GetUrlParam("__th_at");if(__atsal=="1"){TimerManager.ins().doTimer(3e3,1,this.onEnterBtn,this)}else if(__th_at!=""&&__th_at!=null){TimerManager.ins().doTimer(3e4,1,this.onEnterBtn,this)}this.checkShowPolicy();SoundUtil.ins().playStartBGSound();if(!LoginMgr.ins().hadOpenLoginWin){LoginMgr.ins().hadOpenLoginWin=true;var channel=window["GetChannel"]()||"0_1";var c=channel.split("_");GetLoginName();AppDotUp.Ins().PostAppDot("6",c[0],c[1],UUID,"",LoginName,"","","","",DeviceUtils.deviceOS)}this.openTime=egret.getTimer()+10*1e3;this.timeLab.text="";if(window["isSmallGame"]){TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}GameApp.startGameResPreload()};StartGameWin.prototype.dealWithChannel=function(){if(ChannelMgr.ins().isThirdChannel()){this.reLoginGroup.visible=false}if(ChannelMgr.ins().isJuHeAppChannel()){this.bg.source="loginBg_20113_jpg"}else{if(!window["isSmallGame"]){this.bg.source="loginBg1_jpg";this.bg2.source="loginBg2_jpg"}}this.kf.visible=ChannelMgr.ins().isQQSmallGameChannel()};StartGameWin.prototype.updateTime=function(){var s=Math.ceil((this.openTime-egret.getTimer())/1e3);this.timeLab.text="("+Math.max(s,0)+")";if(s<=0){this.checkServer()}};StartGameWin.prototype.showServer=function(){var isOK=SelectServerMgr.ins().isSelectServerOK;this.enterBtn.enabled=isOK;var status=2;if(isOK){this.serverName.text=SelectServerMgr.ins().serverName;status=SelectServerMgr.ins().getServerStatus()}else{this.serverName.text=this.noServerTxt}this.updateStatus(status);console.log("StartGameWin open isSelectServerOK = "+isOK+" serverName = "+SelectServerMgr.ins().serverName)};StartGameWin.prototype.updateStatus=function(status){if(status===void 0){status=2}switch(status){case 0:this.serverStatus.source="login_green";break;case 1:this.serverStatus.source="login_red";break;case 2:this.serverStatus.source="login_grey";break}};StartGameWin.prototype.updateBtnVA=function(){var self=this;LoginMgr.getItem("__hideShowAccount",function(__hideShowAccount){if(__hideShowAccount!="1"){self.btnViewAccount.visible=ChannelMgr.ins().shouldShowSaveAccount()}})};StartGameWin.prototype.onViewAccount=function(){var self=this;LoginMgr.getItem("__savedUserID",function(userName){LoginMgr.getItem("__savedPwd",function(pwd){SaveNewCountWin.show(i18n("StartGameWin_1")+userName+i18n("StartGameWin_2")+pwd+i18n("StartGameWin_3"),function(){ViewManager.ins().close(SaveNewCountWin)},self,function(){LoginMgr.setItem("__hideShowAccount","1");self.btnViewAccount.visible=false;ViewManager.ins().close(SaveNewCountWin)},self,"normal")})})};StartGameWin.prototype.createAni=function(){var self=this;if(!ProfilingMgr.ins().webglSupport()){this.bg.visible=true;return}var newCloudAni=new DragonBones("login_tx_yun",1,null,["newAnimation"],true);newCloudAni.x=this.aniGroup.width/2;newCloudAni.y=this.aniGroup.height/2;this.aniGroup.addChild(newCloudAni);var ani=new DragonBones("login_tx",2,null,["newAnimation"],true);ani.x=this.aniGroup.width/2;ani.y=this.aniGroup.height/2;this.aniGroup.addChild(ani)};StartGameWin.prototype.playDragonBGAni=function(){var self=this;if(!ProfilingMgr.ins().webglSupport()){self.showNewAnibg(false);return}if(window["isSmallGame"]){return}if(ChannelMgr.ins().isJuHeAppChannel()){return}if(!this.roleAni0){self.showNewAnibg(false);var roleAni1=new DragonBones("login",1,null,["01"],true,"_png",false,function(){self.showNewAnibg(true)});self.bgMc0.addChild(roleAni1);self.roleAni0=roleAni1}else{self.showNewAnibg(true);this.roleAni0.playActionArray(["01"],true)}};StartGameWin.prototype.showNewAnibg=function(isshowNewbg){if(isshowNewbg===void 0){isshowNewbg=false}if(isshowNewbg){this.bg.visible=false;this.bg2.visible=true}else{this.bg.visible=true;this.bg2.visible=false}};StartGameWin.prototype.checkShowPolicy=function(){this.grpPolicy.visible=LoginMgr.ins().is_user_agreement_open==1;if(this.grpPolicy.visible){this.cbAcceptPolicy.selected=true}};StartGameWin.prototype.onTouchLabelPolicy1=function(){this.showPolicy1()};StartGameWin.prototype.onTouchLabelPolicy2=function(){this.showPolicy2()};StartGameWin.prototype.showPolicy1=function(){var self=this;if(ChannelMgr.ins().isWXSmallGameChannel()){DisplayPolicyWin.show([g_terms_20122["g_terms_20122_1"],g_terms_20122["g_terms_20122_2"],g_terms_20122["g_terms_20122_3"],g_terms_20122["g_terms_20122_4"],g_terms_20122["g_terms_20122_5"]],g_terms_20122["g_terms_20122_0"],function(){self.cbAcceptPolicy.selected=true;ViewManager.ins().close(DisplayPolicyWin)},this,function(){self.cbAcceptPolicy.selected=false;ViewManager.ins().close(DisplayPolicyWin)},this);return}DisplayPolicyWin.show([g_terms["DisplayPolicyWin_11"],g_terms["DisplayPolicyWin_12"],g_terms["DisplayPolicyWin_13"],g_terms["DisplayPolicyWin_14"],g_terms["DisplayPolicyWin_15"],g_terms["DisplayPolicyWin_16"]],g_terms["DisplayPolicyWin_2"],function(){self.cbAcceptPolicy.selected=true;ViewManager.ins().close(DisplayPolicyWin)},this,function(){self.cbAcceptPolicy.selected=false;ViewManager.ins().close(DisplayPolicyWin)},this)};StartGameWin.prototype.showPolicy2=function(){var self=this;if(ChannelMgr.ins().isWXSmallGameChannel()){DisplayPolicyWin.show([g_terms_20122["g_terms_20122_7"],g_terms_20122["g_terms_20122_8"],g_terms_20122["g_terms_20122_9"]],g_terms_20122["g_terms_20122_6"],function(){self.cbAcceptPolicy.selected=true;ViewManager.ins().close(DisplayPolicyWin)},this,function(){self.cbAcceptPolicy.selected=false;ViewManager.ins().close(DisplayPolicyWin)},this);return}DisplayPolicyWin.show([g_terms["DisplayPolicyWin_0"]],g_terms["DisplayPolicyWin_3"],function(){self.cbAcceptPolicy.selected=true;ViewManager.ins().close(DisplayPolicyWin)},this,function(){self.cbAcceptPolicy.selected=false;ViewManager.ins().close(DisplayPolicyWin)},this)};StartGameWin.prototype.showClientVersion=function(){var cur_url=location.href;if(window["OPEN_DATA"]&&window["OPEN_DATA"].appurl){cur_url=window["OPEN_DATA"].appurl}var i=cur_url.lastIndexOf("index.html");if(ChannelMgr.ins().isChuDongChannel()){i=cur_url.lastIndexOf("index_chudong.html")}else if(ChannelMgr.ins().is1758Channel()){i=cur_url.lastIndexOf("index_1758.html")}else if(ChannelMgr.ins().isAnQiGeChannel()){i=cur_url.lastIndexOf("indexcht.html")}var pre_url=cur_url.slice(0,i);var j=pre_url.lastIndexOf("/");var v=pre_url.slice(j+1,pre_url.length);var mc=ChannelMgr.ins().main_channel;var sc=ChannelMgr.ins().sub_channel;if(v.indexOf("_")<0){v+="_"}v+=mc+"_"+sc;if(!isNaN(LocationProperty.v)){v+="_"+LocationProperty.v.toString()}this.clientVersion.text=v.toString();if(window["isSmallGame"]){var str="";var t=GetUrlParam("t");if(t){var t_text=DateUtils.getFormatBySecond(Math.floor(t/1e3),DateUtils.TIME_FORMAT_18);t_text=t_text.slice(2);str+=t_text+"_"}this.clientVersion.text=str+mc+"_"+sc+"_"+LocationProperty.v.toString();try{var env=window["wx"];if(typeof env=="undefined"){env=window["qq"]}var mbb=env.getMenuButtonBoundingClientRect();var res=env.getSystemInfoSync();this.noticeBtn.top=mbb.top+mbb.height+15}catch(e){}}};StartGameWin.prototype.onPostNoticeWords=function(notice_type){var _this=this;if(notice_type===void 0){notice_type=1}var params="type=getnotice&session="+g_login_session;params+="&notice_type="+notice_type;LoginMgr.request(LoginMgr.preUrl+"login.php",params,function(response){var notice_type=response.notice_type;GameLogic.ins().noticeInfo[notice_type]={title:response.title,info:response.info};var timestamp_new=response.timestamp;if(timestamp_new){LoginMgr.getItem("timestamp"+notice_type,function(timestamp){LoginMgr.setItem("timestamp"+notice_type,timestamp_new);if(timestamp&&timestamp_new!=timestamp){_this.showNoticeWin()}})}},function(response){})};StartGameWin.prototype.reqNotice=function(){for(var i=1;i<=3;i++){this.onPostNoticeWords(i)}};StartGameWin.prototype.onClickedNotice=function(){this.showNoticeWin();this.reqNotice()};StartGameWin.prototype.showNoticeWin=function(){if(!ViewManager.ins().isShow(NoticeWin)){LoginMgr.openView(NoticeWin)}else{GameLogic.ins().postNotice()}};StartGameWin.prototype.onSelectBtn=function(){LoginMgr.openView(SelectServerWin)};StartGameWin.prototype.onClick=function(){this.timeLab.text="";TimerManager.ins().remove(this.updateTime,this)};StartGameWin.prototype.onSelectServerOK=function(e){if(e===void 0){e=null}if(e){var isSelectServerOK=SelectServerMgr.ins().isSelectServerOK;this.enterBtn.enabled=isSelectServerOK;console.log("StartGameWin onSelectServerOK isSelectServerOK = "+isSelectServerOK)}};StartGameWin.prototype.onGetServerName=function(e){if(e===void 0){e=null}if(e&&e.data){this.serverName.text=e.data;console.log("StartGameWin onGetServerName serverName = "+e.data);var status_4=SelectServerMgr.ins().getServerStatus(e.data);this.updateStatus(status_4)}this.updateBtnVA();this.checkShowPolicy()};StartGameWin.prototype.onReLoginBtn=function(){g_auto_login=false;ViewManager.ins().close(StartGameWin);LoginMgr.openView(LoginWin)};StartGameWin.prototype.checkServer=function(){if(SelectServerMgr.ins().isSelectServerOK&&SelectServerMgr.ins().getServerStatus()!=2){this.onEnterBtn()}else{var delayTime=1500;this.showCenterTips(delayTime)}};StartGameWin.prototype.showCenterTips=function(duration){this.centerTips.alpha=1;this.centerTipsGroup.visible=true;this.centerTips.text;var __this=this;__this.centerTips.y=0;var waitTime=500;egret.Tween.get(this.centerTips).to({y:-200},duration,egret.Ease.sineIn);egret.setTimeout(function(){egret.Tween.get(__this.centerTips).to({alpha:0},waitTime,egret.Ease.sineIn)},__this,duration);egret.setTimeout(function(){__this.centerTipsGroup.visible=false},__this,duration+waitTime)};StartGameWin.prototype.onEnterBtn=function(){if(egret.Capabilities.isMobile&&egret.Capabilities.os=="iOS"){SoundManager.ins().playEffectImpl(SoundUtil.WINDOW)}else{SoundManager.ins().playEffect(SoundUtil.WINDOW)}LoadingTimeoutMgr.ins().beginStep(LoadingTimeoutMgr.STEPID_ENTER_GAME);console.log("serverIP:"+LocationProperty.serverIP+" srvid:"+LocationProperty.srvid+" serverPort:"+LocationProperty.serverPort);var self=this;var doEnterGameImpl=function(){GameApp.ins().load();ViewManager.ins().close(StartGameWin)};var doEnterGame=function(){if(!LoginMgr.ins().needAntiAddiction()){doEnterGameImpl()}else{self.enterBtn.enabled=false;LoginMgr.ins().sendGetAccountInfo(function(){var errMsg=LoginMgr.ins().checkAntiAddiction();if(errMsg!=null){self.enterBtn.enabled=true;SaveNewCountWin.show(errMsg,function(){ViewManager.ins().close(SaveNewCountWin)},this,null,null,"sure")}else{doEnterGameImpl()}})}};var checkIDSubmit=function(){if(ChannelMgr.ins().isNeedSubmitID()&&!LoginMgr.ins().isRealName){GlobalConfig.loadPreConfig();SubmitIDWin.show("",function(){ViewManager.ins().close(SubmitIDWin);doEnterGame();ViewManager.ins().close(SaveNewCountWin)},this,undefined,undefined,"sure")}else{doEnterGame()}};if(self.grpPolicy.visible&&!self.cbAcceptPolicy.selected){SaveNewCountWin.show(i18n("StartGameWin_4"),function(){ViewManager.ins().close(SaveNewCountWin)},this,null,null,"sure")}else{checkIDSubmit()}};StartGameWin.prototype.close=function(){GameApp.stopGameResPreload();SelectServerMgr.ins().removeEventListener(SelectServerMgr.EVENT_SEND_SERVERNAME,this.onGetServerName,this);TimerManager.ins().remove(this.onEnterBtn,this);TimerManager.ins().remove(this.updateTime,this);_super.prototype.close.call(this)};return StartGameWin}(BaseEuiView);__reflect(StartGameWin.prototype,"StartGameWin");var JadeDataNew=function(){function JadeDataNew(){this.lv=0;this.exp=0;this._isUpdate=true}JadeDataNew.prototype.parser=function(bytes){this.lv=bytes.readShort();this.exp=bytes.readShort();var len=bytes.readShort();this.danDate=new Object;for(var i=0;i<len;i++)this.danDate[bytes.readInt()]=bytes.readShort();this._isUpdate=true};JadeDataNew.prototype.parserOther=function(bytes){this.lv=bytes.readShort();this._isUpdate=true};JadeDataNew.prototype.getSkillList=function(){if(this._isUpdate){this._isUpdate=false;this._skillList=[];var skills=JadeNew.ins().getSkillsByLv(this.lv);if(skills){for(var _i=0,skills_4=skills;_i<skills_4.length;_i++){var skillId=skills_4[_i];this._skillList.push(new SkillData(skillId))}}}return this._skillList};return JadeDataNew}();__reflect(JadeDataNew.prototype,"JadeDataNew");var JadeNew=function(_super){__extends(JadeNew,_super);function JadeNew(){var _this=_super.call(this)||this;_this.jadeData=[];_this.sysId=PackageID.JadeNew;_this.regNetMsg(1,_this.postJadeData);return _this}JadeNew.ins=function(){return _super.ins.call(this)};JadeNew.prototype.postJadeData=function(bytes){var roleID=bytes.readShort();var jade=this.jadeData[roleID];if(!jade){jade=new JadeDataNew;this.jadeData[roleID]=jade}jade.parser(bytes);return roleID};JadeNew.prototype.sendUseDan=function(roleID,itemID){var bytes=this.getBytes(2);bytes.writeShort(roleID);bytes.writeInt(itemID);this.sendToServer(bytes)};JadeNew.prototype.sendUpgrade=function(roleID,itemID){var bytes=this.getBytes(3);bytes.writeShort(roleID);bytes.writeInt(itemID);this.sendToServer(bytes)};JadeNew.prototype.getJadeDataByID=function(roleID){if(!this.jadeData||!this.jadeData.length)return null;return this.jadeData[roleID]};JadeNew.prototype.isJadeMax=function(roleID){var jadeData=this.getJadeDataByID(roleID);if(!jadeData)return false;return jadeData.lv>=Object.keys(GlobalConfig.JadePlateLevelConfig).length-1};JadeNew.prototype.checkRed=function(){for(var i=0;i<3;i++){if(this.checkRedByRoleID(i))return true}return false};JadeNew.prototype.checkOpen=function(){if(Actor.level<GlobalConfig.JadePlateBaseConfig.openlv)return false;if(GameServer.serverOpenDay<GlobalConfig.JadePlateBaseConfig.openDay-1)return false;return true};JadeNew.prototype.checkRedByRoleID=function(roleID){if(!this.checkOpen())return false;if(!SubRoles.ins().getSubRoleByIndex(roleID))return false;var jadeData=this.getJadeDataByID(roleID);if(!jadeData)return false;if(this.isJadeMax(roleID))return false;var level=jadeData.lv;var itemData;var addExp=0;for(var key in GlobalConfig.JadePlateBaseConfig.itemInfo){itemData=UserBag.ins().getBagItemById(+key);addExp+=+GlobalConfig.JadePlateBaseConfig.itemInfo[key]*(itemData?itemData.count:0)}if(addExp+jadeData.exp>=GlobalConfig.JadePlateLevelConfig[level].exp)return true;var lvCfg;var phase=Math.floor(level/GlobalConfig.JadePlateBaseConfig.perLevel)+1;var used=0,count=0,curMax=0;for(var key in GlobalConfig.JadePlateBaseConfig.upgradeInfo){itemData=UserBag.ins().getBagItemById(+key);count=itemData?itemData.count:0;used=jadeData.danDate&&jadeData.danDate[key]?+jadeData.danDate[key]:0;lvCfg=GlobalConfig.JadePlateLevelConfig[(phase-1)*GlobalConfig.JadePlateBaseConfig.perLevel];curMax=lvCfg.upgradeItemInfo&&lvCfg.upgradeItemInfo[key]?+lvCfg.upgradeItemInfo[key]:0;if(used<curMax&&count)return true}return false};JadeNew.prototype.getSkillsByLv=function(lv){var phase=Math.floor(lv/GlobalConfig.JadePlateBaseConfig.perLevel)+1;var cfg=GlobalConfig.JadePlateLevelConfig[(phase-1)*GlobalConfig.JadePlateBaseConfig.perLevel];var skillLen=cfg.skillIdList?cfg.skillIdList.length:0;if(skillLen<=0)return null;var len=GlobalConfig.JadePlateBaseConfig.skillUnlock.length;var skillList=[];var skillID;for(var i=0;i<len;i++){for(var j=0;j<skillLen;j++){skillID=cfg.skillIdList[j];if(skillID==GlobalConfig.JadePlateBaseConfig.skillUnlock[i].id&&skillID>100)skillList.push(skillID)}}return skillList.length?skillList:null};return JadeNew}(BaseSystem);__reflect(JadeNew.prototype,"JadeNew");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.jadeNew=JadeNew.ins.bind(JadeNew)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var LongHun=function(_super){__extends(LongHun,_super);function LongHun(){var _this=_super.call(this)||this;_this.sysId=PackageID.LoongSoul;_this.regNetMsg(1,_this.postDateUpdate);_this.regNetMsg(2,_this.postStageUpgrade);_this.regNetMsg(3,_this.postStageActive);return _this}LongHun.ins=function(){return _super.ins.call(this)};LongHun.prototype.sendUpGrade=function(roleID,type){var bytes=this.getBytes(1);bytes.writeShort(roleID);bytes.writeShort(type);this.sendToServer(bytes)};LongHun.prototype.postDateUpdate=function(bytes){var roleIndex=bytes.readShort();var type=bytes.readShort();var model=SubRoles.ins().getSubRoleByIndex(roleIndex);var lv=bytes.readInt();var exp=bytes.readInt();var lvChange=0;switch(type+1){case LongHun.TYPE_LONG_HUN:lvChange=model.loongSoulData.level==lv?0:1;model.loongSoulData.level=lv;model.loongSoulData.exp=exp;break;case LongHun.TYPE_HU_DUN:model.shieldData.level=lv;model.shieldData.exp=exp;break;case LongHun.TYPE_XUE_YU:model.xueyuData.level=lv;model.xueyuData.exp=exp;break}return lvChange};LongHun.prototype.sendStageUpgrade=function(roleID,type){var bytes=this.getBytes(2);bytes.writeShort(roleID);bytes.writeShort(type);this.sendToServer(bytes)};LongHun.prototype.postStageUpgrade=function(bytes){var roleIndex=bytes.readShort();var type=bytes.readShort();var stage=bytes.readInt();var model=SubRoles.ins().getSubRoleByIndex(roleIndex);switch(type+1){case LongHun.TYPE_LONG_HUN:model.loongSoulData.stage=stage;break;case LongHun.TYPE_HU_DUN:model.shieldData.stage=stage;break;case LongHun.TYPE_XUE_YU:model.xueyuData.stage=stage;break}};LongHun.prototype.sendStageActive=function(roleID,type){var bytes=this.getBytes(3);bytes.writeShort(roleID);bytes.writeShort(type);this.sendToServer(bytes)};LongHun.prototype.postStageActive=function(bytes){var roleIndex=bytes.readShort();var type=bytes.readShort();var state=bytes.readByte();var model=SubRoles.ins().getSubRoleByIndex(roleIndex);switch(type+1){case LongHun.TYPE_LONG_HUN:model.loongSoulData.state=state;break;case LongHun.TYPE_HU_DUN:model.shieldData.state=state;break;case LongHun.TYPE_XUE_YU:model.xueyuData.state=state;break}RewardWin.showAct(1,i18n("LongHun_0"),"",false,null,"","jlonghun_01")};LongHun.prototype.canShowRedPointByType=function(roleID,type){var role=SubRoles.ins().getSubRoleByIndex(roleID);if(!role)return false;var costExp=0;var currExp=0;var config=null;var nextConfig=null;var stageConfig=null;switch(type){case LongHun.TYPE_LONG_HUN:if(role.loongSoulData.state==0){var level=GlobalConfig.LoongSoulBaseConfig.openlv;if(Actor.level<level){return false}return true}config=GlobalConfig.LoongSoulConfig[role.loongSoulData.level];nextConfig=GlobalConfig.LoongSoulConfig[role.loongSoulData.level+1];stageConfig=GlobalConfig.LoongSoulStageConfig[role.loongSoulData.stage];currExp=role.loongSoulData.exp;break;case LongHun.TYPE_HU_DUN:config=GlobalConfig.ShieldConfig[role.shieldData.level];nextConfig=GlobalConfig.ShieldConfig[role.shieldData.level+1];stageConfig=GlobalConfig.ShieldStageConfig[role.shieldData.stage];currExp=role.shieldData.exp;break}if(!nextConfig)return false;if(this.assert(config&&stageConfig,"config or stageConfig is null"))return false;var itemNum=UserBag.ins().getBagGoodsCountById(0,config.itemId);if(stageConfig.normalCostTip==undefined){return false}return itemNum>=stageConfig.normalCostTip};LongHun.prototype.canShowRedPointInRole=function(roleID){var arr=[LongHun.TYPE_LONG_HUN];for(var _i=0,arr_4=arr;_i<arr_4.length;_i++){var value=arr_4[_i];if(this.canShowRedPointByType(roleID,value)){return true}}return false};LongHun.prototype.canShowRedPointInAll=function(){for(var i=0;i<3;i++){if(this.canShowRedPointInRole(i)){return true}}if(HeartMethodRedPoint.ins().redPoint)return true;if(HunguRedPoint.ins().redPoint&&Hungu.ins().checkShowOpen())return true;return false};LongHun.prototype.canUpgradeByType=function(roleID,type){var role=SubRoles.ins().getSubRoleByIndex(roleID);if(role){var config=null;var stageConfig=null;switch(type){case LongHun.TYPE_LONG_HUN:config=GlobalConfig.LoongSoulConfig[role.loongSoulData.level];stageConfig=GlobalConfig.LoongSoulStageConfig[role.loongSoulData.stage];break;case LongHun.TYPE_HU_DUN:config=GlobalConfig.ShieldConfig[role.shieldData.level];stageConfig=GlobalConfig.ShieldStageConfig[role.shieldData.stage];break}var itemNum=UserBag.ins().getBagGoodsCountById(0,config.itemId);return itemNum>0}return false};LongHun.prototype.canUpgradeinAll=function(){var arr=[LongHun.TYPE_LONG_HUN,LongHun.TYPE_HU_DUN,LongHun.TYPE_XUE_YU];for(var i=0;i<3;i++){for(var _i=0,arr_5=arr;_i<arr_5.length;_i++){var value=arr_5[_i];if(this.canUpgradeByType(i,value)==true){return true}}}return false};LongHun.prototype.canGradeupLoongSoul=function(type){var boolList=[false,false,false];var roleLen=SubRoles.ins().subRolesLen;for(var i=0;i<roleLen;i++){boolList[i]=this.canShowRedPointInRole(i)}return boolList};LongHun.prototype.assert=function(value,msg){return Assert(value,"["+egret.getQualifiedClassName(this)+"] "+msg)};LongHun.TYPE_LONG_HUN=2;LongHun.TYPE_HU_DUN=3;LongHun.TYPE_XUE_YU=4;return LongHun}(BaseSystem);__reflect(LongHun.prototype,"LongHun");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.longhun=LongHun.ins.bind(LongHun)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var LongHunData=function(){function LongHunData(){this.level=0;this.stage=0;this.exp=0;this.state=0}LongHunData.prototype.parser=function(bytes){this.stage=bytes.readInt();this.level=bytes.readInt();this.exp=bytes.readInt();this.state=bytes.readByte()};LongHunData.getLongHunAllLevel=function(){var sumlevel=0;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var data=SubRoles.ins().getSubRoleByIndex(i).loongSoulData;sumlevel+=data.level}return sumlevel};return LongHunData}();__reflect(LongHunData.prototype,"LongHunData");var LongHunWin=function(_super){__extends(LongHunWin,_super);function LongHunWin(){var _this=_super.call(this)||this;_this.starList=null;_this.barbc=new ProgressBarEff;return _this}LongHunWin.prototype.childrenCreated=function(){this.barbc.setWidth(525);this.barbc.x=-15;this.barbc.y=-12;this.expGroup.addChild(this.barbc);this.mc=new MovieClip;this.mc.x=240;this.mc.y=400;this.starList=new StarList(10);this.starList.x=15;this.starList.y=0;this.starGroup.addChild(this.starList);this.eff=new MovieClip;this.eff.x=this.activeBtnMc.width/2;this.eff.y=this.activeBtnMc.height/2;this.eff.scaleX=1.17;this.eff.touchEnabled=false;this.activeBtnMc.touchEnabled=false;this.iconMc=new MovieClip;this.iconMc.touchEnabled=false};LongHunWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var selectedIndex=param&&param[0]?param[0]:0;this.curRole=selectedIndex;this.index=LongHun.TYPE_LONG_HUN;this.addTouchEvent(this.upgradeBtn,this.onTap);this.addTouchEvent(this.activeBtn,this.onTap);this.observe(UserBag.ins().postItemAdd,this.roleChange);this.observe(LongHun.ins().postDateUpdate,this.roleChange);this.observe(LongHun.ins().postStageUpgrade,this.roleChange);this.observe(LongHun.ins().postStageActive,this.roleChange);this.barbc.reset();this.maxShowGroup.visible=false;this.roleChange();this.onTabChange();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.yuXi)};LongHunWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.colorCanvas0,this.onTap);this.removeTouchEvent(this.upgradeBtn,this.onTap);DisplayUtils.removeFromParent(this.eff);DisplayUtils.removeFromParent(this.iconMc);this.removeObserve();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};LongHunWin.prototype.roleSelectChange=function(e){this.roleChange()};LongHunWin.prototype.onTabChange=function(e){if(e===void 0){e=null}this.roleChange()};LongHunWin.prototype.onTap=function(e){switch(e.currentTarget){case this.colorCanvas0:case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break;case this.upgradeBtn:if(this.upgradeBtn.label==i18n("LongHunWin_0")){this.sendUpgrade()}else if(this.upgradeBtn.label==i18n("LongHunWin_1")){this.sendStageUpgrade()}else{this.openBuyGoods()}break;case this.activeBtn:var level=GlobalConfig.LoongSoulBaseConfig.openlv;if(Actor.level>=level){this.sendStageActive()}else{UserTips.ins().showTips(i18n("LongHunWin_2",level))}break}};LongHunWin.prototype.onTaps=function(e){if(this._config==null)return;var num=GlobalConfig.VipConfig[this.index>2?13:14].attrAddition["percent"];num=this.index==LongHun.TYPE_XUE_YU?0:num;var attr=[];this._config.attr.forEach(function(element){attr.push(element.value*num/100>>0)});ViewManager.ins().open(ForgeTipsWin,attr,AttributeData.getAttStr(this._config.attr,1,1,""))};LongHunWin.prototype.maxControll=function(flag){this.maxGroup.visible=flag;this.material.visible=flag;this.barbc.visible=flag;this.powerPanel.visible=true;this.maxLevel.visible=!flag;this.activeGroup.visible=false;this.stairImg.visible=true;this.maxShowGroup.visible=!flag;if(flag){this.curAtt.x=62;this.curAtt.y=408}else{this.curAtt.x=170;this.curAtt.y=408}};LongHunWin.prototype.sendUpgrade=function(){LongHun.ins().sendUpGrade(this.curRole,this.index-1)};LongHunWin.prototype.sendStageUpgrade=function(){LongHun.ins().sendStageUpgrade(this.curRole,this.index-1)};LongHunWin.prototype.openBuyGoods=function(){UserWarn.ins().setBuyGoodsWarn(this._config.itemId,this._missingNum)};LongHunWin.prototype.sendStageActive=function(){LongHun.ins().sendStageActive(this.curRole,this.index-1)};LongHunWin.prototype.updateStageInfo=function(){var currentRole=SubRoles.ins().getSubRoleByIndex(this.curRole);switch(this.index){case LongHun.TYPE_LONG_HUN:this._stageConfig=GlobalConfig.LoongSoulStageConfig[currentRole.loongSoulData.stage];break;case LongHun.TYPE_HU_DUN:this._stageConfig=GlobalConfig.ShieldStageConfig[currentRole.shieldData.stage];break;case LongHun.TYPE_XUE_YU:this._stageConfig=GlobalConfig["XueyuStageConfig"][currentRole.xueyuData.stage];break}if(!this.iconMc.parent){this.iconGroup.addChild(this.iconMc)}this.iconMc.playFile(RES_DIR_EFF+this._stageConfig.icon,-1)};LongHunWin.prototype.roleChange=function(isUpgrade){if(isUpgrade===void 0){isUpgrade=0}this.updateStageInfo();var lv=0;var exp=0;var nextConfig;var fase;var role=SubRoles.ins().getSubRoleByIndex(this.curRole);var finallyAttr=null;if(this.index==LongHun.TYPE_HU_DUN){lv=role.shieldData.level;exp=role.shieldData.exp;this._config=GlobalConfig.ShieldConfig[lv];nextConfig=GlobalConfig.ShieldConfig[lv+1];if(UserVip.ins().lv>=13){this.addTouchEvent(this.vipLabel,this.onTaps);var attr=AttributeData.getAttrStrAdd(this._config.attr,13);this.curAtt.text=AttributeData.getAttStr(attr,0,1,"：")}else{finallyAttr=AttributeData.AttrAddition(this._config.attr,this._stageConfig.attr);this.curAtt.text=AttributeData.getAttStr(finallyAttr,0,1,"：")}}else if(this.index==LongHun.TYPE_LONG_HUN){lv=role.loongSoulData.level;exp=role.loongSoulData.exp;var stair=0;this._config=GlobalConfig.LoongSoulConfig[lv];nextConfig=GlobalConfig.LoongSoulConfig[lv+1];this.stairImg.setValue(role.loongSoulData.stage+1);if(UserVip.ins().lv>=14){var attr=AttributeData.getAttrStrAdd(this._config.attr,14);this.curAtt.text=AttributeData.getAttStr(attr,0,1,"：")}else{finallyAttr=AttributeData.AttrAddition(this._config.attr,this._stageConfig.attr);this.curAtt.text=AttributeData.getAttStr(finallyAttr,0,1,"：")}this.maxCurAtt.text=this.curAtt.text}if(lv>0){this.starList.setStarNum(lv%10==0?10:lv%10,isUpgrade)}else{this.starList.setStarNum(0)}var level=GlobalConfig.LoongSoulBaseConfig.openlv;this.sysDescText.text=i18n("LongHunWin_5",level);this.barbc.setData(exp,this._config.exp);var power=UserBag.getAttrPower(this._config.attr);this.powerPanel.setPower(power);var longHunMax=CommonUtils.getObjectLength(GlobalConfig.LoongSoulConfig)-1;if(role.loongSoulData.state){if(lv!=longHunMax){this.maxControll(true)}else{this.maxControll(false);return}}else{this.maxGroup.visible=false;this.material.visible=false;this.barbc.visible=false;this.maxLevel.visible=false;this.stairImg.visible=false;this.activeGroup.visible=true;this.powerPanel.visible=false;this.redPoint.visible=false;if(Actor.level>=level){this.activeBtn.enabled=true;this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.eff.parent){this.activeBtnMc.addChild(this.eff)}this.redPoint.visible=true}else{this.activeBtn.enabled=false;DisplayUtils.removeFromParent(this.eff)}}var itemCount=UserBag.ins().getBagGoodsCountById(0,this._config.itemId);var itemName=GlobalConfig.ItemConfig[this._config.itemId].name;this.upgradeBtn.label=itemCount<1?i18n("LongHunWin_6"):i18n("LongHunWin_7");if(itemCount<this._stageConfig.normalCost){this._missingNum=this._stageConfig.normalCost-itemCount}else{this._missingNum=0}var colorStr="";if(itemCount>=this._stageConfig.normalCost)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;this.material.textFlow=TextFlowMaker.generateTextFlow(i18n("LongHunWin_8",colorStr,itemCount,ColorUtil.UI_ITEMNUMBER_BULE,this._stageConfig.normalCost));this.material.visible=true;this.showStageUpgradeBtn(lv);var attrs;var nextStageCofig;var stageLevel=0;var isStageUpgrade=this.upgradeBtn.label==i18n("LongHunWin_9");var tempConfig=isStageUpgrade?this._config:nextConfig;if(this.index==LongHun.TYPE_LONG_HUN){attrs=AttributeData.getAttrStrAdd(tempConfig.attr,13);stageLevel=isStageUpgrade?role.loongSoulData.stage+1:role.loongSoulData.stage;nextStageCofig=GlobalConfig.LoongSoulStageConfig[stageLevel]}else if(this.index==LongHun.TYPE_HU_DUN){attrs=AttributeData.getAttrStrAdd(tempConfig.attr,14);stageLevel=isStageUpgrade?role.shieldData.stage+1:role.shieldData.stage;nextStageCofig=GlobalConfig.ShieldStageConfig[stageLevel]}else if(this.index==LongHun.TYPE_XUE_YU){attrs=AttributeData.getAttrStrAdd(tempConfig.attr,15);stageLevel=isStageUpgrade?role.xueyuData.stage+1:role.xueyuData.stage;nextStageCofig=GlobalConfig["XueyuStageConfig"][stageLevel]}attrs=AttributeData.AttrAddition(attrs,nextStageCofig.attr);this.nextAtt.text=AttributeData.getAttStr(attrs,0,1,"：")};LongHunWin.prototype.showStageUpgradeBtn=function(lv){var stageLevel=0;var role=SubRoles.ins().getSubRoleByIndex(this.curRole);switch(this.index){case LongHun.TYPE_LONG_HUN:stageLevel=role.loongSoulData.stage;break;case LongHun.TYPE_HU_DUN:stageLevel=role.shieldData.stage;break;case LongHun.TYPE_XUE_YU:stageLevel=role.xueyuData.stage;break}if(lv>0&&lv%10==0){if(stageLevel<=lv/10-1){this.upgradeBtn.label=i18n("LongHunWin_10");this.material.visible=false;this.starList.setStarNum(10);this.barbc.visible=false}else{this.starList.setStarNum(0);this.barbc.visible=true}}};return LongHunWin}(BaseView);__reflect(LongHunWin.prototype,"LongHunWin");var TreasureWin=function(_super){__extends(TreasureWin,_super);function TreasureWin(){var _this=_super.call(this)||this;_this.lastSelect=0;_this.skinName="TreasureWinSkin";_this.isTopLevel=true;return _this}TreasureWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};TreasureWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var num=this.viewStack.numChildren;for(var i=0;i<num;i++){this.viewStack.getChildAt(i).close()}this.removeObserve()};TreasureWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addChangingEvent(this.tab,this.onTabTouching);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangeEvent(this.roleSelect,this.onChange);this.addTouchEvent(this.help,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(HeartMethodRedPoint.ins().postHeartMethodRedPoint,this.showRoleRedPoint);this.observe(ShenshouRedpoint.ins().postRedPoint,this.showTabRedPoint);this.lastSelect=param[0]||0;this.curRole=param[1]||0;this.viewStack.selectedIndex=this.lastSelect;this.roleSelect.setCurRole(this.curRole);this.setOpenIndex(this.viewStack.selectedIndex);this.observe(UserBag.ins().postItemAdd,this.delayRedPoint);this.observe(UserBag.ins().postItemChange,this.delayRedPoint);this.observe(Actor.ins().postLevelChange,this.delayRedPoint);this.observe(JadeNew.ins().postJadeData,this.delayRedPoint);this.observe(LongHun.ins().postDateUpdate,this.delayRedPoint);this.observe(LongHun.ins().postStageUpgrade,this.delayRedPoint);this.observe(LongHun.ins().postStageActive,this.delayRedPoint);this.observe(Actor.ins().postPowerChange,this.refreshPower);this.observe(HunguRedPoint.ins().postRedPoint,this.showTabRedPoint);this.checkYuPeiRed();this.checkPanel()};TreasureWin.prototype.checkPanel=function(){if(Hungu.ins().checkShowOpen()){if(!this.HunguPanel.parent){this.viewStack.addChild(this.HunguPanel)}if(this.redPoint4.parent){this.redPointGroup.addChild(this.redPoint4)}}else{DisplayUtils.removeFromParent(this.HunguPanel);DisplayUtils.removeFromParent(this.redPoint4)}};TreasureWin.prototype.refreshPower=function(){this.roleSelect.refreshPower(this.roleSelect._curRole)};TreasureWin.prototype.delayRedPoint=function(){if(!TimerManager.ins().isExists(this.checkYuPeiRed,this))TimerManager.ins().doTimer(60,1,this.checkYuPeiRed,this)};TreasureWin.prototype.checkYuPeiRed=function(){this.redPoint0.visible=false;for(var i=0;i<SubRoles.ins().subRolesLen;i++){var b=LongHun.ins().canShowRedPointInRole(i);if(b){this.redPoint0.visible=b;break}}this.redPoint1.visible=JadeNew.ins().checkRed();this.showRoleRedPoint()};TreasureWin.prototype.onTabTouching=function(e){if(!TreasureWin.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};TreasureWin.prototype.onTabTouch=function(e){this.setOpenIndex(this.viewStack.selectedIndex)};TreasureWin.prototype.setRoleId=function(roleId){this.curRole=roleId;this.setOpenIndex(this.viewStack.selectedIndex)};TreasureWin.prototype.onTap=function(e){switch(e.currentTarget){case this.help:if(this.viewStack.selectedIndex==TreasureWin.Longhun){}else if(this.viewStack.selectedIndex==TreasureWin.Yupei){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[30].text)}else if(this.viewStack.selectedIndex==TreasureWin.Xinfa){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[27].text)}else if(this.viewStack.selectedIndex==TreasureWin.Hungu){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[36].text)}break;case this.closeBtn:ViewManager.ins().close(this);break}};TreasureWin.prototype.setOpenIndex=function(index){this.lastSelect=index;this.help.visible=true;this.roleSelect.currentState="uphead";var param=[];switch(this.viewStack.selectedIndex){case TreasureWin.Longhun:this.title.source="biaoti_longhun";this.roleSelect.currentState="yhead";this.help.visible=false;break;case TreasureWin.Yupei:this.title.source="biaoti_yupei";this.roleSelect.currentState="uphead";break;case TreasureWin.Xinfa:this.title.source="heartmethodName";this.roleSelect.currentState="yhead";if(this.lastSelect!=undefined){var hmwin=this.viewStack.getElementAt(this.lastSelect);if(hmwin)param[0]=hmwin.heartId}break;case TreasureWin.Shenshou:this.help.visible=false;this.title.source="biaoti_shoushen";this.roleSelect.currentState="nohead";break;case TreasureWin.Hungu:this.title.source="hunguName";this.roleSelect.currentState="yhead";param[0]=HGPOS.ITEM0;break}if(this.lastSelect!=undefined){this.viewStack.getElementAt(this.lastSelect)["close"]()}this.viewStack.getElementAt(this.lastSelect)["open"](this.curRole,param[0]);this.showRoleRedPoint()};TreasureWin.prototype.onChange=function(e){this.setRoleId(this.roleSelect.getCurRole())};TreasureWin.checkIsOpen=function(index){if(index==TreasureWin.Yupei&&!JadeNew.ins().checkOpen()){UserTips.ins().showTips(i18n("TreasureWin_0",GlobalConfig.JadePlateBaseConfig.openDay,GlobalConfig.JadePlateBaseConfig.openlv));return false}if(index==TreasureWin.Xinfa&&!HeartMethod.ins().checkOpen()){UserTips.ins().showTips(i18n("TreasureWin_1",GlobalConfig.HeartMethodBaseConfig.serverDay,GlobalConfig.HeartMethodBaseConfig.zsLv));return false}if(index==TreasureWin.Shenshou&&!ShenshouModel.ins().checkOpen()){UserTips.ins().showTips(i18n("TreasureWin_2",GlobalConfig.ShenShouConfig.openserverday,GlobalConfig.ShenShouConfig.openzhuanshenglv));return false}if(index==TreasureWin.Hungu&&!Hungu.ins().checkOpen()){UserTips.ins().showTips(i18n("TreasureWin_3",GlobalConfig.HunGuConf.openserverday,GlobalConfig.HunGuConf.openzhuanshenglv));return false}return true};TreasureWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};TreasureWin.prototype.showTabRedPoint=function(){this.redPoint2.visible=HeartMethodRedPoint.ins().redPoint;this.redPoint3.visible=ShenshouRedpoint.ins().redpoint;this.redPoint4.visible=HunguRedPoint.ins().redPoint};TreasureWin.prototype.showRoleRedPoint=function(){var len=SubRoles.ins().subRolesLen;switch(this.viewStack.selectedIndex){case TreasureWin.Longhun:for(var i=0;i<len;i++){this.roleSelect.showRedPoint(i,LongHun.ins().canShowRedPointInRole(i))}break;case TreasureWin.Yupei:for(var i=0;i<len;i++)this.roleSelect.showRedPoint(i,JadeNew.ins().checkRedByRoleID(i));break;case TreasureWin.Xinfa:for(var i=0;i<len;i++){var red=false;for(var k in HeartMethodRedPoint.ins().roleTabs[i]){if(HeartMethodRedPoint.ins().roleTabs[i][k]){red=true;break}}this.roleSelect.showRedPoint(i,red)}break;case TreasureWin.Hungu:for(var i=0;i<len;i++){var red=HunguRedPoint.ins().roleTabs[i];this.roleSelect.showRedPoint(i,red)}break}this.showTabRedPoint()};TreasureWin.Longhun=0;TreasureWin.Yupei=1;TreasureWin.Xinfa=2;TreasureWin.Shenshou=3;TreasureWin.Hungu=4;return TreasureWin}(BaseEuiView);__reflect(TreasureWin.prototype,"TreasureWin");ViewManager.ins().reg(TreasureWin,LayerManager.UI_Main);var JadeNewPanel=function(_super){__extends(JadeNewPanel,_super);function JadeNewPanel(){var _this=_super.call(this)||this;_this._curRole=0;_this._oldLevel=0;_this._curMaterail=-1;_this._oneKeyUp=false;return _this}JadeNewPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this._iconY=this.yupei.y;this._iconMoveY=this.yupei.y-10;this.yupei.perLevel=GlobalConfig.JadePlateBaseConfig.perLevel;this._danInfo=[];var i=0;var itemConfig;for(var key in GlobalConfig.JadePlateBaseConfig.upgradeInfo){this["up"+i].name=i;itemConfig=GlobalConfig.ItemConfig[key];this["up"+i].source=itemConfig.icon+"_png";this._danInfo.push({id:+key,used:0,curMax:0,jade:0,count:0});i++}this._materialInfo=[];i=0;for(var key in GlobalConfig.JadePlateBaseConfig.itemInfo){this["checkBoxs"+i].name=i;itemConfig=GlobalConfig.ItemConfig[key];this["lvImg"+i].source=itemConfig.icon+"_png";this["lvImg"+i].name=key;this._materialInfo.push({id:+key,count:0,addExp:+GlobalConfig.JadePlateBaseConfig.itemInfo[key]});i++}for(i=0;i<5;i++){this["skillIcon"+i].name=i;this["skillIcon"+i].touchEnabled=true;this["skillIcon"+i].touchChildren=false}this._expBar=new ProgressBarEff;this._expBar.setWidth(525);this.barGroup.addChild(this._expBar);this._expBar.x=-15;this._expBar.y=-10};JadeNewPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if(args&&args.length)this._curRole=args[0];this._jadeData=JadeNew.ins().getJadeDataByID(this._curRole);if(!this._jadeData)return;this._oldLevel=this._jadeData.lv;this.observe(JadeNew.ins().postJadeData,this.jadeChange);this.observe(UserBag.ins().postItemAdd,this.updateMaterial);this.observe(UserBag.ins().postItemChange,this.updateMaterial);this.addTouchEvent(this,this.onTouch);this.reset();this.update();this.playIconTween();this.initCheckBoxs();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.yuPei)};JadeNewPanel.prototype.initCheckBoxs=function(){var len=this._materialInfo.length;this._curMaterail=0;for(var i=0;i<len;i++){if(this._materialInfo[i].count){this._curMaterail=i;break}}this["checkBoxs"+this._curMaterail].selected=true};JadeNewPanel.prototype.reset=function(){this._curMaterail=-1;this.stopOneKyUp();this.checkBoxs0.selected=this.checkBoxs1.selected=this.checkBoxs2.selected=false;this.stopIconTween();this._expBar.reset()};JadeNewPanel.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this,this.onTouch);this.stopIconTween();this._curMaterail=-1;this.stopOneKyUp();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};JadeNewPanel.prototype.jadeChange=function(roleID){if(this._curRole!=roleID)return;this._jadeData=JadeNew.ins().getJadeDataByID(this._curRole);this.update()};JadeNewPanel.prototype.playIconTween=function(){this.yupei.y=this._iconY;egret.Tween.removeTweens(this.yupei);egret.Tween.get(this.yupei,{loop:true}).to({y:this._iconMoveY},1e3).to({y:this._iconY},1e3)};JadeNewPanel.prototype.stopIconTween=function(){egret.Tween.removeTweens(this.yupei)};JadeNewPanel.prototype.update=function(){var level=this._jadeData.lv;var objAtts=[];var cfg=GlobalConfig.JadePlateLevelConfig[level];var attr;for(var k in cfg.attrs){attr=cfg.attrs[k];objAtts.push(new AttributeData(attr.type,attr.value))}objAtts=JadeNewPanel.addDanAtt(objAtts,this._jadeData);this.powerPanel.setPower(UserBag.getAttrPower(objAtts,SubRoles.ins().getSubRoleByIndex(this._curRole)));var phase=Math.floor(level/GlobalConfig.JadePlateBaseConfig.perLevel)+1;this.lv.text=this.getNumStr(phase)+i18n("JadeNewPanel_0")+this.getNumStr(level%GlobalConfig.JadePlateBaseConfig.perLevel)+i18n("JadeNewPanel_1");var isMax=JadeNew.ins().isJadeMax(this._curRole);var isUpgrade;this.maxShowGroup.visible=this.maxLevel.visible=isMax;this.updateMaterial();if(isMax){this.maxGroup.visible=false;this.maxCurAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："))}else{this.maxGroup.visible=true;isUpgrade=this._oldLevel!=level;this._oldLevel=level;this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："));objAtts=[];var nextCfg=GlobalConfig.JadePlateLevelConfig[level+1];for(var k in nextCfg.attrs)objAtts.push(new AttributeData(nextCfg.attrs[k].type,nextCfg.attrs[k].value));objAtts=JadeNewPanel.addDanAtt(objAtts,this._jadeData);this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："))}var jade=Math.floor(level/(GlobalConfig.JadePlateBaseConfig.perLevel*9));this.yupei.setLevel(level,isUpgrade&&level%GlobalConfig.JadePlateBaseConfig.perLevel==10);if(level%GlobalConfig.JadePlateBaseConfig.perLevel==10)this.barGroup.visible=false;else{this.barGroup.visible=true;if(this._expBar.getMaxValue()!=cfg.exp)this._expBar.setData(this._jadeData.exp,cfg.exp);else this._expBar.setValue(this._jadeData.exp)}cfg=GlobalConfig.JadePlateLevelConfig[(phase-1)*GlobalConfig.JadePlateBaseConfig.perLevel];var len=GlobalConfig.JadePlateBaseConfig.skillUnlock.length;var skillLen=cfg.skillIdList?cfg.skillIdList.length:0;for(var i=0;i<len;i++){this["blackImg"+i].visible=true;for(var j=0;j<skillLen;j++){if(cfg.skillIdList[j]==GlobalConfig.JadePlateBaseConfig.skillUnlock[i].id)this["blackImg"+i].visible=false}}};JadeNewPanel.prototype.getNumStr=function(num){var list=[];if(Math.floor(num/10)){var shi=Math.floor(num/10);if(shi>1)list.push(shi);list.push(10);if(num%10!=0)list.push(num%10)}else list.push(num%10);var str="";var len=list.length;for(var i=0;i<len;i++){switch(list[i]){case 0:str+=i18n("JadeNewPanel_2");break;case 1:str+=i18n("JadeNewPanel_3");break;case 2:str+=i18n("JadeNewPanel_4");break;case 3:str+=i18n("JadeNewPanel_5");break;case 4:str+=i18n("JadeNewPanel_6");break;case 5:str+=i18n("JadeNewPanel_7");break;case 6:str+=i18n("JadeNewPanel_8");break;case 7:str+=i18n("JadeNewPanel_9");break;case 8:str+=i18n("JadeNewPanel_10");break;case 9:str+=i18n("JadeNewPanel_11");break;case 10:str+=i18n("JadeNewPanel_12");break}}return str};JadeNewPanel.addDanAtt=function(objAtts,jadeData){if(jadeData.danDate&&Object.keys(jadeData.danDate).length){var newObj=objAtts.concat();var atts=void 0;var subLen=void 0;for(var key in jadeData.danDate){atts=GlobalConfig.JadePlateBaseConfig.upgradeInfo[key];if(atts.precent){var newLen=newObj.length;for(var m=0;m<newLen;m++){if(newObj[m].type!=AttributeType.atHuiXinDamage)objAtts.push(new AttributeData(newObj[m].type,Math.floor(newObj[m].value*+jadeData.danDate[key]*atts.precent/1e4)))}}if(atts.attr){subLen=atts.attr.length;for(var j=0;j<subLen;j++)objAtts.push(new AttributeData(atts.attr[j].type,atts.attr[j].value*+jadeData.danDate[key]))}}newObj=[];subLen=objAtts.length;var obj=new Object;for(var i=0;i<subLen;i++){if(obj[objAtts[i].type]==undefined)obj[objAtts[i].type]=0;obj[objAtts[i].type]+=objAtts[i].value}for(var key in obj)newObj.push(new AttributeData(+key,+obj[key]));return newObj}return objAtts};JadeNewPanel.prototype.updateMaterial=function(){var level=this._jadeData.lv;var len=this._danInfo.length;var info;var itemData;var phase=Math.floor(level/GlobalConfig.JadePlateBaseConfig.perLevel)+1;var lvCfg;for(var i=0;i<len;i++){info=this._danInfo[i];itemData=UserBag.ins().getBagItemById(info.id);info.count=itemData?itemData.count:0;info.used=this._jadeData.danDate&&this._jadeData.danDate[info.id]?+this._jadeData.danDate[info.id]:0;info.jade=phase;lvCfg=GlobalConfig.JadePlateLevelConfig[(phase-1)*GlobalConfig.JadePlateBaseConfig.perLevel];info.curMax=lvCfg.upgradeItemInfo&&lvCfg.upgradeItemInfo[info.id]?+lvCfg.upgradeItemInfo[info.id]:0;this["used"+i].text=info.used;this["redPoint"+i].visible=info.used<info.curMax&&info.count}len=this._materialInfo.length;var material;var addExp=0;for(var i=0;i<len;i++){material=this._materialInfo[i];itemData=UserBag.ins().getBagItemById(material.id);material.count=itemData?itemData.count:0;this["lvNum"+i].textFlow=TextFlowMaker.generateTextFlow1(i18n("JadeNewPanel_20",material.count?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N,material.count));addExp+=material.addExp*material.count}this.normal.visible=level%GlobalConfig.JadePlateBaseConfig.perLevel!=10;this.upLv.visible=!this.normal.visible;this.upgradeBtn0.visible=this.upgradeBtn.visible;this.groupGift.x=this.normal.visible?228:84};JadeNewPanel.prototype.onTouch=function(e){switch(e.target){case this.upgradeBtn:this.onUpgrade();break;case this.upgradeBtn0:this.onUpgrade(true);break;case this.upgradeBtn1:this.onUpgrade();break;case this.up0:case this.up1:case this.up2:var info=this._danInfo[e.target.name];if(info.used<info.curMax&&info.count)JadeNew.ins().sendUseDan(this._curRole,info.id);else ViewManager.ins().open(JadeUpTipsWin,info);break;case this.checkBoxs0:case this.checkBoxs1:case this.checkBoxs2:if(this._oneKeyUp)this.stopOneKyUp();var index=+e.target.name;this._curMaterail=-1;var box=void 0;for(var i=0;i<3;i++){box=this["checkBoxs"+i];if(i==index)this._curMaterail=box.selected?index:-1;else box.selected=false}break;case this.skillIcon0:case this.skillIcon1:case this.skillIcon2:case this.skillIcon3:case this.skillIcon4:var data=GlobalConfig.JadePlateBaseConfig.skillUnlock[e.target.name];ViewManager.ins().open(YupeiSkillTipsWin,data.name,data.desc);break;case this.lvImg0:case this.lvImg1:case this.lvImg2:ViewManager.ins().open(ItemDetailedWin,0,e.target.name);break}};JadeNewPanel.prototype.onUpgrade=function(isOneKey){if(isOneKey===void 0){isOneKey=false}if(isOneKey&&this._oneKeyUp){this.stopOneKyUp();return}if(this._oneKeyUp)this.stopOneKyUp();if(this._jadeData.lv%GlobalConfig.JadePlateBaseConfig.perLevel==10)JadeNew.ins().sendUpgrade(this._curRole,this._materialInfo[0].id);else{if(this._curMaterail==-1)UserTips.ins().showTips(i18n("JadeNewPanel_16"));else if(this._materialInfo[this._curMaterail].count<=0){UserTips.ins().showTips(i18n("JadeNewPanel_17",16711680));UserWarn.ins().setBuyGoodsWarn(this._materialInfo[this._curMaterail].id)}else{var count=this._materialInfo[this._curMaterail].count;if(count>1&&isOneKey){TimerManager.ins().doTimer(150,count,this.sendUp,this,this.stopOneKyUp,this);this.upgradeBtn0.label=i18n("JadeNewPanel_18");this._oneKeyUp=true}else JadeNew.ins().sendUpgrade(this._curRole,this._materialInfo[this._curMaterail].id)}}};JadeNewPanel.prototype.stopOneKyUp=function(){this._oneKeyUp=false;this.upgradeBtn0.label=i18n("JadeNewPanel_19");TimerManager.ins().remove(this.sendUp,this)};JadeNewPanel.prototype.sendUp=function(){if(this._jadeData.lv%GlobalConfig.JadePlateBaseConfig.perLevel==10){this.stopOneKyUp();return}JadeNew.ins().sendUpgrade(this._curRole,this._materialInfo[this._curMaterail].id)};return JadeNewPanel}(BaseEuiView);__reflect(JadeNewPanel.prototype,"JadeNewPanel");var JadeUpTipsWin=function(_super){__extends(JadeUpTipsWin,_super);function JadeUpTipsWin(){var _this=_super.call(this)||this;_this.skinName="YuPeiUpTipsSkin";_this.isTopLevel=true;return _this}JadeUpTipsWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);var info=args[0];var itemConfig=GlobalConfig.ItemConfig[info.id];this.itemIcon.setData(itemConfig);this.nameLabel.text=itemConfig.name;this.use.text=info.used+"/"+info.curMax;this.num.text=info.count+"";this.attr.textFlow=TextFlowMaker.generateTextFlow1(itemConfig.desc);var maxPhase=Math.floor((Object.keys(GlobalConfig.JadePlateLevelConfig).length-1)/GlobalConfig.JadePlateBaseConfig.perLevel)+1;var cfg;var show=false;var i;for(i=info.jade;i<=maxPhase;i++){cfg=GlobalConfig.JadePlateLevelConfig[(i-1)*GlobalConfig.JadePlateBaseConfig.perLevel];if(cfg.upgradeItemInfo&&cfg.upgradeItemInfo[info.id]&&+cfg.upgradeItemInfo[info.id]>info.curMax){show=true;break}}if(show){this.info.visible=true;this.num0.text=i+i18n("JadeUpTipsWin_0")}else this.info.visible=false};JadeUpTipsWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch)};JadeUpTipsWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break}};return JadeUpTipsWin}(BaseEuiView);__reflect(JadeUpTipsWin.prototype,"JadeUpTipsWin");ViewManager.ins().reg(JadeUpTipsWin,LayerManager.UI_Main);var YupeiSkillTipsWin=function(_super){__extends(YupeiSkillTipsWin,_super);function YupeiSkillTipsWin(){var _this=_super.call(this)||this;_this.skinName="YupeiSkillTipsNewSkin";_this.isTopLevel=true;return _this}YupeiSkillTipsWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.nameLabel.text=args[0];this.description.textFlow=TextFlowMaker.generateTextFlow1(args[1]);this.addTouchEvent(this.bgClose,this.onTouch)};YupeiSkillTipsWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch)};YupeiSkillTipsWin.prototype.onTouch=function(e){ViewManager.ins().close(this)};return YupeiSkillTipsWin}(BaseEuiView);__reflect(YupeiSkillTipsWin.prototype,"YupeiSkillTipsWin");ViewManager.ins().reg(YupeiSkillTipsWin,LayerManager.UI_Main);var MailData=function(){function MailData(){}MailData.prototype.parser=function(bytes){this.disposeData(bytes);this.item=[];this.text=bytes.readString();var len=bytes.readInt();for(var i=0;i<len;i++){var reward=new RewardData;reward.parser(bytes);this.item.push(reward)}};MailData.prototype.disposeData=function(bytes){this.handle=bytes.readInt();this.title=bytes.readString();this.times=bytes.readInt();this.type=bytes.readInt();this.receive=bytes.readInt()};return MailData}();__reflect(MailData.prototype,"MailData");var UserMail=function(_super){__extends(UserMail,_super);function UserMail(){var _this=_super.call(this)||this;_this.currentMailHandle=0;_this.mailData=[];_this._mailListData=new eui.ArrayCollection;_this.sysId=PackageID.Mail;_this.regNetMsg(1,_this.doMailData);_this.regNetMsg(2,_this.doMailDetailedData);_this.regNetMsg(3,_this.doDeleteMail);_this.regNetMsg(4,_this.doGetItemMail);_this.regNetMsg(5,_this.doAddMail);return _this}UserMail.ins=function(){return _super.ins.call(this)};Object.defineProperty(UserMail.prototype,"mailListData",{get:function(){this.mailData.sort(this.mailSort2);this._mailListData.source=this.mailData;return this._mailListData},enumerable:true,configurable:true});UserMail.prototype.sendMailContentData=function(mailHandle){var bytes=this.getBytes(2);bytes.writeInt(mailHandle);this.sendToServer(bytes)};UserMail.prototype.sendGetItem=function(list){var bytes=this.getBytes(4);bytes.writeInt(list.length);for(var i=0;i<list.length;i++){bytes.writeInt(list[i])}this.sendToServer(bytes)};UserMail.prototype.doMailData=function(bytes){this.parser(bytes,1);this.postMailData()};UserMail.prototype.postMailData=function(){};UserMail.prototype.doMailDetailedData=function(bytes){var mailData=new MailData;mailData.parser(bytes);for(var i=0;i<this.mailData.length;i++){if(this.mailData[i].handle==mailData.handle){this.mailData.splice(i,1,mailData);break}}this.currentMailHandle=mailData.handle;if(!UserMail.ins().isAllReceive)ViewManager.ins().open(MailDetailedWin);this.postMailDetail(mailData)};UserMail.prototype.postMailDetail=function(data){return data};UserMail.prototype.doDeleteMail=function(bytes){this.deleteMailDataByHandle(bytes.readInt());this.postMailData()};UserMail.prototype.doGetItemMail=function(bytes){this.setMailListData(bytes)};UserMail.prototype.postGetItemFromMail=function(){};UserMail.prototype.doAddMail=function(bytes){this.parser(bytes,0);this.postMailData()};UserMail.prototype.parser=function(bytes,type){if(type){this.mailData=[];var len=bytes.readInt();for(var i=0;i<len;i++){var mailData=new MailData;mailData.disposeData(bytes);this.mailData.push(mailData)}this.mailSort(1)}else{var mailData=new MailData;mailData.disposeData(bytes);this.mailData.unshift(mailData)}};UserMail.prototype.getMailDataByHandle=function(handle){for(var _i=0,_a=this.mailData;_i<_a.length;_i++){var mail=_a[_i];if(mail.handle==handle)return mail}return null};UserMail.prototype.deleteMailDataByHandle=function(handle){for(var i=0;i<this.mailData.length;i++){if(this.mailData[i].handle==handle){this.mailData.splice(i,1);return}}};UserMail.prototype.getMailByReceive=function(receive){if(receive===void 0){receive=0}var list=[];for(var i=this.mailData.length-1;i>=0;i--){if(this.mailData[i].receive==receive)list.push(this.mailData[i])}return list};UserMail.prototype.getUnreadMail=function(){var sum=0;for(var i=this.mailData.length-1;i>=0;i--){var mail=this.mailData[i];if(mail.type==0||mail.receive==0)sum+=1}return sum};UserMail.prototype.getCurrentMail=function(){return this.getMailDataByHandle(this.currentMailHandle)};UserMail.prototype.setMailListData=function(bytes){var len=bytes.readInt();for(var i=0;i<len;i++){var handle=bytes.readInt();for(var _i=0,_a=this.mailData;_i<_a.length;_i++){var mail=_a[_i];if(mail.handle==handle){mail.type=bytes.readInt();mail.receive=bytes.readInt();this.postMailDetail(mail);break}}}this.postGetItemFromMail()};UserMail.prototype.sortDesc=function(a,b){var s1=a.times;var s2=b.times;return Algorithm.sortDesc(s1,s2)};UserMail.prototype.sortAsc=function(a,b){var s1=a.times;var s2=b.times;return Algorithm.sortAsc(s1,s2)};UserMail.prototype.mailSort=function(isSort){var mailList=this.mailData;if(isSort)mailList.sort(this.sortDesc);else mailList.sort(this.sortAsc);return mailList};UserMail.prototype.mailSort2=function(a,b){var num=0;num=Algorithm.sortAsc(a.type,b.type);if(num!=0)return num;if(a.receive==0&&b.receive!=0)return-1;if(a.receive!=0&&b.receive==0)return 1;num=Algorithm.sortDesc(a.times,b.times);if(num!=0)return num;return num};return UserMail}(BaseSystem);__reflect(UserMail.prototype,"UserMail");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.usermail=UserMail.ins.bind(UserMail)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var MailDetailedWin=function(_super){__extends(MailDetailedWin,_super);function MailDetailedWin(){return _super.call(this)||this}MailDetailedWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="MailContentSkin";this.itemList.itemRenderer=ItemBase};MailDetailedWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.rect,this.onTap);this.textLabel.addEventListener(egret.TextEvent.LINK,this.linkClick,this);this.addTouchEvent(this.receiveBtn,this.onTap);this.observe(UserMail.ins().postGetItemFromMail,this.setMailData);this.setMailData()};MailDetailedWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};MailDetailedWin.prototype.linkClick=function(evt){var lst=evt.text.split(",");var pa=lst.slice(1);if(lst[0]){ViewManager.ins().open(lst[0],pa[0]?pa:null);ViewManager.ins().close(this);ViewManager.ins().close(FriendBgWin)}};MailDetailedWin.prototype.onTap=function(e){switch(e.currentTarget){case this.receiveBtn:var list=[];list.push(UserMail.ins().currentMailHandle);UserMail.ins().sendGetItem(list);case this.closeBtn:case this.closeBtn0:case this.rect:ViewManager.ins().close(this);break}};MailDetailedWin.prototype.otherClose=function(evt){var bg=this.background;if(evt.localX>=bg.x&&evt.localX<=bg.x+bg.width&&evt.localY>=bg.y&&evt.localY<=bg.y+bg.height){}else{ViewManager.ins().close(this)}};MailDetailedWin.prototype.setMailData=function(){var mailData=UserMail.ins().getCurrentMail();this.textLabel.textFlow=TextFlowMaker.generateTextFlow1(mailData.text);this.setReceiveBtn(mailData.receive,mailData.item.length>0);this.itemList.dataProvider=new eui.ArrayCollection(mailData.item)};MailDetailedWin.prototype.setReceiveBtn=function(receive,isShow){if(isShow===void 0){isShow=false}var str="";this.receiveBtn.visible=receive>=0;if(receive)str=i18n("MailDetailedWin_3");else str=i18n("MailDetailedWin_4");this.receiveBtn.label=str;this.receiveBtn.enabled=!Boolean(receive);this.receiveBtn.visible=isShow;this.desc.visible=!isShow};return MailDetailedWin}(BaseEuiView);__reflect(MailDetailedWin.prototype,"MailDetailedWin");ViewManager.ins().reg(MailDetailedWin,LayerManager.UI_Popup);var MailItem=function(_super){__extends(MailItem,_super);function MailItem(){var _this=_super.call(this)||this;_this.skinName="MailItemSkin";return _this}MailItem.prototype.createChildren=function(){_super.prototype.createChildren.call(this)};MailItem.prototype.dataChanged=function(){var mailData=this.data;if(mailData instanceof MailData){var str=i18n("MailItem_2")+mailData.title+"|";str=str+i18n("MailItem_3")+(mailData.type?"0X8C7551":"0X00cc33")+"&T:"+(mailData.type?i18n("MailItem_0"):i18n("MailItem_1"))+"|";this.nameLabel.textFlow=TextFlowMaker.generateTextFlow(str);this.dateLabel.text=DateUtils.getFormatBySecond(mailData.times,2);this.treasure.source=mailData.receive==0?"220003_png":""}};return MailItem}(BaseItemRender);__reflect(MailItem.prototype,"MailItem");var MailWin=function(_super){__extends(MailWin,_super);function MailWin(){var _this=_super.call(this)||this;_this.name=i18n("MailWin_0");return _this}MailWin.prototype.childrenCreated=function(){this._mails=[];this.mailList.itemRenderer=MailItem;this.mailScroller.viewport=this.mailList};MailWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.allReceiveBtn,this.onTap);this.addTouchEvent(this.mailList,this.onSendMail);this.observe(UserMail.ins().postMailDetail,this.setOpenMail);this.observe(UserMail.ins().postGetItemFromMail,this.mailCall);this.setMailData()};MailWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}WatcherUtil.removeFromArrayCollection(this.mailList.dataProvider);this.mailList.dataProvider=null};MailWin.prototype.mailCall=function(){if(UserMail.ins().isAllReceive){for(var i=0;i<this._mails.length;i++){UserMail.ins().sendMailContentData(this._mails[i].handle)}}};MailWin.prototype.onTap=function(e){switch(e.currentTarget){case this.allReceiveBtn:UserMail.ins().isAllReceive=true;var list=[];var mailList=UserMail.ins().getMailByReceive();for(var i=0;i<mailList.length;i++){list.push(mailList[i].handle)}UserMail.ins().sendGetItem(list);break}};MailWin.prototype.onSendMail=function(e){if(!e)return;UserMail.ins().isAllReceive=false;var item=e.target.parent;if(item){var mailData=item.data;if(mailData){UserMail.ins().sendMailContentData(mailData.handle)}}};MailWin.prototype.setMailData=function(){this._mails=UserMail.ins().mailData;this.mailList.dataProvider=new eui.ArrayCollection(this._mails);this.allReceiveBtn.visible=Boolean(UserMail.ins().getMailByReceive().length);if(UserMail.ins().mailData.length>0)this.noMailTip.visible=false};MailWin.prototype.setOpenMail=function(mailData){for(var i=0;i<this.mailList.numChildren;i++){var item=this.mailList.getChildAt(i);if(item.data.handle==mailData.handle){item.data=mailData;return}}};return MailWin}(BaseComponent);__reflect(MailWin.prototype,"MailWin");var MarryMgr=function(_super){__extends(MarryMgr,_super);function MarryMgr(){var _this=_super.call(this)||this;_this._isMarried=false;_this._showMarrySys=false;_this.giftID=1;_this.rankInfo={};_this.rankShowInfo={};_this.taskInfo={};_this.propose_redpoint=0;_this.divorce_redpoint=0;_this.level_award_redpoint=0;_this.level_up_redpoint=0;_this.euip1_redpoint=0;_this.euip2_redpoint=0;_this.euip3_redpoint=0;_this.euip4_redpoint=0;_this.chest1_redpoint=0;_this.chest2_redpoint=0;_this.login1_redpoint=0;_this.login2_redpoint=0;_this.login3_redpoint=0;_this.login4_redpoint=0;_this.task0_redpoint=0;_this.task1_redpoint=0;_this.wallListDt=[];_this.proposalListDt=[];_this.sysId=PackageID.Marry;_this.regNetMsg(1,_this.postWallInfo);_this.regNetMsg(2,_this.postUpWallResult);_this.regNetMsg(3,_this.postProposalReqResult);_this.regNetMsg(4,_this.postProposalResult);_this.regNetMsg(5,_this.postProrosalList);_this.regNetMsg(6,_this.postMarryInfo);_this.regNetMsg(7,_this.postMarryLevelUp);_this.regNetMsg(8,_this.postMarryLevelReward);_this.regNetMsg(9,_this.postEquipLevelUp);_this.regNetMsg(10,_this.postBuyChest);_this.regNetMsg(11,_this.postChestAward);_this.regNetMsg(12,_this.postLoginAward);_this.regNetMsg(13,_this.postActivateEquip);_this.regNetMsg(14,_this.postRankList);_this.regNetMsg(15,_this.postDivorceApply);_this.regNetMsg(16,_this.postDivorce);_this.regNetMsg(17,_this.postTaskList);_this.regNetMsg(18,_this.postTaskAward);_this.regNetMsg(19,_this.postChangeRole);return _this}MarryMgr.prototype.isOpen=function(){var b=false;var level=Actor.level;var openlevel=GlobalConfig.MarryBaseConfig.openlevel||80;if(level>=openlevel){b=true}return b};MarryMgr.prototype.isMarried=function(){return this._isMarried};MarryMgr.prototype.clearInfo=function(){this._isMarried=false;this.marryInfo=null;this.rankInfo={};this.rankShowInfo={};this.taskInfo={}};MarryMgr.prototype.postSelectObj=function(data){this.proposeInfo=data;return data};MarryMgr.prototype.canLevelUp=function(){var res=false;var info=this.marryInfo;if(!info){return res}var costItemId=GlobalConfig.MarryBaseConfig.marryLevelup.itemID;var costNum=GlobalConfig.MarryLevelupConfig[info.level].cost;var cfg=GlobalConfig.ItemConfig[costItemId];if(!cfg){console.log(i18n("MarryMgr_0")+costItemId);return}var mat_name=cfg.name;var isHave=UserBag.ins().getBagGoodsCountById(0,costItemId);if(isHave<costNum){res=false}else{res=true}return res};MarryMgr.prototype.getMarryTitle=function(){var title=i18n("MarryMgr_1");var desc="";var info=MarryMgr.ins().marryInfo;if(!info){return[title,desc]}for(var k in GlobalConfig.MarryTitleAttrsConfig){var config=GlobalConfig.MarryTitleAttrsConfig[k];if(config.level<=info.level){title=config.name;desc=config.desc}}return[title,desc]};MarryMgr.prototype.getMarryLevelMax=function(){var max=0;for(var k in GlobalConfig.MarryLevelupConfig){var config=GlobalConfig.MarryLevelupConfig[k];if(config.level>max){max=config.level}}return max};MarryMgr.prototype.isMarryLevelMax=function(){var max=this.getMarryLevelMax();var info=this.marryInfo;if(!info){return false}var level=info.level;if(level>=max){return true}return false};MarryMgr.prototype.getMarryNextLevel=function(){var info=MarryMgr.ins().marryInfo;if(!info){return 1}var level=info.level||1;var nLevel=level+1;var max=MarryMgr.ins().getMarryLevelMax();if(nLevel>max){nLevel=max}return nLevel};MarryMgr.prototype.getXinwuPrice=function(xinwuID){if(xinwuID===void 0){xinwuID=1}var cfg=GlobalConfig.MarryBaseConfig.xinwuPrice;for(var i=0;i<cfg.length;i++){var v=cfg[i];if(v.id==xinwuID){return v.price}}return 688};MarryMgr.prototype.getObjID=function(){var info=this.marryInfo;if(!info){return 0}return info.obj_id};MarryMgr.prototype.loginRewardTaken=function(id){var info=this.marryInfo;if(!info){return false}var taken=info.login_awards;if(taken&&taken.indexOf(id)>-1){return true}return false};MarryMgr.prototype.getObjLoginDay=function(){var info=this.marryInfo;if(!info){return 0}return info.login_days};MarryMgr.prototype.getRank=function(rankType){return this.rankInfo[rankType]||[]};MarryMgr.prototype.getRankReward=function(rankType,rank){var cfg=GlobalConfig.MarryRankConfig[rankType];for(var minRank in cfg){var v=cfg[minRank];var min=v.minRank;var max=v.maxRank;if(min<=rank&&rank<=max){return v.rewards}}return[]};MarryMgr.prototype.getMyRank=function(rankType){var info=this.rankInfo[rankType];for(var _i=0,info_2=info;_i<info_2.length;_i++){var v=info_2[_i];if(v.obj1_id==Actor.actorID||v.obj2_id==Actor.actorID){return v.rank}}return 0};MarryMgr.prototype.getMyScore=function(rankType){var info=this.rankInfo[rankType];for(var _i=0,info_3=info;_i<info_3.length;_i++){var v=info_3[_i];if(v.obj1_id==Actor.actorID||v.obj2_id==Actor.actorID){return v.value}}return 0};MarryMgr.prototype.getTaskInfo1=function(taskType){var info=this.taskInfo[taskType]||[];return info};MarryMgr.prototype.getTaskInfo2=function(taskType,task_id){var info=this.taskInfo[taskType]||[];var info2=info[task_id]||null;return info2};MarryMgr.prototype.getMarriedRedPoint=function(){var r=this.getProposeRedPoint();r+=this.getLevelRedPoint();r+=this.getEquipRedPoint();r+=this.getChestRedPoint();r+=this.getTaskRedPoint();return r};MarryMgr.prototype.getProposeRedPoint=function(){return this.propose_redpoint};MarryMgr.prototype.getLevelRedPoint=function(){return this.propose_redpoint+this.divorce_redpoint+this.level_award_redpoint+this.level_up_redpoint};MarryMgr.prototype.getEquipRedPoint=function(id){if(id===void 0){id=null}if(id){return this["euip"+id+"_redpoint"]}else{return this["euip1_redpoint"]+this["euip2_redpoint"]+this["euip3_redpoint"]+this["euip4_redpoint"]}};MarryMgr.prototype.getChestRedPoint=function(){return this.chest1_redpoint+this.chest2_redpoint+this.login1_redpoint+this.login2_redpoint+this.login3_redpoint+this.login4_redpoint};MarryMgr.prototype.getTaskRedPoint=function(){return this.task0_redpoint+this.task1_redpoint};MarryMgr.prototype.refProposeRedPoint=function(){this.postProposeRedPoint()};MarryMgr.prototype.refLevelRedPoint=function(){var info=this.marryInfo;if(!info){console.log(i18n("MarryMgr_2"));this.divorce_redpoint=0;this.level_award_redpoint=0;this.level_up_redpoint=0;return}if(info.divorce_flag){this.divorce_redpoint=1}else{this.divorce_redpoint=0}if(info.award_got_level<info.level&&info.level>1){this.level_award_redpoint=1}else{this.level_award_redpoint=0}if(this.canLevelUp()){this.level_up_redpoint=1}else{this.level_up_redpoint=0}this.postLevelRedPoint()};MarryMgr.prototype.refChestRedPoint=function(){var info=this.marryInfo;if(!info){this.chest1_redpoint=0;this.chest2_redpoint=0;this.login1_redpoint=0;this.login2_redpoint=0;this.login3_redpoint=0;this.login4_redpoint=0;return}var objName=info.obj_name;var objID=info.obj_id;this.chest1_redpoint=0;this.chest2_redpoint=0;var chest_box=info.chest_box||{};var arr=Object.keys(chest_box);var len=arr.length;if(len){if(chest_box[Actor.actorID]){if(chest_box[Actor.actorID].flag==0&&chest_box[Actor.actorID].left_time>0){this.chest1_redpoint=1}}if(chest_box[objID]){if(chest_box[objID].flag==0&&chest_box[objID].left_time>0){this.chest2_redpoint=1}}}var config=GlobalConfig.MarryLoginChestAward;for(var i=0;i<4;i++){var cfg=config[i+1];var nCfg=config[i];var id=cfg.id;var day=cfg.days;var nday=nCfg&&nCfg.days||0;this["login"+(i+1)+"_redpoint"]=0;if(!MarryMgr.ins().loginRewardTaken(id)){var objDay=MarryMgr.ins().getObjLoginDay();if(objDay>=day){this["login"+(i+1)+"_redpoint"]=1}}}this.postChestRedPoint()};MarryMgr.prototype.refEquipRedPoint=function(){for(var i=1;i<=4;i++){this["euip"+i+"_redpoint"]=0}var info=this.marryInfo;if(!info){console.log(i18n("MarryMgr_3"));return}for(var i=1;i<=4;i++){this.isEquipLive(i)}this.postEquipRedPoint();this.refLevelRedPoint()};MarryMgr.prototype.refTaskRedPoint=function(){this.task0_redpoint=0;this.task1_redpoint=0;var info=this.marryInfo;if(!info){console.log(i18n("MarryMgr_4"));return}this.updateTaskRed(0);this.updateTaskRed(1);this.postTaskRedPoint()};MarryMgr.prototype.updateTaskRed=function(taskType){var info=MarryMgr.ins().getTaskInfo1(taskType);for(var _i=0,info_4=info;_i<info_4.length;_i++){var v=info_4[_i];if(v){var cfg=GlobalConfig.MarryTask[taskType][v.task_id];var info1=MarryMgr.ins().getTaskInfo2(taskType,v.task_id);if(info1){this["task"+taskType+"_redpoint"]=(info1.value||0)>=cfg.target&&(info1.obj_value||0)>=cfg.target?1:0}}if(this["task"+taskType+"_redpoint"]>0){break}}};MarryMgr.prototype.isEquipLive=function(xinwuID){if(xinwuID===void 0){xinwuID=1}var info=this.marryInfo;if(!info){console.log(i18n("MarryMgr_5"));this["euip"+xinwuID+"_redpoint"]=0;return}var myLevel=info.equips&&info.equips[xinwuID]&&info.equips[xinwuID].level||0;var activated=myLevel>0;if(activated){if(myLevel<100){var costItemId=GlobalConfig.MarryBaseConfig.xinwuLevelup.itemID;var costNum=GlobalConfig.MarryEquipLevelupConfig[xinwuID][myLevel].cost;var cfg=GlobalConfig.ItemConfig[costItemId];if(!cfg){console.log(i18n("MarryMgr_6")+costItemId);this["euip"+xinwuID+"_redpoint"]=0;return}var mat_name=cfg.name;var isHave=UserBag.ins().getBagGoodsCountById(0,costItemId);if(isHave<costNum){this["euip"+xinwuID+"_redpoint"]=0}else{this["euip"+xinwuID+"_redpoint"]=1}}else{this["euip"+xinwuID+"_redpoint"]=0}}else{this["euip"+xinwuID+"_redpoint"]=0}};MarryMgr.prototype.postProposeRedPoint=function(){};MarryMgr.prototype.postLevelRedPoint=function(){};MarryMgr.prototype.postEquipRedPoint=function(){};MarryMgr.prototype.postChestRedPoint=function(){};MarryMgr.prototype.postTaskRedPoint=function(){};MarryMgr.prototype.sendGetWallInfo=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};MarryMgr.prototype.postWallInfo=function(bytes){if(!bytes){return}var errid=bytes.readInt();if(errid!=0){console.log("postWallInfo: errid = "+errid);return}this.wallListDt=[];var len=bytes.readInt();for(var i=0;i<len;i++){var data=new FriendWallItemData;data.id=bytes.readInt();data.serverid=bytes.readInt();data.nickname=bytes.readString();data.job=bytes.readShort();data.vip=bytes.readShort();data.online=bytes.readBoolean();data.messageid=bytes.readInt();this.wallListDt.push(data)}};MarryMgr.prototype.sendUpWall=function(mid,needTop){if(mid===void 0){mid=1}if(needTop===void 0){needTop=false}var bytes=this.getBytes(2);bytes.writeInt(mid);bytes.writeBoolean(needTop);this.sendToServer(bytes)};MarryMgr.prototype.postUpWallResult=function(bytes){var errid=bytes.readInt();return errid};MarryMgr.prototype.sendProposalRequest=function(){var obj=this.proposeInfo;if(!obj){console.log(i18n("MarryMgr_7"));return}var actorid=obj.id;var giftid=this.giftID||1;var bytes=this.getBytes(3);bytes.writeInt(actorid);bytes.writeInt(giftid);this.sendToServer(bytes)};MarryMgr.prototype.postProposalReqResult=function(bytes){var errid=bytes.readInt();return errid};MarryMgr.prototype.sendProposalRespond=function(actorid,accept){if(accept===void 0){accept=1}var bytes=this.getBytes(4);bytes.writeInt(actorid);bytes.writeInt(accept);this.sendToServer(bytes)};MarryMgr.prototype.postProposalResult=function(bytes){var errid=bytes.readInt();if(errid==0){var actorid=bytes.readInt()}return errid};MarryMgr.prototype.sendGetProrosalList=function(){var bytes=this.getBytes(5);this.sendToServer(bytes)};MarryMgr.prototype.postProrosalList=function(bytes){if(!bytes){return}var errid=bytes.readInt();if(errid!=0){console.log("postProrosalList: errid = "+errid);return}this.proposalListDt=[];var len=bytes.readInt();for(var i=0;i<len;i++){var data=new ProposalItemData;data.id=bytes.readInt();data.serverid=bytes.readInt();data.nickname=bytes.readString();data.job=bytes.readShort();data.vip=bytes.readShort();data.online=bytes.readBoolean();data.giftid=bytes.readInt();this.proposalListDt.push(data)}this.propose_redpoint=this.proposalListDt.length;this.refProposeRedPoint()};MarryMgr.prototype.sendGetMarryInfo=function(){var bytes=this.getBytes(6);this.sendToServer(bytes)};MarryMgr.prototype.postMarryInfo=function(bytes){if(!bytes){return}var errid=bytes.readInt();var info=new MarryInfo;if(errid!=0){console.log(i18n("MarryMgr_8")+errid);this.clearInfo();return}else{this._isMarried=true}info.level=bytes.readShort();info.award_got_level=bytes.readShort();info.exp=bytes.readInt();info.marry_days=bytes.readInt();info.obj_server_id=bytes.readShort();info.obj_id=bytes.readInt();info.obj_name=bytes.readString();info.obj_job=bytes.readShort();info.obj_level=bytes.readShort();info.obj_offline_days=bytes.readInt();info.my_showid=bytes.readShort();info.obj_showid=bytes.readShort();var len=bytes.readInt();if(!info.chest_box){info.chest_box={}}for(var i=0;i<len;i++){var box=new MarryChestBox;box.actor_id=bytes.readInt();box.left_time=bytes.readInt();box.flag=bytes.readByte();info.chest_box[box.actor_id]=box}info.login_days=bytes.readShort();info.login_awards=[];len=bytes.readInt();for(var i=0;i<len;i++){info.login_awards.push(bytes.readByte())}len=bytes.readInt();if(!info.equips){info.equips={}}for(var i=0;i<len;i++){var equip=new MarryEquip;equip.equip_id=bytes.readShort();equip.level=bytes.readShort();equip.exp=bytes.readInt();equip.obj_equip_level=bytes.readShort();info.equips[equip.equip_id]=equip}info.divorce_flag=bytes.readBoolean();this.marryInfo=info;this.refLevelRedPoint();this.refEquipRedPoint();this.refChestRedPoint();console.log(this.marryInfo)};MarryMgr.prototype.sendMarryLevelUp=function(){var bytes=this.getBytes(7);this.sendToServer(bytes)};MarryMgr.prototype.postMarryLevelUp=function(bytes){var errid=bytes.readInt();if(errid==0){var level=bytes.readShort();var exp=bytes.readInt();if(!this.marryInfo){console.log("postMarryLevelUp this.marryInfo = nil");return}this.marryInfo.level=level;this.marryInfo.exp=exp;this.refLevelRedPoint()}else{console.log("postMarryLevelUp errid = "+errid)}return errid};MarryMgr.prototype.sendGetMarryLevelReward=function(){var bytes=this.getBytes(8);this.sendToServer(bytes)};MarryMgr.prototype.postMarryLevelReward=function(bytes){var errid=bytes.readInt();if(errid==0){var award_got_level=bytes.readShort();if(!this.marryInfo){console.log("postMarryLevelReward this.marryInfo = nil");return}this.marryInfo.award_got_level=award_got_level;this.refLevelRedPoint()}else{console.log("postMarryLevelReward errid = "+errid)}return errid};MarryMgr.prototype.sendEquipLevelUp=function(equip_id){if(equip_id===void 0){equip_id=1}var bytes=this.getBytes(9);bytes.writeShort(equip_id);this.sendToServer(bytes)};MarryMgr.prototype.postEquipLevelUp=function(bytes){var errid=bytes.readInt();if(errid==0){var equip_id=bytes.readShort();var level=bytes.readShort();var exp=bytes.readInt();if(!this.marryInfo){console.log("postEquipLevelUp this.marryInfo = nil");return}if(!this.marryInfo.equips[equip_id]){this.marryInfo.equips[equip_id]=new MarryEquip}this.marryInfo.equips[equip_id].level=level;this.marryInfo.equips[equip_id].exp=exp;this.refEquipRedPoint()}else{console.log("postEquipLevelUp errid = "+errid)}return errid};MarryMgr.prototype.sendBuyChest=function(){var bytes=this.getBytes(10);this.sendToServer(bytes)};MarryMgr.prototype.postBuyChest=function(bytes){var errid=bytes.readInt();if(errid==0){var actor_id=bytes.readInt();var left_time=bytes.readInt();var flag=bytes.readByte();if(!this.marryInfo){console.log("postBuyChest this.marryInfo = nil");return}if(!this.marryInfo.chest_box[actor_id]){this.marryInfo.chest_box[actor_id]=new MarryChestBox}this.marryInfo.chest_box[actor_id].actor_id=actor_id;this.marryInfo.chest_box[actor_id].left_time=left_time;this.marryInfo.chest_box[actor_id].flag=flag;this.refChestRedPoint()}else{console.log("postBuyChest errid = "+errid)}return errid};MarryMgr.prototype.sendGetChestAward=function(actor_id){var bytes=this.getBytes(11);bytes.writeInt(actor_id);this.sendToServer(bytes)};MarryMgr.prototype.postChestAward=function(bytes){var errid=bytes.readInt();if(errid==0){var actor_id=bytes.readInt();var flag=bytes.readByte();if(!this.marryInfo){console.log("postChestAward this.marryInfo = nil");return}if(!this.marryInfo.chest_box[actor_id]){this.marryInfo.chest_box[actor_id]=new MarryChestBox}this.marryInfo.chest_box[actor_id].actor_id=actor_id;this.marryInfo.chest_box[actor_id].flag=flag;this.refChestRedPoint()}else{console.log("postChestAward errid = "+errid)}return errid};MarryMgr.prototype.sendLoginAward=function(id){var bytes=this.getBytes(12);bytes.writeShort(id);this.sendToServer(bytes)};MarryMgr.prototype.postLoginAward=function(bytes){var errid=bytes.readInt();if(errid==0){var id=bytes.readShort();if(!this.marryInfo){console.log("postLoginAward this.marryInfo = nil");return}if(!this.marryInfo.login_awards){this.marryInfo.login_awards=[]}if(this.marryInfo.login_awards.indexOf(id)<0){this.marryInfo.login_awards.push(id)}this.refChestRedPoint()}else{console.log("postLoginAward errid = "+errid)}return errid};MarryMgr.prototype.sendActivateEquip=function(euqip_id){var bytes=this.getBytes(13);bytes.writeShort(euqip_id);this.sendToServer(bytes)};MarryMgr.prototype.postActivateEquip=function(bytes){var errid=bytes.readInt();if(errid==0){var equip_id=bytes.readShort();var level=bytes.readShort();var exp=bytes.readInt();if(!this.marryInfo){console.log("postLoginAward this.marryInfo = nil");return}if(!this.marryInfo.equips[equip_id]){this.marryInfo.equips[equip_id]=new MarryEquip}this.marryInfo.equips[equip_id].level=level;this.marryInfo.equips[equip_id].exp=exp;this.refEquipRedPoint()}else{console.log("postActivateEquip errid = "+errid)}return errid};MarryMgr.prototype.sendGetRankList=function(id){if(id===void 0){id=27}var bytes=this.getBytes(14);bytes.writeShort(id);this.sendToServer(bytes)};MarryMgr.prototype.postRankList=function(bytes){var errid=bytes.readInt();if(errid==0){var rank_type=bytes.readShort();var len=bytes.readInt();this.rankInfo[rank_type]=[];this.rankShowInfo[rank_type]={};for(var i=0;i<len;i++){var info=new MarryRankInfo;info.rank=bytes.readShort();info.obj1_server_id=bytes.readShort();info.obj1_id=bytes.readInt();info.obj1_name=bytes.readString();info.obj1_vip_level=bytes.readShort();info.obj2_server_id=bytes.readShort();info.obj2_id=bytes.readInt();info.obj2_name=bytes.readString();info.obj2_vip_level=bytes.readShort();info.value=bytes.readInt();this.rankInfo[rank_type].push(info)}var showid1=bytes.readShort();var showid2=bytes.readShort();this.rankShowInfo[rank_type]={showid1:showid1,showid2:showid2};console.log("this.rankInfo["+rank_type+"] = "+this.rankInfo[rank_type]);console.log("this.rankShowInfo["+rank_type+"] = "+this.rankShowInfo[rank_type])}else{console.log("postRankList errid = "+errid)}return[errid,rank_type]};MarryMgr.prototype.sendDivorceApply=function(flag){if(flag===void 0){flag=0}var bytes=this.getBytes(15);bytes.writeByte(flag);this.sendToServer(bytes)};MarryMgr.prototype.postDivorceApply=function(bytes){var errid=bytes.readInt();var isMe=true;if(errid==0){var actor_id=bytes.readInt();if(actor_id==Actor.actorID){isMe=true}else{isMe=false;this.marryInfo.divorce_flag=true;this.postMarryInfo(null);this.refLevelRedPoint()}}else{console.log("postDivorceApply errid = "+errid)}return[errid,isMe]};MarryMgr.prototype.sendDivorce=function(flag){if(flag===void 0){flag=0}var bytes=this.getBytes(16);bytes.writeByte(flag);this.sendToServer(bytes)};MarryMgr.prototype.postDivorce=function(bytes){var errid=bytes.readInt();if(errid==0){var flag=bytes.readByte();if(flag==1){this.clearInfo()}else{this.marryInfo.divorce_flag=false;this.refLevelRedPoint()}}else{console.log("postDivorce errid = "+errid)}return[errid,flag]};MarryMgr.prototype.sendGetTaskList=function(){var bytes=this.getBytes(17);this.sendToServer(bytes)};MarryMgr.prototype.postTaskList=function(bytes){var errid=bytes.readInt();if(errid==0){var len=bytes.readInt();for(var i=0;i<len;i++){var type=bytes.readByte();this.taskInfo[type]=[];var len2=bytes.readInt();for(var j=0;j<len2;j++){var info=new MarryTaskInfo;info.task_id=bytes.readShort();info.value=bytes.readInt();info.obj_value=bytes.readInt();this.taskInfo[type][info.task_id]=info}}this.refTaskRedPoint()}else{console.log("postTaskList errid = "+errid)}return errid};MarryMgr.prototype.sendTaskAward=function(type,task_id){var bytes=this.getBytes(18);bytes.writeByte(type);bytes.writeShort(task_id);this.sendToServer(bytes)};MarryMgr.prototype.postTaskAward=function(bytes){var errid=bytes.readInt();if(errid==0){var type=bytes.readByte();var task_id=bytes.readShort();this.refTaskRedPoint()}else{console.log("postTaskAward errid = "+errid)}return errid};MarryMgr.ins=function(){return _super.ins.call(this)};MarryMgr.prototype.sendChangeRole=function(roleid){if(roleid===void 0){roleid=0}var bytes=this.getBytes(19);bytes.writeShort(roleid);this.sendToServer(bytes)};MarryMgr.prototype.postChangeRole=function(bytes){var showid=bytes.readShort();this.marryInfo.my_showid=showid};return MarryMgr}(BaseSystem);__reflect(MarryMgr.prototype,"MarryMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.marryMgr=MarryMgr.ins.bind(MarryMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var MarryInfo=function(){function MarryInfo(){}return MarryInfo}();__reflect(MarryInfo.prototype,"MarryInfo");var MarryChestBox=function(){function MarryChestBox(){}return MarryChestBox}();__reflect(MarryChestBox.prototype,"MarryChestBox");var MarryEquip=function(){function MarryEquip(){}return MarryEquip}();__reflect(MarryEquip.prototype,"MarryEquip");var MarryRankInfo=function(){function MarryRankInfo(){}return MarryRankInfo}();__reflect(MarryRankInfo.prototype,"MarryRankInfo");var MarryTaskInfo=function(){function MarryTaskInfo(){}return MarryTaskInfo}();__reflect(MarryTaskInfo.prototype,"MarryTaskInfo");var MarryTaskGroup=function(){function MarryTaskGroup(){}return MarryTaskGroup}();__reflect(MarryTaskGroup.prototype,"MarryTaskGroup");var MarriedMainWin=function(_super){__extends(MarriedMainWin,_super);function MarriedMainWin(){var _this=_super.call(this)||this;_this.skinName="MarriedWinSkin";_this.isTopLevel=true;return _this}MarriedMainWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=param[0]?param[0]:0;this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.setOpenIndex(this.oldIndex,param[1]);MarryMgr.ins().sendGetMarryInfo();MarryMgr.ins().sendGetTaskList();this.observe(MarryMgr.ins().postLevelRedPoint,this.refRedpoint);this.observe(MarryMgr.ins().postEquipRedPoint,this.refRedpoint);this.observe(MarryMgr.ins().postChestRedPoint,this.refRedpoint);this.observe(MarryMgr.ins().postTaskRedPoint,this.refRedpoint);this.observe(MarryMgr.ins().postDivorce,this.onDivorce);this.refRedpoint()};MarriedMainWin.prototype.onDivorce=function(param){var errid=param[0];var flag=param[1];if(errid==0&&flag==1){ViewManager.ins().open(UnMarriedMainWin);ViewManager.ins().close(this)}};MarriedMainWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.viewStack.getElementAt(this.oldIndex)){this.viewStack.getElementAt(this.oldIndex)["close"]()}};MarriedMainWin.prototype.onTabTouch=function(e){var index=this.tab.selectedIndex;this.setOpenIndex(index)};MarriedMainWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};MarriedMainWin.prototype.checkIsOpen=function(index){return true};MarriedMainWin.prototype.setOpenIndex=function(selectedIndex,selectedIndex2){if(selectedIndex2===void 0){selectedIndex2=0}switch(selectedIndex){case 0:this.marryLevelPanel.open();this.title.source="biaoti_level";break;case 1:this.marryEquipPanel.open([selectedIndex2]);this.title.source="biaoti_equip";break;case 2:this.marryChestPanel.open();this.title.source="biaoti_chest";break;case 3:this.marryMissionPanel.open();this.title.source="biaoti_mission";break}if(this.oldIndex!=selectedIndex){this.viewStack.getElementAt(this.oldIndex)["close"]();this.oldIndex=selectedIndex}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}};MarriedMainWin.prototype.refRedpoint=function(){var ins=MarryMgr.ins();this.redPoint0.visible=ins.getLevelRedPoint()>0;this.redPoint1.visible=ins.getEquipRedPoint()>0;this.redPoint2.visible=ins.getChestRedPoint()>0;this.redPoint3.visible=ins.getTaskRedPoint()>0};MarriedMainWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(MarryMgr.ins().isOpen()){var isMarried=MarryMgr.ins().isMarried();if(!isMarried){ViewManager.ins().open(UnMarriedMainWin);return false}else{return true}}else{UserTips.ins().showTips(i18n("MarriedMainWin_0"));return false}};return MarriedMainWin}(BaseEuiView);__reflect(MarriedMainWin.prototype,"MarriedMainWin");ViewManager.ins().reg(MarriedMainWin,LayerManager.UI_Main);var MarryChestBuy=function(_super){__extends(MarryChestBuy,_super);function MarryChestBuy(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="MarryChestBuySkin";return _this}MarryChestBuy.prototype.childrenCreated=function(){var cost=GlobalConfig.MarryBaseConfig.baoxiaPrice;var day=GlobalConfig.MarryBaseConfig.baoxiaDuration;this.label_cost.text=cost.toString();this.label_day.text=day.toString()+i18n("MarryChestBuy_0");var info=MarryMgr.ins().marryInfo;if(!info){return}this.label_name.text=info.obj_name||i18n("MarryChestBuy_1")};MarryChestBuy.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.btnRefuse,this.onTouch);this.addTouchEvent(this.btnAgree,this.onTouch)};MarryChestBuy.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTouch);this.removeTouchEvent(this.btnRefuse,this.onTouch);this.removeTouchEvent(this.btnAgree,this.onTouch)};MarryChestBuy.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.btnRefuse:ViewManager.ins().close(this);break;case this.btnAgree:MarryMgr.ins().sendBuyChest();ViewManager.ins().close(this);break}};return MarryChestBuy}(BaseEuiView);__reflect(MarryChestBuy.prototype,"MarryChestBuy");ViewManager.ins().reg(MarryChestBuy,LayerManager.UI_Popup);var MarryChestPanel=function(_super){__extends(MarryChestPanel,_super);function MarryChestPanel(){var _this=_super.call(this)||this;_this.res=true;_this.skinName="MarryChestPanelSkin";return _this}MarryChestPanel.prototype.childrenCreated=function(){var cfg=GlobalConfig.MarryBaseConfig;this.list_buy_reward.itemRenderer=ItemBaseNoName;this.list_buy_reward.dataProvider=new eui.ArrayCollection(cfg.buyBaoxiaReward);this.list_reward_0.itemRenderer=ItemBaseNoName;this.list_reward_0.dataProvider=new eui.ArrayCollection(cfg.baoxiaReward);this.list_reward_1.itemRenderer=ItemBaseNoName;this.list_reward_1.dataProvider=new eui.ArrayCollection(cfg.baoxiaReward);var days=MarryMgr.ins().getObjLoginDay();this.label_cost_0.text=cfg.baoxiaPrice.toString();this.label_login_day.text=days.toString();var day=GlobalConfig.MarryBaseConfig.baoxiaDuration;this.label_desc.text=i18n("MarryChestPanel_0")+day+i18n("MarryChestPanel_1")};MarryChestPanel.prototype.secToDay=function(sec){var day=Math.floor(sec/3600/24);var hour=Math.ceil((sec-day*24*3600)/3600);if(hour>=24){day=day+1;hour=0}if(day>=1){return day+i18n("MarryChestPanel_2")}else{return hour+i18n("MarryChestPanel_3")}};MarryChestPanel.prototype.updateChest=function(){var info=MarryMgr.ins().marryInfo;if(!info){return}var objName=info.obj_name;var objID=info.obj_id;this.label_desc_0.textFlow=TextFlowMaker.generateTextFlow1(i18n("MarryChestPanel_4",objName));this.label_desc_1.textFlow=TextFlowMaker.generateTextFlow1(i18n("MarryChestPanel_5",objName));this.redPoint4.visible=false;this.redPoint5.visible=false;var chest_box=info.chest_box||{};var arr=Object.keys(chest_box);var len=arr.length;if(len){this.label_cost_1.visible=false;if(chest_box[Actor.actorID]&&chest_box[Actor.actorID].left_time>0){this.label_left_day_0.visible=true;this.group_cost_0.visible=false;var t=chest_box[Actor.actorID].left_time;this.label_left_day_0.text=i18n("MarryChestPanel_6")+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,2);this.btn_buy.visible=false;this.btn_reward_0.visible=true;if(chest_box[Actor.actorID].flag==0){this.btn_reward_0.label=i18n("MarryChestPanel_7");this.redPoint4.visible=true}else{this.btn_reward_0.visible=false}}else{this.label_left_day_0.visible=false;this.group_cost_0.visible=true;this.btn_buy.visible=true;this.btn_reward_0.visible=false}if(chest_box[objID]&&chest_box[objID].left_time>0){this.label_left_day_1.visible=true;this.label_cost_1.visible=false;var t=chest_box[objID].left_time;this.label_left_day_1.text=i18n("MarryChestPanel_9")+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,2);this.btn_send.visible=false;this.btn_reward_1.visible=true;if(chest_box[objID].flag==0){this.btn_reward_1.label=i18n("MarryChestPanel_10");this.redPoint5.visible=true}else{this.btn_reward_1.visible=false}}else{this.label_left_day_1.visible=false;this.label_cost_1.visible=true;this.btn_send.visible=true;this.btn_reward_1.visible=false}}else{this.group_cost_0.visible=true;this.label_cost_1.visible=true;this.btn_buy.visible=true;this.btn_reward_0.visible=false;this.btn_send.visible=true;this.btn_reward_1.visible=false}};MarryChestPanel.prototype.updateLogin=function(){var config=GlobalConfig.MarryLoginChestAward;for(var i=0;i<4;i++){this["bar"+i].labelDisplay.visible=false;var cfg=config[i+1];var nCfg=config[i];var id=cfg.id;var day=cfg.days;var nday=nCfg&&nCfg.days||0;this["turntime"+i].text=day+i18n("MarryChestPanel_12");this["gift"+i].data=cfg.rewards[0];this["gift"+i].isShowName(false);this["bar"+i].maximum=100;this["lingqu"+i].touchEnabled=false;this["redPoint"+i].visible=false;if(MarryMgr.ins().loginRewardTaken(id)){this["bar"+i].value=100;this["lingqu"+i].visible=true;this["isget"+i].touchEnabled=false}else{this["lingqu"+i].visible=false;var objDay=MarryMgr.ins().getObjLoginDay();if(objDay>=day){this["bar"+i].value=100;this["isget"+i].touchEnabled=true;this["redPoint"+i].visible=true}else{this["bar"+i].value=Math.floor((objDay-nday)/(day-nday)*100);this["isget"+i].touchEnabled=false}}}var days=MarryMgr.ins().getObjLoginDay();this.label_login_day.text=days.toString()};MarryChestPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btn_buy,this.onTouch);this.addTouchEvent(this.btn_send,this.onTouch);this.addTouchEvent(this.btn_reward_0,this.onTouch);this.addTouchEvent(this.btn_reward_1,this.onTouch);for(var i=0;i<4;i++){this.addTouchEvent(this["isget"+i],this.onGiftClick)}this.observe(MarryMgr.ins().postBuyChest,this.onBuyChest);this.observe(MarryMgr.ins().postChestAward,this.onChestAward);this.observe(MarryMgr.ins().postLoginAward,this.onLoginAward);this.observe(Friends.ins().postSendResult,this.sendRes);this.observe(Chat.ins().postSystemMessage,this.sysMsg);this.updateChest();this.updateLogin()};MarryChestPanel.prototype.onBuyChest=function(errid){switch(errid){case 0:UserTips.ins().showTips(i18n("MarryChestPanel_13"));this.updateChest();break;case 1:if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("MarryChestPanel_14"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("MarryChestPanel_15"))}break;case 2:UserTips.ins().showTips(i18n("MarryChestPanel_16"));break;case 3:UserTips.ins().showTips(i18n("MarryChestPanel_17"));break}};MarryChestPanel.prototype.onChestAward=function(errid){switch(errid){case 0:this.updateChest();break;case 1:UserTips.ins().showTips(i18n("MarryChestPanel_19"));break;case 2:UserTips.ins().showTips(i18n("MarryChestPanel_20"));break;case 3:UserTips.ins().showTips(i18n("MarryChestPanel_21"));break;case 4:UserTips.ins().showTips(i18n("MarryChestPanel_22"));break;case 5:UserTips.ins().showTips(i18n("MarryChestPanel_31"));break}};MarryChestPanel.prototype.onLoginAward=function(errid){switch(errid){case 0:UserTips.ins().showTips(i18n("MarryChestPanel_23"));this.updateLogin();break;case 1:UserTips.ins().showTips(i18n("MarryChestPanel_24"));break;case 2:UserTips.ins().showTips(i18n("MarryChestPanel_25"));break;case 3:UserTips.ins().showTips(i18n("MarryChestPanel_26"));break;case 4:UserTips.ins().showTips(i18n("MarryChestPanel_27"));break}};MarryChestPanel.prototype.onTouch=function(e){var tar=e.currentTarget;if(tar==this.btn_buy){this.onBtnBuy()}else if(tar==this.btn_send){this.sendReq()}else if(tar==this.btn_reward_0){MarryMgr.ins().sendGetChestAward(Actor.actorID)}else if(tar==this.btn_reward_1){var objID=MarryMgr.ins().getObjID();MarryMgr.ins().sendGetChestAward(objID)}};MarryChestPanel.prototype.sendReq=function(){var info=MarryMgr.ins().marryInfo;if(!info){return}var objID=info.obj_id;this.res=false;Friends.ins().sendChat(objID,i18n("MarryChestPanel_29"),1)};MarryChestPanel.prototype.sendRes=function(errid){if(errid===void 0){errid=0}if(!this.res&&errid==0){UserTips.ins().showCenterTips(i18n("MarryChestPanel_28"));this.res=true}};MarryChestPanel.prototype.sysMsg=function(str){if(str===void 0){str=""}if(!this.res&&str.indexOf(i18n("MarryChestPanel_30"))>-1){this.res=true}};MarryChestPanel.prototype.onBtnBuy=function(){ViewManager.ins().open(MarryChestBuy)};MarryChestPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.btn_buy,this.onTouch);this.removeTouchEvent(this.btn_send,this.onTouch);this.removeTouchEvent(this.btn_reward_0,this.onTouch);this.removeTouchEvent(this.btn_reward_1,this.onTouch);for(var i=0;i<4;i++){this.removeTouchEvent(this["isget"+i],this.onGiftClick)}};MarryChestPanel.prototype.onGiftClick=function(e){for(var i=0;i<4;i++){if(e.currentTarget==this["isget"+i]){MarryMgr.ins().sendLoginAward(i+1);break}}};return MarryChestPanel}(BaseView);__reflect(MarryChestPanel.prototype,"MarryChestPanel");var MarryEquipBtnItemRenderer=function(_super){__extends(MarryEquipBtnItemRenderer,_super);function MarryEquipBtnItemRenderer(){var _this=_super.call(this)||this;var self=_this;_this.skinName="XinWuBtnSkin";return _this}MarryEquipBtnItemRenderer.prototype.dataChanged=function(){var obj=this.data;this.iconDisplay.source=obj["icon"];this.showRedPoint()};MarryEquipBtnItemRenderer.prototype.showRedPoint=function(){this.redPoint.visible=MarryMgr.ins().getEquipRedPoint(this.data.id)>0};return MarryEquipBtnItemRenderer}(BaseItemRender);__reflect(MarryEquipBtnItemRenderer.prototype,"MarryEquipBtnItemRenderer");var MarryEquipBtnItemData=function(){function MarryEquipBtnItemData(){this.id=-1;this.icon="";this.label=""}return MarryEquipBtnItemData}();__reflect(MarryEquipBtnItemData.prototype,"MarryEquipBtnItemData");var MarryEquipPanel=function(_super){__extends(MarryEquipPanel,_super);function MarryEquipPanel(){var _this=_super.call(this)||this;_this.xinwuID=1;_this.equipName={1:i18n("MarryEquipPanel_0"),2:i18n("MarryEquipPanel_1"),3:i18n("MarryEquipPanel_2"),4:i18n("MarryEquipPanel_3")};_this.effName={1:"jh_jzeff",2:"jh_txseff",3:"jh_yzeff",4:"jh_szeff"};_this.lastXinwuID=0;_this.playingAni=false;_this.lastLevel=0;_this.lastErrid=0;_this.skinName="MarryEquipPanelSkin";return _this}MarryEquipPanel.prototype.childrenCreated=function(){var data=[{id:1,icon:"marry_equip1",label:this.equipName[1]},{id:2,icon:"marry_equip2",label:this.equipName[2]},{id:3,icon:"marry_equip3",label:this.equipName[3]},{id:4,icon:"marry_equip4",label:this.equipName[4]}];this.list_menu.itemRenderer=MarryEquipBtnItemRenderer;this._menuListData=new eui.ArrayCollection(data);this.list_menu.dataProvider=this._menuListData;this.progressBar.value=0};MarryEquipPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list_menu.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.list_menu.selectedIndex=0;if(param[0]){this.list_menu.selectedIndex=param[0];this.xinwuID=Number(param[0])+1}this.addTouchEvent(this.btnActivate,this.onTouch);var self=this;this.removeBtnEvent=longTouch(this.btnUpgrade,function(isLoop){if(isLoop&&self.lastErrid!=0&&!MarryMgr.ins().isEquipLive(self.xinwuID)){return}if(!self.playingAni){MarryMgr.ins().sendEquipLevelUp(self.xinwuID)}},100);var st=StageUtils.ins().getStage();st.addEventListener(egret.TouchEvent.TOUCH_END,this.stopTimer,this);this.observe(MarryMgr.ins().postActivateEquip,this.onActivateEquip);this.observe(MarryMgr.ins().postEquipLevelUp,this.onEquipLevelUp);this.observe(MarryMgr.ins().postEquipRedPoint,this.onEquipRedPoint);this.updatePanel()};MarryEquipPanel.prototype.stopTimer=function(){TimerManager.ins().removeAll(this.btnUpgrade)};MarryEquipPanel.prototype.onEquipRedPoint=function(){var idx=this.list_menu.selectedIndex;this._menuListData.refresh();this.list_menu.selectedIndex=idx};MarryEquipPanel.prototype.updatePanel=function(){this.updateXinWu()};MarryEquipPanel.prototype.updateMc=function(xinwuID){if(xinwuID===void 0){xinwuID=1}var xinwuID=this.xinwuID||1;var eff=this.effName[xinwuID];if(!this.effMc){this.effMc=new MovieClip;this.effGroup.addChild(this.effMc)}if(this.lastXinwuID!=xinwuID){this.effMc.playFile(RES_DIR_EFF+eff,-1)}this.lastXinwuID=xinwuID};MarryEquipPanel.prototype.updateTalent=function(xinwuID){if(xinwuID===void 0){xinwuID=1}var xinwuID=this.xinwuID||1};MarryEquipPanel.prototype.setBar=function(value,max){if(value===void 0){value=0}if(max===void 0){max=100}this.progressBar.maximum=max;this.progressBar.value=value};MarryEquipPanel.prototype.updateXinWu=function(){var xinwuID=this.xinwuID||1;var info=MarryMgr.ins().marryInfo;if(!info){console.log("MarryEquipPanel.ts updateXinWu info = nil");return}var myLevel=info.equips&&info.equips[xinwuID]&&info.equips[xinwuID].level||0;var activated=myLevel>0;this.label_equip.text=i18n("MarryEquipPanel_4")+this.equipName[xinwuID];this.label_level.text=myLevel+i18n("MarryEquipPanel_5");this.label_equip1.text=i18n("MarryEquipPanel_6")+this.equipName[xinwuID]+i18n("MarryEquipPanel_7");this.label_level1.text=info.equips&&info.equips[xinwuID]&&info.equips[xinwuID].obj_equip_level||0+i18n("MarryEquipPanel_8");this.updateMc(xinwuID);this.updateTalent(xinwuID);var showLevel=myLevel;if(!activated){showLevel=1}var attrs=GlobalConfig.MarryEquipLevelupConfig[xinwuID][showLevel].attrs;var next_attrs=GlobalConfig.MarryEquipLevelupConfig[xinwuID][showLevel+1].attrs||attrs;var no_attrs=deepCopy(attrs);for(var i=0;i<no_attrs.length;i++){var v=no_attrs[i];v.value=0}var curAttrs=AttributeData.getAttStr(attrs,0,1,"：");var nextAttrs=AttributeData.getAttStr(next_attrs,0,1,"：");var noAttrs=AttributeData.getAttStr(no_attrs,0,1,"：");this.curAtt.text=curAttrs;this.curAtt1.text=curAttrs;this.nextAtt.text=nextAttrs;var power=UserBag.getAttrPower(attrs);this.powerPanel.setPower(power);if(!activated){this.curAtt.text=noAttrs;this.nextAtt.text=curAttrs;this.curAtt.visible=this.cursor.visible=this.nextAtt.visible=true;this.curAtt1.visible=false}else if(myLevel<100){this.curAtt.visible=this.cursor.visible=this.nextAtt.visible=true;this.curAtt1.visible=false}else{this.curAtt.visible=this.cursor.visible=this.nextAtt.visible=false;this.curAtt1.visible=true}this.activateGroup.visible=!activated;this.upgradeGroup.visible=activated;this.playingAni=false;var level=showLevel>100?100:showLevel;var value=info.equips&&info.equips[xinwuID]&&info.equips[xinwuID].exp||0;var maximum=GlobalConfig.MarryEquipLevelupConfig[xinwuID][level].exp;var self=this;if(this.lastLevel<1){this.setBar(value,maximum)}else if(level>this.lastLevel){var exp=GlobalConfig.MarryEquipLevelupConfig[xinwuID][this.lastLevel].exp;this.setBar(exp,exp);TimerManager.ins().doTimer(500,1,function(){self.setBar(value,maximum);self.playingAni=false},this)}else if(level<=this.lastLevel){this.setBar(value,maximum)}this.lastLevel=level;var costItemId=GlobalConfig.MarryBaseConfig.xinwuLevelup.itemID;var costNum=GlobalConfig.MarryEquipLevelupConfig[xinwuID][showLevel].cost;var cfg=GlobalConfig.ItemConfig[costItemId];if(!cfg){console.log(i18n("MarryEquipPanel_9")+costItemId);return}var mat_name=cfg.name;var isHave=UserBag.ins().getBagGoodsCountById(0,costItemId);var color=ColorUtil.GREEN_COLOR_N;this.redPoint0.visible=false;if(isHave<costNum){color=16777215}else if(activated){this.redPoint0.visible=true}this.label_upgrade_cost.textFlow=TextFlowMaker.generateTextFlow1("消耗：|C:"+color+"\n\t\t&T:"+mat_name+" "+isHave+"||C:0xFFFFFF&T:/"+costNum+"|");this.label_max.visible=myLevel>=100;var xinwuPrice=MarryMgr.ins().getXinwuPrice(xinwuID);this.label_act_cost.text=xinwuPrice+"";var myYb=Actor.yb;this.redPoint.visible=false};MarryEquipPanel.prototype.onActivateEquip=function(errid){switch(errid){case 0:this.updatePanel();break;case 1:UserTips.ins().showTips(i18n("MarryEquipPanel_10"));break;case 2:UserTips.ins().showTips(i18n("MarryEquipPanel_11"));break;case 3:if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("MarryEquipPanel_12"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("MarryEquipPanel_13"))}break;case 4:UserTips.ins().showTips(i18n("MarryEquipPanel_14"));break}};MarryEquipPanel.prototype.onEquipLevelUp=function(errid){switch(errid){case 0:this.updatePanel();break;case 1:UserTips.ins().showTips(i18n("MarryEquipPanel_15"));break;case 2:UserTips.ins().showTips(i18n("MarryEquipPanel_16"));break;case 3:UserTips.ins().showTips(i18n("MarryEquipPanel_17"));break;case 4:UserTips.ins().showTips(i18n("MarryEquipPanel_18"));break;case 4:UserTips.ins().showTips(i18n("MarryEquipPanel_19"));break}this.lastErrid=errid};MarryEquipPanel.prototype.onItemTap=function(e){this.list_menu.selectedIndex=e.itemIndex;this.xinwuID=e.itemIndex+1;this.lastLevel=0;this.updatePanel()};MarryEquipPanel.prototype.onTouch=function(e){var _this=this;var tar=e.currentTarget;if(tar==this.btnActivate){var price=MarryMgr.ins().getXinwuPrice(this.xinwuID);var w=WarnWin.show(i18n("MarryEquipPanel_20",price),function(){MarryMgr.ins().sendActivateEquip(_this.xinwuID)},null,null,this)}};MarryEquipPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list_menu.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.removeTouchEvent(this.btnActivate,this.onTouch);this.stopTimer();var st=StageUtils.ins().getStage();st.removeEventListener(egret.TouchEvent.TOUCH_END,this.stopTimer,this);if(this.removeBtnEvent){this.removeBtnEvent()}};return MarryEquipPanel}(BaseView);__reflect(MarryEquipPanel.prototype,"MarryEquipPanel");var MarryDivorceReq=function(_super){__extends(MarryDivorceReq,_super);function MarryDivorceReq(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="MarryDivorceReqSkin";return _this}MarryDivorceReq.prototype.childrenCreated=function(){var info=MarryMgr.ins().marryInfo;if(!info){return}this.label_name.text=info.obj_name||""};MarryDivorceReq.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.btnRefuse,this.onTouch);this.addTouchEvent(this.btnAgree,this.onTouch)};MarryDivorceReq.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTouch);this.removeTouchEvent(this.btnRefuse,this.onTouch);this.removeTouchEvent(this.btnAgree,this.onTouch)};MarryDivorceReq.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.btnRefuse:MarryMgr.ins().sendDivorce(0);ViewManager.ins().close(this);break;case this.btnAgree:MarryMgr.ins().sendDivorce(1);ViewManager.ins().close(this);break}};return MarryDivorceReq}(BaseEuiView);__reflect(MarryDivorceReq.prototype,"MarryDivorceReq");ViewManager.ins().reg(MarryDivorceReq,LayerManager.UI_Popup);var MarryDivorceTip=function(_super){__extends(MarryDivorceTip,_super);function MarryDivorceTip(){var _this=_super.call(this)||this;_this.skinName="MarryDivorceSkin";_this.isTopLevel=true;return _this}MarryDivorceTip.prototype.initUI=function(){_super.prototype.initUI.call(this);var info=MarryMgr.ins().marryInfo;var freeDivorceNeedDays=GlobalConfig.MarryBaseConfig.freeDivorceNeedDays;var divorcePrice=GlobalConfig.MarryBaseConfig.divorcePrice;var obj_offline_days=info&&obj_offline_days||0;this.label_free.visible=obj_offline_days>freeDivorceNeedDays;this.label_7day.visible=obj_offline_days>freeDivorceNeedDays;this.group_cost.visible=obj_offline_days<=freeDivorceNeedDays;this.label_3day.visible=obj_offline_days<=freeDivorceNeedDays;this.label_cost.text=divorcePrice.toString();this.label_7day.text=i18n("MarryDivorceTip_0")+freeDivorceNeedDays+i18n("MarryDivorceTip_1")};MarryDivorceTip.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bg,this.onTap);this.addTouchEvent(this.btnForce,this.onTap);this.addTouchEvent(this.btnDivorce,this.onTap);this.observe(MarryMgr.ins().postDivorceApply,this.reqDivorceResult)};MarryDivorceTip.prototype.reqDivorceResult=function(param){var isMe=param[1];if(isMe){ViewManager.ins().close(MarryDivorceTip)}};MarryDivorceTip.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bg,this.onTap);this.removeTouchEvent(this.btnForce,this.onTap);this.removeTouchEvent(this.btnDivorce,this.onTap)};MarryDivorceTip.prototype.onTap=function(e){switch(e.currentTarget){case this.btnForce:this.sendReq(1);break;case this.btnDivorce:this.sendReq(0);break;case this.bg:ViewManager.ins().close(MarryDivorceTip);break}};MarryDivorceTip.prototype.sendReq=function(type){if(type===void 0){type=0}if(type==0){MarryMgr.ins().sendDivorceApply(type);return}var info=MarryMgr.ins().marryInfo;var obj_name=info.obj_name||"";var w=WarnWin.show(i18n("MarryDivorceTip_2",obj_name),function(){MarryMgr.ins().sendDivorceApply(type)},null,null,this)};return MarryDivorceTip}(BaseEuiView);__reflect(MarryDivorceTip.prototype,"MarryDivorceTip");ViewManager.ins().reg(MarryDivorceTip,LayerManager.UI_Popup);var MarryLevelPanel=function(_super){__extends(MarryLevelPanel,_super);function MarryLevelPanel(){var _this=_super.call(this)||this;_this.roleIdx1=0;_this.roleIdx2=0;_this.bodyRes0="";_this.bodyRes1="";_this.costNum=0;_this.lastLevel=0;_this.playingAni=false;_this.lastErrid=0;_this.isClosed=false;_this.skinName="MarryLevelPanelSkin";return _this}MarryLevelPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.addTouchEvent(this.btn_divorce,this.onTouch);this.addTouchEvent(this.btn_wall,this.onTouch);this.addTouchEvent(this.btn_Title,this.onTouch);this.addTouchEvent(this.btn_Chat,this.onTouch);this.addTouchEvent(this.btn_divorceReq,this.onTouch);this.addTouchEvent(this.btn_level_reward,this.onTouch);this.addTouchEvent(this.btn_change_0,this.onTouch);this.addTouchEvent(this.btn_change_1,this.onTouch);var self=this;this.removeBtnEvent=longTouch(this.btn_level_up,function(isLoop){if(isLoop&&self.lastErrid!=0&&!MarryMgr.ins().canLevelUp()){return}if(!self.playingAni){self.onBtnLevelUp()}},100);var st=StageUtils.ins().getStage();st.addEventListener(egret.TouchEvent.TOUCH_END,this.stopTimer,this);this.observe(MarryMgr.ins().postMarryInfo,this.updatePanel);this.observe(MarryMgr.ins().postMarryLevelUp,this.onLevelUp);this.observe(MarryMgr.ins().postMarryLevelReward,this.updatePanel);this.observe(MarryMgr.ins().postBuyChest,this.updatePanel);this.observe(MarryMgr.ins().postDivorceApply,this.reqDivorceResult);this.observe(MarryMgr.ins().postProrosalList,this.refRedpoint);this.observe(MarryMgr.ins().postLevelRedPoint,this.refRedpoint);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.observe(MarryMgr.ins().postDivorce,this.onDivorce);this.getRole();this.refRedpoint();this.progressBar.value=0;this.updatePanel()};MarryLevelPanel.prototype.stopTimer=function(){TimerManager.ins().removeAll(this.btn_level_up)};MarryLevelPanel.prototype.onDivorce=function(param){var errid=param[0];var flag=param[1];if(errid==0&&flag==0){this.btn_divorceReq.visible=false}};MarryLevelPanel.prototype.updatePanel=function(){this.changeMyRole(0,true);this.openOtherPlayerView(this.otherPlayerData);this.updateTitle();this.updateChest();this.updateLevel();this.updatePower()};MarryLevelPanel.prototype.updateTitle=function(){var info=MarryMgr.ins().getMarryTitle();this.label_Title.text=info[0];this.label_Attr.textFlow=TextFlowMaker.generateTextFlow1(info[1])};MarryLevelPanel.prototype.getRole=function(){var info=MarryMgr.ins().marryInfo;if(!info){console.log("MarryLevelPanel.ts getRole info = nil");return}UserReadPlayer.ins().sendFindPlayer(info.obj_id,info.obj_server_id)};MarryLevelPanel.prototype.updateRole=function(){this.label_husband.text=Actor.myName;var info=MarryMgr.ins().marryInfo;if(!info){console.log("MarryLevelPanel.ts updateRole info = nil");return}this.label_wife.text=info.obj_name;var role=SubRoles.ins().getSubRoleByIndex(this.roleIdx1);var id=role.getEquipByIndex(0).item.configID;var zb=role.zhuangbei;var bodyId=zb[0];this.setRole(0,role,bodyId,role.sex)};MarryLevelPanel.prototype.changeMyRole=function(add,isFirst){if(add===void 0){add=0}if(isFirst===void 0){isFirst=false}if(add==0){this.roleIdx1=MarryMgr.ins().marryInfo.my_showid||0}this.roleIdx1+=add;var len=SubRoles.ins().subRolesLen;if(this.roleIdx1>=len){this.roleIdx1=0}this.changeRole(this.roleIdx1,isFirst);this.updateRole();this.btn_change_0.visible=len>1};MarryLevelPanel.prototype.changeOtherRole=function(add){if(add===void 0){add=0}if(!this.otherPlayerData){return}this.roleIdx2+=add;var len=this.otherPlayerData.roleData.length;if(this.roleIdx2>=len){this.roleIdx2=0}this.openOtherPlayerView(this.otherPlayerData);this.btn_change_1.visible=false};MarryLevelPanel.prototype.changeRole=function(id,isFirst){if(id===void 0){id=0}if(isFirst===void 0){isFirst=false}if(isFirst){return}MarryMgr.ins().sendChangeRole(id)};MarryLevelPanel.prototype.setRole=function(idx,role,bodyId,sex){if(idx===void 0){idx=0}if(sex===void 0){sex=0}var bodyConf=role.getEquipByIndex(2);var bodyConfId=bodyConf.item.configID;var bodyRes;var isHaveBody;if(bodyConfId>0){var fileName=GlobalConfig.EquipConfig[bodyConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}if(fileName.indexOf("903")>0){bodyRes=fileName+"_"+role.sex+"_c"}else{bodyRes=fileName+"_c"}isHaveBody=true}if(!isHaveBody){bodyRes=getDefaultBody(role.job)+"_c"}if(bodyId>0){bodyRes=getZhuangbanById(bodyId).res+"_c"}if(this["bodyRes"+idx]!=bodyRes){if(!this._body){this._body=imageToMc(this["bodyImg"+idx],bodyRes,this["bodyMc"+idx])}else{imageToMc(this["bodyImg"+idx],bodyRes,this["bodyMc"+idx],this._body)}this["bodyRes"+idx]=bodyRes}};MarryLevelPanel.prototype.openOtherPlayerView=function(otherPlayerData){if(this.isClosed||!otherPlayerData){return}this.otherPlayerData=otherPlayerData;this.roleIdx2=MarryMgr.ins().marryInfo.obj_showid||0;var role=otherPlayerData.roleData[this.roleIdx2];var zb=role.zhuangbei;var bodyId=zb[0];this.setRole(1,role,bodyId,role.sex)};MarryLevelPanel.prototype.updateChest=function(){var info=MarryMgr.ins().marryInfo;if(!info){console.log("MarryLevelPanel.ts updateChest info = nil");return}this.label_my_chest.text=info.chest_box[info.obj_id]?i18n("MarryLevelPanel_0"):i18n("MarryLevelPanel_1");this.label_obj_chest.text=info.chest_box[Actor.actorID]?i18n("MarryLevelPanel_2"):i18n("MarryLevelPanel_3")};MarryLevelPanel.prototype.setBar=function(value,max){if(value===void 0){value=0}if(max===void 0){max=100}this.progressBar.maximum=max;this.progressBar.value=value};MarryLevelPanel.prototype.updateLevel=function(){var info=MarryMgr.ins().marryInfo;var self=this;if(!info){console.log("MarryLevelPanel.ts updateLevel info = nil");return}this.label_Day.text=info.marry_days.toString();this.btn_divorceReq.visible=info.divorce_flag;this.label_level.text=info.level.toString()+i18n("MarryLevelPanel_4");this.playingAni=false;var value=info.exp;var maximum=GlobalConfig.MarryLevelupConfig[info.level].exp;if(this.lastLevel<1){this.setBar(value,maximum)}else if(info.level>this.lastLevel){var exp=GlobalConfig.MarryLevelupConfig[this.lastLevel].exp;this.progressBar.value=exp;this.progressBar.maximum=exp;this.setBar(exp,exp);TimerManager.ins().doTimer(500,1,function(){self.setBar(value,maximum);self.playingAni=false},this)}else if(info.level<=this.lastLevel){this.setBar(value,maximum)}this.lastLevel=info.level;var costItemId=GlobalConfig.MarryBaseConfig.marryLevelup.itemID;var costNum=GlobalConfig.MarryLevelupConfig[info.level].cost;var cfg=GlobalConfig.ItemConfig[costItemId];if(!cfg){console.log(i18n("MarryLevelPanel_5")+costItemId);return}var mat_name=cfg.name;var isHave=UserBag.ins().getBagGoodsCountById(0,costItemId);var color=ColorUtil.GREEN_COLOR_N;if(isHave<costNum){color=ColorUtil.RED_COLOR_N}this.costNum=costNum;this.label_cost.textFlow=TextFlowMaker.generateTextFlow1("消耗：|C:0x046E8C\n\t\t&T:"+mat_name+" ||C:"+color+"\n\t\t&T:"+isHave+"||C:0x046E8C&T:/"+costNum+"|");var max=MarryMgr.ins().isMarryLevelMax();this.label_max.visible=max;this.btn_level_up.visible=!max;if(info.award_got_level<info.level&&info.level>1){this.btn_level_reward.visible=true;this.label_state.visible=true;this.label_state.text=i18n("MarryLevelPanel_6");this.label_awardNum.text="x "+(info.level-info.award_got_level).toString()}else{this.btn_level_reward.visible=!max;this.label_state.visible=!max;this.label_state.text=i18n("MarryLevelPanel_7");this.label_awardNum.text=""}};MarryLevelPanel.prototype.updatePower=function(){};MarryLevelPanel.prototype.reqDivorceResult=function(param){var errid=param[0]||0;var isMe=param[1];if(!isMe){return}switch(errid){case 0:UserTips.ins().showTips(i18n("MarryLevelPanel_8"));break;case 1:UserTips.ins().showTips(i18n("MarryLevelPanel_9"));break;case 2:if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("MarryLevelPanel_10"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("MarryLevelPanel_11"))}break;case 3:UserTips.ins().showTips(i18n("MarryLevelPanel_12"));break}};MarryLevelPanel.prototype.onLevelUp=function(errid){switch(errid){case 0:console.log(i18n("MarryLevelPanel_13"));this.updatePanel();break;case 1:UserTips.ins().showTips(i18n("MarryLevelPanel_14"));break;case 2:UserTips.ins().showTips(i18n("MarryLevelPanel_15"));break;case 3:UserTips.ins().showTips(i18n("MarryLevelPanel_16"));break}this.lastErrid=errid};MarryLevelPanel.prototype.onBtnReward=function(){var info=MarryMgr.ins().marryInfo;if(!info){console.log("MarryLevelPanel.ts onBtnReward info = nil");return}if(info.award_got_level<info.level&&info.level>1){MarryMgr.ins().sendGetMarryLevelReward()}else{if(!MarryMgr.ins().isMarryLevelMax()){ViewManager.ins().open(MarryLevelReward)}}};MarryLevelPanel.prototype.onBtnLevelUp=function(){MarryMgr.ins().sendMarryLevelUp()};MarryLevelPanel.prototype.onBtnDivorceReq=function(){ViewManager.ins().open(MarryDivorceReq)};MarryLevelPanel.prototype.onTouch=function(e){var tar=e.currentTarget;if(tar==this.btn_divorce){ViewManager.ins().open(MarryDivorceTip)}else if(tar==this.btn_wall){ViewManager.ins().open(UnMarriedMainWin,1)}else if(tar==this.btn_Title){ViewManager.ins().open(MarryTitleAttr)}else if(tar==this.btn_Chat){}else if(tar==this.btn_divorceReq){this.onBtnDivorceReq()}else if(tar==this.btn_level_reward){this.onBtnReward()}else if(tar==this.btn_change_0){this.changeMyRole(1,false)}else if(tar==this.btn_change_1){}};MarryLevelPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true;this.removeTouchEvent(this.btn_divorce,this.onTouch);this.removeTouchEvent(this.btn_wall,this.onTouch);this.removeTouchEvent(this.btn_Title,this.onTouch);this.removeTouchEvent(this.btn_Chat,this.onTouch);this.removeTouchEvent(this.btn_divorceReq,this.onTouch);this.removeTouchEvent(this.btn_level_reward,this.onTouch);this.removeTouchEvent(this.btn_change_0,this.onTouch);this.removeTouchEvent(this.btn_change_1,this.onTouch);this.stopTimer();var st=StageUtils.ins().getStage();st.removeEventListener(egret.TouchEvent.TOUCH_END,this.stopTimer,this);if(this.removeBtnEvent){this.removeBtnEvent()}};MarryLevelPanel.prototype.refRedpoint=function(){this.redPoint0.visible=MarryMgr.ins().propose_redpoint>0;this.redPoint1.visible=MarryMgr.ins().divorce_redpoint>0;this.redPoint2.visible=MarryMgr.ins().level_award_redpoint>0;this.redPoint3.visible=MarryMgr.ins().level_up_redpoint>0};return MarryLevelPanel}(BaseView);__reflect(MarryLevelPanel.prototype,"MarryLevelPanel");var MarryLevelReward=function(_super){__extends(MarryLevelReward,_super);function MarryLevelReward(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="MarryLevelRewardSkin";return _this}MarryLevelReward.prototype.childrenCreated=function(){var nLevel=MarryMgr.ins().getMarryNextLevel();var cfg=GlobalConfig.MarryLevelupConfig[nLevel];this.list.itemRenderer=ItemBaseNoName;this.list.dataProvider=new eui.ArrayCollection(cfg.rewards);this.label_cond.text=i18n("MarryLevelReward_0")+nLevel+i18n("MarryLevelReward_1")};MarryLevelReward.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTouch)};MarryLevelReward.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTouch)};MarryLevelReward.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break}};return MarryLevelReward}(BaseEuiView);__reflect(MarryLevelReward.prototype,"MarryLevelReward");ViewManager.ins().reg(MarryLevelReward,LayerManager.UI_Popup);var MarryTitleAttr=function(_super){__extends(MarryTitleAttr,_super);function MarryTitleAttr(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="MarryTitleAttrSkin";return _this}MarryTitleAttr.prototype.childrenCreated=function(){this.scrollBar.viewport=this.list;this.list.itemRenderer=MarryTitleAttrItemRender;this._listDt=new eui.ArrayCollection;this.list.dataProvider=this._listDt;var data=[];var cfg=GlobalConfig.MarryTitleAttrsConfig;var len=Object.keys(cfg).length;for(var i=1;i<=len;i++){var id=cfg[i].id;data.push({id:id})}this._listDt.replaceAll(data)};MarryTitleAttr.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTouch)};MarryTitleAttr.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTouch)};MarryTitleAttr.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break}};return MarryTitleAttr}(BaseEuiView);__reflect(MarryTitleAttr.prototype,"MarryTitleAttr");ViewManager.ins().reg(MarryTitleAttr,LayerManager.UI_Popup);var MarryTitleAttrItemRender=function(_super){__extends(MarryTitleAttrItemRender,_super);function MarryTitleAttrItemRender(){var _this=_super.call(this)||this;_this.skinName="MarryTitleAttrItemSkin";return _this}MarryTitleAttrItemRender.prototype.dataChanged=function(){if(!this.data){return}var info=MarryMgr.ins().marryInfo;if(!info){return}var id=this.data.id;var cfg=GlobalConfig.MarryTitleAttrsConfig[id];this.label_title.text=cfg&&cfg.name||"";this.label_desc.textFlow=TextFlowMaker.generateTextFlow1(cfg&&cfg.desc||"");var level=info.level;var obj_level=info.obj_level;var actLevel=cfg.level;if(level>=actLevel&&obj_level>actLevel){this.currentState="act"}else{this.currentState="disable";this.label_desc.textColor=10197659}this.label_cond.text=actLevel+i18n("MarryTitleAttrItemRender_0")};return MarryTitleAttrItemRender}(BaseItemRender);__reflect(MarryTitleAttrItemRender.prototype,"MarryTitleAttrItemRender");var MarryMissionAward=function(_super){__extends(MarryMissionAward,_super);function MarryMissionAward(){var _this=_super.call(this)||this;_this.skinName="MarryMissionAwardSkin";_this.isTopLevel=true;return _this}MarryMissionAward.prototype.initUI=function(){_super.prototype.initUI.call(this);this.list.itemRenderer=ItemBaseNoName;this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect};MarryMissionAward.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var taskType=param[0];var id=param[1];var cfg=GlobalConfig.MarryTask[taskType][id];if(cfg&&cfg.rewards){this._listCollect.source=cfg.rewards}this.addTouchEvent(this.bg,this.onTap)};MarryMissionAward.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bg,this.onTap)};MarryMissionAward.prototype.onTap=function(e){switch(e.currentTarget){case this.bg:ViewManager.ins().close(MarryMissionAward);break}};return MarryMissionAward}(BaseEuiView);__reflect(MarryMissionAward.prototype,"MarryMissionAward");ViewManager.ins().reg(MarryMissionAward,LayerManager.UI_Popup);var MarryMissionItemRender=function(_super){__extends(MarryMissionItemRender,_super);function MarryMissionItemRender(){var _this=_super.call(this)||this;_this.skinName="MarryMissionItemSkin";return _this}MarryMissionItemRender.prototype.onBtnGo=function(){var taskType=this.data.taskType;var id=this.data.id;var cfg=GlobalConfig.MarryTask[taskType][id];var controlTarget=cfg&&cfg.controlTarget;if(!controlTarget){return}ViewManager.ins().open(controlTarget[0],controlTarget[1]||0,controlTarget[2]||null)};MarryMissionItemRender.prototype.onBtnGet=function(){var taskType=this.data.taskType;var id=this.data.id;MarryMgr.ins().sendTaskAward(taskType,id)};MarryMissionItemRender.prototype.onBtnReward=function(){var taskType=this.data.taskType;var id=this.data.id;ViewManager.ins().open(MarryMissionAward,taskType,id)};MarryMissionItemRender.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this);if(!this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){MessageCenter.ins().removeAll(_this)},this)}var self=this;this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){self.onBtnGo();e.stopPropagation();e.stopImmediatePropagation()},this);this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){self.onBtnGet();e.stopPropagation();e.stopImmediatePropagation()},this);this.imgTaskIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){self.onBtnReward();e.stopPropagation();e.stopImmediatePropagation()},this)};MarryMissionItemRender.prototype.clearBar=function(){this.progressBar0.value=0;this.progressBar1.value=0};MarryMissionItemRender.prototype.dataChanged=function(){this.clearBar();if(!this.data){return}var taskType=this.data.taskType;var id=this.data.id;var cfg=GlobalConfig.MarryTask[taskType][id];if(!cfg){console.log(i18n("MarryMissionItemRender_0")+taskType+" id-"+id);return}this.label_mission.text=cfg.desc;this.label_done.visible=false;var info=MarryMgr.ins().getTaskInfo2(taskType,id);if(info){var value=info.value||0;var target=cfg.target;if(value>target){value=target}this.progressBar0.maximum=target;this.progressBar0.value=value;var obj_value=info.obj_value||0;if(obj_value>target){obj_value=target}this.progressBar1.maximum=target;this.progressBar1.value=obj_value;this.btn_go.visible=value<target||obj_value<target;this.btn_get.visible=value>=target&&obj_value>=target;this.redPoint.visible=this.btn_get.visible;console.log(id+"按钮百分比："+this.progressBar0.value+"/"+this.progressBar0.maximum)}};return MarryMissionItemRender}(BaseItemRender);__reflect(MarryMissionItemRender.prototype,"MarryMissionItemRender");var MarryMissionPanel=function(_super){__extends(MarryMissionPanel,_super);function MarryMissionPanel(){var _this=_super.call(this)||this;_this.taskType=0;_this.skinName="MarryMissionPanelSkin";return _this}MarryMissionPanel.prototype.childrenCreated=function(){this.list.itemRenderer=MarryMissionItemRender;this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect;this.list0.itemRenderer=MarryMissionItemRender;this._listCollect0=new ArrayCollection;this.list0.dataProvider=this._listCollect0};MarryMissionPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addChangeEvent(this.tab,this.onTouch);this.observe(MarryMgr.ins().postTaskList,this.updatePanel);this.observe(MarryMgr.ins().postTaskAward,this.onTaskAward);this.observe(MarryMgr.ins().postTaskRedPoint,this.refRedPoint);this.getTaskList()};MarryMissionPanel.prototype.refRedPoint=function(){this.redPoint0.visible=MarryMgr.ins().task0_redpoint>0;this.redPoint1.visible=MarryMgr.ins().task1_redpoint>0};MarryMissionPanel.prototype.getTaskList=function(){MarryMgr.ins().sendGetTaskList()};MarryMissionPanel.prototype.onTaskAward=function(errid){switch(errid){case 0:console.log(i18n("MarryMissionPanel_0"));this.getTaskList();break;case 1:UserTips.ins().showTips(i18n("MarryMissionPanel_1"));break;case 2:UserTips.ins().showTips(i18n("MarryMissionPanel_2"));break;case 3:UserTips.ins().showTips(i18n("MarryMissionPanel_3"));break;case 4:UserTips.ins().showTips(i18n("MarryMissionPanel_4"));break}};MarryMissionPanel.prototype.updatePanel=function(){this.updateData(0);this.updateData(1);this.onSelectPage()};MarryMissionPanel.prototype.updateData=function(taskType){var info=MarryMgr.ins().getTaskInfo1(taskType);var data=[];for(var _i=0,info_5=info;_i<info_5.length;_i++){var v=info_5[_i];if(v){var sort=0;var cfg=GlobalConfig.MarryTask[taskType][v.task_id];if(v.value>=cfg.target&&v.obj_value>=cfg.target){sort=1}data.push({taskType:taskType,id:v.task_id,sort:sort})}}data.sort(this.sortFunc);switch(taskType){case 0:this._listCollect.source=data;break;case 1:this._listCollect0.source=data;break}};MarryMissionPanel.prototype.sortFunc=function(a,b){if(a.sort>b.sort){return-1}if(a.sort<b.sort){return 1}return 0};MarryMissionPanel.prototype.onTouch=function(e){var tar=e.currentTarget;if(tar==this.tab){this.taskType=this.tab.selectedIndex;this.onSelectPage()}};MarryMissionPanel.prototype.onSelectPage=function(){this.list.visible=this.taskType==0;this.list0.visible=this.taskType!=0;this.state.visible=this.taskType==0&&this._listCollect.length<=0||this.taskType==1&&this._listCollect.length<=0;this.state.text=this.taskType==0?i18n("MarryMissionPanel_6"):i18n("MarryMissionPanel_5")};MarryMissionPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};return MarryMissionPanel}(BaseView);__reflect(MarryMissionPanel.prototype,"MarryMissionPanel");var UnMarriedMainWin=function(_super){__extends(UnMarriedMainWin,_super);function UnMarriedMainWin(){var _this=_super.call(this)||this;_this.skinName="UnMarriedWinSkin";_this.isTopLevel=true;return _this}UnMarriedMainWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=param[0]?param[0]:0;if(param[1]){MarryMgr.ins().proposeInfo=param[1]}this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);if(this.oldIndex==1){var isMarried=MarryMgr.ins().isMarried();if(isMarried){this.oldIndex=0}}this.setOpenIndex(this.oldIndex);this.addTouchEvent(this.closeBtn,this.onBtnClose);Friends.ins().sendFriendsList();this.observe(MarryMgr.ins().postProposeRedPoint,this.refRedpoint);this.observe(MarryMgr.ins().postMarryInfo,this.refreshWin);this.refRedpoint();this.checkMarried()};UnMarriedMainWin.prototype.checkMarried=function(){var isMarried=MarryMgr.ins().isMarried();if(!isMarried){if(this.viewStack.length<=3){this.viewStack.addChildAt(this.proposePanel,0);this.redPointGroup.addChildAt(this.redPointPro,0);this.tab.dataProvider=this.viewStack}}else{if(this.viewStack.length>3){this.viewStack.removeChildAt(0);this.redPointGroup.removeChildAt(0);this.tab.dataProvider=this.viewStack}}};UnMarriedMainWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.viewStack.getElementAt(this.oldIndex)){this.viewStack.getElementAt(this.oldIndex)["close"]()}MarryMgr.ins().proposeInfo=null};UnMarriedMainWin.prototype.refreshWin=function(){var isMarried=MarryMgr.ins().isMarried();if(isMarried){ViewManager.ins().close(this);ViewManager.ins().open(MarriedMainWin)}};UnMarriedMainWin.prototype.onTabTouch=function(e){var index=this.tab.selectedIndex;this.setOpenIndex(index)};UnMarriedMainWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};UnMarriedMainWin.prototype.checkIsOpen=function(index){return true};UnMarriedMainWin.prototype.setOpenIndex=function(selectedIndex){var isMarried=MarryMgr.ins().isMarried();if(!isMarried){switch(selectedIndex){case 0:this.title.source="biaoti_propose";this.proposePanel.open();break;case 1:this.title.source="biaoti_wall";this.friendWallPanel.open();break;case 2:this.title.source="biaoti_level_rank";this.levelRankPanel.open();break;case 3:this.title.source="biaoti_equip_rank";this.equipRankPanel.open();break}}else{switch(selectedIndex){case 0:this.title.source="biaoti_wall";this.friendWallPanel.open();break;case 1:this.title.source="biaoti_level_rank";this.levelRankPanel.open();break;case 2:this.title.source="biaoti_equip_rank";this.equipRankPanel.open();break}}if(this.oldIndex!=selectedIndex){this.viewStack.getElementAt(this.oldIndex)["close"]();this.oldIndex=selectedIndex}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}};UnMarriedMainWin.prototype.refRedpoint=function(){this.redPointPro.visible=MarryMgr.ins().propose_redpoint>0};UnMarriedMainWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(MarryMgr.ins().isOpen()){return true}else{UserTips.ins().showTips(i18n("UnMarriedMainWin_4"));return false}};UnMarriedMainWin.prototype.onBtnClose=function(){this.removeTouchEvent(this.closeBtn,this.onBtnClose);ViewManager.ins().close(this)};return UnMarriedMainWin}(BaseEuiView);__reflect(UnMarriedMainWin.prototype,"UnMarriedMainWin");ViewManager.ins().reg(UnMarriedMainWin,LayerManager.UI_Main);var EquipRankItemRender=function(_super){__extends(EquipRankItemRender,_super);function EquipRankItemRender(){var _this=_super.call(this)||this;_this.skinName="EquipRankItemSkin";return _this}EquipRankItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};EquipRankItemRender.prototype.dataChanged=function(){if(!this.data){return}var data=this.data;var rank=data.rank;if(rank<1){rank=1}this.label_rank.visible=rank>3;this.label_rank.text=rank.toString();this.image_rank.visible=rank<=3;if(rank<=3){this.image_rank.source="paihang"+rank}if(data.obj1_vip_level>0){this.viplevel0.visible=true;this.vipGroup0.visible=true;this.viplevel0.text="v";this.vipNum0=BitmapNumber.ins().createNumPic(data.obj1_vip_level,"zv0",8);this.vipNum0.scaleX=this.vipNum0.scaleX=1.1;this.vipNum0.x=data.obj1_vip_level>=10?2:8;this.vipNum0.y=0;this.vipGroup0.removeChildren();this.vipGroup0.addChild(this.vipNum0)}else{this.viplevel0.visible=false;this.vipGroup0.visible=false}if(data.obj2_vip_level>0){this.viplevel1.visible=true;this.vipGroup1.visible=true;this.viplevel1.text="v";this.vipNum1=BitmapNumber.ins().createNumPic(data.obj2_vip_level,"zv0",8);this.vipNum1.scaleX=this.vipNum1.scaleX=1.1;this.vipNum1.x=data.obj2_vip_level>=10?2:8;this.vipNum1.y=0;this.vipGroup1.removeChildren();this.vipGroup1.addChild(this.vipNum1)}else{this.viplevel1.visible=false;this.vipGroup1.visible=false}this.label_name_0.text=data.obj1_name;this.label_name_1.text=data.obj2_name;this.label_score.text=data.value+""};return EquipRankItemRender}(BaseItemRender);__reflect(EquipRankItemRender.prototype,"EquipRankItemRender");var EquipRankPanel=function(_super){__extends(EquipRankPanel,_super);function EquipRankPanel(){var _this=_super.call(this)||this;_this.objData=[];_this.rankInfo1=null;_this.isClosed=false;_this.skinName="EquipRankPanelSkin";return _this}EquipRankPanel.prototype.childrenCreated=function(){this.list.itemRenderer=EquipRankItemRender;this.type=RankDataType.TYPE_MARRY_EQUIP};EquipRankPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.observe(MarryMgr.ins().postRankList,this.onUpdate);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);MarryMgr.ins().sendGetRankList(this.type)};EquipRankPanel.prototype.openOtherPlayerView=function(otherPlayerData){if(!this.rankInfo1){return}if(this.isClosed||!otherPlayerData){return}var id=otherPlayerData.id;var roleid=MarryMgr.ins().rankShowInfo[this.type].showid1;if(id==this.rankInfo1.obj2_id){roleid=MarryMgr.ins().rankShowInfo[this.type].showid2;this.objData[1]=otherPlayerData}else{this.objData[0]=otherPlayerData}var role=otherPlayerData.roleData[roleid];var zb=role.zhuangbei;var bodyId=zb[0];var idx=0;if(id==this.rankInfo1.obj1_id){idx=0}else if(id==this.rankInfo1.obj2_id){idx=1}this.setRole(idx,role,bodyId)};EquipRankPanel.prototype.setRole=function(idx,role,bodyId){if(idx===void 0){idx=0}var bodyConf=role.getEquipByIndex(2);var bodyConfId=bodyConf.item.configID;var bodyRes;var isHaveBody;if(bodyConfId>0){var fileName=GlobalConfig.EquipConfig[bodyConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}if(fileName.indexOf("903")>0){bodyRes=fileName+"_"+role.sex+"_c"}else{bodyRes=fileName+"_c"}isHaveBody=true}if(!isHaveBody){bodyRes=getDefaultBody(role.job)+"_c"}if(bodyId>0){bodyRes=getZhuangbanById(bodyId).res+"_c"}if(!this._body){this._body=imageToMc(this["bodyImg"+idx],bodyRes,this["bodyMc"+idx])}else{imageToMc(this["bodyImg"+idx],bodyRes,this["bodyMc"+idx],this._body)}};EquipRankPanel.prototype.refreshList=function(){var info=MarryMgr.ins().rankInfo[this.type];this.state.visible=info.length<=0;this.top1.visible=false;if(info.length<1){return}var info2=[];var rank1=null;for(var _i=0,info_6=info;_i<info_6.length;_i++){var v=info_6[_i];if(v.rank==1){rank1=v}else{info2.push(v)}}this.list.dataProvider=new eui.ArrayCollection(info2);var myLv=MarryMgr.ins().getMyRank(this.type);this.label_myrank.text=myLv>0?myLv+"":i18n("EquipRankPanel_1");this.label_myscore.text=MarryMgr.ins().getMyScore(this.type)+"";this.updateRankTop(rank1)};EquipRankPanel.prototype.updateRankTop=function(rankInfo){if(!rankInfo){this.rankInfo1=null;return}this.top1.visible=true;if(rankInfo.obj1_vip_level>0){this.viplevel0.visible=true;this.vipGroup0.visible=true;this.viplevel0.text="v";this.vipNum0=BitmapNumber.ins().createNumPic(rankInfo.obj1_vip_level,"zv0",8);this.vipNum0.scaleX=this.vipNum0.scaleX=1.1;this.vipNum0.x=rankInfo.obj1_vip_level>=10?2:8;this.vipNum0.y=0;this.vipGroup0.removeChildren();this.vipGroup0.addChild(this.vipNum0)}else{this.viplevel0.visible=false;this.vipGroup0.visible=false}if(rankInfo.obj2_vip_level>0){this.viplevel1.visible=true;this.vipGroup1.visible=true;this.viplevel1.text="v";this.vipNum1=BitmapNumber.ins().createNumPic(rankInfo.obj2_vip_level,"zv0",8);this.vipNum1.scaleX=this.vipNum1.scaleX=1.1;this.vipNum1.x=rankInfo.obj2_vip_level>=10?2:8;this.vipNum1.y=0;this.vipGroup1.removeChildren();this.vipGroup1.addChild(this.vipNum1)}else{this.viplevel1.visible=false;this.vipGroup1.visible=false}this.label_score.text=(rankInfo.value||0)+"";this.label_name_0.text=rankInfo.obj1_name||"";this.label_name_1.text=rankInfo.obj2_name||"";this.rankInfo1=rankInfo;UserReadPlayer.ins().sendFindPlayer(rankInfo.obj1_id,rankInfo.obj1_server_id);UserReadPlayer.ins().sendFindPlayer(rankInfo.obj2_id,rankInfo.obj2_server_id)};EquipRankPanel.prototype.onUpdate=function(params){var errid=params[0];var rankType=params[1];if(errid==0&&rankType==this.type){this.refreshList()}};EquipRankPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true};return EquipRankPanel}(BaseView);__reflect(EquipRankPanel.prototype,"EquipRankPanel");var LevelRankItemRender=function(_super){__extends(LevelRankItemRender,_super);function LevelRankItemRender(){var _this=_super.call(this)||this;_this.skinName="LevelRankItemSkin";return _this}LevelRankItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};LevelRankItemRender.prototype.dataChanged=function(){if(!this.data){return}var data=this.data;var rank=data.rank;if(rank<1){rank=1}this.label_rank.visible=rank>3;this.label_rank.text=rank.toString();this.image_rank.visible=rank<=3;if(rank<=3){this.image_rank.source="paihang"+rank}if(data.obj1_vip_level>0){this.viplevel0.visible=true;this.vipGroup0.visible=true;this.viplevel0.text="v";this.vipNum0=BitmapNumber.ins().createNumPic(data.obj1_vip_level,"zv0",8);this.vipNum0.scaleX=this.vipNum0.scaleX=1.1;this.vipNum0.x=data.obj1_vip_level>=10?2:8;this.vipNum0.y=0;this.vipGroup0.removeChildren();this.vipGroup0.addChild(this.vipNum0)}else{this.viplevel0.visible=false;this.vipGroup0.visible=false}if(data.obj2_vip_level>0){this.viplevel1.visible=true;this.vipGroup1.visible=true;this.viplevel1.text="v";this.vipNum1=BitmapNumber.ins().createNumPic(data.obj2_vip_level,"zv0",8);this.vipNum1.scaleX=this.vipNum1.scaleX=1.1;this.vipNum1.x=data.obj2_vip_level>=10?2:8;this.vipNum1.y=0;this.vipGroup1.removeChildren();this.vipGroup1.addChild(this.vipNum1)}else{this.viplevel1.visible=false;this.vipGroup1.visible=false}this.label_name_0.text=data.obj1_name;this.label_name_1.text=data.obj2_name;this.label_score.text=i18n("LevelRankItemRender_0")+data.value;var reward=MarryMgr.ins().getRankReward(RankDataType.TYPE_MARRY_LEVEL,data.rank);this.list.itemRenderer=ItemBaseNoName;this._listCollect=new ArrayCollection(reward);this.list.dataProvider=this._listCollect};return LevelRankItemRender}(BaseItemRender);__reflect(LevelRankItemRender.prototype,"LevelRankItemRender");var LevelRankPanel=function(_super){__extends(LevelRankPanel,_super);function LevelRankPanel(){var _this=_super.call(this)||this;_this.skinName="LevelRankPanelSkin";return _this}LevelRankPanel.prototype.childrenCreated=function(){this.list.itemRenderer=LevelRankItemRender;this.type=RankDataType.TYPE_MARRY_LEVEL};LevelRankPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(MarryMgr.ins().postRankList,this.onUpdate);MarryMgr.ins().sendGetRankList(this.type)};LevelRankPanel.prototype.refreshList=function(){var info=MarryMgr.ins().getRank(this.type);this.state.visible=info.length<=0;this.list.dataProvider=new eui.ArrayCollection(info);var myLv=MarryMgr.ins().getMyRank(this.type);this.label_myrank.text=myLv>0?myLv+"":i18n("EquipRankPanel_1");this.label_myscore.text=MarryMgr.ins().getMyScore(this.type)+""};LevelRankPanel.prototype.onUpdate=function(params){var errid=params[0];var rankType=params[1];if(errid==0&&rankType==this.type){this.refreshList()}};LevelRankPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};return LevelRankPanel}(BaseView);__reflect(LevelRankPanel.prototype,"LevelRankPanel");var ProposeConfirmTip=function(_super){__extends(ProposeConfirmTip,_super);function ProposeConfirmTip(){var _this=_super.call(this)||this;_this.skinName="ProposeConfirmTipSkin";_this.isTopLevel=true;return _this}ProposeConfirmTip.prototype.initUI=function(){_super.prototype.initUI.call(this);this.list.itemRenderer=ItemBaseNoName;this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect;var obj=MarryMgr.ins().proposeInfo;if(!obj){console.log(i18n("ProposeConfirmTip_0"));return}var giftID=MarryMgr.ins().giftID||1;var cfg=GlobalConfig.MarryProposalConfig[giftID];this.tipsPlayer.text=obj.name||"";this.tipsGift.text=cfg&&cfg.name;this.tipsCost.text=cfg&&cfg.price+i18n("ProposeConfirmTip_1");var reward=[];for(var i=0;i<cfg.bothRewards.length;i++){reward.push(cfg.bothRewards[i])}for(var i=0;i<cfg.proposeRewards.length;i++){reward.push(cfg.proposeRewards[i])}this._listCollect.source=reward};ProposeConfirmTip.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bg,this.onTap);this.addTouchEvent(this.sure,this.onTap);this.addTouchEvent(this.giveUp,this.onTap);this.observe(MarryMgr.ins().postProposalReqResult,this.reqProposeResult)};ProposeConfirmTip.prototype.reqProposeResult=function(){ViewManager.ins().close(ProposeConfirmTip)};ProposeConfirmTip.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bg,this.onTap);this.removeTouchEvent(this.sure,this.onTap);this.removeTouchEvent(this.giveUp,this.onTap)};ProposeConfirmTip.prototype.onTap=function(e){switch(e.currentTarget){case this.sure:MarryMgr.ins().sendProposalRequest();break;case this.giveUp:case this.bg:ViewManager.ins().close(ProposeConfirmTip);break}};return ProposeConfirmTip}(BaseEuiView);__reflect(ProposeConfirmTip.prototype,"ProposeConfirmTip");ViewManager.ins().reg(ProposeConfirmTip,LayerManager.UI_Popup);var ProposedItemRender=function(_super){__extends(ProposedItemRender,_super);function ProposedItemRender(){var _this=_super.call(this)||this;_this.skinName="ProposedItemSkin";return _this}ProposedItemRender.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this);var self=this;if(!this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){MessageCenter.ins().removeAll(_this)},this)}this.btn_agree.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){MarryMgr.ins().sendProposalRespond(self.data.id,1);e.stopPropagation();e.stopImmediatePropagation()},this);this.btn_reject.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){MarryMgr.ins().sendProposalRespond(self.data.id,0);e.stopPropagation();e.stopImmediatePropagation()},this);this.btn_detail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){UserReadPlayer.ins().sendFindPlayer(self.data.id,self.data.serverid);e.stopPropagation();e.stopImmediatePropagation()},this)};ProposedItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.label_name.text=data.nickname;this.label_gift.text=GlobalConfig.MarryProposalConfig[data.giftid].name;this.img_userIcon.source=iconByJob(data.job);this.headBg.source=ChatListItemRenderer.HEAD_BG[sexByJob(data.job)]};return ProposedItemRender}(BaseItemRender);__reflect(ProposedItemRender.prototype,"ProposedItemRender");var ProposalItemData=function(){function ProposalItemData(){this.id=0;this.serverid=0;this.nickname=i18n("ProposedItemRender_0");this.job=1;this.vip=0;this.online=true;this.giftid=1}return ProposalItemData}();__reflect(ProposalItemData.prototype,"ProposalItemData");var ProposedListWin=function(_super){__extends(ProposedListWin,_super);function ProposedListWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="ProposedListWinSkin";return _this}ProposedListWin.prototype.childrenCreated=function(){this.scrollBar.viewport=this.list;this.list.itemRenderer=ProposedItemRender;this._listDt=new eui.ArrayCollection;this.list.dataProvider=this._listDt;this.refreshList()};ProposedListWin.prototype.refreshList=function(){var source=MarryMgr.ins().proposalListDt;this._listDt.replaceAll(source);this.noFriend.visible=source.length<1?true:false};ProposedListWin.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.observe(MarryMgr.ins().postMarryInfo,this.onMarryInfoChange);this.observe(MarryMgr.ins().postProrosalList,this.refreshList);this.observe(MarryMgr.ins().postProposalResult,this.reqList);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.reqList();this.list.selectedIndex=0};ProposedListWin.prototype.onMarryInfoChange=function(){var isMarried=MarryMgr.ins().isMarried;if(isMarried){this.onClose()}};ProposedListWin.prototype.reqList=function(){MarryMgr.ins().sendGetProrosalList()};ProposedListWin.prototype.openOtherPlayerView=function(){this.bgClose.visible=false;this.centerGroup.visible=false;this.backBtnGroup.visible=true};ProposedListWin.prototype.closeOtherPlayerView=function(){this.bgClose.visible=true;this.centerGroup.visible=true;this.backBtnGroup.visible=false;ViewManager.ins().close(RRoleWin)};ProposedListWin.prototype.onClose=function(){ViewManager.ins().close(this)};ProposedListWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTouch);this.removeTouchEvent(this.closeBtn,this.onTouch)};ProposedListWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.closeBtn:this.closeOtherPlayerView();break}};return ProposedListWin}(BaseEuiView);__reflect(ProposedListWin.prototype,"ProposedListWin");ViewManager.ins().reg(ProposedListWin,LayerManager.UI_Popup);var ProposeGiftItem=function(_super){__extends(ProposeGiftItem,_super);function ProposeGiftItem(){var _this=_super.call(this)||this;_this.skinName="ProposeGiftItemSkin";return _this}ProposeGiftItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName;this._listCollect=new ArrayCollection;this.list.dataProvider=this._listCollect;this.list0.itemRenderer=ItemBaseNoName;this._listCollect0=new ArrayCollection;this.list0.dataProvider=this._listCollect0};ProposeGiftItem.prototype.dataChanged=function(){var id=this.data.id;var price=this.data.price;this.bg.source="marry_gift"+id;this.bg0.source="marry_giftbg"+id;this.giftPrice.text=this.data.price+i18n("ProposeGiftItem_0");this.giftPrice.textFlow=TextFlowMaker.generateTextFlow1(i18n("ProposeGiftItem_1",price));this._listCollect.source=this.data.bothRewards;this._listCollect0.source=this.data.proposeRewards};Object.defineProperty(ProposeGiftItem.prototype,"selected",{set:function(value){this.selectImage.visible=value},enumerable:true,configurable:true});return ProposeGiftItem}(eui.ItemRenderer);__reflect(ProposeGiftItem.prototype,"ProposeGiftItem");var ProposeListItemRender=function(_super){__extends(ProposeListItemRender,_super);function ProposeListItemRender(){var _this=_super.call(this)||this;_this.skinName="ProposeFriendItemSkin";return _this}ProposeListItemRender.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this);if(!this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){MessageCenter.ins().removeAll(_this)},this)}this.btn_chose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){MarryMgr.ins().postSelectObj(_this.data);e.stopPropagation();e.stopImmediatePropagation()},this)};ProposeListItemRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.label_name.text=data.name+"\n("+(data.zs>0?data.zs+i18n("ProposeListItemRender_0"):"")+data.lv+i18n("ProposeListItemRender_1");var job=fixJob(data.job);var sex=fixSex(data.sex);this.img_userIcon.source="head_"+job+sex+(data.online==1?"":"b");this.headBg.source=ChatListItemRenderer.HEAD_BG[data.sex]};return ProposeListItemRender}(BaseItemRender);__reflect(ProposeListItemRender.prototype,"ProposeListItemRender");var ProposeListWin=function(_super){__extends(ProposeListWin,_super);function ProposeListWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="ProposeListWinSkin";return _this}ProposeListWin.prototype.childrenCreated=function(){this.scrollBar.viewport=this.list;this.list.itemRenderer=ProposeListItemRender;this._listDt=new eui.ArrayCollection;this.list.dataProvider=this._listDt;var source=Friends.ins().friendsList.source;if(MarryMgr.ins().proposeInfo){var id=MarryMgr.ins().proposeInfo.id;var idx=Friends.ins().getFriendIndex(id);if(idx==-1){source.push(MarryMgr.ins().proposeInfo)}}var unmarrid=[];for(var _i=0,source_1=source;_i<source_1.length;_i++){var v=source_1[_i];if(v.married==0){unmarrid.push(v)}}this._listDt.replaceAll(unmarrid);this.noFriend.visible=source.length<1?true:false};ProposeListWin.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTouch);this.observe(MarryMgr.ins().postSelectObj,this.onClose);this.list.selectedIndex=0};ProposeListWin.prototype.onClose=function(){ViewManager.ins().close(this)};ProposeListWin.prototype.onListTap=function(e){var data=e.item;ViewManager.ins().close(this);MarryMgr.ins().postSelectObj(data)};ProposeListWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTouch)};ProposeListWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break}};return ProposeListWin}(BaseEuiView);__reflect(ProposeListWin.prototype,"ProposeListWin");ViewManager.ins().reg(ProposeListWin,LayerManager.UI_Popup);var ProposePanel=function(_super){__extends(ProposePanel,_super);function ProposePanel(){var _this=_super.call(this)||this;_this.isClosed=false;_this.skinName="ProposePanelSkin";return _this}ProposePanel.prototype.childrenCreated=function(){this.list.itemRenderer=ProposeGiftItem;this._listDt=new eui.ArrayCollection;this.list.dataProvider=this._listDt};ProposePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.observe(MarryMgr.ins().postProposalReqResult,this.reqProposeResult);this.observe(MarryMgr.ins().postProposalResult,this.onProposalResult);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.observe(MarryMgr.ins().postSelectObj,this.updateObj);this.observe(MarryMgr.ins().postProposeRedPoint,this.refRedpoint);this.addTouchEvent(this.btnChoose,this.onTouch);this.addTouchEvent(this.btnHelp,this.onTouch);this.addTouchEvent(this.btnPropose,this.onTouch);this.addTouchEvent(this.btnList,this.onTouch);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this);this.updateObj();var data=[];var cfg=GlobalConfig.MarryProposalConfig;var len=Object.keys(cfg).length;for(var i=1;i<=len;i++){data.push(cfg[i])}this._listDt.replaceAll(data);this.list.selectedIndex=(MarryMgr.ins().giftID||1)-1;this.refRedpoint()};ProposePanel.prototype.refRedpoint=function(){this.redPoint0.visible=MarryMgr.ins().propose_redpoint>0};ProposePanel.prototype.onListTap=function(e){var data=e.item;if(data&&data.id){MarryMgr.ins().giftID=data.id}};ProposePanel.prototype.updateObj=function(){if(MarryMgr.ins().isMarried()){var info=MarryMgr.ins().marryInfo;var source=Friends.ins().friendsList.source;for(var _i=0,source_2=source;_i<source_2.length;_i++){var v=source_2[_i];if(v.id==info.obj_id){MarryMgr.ins().proposeInfo=v;break}}}this.setProposer(MarryMgr.ins().proposeInfo)};ProposePanel.prototype.setProposer=function(data){if(data&&data.id){this.noObj.visible=false;this.objHead.source="yuanhead"+data.job+data.sex;this.objName.text=data.name}else{this.noObj.visible=true;this.objHead.source="";this.objName.text=""}};ProposePanel.prototype.openOtherPlayerView=function(otherPlayerData){if(this.isClosed){return}ViewManager.ins().open(RRoleWin,otherPlayerData)};ProposePanel.prototype.onTouch=function(e){var tar=e.currentTarget;if(tar==this.btnChoose){if(MarryMgr.ins().isMarried()){return}ViewManager.ins().open(ProposeListWin)}else if(tar==this.btnHelp){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[45].text)}else if(tar==this.btnPropose){if(MarryMgr.ins().isMarried()){UserTips.ins().showTips(i18n("ProposePanel_0"))}else if(MarryMgr.ins().proposeInfo){ViewManager.ins().open(ProposeConfirmTip)}else{UserTips.ins().showTips(i18n("ProposePanel_1"))}}else if(tar==this.btnList){ViewManager.ins().open(ProposedListWin)}};ProposePanel.prototype.reqProposeResult=function(errid){switch(errid){case 0:UserTips.ins().showTips(i18n("ProposePanel_2"));break;case 2:UserTips.ins().showTips(i18n("ProposePanel_3"));break;case 3:UserTips.ins().showTips(i18n("ProposePanel_5"));break;case 4:UserTips.ins().showTips(i18n("ProposePanel_6"));break;case 5:UserTips.ins().showTips(i18n("ProposePanel_7"));break;case 6:UserTips.ins().showTips(i18n("ProposePanel_8"));break;case 7:UserTips.ins().showTips(i18n("ProposePanel_9"));break;case 8:UserTips.ins().showTips(i18n("ProposePanel_16"));break}};ProposePanel.prototype.onProposalResult=function(errid){switch(errid){case 0:console.log(i18n("ProposePanel_10"));break;case 1:UserTips.ins().showTips(i18n("ProposePanel_11"));break;case 2:UserTips.ins().showTips(i18n("ProposePanel_12"));break;case 3:UserTips.ins().showTips(i18n("ProposePanel_13"));break;case 4:UserTips.ins().showTips(i18n("ProposePanel_14"));break;case 5:UserTips.ins().showTips(i18n("ProposePanel_15"));break}};ProposePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true;this.removeTouchEvent(this.btnChoose,this.onTouch);this.removeTouchEvent(this.btnHelp,this.onTouch);this.removeTouchEvent(this.btnPropose,this.onTouch);this.removeTouchEvent(this.btnList,this.onTouch);this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this)};return ProposePanel}(BaseView);__reflect(ProposePanel.prototype,"ProposePanel");var FriendAdvertiseItemRender=function(_super){__extends(FriendAdvertiseItemRender,_super);function FriendAdvertiseItemRender(){return _super.call(this)||this}FriendAdvertiseItemRender.prototype.dataChanged=function(){if(!this.data){return}var id=this.data.id;var cfg=GlobalConfig.MarryMessageConfig[id];this.messageLabel.text=cfg&&cfg.text||i18n("FriendAdvertiseItemRender_0")};return FriendAdvertiseItemRender}(BaseItemRender);__reflect(FriendAdvertiseItemRender.prototype,"FriendAdvertiseItemRender");var FriendAdvertiseWin=function(_super){__extends(FriendAdvertiseWin,_super);function FriendAdvertiseWin(){var _this=_super.call(this)||this;_this.mid=1;_this.needTop=false;_this.isTopLevel=true;_this.skinName="FriendAdvertiseSkin";return _this}FriendAdvertiseWin.prototype.childrenCreated=function(){this.scrollBar.viewport=this.list;this.list.itemRenderer=FriendAdvertiseItemRender;this._listDt=new eui.ArrayCollection;this.list.dataProvider=this._listDt;var data=[];var cfg=GlobalConfig.MarryMessageConfig;var len=Object.keys(cfg).length;for(var i=1;i<=len;i++){var id=cfg[i].id;data.push({id:id})}this._listDt.replaceAll(data);var rIdx=Math.floor(Math.random()*data.length+1)-1;rIdx=rIdx>=data.length?data.length-1:data.length<0?0:rIdx;this.list.selectedIndex=rIdx;this.mid=rIdx+1;this.costLabel.text=GlobalConfig.MarryBaseConfig.setTopPrice+i18n("FriendAdvertiseWin_0");this.timeLabel.text=i18n("FriendAdvertiseWin_1")+Math.floor(GlobalConfig.MarryBaseConfig.setTopTime/3600)+i18n("FriendAdvertiseWin_2")};FriendAdvertiseWin.prototype.open=function(){this.cbTop.selected=this.needTop;this.addTouchEvent(this.cbTop,this.onTouch);this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.postBtn,this.onTouch);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this);this.messageLabel.text=GlobalConfig.MarryMessageConfig["1"].text||""};FriendAdvertiseWin.prototype.onListTap=function(e){var data=e.item;this.messageLabel.text=GlobalConfig.MarryMessageConfig[data.id].text||"";this.mid=data.id};FriendAdvertiseWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};FriendAdvertiseWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.postBtn:MarryMgr.ins().sendUpWall(this.mid,this.needTop);break;case this.cbTop:var tar=e.currentTarget;this.needTop=tar.selected;break}};return FriendAdvertiseWin}(BaseEuiView);__reflect(FriendAdvertiseWin.prototype,"FriendAdvertiseWin");ViewManager.ins().reg(FriendAdvertiseWin,LayerManager.UI_Popup);var FriendWallItemRender=function(_super){__extends(FriendWallItemRender,_super);function FriendWallItemRender(){var _this=_super.call(this)||this;_this.skinName="FriendWallItemSkin";return _this}FriendWallItemRender.prototype.childrenCreated=function(){this.btnDetail.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);this.btnFriend.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};FriendWallItemRender.prototype.dataChanged=function(){if(!this.data){return}var id=this.data.id;var job=this.data.job;this.head.source=iconByJob(job);this.nickname.text=this.data.nickname;this.vip.text=this.data.vip>0?i18n("FriendWallItemRender_4")+this.data.vip:"";this.online.text=this.data.online==true?i18n("FriendWallItemRender_0"):i18n("FriendWallItemRender_1");var mid=this.data.messageid;this.info.text=GlobalConfig.MarryMessageConfig[mid]&&GlobalConfig.MarryMessageConfig[mid].text||i18n("FriendWallItemRender_2");this.btnDetail.visible=id!=Actor.actorID;this.btnFriend.visible=id!=Actor.actorID};FriendWallItemRender.prototype.onClick=function(e){switch(e.currentTarget){case this.btnDetail:UserReadPlayer.ins().sendFindPlayer(this.data.id,this.data.serverid);break;case this.btnFriend:Friends.ins().sendAddFriend(this.data.id,this.data.nickname);break}};return FriendWallItemRender}(BaseItemRender);__reflect(FriendWallItemRender.prototype,"FriendWallItemRender");var FriendWallItemData=function(){function FriendWallItemData(){this.id=0;this.serverid=0;this.nickname=i18n("FriendWallItemRender_3");this.job=1;this.vip=0;this.online=true;this.messageid=1}return FriendWallItemData}();__reflect(FriendWallItemData.prototype,"FriendWallItemData");var FriendWallPanel=function(_super){__extends(FriendWallPanel,_super);function FriendWallPanel(){var _this=_super.call(this)||this;_this.isClosed=false;_this.skinName="FriendWallSkin";return _this}FriendWallPanel.prototype.childrenCreated=function(){this.list.itemRenderer=FriendWallItemRender;this._listDt=new eui.ArrayCollection;this.list.dataProvider=this._listDt};FriendWallPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.observe(MarryMgr.ins().postWallInfo,this.refreshList);this.observe(MarryMgr.ins().postUpWallResult,this.upWallResult);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.cbOnline.selected=SysSetting.ins().getBool(SysSetting.ONLINE_FRIEND);this.cbSex.selected=SysSetting.ins().getBool(SysSetting.OPPOSITE_SEX_FRIEND);this.addTouchEvent(this.cbOnline,this.onTouch);this.addTouchEvent(this.cbSex,this.onTouch);this.addTouchEvent(this.postBtn,this.onTouch);MarryMgr.ins().sendGetWallInfo()};FriendWallPanel.prototype.openOtherPlayerView=function(otherPlayerData){if(this.isClosed){return}ViewManager.ins().open(RRoleWin,otherPlayerData)};FriendWallPanel.prototype.onTouch=function(e){var tar=e.currentTarget;if(tar==this.cbOnline){SysSetting.ins().setBool(SysSetting.ONLINE_FRIEND,tar.selected)}else if(tar==this.cbSex){SysSetting.ins().setBool(SysSetting.OPPOSITE_SEX_FRIEND,tar.selected)}else if(tar==this.postBtn){if(MarryMgr.ins().isMarried()){UserTips.ins().showTips(i18n("FriendWallPanel_0"));return}ViewManager.ins().open(FriendAdvertiseWin)}this.refreshList()};FriendWallPanel.prototype.isSameSex=function(job1,job2){if(job1==job2){return true}if(job1==2&&job2==3){return true}if(job1==3&&job2==2){return true}return false};FriendWallPanel.prototype.refreshList=function(){var list=MarryMgr.ins().wallListDt;var list1=[];var list2=[];var onlineOnly=SysSetting.ins().getBool(SysSetting.ONLINE_FRIEND);var oppositeSexOnly=SysSetting.ins().getBool(SysSetting.OPPOSITE_SEX_FRIEND);if(onlineOnly){for(var i=0;i<list.length;i++){var online=list[i].online;if(online){list1.push(list[i])}}}else{for(var i=0;i<list.length;i++){list1.push(list[i])}}if(oppositeSexOnly){for(var i=0;i<list1.length;i++){var job=list1[i].job;var mjob=SubRoles.ins().getFirstJob();if(!this.isSameSex(mjob,job)){list2.push(list1[i])}}}else{for(var i=0;i<list1.length;i++){list2.push(list1[i])}}this._listDt.replaceAll(list2);this._listDt.refresh()};FriendWallPanel.prototype.upWallResult=function(errid){switch(errid){case 0:UserTips.ins().showTips(i18n("FriendWallPanel_1"));ViewManager.ins().close(FriendAdvertiseWin);MarryMgr.ins().sendGetWallInfo();break;case 1:if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("FriendWallPanel_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("FriendWallPanel_3"))}break;case 2:UserTips.ins().showTips(i18n("FriendWallPanel_4"));ViewManager.ins().close(FriendAdvertiseWin);break;case 3:UserTips.ins().showTips(i18n("FriendWallPanel_5"));break}};FriendWallPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true};return FriendWallPanel}(BaseView);__reflect(FriendWallPanel.prototype,"FriendWallPanel");var MergeCC=function(_super){__extends(MergeCC,_super);function MergeCC(){return _super.call(this)||this}MergeCC.ins=function(){return _super.ins.call(this)};MergeCC.prototype.isOpen=function(){return SamsaraModel.ins().isOpen()||ZhanLingModel.ins().ZhanLingOpen()||Rune.ins().isOpen()};MergeCC.prototype.redPoint=function(){var b=false;if(SamsaraModel.ins().isOpen()){b=SamsaraModel.ins().isCanCompose()}if(!b&&ZhanLingModel.ins().ZhanLingOpen()){b=this.isZlCanMerge()}if(!b&&Rune.ins().isOpen()){b=Rune.ins().isRuneCanMerge()}return b};MergeCC.prototype.getMergeMenu=function(){var config=GlobalConfig.MergeTotal;var lv=Actor.level;var zs=UserZs.ins().lv;var arr=[];for(var i in config){if(config[i].type==MergeType.SamsareEquip){if(SamsaraModel.ins().isOpen())arr.push(config[i])}else if(config[i].type==MergeType.ZhanlingEquip){if(ZhanLingModel.ins().ZhanLingOpen())arr.push(config[i])}else if((config[i].openZs||0)<=zs&&(config[i].openLv||0)<=lv){arr.push(config[i])}}arr.sort(this.sortMenu);return arr};MergeCC.prototype.getMergeSecMenu=function(id){var config=GlobalConfig.MergeConfig[id];var lv=Actor.level;var zs=UserZs.ins().lv;var arr=[];for(var i in config){if((config[i].openZs||0)<=zs&&(config[i].openLv||0)<=lv){arr.push(config[i])}}arr.sort(this.sortMenu);return arr};MergeCC.prototype.sortMenu=function(a,b){if(a.sort<b.sort)return-1;else if(a.sort>b.sort)return 1;return 0};MergeCC.prototype.getListData=function(id,index){var config=GlobalConfig.MergeTotal[id];var merge=GlobalConfig.MergeConfig[id][index];if(config.type==MergeType.SamsareEquip){return SamsaraModel.ins().composeEquipMap[merge.lv][merge.openZs]}else if(config.type==MergeType.ZhanlingEquip){return this.getZlMergeEquipByLv(merge.lv)}else if(config.type==MergeType.Rune){return Rune.ins().getRuneMergeEquipByLv(merge.lv)}return[]};MergeCC.prototype.isCanMergeById=function(id){var _type=GlobalConfig.MergeTotal[id].type;var b=false;switch(_type){case MergeType.SamsareEquip:b=SamsaraModel.ins().isCanTypeCompose(id);break;case MergeType.ZhanlingEquip:b=this.isZlCanMerge();break;case MergeType.Rune:b=Rune.ins().isRuneCanMerge();break}return b};MergeCC.prototype.isCanMergeByIndex=function(id,index){var _type=GlobalConfig.MergeTotal[id].type;var b=false;switch(_type){case MergeType.SamsareEquip:b=SamsaraModel.ins().isCanZsLvCompose(GlobalConfig.MergeConfig[id][index].lv,GlobalConfig.MergeConfig[id][index].openZs);break;case MergeType.ZhanlingEquip:b=this.isZlCanMergeByIndex(id,index);break;case MergeType.Rune:b=Rune.ins().isRuneCanMergeByType(index);break}return b};MergeCC.prototype.getCanMergeTargetId=function(id,index){var _type=GlobalConfig.MergeTotal[id].type;var targetId=0;switch(_type){case MergeType.SamsareEquip:var config=GlobalConfig.MergeConfig[id][index];targetId=SamsaraModel.ins().getComposeEquipId(config.lv,config.openZs);break;case MergeType.ZhanlingEquip:targetId=this.getZlCanMergeTargetId(id,index);break}return targetId};MergeCC.prototype.isCanMergeTargetId=function(type,targetId){if(type==MergeType.SamsareEquip){var config=GlobalConfig.ReincarnateEquipCompose[targetId];return SamsaraModel.ins().isCanEquipCompose(config.material.id)}else if(type==MergeType.ZhanlingEquip){return this.isZlEquipIdCanMerge(targetId)}else if(type==MergeType.Rune){var res=Rune.ins().isRuneCanMergeByIDNew(targetId);return res.type}return false};MergeCC.prototype.getZlMergeEquipByLv=function(lv){if(!this._zlMergeEquip){this._zlMergeEquip={};var configs=GlobalConfig.ZhanLingEquip;for(var id in configs){if(!this._zlMergeEquip[configs[id].level])this._zlMergeEquip[configs[id].level]=[];this._zlMergeEquip[configs[id].level].push({type:MergeType.ZhanlingEquip,id:configs[id].id})}}return this._zlMergeEquip[lv+1]};MergeCC.prototype.getZlCanMergeTargetId=function(id,index){var lv=GlobalConfig.MergeConfig[id][index].lv;var equips=this.getZlMergeEquipByLv(lv);for(var _i=0,equips_1=equips;_i<equips_1.length;_i++){var equip=equips_1[_i];if(this.isZlEquipIdCanMerge(equip.id))return equip.id}return 0};MergeCC.prototype.isZlCanMerge=function(){var config=GlobalConfig.ZhanLingEquip;for(var i in config){if(this.isZlEquipIdCanMerge(i))return true}return false};MergeCC.prototype.isZlCanMergeByIndex=function(id,index){return!!this.getZlCanMergeTargetId(id,index)};MergeCC.prototype.isZlEquipIdCanMerge=function(equipId){var config=GlobalConfig.ZhanLingEquip[equipId];var mat=config.mat;if(mat){var num=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,mat[0].id)+this.getZlHadEquipCount(mat[0].id);if(num>=mat[0].count){return true}}return false};MergeCC.prototype.getZlHadEquipCount=function(equipId){var config=GlobalConfig.ZhanLingEquip[equipId];if(ZhanLingModel.ins().getZhanLingDataByItem(0,config.pos)==equipId){return 1}return 0};return MergeCC}(BaseSystem);__reflect(MergeCC.prototype,"MergeCC");var MergeType;(function(MergeType){MergeType[MergeType["SamsareEquip"]=1]="SamsareEquip";MergeType[MergeType["ZhanlingEquip"]=2]="ZhanlingEquip";MergeType[MergeType["Rune"]=3]="Rune"})(MergeType||(MergeType={}));window["MergeType"]=MergeType;var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.mergeCC=MergeCC.ins.bind(MergeCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ComposeMenuItem=function(_super){__extends(ComposeMenuItem,_super);function ComposeMenuItem(){return _super.call(this)||this}ComposeMenuItem.prototype.childrenCreated=function(){this.list.itemRenderer=ComposeSecMenuItem;this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this)};ComposeMenuItem.prototype.onListChange=function(){var data=this.list.selectedItem;var compose=ViewManager.ins().getView(BagWin).reinComposePanel;compose.updateView(data.id,data.index,MergeCC.ins().getCanMergeTargetId(data.id,data.index));compose.unSelectList();this.list.getVirtualElementAt(this.list.selectedIndex).setSelect(true)};ComposeMenuItem.prototype.selectList=function(index){this.list.selectedIndex=index;var item=this.list.getVirtualElementAt(this.list.selectedIndex);item.selected=true;item.setSelect(true)};ComposeMenuItem.prototype.dataChanged=function(){var data=this.data;this.list.dataProvider=new ArrayCollection(MergeCC.ins().getMergeSecMenu(data.id));this.redPoint.visible=MergeCC.ins().isCanMergeById(data.id);this.rein_equips.source=data.btn_source};return ComposeMenuItem}(BaseItemRender);__reflect(ComposeMenuItem.prototype,"ComposeMenuItem");var ComposePanel=function(_super){__extends(ComposePanel,_super);function ComposePanel(){var _this=_super.call(this)||this;_this._id=-1;_this._index=-1;return _this}ComposePanel.prototype.childrenCreated=function(){this.initUI()};ComposePanel.prototype.initUI=function(){this.list.itemRenderer=ComposeMenuItem;this.list0.itemRenderer=SamsaraComposeItem;this._listData=new eui.ArrayCollection;this.list0.dataProvider=this._listData;this._tabListData=new eui.ArrayCollection;this.list.dataProvider=this._tabListData};ComposePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(UserBag.ins().postItemAdd,this.buffUpdata);this.observe(UserBag.ins().postItemDel,this.buffUpdata);this.observe(UserBag.ins().postItemChange,this.buffUpdata);this.initView();this.updateState();if(param[0]!=undefined&&param[1]!=undefined&&param[2]!=undefined)this.selectList(param[0],param[1],param[2])};ComposePanel.prototype.initView=function(){this._tabListData.source=MergeCC.ins().getMergeMenu()};Object.defineProperty(ComposePanel.prototype,"id",{get:function(){return this._id},enumerable:true,configurable:true});Object.defineProperty(ComposePanel.prototype,"index",{get:function(){return this._index},enumerable:true,configurable:true});ComposePanel.prototype.buffUpdata=function(){TimerManager.ins().remove(this.updateState,this);TimerManager.ins().doTimer(100,1,this.updateState,this)};ComposePanel.prototype.updateState=function(){if(this._tabListData.length==0)return;this._tabListData.refresh();var id=this._id;var index=this._index;var targetId=0;if(this._id==-1||this._index==-1){for(var i=0;i<this._tabListData.length;i++){id=this._tabListData.getItemAt(i).id;var arr=MergeCC.ins().getMergeSecMenu(id);for(var j=0;j<arr.length;j++){targetId=MergeCC.ins().getCanMergeTargetId(arr[j].id,arr[j].index);if(targetId){index=arr[j].index;break}}if(targetId)break}if(!targetId){id=this._tabListData.getItemAt(0).id;var arr=MergeCC.ins().getMergeSecMenu(id);index=arr[0].index}}else{targetId=MergeCC.ins().getCanMergeTargetId(id,index)}this.updateView(id,index,targetId)};ComposePanel.prototype.updateView=function(id,index,targetId){if(targetId===void 0){targetId=0}this._id=id;this._index=index;var data=MergeCC.ins().getListData(id,index);this._listData.source=data;this.refushBarList(targetId)};ComposePanel.prototype.refushBarList=function(targetId){if(!targetId){this.contentScroller.viewport.scrollV=0;return}var data=this.list0.dataProvider;for(var i=0;i<data.length;i++){if(targetId==data.getItemAt(i).id){this.contentScroller.viewport.validateNow();var sh=i*101;if(sh>this.contentScroller.viewport.contentHeight-this.contentScroller.viewport.height){sh=this.contentScroller.viewport.contentHeight-this.contentScroller.height}if(sh<0)sh=0;this.contentScroller.viewport.scrollV=sh;break}}};ComposePanel.prototype.unSelectList=function(){var count=this.list.dataProvider.length;for(var i=0;i<count;i++){var item=this.list.getVirtualElementAt(i);var tempList=item.list;for(var j=0;j<tempList.dataProvider.length;j++){var tempItem=tempList.getVirtualElementAt(j);if(tempItem)tempItem.setSelect(false)}}};ComposePanel.prototype.selectList=function(type,secondIndex,index){var tabIndex=0;var id;for(var i=0;i<this._tabListData.length;i++){var typeTem=this._tabListData.getItemAt(i).type;if(type==typeTem){tabIndex=i;id=this._tabListData.getItemAt(i).id;break}}var item=this.list.getVirtualElementAt(tabIndex);var tempList=item.list;var tempItem=tempList.getVirtualElementAt(secondIndex-1);if(tempItem)tempItem.setSelect(true);this.updateView(id,secondIndex,tempItem.data.id)};ComposePanel.prototype.close=function(){this.removeObserve();this._id=-1;this._index=-1};return ComposePanel}(BaseComponent);__reflect(ComposePanel.prototype,"ComposePanel");var ComposeSecMenuItem=function(_super){__extends(ComposeSecMenuItem,_super);function ComposeSecMenuItem(){return _super!==null&&_super.apply(this,arguments)||this}ComposeSecMenuItem.prototype.dataChanged=function(){var data=this.data;this.lv.text=""+data.btn_name;this.redPoint.visible=MergeCC.ins().isCanMergeByIndex(data.id,data.index);var compose=ViewManager.ins().getView(BagWin).reinComposePanel;if(compose.id==data.id&&compose.index==data.index){this.setSelect(true)}};ComposeSecMenuItem.prototype.setSelect=function(isSelect){this.chosen.visible=isSelect};return ComposeSecMenuItem}(BaseItemRender);__reflect(ComposeSecMenuItem.prototype,"ComposeSecMenuItem");var Millionaire=function(_super){__extends(Millionaire,_super);function Millionaire(){var _this=_super.call(this)||this;_this.AwardRecords=[];_this.sysId=PackageID.Millionaire;_this.regNetMsg(1,_this.postMillionaireInfo);_this.regNetMsg(2,_this.postTurnDice);_this.regNetMsg(3,_this.postRoundReward);_this.regNetMsg(4,_this.postOverAllReward);_this.regNetMsg(5,_this.postMillionaireUpdate);_this.regNetMsg(6,_this.postMillionaireRecord);_this.dice=0;_this.gridId=0;_this.round=0;_this.roundReward=0;_this.randomGridById=0;_this.randomGridByRewardId=0;_this.rewardIdByGrids=[];_this.isStrideStart=0;_this.dicePoint=0;_this.autoTurnDice=0;_this.isAutoGo=false;return _this}Millionaire.ins=function(){return _super.ins.call(this)};Millionaire.prototype.postMillionaireInfo=function(bytes){this.dice=bytes.readShort();this.gridId=bytes.readShort();this.round=bytes.readShort();this.roundReward=bytes.readInt();this.randomGridById=bytes.readShort();this.randomGridByRewardId=bytes.readUnsignedByte();var gridSum=bytes.readShort();for(var i=1;i<=gridSum;i++){var reward=bytes.readShort();this.rewardIdByGrids[i]=reward}var cfg=GlobalConfig.RichManGridConfig[this.gridId];if(cfg&&cfg.action==2){}};Millionaire.prototype.postTurnDice=function(bytes){this.isStrideStart=bytes.readUnsignedByte();this.gridId=bytes.readShort();this.dicePoint=bytes.readUnsignedByte()};Millionaire.prototype.postRoundReward=function(bytes){var roundRewardConfigId=bytes.readUnsignedByte();this.roundReward=bytes.readInt()};Millionaire.prototype.postOverAllReward=function(bytes){this.randomGridById=bytes.readShort();this.randomGridByRewardId=bytes.readUnsignedByte()};Millionaire.prototype.postMillionaireUpdate=function(bytes){this.dice=bytes.readShort();this.round=bytes.readShort();this.roundReward=bytes.readInt()};Millionaire.prototype.postMillionaireRecord=function(bytes){this.AwardRecords=[];var num=bytes.readUnsignedByte();for(var i=0;i<num;i++)this.AwardRecords[i]=[bytes.readString(),bytes.readInt(),bytes.readInt()];this.AwardRecords.reverse()};Millionaire.prototype.sendMillionaireInfo=function(){this.sendBaseProto(1)};Millionaire.prototype.sendTurnDice=function(){this.sendBaseProto(2)};Millionaire.prototype.sendRoundReward=function(roundId){var bytes=this.getBytes(3);bytes.writeInt(roundId);this.sendToServer(bytes)};Millionaire.prototype.sendMillionaireRecord=function(){this.sendBaseProto(4)};Millionaire.prototype.showRedPoint=function(){if(!MillionaireWin.isOpen())return false;if(this.dice>0)return true;for(var k in GlobalConfig.RichManRoundAwardConfig){if(!(this.roundReward>>Number(k)&1)){if(this.round>=GlobalConfig.RichManRoundAwardConfig[k].round)return true}}return false};return Millionaire}(BaseSystem);__reflect(Millionaire.prototype,"Millionaire");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.millionaire=Millionaire.ins.bind(Millionaire)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var MillionaireData=function(_super){__extends(MillionaireData,_super);function MillionaireData(){var _this=_super.call(this)||this;_this.dice=0;_this.gridId=0;_this.round=0;_this.roundReward=0;_this.randomGridById=0;_this.randomGridByRewardId=0;_this.rewardIdByGrids=[];_this.isStrideStart=0;_this.dicePoint=0;_this.autoTurnDice=0;_this.isAutoGo=false;return _this}MillionaireData.ins=function(){return _super.ins.call(this)};MillionaireData.prototype.parser=function(bytes){this.dice=bytes.readShort();this.gridId=bytes.readShort();this.round=bytes.readShort();this.roundReward=bytes.readInt();this.randomGridById=bytes.readShort();this.randomGridByRewardId=bytes.readUnsignedByte();var gridSum=bytes.readShort();for(var i=1;i<=gridSum;i++){var reward=bytes.readShort();this.rewardIdByGrids[i]=reward}var cfg=GlobalConfig.RichManGridConfig[this.gridId];if(cfg&&cfg.action==2){}};MillionaireData.prototype.parserTurnDice=function(bytes){this.isStrideStart=bytes.readUnsignedByte();this.gridId=bytes.readShort();this.dicePoint=bytes.readUnsignedByte()};MillionaireData.prototype.parserRoundReward=function(bytes){this.roundReward=bytes.readInt()};MillionaireData.prototype.parserOverAllReward=function(bytes){this.randomGridById=bytes.readShort();this.randomGridByRewardId=bytes.readUnsignedByte()};MillionaireData.prototype.parserMillionaireUpdate=function(bytes){this.dice=bytes.readShort();this.round=bytes.readShort();this.roundReward=bytes.readInt()};MillionaireData.prototype.getRedPoint=function(){if(!MillionaireWin.isOpen())return false;if(this.dice>0)return true;for(var k in GlobalConfig.RichManRoundAwardConfig){if(!(this.roundReward>>Number(k)&1)){if(this.round>=GlobalConfig.RichManRoundAwardConfig[k].round)return true}}return false};return MillionaireData}(BaseClass);__reflect(MillionaireData.prototype,"MillionaireData");var MillionaireItem=function(_super){__extends(MillionaireItem,_super);function MillionaireItem(){var _this=_super.call(this)||this;_this.skinName="richmanItemSkin";return _this}MillionaireItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.isEffing=false;this.startX=this.itemicon.x;this.startY=this.itemicon.y};MillionaireItem.prototype.setHide=function(){this.itemicon.alpha=1;this.itemicon.source="";this.shadow.visible=false;this.itemicon.x=this.startX;this.itemicon.y=this.startY;this.itemcount.visible=false;this.countX.visible=false};MillionaireItem.prototype.setHideEff=function(){var flyItem=new eui.Image(this.itemicon.source);flyItem.x=this.startX;flyItem.y=this.startY;flyItem.width=this.itemicon.width;flyItem.height=this.itemicon.height;this.itemicon.parent.addChild(flyItem);GameLogic.ins().postFlyItemEx(flyItem);this.setHide()};MillionaireItem.prototype.dataChanged=function(){this.shadow.visible=true;var id=this.data.index;this.itemcount.visible=true;this.countX.visible=true;if(this.data.rewardId==-1){this.itemicon.source="";this.shadow.visible=false;this.itemcount.visible=false;this.countX.visible=false;return}var rewardId=this.data.rewardId-1;var config=GlobalConfig.RichManGridConfig[id];if(!config)return;var rdata;if(config.exparam){for(var k in config.exparam){if(Number(k)==Millionaire.ins().round){rdata=config.exparam[k];break}}}if(rdata){this.setImgSouce(rdata);return}if(config.action==MillionaireItem.ACTION_1){id=Millionaire.ins().randomGridById;if(id){config=GlobalConfig.RichManGridConfig[id];rewardId=Millionaire.ins().randomGridByRewardId-1}rdata=config.param[rewardId];this.setImgSouce(rdata)}else if(config.action==MillionaireItem.ACTION_2){id=Millionaire.ins().randomGridById;if(id){config=GlobalConfig.RichManGridConfig[id];rewardId=Millionaire.ins().randomGridByRewardId-1;rdata=config.param[rewardId];this.setImgSouce(rdata)}else{this.itemicon.source="richman_json.richiman_random"}}else if(config.action==MillionaireItem.ACTION_3){this.itemicon.source="richman_json.richiman_teleport";this.itemcount.visible=false;this.countX.visible=false}else if(config.action==MillionaireItem.ACTION_4){this.itemicon.source="richman_json.richman_dice6";this.itemcount.visible=false;this.countX.visible=false}};MillionaireItem.prototype.setImgSouce=function(rdata){var itemType=0;if(!rdata.type){this.itemicon.source=RewardData.getCurrencyRes(rdata.id);switch(rdata.id){case MoneyConst.yuanbao:itemType=5;break;case MoneyConst.gold:itemType=0;break;case MoneyConst.soul:itemType=2;break;case MoneyConst.piece:itemType=2;this.itemicon.source=RewardData.CURRENCY_RES[rdata.id];break;default:break}}else{var itemconfig=GlobalConfig.ItemConfig[rdata.id];if(itemconfig){this.itemicon.source=itemconfig.icon+"_png"}}this.itemcount.text=rdata.count.toString()};MillionaireItem.prototype.destruct=function(){};MillionaireItem.prototype.clear=function(){};MillionaireItem.ACTION_1=1;MillionaireItem.ACTION_2=2;MillionaireItem.ACTION_3=3;MillionaireItem.ACTION_4=4;return MillionaireItem}(BaseItemRender);__reflect(MillionaireItem.prototype,"MillionaireItem");var MillionaireListRenderer=function(_super){__extends(MillionaireListRenderer,_super);function MillionaireListRenderer(){var _this=_super.call(this)||this;_this.skinName="MillionListRendererSkin";return _this}MillionaireListRenderer.prototype.dataChanged=function(){if(!this.data)return;var arr=this.data;var actorname=arr[0];var itemID=arr[1];if(itemID==null)return;var item=GlobalConfig.ItemConfig[itemID];if(item==null)return;var str;str="<font color = "+ColorUtil.HUNT_ITEMLIST_NAME+">"+actorname+i18n("MillionaireListRenderer_0")+item.name+" x"+arr[2]+"</font>";this.showText.textFlow=TextFlowMaker.generateTextFlow(str)};return MillionaireListRenderer}(BaseItemRender);__reflect(MillionaireListRenderer.prototype,"MillionaireListRenderer");var MillionaireRole=function(_super){__extends(MillionaireRole,_super);function MillionaireRole(sex){var _this=_super.call(this)||this;_this.preName="";_this.shadow=new eui.Image("richman_shadow");_this.shadow.x=_this.x-18;_this.shadow.y=_this.y-5;_this.addChild(_this.shadow);_this.state=MillionaireView.DIR_UP;_this.roleType=MillionaireRole.STOP;_this.sex=sex?sex:0;_this.initModel();return _this}MillionaireRole.prototype.initModel=function(){this.model=new MovieClip;this.addChild(this.model);this.prefix="body100_0";this.model1=new MovieClip;this.addChild(this.model1);this.prefix1="";this.model2=new MovieClip;this.addChild(this.model2);this.prefix2="";this.model3=new MovieClip;this.addChild(this.model3);this.prefix3="";this.model4=new MovieClip;this.addChild(this.model4);this.prefix4="";this.weightLayers=[];this.weightLayers[MillionaireView.DIR_UP]=CharEffect.FRAME_ODER[0];this.weightLayers[MillionaireView.DIR_RIGHT]=CharEffect.FRAME_ODER[2];this.weightLayers[MillionaireView.DIR_LEFT]=CharEffect.FRAME_ODER[6];this.weightLayers[MillionaireView.DIR_DOWN]=CharEffect.FRAME_ODER[4];this.setMovieFromWeight();var role=EntityManager.ins().getMainRole(0);if(role){var model=role.infoModel;var id=model.equipsData[2].item.configID;if(model.zhuangbei[0]>0){var fileName=GlobalConfig.ZhuangBanId[model.zhuangbei[0]].res;this.prefix=fileName}else if(id>0){if(GlobalConfig.EquipConfig[id]){var fileName=GlobalConfig.EquipConfig[id].appearance;if(fileName.indexOf("903")>0){this.prefix=fileName+"_"+this.sex}else{this.prefix=fileName}}}else this.prefix=getDefaultBody(model.job);id=model.getEquipByIndex(0).item.configID;if(model.zhuangbei[1]>0){var fileName=GlobalConfig.ZhuangBanId[model.zhuangbei[1]].res;this.prefix1=fileName}else if(id>0){if(GlobalConfig.EquipConfig[id]){var fileName=GlobalConfig.EquipConfig[id].appearance;this.prefix1=fileName}}if(model.zhuangbei[2]>0){var fileName=GlobalConfig.ZhuangBanId[model.zhuangbei[2]].res;this.prefix2=fileName}else if(model.wingsData.openStatus){if(GlobalConfig.WingLevelConfig[model.wingsData.lv])this.prefix2=GlobalConfig.WingLevelConfig[model.wingsData.lv].appearance}if(model.heirloom){var suitConfig=model.heirloom.getSuitConfig(model);if(suitConfig&&suitConfig.weff){this.prefix3=suitConfig.weff}}if(model.weapons&&model.weapons.weaponsId>0){var fileName=GlobalConfig.WeaponSoulConfig[model.weapons.weaponsId].outside[model.job-1];this.prefix4=fileName}}};MillionaireRole.prototype.setMovieFromWeight=function(){this.setWeight(this.state)};MillionaireRole.prototype.setWeight=function(dir){var layers=this.weightLayers[dir];for(var i=0;i<layers.length;i++){var mc=this.getMoviceByWeight(layers[i]);if(mc){this.setChildIndex(mc,i)}}};MillionaireRole.prototype.getMoviceByWeight=function(weight){var mc;switch(weight){case CharMcOrder.BODY:mc=this.model;break;case CharMcOrder.WEAPON:mc=this.model1;break;case CharMcOrder.WING:mc=this.model2;break;case CharMcOrder.SOUL:mc=this.model4;break}return mc};MillionaireRole.prototype.destory=function(){DisplayUtils.removeFromParent(this.model);DisplayUtils.removeFromParent(this.model1);DisplayUtils.removeFromParent(this.model2);DisplayUtils.removeFromParent(this.model3);DisplayUtils.removeFromParent(this.model4)};Object.defineProperty(MillionaireRole.prototype,"stateName",{get:function(){this.model.scaleX=1;var strType="";switch(this.state){case MillionaireView.DIR_UP:if(this.roleType)strType="0r";else strType="0s";break;case MillionaireView.DIR_RIGHT:if(this.roleType)strType="2r";else strType="2s";break;case MillionaireView.DIR_DOWN:if(this.roleType)strType="4r";else strType="4s";break;case MillionaireView.DIR_LEFT:this.model.scaleX=-1;if(this.roleType)strType="2r";else strType="2s";break}this.model1.scaleX=this.model.scaleX;this.model2.scaleX=this.model.scaleX;this.model4.scaleX=this.model.scaleX;return strType},enumerable:true,configurable:true});MillionaireRole.prototype.updateModel=function(){if(this.preName!=this.stateName){this.preName=this.stateName;if(this.prefix)this.model.playFile(RES_DIR_BODY+this.prefix+"_"+this.stateName,-1);if(this.prefix1)this.model1.playFile(RES_DIR_WEAPON+this.prefix1+"_"+this.sex+"_"+this.stateName,-1);if(this.prefix2)this.model2.playFile(RES_DIR_WING+this.prefix2+"_"+this.stateName,-1);if(this.prefix3)this.model3.playFile(RES_DIR_EFF+this.prefix3,-1);if(this.prefix4)this.model4.playFile(RES_DIR_WEAPON+this.prefix4+"_"+this.stateName,-1);this.setMovieFromWeight()}};MillionaireRole.STOP=0;MillionaireRole.ACTION=1;return MillionaireRole}(egret.DisplayObjectContainer);__reflect(MillionaireRole.prototype,"MillionaireRole");var MillionaireTipsWin=function(_super){__extends(MillionaireTipsWin,_super);function MillionaireTipsWin(){var _this=_super.call(this)||this;_this.skinName="richmanRewardSkin";return _this}MillionaireTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};MillionaireTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Millionaire.ins().postRoundReward,this.callbackRoundReward);this.addTouchEndEvent(this.bgClose,this.onClick);this.addTouchEndEvent(this.getreward,this.onClick);this.pos=param[0];this.getlabel.touchEnabled=false;this.init()};MillionaireTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeObserve()};MillionaireTipsWin.prototype.callbackRoundReward=function(){this.init()};MillionaireTipsWin.prototype.init=function(){var cfg=GlobalConfig.RichManRoundAwardConfig[this.pos];if(cfg){if(Millionaire.ins().roundReward>>this.pos&1){this.counttext.visible=false;this.getreward.visible=true;this.getreward.touchEnabled=false;this.getlabel.visible=this.getreward.visible;this.getlabel.text=i18n("MillionaireTipsWin_1");this.getreward.source="btn42"}else{this.getreward.touchEnabled=true;this.getlabel.text=i18n("MillionaireTipsWin_2");this.getreward.source="btn40";if(Millionaire.ins().round>=cfg.round){this.counttext.visible=false;this.getreward.visible=!this.counttext.visible;this.getlabel.visible=this.getreward.visible}else{this.counttext.visible=true;this.getreward.visible=!this.counttext.visible;this.getlabel.visible=this.getreward.visible}}this.count.text=""+(cfg.round-Millionaire.ins().round);this.partname.text=i18n("MillionaireTipsWin_4",cfg.round);this.itemIcon.data={type:cfg.award[0].type,id:cfg.award[0].id,count:cfg.award[0].count}}};MillionaireTipsWin.prototype.onClick=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.getreward:var cfg=GlobalConfig.RichManRoundAwardConfig[this.pos];if(cfg){if(Millionaire.ins().roundReward>>this.pos&1){UserTips.ins().showTips(i18n("MillionaireTipsWin_5"))}else{if(Millionaire.ins().round>=cfg.round){Millionaire.ins().sendRoundReward(this.pos)}else{UserTips.ins().showTips(i18n("MillionaireTipsWin_6",cfg.round))}}}break}};return MillionaireTipsWin}(BaseEuiView);__reflect(MillionaireTipsWin.prototype,"MillionaireTipsWin");ViewManager.ins().reg(MillionaireTipsWin,LayerManager.UI_Popup);var DIRECTION;(function(DIRECTION){DIRECTION[DIRECTION["LEFT_TOP"]=1]="LEFT_TOP";DIRECTION[DIRECTION["TOP_MID"]=2]="TOP_MID";DIRECTION[DIRECTION["RIGHT_TOP"]=3]="RIGHT_TOP";DIRECTION[DIRECTION["LEFT_MID"]=4]="LEFT_MID";DIRECTION[DIRECTION["RIGHT_MID"]=5]="RIGHT_MID";DIRECTION[DIRECTION["LEFT_DOWN"]=6]="LEFT_DOWN";DIRECTION[DIRECTION["DOWN_MID"]=7]="DOWN_MID";DIRECTION[DIRECTION["RIGHT_DOWN"]=8]="RIGHT_DOWN";DIRECTION[DIRECTION["MOVING"]=9]="MOVING"})(DIRECTION||(DIRECTION={}));window["DIRECTION"]=DIRECTION;var MillionaireView=function(_super){__extends(MillionaireView,_super);function MillionaireView(){var _this=_super.call(this)||this;_this.count=0;_this.gridList=[];_this.curGridId=Millionaire.ins().gridId?Millionaire.ins().gridId:1;_this.nextPos=_this.curGridId;_this.updateStop=true;_this.countDown=0;_this.aniTime=0;_this.dictime=10;_this.count=0;_this.effing=false;_this.btnUp=false;_this.stepNum=0;_this.isUpdateRandom=false;_this.diceimg=false;return _this}Object.defineProperty(MillionaireView.prototype,"cameraWidth",{get:function(){return GlobalConfig.RichManBaseConfig?GlobalConfig.RichManBaseConfig.cameraWidth:1},enumerable:true,configurable:true});Object.defineProperty(MillionaireView.prototype,"cameraHeight",{get:function(){return GlobalConfig.RichManBaseConfig?GlobalConfig.RichManBaseConfig.cameraHeight:1},enumerable:true,configurable:true});Object.defineProperty(MillionaireView.prototype,"step",{get:function(){return GlobalConfig.RichManBaseConfig?GlobalConfig.RichManBaseConfig.speed:1},enumerable:true,configurable:true});MillionaireView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateMillionaire,this);this.gridList=[];if(this.roleModel){this.roleModel.destory()}DisplayUtils.removeFromParent(this.masksp)};MillionaireView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Millionaire.ins().postMillionaireInfo,this.callbackMillionaireInfo);this.observe(Millionaire.ins().postTurnDice,this.callbackTurnDice);this.observe(Millionaire.ins().postOverAllReward,this.callbackOverAllReward);this.createMap();this.createRole();this.initPos();TimerManager.ins().remove(this.updateMillionaire,this);TimerManager.ins().doTimer(this.dictime,0,this.updateMillionaire,this)};MillionaireView.prototype.callbackMillionaireInfo=function(){};MillionaireView.prototype.callbackTurnDice=function(){if(Millionaire.ins().isStrideStart){this.nextPos=1;this.stepNum=Millionaire.ins().dicePoint-(this.gridList.length-this.curGridId)}else{this.nextPos=this.curGridId+Millionaire.ins().dicePoint}var cfg=GlobalConfig.RichManGridConfig[this.nextPos];if(cfg&&cfg.action==MillionaireItem.ACTION_3){}else{if(this.nextPos!=1)this.nextPos=Millionaire.ins().gridId}if(Millionaire.ins().isAutoGo)this.countDown=0;else this.countDown=GlobalConfig.RichManBaseConfig.diceTime;this.updateStop=false};MillionaireView.prototype.callbackOverAllReward=function(){this.isUpdateRandom=true};MillionaireView.prototype.updateMapEx=function(){var _this=this;this.updateEff(function(){_this.updateMap()})};MillionaireView.prototype.updateMapOnly=function(){var i=this.curGridId;this.gridList[i].setHideEff();Millionaire.ins().rewardIdByGrids[i]=-1};MillionaireView.prototype.updateEff=function(callfunc){this.aniTime=.5;this.effing=true;var self=this;this.arrEff=[];var _loop_21=function(i){var mitem=this_15.gridList[i];if(GlobalConfig.RichManGridConfig[i].action==MillionaireItem.ACTION_3||GlobalConfig.RichManGridConfig[i].action==MillionaireItem.ACTION_4){this_15.arrEff[i]=true;return"continue"}this_15.arrEff[i]=false;if(mitem){if(mitem.isEffing){self.arrEff[i]=true;return"continue"}egret.Tween.get(mitem.itemicon).to({scaleX:0,scaleY:0},this_15.aniTime*1e3).call(function(){egret.Tween.removeTweens(mitem.itemicon);self.arrEff[i]=true})}};var this_15=this;for(var i=1;i<=this.gridList.length-1;i++){_loop_21(i)}this.callfunc=callfunc};MillionaireView.prototype.getDirection=function(){if(this.mapGroup.width<=this.cameraWidth&&this.mapGroup.height<=this.cameraHeight)return DIRECTION.LEFT_TOP;var p=new egret.Point;p.x=this.gridList[this.curGridId].x;p.y=this.gridList[this.curGridId].y;var grid_x=Math.floor(p.x+this.gridList[this.curGridId].width/2);var grid_y=Math.floor(p.y+this.gridList[this.curGridId].height/2);if(grid_x>=Math.floor(this.cameraWidth/2)&&grid_y>=Math.floor(this.cameraHeight/2)&&grid_x<=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&grid_y<=Math.floor(this.mapGroup.height-this.cameraHeight/2)){return DIRECTION.MOVING}else{if(grid_x<=Math.floor(this.cameraWidth/2)&&grid_y<=Math.floor(this.cameraHeight/2)){return DIRECTION.LEFT_TOP}else if(grid_x>=Math.floor(this.cameraWidth/2)&&grid_x<=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&grid_y<=Math.floor(this.cameraHeight/2)){return DIRECTION.TOP_MID}else if(grid_x>=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&grid_y<=Math.floor(this.cameraHeight/2)){return DIRECTION.RIGHT_TOP}else if(grid_x<=Math.floor(this.cameraWidth/2)&&grid_y>=Math.floor(this.cameraHeight/2)&&grid_y<=Math.floor(this.mapGroup.height-this.cameraHeight/2)){return DIRECTION.LEFT_MID}else if(grid_x>=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&grid_y>=Math.floor(this.cameraHeight/2)&&grid_y<=Math.floor(this.mapGroup.height-this.cameraHeight/2)){return DIRECTION.RIGHT_MID}else if(grid_x<=Math.floor(this.cameraWidth/2)&&grid_y>=Math.floor(this.mapGroup.height-this.cameraHeight/2)){return DIRECTION.LEFT_DOWN}else if(grid_x>=Math.floor(this.cameraWidth/2)&&grid_x<=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&grid_y>=Math.floor(this.mapGroup.height-this.cameraHeight/2)){return DIRECTION.DOWN_MID}else if(grid_x>=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&grid_y>=Math.floor(this.mapGroup.height-this.cameraHeight/2)){return DIRECTION.RIGHT_DOWN}return 0}};MillionaireView.prototype.initPos=function(){this.mapGroup.x=0;this.mapGroup.y=0;var p=this.gridList[this.curGridId].localToGlobal();this.globalToLocal(p.x,p.y,p);var dir=this.getDirection();if(dir==DIRECTION.MOVING){this.mapGroup.x=this.cameraWidth/2-p.x-this.gridList[this.curGridId].width/2;this.mapGroup.y=this.cameraHeight/2-p.y-this.gridList[this.curGridId].height/2}else{if(dir==DIRECTION.LEFT_TOP){this.mapGroup.x=0;this.mapGroup.y=0}else if(dir==DIRECTION.TOP_MID){this.mapGroup.x=-p.x+this.cameraWidth/2-this.gridList[this.curGridId].width/2;this.mapGroup.y=0}else if(dir==DIRECTION.RIGHT_TOP){this.mapGroup.x=this.cameraWidth-this.mapGroup.width-this.gridList[this.curGridId].width/2;this.mapGroup.y=0}else if(dir==DIRECTION.LEFT_MID){this.mapGroup.x=0;this.mapGroup.y=-p.y+this.cameraHeight/2-this.gridList[this.curGridId].height/2}else if(dir==DIRECTION.RIGHT_MID){this.mapGroup.x=this.cameraWidth-this.mapGroup.width-this.gridList[this.curGridId].width/2;this.mapGroup.y=-p.y+this.cameraHeight/2-this.gridList[this.curGridId].height/2}else if(dir==DIRECTION.LEFT_DOWN){this.mapGroup.x=0;this.mapGroup.y=this.cameraHeight-this.mapGroup.height-this.gridList[this.curGridId].height/2}else if(dir==DIRECTION.DOWN_MID){this.mapGroup.x=-p.x+this.cameraWidth/2-this.gridList[this.curGridId].width/2;this.mapGroup.y=this.cameraHeight-this.mapGroup.height-this.gridList[this.curGridId].height/2}else if(dir==DIRECTION.RIGHT_DOWN){this.mapGroup.x=this.cameraWidth-this.mapGroup.width-this.gridList[this.curGridId].width/2;this.mapGroup.y=this.cameraHeight-this.mapGroup.height-this.gridList[this.curGridId].height/2}}p=this.gridList[this.curGridId].localToGlobal();this.globalToLocal(p.x,p.y,p);this.roleModel.x=p.x+this.roleModel.width/2;this.roleModel.y=p.y+this.roleModel.height/2};MillionaireView.prototype.createRole=function(){var role=SubRoles.ins().getSubRoleByIndex(0);if(this.roleModel){this.roleModel.parent.removeChild(this.roleModel);this.roleModel.destory();this.roleModel=null}this.roleModel=new MillionaireRole(role.sex);var cfg=GlobalConfig.RichManGridConfig[this.curGridId];if(cfg)this.roleModel.state=cfg.dir;this.roleModel.width=53;this.roleModel.height=53+38;this.roleModel.x=this.roleModel.x+this.roleModel.width/2;this.roleModel.y=this.roleModel.y+this.roleModel.height/2;this.roleModel.updateModel();this.addChild(this.roleModel)};MillionaireView.prototype.createMap=function(){if(!this.mapGroup){this.mapGroup=new eui.Group;this.mapGroup.x=0;this.mapGroup.y=0;this.addChild(this.mapGroup)}for(var i=1;i<=Millionaire.ins().rewardIdByGrids.length-1;i++){var cfg=GlobalConfig.RichManGridConfig[i];if(cfg){if(i==1){var mitem_1=new MillionaireItem;mitem_1.x=0;mitem_1.y=0;mitem_1.data={rewardId:Millionaire.ins().rewardIdByGrids[i],index:i};this.mapGroup.addChild(mitem_1);this.gridList[i]=mitem_1;continue}var precfg=GlobalConfig.RichManGridConfig[i-1];if(!precfg)continue;var mitem=new MillionaireItem;mitem.data={rewardId:Millionaire.ins().rewardIdByGrids[i],index:i};this.gridList[i]=mitem;this.mapGroup.addChild(mitem);switch(precfg.dir){case MillionaireView.DIR_UP:mitem.x=this.gridList[i-1].x;mitem.y=this.gridList[i-1].y-this.gridList[i-1].height;break;case MillionaireView.DIR_RIGHT:mitem.x=this.gridList[i-1].x+this.gridList[i-1].width;mitem.y=this.gridList[i-1].y;break;case MillionaireView.DIR_DOWN:mitem.x=this.gridList[i-1].x;mitem.y=this.gridList[i-1].y+this.gridList[i-1].height;break;case MillionaireView.DIR_LEFT:mitem.x=this.gridList[i-1].x-this.gridList[i-1].width;mitem.y=this.gridList[i-1].y;break}}}this.sortGrid();if(!this.masksp){this.masksp=new egret.Sprite;var square=new egret.Shape;square.graphics.beginFill(16776960);square.graphics.drawRect(this.mapGroup.x,this.mapGroup.y-70,this.cameraWidth,this.cameraHeight+70);square.graphics.endFill();this.masksp.addChild(square);this.addChild(this.masksp);this.mapGroup.mask=this.masksp}};MillionaireView.prototype.updateMap=function(){for(var i=1;i<=this.gridList.length-1;i++){this.gridList[i].data={rewardId:Millionaire.ins().rewardIdByGrids[i],index:i};this.gridList[i].itemicon.scaleX=1;this.gridList[i].itemicon.scaleY=1}};MillionaireView.prototype.sortGrid=function(){this.mapGroup.$children.sort(this.sortF)};MillionaireView.prototype.sortF=function(d1,d2){if(d1.y>d2.y){return 1}else if(d1.y<d2.y){return-1}else{return 0}};MillionaireView.prototype.updateMillionaire=function(){if(this.countDown){this.count+=this.dictime/100;if(this.count>=1){this.countDown-=.1;this.count=0}if(this.countDown<=0){this.countDown=0;this.count=0;this.diceimg=false}return}if(this.effing){var isSuccess=true;for(var i=1;i<=this.arrEff.length-1;i++){if(!this.arrEff[i]){isSuccess=false;break}}if(isSuccess){if(this.callfunc&&typeof this.callfunc=="function")this.callfunc();this.effing=false;this.callfunc=null;if(this.stepNum>0){this.nextPos+=this.stepNum;this.stepNum=0}if(this.curGridId==this.nextPos){this.btnUp=false}}return}if(this.updateStop)return;if(this.roleModel){this.checkRoleType();if(this.roleModel.roleType==MillionaireRole.ACTION){this.Action()}else{this.Stop()}}};MillionaireView.prototype.checkRoleType=function(){if(this.curGridId!=this.nextPos){this.roleModel.roleType=MillionaireRole.ACTION}};MillionaireView.prototype.getMoveGridId=function(){if(this.curGridId!=this.nextPos){var p=this.gridList[this.curGridId].localToGlobal();this.globalToLocal(p.x,p.y,p);if(p.x+this.roleModel.width/2==this.roleModel.x&&p.y+this.roleModel.height/2==this.roleModel.y){this.curGridId+=1;if(this.curGridId>this.gridList.length-1)this.curGridId=1;var cfg=GlobalConfig.RichManGridConfig[this.curGridId-1];if(cfg){this.roleModel.state=cfg.dir}}}this.roleModel.updateModel();return this.curGridId};MillionaireView.prototype.Stop=function(){this.updateStop=true;this.roleModel.updateModel()};MillionaireView.prototype.Action=function(){this.updateStop=false;var newGridId=this.getMoveGridId();var p=this.gridList[newGridId].localToGlobal();this.globalToLocal(p.x,p.y,p);var difX=0;var difY=0;switch(this.roleModel.state){case MillionaireView.DIR_LEFT:case MillionaireView.DIR_RIGHT:if(this.roleModel.x!=p.x+this.roleModel.width/2){difX=p.x-this.roleModel.x+this.roleModel.width/2}break;case MillionaireView.DIR_UP:case MillionaireView.DIR_DOWN:if(this.roleModel.y!=p.y+this.roleModel.height/2){difY=p.y-this.roleModel.y+this.roleModel.height/2}break}if(Math.abs(difX)>this.step){difX=this.getStepPixel(this.roleModel.state)}if(Math.abs(difY)>this.step){difY=this.getStepPixel(this.roleModel.state)}var moveObj;var isRoleX;var dir=this.getDirection();if(dir==DIRECTION.LEFT_TOP||dir==DIRECTION.LEFT_MID||dir==DIRECTION.LEFT_DOWN||dir==DIRECTION.RIGHT_TOP||dir==DIRECTION.RIGHT_MID||dir==DIRECTION.RIGHT_DOWN||dir==DIRECTION.TOP_MID||dir==DIRECTION.DOWN_MID){if((dir==DIRECTION.LEFT_TOP||dir==DIRECTION.LEFT_MID||dir==DIRECTION.LEFT_DOWN)&&(this.roleModel.state==MillionaireView.DIR_RIGHT||this.roleModel.state==MillionaireView.DIR_LEFT)&&this.mapGroup.x>=0||(dir==DIRECTION.RIGHT_TOP||dir==DIRECTION.RIGHT_MID||dir==DIRECTION.RIGHT_DOWN)&&(this.roleModel.state==MillionaireView.DIR_LEFT||this.roleModel.state==MillionaireView.DIR_RIGHT)&&this.mapGroup.x<=-this.mapGroup.width+this.cameraWidth||(dir==DIRECTION.TOP_MID||dir==DIRECTION.DOWN_MID)&&this.roleModel.state==MillionaireView.DIR_RIGHT&&this.roleModel.x+this.roleModel.width/2<this.cameraWidth/2||(dir==DIRECTION.TOP_MID||dir==DIRECTION.DOWN_MID)&&this.roleModel.state==MillionaireView.DIR_LEFT&&this.roleModel.x+this.roleModel.width/2>this.cameraWidth/2){moveObj=this.roleModel;isRoleX=true}else{moveObj=this.mapGroup;difX=-difX;isRoleX=false}}else{moveObj=this.mapGroup;difX=-difX;isRoleX=false}var nextPosX=moveObj.x+difX;var isRoleY;if(dir==DIRECTION.LEFT_TOP||dir==DIRECTION.TOP_MID||dir==DIRECTION.RIGHT_TOP||dir==DIRECTION.LEFT_DOWN||dir==DIRECTION.DOWN_MID||dir==DIRECTION.RIGHT_DOWN||dir==DIRECTION.LEFT_MID||dir==DIRECTION.RIGHT_MID){if((dir==DIRECTION.LEFT_TOP||dir==DIRECTION.TOP_MID||dir==DIRECTION.RIGHT_TOP)&&(this.roleModel.state==MillionaireView.DIR_DOWN||this.roleModel.state==MillionaireView.DIR_UP)&&this.mapGroup.y>=0||(dir==DIRECTION.LEFT_DOWN||dir==DIRECTION.DOWN_MID||dir==DIRECTION.RIGHT_DOWN)&&(this.roleModel.state==MillionaireView.DIR_UP||this.roleModel.state==MillionaireView.DIR_DOWN)&&this.mapGroup.y<=-this.mapGroup.height+this.cameraHeight||(dir==DIRECTION.LEFT_MID||dir==DIRECTION.RIGHT_MID)&&this.roleModel.state==MillionaireView.DIR_DOWN&&this.roleModel.y+this.roleModel.height/2<this.cameraHeight/2||(dir==DIRECTION.LEFT_MID||dir==DIRECTION.RIGHT_MID)&&this.roleModel.state==MillionaireView.DIR_UP&&this.roleModel.y+this.roleModel.height/2>this.cameraHeight/2){moveObj=this.roleModel;isRoleY=true}else{moveObj=this.mapGroup;difY=-difY;isRoleY=false}}else{moveObj=this.mapGroup;difY=-difY;isRoleY=false}var nextPosY=moveObj.y+difY;if(!difX&&!difY){this.roleModel.roleType=MillionaireRole.STOP;this.doSometing();this.roleModel.updateModel();return}else{this.roleModel.roleType=MillionaireRole.ACTION}if(isRoleX){if(this.roleModel.x+this.roleModel.width/2<this.cameraWidth/2&&nextPosX+this.roleModel.width/2>this.cameraWidth/2||this.roleModel.x+this.roleModel.width/2>this.cameraWidth/2&&nextPosX+this.roleModel.width/2<this.cameraWidth/2)this.roleModel.x=this.cameraWidth/2-this.roleModel.width/2;else this.roleModel.x=nextPosX}else{this.mapGroup.x=nextPosX}if(isRoleY){if(this.roleModel.y+this.roleModel.height/2<this.cameraHeight/2&&nextPosY+this.roleModel.height/2>this.cameraHeight/2||this.roleModel.y+this.roleModel.height/2>this.cameraHeight/2&&nextPosY+this.roleModel.height/2<this.cameraHeight/2)this.roleModel.y=this.cameraHeight/2-this.roleModel.height/2;else this.roleModel.y=nextPosY}else{this.mapGroup.y=nextPosY}};MillionaireView.prototype.doSometing=function(){var config=GlobalConfig.RichManGridConfig[this.curGridId];if(!config)return;if(this.curGridId==1){this.updateMapOnly();this.updateMapEx();return}if(config.action==MillionaireItem.ACTION_1){this.updateMapOnly()}else if(config.action==MillionaireItem.ACTION_2){if(Millionaire.ins().randomGridById<=0){UserTips.ins().showCenterTips(i18n("MillionaireView_22"));return}if(this.isUpdateRandom){this.isUpdateRandom=false;this.updateMapEx()}else{if(Millionaire.ins().rewardIdByGrids[this.curGridId]==-1){this.btnUp=false;return}this.updateMapOnly()}}else if(config.action==MillionaireItem.ACTION_3){this.nextPos=Millionaire.ins().gridId;this.curGridId=this.nextPos;this.initPos()}else if(config.action==MillionaireItem.ACTION_4){this.updateMapOnly()}this.btnUp=false};MillionaireView.prototype.getStepPixel=function(state){switch(state){case MillionaireView.DIR_UP:return-this.step;case MillionaireView.DIR_DOWN:return this.step;case MillionaireView.DIR_RIGHT:return this.step;case MillionaireView.DIR_LEFT:return-this.step}};MillionaireView.prototype.checkCamera=function(state,dir){if(dir==DIRECTION.MOVING)return true;switch(state){case MillionaireView.DIR_UP:if(this.roleModel.y+this.roleModel.height/2>this.cameraHeight/2)return false;break;case MillionaireView.DIR_DOWN:if(this.roleModel.y+this.roleModel.height/2<this.cameraHeight/2)return false;break;case MillionaireView.DIR_RIGHT:if(this.roleModel.x+this.roleModel.width/2<this.cameraWidth/2)return false;break;case MillionaireView.DIR_LEFT:if(this.roleModel.x+this.roleModel.width/2>this.cameraWidth/2)return false;break}return true};MillionaireView.prototype.destoryView=function(){_super.prototype.destoryView.call(this);this.close()};MillionaireView.DIR_UP=1;MillionaireView.DIR_RIGHT=2;MillionaireView.DIR_DOWN=3;MillionaireView.DIR_LEFT=4;return MillionaireView}(BaseEuiView);__reflect(MillionaireView.prototype,"MillionaireView");var MillionaireWin=function(_super){__extends(MillionaireWin,_super);function MillionaireWin(){var _this=_super.call(this)||this;_this.isShowDice=false;_this.isTopLevel=true;return _this}MillionaireWin.isOpen=function(){if(Actor.level<GlobalConfig.RichManBaseConfig.openLv){return false}return true};MillionaireWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var open=MillionaireWin.isOpen();if(!open)UserTips.ins().showTips(i18n("MillionaireWin_0",GlobalConfig.RichManBaseConfig.openLv));return open};MillionaireWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list0.itemRenderer=MillionaireListRenderer;this.addTouchEvent(this.go,this.onClick);this.addTouchEvent(this.autoGo,this.onClick);this.addTouchEvent(this.arrowleft,this.onClick);this.addTouchEvent(this.arrowright,this.onClick);Millionaire.ins().sendMillionaireInfo();this.observe(Millionaire.ins().postMillionaireInfo,this.callbackInfo);this.observe(Millionaire.ins().postTurnDice,this.callbackTurnDice);this.observe(Millionaire.ins().postRoundReward,this.callbackRoundReward);this.observe(Millionaire.ins().postMillionaireUpdate,this.callbackMillionaireUpdate);this.observe(Millionaire.ins().postMillionaireRecord,this.listRefush);this.listRefush();Millionaire.ins().sendMillionaireRecord();this.touchGroup.touchEnabled=false;this.reward.touchEnabled=false;this.paycount.touchEnabled=false;this.y1.touchEnabled=false;this.y2.touchEnabled=false;this.touchMoving=false;this.dice.visible=false;for(var i=1;i<=8;i++){this.addTouchEvent(this["box"+i],this.onTab)}var roundRewards=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;MillionaireWin.MaxBoxGroup=Math.floor(roundRewards/4);Millionaire.ins().isAutoGo=false;this.startBoxId=0;this.beginPoint=0;this.touchMoving=false;this.ewtime=300;this.actCircle=[];this.dicenum=1;this.isShowDice=false;MillionaireWin.isFirstOpen=true;if(!this.masksp){this.masksp=new egret.Sprite;var square=new egret.Shape;square.graphics.beginFill(16776960);square.graphics.drawRect(this.group1.x,this.group1.y,this.group1.width,this.group1.height);square.graphics.endFill();this.masksp.addChild(square);this.reward.addChild(this.masksp);this.reward.mask=this.masksp}this.init();TimerManager.ins().remove(this.updateMillionaire,this);TimerManager.ins().doTimer(100,0,this.updateMillionaire,this)};MillionaireWin.prototype.updateMillionaire=function(){if(this.millionaireView.diceimg){this.dice.visible=true;if(this.isShowDice&&this.millionaireView.countDown<=GlobalConfig.RichManBaseConfig.diceTime/2)this.dice.source="richman_dice"+Millionaire.ins().dicePoint;else{this.dice.source="richman_dice"+this.dicenum;this.dicenum++;if(this.dicenum>6)this.dicenum=1}return}this.isShowDice=false;this.dice.visible=false;this.dicenum=1;if(Millionaire.ins().isAutoGo)this.turnDice()};MillionaireWin.prototype.callbackMillionaireUpdate=function(){this.init()};MillionaireWin.prototype.callbackInfo=function(){this.init();this.millionaireView.open()};MillionaireWin.prototype.callbackTurnDice=function(){this.isShowDice=true;this.init()};MillionaireWin.prototype.callbackRoundReward=function(){UserTips.ins().showTips(i18n("MillionaireWin_1"));this.init()};MillionaireWin.prototype.listRefush=function(){this.list0.dataProvider=new eui.ArrayCollection(Millionaire.ins().AwardRecords)};MillionaireWin.prototype.init=function(){this.checkStartIndex();this.playTxt.visible=false;this.startBoxId=this.startBoxId?this.startBoxId:1;this.dicecount.text=Millionaire.ins().dice+"";this.count.text=i18n("MillionaireWin_2",Millionaire.ins().round+1);this.paycount.text=GlobalConfig.RichManBaseConfig.dicePrice+"";this.setBoxPos();this.setTxt()};MillionaireWin.prototype.setTxt=function(){if(Millionaire.ins().dice>0){this.playTxt.visible=true;this.ybGroup.visible=false}else{this.playTxt.visible=false;this.ybGroup.visible=true}};MillionaireWin.prototype.setProgressBar=function(){var curRound=Millionaire.ins().round;var maxRound=GlobalConfig.RichManRoundAwardConfig[Object.keys(GlobalConfig.RichManRoundAwardConfig).length].round;var percent=0;var pos=(this.startBoxId-1)*4;var num=100;for(var i=pos,idx=0;i<pos+4;i++,idx++){var index=i+1;if(!idx){continue}if(this["bar"+(idx-1)]&&this["bar"+(idx-1)].value<100){this["bar"+idx].value=0;this["bar"+idx].labelFunction=function(){return""};continue}var cfg=GlobalConfig.RichManRoundAwardConfig[index];var precfg=GlobalConfig.RichManRoundAwardConfig[index-1];var needRound=cfg.round-precfg.round;var cnRound=curRound-precfg.round;cnRound=cnRound>0?cnRound:0;var pcent=cnRound/needRound;if(pcent>=1){percent=num}else{percent=Math.floor(num*pcent)}this["bar"+idx].value=percent>=100?100:percent;this["bar"+idx].labelFunction=function(){return""}}};MillionaireWin.prototype.onClick=function(e){switch(e.currentTarget){case this.go:this.turnDice();break;case this.autoGo:Millionaire.ins().isAutoGo=!Millionaire.ins().isAutoGo;this.autoGo.label=Millionaire.ins().isAutoGo?i18n("MillionaireWin_3"):i18n("MillionaireWin_4");break;case this.arrowleft:this.MoveLeft();break;case this.arrowright:this.MoveRight();break}};MillionaireWin.prototype.turnDice=function(){var _this=this;if(this.millionaireView.effing||this.millionaireView.btnUp)return;if(Millionaire.ins().dice>0){Millionaire.ins().sendTurnDice();this.millionaireView.btnUp=true;if(!Millionaire.ins().isAutoGo)this.millionaireView.diceimg=true}else{if(Millionaire.ins().autoTurnDice){this.cost()}else{if(Millionaire.ins().isAutoGo){this.cost();return}WarnWin.show(i18n("MillionaireWin_5",GlobalConfig.RichManBaseConfig.dicePrice),function(){_this.cost()},this,function(){SysSetting.ins().setBool(SysSetting.DICE,false);Millionaire.ins().autoTurnDice=0},this,"check")}}this.setTxt()};MillionaireWin.prototype.cost=function(){if(Actor.yb>=GlobalConfig.RichManBaseConfig.dicePrice){Millionaire.ins().sendTurnDice();this.millionaireView.btnUp=true;if(!Millionaire.ins().isAutoGo)this.millionaireView.diceimg=true}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("MillionaireWin_7"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("MillionaireWin_8"))}Millionaire.ins().isAutoGo=false;this.millionaireView.btnUp=false;this.autoGo.label=i18n("MillionaireWin_9")}};MillionaireWin.prototype.onTab=function(e){for(var i=1;i<=8;i++){if(e.currentTarget==this["box"+i]){this.getReward(i);break}}};MillionaireWin.prototype.getReward=function(i){ViewManager.ins().open(MillionaireTipsWin,i)};MillionaireWin.prototype.onBegin=function(e){if(this.touchMoving)return;this.beginPoint=e.stageX};MillionaireWin.prototype.onEnd=function(e){if(this.touchMoving)return;if(this.beginPoint==0)return;var offset=e.stageX-this.beginPoint;if(Math.abs(offset)<5){return}this.Moving(offset)};MillionaireWin.prototype.Moving=function(offset){if(offset<0){this.MoveRight()}else{this.MoveLeft()}};MillionaireWin.prototype.MoveRight=function(){var _this=this;this.touchMoving=true;var self=this;if(this.startBoxId>=MillionaireWin.MaxBoxGroup){this.touchMoving=false;this.arrowright.visible=false;this.arrowleft.visible=!this.arrowright.visible;return}this.startBoxId++;if(this.startBoxId>=MillionaireWin.MaxBoxGroup){this.startBoxId=MillionaireWin.MaxBoxGroup;this.arrowright.visible=false;this.arrowleft.visible=!this.arrowright.visible}var _loop_22=function(i){egret.Tween.get(this_16["group"+i]).to({x:this_16["group"+i].x-this_16["group"+i].width},this_16.ewtime).call(function(){egret.Tween.removeTweens(self["group"+i]);if(i==MillionaireWin.MaxBoxGroup){self.setBoxPos();self.touchMoving=false;_this.arrowleft.visible=true}})};var this_16=this;for(var i=1;i<=MillionaireWin.MaxBoxGroup;i++){_loop_22(i)}};MillionaireWin.prototype.MoveLeft=function(){var _this=this;this.touchMoving=true;var self=this;if(this.startBoxId<=1){this.touchMoving=false;this.arrowleft.visible=false;this.arrowright.visible=!this.arrowleft.visible;var roundRewards=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;if(Math.floor(roundRewards/4)==1){this.arrowright.visible=false}return}this.startBoxId--;if(this.startBoxId<=1){this.startBoxId=1;this.arrowleft.visible=false;this.arrowright.visible=!this.arrowleft.visible;var roundRewards=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;if(Math.floor(roundRewards/4)==1){this.arrowright.visible=false}}var _loop_23=function(i){egret.Tween.get(this_17["group"+i]).to({x:this_17["group"+i].x+this_17["group"+i].width},this_17.ewtime).call(function(){egret.Tween.removeTweens(self["group"+i]);if(i==MillionaireWin.MaxBoxGroup){self.setBoxPos();self.touchMoving=false;_this.arrowright.visible=true}})};var this_17=this;for(var i=1;i<=MillionaireWin.MaxBoxGroup;i++){_loop_23(i)}};MillionaireWin.prototype.setBoxPos=function(){for(var i=1;i<=MillionaireWin.MaxBoxGroup;i++){if(i==1){this["group"+i].x=48;continue}var dix=i-this.startBoxId;this["group"+i].x=this["group"+(i-1)].x+this["group"+i].width*dix}for(var i=1;i<=MillionaireWin.MaxBoxGroup;i++){if(i==this.startBoxId){this["group"+i].x=48}else if(i<this.startBoxId){var dix=this.startBoxId-i;var index=i-1>0?i-1:1;this["group"+i].x=this["group"+index].x-this["group"+i].width*dix}else{var dix=i-this.startBoxId;this["group"+i].x=this["group"+(i-1)].x+this["group"+i].width*dix}}this.updateRewardUI()};MillionaireWin.prototype.updateRewardUI=function(){var pos=(this.startBoxId-1)*4;var idx=0;for(var i=pos;i<pos+4;i++){var index=i+1;if(Millionaire.ins().roundReward>>index&1){this["box"+idx+"desc"].textFlow=TextFlowMaker.generateTextFlow1(i18n("MillionaireWin_14"));this.updateBtnGray(idx+1);this.clearEff(idx)}else{var round=GlobalConfig.RichManRoundAwardConfig[index].round;this["box"+idx+"desc"].textFlow=TextFlowMaker.generateTextFlow1(i18n("MillionaireWin_16",round));this.updateEff(idx,round)}idx++}this.setProgressBar()};MillionaireWin.prototype.updateBtnGray=function(idx){var colorGrayMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];var colorFilter=new egret.ColorMatrixFilter(colorGrayMatrix);this["box"+idx].filters=[colorFilter]};MillionaireWin.prototype.updateEff=function(idx,round){if(Millionaire.ins().round>=round){if(!this.actCircle[idx])this.actCircle[idx]=new MovieClip;if(!this.actCircle[idx].parent)this.reward.addChild(this.actCircle[idx]);this.actCircle[idx].x=this["box"+idx+"under"].x+40;this.actCircle[idx].y=this["box"+idx+"under"].y+50;this.actCircle[idx].playFile(RES_DIR_EFF+"actIconCircle",-1)}else{DisplayUtils.removeFromParent(this.actCircle[idx])}};MillionaireWin.prototype.clearEff=function(idx){DisplayUtils.removeFromParent(this.actCircle[idx])};MillionaireWin.prototype.checkStartIndex=function(){for(var i=1;i<=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;i++){var cfg=GlobalConfig.RichManRoundAwardConfig[i];if(cfg){if(Millionaire.ins().roundReward>>i&1){}else{this.startBoxId=Math.floor(i/5)+1;break}}}if(this.startBoxId<=1){this.arrowleft.visible=false;this.arrowright.visible=!this.arrowleft.visible;var roundRewards=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;if(Math.floor(roundRewards/4)==1){this.arrowright.visible=false}}else if(this.startBoxId>=MillionaireWin.MaxBoxGroup){this.arrowleft.visible=true;this.arrowright.visible=!this.arrowleft.visible}else{this.arrowleft.visible=true;this.arrowright.visible=true}};MillionaireWin.prototype.flyRMB=function(rmb){var obj=new eui.BitmapLabel;obj.font="num_2_fnt";obj.y=this.roleSelect.y+10;obj.x=this.roleSelect.x+490;obj.scaleX=obj.scaleY=1.5;obj.text="-"+rmb;this.roleSelect.parent.addChild(obj);egret.Tween.get(obj).to({y:obj.y+50},1e3).call(function(){DisplayUtils.removeFromParent(obj)})};MillionaireWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.go,this.onClick);this.removeTouchEvent(this.autoGo,this.onClick);MillionaireWin.isFirstOpen=false;this.millionaireView.close();for(var i=1;i<=8;i++){this.removeTouchEvent(this["box"+i],this.onTab)}TimerManager.ins().remove(this.updateMillionaire,this);for(var i=0;i<this.actCircle.length;i++){if(this.actCircle[i])DisplayUtils.removeFromParent(this.actCircle[i])}DisplayUtils.removeFromParent(this.masksp);this.masksp=null;this.removeObserve()};MillionaireWin.MaxBoxGroup=2;MillionaireWin.isFirstOpen=false;return MillionaireWin}(BaseEuiView);__reflect(MillionaireWin.prototype,"MillionaireWin");ViewManager.ins().reg(MillionaireWin,LayerManager.UI_Main);var Mine=function(_super){__extends(Mine,_super);function Mine(){var _this=_super.call(this)||this;_this.mineStartTime=0;_this.mineEndTime=0;_this.hasNewRecord=false;_this._revengeCB={length:0};_this._applyHelpRevengeTime=0;_this._helpRevengeCB={length:0};_this.sysId=PackageID.Mine;_this.regNetMsg(1,_this.postMineBaseInfo);_this.regNetMsg(2,_this.postRefresh);_this.regNetMsg(3,_this.postStartMine);_this.regNetMsg(4,_this.postInitScene);_this.regNetMsg(6,_this.postMineRecord);_this.regNetMsg(7,_this.doReqResult);_this.regNetMsg(8,_this.postFightBack);_this.regNetMsg(9,_this.postEnemyAppear);_this.regNetMsg(11,_this.postSceneUpdate);_this.regNetMsg(13,_this.postRobResult);_this.regNetMsg(15,_this.postFinished);_this.regNetMsg(16,_this.postRecordHasUpdate);_this.regNetMsg(17,_this.postRoleInfo);_this.regNetMsg(18,_this.postMyMineTime);_this.regNetMsg(19,_this.postApplyHelpRevenge);_this.regNetMsg(20,_this.postHelpRevenge);_this.regNetMsg(21,_this.postHelpRevengeResult);_this.observe(GameLogic.ins().postEnterMap,_this.onEnterMap);return _this}Mine.ins=function(){return _super.ins.call(this)};Mine.prototype.getRemainSeconds=function(){if(this.mineEndTime==null||this.mineEndTime==0){return 0}var now=GameServer.serverTime;var result=(this.mineEndTime-now)/1e3;if(result<0){result=0}return Math.floor(result)};Mine.prototype.onEnterMap=function(){if(GameMap.sceneInMine()&&this.hasNewRecord&&!this.finishedData){ViewManager.ins().open(MineRecordWin)}};Mine.openCheck=function(showTips){var sv=GlobalConfig.CaiKuangConfig.openServerDay;if(sv>GameServer.serverOpenDay+1){if(showTips)UserTips.ins().showTips(i18n("Mine_0",sv));return false}var v=GlobalConfig.CaiKuangConfig.openLevel;var b=Actor.level>=v;if(!b){if(showTips)UserTips.ins().showTips(i18n("Mine_1",v));return false}return b};Mine.redpointCheck=function(){var b=this.openCheck();if(!b)return b;var addCount=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;if(Mine.ins().finishedData||Mine.ins().mineCount<GlobalConfig.CaiKuangConfig.maxOpenKuangCount+addCount&&Mine.ins().isOverTime()||Mine.ins().hasNewRecord){return b}return false};Mine.prototype.isOverTime=function(){if(!Mine.ins().mineEndTime)return true;if(GameServer.serverTime>Mine.ins().mineEndTime)return true;return false};Mine.prototype.postRedPoint=function(){return Mine.redpointCheck()?1:0};Mine.prototype.postMineFightState=function(state){return state};Mine.prototype.postMineBaseInfo=function(bytes){this.mineCount=bytes.readShort();this.robCount=bytes.readShort();this.mineId=bytes.readInt();this.mineFreshCount=bytes.readInt();this.mineQuaCount=bytes.readInt();this.mineEndTime=DateUtils.formatMiniDateTime(bytes.readInt());this.helpRevengeTimes=bytes.readInt();if(!this.mineId){this.finishedData=null}Mine.ins().postRedPoint()};Mine.prototype.postRefresh=function(bytes){this.mineId=bytes.readInt();this.mineFreshCount=bytes.readInt();var count=bytes.readInt();if(count>this.mineQuaCount){var config=GlobalConfig.KuangYuanConfig[Mine.ins().mineId];var num=Math.floor(config.maxTimes/config.baseTime);UserTips.ins().showTips(i18n("Mine_2",num))}this.mineQuaCount=count};Mine.prototype.postStartMine=function(bytes){this.mineCount=bytes.readShort();Mine.ins().postRedPoint()};Mine.prototype.postInitScene=function(bytes){MineData.ins().parser(bytes)};Mine.prototype.postMineRecord=function(bytes){var len=bytes.readShort();this.mineRecords=this.mineRecords||[];this.mineRecords.length=len;for(var i=0;i<len;i++){this.mineRecords[i]=this.mineRecords[i]||new MineRecord;this.mineRecords[i].parser(bytes)}this.hasNewRecord=false;Mine.ins().postRedPoint()};Mine.prototype.doReqResult=function(bytes){var b=bytes.readBoolean();if(b){MineFight.ins().start({type:0,id:this.robData.configID,actorID:this.robData.actorID})}else{UserTips.ins().showTips(i18n("Mine_3"))}};Mine.prototype.postFightBack=function(bytes){var result=bytes.readByte();var mes=bytes.readString();var hash=bytes.readInt();var fn=this._revengeCB[hash];if(fn&&fn instanceof Function){this._revengeCB[hash]=undefined;fn(result,mes)}};Mine.prototype.postEnemyAppear=function(bytes){var model=new MineEnemyModel;model.parser(bytes);return model};Mine.prototype.postSceneUpdate=function(bytes){var info=ObjectPool.pop("MineSceneInfo");info.parser(bytes);info.handler();info.destroy()};Mine.prototype.postRobResult=function(bytes){this.robCount=bytes.readShort()};Mine.prototype.postFinished=function(bytes){this.mineEndTime=0;this.finishedData={};this.finishedData.configID=bytes.readShort();this.finishedData.beRob=[];var len=bytes.readShort();for(var i=0;i<len;i++){var obj={};obj.name=bytes.readString();obj.win=bytes.readBoolean();this.finishedData.beRob.push(obj)}if(this.hasFinishedData()){this.openRobWin()}Mine.ins().postRedPoint()};Mine.prototype.openRobWin=function(){ViewManager.ins().open(MineRobWin,this.finishedData)};Mine.prototype.hasFinishedData=function(){return GameMap.sceneInMine()&&!MineFight.ins().isFighting&&this.finishedData};Mine.prototype.postRecordHasUpdate=function(bytes){this.hasNewRecord=true;Mine.ins().postRedPoint();return 1};Mine.prototype.postRoleInfo=function(bytes){var power=bytes.readDouble();return power};Mine.prototype.postMyMineTime=function(bytes){var time=bytes.readInt();if(time!=0){time=DateUtils.formatMiniDateTime(time)}this.mineStartTime=time;this.mineEndTime=DateUtils.formatMiniDateTime(bytes.readInt())};Mine.prototype.postApplyHelpRevenge=function(bytes){var result=bytes.readByte();var mes=bytes.readString();if(mes){UserTips.ins().showTips(mes||"")}};Mine.prototype.postHelpRevenge=function(bytes){var result=bytes.readByte();if(result==1)this.helpRevengeTimes--;var mes=bytes.readString();var hash=bytes.readInt();var fn=this._helpRevengeCB[hash];if(fn&&fn instanceof Function){this._helpRevengeCB[hash]=undefined;fn(result,mes)}};Mine.prototype.postHelpRevengeResult=function(bytes){var win=bytes.readByte();if(win==1){var kuangId=bytes.readInt();var rewards_4=GlobalConfig.KuangYuanConfig[kuangId].helpRevengeReward;TimerManager.ins().doTimer(800,1,function(){ResultManager.ins().create(UserFb.FB_ID_MINE,win,rewards_4,i18n("Mine_4"))},this)}else{TimerManager.ins().doTimer(800,1,function(){ResultManager.ins().create(UserFb.FB_ID_MINE,win)},this)}};Mine.prototype.sendIntoMine=function(){this.sendBaseProto(1)};Mine.prototype.sendRefresh=function(tp){if(tp===void 0){tp=0}var bytes=this.getBytes(2);bytes.writeShort(tp);this.sendToServer(bytes)};Mine.prototype.sendStart=function(){this.sendBaseProto(3)};Mine.prototype.sendGetAward=function(isDouble){if(isDouble===void 0){isDouble=false}var bytes=this.getBytes(5);bytes.writeShort(isDouble?1:0);this.sendToServer(bytes)};Mine.prototype.sendGetRecord=function(){this.sendBaseProto(6)};Mine.prototype.sendRob=function(data){this.robData=data;var actorId=data.actorID;var bytes=this.getBytes(7);bytes.writeInt(actorId);this.sendToServer(bytes)};Mine.prototype.sendFightBack=function(recordId,cb){var _this=this;var hash=0;if(cb&&cb instanceof Function){hash=this._revengeCB["length"]+1;this._revengeCB["length"]=hash;this._revengeCB[hash]=cb;setTimeout(function(){if(_this._revengeCB[hash]){_this._revengeCB[hash]=undefined;console.log("请求超时")}},1e4)}var bytes=this.getBytes(8);bytes.writeInt(recordId);bytes.writeInt(hash);this.sendToServer(bytes)};Mine.prototype.sendFightBackResult=function(win,index){var bytes=this.getBytes(10);bytes.writeInt(win?1:0);bytes.writeInt(index);this.sendToServer(bytes)};Mine.prototype.sendQuickFinish=function(){this.sendBaseProto(12)};Mine.prototype.sendRobResult=function(win,mineId,actorID){var bytes=this.getBytes(13);bytes.writeInt(win?1:0);this.sendToServer(bytes)};Mine.prototype.sendSceneChange=function(next){var bytes=this.getBytes(14);bytes.writeShort(next?1:0);this.sendToServer(bytes)};Mine.prototype.sendGetRolePower=function(roleId){var bytes=this.getBytes(17);bytes.writeInt(roleId);this.sendToServer(bytes)};Mine.prototype.sendApplyHelpRevenge=function(type,recordId,frendId){var bytes=this.getBytes(19);bytes.writeInt(type);bytes.writeInt(recordId);if(type==1){bytes.writeInt(frendId)}this.sendToServer(bytes);this._applyHelpRevengeTime=Math.floor(GameServer.serverTime/1e3)};Mine.prototype.nextApplyHelpRevengeTime=function(){var now=Math.floor(GameServer.serverTime/1e3);var t=GlobalConfig.CaiKuangConfig.helpRevengeCD+this._applyHelpRevengeTime-now;return t>0?t:0};Mine.prototype.sendHelpRevenge=function(applicantId,recordId,callback){var _this=this;var hash=0;if(callback){hash=this._helpRevengeCB["length"]+1;this._helpRevengeCB["length"]=hash;this._helpRevengeCB[hash]=callback;setTimeout(function(){if(_this._helpRevengeCB[hash]){_this._helpRevengeCB[hash]=undefined;console.log("请求超时")}},1e4)}var bytes=this.getBytes(20);bytes.writeInt(applicantId);bytes.writeInt(recordId);bytes.writeInt(hash);this.sendToServer(bytes)};Mine.prototype.sendHelpRevengeResult=function(win,applicantId,recordId){var bytes=this.getBytes(21);bytes.writeInt(win?1:0);bytes.writeInt(applicantId);bytes.writeInt(recordId);this.sendToServer(bytes)};return Mine}(BaseSystem);__reflect(Mine.prototype,"Mine");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.mine=Mine.ins.bind(Mine)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var MineData=function(_super){__extends(MineData,_super);function MineData(){var _this=_super.call(this)||this;_this.isShowTransfer=true;_this.mines=[];return _this}MineData.ins=function(){return _super.ins.call(this)};MineData.prototype.parser=function(bytes){this.index=bytes.readShort();this.isExitUp=!!bytes.readShort();this.isExitDown=!!bytes.readShort();var len=bytes.readShort();this.removeAll();for(var i=0;i<len;i++){this.mines[i]=ObjectPool.pop("MineModel");this.mines[i].parser(bytes);this.checkIsMyMine(this.mines[i]);this.updateMineConfig(this.mines[i])}this.resetRole();this.createTransfer();this.createEntity();this.showAwardWin()};MineData.prototype.showAwardWin=function(){if(Mine.ins().finishedData){ViewManager.ins().open(MineRobWin,Mine.ins().finishedData)}};MineData.prototype.resetRole=function(){EntityManager.ins().resetRole();var len=SubRoles.ins().subRolesLen;for(var i=1;i<len;i++){var data=SubRoles.ins().roles[i];var role=EntityManager.ins().getEntityByHandle(data.handle);if(role)role.visible=false}};MineData.prototype.createTransfer=function(){if(!this.isShowTransfer)return;var transPos=GlobalConfig.CaiKuangConfig.transPos;if(this.isExitUp){var transfer=EntityManager.ins().getTransferById(0);if(transfer){transfer.infoModel.index=this.index-1;transfer.updateModel()}else{this.addTransfer(0,this.index-1)}}else{EntityManager.ins().removeTransferById(0)}if(this.isExitDown){var transfer=EntityManager.ins().getTransferById(1);if(transfer){transfer.infoModel.index=this.index+1;transfer.updateModel()}else{this.addTransfer(1,this.index+1)}}else{EntityManager.ins().removeTransferById(1)}};MineData.prototype.showTransfer=function(b){this.isShowTransfer=b;if(b)this.createTransfer();else{EntityManager.ins().removeTransferById(0);EntityManager.ins().removeTransferById(1)}};MineData.prototype.addTransfer=function(configID,index){var transPos=GlobalConfig.CaiKuangConfig.transPos;var model=new TransferModel;model.configID=configID;model.index=index;var pos=transPos[model.configID];model.x=pos.x*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);model.y=pos.y*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);EntityManager.ins().createEntity(model)};MineData.prototype.createEntity=function(){for(var _i=0,_a=this.mines;_i<_a.length;_i++){var mine=_a[_i];GameLogic.ins().createEntityByModel(mine)}if(!TimerManager.ins().isExists(this.updateTime,this)){TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}};MineData.prototype.updateTime=function(){for(var _i=0,_a=this.mines;_i<_a.length;_i++){var mine=_a[_i];var char=EntityManager.ins().getMineByIndex(mine.index);if(char)char.updateTime()}};MineData.prototype.getMineByIndex=function(index,actorID){for(var _i=0,_a=this.mines;_i<_a.length;_i++){var mine=_a[_i];if(mine.index==index){if(!actorID||actorID==mine.actorID){return mine}return null}}};MineData.prototype.add=function(mine){this.remove(mine.index);MineData.ins().mines.push(mine);this.checkIsMyMine(mine);this.updateMineConfig(mine);GameLogic.ins().createEntityByModel(mine)};MineData.prototype.updateMineConfig=function(mine){var kuangPos=GlobalConfig.CaiKuangConfig.kuangPos;var pos=kuangPos[mine.index-1];mine.x=pos.x*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);mine.y=pos.y*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);mine.dir=pos.d};MineData.prototype.checkIsMyMine=function(mine){if(mine.actorID==Actor.actorID){this.myMine=mine.clone(this.myMine);Mine.ins().mineStartTime=this.myMine.startTime;Mine.ins().mineEndTime=this.myMine.endTime;return true}return false};MineData.prototype.getIsCanAtk=function(mine){if(mine.actorID==Actor.actorID){return false}if(!MineData.ins().getMineByIndex(mine.index,mine.actorID)){return false}if(mine.isBeFight){return false}if(mine.beFightActorID.length>=GlobalConfig.CaiKuangConfig.maxBeRobCount){return false}if(mine.beFightActorID.indexOf(Actor.actorID)>=0){return false}if(Mine.ins().robCount>=GlobalConfig.CaiKuangConfig.maxRobCount){return false}return true};MineData.prototype.remove=function(index){for(var i in this.mines){var mine=this.mines[i];if(mine.index==index){this.mines.splice(parseInt(i),1);EntityManager.ins().removeMineByIndex(index);break}}};MineData.prototype.removeAll=function(){while(this.mines.length){var mine=this.mines.pop();EntityManager.ins().removeMineByIndex(mine.index)}TimerManager.ins().removeAll(this)};return MineData}(BaseClass);__reflect(MineData.prototype,"MineData");var MineEnemyModel=function(){function MineEnemyModel(){this.subRole=[];this.hejiLvl=0;this.weiWang=0;this.shapeID=[-1,-1,-1]}MineEnemyModel.prototype.parser=function(bytes){this.lv=bytes.readShort();this.zsLv=bytes.readShort();this.name=bytes.readString();var count=bytes.readShort();for(var i=0;i<count;i++){var role=this.subRole[i]=new Role;role.parser(bytes);role.name=this.name}this.fireRing=this.fireRing||new OtherFireRingData;this.fireRing.parser(bytes);this.hejiLvl=bytes.readInt();this.weiWang=bytes.readInt();for(var i=0;i<3;i++){this.shapeID[i]=bytes.readInt()}MineFight.ins().createEnemy(this)};MineEnemyModel.prototype.getJobRoles=function(){var roles=[].concat(this.subRole);roles.sort(function(a,b){if(a.job<b.job){return-1}return 1});return roles};return MineEnemyModel}();__reflect(MineEnemyModel.prototype,"MineEnemyModel");var MineFight=function(_super){__extends(MineFight,_super);function MineFight(){var _this=_super.call(this)||this;_this.isFighting=0;_this.range=4;return _this}MineFight.ins=function(){return _super.ins.call(this)};MineFight.prototype.start=function(data){if(this.isFighting){return}this.isFighting=1;this.handles=[];this._data=data;var entityList=EntityManager.ins().getAllEntity();var role=EntityManager.ins().getNoDieRole();for(var handle in entityList){var info=entityList[handle].infoModel;if(!info)continue;if(data.type==0&&info.type==EntityType.Mine&&info.actorID==data.actorID){}else if(entityList[handle]!=role){entityList[handle].visible=false}}this.setShowUI(false);ShapeShiftingMgr.ins().postShapeEndClient(true,null);UserSkill.ins().setHejiCD(6e3);this.enemyPoints=this.getEnemyPoint();this.startPos={x:role.x,y:role.y};var dir=DirUtil.get8DirBy2Point(this.startPos,{x:GameMap.grip2Point(this.enemyPoints[0][0]),y:GameMap.grip2Point(this.enemyPoints[0][1])});for(var i=0;i<SubRoles.ins().subRolesLen;i++){var tar=EntityManager.ins().getJobMainRole(i);if(!tar){break}if(i==0){tar.x=this.startPos.x;tar.y=this.startPos.y}else{var grids=GameMap.getPosRangeRandom(this.startPos.x,this.startPos.y,DirUtil.dirOpposit(dir),i);tar.x=GameMap.grip2Point(grids[0]);tar.y=GameMap.grip2Point(grids[1])}tar.dir=dir;tar.visible=true;tar.AI_STATE=AI_State.Stand;this.playTransferEffect(tar);this.handles.push(tar.infoModel.handle);RoleAI.ins().add(tar)}GameLogic.ins().postMoveCamera()};MineFight.prototype.stop=function(){if(!this.isFighting)return;this.isFighting=0;this._model=null;HejiUseMgr.ins().unregister(this);TimerManager.ins().removeAll(this);var entityList=EntityManager.ins().getAllEntity();for(var handle in entityList){if(entityList[handle].infoModel&&entityList[handle].infoModel.type!=EntityType.Monster)entityList[handle].visible=true}for(var i=0;i<this.handles.length;i++){var handle=this.handles[i];EntityManager.ins().removeByHandle(handle)}this.resetRole();this.setShowUI(true);RoleAI.ins().stop();RoleAI.ins().clearAIList();if(GameMap.sceneInMine()&&Mine.ins().finishedData){ViewManager.ins().open(MineRobWin,Mine.ins().finishedData)}GameLogic.ins().postMoveCamera()};MineFight.prototype.resetRole=function(){MineData.ins().resetRole();var model=SubRoles.ins().getSubRoleByIndex(0);var tar=EntityManager.ins().getEntityByHandle(model.handle);tar.x=this.startPos.x;tar.y=this.startPos.y;tar.AI_STATE=AI_State.Stand};MineFight.prototype.fightEnd=function(win){if(win)this.fightWin();else this.fightFail()};MineFight.prototype.fightWin=function(){var _this=this;var id=this._data.id;var config=GlobalConfig.KuangYuanConfig[id];var awards=this.getAward(config);awards=this.getCountAward(awards);for(var _i=0,awards_1=awards;_i<awards_1.length;_i++){var award=awards_1[_i];if(award.type!=0){Encounter.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,award)}}var entityList=EntityManager.ins().getAllEntity();var _loop_24=function(handle){var info=entityList[handle].infoModel;if(!info)return"continue";if(this_18._data.type==0&&info.type==EntityType.Mine&&info.actorID==this_18._data.actorID){egret.Tween.get(entityList[handle]).to({alpha:0},1e3).call(function(){entityList[handle].visible=false;entityList[handle].alpha=1});return"break"}};var this_18=this;for(var handle in entityList){var state_2=_loop_24(handle);if(state_2==="break")break}var f=function(){_this.sendToServer(true);TimerManager.ins().doTimer(1e3,1,_this.stop,_this);var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var _i=0,mylist_7=mylist;_i<mylist_7.length;_i++){var char=mylist_7[_i];char.stopMove();if(!(char instanceof CharRole)){EntityManager.ins().removeByHandle(char.infoModel.handle)}else{_this.playTransferEffect(char)}}SoundUtil.ins().playEffect(SoundUtil.SCENE)};DropHelp.addCompleteFunc(f,this);DropHelp.start()};MineFight.prototype.fightFail=function(){var _this=this;this.sendToServer(false);Encounter.ins().postFightResult(0);TimerManager.ins().doTimer(2e3,1,function(){_this.stop()},this)};MineFight.prototype.sendToServer=function(win){if(this._data.type==0){Mine.ins().sendRobResult(win,this._data.id,this._data.actorID)}else if(this._data.type==1){Mine.ins().sendFightBackResult(win,this._data.index)}else if(this._data.type==2){Mine.ins().sendHelpRevengeResult(win,this._data.applicantId,this._data.index)}};MineFight.prototype.setShowUI=function(b){if(!GameMap.sceneInMine())return;MineData.ins().showTransfer(b);Mine.ins().postMineFightState(b?1:0)};MineFight.prototype.getRoles=function(){if(this._model){return this._model.subRole}return null};MineFight.prototype.getSkillLvl=function(){if(this._model){return this._model.hejiLvl}return 0};MineFight.prototype.getShapeInfo=function(){var info={};if(!this._model){return info}var shapeIds=this._model.shapeID;for(var i in shapeIds){var id=shapeIds[i];if(id>0){var handle=this._model.subRole[i].handle;if(handle){info[handle]=id}}}return info};MineFight.prototype.getIsWeiShe=function(selfTargetIsMy){if(!this._model)return false;var model=this._model;if(selfTargetIsMy){return Actor.weiWang>model.weiWang}else{return Actor.weiWang<model.weiWang}};MineFight.prototype.getWeiSheHurt=function(selfTargetIsMy){if(!this.getIsWeiShe(selfTargetIsMy))return 0;var rankList=Rank.ins().getRankModel(RankDataType.TYPE_WEIWANG);var name="";if(selfTargetIsMy){name=Actor.myName}else{name=this._model&&this._model.subRole[0].name}var rank=0;if(rankList){for(var i=0;i<3;i++){var data=rankList.getDataList(i);if(data&&data.player==name){rank=data.pos;break}}}return GlobalConfig.PrestigeBase.rankDeterDam[rank-1]||GlobalConfig.PrestigeBase.normalDeterDam};MineFight.prototype.createEnemy=function(model){this._model=model;var roles=model.getJobRoles();var mainRole=EntityManager.ins().getNoDieRole();HejiUseMgr.ins().register(this);for(var i=0;i<roles.length;i++){var role=roles[i];role.masterHandle=role.masterHandle*10;role.type=EntityType.Role;var grids=this.enemyPoints[i]||GameMap.getPosRangeRandom(mainRole.x,mainRole.y,mainRole.dir,this.range+i);if(!grids){role.x=mainRole.x;role.y=mainRole.y}else{role.x=GameMap.grip2Point(grids[0]);role.y=GameMap.grip2Point(grids[1])}role.dir=DirUtil.dirOpposit(mainRole.dir);var tar=GameLogic.ins().createEntityByModel(role,Team.WillEntity);tar.dir=DirUtil.dirOpposit(mainRole.dir);tar.AI_STATE=AI_State.Stand;tar.updateNeiGong();this.playTransferEffect(tar);this.handles.push(role.handle);RoleAI.ins().add(tar)}RoleAI.ins().start()};MineFight.prototype.playTransferEffect=function(char){var appearEff=new MovieClip;appearEff.playFile(RES_DIR_EFF+"jl_hd",1,function(){if(appearEff.parent){appearEff.parent.removeChild(appearEff)}});SkillEffPlayer.topLayer.addChild(appearEff);appearEff.x=char.x;appearEff.y=char.y;char.playAction(EntityAction.ATTACK)};MineFight.prototype.getAward=function(config){var rewards=config.rewards;var awards=[];var percent=config.robPrecent;for(var i=0;i<rewards.length;i++){var data=new RewardData;data.type=rewards[i].type;data.id=rewards[i].id;data.count=Math.ceil(rewards[i].count*percent/100);if(this._data.type==1){data.count*=2}awards.push(data)}return awards};MineFight.prototype.getCountAward=function(awards){var arr=[];for(var _i=0,awards_2=awards;_i<awards_2.length;_i++){var award=awards_2[_i];while(award.count>0){var data=new RewardData;data.type=award.type;data.id=award.id;data.count=award.count>10?10:award.count;arr.push(data);award.count-=10}}return arr};MineFight.prototype.getEnemyPoint=function(){var role=EntityManager.ins().getNoDieRole();var px=GameMap.point2Grip(role.x);var py=GameMap.point2Grip(role.y);var points=[];var maxDir=0;var maxCount=0;var isAdd=Math.random()>.5;for(var i=0;i<8;i++){var dir=isAdd?i:7-i;for(var range=this.range;range<this.range+3;range++){var arr=GameMap.getPosRangeByDir(px,py,dir,range);if(arr[2]){points[dir]=points[dir]||[];points[dir].push(arr)}}if(points[dir]&&points[dir].length>=3){return points[dir]}}for(var i=0;i<points.length;i++){if(points[i]&&points[i].length>maxCount){maxCount=points[i].length;maxDir=i}}return points[maxDir]};return MineFight}(BaseClass);__reflect(MineFight.prototype,"MineFight",["IHejiUse"]);var MineRecord=function(){function MineRecord(){}MineRecord.prototype.parser=function(bytes){this.index=bytes.readShort();this.type=bytes.readByte();this.time=DateUtils.formatMiniDateTime(bytes.readInt());if(this.type==MineRecord.TYPE_BEROB){this.configID=bytes.readByte();this.fighterActorID=bytes.readInt();this.fighterName=bytes.readString();this.fighterIsWin=bytes.readByte();this.isBeatHim=bytes.readByte();this.fighterJob=bytes.readByte();this.fighterSex=bytes.readByte();this.fighterPower=bytes.readInt()}else{this.configID=bytes.readByte();this.robActorID=bytes.readInt();this.robMasterName=bytes.readString();this.robIsWin=bytes.readByte()}};MineRecord.TYPE_BEROB=1;MineRecord.TYPE_ROB=2;return MineRecord}();__reflect(MineRecord.prototype,"MineRecord");var MineSceneUpdate;(function(MineSceneUpdate){MineSceneUpdate[MineSceneUpdate["fighting"]=1]="fighting";MineSceneUpdate[MineSceneUpdate["finished"]=2]="finished";MineSceneUpdate[MineSceneUpdate["addNew"]=3]="addNew";MineSceneUpdate[MineSceneUpdate["scene"]=4]="scene";MineSceneUpdate[MineSceneUpdate["updateMine"]=5]="updateMine";MineSceneUpdate[MineSceneUpdate["userInfo"]=6]="userInfo"})(MineSceneUpdate||(MineSceneUpdate={}));window["MineSceneUpdate"]=MineSceneUpdate;var MineSceneInfo=function(){function MineSceneInfo(){}MineSceneInfo.prototype.parser=function(bytes){this.index=bytes.readShort();this.type=bytes.readShort();if(this.type==MineSceneUpdate.fighting){this.state=bytes.readByte()}else if(this.type==MineSceneUpdate.addNew){this.mine=ObjectPool.pop("MineModel");this.mine.parser(bytes)}else if(this.type==MineSceneUpdate.scene){this.sceneIndex=bytes.readShort();this.isExitUp=!!bytes.readShort();this.isExitDown=!!bytes.readShort()}else if(this.type==MineSceneUpdate.updateMine){this.actorId=bytes.readInt()}else if(this.type==MineSceneUpdate.userInfo){this.mine=MineData.ins().getMineByIndex(this.index);if(this.mine)this.mine.parser(bytes)}};MineSceneInfo.prototype.handler=function(){if(this.type==MineSceneUpdate.fighting){var mine=MineData.ins().getMineByIndex(this.index);if(mine){mine.isBeFight=this.state==1;var char=EntityManager.ins().getMineByIndex(this.index);if(char)char.updateTitleState()}}else if(this.type==MineSceneUpdate.finished){MineData.ins().remove(this.index)}else if(this.type==MineSceneUpdate.addNew){MineData.ins().add(this.mine)}else if(this.type==MineSceneUpdate.scene){MineData.ins().isExitUp=this.isExitUp;MineData.ins().isExitDown=this.isExitDown;MineData.ins().index=this.sceneIndex;MineData.ins().createTransfer()}else if(this.type==MineSceneUpdate.updateMine){var mine=MineData.ins().getMineByIndex(this.index);if(mine){mine.beFightActorID.push(this.actorId);var char=EntityManager.ins().getMineByIndex(this.index);if(char)char.updateTitleState()}}else if(this.type==MineSceneUpdate.userInfo){var char=EntityManager.ins().getMineByIndex(this.index);if(char)char.updateModel()}};MineSceneInfo.prototype.destroy=function(){this.mine=null;ObjectPool.push(this)};return MineSceneInfo}();__reflect(MineSceneInfo.prototype,"MineSceneInfo");var MineChoseWorkerRender=function(_super){__extends(MineChoseWorkerRender,_super);function MineChoseWorkerRender(){var _this=_super.call(this)||this;_this.skinName="ChoseWorkerItemSkin";_this.reward.itemRenderer=ItemBase;return _this}MineChoseWorkerRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.nameTxt.text=data.name;this.nameTxt.textColor=data.color;var awards=[].concat(data.rewards);if(data.rewardItem&&data.rewardItem.length){awards=awards.concat(data.rewardItem);this.label.visible=true;this.noRobBg.visible=true}else{this.label.visible=false;this.noRobBg.visible=false}this.reward.dataProvider=new eui.ArrayCollection(awards);var npcConfig=GlobalConfig.NpcBaseConfig[data.npcId];this.worker.source=npcConfig.icon;if(data.id==(Mine.ins().mineId||1)){this.arrow.visible=true;this.selectedImg.visible=true}else{this.arrow.visible=false;this.selectedImg.visible=false}};return MineChoseWorkerRender}(BaseItemRender);__reflect(MineChoseWorkerRender.prototype,"MineChoseWorkerRender");var MineChoseWorkerWin=function(_super){__extends(MineChoseWorkerWin,_super);function MineChoseWorkerWin(){var _this=_super.call(this)||this;_this._cost=0;_this.skinName="ChoseWorkerSin";_this.isTopLevel=true;return _this}MineChoseWorkerWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};MineChoseWorkerWin.prototype.open=function(){this.observe(Mine.ins().postRefresh,this.update);this.addTouchEvent(this.advance,this.onTap);this.addTouchEvent(this.start,this.onTap);this.initList();this.update()};MineChoseWorkerWin.prototype.onTap=function(e){var _this=this;var target=e.currentTarget;if(target==this.advance){if(this.isMaxLevel()){UserTips.ins().showCenterTips(i18n("MineChoseWorkerWin_0"));return}var refurbish=this._cost==0||!this.checkBox.selected?2:1;if(this.checkBox.selected){var itemData=UserBag.ins().getBagItemById(GlobalConfig.CaiKuangConfig.needItem.id);if(!itemData||itemData.count<GlobalConfig.CaiKuangConfig.needItem.count){UserTips.ins().showTips(i18n("MineChoseWorkerWin_1"));return}}else{if(Actor.yb<this._cost){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("MineChoseWorkerWin_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("MineChoseWorkerWin_3"))}return}}Mine.ins().sendRefresh(refurbish)}else if(target==this.start){if(!this.isMaxLevel()){WarnWin.show(i18n("MineChoseWorkerWin_4"),function(){Mine.ins().sendStart();_this.checkBox.selected=false;ViewManager.ins().close(_this)},this);return}Mine.ins().sendStart();ViewManager.ins().close(this)}};MineChoseWorkerWin.prototype.initList=function(){var configs=GlobalConfig.KuangYuanConfig;var arr=[];for(var id in configs){arr.push(configs[id])}this.record.removeChildren();for(var _i=0,arr_6=arr;_i<arr_6.length;_i++){var d=arr_6[_i];var item=new MineChoseWorkerRender;item.data=d;this.record.addChild(item)}this.record.layout.updateDisplayList(this.record.width,this.record.height);this._lastMineId=Mine.ins().mineId};MineChoseWorkerWin.prototype.update=function(){var refreshCost=GlobalConfig.CaiKuangConfig.refreshCost;var len=refreshCost.length;var freshCount=Mine.ins().mineFreshCount;var cost=len<=freshCount?refreshCost[len-1]:refreshCost[freshCount];this._cost=cost;this.yuanbaoNum.text=""+cost;this.checkBox.visible=this.num1.visible=this.needlabel.visible=this.lbl1.visible=this.img1.visible=cost!=0;this.checkBox.selected=cost==0?false:this.checkBox.selected;var itemData=UserBag.ins().getBagItemById(GlobalConfig.CaiKuangConfig.needItem.id);var color=242004;if(!itemData||itemData.count<GlobalConfig.CaiKuangConfig.needItem.count){color=16711680}var count=itemData?itemData.count+"":"0";this.num1.textFlow=TextFlowMaker.generateTextFlow1(i18n("MineChoseWorkerWin_11",color,count));this.needlabel.text="/"+GlobalConfig.CaiKuangConfig.needItem.count;var addCount=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;var max=GlobalConfig.CaiKuangConfig.maxOpenKuangCount+addCount;var cur=Mine.ins().mineCount;if(cur>=max){this.countTxt.textFlow=TextFlowMaker.generateTextFlow1(i18n("MineChoseWorkerWin_5",max-cur,max))}else{this.countTxt.textFlow=TextFlowMaker.generateTextFlow1(i18n("MineChoseWorkerWin_6",max-cur,max))}if(Mine.ins().mineId){var config=GlobalConfig.KuangYuanConfig[Mine.ins().mineId];this.expBar0.maximum=config.maxTimes;this.expBar0.value=Math.ceil(config.maxTimes/config.baseTime*Mine.ins().mineQuaCount)}else{this.expBar0.maximum=10;this.expBar0.value=0}if(this.isMaxLevel()){this.expBar0.maximum=10;this.expBar0.value=0}if(this._lastMineId!=Mine.ins().mineId){for(var i=0,c=this.record.numChildren;i<c;++i){var item=this.record.getChildAt(i);item.data=item.data}this._lastMineId=Mine.ins().mineId}};MineChoseWorkerWin.prototype.isMaxLevel=function(){var next=Mine.ins().mineId+1;if(!GlobalConfig.KuangYuanConfig[next]){return true}return false};MineChoseWorkerWin.prototype.openCheck=function(){var addCount=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;if(Mine.ins().mineCount>=GlobalConfig.CaiKuangConfig.maxOpenKuangCount+addCount){UserTips.ins().showCenterTips(i18n("MineChoseWorkerWin_8"));return false}if(Mine.ins().mineStartTime){UserTips.ins().showCenterTips(i18n("MineChoseWorkerWin_9"));return false}return true};MineChoseWorkerWin.prototype.close=function(){};MineChoseWorkerWin.openCheck=function(){if(!Mine.ins().mineId){Mine.ins().sendRefresh()}if(MineData.ins().mines.length>=GlobalConfig.CaiKuangConfig.maxKuangCount){UserTips.ins().showCenterTips(i18n("MineChoseWorkerWin_10"));return false}return true};return MineChoseWorkerWin}(BaseEuiView);__reflect(MineChoseWorkerWin.prototype,"MineChoseWorkerWin");ViewManager.ins().reg(MineChoseWorkerWin,LayerManager.UI_Main);var MineDoneRecordRender=function(_super){__extends(MineDoneRecordRender,_super);function MineDoneRecordRender(){var _this=_super.call(this)||this;_this.skinName="DoneRecordItemSkin";return _this}MineDoneRecordRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var robName=this.data.name;var win=this.data.win;var config=GlobalConfig.KuangYuanConfig[Mine.ins().finishedData.configID];var color=config.color;if(win){this.des0.textFlow=TextFlowMaker.generateTextFlow1(i18n("MineDoneRecordRender_0",robName,color,config.name))}else{this.des0.textFlow=TextFlowMaker.generateTextFlow1(i18n("MineDoneRecordRender_1",robName,color,config.name))}};return MineDoneRecordRender}(BaseItemRender);__reflect(MineDoneRecordRender.prototype,"MineDoneRecordRender");var MineFriendRender=function(_super){__extends(MineFriendRender,_super);function MineFriendRender(){var _this=_super.call(this)||this;_this.skinName="MineFriendRenderSkin";return _this}MineFriendRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};MineFriendRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.sendBtn.enabled=data.online?true:false;this.label_name.text=data.name;this.label_lv.text=(data.zs>0?i18n("MineFriendRender_1",data.zs):"")+i18n("MineFriendRender_2",data.lv);if(data.online==1){this.label_lastLogin.text=i18n("MineFriendRender_3");this.label_lastLogin.textColor=2610714}else{this.label_lastLogin.text=DateUtils.getFormatBySecond(Math.max(data.offLineSec,60),4);this.label_lastLogin.textColor=16579836}var job=fixJob(data.job);var sex=fixSex(data.sex);this.img_userIcon.source="head_"+job+sex+(data.online==1?"":"b");this.headBg.source=ChatListItemRenderer.HEAD_BG[sex];this.sendBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.sendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};MineFriendRender.prototype.onTap=function(e){var data=this.data;switch(e.currentTarget){case this.sendBtn:var t=Mine.ins().nextApplyHelpRevengeTime();if(t){UserTips.ins().showTips(i18n("MineFriendRender_0",t))}else{Mine.ins().sendApplyHelpRevenge(1,MineFriendWin.data.index,data.id)}break}};return MineFriendRender}(BaseItemRender);__reflect(MineFriendRender.prototype,"MineFriendRender");var MineFriendWin=function(_super){__extends(MineFriendWin,_super);function MineFriendWin(){var _this=_super.call(this)||this;_this.skinName="MineFriendSkin";return _this}MineFriendWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.list.itemRenderer=MineFriendRender};MineFriendWin.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}if(!params[0]){this.close();return}MineFriendWin.data=params[0];this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(Friends.ins().postFriendChange,this.update);this.update()};MineFriendWin.prototype.update=function(){this.list.dataProvider=Friends.ins().friendsList};MineFriendWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:;case this.closeBtn:this.close();break}};MineFriendWin.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);ViewManager.ins().close(this)};return MineFriendWin}(BaseEuiView);__reflect(MineFriendWin.prototype,"MineFriendWin");ViewManager.ins().reg(MineFriendWin,LayerManager.UI_Popup);var MinePanel=function(_super){__extends(MinePanel,_super);function MinePanel(){return _super.call(this)||this}MinePanel.prototype.open=function(){this.addTouchEvent(this.go,this.onTap);this.observe(Mine.ins().postRedPoint,this.updateRedPoint);this.update()};MinePanel.prototype.update=function(){var addCount=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;var maxCount=GlobalConfig.CaiKuangConfig.maxOpenKuangCount+addCount;var curCount=Mine.ins().mineCount;this.workNum.text=i18n("MinePanel_0",maxCount-curCount,maxCount);var maxRobCount=GlobalConfig.CaiKuangConfig.maxRobCount;var curRobCount=Mine.ins().robCount;this.plunderNum.text=i18n("MinePanel_1",maxRobCount-curRobCount,maxRobCount);this.redPoint.visible=Mine.redpointCheck()};MinePanel.prototype.updateRedPoint=function(num){this.redPoint.visible=!!num};MinePanel.prototype.onTap=function(e){if(!UserFb.ins().checkInFB()){Mine.ins().sendIntoMine()}};return MinePanel}(BaseEuiView);__reflect(MinePanel.prototype,"MinePanel");var MineRecordRender=function(_super){__extends(MineRecordRender,_super);function MineRecordRender(){var _this=_super.call(this)||this;_this.skinName="PlunderRecordItemSkin";_this.revenge.textFlow=[{text:i18n("MineRecordRender_0"),style:{underline:true}}];_this.revenge0.textFlow=[{text:i18n("MineRecordRender_7"),style:{underline:true}}];return _this}MineRecordRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;var config=GlobalConfig.KuangYuanConfig[data.configID];var color=config.color;this.time.text=DateUtils.getFormatBySecond(data.time/1e3>>0,DateUtils.TIME_FORMAT_2);this.revenge.visible=false;this.revenge.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.revenge0.visible=false;this.revenge0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);if(data.type==MineRecord.TYPE_BEROB){if(data.fighterIsWin){this.des.textFlow=TextFlowMaker.generateTextFlow1(i18n("MineRecordRender_1",data.fighterName,color,config.name));this.revenge.visible=true;this.revenge0.visible=true;if(data.isBeatHim){this.revenge.textFlow=[{text:i18n("MineRecordRender_2")}];this.revenge.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.revenge0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.revenge0.visible=false}else{this.revenge.textFlow=[{text:i18n("MineRecordRender_3"),style:{underline:true}}];this.revenge.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.revenge0.visible=true;this.revenge0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)}}else{this.des.textFlow=TextFlowMaker.generateTextFlow1(i18n("MineRecordRender_4",data.fighterName,color,config.name))}}else{if(data.robIsWin){this.des.textFlow=TextFlowMaker.generateTextFlow1(i18n("MineRecordRender_5",data.robMasterName,color,config.name))}else{this.des.textFlow=TextFlowMaker.generateTextFlow1(i18n("MineRecordRender_6",data.robMasterName,color,config.name))}}};MineRecordRender.prototype.onTap=function(e){switch(e.currentTarget){case this.revenge:ViewManager.ins().open(MineRobWin,this.data);break;case this.revenge0:ViewManager.ins().open(MineReplaceRevengeWin,this.data);break}};return MineRecordRender}(BaseItemRender);__reflect(MineRecordRender.prototype,"MineRecordRender");var MineRecordWin=function(_super){__extends(MineRecordWin,_super);function MineRecordWin(){var _this=_super.call(this)||this;_this.skinName="PlunderRecordSkin";return _this}MineRecordWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.record.itemRenderer=MineRecordRender};MineRecordWin.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(Mine.ins().postMineRecord,this.update);Mine.ins().sendGetRecord();this.update()};MineRecordWin.prototype.update=function(){this.record.dataProvider=new eui.ArrayCollection(Mine.ins().mineRecords)};MineRecordWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:;case this.closeBtn:this.close();break}};MineRecordWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeObserve();ViewManager.ins().close(this)};return MineRecordWin}(BaseEuiView);__reflect(MineRecordWin.prototype,"MineRecordWin");ViewManager.ins().reg(MineRecordWin,LayerManager.UI_Popup);var MineReplaceRevengeWin=function(_super){__extends(MineReplaceRevengeWin,_super);function MineReplaceRevengeWin(){var _this=_super.call(this)||this;_this.skinName="MineReplaceRevengeSkin";_this.isTopLevel=true;return _this}MineReplaceRevengeWin.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this.data=params[0];this.desc.text=this.data.fighterName||"";this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.btnCannel,this.onTap);this.addTouchEvent(this.btnOk,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.tipGroup,this.onTap)};MineReplaceRevengeWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:;case this.closeBtn:;case this.tipGroup:this.close();break;case this.btnOk:if(!Guild.ins().isInGuild()){UserTips.ins().showTips(i18n("MineReplaceRevengeWin_2"));return}var t=Mine.ins().nextApplyHelpRevengeTime();if(t){UserTips.ins().showTips(i18n("MineReplaceRevengeWin_1",t))}else{Mine.ins().sendApplyHelpRevenge(0,this.data.index)}this.close();break;case this.btnCannel:ViewManager.ins().open(MineFriendWin,this.data);this.close();break}};MineReplaceRevengeWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.btnCannel,this.onTap);this.removeTouchEvent(this.btnOk,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.tipGroup,this.onTap);ViewManager.ins().close(this)};return MineReplaceRevengeWin}(BaseEuiView);__reflect(MineReplaceRevengeWin.prototype,"MineReplaceRevengeWin");ViewManager.ins().reg(MineReplaceRevengeWin,LayerManager.UI_Popup);var MineRobWin=function(_super){__extends(MineRobWin,_super);function MineRobWin(){var _this=_super.call(this)||this;_this._stateIndex=0;_this._states=["plunder","revenge","done","helpRevenge"];_this.skinName="HandleSkin";return _this}MineRobWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.robaward.itemRenderer=ItemBase;this.awardList.itemRenderer=ItemBase;this.recordList.itemRenderer=MineDoneRecordRender;this.helpRevengeReward.itemRenderer=ItemBase;this.addTouchEvent(this.handleBtn,this.onTap);this.addTouchEvent(this.double,this.onTap)};MineRobWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.observe(Mine.ins().postRoleInfo,this.updateInfo);this._data=param[0];this.update()};MineRobWin.prototype.updateInfo=function(power){if(this._stateIndex==0){this.power.text=""+power}else if(this._stateIndex==1){this.enemyPower.text=""+power}};MineRobWin.prototype.update=function(){if(this._data instanceof MineRecord){this._stateIndex=1;Mine.ins().sendGetRolePower(this._data.fighterActorID)}else if(this._data instanceof MineModel){this._stateIndex=0;Mine.ins().sendGetRolePower(this._data.actorID)}else if(this._data instanceof GuildMessageInfo){this._stateIndex=3;Mine.ins().sendGetRolePower(this._data.record.fighterActorID)}else if(this._data instanceof ChatData){this._stateIndex=3;Mine.ins().sendGetRolePower(this._data.data.fighterActorID)}else{this._stateIndex=2}this.currentState=this._states[this._stateIndex];var config;if(this._data instanceof GuildMessageInfo){config=GlobalConfig.KuangYuanConfig[this._data.record.configID]}else if(this._data instanceof ChatData){config=GlobalConfig.KuangYuanConfig[this._data.data.configID]}else{config=GlobalConfig.KuangYuanConfig[this._data.configID]}if(this._stateIndex==0){var data=this._data;this.Title.textColor=config.color;this.Title.text=i18n("MineRobWin_0",config.name);this.owner.text=data.name;this.power.text=data.power+"";this.gang.text=data.guildName||i18n("MineRobWin_1");var maxRobCount=GlobalConfig.CaiKuangConfig.maxRobCount;this.workNum.text=i18n("MineRobWin_2",maxRobCount-Mine.ins().robCount,maxRobCount);this.awardList.dataProvider=new eui.ArrayCollection(this.getAward(config))}else if(this._stateIndex==1){var data=this._data;this.enemy.text=data.fighterName;this.enemyPower.text=data.fighterPower+"";var job=fixJob(data.fighterJob);var sex=fixSex(data.fighterSex);this.myFace0.source="head_"+job+sex;this.time.text=DateUtils.getFormatBySecond(data.time/1e3>>0,DateUtils.TIME_FORMAT_2);this.robaward.dataProvider=new eui.ArrayCollection(this.getAward(config))}else if(this._stateIndex==2){this.getAwardTxt(config);var npcConfig=GlobalConfig.NpcBaseConfig[config.npcId];this.worker.source=npcConfig.icon;this.nameTxt.text=config.name;this.nameTxt.textColor=config.color;this.cost.text=GlobalConfig.CaiKuangConfig.doubleCost+"";if(Mine.ins().finishedData.beRob.length){this.noRob.visible=false}else{this.noRob.visible=true}this.recordList.dataProvider=new eui.ArrayCollection(Mine.ins().finishedData.beRob)}else if(this._stateIndex==3&&this._data instanceof GuildMessageInfo){var data=this._data;this.applicant.text=data.name;this.enemy.text=data.record.fighterName;this.enemyPower.text=data.record.fighterPower+"";var job=fixJob(data.record.fighterJob);var sex=fixSex(data.record.fighterSex);this.myFace0.source="head_"+job+sex;var maxHelpRevengeTimes=GlobalConfig.CaiKuangConfig.helpRevengeTimes;this.workNum2.text=i18n("MineRobWin_2",Mine.ins().helpRevengeTimes,maxHelpRevengeTimes);var r=this.getHelpAward(config);console.log("getHelpAward",r);this.helpRevengeReward.dataProvider=new eui.ArrayCollection(r)}else if(this._stateIndex==3&&this._data instanceof ChatData){var chatData=this._data;this.applicant.text=chatData.fromActor.name;this.enemy.text=chatData.data.fighterName;this.enemyPower.text=chatData.data.fighterPower+"";var job=fixJob(chatData.data.fighterJob);var sex=fixSex(chatData.data.fighterSex);this.myFace0.source="head_"+job+sex;var maxHelpRevengeTimes=GlobalConfig.CaiKuangConfig.helpRevengeTimes;this.workNum2.text=i18n("MineRobWin_2",Mine.ins().helpRevengeTimes,maxHelpRevengeTimes);var r=this.getHelpAward(config);console.log("getHelpAward",r);this.helpRevengeReward.dataProvider=new eui.ArrayCollection(r)}};MineRobWin.prototype.getAward=function(config){var rewards=config.rewards;var awards=[];var percent=config.robPrecent;for(var i=0;i<rewards.length;i++){var data=new RewardData;data.type=rewards[i].type;data.id=rewards[i].id;data.count=Math.ceil(rewards[i].count*percent/100);awards.push(data)}return awards};MineRobWin.prototype.getHelpAward=function(config){return[].concat(config.helpRevengeReward)};MineRobWin.prototype.getAwardTxt=function(config){var rewards=[].concat(config.rewards);if(config.rewardItem){rewards=rewards.concat(config.rewardItem)}var roberNum=0;for(var _i=0,_a=Mine.ins().finishedData.beRob;_i<_a.length;_i++){var obj=_a[_i];if(obj.win)roberNum+=1}var str1="";var str2="";for(var i=0;i<rewards.length;i++){if(rewards[i].type==0){str1+=RewardData.getCurrencyName(rewards[i].id)}else{var itemConfig=GlobalConfig.ItemConfig[rewards[i].id];str1+=itemConfig.name}str1+="x"+rewards[i].count+"\n";if(roberNum&&i<config.rewards.length){var robCount=Math.ceil(rewards[i].count*config.robPrecent/100)*roberNum;str2+="-"+robCount+"\n"}}this.reward.text=str1;this.minus.text=str2};MineRobWin.prototype.onTap=function(e){var _this=this;var target=e.currentTarget;if(target==this.bgClose||target==this.closeBtn){ViewManager.ins().close(this)}else if(target==this.handleBtn){if(this._stateIndex==1){var data_7=this._data;Mine.ins().sendFightBack(this._data.index,function(result,err){if(result)MineFight.ins().start({type:1,id:data_7.configID,index:data_7.index});else UserTips.ins().showTips(err)})}else if(this._stateIndex==0){if(!MineRobWin.openCheck(this._data)){return}Mine.ins().sendRob(this._data)}else if(this._stateIndex==3&&this._data instanceof GuildMessageInfo){var data_8=this._data;Mine.ins().sendHelpRevenge(data_8.roleId,data_8.record.index,function(result,err){if(result)MineFight.ins().start({type:2,id:data_8.record.configID,index:data_8.record.index,applicantId:data_8.roleId});else UserTips.ins().showTips(err)})}else if(this._stateIndex==3&&this._data instanceof ChatData){var data_9=this._data;Mine.ins().sendHelpRevenge(data_9.fromActor.id,data_9.data.index,function(result,err){if(result)MineFight.ins().start({type:2,id:data_9.data.configID,index:data_9.data.index,applicantId:data_9.fromActor.id});else UserTips.ins().showTips(err)})}else{Mine.ins().sendGetAward();Mine.ins().mineStartTime=0}ViewManager.ins().close(this);ViewManager.ins().close(MineRecordWin)}else if(target==this.double){Mine.ins().mineStartTime=0;if(Actor.yb<GlobalConfig.CaiKuangConfig.doubleCost){UserTips.ins().showTips(i18n("MineRobWin_3"),function(){ViewManager.ins().close(_this);UserFb.ins().sendExitFb()});return}Mine.ins().sendGetAward(true);ViewManager.ins().close(this);ViewManager.ins().close(MineRecordWin)}};MineRobWin.prototype.close=function(){};MineRobWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var info=param[0];if(info instanceof MineModel){if(info.actorID==Actor.actorID){return false}if(Mine.ins().robCount>=GlobalConfig.CaiKuangConfig.maxRobCount){UserTips.ins().showCenterTips(i18n("MineRobWin_5"));return false}if(info.beFightActorID.indexOf(Actor.actorID)>=0){UserTips.ins().showCenterTips(i18n("MineRobWin_6"));return false}if(!MineData.ins().getMineByIndex(info.index,info.actorID)){UserTips.ins().showCenterTips(i18n("MineRobWin_7"));return false}if(info.beFightActorID.length>=GlobalConfig.CaiKuangConfig.maxBeRobCount){UserTips.ins().showCenterTips(i18n("MineRobWin_8"));return false}if(info.isBeFight){UserTips.ins().showCenterTips(i18n("MineRobWin_9"));return false}}return true};return MineRobWin}(BaseEuiView);__reflect(MineRobWin.prototype,"MineRobWin");ViewManager.ins().reg(MineRobWin,LayerManager.UI_Popup);var MineScenePanel=function(_super){__extends(MineScenePanel,_super);function MineScenePanel(){var _this=_super.call(this)||this;_this.skinName="WaKuangFbSkin";return _this}MineScenePanel.prototype.open=function(){this.quickFinish.textFlow=[{text:i18n("MineScenePanel_0"),style:{underline:true}}];this.addTouchEvent(this.quickFinish,this.onTap);this.addTouchEvent(this.xiangqing,this.onTap);this.addTouchEvent(this.wakuang,this.onTap);this.observe(Mine.ins().postMineBaseInfo,this.updateBase);this.observe(Mine.ins().postInitScene,this.updateScene);this.observe(Mine.ins().postSceneUpdate,this.updateScene);this.observe(Mine.ins().postRecordHasUpdate,this.recordHasUpdate);this.observe(Mine.ins().postMineRecord,this.recordHasUpdate);this.observe(Mine.ins().postMineFightState,this.updateScene);this.observe(Mine.ins().postStartMine,this.MineRedPoint);this.observe(Mine.ins().postFinished,this.MineRedPoint);this.updateScene()};MineScenePanel.prototype.close=function(){TimerManager.ins().removeAll(this)};MineScenePanel.prototype.onTap=function(e){var target=e.currentTarget;if(target==this.quickFinish){this.openQuick()}else if(target==this.xiangqing){ViewManager.ins().open(MineRecordWin)}else if(target==this.wakuang){if(Mine.ins().hasFinishedData()){Mine.ins().openRobWin()}else{ViewManager.ins().open(MineChoseWorkerWin)}}};MineScenePanel.prototype.openQuick=function(){var sec=Math.floor((this._totalTime*1e3+Mine.ins().mineStartTime-GameServer.serverTime)/1e3);var min=Math.ceil(sec/60);var cost=GlobalConfig.CaiKuangConfig.quickCost*min;if(cost<=0)return;if(Actor.yb<cost){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("MineScenePanel_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("MineScenePanel_2"));return}var str=i18n("MineScenePanel_3",cost);WarnWin.show(str,function(){Mine.ins().sendQuickFinish()},this)};MineScenePanel.prototype.updateBase=function(){var myMine=MineData.ins().myMine;if(MineFight.ins().isFighting){this.recordGroup.visible=false}else{this.recordGroup.visible=true}this.wakuangGroup.visible=this.recordGroup.visible;if(!Mine.ins().isOverTime()&&myMine){this.myGroup.visible=true;var config=GlobalConfig.KuangYuanConfig[myMine.configID];this._totalTime=config.needTime;this.addTime()}else{this.removeTime();this.myGroup.visible=false}};MineScenePanel.prototype.updateScene=function(){var mineData=MineData.ins();this.nameTxt.text=i18n("MineScenePanel_4",mineData.index);this.workerNum.text=i18n("MineScenePanel_5",mineData.mines.length);this.recordHasUpdate(Mine.ins().hasNewRecord);this.MineRedPoint();this.updateBase()};MineScenePanel.prototype.recordHasUpdate=function(b){this.redPoint.visible=!!b};MineScenePanel.prototype.MineRedPoint=function(){var addCount=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;this.redPoint1.visible=Mine.ins().mineCount<GlobalConfig.CaiKuangConfig.maxOpenKuangCount+addCount&&Mine.ins().isOverTime()};MineScenePanel.prototype.addTime=function(){if(!TimerManager.ins().isExists(this.timeHandler,this)){TimerManager.ins().doTimer(1e3,0,this.timeHandler,this)}};MineScenePanel.prototype.timeHandler=function(){var sec=Math.floor((Mine.ins().mineEndTime-GameServer.serverTime)/1e3);if(sec>=0){this.time.text="（"+DateUtils.getFormatBySecond(sec,DateUtils.TIME_FORMAT_3)+"）"}};MineScenePanel.prototype.removeTime=function(){TimerManager.ins().remove(this.timeHandler,this)};return MineScenePanel}(BaseEuiView);__reflect(MineScenePanel.prototype,"MineScenePanel");ViewManager.ins().reg(MineScenePanel,LayerManager.UI_Main);var MoveCC=function(_super){__extends(MoveCC,_super);function MoveCC(){var _this=_super.call(this)||this;_this.observe(MapView.onGridClick,_this.mapClick);_this.observe(MapView.moveComplete,_this.touchTarget);return _this}MoveCC.prototype.findTargetEntity=function(x,y){var entityList=EntityManager.ins().getAllEntity();for(var i in entityList){var entity=entityList[i];var type=entity.infoModel.type;if(type==EntityType.DropItem){var dis=calc_distance_point_to_point({x:x,y:y},{x:entity.x,y:entity.y});if(dis<50){return entity}}}return null};MoveCC.prototype.mapClick=function(_a){var target=_a.target,x=_a.x,y=_a.y;if(KfArenaSys.ins().isKFArena&&KfArenaSys.ins().getReadyTime()>0){return}if(!GameMap.sceneInMine()&&!TargetListCC.ins().isShow)return;if(BattleCC.ins().isBattle()&&!BattleCC.ins().canMove())return;if((GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss)&&!GwBoss.ins().canMove())return;if(DarkMjBoss.ins().isDarkBoss)return;this.findTarget=target;if(BattleGround.ins().isPaoDian){var t=this.findTargetEntity(x,y);if(t){this.findTarget=t}}var role=EntityManager.ins().getNoDieRole();if(role==null||role.isHardStraight)return;if(CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss)CityCC.ins().sendStopAI();if(BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||BattleGround.ins().isPaoDian||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena)GameLogic.ins().stopAI();if(target&&target.infoModel){if(target.infoModel.type==EntityType.Npc||target.infoModel.type==EntityType.Mine){var pos=GameMap.getPosRangeRandom(target.x,target.y,DirUtil.get8DirBy2Point(target,role));x=pos[0]*GameMap.CELL_SIZE+Math.floor(MathUtils.limit(.2,1)*GameMap.CELL_SIZE);y=pos[1]*GameMap.CELL_SIZE+Math.floor(MathUtils.limit(.2,1)*GameMap.CELL_SIZE)}}if(GameMap.sceneInMine()){if(!GameMap.checkWalkable(Math.floor(x/GameMap.CELL_SIZE),Math.floor(y/GameMap.CELL_SIZE))){return}}GameMap.moveTo(x,y)};MoveCC.prototype.touchTarget=function(e){if(BattleGround.ins().isPaoDian){if(this.findTarget&&this.findTarget.infoModel){var infoModel=this.findTarget.infoModel;if(infoModel.type==EntityType.DropItem){console.log("捡到道具了~");GameLogic.ins().postChangeAttrPoint(infoModel.handle)}}}if(e.team!=Team.My)return;if(this.findTarget&&this.findTarget.infoModel){if(this.findTarget.infoModel.type==EntityType.Npc){var role=EntityManager.ins().getNoDieRole();if(role==null||role.isHardStraight)return;var size=GameMap.CELL_SIZE;var tx=SysSetting.ins().getValue("mapClickTx")*size;var ty=SysSetting.ins().getValue("mapClickTy")*size;if(Math.abs(role.x-tx)<=size&&Math.abs(role.y-ty)<=size){if(Mine.ins().hasFinishedData()){Mine.ins().openRobWin()}else{var config=GlobalConfig.NpcBaseConfig[this.findTarget.infoModel.configID];var control=config.controlTarget;if(control&&control[0])ViewManager.ins().open(control[0])}}else return}else if(this.findTarget.infoModel.type==EntityType.Mine){ViewManager.ins().open(MineRobWin,this.findTarget.infoModel)}else if(this.findTarget.infoModel.type==EntityType.Transfer){if(GameMap.sceneInMine()){Mine.ins().sendSceneChange(this.findTarget.infoModel.configID)}}}if(this.findTarget&&this.findTarget.parent&&this.findTarget.parent instanceof TransferNameHead){if(GameMap.sceneInMine()){var configID=this.findTarget.parent.configID;if(configID>-1){Mine.ins().sendSceneChange(configID);console.log("MoveCC sendSceneChange this.findTarget.infoModel.configID = "+configID)}}}this.findTarget=null};return MoveCC}(BaseSystem);__reflect(MoveCC.prototype,"MoveCC");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.movecc=MoveCC.ins.bind(MoveCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var NeiGong=function(_super){__extends(NeiGong,_super);function NeiGong(){var _this=_super.call(this)||this;_this.isActList={};_this.isShow=false;_this.ngList={};_this.sysId=PackageID.NeiGong;_this.regNetMsg(1,_this.postNeiGongDataChange);_this.regNetMsg(3,_this.postNeiGongAct);return _this}NeiGong.ins=function(){return _super.ins.call(this)};NeiGong.prototype.postNeiGongDataChange=function(bytes){var roleId=bytes.readShort();if(!NeiGongModel.ins().neiGongList[roleId]){NeiGongModel.ins().neiGongList[roleId]=new NeiGongData}var data=NeiGongModel.ins().neiGongList[roleId];data.roleId=roleId;data.parse(bytes);var neigongAct=bytes.readBoolean();if(!this.isActList[roleId])this.isActList[roleId]={};this.isActList[roleId].act=neigongAct?1:0;this.ngList[roleId]=neigongAct?1:0};NeiGong.prototype.postNeiGongAct=function(bytes){var roleId=bytes.readShort();var act=bytes.readInt();this.ngList[roleId]=act;this.isActList[roleId].isShow=false;if(this.isActList[roleId].act==0&&act==1){this.isActList[roleId].isShow=true}this.isActList[roleId].act=act};NeiGong.prototype.sendNeiGongUpLevel=function(id){var bytes=this.getBytes(1);bytes.writeShort(id);this.sendToServer(bytes)};NeiGong.prototype.sendNeiGongUpStage=function(id){var bytes=this.getBytes(2);bytes.writeShort(id);this.sendToServer(bytes)};NeiGong.prototype.sendNeiGongAct=function(id){var bytes=this.getBytes(3);bytes.writeShort(id);this.sendToServer(bytes)};return NeiGong}(BaseSystem);__reflect(NeiGong.prototype,"NeiGong");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.neigong=NeiGong.ins.bind(NeiGong)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var NeiGongModel=function(_super){__extends(NeiGongModel,_super);function NeiGongModel(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.neiGongList=[];return _this}NeiGongModel.ins=function(){return _super.ins.call(this)};NeiGongModel.prototype.canUp=function(){if(UserFb.ins().guanqiaID<GlobalConfig.NeiGongBaseConfig.openGuanqia)return false;var len=Math.min(SubRoles.ins().subRolesLen,this.neiGongList.length);for(var i=0;i<len;i++){if(this.canUpById(i))return true}return false};NeiGongModel.prototype.canUpById=function(id){if(this.neiGongList[id]){if(UserFb.ins().guanqiaID<=GlobalConfig.NeiGongBaseConfig.openGuanqia)return false;if(this.neiGongList[id].stage>=GlobalConfig.NeiGongBaseConfig.maxStage)return false;if(this.neiGongList[id].canMix||this.neiGongList[id].getCanLevelUp())return true}return false};return NeiGongModel}(BaseClass);__reflect(NeiGongModel.prototype,"NeiGongModel");var NeiGongData=function(){function NeiGongData(){this.roleId=0;this.level=0;this.stage=0;this.exp=0}NeiGongData.prototype.parse=function(bytes){this.level=bytes.readInt();this.stage=bytes.readInt();this.exp=bytes.readInt();var cruLevelCfg=GlobalConfig.NeiGongStageConfig[this.stage][this.level];this.canMix=this.level>0&&this.level%GlobalConfig.NeiGongBaseConfig.levelPerStage==0};NeiGongData.prototype.getCanLevelUp=function(){var cruLevelCfg=GlobalConfig.NeiGongStageConfig[this.stage][this.level];if(!cruLevelCfg)return false;var difexp=cruLevelCfg.totalExp-this.exp;var count=Math.ceil(difexp/cruLevelCfg.addExp);return Actor.gold>=count*cruLevelCfg.costMoney&&Actor.gold>=1e6};return NeiGongData}();__reflect(NeiGongData.prototype,"NeiGongData");var NeiGongWin=function(_super){__extends(NeiGongWin,_super);function NeiGongWin(){var _this=_super.call(this)||this;_this.curRole=0;_this.canUp=false;_this.isLights=[];_this.effs={};_this.starPoint=[];_this.isNext=false;_this.isAutoUp=false;_this.signLevel=0;_this.mcPos=[[52,77,0],[47,55,18],[55,30,36],[75,12,54],[110,0,72],[75,15,108],[100,30,126],[110,60,144],[100,90,162],[85,120,180]];_this.toHeight=0;_this.mcWidth=160;_this.mcHeight=160;_this._currHeight=0;return _this}NeiGongWin.prototype.childrenCreated=function(){this.init()};NeiGongWin.prototype.init=function(){this.upLevelMc=new MovieClip;this.stageImg=BitmapNumber.ins().createNumPic(0,"ng0");this.stageImg.x=25;this.stageImg.y=12;this.stageGroup.addChild(this.stageImg);this._shap=new egret.Shape;this.lineGroup.addChild(this._shap);this.lineBg.mask=this._shap;this._shap.x=this._shap.y=this.lineGroup.width>>1;this._shap.rotation=-196;this.circleMc=new MovieClip1;this.circleMc.x=80;this.circleMc.y=75;this.mcGroup.addChild(this.circleMc);this.moveInMc=new MovieClip;this.moveInMc.x=70;this.moveInMc.y=65;this.ball.addChild(this.moveInMc);this.stageMc=new MovieClip;this.stageMc.x=52;this.stageMc.y=32;this.stageGroup.addChild(this.stageMc);this._ballShap=new egret.Shape;this.mcGroup.addChild(this._ballShap);var temp=NeiGongModel.ins().neiGongList[this.curRole];var level=temp?temp.level:0;for(var i=0;i<10;i++){var point=new egret.Point(this["eff_"+i].x,this["eff_"+i].y);this.starPoint[i]=point;this.isLights[i]=i<level}this.eff=new MovieClip;this.eff.x=this.UplevelBtn0.x+this.UplevelBtn0.width/2;this.eff.y=this.UplevelBtn0.y+this.UplevelBtn0.height/2;this.eff.scaleX=1.15;this.eff.scaleY=1;this.eff.touchEnabled=false};NeiGongWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curRole=param[0];this.lastLevel=-1;this.circleMc.playFile(RES_DIR_EFF+"neigongzhongjianeff",-1);if(!this.moveInMc.parent)this.ball.addChild(this.moveInMc);this.circleMc.mask=this._ballShap;this.addTouchEvent(this.upBtn,this.onClick);this.addTouchEvent(this.mixBtn,this.onClick);this.addTouchEvent(this.oneKeyUp,this.onClick);this.addTouchEvent(this.UplevelBtn0,this.onClick);this.observe(NeiGong.ins().postNeiGongDataChange,this.refushPanelInfo);this.observe(Actor.ins().postLevelChange,this.setBtnStatuBarinfo);this.observe(NeiGong.ins().postNeiGongAct,this.showActPanel);this.refushPanelInfo(true);this.showActPanel();this.stopAutoUp()};NeiGongWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();this.removeTouchEvent(this.upBtn,this.onClick);this.removeTouchEvent(this.mixBtn,this.onClick);this.removeTouchEvent(this.oneKeyUp,this.onClick);this.seteffectPost();for(var i in this.effs){DisplayUtils.removeFromParent(this.effs[i]);if(this.effs[i])egret.Tween.removeTweens(this.effs[i])}DisplayUtils.removeFromParent(this.eff);this.stopAutoUp()};NeiGongWin.openCheck=function(){var openLevel=GlobalConfig.NeiGongBaseConfig.openLevel;if(Actor.level<openLevel){UserTips.ins().showTips(i18n("NeiGongWin_0",openLevel));return false}return true};NeiGongWin.prototype.showActPanel=function(){if(NeiGong.ins().isActList[this.curRole].isShow){NeiGong.ins().isActList[this.curRole].isShow=false;RewardWin.showAct(0,i18n("NeiGongWin_1"),"",false,null,"","","","neigongzhongjianeff");var role=EntityManager.ins().getMainRole(this.curRole);if(role)role.updateNeiGong()}this.showAct.visible=NeiGong.ins().ngList[this.curRole]>0;this.btnGroup.visible=NeiGong.ins().ngList[this.curRole]>0;if(!this.showAct.visible){this.Activation.visible=true;this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.eff.parent)this.UplevelBtn0.parent.addChild(this.eff)}else{this.Activation.visible=false;DisplayUtils.removeFromParent(this.eff)}var openGuanqia=GlobalConfig.NeiGongBaseConfig.openGuanqia;if(UserFb.ins().guanqiaID<=openGuanqia){this.redPointAct0.visible=false}this.activeTipsTxt0.text=i18n("NeiGongWin_2",openGuanqia+1)};NeiGongWin.prototype.onChange=function(){this.stopAutoUp();this.refushPanelInfo()};NeiGongWin.prototype.refushPanelInfo=function(init){this.data=NeiGongModel.ins().neiGongList[this.curRole];if(!this.data){return}this.cruLevelCfg=GlobalConfig.NeiGongStageConfig[this.data.stage][this.data.level];if(!this.cruLevelCfg){return}if(this.lastLevel!=this.data.level){this.effectShow(init)}this.lastLevel=this.data.level;this.setAttrCost();this.setPowerShow();this.setBtnStatuBarinfo();this.seteffectPost()};NeiGongWin.prototype.setPowerShow=function(){this._totalPower=UserBag.getAttrPower(this.cruLevelCfg.attribute);this.powerPanel.setPower(this._totalPower)};NeiGongWin.prototype.setAttrCost=function(){this.stageImg.x=this.data.stage<10?40:25;BitmapNumber.ins().changeNum(this.stageImg,this.data.stage,"ng0");var cost=0;var discount=GlobalConfig.MonthCardConfig.neiGongGoldPrecent/100;var addValue=Recharge.ins().getIsForeve()?1-discount:1;if(!this.data.canMix){cost=Math.floor(this.cruLevelCfg.costMoney*addValue)}var colorStr="";if(Actor.gold>=cost)colorStr=i18n("NeiGongWin_8");else colorStr=i18n("NeiGongWin_9");this.canUp=Actor.gold>=cost;this.costlable.textFlow=TextFlowMaker.generateTextFlow(colorStr+cost);var attrList=this.cruLevelCfg.attribute;attrList.sort(AttributeData.sortAttribute);var len=attrList.length;for(var i=0;i<3;i++){this["attr"+i].text=len>i?AttributeData.getAttStrByType(attrList[i],1):""}var nextStage=0;var nextLevel=0;if(this.data.level==GlobalConfig.NeiGongBaseConfig.levelPerStage){nextStage=this.data.stage+1;nextLevel=0}else{nextStage=this.data.stage;nextLevel=this.data.level+1}var cfgList=GlobalConfig.NeiGongStageConfig[nextStage];var nextConfig=cfgList?cfgList[nextLevel]:null;if(nextConfig){var str="";var addList=nextConfig.attribute;addList.sort(AttributeData.sortAttribute);for(var i=0;i<3;i++){if(len>i){var attr=attrList[i];str=this.getAttrByType(addList,attr)}this["addAttr"+i].text=str;this["arrow"+i].visible=str!=""}this.isNext=true}else{for(var i=0;i<3;i++){this["addAttr"+i].text="";this["arrow"+i].visible=false}this.isNext=false}};NeiGongWin.prototype.effectShow=function(init){var len=this.data.level;for(var i=0;i<10;i++){this["point_"+i].source=i>=len?"neigongzhuzi2":"neigongzhuzi1"}if(len>0)DisplayUtils.drawCir(this._shap,(this.lineGroup.width>>1)+2,(len-1)*(180+32)/9);else this._shap.graphics.clear();for(var i in this.effs){DisplayUtils.removeFromParent(this.effs[i]);this.effs[i]=null}if(init){var temp=NeiGongModel.ins().neiGongList[this.curRole];var level=temp?temp.level:0;for(var i=0;i<10;i++){this.isLights[i]=i<level}}for(var i=0;i<len;i++){var mc=this.effs[i]||new MovieClip;mc.x=1;mc.y=30;mc.scaleX=1;mc.scaleY=1;this.effs[i]=mc;this["eff_"+i].addChild(mc);if(!this.isLights[i]){this.isLights[i]=true;this.moveEffectOut(i)}else{mc.playFile(RES_DIR_EFF+"feishengfire",-1)}}};NeiGongWin.prototype.setBtnStatuBarinfo=function(){var flag=this.data.canMix;this.upBtn.visible=!flag&&this.isNext;this.oneKeyUp.visible=!flag&&this.isNext;this.mixBtn.visible=flag;this.redPoint1.visible=false;this.redPoint0.visible=false;this.costInfo.visible=!flag&&this.isNext;this.maxDesc.visible=!this.isNext;if(flag){this.expLabel.text="";this.upDataExpMcBall(this.cruLevelCfg.totalExp,this.cruLevelCfg.totalExp)}else{if(this.cruLevelCfg){this.upDataExpMcBall(this.data.exp,this.cruLevelCfg.totalExp);this.expLabel.text=this.data.exp+"/"+this.cruLevelCfg.totalExp}}};NeiGongWin.prototype.onClick=function(e){var _this=this;if(!this.isNext){UserTips.ins().showTips(i18n("NeiGongWin_3"));return}switch(e.target){case this.upBtn:if(this.canUp){NeiGong.ins().sendNeiGongUpLevel(this.curRole);SoundUtil.ins().playEffect(SoundUtil.SKILL_UP)}else{if(!Shop.openBuyGoldWin(false)){UserTips.ins().showTips(i18n("NeiGongWin_4"))}}break;case this.mixBtn:this.moveEffectIn();TimerManager.ins().doTimer(400,1,function(){NeiGong.ins().sendNeiGongUpStage(_this.curRole);SoundUtil.ins().playEffect(SoundUtil.SKILL_UP)},this);break;case this.oneKeyUp:if(this.isAutoUp){this.stopAutoUp()}else{if(!this.canUp){if(!Shop.openBuyGoldWin(false)){UserTips.ins().showTips(i18n("NeiGongWin_5"))}return}this.isAutoUp=true;this.oneKeyUp.label=i18n("NeiGongWin_6");TimerManager.ins().doTimer(300,0,this.autoUpStar,this)}break;case this.UplevelBtn0:NeiGong.ins().sendNeiGongAct(this.curRole);break}};NeiGongWin.prototype.stopAutoUp=function(){this.isAutoUp=false;if(this.oneKeyUp)this.oneKeyUp.label=i18n("NeiGongWin_7");TimerManager.ins().remove(this.autoUpStar,this)};NeiGongWin.prototype.autoUpStar=function(){if(this.canUp&&this.data.canMix==false&&this.isNext){NeiGong.ins().sendNeiGongUpLevel(this.curRole);SoundUtil.ins().playEffect(SoundUtil.SKILL_UP)}else{this.stopAutoUp()}};NeiGongWin.prototype.moveEffectOut=function(id){var _this=this;var tt=egret.Tween.get(this["eff_9"]);tt.call(function(){_this.moveInMc.playFile(RES_DIR_EFF+"neigongbaozhaeff",1,null,false)},this).wait(100).call(function(){DisplayUtils.removeFromParent(_this.upLevelMc);_this.ball.addChild(_this.upLevelMc);_this.upLevelMc.x=_this.mcPos[id][0];_this.upLevelMc.y=_this.mcPos[id][1];_this.upLevelMc.rotation=_this.mcPos[id][2];_this.upLevelMc.playFile(RES_DIR_EFF+"piaodongqipaohuang",1,function(){if(_this.effs[id])_this.effs[id].playFile(RES_DIR_EFF+"feishengfire",-1);var len=_this.data.level;for(var i=0;i<10;i++){_this["point_"+i].source=i>=len?"neigongzhuzi2":"neigongzhuzi1"}if(len>0)DisplayUtils.drawCir(_this._shap,(_this.lineGroup.width>>1)+2,(len-1)*(180+32)/9);else _this._shap.graphics.clear()},true)},this)};NeiGongWin.prototype.moveEffectIn=function(){var _this=this;for(var i in this.effs){var t=egret.Tween.get(this["eff_"+i]);t.to({x:280,y:320,scaleX:1,scaleY:1},390).to({alpha:0},10)}for(var i=0;i<10;i++){this.isLights[i]=false}var tt=egret.Tween.get(this["eff_9"]);tt.wait(400).call(function(){_this.moveInMc.playFile(RES_DIR_EFF+"neigongbaozhaeff",1,null,false)},this).call(function(){if(!_this.stageMc.parent)_this.stageGroup.addChild(_this.stageMc);_this.stageMc.playFile(RES_DIR_EFF+"neigongshengjieff",1,function(){DisplayUtils.removeFromParent(_this.stageMc)})},this);for(var i=0;i<10;i++){this["point_"+i].source="neigongzhuzi2"}};NeiGongWin.prototype.getAttrByType=function(attrs,attr){var len=attrs.length;for(var i=0;i<len;i++){if(attrs[i].type==attr.type&&attrs[i].value!=attr.value){return" "+AttributeData.getAttStrByType(attrs[i],1,"",false,false)}}return""};NeiGongWin.prototype.seteffectPost=function(){var len=this.data?this.data.level:0;for(var i=0;i<10;i++){var point=this.starPoint[i];if(point){this["eff_"+i].x=i<len?point.x:280;this["eff_"+i].y=i<len?point.y:320;this["eff_"+i].scaleX=1;this["eff_"+i].scaleY=1;this["eff_"+i].alpha=1}}};NeiGongWin.prototype.upDataExpMcBall=function(value,total){DisplayUtils.drawrect(this._ballShap,this.mcWidth,this.mcHeight);this.toHeight=this.mcHeight*(value/total);this.currHeight=this.toHeight>=this.mcHeight?this.mcHeight:this.toHeight};Object.defineProperty(NeiGongWin.prototype,"currHeight",{get:function(){return this._currHeight},set:function(value){this._currHeight=value;var y=this.mcHeight-Math.floor(this._currHeight);var t=egret.Tween.get(this._ballShap);t.to({y:y},200).call(function(){},this)},enumerable:true,configurable:true});NeiGongWin.prototype.destoryView=function(){};return NeiGongWin}(BaseView);__reflect(NeiGongWin.prototype,"NeiGongWin");var newBoxWin=function(_super){__extends(newBoxWin,_super);function newBoxWin(){var _this=_super.call(this)||this;_this.isSendUse=false;_this.skinName="newBoxSkin";_this.time=10;return _this}newBoxWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.visible=false;this.removeTouchEvent(this.go,this.onEvent);TimerManager.ins().remove(this.updateTime,this);this.removeObserve()};newBoxWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.visible=true;this.tick=this.time;this.itemId=param[0];this.itemicon.data=this.itemId;this.itemdata=UserBag.ins().getBagItemById(this.itemId);this.removeTouchEvent(this.go,this.onEvent);this.addTouchEvent(this.go,this.onEvent);this.itemLbl.text=i18n("newBoxWin_0",this.time);if(!TimerManager.ins().isExists(this.updateTime,this)){this.tick=this.time;TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}this.observe(UserBag.ins().postUseItemSuccess,this.useSuccessShow)};newBoxWin.prototype.onEvent=function(e){switch(e.target){case this.go:this.sendUse();break}};newBoxWin.prototype.sendUse=function(){if(this.itemId){UserBag.ins().sendUseItem(this.itemId,1);this.isSendUse=true;this.checkIsDressBox()}};newBoxWin.prototype.checkIsDressBox=function(){var itemConfig=GlobalConfig.ItemConfig[this.itemId];var subType=ItemConfig.getSubType(itemConfig);if(subType==1){ViewManager.ins().open(DressTryTipsWin);ViewManager.ins().close(newPlayerChapterGiftWin)}};newBoxWin.prototype.useSuccessShow=function(){if(this.itemId>0&&this.isSendUse){this.isSendUse=false;this.close()}};newBoxWin.prototype.updateTime=function(){if(this.tick<=0){UserBag.ins().sendUseItem(this.itemId,1);this.checkIsDressBox();this.close();return}this.itemLbl.text=i18n("newBoxWin_0",this.tick);this.tick--};return newBoxWin}(BaseEuiView);__reflect(newBoxWin.prototype,"newBoxWin");ViewManager.ins().reg(newBoxWin,LayerManager.UI_Popup);var NewEquip=function(_super){__extends(NewEquip,_super);function NewEquip(){var _this=_super.call(this)||this;_this.equipsList=[[],[],[],[],[]];return _this}NewEquip.ins=function(){return _super.ins.call(this)};NewEquip.prototype.check=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.NEWEQUIP)){return false}return true};NewEquip.prototype.callBack=function(){};NewEquip.prototype.isAddItem=function(newItem){if(newItem&&NewEquip.notShowEquipIDs&&NewEquip.notShowEquipIDs.length>0){for(var idx in NewEquip.notShowEquipIDs){if(NewEquip.notShowEquipIDs[idx]==newItem._configID){return false}}}return true};NewEquip.prototype.addItem=function(newItem){if(!newItem)return;if(!this.check())return;if(!this.isAddItem(newItem))return;var newPos=ItemConfig.getSubType(newItem.itemConfig);var newJob=ItemConfig.getJob(newItem.itemConfig);var role=SubRoles.ins().getSubRoleByJob(newJob);if(!role||role.job!=newJob)return;if(UserZs.ins().lv>=(newItem.itemConfig.zsLevel||0)&&Actor.level>=(newItem.itemConfig.level||1)){}else{UserTips.ins().showTips(i18n("NewEquip_0"));return}var isInList=false;if(newJob>=this.equipsList.length){var dis=newJob-this.equipsList.length+1;for(var i=dis;i>0;--i){this.equipsList.push([]);if(newJob<this.equipsList.length)break}}var role_equipsList=this.equipsList[newJob];for(var i=0;i<role_equipsList.length;i++){var curItem=role_equipsList[i];var pos=ItemConfig.getSubType(curItem.itemConfig);if(i==0&&newPos==pos){if(newPos==pos){isInList=true;if(this.compareEquip(curItem,newItem)){role_equipsList.push(newItem)}break}}else{if(newPos==pos){isInList=true;if(this.compareEquip(curItem,newItem)){role_equipsList[i]=newItem}break}}}if(!isInList){var equip=role.equipsData[newPos];if(equip&&equip.item&&equip.item.itemConfig){if(this.compareEquip(equip.item,newItem)){role_equipsList.push(newItem)}}else{role_equipsList.push(newItem)}}var view=ViewManager.ins().getView(PlayFunView);if(view&&this.equipsList&&this.equipsList.length>0){for(var idx in this.equipsList){if(this.equipsList[idx]&&this.equipsList[idx].length>0){view.updateNewEquip();break}}}};NewEquip.prototype.isHaveEquip=function(){var equipsList=NewEquip.ins().equipsList;var found=false;for(var idx in equipsList){if(equipsList[idx]&&equipsList[idx].length>0){found=true;break}}return found};NewEquip.prototype.compareEquip=function(curItem,newItem){var curPower=curItem.point;var newPower=newItem.point;return newPower>curPower};NewEquip.notShowEquipIDs=[];return NewEquip}(BaseSystem);__reflect(NewEquip.prototype,"NewEquip");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.newEquip=NewEquip.ins.bind(NewEquip)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var NewEquipWin=function(_super){__extends(NewEquipWin,_super);function NewEquipWin(){var _this=_super.call(this)||this;_this.mcPlayed=false;_this.roleIdx=0;_this.job=1;_this.isTrival=false;_this.dressInfo=null;_this.skinName="newEquipSkin";_this.time=5;return _this}NewEquipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.visible=false;this.removeTouchEvent(this.go,this.onEvent);this.removeObserve();TimerManager.ins().removeAll(this);this.tick=0};NewEquipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.visible=false;if(!NewEquip.ins().isHaveEquip())return;if(this.visible)return;this.tick=this.time;this.removeTouchEvent(this.go,this.onEvent);this.addTouchEvent(this.go,this.onEvent);this.observe(UserEquip.ins().postEquipChange,this.equipCallBack);this.observe(Dress.ins().doDressActivationRes,this.trialCallBack);if(NewEquip.ins().check()){this.equipLbl.text=i18n("NewEquipWin_0",this.time);if(!TimerManager.ins().isExists(this.updateTime,this)){this.tick=this.time;TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}}else return};NewEquipWin.prototype.updateTime=function(){if(!this.visible){this.mcPlayed=false}this.visible=true;if(!this.mcPlayed){this.mcPlayed=true;var mc=ObjectPool.pop("MovieClip");var fileName=RES_DIR_EFF+"daoju_eff";mc.playFile(fileName,1);this.grpItemAni.addChild(mc)}this.init()};NewEquipWin.prototype.equipCallBack=function(){if(this.isTrival){return}this.callBack()};NewEquipWin.prototype.trialCallBack=function(){if(this.isTrival){this.callBack()}};NewEquipWin.prototype.callBack=function(){if(!NewEquip.ins().isHaveEquip()){this.close()}this.tick=this.time;this.updateTime()};NewEquipWin.prototype.init=function(){if(this.tick<=0){if(!NewEquip.ins().isHaveEquip()){this.close();return}this.tick=this.time}if(NewEquip.ins().equipsList.length>0){var equipsList=NewEquip.ins().equipsList;for(var jobNum in equipsList){if(equipsList[jobNum]&&equipsList[jobNum].length>0){this.equipLbl.text=i18n("NewEquipWin_0",this.tick);this.itemdata=equipsList[jobNum][0];var roles=SubRoles.ins().roles;for(var i=0;i<roles.length;++i){if(roles[i].job==parseInt(jobNum)){this.roleIdx=i;this.job=parseInt(jobNum);break}}if(this.itemdata&&this.itemdata.itemConfig){this.visible=true;this.equip.data=this.itemdata._configID;this.equip.isShowName(false);this.equipName.text=this.itemdata.itemConfig.name;this.equipName.textColor=ItemConfig.getQualityColor(this.itemdata.itemConfig);this.equipName.strokeColor=ItemConfig.getQualityStrokeColor(this.itemdata.itemConfig);this.powerCount.text=this.itemdata.point+"";this.go.label=i18n("NewEquipWin_2")}break}}}this.tick--;if(this.tick<=0){this.sendWear()}};NewEquipWin.prototype.onEvent=function(e){switch(e.target){case this.go:this.sendWear();break}};NewEquipWin.prototype.sendWear=function(){if(this.itemdata){var pos=ItemConfig.getSubType(this.itemdata.itemConfig);UserEquip.ins().sendWearEquipment(this.itemdata.handle,pos,this.roleIdx);var equipsList=NewEquip.ins().equipsList;for(var idx in equipsList){if(parseInt(idx)==this.job){if(equipsList[idx]&&equipsList[idx].length>0){equipsList[idx].shift();break}}}this.tick=this.time}if(!NewEquip.ins().isHaveEquip()){this.close()}};NewEquipWin.prototype.onClose=function(){this.close()};return NewEquipWin}(BaseEuiView);__reflect(NewEquipWin.prototype,"NewEquipWin");ViewManager.ins().reg(NewEquipWin,LayerManager.UI_Popup);var NewRoleWin=function(_super){__extends(NewRoleWin,_super);function NewRoleWin(){var _this=_super.call(this)||this;_this.sex=[0,1,1];_this.roleAni1=null;_this.roleAni2=null;_this.roleAni3=null;_this.isTopLevel=true;return _this}NewRoleWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="OpenRoleSkin";this.jobImage=[this.j0,this.j1,this.j2]};NewRoleWin.prototype.setNeedTxt=function(){var openIndex=SubRoles.ins().subRolesLen;var config=GlobalConfig.NewRoleConfig[openIndex];var str="";var color;var meetVIP;if(config.zsLevel){str=i18n("NewRoleWin_0",config.zsLevel);this.canOpen=UserZs.ins().lv>=config.zsLevel;color=this.canOpen?242004:15937822;str='<font color="#'+color.toString(16)+'">'+str+"</font>"}else{str=i18n("NewRoleWin_1",config.level);this.canOpen=Actor.level>=config.level;color=this.canOpen?242004:15937822;str='<font color="#'+color.toString(16)+'">'+str+"</font>"}if(config.vip){meetVIP=UserVip.ins().lv>=config.vip;this.canOpen=this.canOpen||meetVIP;color=meetVIP?242004:15937822;str=str+i18n("NewRoleWin_2",color.toString(16),config.vip)}this.needTxt.textFlow=(new egret.HtmlTextParser).parser(i18n("NewRoleWin_3",str))};NewRoleWin.prototype.showbg=function(job,show){if(job===void 0){job="1"}if(show===void 0){show=false}var state=this.currentState;if(job==state){this.bg.visible=show}};NewRoleWin.prototype.playRoleAni1=function(){var self=this;if(!ProfilingMgr.ins().webglSupport()){self.showbg("0",false);return}if(!this.roleAni1){self.showbg("0",false);var roleAni1=new DragonBones("nanzhanshi",2,null,["nanzhanshi_once","nanzhanshi_loop"],true,"_png",false,function(){self.showbg("0",true)});self.roleMc1.addChild(roleAni1);self.roleAni1=roleAni1}else{self.showbg("0",true);this.roleAni1.playActionArray(["nanzhanshi_once","nanzhanshi_loop"],true)}};NewRoleWin.prototype.playRoleAni2=function(){var self=this;if(!ProfilingMgr.ins().webglSupport()){self.showbg("1",false);return}if(!this.roleAni2){self.showbg("1",false);var roleAni2=new DragonBones("nv_fashi",2,null,["fashi_nv_once","fashi_nv_loop"],true,"_png",false,function(){self.showbg("1",true)});if(ChannelMgr.ins().isJiuYou()){roleAni2=new DragonBones("nv_fashi",2,null,["fashi_nv_once","fashi_nv_loop"],true,"_png",false,function(){self.showbg("1",true)})}self.roleMc2.addChild(roleAni2);self.roleAni2=roleAni2}else{self.showbg("1",true);this.roleAni2.playActionArray(["fashi_nv_once","fashi_nv_loop"],true)}};NewRoleWin.prototype.playRoleAni3=function(){var self=this;if(!ProfilingMgr.ins().webglSupport()){self.showbg("2",false);return}if(!this.roleAni3){self.showbg("2",false);var roleAni3=new DragonBones("nv_daoshi",2,null,["fashi_nv_once","fashi_nv_loop"],true,"_png",false,function(){self.showbg("2",true)});self.roleMc3.addChild(roleAni3);self.roleAni3=roleAni3}else{self.showbg("2",true);this.roleAni3.playActionArray(["fashi_nv_once","fashi_nv_loop"],true)}};NewRoleWin.prototype.selectJob=function(jobIndex,teleport){if(teleport===void 0){teleport=false}this.currentState=""+jobIndex;if(jobIndex==0){this.roleStill.source="choose_bg_zs_jpg";this.playRoleAni1()}if(jobIndex==1){this.roleStill.source="choose_bg_fs_jpg";this.playRoleAni2()}if(jobIndex==2){this.roleStill.source="choose_bg_ds_jpg";this.playRoleAni3()}var len=SubRoles.ins().subRolesLen;var b=false;for(var i=0;i<len;i++){var element=SubRoles.ins().getSubRoleByIndex(i);if(element.job==jobIndex+1){b=true;break}}this.openBtn.visible=!b;this.openedImg.visible=b};NewRoleWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);for(var i=0;i<this.jobImage.length;i++){this.jobImage[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.setNeedTxt();var arr=[0,1,2];var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var element=SubRoles.ins().getSubRoleByIndex(i);var index=arr.indexOf(element.job-1);if(index>-1)arr.splice(index,1)}this.job=arr[0];this.bg.visible=false};NewRoleWin.prototype.onClick=function(e){switch(e.currentTarget){default:var jobIndex=this.jobImage.indexOf(e.currentTarget);if(jobIndex>=0)this.job=jobIndex;break}};NewRoleWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTap);for(var i=0;i<this.jobImage.length;i++){this.jobImage[i].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}};NewRoleWin.prototype.onTap=function(e){switch(e.target){case this.openBtn:if(!this.canOpen){var openIndex=SubRoles.ins().subRolesLen;var config_9=GlobalConfig.NewRoleConfig[openIndex];var win=WarnWin.show(i18n("NewRoleWin_5",config_9.vip,openIndex+1),null,null,function(){ViewManager.ins().open(VipWin,config_9.vip)},this);win.setBtnLabel(i18n("NewRoleWin_6"),i18n("NewRoleWin_7"));return}GameLogic.ins().sendNewRole(this.job+1,this.sex[this.job]);ViewManager.ins().close(LimitTaskView);case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;default:var jobIndex=this.jobImage.indexOf(e.currentTarget);if(jobIndex>=0)this.job=jobIndex;break}};Object.defineProperty(NewRoleWin.prototype,"job",{get:function(){return this._job},set:function(value){this._job=value;this.selectJob(value)},enumerable:true,configurable:true});NewRoleWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(SubRoles.ins().subRolesLen>=3){return false}else{ViewManager.ins().close(LiLianWin);return true}};return NewRoleWin}(BaseEuiView);__reflect(NewRoleWin.prototype,"NewRoleWin");ViewManager.ins().reg(NewRoleWin,LayerManager.UI_Main);var actor=GameSystem.actor;window["actor"]=actor;var Notice=function(_super){__extends(Notice,_super);function Notice(){var _this=_super.call(this)||this;_this.autoOpen="_FuliautoOpen_";_this.isAutoOpened=false;_this.hasNewNotice=false;_this._key="fuli_gonggao";_this.sysId=PackageID.Notice;_this.regNetMsg(1,_this.doNotice);_this.regNetMsg(2,_this.doNoticeOpen);_this.regNetMsg(3,_this.postWelfareNotice);TimerManager.ins().doTimer(3e3,1,_this.checkUpdata,_this);return _this}Notice.ins=function(){return _super.ins.call(this)};Notice.prototype.checkUpdata=function(){if(!GlobalConfig.UpdateRemindConfig.appearTime||!GlobalConfig.UpdateRemindConfig.disappearTime)return;if(UserZs.ins().lv*1e3+Actor.level<GlobalConfig.UpdateRemindConfig.appearLv)return;if(GameServer.serverOpenDay+1<GlobalConfig.UpdateRemindConfig.serverDayLimit)return;var serverTime=GameServer.serverTime;if(DateUtils.formatStrTimeToMs(GlobalConfig.UpdateRemindConfig.appearTime)<=serverTime&&serverTime<DateUtils.formatStrTimeToMs(GlobalConfig.UpdateRemindConfig.disappearTime))ViewManager.ins().open(UpdateRemindWin,GlobalConfig.UpdateRemindConfig.lotteryNotice)};Notice.prototype.doNotice=function(bytes){var type=bytes.readShort();var str=bytes.readString();var isNew=bytes.readUnsignedByte();if(type==1){if(isNew==0){ViewManager.ins().open(NoticeView).showNotice(str)}}else if(type==2){if(!this.data){this.data=new ChatInfoData(null)}this.data.str=str;this.data.type=7}if(type==3){ViewManager.ins().open(NoticeView).showNotice(str)}Chat.ins().postSysChatMsg(new ChatSystemData(type,str))};Notice.prototype.doNoticeOpen=function(bytes){UserFuLi.ins().isOpenNotice=bytes.readBoolean();Notice.ins().postGameNotice()};Notice.prototype.getWelfareNotice=function(){console.log("getWelfareNotice: "+ChannelMgr.ins().main_channel+" "+Number(ChannelMgr.ins().sub_channel));var bytes=this.getBytes(3);bytes.writeInt(Number(ChannelMgr.ins().main_channel));bytes.writeInt(Number(ChannelMgr.ins().sub_channel));this.sendToServer(bytes)};Notice.prototype.postWelfareNotice=function(bytes){var result=bytes.readInt();var notice=bytes.readString();var red_point=bytes.readByte();console.log("result:"+result+", notice:"+notice+", red_point:"+red_point);notice=result==0?notice:"";this.setNotice(1,notice);return notice};Notice.prototype.setNoticeOPen=function(){this.sendBaseProto(2)};Notice.prototype.postGameNotice=function(){};Notice.prototype.getNotice=function(fn){LoginMgr.getItem(this._key,function(str){if(str!=""&&str!=null){var data=JSON.parse(str);if(!data||typeof data!="object"){data={time:(new Date).toDateString(),notice:"",state:false}}fn(data)}else{var data={time:(new Date).toDateString(),notice:"",state:false};fn(data)}})};Notice.prototype.setNotice=function(type,txt,state){var _this=this;this.getNotice(function(data){if(type==1){var oldv=_this.hasNewNotice;var oldtxt=data.notice;var hasNotice=txt?true:false;var isNew=hasNotice&&txt!=data.notice?true:false;var today=(new Date).toDateString();if(today!=data.time){data.time=today;data.state=hasNotice}data.state=_this.hasNewNotice=isNew||data.state;data.notice=hasNotice?txt:"";LoginMgr.setItem(_this._key,JSON.stringify(data));if(oldtxt!=data.notice)_this.postChangeNotice();if(oldv!=_this.hasNewNotice)_this.postChangeState()}else if(type==2){var oldv=_this.hasNewNotice;data.state=_this.hasNewNotice=state;LoginMgr.setItem(_this._key,JSON.stringify(data));if(oldv!=_this.hasNewNotice)_this.postChangeState()}})};Notice.prototype.postChangeState=function(){};Notice.prototype.postChangeNotice=function(){};return Notice}(BaseSystem);__reflect(Notice.prototype,"Notice");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.notice=Notice.ins.bind(Notice)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var NoticeView=function(_super){__extends(NoticeView,_super);function NoticeView(){var _this=_super.call(this)||this;_this.list=[];_this.startX=0;_this.endX=0;return _this}NoticeView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.frame=new eui.Image;this.frame.source="zjmgonggaobg";this.frame.width=480;this.frame.height=28;this.frame.y=240;this.frame.x=StageUtils.ins().getWidth()/2-this.frame.width/2;this.addChild(this.frame);this.frame.visible=false;this.touchChildren=false;this.touchEnabled=false;this.startX=this.frame.x+this.frame.width;this.endX=this.frame.x};NoticeView.prototype.removeFfArenaNotice=function(){if(this.list.length<1){return}var lab=this.list[0];if(lab&&!KfArenaSys.ins().isKFArena){var temp=[];var s=lab.visible?1:0;for(var i=s;i<this.list.length;i++){var lab_1=this.list[i];if(!KfArenaSys.ins().isKfArenaNotice(lab_1.text)){temp.push(lab_1)}}this.list=temp}};NoticeView.prototype.showNotice=function(str){if(str&&str.indexOf(i18n("NoticeView_0"))>-1){this.visible=false;return}else this.visible=true;this.frame.visible=true;var lab=new eui.Label;lab.size=20;lab.textColor=16705792;lab.stroke=1;lab.strokeColor=0;lab.x=this.startX;lab.y=this.frame.y+4;lab.textFlow=TextFlowMaker.generateTextFlow(str);this.Linkstr=str;this.addTouchEvent(lab,this.onLabTap);lab.touchEnabled=true;this.addChild(lab);this.list.push(lab);lab.visible=false;if(this.list.length==1)this.tweenLab()};NoticeView.prototype.tweenLab=function(){var _this=this;var lab=this.list[0];var tweenX=this.endX-lab.width;var t=egret.Tween.get(lab);lab.visible=true;t.to({x:tweenX},lab.width*20).call(function(){_this.removeChild(lab);_this.list.shift();if(_this.list.length<1)_this.frame.visible=false;else _this.tweenLab()},this)};NoticeView.prototype.onLabTap=function(){if(this.Linkstr&&this.Linkstr.indexOf("|E:")>=0)this.onLink(this.Linkstr)};NoticeView.prototype.onLink=function(str){var index=str.indexOf("|E:");str=str.slice(index+3,Number.MAX_VALUE);var list;if(str.indexOf(",")>=0)list=str.split(",");else if(str.indexOf("*")>=0)list=str.split("*");if(!list||list.length<=0)return;switch(list[0]){case"1":UserFb.ins().sendEnterTFRoom(+list[1]);break;case"2":KfArenaSys.ins().sendJoinTeam(+list[1]);break}};return NoticeView}(BaseEuiView);__reflect(NoticeView.prototype,"NoticeView");ViewManager.ins().reg(NoticeView,LayerManager.UI_Tips);var UpdateRemindWin=function(_super){__extends(UpdateRemindWin,_super);function UpdateRemindWin(){var _this=_super.call(this)||this;_this.skinName="updateRemindSkin";return _this}UpdateRemindWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};UpdateRemindWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.onTouch);var skin=param[0];if(skin&&skin!=this.skinName)this.skinName=skin};UpdateRemindWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.closeBtn:case this.btn:ViewManager.ins().close(this);if(e.target==this.btn)ViewManager.ins().open(FuliWin,"GameNoticePanle");break}};return UpdateRemindWin}(BaseEuiView);__reflect(UpdateRemindWin.prototype,"UpdateRemindWin");ViewManager.ins().reg(UpdateRemindWin,LayerManager.UI_Popup);var EffectivenessTip=function(_super){__extends(EffectivenessTip,_super);function EffectivenessTip(){var _this=_super.call(this)||this;_this.showType=0;_this.skinName="CheckEfficienSkin";return _this}EffectivenessTip.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.showType=param[0]?param[0]:0;this.update();this.addTouchEvent(this,this.onTap);TimerManager.ins().doTimer(3e3,1,this.playTween,this)};EffectivenessTip.prototype.playTween=function(){var _this=this;if(this.showType||true){var tt=egret.Tween.get(this.mainGroup);tt.to({scaleX:0,scaleY:0,horizontalCenter:170,top:52},500).call(function(){ViewManager.ins().close(_this)})}else{var t=egret.Tween.get(this);t.to({alpha:0},1e3).call(function(){_this.alpha=1;ViewManager.ins().close(_this)},this)}};EffectivenessTip.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}UserFb.ins().showAni=false;this.removeTouchEvent(this,this.onTap);TimerManager.ins().remove(this.playTween,this);egret.Tween.removeTweens(this.mainGroup);egret.Tween.removeTweens(this)};EffectivenessTip.prototype.onTap=function(e){this.removeTouchEvent(this,this.onTap);TimerManager.ins().remove(this.playTween,this);this.playTween()};EffectivenessTip.prototype.update=function(){var curId=UserFb.ins().guanqiaID;var lastID=curId-1;if(UserFb.ins().expEff==UserFb.ins().expEffLast){this.groupExp.visible=false}else{this.groupExp.visible=true;this.curExp.text=UserFb.ins().expEffLast+"";this.nextExp.text=UserFb.ins().expEff+""}if(UserFb.ins().ssExpEff==UserFb.ins().bsExpEffLast){this.groupExpSS.visible=false}else{this.groupExpSS.visible=true;this.curExpSS.text=UserFb.ins().bsExpEffLast+"";this.nextExpSS.text=UserFb.ins().ssExpEff+""}if(UserFb.ins().goldEff==UserFb.ins().goldEffLast){this.groupGold.visible=false}else{this.groupGold.visible=true;this.curMoney.text=UserFb.ins().goldEffLast+"";this.nextMoney.text=UserFb.ins().goldEff+""}if(this.showType){this.groupGold.visible=this.groupExp.visible=this.groupExpSS.visible=false;this.groupInfoGold.visible=this.groupInfoExp.visible=this.groupInfoExpSS.visible=true;this.nextInfoExp.text=UserFb.ins().expEff+"";this.nextInfoMoney.text=UserFb.ins().goldEff+"";this.nextInfoExpSS.text=UserFb.ins().ssExpEff+"";this.groupInfoExpSS.visible=UserFb.ins().ssExpEff>0;this.bg.bottom=this.groupInfoExpSS.visible?-54:-17;this.descTxt.text=i18n("EffectivenessTip_0")}else{this.groupGold.visible=this.groupExp.visible=this.groupExpSS.visible=true;this.groupInfoGold.visible=this.groupInfoExp.visible=this.groupInfoExpSS.visible=false;this.groupExpSS.visible=UserFb.ins().ssExpEff>UserFb.ins().bsExpEffLast;this.bg.bottom=this.groupExpSS.visible?-54:-17;this.descTxt.text=i18n("EffectivenessTip_1")}};return EffectivenessTip}(BaseEuiView);__reflect(EffectivenessTip.prototype,"EffectivenessTip");ViewManager.ins().reg(EffectivenessTip,LayerManager.UI_Main);var OfflineRewardWin=function(_super){__extends(OfflineRewardWin,_super);function OfflineRewardWin(){var _this=_super.call(this)||this;_this.arr=[];_this.skinName="OfflineRewardSkin";_this.isTopLevel=true;return _this}OfflineRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.okBtn,this.toClose);this.addTouchEvent(this.closeBtn,this.toClose);this.addTouchEvent(this.bgClose,this.toClose);this.addTouchEvent(this.adBtn,this.onAd);this.arr=param[0];this.coin=param[1];for(var i=0;i<this.coin.length;i++){if(this.coin[i].id==MoneyConst.soul){this.arr.push(this.coin[i].count);break}}this.update()};OfflineRewardWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.toClose);this.removeTouchEvent(this.bgClose,this.toClose);this.removeTouchEvent(this.okBtn,this.toClose);this.removeTouchEvent(this.adBtn,this.onAd)};OfflineRewardWin.prototype.update=function(){this.updateAd();this.time.text=i18n("OfflineRewardWin_0")+DateUtils.getFormatBySecond(this.arr[0],DateUtils.TIME_FORMAT_9);this.exp.text=""+this.arr[1];this.ssExp.text=""+this.arr[2];this.money.text=""+this.arr[3];this.equipNum.text=""+(this.arr[4]+this.arr[5]);this.jinglianshiNum.text=""+(this.arr[7]?this.arr[7]:0);if(this.arr[5]==0){this.bagFull.visible=false}else{this.bagFull.visible=true;this.bagFull.textFlow=(new egret.HtmlTextParser).parser(i18n("OfflineRewardWin_1",this.arr[5]))}if(this.arr[6].length>0){for(var i=0;i<this.arr[6].length;i++){var obj=this.arr[6][i];if(obj["type"]==1){this.label4.text=obj["gold"];this.label6.text=obj["exp"]}else if(obj["type"]==2){this.label3.text=obj["gold"];this.label5.text=obj["exp"];this.label7.text=obj["ssExp"]}else if(obj["type"]==3){this.exp.text=""+(this.arr[1]+obj["exp"]);this.arr[3]+=obj["gold"]}else if(obj["type"]==4){this.exp.text=""+(this.arr[1]+obj["exp"]);this.arr[3]+=obj["gold"]}}this.money.text=""+this.arr[3]}};OfflineRewardWin.prototype.updateAd=function(){this.adGroup.visible=ChannelMgr.ins().isQQSmallGameChannel();this.offlinePlus.text="+"+GlobalConfig.SmallGameBaseConfig.offlinePlus.toString()+"%"};OfflineRewardWin.prototype.toClose=function(){ViewManager.ins().close(this)};OfflineRewardWin.prototype.onAd=function(){var b=ChannelNet.ins().canGetAdAward(adType.offline);if(b){var self=this;var getAward=function(){var c=ChannelMgr.ins().getFullChannel();ChannelNet.ins().sendAdReward(c,adType.offline,0);self.toClose()};ChannelNet.ins().playQQadVedio(adType.offline,getAward)}else{WarnWin.show(i18n("OfflineRewardWin_2"),function(){},this)}};return OfflineRewardWin}(BaseEuiView);__reflect(OfflineRewardWin.prototype,"OfflineRewardWin");ViewManager.ins().reg(OfflineRewardWin,LayerManager.UI_Popup);var OpenSystem=function(_super){__extends(OpenSystem,_super);function OpenSystem(){return _super.call(this)||this}OpenSystem.ins=function(){return _super.ins.call(this)};OpenSystem.prototype.checkSysOpen=function(type){var config=GlobalConfig.OpenSystemConfig[type];if(config&&config.judge){if(!config.than)return UserZs.ins().lv>=config.openzs&&Actor.level>=config.openlevel&&UserFb.ins().guanqiaID>=config.opencheck;else return UserZs.ins().lv<=config.openzs&&Actor.level<=config.openlevel&&UserFb.ins().guanqiaID<=config.opencheck}else{if(type==SystemType.FIRSTCHARGE&&LocationProperty.pfid=="2"){return true}}return false};OpenSystem.prototype.getNoOpenTips=function(type){var config=GlobalConfig.OpenSystemConfig[type];var tips="";if(config){if(!config.judge){tips=i18n("OpenSystem_0",config.funName)}else{if(!config.than){if(UserZs.ins().lv<config.openzs){tips+=i18n("OpenSystem_1",config.openzs)}if(Actor.level<config.openlevel){tips+=i18n("OpenSystem_2",config.openlevel)}if(UserFb.ins().guanqiaID<config.opencheck){tips+=i18n("OpenSystem_3",config.opencheck)}if(tips!="")tips+=i18n("OpenSystem_4",config.funName)}}}return tips};return OpenSystem}(BaseSystem);__reflect(OpenSystem.prototype,"OpenSystem");var PaoDianCC=function(_super){__extends(PaoDianCC,_super);function PaoDianCC(){var _this=_super.call(this)||this;_this._openLeftTime=0;_this._openTimer=0;_this._enterCD=0;_this._enterCDTimer=0;_this._leftTime=0;_this._areaId=0;_this._shenBingExp=0;_this._jadeChips=0;_this.sysId=PackageID.PaoDian;_this.observe(GameLogic.ins().postEnterMap,_this.mapChange);_this.regNetMsg(1,_this.postEnterSuccess);_this.regNetMsg(2,_this.postBelongChange);_this.regNetMsg(3,_this.doEnterCD);_this.regNetMsg(4,_this.postOpenInfo);_this.regNetMsg(5,_this.doRelive);_this.regNetMsg(6,_this.postMyInfo);_this.regNetMsg(7,_this.postAreaChange);_this.regNetMsg(8,_this.doResult);return _this}Object.defineProperty(PaoDianCC.prototype,"areaId",{get:function(){return this._areaId},enumerable:true,configurable:true});Object.defineProperty(PaoDianCC.prototype,"shenBingExp",{get:function(){return this._shenBingExp},enumerable:true,configurable:true});Object.defineProperty(PaoDianCC.prototype,"jadeChips",{get:function(){return this._jadeChips},enumerable:true,configurable:true});PaoDianCC.prototype.mapChange=function(){if(GameMap.fubenID==GlobalConfig.PassionPointConfig.fbId)this.enterBattle();if(this._isPaoDian&&GameMap.fubenID!=GlobalConfig.PassionPointConfig.fbId)this.escBattle();if(this.gotoNpc&&GameMap.fbType==UserFb.FB_TYPE_CITY){this.gotoNpc=false;GameMap.myMoveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE,this.findComplete);GameMap.moveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE)}};PaoDianCC.prototype.findComplete=function(){ViewManager.ins().open(PaoDianNpcTalkWin)};PaoDianCC.prototype.enterBattle=function(){this._isPaoDian=true;if(!ViewManager.ins().isShow(PaoDianWin))ViewManager.ins().open(PaoDianWin);ViewManager.ins().close(PaoDianNpcTalkWin)};PaoDianCC.prototype.escBattle=function(){this._isPaoDian=false;ViewManager.ins().close(PaoDianWin)};PaoDianCC.ins=function(){return _super.ins.call(this)};Object.defineProperty(PaoDianCC.prototype,"isPaoDian",{get:function(){return this._isPaoDian},enumerable:true,configurable:true});Object.defineProperty(PaoDianCC.prototype,"isOpen",{get:function(){return this._isOpen},enumerable:true,configurable:true});PaoDianCC.prototype.enterPaoDian=function(){this.sendBaseProto(1)};PaoDianCC.prototype.postEnterSuccess=function(bytes){this._leftTime=DateUtils.formatMiniDateTime(bytes.readInt())};PaoDianCC.prototype.getLeftTime=function(){return Math.floor((this._leftTime-GameServer.serverTime)/1e3)};PaoDianCC.prototype.postBelongChange=function(bytes){this._belongs=[];var len=bytes.readInt();this._belongs.length=len;for(var i=0;i<len;i++)this._belongs[i]={id:bytes.readShort(),handler:bytes.readDouble()}};PaoDianCC.prototype.doEnterCD=function(bytes){this._enterCD=bytes.readInt();this._enterCDTimer=egret.getTimer()};PaoDianCC.prototype.getEnterCD=function(){return Math.ceil(this._enterCD-(egret.getTimer()-this._enterCDTimer)/1e3)};PaoDianCC.prototype.postOpenInfo=function(bytes){this._isOpen=bytes.readBoolean();this._openLeftTime=bytes.readInt();this._openTimer=egret.getTimer()};PaoDianCC.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3};PaoDianCC.prototype.sendReLive=function(){this.sendBaseProto(5)};PaoDianCC.prototype.doRelive=function(bytes){UserBoss.ins().reliveTime=bytes.readInt();UserBoss.ins().killerHandler=bytes.readDouble();ViewManager.ins().close(TargetPlayerBigBloodPanel);if(UserBoss.ins().reliveTime>0){UserBoss.ins().clearWorldBossList();ViewManager.ins().open(WorldBossBeKillWin)}else ViewManager.ins().close(WorldBossBeKillWin)};PaoDianCC.prototype.sendCheckMyInfo=function(){this.sendBaseProto(6)};PaoDianCC.prototype.postMyInfo=function(bytes){this._shenBingExp=bytes.readInt();this._jadeChips=bytes.readInt()};PaoDianCC.prototype.postAreaChange=function(bytes){this._areaId=bytes.readShort()};PaoDianCC.prototype.doResult=function(bytes){var len=bytes.readInt();var list=[];list.length=len;for(var i=0;i<len;i++)list[i]=new PaoDianRankVo(bytes);ViewManager.ins().open(PaoDianResultWin,list)};PaoDianCC.prototype.checkRedPoint=function(){return this.isOpen&&Actor.level+UserZs.ins().lv*1e3>=GlobalConfig.PassionPointConfig.openLv};PaoDianCC.prototype.getBelongById=function(id){if(!this._belongs||this._belongs.length==0)return null;var len=this._belongs.length;for(var i=0;i<len;i++){if(this._belongs[i].id==id)return this._belongs[i]}return null};PaoDianCC.prototype.checkOpen=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.PAODIAN))return false;if(PaoDianCC.ins().isOpen){return true}else{var leftTime=PaoDianCC.ins().getOpenLeftTime();if(leftTime>0){return true}}return false};PaoDianCC.prototype.toPaoDianCC=function(){if(!PaoDianCC.ins().isOpen){UserTips.ins().showTips(GlobalConfig.PassionPointConfig.openTips);return}var openLevel=GlobalConfig.PassionPointConfig.openLv;if(Actor.level+UserZs.ins().lv*1e3<openLevel){UserTips.ins().showTips((openLevel<1e3?openLevel+i18n("PlayWayPanel_12"):openLevel%1e3==0?openLevel/1e3+i18n("PlayWayPanel_13"):openLevel/1e3+i18n("PlayWayPanel_14")+openLevel%1e3+i18n("PlayWayPanel_15"))+i18n("PlayWayPanel_16"));return}if(CityCC.ins().enterCD<1){if(CityCC.ins().isCity){GameMap.myMoveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE,PaoDianCC.ins().findComplete);GameMap.moveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE)}else{PaoDianCC.ins().gotoNpc=true;CityCC.ins().sendEnter()}}else UserTips.ins().showTips(i18n("PlayWayPanel_17",CityCC.ins().enterCD))};return PaoDianCC}(BaseSystem);__reflect(PaoDianCC.prototype,"PaoDianCC");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.paoDianCC=PaoDianCC.ins.bind(PaoDianCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var PaoDianCurrentWin=function(_super){__extends(PaoDianCurrentWin,_super);function PaoDianCurrentWin(){var _this=_super.call(this)||this;_this.skinName="PointCurrentTipsSkin";return _this}PaoDianCurrentWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};PaoDianCurrentWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.observe(PaoDianCC.ins().postMyInfo,this.update);this.observe(PaoDianCC.ins().postAreaChange,this.update);this.update()};PaoDianCurrentWin.prototype.update=function(){this.yupeiNum.text=i18n("PaoDianCurrentWin_0")+PaoDianCC.ins().jadeChips;this.gwexpNum.text=i18n("PaoDianCurrentWin_1")+PaoDianCC.ins().shenBingExp;var cfg=GlobalConfig.PassionPointAwardConfig[PaoDianCC.ins().areaId];this.currentArea.text=cfg?cfg.times+i18n("PaoDianCurrentWin_2"):"";var num=cfg?cfg.reward[1].count:0;num=Math.floor(num/1e3)/10;this.Speed.text=GlobalConfig.PassionPointConfig.efficiencyDesc.replace("{0}",(cfg?cfg.reward[0].count:0)+"").replace("{1}",num+"");this.currentArea.textColor=this.yupeiNum.textColor=this.gwexpNum.textColor=this.Speed.textColor=cfg?cfg.color:this.Speed.textColor};PaoDianCurrentWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeObserve()};PaoDianCurrentWin.prototype.onClose=function(e){ViewManager.ins().close(this)};return PaoDianCurrentWin}(BaseEuiView);__reflect(PaoDianCurrentWin.prototype,"PaoDianCurrentWin");ViewManager.ins().reg(PaoDianCurrentWin,LayerManager.Main_View);var PaoDianIconItemRender=function(_super){__extends(PaoDianIconItemRender,_super);function PaoDianIconItemRender(){var _this=_super.call(this)||this;_this.skinName="PointResultAwardSkin";return _this}PaoDianIconItemRender.prototype.dataChanged=function(){this.icon.source=this.data[0];var num=this.data[1];num=Math.floor(num/1e3)/10;this.count.text=num==0?"0":num+i18n("PaoDianIconItemRender_0")};return PaoDianIconItemRender}(BaseItemRender);__reflect(PaoDianIconItemRender.prototype,"PaoDianIconItemRender");var PaoDianNpcTalkWin=function(_super){__extends(PaoDianNpcTalkWin,_super);function PaoDianNpcTalkWin(){var _this=_super.call(this)||this;_this.skinName="PointTipsSkin";return _this}PaoDianNpcTalkWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onGoto);this.update()};PaoDianNpcTalkWin.prototype.close=function(){this.removeTouchEvent(this.goTo,this.onGoto)};PaoDianNpcTalkWin.prototype.update=function(){this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PassionPointConfig.desc);this.rule.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HelpInfoConfig[20].text);this.redPoint.visible=PaoDianCC.ins().isOpen};PaoDianNpcTalkWin.prototype.onGoto=function(e){if(e.target==this.goTo){if(!PaoDianCC.ins().isOpen){UserTips.ins().showTips(GlobalConfig.PassionPointConfig.openTips);return}var openLevel=GlobalConfig.PassionPointConfig.openLv;if(Actor.level+UserZs.ins().lv*1e3<openLevel){UserTips.ins().showTips((openLevel<1e3?openLevel+i18n("PaoDianNpcTalkWin_0"):openLevel%1e3==0?openLevel/1e3+i18n("PaoDianNpcTalkWin_1"):openLevel/1e3+i18n("PaoDianNpcTalkWin_2")+openLevel%1e3+i18n("PaoDianNpcTalkWin_3"))+i18n("PaoDianNpcTalkWin_4"));return}var cd=PaoDianCC.ins().getEnterCD();if(cd>0){UserTips.ins().showTips(cd+i18n("PaoDianNpcTalkWin_5"));return}PaoDianCC.ins().enterPaoDian()}else if(e.target==this.bgClose||e.target==this.closeBtn)ViewManager.ins().close(this)};return PaoDianNpcTalkWin}(BaseEuiView);__reflect(PaoDianNpcTalkWin.prototype,"PaoDianNpcTalkWin");ViewManager.ins().reg(PaoDianNpcTalkWin,LayerManager.UI_Main);var PaoDianResultItemRender=function(_super){__extends(PaoDianResultItemRender,_super);function PaoDianResultItemRender(){var _this=_super.call(this)||this;_this.skinName="PointResultItemSkin";return _this}PaoDianResultItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.award.itemRenderer=PaoDianIconItemRender};PaoDianResultItemRender.prototype.dataChanged=function(){var vo=this.data;this.ranking.text=vo.rank+"";this.roleName.text=vo.roleName;this.guild.text=vo.unionName;this.award.dataProvider=new ArrayCollection([["ZSprestige",vo.jadeChips],["ZSexp",vo.shenBingExp]])};return PaoDianResultItemRender}(BaseItemRender);__reflect(PaoDianResultItemRender.prototype,"PaoDianResultItemRender");var PaoDianResultWin=function(_super){__extends(PaoDianResultWin,_super);function PaoDianResultWin(){var _this=_super.call(this)||this;_this._time=5;_this.skinName="PointResultSkin";return _this}PaoDianResultWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rankList.itemRenderer=PaoDianResultItemRender;this.myRewarrd.itemRenderer=PaoDianIconItemRender;this._arrayCollect=new ArrayCollection;this.myRewarrd.dataProvider=this._arrayCollect};PaoDianResultWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);this.observe(PaoDianCC.ins().postMyInfo,this.updateMyScore);this.timerGroup.visible=true;this.info.text=this._time+"";TimerManager.ins().doTimer(1e3,5,this.repeat,this);this.updateMyScore();this.rankList.dataProvider=new eui.ArrayCollection(args[0])};PaoDianResultWin.prototype.updateMyScore=function(){this._arrayCollect.source=[["ZSprestige",PaoDianCC.ins().jadeChips],["ZSexp",PaoDianCC.ins().shenBingExp]]};PaoDianResultWin.prototype.repeat=function(){this._time--;if(this._time>0)this.info.text=this._time+"";else this.timerGroup.visible=false};PaoDianResultWin.prototype.close=function(){this.removeTouchEvent(this,this.onTap);this.removeObserve();TimerManager.ins().removeAll(this)};PaoDianResultWin.prototype.onTap=function(e){switch(e.target){case this.closeBtn:UserFb.ins().sendExitFb();ViewManager.ins().close(this);break}};return PaoDianResultWin}(BaseEuiView);__reflect(PaoDianResultWin.prototype,"PaoDianResultWin");ViewManager.ins().reg(PaoDianResultWin,LayerManager.UI_Main);var PaoDianWin=function(_super){__extends(PaoDianWin,_super);function PaoDianWin(){var _this=_super.call(this)||this;_this._leftTime=0;_this._stateList=["one","two","three","","five"];_this.skinName="PointFightSkin";return _this}PaoDianWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.observe(PaoDianCC.ins().postEnterSuccess,this.updateTime);this.observe(PaoDianCC.ins().postBelongChange,this.update);this.observe(PaoDianCC.ins().postAreaChange,this.updateCurrentArea);this.update();this.updateTime();this.updateCurrentArea()};PaoDianWin.prototype.update=function(){var cfg,id;var belong;var btn;var char;for(var i=0;i<5;i++){cfg=GlobalConfig.PassionPointConfig.expPoint[i];id=cfg[2];belong=PaoDianCC.ins().getBelongById(id);btn=this["area"+i];btn.name=belong?belong.handler+"":cfg[0]+","+cfg[1];this["occupy"+i].visible=belong==null;if(belong){char=EntityManager.ins().getEntityBymasterhHandle(belong.handler);if(char){this["name"+i].text=char.infoModel.name;this["guild"+i].text=char.infoModel.guildName}else{this["name"+i].text="";this["guild"+i].text=""}}else{this["name"+i].text="";this["guild"+i].text=""}}};PaoDianWin.prototype.updateTime=function(){TimerManager.ins().remove(this.repeat,this);this._leftTime=PaoDianCC.ins().getLeftTime();if(this._leftTime>0){TimerManager.ins().doTimer(1e3,0,this.repeat,this);this.repeat()}else this.wholeLeftTime.text=""};PaoDianWin.prototype.repeat=function(){if(this._leftTime<=0){this.wholeLeftTime.text="";TimerManager.ins().remove(this.repeat,this);return}this.wholeLeftTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4);this._leftTime--};PaoDianWin.prototype.updateCurrentArea=function(){var cfg=GlobalConfig.PassionPointAwardConfig[PaoDianCC.ins().areaId];this.currentArea.currentState=this._stateList[cfg?cfg.times-1:0]};PaoDianWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeObserve();TimerManager.ins().remove(this.repeat,this)};PaoDianWin.prototype.onTouch=function(e){switch(e.target){case this.area0:case this.area1:case this.area2:case this.area3:case this.area4:var list=e.target.name.split(",");if(list.length==1)GameLogic.ins().postChangeAttrPoint(Number(list[0]));else{GameLogic.ins().stopAI();SysSetting.ins().setValue("mapClickTx",0);SysSetting.ins().setValue("mapClickTy",0);GameMap.moveTo(Number(list[0])*GameMap.CELL_SIZE,Number(list[1])*GameMap.CELL_SIZE)}break;case this.currentArea:PaoDianCC.ins().sendCheckMyInfo();ViewManager.ins().open(PaoDianCurrentWin);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[20].text);break}};return PaoDianWin}(BaseEuiView);__reflect(PaoDianWin.prototype,"PaoDianWin");ViewManager.ins().reg(PaoDianWin,LayerManager.Main_View);var PaoDianRankVo=function(){function PaoDianRankVo(bytes){this.rank=bytes.readShort();this.roleName=bytes.readString();this.unionName=bytes.readString();this.shenBingExp=bytes.readInt();this.jadeChips=bytes.readInt()}return PaoDianRankVo}();__reflect(PaoDianRankVo.prototype,"PaoDianRankVo");var PeachSys=function(_super){__extends(PeachSys,_super);function PeachSys(){var _this=_super.call(this)||this;_this.buyTimes={};_this.opened=false;_this.end_time=0;_this.redP0=0;_this.redP1=0;_this.redP2=0;_this.sysId=PackageID.Peach;_this.regNetMsg(1,_this.postBuyTimes);_this.regNetMsg(2,_this.postGetPeachRes);_this.regNetMsg(3,_this.postSysOpenState);return _this}PeachSys.ins=function(){return _super.ins.call(this)};PeachSys.prototype.postBuyTimes=function(bytes){var count=bytes.readInt();for(var i=0;i<count;i++){var id=bytes.readInt();var times=bytes.readInt();this.buyTimes[id]=times}};PeachSys.prototype.getBuyTimes=function(id){if(id===void 0){id=1}return this.buyTimes&&this.buyTimes[id]||0};PeachSys.prototype.sendGetPeach=function(id){var bytes=this.getBytes(2);bytes.writeInt(id);this.sendToServer(bytes)};PeachSys.prototype.postGetPeachRes=function(bytes){var err_code=bytes.readInt();var id=bytes.readInt();console.log("postGetPeachRes err_code:"+err_code+" id:"+id);return err_code};PeachSys.prototype.postSysOpenState=function(bytes){var state=bytes.readByte();var time=bytes.readInt();this.opened=state>0;this.end_time=time;console.log("postSysOpenState open:"+state+" end_time:"+time)};PeachSys.prototype.isOpen=function(){return this.opened};PeachSys.prototype.getRedPoint=function(i){if(i===void 0){i=-1}this.redP0=UserBag.ins().canExchange(GlobalConfig.PeachBaseConfig.exchangeId,-1)?1:0;this.redP1=UserTask.ins().hasSevenDayTaskReward(GlobalConfig.PeachBaseConfig.taskId)?1:0;this.redP2=this.buyState(1)==eState.ok?1:0;if(i>=0&&i<=2){return this["redP"+i]}else{var sum=0;for(var i=0;i<=2;i++){sum+=this["redP"+i]}return sum}};PeachSys.prototype.buyState=function(id){if(id===void 0){id=1}var cfg=GlobalConfig.PeachStoreConfig[id];var limit=cfg.times||-1;var buyTimes=this.getBuyTimes(cfg.id);var b=limit>-1&&buyTimes<limit||limit==-1;return b?eState.ok:eState.no};return PeachSys}(BaseSystem);__reflect(PeachSys.prototype,"PeachSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.peachsys=PeachSys.ins.bind(PeachSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var loopMode;(function(loopMode){loopMode[loopMode["daily"]=1]="daily";loopMode[loopMode["cycle"]=2]="cycle"})(loopMode||(loopMode={}));window["loopMode"]=loopMode;var PeachExchangeItemRender=function(_super){__extends(PeachExchangeItemRender,_super);function PeachExchangeItemRender(){var _this=_super.call(this)||this;_this.skinName="peachExchangeItemSkin";return _this}PeachExchangeItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName;this.listVip.itemRenderer=ItemBaseVip;this.init()};PeachExchangeItemRender.prototype.init=function(){this.btnExchange.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};PeachExchangeItemRender.prototype.dataChanged=function(){if(!this.data){return}if(!this.data.config){return}var cfg=this.data.config;this.list.dataProvider=new eui.ArrayCollection(cfg.normal);this.listVip.dataProvider=new eui.ArrayCollection(cfg.vip);var state=this.data.state;var count=cfg.materials[0]["count"]||0;this.btnExchange.enabled=state==eState.ok;this.btnExchange.label=state==eState.ok?count.toString():i18n("PeachExchangeItemRender_0");this.redP();var disc=cfg.discount||100;this.discountGroup.visible=disc<100;this.discount.text=Math.floor(Math.min(100,disc)/10).toString();var limit=cfg.times||-1;this.type.text=cfg.type==loopMode.daily?i18n("PeachStoreItemRender_3"):i18n("PeachStoreItemRender_4");var t=UserBag.ins().getExchangedTimes(cfg.id,cfg.eid);if(limit>-1){this.limitGroup.visible=true;this.unlimitGroup.visible=false;this.limit.text=t+"/"+limit}else{this.limitGroup.visible=false;this.unlimitGroup.visible=true}};PeachExchangeItemRender.prototype.redP=function(){var cfg=this.data.config;var b=UserBag.ins().canExchange(cfg.id,cfg.eid);this.btnExchange["redPoint"].visible=b};PeachExchangeItemRender.prototype.onClick=function(){var cfg=this.data.config;UserBag.ins().sendExchange(cfg.id,cfg.eid)};PeachExchangeItemRender.prototype.onRemove=function(){this.btnExchange.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);TimerManager.ins().removeAll(this)};return PeachExchangeItemRender}(BaseItemRender);__reflect(PeachExchangeItemRender.prototype,"PeachExchangeItemRender");var PeachExchangePanel=function(_super){__extends(PeachExchangePanel,_super);function PeachExchangePanel(){var _this=_super.call(this)||this;_this.stateDic={};return _this}PeachExchangePanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=PeachExchangeItemRender;this.listVip.itemRenderer=ItemBaseVip;this.listVip0.itemRenderer=ItemBaseVip};PeachExchangePanel.prototype.open=function(){this.sysId=GlobalConfig.PeachBaseConfig.exchangeId;this.observe(UserBag.ins().postExchangeData,this.setWinData);this.observe(UserBag.ins().postItemAdd,this.itemchange);this.observe(UserBag.ins().postItemDel,this.itemchange);this.observe(UserBag.ins().postItemChange,this.itemchange);this.observe(UserBag.ins().postExchangeRes,this.result);this.addTouchEvent(this.btnVip,this.onClick);this.addTouchEvent(this.btnVip0,this.onClick);this.setWinData()};PeachExchangePanel.prototype.onClick=function(e){switch(e.target){case this.btnVip:case this.btnVip0:this.onVip();break}};PeachExchangePanel.prototype.onVip=function(){var lv=UserVip.ins().lv;if(lv>0){ViewManager.ins().open(VipWin);return}ViewManager.ins().open(Recharge1Win)};PeachExchangePanel.prototype.result=function(param){var err_code=param[0]||0;var id=param[1];if(id==this.sysId&&err_code!=0){if(err_code==2){this.noPeach()}}};PeachExchangePanel.prototype.noPeach=function(){var warnWin=WarnWin.show(i18n("PeachExchangePanel_0"),function(){ViewManager.ins().open(PeachWin,2)},this,function(){ViewManager.ins().open(PeachWin,1)},this);warnWin.setBtnLabel(i18n("PeachExchangePanel_2"),i18n("PeachExchangePanel_1"))};PeachExchangePanel.prototype.itemchange=function(){for(var i=0;i<this.list.dataProvider.length;i++){var item=this.list.getVirtualElementAt(i);if(item){item.redP()}}};PeachExchangePanel.prototype.setWinData=function(){var config=GlobalConfig.ItemExchangeConfig[this.sysId];var dataArr=[];for(var k in config){var eid_1=config[k].eid;var state=UserBag.ins().getExchangeState(this.sysId,eid_1);dataArr.push({config:config[k],state:state})}dataArr=dataArr.sort(this.sort);this.list.dataProvider=new eui.ArrayCollection(dataArr);var isVip=UserVip.ins().lv>0||ChannelMgr.ins().isRechargeHidden();this.vipGroup.visible=!isVip;this.scroller.bottom=isVip?0:80;if(isVip){return}var eids=UserBag.ins().getExchangeRecord(this.sysId);this.btnVip.label=eids.length>0?i18n("PeachExchangePanel_3"):i18n("PeachExchangePanel_4");this.noRecord.visible=eids.length==0;this.hasRecord.visible=eids.length>0;var award=[];var keys=[];for(var _i=0,eids_1=eids;_i<eids_1.length;_i++){var eid=eids_1[_i];var vip=config[eid].vip;for(var _a=0,vip_1=vip;_a<vip_1.length;_a++){var v=vip_1[_a];var i=keys.indexOf(v.id);if(i<0){award.push(deepCopy(v));keys.push(v.id)}else{award[i].count+=v.count}}}this.listVip.dataProvider=new eui.ArrayCollection(award);this.listVip0.dataProvider=new eui.ArrayCollection(award);this.group3.visible=award.length<4;this.group4.visible=award.length>=4};PeachExchangePanel.prototype.sort=function(a,b){var eid1=a.config.eid;var eid2=b.config.eid;var state1=a.state;var state2=b.state;if(state1==eState.ok&&state2==eState.no){return-1}else if(state1==eState.no&&state2==eState.ok){return 1}if(eid1>eid2)return 1;else if(eid1<eid2)return-1;else return 0};PeachExchangePanel.prototype.close=function(){};return PeachExchangePanel}(BaseEuiView);__reflect(PeachExchangePanel.prototype,"PeachExchangePanel");var PeachStoreItemRender=function(_super){__extends(PeachStoreItemRender,_super);function PeachStoreItemRender(){var _this=_super.call(this)||this;_this.skinName="peachStoreItemSkin";return _this}PeachStoreItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.init()};PeachStoreItemRender.prototype.init=function(){this.btnFree.addEventListener(egret.TouchEvent.TOUCH_END,this.onFreeClick,this);this.btnYB.addEventListener(egret.TouchEvent.TOUCH_END,this.onYBClick,this);this.btnRMB.addEventListener(egret.TouchEvent.TOUCH_END,this.onRMBClick,this)};PeachStoreItemRender.prototype.dataChanged=function(){if(!this.data){return}if(!this.data.config){return}var cfg=this.data.config;this.itemName.text=cfg.name;this.iconImg.source=cfg.icon;var type=1;var yb=cfg.yb||0;var rechargeId=cfg.rechargeId||0;var disc=cfg.discount||100;var limit=cfg.times||-1;var buyTimes=PeachSys.ins().getBuyTimes(cfg.id);this.redPoint.visible=false;this.discountGroup.visible=disc<100;this.discount.text=Math.floor(Math.min(100,disc)/10).toString();this.price.visible=(cfg.originPrice||0)>0;this.originPrice.text=i18n("PeachStoreItemRender_1",cfg.originPrice);if(ChannelMgr.ins().isAnQiGeChannel()&&rechargeId>0){var rcfg=GlobalConfig.RechargeItemsConfig[rechargeId];this.originPrice.text=i18n("PeachStoreItemRender_1",Math.floor(rcfg.channel_20121_NT/cfg.discount*100))}if(yb==0&&rechargeId==0){type=1;this.btnFree.enabled=this.data.state==eState.ok;this.redPoint.visible=this.btnFree.enabled}else if(yb>0){type=2;this.btnYB.enabled=this.data.state==eState.ok;this.btnYB["yb"].text=yb}else if(rechargeId>0){type=3;var rcfg=GlobalConfig.RechargeItemsConfig[rechargeId];this.btnRMB.label=i18n("PeachStoreItemRender_0",rcfg.cash);this.btnRMB.enabled=this.data.state==eState.ok;if(ChannelMgr.ins().isAnQiGeChannel()){this.btnRMB.label=i18n("PeachStoreItemRender_6",rcfg.channel_20121_NT)}}if(yb==0&&rechargeId==0){this.type.text=i18n("PeachStoreItemRender_2")}else{this.type.text=cfg.type==loopMode.daily?i18n("PeachStoreItemRender_3"):i18n("PeachStoreItemRender_4")}if(limit>-1){this.limit.textFlow=TextFlowMaker.generateTextFlow(i18n("PeachStoreItemRender_5",buyTimes,limit))}else{this.limit.text=""}this.btnFree.visible=type==1;this.btnYB.visible=type==2;this.btnRMB.visible=type==3};PeachStoreItemRender.prototype.onFreeClick=function(){var cfg=this.data.config;PeachSys.ins().sendGetPeach(cfg.id)};PeachStoreItemRender.prototype.onYBClick=function(){this.onFreeClick()};PeachStoreItemRender.prototype.onRMBClick=function(){var cfg=this.data.config;Recharge.ins().showReCharge(cfg.rechargeId)};PeachStoreItemRender.prototype.onRemove=function(){this.btnFree.removeEventListener(egret.TouchEvent.TOUCH_END,this.onFreeClick,this);this.btnYB.removeEventListener(egret.TouchEvent.TOUCH_END,this.onYBClick,this);this.btnRMB.removeEventListener(egret.TouchEvent.TOUCH_END,this.onRMBClick,this);TimerManager.ins().removeAll(this)};return PeachStoreItemRender}(BaseItemRender);__reflect(PeachStoreItemRender.prototype,"PeachStoreItemRender");var PeachStorePanel=function(_super){__extends(PeachStorePanel,_super);function PeachStorePanel(){return _super.call(this)||this}PeachStorePanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=PeachStoreItemRender};PeachStorePanel.prototype.open=function(){this.observe(PeachSys.ins().postBuyTimes,this.setWinData);this.observe(PeachSys.ins().postGetPeachRes,this.result);this.setWinData()};PeachStorePanel.prototype.result=function(param){var err_code=param||0;if(err_code==2){this.noYB()}};PeachStorePanel.prototype.noYB=function(){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("PeachStorePanel_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,this);warnWin.setBtnLabel(i18n("PeachStorePanel_2"),i18n("PeachStorePanel_1"))};PeachStorePanel.prototype.setWinData=function(){var config=GlobalConfig.PeachStoreConfig;var dataArr=[];for(var k in config){var state=PeachSys.ins().buyState(config[k].id);var h=ChannelMgr.ins().isRechargeHidden();if(h&&config[k].rechargeId<=0||!h){dataArr.push({config:config[k],state:state})}}dataArr=dataArr.sort(this.sort);this.list.dataProvider=new eui.ArrayCollection(dataArr)};PeachStorePanel.prototype.sort=function(a,b){var id1=a.config.id;var id2=b.config.id;var state1=a.state;var state2=b.state;if(state1==eState.ok&&state2==eState.no){return-1}else if(state1==eState.no&&state2==eState.ok){return 1}if(id1>id2)return 1;else if(id1<id2)return-1;else return 0};PeachStorePanel.prototype.close=function(){};return PeachStorePanel}(BaseEuiView);__reflect(PeachStorePanel.prototype,"PeachStorePanel");var PeachTaskItemRender=function(_super){__extends(PeachTaskItemRender,_super);function PeachTaskItemRender(){var _this=_super.call(this)||this;_this.skinName="peachTaskItemSkin";return _this}PeachTaskItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName;this.init();this.setMC()};PeachTaskItemRender.prototype.init=function(){this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this)};PeachTaskItemRender.prototype.dataChanged=function(){if(!this.data){return}if(!this.data.config){return}var r=this.data;switch(r.state){case 0:this.btnGet.enabled=true;this.btnGet.label=i18n("PeachTaskItemRender_0");break;case 1:this.btnGet.enabled=true;this.btnGet.label=i18n("PeachTaskItemRender_1");break;case 2:this.btnGet.enabled=false;this.btnGet.label=i18n("PeachTaskItemRender_2");break;case 3:this.btnGet.enabled=false;this.btnGet.label=i18n("PeachTaskItemRender_3");break;case 4:this.btnGet.enabled=false;this.btnGet.label=i18n("PeachTaskItemRender_4");break}this.eff.visible=this.redPoint.visible=r.state==1;this.info.text=i18n("PeachTaskItemRender_5",r.config.desc,r.data.value,r.config.target);this.list.dataProvider=new eui.ArrayCollection(r.config.awardList.slice());this.type.source=r.daily_reset==1?"p_day1":"p_day7";this.bg.source=r.daily_reset==1?"scitembg":"marry_gift2";this.bg.scale9Grid=r.daily_reset==1?new egret.Rectangle(25,27,19,13):new egret.Rectangle(77,36,35,76)};PeachTaskItemRender.prototype.onTap=function(e){var r=this.data;switch(e.currentTarget){case this.btnGet:if(r.state==0){if(!r.config.controlTarget)return;var cls=egret.getDefinitionByName(r.config.controlTarget[0]);if(!cls)return;ViewManager.ins().close(PeachWin);(_a=ViewManager.ins()).open.apply(_a,[cls].concat(r.config.controlTarget.slice(1)))}else if(r.state==1){UserTask.ins().getSevenDayTaskReward(r.config.id)}break}var _a};PeachTaskItemRender.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=51;this.mc.y=20;this.mc.width=102;this.mc.height=46;this.mc.scaleX=.66;this.mc.scaleY=.78;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.eff.addChild(this.mc)}};return PeachTaskItemRender}(BaseItemRender);__reflect(PeachTaskItemRender.prototype,"PeachTaskItemRender");var PeachTaskPanel=function(_super){__extends(PeachTaskPanel,_super);function PeachTaskPanel(){return _super.call(this)||this}PeachTaskPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.listDay.itemRenderer=PeachTaskItemRender;this.listWeek.itemRenderer=PeachTaskItemRender};PeachTaskPanel.prototype.open=function(){this.sysId=GlobalConfig.PeachBaseConfig.exchangeId;this.observe(UserTask.ins().postSevenDayTasks,this.setWinData);this.setWinData();if(!TimerManager.ins().isExists(this.updateTime,this)){this.updateTime();TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}};PeachTaskPanel.prototype.updateTime=function(){var totalNum=1*DateUtils.SECOND_PER_DAY;var left=totalNum-DateUtils.getTodayPassedSecond();this.timeTxtDay.text=DateUtils.getFormatBySecond(left,DateUtils.TIME_FORMAT_1,4)};PeachTaskPanel.prototype.setWeekTime=function(txt){if(this.timeTxtWeek){this.timeTxtWeek.text=txt}};PeachTaskPanel.prototype.setWinData=function(){var ids1=[];var ids2=[];var config=GlobalConfig.SystemTaskConfig[this.sysId][UserTask.ACTIVATE_TYPE_LOOP];var arr1=[];var arr2=[];for(var k in config){var daily_reset=config[k].daily_reset;var task_ids=config[k].task_ids;if(daily_reset==1){for(var _i=0,task_ids_1=task_ids;_i<task_ids_1.length;_i++){var v=task_ids_1[_i];ids1.push(v)}}else{for(var _a=0,task_ids_2=task_ids;_a<task_ids_2.length;_a++){var v=task_ids_2[_a];ids2.push(v)}}}var dCfg=GlobalConfig.DailyConfig;for(var _b=0,ids1_1=ids1;_b<ids1_1.length;_b++){var id=ids1_1[_b];var data=UserTask.ins().getSevenDayTaskById(id);if(!data)continue;arr1.push({config:dCfg[id],state:data.state,data:data,daily_reset:1})}for(var _c=0,ids2_1=ids2;_c<ids2_1.length;_c++){var id=ids2_1[_c];var data=UserTask.ins().getSevenDayTaskById(id);if(!data)continue;arr2.push({config:dCfg[id],state:data.state,data:data,daily_reset:0})}arr1=arr1.sort(this.sort);arr2=arr2.sort(this.sort);this.listDay.dataProvider=new eui.ArrayCollection(arr1);this.listWeek.dataProvider=new eui.ArrayCollection(arr2)};PeachTaskPanel.prototype.sort=function(a,b){var id1=a.config.id;var id2=b.config.id;var state1=a.state;var state2=b.state;if(state1==1&&state2!=1){return-1}else if(state1!=1&&state2==1){return 1}if(state1!=1&&state2!=1){if(state1>state2){return 1}else if(state1<state2){return-1}}if(id1>id2)return 1;else if(id1<id2)return-1;else return 0};PeachTaskPanel.prototype.close=function(){TimerManager.ins().removeAll(this)};return PeachTaskPanel}(BaseEuiView);__reflect(PeachTaskPanel.prototype,"PeachTaskPanel");var PeachVipTip=function(_super){__extends(PeachVipTip,_super);function PeachVipTip(){var _this=_super.call(this)||this;_this.skinName="peachVipTipSkin";return _this}PeachVipTip.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseVip};PeachVipTip.prototype.open=function(params){this.sysId=GlobalConfig.PeachBaseConfig.exchangeId;this.eids=params||[];this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.btnCharge,this.onTap);this.setWinData()};PeachVipTip.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.btnCharge:ViewManager.ins().close(this);ViewManager.ins().open(Recharge1Win);break}};PeachVipTip.prototype.setWinData=function(){var config=GlobalConfig.ItemExchangeConfig[this.sysId];var award=[];var keys=[];for(var _i=0,_a=this.eids;_i<_a.length;_i++){var eid=_a[_i];var vip=config[eid].vip;for(var _b=0,vip_2=vip;_b<vip_2.length;_b++){var v=vip_2[_b];var i=keys.indexOf(v.id);if(i<0){award.push(deepCopy(v));keys.push(v.id)}else{award[i].count+=v.count}}}this.list.dataProvider=new eui.ArrayCollection(award)};PeachVipTip.prototype.close=function(){};return PeachVipTip}(BaseEuiView);__reflect(PeachVipTip.prototype,"PeachVipTip");ViewManager.ins().reg(PeachVipTip,LayerManager.UI_Popup);var PeachWin=function(_super){__extends(PeachWin,_super);function PeachWin(){var _this=_super.call(this)||this;_this.skinName="peachSkin";_this.isTopLevel=true;return _this}PeachWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};PeachWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=param[0]?param[0]:0;this.addTouchEndEvent(this,this.onTouch);this.addChangeEvent(this.tab,this.onTabTouch);this.setOpenIndex(this.oldIndex);this.observe(UserBag.ins().postExchangeData,this.updateRed);this.observe(UserBag.ins().postItemAdd,this.itemChange);this.observe(UserBag.ins().postItemDel,this.itemChange);this.observe(UserBag.ins().postItemChange,this.itemChange);this.checkState()};PeachWin.prototype.checkState=function(){this.itemChange();if(!TimerManager.ins().isExists(this.updateTime,this)){this.updateTime();TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}};PeachWin.prototype.close=function(){TimerManager.ins().removeAll(this)};PeachWin.prototype.itemChange=function(){var id=GlobalConfig.PeachBaseConfig.costItemId;var isHave=UserBag.ins().getBagGoodsCountById(0,id);this.peachNum.text=isHave.toString();this.updateRed()};PeachWin.prototype.updateTime=function(){var end_time=PeachSys.ins().end_time;var left=Math.floor((DateUtils.formatMiniDateTime(end_time)-GameServer.serverTime)/1e3);left=Math.max(0,left);this.timeTxt.text=DateUtils.getFormatBySecond(left,DateUtils.TIME_FORMAT_5,3);this.task.setWeekTime(DateUtils.getFormatBySecond(left,DateUtils.TIME_FORMAT_1,3))};PeachWin.prototype.onTabTouch=function(e){var index=this.tab.selectedIndex;this.setOpenIndex(index)};PeachWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[55].text);break}};PeachWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case 0:this.exchange.open();this.infoImg.source="p_exchange";break;case 1:this.task.open();this.infoImg.source="p_task";break;case 2:this.store.open();this.infoImg.source="p_store";break}if(this.oldIndex!=selectedIndex){this.viewStack.getElementAt(this.oldIndex)["close"]();this.oldIndex=selectedIndex}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}};PeachWin.prototype.updateRed=function(){this.redPoint0.visible=PeachSys.ins().getRedPoint(0)>0;this.redPoint1.visible=PeachSys.ins().getRedPoint(1)>0;this.redPoint2.visible=PeachSys.ins().getRedPoint(2)>0};return PeachWin}(BaseEuiView);__reflect(PeachWin.prototype,"PeachWin");ViewManager.ins().reg(PeachWin,LayerManager.UI_Main);var LoadingScene=function(_super){__extends(LoadingScene,_super);function LoadingScene(){return _super.call(this)||this}return LoadingScene}(BaseScene);__reflect(LoadingScene.prototype,"LoadingScene");var PlatFormID=function(){function PlatFormID(){}PlatFormID.SDK_TYPE=window["ourPlatform"];PlatFormID.WAN_BA="WAN_BA";PlatFormID.QQ_BROWSER=2000001+"";PlatFormID.ZHI_SHANG=2000003+"";PlatFormID.FENG_KUANG=2000004+"";PlatFormID.AI_WEI_YOU=2000005+"";PlatFormID.GE_TUI=2000006+"";PlatFormID.XIN_LANG=2000007+"";PlatFormID.$9G=2000012+"";PlatFormID.QUN_HEI=2000013+"";PlatFormID.$1758=2000014+"";return PlatFormID}();__reflect(PlatFormID.prototype,"PlatFormID");var Socket=function(_super){__extends(Socket,_super);function Socket(){var _this=_super.call(this)||this;_this._needReconnect=false;_this._maxReconnectCount=10;_this._reconnectCount=0;return _this}Socket.prototype.addEvents=function(){this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this);this._socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this);this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this);this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)};Socket.prototype.removeEvents=function(){this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this);this._socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this);this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this);this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)};Socket.prototype.onSocketOpen=function(){this._reconnectCount=0;if(this._connectFlag){MessageCenter.ins().dispatch(SocketConst.SOCKET_RECONNECT)}else{MessageCenter.ins().dispatch(SocketConst.SOCKET_CONNECT)}this._connectFlag=true;this._isConnecting=true};Socket.prototype.onSocketClose=function(){if(this._needReconnect){this.reconnect();MessageCenter.ins().dispatch(SocketConst.SOCKET_START_RECONNECT)}else{MessageCenter.ins().dispatch(SocketConst.SOCKET_CLOSE)}this._isConnecting=false};Socket.prototype.onSocketError=function(){if(this._needReconnect){this.reconnect()}else{MessageCenter.ins().dispatch(SocketConst.SOCKET_NOCONNECT)}this._isConnecting=false};Socket.prototype.onReceiveMessage=function(e){this._msg.receive(this._socket)};Socket.prototype.initServer=function(host,port,msg){this._host=host;this._port=port;this._msg=msg};Socket.prototype.connect=function(){if(DeviceUtils.IsHtml5){if(!window["WebSocket"]){Log.trace(i18n("Socket_0"));return}}this._socket=new egret.WebSocket;if(this._msg instanceof ByteArrayMsg){this._socket.type=egret.WebSocket.TYPE_BINARY}Log.trace("WebSocket: "+this._host+":"+this._port);this._socket.connect(this._host,this._port);this.addEvents()};Socket.prototype.reconnect=function(){this.close();this._reconnectCount++;if(this._reconnectCount<this._maxReconnectCount){this.connect()}else{this._reconnectCount=0;if(this._connectFlag){MessageCenter.ins().dispatch(SocketConst.SOCKET_CLOSE)}else{MessageCenter.ins().dispatch(SocketConst.SOCKET_NOCONNECT)}}};Socket.prototype.send=function(msg){this._msg.send(this._socket,msg)};Socket.prototype.close=function(){this.removeEvents();this._socket.close();this._socket=null;this._isConnecting=false;this._connectFlag=false};Socket.prototype.isConnecting=function(){return this._isConnecting};Socket.prototype.debugInfo=function(str){MessageCenter.ins().dispatch(SocketConst.SOCKET_DEBUG_INFO,str)};return Socket}(BaseClass);__reflect(Socket.prototype,"Socket");var WanbaLoading=function(_super){__extends(WanbaLoading,_super);function WanbaLoading(){return _super.call(this)||this}WanbaLoading.prototype.init=function(){this.bg=new eui.Image;this.bg.source=RES.getRes("wbbg_jpg");this.addChildAt(this.bg,0);this.progress=new eui.Image;this.progress.width=.1;this.progress.source=RES.getRes("wbProgress_png");this.progress.scale9Grid=new egret.Rectangle(5,2,3,1);this.progress.x=110;this.progress.y=583;this.addChild(this.progress);this.icon=new eui.Image;this.icon.source=RES.getRes("wbIcon_png");this.icon.anchorOffsetX=21>>1;this.icon.anchorOffsetY=11;this.icon.x=this.progress.x+this.progress.width;this.icon.y=this.progress.y+(this.progress.height>>1);this.addChild(this.icon)};WanbaLoading.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}egret.startTick(this.iconRotation,this)};WanbaLoading.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}egret.stopTick(this.iconRotation,this)};WanbaLoading.prototype.iconRotation=function(time){this.icon.rotation+=5;return false};WanbaLoading.prototype.setProgress=function(current,total){var p=current/total;this.progress.width=257*p;this.icon.x=this.progress.x+this.progress.width;this.icon.y=this.progress.y+(this.progress.height>>1)};return WanbaLoading}(LoadingView);__reflect(WanbaLoading.prototype,"WanbaLoading");var PfActivity=function(_super){__extends(PfActivity,_super);function PfActivity(){var _this=_super.call(this)||this;_this.wxInviteCount=0;_this.focusState=-1;_this.shareState=-1;_this.isShowGameDesktop=0;_this.sysId=PackageID.pfActivity;_this.regNetMsg(1,_this.doWanBaGift);_this.regNetMsg(3,_this.doZhiShangData);_this.regNetMsg(4,_this.doWeiXinInviteGift);return _this}PfActivity.ins=function(){return _super.ins.call(this)};PfActivity.prototype.initLogin=function(){this.sendWanBaGift()};PfActivity.prototype.postGuanZhu=function(code){this.focusState=code;if(this.focusState==1)this.sendGuanZhuGift()};PfActivity.prototype.postShare=function(code){this.shareState=code};PfActivity.prototype.postGameDesktop=function(status){this.isShowGameDesktop=status;return status};PfActivity.prototype.saveGameDesktop=function(){var _this=this;window["saveGameDesktop"](function(){SysSetting.ins().setValue("isSaveGameDesktop",1);_this.postGameDesktop(0)})};PfActivity.prototype.doWanBaGift=function(bytes){ViewManager.ins().open(WanBaGiftWin,bytes.readByte(),bytes.readBoolean())};PfActivity.prototype.sendWanBaGift=function(){if(!LocationProperty.gifi)return;this.sendBaseProto(1)};PfActivity.prototype.sendGuanZhuGift=function(){this.sendBaseProto(2)};PfActivity.prototype.doZhiShangData=function(bytes){if(LocationProperty.appid!=PlatFormID.ZHI_SHANG)return;ReportData.getIns().reportUrl(LocationProperty.callUrl)};PfActivity.prototype.sendWeiXinInviteGift=function(){this.sendBaseProto(4)};PfActivity.prototype.doWeiXinInviteGift=function(bytes){PfActivity.ins().wxInviteCount=bytes.readInt();PfActivity.ins().inviteTime=bytes.readInt();this.postInviteInfoUpdate()};PfActivity.prototype.postInviteInfoUpdate=function(){};PfActivity.prototype.copyMsgToBoard=function(msg){if(document&&document.createElement){var input=document.createElement("input");input.value=msg;document.body.appendChild(input);input.select();input.setSelectionRange(0,input.value.length);document.execCommand("Copy");document.body.removeChild(input);return true}return false};return PfActivity}(BaseSystem);__reflect(PfActivity.prototype,"PfActivity");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.pfactivity=PfActivity.ins.bind(PfActivity)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var FocusWin=function(_super){__extends(FocusWin,_super);function FocusWin(){var _this=_super.call(this)||this;_this.skinName="UpToDesktopSkin";return _this}FocusWin.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.focusBtn,this.onTap);this.initList()};FocusWin.prototype.initList=function(){var award=GlobalConfig.WeiXiGuanZhuConst.awards;this.reward.itemRenderer=ItemBase;this.reward.dataProvider=new eui.ArrayCollection(award)};FocusWin.prototype.onTap=function(e){var tar=e.currentTarget;switch(tar){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.focusBtn:window["showQRCode"]&&window["showQRCode"]();ViewManager.ins().close(this);break}};return FocusWin}(BaseEuiView);__reflect(FocusWin.prototype,"FocusWin");ViewManager.ins().reg(FocusWin,LayerManager.UI_Popup);var FranchiseWin=function(_super){__extends(FranchiseWin,_super);function FranchiseWin(){var _this=_super.call(this)||this;_this.skinName="SpecialCardSkin";return _this}FranchiseWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Recharge.ins().postFranchiseInfo,this.setView);this.addTouchEvent(this.btn1,this.onTap);this.addTouchEvent(this.btnDetail,this.onTap);if(ChannelMgr.ins().isAnQiGeChannel()){this.btn1.label=i18n("FranchiseWin_4")}if(this.feng.visible){this.btn1.visible=false;if(this.first)this.first.visible=false}else{if(Recharge.ins().franchise>0){TimerManager.ins().doTimer(1e3,0,this.setTimeLbel,this);this.setTimeLbel();this.btn1.visible=true;this.setView()}else{this.btn1.visible=true;TimerManager.ins().remove(this.setTimeLbel,this);if(this.first)this.first.visible=true}this.leftTime.visible=Recharge.ins().franchise>0?true:false}this.setIconEff();this.depictLabel.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PrivilegeData.rightDesc);Recharge.ins().initAsPay()};FranchiseWin.prototype.setView=function(){if(!Recharge.ins().franchiseget){this.btn1.label=i18n("FranchiseWin_0");this.btn1.currentState="disabled";this.btn1.touchEnabled=false}else{this.btn1.currentState="up";this.btn1.touchEnabled=true;this.btn1.label=i18n("FranchiseWin_1")}if(this.first)this.first.visible=false};FranchiseWin.prototype.setTimeLbel=function(){var endedTime=Recharge.ins().franchise;var str=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,1);str=i18n("FranchiseWin_2",str);this.leftTime.textFlow=(new egret.HtmlTextParser).parser(str)};FranchiseWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();this.removeTouchEvent(this.btn1,this.onTap);TimerManager.ins().remove(this.setTimeLbel,this)};FranchiseWin.prototype.onTap=function(e){switch(e.currentTarget){case this.btn1:if(this.btn1.label!=i18n("FranchiseWin_3"))Recharge.ins().showReCharge(1001);else Recharge.ins().sendGetFranchise();break;case this.btnDetail:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[71].text);break}};FranchiseWin.prototype.setIconEff=function(){var config=GlobalConfig.TitleConf[17];if(!config)return;if(config.eff){if(!this.mc)this.mc=new MovieClip;if(!this.mc.parent)this.titleMcGroup.addChild(this.mc);this.mc.playFile(RES_DIR_EFF+"chenghaozztq_big",-1)}else{if(!this.titleImg)this.titleImg=new eui.Image(config.img);if(!this.titleImg.parent)this.titleMcGroup.addChild(this.titleImg)}var power=0;power=UserBag.getAttrPower(config.attrs)*3;this.powerPanel.setPower(power)};return FranchiseWin}(BaseView);__reflect(FranchiseWin.prototype,"FranchiseWin");var MonthCardWin=function(_super){__extends(MonthCardWin,_super);function MonthCardWin(){var _this=_super.call(this)||this;_this.skinName="MonthCardSkin";return _this}MonthCardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Recharge.ins().postUpdateRecharge,this.setView);this.observe(Recharge.ins().postGetMonthDay,this.setView);this.addTouchEvent(this.btn1,this.onTap);if(this.feng.visible){this.btn1.visible=false}else{this.setView()}if(ChannelMgr.ins().isAnQiGeChannel()){this.btn1.label=i18n("MonthCardWin_1")}if(ChannelMgr.ins().isWXSmallGameChannel()){this.btn1.label=i18n("MonthCardWin_2")}Recharge.ins().initAsPay();this.rewardList.itemRenderer=ItemBase;this.rewardList.dataProvider=new eui.ArrayCollection(GlobalConfig.MonthCardConfig.monthCardTotalRewardShow)};MonthCardWin.prototype.setView=function(){TimerManager.ins().remove(this.setTimeLbel,this);if(Recharge.ins().monthDay>0){TimerManager.ins().doTimer(1e3,0,this.setTimeLbel,this);this.setTimeLbel();this.btn1.visible=false}else{this.btn1.visible=true}this.leftTime.visible=Recharge.ins().monthDay>0?true:false};MonthCardWin.prototype.setTimeLbel=function(){var endedTime=Recharge.ins().monthDay;var str=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,1);str=i18n("MonthCardWin_0",str);this.leftTime.textFlow=(new egret.HtmlTextParser).parser(str)};MonthCardWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();this.removeTouchEvent(this.btn1,this.onTap);TimerManager.ins().remove(this.setTimeLbel,this)};MonthCardWin.prototype.onTap=function(e){var id=1e3;if(ChannelMgr.ins().isWXSmallGameChannel()){id=1016}switch(e.currentTarget){case this.btn1:Recharge.ins().showReCharge(id);break}};MonthCardWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("VipWin_13"));return false}return true};return MonthCardWin}(BaseView);__reflect(MonthCardWin.prototype,"MonthCardWin");var WanBaGiftWin=function(_super){__extends(WanBaGiftWin,_super);function WanBaGiftWin(){return _super.call(this)||this}WanBaGiftWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GiftNoticeSkin"};WanBaGiftWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var day=param[0];var result=param[1];this.currentState=result?"success":"fail";this.addTouchEvent(this.okBtn,this.onTap);var config=GlobalConfig.WanBaGiftbagBasic[day];var s="";for(var i=0;i<config.items.length;i++){if(config.items[i].type==0)s+=RewardData.getCurrencyName(config.items[i].id);else s+=GlobalConfig.ItemConfig[config.items[i].id].name;s+="×"+config.items[i].count;if(i+1<config.items.length)s+="、"}this.text.text=s};WanBaGiftWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.okBtn,this.onTap)};WanBaGiftWin.prototype.onTap=function(e){ViewManager.ins().close(this)};return WanBaGiftWin}(BaseEuiView);__reflect(WanBaGiftWin.prototype,"WanBaGiftWin");ViewManager.ins().reg(WanBaGiftWin,LayerManager.UI_Main);var WeiBoShareWin=function(_super){__extends(WeiBoShareWin,_super);function WeiBoShareWin(){return _super.call(this)||this}WeiBoShareWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WeiboShareSkin";this.input.textDisplay.size=16;this.input.textDisplay.lineSpacing=0;this.input.textDisplay.multiline=true;this.input.textDisplay.wordWrap=true;this.input.textDisplay.height=171;this.input.textDisplay.maxChars=40};WeiBoShareWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn1,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.fxBtn,this.onTap)};WeiBoShareWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn1,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.fxBtn,this.onTap)};WeiBoShareWin.prototype.onTap=function(e){switch(e.currentTarget){case this.fxBtn:if(this.input.text.length<=0){UserTips.ins().showTips(i18n("WeiBoShareWin_1"));return}window["weiboShare"](this.input.text,LocationProperty.openID,LocationProperty.openKey);case this.closeBtn1:case this.closeBtn:ViewManager.ins().close(this);break}};return WeiBoShareWin}(BaseEuiView);__reflect(WeiBoShareWin.prototype,"WeiBoShareWin");ViewManager.ins().reg(WeiBoShareWin,LayerManager.UI_Popup);var YqWin=function(_super){__extends(YqWin,_super);function YqWin(){return _super.call(this)||this}YqWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="InviteFriendsSkin"};YqWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateInfo();TimerManager.ins().doTimer(1e3,0,this.updateInfo,this);this.observe(PfActivity.ins().postInviteInfoUpdate,this.updateInfo);this.addTouchEvent(this.closeBtn1,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.fxBtn,this.onTap)};YqWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateInfo,this);this.removeTouchEvent(this.closeBtn1,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.fxBtn,this.onTap);this.removeObserve()};YqWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn1:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.fxBtn:ViewManager.ins().open(WeiBoShareWin);break}};YqWin.prototype.updateInfo=function(){if(PfActivity.ins().wxInviteCount>=3){ViewManager.ins().close(this);return}var allCount=3;this.count.text="("+PfActivity.ins().wxInviteCount+"/"+allCount+")";this.fxBtn.enabled=PfActivity.ins().wxInviteCount<allCount;var award=GlobalConfig.SDKConfig.shareReward;var data=award[0];if(data.type==0){this.icon.source=RewardData.getCurrencyRes(data.id)}else{var itemConfig=GlobalConfig.ItemConfig[data.id];if(itemConfig)this.icon.source=itemConfig.icon+"_png"}this.item.source=this.icon.source;this.ybCountTxt.text=""+data.count;if(PfActivity.ins().wxInviteCount){var t=DateUtils.formatMiniDateTime(PfActivity.ins().inviteTime)-GameServer.serverTime;this.time.text=t>0?DateUtils.getFormatBySecond(t/1e3)+i18n("YqWin_0"):""}else this.time.text=""};return YqWin}(BaseEuiView);__reflect(YqWin.prototype,"YqWin");ViewManager.ins().reg(YqWin,LayerManager.UI_Popup);var PlayerAttrManager=function(_super){__extends(PlayerAttrManager,_super);function PlayerAttrManager(){var _this=_super.call(this)||this;_this.moduleAry=[];_this.count=0;_this.roleIndex=0;_this.descAry=[];_this.attrData=[];_this.dressPower=0;_this.dressCount=9;_this.score=0;_this.power=0;_this.specialPower=0;_this.descAry.push(i18n("PlayerAttrManager_0"));_this.descAry.push(i18n("PlayerAttrManager_1"));_this.descAry.push(i18n("PlayerAttrManager_2"));_this.descAry.push(i18n("PlayerAttrManager_3"));_this.descAry.push(i18n("PlayerAttrManager_4"));_this.descAry.push(i18n("PlayerAttrManager_5"));_this.descAry.push(i18n("PlayerAttrManager_6"));_this.descAry.push(i18n("PlayerAttrManager_7"));_this.descAry.push(i18n("PlayerAttrManager_8"));_this.descAry.push(i18n("PlayerAttrManager_9"));_this.descAry.push(i18n("PlayerAttrManager_10"));_this.descAry.push(i18n("PlayerAttrManager_11"));_this.descAry.push(i18n("PlayerAttrManager_12"));_this.descAry.push(i18n("PlayerAttrManager_13"));_this.descAry.push(i18n("PlayerAttrManager_14"));_this.descAry.push(i18n("PlayerAttrManager_15"));_this.descAry.push(i18n("PlayerAttrManager_16"));_this.descAry.push(i18n("PlayerAttrManager_17"));_this.descAry.push(i18n("PlayerAttrManager_18"));_this.descAry.push(i18n("PlayerAttrManager_19"));_this.descAry.push(i18n("PlayerAttrManager_20"));_this.descAry.push(i18n("PlayerAttrManager_21"));_this.descAry.push(i18n("PlayerAttrManager_22"));_this.descAry.push(i18n("PlayerAttrManager_23"));_this.descAry.push(i18n("PlayerAttrManager_24"));_this.descAry.push(i18n("PlayerAttrManager_25"));_this.descAry.push("尊者");_this.descAry.push(i18n("PlayerAttrManager_26"));return _this}PlayerAttrManager.prototype.doSave=function(value,type,name){var blob;if(typeof window.Blob=="function"){blob=new Blob([value],{type:type})}else{var BlobBuilder=window["BlobBuilder"]||window["MozBlobBuilder"]||window["WebKitBlobBuilder"]||window["MSBlobBuilder"];var bb=new BlobBuilder;bb.append(value);blob=bb.getBlob(type)}var URL=window.URL||window["webkitURL"];var bloburl=URL.createObjectURL(blob);var anchor=document.createElement("a");if("download"in anchor){anchor.style.visibility="hidden";anchor.href=bloburl;anchor.download=name;document.body.appendChild(anchor);var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,true);anchor.dispatchEvent(evt);document.body.removeChild(anchor)}else if(navigator.msSaveBlob){navigator.msSaveBlob(blob,name)}else{location.href=bloburl}};PlayerAttrManager.prototype.save=function(content,fileName){this.doSave(content,"text/latex",fileName+".txt")};PlayerAttrManager.prototype.getAttrStr=function(){var attr="";var count=this.attrData.length;for(var i=0;i<count;i++){var model=this.attrData[i];attr+=this.descAry[model.module]+"\t"+model.soldierPower+"\t"+model.magePower+"\t"+model.immortalPower+"\n"}return attr};PlayerAttrManager.prototype.getModuleIndex=function(moduleName){var count=this.descAry.length;for(var i=0;i<count;i++){if(this.descAry[i]==moduleName){return i}}return 0};PlayerAttrManager.prototype.updateData=function(moduleName,power,roleIndex){var index=this.getModuleIndex(moduleName);if(roleIndex==undefined){roleIndex=0}var dataIndex=SubRoles.ins().getSubRoleByIndex(roleIndex).job;var data=this.attrData[index];if(data==undefined){data=new PlayerAttrModel}switch(dataIndex){case JobConst.ZhanShi:data.soldierPower=power;break;case JobConst.FaShi:data.magePower=power;break;case JobConst.DaoShi:data.immortalPower=power;break}data.module=index;this.attrData[index]=data};PlayerAttrManager.prototype.isHaveRole=function(roleIndex){return roleIndex<SubRoles.ins().subRolesLen};PlayerAttrManager.prototype.getAttr=function(){var _this=this;ViewManager.ins().open(LiLianWin,3);TimerManager.ins().doTimerDelay(850,0,1,function(){_this.updateData(i18n("PlayerAttrManager_27"),Book.ins().getBookPowerNumEx());ViewManager.ins().close(LiLianWin)},this);TimerManager.ins().doTimerDelay(850,0,1,function(){ViewManager.ins().open(LiLianWin,2);TimerManager.ins().doTimerDelay(860,0,1,function(){var win=ViewManager.ins().getView(LiLianWin);_this.updateData(i18n("PlayerAttrManager_28"),win["xunzhangPanel"].getPower());ViewManager.ins().close(LiLianWin)},_this)},this);TimerManager.ins().doTimerDelay(1e3,0,1,function(){ViewManager.ins().open(LiLianWin,1)},this);TimerManager.ins().doTimerDelay(1150,0,1,function(){var count=parseInt(Artifact.ins().getMaxIndex()+"");var artifactPower=0;for(var i=0;i<count;i++){if(Artifact.ins().getNewArtifactBy(i+1).open||Artifact.ins().getNewArtifactPower(i+1)!=0){artifactPower+=Artifact.ins().getNewArtifactPower(i+1)}else{break}}_this.updateData(i18n("PlayerAttrManager_29"),artifactPower)},this);TimerManager.ins().doTimerDelay(1500,0,1,function(){ViewManager.ins().close(LiLianWin);ViewManager.ins().open(LiLianWin)},this);TimerManager.ins().doTimerDelay(1600,0,1,function(){_this.updateData(i18n("PlayerAttrManager_30"),LiLian.ins().getPower());ViewManager.ins().close(LiLianWin)},this);TimerManager.ins().doTimerDelay(1700,0,1,function(){ViewManager.ins().open(DressWin,0,3);TimerManager.ins().doTimerDelay(10,0,1,function(){_this.updateData(i18n("PlayerAttrManager_31"),Title.ins().getTotalPower(),0);ViewManager.ins().close(DressWin)},_this)},this);TimerManager.ins().doTimerDelay(1800,0,1,function(){ViewManager.ins().open(DressWin,1,3);TimerManager.ins().doTimerDelay(20,0,1,function(){_this.updateData(i18n("PlayerAttrManager_32"),Title.ins().getTotalPower(),1);ViewManager.ins().close(DressWin)},_this)},this);TimerManager.ins().doTimerDelay(1900,0,1,function(){ViewManager.ins().open(DressWin,2,3);TimerManager.ins().doTimerDelay(20,0,1,function(){_this.updateData(i18n("PlayerAttrManager_33"),Title.ins().getTotalPower(),2);ViewManager.ins().close(DressWin)},_this)},this);TimerManager.ins().doTimerDelay(2e3,0,1,function(){ViewManager.ins().open(GuildSkillWin,0);TimerManager.ins().doTimerDelay(20,0,1,function(){var win=ViewManager.ins().getView(GuildSkillWin);_this.updateData(i18n("PlayerAttrManager_34"),win.guildskill.getTotalPower(),0);ViewManager.ins().close(GuildSkillWin)},_this)},this);TimerManager.ins().doTimerDelay(2100,0,1,function(){ViewManager.ins().open(GuildSkillWin,1);TimerManager.ins().doTimerDelay(20,0,1,function(){var win=ViewManager.ins().getView(GuildSkillWin);_this.updateData(i18n("PlayerAttrManager_35"),win.guildskill.getTotalPower(),1);ViewManager.ins().close(GuildSkillWin)},_this)},this);TimerManager.ins().doTimerDelay(2200,0,1,function(){ViewManager.ins().open(GuildSkillWin,2);TimerManager.ins().doTimerDelay(20,0,1,function(){var win=ViewManager.ins().getView(GuildSkillWin);_this.updateData(i18n("PlayerAttrManager_36"),win.guildskill.getTotalPower(),2);ViewManager.ins().close(GuildSkillWin);ViewManager.ins().close(GuildMap);ViewManager.ins().open(RoleWin,0);_this.getRoleInfo()},_this)},this);this.updateData("尊者",this.getVipPower());var length=SubRoles.ins().subRolesLen;for(var i=0;i<length;i++){var job=SubRoles.ins().getSubRoleByIndex(i).job;var power=this.getRolePower(Actor.level,job);this.updateData(i18n("PlayerAttrManager_37"),power,i)}};PlayerAttrManager.prototype.getVipPower=function(){var power=0;if(UserVip.ins().lv>0){var cfg=GlobalConfig.VipConfig[UserVip.ins().lv];power=UserBag.getAttrPower(cfg.attrAddition)}return power};PlayerAttrManager.prototype.getRolePower=function(lv,job){var power=0;var cfg;for(var i in GlobalConfig.RoleConfig){if(i==lv.toString()){for(var j in GlobalConfig.RoleConfig[i]){if(j==job.toString()){cfg=GlobalConfig.RoleConfig[i][j];power=this.getAttrPower(cfg)}}}}return power};PlayerAttrManager.prototype.getAttrPower=function(data){var attr=[];attr.push(new AttributeData(AttributeType.atHp,data.hp));attr.push(new AttributeData(AttributeType.atMp,data.mp));attr.push(new AttributeData(AttributeType.atAttack,data.atk));attr.push(new AttributeData(AttributeType.atDef,data.def));attr.push(new AttributeData(AttributeType.atRes,data.res));attr.push(new AttributeData(AttributeType.atCrit,data.crit));attr.push(new AttributeData(AttributeType.atTough,data.tough));attr.push(new AttributeData(AttributeType.atAttackSpeed,data.as));attr.push(new AttributeData(AttributeType.atMoveSpeed,data.ms));var power=0;power=UserBag.getAttrPower(attr);return power};PlayerAttrManager.prototype.getRoleInfo=function(){var _this=this;TimerManager.ins().doTimerDelay(20,0,1,function(){var win=ViewManager.ins().getView(RoleWin);var rolePanel=win.roleInfoPanel;TimerManager.ins().doTimerDelay(10,0,1,function(){rolePanel["item"+_this.count].showPower();TimerManager.ins().doTimerDelay(20,0,1,function(){var tips=ViewManager.ins().getView(EquipDetailedWin);if(tips!=undefined){if(tips.getType()==i18n("PlayerAttrManager_38")){_this.updateData(i18n("PlayerAttrManager_39"),tips.getPower(),_this.roleIndex)}else{_this.score+=tips.getScore();_this.power+=tips.getPower()}ViewManager.ins().close(EquipDetailedWin)}_this.count++;if(_this.count<9){_this.getRoleInfo()}else{_this.updateData(i18n("PlayerAttrManager_40"),_this.power,_this.roleIndex);_this.updateData(i18n("PlayerAttrManager_41"),_this.score,_this.roleIndex);_this.count=0;_this.power=0;_this.score=0;_this.roleIndex++;ViewManager.ins().close(RoleWin);TimerManager.ins().doTimerDelay(20,0,1,function(){if(_this.roleIndex<3){ViewManager.ins().open(RoleWin,0,_this.roleIndex);_this.getRoleInfo()}else{_this.count=0;_this.roleIndex=0;_this.getSpecialRingPower()}},_this)}},_this)},_this)},this)};PlayerAttrManager.prototype.getSpecialRingPower=function(){var _this=this;ViewManager.ins().open(SpecialRingWin,this.count,this.roleIndex);TimerManager.ins().doTimerDelay(20,0,1,function(){var win=ViewManager.ins().getView(SpecialRingWin);TimerManager.ins().doTimerDelay(10,0,1,function(){_this.specialPower+=win.getPower();ViewManager.ins().close(SpecialRingWin);_this.count++;if(_this.count<2){_this.getSpecialRingPower()}else{_this.updateData(i18n("PlayerAttrManager_42"),_this.specialPower,_this.roleIndex);_this.specialPower=0;_this.count=0;_this.roleIndex++;TimerManager.ins().doTimerDelay(20,0,1,function(){if(_this.roleIndex<3){ViewManager.ins().open(SpecialRingWin,_this.count,_this.roleIndex);_this.getSpecialRingPower()}else{_this.count=0;_this.roleIndex=0;_this.delayRun()}},_this)}},_this)},this)};PlayerAttrManager.prototype.delayRun=function(){this.moduleAry.push({tips:i18n("PlayerAttrManager_43"),cls:FireRingWin});this.moduleAry.push({tips:i18n("PlayerAttrManager_44"),cls:FireRingWin,param:1});this.addRoleAttr({tips:i18n("PlayerAttrManager_45"),cls:TreasureWin});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_46"),cls:SkillWin,param:1});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_47"),cls:SkillWin,param:2});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_48"),cls:SkillWin,param:3});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_49"),cls:ForgeWin,param:0});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_50"),cls:ForgeWin,param:1});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_51"),cls:ForgeWin,param:2});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_52"),cls:ForgeWin,param:3});this.moduleAry.push({tips:i18n("PlayerAttrManager_53"),cls:RoleWin,param:1});this.moduleAry.push({tips:i18n("PlayerAttrManager_54"),cls:RoleWin,param:2});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_55"),cls:RoleWin,param:3});this.addRoleAttr({tips:i18n("PlayerAttrManager_56"),cls:HeirloomWin});this.addRoleAttr({tips:i18n("PlayerAttrManager_57"),cls:RuneWin});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_58"),cls:DressWin,param:0});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_59"),cls:DressWin,param:1});this.addRoleNextAttr({tips:i18n("PlayerAttrManager_60"),cls:DressWin,param:2});this.onGetAttr()};PlayerAttrManager.prototype.addRoleAttr=function(data){var length=SubRoles.ins().subRolesLen;for(var i=0;i<length;i++){this.moduleAry.push({tips:data.tips,cls:data.cls,roleIndex:i,param:i})}};PlayerAttrManager.prototype.addRoleNextAttr=function(data){var length=SubRoles.ins().subRolesLen;for(var i=0;i<length;i++){this.moduleAry.push({tips:data.tips,cls:data.cls,roleIndex:i,param:[data.param,i]})}};PlayerAttrManager.prototype.onGetAttr=function(){var _this=this;if(this.moduleAry.length){this.data=this.moduleAry.shift();if(this.data.param!=undefined){if(this.data.param instanceof Array){ViewManager.ins().open(this.data.cls,this.data.param[0],this.data.param[1])}else{ViewManager.ins().open(this.data.cls,this.data.param)}}else{ViewManager.ins().open(this.data.cls)}TimerManager.ins().doTimerDelay(100,0,1,function(){_this.getPlayerAttr()},this)}};PlayerAttrManager.prototype.getPlayerAttr=function(){var win=ViewManager.ins().getView(this.data.cls);this.getValue(win,this.data,this.data.cls);this.onGetAttr()};PlayerAttrManager.prototype.getValue=function(container,data,win){for(var i=0;i<container.numChildren;i++){var dis=container.getChildAt(i);if(dis instanceof PowerPanel){if(dis.visible){var roleIndex=0;if(this.data.roleIndex){roleIndex=this.data.roleIndex}if(this.data.tips==i18n("PlayerAttrManager_61")){this.dressCount--;this.dressPower+=dis.power;if(this.dressCount==0){this.updateData(this.data.tips,this.dressPower,roleIndex);this.dressPower=0;this.dressCount=9;this.save(this.getAttrStr(),i18n("PlayerAttrManager_62",Actor.myName))}}else{var power=0;if(dis.power){power=dis.power}this.updateData(this.data.tips,power,roleIndex)}}ViewManager.ins().close(win);return}else if(dis instanceof egret.DisplayObjectContainer){if(dis instanceof eui.ViewStack){var child=dis.selectedChild;if(child){this.getValue(child,data,win)}}else{this.getValue(dis,data,win)}}}ViewManager.ins().close(win)};PlayerAttrManager.ins=function(){return _super.ins.call(this)};return PlayerAttrManager}(BaseClass);__reflect(PlayerAttrManager.prototype,"PlayerAttrManager");var PlayerAttrModel=function(){function PlayerAttrModel(){this.module=0;this.soldierPower=0;this.magePower=0;this.immortalPower=0}return PlayerAttrModel}();__reflect(PlayerAttrModel.prototype,"PlayerAttrModel");var PlayFunShow;(function(PlayFunShow){PlayFunShow[PlayFunShow["topMain"]=1]="topMain";PlayFunShow[PlayFunShow["leftGroup"]=2]="leftGroup";PlayFunShow[PlayFunShow["rightGroup"]=4]="rightGroup";PlayFunShow[PlayFunShow["downGroup"]=8]="downGroup";PlayFunShow[PlayFunShow["topGroup"]=16]="topGroup"})(PlayFunShow||(PlayFunShow={}));window["PlayFunShow"]=PlayFunShow;var PlayFun=function(_super){__extends(PlayFun,_super);function PlayFun(){var _this=_super.call(this)||this;_this.showTipsObj=null;_this.observe(UserBoss.ins().postBossData,_this.publicBossRelive);_this.observe(UserFb.ins().postAddEnergy,_this.updateAutoPk);_this.observe(GameLogic.ins().postEnterMap,function(){var fbID=GameMap.fubenID;if(!CityCC.ins().isCity){if(!fbID||GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS){if(!ViewManager.ins().isShow(PlayFunView))ViewManager.ins().open(PlayFunView);if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS)_this.postShowViews(PlayFunShow.topMain);else _this.postShowViews(PlayFun.showAll);return}ViewManager.ins().close(PlayFunView)}EncounterFight.ins().isEncountering=false;EncounterFight.ins().encounterIndex=undefined});return _this}PlayFun.ins=function(){return _super.ins.call(this)};PlayFun.prototype.closeAuto=function(){var view=ViewManager.ins().getView(UIView2);if(view)view.autoPkBoss.selected=false;this.updateAutoPk()};PlayFun.prototype.openAuto=function(){var view=ViewManager.ins().getView(UIView2);if(view)view.autoPkBoss.selected=true;this.updateAutoPk()};PlayFun.prototype.publicBossRelive=function(params){var isShow=params[0];var bossName=params[1];var view=ViewManager.ins().getView(PlayFunView);if(view)view.publicBossRelive(isShow,bossName)};PlayFun.prototype.upDataWillBoss=function(id){var view=ViewManager.ins().getView(PlayFunView);if(view)view.upDataWillBoss(id)};PlayFun.prototype.updateAutoPk=function(){if(UserFb.ins().bossIsChallenged)return;var m=UserFb.ins().energy;var v=UserFb.ins().currentEnergy;var view=ViewManager.ins().getView(UIView2);if(view){view.checkGuanqiaBagFull()}if(view&&view.autoPkBoss.selected&&v>=m){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){view.autoPkBoss.selected=false;UserTips.ins().showTips(i18n("PlayFun_0"));this.removePkArrowTips()}else{if(UserFb.ins().guanqiaID<GlobalConfig.InstanceBaseConfig.maxCheckPoint){this.addPkArrowTips()}else{UserTips.ins().showCenterTips(i18n("PlayFun_1"));view.autoPkBoss.selected=false;this.removePkArrowTips()}}}else{this.removePkArrowTips()}};PlayFun.prototype.postShowViews=function(handle,reverse){if(reverse===void 0){reverse=false}return[handle,reverse]};PlayFun.prototype.addPkArrowTips=function(){var _this=this;var view=ViewManager.ins().getView(UIView2);if(view&&!this.showTipsObj){this.showTipsObj={};UserTips.ins().showTaskTips(i18n("PlayFun_2"));egret.Tween.get(this.showTipsObj).wait(1500).call(function(){if(view.autoPkBoss.selected){GameLogic.ins().startPkBoss();_this.removePkArrowTips()}})}};PlayFun.prototype.removePkArrowTips=function(){if(this.showTipsObj){egret.Tween.removeTweens(this.showTipsObj);this.showTipsObj=null}};PlayFun.showAll=PlayFunShow.topMain|PlayFunShow.leftGroup|PlayFunShow.rightGroup|PlayFunShow.downGroup|PlayFunShow.topGroup;return PlayFun}(BaseSystem);__reflect(PlayFun.prototype,"PlayFun");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.playfun=PlayFun.ins.bind(PlayFun)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var PlayFunView=function(_super){__extends(PlayFunView,_super);function PlayFunView(){var _this=_super.call(this)||this;_this.ruleList={};_this.ruleParent={};_this.ruleIdList={};_this.ruleEffBottom={};_this.btnEff={};_this.ruleEffTop={};_this.taskEffTypes=[];_this.preRecharge=false;_this.preVip=false;_this.reLoadIconIds=[6,12,14,15,16,21,34,39,40,41,51,55,58,66,68];_this.iconGroup_right0=15;_this.iconGroup_right1=-480;_this.iconGroup_y0=0;_this.iconGroup_y1=-240;_this.funcMcs=[];_this.value1=1;_this.isInWild=null;_this.touchEnabled=false;PlayFunView.instance=_this;PlayFunView.loadExpiredFuncTips();return _this}PlayFunView.prototype.destoryView=function(){};PlayFunView.prototype.initData=function(){CommonUtils.labelIsOverLenght(this.goldTxt,Actor.gold);CommonUtils.labelIsOverLenght(this.ybTxt,Actor.yb);this.nameTxt.text=Actor.myName;this.expChange();BitmapNumber.ins().changeNum(this.power,Actor.power,"8",5);this.vipNum.x=UserVip.ins().lv>=10?48+61-5:this.vipNum.x=48+61;this.vipNum.y=32+4;BitmapNumber.ins().changeNum(this.vipNum,UserVip.ins().lv,"zv0",8);this.upDataVipBtnRedPoint()};PlayFunView.prototype.readyUpdateHp=function(data){if(!data)return;if(data instanceof EntityModel){if(!data.isMy)return}else{if(!data[0].isMy)return}this.updateHp()};PlayFunView.prototype.updateHp=function(){var len=SubRoles.ins().subRolesLen;var value=0;var total=0;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role){var curHp=role.getAtt(AttributeType.atHp)||0;var maxHp=role.getAtt(AttributeType.atMaxHp)||0;value+=curHp;total+=maxHp}}if(value>total)value=total;this.greenBar.width=158*(value/total)};PlayFunView.prototype.updateHuShen=function(model){if(model&&model.team!=Team.My)return;var len=SubRoles.ins().subRolesLen;var role;var value=0;var total=0;for(var i=0;i<len;i++){role=SubRoles.ins().getSubRoleByIndex(i);value+=role.getAtt(AttributeType.atMp);total+=role.getAtt(AttributeType.atMaxMp)}if(value>total)value=total;this.blueBar.width=158*(value/total)};PlayFunView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="PlayFunSkin";this.showViewList={};this.showViewList[PlayFunShow.topMain]=this.topMain;this.showViewList[PlayFunShow.leftGroup]=this.leftGroup;this.showViewList[PlayFunShow.rightGroup]=this.rightGroup;this.showViewList[PlayFunShow.downGroup]=this.downGroup;this.showViewList[PlayFunShow.topGroup]=this.topGroup;this.rulePos={0:this.downGroup,1:this.iconGroup,2:this.leftGroup,3:this.rightGroup};this.iconGroup_right0=this.iconGroup.right;this.flameMC=new MovieClip;this.flameMC.x=100;this.flameMC.y=15;this.flameGroup.addChildAt(this.flameMC,1);this.greenBarMc=new MovieClip;this.greenBarMc.x=72.5;this.greenBarMc.y=7;this.greenBarGroup.addChild(this.greenBarMc);this.blueBarMc=new MovieClip;this.blueBarMc.x=72.5;this.blueBarMc.y=7;this.blueBarGroup.addChild(this.blueBarMc);this.vipMc=new MovieClip;this.vipMc.x=87;this.vipMc.y=47;this.vipMcGroup.addChild(this.vipMc);this.checkShowVip();this.power=BitmapNumber.ins().createNumPic(0,"8",5);this.power.x=this.fightImg.x+70;this.power.y=this.fightImg.y+4;this.flameGroup.addChild(this.power);this.taskAsseptMc=new MovieClip;this.taskAsseptMc.x=140;this.taskAsseptMc.y=-50;this.taskAsseptMc.touchEnabled=false;this.taskComMc=new MovieClip;this.taskComMc.x=140;this.taskComMc.y=-80;this.taskComMc.touchEnabled=false;var roleData=SubRoles.ins().getSubRoleByIndex(0);this.face.source="yuanhead"+roleData.job+roleData.sex;this.vipNum=BitmapNumber.ins().createNumPic(UserVip.ins().lv,"zv0",8);this.vipNum.x=UserVip.ins().lv>=10?48+61-5:this.vipNum.x=48+61;this.vipNum.y=32+4;this.vipNumGroup.addChild(this.vipNum);this.reliveBossArrow=new GuideArrow2;this.newBossRelive.addChild(this.reliveBossArrow);this.reliveBossArrow.setDirection(2);this.publicBossRelive(false);RuleIconBase.update=this.updateRule.bind(this);RuleIconBase.updateShow=this.updateRuleAndSort.bind(this);this.initRuleList();this.escortGrpY0=this.escortGrp.y;this.mineCaveGrpY0=this.mineCaveGrp.y;this.addTouchEvent(this.escortGrp,this.onTouchEscort);this.addTouchEvent(this.mineCaveGrp,this.onTouchMineCave);this.btnShapeShiftingEff=new MovieClip;this.btnShapeShiftingMc.addChild(this.btnShapeShiftingEff);this.btnShapeShiftingEff.touchEnabled=false;this.btnShowCityBoss.visible=false;this.initFuncTipBtn();this.qzVip.visible=false;this.datNFvip.visible=false};PlayFunView.prototype.checkShowVip=function(open){if(open===void 0){open=true}if(ChannelMgr.ins().isRechargeHidden()){this.vipGroup.visible=false}else{this.vipGroup.visible=true}};PlayFunView.prototype.onTouchEscort=function(){ViewManager.ins().open(LadderWin,3)};PlayFunView.prototype.onTouchMineCave=function(){ViewManager.ins().open(LadderWin,2)};PlayFunView.prototype.add0=function(i){var s=i.toString();if(s.length<2){s="0"+s}return s};PlayFunView.prototype.refreshEscortMine=function(){var hasEscort=EscortMgr.ins().hasEscort();this.escortGrp.visible=hasEscort;if(hasEscort){this.escortGrp.visible=true;var remainSecs=EscortMgr.ins().getRemainSeconds();var escortStr;var escortColor=7796265;if(remainSecs>0){escortStr=i18n("PlayFunView_0")+this.add0(Math.floor(remainSecs/60))+":"+this.add0(remainSecs%60);escortColor=13614335}else{escortStr=i18n("PlayFunView_1")}if(this.escortTxt.text!=escortStr){this.escortTxt.text=escortStr;this.escortTxt.textColor=escortColor}}var hasMine=Mine.ins().mineStartTime!=null&&Mine.ins().mineStartTime!=0;this.mineCaveGrp.visible=hasMine;if(hasMine){this.mineCaveGrp.visible=true;var remainSecs=Mine.ins().getRemainSeconds();var mineCaveStr;var mineCaveColor=7796265;if(remainSecs>0){mineCaveStr=i18n("PlayFunView_2")+this.add0(Math.floor(remainSecs/60))+":"+this.add0(remainSecs%60);mineCaveColor=13614335}else{mineCaveStr=i18n("PlayFunView_3")}if(this.mineCaveTxt.text!=mineCaveStr){this.mineCaveTxt.text=mineCaveStr;this.mineCaveTxt.textColor=mineCaveColor}}if(!hasEscort&&hasMine){this.mineCaveGrp.y=this.escortGrpY0}else{this.mineCaveGrp.y=this.mineCaveGrpY0}};PlayFunView.prototype.onShapeStart=function(param){var isMe=param;if(!isMe){return}if(ShapeShiftingMgr.ins().getIsInShape()==false){return}this.bianshenGroup.removeChildren();var job=ShapeShiftingMgr.ins().getShowJob();if(job==-1){return}var effRes="";switch(job){case JobConst.ZhanShi:effRes="bs_naneff";break;case JobConst.FaShi:effRes="bs_nveff";break;case JobConst.DaoShi:effRes="bs_nveff";break}var mc1=new MovieClip;this.bianshenGroup.addChild(mc1);mc1.playFile(RES_DIR_EFF+"bs_txbgeff",-1);var mc2=new MovieClip;this.bianshenGroup.addChild(mc2);mc2.playFile(RES_DIR_EFF+effRes,-1);this.bianshenGroup0.removeChildren();var mc3=new MovieClip;this.bianshenGroup0.addChild(mc3);mc3.playFile(RES_DIR_EFF+"bs_cxbgeff",1)};PlayFunView.prototype.onShapeEnd=function(){this.bianshenGroup.removeChildren();this.bianshenGroup0.removeChildren()};PlayFunView.prototype.initChapterGift=function(){var chapterlevel=UserFb.ins().guanqiaID;if(nPChapterGiftSys.ins().isCangetchapterGift()){this.newPlayerGroup.visible=true;this.addTouchEvent(this.nPgiftBtn,this.onTap)}else{this.newPlayerGroup.visible=false}};PlayFunView.prototype.ChapterGiftIconAni=function(){var _this=this;var t=egret.Tween.get(this.nPgiftBtn);t.to({rotation:20},200).to({rotation:-20},300).call(function(){egret.Tween.removeTweens(_this.nPgiftBtn);_this.ChapterGiftIconAni()});TimerManager.ins().remove(this.lightAni,this);TimerManager.ins().doTimer(100,0,this.lightAni,this)};PlayFunView.prototype.lightAni=function(){this.nPgiftLight.rotation+=10/600*360};PlayFunView.prototype.initRuleList=function(){var configs=GlobalConfig.PlayFunConfig;for(var id in configs){var config=configs[id];var cls=egret.getDefinitionByName(config.cls);if(!cls){alert(i18n("PlayFunView_4",id,config.cls))}else{this.addRuleList(new cls(config.id))}}this.addRuleList(new TaskTraceIconRule(0,this.taskTraceBtn));this.hejiRule=new HejiIconRule(0,this.hejiguide);this.addRuleList(this.hejiRule)};PlayFunView.prototype.addRuleList=function(rule){this.ruleList[rule.hashCode]=rule;if(rule.id){this.ruleIdList[rule.id]=rule}if(rule.tar&&rule.tar.parent){this.ruleParent[rule.hashCode]=rule.tar.parent;rule.tar.parent.removeChild(rule.tar)}else{var config=GlobalConfig.PlayFunConfig[rule.id];this.ruleParent[rule.hashCode]=this.rulePos[config.pos]}};PlayFunView.prototype.showViews=function(_a){var handle=_a[0],reverse=_a[1];var value=1;while(PlayFunShow[value]){var b=(handle&value)==value;this.showView(value,reverse?!b:b);value*=2}};PlayFunView.prototype.showView=function(handle,b){this.showViewList[handle].visible=b};PlayFunView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btn_toolbar,this.onTap);this.addTouchEvent(this.vipBtn0,this.onTap);this.addTouchEvent(this.face,this.onTap);this.addTouchEvent(this.expGroup,this.onTap);this.addTouchEvent(this.ssExpGroup,this.onTap);this.addTouchEvent(this.mapName0,this.onTap);this.addTouchEvent(this.btnShowCityBoss,this.onTap);this.addTouchEvent(this.qzVip,this.onTap);this.observe(UserFb.ins().postGuanqiaInfo,this.upDataGuanQiaInfo);this.observe(UserFb.ins().postFbInfoInit,this.removeGuanQiaEnergy);this.observe(UserTask.ins().postUpdteTaskTrace,this.changeTaskTrace);this.observe(UserTask.ins().postUpdteTaskTrace,this.updateTaskState);this.observe(UserFb.ins().postGuanKaIdChange,this.guanqiaChange);this.observe(Recharge.ins().postChangeRecharge,this.checkShowVip);this.observe(GameLogic.ins().postSubRoleChange,this.initData);this.observe(Actor.ins().postGoldChange,this.initData);this.observe(Actor.ins().postYbChange,this.initData);this.observe(Actor.ins().postNameChange,this.initData);this.observe(Actor.ins().postPowerChange,this.initData);this.observe(UserFb.ins().postPlayWarm,this.warmWord);this.observe(UserVip.ins().postUpdateVipData,this.initData);this.observe(UserVip.ins().postUpdataExp,this.upDataVipBtnRedPoint);this.observe(UserVip.ins().postUpdateVipAwards,this.upDataVipBtnRedPoint);this.observe(UserVip.ins().postUpdateWeekAwards,this.upDataVipBtnRedPoint);this.observe(Actor.ins().postLevelChange,this.updateHeadRedPoint);this.observe(Actor.ins().postExp,this.checkisOpenFuliWin);this.observe(GameLogic.ins().postLevelBarChange,this.updateLevelBar);this.observe(Actor.ins().postExp,this.checkGuide);this.observe(PlayFun.ins().postShowViews,this.showViews);this.observe(UserFb.ins().postTeamFbFlowarRecords,this.updateFlower);this.observe(ShapeShiftingMgr.ins().postShapeStart,this.onShapeStart);this.observe(ShapeShiftingMgr.ins().postShapeEnd,this.onShapeEnd);this.observe(ShapeShiftingMgr.ins().postShapeStartClient,this.onShapeStart);this.observe(ShapeShiftingMgr.ins().postShapeEndClient,this.onShapeEnd);this.observe(GameLogic.ins().postMpChange,this.updateHuShen);this.observe(GameLogic.ins().postCreateOtherEntity,this.updateHuShen);this.observe(GameLogic.ins().postHpChange,this.readyUpdateHp);this.observe(GameLogic.ins().postCreateOtherEntity,this.readyUpdateHp);this.observe(CityCC.ins().postCityBossId,this.changeCityBossIcon);this.observe(UserBag.ins().postItemAdd,this.setRedPoint);this.observe(UserBag.ins().postItemAdd,this.initChapterGift);this.observe(UserBag.ins().postItemDel,this.setRedPoint);this.observe(ShapeShiftingMgr.ins().postShapeShiftingInfo,this.setRedPoint);this.observe(ShapeShiftingMgr.ins().postTaskAwards,this.setRedPoint);this.observe(UserFb.ins().postGuanqiaInfo,this.setSS);this.observe(SysPreview.ins().postChange,this.updatePreview);this.observe(GameLogic.ins().postEnterMap,this.updatePreview);this.observe(Encounter.ins().postFightResult,this.updatePreview);this.observe(SysPreview.ins().postNewOpen,this.showPreviewTip);this.observe(ShoppingGift.ins().postInfo,this.showShoppingGiftTip);this.observe(GameLogic.ins().postEnterMap,this.showShoppingGiftTip);this.observe(Encounter.ins().postFightResult,this.showShoppingGiftTip);this.observe(BossHomeSys.ins().postRoomingChange,this.updateBossHomeFuncTips);this.observe(BossHomeSys.ins().postExitCD,this.updateBossHomeFuncTips);this.observe(Friends.ins().postFriendChange,this.updateFriendsFuncTips);this.observe(Friends.ins().postFriendInviteTeam,this.showInviteTeamFuncTips);this.observe(Friends.ins().postInviteMsgListIsNull,this.removeInviteTeamFuncTips);this.observe(GameLogic.ins().postEnterMap,this.topIconShow);this.observe(Encounter.ins().postEncounterStartFight,this.topIconShow2);this.observe(Encounter.ins().postFightResult,this.topIconShow);this.observe(QzoneSys.ins().postUserInfo,this.updateQzVipIcon);this.observe(QQDaTingSys.ins().postUserInfo,this.updateQzVipIcon);this.addTouchEvent(this.recharge1,this.onTap);this.addTouchEvent(this.recharge2,this.onTap);this.addTouchEvent(this.btnShapeShifting,this.onTap);this.initData();this.upDataGuanQiaInfo();this.changeTaskTrace();this.addRuleEvent();this.updateRules();this.upDataWillBoss(Encounter.ins().willBossID);this.updateHeadRedPoint();HBSystem.ins().updateHongBao();this.updatePreview();this.showShoppingGiftTip();this.flameMC.playFile(RES_DIR_EFF+"zhanduolibeijing",-1);this.greenBarMc.playFile(RES_DIR_EFF+"xuetiaogreen",-1);this.blueBarMc.playFile(RES_DIR_EFF+"xuetiaoblue",-1);this.vipMc.playFile(RES_DIR_EFF+"vipeff",-1);this.btnShapeShiftingEff.playFile(RES_DIR_EFF+"bstb_uieff",-1);this.playFuncGroupEff();this.refreshEscortMine();TimerManager.ins().doTimer(1e3,0,this.refreshEscortMine,this);this.setRedPoint();this.setSS();this.initChapterGift();var view=ViewManager.ins().getView(UIView2);if(view){view.updateAutoPKBoss()}this.updateBossHomeFuncTips();this.updateQzVipIcon()};PlayFunView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeGuanQiaEnergy();this.removeRuleEvent();this.hongbao.removeChildren();DisplayUtils.removeFromParent(this._flowerShowItem);TimerManager.ins().removeAll(this)};PlayFunView.prototype.setRedPoint=function(){this.redPointSS.visible=ShapeShiftingMgr.ins().showBsRedP()||ShapeShiftingMgr.ins().showSjRedP()||ShapeShiftingMgr.ins().showSmeltRedP()||ShapeShiftingMgr.ins().showBsRedTask()};PlayFunView.prototype.playFuncGroupEff=function(){for(var i=0;i<this.funcMcs.length;i++){var mc=this.funcMcs[i];if(mc){mc.playFile(RES_DIR_EFF+"actIconCircle",-1)}}};PlayFunView.prototype.setSS=function(){var guanQiaID=UserFb.ins().guanqiaID;var openChapterLevel=GlobalConfig.ShapeShiftingBaseConfig.openChapterLevel;this.ssGroup.visible=guanQiaID>=openChapterLevel};PlayFunView.prototype.expChange=function(lvl){var lv=lvl||Actor.level;var zs=UserZs.ins()?UserZs.ins().lv:0;var strLv=i18n("PlayFunView_19")+(zs?zs+i18n("PlayFunView_5"):"")+"|";strLv=(zs?zs+i18n("PlayFunView_7"):"")+lv+i18n("PlayFunView_8");this.lvTxt.text=strLv};PlayFunView.prototype.updateQzVipIcon=function(){if(QzoneSys.ins().isYellowYearVip()&&QzoneSys.ins().getYellowViplv()>0){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_year_"+QzoneSys.ins().getYellowViplv()}else if(!QzoneSys.ins().isYellowYearVip()&&QzoneSys.ins().getYellowViplv()>0){this.qzVip.visible=true;this.qzVip.source="qz_vip_icon_"+QzoneSys.ins().getYellowViplv()}else if(QQDaTingSys.ins().isDaTHighVip()&&QQDaTingSys.ins().getDaTViplv()>0){this.qzVip.visible=true;this.qzVip.height=26;this.qzVip.width=29;this.qzVip.source="lanhhviplv"+QQDaTingSys.ins().getDaTViplv()}else if(!QQDaTingSys.ins().isDaTHighVip()&&QQDaTingSys.ins().getDaTViplv()>0){this.qzVip.visible=true;this.qzVip.height=26;this.qzVip.width=29;this.qzVip.source="lanptviplv"+QQDaTingSys.ins().getDaTViplv()}else{this.qzVip.visible=false}if(QQDaTingSys.ins().isDaTYearVip()&&QQDaTingSys.ins().getDaTViplv()>0){this.datNFvip.visible=true}};PlayFunView.prototype.hideBtn=function(){var self=this;egret.Tween.removeTweens(this.iconGroup);var t=egret.Tween.get(this.iconGroup);this.btn_toolbar.touchEnabled=false;if(self.iconGroup.visible){t.to({scaleX:.2,scaleY:.2},500,egret.Ease.backIn).call(function(){self.iconGroup.visible=!self.btn_toolbar.selected;self.btn_toolbar.touchEnabled=true})}else{self.iconGroup.visible=!self.btn_toolbar.selected;t.to({scaleX:1,scaleY:1},700,egret.Ease.bounceOut).call(function(){self.btn_toolbar.touchEnabled=true})}};PlayFunView.prototype.topIconShow=function(){if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS&&this.iconGroup.visible){this.btn_toolbar.$setSelected(true);this.hideBtn()}else if(!this.iconGroup.visible){this.btn_toolbar.$setSelected(false);this.hideBtn()}};PlayFunView.prototype.topIconShow2=function(){if(this.iconGroup.visible){this.btn_toolbar.$setSelected(true);this.hideBtn()}};PlayFunView.prototype.addRuleEvent=function(){for(var i in this.ruleList){var rule=this.ruleList[i];rule.addShowEvents();if(rule.isShow){rule.addRedEvents();ResourceMgr.ins().reloadContainer(rule.tar)}}};PlayFunView.prototype.removeRuleEvent=function(){for(var i in this.ruleList){var rule=this.ruleList[i];rule.removeEvents()}};PlayFunView.prototype.updateRules=function(){if(!TimerManager.ins().isExists(this.startUpdateRule,this))TimerManager.ins().doTimer(60,1,this.startUpdateRule,this);if(!TimerManager.ins().isExists(this.startUpdateCD,this))TimerManager.ins().doTimer(20,0,this.startUpdateCD,this)};PlayFunView.prototype.startUpdateCD=function(){DieGuide.ins().checkCDTimeShow();this.checkWingTips()};PlayFunView.prototype.startUpdateRule=function(){var isChanged=false;for(var i in this.ruleList){var rule=this.ruleList[i];var hasChanged=this.updateShow(rule);if(hasChanged)isChanged=true;if(!hasChanged&&rule.isShow){this.updateRule(rule)}}if(isChanged)this.sortBtnList();this.checkGuide()};PlayFunView.prototype.checkWingTips=function(){this.groupWingTips.visible=Wing.ins().showWingTips()};PlayFunView.prototype.checkGuide=function(){DieGuide.ins().checkFirstChargeOrVIPWin()};PlayFunView.prototype.updateRuleAndSort=function(rule){TimerManager.ins().doTimer(100,1,function(){if(this.updateShow(rule)){this.sortBtnList(rule)}},this)};PlayFunView.prototype.updateShow=function(rule){var isShow=rule.checkShowIcon();var tar;if(KFServerSys.ins().isLinkingKF)isShow=false;if(rule.isShow==isShow){var reload=false;for(var idx in this.reLoadIconIds){if(rule.id==this.reLoadIconIds[idx]){reload=true;break}}if(!reload)return}rule.isShow=isShow;if(isShow){rule.addRedEvents();tar=rule.getTar();if(tar["iconGroup"]){tar["iconGroup"].addEventListener(egret.TouchEvent.TOUCH_TAP,rule.tapExecute,rule)}else{tar.addEventListener(egret.TouchEvent.TOUCH_TAP,rule.tapExecute,rule)}var tarParent=this.ruleParent[rule.hashCode];tarParent.addChild(tar);ResourceMgr.ins().reloadContainer(tar,false);this.updateRule(rule)}else{rule.removeRedEvents();tar=rule.tar;if(tar){if(tar["iconGroup"]){tar["iconGroup"].addEventListener(egret.TouchEvent.TOUCH_TAP,rule.tapExecute,rule)}else{tar.addEventListener(egret.TouchEvent.TOUCH_TAP,rule.tapExecute,rule)}DisplayUtils.removeFromParent(tar);DisplayUtils.removeFromParent(this.ruleEffBottom[tar.hashCode]);DisplayUtils.removeFromParent(this.btnEff[tar.hashCode]);DisplayUtils.removeFromParent(this.ruleEffTop[tar.hashCode])}}return true};PlayFunView.prototype.updateRule=function(rule){var count=0;var tar=rule.getTar();if(tar["redPoint"]){count=rule.checkShowRedPoint();tar["redPoint"].visible=count}if(tar["leftTip"]){tar["leftTip"].source=rule.getLeftTipName();tar["leftTip"].visible=rule.checkShowLeftTip()}var effName=rule.getEffName(count);if(effName){if(!this.ruleEffBottom[tar.hashCode]||!this.ruleEffBottom[tar.hashCode].parent){var mc=this.getEff(tar.hashCode,effName);var layer=rule.getEffLayer();mc.x=rule.effX;mc.y=rule.effY;if(effName=="actIconCircle"){mc.scaleX=mc.scaleY=.9}if(tar["bottomAni"]){tar["bottomAni"].addChild(mc)}else{tar.addChildAt(mc,rule.getEffLayer())}}else{this.ruleEffBottom[tar.hashCode].play(-1)}}else{DisplayUtils.removeFromParent(this.ruleEffBottom[tar.hashCode])}effName=rule.getBtnEffName();var config=rule.getConfig();if(effName){if(tar["icon"]){tar["icon"]=""}var mc=this.getBtnEff(tar.hashCode,effName);mc.x=rule.btnEffX;mc.y=rule.btnEffY;if(tar["btnAni"]){tar["btnAni"].removeChildren();tar["btnAni"].addChild(mc)}else{if(rule.id&&config&&(rule.icon||config.icon)&&tar){tar["icon"]=rule.icon||config.icon}}}else{if(rule.id&&config&&(rule.icon||config.icon)&&tar){tar["icon"]=rule.icon||config.icon}DisplayUtils.removeFromParent(this.btnEff[tar.hashCode])}effName=rule.getEffTopName();if(effName){if(!this.ruleEffTop[tar.hashCode]||!this.ruleEffTop[tar.hashCode].parent){var mc=this.getEffTop(tar.hashCode,effName);mc.x=rule.effX-5;mc.y=rule.effY+2;mc.scaleX=mc.scaleY=.9;if(tar["topAni"]){tar["topAni"].addChild(mc)}else{tar.addChildAt(mc,rule.getTopEffLayer())}}else{this.ruleEffTop[tar.hashCode].play(-1)}}else{DisplayUtils.removeFromParent(this.ruleEffTop[tar.hashCode])}};PlayFunView.prototype.getEff=function(value,effName){this.ruleEffBottom[value]=this.ruleEffBottom[value]||new MovieClip;if(effName)this.ruleEffBottom[value].playFile(RES_DIR_EFF+effName,-1);return this.ruleEffBottom[value]};PlayFunView.prototype.getEffTop=function(value,effName){this.ruleEffTop[value]=this.ruleEffTop[value]||new MovieClip;if(effName)this.ruleEffTop[value].playFile(RES_DIR_EFF+effName,-1);return this.ruleEffTop[value]};PlayFunView.prototype.getBtnEff=function(value,effName){this.btnEff[value]=new MovieClip;if(effName)this.btnEff[value].playFile(RES_DIR_EFF+effName,-1);return this.btnEff[value]};PlayFunView.prototype.guanqiaChange=function(){this.maskImg.visible=UserFb.ins().guanqiaID<=10;if(nPChapterGiftSys.ins().isCangetchapterGift()){this.ChapterGiftIconAni()}this.showTopChapterGiftTips()};PlayFunView.prototype.showTopChapterGiftTips=function(){var dofunc=function(){this.chaptergiftTips.visible=false};if(nPChapterGiftSys.ins().ChapterCompare()>0){this.chaptergiftTips.bottom=440;this.chaptergiftTips.visible=true;this.chaptergiftTips.text=i18n("PlayFunView_23")+nPChapterGiftSys.ins().ChapterCompare()+i18n("PlayFunView_24");egret.Tween.removeTweens(this.chaptergiftTips);var t=egret.Tween.get(this.chaptergiftTips);var self_14=this;t.to({bottom:900},5e3).call(function(){self_14.chaptergiftTips.visible=false},this)}else{this.chaptergiftTips.visible=false;TimerManager.ins().remove(dofunc,this)}};PlayFunView.prototype.initFuncTipBtn=function(){var btns=[this.FuncBossHomeBtn,this.FuncInviteRoomBtn,this.FuncFriendsBtn,this.FuncExpiredBtn];var groups=[this.FuncBossHomeGroup,this.FuncInviteRoomGroup,this.FuncFriendsGroup,this.FuncExpiredGroup];for(var _i=0,btns_4=btns;_i<btns_4.length;_i++){var btn=btns_4[_i];this.addTouchEvent(btn,this.onTap)}for(var i=0,c=groups.length;i<c;++i){var group=groups[i];var mc=new MovieClip;this.funcMcs[i]=mc;mc.x=40;mc.y=42;mc.scaleX=mc.scaleY=.9;group.addChildAt(mc,0);mc.playFile(RES_DIR_EFF+"actIconCircle",-1);group.parent.removeChild(group)}this.updateExpiredFuncTips()};PlayFunView.prototype.updateBossHomeFuncTips=function(){var timeFunc=function(){BossHomeSys.ins().exitCD=0;BossHomeSys.ins().postExitCD()};if(!TimerManager.ins().isExists(timeFunc,this)&&BossHomeSys.ins().exitCD>0){TimerManager.ins().doTimer(BossHomeSys.ins().exitCD*1e3,1,timeFunc,this)}var isHasCanChanellageRoom=BossHomeSys.ins().isHasCanChanellageRoom();if(isHasCanChanellageRoom){this.funcMcs[0].playFile(RES_DIR_EFF+"actIconCircle",-1);this.FuncTipsGroup.addChild(this.FuncBossHomeGroup)}if(!isHasCanChanellageRoom||BossHomeSys.ins().bosslistLength1<=0||BossHomeSys.ins().nowjoinletfTime<=0||BossHomeSys.ins().exitCD>0){if(this.FuncBossHomeGroup.parent==this.FuncTipsGroup){this.FuncTipsGroup.removeChild(this.FuncBossHomeGroup)}}};PlayFunView.prototype.showInviteTeamFuncTips=function(isAdd){if(isAdd===void 0){isAdd=true}if(isAdd){this.funcMcs[1].playFile(RES_DIR_EFF+"actIconCircle",-1);this.FuncTipsGroup.addChild(this.FuncInviteRoomGroup)}};PlayFunView.prototype.removeInviteTeamFuncTips=function(){if(this.FuncInviteRoomGroup.parent==this.FuncTipsGroup){this.FuncTipsGroup.removeChild(this.FuncInviteRoomGroup)}};PlayFunView.prototype.updateFriendsFuncTips=function(){if(Friends.ins().appList.length>0){this.funcMcs[2].playFile(RES_DIR_EFF+"actIconCircle",-1);this.FuncTipsGroup.addChild(this.FuncFriendsGroup)}else{if(this.FuncFriendsGroup.parent==this.FuncTipsGroup){this.FuncTipsGroup.removeChild(this.FuncFriendsGroup)}}};PlayFunView.addExpiredFuncTip=function(content){this.FuncExpiredTexts.push(content);this.saveExpiredFuncTips();if(PlayFunView.instance!=null){PlayFunView.instance.updateExpiredFuncTips()}};PlayFunView.addMonthCardExpiredTip=function(isPrivilegeCard){this.addExpiredFuncTip(isPrivilegeCard==0?i18n("PlayFunView_27"):i18n("PlayFunView_28"))};PlayFunView.saveExpiredFuncTips=function(){LoginMgr.setItem("expiredFuncTips_"+Actor.actorID,JSON.stringify(this.FuncExpiredTexts))};PlayFunView.loadExpiredFuncTips=function(){var _this=this;LoginMgr.getItem("expiredFuncTips_"+Actor.actorID,function(s){if(s==null||s==""){return}try{_this.FuncExpiredTexts=JSON.parse(s)}catch(e){_this.FuncExpiredTexts=[]}})};PlayFunView.prototype.updateExpiredFuncTips=function(){if(PlayFunView.FuncExpiredTexts.length>0){this.funcMcs[3].playFile(RES_DIR_EFF+"actIconCircle",-1);this.FuncTipsGroup.addChild(this.FuncExpiredGroup)}else{if(this.FuncExpiredGroup.parent==this.FuncTipsGroup){this.FuncTipsGroup.removeChild(this.FuncExpiredGroup)}}};PlayFunView.prototype.showTaskTips=function(text){UserTips.ins().showTaskTips(text)};PlayFunView.prototype.onTap=function(e){var tar=e.currentTarget;switch(tar){case this.willBossPrompt:ViewManager.ins().open(BossWin,1);break;case this.btn_toolbar:this.hideBtn();break;case this.recharge1:Recharge.ins().tryShowChargeFirstWin();break;case this.recharge2:Shop.openBuyGoldWin();break;case this.vipBtn0:ViewManager.ins().open(VipWin);break;case this.face:ViewManager.ins().open(SettingView);if(this.headRedPoint.visible){Setting.ins().setValue(ClientSet.headRed,1);this.updateHeadRedPoint()}break;case this.expGroup:case this.mapName0:case this.ssExpGroup:ViewManager.ins().open(EffectivenessTip,1);break;case this.btnShapeShifting:ViewManager.ins().open(ShapeShiftingWin);break;case this.btnShowCityBoss:TimerManager.ins().remove(this.checkCityBossClick,this);if(!CityCC.ins().bossIconStatus){CityCC.ins().bossIconStatus=true;this.btnShowCityBoss.visible=false}else{CityCC.ins().bossIconStatus=false}CityCC.ins().postCityBossIconVisable();TimerManager.ins().doTimer(1e4,1,this.checkCityBossClick,this);break;case this.nPgiftBtn:nPChapterGiftSys.ins().onChapterGiftBtn();break;case this.FuncBossHomeBtn:ViewManager.ins().open(BossWin,5,1);break;case this.FuncInviteRoomBtn:ViewManager.ins().open(TeamFbFriendInviteWin);break;case this.FuncFriendsBtn:ViewManager.ins().open(FriendBgWin,2);break;case this.FuncExpiredBtn:this.checkShowExpiredTips();this.updateExpiredFuncTips();break;case this.qzVip:if(QzoneSys.ins().getYellowViplv()>0){ViewManager.ins().open(QzVipWin)}else if(QQDaTingSys.ins().getDaTViplv()>0){ViewManager.ins().open(DaTVipWin)}break}};PlayFunView.prototype.checkShowExpiredTips=function(){var _this=this;if(PlayFunView.FuncExpiredTexts&&PlayFunView.FuncExpiredTexts.length>0){var expiredText=PlayFunView.FuncExpiredTexts.shift();PlayFunView.saveExpiredFuncTips();var monthCardPreffix="MONTHCARD-";var privilegeCardPreffix="PRIVILEGECARD-";var isMonthCard=false;var isPrivilegeCard=false;if(expiredText.indexOf(monthCardPreffix)==0){expiredText=expiredText.substr(monthCardPreffix.length);isMonthCard=true}else if(expiredText.indexOf(privilegeCardPreffix)==0){expiredText=expiredText.substr(privilegeCardPreffix.length);isPrivilegeCard=true}var showNextTip=function(){_this.updateExpiredFuncTips();TimerManager.ins().doNext(_this.checkShowExpiredTips,_this)};if(isMonthCard||isPrivilegeCard){WarnWin.show(expiredText,function(){_this.updateExpiredFuncTips();ViewManager.ins().open(FuliWin,isMonthCard?"MonthCardWin":"FranchiseWin")},this,showNextTip,this,"normal").setBtnLabel(i18n("PlayFunView_26"),i18n("PlayFunView_25"))}else{WarnWin.show(expiredText,showNextTip,this,undefined,undefined,"sure")}}};PlayFunView.prototype.checkCityBossClick=function(){var self=this;if(CityCC.ins().bossIconStatus){CityCC.ins().bossIconStatus=false;CityCC.ins().postCityBossIconVisable();setTimeout(function(){self.btnShowCityBoss.visible=true},400)}};PlayFunView.prototype.test=function(){if(this.value1>1/100){this.value1-=1/100}else{this.value1=1}if(this.value1>1)this.value1=1;this.blueBar.width=145*(1-this.value1/1);this.greenBar.width=145*(this.value1/1)};PlayFunView.prototype.changeTaskTrace=function(){var data=UserTask.ins().taskTrace;if(data){var config=UserTask.ins().getAchieveConfById(data.id);if(!config){console.log(i18n("PlayFunView_10",data.id));return}var desc0=config.desc,desc1="",imgSource="";var handle="×";var i=config.desc.indexOf(handle);if(i>=0){desc0=config.desc.slice(0,i);desc1=config.desc.slice(i);if(config.awardList[0]&&GlobalConfig.ItemConfig[config.awardList[0].id]&&GlobalConfig.ItemConfig[config.awardList[0].id].icon){imgSource=GlobalConfig.ItemConfig[config.awardList[0].id].icon+"_png"}else if(config.awardList[0]){switch(config.awardList[0].id){case MoneyConst.yuanbao:imgSource="szyuanbao";break;case MoneyConst.gold:imgSource="szjinbi";break}}}this.taskTraceAwardsImg.source=imgSource;if(config.type==79){this.taskTraceAwards0.textFlow=TextFlowMaker.generateTextFlow(i18n("PlayFunView_20")+desc0+"|");this.taskTraceAwards1.textFlow=TextFlowMaker.generateTextFlow(i18n("PlayFunView_20")+desc1+"|")}else{this.taskTraceAwards0.text=""+desc0;this.taskTraceAwards1.text=""+desc1}switch(data.state){case 0:var maxtarget=config.target;var value=data.value;if(config.type==79){value=0;maxtarget=1}if(config.type==36){value-=1;maxtarget-=1}this.taskTraceName.textFlow=TextFlowMaker.generateTextFlow(config.name+i18n("PlayFunView_21")+value+"/"+maxtarget+")|");if(data.value==0)GameGuider.stopTaskEffect();GameGuider.startTaskEffect();break;case 1:this.taskTraceName.textFlow=TextFlowMaker.generateTextFlow(config.name+i18n("PlayFunView_11"));GameGuider.stopTaskEffect();GameGuider.startTaskEffect();break}var t=egret.Tween.get(this.taskTraceAwardsGroup);t.to({x:this.taskTraceAwardsGroup.x+100,alpha:0},200).to({x:0},200).to({x:71,alpha:1},200);var t1=egret.Tween.get(this.taskTraceName);t1.to({x:this.taskTraceName.x+100,alpha:0},200).to({x:0},200).to({x:71,alpha:1},200)}else{GameGuider.stopTaskEffect()}};PlayFunView.prototype.updateTaskState=function(){var data=UserTask.ins().taskTrace;if(data){this.taskImg.visible=true;if(data.state==1){if(this.taskAsseptMc.parent){if(this.taskEffTypes.indexOf(1)<0)this.taskEffTypes.push(1)}else if(!this.taskComMc.parent){this.addTaskEffectIndex(1)}this.taskImg.visible=false}else if(data.state==0&&data.value==0){if(this.taskComMc.parent){if(this.taskEffTypes.indexOf(0)<0)this.taskEffTypes.push(0)}else if(!this.taskAsseptMc.parent){this.addTaskEffectIndex(0)}}}};PlayFunView.prototype.addTaskEffectIndex=function(index){var _this=this;if(index==0){this.taskTraceBtn.addChild(this.taskAsseptMc);this.taskAsseptMc.playFile(RES_DIR_EFF+"receive",1,function(){TimerManager.ins().doNext(function(){if(_this.taskEffTypes.length){_this.addTaskEffectIndex(_this.taskEffTypes.shift())}},_this)});SoundUtil.ins().playEffect(SoundUtil.TASK);this.taskAsseptMc.y=-50}else if(index==1){this.taskTraceBtn.addChild(this.taskComMc);this.taskComMc.playFile(RES_DIR_EFF+"complete",1,function(){TimerManager.ins().doNext(function(){if(_this.taskEffTypes.length){_this.addTaskEffectIndex(_this.taskEffTypes.shift())}},_this)});this.taskComMc.y=-80}};PlayFunView.prototype.toWan=function(n){var w=Math.floor(n/1e4);if(w>0){return w+i18n("PlayFunView_22")}return n};PlayFunView.prototype.upDataGuanQiaInfo=function(){this.initChapterGift();this.expTxt.textFlow=TextFlowMaker.generateTextFlow(i18n("PlayFunView_13",this.toWan(UserFb.ins().expEff)));this.ssExpTxt.textFlow=TextFlowMaker.generateTextFlow(i18n("PlayFunView_13",this.toWan(UserFb.ins().ssExpEff)));this.ssExpGroup.visible=UserFb.ins().ssExpEff>0;this.mapName0.textFlow=TextFlowMaker.generateTextFlow(i18n("PlayFunView_14",UserFb.ins().guanqiaID))};PlayFunView.prototype.removeGuanQiaEnergy=function(){UserFb.ins().currentEnergy=0;var view=ViewManager.ins().getView(UIView2);if(view){view.upDataExpMcBall()}};PlayFunView.prototype.upDataWillBoss=function(id){if(id){this.willBossPrompt=this.willBossPrompt||new MovieClip;this.willBossPrompt.playFile(RES_DIR_EFF+"zaoyuBoss",-1);this.willBossPrompt.y=500;this.willBossPrompt.x=330;this.willBossPrompt.touchEnabled=true;this.addTouchEvent(this.willBossPrompt,this.onTap);this.addChild(this.willBossPrompt)}else if(this.willBossPrompt){DisplayUtils.removeFromParent(this.willBossPrompt);this.removeTouchEvent(this.willBossPrompt,this.onTap)}};PlayFunView.prototype.updateHeadRedPoint=function(){if(Actor.level>=30&&!Setting.ins().getValue(ClientSet.headRed)){this.headRedPoint.visible=true}else{this.headRedPoint.visible=false}};PlayFunView.prototype.checkisOpenFuliWin=function(){var isAutoopenToday=Notice.ins().isAutoOpened;if(GameMap.sceneInMain()&&!ViewManager.ins().hasTopView()&&!isAutoopenToday){if(Actor.level>=GlobalConfig.OpenSystemConfig[SystemType.FULI].openlevel){if(!TimerManager.ins().isExists(this.isInPlayFunView,this))TimerManager.ins().doTimer(1e3,10,this.isInPlayFunView,this,this.openFuliWin,this)}}};PlayFunView.prototype.isInPlayFunView=function(){if(!GameMap.sceneInMain()||ViewManager.ins().hasTopView()){TimerManager.ins().remove(this.isInPlayFunView,this)}};PlayFunView.prototype.openFuliWin=function(){var logIndays=DailyCheckIn.ins().conLoginTimes;var state=DailyCheckIn.ins().todayReward;var isAutoopenToday=Notice.ins().isAutoOpened;if(!state&&!isAutoopenToday&&GameMap.sceneInMain()&&!ViewManager.ins().hasTopView()){ViewManager.ins().open(FuliWin);Notice.ins().isAutoOpened=true}else{TimerManager.ins().remove(this.isInPlayFunView,this)}};PlayFunView.prototype.updateLevelBar=function(lv){this.expChange(lv)};PlayFunView.prototype.publicBossRelive=function(isShow,bossName){if(bossName===void 0){bossName=""}if(!isShow&&bossName&&bossName!=this.reliveBossLab.name)return;var boo=UserBoss.ins().checkBossIconShow();var isVisible=isShow&&boo&&GameMap.sceneInMain();PlayFun.ins().newBossRelive=this.newBossRelive.visible=isVisible;this.reliveBossLab.name=isShow?bossName:"1";if(!isVisible)return;this.reliveBossArrow.setTips(bossName+i18n("PlayFunView_15"))};PlayFunView.prototype.sortRule=function(a,b){var ac=GlobalConfig.PlayFunConfig[a.id];var bc=GlobalConfig.PlayFunConfig[b.id];if(ac.sort<bc.sort)return-1;else return 1};PlayFunView.prototype.sortBtnList=function(rule){if(rule===void 0){rule=null}var pos=-1;if(rule){var config=GlobalConfig.PlayFunConfig[rule.id];if(!config)return;pos=config.pos}var btnDic={};if(pos==-1){btnDic[0]=[];btnDic[1]=[[],[],[]];btnDic[2]=[];btnDic[3]=[]}else{if(pos!=1)btnDic[pos]=[];else btnDic[pos]=[[],[],[]]}var configs=GlobalConfig.PlayFunConfig;var ruleIdList=this.ruleIdList;for(var id in configs){var r=ruleIdList[id];if(r.isShow){var config=configs[id];var temp=config.pos;if(pos==-1||pos==temp){if(temp==1){btnDic[temp][config.layer-1].push(r)}else{btnDic[temp].push(r)}}}}for(var i in btnDic){if(i=="1"){for(var j in btnDic[i])btnDic[i][j].sort(this.sortRule)}else{btnDic[i].sort(this.sortRule)}}var starX=this.width-156;var starY=0;var btn;var btnList;var showNum=0;var index=0;var actRow=0;if(pos==-1||pos==1){btnList=btnDic[1];for(var row=0;row<btnList.length;row++){if(actRow<row){actRow=row;showNum=0}for(var i=0;i<btnList[row].length;i++){btn=btnList[row][i].tar;btn.parent.setChildIndex(btn,0);btn.x=starX-showNum*75;btn.y=starY+actRow*75;showNum+=1;if(ChannelMgr.ins().isQQZoneChannel()||ChannelMgr.ins().isQQDaTingChannel()){if(row==0&&showNum>7){actRow+=1;showNum=0}else if(row>0&&showNum>4){actRow+=1;showNum=0}}else{if(row==0&&showNum>5){actRow+=1;showNum=0}else if(row>0&&showNum>4){actRow+=1;showNum=0}}}}}if(pos==-1||pos==2){showNum=0;index=0;btnList=btnDic[2];for(var i=0;i<btnList.length;i++){var r=btnList[i];btn=r.tar;btn.parent.setChildIndex(btn,index);index+=1;if(!r.getConfig().noMove){btn.left=10;btn.top=594-showNum*80;showNum++}}}if(pos==-1||pos==3){showNum=0;index=0;btnList=btnDic[3];for(var i=0;i<btnList.length;i++){var r=btnList[i];btn=r.tar;btn.parent.setChildIndex(btn,index);index+=1;if(r.getConfig().noMove){btn.bottom=406;btn.right=14}if(!r.getConfig().noMove){btn.right=showNum*90+StageUtils.ins().getWidth()/2-195;btn.bottom=90;showNum++}}}if(pos==-1||pos==0){index=0;btnList=btnDic[0];for(var i=0;i<btnList.length;i++){btn=btnList[i].tar;btn.parent.setChildIndex(btn,index);index+=1}}};PlayFunView.prototype.warmWord=function(num){var _this=this;if(num){if(GameMap.sceneInMain()){this.bossWarmMc=this.bossWarmMc||new MovieClip;this.bossWarmMc.touchEnabled=false;this.mcGroup.addChildAt(this.bossWarmMc,0);this.mcGroup.visible=true;this.aniShadow();this.bossWarmMc.playFile(RES_DIR_EFF+"tz_gkeff",1,function(){_this.removeShadow()});this.removeGuanQiaEnergy()}}else{this.mcGroup.visible=false;egret.Tween.removeTweens(this.alphaGroup);if(this.bossWarmMc){DisplayUtils.removeFromParent(this.bossWarmMc);this.bossWarmMc=null}}};PlayFunView.prototype.aniShadow=function(){var _this=this;this.warmImage.visible=true;var t=egret.Tween.get(this.warmImage);this.warmImage.alpha=.23;t.to({alpha:1},300).wait(2200).to({alpha:0},350).call(function(){egret.Tween.removeTweens(_this.warmImage)});this.levelNum.text=UserFb.ins().guanqiaID+"";this.alphaGroup.alpha=0;egret.Tween.removeTweens(this.alphaGroup);egret.Tween.get(this.alphaGroup,{loop:false}).to({alpha:1},600).to({alpha:1},600).to({alpha:0},250);TimerManager.ins().doTimer(3500,1,this.removeShadow,this)};PlayFunView.prototype.removeShadow=function(){this.warmImage.visible=false;this.mcGroup.visible=false;egret.Tween.removeTweens(this.alphaGroup);TimerManager.ins().remove(this.removeShadow,this)};PlayFunView.prototype.upDataVipBtnRedPoint=function(){this.redPointVip0.visible=UserVip.ins().getVipState()};PlayFunView.prototype.setDieGuide=function(dieType){switch(dieType){case DieGuide.RECHARGE:if(ChannelMgr.ins().isRechargeHidden()){this.preRecharge=this.recharge.visible=false;this.cz.source="";this.cz.touchEnabled=this.recharge.touchEnabled=false}else{this.preRecharge=this.recharge.visible=true;this.cz.source="swyd_firstrecharge_png";this.cz.touchEnabled=this.recharge.touchEnabled=false}break;case DieGuide.VIP:this.preVip=this.vip.visible=true;this.v.touchEnabled=this.vip.touchEnabled=false;break;case DieGuide.CD:var t=this.getCdTimeTxt();if(t){if(ChannelMgr.ins().isRechargeHidden()){this.cdGroup.visible=false}else{if(!this.cdGroup.visible){this.cdGroup.visible=true;this.cdGroup.touchEnabled=false}this.cdTimeTxt.text=t}}else if(this.cdGroup.visible){this.cdGroup.visible=false}break}};PlayFunView.prototype.getCdTimeTxt=function(){var second=Recharge.ins().cdTime;if(!second){return null}var min=Math.floor(second/60);var sec=Math.floor(second%60);var t=min+i18n("PlayFunView_17")+sec+i18n("PlayFunView_18");return t};PlayFunView.prototype.updateNewEquip=function(){if(!this.equipTips){this.equipTips=ViewManager.ins().open(NewEquipWin)}else{this.equipTips.open()}if(!TimerManager.ins().isExists(this.checkTime,this)){TimerManager.ins().doTimer(500,0,this.checkTime,this)}};PlayFunView.prototype.checkTime=function(){if(NewEquip.ins().check()){if(this.equipTips.visible&&!NewEquip.ins().isHaveEquip()){this.equipTips.close()}}else{TimerManager.ins().remove(this.checkTime,this);this.equipTips.close()}};PlayFunView.prototype.updateFlower=function(){if(!this._flowerShowItem){this._flowerShowItem=new FlowerShowItem;this.flower.addChild(this._flowerShowItem);return}if(!this._flowerShowItem.parent)this.flower.addChild(this._flowerShowItem);this._flowerShowItem.showEffect()};PlayFunView.prototype.removeFlowerItem=function(){DisplayUtils.removeFromParent(this._flowerShowItem)};PlayFunView.prototype.playUIEff=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};PlayFunView.prototype.friendIconShow=function(){return Actor.level>=70};PlayFunView.prototype.cityIconShow=function(){return GameMap.sceneInMain()&&OpenSystem.ins().checkSysOpen(SystemType.CITYMONSTER)&&!UserFb.ins().isCloseFbEntrance};PlayFunView.prototype.mailIconShow=function(){var data=UserMail.ins().mailListData;if(data.length<=0){return false}else{return true}};PlayFunView.prototype.updateWild=function(param){if(param===void 0){param=null}this.isInWild=param};PlayFunView.prototype.changeCityBossIcon=function(){if(GameServer.serverOpenDay&&OpenSystem.ins().checkSysOpen(SystemType.CITYMONSTER)&&!UserFb.ins().isCloseFbEntrance){if(CityCC.ins().cityBossId!=0){CityCC.ins().bossIconStatus=true;this.btnShowCityBoss.visible=false}else{CityCC.ins().bossIconStatus=false;this.btnShowCityBoss.visible=true}CityCC.ins().postCityBossIconVisable()}else this.btnShowCityBoss.visible=false};PlayFunView.prototype.updatePreview=function(){if(!this.sysPreview){this.sysPreview=new SysPreviewIcon;this.sysPvGroup.addChild(this.sysPreview)}var sysId=SysPreview.ins().nextSys();if(sysId<=0||!GameMap.sceneInMain()&&GameMap.fbType!=UserFb.FB_TYPE_CITY){this.sysPvGroup.visible=false}else{var cfg=SysPreview.ins().getConfig(sysId);var state=SysPreview.ins().getState(sysId);this.sysPvGroup.visible=true;this.sysPreview.data={config:cfg,state:state}}};PlayFunView.prototype.showPreviewTip=function(){if(SysPreview.ins().openSysList.length>0&&(GameMap.sceneInMain()||GameMap.fbType==UserFb.FB_TYPE_CITY)){ViewManager.ins().open(SysPreviewTip)}};PlayFunView.prototype.showShoppingGiftTip=function(){var d=ShoppingGift.ins().getFirstGift();if(!d||!GameMap.sceneInMain()&&GameMap.fbType!=UserFb.FB_TYPE_CITY){if(this.shoppingGiftTip)this.shoppingGiftTip.close();this.shoppingGiftGroup.visible=false;if(ShoppingGift.ins().showState!=ShoppingGift.STATE_ALREADY_FIRST_OPEN){clearTimeout(this.shoppingGiftTipTimer);this.shoppingGiftTipTimer=setTimeout(function(){ShoppingGift.ins().showState=ShoppingGift.STATE_ALREADY_FIRST_OPEN},1e4)}return}this.shoppingGiftGroup.visible=true;if(!this.shoppingGiftTip){this.shoppingGiftTip=new ShoppingGiftTip;this.shoppingGiftGroup.addChild(this.shoppingGiftTip)}this.shoppingGiftTip.data=d;if(ShoppingGift.ins().showState==ShoppingGift.STATE_BRFORE_SET_TIMER){ShoppingGift.ins().showState=ShoppingGift.STATE_CAN_FIRST_OPEN;clearTimeout(this.shoppingGiftTipTimer);TimerManager.ins().doTimerDelay(1e4,1e3,0,this.fisrtShowShoppingGift,this)}else if(ShoppingGift.ins().showState==ShoppingGift.STATE_ALREADY_FIRST_OPEN&&ShoppingGift.ins().hasNewData){ViewManager.ins().open(ShoppingGiftWin)}};PlayFunView.prototype.fisrtShowShoppingGift=function(){if(ShoppingGift.ins().showState==ShoppingGift.STATE_ALREADY_FIRST_OPEN){TimerManager.ins().remove(this.fisrtShowShoppingGift,this)}else if(ShoppingGift.ins().showState==ShoppingGift.STATE_CAN_FIRST_OPEN&&GameMap.sceneInMain()&&!ViewManager.ins().hasTopView()){TimerManager.ins().remove(this.fisrtShowShoppingGift,this);if(ShoppingGift.ins().hasNewData){ViewManager.ins().open(ShoppingGiftWin)}else{ShoppingGift.ins().showState=ShoppingGift.STATE_ALREADY_FIRST_OPEN}}};PlayFunView.prototype.getRuleByClass=function(cls){if(cls){for(var i in this.ruleList){var rule=this.ruleList[i];if(rule instanceof egret.getDefinitionByName(cls)){return rule.getTar()}}}return null};PlayFunView.FuncExpiredTexts=[];__decorate([callLater],PlayFunView.prototype,"initData",null);__decorate([callLater],PlayFunView.prototype,"updateHp",null);return PlayFunView}(BaseEuiView);__reflect(PlayFunView.prototype,"PlayFunView");ViewManager.ins().reg(PlayFunView,LayerManager.Main_View);var ActivityForeshowModel=function(_super){__extends(ActivityForeshowModel,_super);function ActivityForeshowModel(){return _super!==null&&_super.apply(this,arguments)||this}ActivityForeshowModel.ins=function(){return _super.ins.call(this)};ActivityForeshowModel.prototype.getForeshow=function(){for(var i in GlobalConfig.NewFuncNoticeConfig){var cfg=GlobalConfig.NewFuncNoticeConfig[i];var isIn=this.checkOpenTime(cfg.open,cfg.close);if(isIn&&Actor.level>=cfg.openLv)return cfg}return null};ActivityForeshowModel.prototype.checkOpenTime=function(openDay,closeDay){var isIn=GameServer.serverOpenDay+1>=openDay&&GameServer.serverOpenDay+1<=closeDay;return isIn};ActivityForeshowModel.prototype.getRemainTime=function(){var remainTime=0;var cfg=this.getForeshow();if(cfg){var endDate=new Date(DateUtils.formatMiniDateTime(GameServer._serverZeroTime));if(cfg.id==1){endDate.setDate(endDate.getDate()+cfg.open);endDate.setHours(19,20,0,0)}else{endDate.setDate(endDate.getDate()+cfg.close);endDate.setHours(0,0,0,0)}var endTime=endDate.getTime();var currentTime=GameServer.serverTime;remainTime=endTime-currentTime;if(remainTime<0)remainTime=0}remainTime=remainTime/1e3;return remainTime};return ActivityForeshowModel}(BaseClass);__reflect(ActivityForeshowModel.prototype,"ActivityForeshowModel");var ActivityExIconRule=function(_super){__extends(ActivityExIconRule,_super);function ActivityExIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,UserBag.ins().postItemAdd,UserBag.ins().postItemChange];return _this}ActivityExIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.HFACTIVITY)){return false}var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum.length)return false;for(var k in data){var actData=data[k];if(!actData.pageStyle&&actData.timeType==ActivityDataFactory.TimeType_Total){if(actData.isOpenActivity()){return true}}}return false};ActivityExIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(!actData.pageStyle&&actData.timeType==ActivityDataFactory.TimeType_Total){if(actData.isOpenActivity()&&actData.canReward()&&actData.specialState()){return 1}}}return 0};ActivityExIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};ActivityExIconRule.prototype.tapExecute=function(){ViewManager.ins().open(ActivityExWin);this.firstTap=false;this.update()};return ActivityExIconRule}(RuleIconBase);__reflect(ActivityExIconRule.prototype,"ActivityExIconRule");var ActivityFirstRechargeIconRule=function(_super){__extends(ActivityFirstRechargeIconRule,_super);function ActivityFirstRechargeIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx,Activity.ins().postActivityFirstRecharge,Recharge.ins().postChangeRecharge];_this.updateMessage=[Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx,Activity.ins().postActivityFirstRecharge];return _this}ActivityFirstRechargeIconRule.prototype.getConfig=function(){var cfg=GlobalConfig.PlayFunConfig[this.id];var activityData=Activity.ins().activityData;var type26ActData;for(var k in activityData){var actData=activityData[k];if(actData.pageStyle==ActivityPageStyle.ACTIVITY_FIRST_RECHAGE){if(actData.isOpenActivity()&&!actData.getHide()){type26ActData=actData;var aBtn=Activity.ins().getbtnInfo(type26ActData.id.toString());var copyCfg={};for(var kk in cfg){var vv=cfg[kk];copyCfg[kk]=vv}copyCfg["icon"]=aBtn.icon;return copyCfg}}}return cfg};ActivityFirstRechargeIconRule.checkShow=function(){var activityData=Activity.ins().activityData;var hasFirstRecharge=false;var type26ActData;for(var k in activityData){var actData=activityData[k];if(actData.pageStyle==ActivityPageStyle.ACTIVITY_FIRST_RECHAGE){if(actData.isOpenActivity()&&!actData.getHide()){type26ActData=actData;hasFirstRecharge=true;break}}}if(!hasFirstRecharge){return false}if(type26ActData.first_recharge==0||type26ActData.activity_first_recharge==1){return false}var data=Recharge.ins().getRechargeData(0);for(var _i=0,_a=data.firstRewardInfo;_i<_a.length;_i++){var fri=_a[_i];if(fri==1){return false}}if(ChannelMgr.ins().isRechargeHidden()){return false}return true};ActivityFirstRechargeIconRule.prototype.checkShowIcon=function(){return ActivityFirstRechargeIconRule.checkShow()};ActivityFirstRechargeIconRule.prototype.checkShowRedPoint=function(){return 1};ActivityFirstRechargeIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};ActivityFirstRechargeIconRule.prototype.getEffTopName=function(){return"actIconCircleup_eff"};ActivityFirstRechargeIconRule.prototype.getBtnEffName=function(){return null};ActivityFirstRechargeIconRule.prototype.tapExecute=function(){var activityData=Activity.ins().activityData;var type26ActData;for(var k in activityData){var actData=activityData[k];if(actData.pageStyle==ActivityPageStyle.ACTIVITY_FIRST_RECHAGE){if(actData.isOpenActivity()&&!actData.getHide()){type26ActData=actData;break}}}ViewManager.ins().open(ActivityFirstRechargeWin,type26ActData)};return ActivityFirstRechargeIconRule}(RuleIconBase);__reflect(ActivityFirstRechargeIconRule.prototype,"ActivityFirstRechargeIconRule");var ActivityIconRule=function(_super){__extends(ActivityIconRule,_super);function ActivityIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards,Recharge.ins().postChangeRecharge];_this.updateMessage=[Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards];return _this}ActivityIconRule.prototype.createTar=function(){var tar=_super.prototype.createTar.call(this);if(GameServer.serverOpenDay<7){if(tar)tar["icon"]="zjmkaifu";this.icon="zjmkaifu"}else{if(tar)tar["icon"]="zjmhuodong";this.icon="zjmhuodong"}return tar};ActivityIconRule.prototype.checkShowIcon=function(){if(ChannelMgr.ins().isRechargeHidden()){return false}if(GameServer.serverOpenDay<7){if(this.tar)this.tar["icon"]="zjmkaifu";this.icon="zjmkaifu"}else{if(this.tar)this.tar["icon"]="zjmhuodong";this.icon="zjmhuodong"}if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY)){return false}var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum.length)return false;for(var k in data){var actData=data[k];if(!actData.pageStyle&&actData.timeType!=ActivityDataFactory.TimeType_Total){if(actData.isOpenActivity()&&!actData.getHide()){Activity.ins().levelChange();return true}}}data=PActivity.ins().activityData;for(var k in data){var actData=data[k];if(actData.isOpenActivity()&&!actData.getHide()){return true}}return false};ActivityIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(!actData.pageStyle&&actData.timeType!=ActivityDataFactory.TimeType_Total){if(actData.isOpenActivity()&&actData.canReward()){return 1}}}data=PActivity.ins().activityData;for(var k in data){var actData=data[k];if(actData.isOpenActivity()&&actData.canReward()){return 1}}return 0};ActivityIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};ActivityIconRule.prototype.tapExecute=function(){ViewManager.ins().open(ActivityWin);this.firstTap=false;this.update()};return ActivityIconRule}(RuleIconBase);__reflect(ActivityIconRule.prototype,"ActivityIconRule");var AuctionIconRule=function(_super){__extends(AuctionIconRule,_super);function AuctionIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Actor.ins().postExp,GameServer.ins().postServerOpenDay,Recharge.ins().postChangeRecharge];_this.updateMessage=[Auction.ins().postListData,Auction.ins().postAuctionResult,Auction.ins().postBuyResult,Auction.ins().postUpdate,Auction.ins().postBonusResult,GameServer.ins().postServerTime];return _this}AuctionIconRule.prototype.checkShowIcon=function(){if(ChannelMgr.ins().isRechargeHidden()){return false}if(Auction.ins().isAuctionOpen()){return true}return false};AuctionIconRule.prototype.checkShowRedPoint=function(){return Auction.ins().checkRed()?1:0};AuctionIconRule.prototype.getEffName=function(redPointNum){return undefined};AuctionIconRule.prototype.tapExecute=function(){ViewManager.ins().open(AuctionWin);Auction.ins().sendGetList(0);if(this.firstTap){if(Auction.ins().checkRed())this.firstTap=false;this.update()}};return AuctionIconRule}(RuleIconBase);__reflect(AuctionIconRule.prototype,"AuctionIconRule");var BattleGroundIconRule=function(_super){__extends(BattleGroundIconRule,_super);function BattleGroundIconRule(id,t){var _this=_super.call(this,id,t)||this;_this._time=0;_this.showMessage=[Actor.ins().postLevelChange,BattleGround.ins().postOpenInfo];return _this}BattleGroundIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this._timeTxt=new eui.Label;this._timeTxt.x=0;this._timeTxt.y=75;this._timeTxt.width=70;this._timeTxt.textAlign="center";this._timeTxt.text="";this._timeTxt.size=14;this._timeTxt.textColor=5893404;this._timeTxt.bold=true;t.addChild(this._timeTxt);if(BattleGround.ins().isOpen){this._timeTxt.text=i18n("PaoDianIconRule_0")}else{var leftTime=BattleGround.ins().getOpenLeftTime();if(leftTime>0){this._time=leftTime;this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4);if(!TimerManager.ins().isExists(this.setRepeat,this))TimerManager.ins().doTimer(1e3,0,this.setRepeat,this)}}return t};BattleGroundIconRule.prototype.checkShowIcon=function(){TimerManager.ins().removeAll(this);if(!OpenSystem.ins().checkSysOpen(SystemType.BattleGround))return false;if(BattleGround.ins().isOpen){return true}else{var leftTime=BattleGround.ins().getOpenLeftTime();if(leftTime>0){this._time=leftTime;if(!TimerManager.ins().isExists(this.setRepeat,this))TimerManager.ins().doTimer(1e3,0,this.setRepeat,this);return true}}return false};BattleGroundIconRule.prototype.setRepeat=function(){this._time--;if(this._time>0)this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4);else{this._timeTxt.text=i18n("PaoDianIconRule_1");TimerManager.ins().removeAll(this)}};BattleGroundIconRule.prototype.checkShowRedPoint=function(){return 0};BattleGroundIconRule.prototype.getEffName=function(redPointNum){this.effX=38;this.effY=45;return"actIconCircle"};BattleGroundIconRule.prototype.tapExecute=function(){this.update();if(!BattleGround.ins().isOpen){UserTips.ins().showTips(GlobalConfig.BattleGroundConfig.openTips);return}var openLevel=GlobalConfig.BattleGroundConfig.openLv;if(Actor.level+UserZs.ins().lv*1e3<openLevel){UserTips.ins().showTips((openLevel<1e3?openLevel+i18n("PaoDianNpcTalkWin_0"):openLevel%1e3==0?openLevel/1e3+i18n("PaoDianNpcTalkWin_1"):openLevel/1e3+i18n("PaoDianNpcTalkWin_2")+openLevel%1e3+i18n("PaoDianNpcTalkWin_3"))+i18n("PaoDianNpcTalkWin_4"));return}var cd=BattleGround.ins().getEnterCD();if(cd>0){UserTips.ins().showTips(cd+i18n("PaoDianNpcTalkWin_5"));return}BattleGround.ins().enterPaoDian()};return BattleGroundIconRule}(RuleIconBase);__reflect(BattleGroundIconRule.prototype,"BattleGroundIconRule");var BattleIconRule=function(_super){__extends(BattleIconRule,_super);function BattleIconRule(id,t){var _this=_super.call(this,id,t)||this;_this._time=0;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,BattleCC.ins().postOpenInfo];return _this}BattleIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this._timeTxt=new eui.Label;this._timeTxt.x=0;this._timeTxt.y=75;this._timeTxt.width=70;this._timeTxt.textAlign="center";this._timeTxt.text="";this._timeTxt.size=14;this._timeTxt.textColor=5893404;this._timeTxt.bold=true;t.addChild(this._timeTxt);if(BattleCC.ins().isOpen){this._timeTxt.text=i18n("BattleIconRule_0")}else{var leftTime=BattleCC.ins().getOpenLeftTime();if(leftTime>0){this._time=leftTime;this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4);if(!TimerManager.ins().isExists(this.setRepeat,this))TimerManager.ins().doTimer(1e3,0,this.setRepeat,this)}}return t};BattleIconRule.prototype.checkShowIcon=function(){TimerManager.ins().removeAll(this);if(!OpenSystem.ins().checkSysOpen(SystemType.BATTLE))return false;if(BattleCC.ins().isOpen){return true}else{var leftTime=BattleCC.ins().getOpenLeftTime();if(leftTime>0){this._time=leftTime;if(!TimerManager.ins().isExists(this.setRepeat,this))TimerManager.ins().doTimer(1e3,0,this.setRepeat,this);return true}}return false};BattleIconRule.prototype.setRepeat=function(){this._time--;if(this._time>0)this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4);else{this._timeTxt.text=i18n("BattleIconRule_1");TimerManager.ins().removeAll(this)}};BattleIconRule.prototype.checkShowRedPoint=function(){return 0};BattleIconRule.prototype.getEffName=function(redPointNum){this.effX=38;this.effY=45;return"actIconCircle"};BattleIconRule.prototype.tapExecute=function(){ViewManager.ins().open(FbWin,3);this.update()};return BattleIconRule}(RuleIconBase);__reflect(BattleIconRule.prototype,"BattleIconRule");var BBSIconRule=function(_super){__extends(BBSIconRule,_super);function BBSIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[];return _this}BBSIconRule.prototype.checkShowIcon=function(){return LocationProperty.appid==PlatFormID.QQ_BROWSER};BBSIconRule.prototype.tapExecute=function(){window["openTopicCircle"]()};return BBSIconRule}(RuleIconBase);__reflect(BBSIconRule.prototype,"BBSIconRule");var BossIconRule=function(_super){__extends(BossIconRule,_super);function BossIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[UserFb.ins().postGuanKaIdChange,UserTask.ins().postUpdteTaskTrace,ZsBoss.ins().postBossOpen,GameLogic.ins().postEnterMap];_this.updateMessage=[UserBoss.ins().postWorldBoss,UserBoss.ins().postWorldNotice,ZsBoss.ins().postBossList,UserBoss.ins().postBossData];return _this}BossIconRule.prototype.checkShowIcon=function(){var b=UserBoss.ins().checkBossIconShow();PlayFunView.instance.reliveBossArrow.visible=b;return b};BossIconRule.prototype.checkShowRedPoint=function(){if(PlayFun.ins().newBossRelive||UserFb.isCanChallenge()||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_QMBOSS)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_WORLDBOSS)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_HOMEBOSS)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_SHENYU)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_DARKBOSS))return 1;return 0};BossIconRule.prototype.tapExecute=function(){ViewManager.ins().open(BossWin);UserBoss.ins().postBossData(false)};BossIconRule.OpenTaskIndex=41;return BossIconRule}(RuleIconBase);__reflect(BossIconRule.prototype,"BossIconRule");var BoxIconRule=function(_super){__extends(BoxIconRule,_super);function BoxIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.updateMessage=[Box.ins().postUpdateData,Actor.ins().postLevelChange,Box.ins().postUpdateFreeBox];return _this}BoxIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=242004;this.alertText.horizontalCenter=0;t.addChild(this.alertText);this.alertText.y=48;if(BoxModel.ins().checkCanTake()){this.alertText.text=i18n("BoxIconRule_1");this.setTimeBgVisible(true)}else{this.startTime();this.runTime()}return t};BoxIconRule.prototype.startTime=function(){if(!TimerManager.ins().isExists(this.runTime,this)){TimerManager.ins().doTimer(1e3,0,this.runTime,this)}};BoxIconRule.prototype.removeTime=function(){TimerManager.ins().remove(this.runTime,this)};BoxIconRule.prototype.runTime=function(){var time=BoxModel.ins().getMinBoxTime();if(time==Number.MAX_VALUE){this.alertText.text="";this.setTimeBgVisible(false);this.removeTime()}else if(time<=0){this.alertText.text=i18n("BoxIconRule_2");this.setTimeBgVisible(true);this.removeTime();this.update()}else{this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}};BoxIconRule.prototype.checkShowIcon=function(){return false};BoxIconRule.prototype.checkShowRedPoint=function(){var flag=BoxModel.ins().checkRedPointShow()||BookRedPoint.ins().redpoint;if(flag){return 1}return 0};BoxIconRule.prototype.tapExecute=function(){ViewManager.ins().open(BoxBgWin)};BoxIconRule.prototype.getEffName=function(redPointNum){return undefined};return BoxIconRule}(RuleIconBase);__reflect(BoxIconRule.prototype,"BoxIconRule");var CDkeyIconRule=function(_super){__extends(CDkeyIconRule,_super);function CDkeyIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange];_this.updateMessage=[UserFuLi.ins().postMoneyInfoChange,Notice.ins().postGameNotice,DailyCheckIn.ins().postCheckInData,Activity.ins().postSevendayIsAwards,Recharge.ins().postFranchiseInfo,Activity.ins().postActivityIsGetAwards,UserFuLiHongbao.ins().postDailyEnvelopeInfo,LevelupRewardsSys.ins().postRewardsStatus,LevelupRewardsSys.ins().postRewardId,TimeCardMgr.ins().postInfo,UserVip.ins().postVipDailyRewards,UserVip.ins().postUpdateVipData,TrainGift.ins().postChangeState,Notice.ins().postChangeState,Recharge.ins().postChangeRecharge,BaoZang.ins().postChapterData,BaoZang.ins().postFuwentaData];return _this}CDkeyIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FULI)};CDkeyIconRule.prototype.checkShowRedPoint=function(){var b=false;var b1=DailyCheckIn.ins().showRedPoint()||Activity.ins().getSevenDayStast()||Activity.ins().checkNoticeRed()||UserFuLiHongbao.ins().isShowRedPoint()||LevelupRewardsSys.ins().isEnableGetRewards()||UserVip.ins().hasVipDailyReward()||Notice.ins().hasNewNotice||TrainGift.ins().isOpen()&&TrainGift.ins().hasRedPoint||BaoZang.ins().chapterCanGet()||BaoZang.ins().fuwentaCanGet();var b2=Recharge.ins().franchise&&Recharge.ins().franchiseget;if(ChannelMgr.ins().isRechargeHidden()){b=b1}else{b=b1||b2}if(b){return 1}return 0};CDkeyIconRule.prototype.getEffName=function(redPointNum){return undefined};CDkeyIconRule.prototype.tapExecute=function(){ViewManager.ins().open(FuliWin);this.update()};return CDkeyIconRule}(RuleIconBase);__reflect(CDkeyIconRule.prototype,"CDkeyIconRule");var CelebrationIconRule=function(_super){__extends(CelebrationIconRule,_super);function CelebrationIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards];return _this}CelebrationIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.CELEBRATION))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.CELEBRATION){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};CelebrationIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.CELEBRATION){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};CelebrationIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};CelebrationIconRule.prototype.tapExecute=function(){ViewManager.ins().open(CelebrationWin);if(this.firstTap){this.firstTap=false;this.update()}};return CelebrationIconRule}(RuleIconBase);__reflect(CelebrationIconRule.prototype,"CelebrationIconRule");var ChatMessageIconRule=function(_super){__extends(ChatMessageIconRule,_super);function ChatMessageIconRule(id,t){return _super.call(this,id,t)||this}ChatMessageIconRule.prototype.checkShowRedPoint=function(){return 0};ChatMessageIconRule.prototype.tapExecute=function(){ViewManager.ins().open(ChatWin)};return ChatMessageIconRule}(RuleIconBase);__reflect(ChatMessageIconRule.prototype,"ChatMessageIconRule");var ChristmasIconRule=function(_super){__extends(ChristmasIconRule,_super);function ChristmasIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange];return _this}ChristmasIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.CHRISTMAS))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.CHRISTMAS){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};ChristmasIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.CHRISTMAS){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};ChristmasIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};ChristmasIconRule.prototype.tapExecute=function(){ViewManager.ins().open(ChristmasDayWin);if(this.firstTap){this.firstTap=false;this.update()}};return ChristmasIconRule}(RuleIconBase);__reflect(ChristmasIconRule.prototype,"ChristmasIconRule");var CityIconRule=function(_super){__extends(CityIconRule,_super);function CityIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[GameLogic.ins().postEnterMap,Actor.ins().postExp];return _this}CityIconRule.prototype.checkShowIcon=function(){return PlayFunView.instance.cityIconShow()};CityIconRule.prototype.checkShowRedPoint=function(){return 0};CityIconRule.prototype.tapExecute=function(){if(!GameServer.serverOpenDay){UserTips.ins().showTips(i18n("CityIconRule_0"));return}if(!OpenSystem.ins().checkSysOpen(SystemType.CITY))return;if(!GameMap.sceneInMain())return;if(Encounter.ins().isEncounter()){UserTips.ins().showTips(i18n("CityIconRule_1"));return}if(CityCC.ins().enterCD<1){CityCC.ins().sendEnter()}else UserTips.ins().showTips(i18n("CityIconRule_2",CityCC.ins().enterCD))};CityIconRule.prototype.getEffName=function(redPointNum){return undefined};return CityIconRule}(RuleIconBase);__reflect(CityIconRule.prototype,"CityIconRule");var CityMonsterIconRule=function(_super){__extends(CityMonsterIconRule,_super);function CityMonsterIconRule(id,t){var _this=_super.call(this,id,t)||this;_this._shap=new egret.Shape;_this._radius=0;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay,GameApp.ins().postZeroInit,CityCC.ins().postCityBossIconVisable];_this.updateMessage=[CityCC.ins().postBossInfo,CityCC.ins().postCityBossId];return _this}CityMonsterIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.monHead=t["monHead"];this.process=t["process"];this._radius=t.width>>1;this._shap.x=this._radius;this._shap.y=this._radius;this._shap.rotation=-90;t.addChild(this._shap);this.process.mask=this._shap;return t};CityMonsterIconRule.prototype.checkShowIcon=function(){this.updateIcon();var isshow=GameServer.serverOpenDay&&OpenSystem.ins().checkSysOpen(SystemType.CITYMONSTER)&&!UserFb.ins().isCloseFbEntrance&&CityCC.ins().bossIconStatus;return isshow};CityMonsterIconRule.prototype.checkShowRedPoint=function(){this.updateIcon();var id=CityCC.ins().cityBossId;for(var i in GlobalConfig.CityBossConfig){var cfg=GlobalConfig.CityBossConfig[i];if(cfg.bossId==id&&cfg.killBossId<999){return 0}}return id};CityMonsterIconRule.prototype.tapExecute=function(){ViewManager.ins().open(CityBossView)};CityMonsterIconRule.prototype.getEffName=function(redPointNum){return undefined};CityMonsterIconRule.prototype.updateIcon=function(){var bossId=CityCC.ins().cityBossId;if(bossId==0){var _a=CityCC.ins().getMaxKillNumBoss(),id=_a[0],value=_a[1];bossId=id;this.curAngle=MathUtils.toInteger(value*360)}else this.curAngle=360;if(!GlobalConfig.MonstersConfig[bossId])return;if(this.monHead)this.monHead.source="monhead"+GlobalConfig.MonstersConfig[bossId].head+"_png"};CityMonsterIconRule.prototype.showIconTween=function(isshow){var tar=this.getTar();var t=egret.Tween.get(tar);tar.x=500;if(isshow){t.to({x:476},1e3)}};Object.defineProperty(CityMonsterIconRule.prototype,"curAngle",{set:function(value){DisplayUtils.drawCir(this._shap,this._radius,value)},enumerable:true,configurable:true});return CityMonsterIconRule}(RuleIconBase);__reflect(CityMonsterIconRule.prototype,"CityMonsterIconRule");var CollectionIconRule=function(_super){__extends(CollectionIconRule,_super);function CollectionIconRule(id,t){return _super.call(this,id,t)||this}CollectionIconRule.prototype.checkShowIcon=function(){return LocationProperty.appid==PlatFormID.QQ_BROWSER||LocationProperty.appid==PlatFormID.XIN_LANG};CollectionIconRule.prototype.tapExecute=function(){window["sendToDesktop"]()};return CollectionIconRule}(RuleIconBase);__reflect(CollectionIconRule.prototype,"CollectionIconRule");var DailyShareQQKJRule=function(_super){__extends(DailyShareQQKJRule,_super);function DailyShareQQKJRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.lastTapTime=null;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange];return _this}DailyShareQQKJRule.prototype.checkShowIcon=function(){return ChannelMgr.ins().isChuDongChannel()};DailyShareQQKJRule.prototype.checkShowRedPoint=function(){return 0};DailyShareQQKJRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};DailyShareQQKJRule.prototype.tapExecute=function(){var now=(new Date).getTime();if(this.lastTapTime!=null&&now-this.lastTapTime<2e3){return}this.lastTapTime=now;ChannelNet.ins().sendShareStart(1);if(this.firstTap){this.firstTap=false;this.update()}};return DailyShareQQKJRule}(RuleIconBase);__reflect(DailyShareQQKJRule.prototype,"DailyShareQQKJRule");var DesktopIconRule=function(_super){__extends(DesktopIconRule,_super);function DesktopIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[PfActivity.ins().postGameDesktop];return _this}DesktopIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FOCUS)&&!!PfActivity.ins().isShowGameDesktop};DesktopIconRule.prototype.checkShowRedPoint=function(){return 0};DesktopIconRule.prototype.tapExecute=function(){PfActivity.ins().saveGameDesktop()};return DesktopIconRule}(RuleIconBase);__reflect(DesktopIconRule.prototype,"DesktopIconRule");var DoubleElevenIconRule=function(_super){__extends(DoubleElevenIconRule,_super);function DoubleElevenIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,Activity.ins().postSpecials];return _this}DoubleElevenIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.DOUBLEELEVEN)){return false}var data=Activity.ins().doubleElevenData;for(var k in data){if(data[k].isOpenActivity())return true}return false};DoubleElevenIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().doubleElevenData;for(var k in data){var actData=data[k];if(actData.canReward()){if(Activity.ins().doubleElevenSpecialIDs.indexOf(actData.id)!=-1){if(actData.isSpecialOpen())return 1}else if(actData.isOpenActivity())return 1}}return 0};DoubleElevenIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};DoubleElevenIconRule.prototype.tapExecute=function(){ViewManager.ins().open(DoubleEleventWin);this.firstTap=false;this.update()};return DoubleElevenIconRule}(RuleIconBase);__reflect(DoubleElevenIconRule.prototype,"DoubleElevenIconRule");var DoubleTwelveActivityIconRule=function(_super){__extends(DoubleTwelveActivityIconRule,_super);function DoubleTwelveActivityIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Actor.ins().postLevelChange,Activity.ins().postActivityIsGetAwards];_this.updateMessage=[Activity.ins().postActivityIsGetAwards];return _this}DoubleTwelveActivityIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.DOUBLE_TWELVE)){return false}var data=Activity.ins().doubleTwelveData;for(var k in data){if(data[k].isOpenActivity())return true}return false};DoubleTwelveActivityIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().doubleTwelveData;for(var i in data){if(data[i].isOpenActivity()&&data[i].type==9){for(var j=0;j<3;j++){if(Activity.ins().isGetRollReward(data[i].id,j))return 1}}}return 0};DoubleTwelveActivityIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};DoubleTwelveActivityIconRule.prototype.tapExecute=function(){ViewManager.ins().open(DoubleTwelveWin);this.firstTap=false;this.update()};return DoubleTwelveActivityIconRule}(RuleIconBase);__reflect(DoubleTwelveActivityIconRule.prototype,"DoubleTwelveActivityIconRule");var DoubleTwelveRechargeIconRule=function(_super){__extends(DoubleTwelveRechargeIconRule,_super);function DoubleTwelveRechargeIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.time=0;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx];return _this}DoubleTwelveRechargeIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=242004;this.alertText.horizontalCenter=0;t.addChild(this.alertText);this.alertText.y=48;return t};DoubleTwelveRechargeIconRule.prototype.runTime=function(){var time=this.time;this.time-=1;if(time>0){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}else{this.alertText.text="";this.setTimeBgVisible(false);TimerManager.ins().remove(this.runTime,this);this.updateShow()}};DoubleTwelveRechargeIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.DOUBLE_TWELVE_RECHARGE)){return false}var rechargeData=Activity.ins().doubleTwelveRechargeData;for(var k in rechargeData){if(rechargeData[k].isOpenActivity()){var data=rechargeData[Activity.ins().doubleTwelveRechargeIDAry[0]];if(data){TimerManager.ins().remove(this.runTime,this);this.time=data.getLeftTime();TimerManager.ins().doTimer(1e3,0,this.runTime,this)}return true}}return false};DoubleTwelveRechargeIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().doubleTwelveRechargeData;for(var k in data){if(data[k].canReward()){return 1}}return 0};DoubleTwelveRechargeIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};DoubleTwelveRechargeIconRule.prototype.tapExecute=function(){ViewManager.ins().open(DoubleTwelveRechargeWin);this.firstTap=false;this.update()};return DoubleTwelveRechargeIconRule}(RuleIconBase);__reflect(DoubleTwelveRechargeIconRule.prototype,"DoubleTwelveRechargeIconRule");var DuanwuIconRule=function(_super){__extends(DuanwuIconRule,_super);function DuanwuIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,Activity.ins().postActivityIsGetAwards];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,GameApp.ins().postZeroInit];return _this}DuanwuIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.DUANWU))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.DUANWU){if(actData.isOpenActivity()){return true}}}return false};DuanwuIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.DUANWU){if(actData.isOpenActivity()&&actData.canReward()&&actData.specialState()){return 1}}}return 0};DuanwuIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};DuanwuIconRule.prototype.tapExecute=function(){ViewManager.ins().open(DuanwuWin);this.firstTap=false;this.update()};return DuanwuIconRule}(RuleIconBase);__reflect(DuanwuIconRule.prototype,"DuanwuIconRule");var DuanwuWin=function(_super){__extends(DuanwuWin,_super);function DuanwuWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.skinName="ActivityWinSkin";_this.isTopLevel=true;_this.selectIndex=0;return _this}DuanwuWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.menuList.itemRenderer=ActivityBtnRenderer};DuanwuWin.prototype.checkIndexByActivityId=function(actId){for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i].activityID==actId){return i}}return 0};DuanwuWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.DUANWU)continue;if(Activity.ins().getActivityDataById(+k).isOpenActivity()){return true}}UserTips.ins().showTips(i18n("DuanwuWin_0"));return false};DuanwuWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actId=param[0];this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.observe(Activity.ins().postActivityPanel,this.updatePanel);this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint);this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint);this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint);this.observe(Activity.ins().postChangePage,this.ChangePageCallBack);this.addChangeEvent(this.menuScroller,this.onChange)};DuanwuWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onClick);this.menuList.removeEventListener(egret.Event.CHANGE,this.onClickMenu,this);this.removeTouchEvent(this.leftBtn,this.onTouchBtn);this.removeTouchEvent(this.rightBtn,this.onTouchBtn);this.menuScroller.removeEventListener(egret.Event.CHANGE,this.onChange,this);this.removeObserve();TimerManager.ins().removeAll(this);for(var i=0;i<this.activityPanelList.length;i++){this.activityPanelList[i].close()}};DuanwuWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr);this.menuList.dataProvider=this.dataArr};DuanwuWin.prototype.updateView=function(){var index=0;var i=0;for(var i_16=0;i_16<this.viewStack.numElements;i_16++){ObjectPool.push(this.viewStack.getElementAt(i_16))}this.viewStack.removeChildren();this.activityPanelList=[];this._datas=[];i=0;for(var k in Activity.ins().activityData){if(!Activity.ins().activityData[k])continue;if(Activity.ins().activityData[k].pageStyle!=ActivityPageStyle.DUANWU){continue}if(Activity.ins().getActivityDataById(+k).isOpenActivity()){var data=Activity.ins().getbtnInfo(k);if(!ErrorLog.Assert(data,"DUANWU  data   "+k))this._datas.push(data)}}this._datas.sort(this.sort);this.BtnArr=[];for(var k in this._datas){var id=this._datas[k].id;var act=void 0;if(this._datas[k].activityType==ActivityType.Normal){act=Activity.ins().getActivityDataById(+id)}else if(this._datas[k].activityType==ActivityType.Personal){act=PActivity.ins().getActivityDataById(+id)}if(act&&act.id==id){var hide=act.getHide();if(!hide){var panel=ActivityPanel.create(id,act.activityType);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;this.activityPanelList[i]=panel;this.viewStack.addChild(this.activityPanelList[i]);this.BtnArr.push(this._datas[k]);if(this.actId&&this.actId==id){index=i}i++}}}this.dataArr=new eui.ArrayCollection(this.BtnArr);this.menuList.dataProvider=this.dataArr;this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}this.title.source="biaoti_duanwu"};DuanwuWin.prototype.updatePanel=function(activityID){for(var k in this.activityPanelList){if(this.activityPanelList[k].activityID==activityID){this.activityPanelList[k].updateData();break}}};DuanwuWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};DuanwuWin.prototype.setOpenIndex=function(selectedIndex){this.activityPanelList[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;Activity.ins().setPalyEffListById(this.activityPanelList[selectedIndex].activityID,true);this.refushRedPoint();Activity.ins().setfirstShowRedPointById(this.activityPanelList[selectedIndex].activityID,"onclicked")};DuanwuWin.prototype.onClickMenu=function(e){this.actId=0;if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;if(this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var config=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];if(config){if(config.activityType==3){this.setOpenIndex(this.selectIndex)}else{Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID)}}}};DuanwuWin.prototype.ChangePageCallBack=function(){if(this.actId)this.selectIndex=this.checkIndexByActivityId(this.actId);this.setOpenIndex(this.selectIndex)};DuanwuWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}this.leftRed.visible=this.leftBtn.visible;this.rightRed.visible=this.rightBtn.visible};DuanwuWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};DuanwuWin.prototype.sort=function(a,b){if(a.sort>b.sort)return 1;else if(a.sort<b.sort)return-1;else return 0};return DuanwuWin}(BaseEuiView);__reflect(DuanwuWin.prototype,"DuanwuWin");ViewManager.ins().reg(DuanwuWin,LayerManager.UI_Main);var ExpGoldIconRule=function(_super){__extends(ExpGoldIconRule,_super);function ExpGoldIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=_this.updateMessage=[UserVip.ins().postUpdateVipAwards,UserVip.ins().postUpdateVipData];return _this}ExpGoldIconRule.prototype.checkShowIcon=function(){return(UserVip.ins().state>>2&1)==0};ExpGoldIconRule.prototype.checkShowRedPoint=function(){var boo=(UserVip.ins().state>>2&1)==0&&UserVip.ins().lv>=3;return boo?1:0};ExpGoldIconRule.prototype.getEffName=function(redPointNum){return undefined};ExpGoldIconRule.prototype.tapExecute=function(){ViewManager.ins().open(Vip3Win);this.firstTap=false;this.update()};return ExpGoldIconRule}(RuleIconBase);__reflect(ExpGoldIconRule.prototype,"ExpGoldIconRule");var FanTigzIconRule=function(_super){__extends(FanTigzIconRule,_super);function FanTigzIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange];_this.updateMessage=[];return _this}FanTigzIconRule.prototype.update=function(){_super.prototype.update.call(this)};FanTigzIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)&&ChannelMgr.ins().isAnQiGeChannel()};FanTigzIconRule.prototype.checkShowRedPoint=function(){return 0};FanTigzIconRule.prototype.tapExecute=function(){ViewManager.ins().open(FanTiGuanzhuWin)};return FanTigzIconRule}(RuleIconBase);__reflect(FanTigzIconRule.prototype,"FanTigzIconRule");var FanTiVipIconRule=function(_super){__extends(FanTiVipIconRule,_super);function FanTiVipIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange];_this.updateMessage=[];return _this}FanTiVipIconRule.prototype.update=function(){_super.prototype.update.call(this)};FanTiVipIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)&&ChannelMgr.ins().isAnQiGeChannel()};FanTiVipIconRule.prototype.checkShowRedPoint=function(){return 0};FanTiVipIconRule.prototype.tapExecute=function(){ViewManager.ins().open(FanTiSuperVipWin)};return FanTiVipIconRule}(RuleIconBase);__reflect(FanTiVipIconRule.prototype,"FanTiVipIconRule");var FavorQQKJRule=function(_super){__extends(FavorQQKJRule,_super);function FavorQQKJRule(id,t){var _this=_super.call(this,id,t)||this;_this.lastTapTime=null;return _this}FavorQQKJRule.prototype.checkShowIcon=function(){return ChannelMgr.ins().isChuDongChannel()};FavorQQKJRule.prototype.checkShowRedPoint=function(){return 0};FavorQQKJRule.prototype.blink=function(){var t=egret.Tween.get(this.tar);t.to({alpha:0},500).to({alpha:1},500).call(this.blink.bind(this))};FavorQQKJRule.prototype.tapExecute=function(){var now=(new Date).getTime();if(this.lastTapTime!=null&&now-this.lastTapTime<2e3){return}this.lastTapTime=now;ChannelNet.ins().sendShareStart(2)};return FavorQQKJRule}(RuleIconBase);__reflect(FavorQQKJRule.prototype,"FavorQQKJRule");var FbBtnIconRule=function(_super){__extends(FbBtnIconRule,_super);function FbBtnIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[GameLogic.ins().postEnterMap,Actor.ins().postLevelChange,UserTask.ins().postUpdteTaskTrace];_this.updateMessage=[FbRedPoint.ins().postRedPoint];return _this}FbBtnIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FB)&&!UserFb.ins().pkGqboss};FbBtnIconRule.prototype.checkShowRedPoint=function(){return FbRedPoint.ins().redpoint?1:0};FbBtnIconRule.prototype.tapExecute=function(){ViewManager.ins().open(FbWin)};return FbBtnIconRule}(RuleIconBase);__reflect(FbBtnIconRule.prototype,"FbBtnIconRule");var FengceIconRule=function(_super){__extends(FengceIconRule,_super);function FengceIconRule(id,t){return _super.call(this,id,t)||this}FengceIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FENGCE)};FengceIconRule.prototype.checkShowRedPoint=function(){return 0};FengceIconRule.prototype.tapExecute=function(){ViewManager.ins().open(FengceActivityWin)};return FengceIconRule}(RuleIconBase);__reflect(FengceIconRule.prototype,"FengceIconRule");var FirstRankRule=function(_super){__extends(FirstRankRule,_super);function FirstRankRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.gap1=10;_this.gap2=10;_this.last=-1;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,GameServer.ins().postServerOpenDay,Activity.ins().postGetDaBiaoInfo,Activity.ins().postSevendayIsAwards,Activity.ins().postKuaFuRank,Rank.ins().postRankingData];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,GameServer.ins().postServerOpenDay,ShapeShiftingMgr.ins().postShapeShiftingUpgradeBreak,UserMiji.ins().postMijiChange,Actor.ins().postPowerChange,UserZs.ins().postZsLv,Wing.ins().postWingUpgrade,Book.ins().postDataChange,LongHun.ins().postStageUpgrade,UserForge.ins().postForgeUpdate,Actor.ins().postLevelChange,Activity.ins().postGetDaBiaoInfo,Activity.ins().postSevendayIsAwards,Activity.ins().postKuaFuRank,Rank.ins().postRankingData];return _this}FirstRankRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.targetGroup=t["targetGroup"];this.decNum=t["decNum"];this.rankType=t["rankType"];this.target=t["target"];this.btnClose=t["btnClose"];this.iconGroup=t["iconGroup"];return t};FirstRankRule.prototype.checkTips=function(){TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1e3*60*this.gap1,0,this.showTips,this);TimerManager.ins().doTimer(1e3*(60*this.gap1+this.gap2),0,this.hideTips,this);TimerManager.ins().doTimer(1e3*this.gap2,1,this.hideTips,this);this.btnClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hideTips,this);this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hideTips,this);this.showTips()};FirstRankRule.prototype.getTipVisible=function(){var curRankId=FirstRank.ins().getCurRankId();var rank=FirstRank.ins().getTargetRank();return curRankId>-1&&rank>0};FirstRankRule.prototype.showTips=function(){var curRankId=FirstRank.ins().getCurRankId();var rank=FirstRank.ins().getTargetRank();var v1=curRankId>-1&&rank>0;if(v1==false){return}if(!this.targetGroup){return}var v2=this.targetGroup.visible;this.targetGroup.visible=v1;if(v1&&!v2){this.checkTips();return}this.target.text=rank.toString();this.last=rank;this.decNum.text=FirstRank.ins().getDec(rank).toString();var cfg=GlobalConfig.FirstRankConfig[curRankId];var levelUnit=cfg.levelUnit;this.rankType.text=levelUnit};FirstRankRule.prototype.hideTips=function(){this.targetGroup.visible=false};FirstRankRule.prototype.checkShowIcon=function(){if(this.showMessage.indexOf(Actor.ins().postLevelChange)==-1){this.showMessage.push(Actor.ins().postLevelChange)}var v=OpenSystem.ins().checkSysOpen(SystemType.CHONGBANG)&&!FirstRank.ins().isOver();if(v){if(this.last!=FirstRank.ins().getTargetRank()){this.showTips()}}return v};FirstRankRule.prototype.checkShowRedPoint=function(){return FirstRank.ins().hasReward()?1:0};FirstRankRule.prototype.getEffName=function(redPointNum){if(this.firstTap){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};FirstRankRule.prototype.tapExecute=function(){FirstRank.ins().isClickInto=true;FirstRank.ins().sendGetRankData()};return FirstRankRule}(RuleIconBase);__reflect(FirstRankRule.prototype,"FirstRankRule");var FirstRechargeDailyIconRule=function(_super){__extends(FirstRechargeDailyIconRule,_super);function FirstRechargeDailyIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,Recharge.ins().postDailyDealsInfo,Recharge.ins().postDailyDealsAwards,Recharge.ins().postChangeRecharge];_this.updateMessage=[Recharge.ins().postDailyDealsInfo,Recharge.ins().postDailyDealsAwards];return _this}FirstRechargeDailyIconRule.prototype.createTar=function(){_super.prototype.createTar.call(this);return this.tar};FirstRechargeDailyIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)){return false}if(ChannelMgr.ins().isRechargeHidden()){return false}return true};FirstRechargeDailyIconRule.prototype.checkShowRedPoint=function(){var count=Recharge.ins().getDailyDealRedpoint();return count};FirstRechargeDailyIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};FirstRechargeDailyIconRule.prototype.getEffTopName=function(){return"actIconCircleup_eff"};FirstRechargeDailyIconRule.prototype.getBtnEffName=function(){this.btnEffX=38;this.btnEffY=38;return"mrth_eff"};FirstRechargeDailyIconRule.prototype.tapExecute=function(){ViewManager.ins().open(Recharge4Win)};return FirstRechargeDailyIconRule}(RuleIconBase);__reflect(FirstRechargeDailyIconRule.prototype,"FirstRechargeDailyIconRule");var FirstRechargeIconRule=function(_super){__extends(FirstRechargeIconRule,_super);function FirstRechargeIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx,Recharge.ins().postChangeRecharge];_this.updateMessage=[Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx];return _this}FirstRechargeIconRule.prototype.createTar=function(){_super.prototype.createTar.call(this);return this.tar};FirstRechargeIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)){return false}var data=Recharge.ins().getRechargeData(0);if(data.num==2){return false}if(ActivityFirstRechargeIconRule.checkShow()){return false}if(ChannelMgr.ins().isRechargeHidden()){return false}return true};FirstRechargeIconRule.prototype.checkShowRedPoint=function(){var count=0;var data=Recharge.ins().getRechargeData(0);if(data.num==1){for(var i=0;i<3;i++){if(data.firstRewardInfo[i]==1){count+=1}}}return count};FirstRechargeIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};FirstRechargeIconRule.prototype.getEffTopName=function(){return"actIconCircleup_eff"};FirstRechargeIconRule.prototype.getBtnEffName=function(){this.btnEffX=38;this.btnEffY=40;var data=Recharge.ins().getRechargeData(0);if(data.num==0){return"schl_eff"}else{return""}};FirstRechargeIconRule.prototype.tapExecute=function(){ViewManager.ins().open(Recharge1Win)};FirstRechargeIconRule.prototype.getLeftTipName=function(){return"timestip"};FirstRechargeIconRule.prototype.checkShowLeftTip=function(){var data=Recharge.ins().getRechargeData(0);return data.num==0?true:false};return FirstRechargeIconRule}(RuleIconBase);__reflect(FirstRechargeIconRule.prototype,"FirstRechargeIconRule");var FocusIconRule=function(_super){__extends(FocusIconRule,_super);function FocusIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange,PfActivity.ins().postGuanZhu];return _this}FocusIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FOCUS)&&PfActivity.ins().focusState==0};FocusIconRule.prototype.checkShowRedPoint=function(){return 1};FocusIconRule.prototype.tapExecute=function(){ViewManager.ins().open(FocusWin)};return FocusIconRule}(RuleIconBase);__reflect(FocusIconRule.prototype,"FocusIconRule");var FriendsIconRule=function(_super){__extends(FriendsIconRule,_super);function FriendsIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=false;_this.showMessage=[Actor.ins().postExp,GameLogic.ins().postEnterMap];_this.updateMessage=[Friends.ins().postFriendChange];return _this}FriendsIconRule.prototype.checkShowIcon=function(){var tar=this.getTar();tar["right"]=PlayFunView.instance.cityIconShow()||PlayFunView.instance.isInWild?115:55;return PlayFunView.instance.friendIconShow()};FriendsIconRule.prototype.checkShowRedPoint=function(){var rtn=0;if(Object.keys(Friends.ins().newMsg).length>0){for(var key in Friends.ins().newMsg){var value=Friends.ins().newMsg[key];if(value==true){rtn++;break}}}if(Friends.ins().appList.length>0){rtn++}return rtn};FriendsIconRule.prototype.getEffName=function(redPointNum){return undefined};FriendsIconRule.prototype.tapExecute=function(){if(Actor.level<GlobalConfig.FriendLimit.sysLv){UserTips.ins().showTips(i18n("FriendsIconRule_0",GlobalConfig.FriendLimit.sysLv))}else{ViewManager.ins().open(FriendBgWin)}};return FriendsIconRule}(RuleIconBase);__reflect(FriendsIconRule.prototype,"FriendsIconRule");var FuliHongbaoRule=function(_super){__extends(FuliHongbaoRule,_super);function FuliHongbaoRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[UserFuLiHongbao.ins().postDailyEnvelopeInfo,Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay,UserFuLiHongbao.ins().postLeftTimeZero];return _this}FuliHongbaoRule.prototype.checkShowIcon=function(){return UserFuLiHongbao.ins().canShowIcon()};FuliHongbaoRule.prototype.checkShowRedPoint=function(){return 1};FuliHongbaoRule.prototype.getEffName=function(redPointNum){return"actIconCircle"};FuliHongbaoRule.prototype.blink=function(){var t=egret.Tween.get(this.tar);t.to({alpha:0},500).to({alpha:1},500).call(this.blink.bind(this))};FuliHongbaoRule.prototype.tapExecute=function(){ViewManager.ins().open(FuliWin,"FuliHongbaoPanel")};return FuliHongbaoRule}(RuleIconBase);__reflect(FuliHongbaoRule.prototype,"FuliHongbaoRule");var FuncNoticeIconRule=function(_super){__extends(FuncNoticeIconRule,_super);function FuncNoticeIconRule(id){var _this=_super.call(this,id)||this;_this.funcNoticeLastLv=0;_this.showMessage=[UserFb.ins().postGuanKaIdChange];return _this}FuncNoticeIconRule.prototype.checkShowIcon=function(){var lv=UserFb.ins().guanqiaID;var config=FuncNoticeWin.getFuncNoticeConfigById(lv);if(!config)return false;var bool=config.openLv-lv<=10;if(bool){if(config.openLv-lv==0){if(lv-this.funcNoticeLastLv==1)UserTips.ins().showFuncNotice(lv);config=FuncNoticeWin.getFuncNoticeConfigById(lv+1);if(!config||config.openLv-lv>10)bool=false}if(bool&&this.tar){this.updateButton()}}this.funcNoticeLastLv=lv;return bool};FuncNoticeIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.updateButton();return t};FuncNoticeIconRule.prototype.updateButton=function(){var lv=UserFb.ins().guanqiaID;var config=FuncNoticeWin.getFuncNoticeConfigById(lv);this.tar["iconDisplay"].source="yg_"+config.index+"0";this.tar["txt"].text=i18n("FuncNoticeIconRule_0",config.openLv);if(config.index==2){this.tar["iconDisplay"].x=15;this.tar["iconDisplay"].y=0}else{this.tar["iconDisplay"].x=3;this.tar["iconDisplay"].y=-30}};FuncNoticeIconRule.prototype.tapExecute=function(){var lv=UserFb.ins().guanqiaID;var config=FuncNoticeWin.getFuncNoticeConfigById(lv);if(config.openLv-lv==0)lv+=1;UserTips.ins().showFuncNotice(lv)};return FuncNoticeIconRule}(RuleIconBase);__reflect(FuncNoticeIconRule.prototype,"FuncNoticeIconRule");var FunctionOpenIconRule=function(_super){__extends(FunctionOpenIconRule,_super);function FunctionOpenIconRule(id,icon){var _this=_super.call(this,id,icon)||this;_this.showMessage=[Actor.ins().postLevelChange,GameApp.ins().postZeroInit,GameServer.ins().postServerOpenDay,UserBoss.ins().postNewBossOpen];return _this}FunctionOpenIconRule.prototype.createTar=function(){var icon=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=5893404;this.alertText.horizontalCenter=0;icon.addChild(this.alertText);this.alertText.y=48;this.alertText.bold=true;var cfg=ActivityForeshowModel.ins().getForeshow();if(cfg){if(GameServer.serverOpenDay+1>cfg.close){this.alertText.text="";this.setTimeBgVisible(false)}else{this.time=this.getLeftTime();this.runTime();TimerManager.ins().doTimer(500,0,this.runTime,this)}icon["icon"]=cfg.icon;this.icon=cfg.icon}return icon};FunctionOpenIconRule.prototype.getLeftTime=function(){var leftTime=0;var cfg=ActivityForeshowModel.ins().getForeshow();if(cfg){if(GameServer.serverOpenDay+1<=cfg.close){var date=new Date(GameServer.serverTime);var day=cfg.close-GameServer.serverOpenDay;if(cfg.id==1){var time=UserBoss.ins().newWorldBossData.startTime;if(time){return leftTime}else{date.setDate(date.getDate()+day-1);date.setHours(19,20,0,0)}}else{date.setDate(date.getDate()+day);date.setHours(0,0,0,0)}leftTime=Math.floor((date.getTime()-GameServer.serverTime)/1e3);if(this.tar){this.tar["icon"]=cfg.icon}this.icon=cfg.icon}}return leftTime};FunctionOpenIconRule.prototype.runTime=function(){var time=ActivityForeshowModel.ins().getRemainTime();if(time>0){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}else{this.alertText.text="";this.setTimeBgVisible(false);TimerManager.ins().remove(this.runTime,this);this.updateShow()}};FunctionOpenIconRule.prototype.checkShowIcon=function(){var isShow=this.getLeftTime()>0;return isShow};FunctionOpenIconRule.prototype.checkShowRedPoint=function(){return 0};FunctionOpenIconRule.prototype.tapExecute=function(){ViewManager.ins().open(ActivityForeshowWin)};return FunctionOpenIconRule}(RuleIconBase);__reflect(FunctionOpenIconRule.prototype,"FunctionOpenIconRule");var GiftPackRule=function(_super){__extends(GiftPackRule,_super);function GiftPackRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay,Recharge.ins().postChangeRecharge];_this.updateMessage=[GiftPackMgr.ins().postGetInfo,GiftPackMgr.ins().postBuyGiftPack,GiftPackMgr.ins().postShowInfo,Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,UserZs.ins().postZsLv,GameServer.ins().postServerOpenDay,UserTask.ins().postUpdteTaskTrace,Actor.ins().postPowerChange];return _this}GiftPackRule.prototype.checkShowIcon=function(){if(ChannelMgr.ins().isRechargeHidden()){return false}var data=GiftPackMgr.ins().getPageData()||[];return OpenSystem.ins().checkSysOpen(SystemType.XIANGOUSHANGDIAN)&&data.length>0};GiftPackRule.prototype.checkShowRedPoint=function(){return GiftPackMgr.ins().canBuy()?1:0};GiftPackRule.prototype.getEffName=function(redPointNum){if(this.firstTap){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};GiftPackRule.prototype.getEffTopName=function(){return"actIconCircleup_eff"};GiftPackRule.prototype.tapExecute=function(){GiftPackMgr.ins().sendGetInfo();ViewManager.ins().open(GiftPackWin,0)};return GiftPackRule}(RuleIconBase);__reflect(GiftPackRule.prototype,"GiftPackRule");var GodWeaponIconRule=function(_super){__extends(GodWeaponIconRule,_super);function GodWeaponIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[GameApp.ins().postZeroInit,UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay];_this.updateMessage=[GodWeaponRedPoint.ins().postGodWeapon];return _this}GodWeaponIconRule.prototype.checkShowRedPoint=function(){var num=GodWeaponRedPoint.ins().godWeaponRed?1:0;return num};GodWeaponIconRule.prototype.checkShowIcon=function(){if(Actor.level>=GlobalConfig.GodWeaponBaseConfig.noticeOpenLv&&UserZs.ins().lv>=GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel&&GameServer.serverOpenDay+1>=GlobalConfig.GodWeaponBaseConfig.openDay){return true}else{return false}};GodWeaponIconRule.prototype.tapExecute=function(){if(KfArenaSys.ins().isKFMacthing()){UserTips.ins().showCenterTips(i18n("GodWeaponIconRule_0"))}else{ViewManager.ins().open(GodWeaponWin)}};return GodWeaponIconRule}(RuleIconBase);__reflect(GodWeaponIconRule.prototype,"GodWeaponIconRule");var GuangqiaIconRule=function(_super){__extends(GuangqiaIconRule,_super);function GuangqiaIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.canChallen=false;_this.showMessage=[GameLogic.ins().postEnterMap,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,UserTask.ins().postUpdteTaskTrace,UserFb.ins().postAutoPk,UserFb.ins().postAutoPk2];return _this}GuangqiaIconRule.prototype.checkShowIcon=function(){return UserFb.ins().checkGuanqiaIconShow()&&GameMap.sceneInMain()};GuangqiaIconRule.prototype.upDateGuanqiaWroldReward=function(){var boxPass=UserFb.ins().getWorldGuanQia();return UserFb.ins().isReceiveBox(boxPass)?1:0};GuangqiaIconRule.prototype.getEffName=function(redPointNum){var eff="";return eff};GuangqiaIconRule.prototype.tapExecute=function(){};return GuangqiaIconRule}(RuleIconBase);__reflect(GuangqiaIconRule.prototype,"GuangqiaIconRule");var GuildIconRule=function(_super){__extends(GuildIconRule,_super);function GuildIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange];_this.updateMessage=[GuildRedPoint.ins().postHanghui,GuildBoxMgr.ins().postBoxInfoChanged];return _this}GuildIconRule.prototype.checkShowIcon=function(){return Actor.level>=GlobalConfig.GuildConfig.openLevel};GuildIconRule.prototype.checkShowRedPoint=function(){return GuildRedPoint.ins().hanghui};GuildIconRule.prototype.tapExecute=function(){if(Actor.level>=GlobalConfig.GuildConfig.openLevel){if(Guild.ins().guildID==undefined||Guild.ins().guildID==0)ViewManager.ins().open(GuildApplyWin);else ViewManager.ins().open(GuildMap)}else{UserTips.ins().showTips(i18n("GuildIconRule_0",GlobalConfig.GuildConfig.openLevel))}};return GuildIconRule}(RuleIconBase);__reflect(GuildIconRule.prototype,"GuildIconRule");var GuildWarIconRule=function(_super){__extends(GuildWarIconRule,_super);function GuildWarIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[GuildWar.ins().postGuildWarStarInfo];return _this}GuildWarIconRule.prototype.checkShowIcon=function(){return GuildWar.ins().getModel().getIsShowGuildWarBtn()==1};GuildWarIconRule.prototype.getEffName=function(redPointNum){return undefined};GuildWarIconRule.prototype.tapExecute=function(){GuildWar.ins().toGuildWar()};return GuildWarIconRule}(RuleIconBase);__reflect(GuildWarIconRule.prototype,"GuildWarIconRule");var GuildWarRedBagIconRule=function(_super){__extends(GuildWarRedBagIconRule,_super);function GuildWarRedBagIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.updateMessage=[GuildRedPoint.ins().postRedBag];return _this}GuildWarRedBagIconRule.prototype.checkShowIcon=function(){return false};GuildWarRedBagIconRule.prototype.checkShowRedPoint=function(){return 0};GuildWarRedBagIconRule.prototype.getEffName=function(redPointNum){return undefined};GuildWarRedBagIconRule.prototype.tapExecute=function(){ViewManager.ins().open(RedBagWin)};return GuildWarRedBagIconRule}(RuleIconBase);__reflect(GuildWarRedBagIconRule.prototype,"GuildWarRedBagIconRule");var GuoQingIconRule=function(_super){__extends(GuoQingIconRule,_super);function GuoQingIconRule(id,t){return _super.call(this,id,t)||this}GuoQingIconRule.prototype.checkShowIcon=function(){var date=new Date(GameServer.serverTime);var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();return year==2017&&(month==9&&day==30||month==10&&day<9)};GuoQingIconRule.prototype.checkShowRedPoint=function(){return 0};GuoQingIconRule.prototype.getEffName=function(redPointNum){this.effX=38;this.effY=45;return"actIconCircle"};GuoQingIconRule.prototype.tapExecute=function(){ViewManager.ins().open(GuoActivityWin)};return GuoQingIconRule}(RuleIconBase);__reflect(GuoQingIconRule.prototype,"GuoQingIconRule");var GZHFollowRule=function(_super){__extends(GZHFollowRule,_super);function GZHFollowRule(id,t){var _this=_super.call(this,id,t)||this;_this.lastTapTime=null;return _this}GZHFollowRule.prototype.checkShowIcon=function(){return ChannelMgr.ins().is1758Channel()&&!window["1758follow"]||ChannelMgr.ins().isFKYLCChannel()&&!window["20117follow"]||ChannelMgr.ins().isMeiShengYuanChannelH5()&&!window["MSYfollow"]&&window["MSYshare"]||ChannelMgr.ins().isAWYCChannel()&&!window["20118chid"]&&!window["20118focus"]};GZHFollowRule.prototype.checkShowRedPoint=function(){return 0};GZHFollowRule.prototype.blink=function(){var t=egret.Tween.get(this.tar);t.to({alpha:0},500).to({alpha:1},500).call(this.blink.bind(this))};GZHFollowRule.prototype.tapExecute=function(){var now=(new Date).getTime();if(this.lastTapTime!=null&&now-this.lastTapTime<2e3){return}this.lastTapTime=now;if(ChannelMgr.ins().isFKYLCChannel()&&!window["20117follow"]){console.log("channel 20117 ChannelNet.ins().sendShareStart(9)");ChannelNet.ins().sendShareStart(9)}else if(ChannelMgr.ins().isAWYCChannel()){console.log("channel 20118 ChannelNet.ins().sendShareStart(11)");ChannelNet.ins().sendShareStart(11)}else{ChannelNet.ins().sendShareStart(4)}};return GZHFollowRule}(RuleIconBase);__reflect(GZHFollowRule.prototype,"GZHFollowRule");var HappySevenDayIconRule=function(_super){__extends(HappySevenDayIconRule,_super);function HappySevenDayIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this._activityID=0;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards];return _this}HappySevenDayIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.HAPPYSEVENDAY))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.HAPPYSEVENDAY){if(actData.isOpenActivity()&&!actData.getHide()){this._activityID=+k;return true}}}return false};HappySevenDayIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.HAPPYSEVENDAY){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};HappySevenDayIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};HappySevenDayIconRule.prototype.tapExecute=function(){ViewManager.ins().open(HappySevenDayWin,this._activityID);if(this.firstTap){this.firstTap=false;this.update()}};return HappySevenDayIconRule}(RuleIconBase);__reflect(HappySevenDayIconRule.prototype,"HappySevenDayIconRule");var HejiIconRule=function(_super){__extends(HejiIconRule,_super);function HejiIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[UserTask.ins().postUpdteTaskTrace];_this.playPunView=ViewManager.ins().getView(PlayFunView);var role=SubRoles.ins().getSubRoleByIndex(0);_this.guangquan=t["guangquan"];_this.questNumber=t["questNumber"];_this.skillName=t["skillName"];_this.Img=t["Img"];_this.bgimg=t["bgimg"];_this.imggroup=t["imggroup"];_this.eff=t["eff"];_this.skillName.source="8000"+role.job+"_png";_this.questNumber.text="0";_this.Img.source="7"+role.job+"000_png";_this.bgimg.source="7"+role.job+"000b_png";_this.mc=new MovieClip;_this.eff.addChild(_this.mc);_this.prossY=0;var p=_this.Img.localToGlobal();_this.imggroup.globalToLocal(p.x,p.y,p);_this.masksp=new egret.Sprite;var square=new egret.Shape;square.graphics.beginFill(16777215);square.graphics.drawRect(p.x,p.y,_this.Img.width,_this.Img.height);square.graphics.endFill();_this.prossY=p.y+_this.Img.height;_this.masksp.y=_this.prossY;_this.masksp.addChild(square);_this.imggroup.addChild(_this.masksp);_this.Img.mask=_this.masksp;var dif=_this.updatekStep();_this.updatePross(dif);return _this}HejiIconRule.prototype.checkShowIcon=function(){if(!UserTask.ins().taskTrace){return false}if(UserFb.ins().pkGqboss)return false;if(UserTask.ins().taskTrace.id>=TargetWin.TASKID){if(this.mc.parent)DisplayUtils.removeFromParent(this.mc);return false}return true};HejiIconRule.prototype.updatekStep=function(success){if(!UserTask.ins().taskTrace){return 0}if(UserTask.ins().taskTrace.id>=TargetWin.TASKID)return 0;var _loop_25=function(i){if(UserTask.ins().taskTrace.id==GlobalConfig.AchievementTaskConfig[i].taskId){var dif_1=GlobalConfig.AchievementTaskConfig[i].index;var difex=dif_1;if(success)difex=dif_1+1;this_19.questNumber.text=TargetWin.TASKID%100-difex+1+"";var self_15=this_19;this_19.showEff(function(){self_15.updatePross(dif_1)});if(success)return{value:dif_1>0?dif_1:0};return{value:dif_1<=1?0:dif_1}}};var this_19=this;for(var i in GlobalConfig.AchievementTaskConfig){var state_3=_loop_25(i);if(typeof state_3==="object")return state_3.value}return 0};HejiIconRule.prototype.showEff=function(func){var taskTraceName=this.playPunView.taskTraceName;var point=taskTraceName.localToGlobal();this.playPunView.globalToLocal(point.x,point.y,point);if(!this.jumpmc){this.jumpmc=new MovieClip;this.jumpmc.playFile(RES_DIR_EFF+"bally2",-1)}if(!this.jumpmc.parent)this.playPunView.addChild(this.jumpmc);this.jumpmc.x=point.x+this.playPunView.taskTraceBtn.width/2;this.jumpmc.y=point.y;point=this.playPunView.hejiguide.localToGlobal();this.playPunView.globalToLocal(point.x,point.y,point);var self=this;egret.Tween.get(this.jumpmc).to({x:point.x+self.playPunView.hejiguide.width/2,y:point.y+self.playPunView.hejiguide.height/2},600).call(function(){if(!self.mc.parent)self.eff.addChild(self.mc);self.mc.playFile(RES_DIR_EFF+"guidecircle",1,function(){DisplayUtils.removeFromParent(self.mc)});egret.Tween.removeTweens(self.jumpmc);DisplayUtils.removeFromParent(self.jumpmc);if(func&&typeof func=="function"){func()}})};HejiIconRule.prototype.updatePross=function(v){if(this.masksp){var value=v;var total=TargetWin.TASKID%100;var persent=value/total;persent=persent>=1?1:persent;this.masksp.y=this.prossY-Math.abs(this.prossY)*persent}};HejiIconRule.prototype.checkShowRedPoint=function(){return 0};HejiIconRule.prototype.tapExecute=function(){ViewManager.ins().open(TargetWin,TargetWin.HEJI);Artifact.ins().showGuide=-2e3};HejiIconRule.prototype.getEffName=function(redPointNum){return undefined};return HejiIconRule}(RuleIconBase);__reflect(HejiIconRule.prototype,"HejiIconRule");var InvestIconRule=function(_super){__extends(InvestIconRule,_super);function InvestIconRule(id,t){if(t===void 0){t=null}var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange,Invest.ins().postInvestmentInfo,Recharge.ins().postChangeRecharge];_this.updateMessage=[Actor.ins().postLevelChange,Invest.ins().postInvestmentInfo];return _this}InvestIconRule.prototype.checkShowIcon=function(){if(Actor.level<30){return false}var b=false;var ins=Invest.ins();if(!ins.isHadInvestLogin()||!ins.isHadInvestLevel()||this.isHadNotInvestNewLogin()||ins.isHaveLoginReward()||ins.isHaveNewLoginReward()||ins.isHaveLevelReward()||!ins.isHadGetAllLoginReward()||!ins.isHadGetAllNewLoginReward()||!ins.isHadGetAllLevelReward()){b=true}if(ChannelMgr.ins().isRechargeHidden()){b=false}return b};InvestIconRule.prototype.checkShowRedPoint=function(){var ins=Invest.ins();if(!ins.isHadInvestLogin()||!ins.isHadInvestLevel()||this.isHadNotInvestNewLogin()||ins.isHaveLoginReward()||ins.isHaveNewLoginReward()||ins.isHaveLevelReward()){return 1}return 0};InvestIconRule.prototype.isHadNotInvestNewLogin=function(){var ins=Invest.ins();return ins.investLoginReward>=Invest.EIGHT_DAYS&&!ins.isInvestNewLogin};InvestIconRule.prototype.tapExecute=function(){ViewManager.ins().open(InvestWin)};return InvestIconRule}(RuleIconBase);__reflect(InvestIconRule.prototype,"InvestIconRule");var InviterIconRule=function(_super){__extends(InviterIconRule,_super);function InviterIconRule(id,t){if(t===void 0){t=null}var _this=_super.call(this,id,t)||this;_this.showMessage=[Invite.ins().postInviteInfo];_this.updateMessage=[Invite.ins().postInviteInfo];return _this}InviterIconRule.prototype.checkShowIcon=function(){return false};InviterIconRule.prototype.checkShowRedPoint=function(){return 0};InviterIconRule.prototype.tapExecute=function(){ViewManager.ins().open(inviterWin)};return InviterIconRule}(RuleIconBase);__reflect(InviterIconRule.prototype,"InviterIconRule");var KaiMenHongIconRule=function(_super){__extends(KaiMenHongIconRule,_super);function KaiMenHongIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange];return _this}KaiMenHongIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.KAIMENHONG))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.KAIMENHONG){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};KaiMenHongIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.KAIMENHONG){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};KaiMenHongIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};KaiMenHongIconRule.prototype.tapExecute=function(){ViewManager.ins().open(KaiMenWin);if(this.firstTap){this.firstTap=false;this.update()}};return KaiMenHongIconRule}(RuleIconBase);__reflect(KaiMenHongIconRule.prototype,"KaiMenHongIconRule");var KFArenaRule=function(_super){__extends(KFArenaRule,_super);function KFArenaRule(id,t){var _this=_super.call(this,id,t)||this;_this._time=0;_this.showMessage=[UserZs.ins().postZsData,KfArenaSys.ins().postMacthState,KfArenaSys.ins().postOpenKfArena,GameServer.ins().postServerOpenDay];_this.updateMessage=[KfArenaRedPoint.ins().postRedPoint];return _this}KFArenaRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this._timeTxt=new eui.Label;this._timeTxt.x=0;this._timeTxt.y=80;this._timeTxt.width=70;this._timeTxt.textAlign="center";this._timeTxt.text="";this._timeTxt.size=14;this._timeTxt.textColor=5893404;this._timeTxt.bold=true;t.addChild(this._timeTxt);this.setState();return t};KFArenaRule.prototype.setRepeat=function(){this._time--;if(this._time>0)this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4);else{KfArenaSys.ins().isStartIng=1;if(KfArenaSys.ins().macthState==1){this._timeTxt.text=i18n("KFArenaRule_0")}else{this._timeTxt.text=i18n("KFArenaRule_1")}TimerManager.ins().removeAll(this)}};KFArenaRule.prototype.checkShowIcon=function(){var boo=KfArenaSys.ins().isOpen();this.setState();return boo};KFArenaRule.prototype.setState=function(){var boo=KfArenaSys.ins().isOpen();if(boo&&this.tar){if(KfArenaSys.ins().macthState==1){this._timeTxt.text=i18n("KFArenaRule_2")}else if(KfArenaSys.ins().isStartIng==1){this._timeTxt.text=i18n("KFArenaRule_3")}else{var leftTime=KfArenaSys.ins().getOpenLeftTime();if(leftTime>0){this._time=leftTime;this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4);if(!TimerManager.ins().isExists(this.setRepeat,this))TimerManager.ins().doTimer(1e3,0,this.setRepeat,this)}}}};KFArenaRule.prototype.checkShowRedPoint=function(){return KfArenaRedPoint.ins().redpoint};KFArenaRule.prototype.getEffName=function(redPointNum){this.effX=38;this.effY=45;return"actIconCircle"};KFArenaRule.prototype.tapExecute=function(){ViewManager.ins().open(KfArenaWin,0)};return KFArenaRule}(RuleIconBase);__reflect(KFArenaRule.prototype,"KFArenaRule");var KFIconRule=function(_super){__extends(KFIconRule,_super);function KFIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[UserZs.ins().postZsData,GameServer.ins().postServerOpenDay];_this.updateMessage=[KFBattleRedPoint.ins().postRedPoint,DevildomRedPoint.ins().postRedPoint,KfArenaRedPoint.ins().postRedPoint];return _this}KFIconRule.prototype.checkShowIcon=function(){var boo=KFBossSys.ins().isOpen()||KfArenaSys.ins().isAchieveOpenCfg()||DevildomSys.ins().isOpen();return boo};KFIconRule.prototype.checkShowRedPoint=function(){return KFBattleRedPoint.ins().redPoint||DevildomRedPoint.ins().redPoint||KfArenaRedPoint.ins().redpoint};KFIconRule.prototype.tapExecute=function(){ViewManager.ins().open(KFBattleWin)};return KFIconRule}(RuleIconBase);__reflect(KFIconRule.prototype,"KFIconRule");var LabaBossIconRule=function(_super){__extends(LabaBossIconRule,_super);function LabaBossIconRule(id,t){var _this=_super.call(this,id,t)||this;if(OpenSystem.ins().checkSysOpen(SystemType.LABA)){_this.activityData=Activity.ins().checkLabaBossData();if(!_this.activityData)return _this;_this.actId=_this.activityData.id}_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];return _this}LabaBossIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=242004;this.alertText.horizontalCenter=0;t.addChild(this.alertText);this.alertText.y=48;if(this.activityData.isOpenActivity()&&!this.activityData.IsEnd()){if(!TimerManager.ins().isExists(this.runTime,this)){TimerManager.ins().doTimer(1e3,0,this.runTime,this)}if(!TimerManager.ins().isExists(this.updateActivity,this)){TimerManager.ins().doTimer(3e4,0,this.updateActivity,this)}}return t};LabaBossIconRule.prototype.updateActivity=function(){if(this.activityData){Activity.ins().sendChangePage(this.activityData.id)}};LabaBossIconRule.prototype.runTime=function(){if(!this.actId)return;this.activityData=Activity.ins().getActivityDataById(this.actId);if(!this.activityData){TimerManager.ins().remove(this.runTime,this);TimerManager.ins().remove(this.updateActivity,this);return}if(this.activityData.IsEnd()){this.alertText.text=i18n("LabaBossIconRule_1");this.setTimeBgVisible(true);TimerManager.ins().remove(this.runTime,this);TimerManager.ins().remove(this.updateActivity,this);return}var curTime=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);var endTime=this.activityData.getEndTimer();if(curTime>=endTime){this.alertText.text=i18n("LabaBossIconRule_2");this.setTimeBgVisible(true);return}var startTime=this.activityData.getStartTimer();if(this.activityData.isGoIn){this.alertText.text=i18n("LabaBossIconRule_3");this.setTimeBgVisible(true)}else{var time=startTime-curTime;if(time>0){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}else{this.alertText.text=i18n("LabaBossIconRule_4");this.setTimeBgVisible(true)}}};LabaBossIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.LABA))return false;if(!this.activityData)return false;if(this.activityData.IsEnd()){return false}if(this.activityData.go2BossFb()){return true}return false};LabaBossIconRule.prototype.checkShowRedPoint=function(){return 0};LabaBossIconRule.prototype.tapExecute=function(){if(!this.activityData)return;if(this.activityData.IsEnd()){UserTips.ins().showTips(i18n("LabaBossIconRule_5"));return}if(this.activityData.go2BossFb()){Activity.ins().sendReward(this.activityData.id,this.activityData.index)}else{UserTips.ins().showTips(i18n("LabaBossIconRule_6"))}};return LabaBossIconRule}(RuleIconBase);__reflect(LabaBossIconRule.prototype,"LabaBossIconRule");var LabaIconRule=function(_super){__extends(LabaIconRule,_super);function LabaIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards];return _this}LabaIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.LABA))return false;var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.LABA){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};LabaIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.LABA){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};LabaIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};LabaIconRule.prototype.tapExecute=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.LABA))return;ViewManager.ins().open(LabaWin);if(this.firstTap){this.firstTap=false;this.update()}};return LabaIconRule}(RuleIconBase);__reflect(LabaIconRule.prototype,"LabaIconRule");var LadderBtnIconRule=function(_super){__extends(LadderBtnIconRule,_super);function LadderBtnIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[GameLogic.ins().postEnterMap,Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,UserTask.ins().postUpdteTaskTrace];_this.updateMessage=[Ladder.ins().postTadderChange,Encounter.ins().postEncounterDataChange,Mine.ins().postRedPoint,KFBattleRedPoint.ins().postRedPoint,UserFb.ins().postShowRedChange,EscortMgr.ins().postStatus,EscortMgr.ins().postStartEscort,EscortMgr.ins().postEndTimeReached,EscortMgr.ins().postBuyEscort];return _this}LadderBtnIconRule.prototype.checkShowIcon=function(){return UserFb.ins().guanqiaID>=GlobalConfig.SkirmishBaseConfig.openLevel&&!Encounter.ins().isGuiding&&!UserFb.ins().pkGqboss};LadderBtnIconRule.prototype.checkShowRedPoint=function(){var num=Encounter.ins().isHasRed();if(num){return num}if(Ladder.ins().checkRedShow()){return 1}if(Mine.redpointCheck()){return 1}if(EscortMgr.ins().checkRedPoint()){return 1}return 0};LadderBtnIconRule.prototype.getEffName=function(redPointNum){return undefined};LadderBtnIconRule.prototype.tapExecute=function(){ViewManager.ins().open(LadderWin,0)};return LadderBtnIconRule}(RuleIconBase);__reflect(LadderBtnIconRule.prototype,"LadderBtnIconRule");var LimitTaskIconRule=function(_super){__extends(LimitTaskIconRule,_super);function LimitTaskIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[UserTask.ins().postUpdteLimitTaskData,Actor.ins().postLevelChange,UserZs.ins().postZsData,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay,Recharge.ins().postChangeRecharge];_this.updateMessage=[UserTask.ins().postUpdteLimitTaskData];return _this}LimitTaskIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=5893404;this.alertText.horizontalCenter=0;t.addChildAt(this.alertText,1e3);this.alertText.y=48;this.alertText.bold=true;if(UserTask.ins().limitTaskState==0){this.alertText.text=i18n("LimitTaskIconRule_1");this.setTimeBgVisible(true)}else{this.runTime();TimerManager.ins().doTimer(1e3,0,this.runTime,this)}return t};LimitTaskIconRule.prototype.runTime=function(){var time=UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3);if(time>=0){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}else{this.alertText.text=i18n("LimitTaskIconRule_2");this.setTimeBgVisible(true);TimerManager.ins().remove(this.runTime,this);this.updateShow()}};LimitTaskIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.LIMITTASK)){return false}if(ChannelMgr.ins().isRechargeHidden()){return false}var config=GlobalConfig.LimitTimeConfig[UserTask.ins().currTaskListsId];if(!config)return false;if(UserTask.ins().limitTaskEndTime>0){if(UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3)<0){if(!GlobalConfig.LimitTimeConfig[UserTask.ins().currTaskListsId+1]){ViewManager.ins().close(LimitTaskView);return false}}else if(!GlobalConfig.LimitTimeConfig[UserTask.ins().currTaskListsId+1]&&UserTask.ins().limitTaskCount==8){this.updateShow();TimerManager.ins().doTimer(1500,1,function(){ViewManager.ins().close(LimitTaskView)},this);return false}}if(UserTask.ins().limitTaskState!=-1&&UserTask.ins().limitTaskEndTime>0)return true;return true};LimitTaskIconRule.prototype.checkShowRedPoint=function(){return UserTask.ins().getLimitTaskRed()};LimitTaskIconRule.prototype.tapExecute=function(){ViewManager.ins().open(LimitTaskView)};LimitTaskIconRule.prototype.getEffName=function(redPointNum){this.effX=38;this.effY=45;return"actIconCircle"};return LimitTaskIconRule}(RuleIconBase);__reflect(LimitTaskIconRule.prototype,"LimitTaskIconRule");var LongTaiTouIconRule=function(_super){__extends(LongTaiTouIconRule,_super);function LongTaiTouIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange];return _this}LongTaiTouIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.LONGTAITOU))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.LONGTAITOU){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};LongTaiTouIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.LONGTAITOU){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};LongTaiTouIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};LongTaiTouIconRule.prototype.tapExecute=function(){ViewManager.ins().open(LongTaiTouWin);if(this.firstTap){this.firstTap=false;this.update()}};return LongTaiTouIconRule}(RuleIconBase);__reflect(LongTaiTouIconRule.prototype,"LongTaiTouIconRule");var MaBiIconRule=function(_super){__extends(MaBiIconRule,_super);function MaBiIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[UserVip.ins().postUpdateVipAwards,UserVip.ins().postUpdateVipData,UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay];_this.updateMessage=[UserVip.ins().postUpdataExp];return _this}MaBiIconRule.prototype.checkShowIcon=function(){return false};MaBiIconRule.prototype.checkShowRedPoint=function(){return UserVip.ins().lv>=3?1:0};MaBiIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};MaBiIconRule.prototype.getEffTopName=function(){return"actIconCircleup_eff"};MaBiIconRule.prototype.tapExecute=function(){this.firstTap=false;this.update();ViewManager.ins().open(Vip3MWin,3)};return MaBiIconRule}(RuleIconBase);__reflect(MaBiIconRule.prototype,"MaBiIconRule");var MailIconRule=function(_super){__extends(MailIconRule,_super);function MailIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[UserMail.ins().postMailData,UserMail.ins().postGetItemFromMail,UserMail.ins().postMailDetail,GameLogic.ins().postEnterMap,Actor.ins().postExp];_this.updateMessage=[UserMail.ins().postMailData,UserMail.ins().postGetItemFromMail,UserMail.ins().postMailDetail];return _this}MailIconRule.prototype.checkShowIcon=function(){var tar=this.getTar();tar["right"]=PlayFunView.instance.cityIconShow()||PlayFunView.instance.isInWild?PlayFunView.instance.friendIconShow()?175:115:PlayFunView.instance.friendIconShow()?115:55;return PlayFunView.instance.mailIconShow()};MailIconRule.prototype.checkShowRedPoint=function(){if(UserMail.ins().mailData){return UserMail.ins().getUnreadMail()}return 0};MailIconRule.prototype.blink=function(){var t=egret.Tween.get(this.tar);t.to({alpha:0},500).to({alpha:1},500).call(this.blink.bind(this))};MailIconRule.prototype.tapExecute=function(){ViewManager.ins().open(FriendBgWin,4)};return MailIconRule}(RuleIconBase);__reflect(MailIconRule.prototype,"MailIconRule");var MallIconRule=function(_super){__extends(MallIconRule,_super);function MallIconRule(id,t){if(t===void 0){t=null}var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,Recharge.ins().postChangeRecharge];_this.updateMessage=[ShopRedPoint.ins().postShopRedPoint];return _this}MallIconRule.prototype.checkShowIcon=function(){if(ChannelMgr.ins().isRechargeHidden()){return false}return OpenSystem.ins().checkSysOpen(SystemType.MALL)};MallIconRule.prototype.checkShowRedPoint=function(){if(ShopRedPoint.ins().shopRedPoint||!ShopRedPoint.ins().nfirstLogin){return 1}return 0};MallIconRule.prototype.tapExecute=function(){ViewManager.ins().open(ShopWin);ShopRedPoint.ins().nfirstLogin=true;this.update()};return MallIconRule}(RuleIconBase);__reflect(MallIconRule.prototype,"MallIconRule");var MapIconRule=function(_super){__extends(MapIconRule,_super);function MapIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=_this.updateMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange];return _this}MapIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.WORLDMAP)};MapIconRule.prototype.checkShowRedPoint=function(){var preConfig=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward-1];var cfg=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward];if(!cfg){return 0}var needLevel=preConfig?cfg.needLevel-preConfig.needLevel:cfg.needLevel;var curLevel=UserFb.ins().guanqiaID-(preConfig?preConfig.needLevel:0)-1;if(curLevel>=needLevel)return 1;var config=GlobalConfig.WorldRewardConfig;for(var k in config){if(UserFb.ins().guanqiaID>config[k].needLevel&&!UserFb.ins().isGetReceiveBox(config[k].id)){return 1}}return 0};MapIconRule.prototype.tapExecute=function(){ViewManager.ins().open(GuanQiaWordMapWin)};return MapIconRule}(RuleIconBase);__reflect(MapIconRule.prototype,"MapIconRule");var MarryIconRule=function(_super){__extends(MarryIconRule,_super);function MarryIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange];_this.updateMessage=[MarryMgr.ins().postProposeRedPoint,MarryMgr.ins().postLevelRedPoint,MarryMgr.ins().postEquipRedPoint,MarryMgr.ins().postChestRedPoint,MarryMgr.ins().postTaskRedPoint];return _this}MarryIconRule.prototype.update=function(){_super.prototype.update.call(this)};MarryIconRule.prototype.checkShowIcon=function(){return MarryMgr.ins().isOpen()};MarryIconRule.prototype.checkShowRedPoint=function(){var c=0;var m=MarryMgr.ins().isMarried();if(m){c=MarryMgr.ins().getMarriedRedPoint()}else{c=MarryMgr.ins().getProposeRedPoint()}return c};MarryIconRule.prototype.tapExecute=function(){var m=MarryMgr.ins().isMarried();if(m){ViewManager.ins().open(MarriedMainWin)}else{ViewManager.ins().open(UnMarriedMainWin,1)}};return MarryIconRule}(RuleIconBase);__reflect(MarryIconRule.prototype,"MarryIconRule");var MonthCardIconRule=function(_super){__extends(MonthCardIconRule,_super);function MonthCardIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay,UserExpGold.ins().postExpUpdate,Recharge.ins().postGetMonthDay,Recharge.ins().postFranchiseInfo,Recharge.ins().postChangeRecharge];return _this}MonthCardIconRule.prototype.checkShowIcon=function(){var b=true;if(Recharge.ins().monthDay>0&&Recharge.ins().franchise>0){b=false}b=OpenSystem.ins().checkSysOpen(SystemType.MONTHCARD)&&b;if(ChannelMgr.ins().isRechargeHidden()){return false}return b};MonthCardIconRule.prototype.checkShowRedPoint=function(){return 0};MonthCardIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};MonthCardIconRule.prototype.getEffTopName=function(){return"actIconCircleup_eff"};MonthCardIconRule.prototype.tapExecute=function(){var index=2;if(Recharge.ins().monthDay>0){index=3;ViewManager.ins().open(FuliWin,"FranchiseWin")}else ViewManager.ins().open(FuliWin,"MonthCardWin");this.firstTap=false;this.update()};return MonthCardIconRule}(RuleIconBase);__reflect(MonthCardIconRule.prototype,"MonthCardIconRule");var NewWorldBossIconRule=function(_super){__extends(NewWorldBossIconRule,_super);function NewWorldBossIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=_this.updateMessage=[UserBoss.ins().postNewBossOpen,GameServer.ins().postServerOpenDay,GameServer.ins().postServerTime];return _this}NewWorldBossIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=242004;this.alertText.horizontalCenter=0;t.addChild(this.alertText);this.alertText.y=48;if(UserBoss.ins().newWorldBossData.startTime){this.runTime();if(!TimerManager.ins().isExists(this.runTime,this))TimerManager.ins().doTimer(1e3,0,this.runTime,this)}else{this.alertText.text=i18n("NewWorldBossIconRule_1");this.setTimeBgVisible(true)}return t};NewWorldBossIconRule.prototype.runTime=function(){var time=Math.floor((UserBoss.ins().newWorldBossData.startTime-GameServer.serverTime)/1e3);if(time>=0){if(this.alertText){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}}else if(GlobalConfig.NewWorldBossBaseConfig.bossTime*1e3+UserBoss.ins().newWorldBossData.startTime>GameServer.serverTime){this.alertText.text="";this.setTimeBgVisible(false)}else{if(this.alertText){this.alertText.text=i18n("NewWorldBossIconRule_2");this.setTimeBgVisible(true)}TimerManager.ins().remove(this.runTime,this);this.updateShow()}};NewWorldBossIconRule.prototype.checkShowIcon=function(){var b=UserBoss.ins().newWorldBossOpen();if(b&&UserBoss.ins().newWorldBossData.startTime){if(!TimerManager.ins().isExists(this.runTime,this))TimerManager.ins().doTimer(1e3,0,this.runTime,this)}return b};NewWorldBossIconRule.prototype.checkShowRedPoint=function(){return GameServer.serverTime>UserBoss.ins().newWorldBossData.startTime&&GlobalConfig.NewWorldBossBaseConfig.bossTime*1e3+UserBoss.ins().newWorldBossData.startTime>GameServer.serverTime?1:0};NewWorldBossIconRule.prototype.getEffName=function(){if(this.checkShowRedPoint()){this.effX=38;this.effY=45;return"actIconCircle"}return""};NewWorldBossIconRule.prototype.tapExecute=function(){ViewManager.ins().open(NewWorldBossWin)};return NewWorldBossIconRule}(RuleIconBase);__reflect(NewWorldBossIconRule.prototype,"NewWorldBossIconRule");var NewYearIconRule=function(_super){__extends(NewYearIconRule,_super);function NewYearIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Actor.ins().postLevelChange,Activity.ins().postActivityIsGetAwards];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange];return _this}NewYearIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.NEWYEAR))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.NEWYEAR){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};NewYearIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.NEWYEAR){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};NewYearIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};NewYearIconRule.prototype.tapExecute=function(){ViewManager.ins().open(NewYearWin);if(this.firstTap){this.firstTap=false;this.update()}};return NewYearIconRule}(RuleIconBase);__reflect(NewYearIconRule.prototype,"NewYearIconRule");var PaoDianIconRule=function(_super){__extends(PaoDianIconRule,_super);function PaoDianIconRule(id,t){var _this=_super.call(this,id,t)||this;_this._time=0;_this.showMessage=[Actor.ins().postLevelChange,PaoDianCC.ins().postOpenInfo];return _this}PaoDianIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this._timeTxt=new eui.Label;this._timeTxt.x=0;this._timeTxt.y=75;this._timeTxt.width=70;this._timeTxt.textAlign="center";this._timeTxt.text="";this._timeTxt.size=14;this._timeTxt.textColor=5893404;this._timeTxt.bold=true;t.addChild(this._timeTxt);if(PaoDianCC.ins().isOpen){this._timeTxt.text=i18n("PaoDianIconRule_0")}else{var leftTime=PaoDianCC.ins().getOpenLeftTime();if(leftTime>0){this._time=leftTime;this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4);if(!TimerManager.ins().isExists(this.setRepeat,this))TimerManager.ins().doTimer(1e3,0,this.setRepeat,this)}}return t};PaoDianIconRule.prototype.checkShowIcon=function(){TimerManager.ins().removeAll(this);if(!OpenSystem.ins().checkSysOpen(SystemType.PAODIAN))return false;if(PaoDianCC.ins().isOpen){return true}else{var leftTime=PaoDianCC.ins().getOpenLeftTime();if(leftTime>0){this._time=leftTime;if(!TimerManager.ins().isExists(this.setRepeat,this))TimerManager.ins().doTimer(1e3,0,this.setRepeat,this);return true}}return false};PaoDianIconRule.prototype.setRepeat=function(){this._time--;if(this._time>0)this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4);else{this._timeTxt.text=i18n("PaoDianIconRule_1");TimerManager.ins().removeAll(this)}};PaoDianIconRule.prototype.checkShowRedPoint=function(){return 0};PaoDianIconRule.prototype.getEffName=function(redPointNum){this.effX=38;this.effY=45;return"actIconCircle"};PaoDianIconRule.prototype.tapExecute=function(){ViewManager.ins().open(FbWin,3);this.update()};return PaoDianIconRule}(RuleIconBase);__reflect(PaoDianIconRule.prototype,"PaoDianIconRule");var PartnerIconRule=function(_super){__extends(PartnerIconRule,_super);function PartnerIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.updateMessage=[Actor.ins().postLevelChange,GameLogic.ins().postSubRoleChange];return _this}PartnerIconRule.prototype.checkShowIcon=function(){return SubRoles.ins().subRolesLen<3};PartnerIconRule.prototype.checkShowRedPoint=function(){var count=SubRoles.ins().subRolesLen;var config=GlobalConfig.NewRoleConfig[count];if(!config)return 0;var lv=config.zsLevel?UserZs.ins().lv:Actor.level;var configLv=config.zsLevel?config.zsLevel:config.level;if(lv>=configLv||UserVip.ins().lv>=config.vip)return 1;return 0};PartnerIconRule.prototype.tapExecute=function(){ViewManager.ins().open(NewRoleWin)};return PartnerIconRule}(RuleIconBase);__reflect(PartnerIconRule.prototype,"PartnerIconRule");var PeachIconRule=function(_super){__extends(PeachIconRule,_super);function PeachIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[GameServer.ins().postServerOpenDay,PeachSys.ins().postSysOpenState];_this.updateMessage=[UserBag.ins().postExchangeData,UserBag.ins().postItemAdd,UserBag.ins().postItemDel,UserBag.ins().postItemChange,UserTask.ins().postSevenDayTasks,PeachSys.ins().postBuyTimes,PeachSys.ins().postSysOpenState];return _this}PeachIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=5893404;this.alertText.horizontalCenter=0;t.addChildAt(this.alertText,1e3);this.alertText.y=48;this.alertText.bold=true;this.runTime();TimerManager.ins().doTimer(1e3,0,this.runTime,this);return t};PeachIconRule.prototype.runTime=function(){var end_time=PeachSys.ins().end_time;var time=Math.floor((DateUtils.formatMiniDateTime(end_time)-GameServer.serverTime)/1e3);if(time>=0){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}else{this.alertText.text="";this.setTimeBgVisible(true);TimerManager.ins().remove(this.runTime,this);this.updateShow()}};PeachIconRule.prototype.checkShowIcon=function(){return PeachSys.ins().isOpen()};PeachIconRule.prototype.checkShowRedPoint=function(){return PeachSys.ins().getRedPoint()};PeachIconRule.prototype.tapExecute=function(){var index=PeachSys.ins().getRedPoint(1)>0?1:0;ViewManager.ins().open(PeachWin,index)};return PeachIconRule}(RuleIconBase);__reflect(PeachIconRule.prototype,"PeachIconRule");var PeakedIconRule=function(_super){__extends(PeakedIconRule,_super);function PeakedIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,SpecialRing.ins().postGetSpicelRingInfo,SpecialRing.ins().postActiveRing,GameApp.ins().postZeroInit,GameServer.ins().postServerOpenDay,UserZs.ins().postZsLv,PeakedSys.ins().postState,Recharge.ins().postChangeRecharge];_this.updateMessage=[PeakedRedpoint.ins().postRedPoint,PeakedSys.ins().postState];return _this}PeakedIconRule.prototype.update=function(){_super.prototype.update.call(this);if(this.tar["txt"]){if(PeakedSys.ins().isKf()){if(PeakedSys.ins().kfStatusIsEnd&&PeakedSys.ins().kfStatus<KF_PeakStatus.Finals){this.tar["txt"].text=PeakedData.STATE_KF_ICON_CN[PeakedSys.ins().kfStatus+1];this.tar["txt"].y=48;this.tar["txt"].bold=true}else{this.tar["txt"].text=PeakedData.STATE_KF_ICON_CN[PeakedSys.ins().kfStatus];this.tar["txt"].y=48;this.tar["txt"].bold=true}}else{if(PeakedSys.ins().bfStatusIsEnd&&PeakedSys.ins().bfStatus<BF_PeakStatus.Finals){this.tar["txt"].text=PeakedData.STATE_ICON_CN[PeakedSys.ins().bfStatus+1];this.tar["txt"].y=48;this.tar["txt"].bold=true}else{this.tar["txt"].text=PeakedData.STATE_ICON_CN[PeakedSys.ins().bfStatus];this.tar["txt"].y=48;this.tar["txt"].bold=true}}if(this.tar["timeBg"]){this.tar["timeBg"].visible=this.tar["txt"].text!=""}}};PeakedIconRule.prototype.checkShowIcon=function(){if(ChannelMgr.ins().isRechargeHidden()){return false}return PeakedSys.ins().isOpen()};PeakedIconRule.prototype.checkShowRedPoint=function(){return PeakedRedpoint.ins().redpoint};PeakedIconRule.prototype.tapExecute=function(){ViewManager.ins().open(PeakedMainWin)};return PeakedIconRule}(RuleIconBase);__reflect(PeakedIconRule.prototype,"PeakedIconRule");var QDaTingIconRule=function(_super){__extends(QDaTingIconRule,_super);function QDaTingIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange];_this.updateMessage=[QQDaTingSys.ins().postUserInfo,QQDaTingSys.ins().postGetNewGift,QQDaTingSys.ins().postGetLevelGift,QQDaTingSys.ins().postGetDailyGift];return _this}QDaTingIconRule.prototype.update=function(){_super.prototype.update.call(this)};QDaTingIconRule.prototype.checkShowIcon=function(){return ChannelMgr.ins().isQQDaTingChannel()};QDaTingIconRule.prototype.checkShowRedPoint=function(){var isred=QQDaTingSys.ins().isEnableGetDaTingNewGift()||QQDaTingSys.ins().isEnableGetLevelRewards(QQDaTingSys.TYPE_DATING)||QQDaTingSys.ins().isEnableGetDaTingDailyGift();if(isred){return 1}return 0};QDaTingIconRule.prototype.tapExecute=function(){ViewManager.ins().open(QQDaTWin)};return QDaTingIconRule}(RuleIconBase);__reflect(QDaTingIconRule.prototype,"QDaTingIconRule");var QDaTVipIconRule=function(_super){__extends(QDaTVipIconRule,_super);function QDaTVipIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange];_this.updateMessage=[QQDaTingSys.ins().postUserInfo,QQDaTingSys.ins().postGetNewGift,QQDaTingSys.ins().postGetLevelGift,QQDaTingSys.ins().postGetDailyGift];return _this}QDaTVipIconRule.prototype.update=function(){_super.prototype.update.call(this)};QDaTVipIconRule.prototype.checkShowIcon=function(){return ChannelMgr.ins().isQQDaTingChannel()};QDaTVipIconRule.prototype.checkShowRedPoint=function(){var isred=QQDaTingSys.ins().isEnableGetDaTVipNewGift()||QQDaTingSys.ins().isEnableGetLevelRewards(QQDaTingSys.TYPE_DATVIP)||QQDaTingSys.ins().isEnableGetDaTVipDailyGift();if(isred){return 1}return 0};QDaTVipIconRule.prototype.tapExecute=function(){ViewManager.ins().open(DaTVipWin)};return QDaTVipIconRule}(RuleIconBase);__reflect(QDaTVipIconRule.prototype,"QDaTVipIconRule");var QzoneTqIconRule=function(_super){__extends(QzoneTqIconRule,_super);function QzoneTqIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[];_this.updateMessage=[QzoneSys.ins().postGetNewGift,QzoneSys.ins().postGetDailyGift,QzoneSys.ins().postGetTqGift,QzoneSys.ins().postGetLevelGift];return _this}QzoneTqIconRule.prototype.update=function(){_super.prototype.update.call(this)};QzoneTqIconRule.prototype.checkShowIcon=function(){return ChannelMgr.ins().isQQZoneChannel()};QzoneTqIconRule.prototype.checkShowRedPoint=function(){var isred=QzoneSys.ins().isEnableGetZoneNewGift()||QzoneSys.ins().isEnableGetZoneDailyGift()||QzoneSys.ins().isEnableGetZoneTqGift()||QzoneSys.ins().isEnableGetLevelRewards(QzoneSys.TYPE_QQZONE);if(isred){return 1}return 0};QzoneTqIconRule.prototype.tapExecute=function(){ViewManager.ins().open(QQzoneWin)};return QzoneTqIconRule}(RuleIconBase);__reflect(QzoneTqIconRule.prototype,"QzoneTqIconRule");var QzVipIconRule=function(_super){__extends(QzVipIconRule,_super);function QzVipIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange];_this.updateMessage=[QzoneSys.ins().postUserInfo,QzoneSys.ins().postGetNewGift,QzoneSys.ins().postGetLevelGift,QzoneSys.ins().postGetDailyGift,QzoneSys.ins().postActivateTittle];return _this}QzVipIconRule.prototype.update=function(){_super.prototype.update.call(this)};QzVipIconRule.prototype.checkShowIcon=function(){return ChannelMgr.ins().isQQZoneChannel()};QzVipIconRule.prototype.checkShowRedPoint=function(){var isred=QzoneSys.ins().isEnableGetQzNewGift()||QzoneSys.ins().isEnableGetLevelRewards(QzoneSys.TYPE_QQVIP)||QzoneSys.ins().isEnableGetQzDailyGift()||QzoneSys.ins().isEnableGetQzTittleGift();if(isred){return 1}return 0};QzVipIconRule.prototype.tapExecute=function(){ViewManager.ins().open(QzVipWin)};return QzVipIconRule}(RuleIconBase);__reflect(QzVipIconRule.prototype,"QzVipIconRule");var RankIconRule=function(_super){__extends(RankIconRule,_super);function RankIconRule(id,t){if(t===void 0){t=null}var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,UserZs.ins().postZsLv,GameServer.ins().postServerOpenDay];return _this}RankIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.RANK)};RankIconRule.prototype.checkShowRedPoint=function(){if(OpenSystem.ins().checkSysOpen(SystemType.RANK)){return 0}else{return Rank.ins().canPraiseInAll()?1:0}};RankIconRule.prototype.tapExecute=function(){ViewManager.ins().open(RankingWin)};return RankIconRule}(RuleIconBase);__reflect(RankIconRule.prototype,"RankIconRule");var RingIconRule=function(_super){__extends(RingIconRule,_super);function RingIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,SpecialRing.ins().postGetSpicelRingInfo,SpecialRing.ins().postActiveRing];_this.updateMessage=[SpecialRing.ins().postActiveRing,SpecialRing.ins().postGetSpicelRingInfo,UserBag.ins().postItemDel,UserBag.ins().postItemAdd];return _this}RingIconRule.prototype.checkShowIcon=function(){var b=OpenSystem.ins().checkSysOpen(SystemType.RING);if(b){var maxCount=Object.keys(GlobalConfig.ActorExRingConfig).length;b=SpecialRing.ins().ringActiNum<maxCount}return b};RingIconRule.prototype.checkShowRedPoint=function(){var flag=SpecialRing.ins().checkHaveUpRing();if(flag)return 1;return 0};RingIconRule.prototype.getEffName=function(){return undefined};RingIconRule.prototype.tapExecute=function(){if(SpecialRing.ins().checkRingOpen()){ViewManager.ins().open(RingInfoView)}else{UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.RING))}};return RingIconRule}(RuleIconBase);__reflect(RingIconRule.prototype,"RingIconRule");var RollMapIconRule=function(_super){__extends(RollMapIconRule,_super);function RollMapIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[GameServer.ins().postServerOpenDay,RollMapSys.ins().postSysOpenState];_this.updateMessage=[UserBag.ins().postExchangeData,UserBag.ins().postItemAdd,UserBag.ins().postItemDel,UserBag.ins().postItemChange,UserTask.ins().postSevenDayTasks,RollMapSys.ins().postBuyTimes,RollMapSys.ins().postSysOpenState];return _this}RollMapIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=5893404;this.alertText.horizontalCenter=0;t.addChildAt(this.alertText,1e3);this.alertText.y=48;this.alertText.bold=true;this.runTime();TimerManager.ins().doTimer(1e3,0,this.runTime,this);return t};RollMapIconRule.prototype.runTime=function(){var end_time=RollMapSys.ins().end_time;var time=Math.floor((DateUtils.formatMiniDateTime(end_time)-GameServer.serverTime)/1e3);if(time>=0){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}else{this.alertText.text="";this.setTimeBgVisible(true);TimerManager.ins().remove(this.runTime,this);this.updateShow()}};RollMapIconRule.prototype.checkShowIcon=function(){var open=RollMapSys.ins().isOpen();if(!open){ViewManager.ins().close(RollMapWin)}return open};RollMapIconRule.prototype.checkShowRedPoint=function(){return RollMapSys.ins().getRedPoint()};RollMapIconRule.prototype.tapExecute=function(){ViewManager.ins().open(RollMapWin)};return RollMapIconRule}(RuleIconBase);__reflect(RollMapIconRule.prototype,"RollMapIconRule");var SocketConst=function(){function SocketConst(){}SocketConst.SOCKET_CONNECT="SOCKET_CONNECT";SocketConst.SOCKET_RECONNECT="SOCKET_RECONNECT";SocketConst.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT";SocketConst.SOCKET_CLOSE="SOCKET_CLOSE";SocketConst.SOCKET_DATA="SOCKET_DATA";SocketConst.SOCKET_NOCONNECT="SOCKET_NOCONNECT";SocketConst.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO";return SocketConst}();__reflect(SocketConst.prototype,"SocketConst");var RuneIconRule=function(_super){__extends(RuneIconRule,_super);function RuneIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[UserZs.ins().postZsData];return _this}RuneIconRule.prototype.checkShowIcon=function(){var otherCfg=RuneConfigMgr.ins().getOtherCfg();return UserZs.ins().lv>=otherCfg.zsLevel};RuneIconRule.prototype.getEffName=function(){return undefined};RuneIconRule.prototype.tapExecute=function(){var otherCfg=RuneConfigMgr.ins().getOtherCfg();var isOpen=UserZs.ins().lv>=otherCfg.zsLevel;if(!isOpen){UserTips.ins().showTips(i18n("RuneIconRule_0",otherCfg.zsLevel));return}ViewManager.ins().open(RuneWin)};return RuneIconRule}(RuleIconBase);__reflect(RuneIconRule.prototype,"RuneIconRule");var SanbaIconRule=function(_super){__extends(SanbaIconRule,_super);function SanbaIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange];return _this}SanbaIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.SANBA))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.SANBA){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};SanbaIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.SANBA){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};SanbaIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};SanbaIconRule.prototype.tapExecute=function(){ViewManager.ins().open(SanbaWin);if(this.firstTap){this.firstTap=false;this.update()}};return SanbaIconRule}(RuleIconBase);__reflect(SanbaIconRule.prototype,"SanbaIconRule");var SevenDayIconRule=function(_super){__extends(SevenDayIconRule,_super);function SevenDayIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postSevendayIsAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postSevendayIsAwards];return _this}SevenDayIconRule.prototype.checkShowIcon=function(){return Actor.level>=10&&Activity.ins().getSevenDayLogIsVisible()};SevenDayIconRule.prototype.checkShowRedPoint=function(){return Activity.ins().getSevenDayStast()?1:0};SevenDayIconRule.prototype.getEffName=function(redPointNum){return undefined};SevenDayIconRule.prototype.tapExecute=function(){ViewManager.ins().open(SevenDayLogWin);this.firstTap=false;this.update()};return SevenDayIconRule}(RuleIconBase);__reflect(SevenDayIconRule.prototype,"SevenDayIconRule");var SevenDayTaskRule=function(_super){__extends(SevenDayTaskRule,_super);function SevenDayTaskRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[UserTask.ins().postSevenDayTasks,Actor.ins().postLevelChange];_this.updateMessage=[UserTask.ins().postSevenDayTasks];return _this}SevenDayTaskRule.prototype.checkShowIcon=function(){return Actor.level>=30&&UserTask.ins().createDays&&(UserTask.ins().createDays<=7?true:false)};SevenDayTaskRule.prototype.checkShowRedPoint=function(){return UserTask.ins().hasSevenDayTaskReward()?1:0};SevenDayTaskRule.prototype.tapExecute=function(){ViewManager.ins().open(SevenDayTaskWin)};return SevenDayTaskRule}(RuleIconBase);__reflect(SevenDayTaskRule.prototype,"SevenDayTaskRule");var Share1758Rule=function(_super){__extends(Share1758Rule,_super);function Share1758Rule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.lastTapTime=null;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange];return _this}Share1758Rule.prototype.checkShowIcon=function(){if(this.tar){if(ChannelMgr.ins().isAWYCChannel()){this.tar["icon"]="zjminvite"}else{this.tar["icon"]="zjmmeiyifenxiang"}this.icon=this.tar["icon"]}return ChannelMgr.ins().is1758Channel()||ChannelMgr.ins().isMeiShengYuanChannelH5()&&window["MSYshare"]||ChannelMgr.ins().isFKYLCChannel()||ChannelMgr.ins().isAWYCChannel()};Share1758Rule.prototype.checkShowRedPoint=function(){return 0};Share1758Rule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};Share1758Rule.prototype.tapExecute=function(){var now=(new Date).getTime();if(this.lastTapTime!=null&&now-this.lastTapTime<2e3){return}this.lastTapTime=now;if(ChannelMgr.ins().isFKYLCChannel()){console.log("channel 20117 ChannelNet.ins().sendShareStart(8)");ChannelNet.ins().sendShareStart(8)}else if(ChannelMgr.ins().isAWYCChannel()){console.log("channel 20118 ChannelNet.ins().sendShareStart(10)");ChannelNet.ins().sendShareStart(10)}else{ChannelNet.ins().sendShareStart(3)}if(this.firstTap){this.firstTap=false;this.update()}};return Share1758Rule}(RuleIconBase);__reflect(Share1758Rule.prototype,"Share1758Rule");var ShareIconRule=function(_super){__extends(ShareIconRule,_super);function ShareIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[PfActivity.ins().postInviteInfoUpdate,PfActivity.ins().postShare,Actor.ins().postLevelChange];_this.updateMessage=[PfActivity.ins().postInviteInfoUpdate];return _this}ShareIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.SHARE)&&PfActivity.ins().shareState!=-1&&PfActivity.ins().wxInviteCount<3};ShareIconRule.prototype.checkShowRedPoint=function(){var t=DateUtils.formatMiniDateTime(PfActivity.ins().inviteTime)-GameServer.serverTime;TimerManager.ins().removeAll(this);var b=t<=0?1:0;if(!b)TimerManager.ins().doTimer(t,1,this.updateTime,this);return b};ShareIconRule.prototype.updateTime=function(){this.update()};ShareIconRule.prototype.tapExecute=function(){ViewManager.ins().open(YqWin)};return ShareIconRule}(RuleIconBase);__reflect(ShareIconRule.prototype,"ShareIconRule");var ShenQiIconRule=function(_super){__extends(ShenQiIconRule,_super);function ShenQiIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,UserTask.ins().postUpdteTaskTrace,Artifact.ins().postNewArtifactInit,Artifact.ins().postNewArtifactUpdate,Artifact.ins().postGuide,ShoppingGift.ins().postInfo];return _this}ShenQiIconRule.prototype.checkShowIcon=function(){this.updateInfo();var b=OpenSystem.ins().checkSysOpen(SystemType.SHENQIGUIDE)&&!UserFb.ins().pkGqboss&&UserFb.ins().guanqiaID<340&&ShoppingGift.ins().getFirstGift()==null;return b};ShenQiIconRule.prototype.updateInfo=function(){var rewardData;var reward=UserFb.ins().getCurrentReward();var nextReward=UserFb.ins().getNextReward();if(reward){rewardData=reward[0];UserFb.ins().getMapReward();if(!this.pretips||this.pretips!=rewardData.id){this.pretips=rewardData.id;UserTips.ins().showItemTips(rewardData.id)}}else if(nextReward){rewardData=nextReward[0];if(this.labelChapter){var str=i18n("ShenQiIconRule_0",UserFb.ins().getNextNeedChapter());this.labelChapter.textFlow=TextFlowMaker.generateTextFlow1(str)}}if(rewardData&&this.tar)this.setReward(rewardData)};ShenQiIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.labelInfo=t["labelInfo"];this.imgInfo=t["imgInfo"];this.imgName=t["imgName"];this.imgItem=t["imgItem"];this.mcArtfactGroup=t["mcArtfactGroup"];this.labelChapter=t["labelChapter"];this.groupEff=t["groupEff"];this.updateInfo();return t};ShenQiIconRule.prototype.checkShowRedPoint=function(){return 0};ShenQiIconRule.prototype.tapExecute=function(){ViewManager.ins().open(TargetWin,TargetWin.SEHNQI);Artifact.ins().showGuide=-2e3};ShenQiIconRule.prototype.setMcArtfact=function(mcName,isGray){if(isGray===void 0){isGray=false}if(!this.mcArtfactGroup){return}if(!this.mcArtfact){this.mcArtfact=new MovieClip;this.mcArtfactGroup.addChild(this.mcArtfact)}this.mcArtfact.playFile(RES_DIR_SQ+mcName,-1);if(isGray){var filter=FilterUtil.ARRAY_GRAY_FILTER;this.mcArtfact.filters=filter}else{this.mcArtfact.filters=null}};ShenQiIconRule.prototype.setReward=function(rewardData){var conf=Artifact.ins().getConfByChipId(rewardData.id);if(!conf)return;this.imgName.source=conf.imgName;this.setMcArtfact(conf.mc,false);this.imgInfo.source=conf.simpleDesc;this.labelInfo.text=conf.buttonDesc};ShenQiIconRule.prototype.getEffName=function(redPointNum){return undefined};return ShenQiIconRule}(RuleIconBase);__reflect(ShenQiIconRule.prototype,"ShenQiIconRule");var SmallGameActivityIconRule=function(_super){__extends(SmallGameActivityIconRule,_super);function SmallGameActivityIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[GameServer.ins().postServerOpenDay,GameServer.ins().postServerTime,ChannelNet.ins().postShowIcon];_this.updateMessage=[ChannelNet.ins().postShareStart,ChannelNet.ins().postShareEnd,ChannelNet.ins().postAdInfo,ChannelNet.ins().postAdRewardRes];return _this}SmallGameActivityIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=5893404;this.alertText.horizontalCenter=0;t.addChildAt(this.alertText,1e3);this.alertText.y=48;this.alertText.bold=true;this.runTime();TimerManager.ins().doTimer(1e3,0,this.runTime,this);return t};SmallGameActivityIconRule.prototype.runTime=function(){var end_time=0;var time=Math.floor((DateUtils.formatMiniDateTime(end_time)-GameServer.serverTime)/1e3);if(time>=0){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}else{this.alertText.text="";this.setTimeBgVisible(false);TimerManager.ins().remove(this.runTime,this);this.updateShow()}};SmallGameActivityIconRule.prototype.checkShowIcon=function(){return ChannelMgr.ins().isQQSmallGameChannel()||ChannelNet.ins().showSmallGameActivity};SmallGameActivityIconRule.prototype.checkShowRedPoint=function(){var b=ChannelNet.ins().canGetAward(awardType.qqSubscribe)||ChannelNet.ins().canGetAward(awardType.qqAddToDeskTop)||ChannelNet.ins().canGetAdAward(adType.ad);if(ChannelNet.ins().hideShare()==false){b=b||ChannelNet.ins().showInviteRedPoint()||ChannelNet.ins().showClickGiftRedPoint()||ChannelNet.ins().showFriendGiftRedPoint()}return b?1:0};SmallGameActivityIconRule.prototype.tapExecute=function(){ViewManager.ins().open(SmallGameActivityWin)};return SmallGameActivityIconRule}(RuleIconBase);__reflect(SmallGameActivityIconRule.prototype,"SmallGameActivityIconRule");var SmallGameHongBaoIconRule=function(_super){__extends(SmallGameHongBaoIconRule,_super);function SmallGameHongBaoIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[GameServer.ins().postServerOpenDay,GameServer.ins().postServerTime,ChannelNet.ins().postShowIcon,Actor.ins().postLevelChange];_this.updateMessage=[ChannelNet.ins().postLoginInfo,ChannelNet.ins().postOpenLoginRedPacket,ChannelNet.ins().postWithdrawLoginCash,ChannelNet.ins().postCashGiftInfo,ChannelNet.ins().postWithdrawGiftCash];return _this}SmallGameHongBaoIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=5893404;this.alertText.horizontalCenter=0;t.addChildAt(this.alertText,1e3);this.alertText.y=48;this.alertText.bold=true;this.runTime();TimerManager.ins().doTimer(1e3,0,this.runTime,this);return t};SmallGameHongBaoIconRule.prototype.runTime=function(){var end_time=0;var time=Math.floor((DateUtils.formatMiniDateTime(end_time)-GameServer.serverTime)/1e3);if(time>=0){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}else{this.alertText.text="";this.setTimeBgVisible(false);TimerManager.ins().remove(this.runTime,this);this.updateShow()}};SmallGameHongBaoIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)){return false}if(ChannelMgr.ins().isRechargeHidden()){return false}return(ChannelMgr.ins().isQQSmallGameChannel()||ChannelNet.ins().showSmallGameActivity)&&(ChannelNet.ins().cashGift_left_period>0||ChannelNet.ins().loginGift_left_period>0)};SmallGameHongBaoIconRule.prototype.checkShowRedPoint=function(){var b=false;if(ChannelNet.ins().cashGift_left_period>=0){b=b||ChannelNet.ins().showRechargeRedPoint()}if(ChannelNet.ins().loginGift_left_period>=0){b=b||ChannelNet.ins().showLoginRedPoint()}return b?1:0};SmallGameHongBaoIconRule.prototype.tapExecute=function(){ViewManager.ins().open(SmallGameHongBaoWin)};return SmallGameHongBaoIconRule}(RuleIconBase);__reflect(SmallGameHongBaoIconRule.prototype,"SmallGameHongBaoIconRule");var SpringBeginIconRule=function(_super){__extends(SpringBeginIconRule,_super);function SpringBeginIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange,UserBag.ins().postItemDel];return _this}SpringBeginIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.SPRINGBEGIN))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.SPRINGBEGIN){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};SpringBeginIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.SPRINGBEGIN){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};SpringBeginIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};SpringBeginIconRule.prototype.tapExecute=function(){ViewManager.ins().open(SpringBeginWin);if(this.firstTap){this.firstTap=false;this.update()}};return SpringBeginIconRule}(RuleIconBase);__reflect(SpringBeginIconRule.prototype,"SpringBeginIconRule");var SpringEightDayIconRule=function(_super){__extends(SpringEightDayIconRule,_super);function SpringEightDayIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this._activityID=0;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards];return _this}SpringEightDayIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.SPRINGEIGHTDAY))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.SPRINGEIGHTDAY){if(actData.isOpenActivity()&&!actData.getHide()){this._activityID=+k;return true}}}return false};SpringEightDayIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.SPRINGEIGHTDAY){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};SpringEightDayIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};SpringEightDayIconRule.prototype.tapExecute=function(){ViewManager.ins().open(SpringEightDayWin,this._activityID);if(this.firstTap){this.firstTap=false;this.update()}};return SpringEightDayIconRule}(RuleIconBase);__reflect(SpringEightDayIconRule.prototype,"SpringEightDayIconRule");var SpringFestivalIconRule=function(_super){__extends(SpringFestivalIconRule,_super);function SpringFestivalIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange,UserBag.ins().postItemDel];return _this}SpringFestivalIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.SPRINGFESTIVAL))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.SPRINGFESTIVAL){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};SpringFestivalIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.SPRINGFESTIVAL){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};SpringFestivalIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};SpringFestivalIconRule.prototype.tapExecute=function(){ViewManager.ins().open(SpringFestivalWin);if(this.firstTap){this.firstTap=false;this.update()}};return SpringFestivalIconRule}(RuleIconBase);__reflect(SpringFestivalIconRule.prototype,"SpringFestivalIconRule");var StrengthRule=function(_super){__extends(StrengthRule,_super);function StrengthRule(id,t){var _this=_super.call(this,id,t)||this;_this.isCheck=false;_this.showMessage=[Actor.ins().postLevelChange];_this.updateMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,UserZs.ins().postZsLv,GameServer.ins().postServerOpenDay,UserTask.ins().postUpdteTaskTrace,Actor.ins().postPowerChange,StrengthMgr.ins().postGetInfo,StrengthMgr.ins().postGetZLReward,StrategySys.ins().postChange];var self=_this;TimerManager.ins().doTimer(3500,1,function(){self.isCheck=true;console.log("StrengthRule isCheck = "+self.isCheck)},self);return _this}StrengthRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);return t};StrengthRule.prototype.setRepeat=function(){};StrengthRule.prototype.checkShowIcon=function(){return StrengthMgr.ins().isOpen()};StrengthRule.prototype.checkShowRedPoint=function(){if(StrategySys.ins().canReward())return 1;if(!this.isCheck)return 0;return StrengthMgr.ins().isHaveTask()||StrengthMgr.ins().isHaveZhanLiReward()?1:0};StrengthRule.prototype.getEffName=function(redPointNum){this.effX=38;this.effY=45;return"actIconCircle"};StrengthRule.prototype.tapExecute=function(){ViewManager.ins().open(StrengthWin,0)};return StrengthRule}(RuleIconBase);__reflect(StrengthRule.prototype,"StrengthRule");var SuperVipIconRule=function(_super){__extends(SuperVipIconRule,_super);function SuperVipIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[UserVip.ins().postSuperVipData,UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange];return _this}SuperVipIconRule.prototype.checkShowIcon=function(){if(OpenSystem.ins().checkSysOpen(SystemType.SUPERVIP)&&UserVip.ins().superVipData){return UserVip.ins().superVipData.enabled}return false};SuperVipIconRule.prototype.checkShowRedPoint=function(){return 0};SuperVipIconRule.prototype.tapExecute=function(){ViewManager.ins().open(SuperVipWin)};return SuperVipIconRule}(RuleIconBase);__reflect(SuperVipIconRule.prototype,"SuperVipIconRule");var SVIPIconRule=function(_super){__extends(SVIPIconRule,_super);function SVIPIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.lastTapTime=null;_this.showMessage=[Actor.ins().postLevelChange,GameServer.ins().postServerOpenDay,Actor.ins().postExp,Actor.ins().postInit];return _this}SVIPIconRule.prototype.checkShowIcon=function(){if(ChannelMgr.ins().isFKYLCChannel()&&window["20117SVIP"]){if(this.getTar()){this.tar["iconDisplay"].width=90;this.tar["iconDisplay"].height=90;this.tar["icon"]=window["20117SVIP"];this.icon=window["20117SVIP"]}return true}if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)){return false}if(ChannelMgr.ins().isAWYCChannel()){return true}return false};SVIPIconRule.prototype.checkShowRedPoint=function(){return 0};SVIPIconRule.prototype.blink=function(){var t=egret.Tween.get(this.tar);t.to({alpha:0},500).to({alpha:1},500).call(this.blink.bind(this))};SVIPIconRule.prototype.tapExecute=function(){var now=(new Date).getTime();if(this.lastTapTime!=null&&now-this.lastTapTime<2e3){return}this.lastTapTime=now;if(ChannelMgr.ins().isAWYCChannel()){var sdk_2=window["AWY_SDK"];if(!sdk_2){console.log("channel 20118 sdk = null L41");return}console.log("channel 20118 ChannelNet.ins().sendShareStart(12)");if(window["20118SVIP"]=="connectSVIP"){sdk_2.connectSVIP()}else if(window["20118SVIP"]=="addSVIP"){sdk_2.addSVIP()}}else if(ChannelMgr.ins().isFKYLCChannel()){var sdk=window["HORTOR_AGENT"];if(!sdk){console.log("channel 20117 sdk = null L60");return}sdk.openSVIP();console.log("channel 20117 sdk.openSVIP()")}};return SVIPIconRule}(RuleIconBase);__reflect(SVIPIconRule.prototype,"SVIPIconRule");var TaskTraceIconRule=function(_super){__extends(TaskTraceIconRule,_super);function TaskTraceIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.currentEff="";_this.showMessage=[UserTask.ins().postUpdteTaskTrace,Actor.ins().postLevelChange,GameLogic.ins().postEnterMap];_this.updateMessage=[UserTask.ins().postUpdteTaskTrace,Actor.ins().postLevelChange];return _this}TaskTraceIconRule.prototype.checkShowIcon=function(){var b=UserTask.ins().getTaskState()&&!UserFb.ins().pkGqboss;return b};TaskTraceIconRule.prototype.getEffName=function(redPointNum){var eff;var data=UserTask.ins().taskTrace;if(data){switch(data.state){case 1:eff="achieveCom";this.effX=30;this.effY=33.5;break}}if(this.currentEff!=eff){var playPunView=ViewManager.ins().getView(PlayFunView);if(playPunView.ruleEffBottom[this.tar.hashCode]){DisplayUtils.removeFromParent(playPunView.ruleEffBottom[this.tar.hashCode]);playPunView.ruleEffBottom[this.tar.hashCode]=null}if(playPunView.ruleEffTop[this.tar.hashCode]){DisplayUtils.removeFromParent(playPunView.ruleEffTop[this.tar.hashCode]);playPunView.ruleEffTop[this.tar.hashCode]=null}if(playPunView.btnEff[this.tar.hashCode]){DisplayUtils.removeFromParent(playPunView.btnEff[this.tar.hashCode]);playPunView.btnEff[this.tar.hashCode]=null}}this.currentEff=eff;return eff};TaskTraceIconRule.prototype.getEffLayer=function(){return 100};TaskTraceIconRule.prototype.tapExecute=function(){var data=UserTask.ins().taskTrace;if(data.state==0){GameGuider.taskGuidance(data.id,1);GuideUtils.ins().updateByClick()}else{UserTask.ins().sendGetAchieve(data.achievementId);UserTask.ins().postParabolicItem();Hint.ins().postAchievementAft(data);if(!UserTask.ins().getAchieveConfById(data.id+1)){UserTips.ins().showTips(i18n("TaskTraceIconRule_0"))}var view=ViewManager.ins().getView(PlayFunView);view.hejiRule.updatekStep(true)}this.update()};return TaskTraceIconRule}(RuleIconBase);__reflect(TaskTraceIconRule.prototype,"TaskTraceIconRule");var ThanksIconRule=function(_super){__extends(ThanksIconRule,_super);function ThanksIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay,Activity.ins().postActivityIsGetAwards];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx];return _this}ThanksIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.THANKS))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.THANKS){if(actData.isOpenActivity()){return true}}}return false};ThanksIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.THANKS){if(actData.isOpenActivity()&&actData.canReward()&&actData.specialState()){return 1}}}return 0};ThanksIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};ThanksIconRule.prototype.tapExecute=function(){ViewManager.ins().open(ThanksGivingWin);this.firstTap=false;this.update()};return ThanksIconRule}(RuleIconBase);__reflect(ThanksIconRule.prototype,"ThanksIconRule");var TicketIconRule=function(_super){__extends(TicketIconRule,_super);function TicketIconRule(id,t){if(t===void 0){t=null}var _this=_super.call(this,id,t)||this;_this.showMessage=[];_this.updateMessage=[];return _this}TicketIconRule.prototype.checkShowIcon=function(){return true};TicketIconRule.prototype.checkShowRedPoint=function(){return 1};TicketIconRule.prototype.tapExecute=function(){ViewManager.ins().open(TicketWin)};return TicketIconRule}(RuleIconBase);__reflect(TicketIconRule.prototype,"TicketIconRule");var TicketRule=function(_super){__extends(TicketRule,_super);function TicketRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[];_this.updateMessage=[TicketSys.ins().postGetInfo,TicketSys.ins().postTaskInfo,TicketSys.ins().postFinishTask,TicketSys.ins().postBtnRedPoint];return _this}TicketRule.prototype.checkShowIcon=function(){return true};TicketRule.prototype.checkShowRedPoint=function(){return TicketSys.ins().isHasTicketReward()||TicketSys.ins().btnRedPointShow?1:0};TicketRule.prototype.tapExecute=function(){ViewManager.ins().open(TicketWin)};return TicketRule}(RuleIconBase);__reflect(TicketRule.prototype,"TicketRule");var TimeCardRule=function(_super){__extends(TimeCardRule,_super);function TimeCardRule(id,t){if(t===void 0){t=null}var _this=_super.call(this,id,t)||this;_this.showMessage=[];_this.updateMessage=[];return _this}TimeCardRule.prototype.checkShowIcon=function(){return true};TimeCardRule.prototype.checkShowRedPoint=function(){return 1};TimeCardRule.prototype.tapExecute=function(){ViewManager.ins().open(TicketWin)};return TimeCardRule}(RuleIconBase);__reflect(TimeCardRule.prototype,"TimeCardRule");var TotalRechargeIconRule=function(_super){__extends(TotalRechargeIconRule,_super);function TotalRechargeIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.activityId=0;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Recharge.ins().postUpdateRecharge];return _this}TotalRechargeIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=242004;this.alertText.horizontalCenter=0;t.addChild(this.alertText);this.alertText.y=48;this.runTime();this.addTime();return t};TotalRechargeIconRule.prototype.addTime=function(){TimerManager.ins().doTimer(1e3,0,this.runTime,this)};TotalRechargeIconRule.prototype.removeTime=function(){TimerManager.ins().remove(this.runTime,this)};TotalRechargeIconRule.prototype.runTime=function(){var data=Activity.ins().activityData;if(!this.activityId){for(var k in data){var actData_1=data[k];if(actData_1.pageStyle==ActivityPageStyle.TOTALRECHARGE){if(actData_1.isOpenActivity()&&!actData_1.getHide()){this.activityId=+k;break}}}}if(!this.activityId){this.alertText.text="";this.setTimeBgVisible(false);return}var actData=data[this.activityId];if(!actData){this.alertText.text="";this.setTimeBgVisible(false);return}var time=actData.getLeftTime();if(time>0){this.alertText.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_12);this.setTimeBgVisible(true)}else{var panel=ViewManager.ins().getView(PlayFunView);if(panel){this.removeTime();this.update()}}};TotalRechargeIconRule.prototype.checkShowIcon=function(){this.removeTime();if(!OpenSystem.ins().checkSysOpen(SystemType.DOUBLE_TWELVE_RECHARGE))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.TOTALRECHARGE){if(actData.isOpenActivity()&&!actData.getHide()){this.activityId=+k;var data3=data[this.activityId];if(data3.getLeftTime()>0){this.addTime();return true}}}}return false};TotalRechargeIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.TOTALRECHARGE){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};TotalRechargeIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};TotalRechargeIconRule.prototype.tapExecute=function(){ViewManager.ins().open(TotalRechargeWin);if(this.firstTap){this.firstTap=false;this.update()}};return TotalRechargeIconRule}(RuleIconBase);__reflect(TotalRechargeIconRule.prototype,"TotalRechargeIconRule");var TreasureIconRule=function(_super){__extends(TreasureIconRule,_super);function TreasureIconRule(id,t){if(t===void 0){t=null}var _this=_super.call(this,id,t)||this;_this.showMessage=[UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay];_this.updateMessage=[UserBag.ins().postItemAdd,UserBag.ins().postHuntStore,Heirloom.ins().postHuntBoxInfo,ShapeShiftingTreasure.ins().postHuntBoxInfo];return _this}TreasureIconRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.TREASURE)};TreasureIconRule.prototype.checkShowRedPoint=function(){if(Setting.ins().getValue(ClientSet.firstClickTreasure)!=new Date(GameServer.serverTime).getDate()){return 1}if(Hunt.ins().showRedPoint()){return 1}if(ShapeShiftingTreasure.ins().showRedPoint()){return 1}if(Rune.ins().showRedPoint()){return 1}if(Millionaire.ins().showRedPoint()){return 1}if(Heirloom.ins().showRedPoint()){return 1}return 0};TreasureIconRule.prototype.tapExecute=function(){ViewManager.ins().open(TreasureHuntWin);var date=new Date(GameServer.serverTime).getDate();if(Setting.ins().getValue(ClientSet.firstClickTreasure)!=date){Setting.ins().setValue(ClientSet.firstClickTreasure,date);this.update()}};return TreasureIconRule}(RuleIconBase);__reflect(TreasureIconRule.prototype,"TreasureIconRule");var VersionCeleIconRule=function(_super){__extends(VersionCeleIconRule,_super);function VersionCeleIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange,UserBag.ins().postItemDel];return _this}VersionCeleIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.VERSIONCEL))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.VERSIONCELE){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};VersionCeleIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.VERSIONCELE){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};VersionCeleIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};VersionCeleIconRule.prototype.tapExecute=function(){ViewManager.ins().open(VersionCeleWin);if(this.firstTap){this.firstTap=false;this.update()}};return VersionCeleIconRule}(RuleIconBase);__reflect(VersionCeleIconRule.prototype,"VersionCeleIconRule");var VertifyIconRule=function(_super){__extends(VertifyIconRule,_super);function VertifyIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.lastTapTime=null;return _this}VertifyIconRule.prototype.checkShowIcon=function(){return ChannelMgr.ins().isAWYCChannel()&&!window["20118verify"]};VertifyIconRule.prototype.checkShowRedPoint=function(){return 0};VertifyIconRule.prototype.blink=function(){var t=egret.Tween.get(this.tar);t.to({alpha:0},500).to({alpha:1},500).call(this.blink.bind(this))};VertifyIconRule.prototype.tapExecute=function(){var now=(new Date).getTime();if(this.lastTapTime!=null&&now-this.lastTapTime<2e3){return}this.lastTapTime=now;if(ChannelMgr.ins().isAWYCChannel()){console.log("channel 20118 ChannelNet.ins().sendShareStart(12)");ChannelNet.ins().sendShareStart(12)}};return VertifyIconRule}(RuleIconBase);__reflect(VertifyIconRule.prototype,"VertifyIconRule");var VipGiftIconRule=function(_super){__extends(VipGiftIconRule,_super);function VipGiftIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange,UserVip.ins().postVipGiftBuy,GameServer.ins().postServerOpenDay];_this.updateMessage=[UserVip.ins().postUpdateVipData,UserVip.ins().postVipGiftBuy,Recharge.ins().postUpdateRechargeEx,Actor.ins().postYbChange,GameServer.ins().postServerOpenDay];return _this}VipGiftIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.VIPGIFT)){return false}var maxId=Object.keys(GlobalConfig.VipGiftConfig).length;var state=UserVip.ins().vipGiftState;for(var id=1;id<=maxId;id++){var hfTimes=GlobalConfig.VipGiftConfig[id].hfTimes;hfTimes=hfTimes?hfTimes:0;if(GameServer._hefuCount>=hfTimes&&(state[id-1].state&1)==0){return true}}return false};VipGiftIconRule.prototype.checkShowRedPoint=function(){var vip=UserVip.ins().lv;for(var id in GlobalConfig.VipGiftConfig){var config=GlobalConfig.VipGiftConfig[id];var hfTimes=config.hfTimes;hfTimes=hfTimes?hfTimes:0;if(vip>=config.vipLv&&GameServer._hefuCount>=hfTimes){if(UserVip.ins().getVipGiftRedPoint(+id)){return 1}}}return 0};VipGiftIconRule.prototype.tapExecute=function(){ViewManager.ins().open(VipGiftWin)};return VipGiftIconRule}(RuleIconBase);__reflect(VipGiftIconRule.prototype,"VipGiftIconRule");var WJBattleIconRule=function(_super){__extends(WJBattleIconRule,_super);function WJBattleIconRule(id,t){return _super.call(this,id,t)||this}WJBattleIconRule.prototype.checkShowIcon=function(){return WJBattlefieldSys.ins().isOpen};WJBattleIconRule.prototype.checkShowRedPoint=function(){return KFBattleRedPoint.ins().redPoint1};WJBattleIconRule.prototype.tapExecute=function(){ViewManager.ins().open(WJBattlefieldWin)};return WJBattleIconRule}(RuleIconBase);__reflect(WJBattleIconRule.prototype,"WJBattleIconRule");var WriteInviteNumRule=function(_super){__extends(WriteInviteNumRule,_super);function WriteInviteNumRule(id,t){if(t===void 0){t=null}var _this=_super.call(this,id,t)||this;_this.showMessage=[Invite.ins().postInviteInfo];_this.updateMessage=[Invite.ins().postInviteInfo];return _this}WriteInviteNumRule.prototype.checkShowIcon=function(){if(!Invite.ins().isHadReq){Invite.ins().isHadReq=true;Invite.ins().sendInviteInfoReq()}else{if(Invite.ins().enable==1&&Invite.ins().is_inviter==0&&Invite.ins().is_bind_invite==0){return true}}return false};WriteInviteNumRule.prototype.checkShowRedPoint=function(){return 0};WriteInviteNumRule.prototype.tapExecute=function(){ViewManager.ins().open(WriteInviteIDWin)};return WriteInviteNumRule}(RuleIconBase);__reflect(WriteInviteNumRule.prototype,"WriteInviteNumRule");var XiaoNianIconRule=function(_super){__extends(XiaoNianIconRule,_super);function XiaoNianIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange];return _this}XiaoNianIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.XIAONIAN))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.XIAONIAN){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};XiaoNianIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.XIAONIAN){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};XiaoNianIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};XiaoNianIconRule.prototype.tapExecute=function(){ViewManager.ins().open(XiaoNianWin);if(this.firstTap){this.firstTap=false;this.update()}};return XiaoNianIconRule}(RuleIconBase);__reflect(XiaoNianIconRule.prototype,"XiaoNianIconRule");var YBZhuanPanIconRule=function(_super){__extends(YBZhuanPanIconRule,_super);function YBZhuanPanIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.activityId=0;_this.showMessage=[Activity.ins().postActivityIsGetAwards,UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange];return _this}YBZhuanPanIconRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);this.alertText=new eui.Label;this.alertText.size=14;this.alertText.width=120;this.alertText.textAlign="center";this.alertText.textColor=242004;this.alertText.horizontalCenter=0;t.addChild(this.alertText);this.alertText.y=48;this.runTime();this.addTime();return t};YBZhuanPanIconRule.prototype.addTime=function(){TimerManager.ins().doTimer(1e3,0,this.runTime,this)};YBZhuanPanIconRule.prototype.removeTime=function(){TimerManager.ins().remove(this.runTime,this)};YBZhuanPanIconRule.prototype.runTime=function(){var data=Activity.ins().activityData;if(!this.activityId){for(var k in data){var actData_2=data[k];if(actData_2.pageStyle==ActivityPageStyle.YBZHUANPAN){if(actData_2.isOpenActivity()&&!actData_2.getHide()){this.activityId=+k;break}}}}if(!this.activityId){this.alertText.text="";this.setTimeBgVisible(false);return}var actData=data[this.activityId];if(!actData){this.alertText.text="";this.setTimeBgVisible(false);return}if(!actData.getLeftTime()){this.removeTime()}var time=actData.getRemainTime();this.alertText.text=time;this.setTimeBgVisible(true)};YBZhuanPanIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.CHRISTMAS))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.YBZHUANPAN){if(actData.isOpenActivity()&&!actData.getHide()){return true}}}return false};YBZhuanPanIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.YBZHUANPAN){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};YBZhuanPanIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};YBZhuanPanIconRule.prototype.tapExecute=function(){ViewManager.ins().open(YBZhuanPanWin);if(this.firstTap){this.firstTap=false;this.update()}};return YBZhuanPanIconRule}(RuleIconBase);__reflect(YBZhuanPanIconRule.prototype,"YBZhuanPanIconRule");var YqBtnIconRule=function(_super){__extends(YqBtnIconRule,_super);function YqBtnIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[PfActivity.ins().postInviteInfoUpdate];return _this}YqBtnIconRule.prototype.checkShowIcon=function(){var isOpen=true;if(PfActivity.ins().wxInviteCount>=3){isOpen=false}return isOpen&&YqBtnIconRule.isShowIcon};YqBtnIconRule.prototype.tapExecute=function(){ViewManager.ins().open(YqWin)};YqBtnIconRule.isShowIcon=false;return YqBtnIconRule}(RuleIconBase);__reflect(YqBtnIconRule.prototype,"YqBtnIconRule");var ZeroPurchaseRule=function(_super){__extends(ZeroPurchaseRule,_super);function ZeroPurchaseRule(id,t){var _this=_super.call(this,id,t)||this;_this.showMessage=[Actor.ins().postLevelChange,UserVip.ins().postUpdateVipData];_this.updateMessage=[Activity.ins().postRewardResult];TimerManager.ins().doTimer(2e3,1,_this.updateShow,_this);ZeroPurchaseLocalStorageItem.rule=_this;return _this}ZeroPurchaseRule.prototype.createTar=function(){var t=_super.prototype.createTar.call(this);return t};ZeroPurchaseRule.prototype.setRepeat=function(){};ZeroPurchaseRule.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.ZEROPURCHASE)&&ZeroPurchase.ins().getLeftTime()>0};ZeroPurchaseRule.prototype.checkShowRedPoint=function(){var r=ZeroPurchase.ins().isHaveLeftBuyTime()&&ZeroPurchaseLocalStorageItem.hasRedPoint?1:0;return r};ZeroPurchaseRule.prototype.getEffName=function(redPointNum){this.effX=38;this.effY=45;return"actIconCircle"};ZeroPurchaseRule.prototype.tapExecute=function(){ViewManager.ins().open(ZeroPurchaseWin,0)};return ZeroPurchaseRule}(RuleIconBase);__reflect(ZeroPurchaseRule.prototype,"ZeroPurchaseRule");var ZhanLingIconRule=function(_super){__extends(ZhanLingIconRule,_super);function ZhanLingIconRule(id,t){var _this=_super.call(this,id,t)||this;_this.firstTap=true;_this.showMessage=[Activity.ins().postActivityIsGetAwards,UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay];_this.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange];return _this}ZhanLingIconRule.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.ZHANLING))return false;var data=Activity.ins().activityData;var sum=Object.keys(data);if(!sum||!sum.length)return false;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.ZHANLING){if(actData.isOpenActivity()&&!actData.getHide())return true}}return false};ZhanLingIconRule.prototype.checkShowRedPoint=function(){var data=Activity.ins().activityData;for(var k in data){var actData=data[k];if(actData.pageStyle==ActivityPageStyle.ZHANLING){if(actData.isOpenActivity()&&actData.canReward()&&!actData.getHide())return 1}}return 0};ZhanLingIconRule.prototype.getEffName=function(redPointNum){if(this.firstTap||redPointNum){this.effX=38;this.effY=45;return"actIconCircle"}return undefined};ZhanLingIconRule.prototype.tapExecute=function(){ViewManager.ins().open(ZhanLingACTWin);if(this.firstTap){this.firstTap=false;this.update()}};return ZhanLingIconRule}(RuleIconBase);__reflect(ZhanLingIconRule.prototype,"ZhanLingIconRule");var ActivityForeshowWin=function(_super){__extends(ActivityForeshowWin,_super);function ActivityForeshowWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="NewFuncNoticeSkin";return _this}ActivityForeshowWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addCustomEvent();this.updateView()};ActivityForeshowWin.prototype.addCustomEvent=function(){this.addTouchEvent(this.closeBtn,this.closeWin);TimerManager.ins().doTimerDelay(1e3,1e3,0,this.refreshTime,this)};ActivityForeshowWin.prototype.closeWin=function(){ViewManager.ins().close(this)};ActivityForeshowWin.prototype.updateView=function(){var cfg=ActivityForeshowModel.ins().getForeshow();if(cfg){this.activityImg.source=cfg.pic}this.refreshTime()};ActivityForeshowWin.prototype.refreshTime=function(){var timeDesc=DateUtils.getFormatBySecond(ActivityForeshowModel.ins().getRemainTime());this.daojishi0.text=timeDesc};return ActivityForeshowWin}(BaseEuiView);__reflect(ActivityForeshowWin.prototype,"ActivityForeshowWin");ViewManager.ins().reg(ActivityForeshowWin,LayerManager.UI_Main);var DaTVipDailyGiftPanel=function(_super){__extends(DaTVipDailyGiftPanel,_super);function DaTVipDailyGiftPanel(){var _this=_super.call(this)||this;_this.skinName="DaTVipDailyGiftskin";_this.isTopLevel=true;return _this}DaTVipDailyGiftPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};DaTVipDailyGiftPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rewardlist.itemRenderer=DaTvipDailyGiftRenderer};DaTVipDailyGiftPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QQDaTingSys.ins().postGetDailyGift,this.updateShow);this.addTouchEvent(this.btnkthz,this.onBtnkthz);this.addTouchEvent(this.btnktnfhz,this.onBtnktnfhz);this.addTouchEvent(this.btnGet,this.sendGetRewards);this.addTouchEvent(this.webtips,this.onwebtips);this.initRewardsData();this.updateShow()};DaTVipDailyGiftPanel.prototype.sendGetRewards=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}QQDaTingSys.ins().sendGetDailyGift(QQDaTingSys.TYPE_DATVIP)};DaTVipDailyGiftPanel.prototype.initRewardsData=function(){var rewardsData=[];var config=Object.keys(GlobalConfig.QDaTVipDailyGiftconfig);for(var _i=0,config_10=config;_i<config_10.length;_i++){var index=config_10[_i];rewardsData.push(GlobalConfig.QDaTVipDailyGiftconfig[index])}this.rewardlist.dataProvider=new eui.ArrayCollection(rewardsData)};DaTVipDailyGiftPanel.prototype.updateShow=function(){this.viplevel.source="lanptviplv"+(QQDaTingSys.ins().getDaTViplv()||"1");if(QQDaTingSys.ins().isEnableGetDaTVipDailyGift()&&QQDaTingSys.ins().getDaTViplv()>0){this.btnGet.currentState="up";this.btnGet.label="领取礼包"}else if(QQDaTingSys.ins().isEnableGetDaTVipDailyGift()&&QQDaTingSys.ins().getDaTViplv()<=0){this.btnGet.currentState="disabled";this.btnGet.label="领取礼包"}else{this.btnGet.currentState="disabled";this.btnGet.label="已领取";this.removeTouchEvent(this.btnGet,this.sendGetRewards)}};DaTVipDailyGiftPanel.prototype.onBtnkthz=function(){QQDaTingSys.ins().windowOpen(false)};DaTVipDailyGiftPanel.prototype.onBtnktnfhz=function(){QQDaTingSys.ins().windowOpen(true)};DaTVipDailyGiftPanel.prototype.onwebtips=function(){QQDaTingSys.ins().webTipsOpen()};return DaTVipDailyGiftPanel}(BaseEuiView);__reflect(DaTVipDailyGiftPanel.prototype,"DaTVipDailyGiftPanel");var DaTViplevelGiftPanel=function(_super){__extends(DaTViplevelGiftPanel,_super);function DaTViplevelGiftPanel(){var _this=_super.call(this)||this;_this.skinName="DaTViplevelGiftskin";_this.isTopLevel=true;return _this}DaTViplevelGiftPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};DaTViplevelGiftPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rewardlist.itemRenderer=DaTvipLevelGiftRenderer};DaTViplevelGiftPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QQDaTingSys.ins().postUserInfo,this.updateShow);this.observe(QQDaTingSys.ins().postGetLevelGift,this.updateShow);this.addTouchEvent(this.btnkthz,this.onBtnkthz);this.addTouchEvent(this.btnktnfhz,this.onBtnktnfhz);this.addTouchEvent(this.webtips,this.onwebtips);this.setRewardsData();this.updateShow()};DaTViplevelGiftPanel.prototype.updateShow=function(){this.setLevelTxt();TimerManager.ins().doTimer(300,1,this.setRewardsData,this)};DaTViplevelGiftPanel.prototype.setLevelTxt=function(){var levelTxt="";if(UserZs.ins().lv>0){levelTxt+=UserZs.ins().lv+i18n("LevelupRewardsPanel_0")}if(Actor.level>0){levelTxt+=Actor.level+i18n("LevelupRewardsPanel_1")}};DaTViplevelGiftPanel.prototype.setRewardsData=function(){var rewardsList=QQDaTingSys.ins().DaTVipLevelGiftList;var rewardsData=[];var LevelupRewards=GlobalConfig.QDaTVipLevelGiftconfig;if(LevelupRewards){rewardsList.forEach(function(reward){if(reward&&reward.id){rewardsData.push(LevelupRewards[reward.id])}});this.rewardlist.dataProvider=new eui.ArrayCollection(rewardsData)}};DaTViplevelGiftPanel.prototype.onBtnkthz=function(){QQDaTingSys.ins().windowOpen(false)};DaTViplevelGiftPanel.prototype.onBtnktnfhz=function(){QQDaTingSys.ins().windowOpen(true)};DaTViplevelGiftPanel.prototype.onwebtips=function(){QQDaTingSys.ins().webTipsOpen()};return DaTViplevelGiftPanel}(BaseEuiView);__reflect(DaTViplevelGiftPanel.prototype,"DaTViplevelGiftPanel");var DaTVipNewGiftPanel=function(_super){__extends(DaTVipNewGiftPanel,_super);function DaTVipNewGiftPanel(){var _this=_super.call(this)||this;_this.skinName="DaTVipNewGiftskin";_this.isTopLevel=true;_this.rewardlistItem.itemRenderer=ItemBase;_this.observe(QQDaTingSys.ins().postGetNewGift,_this.updateShow);return _this}DaTVipNewGiftPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};DaTVipNewGiftPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateShow();this.addTouchEvent(this.btnkthz,this.onBtnkthz);this.addTouchEvent(this.btnktnfhz,this.onBtnktnfhz);this.addTouchEvent(this.btnGet,this.onSendGetReward);this.addTouchEvent(this.webtips,this.onwebtips)};DaTVipNewGiftPanel.prototype.updateShow=function(){var rewardList=GlobalConfig.QDaTVipNewGiftconfig[1].rewards;this.rewardlistItem.dataProvider=new eui.ArrayCollection(rewardList);if(QQDaTingSys.ins().isEnableGetDaTVipNewGift()&&QQDaTingSys.ins().getDaTViplv()>0){this.btnGet.currentState="up";this.btnGet.label="领取礼包"}else if(QQDaTingSys.ins().isEnableGetDaTVipNewGift()&&QQDaTingSys.ins().getDaTViplv()<=0){this.btnGet.currentState="disabled";this.btnGet.label="领取礼包"}else{this.btnGet.label="已领取";this.btnGet.currentState="disabled";this.removeTouchEvent(this.btnGet,this.onSendGetReward)}};DaTVipNewGiftPanel.prototype.onSendGetReward=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}QQDaTingSys.ins().sendGetNewGift(QQDaTingSys.TYPE_DATVIP)};DaTVipNewGiftPanel.prototype.onBtnkthz=function(){QQDaTingSys.ins().windowOpen(false)};DaTVipNewGiftPanel.prototype.onBtnktnfhz=function(){QQDaTingSys.ins().windowOpen(true)};DaTVipNewGiftPanel.prototype.onwebtips=function(){QQDaTingSys.ins().webTipsOpen()};return DaTVipNewGiftPanel}(BaseEuiView);__reflect(DaTVipNewGiftPanel.prototype,"DaTVipNewGiftPanel");var DaTVipPrivilegesPanel=function(_super){__extends(DaTVipPrivilegesPanel,_super);function DaTVipPrivilegesPanel(){var _this=_super.call(this)||this;_this.skinName="DaTVipPrivilegeskin";_this.isTopLevel=true;return _this}DaTVipPrivilegesPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};DaTVipPrivilegesPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnktlz,this.onBtnktlz);this.addTouchEvent(this.btnktnflz,this.onBtnktnflz);this.addTouchEvent(this.webtips,this.onwebtips)};DaTVipPrivilegesPanel.prototype.onBtnktlz=function(){QQDaTingSys.ins().windowOpen(false)};DaTVipPrivilegesPanel.prototype.onBtnktnflz=function(){QQDaTingSys.ins().windowOpen(true)};DaTVipPrivilegesPanel.prototype.onwebtips=function(){QQDaTingSys.ins().webTipsOpen()};return DaTVipPrivilegesPanel}(BaseEuiView);__reflect(DaTVipPrivilegesPanel.prototype,"DaTVipPrivilegesPanel");var DaTVipWin=function(_super){__extends(DaTVipWin,_super);function DaTVipWin(){var _this=_super.call(this)||this;_this.selectIndex=0;_this.skinName="DaTVipWinSkin";_this.isTopLevel=true;return _this}DaTVipWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};DaTVipWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};DaTVipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QQDaTingSys.ins().postGetNewGift,this.updateRedPoint);this.observe(QQDaTingSys.ins().postGetLevelGift,this.updateRedPoint);this.observe(QQDaTingSys.ins().postGetDailyGift,this.updateRedPoint);this.addTouchEvent(this.closeBtn,this.onTap);this.addChangeEvent(this.tab,this.onTabTouch);this.selectIndex=param[0]!=undefined?param[0]:0;this.ViewStack.selectedIndex=this.tab.selectedIndex=this.selectIndex;this.setOpenIndex(this.selectIndex);this.updateRedPoint()};DaTVipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.tab,this.onTabTouch)};DaTVipWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex)};DaTVipWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case DaTVipWin.Panel_Privileges:this.DaTVipPrivilegeWin.open();break;case DaTVipWin.Panel_DailyGift:this.DaTVipDailyGiftWin.open();break;case DaTVipWin.Panel_levelGift:this.DaTViplevelGiftWin.open();break;case DaTVipWin.Panel_NewGift:this.DaTVipNewGiftWin.open();break}};DaTVipWin.prototype.updateRedPoint=function(){this.redPoint0.visible=false;this.redPoint1.visible=QQDaTingSys.ins().isEnableGetDaTVipNewGift();this.redPoint2.visible=QQDaTingSys.ins().isEnableGetLevelRewards(QQDaTingSys.TYPE_DATVIP);this.redPoint3.visible=QQDaTingSys.ins().isEnableGetDaTVipDailyGift()};DaTVipWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};DaTVipWin.prototype.updateDetail=function(parma){};DaTVipWin.Panel_Privileges=0;DaTVipWin.Panel_NewGift=1;DaTVipWin.Panel_levelGift=2;DaTVipWin.Panel_DailyGift=3;return DaTVipWin}(BaseEuiView);__reflect(DaTVipWin.prototype,"DaTVipWin");ViewManager.ins().reg(DaTVipWin,LayerManager.UI_Main);var QQDaTDailyPanel=function(_super){__extends(QQDaTDailyPanel,_super);function QQDaTDailyPanel(){var _this=_super.call(this)||this;_this.skinName="QQDaTDailyGiftskin";_this.isTopLevel=true;_this.rewardlistItem.itemRenderer=ItemBase;return _this}QQDaTDailyPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QQDaTDailyPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QQDaTingSys.ins().postGetDailyGift,this.updateShow);this.addTouchEvent(this.btnGet,this.onGetRewards);this.updateShow()};QQDaTDailyPanel.prototype.onGetRewards=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}QQDaTingSys.ins().sendGetDailyGift(QQDaTingSys.TYPE_DATING)};QQDaTDailyPanel.prototype.updateShow=function(){var rewardList=GlobalConfig.QDaTingDailyGiftconfig[1].rewards;this.rewardlistItem.dataProvider=new eui.ArrayCollection(rewardList);if(QQDaTingSys.ins().isEnableGetDaTingDailyGift()){this.btnGet.currentState="up";this.btnGet.label="领取礼包"}else{this.btnGet.label="已领取";this.btnGet.currentState="disabled"}};return QQDaTDailyPanel}(BaseEuiView);__reflect(QQDaTDailyPanel.prototype,"QQDaTDailyPanel");var QQDaTingSys=function(_super){__extends(QQDaTingSys,_super);function QQDaTingSys(){var _this=_super.call(this)||this;_this.is_year_DaTVip=false;_this.is_high_DaTVip=false;_this.isCanGetDaTVipNewGift=0;_this.isCanGetDaTVipDailyGift=0;_this.isCanGetDaTingNewGift=0;_this.isCanGetDaTingDailyGift=0;_this.DaTVipLevelGiftList=[];_this.DaTingLevelGiftList=[];_this.sysId=PackageID.QQDaTing;_this.regNetMsg(1,_this.postUserInfo);_this.regNetMsg(2,_this.postGetDailyGift);_this.regNetMsg(3,_this.postGetNewGift);_this.regNetMsg(4,_this.postGetLevelGift);return _this}QQDaTingSys.ins=function(){return _super.ins.call(this)};QQDaTingSys.prototype.sendQQDaTingInfo=function(){var bytes=this.getBytes(1);var extern_args=ChannelMgr.ins().extern_args;console.log("===sendQQDaTingInfo:",extern_args);bytes.writeString(extern_args);this.sendToServer(bytes)};QQDaTingSys.prototype.postUserInfo=function(bytes){var n=2;var config=Object.keys(GlobalConfig.QDaTVipLevelGiftconfig);var DaTVipLevelGiftList=[];var DaTingLevelGiftList=[];var p=bytes.readInt();this.is_year_DaTVip=bytes.readBoolean();this.is_high_DaTVip=bytes.readBoolean();this.DaTVip_level=bytes.readShort();for(var i=0;i<n;i++){var QzType=bytes.readByte();if(QzType==QQDaTingSys.TYPE_DATVIP){this.isCanGetDaTVipNewGift=bytes.readByte();this.isCanGetDaTVipDailyGift=bytes.readByte();for(var _i=0,config_11=config;_i<config_11.length;_i++){var index=config_11[_i];var rewardData=new QzlevelRewardsData;rewardData.parse(bytes);DaTVipLevelGiftList.push(rewardData)}}else if(QzType==QQDaTingSys.TYPE_DATING){this.isCanGetDaTingNewGift=bytes.readByte();this.isCanGetDaTingDailyGift=bytes.readByte();for(var _a=0,config_12=config;_a<config_12.length;_a++){var index=config_12[_a];var rewardData=new QzlevelRewardsData;rewardData.parse(bytes);DaTingLevelGiftList.push(rewardData)}}}DaTVipLevelGiftList=this.sortlevelRewardList(DaTVipLevelGiftList);DaTVipLevelGiftList=this.classifyRewardsListByStatus(DaTVipLevelGiftList);this.DaTVipLevelGiftList=DaTVipLevelGiftList;DaTingLevelGiftList=this.sortlevelRewardList(DaTingLevelGiftList);DaTingLevelGiftList=this.classifyRewardsListByStatus(DaTingLevelGiftList);this.DaTingLevelGiftList=DaTingLevelGiftList};QQDaTingSys.prototype.sendGetDailyGift=function(QzType){var bytes=this.getBytes(2);bytes.writeByte(QzType);this.sendToServer(bytes)};QQDaTingSys.prototype.postGetDailyGift=function(bytes){var type=bytes.readByte();var result=bytes.readInt();if(result==0){if(type==QQDaTingSys.TYPE_DATVIP){this.isCanGetDaTVipDailyGift=1}else if(type==QQDaTingSys.TYPE_DATING){this.isCanGetDaTingDailyGift=1}}else if(result==2){UserTips.ins().showTips(i18n("QQDaTingSys_1"))}else{}};QQDaTingSys.prototype.sendGetNewGift=function(QzType){var bytes=this.getBytes(3);bytes.writeByte(QzType);this.sendToServer(bytes)};QQDaTingSys.prototype.postGetNewGift=function(bytes){var type=bytes.readByte();var result=bytes.readInt();if(result==0){if(type==QQDaTingSys.TYPE_DATVIP){this.isCanGetDaTVipNewGift=1}else if(type==QQDaTingSys.TYPE_DATING){this.isCanGetDaTingNewGift=1}}else if(result==2){UserTips.ins().showTips(i18n("QQDaTingSys_1"))}else{}};QQDaTingSys.prototype.sendGetLevelGift=function(QzType,index){var bytes=this.getBytes(4);bytes.writeByte(QzType);bytes.writeInt(index);this.sendToServer(bytes)};QQDaTingSys.prototype.postGetLevelGift=function(bytes){var type=bytes.readByte();var result=bytes.readInt();var getId=bytes.readInt();console.log("==========result:",result);if(result==0){var rewardsList=this.setlevelRewardStatus(getId,type,RewardsStatus.STATUS_HAD_GET);rewardsList=this.sortlevelRewardList(rewardsList);rewardsList=this.classifyRewardsListByStatus(rewardsList);if(type==QQDaTingSys.TYPE_DATVIP){this.DaTVipLevelGiftList=rewardsList}else if(type==QQDaTingSys.TYPE_DATING){this.DaTingLevelGiftList=rewardsList}}else if(result==2&&this.getDaTViplv()<=0){UserTips.ins().showTips(i18n("QQDaTingSys_1"))}else{}};QQDaTingSys.prototype.classifyRewardsListByStatus=function(rewardsList){if(!rewardsList)return[];var hadGetRewards=[];var waitToGetRewards=[];for(var i=0;i<rewardsList.length;++i){if(rewardsList[i].status==RewardsStatus.STATUS_HAD_GET){hadGetRewards.push(rewardsList[i])}else{waitToGetRewards.push(rewardsList[i])}}return waitToGetRewards.concat(hadGetRewards)};QQDaTingSys.prototype.sortlevelRewardList=function(rewardsList){if(!rewardsList)return[];rewardsList.sort(function(a,b){return a.id-b.id});return rewardsList};QQDaTingSys.prototype.setlevelRewardStatus=function(id,QzType,status){if(QzType==QQDaTingSys.TYPE_DATVIP){var rewardsList=this.DaTVipLevelGiftList;rewardsList.forEach(function(reward){if(reward&&reward.id==id){reward.status=status}});return rewardsList}else if(QzType==QQDaTingSys.TYPE_DATING){var rewardsList=this.DaTingLevelGiftList;rewardsList.forEach(function(reward){if(reward&&reward.id==id){reward.status=status}});return rewardsList}};QQDaTingSys.prototype.getDaTViplv=function(){return this.DaTVip_level};QQDaTingSys.prototype.isDaTYearVip=function(){return this.is_year_DaTVip};QQDaTingSys.prototype.isDaTHighVip=function(){return this.is_high_DaTVip};QQDaTingSys.prototype.isEnableGetDaTVipNewGift=function(){return this.isCanGetDaTVipNewGift==0};QQDaTingSys.prototype.isEnableGetDaTingNewGift=function(){return this.isCanGetDaTingNewGift==0};QQDaTingSys.prototype.isEnableGetDaTVipDailyGift=function(){return this.isCanGetDaTVipDailyGift==0};QQDaTingSys.prototype.isEnableGetDaTingDailyGift=function(){return this.isCanGetDaTingDailyGift==0};QQDaTingSys.prototype.isEnableGetLevelRewards=function(Qztype){var isEnableGet=false;var rewardsList;var levelconfig;if(Qztype==QQDaTingSys.TYPE_DATVIP){rewardsList=this.DaTVipLevelGiftList;levelconfig=GlobalConfig.QDaTVipLevelGiftconfig}else if(Qztype==QQDaTingSys.TYPE_DATING){rewardsList=this.DaTingLevelGiftList;levelconfig=GlobalConfig.QDaTingLevelGiftconfig}rewardsList.forEach(function(reward){if(reward&&reward.status==RewardsStatus.STATUS_ABLE_GET){isEnableGet=true}if(reward&&reward.status!=RewardsStatus.STATUS_HAD_GET&&levelconfig[reward.id]&&levelconfig[reward.id].level>0&&Actor.level>=levelconfig[reward.id].level){isEnableGet=true}else if(reward&&reward.status!=RewardsStatus.STATUS_HAD_GET&&levelconfig[reward.id]&&levelconfig[reward.id].zslevel>0&&UserZs.ins().lv>=levelconfig[reward.id].zslevel){isEnableGet=true}});return isEnableGet};QQDaTingSys.prototype.windowOpen=function(isyearVip){if(isyearVip){window.open("https://pay.qq.com/ipay/index.shtml?n=3&c=xxzxgj,xxqgame&aid=VIP.APP1111142048.PLATqqgame&ch=qdqb,kj","newwindow")}else{window.open("https://pay.qq.com/ipay/index.shtml?n=3&c=xxzxgj,xxqgame&aid=VIP.APP1111142048.PLATqqgame&ch=qdqb,kj","newwindow")}};QQDaTingSys.prototype.webTipsOpen=function(){window.open("http://gamevip.qq.com/?ADTAG=VIP.WEB.wlmz","newwindow")};QQDaTingSys.TYPE_DATVIP=1;QQDaTingSys.TYPE_DATING=2;QQDaTingSys.MARK_DATVIP="DaTViplv";QQDaTingSys.MARK_DATYEAR="isYearVip";QQDaTingSys.MARK_DATHIGHVIP="isHighVip";return QQDaTingSys}(BaseSystem);__reflect(QQDaTingSys.prototype,"QQDaTingSys");var QQDaTLevelPanel=function(_super){__extends(QQDaTLevelPanel,_super);function QQDaTLevelPanel(){var _this=_super.call(this)||this;_this.skinName="QQDaTlevelGiftskin";_this.isTopLevel=true;return _this}QQDaTLevelPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QQDaTLevelPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rewardlist.itemRenderer=QQDaTLevelGiftRenderer};QQDaTLevelPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QQDaTingSys.ins().postUserInfo,this.updateShow);this.observe(QQDaTingSys.ins().postGetLevelGift,this.updateShow);this.setRewardsData();this.updateShow()};QQDaTLevelPanel.prototype.updateShow=function(){TimerManager.ins().doTimer(300,1,this.setRewardsData,this)};QQDaTLevelPanel.prototype.setRewardsData=function(){var rewardsList=QQDaTingSys.ins().DaTingLevelGiftList;var rewardsData=[];var LevelupRewards=GlobalConfig.QDaTingLevelGiftconfig;if(LevelupRewards){rewardsList.forEach(function(reward){if(reward&&reward.id){rewardsData.push(LevelupRewards[reward.id])}});this.rewardlist.dataProvider=new eui.ArrayCollection(rewardsData)}};return QQDaTLevelPanel}(BaseEuiView);__reflect(QQDaTLevelPanel.prototype,"QQDaTLevelPanel");var QQDaTNewPanel=function(_super){__extends(QQDaTNewPanel,_super);function QQDaTNewPanel(){var _this=_super.call(this)||this;_this.skinName="QQDaTNewGiftskin";_this.isTopLevel=true;_this.rewardlistItem.itemRenderer=ItemBase;return _this}QQDaTNewPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QQDaTNewPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QQDaTingSys.ins().postGetNewGift,this.updateShow);this.addTouchEvent(this.btnGet,this.onGetRewards);this.updateShow()};QQDaTNewPanel.prototype.onGetRewards=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}QQDaTingSys.ins().sendGetNewGift(QQDaTingSys.TYPE_DATING)};QQDaTNewPanel.prototype.updateShow=function(){var rewardList=GlobalConfig.QDaTingNewGiftconfig[1].rewards;this.rewardlistItem.dataProvider=new eui.ArrayCollection(rewardList);if(QQDaTingSys.ins().isEnableGetDaTingNewGift()){this.btnGet.currentState="up";this.btnGet.label="领取礼包"}else{this.btnGet.label="已领取";this.btnGet.currentState="disabled"}};return QQDaTNewPanel}(BaseEuiView);__reflect(QQDaTNewPanel.prototype,"QQDaTNewPanel");var QQDaTWin=function(_super){__extends(QQDaTWin,_super);function QQDaTWin(){var _this=_super.call(this)||this;_this.skinName="QQDaTWinSkin";_this.isTopLevel=true;return _this}QQDaTWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};QQDaTWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QQDaTingSys.ins().postGetNewGift,this.updateRedPoint);this.observe(QQDaTingSys.ins().postGetDailyGift,this.updateRedPoint);this.observe(QQDaTingSys.ins().postGetLevelGift,this.updateRedPoint);this.addTouchEvent(this.closeBtn,this.onTap);this.addChangeEvent(this.tab,this.onTabTouch);var selectIndex=param[0]!=undefined?param[0]:0;this.viewStack.selectedIndex=this.tab.selectedIndex=selectIndex;this.setOpenIndex(selectIndex);this.updateRedPoint()};QQDaTWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex)};QQDaTWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case QQDaTWin.Panel_NewGift:this.QQDaTNewWin.open();break;case QQDaTWin.Panel_DailyGift:this.QQDaTDailyWin.open();break;case QQDaTWin.Panel_LevelGift:this.QQDaTLevelWin.open();break}};QQDaTWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};QQDaTWin.prototype.updateRedPoint=function(){this.redPoint0.visible=QQDaTingSys.ins().isEnableGetDaTingNewGift();this.redPoint1.visible=QQDaTingSys.ins().isEnableGetLevelRewards(QQDaTingSys.TYPE_DATING);this.redPoint2.visible=QQDaTingSys.ins().isEnableGetDaTingDailyGift()};QQDaTWin.Panel_NewGift=0;QQDaTWin.Panel_LevelGift=1;QQDaTWin.Panel_DailyGift=2;return QQDaTWin}(BaseEuiView);__reflect(QQDaTWin.prototype,"QQDaTWin");ViewManager.ins().reg(QQDaTWin,LayerManager.UI_Main);var DaTvipDailyGiftRenderer=function(_super){__extends(DaTvipDailyGiftRenderer,_super);function DaTvipDailyGiftRenderer(){var _this=_super.call(this)||this;_this.skinName="DaTVipDailyGiftItemSkin";_this.itemList.itemRenderer=ItemBase;_this.itemList0.itemRenderer=ItemBaseDaTYearVip;_this.itemList1.itemRenderer=ItemBaseDaTHighVip;return _this}DaTvipDailyGiftRenderer.prototype.dataChanged=function(){if(!this.data)return;this.updateShow()};DaTvipDailyGiftRenderer.prototype.updateShow=function(){this.viplevel.source="lanptviplv"+this.data.index;this.setItemListData()};DaTvipDailyGiftRenderer.prototype.setItemListData=function(){var data=this.data;this.itemList.dataProvider=new eui.ArrayCollection(data.rewards);this.itemList0.dataProvider=new eui.ArrayCollection(data.yearrewards);this.itemList1.dataProvider=new eui.ArrayCollection(data.highrewards)};DaTvipDailyGiftRenderer.prototype.onGetReward=function(){};return DaTvipDailyGiftRenderer}(BaseItemRender);__reflect(DaTvipDailyGiftRenderer.prototype,"DaTvipDailyGiftRenderer");var DaTvipLevelGiftRenderer=function(_super){__extends(DaTvipLevelGiftRenderer,_super);function DaTvipLevelGiftRenderer(){var _this=_super.call(this)||this;_this.lastTime=0;_this.skinName="DaTVipLevelGiftItemSkin";_this.itemList.itemRenderer=ItemBase;return _this}DaTvipLevelGiftRenderer.prototype.dataChanged=function(){if(!this.data)return;this.initUI();this.updateShow()};DaTvipLevelGiftRenderer.prototype.initUI=function(){this.redPoint.visible=false;this.levelTxt.text="";this.btnGet.skinName="Btn60Skin";this.btnGet.label=i18n("LevelupRewardsRenderer_0");this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)};DaTvipLevelGiftRenderer.prototype.updateShow=function(){var curLevel=-1;var getLevel=-1;var rewardsList=QQDaTingSys.ins().DaTVipLevelGiftList;var status=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].status:RewardsStatus.STATUS_DISABLE_GET;if(this.data["level"]){curLevel=Actor.level;getLevel=this.data["level"];this.levelShow()}else if(this.data["zslevel"]){curLevel=UserZs.ins().lv;getLevel=this.data["zslevel"];this.zslevelShow()}this.setRewardStatus(curLevel,getLevel,status);this.setItemListData()};DaTvipLevelGiftRenderer.prototype.levelShow=function(){this.levelTxt.text=""+this.data["level"]+"级"};DaTvipLevelGiftRenderer.prototype.zslevelShow=function(){this.levelTxt.text=""+this.data["zslevel"]+"转"};DaTvipLevelGiftRenderer.prototype.setRewardStatus=function(curLevel,getLevel,status){this.btnGet.enabled=true;if(curLevel>=getLevel){this.redPoint.visible=true;if(status==RewardsStatus.STATUS_ABLE_GET||status==RewardsStatus.STATUS_DISABLE_GET){this.btnGet.currentState="up";this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)}else if(status==RewardsStatus.STATUS_HAD_GET){this.redPoint.visible=false;this.btnGet.enabled=false;this.btnGet.label=i18n("LevelupRewardsRenderer_1");this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled"}}else{this.btnGet.enabled=false;this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled";this.btnGet.label=i18n("LevelupRewardsRenderer_2")}};DaTvipLevelGiftRenderer.prototype.setItemListData=function(){if(this.data["rewards"]){var rewards=this.data["rewards"];var d=[];for(var i=0;i<rewards.length;i++){if(!rewards[i])continue;d.push(rewards[i])}this.itemList.dataProvider=new eui.ArrayCollection(d)}};DaTvipLevelGiftRenderer.prototype.onGetReward=function(){this.btnGet.currentState="down";if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}var rewardsList=QQDaTingSys.ins().DaTVipLevelGiftList;var id=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].id:-1;if(GameServer.serverTime-this.lastTime<1e3){return}this.lastTime=GameServer.serverTime;QQDaTingSys.ins().sendGetLevelGift(QQDaTingSys.TYPE_DATVIP,id)};return DaTvipLevelGiftRenderer}(BaseItemRender);__reflect(DaTvipLevelGiftRenderer.prototype,"DaTvipLevelGiftRenderer");var QQDaTLevelGiftRenderer=function(_super){__extends(QQDaTLevelGiftRenderer,_super);function QQDaTLevelGiftRenderer(){var _this=_super.call(this)||this;_this.skinName="QQDaTLevelGiftItemSkin";_this.itemList.itemRenderer=ItemBase;return _this}QQDaTLevelGiftRenderer.prototype.dataChanged=function(){if(!this.data)return;this.initUI();this.updateShow()};QQDaTLevelGiftRenderer.prototype.initUI=function(){this.redPoint.visible=false;this.levelTxt.text="";this.btnGet.skinName="Btn60Skin";this.btnGet.label=i18n("LevelupRewardsRenderer_0");this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)};QQDaTLevelGiftRenderer.prototype.updateShow=function(){var curLevel=-1;var getLevel=-1;var rewardsList=QQDaTingSys.ins().DaTingLevelGiftList;var status=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].status:RewardsStatus.STATUS_DISABLE_GET;if(this.data["level"]){curLevel=Actor.level;getLevel=this.data["level"];this.levelShow()}else if(this.data["zslevel"]){curLevel=UserZs.ins().lv;getLevel=this.data["zslevel"];this.zslevelShow()}this.setRewardStatus(curLevel,getLevel,status);this.setItemListData()};QQDaTLevelGiftRenderer.prototype.levelShow=function(){this.levelTxt.text=""+this.data["level"]+"级"};QQDaTLevelGiftRenderer.prototype.zslevelShow=function(){this.levelTxt.text=""+this.data["zslevel"]+"转"};QQDaTLevelGiftRenderer.prototype.setRewardStatus=function(curLevel,getLevel,status){this.btnGet.enabled=true;if(curLevel>=getLevel){this.redPoint.visible=true;if(status==RewardsStatus.STATUS_ABLE_GET){this.btnGet.currentState="up";this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)}else if(status==RewardsStatus.STATUS_HAD_GET){this.redPoint.visible=false;this.btnGet.enabled=false;this.btnGet.label=i18n("LevelupRewardsRenderer_1");this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled"}}else{this.btnGet.enabled=false;this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled";this.btnGet.label=i18n("LevelupRewardsRenderer_2")}};QQDaTLevelGiftRenderer.prototype.setItemListData=function(){if(this.data["rewards"]){var rewards=this.data["rewards"];var d=[];for(var i=0;i<rewards.length;i++){if(!rewards[i])continue;d.push(rewards[i])}this.itemList.dataProvider=new eui.ArrayCollection(d)}};QQDaTLevelGiftRenderer.prototype.onGetReward=function(){this.btnGet.currentState="down";if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}var rewardsList=QQDaTingSys.ins().DaTingLevelGiftList;var id=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].id:-1;QQDaTingSys.ins().sendGetLevelGift(QQDaTingSys.TYPE_DATING,id)};return QQDaTLevelGiftRenderer}(BaseItemRender);__reflect(QQDaTLevelGiftRenderer.prototype,"QQDaTLevelGiftRenderer");var QQzoneDailyPanel=function(_super){__extends(QQzoneDailyPanel,_super);function QQzoneDailyPanel(){var _this=_super.call(this)||this;_this.skinName="QQzoneDailyGiftskin";_this.isTopLevel=true;_this.rewardlistItem.itemRenderer=ItemBase;return _this}QQzoneDailyPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QQzoneDailyPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QzoneSys.ins().postGetDailyGift,this.updateShow);this.addTouchEvent(this.btnGet,this.onGetRewards);this.updateShow()};QQzoneDailyPanel.prototype.onGetRewards=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}QzoneSys.ins().sendGetDailyGift(QzoneSys.TYPE_QQZONE)};QQzoneDailyPanel.prototype.updateShow=function(){var rewardList=GlobalConfig.QzoneDailyGiftconfig[1].rewards;this.rewardlistItem.dataProvider=new eui.ArrayCollection(rewardList);if(QzoneSys.ins().isEnableGetZoneDailyGift()){this.btnGet.currentState="up";this.btnGet.label="领取礼包"}else{this.btnGet.label="已领取";this.btnGet.currentState="disabled"}};return QQzoneDailyPanel}(BaseEuiView);__reflect(QQzoneDailyPanel.prototype,"QQzoneDailyPanel");var QQzoneLevelPanel=function(_super){__extends(QQzoneLevelPanel,_super);function QQzoneLevelPanel(){var _this=_super.call(this)||this;_this.skinName="QQzonelevelGiftskin";_this.isTopLevel=true;return _this}QQzoneLevelPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QQzoneLevelPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rewardlist.itemRenderer=QQzoneLevelGiftRenderer};QQzoneLevelPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QzoneSys.ins().postUserInfo,this.updateShow);this.observe(QzoneSys.ins().postGetLevelGift,this.updateShow);this.setRewardsData();this.updateShow()};QQzoneLevelPanel.prototype.updateShow=function(){TimerManager.ins().doTimer(300,1,this.setRewardsData,this)};QQzoneLevelPanel.prototype.setRewardsData=function(){var rewardsList=QzoneSys.ins().QZoneLevelGiftList;var rewardsData=[];var LevelupRewards=GlobalConfig.QzoneLevelGiftconfig;if(LevelupRewards){rewardsList.forEach(function(reward){if(reward&&reward.id){rewardsData.push(LevelupRewards[reward.id])}});this.rewardlist.dataProvider=new eui.ArrayCollection(rewardsData)}};return QQzoneLevelPanel}(BaseEuiView);__reflect(QQzoneLevelPanel.prototype,"QQzoneLevelPanel");var QQzoneNewPanel=function(_super){__extends(QQzoneNewPanel,_super);function QQzoneNewPanel(){var _this=_super.call(this)||this;_this.skinName="QQzoneNewGiftskin";_this.isTopLevel=true;_this.rewardlistItem.itemRenderer=ItemBase;return _this}QQzoneNewPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QQzoneNewPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QzoneSys.ins().postGetNewGift,this.updateShow);this.addTouchEvent(this.btnGet,this.onGetRewards);this.updateShow()};QQzoneNewPanel.prototype.onGetRewards=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}QzoneSys.ins().sendGetNewGift(QzoneSys.TYPE_QQZONE)};QQzoneNewPanel.prototype.updateShow=function(){var rewardList=GlobalConfig.QzoneNewGiftconfig[1].rewards;this.rewardlistItem.dataProvider=new eui.ArrayCollection(rewardList);if(QzoneSys.ins().isEnableGetZoneNewGift()){this.btnGet.currentState="up";this.btnGet.label="领取礼包"}else{this.btnGet.label="已领取";this.btnGet.currentState="disabled"}};return QQzoneNewPanel}(BaseEuiView);__reflect(QQzoneNewPanel.prototype,"QQzoneNewPanel");var QQzoneTqPanel=function(_super){__extends(QQzoneTqPanel,_super);function QQzoneTqPanel(){var _this=_super.call(this)||this;_this.skinName="QQzoneTequanskin";_this.isTopLevel=true;_this.rewardlistItem.itemRenderer=ItemBase;return _this}QQzoneTqPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QQzoneTqPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QzoneSys.ins().postGetTqGift,this.updateShow);this.addTouchEvent(this.btnGet,this.onGetRewards);this.updateShow()};QQzoneTqPanel.prototype.onGetRewards=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}QzoneSys.ins().sendGetTqGift(QzoneSys.TYPE_QQZONE)};QQzoneTqPanel.prototype.updateShow=function(){var rewardList=GlobalConfig.QzoneTeqGiftconfig[1].rewards;this.rewardlistItem.dataProvider=new eui.ArrayCollection(rewardList);if(QzoneSys.ins().isEnableGetZoneTqGift()){this.btnGet.currentState="up";this.btnGet.label="领取礼包"}else{this.btnGet.label="已领取";this.btnGet.currentState="disabled"}};return QQzoneTqPanel}(BaseEuiView);__reflect(QQzoneTqPanel.prototype,"QQzoneTqPanel");var QQzoneWin=function(_super){__extends(QQzoneWin,_super);function QQzoneWin(){var _this=_super.call(this)||this;_this.skinName="QQzoneWinSkin";_this.isTopLevel=true;return _this}QQzoneWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};QQzoneWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QzoneSys.ins().postGetNewGift,this.updateRedPoint);this.observe(QzoneSys.ins().postGetDailyGift,this.updateRedPoint);this.observe(QzoneSys.ins().postGetTqGift,this.updateRedPoint);this.observe(QzoneSys.ins().postGetLevelGift,this.updateRedPoint);this.addTouchEvent(this.closeBtn,this.onTap);this.addChangeEvent(this.tab,this.onTabTouch);var selectIndex=param[0]!=undefined?param[0]:0;this.viewStack.selectedIndex=this.tab.selectedIndex=selectIndex;this.setOpenIndex(selectIndex);this.updateRedPoint()};QQzoneWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex)};QQzoneWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case QQzoneWin.Panel_NewGift:this.QQzoneNewWin.open();break;case QQzoneWin.Panel_DailyGift:this.QQzoneDailyWin.open();break;case QQzoneWin.Panel_TequanGift:this.QQzoneTequanWin.open();break;case QQzoneWin.Panel_LevelGift:this.QQzonelevelWin.open();break}};QQzoneWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};QQzoneWin.prototype.updateRedPoint=function(){this.redPoint0.visible=QzoneSys.ins().isEnableGetZoneNewGift();this.redPoint1.visible=QzoneSys.ins().isEnableGetZoneDailyGift();this.redPoint2.visible=QzoneSys.ins().isEnableGetZoneTqGift();this.redPoint3.visible=QzoneSys.ins().isEnableGetLevelRewards(QzoneSys.TYPE_QQZONE)};QQzoneWin.Panel_NewGift=0;QQzoneWin.Panel_DailyGift=1;QQzoneWin.Panel_TequanGift=2;QQzoneWin.Panel_LevelGift=3;return QQzoneWin}(BaseEuiView);__reflect(QQzoneWin.prototype,"QQzoneWin");ViewManager.ins().reg(QQzoneWin,LayerManager.UI_Main);var QzDailyGiftPanel=function(_super){__extends(QzDailyGiftPanel,_super);function QzDailyGiftPanel(){var _this=_super.call(this)||this;_this.skinName="QzDailyGiftskin";_this.isTopLevel=true;return _this}QzDailyGiftPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QzDailyGiftPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rewardlist.itemRenderer=QzvipDailyGiftRenderer};QzDailyGiftPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QzoneSys.ins().postGetDailyGift,this.updateShow);this.addTouchEvent(this.btnkthz,this.onBtnkthz);this.addTouchEvent(this.btnktnfhz,this.onBtnktnfhz);this.addTouchEvent(this.btnGet,this.sendGetRewards);this.initRewardsData();this.updateShow()};QzDailyGiftPanel.prototype.sendGetRewards=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}QzoneSys.ins().sendGetDailyGift(QzoneSys.TYPE_QQVIP)};QzDailyGiftPanel.prototype.initRewardsData=function(){var rewardsData=[];var config=Object.keys(GlobalConfig.QzVipDailyGiftconfig);for(var _i=0,config_13=config;_i<config_13.length;_i++){var index=config_13[_i];rewardsData.push(GlobalConfig.QzVipDailyGiftconfig[index])}this.rewardlist.dataProvider=new eui.ArrayCollection(rewardsData)};QzDailyGiftPanel.prototype.updateShow=function(){this.viplevel.source="hzicon"+(QzoneSys.ins().getYellowViplv()||"1");if(QzoneSys.ins().isEnableGetQzDailyGift()){this.btnGet.currentState="up";this.btnGet.label="领取礼包"}else{this.btnGet.currentState="disabled";this.btnGet.label="已领取";this.removeTouchEvent(this.btnGet,this.sendGetRewards)}};QzDailyGiftPanel.prototype.onBtnkthz=function(){QzoneSys.ins().windowOpen(false)};QzDailyGiftPanel.prototype.onBtnktnfhz=function(){QzoneSys.ins().windowOpen(true)};return QzDailyGiftPanel}(BaseEuiView);__reflect(QzDailyGiftPanel.prototype,"QzDailyGiftPanel");var QzlevelGiftPanel=function(_super){__extends(QzlevelGiftPanel,_super);function QzlevelGiftPanel(){var _this=_super.call(this)||this;_this.skinName="QzlevelGiftskin";_this.isTopLevel=true;return _this}QzlevelGiftPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QzlevelGiftPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.rewardlist.itemRenderer=QzvipLevelGiftRenderer};QzlevelGiftPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QzoneSys.ins().postUserInfo,this.updateShow);this.observe(QzoneSys.ins().postGetLevelGift,this.updateShow);this.addTouchEvent(this.btnkthz,this.onBtnkthz);this.addTouchEvent(this.btnktnfhz,this.onBtnktnfhz);this.setRewardsData();this.updateShow()};QzlevelGiftPanel.prototype.updateShow=function(){this.setLevelTxt();TimerManager.ins().doTimer(300,1,this.setRewardsData,this)};QzlevelGiftPanel.prototype.setLevelTxt=function(){var levelTxt="";if(UserZs.ins().lv>0){levelTxt+=UserZs.ins().lv+i18n("LevelupRewardsPanel_0")}if(Actor.level>0){levelTxt+=Actor.level+i18n("LevelupRewardsPanel_1")}};QzlevelGiftPanel.prototype.setRewardsData=function(){var rewardsList=QzoneSys.ins().QzVipLevelGiftList;var rewardsData=[];var LevelupRewards=GlobalConfig.QzVipLevelGiftconfig;if(LevelupRewards){rewardsList.forEach(function(reward){if(reward&&reward.id){rewardsData.push(LevelupRewards[reward.id])}});this.rewardlist.dataProvider=new eui.ArrayCollection(rewardsData)}};QzlevelGiftPanel.prototype.onBtnkthz=function(){QzoneSys.ins().windowOpen(false)};QzlevelGiftPanel.prototype.onBtnktnfhz=function(){QzoneSys.ins().windowOpen(true)};return QzlevelGiftPanel}(BaseEuiView);__reflect(QzlevelGiftPanel.prototype,"QzlevelGiftPanel");var QzlevelRewardsData=function(){function QzlevelRewardsData(){}QzlevelRewardsData.prototype.parse=function(bytes){this.id=bytes.readShort();this.status=bytes.readShort()};return QzlevelRewardsData}();__reflect(QzlevelRewardsData.prototype,"QzlevelRewardsData");var QzNewGiftPanel=function(_super){__extends(QzNewGiftPanel,_super);function QzNewGiftPanel(){var _this=_super.call(this)||this;_this.skinName="QzNewGiftskin";_this.isTopLevel=true;_this.rewardlistItem.itemRenderer=ItemBase;_this.observe(QzoneSys.ins().postGetNewGift,_this.updateShow);return _this}QzNewGiftPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QzNewGiftPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnkthz,this.onBtnkthz);this.addTouchEvent(this.btnktnfhz,this.onBtnktnfhz);this.addTouchEvent(this.btnGet,this.onSendGetReward);this.updateShow()};QzNewGiftPanel.prototype.updateShow=function(){var rewardList=GlobalConfig.QzVipNewGiftconfig[1].rewards;this.rewardlistItem.dataProvider=new eui.ArrayCollection(rewardList);if(QzoneSys.ins().isEnableGetQzNewGift()){this.btnGet.currentState="up";this.btnGet.label="领取礼包"}else{this.btnGet.label="已领取";this.btnGet.currentState="disabled";this.removeTouchEvent(this.btnGet,this.onSendGetReward)}};QzNewGiftPanel.prototype.onSendGetReward=function(){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}QzoneSys.ins().sendGetNewGift(QzoneSys.TYPE_QQVIP)};QzNewGiftPanel.prototype.onBtnkthz=function(){QzoneSys.ins().windowOpen(false)};QzNewGiftPanel.prototype.onBtnktnfhz=function(){QzoneSys.ins().windowOpen(true)};return QzNewGiftPanel}(BaseEuiView);__reflect(QzNewGiftPanel.prototype,"QzNewGiftPanel");var QzoneSys=function(_super){__extends(QzoneSys,_super);function QzoneSys(){var _this=_super.call(this)||this;_this.is_year_yellowVip=false;_this.isCanGetQzVipNewGift=0;_this.isCanGetQzVipDailyGift=0;_this.isCanGetQzVipTittleGift=0;_this.isCanGetZoneNewGift=0;_this.isCanGetZoneDailyGift=0;_this.isCanGetZoneTeqGift=0;_this.QzVipLevelGiftList=[];_this.QZoneLevelGiftList=[];_this.sysId=PackageID.QQzone;_this.regNetMsg(1,_this.postUserInfo);_this.regNetMsg(2,_this.postGetDailyGift);_this.regNetMsg(3,_this.postGetNewGift);_this.regNetMsg(4,_this.postGetLevelGift);_this.regNetMsg(5,_this.postActivateTittle);_this.regNetMsg(6,_this.postGetTqGift);return _this}QzoneSys.ins=function(){return _super.ins.call(this)};QzoneSys.prototype.sendQQzoneInfo=function(){var bytes=this.getBytes(1);var extern_args=ChannelMgr.ins().extern_args;console.log("===sendQQzoneInfo:",extern_args);bytes.writeString(extern_args);this.sendToServer(bytes)};QzoneSys.prototype.postUserInfo=function(bytes){var n=2;var config=Object.keys(GlobalConfig.QzVipLevelGiftconfig);var QzVipLevelGiftList=[];var QzoneLevelGiftList=[];var p=bytes.readInt();this.is_year_yellowVip=bytes.readBoolean();this.yellowVip_level=bytes.readShort();for(var i=0;i<n;i++){var QzType=bytes.readByte();if(QzType==QzoneSys.TYPE_QQVIP){this.isCanGetQzVipNewGift=bytes.readByte();this.isCanGetQzVipDailyGift=bytes.readByte();var TeqGift=bytes.readByte();this.isCanGetQzVipTittleGift=bytes.readByte();for(var _i=0,config_14=config;_i<config_14.length;_i++){var index=config_14[_i];var rewardData=new QzlevelRewardsData;rewardData.parse(bytes);QzVipLevelGiftList.push(rewardData)}}else if(QzType==QzoneSys.TYPE_QQZONE){this.isCanGetZoneNewGift=bytes.readByte();this.isCanGetZoneDailyGift=bytes.readByte();this.isCanGetZoneTeqGift=bytes.readByte();var tittleGift=bytes.readByte();for(var _a=0,config_15=config;_a<config_15.length;_a++){var index=config_15[_a];var rewardData=new QzlevelRewardsData;rewardData.parse(bytes);QzoneLevelGiftList.push(rewardData)}}}QzVipLevelGiftList=this.sortlevelRewardList(QzVipLevelGiftList);QzVipLevelGiftList=this.classifyRewardsListByStatus(QzVipLevelGiftList);this.QzVipLevelGiftList=QzVipLevelGiftList;QzoneLevelGiftList=this.sortlevelRewardList(QzoneLevelGiftList);QzoneLevelGiftList=this.classifyRewardsListByStatus(QzoneLevelGiftList);this.QZoneLevelGiftList=QzoneLevelGiftList};QzoneSys.prototype.sendGetDailyGift=function(QzType){var bytes=this.getBytes(2);bytes.writeByte(QzType);this.sendToServer(bytes)};QzoneSys.prototype.postGetDailyGift=function(bytes){var type=bytes.readByte();var result=bytes.readInt();if(result==0){if(type==QzoneSys.TYPE_QQVIP){this.isCanGetQzVipDailyGift=1}else if(type==QzoneSys.TYPE_QQZONE){this.isCanGetZoneDailyGift=1}}else if(result==2){UserTips.ins().showTips(i18n("QzoneSys_1"))}else{}};QzoneSys.prototype.sendGetNewGift=function(QzType){var bytes=this.getBytes(3);bytes.writeByte(QzType);this.sendToServer(bytes)};QzoneSys.prototype.postGetNewGift=function(bytes){var type=bytes.readByte();var result=bytes.readInt();if(result==0){if(type==QzoneSys.TYPE_QQVIP){this.isCanGetQzVipNewGift=1}else if(type==QzoneSys.TYPE_QQZONE){this.isCanGetZoneNewGift=1}}else if(result==2){UserTips.ins().showTips(i18n("QzoneSys_1"))}else{}};QzoneSys.prototype.sendGetLevelGift=function(QzType,index){var bytes=this.getBytes(4);bytes.writeByte(QzType);bytes.writeInt(index);this.sendToServer(bytes)};QzoneSys.prototype.postGetLevelGift=function(bytes){var type=bytes.readByte();var result=bytes.readInt();var getId=bytes.readInt();console.log("==========result:",result);if(result==0){var rewardsList=this.setlevelRewardStatus(getId,type,RewardsStatus.STATUS_HAD_GET);rewardsList=this.sortlevelRewardList(rewardsList);rewardsList=this.classifyRewardsListByStatus(rewardsList);if(type==QzoneSys.TYPE_QQVIP){this.QzVipLevelGiftList=rewardsList}else if(type==QzoneSys.TYPE_QQZONE){this.QZoneLevelGiftList=rewardsList}}else if(result==2&&this.getYellowViplv()<=0){UserTips.ins().showTips(i18n("QzoneSys_1"))}else{}};QzoneSys.prototype.sendActivateTittle=function(QzType){var bytes=this.getBytes(5);bytes.writeInt(QzType);this.sendToServer(bytes)};QzoneSys.prototype.postActivateTittle=function(bytes){var type=bytes.readByte();var result=bytes.readInt();if(result==0){UserTips.ins().showTips(i18n("QzoneSys_2"));this.isCanGetQzVipTittleGift=1}else if(result==1){UserTips.ins().showTips(i18n("QzoneSys_3"))}else if(result==2){UserTips.ins().showTips(i18n("QzoneSys_1"))}else{}};QzoneSys.prototype.sendGetTqGift=function(QzType){var bytes=this.getBytes(6);bytes.writeByte(QzType);this.sendToServer(bytes)};QzoneSys.prototype.postGetTqGift=function(bytes){var type=bytes.readByte();var result=bytes.readInt();if(result==0){if(type==QzoneSys.TYPE_QQZONE){this.isCanGetZoneTeqGift=1}}else if(result==2){UserTips.ins().showTips(i18n("QzoneSys_1"))}else{}};QzoneSys.prototype.classifyRewardsListByStatus=function(rewardsList){if(!rewardsList)return[];var hadGetRewards=[];var waitToGetRewards=[];for(var i=0;i<rewardsList.length;++i){if(rewardsList[i].status==RewardsStatus.STATUS_HAD_GET){hadGetRewards.push(rewardsList[i])}else{waitToGetRewards.push(rewardsList[i])}}return waitToGetRewards.concat(hadGetRewards)};QzoneSys.prototype.sortlevelRewardList=function(rewardsList){if(!rewardsList)return[];rewardsList.sort(function(a,b){return a.id-b.id});return rewardsList};QzoneSys.prototype.setlevelRewardStatus=function(id,QzType,status){if(QzType==QzoneSys.TYPE_QQVIP){var rewardsList=this.QzVipLevelGiftList;rewardsList.forEach(function(reward){if(reward&&reward.id==id){reward.status=status}});return rewardsList}else if(QzType==QzoneSys.TYPE_QQZONE){var rewardsList=this.QZoneLevelGiftList;rewardsList.forEach(function(reward){if(reward&&reward.id==id){reward.status=status}});return rewardsList}};QzoneSys.prototype.getYellowViplv=function(){return this.yellowVip_level};QzoneSys.prototype.isYellowYearVip=function(){return this.is_year_yellowVip};QzoneSys.prototype.isEnableGetQzNewGift=function(){return this.isCanGetQzVipNewGift==0};QzoneSys.prototype.isEnableGetZoneNewGift=function(){return this.isCanGetZoneNewGift==0};QzoneSys.prototype.isEnableGetQzDailyGift=function(){return this.isCanGetQzVipDailyGift==0};QzoneSys.prototype.isEnableGetZoneDailyGift=function(){return this.isCanGetZoneDailyGift==0};QzoneSys.prototype.isEnableGetQzTittleGift=function(){return this.isCanGetQzVipTittleGift==0};QzoneSys.prototype.isEnableGetZoneTqGift=function(){return this.isCanGetZoneTeqGift==0};QzoneSys.prototype.isEnableGetLevelRewards=function(Qztype){var isEnableGet=false;var rewardsList=null;var levelconfig=null;if(Qztype==QzoneSys.TYPE_QQVIP){rewardsList=this.QzVipLevelGiftList;levelconfig=GlobalConfig.QzVipLevelGiftconfig}else if(Qztype==QzoneSys.TYPE_QQZONE){rewardsList=this.QZoneLevelGiftList;levelconfig=GlobalConfig.QzoneLevelGiftconfig}rewardsList.forEach(function(reward){if(reward&&reward.status==RewardsStatus.STATUS_ABLE_GET){isEnableGet=true}if(reward&&reward.status!=RewardsStatus.STATUS_HAD_GET&&levelconfig[reward.id]&&levelconfig[reward.id].level>0&&Actor.level>=levelconfig[reward.id].level){isEnableGet=true}else if(reward&&reward.status!=RewardsStatus.STATUS_HAD_GET&&levelconfig[reward.id]&&levelconfig[reward.id].zslevel>0&&UserZs.ins().lv>=levelconfig[reward.id].zslevel){isEnableGet=true}});return isEnableGet};QzoneSys.prototype.windowOpen=function(isyearVip){if(isyearVip){window.open("http://pay.qq.com/qzone/index.shtml?aid=game1111142048.yop&paytime=year","newwindow")}else{window.open("http://pay.qq.com/qzone/index.shtml?aid=game1111142048.op","newwindow")}};QzoneSys.TYPE_QQVIP=1;QzoneSys.TYPE_QQZONE=2;QzoneSys.MARK_QZVIP="ZoneViplv";QzoneSys.MARK_QZYEAR="isYearVip";return QzoneSys}(BaseSystem);__reflect(QzoneSys.prototype,"QzoneSys");var QzPrivilegesPanel=function(_super){__extends(QzPrivilegesPanel,_super);function QzPrivilegesPanel(){var _this=_super.call(this)||this;_this.skinName="QzPrivilegeskin";_this.isTopLevel=true;return _this}QzPrivilegesPanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QzPrivilegesPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};return QzPrivilegesPanel}(BaseEuiView);__reflect(QzPrivilegesPanel.prototype,"QzPrivilegesPanel");var QzTittlePanel=function(_super){__extends(QzTittlePanel,_super);function QzTittlePanel(){var _this=_super.call(this)||this;_this.skinName="QzTittleGiftskin";_this.isTopLevel=true;return _this}QzTittlePanel.prototype.initUI=function(){_super.prototype.initUI.call(this)};QzTittlePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QzoneSys.ins().postActivateTittle,this.updateShow);this.addTouchEvent(this.btnAct,this.onActivate);this.initTittleAttr();this.updateShow()};QzTittlePanel.prototype.onActivate=function(){QzoneSys.ins().sendActivateTittle(QzoneSys.TYPE_QQVIP)};QzTittlePanel.prototype.updateShow=function(){if(QzoneSys.ins().isEnableGetQzTittleGift()){this.btnAct.currentState="up";this.btnAct.label="立即激活"}else{this.btnAct.currentState="disabled";this.btnAct.label="已激活";this.removeTouchEvent(this.btnAct,this.onActivate)}};QzTittlePanel.prototype.initTittleAttr=function(){var attData=[];var config=GlobalConfig.TitleConf[35];attData=config.attrs;this.attrsText.text=AttributeData.getAttStr(attData);this.power.text=UserBag.getAttrPower(attData)+""};return QzTittlePanel}(BaseEuiView);__reflect(QzTittlePanel.prototype,"QzTittlePanel");var QzVipWin=function(_super){__extends(QzVipWin,_super);function QzVipWin(){var _this=_super.call(this)||this;_this.selectIndex=0;_this.skinName="QzVipWinSkin";_this.isTopLevel=true;return _this}QzVipWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};QzVipWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};QzVipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(QzoneSys.ins().postGetNewGift,this.updateRedPoint);this.observe(QzoneSys.ins().postGetLevelGift,this.updateRedPoint);this.observe(QzoneSys.ins().postGetDailyGift,this.updateRedPoint);this.observe(QzoneSys.ins().postActivateTittle,this.updateRedPoint);this.addTouchEvent(this.closeBtn,this.onTap);this.addChangeEvent(this.tab,this.onTabTouch);this.selectIndex=param[0]!=undefined?param[0]:0;this.ViewStack.selectedIndex=this.tab.selectedIndex=this.selectIndex;this.updateRedPoint()};QzVipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.tab,this.onTabTouch)};QzVipWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex)};QzVipWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case QzVipWin.Panel_Privileges:this.QzPrivilegeWin.open();break;case QzVipWin.Panel_DailyGift:this.QzDailyGiftWin.open();break;case QzVipWin.Panel_levelGift:this.QzlevelGiftWin.open();break;case QzVipWin.Panel_NewGift:this.QzNewGiftWin.open();break;case QzVipWin.Panel_Tittle:this.QzTittleWin.open();break}};QzVipWin.prototype.updateRedPoint=function(){this.redPoint1.visible=QzoneSys.ins().isEnableGetQzNewGift();this.redPoint2.visible=QzoneSys.ins().isEnableGetLevelRewards(QzoneSys.TYPE_QQVIP);this.redPoint3.visible=QzoneSys.ins().isEnableGetQzDailyGift();this.redPoint4.visible=QzoneSys.ins().isEnableGetQzTittleGift()};QzVipWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};QzVipWin.prototype.updateDetail=function(parma){};QzVipWin.Panel_Privileges=0;QzVipWin.Panel_NewGift=1;QzVipWin.Panel_levelGift=2;QzVipWin.Panel_DailyGift=3;QzVipWin.Panel_Tittle=4;return QzVipWin}(BaseEuiView);__reflect(QzVipWin.prototype,"QzVipWin");ViewManager.ins().reg(QzVipWin,LayerManager.UI_Main);var QQzoneLevelGiftRenderer=function(_super){__extends(QQzoneLevelGiftRenderer,_super);function QQzoneLevelGiftRenderer(){var _this=_super.call(this)||this;_this.skinName="QQzoneLevelGiftItemSkin";_this.itemList.itemRenderer=ItemBase;return _this}QQzoneLevelGiftRenderer.prototype.dataChanged=function(){if(!this.data)return;this.initUI();this.updateShow()};QQzoneLevelGiftRenderer.prototype.initUI=function(){this.redPoint.visible=false;this.levelTxt.text="";this.btnGet.skinName="Btn60Skin";this.btnGet.label=i18n("LevelupRewardsRenderer_0");this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)};QQzoneLevelGiftRenderer.prototype.updateShow=function(){var curLevel=-1;var getLevel=-1;var rewardsList=QzoneSys.ins().QZoneLevelGiftList;var status=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].status:RewardsStatus.STATUS_DISABLE_GET;if(this.data["level"]){curLevel=Actor.level;getLevel=this.data["level"];this.levelShow()}else if(this.data["zslevel"]){curLevel=UserZs.ins().lv;getLevel=this.data["zslevel"];this.zslevelShow()}this.setRewardStatus(curLevel,getLevel,status);this.setItemListData()};QQzoneLevelGiftRenderer.prototype.levelShow=function(){this.levelTxt.text=""+this.data["level"]+"级"};QQzoneLevelGiftRenderer.prototype.zslevelShow=function(){this.levelTxt.text=""+this.data["zslevel"]+"转"};QQzoneLevelGiftRenderer.prototype.setRewardStatus=function(curLevel,getLevel,status){this.btnGet.enabled=true;if(curLevel>=getLevel){this.redPoint.visible=true;if(status==RewardsStatus.STATUS_ABLE_GET){this.btnGet.currentState="up";this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)}else if(status==RewardsStatus.STATUS_HAD_GET){this.redPoint.visible=false;this.btnGet.enabled=false;this.btnGet.label=i18n("LevelupRewardsRenderer_1");this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled"}}else{this.btnGet.enabled=false;this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled";this.btnGet.label=i18n("LevelupRewardsRenderer_2")}};QQzoneLevelGiftRenderer.prototype.setItemListData=function(){if(this.data["rewards"]){var rewards=this.data["rewards"];var d=[];for(var i=0;i<rewards.length;i++){if(!rewards[i])continue;d.push(rewards[i])}this.itemList.dataProvider=new eui.ArrayCollection(d)}};QQzoneLevelGiftRenderer.prototype.onGetReward=function(){this.btnGet.currentState="down";if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}var rewardsList=QzoneSys.ins().QZoneLevelGiftList;var id=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].id:-1;QzoneSys.ins().sendGetLevelGift(QzoneSys.TYPE_QQZONE,id)};return QQzoneLevelGiftRenderer}(BaseItemRender);__reflect(QQzoneLevelGiftRenderer.prototype,"QQzoneLevelGiftRenderer");var QzvipDailyGiftRenderer=function(_super){__extends(QzvipDailyGiftRenderer,_super);function QzvipDailyGiftRenderer(){var _this=_super.call(this)||this;_this.skinName="QzvipDailyGiftItemSkin";_this.itemList.itemRenderer=ItemBase;_this.itemList0.itemRenderer=ItemBaseQzVip;return _this}QzvipDailyGiftRenderer.prototype.dataChanged=function(){if(!this.data)return;this.updateShow()};QzvipDailyGiftRenderer.prototype.updateShow=function(){this.viplevel.source="hzicon"+this.data.index;this.setItemListData()};QzvipDailyGiftRenderer.prototype.setItemListData=function(){var data=this.data;this.itemList.dataProvider=new eui.ArrayCollection(data.rewards);this.itemList0.dataProvider=new eui.ArrayCollection(data.yearrewards)};QzvipDailyGiftRenderer.prototype.onGetReward=function(){};return QzvipDailyGiftRenderer}(BaseItemRender);__reflect(QzvipDailyGiftRenderer.prototype,"QzvipDailyGiftRenderer");var QzvipLevelGiftRenderer=function(_super){__extends(QzvipLevelGiftRenderer,_super);function QzvipLevelGiftRenderer(){var _this=_super.call(this)||this;_this.lastTime=0;_this.skinName="QzvipLevelGiftItemSkin";_this.itemList.itemRenderer=ItemBase;return _this}QzvipLevelGiftRenderer.prototype.dataChanged=function(){if(!this.data)return;this.initUI();this.updateShow()};QzvipLevelGiftRenderer.prototype.initUI=function(){this.redPoint.visible=false;this.levelTxt.text="";this.btnGet.skinName="Btn60Skin";this.btnGet.label=i18n("LevelupRewardsRenderer_0");this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)};QzvipLevelGiftRenderer.prototype.updateShow=function(){var curLevel=-1;var getLevel=-1;var rewardsList=QzoneSys.ins().QzVipLevelGiftList;var status=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].status:RewardsStatus.STATUS_DISABLE_GET;if(this.data["level"]){curLevel=Actor.level;getLevel=this.data["level"];this.levelShow()}else if(this.data["zslevel"]){curLevel=UserZs.ins().lv;getLevel=this.data["zslevel"];this.zslevelShow()}this.setRewardStatus(curLevel,getLevel,status);this.setItemListData()};QzvipLevelGiftRenderer.prototype.levelShow=function(){this.levelTxt.text=""+this.data["level"]+"级"};QzvipLevelGiftRenderer.prototype.zslevelShow=function(){this.levelTxt.text=""+this.data["zslevel"]+"转"};QzvipLevelGiftRenderer.prototype.setRewardStatus=function(curLevel,getLevel,status){this.btnGet.enabled=true;if(curLevel>=getLevel){this.redPoint.visible=true;if(status==RewardsStatus.STATUS_ABLE_GET||status==RewardsStatus.STATUS_DISABLE_GET){this.btnGet.currentState="up";this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onGetReward,this)}else if(status==RewardsStatus.STATUS_HAD_GET){this.redPoint.visible=false;this.btnGet.enabled=false;this.btnGet.label=i18n("LevelupRewardsRenderer_1");this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled"}}else{this.btnGet.enabled=false;this.btnGet.skinName="Btn60Skin";this.btnGet.currentState="disabled";this.btnGet.label=i18n("LevelupRewardsRenderer_2")}};QzvipLevelGiftRenderer.prototype.setItemListData=function(){if(this.data["rewards"]){var rewards=this.data["rewards"];var d=[];for(var i=0;i<rewards.length;i++){if(!rewards[i])continue;d.push(rewards[i])}this.itemList.dataProvider=new eui.ArrayCollection(d)}};QzvipLevelGiftRenderer.prototype.onGetReward=function(){this.btnGet.currentState="down";if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin);return}var rewardsList=QzoneSys.ins().QzVipLevelGiftList;var id=rewardsList[this.itemIndex]!=null?rewardsList[this.itemIndex].id:-1;if(GameServer.serverTime-this.lastTime<1e3){return}this.lastTime=GameServer.serverTime;QzoneSys.ins().sendGetLevelGift(QzoneSys.TYPE_QQVIP,id)};return QzvipLevelGiftRenderer}(BaseItemRender);__reflect(QzvipLevelGiftRenderer.prototype,"QzvipLevelGiftRenderer");var Rank=function(_super){__extends(Rank,_super);function Rank(){var _this=_super.call(this)||this;_this.rankModel=[];_this.rankTypeList=[];_this.sysId=PackageID.Ranking;_this.regNetMsg(1,_this.postRankingData);_this.regNetMsg(2,_this.postPraiseData);_this.regNetMsg(3,_this.postPraiseResult);_this.regNetMsg(4,_this.postAllPraiseData);return _this}Rank.ins=function(){return _super.ins.call(this)};Rank.prototype.initLogin=function(){this.sendGetAllPraiseData()};Rank.prototype.sendGetRankingData=function(type){if(type===void 0){type=0}var bytes=this.getBytes(1);bytes.writeShort(type);this.sendToServer(bytes)};Rank.prototype.postRankingData=function(bytes){var type=bytes.readShort();var rankModel=this.getRankModel(type);rankModel.parser(bytes);this.rankModel[type]=rankModel;return rankModel};Rank.prototype.sendGetPraiseData=function(type){if(type===void 0){type=0}var bytes=this.getBytes(2);bytes.writeShort(type);this.sendToServer(bytes)};Rank.prototype.postPraiseData=function(bytes){var rankModel=Rank.ins().getRankModel(bytes.readShort());rankModel.praise.praiseTime=bytes.readShort();rankModel.praise.parser(bytes);return rankModel.type};Rank.prototype.sendGetAllPraiseData=function(){this.sendBaseProto(4)};Rank.prototype.postAllPraiseData=function(bytes){var n=bytes.readShort();for(var i=0;i<n;i++){var rankModel=Rank.ins().getRankModel(bytes.readShort());rankModel.praise.praiseTime=bytes.readShort()}};Rank.prototype.sendPraise=function(type){var bytes=this.getBytes(3);bytes.writeShort(type);this.sendToServer(bytes)};Rank.prototype.postPraiseResult=function(bytes){var rankModel=Rank.ins().getRankModel(bytes.readShort());rankModel.praise.praiseTime=bytes.readShort();return[rankModel.type,rankModel.praise.getLastMobaiNum()]};Rank.prototype.getRankModel=function(type){if(!(type in this.rankModel)){var dataClass=void 0;if(type==RankDataType.TYPE_SKIRMISH)dataClass=RankDataSkirmish;else if(type==RankDataType.TYPE_LADDER)dataClass=RankDataLadder;else if(type==RankDataType.TYPE_BAOSHI)dataClass=RankDataZhuZao;else if(type==RankDataType.TYPE_LONGHUN)dataClass=RankDataLongHun;else if(type==RankDataType.TYPE_WING)dataClass=RankDataWing;else if(type==RankDataType.TYPE_BOOK)dataClass=RankDataBook;else if(type==RankDataType.TYPE_ZS)dataClass=RankDataZhuan;else if(type==RankDataType.TYPE_SCORE)dataClass=RankDataScore;else if(type==RankDataType.TYPE_WEIWANG)dataClass=RankDataWeiWang;else if(type==RankDataType.TYPE_SHAPESHIFTING)dataClass=RankDataShape;else if(type==RankDataType.TYPE_XIANYU)dataClass=RankDataXianYu;else if(type==RankDataType.TYPE_HARD_FB)dataClass=RankDataHardFb;else if(type==RankDataType.TYPE_SPRING_TURNTABLE)dataClass=RankDataSpring;else dataClass=RankDataBase;this.rankModel[type]=new RankModel(type,dataClass)}return this.rankModel[type]};Rank.prototype.canPraiseByType=function(type){return false};Rank.prototype.canPraiseInAll=function(){if(this.rankTypeList.length<=0){this.rankTypeList=[RankDataType.TYPE_POWER,RankDataType.TYPE_SKIRMISH,RankDataType.TYPE_LEVEL,RankDataType.TYPE_LILIAN,RankDataType.TYPE_XUNZHANG]}for(var _i=0,_a=this.rankModel;_i<_a.length;_i++){var value=_a[_i];if(value&&this.rankTypeList.lastIndexOf(value.type)>-1){if(value.praise&&value.praise.praiseTime<1){return true}}}return false};return Rank}(BaseSystem);__reflect(Rank.prototype,"Rank");var RankModel=function(){function RankModel(type,dataClass){this.type=type;this._dataClass=dataClass;this._dataList=[];this.praise=new PraiseData}RankModel.prototype.getDataList=function(index){if(index===void 0){index=-1}return index==-1?this._dataList:this._dataList[index]};RankModel.prototype.parser=function(bytes){var items=RankDataType.ITEMS[this.type];var n=bytes.readShort();this._dataList.length=n;for(var i=0;i<n;++i){if(!(i in this._dataList))this._dataList[i]=new this._dataClass;this._dataList[i].parser(bytes,items)}this.selfPos=bytes.readShort()};return RankModel}();__reflect(RankModel.prototype,"RankModel");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.rank=Rank.ins.bind(Rank)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var RankDataType;(function(RankDataType){RankDataType.TYPE_POWER=0;RankDataType.TYPE_ARENA=1;RankDataType.TYPE_SKIRMISH=2;RankDataType.TYPE_PASS=3;RankDataType.TYPE_COPY=4;RankDataType.TYPE_LEVEL=5;RankDataType.TYPE_WING=16;RankDataType.TYPE_JOB_ZS=7;RankDataType.TYPE_JOB_FS=8;RankDataType.TYPE_JOB_DS=9;RankDataType.TYPE_LILIAN=10;RankDataType.TYPE_LADDER=11;RankDataType.TYPE_BAOSHI=12;RankDataType.TYPE_ZHANLING=13;RankDataType.TYPE_LONGHUN=14;RankDataType.TYPE_XUNZHANG=15;RankDataType.TYPE_XIAOFEI=21;RankDataType.TYPE_BOOK=17;RankDataType.TYPE_ZS=18;RankDataType.TYPE_SCORE=19;RankDataType.TYPE_HF_XIAOFEI=31;RankDataType.TYPE_WEIWANG=22;RankDataType.TYPE_XIAYI=23;RankDataType.TYPE_XIANYU=24;RankDataType.TYPE_SHAPESHIFTING=29;RankDataType.TYPE_MARRY_LEVEL=27;RankDataType.TYPE_MARRY_EQUIP=28;RankDataType.TYPE_FUWENTA=32;RankDataType.TYPE_HARD_FB=34;RankDataType.TYPE_SPRING_TURNTABLE=35;RankDataType.DATA_POS="pos";RankDataType.DATA_ID="id";RankDataType.DATA_PLAYER="player";RankDataType.DATA_LEVEL="level";RankDataType.DATA_ZHUAN="zhuan";RankDataType.DATA_VIP="vip";RankDataType.DATA_MONTH="month";RankDataType.DATA_POWER="power";RankDataType.DATA_COUNT="count";RankDataType.DATA_EXP="exp";RankDataType.DATA_JOB="job";RankDataType.DATA_SEX="sex";RankDataType.DATA_WEIWANG="weiWang";RankDataType.ITEMS=[];RankDataType.ITEMS[RankDataType.TYPE_POWER]=RankDataType.ITEMS[RankDataType.TYPE_WING]=RankDataType.ITEMS[RankDataType.TYPE_JOB_ZS]=RankDataType.ITEMS[RankDataType.TYPE_JOB_FS]=RankDataType.ITEMS[RankDataType.TYPE_JOB_DS]=[RankDataType.DATA_POS,RankDataType.DATA_ID,RankDataType.DATA_PLAYER,RankDataType.DATA_LEVEL,RankDataType.DATA_ZHUAN,RankDataType.DATA_VIP,RankDataType.DATA_MONTH,RankDataType.DATA_POWER];RankDataType.ITEMS[RankDataType.TYPE_SKIRMISH]=[RankDataType.DATA_POS,RankDataType.DATA_ID,RankDataType.DATA_PLAYER,RankDataType.DATA_JOB,RankDataType.DATA_SEX,RankDataType.DATA_LEVEL,RankDataType.DATA_ZHUAN,RankDataType.DATA_VIP,RankDataType.DATA_COUNT,RankDataType.DATA_MONTH];RankDataType.ITEMS[RankDataType.TYPE_LEVEL]=[RankDataType.DATA_POS,RankDataType.DATA_ID,RankDataType.DATA_PLAYER,RankDataType.DATA_LEVEL,RankDataType.DATA_ZHUAN,RankDataType.DATA_VIP,RankDataType.DATA_MONTH];RankDataType.ITEMS[RankDataType.TYPE_PASS]=RankDataType.ITEMS[RankDataType.TYPE_COPY]=RankDataType.ITEMS[RankDataType.TYPE_FUWENTA]=[RankDataType.DATA_POS,RankDataType.DATA_ID,RankDataType.DATA_PLAYER,RankDataType.DATA_POWER,RankDataType.DATA_VIP,RankDataType.DATA_COUNT,RankDataType.DATA_MONTH];RankDataType.ITEMS[RankDataType.TYPE_LILIAN]=[RankDataType.DATA_POS,RankDataType.DATA_ID,RankDataType.DATA_PLAYER,RankDataType.DATA_LEVEL,RankDataType.DATA_ZHUAN,RankDataType.DATA_VIP,RankDataType.DATA_MONTH,RankDataType.DATA_COUNT,RankDataType.DATA_EXP];RankDataType.ITEMS[RankDataType.TYPE_XUNZHANG]=[RankDataType.DATA_POS,RankDataType.DATA_ID,RankDataType.DATA_PLAYER,RankDataType.DATA_LEVEL,RankDataType.DATA_ZHUAN,RankDataType.DATA_VIP,RankDataType.DATA_MONTH,RankDataType.DATA_COUNT];RankDataType.ITEMS[RankDataType.TYPE_XIAYI]=[RankDataType.DATA_POS,RankDataType.DATA_ID,RankDataType.DATA_PLAYER,RankDataType.DATA_VIP,RankDataType.DATA_COUNT];RankDataType.readFunc={};RankDataType.readFunc[RankDataType.DATA_JOB]=RankDataType.readFunc[RankDataType.DATA_SEX]="readByte";RankDataType.readFunc[RankDataType.DATA_POS]=RankDataType.readFunc[RankDataType.DATA_LEVEL]=RankDataType.readFunc[RankDataType.DATA_ZHUAN]=RankDataType.readFunc[RankDataType.DATA_VIP]=RankDataType.readFunc[RankDataType.DATA_MONTH]="readShort";RankDataType.readFunc[RankDataType.DATA_ID]=RankDataType.readFunc[RankDataType.DATA_POWER]=RankDataType.readFunc[RankDataType.DATA_COUNT]=RankDataType.readFunc[RankDataType.DATA_EXP]="readInt";RankDataType.readFunc[RankDataType.DATA_POWER]="readDouble";RankDataType.readFunc[RankDataType.DATA_PLAYER]="readString"})(RankDataType||(RankDataType={}));window["RankDataType"]=RankDataType;var UserReadPlayer=function(_super){__extends(UserReadPlayer,_super);function UserReadPlayer(){var _this=_super.call(this)||this;_this.sysId=PackageID.Default;_this.regNetMsg(16,_this.postPlayerResult);return _this}UserReadPlayer.ins=function(){return _super.ins.call(this)};UserReadPlayer.prototype.sendFindPlayer=function(id,serverId){if(serverId===void 0){serverId=0}var bytes=this.getBytes(16);bytes.writeInt(id);bytes.writeInt(serverId);this.sendToServer(bytes)};UserReadPlayer.prototype.postPlayerResult=function(bytes){var data=UserReadPlayer.ins().otherPlayerData;if(!data)data=new OtherPlayerData;data.parser(bytes);return data};return UserReadPlayer}(BaseSystem);__reflect(UserReadPlayer.prototype,"UserReadPlayer");var OtherPlayerData=function(){function OtherPlayerData(){this.roleData=[];this.lilianLv=0;this.zhanlingID=0;this.zhanlingLevel=0}OtherPlayerData.prototype.parser=function(bytes){this.id=bytes.readInt();this.serverId=bytes.readInt();this.name=bytes.readString();this.level=bytes.readShort();this.vipLevel=bytes.readShort();this.zhuan=bytes.readShort();this.lilianLv=bytes.readInt();this.ce=bytes.readDouble();this.guildId=bytes.readInt();this.guildName=bytes.readString();this.zhanlingID=bytes.readInt();this.zhanlingLevel=bytes.readInt();var num=bytes.readShort();for(var i=0;i<num;i++){this.roleData[i]=new Role;this.roleData[i].parser(bytes)}};return OtherPlayerData}();__reflect(OtherPlayerData.prototype,"OtherPlayerData");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userreadplayer=UserReadPlayer.ins.bind(UserReadPlayer)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SubRole=function(){function SubRole(){this.pos1=0;this.pos2=0;this.pos3=0}SubRole.prototype.parser=function(bytes){this.job=bytes.readByte();this.sex=bytes.readByte();this.clothID=bytes.readInt();this.swordID=bytes.readInt();this.wingLevel=bytes.readInt();if(bytes.readInt()==0){this.wingLevel=-1}this.pos1=bytes.readInt();this.pos2=bytes.readInt();this.pos3=bytes.readInt()};return SubRole}();__reflect(SubRole.prototype,"SubRole");var PraiseData=function(){function PraiseData(){this.subRole=[]}PraiseData.prototype.getLastMobaiNum=function(){var index=UserZs.ins().lv>0?UserZs.ins().lv*1e3:Actor.level;var maxPraiseTime=GlobalConfig["MorshipConfig"][index].count;return maxPraiseTime-this.praiseTime};PraiseData.prototype.parser=function(bytes){this.id=bytes.readInt();if(this.id>0){this.name=bytes.readString();this.ce=bytes.readDouble();this.level=bytes.readShort();this.zhuan=bytes.readShort();this.vipLevel=bytes.readShort();var num=bytes.readShort();for(var i=0;i<num;i++){this.subRole[i]=new SubRole;this.subRole[i].parser(bytes)}}};PraiseData.prototype.getRoleByJob=function(job){if(job>0){for(var i in this.subRole){if(this.subRole[i].job==job)return this.subRole[i]}}return this.subRole[0]};return PraiseData}();__reflect(PraiseData.prototype,"PraiseData");var AStarNode=function(){function AStarNode(x,y,dir,endTimer){this.nX=x;this.nY=y;this.nDir=dir;this.endTimer=endTimer}return AStarNode}();__reflect(AStarNode.prototype,"AStarNode");var RankDataBook=function(_super){__extends(RankDataBook,_super);function RankDataBook(){return _super.call(this)||this}RankDataBook.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.value=bytes.readDouble()};return RankDataBook}(RankDataBase);__reflect(RankDataBook.prototype,"RankDataBook");var RankDataHardFb=function(_super){__extends(RankDataHardFb,_super);function RankDataHardFb(){return _super.call(this)||this}RankDataHardFb.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.value=bytes.readInt()};return RankDataHardFb}(RankDataBase);__reflect(RankDataHardFb.prototype,"RankDataHardFb");var RankDataLadder=function(_super){__extends(RankDataLadder,_super);function RankDataLadder(){return _super.call(this)||this}RankDataLadder.prototype.parser=function(bytes,items){this.id=bytes.readInt();this.player=bytes.readString();this.challgeLevel=bytes.readInt();this.challgeId=bytes.readInt();this.winNum=bytes.readInt();this.job=bytes.readByte();this.sex=bytes.readByte()};return RankDataLadder}(RankDataBase);__reflect(RankDataLadder.prototype,"RankDataLadder");var RankDataLongHun=function(_super){__extends(RankDataLongHun,_super);function RankDataLongHun(){return _super.call(this)||this}RankDataLongHun.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.value=bytes.readInt()};return RankDataLongHun}(RankDataBase);__reflect(RankDataLongHun.prototype,"RankDataLongHun");var RankDataScore=function(_super){__extends(RankDataScore,_super);function RankDataScore(){return _super.call(this)||this}RankDataScore.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.value=bytes.readDouble()};return RankDataScore}(RankDataBase);__reflect(RankDataScore.prototype,"RankDataScore");var RankDataShape=function(_super){__extends(RankDataShape,_super);function RankDataShape(){return _super.call(this)||this}RankDataShape.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.value=bytes.readInt()};return RankDataShape}(RankDataBase);__reflect(RankDataShape.prototype,"RankDataShape");var RankDataSkirmish=function(_super){__extends(RankDataSkirmish,_super);function RankDataSkirmish(){return _super.call(this)||this}RankDataSkirmish.prototype.parser=function(bytes,items){_super.prototype.parser.call(this,bytes,items);for(var i in GlobalConfig.SkirmishRankConfig){var config=GlobalConfig.SkirmishRankConfig[i];if(config.minRank<=this.pos&&this.pos<=config.maxRank){this.reward=config.rewards[0].count;this.money=config.rewards[1].count;return}}this.money=this.reward=0};return RankDataSkirmish}(RankDataBase);__reflect(RankDataSkirmish.prototype,"RankDataSkirmish");var RankDataSpring=function(_super){__extends(RankDataSpring,_super);function RankDataSpring(){return _super.call(this)||this}RankDataSpring.prototype.parser=function(bytes){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.value=bytes.readInt()};return RankDataSpring}(RankDataBase);__reflect(RankDataSpring.prototype,"RankDataSpring");var RankDataWeiWang=function(_super){__extends(RankDataWeiWang,_super);function RankDataWeiWang(){return _super.call(this)||this}RankDataWeiWang.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.weiWang=bytes.readInt()};return RankDataWeiWang}(RankDataBase);__reflect(RankDataWeiWang.prototype,"RankDataWeiWang");var RankDataWing=function(_super){__extends(RankDataWing,_super);function RankDataWing(){return _super.call(this)||this}RankDataWing.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.value=bytes.readInt()};return RankDataWing}(RankDataBase);__reflect(RankDataWing.prototype,"RankDataWing");var RankDataXianYu=function(_super){__extends(RankDataXianYu,_super);function RankDataXianYu(){return _super.call(this)||this}RankDataXianYu.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.value=bytes.readInt()};return RankDataXianYu}(RankDataBase);__reflect(RankDataXianYu.prototype,"RankDataXianYu");var RankDataZhuan=function(_super){__extends(RankDataZhuan,_super);function RankDataZhuan(){return _super.call(this)||this}RankDataZhuan.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.value=bytes.readInt()};return RankDataZhuan}(RankDataBase);__reflect(RankDataZhuan.prototype,"RankDataZhuan");var RankDataZhuZao=function(_super){__extends(RankDataZhuZao,_super);function RankDataZhuZao(){return _super.call(this)||this}RankDataZhuZao.prototype.parser=function(bytes,items){this.pos=bytes.readShort();this.id=bytes.readInt();this.player=bytes.readString();this.level=bytes.readShort();this.zslevel=bytes.readShort();this.viplevel=bytes.readShort();this.monthCard=bytes.readShort();this.value=bytes.readInt()};return RankDataZhuZao}(RankDataBase);__reflect(RankDataZhuZao.prototype,"RankDataZhuZao");var FbAndLevelsRankItem=function(_super){__extends(FbAndLevelsRankItem,_super);function FbAndLevelsRankItem(){var _this=_super.call(this)||this;_this.skinName="FbRankItemSkin";return _this}FbAndLevelsRankItem.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openDetail,this)};FbAndLevelsRankItem.prototype.close=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openDetail,this)};FbAndLevelsRankItem.prototype.dataChanged=function(){this.rank.text=this.data[RankDataType.DATA_POS]+"";this.monthcard.visible=this.data[RankDataType.DATA_MONTH]==1;var vipLevel=this.data[RankDataType.DATA_VIP];this.vipImg.visible=vipLevel>0;this.vip.removeChildren();if(vipLevel>0)this.vip.addChild(BitmapNumber.ins().createNumPic(vipLevel,"5"));this.nameLabel.text=this.data[RankDataType.DATA_PLAYER];this.zhanli.text=CommonUtils.overLength(this.data[RankDataType.DATA_POWER]);this.ce.text=this.data[RankDataType.DATA_COUNT]+i18n("FbAndLevelsRankItem_0")};FbAndLevelsRankItem.prototype.openDetail=function(){UserReadPlayer.ins().sendFindPlayer(this.data.playId)};return FbAndLevelsRankItem}(BaseItemRender);__reflect(FbAndLevelsRankItem.prototype,"FbAndLevelsRankItem");var FbAndLevelsRankWin=function(_super){__extends(FbAndLevelsRankWin,_super);function FbAndLevelsRankWin(){return _super.call(this)||this}FbAndLevelsRankWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="FbRankSkin"};FbAndLevelsRankWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.title.source="fbRankSkin_"+param[0];var rankModel=Rank.ins().rankModel[param[0]];this.rank.text=0<rankModel.selfPos&&rankModel.selfPos<=1e3?rankModel.selfPos+"":i18n("FbAndLevelsRankWin_0");this.list.itemRenderer=FbAndLevelsRankItem;this.list.dataProvider=new eui.ArrayCollection(rankModel.getDataList());this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap)};FbAndLevelsRankWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap)};FbAndLevelsRankWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(FbAndLevelsRankWin);break}};return FbAndLevelsRankWin}(BaseEuiView);__reflect(FbAndLevelsRankWin.prototype,"FbAndLevelsRankWin");ViewManager.ins().reg(FbAndLevelsRankWin,LayerManager.UI_Popup);var RankingWin=function(_super){__extends(RankingWin,_super);function RankingWin(){var _this=_super.call(this)||this;_this.firstId=0;_this.skinName="RankSkin";_this.isTopLevel=true;return _this}RankingWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.praiseBtn.touchEnabled=true;this.praiseBtn.icon="xphb_json.phb_2";this.list.itemRenderer=RankItemRenderer;this.tab.itemRenderer=RankTabItemRenderer;this.mobaiEff=new MovieClip;this.mobaiEff.x=35;this.mobaiEff.y=-35;this.mobaiEff.scaleX=this.mobaiEff.scaleY=.65;this.playFlameMC();this.firstPower=BitmapNumber.ins().createNumPic(0,"8",5);this.powerNum.addChild(this.firstPower)};RankingWin.prototype.initPos=function(){if(this.firstPower.width/2>0)this.firstPower.x=20-this.firstPower.width/2};RankingWin.prototype.setPower=function(value){BitmapNumber.ins().changeNum(this.firstPower,value,"8",5);this.initPos()};RankingWin.prototype.playFlameMC=function(){if(this.flameMC){this.flameMC.play(-1)}else{this.flameMC=new MovieClip;this.flameMC.x=60;this.flameMC.y=28;this.flameMC.playFile(RES_DIR_EFF+"zhanduolibeijing",-1);this.flameGroup.addChild(this.flameMC)}};RankingWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.praiseBtn,this.onClick);this.addTouchEvent(this.list,this.onClick);this.addChangeEvent(this.tab,this.onClick);this.addTouchEvent(this.firstGroup,this.onClick);this.addTouchEvent(this.praiseGroup,this.onClick);this.addTouchEvent(this.praiseGroup2,this.onClick);this.addTouchEvent(this.praiseGroup3,this.onClick);this.addTouchEvent(this.help,this.onClick);this.setOpenType(param[0]==undefined?-1:param[0]);this.observe(Rank.ins().postRankingData,this.updateList);this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView);this.observe(Rank.ins().postPraiseResult,this.refushMoBaiStatu);this.observe(Rank.ins().postPraiseData,this.updatePraise);this.observe(Rank.ins().postAllPraiseData,this.updateTab);Rank.ins().sendGetAllPraiseData()};RankingWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this._weaponEff0)DisplayUtils.removeFromParent(this._weaponEff0);if(this._weaponEff1)DisplayUtils.removeFromParent(this._weaponEff1);if(this._weaponEff2)DisplayUtils.removeFromParent(this._weaponEff2);if(this._bodyEff0)DisplayUtils.removeFromParent(this._bodyEff0);if(this._bodyEff1)DisplayUtils.removeFromParent(this._bodyEff1);if(this._bodyEff2)DisplayUtils.removeFromParent(this._bodyEff2);WatcherUtil.removeFromArrayCollection(this.tab.dataProvider)};RankingWin.prototype.updateList=function(rankModel){if(rankModel.type!=this._type)return;this.selfPos.text=0<rankModel.selfPos&&rankModel.selfPos<=1e3?rankModel.selfPos+"":i18n("RankingWin_0");var arr=rankModel.getDataList();this.list.dataProvider=new eui.ArrayCollection(arr.slice(1));this.refushMoBaiStatu();this.refushFirstInfo(rankModel.getDataList(0));if(arr&&!arr.length){this.state.visible=true}else{this.state.visible=false}this.titleMcGroup.visible=this.titleImg.visible=this.firstGroup.visible=!this.state.visible};RankingWin.prototype.refushFirstInfo=function(firstInfo){if(firstInfo){this.firstId=firstInfo.id;this.powerGroup.visible=false;UserReadPlayer.ins().sendFindPlayer(this.firstId);this.firstNameTxt.text=firstInfo.player;this.vip.visible=false;this.vipGroup.removeChildren();if(firstInfo.vip>0||firstInfo.viplevel>0){this.viplevel.visible=true;this.vipGroup.visible=true;this.viplevel.text="v";this.vipNum=BitmapNumber.ins().createNumPic(firstInfo.vip||firstInfo.viplevel,"zv0",8);this.vipNum.scaleX=this.vipNum.scaleX=1.1;this.vipNum.x=(firstInfo.vip||firstInfo.viplevel)>=10?2:8;this.vipNum.y=0;this.vipGroup.addChild(this.vipNum)}else{this.viplevel.visible=false;this.vipGroup.visible=false}var str="";if(Rank.ins().curType==RankDataType.TYPE_XUNZHANG){var cfg=GlobalConfig.KnighthoodConfig[firstInfo.count];str=cfg.type}else if(Rank.ins().curType==RankDataType.TYPE_LILIAN){var cfg=GlobalConfig.TrainLevelConfig[firstInfo.count];str=i18n("RankingWin_1",cfg.trainlevel,cfg.trainName)}else if(Rank.ins().curType==RankDataType.TYPE_SKIRMISH){str=i18n("RankingWin_2",firstInfo.count)}else if(Rank.ins().curType==RankDataType.TYPE_XIAYI){str=i18n("RankingWin_3",firstInfo.count)}else if(Rank.ins().curType==RankDataType.TYPE_POWER){str="";this.firstLevelTxt.visible=false;this.powerGroup.visible=true;this.setPower(firstInfo.power)}else{str=(firstInfo[RankDataType.DATA_ZHUAN]?firstInfo[RankDataType.DATA_ZHUAN]+i18n("RankingWin_4"):"")+firstInfo[RankDataType.DATA_LEVEL]+i18n("RankingWin_5")}if(Rank.ins().curType==RankDataType.TYPE_WEIWANG){this.weiwang.visible=true;this.weiwang.source=WeiWangCC.ins().getWeiWangCfg(firstInfo.weiWang).res;this.firstLevelTxt.visible=false}else{this.firstLevelTxt.visible=true;this.weiwang.visible=false}this.firstLevelTxt.text=str}else{this.firstId=0;this.weiwang.visible=false}};RankingWin.prototype.updateValue=function(infoData,key,value){switch(key){case RankDataType.DATA_VIP:return;case RankDataType.DATA_MONTH:return;case RankDataType.DATA_LEVEL:value=(infoData[RankDataType.DATA_ZHUAN]?infoData[RankDataType.DATA_ZHUAN]+i18n("RankingWin_7"):"")+value+i18n("RankingWin_8");break;case RankDataType.DATA_COUNT:break}this.firstLevelTxt.text=value};RankingWin.prototype.refushMoBaiStatu=function(){if(Rank.ins().canPraiseByType(this._type)){this.praiseBtn.icon="xphb_json.phb_2";this.mobaiEff.playFile(RES_DIR_EFF+"huoban",-1);this.mobai.addChild(this.mobaiEff)}else{this.praiseBtn.icon="xphb_json.phb_23";DisplayUtils.removeFromParent(this.mobaiEff)}this.updateTab()};RankingWin.prototype.setOpenType=function(_type){var datas=this.tab.dataProvider;var index=0;for(var i=0;i<datas.length;i++){var data=datas.getItemAt(i);if(data.type==_type){index=i;break}}this.setOpenIndex(index)};RankingWin.prototype.setOpenIndex=function(selectedIndex){this.tab.selectedIndex=selectedIndex;var selectedData=this.tab.selectedItem;this._type=selectedData.type;Rank.ins().curType=this._type;RankItemRenderer.dataFormat=selectedData;this.selfPos.text=null;this.list.dataProvider=null;this.list.itemRendererSkinName=selectedData.skin||"RankItemPowerSkin";if(this._type==RankDataType.TYPE_LADDER){Ladder.ins().sendGetRankInfo()}else{Rank.ins().sendGetRankingData(this._type)}Rank.ins().sendGetPraiseData(this._type)};RankingWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.praiseBtn:if(Rank.ins().rankModel[this._type].praise.praiseTime<1){Rank.ins().sendPraise(this._type)}else{UserTips.ins().showTips(i18n("RankingWin_9"))}break;case this.list:if(this.list.selectedItem){this._openOtherWin=true;UserReadPlayer.ins().sendFindPlayer(this.list.selectedItem[RankDataType.DATA_ID])}break;case this.tab:this.setOpenIndex(this.tab.selectedIndex);break;case this.firstGroup:case this.praiseGroup:case this.praiseGroup2:case this.praiseGroup3:if(this.firstId){this._openOtherWin=true;UserReadPlayer.ins().sendFindPlayer(this.firstId)}break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[21].text);break}};RankingWin.prototype.openOtherPlayerView=function(otherPlayerData){if(this._openOtherWin){this._openOtherWin=false;ViewManager.ins().open(RRoleWin,otherPlayerData)}else{var maxtitle=-1;if(otherPlayerData&&otherPlayerData.roleData&&otherPlayerData.roleData.length>0){var roleData=otherPlayerData.roleData;var len=otherPlayerData.roleData.length;for(var i=0;i<len;++i){if(roleData[i]&&roleData[i].title>maxtitle){maxtitle=roleData[i].title}}}this.onSetTitle(maxtitle)}};RankingWin.prototype.onSetTitle=function(title){if(!this.state.visible){var config=GlobalConfig.TitleConf[title]||{};this.titleImg.source=config.img;if(config.eff){if(!this.titleMc){this.titleMc=ObjectPool.pop("MovieClip");this.titleMc.x=0;this.titleMc.y=0;this.titleMc.scaleX=1.5;this.titleMc.scaleY=1.5;this.titleMcGroup.addChild(this.titleMc)}this.titleMc.playFile(RES_DIR_EFF+config.eff,-1)}else{if(this.titleMc){this.titleMc.destroy();this.titleMc=null}}}};RankingWin.prototype.updatePraise=function(type){var role;if(Rank.ins().rankModel[type].praise.id>0){for(var i=0;i<3;i++){role=Rank.ins().rankModel[type].praise.subRole[i];var bodyRes="";var weaponRes="";var wingRes="";var noAni=false;if(role){var clothCfg=GlobalConfig.EquipConfig[role.clothID];if(clothCfg){var fileName=clothCfg.appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}if(fileName.indexOf("903")>0){bodyRes=(role.clothID>0?fileName+"_":"body"+role.job+"00_")+role.sex+"_c"}else{bodyRes=(role.clothID>0?fileName:"body"+role.job+"00")+"_c"}}else{bodyRes=getDefaultBody(role.job)+"_c"}var weaponCfg=GlobalConfig.EquipConfig[role.swordID];if(weaponCfg){var fileName=GlobalConfig.EquipConfig[role.swordID].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}weaponRes=!this.hideWeapon(role.swordID,role.sex)?role.swordID>0?fileName+"_"+role.sex+"_c":"":""}else{weaponRes=""}var wingCfg=GlobalConfig.WingLevelConfig[role.wingLevel];if(wingCfg){wingRes=role.wingLevel>=0?wingCfg.appearance:""}else{wingRes=""}if(role.pos1>0){bodyRes=getZhuangbanById(role.pos1).res+"_c";DisplayUtils.removeFromParent(this["_bodyEff"+i])}else{if(!this["_bodyEff"+i])this["_bodyEff"+i]=new MovieClip;this.setWeaponEffect(role.clothID,"bPos"+i+"_",role.sex,this["bodyEffect"+i],this["_bodyEff"+i])}if(role.pos2>0){weaponRes=getZhuangbanById(role.pos2).res+"_"+role.sex+"_c";DisplayUtils.removeFromParent(this["_weaponEff"+i])}else{if(!this["_weaponEff"+i])this["_weaponEff"+i]=new MovieClip}if(role.pos3>0){wingRes=getZhuangbanById(role.pos3).res}}else{noAni=true;bodyRes="";weaponRes="";wingRes="";if(this["_weaponEff"+i])DisplayUtils.removeFromParent(this["_weaponEff"+i]);if(this["_bodyEff"+i])DisplayUtils.removeFromParent(this["_bodyEff"+i])}var mc=imageToMc(this["bodyImg"+i],bodyRes,this["bodyMc"+i],null,RES_DIR_ROLE,noAni);if(!this._body){this._body=mc}imageToMc(this["weaponImg"+i],weaponRes,this["weaponMc"+i],this._body,RES_DIR_ROLE,noAni);imageToMc(this["wingImg"+i],wingRes,this["wingMc"+i],this._body,RES_DIR_ROLE,noAni)}this.refushMoBaiStatu()}else{for(var i=0;i<3;i++){var mc=imageToMc(this["bodyImg"+i],"",this["bodyMc"+i],null,RES_DIR_ROLE,true);if(!this._body){this._body=mc}imageToMc(this["weaponImg"+i],"",this["weaponMc"+i],this._body,RES_DIR_ROLE,true);imageToMc(this["wingImg"+i],"",this["wingMc"+i],this._body,RES_DIR_ROLE,true);DisplayUtils.removeFromParent(this["_weaponEff"+i]);DisplayUtils.removeFromParent(this["_bodyEff"+i])}}this.updateTab()};RankingWin.prototype.updateTab=function(){var i=this.tab.selectedIndex;this.tab.dataProvider.refresh();this.tab.selectedIndex=i};RankingWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!OpenSystem.ins().checkSysOpen(SystemType.RANK)){UserTips.ins().showTips(i18n("RankingWin_10"));return false}return true};RankingWin.prototype.hideWeapon=function(id,sex){return false};RankingWin.prototype.setWeaponEffect=function(id,imgStr,sex,soulEffGroup,suitEff){var cfg=GlobalConfig.EquipWithEffConfig[id+"_"+sex];if(cfg){suitEff.scaleX=suitEff.scaleY=cfg.scaling;if(!suitEff.parent)soulEffGroup.addChild(suitEff);suitEff.x=this[imgStr+sex].x+cfg.offX;suitEff.y=this[imgStr+sex].y+cfg.offY;suitEff.playFile(RES_DIR_EFF+cfg.inShowEff,-1)}else if(suitEff.parent)suitEff.parent.removeChild(suitEff)};return RankingWin}(BaseEuiView);__reflect(RankingWin.prototype,"RankingWin");ViewManager.ins().reg(RankingWin,LayerManager.UI_Main);var RankTabItemRenderer=function(_super){__extends(RankTabItemRenderer,_super);function RankTabItemRenderer(){var _this=_super.call(this)||this;_this.skinName="BtnTab3Skin";return _this}RankTabItemRenderer.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);this.redPoint.visible=Rank.ins().canPraiseByType(this.data.type)};return RankTabItemRenderer}(BaseItemRender);__reflect(RankTabItemRenderer.prototype,"RankTabItemRenderer");var RRoleAttrWin=function(_super){__extends(RRoleAttrWin,_super);function RRoleAttrWin(){var _this=_super.call(this)||this;_this._lastX=0;_this.proShowList=[1,2,3,4,5,6,7,AttributeType.atCritEnhance,8,9,10,11,12,13,14,15,16];_this.skinName="RoleAttrSkin";_this.isTopLevel=true;return _this}RRoleAttrWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};RRoleAttrWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._otherPlayerData=param[1];this.curRole=param[0];this.setRoleAttr(this.curRole);var len=this._otherPlayerData.roleData.length;if(len>1){this.addTouchEvent(this.leftBtn,this.onTouch);this.addTouchEvent(this.rightBtn,this.onTouch);this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.addTouchEndEvent(this.bg,this.onMove)}this.addTouchEndEvent(this,this.otherClose);this.addTouchEvent(this.closeBtn,this.onClose);this.addTouchEvent(this.bgClose,this.onClose)};RRoleAttrWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var len=this._otherPlayerData.roleData.length;if(len>1){this.removeTouchEvent(this.leftBtn,this.onTouch);this.removeTouchEvent(this.rightBtn,this.onTouch);this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this);this.removeTouchEvent(this.closeBtn,this.onClose);this.removeTouchEvent(this.bgClose,this.onClose)};RRoleAttrWin.prototype.onClose=function(e){ViewManager.ins().close(this)};RRoleAttrWin.prototype.otherClose=function(e){if(e.target==this.bg||e.target instanceof eui.Button)return;ViewManager.ins().close(this)};RRoleAttrWin.prototype.onMove=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=e.localX;break;case egret.TouchEvent.TOUCH_END:if(this._lastX>e.localX){if(this.curRole<2){this.curRole++;this.setRoleAttr(this.curRole);this.moveAttr(-200)}}else if(this._lastX<e.localX){if(this.curRole>0){this.curRole--;this.setRoleAttr(this.curRole);this.moveAttr(200)}}break}};RRoleAttrWin.prototype.moveAttr=function(num){var t=egret.Tween.get(this.attrGroup);var toNum;if(num>0)toNum=0;else toNum=242;t.to({x:this.attrGroup.x+num,alpha:0},200).to({x:toNum},200).to({x:80,alpha:1},200)};RRoleAttrWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.leftBtn:if(this.curRole>0){this.curRole--;this.setRoleAttr(this.curRole);this.moveAttr(200)}break;case this.rightBtn:if(this.curRole<2){this.curRole++;this.setRoleAttr(this.curRole);this.moveAttr(-200)}break}};RRoleAttrWin.prototype.setRoleAttr=function(roleId){var role=this._otherPlayerData.roleData[roleId];this.job.source="op_"+role.job;var str="";var value=0;var i=0;for(var j=0;j<this.proShowList.length;j++){i=this.proShowList[j];value=role.attributeData[i];if(i>1&&i<9){if(i==7||i==8){str+=value/100+"%"}else{str+=value}}else if(i>12&&i<15||i>15){if(i==AttributeType.atCritEnhance){value+=role.getAtt(AttributeType.atHuiXinDamage);value+=1e4}str+=value/100+"%"}else continue;if(j<this.proShowList.length-1)str+="\n"}this.attr.text=str;this.setBtn()};RRoleAttrWin.prototype.setBtn=function(){var len=this._otherPlayerData.roleData.length;if(len==1){this.leftBtn.visible=false;this.rightBtn.visible=false}else if(len>1){if(this.curRole==0){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.curRole==1){this.leftBtn.visible=true;if(len<3)this.rightBtn.visible=false;else this.rightBtn.visible=true}else if(this.curRole==2){this.leftBtn.visible=true;this.rightBtn.visible=false}}};return RRoleAttrWin}(BaseEuiView);__reflect(RRoleAttrWin.prototype,"RRoleAttrWin");ViewManager.ins().reg(RRoleAttrWin,LayerManager.UI_Popup);var RRoleInfoPanel=function(_super){__extends(RRoleInfoPanel,_super);function RRoleInfoPanel(){var _this=_super.call(this)||this;_this.curRole=0;_this.beforeIndex=-1;_this.name=i18n("RRoleInfoPanel_0");return _this}RRoleInfoPanel.prototype.childrenCreated=function(){this.init()};RRoleInfoPanel.prototype.init=function(){this.touchEnabled=false;this.touchChildren=true;this.groupRole.touchEnabled=false;this.groupRoleNext.touchEnabled=false;this.groupRole.touchChildren=false;this.groupRoleNext.touchChildren=false;this.equips=[];for(var i=0;i<EquipPos.MAX;i++){this.equips[i]=this["item"+i];this.equips[i].touchEnabled=true;this.equips[i].isShowJob(false);this.equips[i].isShowTips(false)}this.suitEff1=new MovieClip;this.suitEff1.x=this.suitImg.x;this.suitEff1.y=this.suitImg.y;this.suitEff=new MovieClip;this.suitEff5=new MovieClip;this.suitEff6=new MovieClip;this.suitEff7=new MovieClip;this.suitEff8=new MovieClip;this.suitEff9=new MovieClip;this.suitEff10=new MovieClip};RRoleInfoPanel.prototype.clear=function(){this.beforeIndex=-1};RRoleInfoPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this._otherPlayerData=param[0];this.addTouchEvent(this.roleInfoItem0,this.onClick);this.addTouchEvent(this.roleInfoItem1,this.onClick);this.updateRing();this.updataEquip(false);this.updateSamsaraEquip();this.clearChangeEff();if(this.beforeIndex!=-1){this.roleChange(this.beforeIndex,this.curRole)}else{this.setRole(this.curRole,this.bodyImg,this.weaponImg,this.bodyMc,this.weaponMc);this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2);this.setSuit(this.curRole,this.suitImg,this.suitEff1);this.setWing()}this.beforeIndex=this.curRole};RRoleInfoPanel.prototype.close=function(){egret.Tween.removeTweens(this.groupRole);egret.Tween.removeTweens(this.groupRoleNext);DisplayUtils.removeFromParent(this.suitEff);DisplayUtils.removeFromParent(this.suitEff5);DisplayUtils.removeFromParent(this.suitEff6);DisplayUtils.removeFromParent(this.suitEff7);DisplayUtils.removeFromParent(this.suitEff8);DisplayUtils.removeFromParent(this.suitEff9);DisplayUtils.removeFromParent(this.suitEff10);this.roleInfoItem0.destory();this.roleInfoItem1.destory();TimerManager.ins().remove(this.hideZhanling,this);TimerManager.ins().remove(this.playZhanLingAttack,this);TimerManager.ins().remove(this.startShowZhanling,this)};RRoleInfoPanel.prototype.clearChangeEff=function(){egret.Tween.removeTweens(this.groupRole);egret.Tween.removeTweens(this.groupRoleNext);this.groupRole.x=0;this.groupRoleNext.x=580;this.groupRole.alpha=1;this.groupRoleNext.alpha=0;this.groupRoleNext.visible=false;this.setRole(this.curRole,this.bodyImg,this.weaponImg,this.bodyMc,this.weaponMc);this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2);this.setSuit(this.curRole,this.suitImg,this.suitEff1);this.setWing(this.curRole,this.wingImg,this.wingMc)};RRoleInfoPanel.prototype.roleChange=function(beforeIndex,nextIndex){if(beforeIndex==nextIndex){this.clearChangeEff();return}this.groupRoleNext.visible=true;this.setWing(beforeIndex,this.wingImg,this.wingMc);this.setWing(nextIndex,this.nextWingImg,this.nextWingMc);this.setSuit(beforeIndex,this.suitImg,this.suitEff1);this.setRole(beforeIndex,this.bodyImg,this.weaponImg,this.bodyMc,this.weaponMc);this.setRole(nextIndex,this.nextBodyImg,this.nextWeaponImg,this.nextBodyMc,this.nextWeaponMc);this.setWeaponEffect(beforeIndex,"bodyEffect",this.bodyEff,this.suitEff7,2);this.setWeaponEffect(nextIndex,"nbodyEffect",this.nbodyEff,this.suitEff8,2);var t=egret.Tween.get(this.groupRole);var t2=egret.Tween.get(this.groupRoleNext);if(beforeIndex<nextIndex){this.groupRoleNext.x=580;t.to({x:-580,alpha:0},600);t2.to({x:0,alpha:1},600).call(this.clearChangeEff,this)}else{this.groupRoleNext.x=-580;t.to({x:580,alpha:0},600);t2.to({x:0,alpha:1},600).call(this.clearChangeEff,this)}};RRoleInfoPanel.prototype.updateRing=function(){var ringModel=this._otherPlayerData.roleData[this.curRole].exRingsData;if(ringModel[0]>0){this.roleInfoItem0.setImgSource(0,1);this.roleInfoItem0.setLv(0);this.roleInfoItem0.setNameTxt(i18n("RRoleInfoPanel_1"));this.roleInfoItem0.setBgValue("quality4")}else{this.roleInfoItem0.setImgSource(0,0);this.roleInfoItem0.setLv(0);this.roleInfoItem0.setNameTxt(i18n("RRoleInfoPanel_2"));this.roleInfoItem0.setBgValue("quality0")}if(ringModel[1]>0){this.roleInfoItem1.setImgSource(1,1);this.roleInfoItem1.setLv(0);this.roleInfoItem1.setNameTxt(i18n("RRoleInfoPanel_3"));this.roleInfoItem1.setBgValue("quality4")}else{this.roleInfoItem1.setImgSource(1,0);this.roleInfoItem1.setLv(0);this.roleInfoItem1.setNameTxt(i18n("RRoleInfoPanel_4"));this.roleInfoItem1.setBgValue("quality0")}};RRoleInfoPanel.prototype.updataEquip=function(delay){if(delay===void 0){delay=true}var model=this._otherPlayerData.roleData[this.curRole];this.setEquip(model)};RRoleInfoPanel.prototype.updateSamsaraEquip=function(){var zlv=this._otherPlayerData.zhuan;var level=this._otherPlayerData.level;var roleLv=zlv*1e3+level;var isOpen=roleLv>=GlobalConfig.ReincarnationBase.openLevel;for(var i=9;i<13;i++){this["item"+i].visible=isOpen}};RRoleInfoPanel.prototype.setEquip=function(role){if(!role)return;var len=role.getEquipLen();imageToMc(this.weaponImg,"",this.weaponMc,this._body);for(var i=0;i<len;i++){var element=role.getEquipByIndex(i);this.equips[i].setModel(role);this.equips[i].setIndex(i);this.equips[i].data=element.item;if(element.item.configID==0){this.equips[i].setItemImg(i>EquipPos.MAX?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[i]);this.equips[i].isShowTips(false)}else{this.equips[i].isShowTips(true)}if(i>=EquipPos.HAT&&i<=EquipPos.SHIELD){if(element.soulLv>0){this["item"+i].setSoul(true)}else{this["item"+i].setSoul(false)}}else if(i>=EquipPos.WEAPON&&i<=EquipPos.SHOE){var itemIcon=this["item"+i].getItemIcon();itemIcon.extreme.visible=ExtremeEquipModel.ins().getZhiZunLvByRoleID(role,i)>0}}this.powerPanel.setPower(role.power);this.setRole(this.curRole,this.bodyImg,this.weaponImg,this.bodyMc,this.weaponMc);this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)};RRoleInfoPanel.prototype.setRole=function(index,imgBody,imgWeapon,bodyMc,weaponMc){var role=this._otherPlayerData.roleData[index];var zb=role.zhuangbei;var isHaveBody;var bodyId=zb[0];var weaponId=zb[1];var weaponConf=role.getEquipByIndex(0);var weaponConfId=weaponConf.item.configID;var bodyConf=role.getEquipByIndex(2);var bodyConfId=bodyConf.item.configID;var bodyRes="";var weaponRes="";var wingRes="";if(weaponConfId>0){var fileName=GlobalConfig.EquipConfig[weaponConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}weaponRes=fileName+"_"+role.sex+"_c"}if(bodyConfId>0){var fileName=GlobalConfig.EquipConfig[bodyConfId].appearance;if(fileName&&fileName.indexOf("[job]")>-1){fileName=fileName.replace("[job]",role.job+"")}if(fileName.indexOf("903")>0){bodyRes=fileName+"_"+role.sex+"_c"}else{bodyRes=fileName+"_c"}isHaveBody=true}if(!isHaveBody){bodyRes=getDefaultBody(role.job)+"_c"}if(weaponId>0){weaponRes=getZhuangbanById(weaponId).res+"_"+role.sex+"_c"}if(bodyId>0){bodyRes=getZhuangbanById(bodyId).res+"_c"}this._body=imageToMc(imgBody,bodyRes,bodyMc);imageToMc(imgWeapon,weaponRes,weaponMc,this._body);this.setWeaponsSuit(role)};RRoleInfoPanel.prototype.setSuit=function(roleId,suitImg,suitEff){DisplayUtils.removeFromParent(suitEff);var role=this._otherPlayerData.roleData[roleId];var cfg=role.heirloom.getSuitConfig(role);if(cfg){if(!suitEff.parent)suitImg.parent.addChildAt(suitEff,suitImg.parent.getChildIndex(suitImg));var suitConfig=GlobalConfig.HeirloomEquipSetConfig[cfg.lv];suitEff.playFile(RES_DIR_EFF+suitConfig.neff,-1)}};RRoleInfoPanel.prototype.onClick=function(e){switch(e.currentTarget){case this.roleInfoItem0:ViewManager.ins().open(RSpecialRingWin,0,this.curRole,this._otherPlayerData);break;case this.roleInfoItem1:ViewManager.ins().open(RSpecialRingWin,1,this.curRole,this._otherPlayerData);break;default:break}};RRoleInfoPanel.prototype.setWing=function(index,wingImg,wingMc){if(index===void 0){index=this.curRole}if(wingImg===void 0){wingImg=this.wingImg}if(wingMc===void 0){wingMc=this.wingMc}var wingRes="";var wingdata=this._otherPlayerData.roleData[index].wingsData;var id=this._otherPlayerData.roleData[this.curRole].zhuangbei[2];if(id>0){wingRes=GlobalConfig.ZhuangBanId[id].res}else if(wingdata.openStatus){wingRes=GlobalConfig.WingLevelConfig[wingdata.lv].appearance}imageToMc(wingImg,wingRes,wingMc,this._body)};RRoleInfoPanel.prototype.setWeaponsSuit=function(role){var wid=role.weapons.weaponsId;var hideWeapons=role.hideWeapons();if(!hideWeapons&&wid){this.suitEff.x=this["sef"+role.job].x;this.suitEff.y=this["sef"+role.job].y;this.suitEff.rotation=this["sef"+role.job].rotation;if(!this.suitEff.parent)this.soulEff.addChild(this.suitEff);var suitConfig=GlobalConfig.WeaponSoulConfig[wid];this.suitEff.playFile(RES_DIR_EFF+suitConfig.inside[role.job-1],-1)}else if(this.suitEff.parent)this.suitEff.parent.removeChild(this.suitEff)};RRoleInfoPanel.prototype.setWeaponEffect=function(roleId,jobImage,soulEffGroup,suitEff,pos){if(pos===void 0){pos=0}var role=this._otherPlayerData.roleData[roleId];var id=role.getEquipByIndex(pos).item.configID;var cfg=GlobalConfig.EquipWithEffConfig[id+"_"+role.sex];DisplayUtils.removeFromParent(suitEff);var zb=role.zhuangbei;var eff=suitEff;if(eff==this.suitEff5){if(role.sex==0)DisplayUtils.removeFromParent(this.suitEff9);else eff=this.suitEff9}else if(eff==this.suitEff6){if(role.sex==0)DisplayUtils.removeFromParent(this.suitEff10);else eff=this.suitEff10}if(cfg&&(pos==0&&zb[1]<=0||pos==2&&zb[0]<=0)){eff.x=this[jobImage+role.sex].x+cfg.offX;eff.y=this[jobImage+role.sex].y+cfg.offY;eff.rotation=this[jobImage+role.sex].rotation;eff.scaleX=eff.scaleY=cfg.scaling;eff.playFile(RES_DIR_EFF+cfg.inShowEff,-1);soulEffGroup.addChild(eff)}else DisplayUtils.removeFromParent(eff)};RRoleInfoPanel.prototype.showZhanling=function(otherPlayerData){var zhanlingID=otherPlayerData.zhanlingID;var zhanlingLevel=otherPlayerData.zhanlingLevel;if(zhanlingLevel<0)return;var config=GlobalConfig.ZhanLingLevel[zhanlingID][zhanlingLevel];this.fileName=config.appearance;if(!this.warMc){this.warMc=new MovieClip;this.warMc.x=190;this.warMc.y=220;this.powerPanel.addChildAt(this.warMc,1);this.warMc.playFile(RES_DIR_MONSTER+this.fileName+"_4s",-1);this.warMc.touchEnabled=false}var anchorOffset=GlobalConfig.ZhanLingConfig.anchorOffset||[];this.warMc.anchorOffsetX=anchorOffset[0]||0;this.warMc.anchorOffsetY=anchorOffset[1]||0;TimerManager.ins().remove(this.startShowZhanling,this);TimerManager.ins().doTimer(200,1,this.playZhanLingAttack,this)};RRoleInfoPanel.prototype.playZhanLingAttack=function(){var _this=this;if(this.warMc){var s=RES_DIR_MONSTER+this.fileName+"_4"+EntityAction.ATTACK;this.warMc.playFile(s,1,function(){var src=RES_DIR_MONSTER+_this.fileName+"_4"+EntityAction.STAND;_this.warMc.playFile(src,-1,null,false);TimerManager.ins().remove(_this.playZhanLingAttack,_this);TimerManager.ins().doTimer(2800,1,_this.hideZhanling,_this)},false)}};RRoleInfoPanel.prototype.hideZhanling=function(){var _this=this;if(this.warMc){egret.Tween.get(this.warMc).to({alpha:0},GlobalConfig.ZhanLingConfig.disappearTime||1500).call(function(){_this.powerPanel.removeChild(_this.warMc);_this.warMc.destroy();_this.warMc=null;TimerManager.ins().remove(_this.hideZhanling,_this);TimerManager.ins().doTimer(7e3,1,_this.startShowZhanling,_this)})}};RRoleInfoPanel.prototype.startShowZhanling=function(){this.showZhanling(this._otherPlayerData)};return RRoleInfoPanel}(BaseView);__reflect(RRoleInfoPanel.prototype,"RRoleInfoPanel");var RRoleSelectPanel=function(_super){__extends(RRoleSelectPanel,_super);function RRoleSelectPanel(){var _this=_super.call(this)||this;_this._curRole=0;_this.skinName="RoleSelectPanelSkin";return _this}RRoleSelectPanel.prototype.childrenCreated=function(){this.roles=[this.role0,this.role1,this.role2]};RRoleSelectPanel.prototype.open=function(){this.setCurRole(0);this.addTouchEvent(this,this.onClick)};Object.defineProperty(RRoleSelectPanel.prototype,"otherPlayerData",{set:function(value){this._otherPlayerData=value;this.updateRole()},enumerable:true,configurable:true});RRoleSelectPanel.prototype.getCurRole=function(){return this._curRole};RRoleSelectPanel.prototype.setCurRole=function(value){this._curRole=value;for(var i=0;i<this.roles.length;i++){var element=this.roles[i];element.selected=i==value}this.dispatchEventWith(egret.Event.CHANGE,false,this._curRole)};RRoleSelectPanel.prototype.refreshPower=function(value){this.powerPanel.setPower(value)};RRoleSelectPanel.prototype.onClick=function(e){var index=this.roles.indexOf(e.target);if(index>-1){var roleBtn=e.target;if(this._otherPlayerData.roleData[index]){this.setCurRole(index)}else{roleBtn.selected=false}}switch(e.target){case this.juesexiangxi:ViewManager.ins().open(RRoleAttrWin,this._curRole,this._otherPlayerData);break}};RRoleSelectPanel.prototype.updateRole=function(){var role;var roleData;for(var i=0;i<this.roles.length;i++){role=this.roles[i];roleData=this._otherPlayerData.roleData[i];if(roleData){role["jobImg"].visible=true;role["jobImg"].source="job"+roleData.job+"Item";role.icon="yuanhead"+roleData.job+roleData.sex}else{role.icon="";role["jobImg"].visible=false}}};RRoleSelectPanel.prototype.close=function(){this.removeTouchEvent(this,this.onClick)};return RRoleSelectPanel}(BaseView);__reflect(RRoleSelectPanel.prototype,"RRoleSelectPanel");var RRoleWin=function(_super){__extends(RRoleWin,_super);function RRoleWin(){var _this=_super.call(this)||this;_this.skinName="RRoleWinSkin";_this.isTopLevel=true;return _this}RRoleWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.viewStack.selectedIndex=0};RRoleWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.otherPlayerData=param[0];this.roleSelect.otherPlayerData=this.otherPlayerData;this.nameTxt.text=this.otherPlayerData.name;this.roleSelect.open();this.addTouchEvent(this,this.onClick);this.addChangeEvent(this.roleSelect,this.onChange);this.observe(PeakedSys.ins().postSignUp,this.upLikeDt);this.roleSelect.setCurRole(0);this.setRoleInfo();this.upLikeDt();this.roleInfoPanel.showZhanling(this.otherPlayerData)};RRoleWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onClick);this.roleInfoPanel.clear();if(this.closeFun)this.closeFun()};RRoleWin.prototype.destoryView=function(){_super.prototype.destoryView.call(this);this.roleSelect.close();this.roleInfoPanel.close()};RRoleWin.prototype.upLikeDt=function(){if(this.likeBtn){this.likeBtn.enabled=PeakedSys.ins().kideNum<GlobalConfig.PeakRaceBase.likeCount&&PeakedRedpoint.ins().redpoint2>0}};RRoleWin.prototype.setRoleInfo=function(){var _this=this;var tempData=this.otherPlayerData.roleData[0];var server="[S"+this.otherPlayerData.serverId+"]";if(!this.otherPlayerData.serverId||this.otherPlayerData.serverId==LocationProperty.srvid)server="";this.nameTxt.text=this.otherPlayerData.name+server;egret.callLater(function(){_this.guildNameText.x=_this.nameTxt.x+_this.nameTxt.textWidth+10},this);this.guildNameText.text=this.otherPlayerData.guildName?i18n("RRoleWin_0",this.otherPlayerData.guildName):"";var strLv=this.otherPlayerData.zhuan?i18n("RRoleWin_1",this.otherPlayerData.zhuan):"";this.levelText.text=i18n("RRoleWin_2",strLv,this.otherPlayerData.level);var job=fixJob(tempData.job);var sex=fixSex(tempData.sex);this.headIcon.source="head_"+job+sex;var lv=this.otherPlayerData.lilianLv;var config=GlobalConfig.TrainLevelConfig[lv];this.jueweiIcon.source="juewei_1_"+config.type+"_png";if(this.otherPlayerData.vipLevel>0){this.viplevel.visible=true;this.viplevel.text="v";this.vipNum=BitmapNumber.ins().createNumPic(this.otherPlayerData.vipLevel,"zv0",8);this.vipNum.x=this.otherPlayerData.vipLevel>=10?0:6;this.vipGroup.addChild(this.vipNum)}else{this.viplevel.visible=false;this.nameTxt.x=112}};RRoleWin.prototype.onChange=function(e){this.setView(this.roleSelect.getCurRole())};RRoleWin.prototype.setView=function(id){if(id===void 0){id=0}this.roleInfoPanel.curRole=this.roleSelect.getCurRole();this.roleInfoPanel.open(this.otherPlayerData);var model=this.otherPlayerData.roleData[this.roleSelect.getCurRole()];this.roleSelect.refreshPower(model.power)};RRoleWin.prototype.onClick=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);var uiview2=ViewManager.ins().getView(UIView2);if(uiview2)uiview2.closeNav(UIView2.NAV_ROLE);break;case this.likeBtn:if(PeakedSys.ins().isKf()){PeakedSys.ins().sendKFToLikes(this.otherPlayerData.id)}else{PeakedSys.ins().sendToLikes(this.otherPlayerData.id)}break}};RRoleWin.prototype.hideEx=function(type){if(type===void 0){type=1}switch(type){case 1:if(this.likeBtn)this.likeBtn.visible=true;break;case 2:if(this.likeBtn)this.likeBtn.visible=false;break}};return RRoleWin}(BaseEuiView);__reflect(RRoleWin.prototype,"RRoleWin");ViewManager.ins().reg(RRoleWin,LayerManager.UI_Main);var RSpecialRingWin=function(_super){__extends(RSpecialRingWin,_super);function RSpecialRingWin(){var _this=_super.call(this)||this;_this.ringLv=0;_this.skinName="RingTips";return _this}RSpecialRingWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.iconMc=new MovieClip;this.iconMc.x=170;this.iconMc.y=160;this.gainList0.itemRenderer=RingGainItem;this.btnUse.visible=false};RSpecialRingWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.index=param[0];if(param[1]==null)param[1]=0;this._otherPlayerData=param[2];this.roleSelect.setCurRole(param[1]);if(this.iconMc&&!this.iconMc.parent)this.mcGroup.addChild(this.iconMc);this.addTouchEvent(this.colorCanvas0,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addChangeEvent(this.roleSelect,this.roleChange);this.gainList0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);var config=GlobalConfig.ExRingConfig[this.index];var gainConfig=GlobalConfig.GainItemConfig[config.costItem];this.gainList0.dataProvider=new eui.ArrayCollection(gainConfig.gainWay);this.roleChange()};RSpecialRingWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.colorCanvas0,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.roleSelect.removeEventListener(egret.Event.CHANGE,this.roleChange,this);this.gainList0.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);DisplayUtils.removeFromParent(this.iconMc);this.removeObserve()};RSpecialRingWin.prototype.onTouchList=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2],true)}};RSpecialRingWin.prototype.onTap=function(e){switch(e.currentTarget){case this.colorCanvas0:case this.bgClose:ViewManager.ins().close(this);break}};RSpecialRingWin.prototype.showIcon=function(){var effSoure=this.index?"hushen":"mabi";this.iconMc.playFile(RES_DIR_EFF+effSoure,-1)};RSpecialRingWin.prototype.roleChange=function(isUpgrade){if(isUpgrade===void 0){isUpgrade=false}var select=this.roleSelect.getCurRole();this.ringLv=this._otherPlayerData.roleData[select].getExRingsData(this.index);this.showIcon();var config=GlobalConfig.ExRingConfig[this.index];var ringConfig=GlobalConfig["ExRing"+this.index+"Config"][0];var ringNextConfig=GlobalConfig["ExRing"+this.index+"Config"][1];if(this.ringLv==0){this.currentState="lock";this.tips.source="tjweijihuo";this.labelLevel.visible=false}else{this.currentState="actived";this.tips.source="tjyijihuo";this.labelLevel.visible=true;this.labelLevel.text=this.ringLv.toString()+i18n("SpecialRingWin_0")}if(ringNextConfig){var attName="";var value=0;var i=0;var index=0;var str="";for(var j=0;j<ringNextConfig.attrAward.length;j++){i=ringNextConfig.attrAward[j].type;if(i==15||i==13)continue;attName=AttributeData.getAttrStrByType(i);value=ringNextConfig.attrAward[j].value;if(attName.length<3)attName=AttributeData.inserteBlank(attName,7);this["attr"+index].text=attName+"：";if(i>1&&i<9){if(i==7||i==8){str=value/100+"%"}else{str=value.toString()}}else if(i>12&&i<15||i>15){if(i==AttributeType.atCritEnhance)str=value/100+150+"%";else str=value/100+"%"}this["value"+index].text=str;index++}var power=UserBag.getAttrPower(ringNextConfig.attrAward);this.powerPanel.setPower(power);this.powerPanel.setMcVisible(false);this.validateNow();var itemCfg=GlobalConfig.ItemConfig[config.costItem];this.specialAttr.textFlow=TextFlowMaker.generateTextFlow1(itemCfg.desc);this.nameLabel.text=""+config.name}};return RSpecialRingWin}(BaseEuiView);__reflect(RSpecialRingWin.prototype,"RSpecialRingWin");ViewManager.ins().reg(RSpecialRingWin,LayerManager.UI_Main);var RealNameRewardMgr=function(_super){__extends(RealNameRewardMgr,_super);function RealNameRewardMgr(){var _this=_super.call(this)||this;_this.isSend=true;_this.sysId=PackageID.RealNameReward;_this.regNetMsg(1,_this.postGetResult);return _this}RealNameRewardMgr.ins=function(){return _super.ins.call(this)};RealNameRewardMgr.prototype.sendGetReward=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};RealNameRewardMgr.prototype.postGetResult=function(bytes){var error_code=bytes.readInt();var error_msg=bytes.readString();console.log("RealNameRewardMgr postGetResult error_msg :"+error_msg)};RealNameRewardMgr.prototype.sendGetRewardReq=function(){if(this.isSend){this.isSend=false;this.sendGetReward()}};RealNameRewardMgr.prototype.checkChannel=function(){};return RealNameRewardMgr}(BaseSystem);__reflect(RealNameRewardMgr.prototype,"RealNameRewardMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.realNameRewardMgr=RealNameRewardMgr.ins.bind(RealNameRewardMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var Base64=function(){function Base64(){}Base64.encode=function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=this._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4)}return output};Base64.decode=function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}}output=this._utf8_decode(output);return output};Base64._utf8_encode=function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext};Base64._utf8_decode=function(utftext){var string="";var i=0;var c=0;var c1=0;var c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=utftext.charCodeAt(i+1);var c3=utftext.charCodeAt(i+2);string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return string};Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return Base64}();__reflect(Base64.prototype,"Base64");var H5PayIFrameManager=function(_super){__extends(H5PayIFrameManager,_super);function H5PayIFrameManager(){var _this=_super.call(this)||this;_this.checkUrlTimerKey=-1;return _this}H5PayIFrameManager.prototype.popIFrame=function(url,w,h,x,y,needCloseBtn,cleft,ctop,cwidth,cheight){if(w===void 0){w="100%"}if(h===void 0){h="80%"}if(x===void 0){x="0%"}if(y===void 0){y="10%"}if(needCloseBtn===void 0){needCloseBtn=true}if(cleft===void 0){cleft="88%"}if(ctop===void 0){ctop="13%"}if(cwidth===void 0){cwidth="7%"}if(cheight===void 0){cheight="0%"}var self=this;var bg=document.createElement("div");bg.id="H5PayIFrameBg";bg.style.backgroundColor="Black";bg.style.display="block";bg.style.zIndex="3";bg.style.position="absolute";bg.style.left="0%";bg.style.top="0%";bg.style.width="100%";bg.style.height="100%";bg.style.filter="Alpha(Opacity=30)";bg.style.opacity="0.4";document.body.appendChild(bg);var iframe=document.createElement("iframe");iframe.width=w;iframe.height=h;iframe.id="H5PayIFrame";iframe.name="H5PayIFrame";iframe.style.position="absolute";iframe.style.zIndex="4";iframe.style.left=x;iframe.style.top=y;iframe.frameBorder="no";iframe.marginHeight="0";iframe.marginWidth="0";iframe.setAttribute("allowTransparency","true");document.body.appendChild(iframe);iframe.src=url;var closeBtn=document.createElement("img");closeBtn.id="H5PayIFrameCloseBtn";closeBtn.style.zIndex="5";closeBtn.style.position="absolute";closeBtn.style.left=cleft;closeBtn.style.top=ctop;var s=RES_RESOURCE+"skins/recharge/close.png";s=RES.$getVirtualUrl(s);closeBtn.src=s;closeBtn.style.width=cwidth;closeBtn.style.height=cheight;if(needCloseBtn){document.body.appendChild(closeBtn)}closeBtn.onclick=function(){self.onPayEnd()};function checkReturnUrl(){var iframeUrl=null;try{iframeUrl=iframe.contentWindow.location.href}catch(e){}if(iframeUrl!=null&&iframeUrl.indexOf("_return.html")>=0){self.onPayEnd()}else{self.checkUrlTimerKey=egret.setTimeout(checkReturnUrl,null,500)}}self.checkUrlTimerKey=egret.setTimeout(checkReturnUrl,null,500);var closePay=function(){iframe.parentNode.removeChild(iframe);bg.parentNode.removeChild(bg);if(needCloseBtn){closeBtn.parentNode.removeChild(closeBtn)}self.closePay=null;egret.clearTimeout(self.checkUrlTimerKey)};self.closePay=closePay;bg.onclick=function(){self.onPayEnd()}};H5PayIFrameManager.prototype.onPayEnd=function(){var self=this;if(self.closePay){self.closePay()}};H5PayIFrameManager.ins=function(){if(this.s_instance==null){this.s_instance=new H5PayIFrameManager}return this.s_instance};H5PayIFrameManager.EVENT_RECHARGE_FINISHED="EVENT_RECHARGE_FINISHED";return H5PayIFrameManager}(egret.EventDispatcher);__reflect(H5PayIFrameManager.prototype,"H5PayIFrameManager");var Recharge=function(_super){__extends(Recharge,_super);function Recharge(){var _this=_super.call(this)||this;_this._rechargeData=[];_this.showCdTime=true;_this._cdTime=0;_this.flag=0;_this.forevetCard=0;_this.dailyDealInfo=[[1,1,0],[2,1,0],[3,1,0],[4,1,0],[5,1,0]];_this.open=true;_this.recharge_type=0;_this.plat="dev";_this.payMethod=0;_this.product_id=0;_this.product_param=0;_this.order_id="";_this.franchiseflag=0;_this.franchiseget=0;_this.firstBuy=0;_this.sysId=PackageID.Recharge;_this.regNetMsg(1,_this.postRecharge1Data);_this.regNetMsg(2,_this.changeRecharge1Data);_this.regNetMsg(6,_this.getRecharge2Data);_this.regNetMsg(7,_this.changeRecharge2Data);_this.regNetMsg(8,_this.postUpDataItem);_this.regNetMsg(9,_this.postRechargeTotalDay);_this.regNetMsg(20,_this.postGetMonthDay);_this.regNetMsg(11,_this.postFranchiseInfo);_this.regNetMsg(12,_this.postMuchDayRecReward);_this.regNetMsg(13,_this.onGetPayMethodList);_this.regNetMsg(14,_this.onGetPayString);_this.regNetMsg(15,_this.onRechargeCmd_NotifySucc);_this.regNetMsg(16,_this.onsRechargeCmd_QueryPayStatus);_this.regNetMsg(17,_this.postDailyDealsInfo);_this.regNetMsg(18,_this.postDailyDealsAwards);_this.regNetMsg(21,_this.postMonthCardExpired);return _this}Recharge.ins=function(){return _super.ins.call(this)};Recharge.prototype.getRechargeData=function(index){if(index===void 0){index=-1}return index==-1?this._rechargeData:this._rechargeData[index]||new RechargeData};Recharge.prototype.getCurRechargeConfig=function(){var rch=this.getRechargeData(0);var len=CommonUtils.getObjectLength(GlobalConfig.DailyRechargeConfig);if(rch.day<=len){return GlobalConfig.DailyRechargeConfig[rch.day]}else{var loopDay=rch.day-len;len=CommonUtils.getObjectLength(GlobalConfig.LoopRechargeConfig);loopDay=loopDay%len||len;return GlobalConfig.LoopRechargeConfig[loopDay]}};Recharge.prototype.getCurDailyRechargeIsAllGet=function(){var data=Recharge.ins().getRechargeData(0);var config=Recharge.ins().getCurRechargeConfig();var len=CommonUtils.getObjectLength(config);for(var i=0;i<len;i++){var boo2=data.isAwards>>i&1?true:false;if(!boo2)return false}return true};Recharge.prototype.sendGetAwards=function(type,id){var bytes=this.getBytes(type==0?2:7);bytes.writeShort(id);this.sendToServer(bytes)};Recharge.prototype.postRecharge1Data=function(bytes){this.recharge(bytes,0)};Recharge.prototype.changeRecharge1Data=function(day){if(day===void 0){day=1}var bytes=this.getBytes(2);bytes.writeShort(day);this.sendToServer(bytes)};Recharge.prototype.postUpdateRechargeEx=function(param){return{type:param}};Recharge.prototype.postUpdateRecharge=function(param){return param};Recharge.prototype.getDayReward=function(index){var bytes=this.getBytes(3);bytes.writeShort(index);this.sendToServer(bytes)};Recharge.prototype.getRecharge2Data=function(bytes){};Recharge.prototype.changeRecharge2Data=function(bytes){var data=this.getRechargeData(1);if(data){data.change(bytes);Recharge.ins().postUpdateRecharge(1)}};Recharge.prototype.getRechargeTotalAward=function(index){var bytes=this.getBytes(8);bytes.writeShort(index);this.sendToServer(bytes)};Recharge.prototype.recharge=function(bytes,type){if(!this._rechargeData[type])this._rechargeData[type]=new RechargeData;this._rechargeData[type].parser(bytes,type);if(type==0){var boo2=Recharge.ins().getCurDailyRechargeIsAllGet();if(boo2)ViewManager.ins().close(Recharge2Win)}Recharge.ins().postUpdateRechargeEx(type);this.recharge_type=type};Recharge.prototype.postUpDataItem=function(bytes){this.costList=bytes.readInt();if(this.showCdTime){this.cdTime=bytes.readInt()}};Recharge.prototype.postRechargeTotalDay=function(bytes){this.rechargeTotal={};this.rechargeTotal.hasGetDays=[];var len=bytes.readShort();for(var i=0;i<len;i++){this.rechargeTotal.hasGetDays.push(bytes.readShort())}this.rechargeTotal.totalDay=bytes.readShort()};Recharge.prototype.postGetMonthDay=function(bytes){var leftTime=bytes.readUnsignedInt();if(leftTime>0){this.monthDay=leftTime}else{this.monthDay=0}if(leftTime>0)this.flag=2;this.forevetCard=bytes.readInt();if(!Setting.ins().getValue(ClientSet.firstMonthCard)&&(this.monthDay>0||this.getIsForeve()))Setting.ins().setValue(ClientSet.firstMonthCard,1)};Recharge.prototype.getOrderByIndex=function(index){if(index===void 0){index=0}var num=this.costList>>index&1;return num};Object.defineProperty(Recharge.prototype,"monthDay",{get:function(){return this._monthDay},set:function(value){if(this._monthDay!=value){this._monthDay=value;TimerManager.ins().remove(this.downTime,this);if(this._monthDay>0){TimerManager.ins().doTimer(1e3,this._monthDay,this.downTime,this)}}},enumerable:true,configurable:true});Recharge.prototype.downTime=function(){this._monthDay-=1};Recharge.prototype.getAddBagGrid=function(){return this.monthDay>0?100:0};Recharge.prototype.getAddBagFranchiseGrid=function(){return this.franchise>0?100:0};Recharge.prototype.getPlatformIDCallback=function(plat){this.plat=plat;if(Recharge._gpidcb){Recharge._gpidcb(Recharge.platIds[plat])}};Recharge.prototype.getPlatformID=function(cb){var self=this;if(JsNativeCallMgr.hasMethod("getPlatformID")){JsNativeCallMgr.callMethod("getPlatformID",function(flag_plat){var plat=flag_plat;var platId=Recharge.platIds[plat];self.plat=plat;cb(platId)});return}else{var pid=ChannelMgr.ins().platID;if(pid){this.plat=Recharge.idToPlat[pid];cb(pid);return}}if(ChannelMgr.ins().isQuickH5SDKChannel()||ChannelMgr.ins().isZiXiaChannel()||ChannelMgr.ins().is511WanChannel()||ChannelMgr.ins().isYouTuoBangChannel()||ChannelMgr.ins().isFKYLCChannel()||ChannelMgr.ins().isAWYCChannel()||ChannelMgr.ins().isQQSmallGameChannel()||ChannelMgr.ins().isWXSmallGameChannel()){this.plat="h5";cb(null);return}else if(ChannelMgr.ins().isYaoShengChannel()){this.plat="as";var platId=Recharge.platIds[this.plat];console.log("as");cb(platId);return}else if(egret.Capabilities.isMobile==true){var pid=ChannelMgr.ins().platID;if(pid==""||!pid){this.plat="h5";var platId=Recharge.platIds[this.plat];cb(platId);return}else{this.plat=Recharge.idToPlat[pid];cb(pid);return}}var self=this;if(!Recharge.getPlatformIDInited){Recharge.getPlatformIDInited=true;egret.ExternalInterface.addCallback("getPlatformIDCallback",function(plat){self.getPlatformIDCallback(plat)})}Recharge._gpidcb=cb;egret.ExternalInterface.call("getPlatformID","");if(ChannelMgr.ins().isHuanYouChannel2()||ChannelMgr.ins().isHuanYouChannel()||ChannelMgr.ins().isQuickAppSDKChannel()||ChannelMgr.ins().isChuDongChannel()||ChannelMgr.ins().isMiJuChannel()||ChannelMgr.ins().isChongChongChannel()||ChannelMgr.ins().isMeiShengYuanChannel()||ChannelMgr.ins().isGuoPanChannel()||ChannelMgr.ins().isYouXiFanChannel()||ChannelMgr.ins().isXianTuChannel()||ChannelMgr.ins().isYiYouChannel()||ChannelMgr.ins().isDiMaiChannel()||ChannelMgr.ins().isJuHeAppChannel()||ChannelMgr.ins().isQQZoneChannel()||ChannelMgr.ins().isQQDaTingChannel()){platId=ChannelMgr.ins().platID;this.plat=Recharge.idToPlat[platId.toString()]||"dev";cb(platId);return}};Recharge.prototype.initAsPay=function(){var self=this;var getPlatformID_cb=function(platId){if(platId===void 0){platId=0}if(platId==Recharge.platIds["as"]&&!Recharge.asPayInited){self.getPayMethodList(platId,1)}ChannelMgr.ins().channelSDKInit()};this.getPlatformID(getPlatformID_cb)};Recharge.prototype.getAWYProductID=function(){var id=this.product_id;var cfg=GlobalConfig.RechargeItemsConfig[id];return cfg.channel_20118_itemId_h5};Recharge.prototype.dealWithSpecialProductID=function(product_id){var isAs=false;if(Recharge.ins().plat=="as"){isAs=true}else if(ChannelMgr.ins().isMeiShengYuanChannel()&&ChannelMgr.ins().platID=="103"){isAs=true}if(isAs){if(product_id==1e3){product_id=2e3}else if(product_id==1001){product_id=2001}else if(product_id==1003){product_id=2002}else if(product_id==1004){product_id=2003}else if(product_id==1005){product_id=2004}}if(ChannelMgr.ins().isAnQiGeChannel()){if(product_id==1003){product_id=1013}else if(product_id==1004){product_id=1014}else if(product_id==1005){product_id=1015}}return product_id};Recharge.prototype.showReCharge=function(product_id,param){if(param===void 0){param=0}var self=this;if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("Recharge_28"));return}product_id=this.dealWithSpecialProductID(product_id);if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.FIRSTCHARGE));return}this.product_id=product_id;this.product_param=param;var getPlatformID_cb=function(platId){if(platId===void 0){platId=0}self.getPayMethodList(platId,product_id)};if(!Recharge.payCallBackInited){Recharge.payCallBackInited=true;window["payCallbackFunc"]=self.payCallBack}this.getPlatformID(getPlatformID_cb)};Recharge.prototype.getIsForeve=function(){return Recharge.ins().forevetCard==2};Recharge.prototype.getPayMethodList=function(platID,product_id){if(platID===void 0){platID=0}if(product_id===void 0){product_id=0}var bytes=this.getBytes(13);if(ChannelMgr.ins().isThirdChannelPay()){platID=Number(ChannelMgr.ins().main_channel)}if(ChannelMgr.ins().isSelfChannelPay()){platID=Number(ChannelMgr.ins().main_channel)}bytes.writeInt(platID);bytes.writeInt(product_id);this.sendToServer(bytes)};Recharge.prototype.onGetPayMethodList=function(bytes){var self=this;var payment_mothod_list=[];var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code!=0){WarnWin.show(i18n("Recharge_2")+error_msg,function(){},this);return}var len=bytes.readInt();for(var i=0;i<len;i++){payment_mothod_list.push(bytes.readInt())}if(self.plat=="as"){var a=[];var idLen=bytes.readInt();for(var j=0;j<idLen;j++){a.push(bytes.readString())}if(!Recharge.asPayInited){var as_product_id=JSON.stringify({as_product_id:a});Recharge.asPayInited=true;if(ChannelMgr.ins().isYaoShengChannel()){window["getAsPayCallbackFunc"]=function(str){self.asPayCallBack(str)};if(JsNativeCallMgr.hasMethod("initPay")){JsNativeCallMgr.callMethod("initPay",function(){},as_product_id)}else{alert("Js2JavaInterface = null")}return}egret.ExternalInterface.addCallback("getAsPayCallback",function(str){self.asPayCallBack(str)});egret.ExternalInterface.call("initPay",as_product_id);return}}if(payment_mothod_list.length<1){WarnWin.show(i18n("Recharge_3"),function(){},this);return}var chosenCallBack=function(payMethod){if(payMethod===void 0){payMethod=0}if(payMethod==Recharge.payMethod["zfb"]||payMethod==Recharge.payMethod["wx"]){self.payMethod=payMethod;self.getPayString(Recharge.platIds[self.plat],self.product_id,self.payMethod)}};if(payment_mothod_list.length>1){ViewManager.ins().open(ChoosePayMethod,[self.product_id,chosenCallBack])}else{this.payMethod=payment_mothod_list[0];this.getPayString(Recharge.platIds[this.plat],this.product_id,this.payMethod)}};Recharge.prototype.getPayString=function(plat_id,product_id,payment_mothod){if(plat_id===void 0){plat_id=101}if(product_id===void 0){product_id=0}if(payment_mothod===void 0){payment_mothod=0}var bytes=this.getBytes(14);if(ChannelMgr.ins().isThirdChannelPay()){plat_id=Number(ChannelMgr.ins().main_channel)}if(ChannelMgr.ins().isSelfChannelPay()){plat_id=Number(ChannelMgr.ins().main_channel)}bytes.writeInt(plat_id);bytes.writeInt(product_id);bytes.writeInt(payment_mothod);var client_ip=Recharge.client_ip||"";bytes.writeString(client_ip);var extern_args=ChannelMgr.ins().extern_args;if(ChannelMgr.ins().isChuDongChannel()&&extern_args){var extern_args_obj=JSON.parse(extern_args);var zoneid=extern_args_obj["zoneid"];var id=this.getChuDongItemID(product_id,zoneid);extern_args_obj["itemid"]=id;extern_args=JSON.stringify(extern_args_obj)}var extern_args_obj=JSON.parse(extern_args);extern_args_obj["product_param"]=this.product_param;extern_args=JSON.stringify(extern_args_obj);bytes.writeString(extern_args);var subchannel=Number(ChannelMgr.ins().sub_channel);bytes.writeInt(subchannel);var ios=DeviceUtils.IsPC?0:egret.Capabilities.os=="iOS"?1:0;bytes.writeShort(ios);this.sendToServer(bytes)};Recharge.prototype.getChuDongItemID=function(product_id,zoneid){if(zoneid===void 0){zoneid=1}var itemid="";var dataList=GlobalConfig.RechargeItemsConfig;var data=dataList[this.product_id];if(!data){return itemid}if(zoneid==1){itemid=data.channel_10018_itemId_and}else{itemid=data.channel_10018_itemId_ios}return itemid};Recharge.prototype.getChuDongItemPrice=function(product_id,itemid){if(itemid===void 0){itemid=0}var xingBi=1;if(itemid==52035||itemid==52036){return xingBi}var dataList=GlobalConfig.RechargeItemsConfig;var data=dataList[this.product_id];if(!data){return xingBi}xingBi=data.cash*10;return xingBi};Recharge.prototype.getChuDongAppID=function(){var appid="";var extern_args=ChannelMgr.ins().extern_args;if(ChannelMgr.ins().isChuDongChannel()&&extern_args){var extern_args_obj=JSON.parse(extern_args);appid=extern_args_obj["appid"]}return appid};Recharge.prototype.onGetPayString=function(bytes){var self=this;var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code!=0){if(ChannelMgr.ins().isChuDongChannel()){window["popPayTips"]({version:"v2",defaultScore:self.getChuDongItemPrice(self.product_id,error_code),appid:self.getChuDongAppID()});return}else{console.log(i18n("Recharge_4")+error_msg);WarnWin.show(error_msg,function(){},this);return}}var product_id=bytes.readInt();var payment_method=bytes.readInt();var pay_string=bytes.readString();if(ChannelMgr.ins().isQuickAppSDKChannel()||this.plat=="as"||ChannelMgr.ins().isQuickH5SDKChannel()||ChannelMgr.ins().isMiJuChannel()||ChannelMgr.ins().isChongChongChannel()||ChannelMgr.ins().isGuoPanChannel()||ChannelMgr.ins().isZiXiaChannel()||ChannelMgr.ins().is1758Channel()||ChannelMgr.ins().isMeiShengYuanChannel()||ChannelMgr.ins().isYouXiFanChannel()||ChannelMgr.ins().isXianTuChannel()||ChannelMgr.ins().is511WanChannel()||ChannelMgr.ins().isYiYouChannel()||ChannelMgr.ins().isYouTuoBangChannel()||ChannelMgr.ins().isJuHeAppChannel()||ChannelMgr.ins().isFKYLCChannel()||ChannelMgr.ins().isAWYCChannel()||ChannelMgr.ins().isQQSmallGameChannel()||ChannelMgr.ins().isWXSmallGameChannel()||ChannelMgr.ins().isDouYuChannel()||ChannelMgr.ins().is52ggChannel()||ChannelMgr.ins().isTongChengChannel()||ChannelMgr.ins().isAnQiGeChannel()||ChannelMgr.ins().isDuoYouChannel()){this.order_id=JSON.parse(pay_string)["mypayment_order_id"].toString()||"0";this.pay(this.plat,payment_method,product_id,pay_string)}else if(ChannelMgr.ins().isHuanYouChannel()||ChannelMgr.ins().isHuanYouChannel2()){this.pay(this.plat,payment_method,product_id,pay_string)}else if(ChannelMgr.ins().isXianKunQiYuan()){var payment_string=JSON.parse(pay_string)["payment_string"].toString()||"";H5PayIFrameManager.ins().popIFrame(payment_string)}else{this.pay(this.plat,payment_method,product_id,pay_string)}};Recharge.prototype.noPay=function(str){if(str===void 0){str=i18n("Recharge_5")}alert(str);ViewManager.ins().close(WarnWin)};Recharge.prototype.pay=function(plat,payment_method,product_id,payString){if(plat===void 0){plat="dev"}if(payment_method===void 0){payment_method=1}if(product_id===void 0){product_id=0}if(plat=="dev"){this.noPay();return}else if(ChannelMgr.ins().isQuickAppSDKChannel()){if(JsNativeCallMgr.hasMethod("channelPay")){var config=GlobalConfig.RechargeItemsConfig[product_id];var productName=config?config.product_name:"";var order_id=this.order_id;var amount=JSON.parse(payString)["amount"].toString()||"0.01";var count=1;console.log("【"+ChannelMgr.ins().main_channel+"】 Js2JavaInterface.channelPay:{product_id:"+product_id+" productName:"+productName+" order_id:"+order_id+" count:"+count+" amount:"+amount+" extra:"+payString+"} ");JsNativeCallMgr.callMethod("channelPay",function(){},product_id,productName,order_id,count,amount,payString);return}else{this.noPay();return}}else if(ChannelMgr.ins().isJuHeAppChannel()){if(JsNativeCallMgr.hasMethod("channelPay")){var config=GlobalConfig.RechargeItemsConfig[product_id];var productName=config?config.product_name:"";var order_id=this.order_id;var amount=JSON.parse(payString)["amount"].toString()||"0.01";var count=1;console.log("【"+ChannelMgr.ins().main_channel+"】 Js2JavaInterface.channelPay:{product_id:"+product_id+" productName:"+productName+" order_id:"+order_id+" count:"+count+" amount:"+amount+" extra:"+payString+"} ");JsNativeCallMgr.callMethod("channelPay",function(){},product_id,productName,order_id,count,amount,payString);return}else{this.noPay();return}}else if(ChannelMgr.ins().isMiJuChannel()){if(JsNativeCallMgr.hasMethod("channelPay")){var amount=JSON.parse(payString)["amount"].toString()||"0.01";var serverid=LocationProperty.srvid;var servername=LocationProperty.srvName;var extendsinfo=payString;var role_id=Actor.actorID;var role_name=Actor.myName;var config=GlobalConfig.RechargeItemsConfig[product_id];var productName=config?config.product_name:"";console.log("Js2JavaInterface.channelPay:{amount:"+amount+" serverid:"+serverid+" servername:"+servername+" extendsinfo:"+extendsinfo+" role_id:"+role_id+" role_name:"+role_name+" productName:"+productName+"} ");JsNativeCallMgr.callMethod("channelPay",function(){},amount,serverid,servername,extendsinfo,role_id,role_name,productName);return}else{alert("Js2JavaInterface.channelPay = null");this.noPay();return}}else if(ChannelMgr.ins().isGuoPanChannel()){var isApp=false;if(JsNativeCallMgr.hasMethod("channelPay")){isApp=true}if(isApp){var amount=JSON.parse(payString)["amount"].toString()||"0.01";var serverid=LocationProperty.srvid;var servername=LocationProperty.srvName;var reserved=payString;var config=GlobalConfig.RechargeItemsConfig[product_id];var productName=config?config.product_name:"";var paymentDes=productName;console.log(i18n("Recharge_6")+this.order_id+" itemID:"+product_id+" itemName:"+productName+" itemPrice:"+amount+" itemCount:"+1+" reserved:"+reserved+" paymentDes:"+productName+"} ");JsNativeCallMgr.callMethod("channelPay",function(){},this.order_id,product_id,productName,amount,"1",reserved,paymentDes);return}else{var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var amount=JSON.parse(payString)["amount"].toString()||"0.01";var time=JSON.parse(payString)["time"].toString()||"";var sign=JSON.parse(payString)["sign"].toString()||"";var guoPanPayUrl="http://h5.guopan.cn/api/sdk_pay.php";guoPanPayUrl+="?guopanAppId="+obj["appid"];guoPanPayUrl+="&serialNumber="+this.order_id;guoPanPayUrl+="&game_uin="+obj["uid"];guoPanPayUrl+="&gameUrl=http://h5.guopan.cn/web/game.php?appid="+obj["appid"];guoPanPayUrl+="&time="+time;guoPanPayUrl+="&ext="+payString;guoPanPayUrl+="&money="+amount;guoPanPayUrl+="&sign="+sign;console.log(i18n("Recharge_7")+guoPanPayUrl);top.location.href=guoPanPayUrl}}else if(ChannelMgr.ins().isMeiShengYuanChannel()){if(ChannelMgr.ins().platID=="102"){if(JsNativeCallMgr.hasMethod("channelPay")){var gameName=ChannelMgr.ins().channelSDKParams["MeiShengYuan"].andGameName;var config=GlobalConfig.RechargeItemsConfig[product_id];var productName=config?config.product_name:"";var productDescription=productName;var amount=JSON.parse(payString)["amount"].toString()||"0.01";var gameMonney=config?config.amount:"1";console.log(i18n("Recharge_8")+productName+" count:"+1+" productDescription:"+productDescription+" ext:"+payString+" gameOrderId:"+this.order_id+" amount:"+amount+" rate:"+1+" gameMonney:"+gameMonney+" product_id:"+product_id+"} ");JsNativeCallMgr.callMethod("channelPay",function(){},productName,"1",productDescription,payString,this.order_id,amount,"1",gameMonney,product_id);return}else{alert("Js2JavaInterface.channelPay = null");this.noPay();return}}else if(ChannelMgr.ins().platID=="103"){if(JsNativeCallMgr.hasMethod("channelPay")){var config=GlobalConfig.RechargeItemsConfig[product_id];var productID=config.channel_10028_itemId_ios;var gameName=ChannelMgr.ins().channelSDKParams["MeiShengYuan"].iosGameName;var goodsTitle=config?config.product_name:"";var productDescription=goodsTitle;var price=config?config.cash:"1";var userinfo=payString;var roleinfo=JSON.stringify({level:Actor.level,vipLevel:UserVip.ins().lv,roleID:Actor.actorID,roleName:Actor.myName});console.log(i18n("Recharge_9")+productID+" gameName:"+gameName+" goodsTitle:"+goodsTitle+" productDescription:"+productDescription+" price:"+price+" orderid:"+this.order_id+" userinfo(pay_string):"+userinfo+" roleinfo:"+roleinfo+"} ");JsNativeCallMgr.callMethod("channelPay",function(){},productID,gameName,goodsTitle,"1",productDescription,price,this.order_id,userinfo,roleinfo);return}else{alert("Js2JavaInterface.channelPay = null");this.noPay();return}}else if(ChannelMgr.ins().platID=="105"){if(!Gmsy){ChannelMgr.ins().channelSDKInit();return}var amount=JSON.parse(payString)["amount"].toString()||"0.01";var sign=JSON.parse(payString)["sign"].toString()||"";var config=GlobalConfig.RechargeItemsConfig[product_id];var productName=config?config.product_name:"";var serverid=LocationProperty.srvid;var servername=LocationProperty.srvName;var data={orderid:this.order_id,money:amount,product:product_id,productid:productName,roleid:Actor.actorID,serverid:serverid,servername:servername,sign:sign};console.log(i18n("Recharge_10")+data+")");Gmsy.pay(data);return}}else if(ChannelMgr.ins().isChongChongChannel()){if(JsNativeCallMgr.hasMethod("memoryUsage")){var orderId=this.order_id;var config=GlobalConfig.RechargeItemsConfig[product_id];var productName=config?config.product_name:"";var currentMoney=JSON.parse(payString)["amount"].toString()||"0.01";var playUserInfo=JSON.stringify(ChannelMgr.ins().getChongChongUserInfo());var serverid=LocationProperty.srvid;var servername=LocationProperty.srvName;var ext=payString;var role_id=Actor.actorID;var role_name=Actor.myName;console.log(i18n("Recharge_11")+orderId+" productId:"+""+" productName:"+productName+" currentMoney:"+currentMoney+" ext:"+ext+" playUserInfo:"+playUserInfo+"} ");JsNativeCallMgr.callMethod("memoryUsage",function(){},orderId,"",productName,currentMoney,ext,playUserInfo);return}else{alert("Js2JavaInterface.channelPay = null");this.noPay();return}}else if(ChannelMgr.ins().isYouXiFanChannel()){if(JsNativeCallMgr.hasMethod("channelPay")){var zoneId=1;var zoneName=LocationProperty.srvName;var roleId=Actor.actorID;var roleName=Actor.myName;var roleLevel=Actor.level;var serverId=LocationProperty.srvid;var roleVIP=UserVip.ins().lv;var money=JSON.parse(payString)["amount"].toString()||"0.01";var cpOrderId=this.order_id;var extInfo=payString;var notifyUrl=JSON.parse(payString)["notifyUrl"].toString()||"";var productCount=1;var config=GlobalConfig.RechargeItemsConfig[product_id];var ProductName=config?config.product_name:"";var sign=JSON.parse(payString)["sign"].toString()||"0.01";console.log(i18n("Recharge_12")+zoneId+" zoneName:"+zoneName+" roleId:"+roleId+" roleName:"+roleName+" roleLevel:"+roleLevel+" serverId:"+serverId+" roleVIP:"+roleVIP+" money:"+money+" cpOrderId:"+cpOrderId+" extInfo:"+extInfo+" notifyUrl:"+notifyUrl+" productId:"+product_id+" productCount:"+productCount+" ProductName:"+ProductName+" sign:"+sign+"} ");JsNativeCallMgr.callMethod("channelPay",function(){},zoneId,zoneName,roleId,roleName,roleLevel,serverId,roleVIP,money,cpOrderId,extInfo,notifyUrl,product_id,productCount,ProductName,sign);return}else{alert("Js2JavaInterface.channelPay = null");this.noPay();return}}else if(ChannelMgr.ins().isXianTuChannel()){if(JsNativeCallMgr.hasMethod("channelPay")){var config=GlobalConfig.RechargeItemsConfig[product_id];var ProductName=config?config.product_name:"";var ProductDes=ProductName;var amount=JSON.parse(payString)["amount"].toString()||"0.01";var extInfo=this.order_id;var serverId=LocationProperty.srvid;var serverName=LocationProperty.srvName;var roleId=Actor.actorID;var roleName=Actor.myName;console.log(i18n("Recharge_13")+ProductName+" ProductDes:"+ProductDes+" amount:"+amount+" extInfo:"+extInfo+" serverId:"+serverId+" serverName:"+serverName+" roleId:"+roleId+" roleName:"+roleName+"} ");JsNativeCallMgr.callMethod("channelPay",function(){},ProductName,ProductDes,amount,extInfo,serverId,serverName,roleId,roleName);return}else{alert("Js2JavaInterface.channelPay = null");this.noPay();return}}else if(ChannelMgr.ins().isYiYouChannel()){if(JsNativeCallMgr.hasMethod("channelPay")){var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var userId=obj["userId"];var accessToken=obj["accessToken"];var amount=JSON.parse(payString)["amount"].toString()||"0.01";var itemid=this.order_id;var config=GlobalConfig.RechargeItemsConfig[product_id];var itemname=config?config.product_name:"";var itemdesc=itemname;console.log(i18n("Recharge_14")+userId+" accessToken:"+accessToken+" amount:"+amount+" itemid:"+itemid+" itemname:"+itemname+" itemdesc:"+itemdesc+"} ");JsNativeCallMgr.callMethod("channelPay",function(){},userId,accessToken,amount,itemid,itemname,itemdesc);return}else{alert("Js2JavaInterface.channelPay = null");this.noPay();return}}else if(ChannelMgr.ins().isZiXiaChannel()){var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var amount=JSON.parse(payString)["amount"].toString()||"0.01";var time=JSON.parse(payString)["time"].toString();var sign=JSON.parse(payString)["sign"].toString();var ziXiaPayUrl="https://game.zixia.com/pay";ziXiaPayUrl+="?gkey="+obj["gkey"];ziXiaPayUrl+="&skey="+obj["skey"];ziXiaPayUrl+="&platfrom="+obj["platfrom"];ziXiaPayUrl+="&order_id="+this.order_id;ziXiaPayUrl+="&uid="+obj["uid"];ziXiaPayUrl+="&money="+amount;ziXiaPayUrl+="&time="+time;ziXiaPayUrl+="&sign="+sign;ziXiaPayUrl+="&role_name="+Actor.myName;ziXiaPayUrl+="&role_id="+Actor.actorID;ziXiaPayUrl+="&ext="+payString;console.log(i18n("Recharge_15")+ziXiaPayUrl);H5PayIFrameManager.ins().popIFrame(ziXiaPayUrl,"100%","100%","0%","0%",false)}else if(ChannelMgr.ins().isFKYLCChannel()){var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var order_id=JSON.parse(payString)["order_id"].toString()||"";var app_id=JSON.parse(payString)["app_id"].toString();var timestamp=JSON.parse(payString)["timestamp"].toString();var nonce_str=JSON.parse(payString)["nonce_str"].toString();var pk=JSON.parse(payString)["package"].toString();var sign_type=JSON.parse(payString)["sign_type"].toString();var pay_sign=JSON.parse(payString)["pay_sign"].toString();var sdk=window["HORTOR_AGENT"];if(!sdk){console.log("channel 20117 sdk = null before pay");return}sdk.pay({order_id:order_id,app_id:app_id,timestamp:timestamp,nonce_str:nonce_str,package:pk,sign_type:sign_type,pay_sign:pay_sign})}else if(ChannelMgr.ins().isAWYCChannel()){var sdk=window["AWY_SDK"];if(!sdk){console.log("channel 20118 sdk = null before pay");return}var pid=this.getAWYProductID();var self_16=this;console.log("channel 20118 sdk.pay: id:"+this.product_id+" pid:"+pid);sdk.pay({pid:pid,txid:self_16.order_id,userdata:"",product_count:1})}else if(ChannelMgr.ins().isQQSmallGameChannel1()){var config=GlobalConfig.RechargeItemsConfig[product_id];var goods_count=1;var goods_des=config?config.desc:"";var goods_identifier=config.channel_20120_product_id?config.channel_20120_product_id:product_id;var goods_name=config?config.desc:"";var pay_amount=JSON.parse(payString)["amount"]||1;var redirect_uri=JSON.parse(payString)["redirect_uri"].toString();var extra_info=JSON.parse(payString)["extra_info"].toString();var order_sn=this.order_id;var role_id=Actor.actorID;var role_name=Actor.myName;var server_id=JSON.parse(payString)["server_id"].toString();var server_name=SelectServerMgr.ins().getServerNameByID(server_id);var param_1={goods_count:goods_count,goods_des:goods_des,goods_identifier:goods_identifier,goods_name:goods_name,pay_amount:pay_amount,redirect_uri:redirect_uri,extra_info:extra_info,order_sn:order_sn,role_id:role_id,role_name:role_name,server_id:server_id,server_name:server_name};var callback=function(res){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.submitOrder callback:");console.log(res)};dyb.submitOrder(param_1,callback);console.log("channel "+ChannelMgr.ins().main_channel+" dyb.submitOrder: param="+JSON.stringify(param_1))}else if(ChannelMgr.ins().isQQSmallGameChannel2()){var config=GlobalConfig.RechargeItemsConfig[product_id];var goods_count=1;var goods_des=config?config.desc:"";var goods_identifier=config.channel_20127_product_id?config.channel_20127_product_id:product_id;var goods_name=config?config.desc:"";var pay_amount=JSON.parse(payString)["amount"]||1;var redirect_uri=JSON.parse(payString)["redirect_uri"].toString();var extra_info=JSON.parse(payString)["extra_info"].toString();var order_sn=this.order_id;var role_id=Actor.actorID;var role_name=Actor.myName;var server_id=JSON.parse(payString)["server_id"].toString();var server_name=SelectServerMgr.ins().getServerNameByID(server_id);var param_2={goods_count:goods_count,goods_des:goods_des,goods_identifier:goods_identifier,goods_name:goods_name,pay_amount:pay_amount,redirect_uri:redirect_uri,extra_info:extra_info,order_sn:order_sn,role_id:role_id,role_name:role_name,server_id:server_id,server_name:server_name};var callback=function(res){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.submitOrder callback:");console.log(res)};dyb.submitOrder(param_2,callback);console.log("channel "+ChannelMgr.ins().main_channel+" dyb.submitOrder: param="+JSON.stringify(param_2))}else if(ChannelMgr.ins().isWXSmallGameChannel()){var config=GlobalConfig.RechargeItemsConfig[product_id];var productName=config?config.desc:"";var productId=product_id;var productPrice=JSON.parse(payString)["amount"]||1;var cpOrderId=this.order_id;var extendsParam1=this.order_id;var extendsParam2=this.order_id;var roleId=Actor.actorID;var roleName=Actor.myName;var roleLevel=Actor.level;var serverId=JSON.parse(payString)["server_id"].toString();var serverName=SelectServerMgr.ins().getServerNameByID(serverId);var roleVip=UserVip.ins().lv;var param_3={productName:productName,productId:productId,productPrice:productPrice,cpOrderId:cpOrderId,extendsParam1:extendsParam1,extendsParam2:extendsParam2,roleId:roleId,roleName:roleName,roleLevel:roleLevel,serverId:serverId,serverName:serverName,roleVip:roleVip};qingjs.instance.purchase(param_3,function(result){console.log("channel "+ChannelMgr.ins().main_channel+" qingjs.instance.purchase result:"+JSON.stringify(result))});console.log("channel "+ChannelMgr.ins().main_channel+" qingjs.instance.purchase: param="+JSON.stringify(param_3))}else if(ChannelMgr.ins().isYouTuoBangChannel()){var amount=JSON.parse(payString)["amount"].toString()||"1";var config=GlobalConfig.RechargeItemsConfig[product_id];var productNo=config?config.channel_10036_itemId_h5:product_id;var orderName=config?config.product_name:"";var opt={productNo:productNo,amount:amount,orderName:orderName,userId:window["YTB_DATA"].uid,orderId:this.order_id,returnurl:"http://lytj.lkgame.com/index.html?channel=10036_1",payCallback:function(type){if(type=="PAY_WAY_OK"){console.log("10036 PAY_WAY_OK")}}};YDPAY.showPayPopup(opt);console.log("YDPAY.showPayPopup:");console.log(opt)}else if(ChannelMgr.ins().is511WanChannel()){var game_id=ChannelMgr.ins().channelSDKParams["511Wan"].game_id;var amount=JSON.parse(payString)["amount"].toString()||"0.01";var config=GlobalConfig.RechargeItemsConfig[product_id];var goods=config?config.product_name:"";var gold=1;var gameOrderId=this.order_id;var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var time=JSON.parse(payString)["time"].toString();var sign=JSON.parse(payString)["sign"].toString();var payUrl="http://h5.511wan.com/pay.jsp";payUrl+="?game_id="+game_id;payUrl+="&amount="+amount;payUrl+="&goods="+goods;payUrl+="&gold="+gold;payUrl+="&gameOrderId="+gameOrderId;payUrl+="&time="+time;payUrl+="&sign="+sign;payUrl+="&uid="+obj["uid"];console.log(i18n("Recharge_16")+payUrl);top.location.href=payUrl}else if(ChannelMgr.ins().is1758Channel()){var paySafeCode=JSON.parse(payString)["paySafeCode"].toString();console.log(i18n("Recharge_17")+paySafeCode);var payData={paySafecode:paySafeCode,callback:function(data){console.log(data)}};window["HLMY_SDK"].pay(payData)}else if(plat=="and"||plat=="ent"){if(JsNativeCallMgr.hasMethod("pay")){if(payment_method==2){payString=Base64.decode(payString);console.log("app支付宝下单 Base64.decode后："+payString)}else{console.log("app支付微信下单："+payString)}JsNativeCallMgr.callMethod("pay",function(){},payment_method,payString);return}else{this.noPay();return}}else if(plat=="as"){if(ChannelMgr.ins().isYaoShengChannel()){if(JsNativeCallMgr.hasMethod("pay")){JsNativeCallMgr.callMethod("pay",function(){},payString);return}else{alert("Js2JavaInterface.pay = null");return}}else{egret.ExternalInterface.call("pay",payString)}return}else if(ChannelMgr.ins().isHuanYouChannel()||ChannelMgr.ins().isHuanYouChannel2()){if(typeof HySDK!="undefined"){if(HySDK.pay){payString=this.dealWithHuanYouURL(payString);console.log(i18n("Recharge_18")+payString);HySDK.payUrl=payString;HySDK.pay();return}else{return}}else{return}}else if(ChannelMgr.ins().isQuickH5SDKChannel()){var amount=JSON.parse(payString)["amount"].toString()||"0.01";this.dealWithQuickH5Pay(amount,payString);return}else if(ChannelMgr.ins().isDiMaiChannel()){var extern_args=ChannelMgr.ins().extern_args;var args_obj=JSON.parse(extern_args);var tm=JSON.parse(payString)["tm"].toString()||"";var pid=JSON.parse(payString)["pid"].toString()||"";var gid=JSON.parse(payString)["gid"].toString()||"";var mid=JSON.parse(payString)["mid"].toString()||"";var access_token=JSON.parse(payString)["access_token"].toString()||"";var role_id=JSON.parse(payString)["role_id"].toString()||"";var role_name=JSON.parse(payString)["role_name"].toString()||"";var role_level=JSON.parse(payString)["role_level"].toString()||"";var amount=JSON.parse(payString)["amt"].toString()||"0";var sign=JSON.parse(payString)["sign"].toString()||"";var productName=JSON.parse(payString)["goods_name"].toString()||"";var serverid=JSON.parse(payString)["server_id"].toString()||"";var servername=JSON.parse(payString)["server_name"].toString()||"";var gameext=JSON.parse(payString)["game_ext"].toString()||"";var order_id=JSON.parse(payString)["game_order_no"].toString()||"";var paydata={tm:tm,pid:pid,gid:gid,mid:mid,access_token:access_token,role_id:role_id,role_name:role_name,role_level:role_level,server_id:serverid,server_name:servername,amt:amount,goods_name:productName,game_order_no:order_id,game_ext:gameext,sign:sign};console.log("我的迪麦渠道SDK："+paydata+")");glSdk.pay(paydata);return}else if(ChannelMgr.ins().isAnQiGeChannel()){var Cp_orderid=this.order_id;var dataList=GlobalConfig.RechargeItemsConfig;var data_10=dataList[this.product_id];var Sku=data_10.channel_20121_product_id;var UPrice=JSON.parse(payString)["amount"].toString()||"";var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var param={Ugameid:obj["Ugameid"],Uid:obj["Uid"],Serverid:LocationProperty.srvid,Roleid:Actor.actorID,Method:"createPay",Time:GameServer.serverTime/1e3,Cp_orderid:Cp_orderid,Sku:Sku,UPrice:UPrice};window.parent.postMessage(param,"*")}else if(ChannelMgr.ins().isDouYuChannel()){var cpOrderId=this.order_id;var uid=JSON.parse(payString)["uid"].toString()||"";var game_id=JSON.parse(payString)["game_id"].toString()||"";var sid=JSON.parse(payString)["sid"].toString()||"";var role_name=JSON.parse(payString)["role_name"].toString()||"";var subject=JSON.parse(payString)["subject"].toString()||"";var cp_order_id=JSON.parse(payString)["cp_order_id"].toString()||"0";var money=JSON.parse(payString)["money"].toString()||"0.01";var time=JSON.parse(payString)["time"].toString()||"0";var sign=JSON.parse(payString)["sign"].toString()||"0";var param_4={uid:uid,game_id:game_id,sid:sid,role_name:role_name,subject:subject,cp_order_id:cp_order_id,money:money,time:time,sign:sign};sqsdk=window["SQ_SDK"];sqsdk.pay(param_4)}else if(ChannelMgr.ins().isDuoYouChannel()){var extern_args=ChannelMgr.ins().extern_args;var obj=JSON.parse(extern_args);var amount=JSON.parse(payString)["amount"].toString()||"0.01";var app_id=JSON.parse(payString)["app_id"].toString()||"";var user_id=JSON.parse(payString)["user_id"].toString()||"";var zone_id=JSON.parse(payString)["zone_id"].toString()||"";var zone_name=JSON.parse(payString)["zone_name"].toString()||"";var role_id=JSON.parse(payString)["role_id"].toString()||"";var role_name=JSON.parse(payString)["role_name"].toString()||"";var game_order_id=JSON.parse(payString)["game_order_id"].toString()||"";var order_amount=JSON.parse(payString)["order_amount"].toString()||"";var prop_id=JSON.parse(payString)["prop_id"].toString()||"";var prop_name=JSON.parse(payString)["prop_name"].toString()||"";var extra=JSON.parse(payString)["extra"].toString()||"";var config=GlobalConfig.RechargeItemsConfig[product_id];var props_name=config?config.product_name:"";var sign=JSON.parse(payString)["sign"].toString()||"";var data_11={app_id:app_id,user_id:user_id,zone_id:zone_id,zone_name:zone_name,role_id:role_id,role_name:role_name,game_order_id:game_order_id,order_amount:order_amount,prop_id:prop_id,prop_name:prop_name,extra:extra,sign:sign};console.log("====52dy_jh_sdk Pay:",data_11);dy_jh_sdk.h5paySdk(data_11,function(result){console.log("====dy Pay result:",result)})}else if(ChannelMgr.ins().is52ggChannel()){var trade_no=this.order_id;var extern_args_1=ChannelMgr.ins().extern_args;var obj_3=JSON.parse(extern_args_1);var game_appid=JSON.parse(payString)["game_appid"].toString()||"";var user_id=JSON.parse(payString)["user_id"].toString()||"";var sign=JSON.parse(payString)["sign"].toString()||"";var sdklogindomain=obj_3["sdklogindomain"];var sdkloginmodel=obj_3["sdkloginmodel"];var channelExt=JSON.parse(payString)["channelExt"].toString()||"";var config=GlobalConfig.RechargeItemsConfig[product_id];var props_name=config?config.product_name:"";var amount=JSON.parse(payString)["amount"].toString()||"0.01";var paySrc="http://"+sdklogindomain+"/"+sdkloginmodel+"/Game/paysdk";paySrc+="?game_appid="+game_appid;paySrc+="&user_id="+user_id;paySrc+="&trade_no="+trade_no;paySrc+="&props_name="+props_name;paySrc+="&channelExt="+channelExt;paySrc+="&amount="+amount;paySrc+="&sign="+sign;console.log("====52ggchannelPay:",paySrc);window["52ggchannelPay"](paySrc)}else if(ChannelMgr.ins().isTongChengChannel()){var extern_args_2=ChannelMgr.ins().extern_args;var obj_4=JSON.parse(extern_args_2);var config=GlobalConfig.RechargeItemsConfig[product_id];var props_name=config?config.product_name:"";var Price=JSON.parse(payString)["Price"].toString()||"0.01";var OutOrderInfo=JSON.parse(payString)["OutOrderInfo"].toString()||"";var OutOrderInfoSign=JSON.parse(payString)["OutOrderInfoSign"].toString()||"";console.log("====tongchengyouchannelPay:",extern_args_2);TCYSDK.start("TCYSDK_PAY",{ProductSubject:props_name,Price:Price,ProductBody:props_name,OutOrderInfo:OutOrderInfo,OutOrderInfoSign:OutOrderInfoSign})}else if(ChannelMgr.ins().isQQZoneChannel()){var paramStr=JSON.parse(payString)["url_params"].toString()||"";console.log("我的QQ空间渠道SDK："+paramStr+")");fusion2.dialog.buy({param:paramStr,sandbox:false,onSuccess:function(opt){},onClose:function(opt){}})}else if(ChannelMgr.ins().isQQDaTingChannel()){var extern_args=ChannelMgr.ins().extern_args;var args_obj=JSON.parse(extern_args);var appid=args_obj["appid"];var itemurl=JSON.parse(payString)["url_params"].toString()||"";console.log("我的QQ大厅渠道SDK："+itemurl+")");var issandbox=1;GameAPI=window["GameAPI"];if(typeof GameAPI!="undefined"){GameAPI.BuyBox.show(appid,itemurl,issandbox,"充值",function(){console.log("QQ大厅充值退出")},function(){console.log("QQ大厅充值成功")})}else{console.log("GameAPI undefined")}}};Recharge.prototype.dealWithHuanYouURL=function(url){var a=url.split("?");var p1=a[0];var username=GetUrlParam("username",url);var gid=GetUrlParam("gid",url);var pid=GetUrlParam("pid",url);var sid=GetUrlParam("sid",url);var money=GetUrlParam("money",url);var goodsid=GetUrlParam("goodsid",url);var cporderid=GetUrlParam("cporderid",url);var roleid=GetUrlParam("roleid",url);var param=GetUrlParam("param",url);var attach=GetUrlParam("attach",url);var sign=GetUrlParam("sign",url);param=encodeURI(param);attach=encodeURI(attach);var newURL=p1+"?username="+username+"&gid="+gid+"&pid="+pid+"&sid="+sid+"&money="+money+"&goodsid="+goodsid+"&cporderid="+cporderid+"&roleid="+roleid+"&param="+param+"&attach="+attach+"&sign="+sign;return newURL};Recharge.prototype.dealWithQuickH5Pay=function(amount,extrasParams){var extern_args=ChannelMgr.ins().extern_args;if(ChannelMgr.ins().isQuickH5SDKChannel()&&extern_args){var obj=JSON.parse(extern_args);var cfg=GlobalConfig.RechargeItemsConfig;var data=cfg[this.product_id];var orderInfo={productCode:ChannelMgr.ins().getProductCode(),uid:obj.uid,username:obj.username,userRoleId:Actor.actorID,userRoleName:Actor.myName,serverId:LocationProperty.srvid,userServer:LocationProperty.srvName,userLevel:Actor.level,cpOrderNo:this.order_id,amount:amount,subject:data&&data.product_name||"",desc:data&&data.desc||"",callbackUrl:"",extrasParams:encodeURI(extrasParams),goodsId:this.product_id,count:1,quantifier:1};var orderInfoJson=JSON.stringify(orderInfo);QuickSDK.pay(orderInfoJson,function(payStatusObject){console.log("QuickSDK["+ChannelMgr.ins().main_channel+i18n("Recharge_19")+JSON.stringify(payStatusObject))})}};Recharge.prototype.onRechargeCmd_NotifySucc=function(bytes){var order_id=bytes.readString();var yuanbao=bytes.readInt();var productId=bytes.readInt();var method=bytes.readInt();this.onRechargeResult(order_id,yuanbao,productId,method)};Recharge.prototype.reqRechargeResult=function(order_id,receipt_data){if(order_id===void 0){order_id="0"}var bytes=this.getBytes(16);bytes.writeString(order_id);bytes.writeString(receipt_data);this.sendToServer(bytes)};Recharge.prototype.onsRechargeCmd_QueryPayStatus=function(bytes){var error_code=bytes.readInt();var error_msg=bytes.readString();if(Recharge.ins().plat=="as"){var res="success";if(error_code!=0){res="failed"}egret.ExternalInterface.call("checkReceiptCallback",res)}if(error_code!=0){WarnWin.show(i18n("Recharge_20")+error_msg,function(){},this);return}var order_id=bytes.readString();var yuanbao=bytes.readInt();this.onRechargeResult(order_id,yuanbao,0,0)};Recharge.prototype.onRechargeResult=function(order_id,yuanbao,productId,method){if(order_id===void 0){order_id=""}if(yuanbao===void 0){yuanbao=0}this.order_id="";WarnWin.show(i18n("Recharge_21"),function(){},this,undefined,undefined,"sure");Actor.ins().postYbChange(yuanbao);if(ChannelMgr.ins().isDouYinChannel()||ChannelMgr.ins().isTencGDTChannel()){var config=GlobalConfig.RechargeItemsConfig[productId];var productName=config?config.product_name:"";var cash=config?config.cash:"0";ChannelMgr.ins().channelReport(6,productName,productName,productId,1,method,"¥",true,cash)}if(ChannelMgr.ins().isHuanYouChannel()||ChannelMgr.ins().isHuanYouChannel2()){if(typeof HySDK!="undefined"){if(HySDK.closePay){HySDK.closePay()}else{}}else{}return}if(ChannelMgr.ins().isXianKunQiYuan()){H5PayIFrameManager.ins().onPayEnd()}if(ChannelMgr.ins().isGuoPanChannel()){H5PayIFrameManager.ins().onPayEnd()}if(ChannelMgr.ins().isZiXiaChannel()){H5PayIFrameManager.ins().onPayEnd()}};Recharge.prototype.asPayCallBack=function(str){var decode_str=Base64.decode(str);if(!ChannelMgr.ins().isYaoShengChannel()){egret.ExternalInterface.call("LOG","Base64 ~~~~ "+decode_str)}if(str.length>0){this.payCallBack(0,decode_str)}else{this.payCallBack(1,decode_str)}};Recharge.prototype.payCallBack=function(isSucceeded,receipt_data){if(receipt_data===void 0){receipt_data=""}var self=this;if(isSucceeded==0){if(Recharge.ins().plat=="as"){self.reqRechargeResult(this.order_id,receipt_data)}else{}}else{console.log(i18n("Recharge_23"))}};Recharge.prototype.sendGetFranchise=function(){this.sendBaseProto(10)};Recharge.prototype.postFranchiseInfo=function(bytes){var leftTime=bytes.readUnsignedInt();if(leftTime>0){this.franchise=leftTime}else{this.franchise=0}this.franchiseget=bytes.readByte();this.firstBuy=bytes.readByte();UserBag.auto_smelt=bytes.readInt()};Object.defineProperty(Recharge.prototype,"cdTime",{get:function(){return this._cdTime},set:function(value){if(this._cdTime!=value){this._cdTime=value;TimerManager.ins().remove(this.fCDTime,this);if(this._cdTime>0){TimerManager.ins().doTimer(1e3,this._cdTime,this.fCDTime,this)}}},enumerable:true,configurable:true});Object.defineProperty(Recharge.prototype,"franchise",{get:function(){return this._franchise},set:function(value){if(this._franchise!=value){this._franchise=value;TimerManager.ins().remove(this.franchiseTime,this);if(this._franchise>0){TimerManager.ins().doTimer(1e3,this._franchise,this.franchiseTime,this)}}},enumerable:true,configurable:true});Recharge.prototype.franchiseTime=function(){this._franchise-=1};Recharge.prototype.fCDTime=function(){this._cdTime-=1};Recharge.prototype.getRechargeList=function(){var configs=GlobalConfig.RechargeDaysAwardsConfig;var list=[];var rechargeMap={};var rechargeMapSum={};for(var i in configs){if(!rechargeMap[configs[i].sum])rechargeMap[configs[i].sum]=[];if(!rechargeMapSum[configs[i].sum])rechargeMapSum[configs[i].sum]=0;if(Recharge.ins().rechargeTotal.hasGetDays.indexOf(configs[i].id)>=0){rechargeMapSum[configs[i].sum]++}rechargeMap[configs[i].sum].push(configs[i])}for(var i in rechargeMapSum){if(list.length)break;if(rechargeMapSum[i]>=CommonUtils.getObjectLength(rechargeMap[i])){continue}for(var j in rechargeMap[i]){list.push(rechargeMap[i][j])}}return list};Recharge.prototype.sendMuchDayRecReward=function(){this.sendBaseProto(11)};Recharge.prototype.postMuchDayRecReward=function(bytes){this.mRecNum=bytes.readInt();this.mReward=bytes.readByte();this.mDayNum=bytes.readShort()};Recharge.prototype.tryShowChargeFirstWin=function(){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("Recharge_28"));return}var rdata=Recharge.ins().getRechargeData(0);if(!rdata||rdata&&rdata.num==0){ViewManager.ins().open(Recharge1Win)}else{ViewManager.ins().open(ChargeFirstWin)}};Recharge.prototype.postDailyDealsInfo=function(bytes){var c=bytes.readInt();for(var i=0;i<c;i++){var id=bytes.readInt();var status_5=bytes.readInt();var left_days=bytes.readInt();this.dailyDealInfo[i]=[id,status_5,left_days]}};Recharge.prototype.sendGetDailyDealsAwards=function(id){var bytes=this.getBytes(18);bytes.writeInt(id);this.sendToServer(bytes)};Recharge.prototype.postDailyDealsAwards=function(bytes){var error_code=bytes.readInt();var id=bytes.readInt();var status=bytes.readInt();var left_days=bytes.readInt();var index=-1;for(var i=0;i<this.dailyDealInfo.length;i++){var v=this.dailyDealInfo[i];if(v[0]==id){index=i;break}}if(index>-1){this.dailyDealInfo[index]=[id,status,left_days]}};Recharge.prototype.postMonthCardExpired=function(bytes){var isPrivilegeCard=bytes.readShort();PlayFunView.addMonthCardExpiredTip(isPrivilegeCard)};Recharge.prototype.getDailyDealsStatus=function(id){if(id==5){var got=true;for(var i=1;i<4;i++){var v=this.dailyDealInfo[i];if(v[1]==dailyDealState.get){return dailyDealState.get}if(v[1]!=dailyDealState.done){return dailyDealState.buy}}return dailyDealState.done}var status=2;for(var i=0;i<this.dailyDealInfo.length;i++){var v=this.dailyDealInfo[i];if(v[0]==id){status=v[1];break}}return status};Recharge.prototype.getDailyDealsLeftDay=function(){var day=0;for(var i=1;i<this.dailyDealInfo.length-1;i++){var v=this.dailyDealInfo[i];if(day==0){day=v[2]}else{if(v[2]<day){day=v[2]}}}return day};Recharge.prototype.getRechargeID=function(id){if(id===void 0){id=1}var cfg=GlobalConfig.DailyRecharge4Config[id];if(!cfg){return-1}return cfg.rechargeId};Recharge.prototype.getDailyDealRedpoint=function(){var count=0;for(var _i=0,_a=this.dailyDealInfo;_i<_a.length;_i++){var v=_a[_i];var id=v[0];var status_6=this.getDailyDealsStatus(id);if(status_6==dailyDealState.get){count++}}return count};Recharge.prototype.postChangeRecharge=function(open){if(open===void 0){open=true}this.open=open;var view=ViewManager.ins().getView(PlayFunView);if(view){view.checkShowVip()}if(open){ShoppingGift.ins().control(1)}else{ShoppingGift.ins().control(0);if(view){view.setDieGuide(DieGuide.RECHARGE)}}DieGuide.ins().checkCDTimeShow()};Recharge.payMethod={dev:0,ios:1,zfb:2,wx:3,h5:4,channel:5};Recharge.client_ip="";Recharge.getPlatformIDInited=false;Recharge.asPayInited=false;Recharge.payCallBackInited=false;Recharge.huanyouPayInited=false;Recharge.chudongPayInited=false;Recharge.meishengyuanPayInited=false;Recharge.youtuobangPayInited=false;Recharge.platIds={dev:101,and:102,ent:103,as:104,h5:105,channel:106};Recharge.idToPlat={101:"dev",102:"and",103:"ent",104:"as",105:"h5",106:"channel"};return Recharge}(BaseSystem);__reflect(Recharge.prototype,"Recharge");var RechargeData=function(){function RechargeData(){this.firstRewardInfo=[0,0,0]}RechargeData.prototype.parser=function(bytes,type){this.day=bytes.readShort()+1;this.curDayPay=bytes.readInt();this.num=bytes.readInt();this.isAwards=bytes.readInt();this.firstRechargeTime=bytes.readInt();for(var i=0;i<3;i++){this.firstRewardInfo[i]=bytes.readShort()}};RechargeData.prototype.change=function(bytes){this.num=bytes.readInt();this.isAwards=bytes.readInt()};return RechargeData}();__reflect(RechargeData.prototype,"RechargeData");var dailyDealState;(function(dailyDealState){dailyDealState[dailyDealState["get"]=0]="get";dailyDealState[dailyDealState["done"]=1]="done";dailyDealState[dailyDealState["buy"]=2]="buy"})(dailyDealState||(dailyDealState={}));window["dailyDealState"]=dailyDealState;var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.recharge=Recharge.ins.bind(Recharge)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var RechargeRewardData=function(){function RechargeRewardData(){}return RechargeRewardData}();__reflect(RechargeRewardData.prototype,"RechargeRewardData");var ActivityFirstRechargeWin=function(_super){__extends(ActivityFirstRechargeWin,_super);function ActivityFirstRechargeWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.isPlayOpenSound=true;return _this}ActivityFirstRechargeWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ActivityFirstRechargeSkin";this.list.itemRenderer=ItemBase;this.btnArr=[];for(var i=0;i<4;i++){this.btnArr.push(this["chong"+i])}this.eff=new MovieClip;this.eff.touchEnabled=false;Recharge.ins().initAsPay()};ActivityFirstRechargeWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return ActivityFirstRechargeIconRule.checkShow()};ActivityFirstRechargeWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.actData=param[0];this.actCfg=GlobalConfig.ActivityType26Config[this.actData.id]["1"];this.actBtnCfg=Activity.ins().getbtnInfo(this.actData.id.toString());this.addTouchEvent(this.bg,this.closeCB);this.addTouchEvent(this.closeBtn,this.closeCB);for(var i_17=0;i_17<this.btnArr.length;i_17++){this.addTouchEvent(this.btnArr[i_17],this.onTouch)}var i=0;var list=this.getDataList();for(var k in list){var frc=list[k];var paydesc=frc.paydesc.replace(i18n("Recharge1Win_3"),"");this.btnArr[i]["rmb"].text=paydesc;this.btnArr[i]["yuanbao"].text=frc.pay;this.btnArr[i]["money"]=frc.pay;this.btnArr[i]["id"]=frc.id;this.btnArr[i]["give"].text="+"+(frc.payReturn-frc.pay);this.btnArr[i]["rec"].visible=i==3?true:false;this.btnArr[i]["nt"].visible=false;this.btnArr[i]["rmbGroup"].visible=true;if(ChannelMgr.ins().isAnQiGeChannel()){this.btnArr[i]["rmbGroup"].visible=false;this.btnArr[i]["nt"].visible=true;this.btnArr[i]["nt"].text=frc.paydesc}var mc=new MovieClip;mc.x=this.btnArr[i]["aniGroup"].width/2;mc.y=this.btnArr[i]["aniGroup"].height/2;mc.touchEnabled=this.btnArr[i]["aniGroup"].touchEnabled=false;mc.playFile(RES_DIR_EFF+"scantx1_eff",-1);this.btnArr[i]["aniGroup"].addChild(mc);i++}this.setWinData();this.showFirstChargeReward()};ActivityFirstRechargeWin.prototype.showFirstChargeReward=function(){var cfg=this.actCfg;if(!cfg){return}var mc=new MovieClip;mc.playFile(cfg.aniRes,-1);mc.x=cfg.aniX;mc.y=cfg.aniY;this.mcGroup.addChild(mc);this.list.dataProvider=new ArrayCollection(cfg.reward);this.zi0.source=cfg.zi0;this.zi1.source=cfg.zi1;this.zi2.source=cfg.zi2;this.zi3.source=cfg.zi3;this.zi4.source=cfg.zi4;this.zi5.source=cfg.zi5;var beganTime=Math.floor((DateUtils.formatMiniDateTime(this.actData.startTime)-GameServer.serverTime)/1e3);var endedTime=Math.floor((DateUtils.formatMiniDateTime(this.actData.endTime)-GameServer.serverTime)/1e3);if(beganTime>=0){this.labelTime.text=i18n("ActivityFirstRechargeWin_1")}else if(endedTime<=0){this.labelTime.text=i18n("ActivityFirstRechargeWin_2")}else{this.labelTime.text=DateUtils.getFormatBySecond(endedTime,DateUtils.TIME_FORMAT_5,3)}this.bgImg.source=cfg.bg};ActivityFirstRechargeWin.prototype.getDataList=function(){var dataList=GlobalConfig.FirstRechargeConfig;var list_gen=[];var list_as=[];for(var str in dataList){var v=dataList[str];var as_plat=Recharge.platIds["as"];if(v.plats.indexOf(as_plat)!=-1){list_as.push(v)}else{if(ChannelMgr.ins().isAnQiGeChannel()){if(v.plats.indexOf(20121)!=-1){list_gen.push(v)}}else{if(v.plats.indexOf(20121)==-1){list_gen.push(v)}}}}if(ChannelMgr.ins().isWXSmallGameChannel()){list_gen=list_as}if(Recharge.ins().plat=="as"){return list_as}else if(ChannelMgr.ins().isMeiShengYuanChannel()&&ChannelMgr.ins().platID=="103"){return list_as}else if(ChannelMgr.ins().isYaoShengChannel()){return list_as}else{return list_gen}};ActivityFirstRechargeWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}DisplayUtils.removeFromParent(this.eff);egret.Tween.removeTweens(this)};ActivityFirstRechargeWin.prototype.closeCB=function(e){ViewManager.ins().close(this);TimerManager.ins().removeAll(this)};ActivityFirstRechargeWin.prototype.onTouch=function(e){var num=0;switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;default:for(var i=0;i<4;i++){if(e.currentTarget==this.btnArr[i]){var id=this.btnArr[i]["id"];for(var i_18 in GlobalConfig.RechargeItemsConfig){if(id==GlobalConfig.RechargeItemsConfig[i_18].id){Recharge.ins().showReCharge(GlobalConfig.RechargeItemsConfig[i_18].id);break}}break}}break}};ActivityFirstRechargeWin.prototype.setWinData=function(){this._data=Recharge.ins().getRechargeData(0);DisplayUtils.removeFromParent(this.eff);this.tips.visible=true;this.updateRedPoint()};ActivityFirstRechargeWin.prototype.updateRedPoint=function(){this.redPoint0.visible=(this._data.firstRewardInfo[0]||0)==1?true:false;this.redPoint1.visible=(this._data.firstRewardInfo[1]||0)==1?true:false;this.redPoint2.visible=(this._data.firstRewardInfo[2]||0)==1?true:false};return ActivityFirstRechargeWin}(BaseEuiView);__reflect(ActivityFirstRechargeWin.prototype,"ActivityFirstRechargeWin");ViewManager.ins().reg(ActivityFirstRechargeWin,LayerManager.UI_Popup);var ChargeFirstWin=function(_super){__extends(ChargeFirstWin,_super);function ChargeFirstWin(){var _this=_super.call(this)||this;_this.barbc=new ProgressBarEff;_this.skinName="ChargeSkin";_this.isTopLevel=true;return _this}ChargeFirstWin.prototype.sort=function(a,b){var c1=a.cash;var c2=b.cash;if(c1>c2)return 1;else if(c1<c2)return-1;else return 0};ChargeFirstWin.prototype.getDataList=function(){var dataList=GlobalConfig.RechargeItemsConfig;var list_gen=[];var list_as=[];for(var str in dataList){var v=dataList[str];var as_plat=Recharge.platIds["as"];if(v.plats.indexOf(as_plat)!=-1){if(v.cash<=648&&v.cash!=1&&list_as.length<6){list_as.push(v)}var t=347126400;if(v.cash==188&&window["isIOS_AppStore"]==true&&GameServer._serverZeroTime<t){list_as.push(v)}}else if(v.id<20){list_gen.push(v)}}if(ChannelMgr.ins().isAnQiGeChannel()){list_gen=[];for(var str in dataList){var v=dataList[str];if(v.plats.indexOf(20121)!=-1&&v.id<1e3){list_gen.push(v)}}}if(ChannelMgr.ins().isWXSmallGameChannel()){list_gen=list_as}list_as.sort(this.sort);if(Recharge.ins().plat=="as"){return list_as}else if(ChannelMgr.ins().isMeiShengYuanChannel()&&ChannelMgr.ins().platID=="103"){return list_as}else if(ChannelMgr.ins().isYaoShengChannel()){return list_as}else{return list_gen}};ChargeFirstWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.list.itemRenderer=ChargeItemRenderer;this.scrollBar.viewport=this.list;var dataArr=this.getDataList();this.list.dataProvider=new eui.ArrayCollection(dataArr);this.barbc.setWidth(340);this.barbc.x=80;this.barbc.y=12;this.topGroup.addChild(this.barbc);this.vipValue=BitmapNumber.ins().createNumPic(0,"vip_v",5);this.vipValue.x=36;this.vipValue.y=10;this.vipGroup.addChild(this.vipValue);Recharge.ins().initAsPay()};ChargeFirstWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.vipBtn,this.onTap);this.observe(Recharge.ins().postUpDataItem,this.refushInfo);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this);this.barbc.reset();this.setView()};ChargeFirstWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.vipBtn,this.onTap);this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this);this.removeObserve()};ChargeFirstWin.prototype.onListTap=function(e){var data=e.item;Recharge.ins().showReCharge(data.id)};ChargeFirstWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(ChargeFirstWin);break;case this.vipBtn:ViewManager.ins().close(ChargeFirstWin);ViewManager.ins().open(VipWin);break}};ChargeFirstWin.prototype.refushInfo=function(){var dataPro=this.list.dataProvider;for(var i=0;i<dataPro.length;i++){var data=dataPro.getItemAt(i);dataPro.itemUpdated(data)}this.setView()};ChargeFirstWin.prototype.setView=function(){var curLv=UserVip.ins().lv;var nextConfig=GlobalConfig.VipConfig[curLv+1];var nextNeedYb=0;var ybValue=0;var str="";var curNeedYb=UserVip.ins().exp;if(nextConfig){nextNeedYb=nextConfig.needYb-curNeedYb;var needYb=nextNeedYb-ybValue;str=i18n("ChargeFirstWin_0",nextNeedYb,curLv+1);this.barbc.setData(curNeedYb,nextConfig.needYb)}else{str=i18n("ChargeFirstWin_1");this.barbc.max()}BitmapNumber.ins().changeNum(this.vipValue,curLv,"vip_v",3);if(curLv<10){this.vipValue.x=36}else{this.vipValue.x=26}this.tipsText.textFlow=TextFlowMaker.generateTextFlow(str)};ChargeFirstWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.FIRSTCHARGE));return false}if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("VipWin_13"));return false}return true};return ChargeFirstWin}(BaseEuiView);__reflect(ChargeFirstWin.prototype,"ChargeFirstWin");ViewManager.ins().reg(ChargeFirstWin,LayerManager.UI_Popup);var ChargeItemRenderer=function(_super){__extends(ChargeItemRenderer,_super);function ChargeItemRenderer(){var _this=_super.call(this)||this;_this.skinName="ChargeItemSkin";return _this}ChargeItemRenderer.prototype.dataChanged=function(){this.refreshInfo()};ChargeItemRenderer.prototype.refreshInfo=function(){this.gain1.text=this.data.amount;this.yuanbaoImg.source=this.data.icon;var cost=this.data.cash;this.pay.text="￥"+cost;if(ChannelMgr.ins().isAnQiGeChannel()){this.pay.text=this.data.channel_20121_itemName}if(Recharge.ins().getOrderByIndex(this.data.id)){this.give.visible=false;this.itemName.text=this.data.amount}else{this.give.visible=true;this.itemName.text=this.data.award}this.invalidateState();if(this.data.id>=1e3){this.give.visible=false;this.card.text=this.data.itemName;this.card.visible=true;this.yb.visible=false}else{this.card.visible=false;this.yb.visible=true}if(this.data.id==2004){this.yuanbaoImg.source="cz_14";this.card.visible=false;this.yb.visible=true;this.itemName.text=this.data.amount}};return ChargeItemRenderer}(BaseItemRender);__reflect(ChargeItemRenderer.prototype,"ChargeItemRenderer");var ChargeTipsWin=function(_super){__extends(ChargeTipsWin,_super);function ChargeTipsWin(){return _super.call(this)||this}ChargeTipsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ChargeTipsSkin"};return ChargeTipsWin}(BaseEuiView);__reflect(ChargeTipsWin.prototype,"ChargeTipsWin");ViewManager.ins().reg(ChargeTipsWin,LayerManager.UI_Tips);var ChoosePayMethod=function(_super){__extends(ChoosePayMethod,_super);function ChoosePayMethod(){var _this=_super.call(this)||this;_this.product_id=1;_this.skinName="ChoosePayMethodSkin";_this.isTopLevel=true;return _this}ChoosePayMethod.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(param[0]){this.product_id=param[0][0];this.chosenCallBack=param[0][1]}this.addTouchEvent(this.closeBtn,this.onCloseBtn);this.addTouchEvent(this.zfbBtn,this.onZfbBtn);this.addTouchEvent(this.wxBtn,this.onWxBtn);this.showProduct()};ChoosePayMethod.prototype.showProduct=function(){var dataList=GlobalConfig.RechargeItemsConfig;var data=dataList[this.product_id];this.goodsname.text=data.desc;this.goodsprice.text=data.cash+i18n("ChoosePayMethod_0")};ChoosePayMethod.prototype.onZfbBtn=function(){if(this.chosenCallBack){this.chosenCallBack(Recharge.payMethod["zfb"])}this.onCloseBtn()};ChoosePayMethod.prototype.onWxBtn=function(){if(this.chosenCallBack){this.chosenCallBack(Recharge.payMethod["wx"])}this.onCloseBtn()};ChoosePayMethod.prototype.onCloseBtn=function(){ViewManager.ins().close(ChoosePayMethod)};ChoosePayMethod.prototype.close=function(){_super.prototype.close.call(this)};return ChoosePayMethod}(BaseEuiView);__reflect(ChoosePayMethod.prototype,"ChoosePayMethod");ViewManager.ins().reg(ChoosePayMethod,LayerManager.UI_Popup);var Recharge1Win=function(_super){__extends(Recharge1Win,_super);function Recharge1Win(){var _this=_super.call(this)||this;_this.day=0;_this.today=-1;_this.isTopLevel=true;_this.isPlayOpenSound=true;return _this}Recharge1Win.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="FirstChargeSkin";this.list.itemRenderer=ItemBase;this.listVip.itemRenderer=ItemBase;this.btnArr=[];for(var i=0;i<4;i++){this.btnArr.push(this["chong"+i])}this.eff=new MovieClip;this.eff.touchEnabled=false;Recharge.ins().initAsPay()};Recharge1Win.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.FIRSTCHARGE));return false}if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("VipWin_13"));return false}var rch=Recharge.ins().getRechargeData(0);if(!param[0]){if(rch.num==2){ViewManager.ins().open(ChargeFirstWin);return false}return true}if(rch.num==2){ViewManager.ins().open(param[0][0]);return false}return true};Recharge1Win.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.today=param[0]||-1;this.addTouchEvent(this.bg,this.closeCB);this.addTouchEvent(this.closeBtn,this.closeCB);this.addTouchEvent(this.btnGet,this.onTouch);this.addChangeEvent(this.tab,this.onTabTouch);for(var i_19=0;i_19<this.btnArr.length;i_19++){this.addTouchEvent(this.btnArr[i_19],this.onTouch)}this.observe(Recharge.ins().postUpdateRechargeEx,this.setWinData);var playPunView=ViewManager.ins().getView(PlayFunView);if(playPunView){playPunView.preRecharge=playPunView.recharge.visible=false}var i=0;var list=this.getDataList();for(var k in list){var frc=list[k];var paydesc=frc.paydesc.replace(i18n("Recharge1Win_3"),"");this.btnArr[i]["rmb"].text=paydesc;this.btnArr[i]["yuanbao"].text=frc.pay;this.btnArr[i]["money"]=frc.pay;this.btnArr[i]["id"]=frc.id;this.btnArr[i]["give"].text="+"+(frc.payReturn-frc.pay);this.btnArr[i]["rec"].visible=i==3?true:false;this.btnArr[i]["nt"].visible=false;this.btnArr[i]["rmbGroup"].visible=true;if(ChannelMgr.ins().isAnQiGeChannel()){this.btnArr[i]["rmbGroup"].visible=false;this.btnArr[i]["nt"].visible=true;this.btnArr[i]["nt"].text=frc.paydesc}var mc=new MovieClip;mc.x=this.btnArr[i]["aniGroup"].width/2;mc.y=this.btnArr[i]["aniGroup"].height/2;mc.touchEnabled=this.btnArr[i]["aniGroup"].touchEnabled=false;mc.playFile(RES_DIR_EFF+"scantx1_eff",-1);this.btnArr[i]["aniGroup"].addChild(mc);i++}if(this.today>-1){this.tab.selectedIndex=this.today;this.day=this.today}else{this._data=Recharge.ins().getRechargeData(0);for(var day=0;day<3;day++){if(this._data.firstRewardInfo[day]==1){this.tab.selectedIndex=day;this.day=day;break}}}this.setWinData();this.showFirstChargeReward();if(ChannelMgr.ins().isAnQiGeChannel()){this.giftPrice.text="10"}};Recharge1Win.prototype.showFirstChargeReward=function(){var day=this.day;var job=SubRoles.ins().getFirstJob();var cfg=GlobalConfig.FirstRechargeAwardsConfig[job][day+1];if(!cfg){return}var res=cfg.rewardShow;var mcX=170;var mcY=311;if(res.indexOf("weapon")>-1){var sex=sexByJob(job);if(sex==0){mcX=280;mcY=240}else{mcX=270;mcY=197+52}}else if(res.indexOf("wing")>-1){mcY=295+42}this.mcGroup.x=mcX;this.mcGroup.y=mcY;imageToMc(this.mcImg,res,this.mcGroup,null,RES_DIR_ROLE);this.list.dataProvider=new ArrayCollection(cfg.rechargeReward);this.title.source=cfg.titleShow;this.txtShow.source=cfg.txtShow};Recharge1Win.prototype.getDataList=function(){var dataList=GlobalConfig.FirstRechargeConfig;var list_gen=[];var list_as=[];for(var str in dataList){var v=dataList[str];var as_plat=Recharge.platIds["as"];if(v.plats.indexOf(as_plat)!=-1){list_as.push(v)}else{if(ChannelMgr.ins().isAnQiGeChannel()){if(v.plats.indexOf(20121)!=-1){list_gen.push(v)}}else{if(v.plats.indexOf(20121)==-1){list_gen.push(v)}}}}if(ChannelMgr.ins().isWXSmallGameChannel()){list_gen=list_as}if(Recharge.ins().plat=="as"){return list_as}else if(ChannelMgr.ins().isMeiShengYuanChannel()&&ChannelMgr.ins().platID=="103"){return list_as}else if(ChannelMgr.ins().isYaoShengChannel()){return list_as}else{return list_gen}};Recharge1Win.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}DisplayUtils.removeFromParent(this.eff);egret.Tween.removeTweens(this)};Recharge1Win.prototype.closeCB=function(e){ViewManager.ins().close(this);TimerManager.ins().removeAll(this)};Recharge1Win.prototype.onTouch=function(e){var num=0;switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.btnGet:if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}Recharge.ins().changeRecharge1Data(this.day+1);break;default:for(var i=0;i<4;i++){if(e.currentTarget==this.btnArr[i]){var id=this.btnArr[i]["id"];for(var i_20 in GlobalConfig.RechargeItemsConfig){if(id==GlobalConfig.RechargeItemsConfig[i_20].id){Recharge.ins().showReCharge(GlobalConfig.RechargeItemsConfig[i_20].id);break}}break}}break}};Recharge1Win.prototype.onTabTouch=function(e){if(e.currentTarget.selectedIndex==this.day)return;this.day=e.currentTarget.selectedIndex;this.showFirstChargeReward();this.showRewardState()};Recharge1Win.prototype.setWinData=function(){this.listVip.dataProvider=new ArrayCollection(GlobalConfig.ChongZhiBaseConfig.firstchargeitemshow);this._data=Recharge.ins().getRechargeData(0);if(!this._data.num){this.buyed.visible=false;this.unbuy.visible=true;DisplayUtils.removeFromParent(this.eff);this.tips.visible=true}else{this.tips.visible=false;this.buyed.visible=true;this.unbuy.visible=false;this.showRewardState()}this.updateRedPoint()};Recharge1Win.prototype.showRewardState=function(){var state=this._data.firstRewardInfo[this.day]||0;this.btnGet.visible=state==2?false:true;this.btnGet.enabled=state==1;this.time.visible=state==0?true:false;this.updateTime();TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1e3,0,this.updateTime,this);if(state==1){if(!this.eff.parent){this.buyMcGroup.addChild(this.eff);this.eff.x=this.buyMcGroup.width/2;this.eff.y=this.buyMcGroup.height/2;this.eff.touchEnabled=this.buyMcGroup.touchEnabled=false;this.eff.playFile(RES_DIR_EFF+"chongzhi",-1)}}else{this.buyMcGroup.removeChildren()}};Recharge1Win.prototype.updateTime=function(){var rechargeTime=this._data.firstRechargeTime*DateUtils.MS_PER_SECOND;var nextDayTime=rechargeTime+this.day*60*60*24*DateUtils.MS_PER_SECOND;var nextDay=new Date(nextDayTime);var end=new Date;end.setFullYear(nextDay.getFullYear());end.setMonth(nextDay.getMonth());end.setDate(nextDay.getDate());end.setHours(0,0,0,0);var remainSeconds=(end.getTime()-GameServer.serverTime)/1e3;var time=DateUtils.getFormatTimeByStyle(remainSeconds,DateUtils.STYLE_3);this.time.text=i18n("Recharge1Win_11",time)};Recharge1Win.prototype.updateRedPoint=function(){this.redPoint0.visible=(this._data.firstRewardInfo[0]||0)==1?true:false;this.redPoint1.visible=(this._data.firstRewardInfo[1]||0)==1?true:false;this.redPoint2.visible=(this._data.firstRewardInfo[2]||0)==1?true:false};return Recharge1Win}(BaseEuiView);__reflect(Recharge1Win.prototype,"Recharge1Win");ViewManager.ins().reg(Recharge1Win,LayerManager.UI_Popup);var Recharge2Win=function(_super){__extends(Recharge2Win,_super);function Recharge2Win(){var _this=_super.call(this)||this;_this.skinName="DailyChargeSkin2";_this.isTopLevel=true;_this.needBg=false;return _this}Recharge2Win.prototype.initUI=function(){_super.prototype.initUI.call(this);this.totalPower=BitmapNumber.ins().createNumPic(0,"vip_v",5);this.totalPower.x=0;this.totalPower.y=0;this.moneyGroup.addChild(this.totalPower);this.eff=new MovieClip;this.eff.x=this.goUpBtn.x+103;this.eff.y=this.goUpBtn.y+24;this.eff.scaleX=1.45;this.eff.touchEnabled=false;Recharge.ins().initAsPay()};Recharge2Win.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.goUpBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.observe(Recharge.ins().postUpdateRechargeEx,this.setWinData);var playPunView=ViewManager.ins().getView(PlayFunView);if(playPunView){playPunView.preRecharge=playPunView.recharge.visible=false}this.setWinData()};Recharge2Win.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.goUpBtn,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);DisplayUtils.removeFromParent(this.eff);egret.Tween.removeTweens(this);this.removeObserve()};Recharge2Win.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(Recharge2Win);break;case this.goUpBtn:if(this.goUpBtn.label==i18n("Recharge2Win_0")){if(this.currData){this.getReward()}}else if(this.goUpBtn.label==i18n("Recharge2Win_1")){Recharge.ins().tryShowChargeFirstWin()}break}};Recharge2Win.prototype.getReward=function(){this.playGet(undefined,this.currData);Recharge.ins().getDayReward(this.currData.index)};Recharge2Win.prototype.playGet=function(fun,infoData){var uiView2=ViewManager.ins().getView(UIView2);var bagBtn=uiView2.getBagBtn();var targetX=bagBtn.x-this.mainGroup.x-50;var targetY=bagBtn.y-this.mainGroup.y-110;var _loop_26=function(i){var item=new ItemBase;item.data=this_20["item"+(i+1)].data;item.x=this_20["item"+(i+1)].x;item.y=this_20["item"+(i+1)].y;this_20["item"+(i+1)].parent.addChild(item);var t=egret.Tween.get(item);t.to({x:targetX,y:targetY,scaleX:0,scaleY:0},500).call(function(){DisplayUtils.removeFromParent(item)})};var this_20=this;for(var i=0;i<4;i++){_loop_26(i)}};Recharge2Win.prototype.setWinData=function(){var data=Recharge.ins().getRechargeData(0);var config=Recharge.ins().getCurRechargeConfig();this.currData=null;var minRecharge=Number.MAX_VALUE;for(var k in config){var state=data.isAwards>>config[k].index&1;if(!state&&minRecharge>config[k].pay){minRecharge=config[k].pay;this.currData=config[k]}}if(!this.currData)this.currData=config[0];if(this.currData){var cost=this.currData.pay-data.curDayPay;var index=this.currData.index;if(cost>0){this.goUpBtn.label=i18n("Recharge2Win_4");DisplayUtils.removeFromParent(this.eff)}else{this.goUpBtn.label=i18n("Recharge2Win_5");if(!this.eff.parent){this.goUpBtn.parent.addChildAt(this.eff,this.getChildIndex(this.goUpBtn));this.eff.playFile(RES_DIR_EFF+"chongzhi",-1)}}this.setItem();BitmapNumber.ins().changeNum(this.totalPower,cost<0?0:cost,"vip_v",3)}this.initPos()};Recharge2Win.prototype.setItem=function(){for(var j=0;j<this.currData.awardList.length;j++){var d=this.currData.awardList[j];this["item"+(j+1)].data=d;this["item"+(j+1)].visible=true;this["item"+(j+1)].scaleX=this["item"+(j+1)].scaleY=1;this["item"+(j+1)].x=90*j;this["item"+(j+1)].y=0}};Recharge2Win.prototype.initPos=function(){this.totalPower.x=(this.moneyGroup.width-this.totalPower.width)/2};return Recharge2Win}(BaseEuiView);__reflect(Recharge2Win.prototype,"Recharge2Win");ViewManager.ins().reg(Recharge2Win,LayerManager.UI_Main);var Recharge3Win=function(_super){__extends(Recharge3Win,_super);function Recharge3Win(){var _this=_super.call(this)||this;_this._oneDay=DateUtils.HOURS_PER_DAY*DateUtils.SECOND_PER_HOUR;_this.activityID=20;_this.stateDic={};_this.initUI();return _this}Recharge3Win.prototype.initUI=function(){this.skinName="TotalChargeActSkin";this.name=i18n("Recharge3Win_0");this.list.itemRenderer=TotalChargeActItem};Recharge3Win.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.setWinData();this.observe(Recharge.ins().postUpdateRecharge,this.setWinData);this.addTouchEvent(this.recharge,this.onTabTouch)};Recharge3Win.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.recharge,this.onTabTouch);this.removeObserve()};Recharge3Win.prototype.onTabTouch=function(e){switch(e.currentTarget){case this.recharge:Recharge.ins().tryShowChargeFirstWin();break}};Recharge3Win.prototype.setWinData=function(){this._data=Recharge.ins().getRechargeData(1);this.desc.text=i18n("Recharge3Win_1")+this._data.num+i18n("Recharge3Win_2");var config=GlobalConfig.ChongZhi2Config[this._data.day/DateUtils.DAYS_PER_WEEK>=1?2:1][this._data.day%7];var dataArr=[];for(var k in config){dataArr.push(config[k]);this.stateDic[config[k].index]=this._data.isAwards>>config[k].index&1}dataArr=dataArr.sort(this.sort);this.list.dataProvider=new eui.ArrayCollection(dataArr);var times=GameServer.serverTime/1e3-(new Date).getTimezoneOffset()*60;if(times>this._oneDay)times-=this._oneDay;var endedTime=this._oneDay-times%this._oneDay;var hourst=Math.floor(endedTime/DateUtils.SECOND_PER_HOUR);var minst=Math.floor(endedTime%DateUtils.SECOND_PER_HOUR/60);this.date.text=i18n("Recharge3Win_3",hourst,minst)};Recharge3Win.prototype.sort=function(a,b){var s1=a.pay;var s2=b.pay;if(this.stateDic[a.index]==0&&this.stateDic[b.index]==1){return-1}else if(this.stateDic[a.index]==1&&this.stateDic[b.index]==0){return 1}if(s1>s2)return 1;else if(s1<s2)return-1;else return 0};return Recharge3Win}(BaseView);__reflect(Recharge3Win.prototype,"Recharge3Win");ViewManager.ins().reg(Recharge3Win,LayerManager.UI_Main);var Recharge4Item=function(_super){__extends(Recharge4Item,_super);function Recharge4Item(){var _this=_super.call(this)||this;_this.skinName="Recharge4ItemSkin";return _this}Recharge4Item.prototype.onTap=function(e){switch(e){case this.btn:this.onClickBtn();break}};Recharge4Item.prototype.onClickBtn=function(){var id=this.id;var status=Recharge.ins().getDailyDealsStatus(id);var rechargeId=Recharge.ins().getRechargeID(id);if(rechargeId<0){console.log("DailyRecharge4 no such recharge item:"+id);return}switch(status){case dailyDealState.get:Recharge.ins().sendGetDailyDealsAwards(id);break;case dailyDealState.buy:Recharge.ins().showReCharge(rechargeId);break;case dailyDealState.done:break}};Recharge4Item.prototype.dataChanged=function(){this.id=this.data;var cfg=GlobalConfig.DailyRecharge4Config[this.id];var awardList=cfg.awardList;this.list.itemRenderer=ItemBaseNoName;this.list.dataProvider=new ArrayCollection(awardList);switch(this.id){case 1:this.name0.source="gift0";this.oriprice.text="";break;case 2:this.name0.source="gift1";this.oriprice.text=i18n("Recharge4Item_0",10);break;case 3:this.name0.source="gift3";this.oriprice.text=i18n("Recharge4Item_0",30);break;case 4:this.name0.source="gift6";this.oriprice.text=i18n("Recharge4Item_0",60);if(ChannelMgr.ins().isAnQiGeChannel()){this.name0.source="gift61";this.oriprice.text=i18n("Recharge4Item_1",300)}break}this.line.visible=this.oriprice.text!="";var status=Recharge.ins().getDailyDealsStatus(this.id);this.btn.visible=status==dailyDealState.done?false:true;this.btn.label=status==dailyDealState.get?i18n("Recharge4Win_0"):i18n("Recharge4Win_1");this.redPoint.visible=status==dailyDealState.get?true:false};return Recharge4Item}(BaseItemRender);__reflect(Recharge4Item.prototype,"Recharge4Item");var Recharge4Win=function(_super){__extends(Recharge4Win,_super);function Recharge4Win(){var _this=_super.call(this)||this;_this.len=5;_this.skinName="DailyChargeSkin4";_this.isTopLevel=true;_this.needBg=false;return _this}Recharge4Win.prototype.initUI=function(){_super.prototype.initUI.call(this)};Recharge4Win.prototype.childrenCreated=function(){this.initMc()};Recharge4Win.prototype.initMc=function(){for(var i=0;i<2;i++){var mc=new MovieClip;mc.playFile(RES_DIR_EFF+"mrthjm"+(i+1)+"_eff",-1);mc.touchEnabled=false;this["ani"+i].addChild(mc)}for(var i=0;i<4;i++){var mc3=new MovieClip;mc3.playFile(RES_DIR_EFF+"mrthjm3_eff",-1);mc3.x=102;mc3.y=125;mc3.touchEnabled=false;this["group"+i].addChildAt(mc3,1);var mc4=new MovieClip;mc4.playFile(RES_DIR_EFF+"mrthjm4_eff",-1);mc4.x=102;mc4.y=38;mc4.touchEnabled=false;this["group"+i].addChildAt(mc4,3)}};Recharge4Win.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnClose,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.group0,this.onTap);this.addTouchEvent(this.group1,this.onTap);this.addTouchEvent(this.group2,this.onTap);this.addTouchEvent(this.group3,this.onTap);this.addTouchEvent(this.btn4,this.onTap);this.observe(Recharge.ins().postDailyDealsInfo,this.setWinData);this.observe(Recharge.ins().postDailyDealsAwards,this.setWinData);this.cfg=GlobalConfig.DailyRecharge4Config;this.setWinData()};Recharge4Win.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.btnClose,this.onTap);this.removeTouchEvent(this.group0,this.onTap);this.removeTouchEvent(this.group1,this.onTap);this.removeTouchEvent(this.group2,this.onTap);this.removeTouchEvent(this.group3,this.onTap);this.removeTouchEvent(this.btn4,this.onTap);this.removeObserve()};Recharge4Win.prototype.onTap=function(e){var res=false;switch(e.currentTarget){case this.btnClose:case this.bgClose:ViewManager.ins().close(Recharge4Win);res=true;break;case this.btn4:this.onClickBtn(5);res=true;break}if(!res&&e.target instanceof eui.Button){var item=e.target.parent;item.onTap(e.target)}};Recharge4Win.prototype.onClickBtn=function(id){if(id===void 0){id=1}var status=Recharge.ins().getDailyDealsStatus(id);var rechargeId=Recharge.ins().getRechargeID(id);if(rechargeId<0){console.log("DailyRecharge4 no such recharge item:"+id);return}switch(status){case dailyDealState.get:Recharge.ins().sendGetDailyDealsAwards(id);break;case dailyDealState.buy:Recharge.ins().showReCharge(rechargeId);break;case dailyDealState.done:break}};Recharge4Win.prototype.setWinData=function(){var status=Recharge.ins().getDailyDealsStatus(5);var day=Recharge.ins().getDailyDealsLeftDay();for(var i=0;i<4;i++){var item=this["group"+i];item.data=i+1}if(ChannelMgr.ins().isAnQiGeChannel()){this.currentState="20121";this.btn4.label=status==dailyDealState.buy?i18n("Recharge4Win_31"):i18n("Recharge4Win_2");if(this.btn4.label==i18n("Recharge4Win_31")){this.btn4.width=282;this.redPoint4.x=295}else{this.btn4.width=182;this.redPoint4.x=245}}else{this.currentState="normal";this.btn4.label=status==dailyDealState.buy?i18n("Recharge4Win_3"):i18n("Recharge4Win_2")}this.tip.text=status==dailyDealState.buy?i18n("Recharge4Win_4"):i18n("Recharge4Win_5",day);this.redPoint4.visible=status==dailyDealState.get?true:false;this.btn4.enabled=status!=dailyDealState.done};return Recharge4Win}(BaseEuiView);__reflect(Recharge4Win.prototype,"Recharge4Win");ViewManager.ins().reg(Recharge4Win,LayerManager.UI_Popup);var TotalChargeActItem=function(_super){__extends(TotalChargeActItem,_super);function TotalChargeActItem(){var _this=_super.call(this)||this;_this.skinName="TotalChargeActItemSkin";_this.list.itemRenderer=ItemBase;return _this}TotalChargeActItem.prototype.dataChanged=function(){this.price.setType(MoneyConst.yuanbao);var config=this.data;var num=Recharge.ins().getRechargeData(1).num;this._index=config.index;this.price.setPrice(config.pay);this.list.dataProvider=new eui.ArrayCollection(config.awardList);var bool=this.getRemindByIndex(this._index);if(num>=config.pay){if(bool){this.rewardBtn.visible=false;this.rewardedTip.visible=true}else{this.rewardBtn.visible=true;this.rewardedTip.visible=false;this.rewardBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)}}else{this.rewardBtn.visible=this.rewardedTip.visible=false}};TotalChargeActItem.prototype.getRemindByIndex=function(index){return(Recharge.ins().getRechargeData(1).isAwards>>index&1)==1};TotalChargeActItem.prototype.onClick=function(){Recharge.ins().sendGetAwards(1,this._index);this.rewardBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};return TotalChargeActItem}(BaseItemRender);__reflect(TotalChargeActItem.prototype,"TotalChargeActItem");var RenameWin=function(_super){__extends(RenameWin,_super);function RenameWin(){var _this=_super.call(this)||this;_this.skinName="NameChangeSkin";return _this}RenameWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.sureBtn,this.onTap)};RenameWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.sureBtn,this.onTap);this.input.text=""};RenameWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(RenameWin);break;case this.sureBtn:if(this.input.text.length==0){UserTips.ins().showTips(i18n("RenameWin_0"))}else if(UserBag.ins().getBagItemById(ItemConst.RENAME)!=null){GameLogic.ins().sendRename(this.input.text)}break}};return RenameWin}(BaseEuiView);__reflect(RenameWin.prototype,"RenameWin");ViewManager.ins().reg(RenameWin,LayerManager.UI_Popup);var ReportData=function(){function ReportData(){this.isComplete=false;this.httpRequest=new egret.HttpRequest;this.httpRequestUrl=[]}ReportData.getIns=function(){this._ins=this._ins||new ReportData;return this._ins};ReportData.prototype.report=function(str,reportType){var roleCount=LocationProperty.roleCount;reportType=reportType||ReportData.LOAD;if(reportType==ReportData.LOAD){if(roleCount!=0)return}if(reportType==ReportData.ERROR&&str==this.lastErrMsg){return}this.lastErrMsg=str;var ua=navigator.userAgent.toLowerCase();if(/iphone|ipad|ipod/.test(ua)){ua="1"}else if(/android/.test(ua)){ua="2"}else ua="0";var key=md5_lytj.hex_md5(md5_lytj.hex_md5(reportType+"027a47eabf1ebcb409b7fe680ff69008"));var data="&data=";data+=LocationProperty.pfid;data+="|"+LocationProperty.srvid;data+="|"+LocationProperty.openID;data+="|"+reportType;data+="|"+str;data+="|"+LocationProperty.isnew;data+="|"+ua;data+="|"+LocationProperty.login_ip;data+="|"+DateUtils.getFormatBySecond(Math.floor((GameServer.serverTime||Date.now())/1e3),2);data+="|"+LocationProperty.appid;if(reportType!=ReportData.ERROR)data+="|"+Actor.level||1;this.reportUrl(LocationProperty.loadurl+"/report?appv=1.0&counter="+reportType+"&key="+key+data)};ReportData.prototype.reportChat=function(str,chatType){if(LocationProperty.isLocation){return}if(window["reportChat"]){var obj={serverid:LocationProperty.srvid,qid:LocationProperty.openID,actorid:Actor.actorID,name:Actor.myName,chattype:chatType,content:str,chatdate:DateUtils.getFormatBySecond(Math.floor((GameServer.serverTime||Date.now())/1e3),2),ip:LocationProperty.login_ip,pf:LocationProperty.pf};window["reportChat"](obj);return}var reportType="chat";str=str.replace(/\|/g,"、");var key=md5_lytj.hex_md5(md5_lytj.hex_md5(reportType+"027a47eabf1ebcb409b7fe680ff69008"));var data="&data=";data+=LocationProperty.srvid;data+="|"+LocationProperty.openID;data+="|"+Actor.actorID;data+="|"+Actor.myName;data+="|"+chatType;data+="|"+str;data+="|"+DateUtils.getFormatBySecond(Math.floor((GameServer.serverTime||Date.now())/1e3),2);data+="|"+LocationProperty.login_ip;data+="|"+LocationProperty.pf;this.reportUrl(LocationProperty.loadurl+"/report?appv=1.0&counter="+reportType+"&key="+key+data)};ReportData.prototype.advice=function(str,func,funcThis){var f=function(v){this.httpRequest.removeEventListener(egret.Event.COMPLETE,f,this);var request=v.currentTarget;if(request.response=="true"||request.response=="true\n"){UserTips.ins().showTips(i18n("ReportData_0"));func.call(funcThis)}else UserTips.ins().showTips(i18n("ReportData_1"))};this.httpRequest.addEventListener(egret.Event.COMPLETE,f,this);var ua=navigator.userAgent.toLowerCase();if(/iphone|ipad|ipod/.test(ua)){ua="1"}else if(/android/.test(ua)){ua="2"}else ua="0";var counter="gm";str=str.replace(/\|/g,"、");var data="&data=";data+=LocationProperty.pfid;data+="|"+LocationProperty.srvid;data+="|"+LocationProperty.openID;data+="|"+counter;data+="|"+str;data+="|"+LocationProperty.isnew;data+="|"+ua;data+="|"+LocationProperty.login_ip;data+="|"+DateUtils.getFormatBySecond(Math.floor((GameServer.serverTime||Date.now())/1e3),2);data+="|"+LocationProperty.appid;data+="|"+Actor.level;this.reportUrl(LocationProperty.loadurl+"/report?appv=1.0&counter="+counter+"&key=d413074da338f01ab95010fac6f0c81a"+data)};ReportData.prototype.roleUp=function(){};ReportData.prototype.enterGame=function(){};ReportData.prototype.createRole=function(roleId){};ReportData.prototype.advice1=function(str,func,funcThis){var f=function(v){this.httpRequest.removeEventListener(egret.Event.COMPLETE,f,this);var request=v.currentTarget;if(request.response=="ok"){UserTips.ins().showTips(i18n("ReportData_2"));func.call(funcThis)}else UserTips.ins().showTips(i18n("ReportData_3"))};this.httpRequest.addEventListener(egret.Event.COMPLETE,f,this);str=str.replace(/@/g,"");str=str.replace(/#/g,"");var data="&serverid="+LocationProperty.srvid;data+="&sign="+md5_lytj.hex_md5(""+(LocationProperty.srvid||0)+Actor.actorID+"enter_reportfeedbackqiyaohudongyule!@#");data+="&actorid="+Actor.actorID;data+="&actorname="+Actor.myName;data+="&feedcnt="+str;data+="&openid="+LocationProperty.openID;data+="&userlevel="+Actor.level;data+="&viplevel="+UserVip.ins().lv;data+="&appid="+LocationProperty.appid;this.reportUrl(LocationProperty.loadurl+"/api/load?counter=enter_report"+data)};ReportData.prototype.reportUrl=function(url,method){};ReportData.prototype.sendReportUrl=function(){if(this.isComplete==false&&this.httpRequestUrl.length>0){var url=this.httpRequestUrl[0].url;var method=this.httpRequestUrl[0].method;this.httpRequest.open(url,method?method:egret.HttpMethod.GET);this.httpRequest.send();this.isComplete=true;this.httpRequest.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this);this.httpRequest.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this)}};ReportData.prototype.onGetComplete=function(event){this.isComplete=false;this.httpRequestUrl.shift();this.sendReportUrl()};ReportData.prototype.onGetIOError=function(event){this.isComplete=false;this.sendReportUrl()};ReportData.LOAD="load";ReportData.GM="gm";ReportData.ERROR="error";return ReportData}();__reflect(ReportData.prototype,"ReportData");var HrInfo=function(){function HrInfo(){}return HrInfo}();__reflect(HrInfo.prototype,"HrInfo");var ActivationContent=function(_super){__extends(ActivationContent,_super);function ActivationContent(type,name,source,play,func,effmc,zlmodel,feijianModel,sqmc,wingmc,resDir){if(play===void 0){play=true}if(func===void 0){func=null}if(resDir===void 0){resDir=RES_DIR_EFF}var _this=_super.call(this)||this;_this.skinName="ActivationContentSkin";StageUtils.ins().setTouchChildren(true);var rxa=RegExpUtil.NonNumericExp.exec(name);if(!rxa)_this.itemname.text=name;else{var num="";var oth="";for(var i=0;i<name.length;i++){if(i>=rxa.index){oth+=name[i]}else{num+=name[i]}}var str="";if(Number(num)/10>=1){str=num}else{str=" "+num}_this.itemname.text=str+oth}_this.img.source=source;if(effmc){if(!_this.imgEff)_this.imgEff=new MovieClip;if(!_this.imgEff.parent)_this.imgMc.addChild(_this.imgEff);_this.imgEff.playFile(resDir+effmc,-1);_this.playGetEff(_this.huodeMc)}else if(sqmc){if(!_this.sqEff)_this.sqEff=new MovieClip;if(!_this.sqEff.parent)_this.sqMc.addChild(_this.sqEff);_this.sqEff.playFile(resDir+sqmc,-1);_this.playGetEff(_this.sqMc)}else if(wingmc){if(!_this.wingEff)_this.wingEff=new MovieClip;if(!_this.wingEff.parent)_this.wingMc.addChild(_this.wingEff);_this.wingEff.playFile(resDir+wingmc,-1);_this.playGetEff(_this.wingMc2)}else if(zlmodel){if(!_this.zlEff)_this.zlEff=new MovieClip;if(!_this.zlEff.parent)_this.zlMc.addChild(_this.zlEff);_this.zlEff.playFile(resDir+zlmodel,-1);_this.playGetEff(_this.huodeMc)}else if(feijianModel){if(!_this.feijianEff)_this.feijianEff=new MovieClip;if(!_this.feijianEff.parent)_this.feijianMc.addChild(_this.feijianEff);_this.feijianEff.playFile(resDir+feijianModel,-1);_this.playGetEff(_this.feijianMc)}else{_this.playGetEff(_this.huodeMc)}_this.playAnimaiton(play);return _this}ActivationContent.prototype.playGetEff=function(huodeMC){var huodeEff=this.huodeEff;if(!huodeEff)huodeEff=new MovieClip;if(!huodeEff.parent)huodeMC.addChild(huodeEff);TimerManager.ins().doTimer(300,1,function(){huodeEff.playFile(RES_DIR_EFF+"huodealleff",1)},this)};ActivationContent.prototype.close=function(){egret.Tween.removeTweens(this.img);egret.Tween.removeTweens(this.imgMc);egret.Tween.removeTweens(this.zlMc);egret.Tween.removeTweens(this.feijianMc);egret.Tween.removeTweens(this.imgAct);if(this.closeFunc)this.closeFunc.apply(null);this.closeFunc=null;DisplayUtils.removeFromParent(this.zlEff);DisplayUtils.removeFromParent(this.imgEff);DisplayUtils.removeFromParent(this.mc);TimerManager.ins().removeAll(this);this.zlEff=null;this.imgEff=null;this.mc=null};ActivationContent.prototype.playAnimaiton=function(play){this.artifactTween()};ActivationContent.prototype.artifactTween=function(){var t=egret.Tween.get(this.imgAct,{loop:true});t.to({y:this.imgAct.y-20},1e3).to({y:this.imgAct.y},1e3)};return ActivationContent}(eui.Component);__reflect(ActivationContent.prototype,"ActivationContent");var RewardWin=function(_super){__extends(RewardWin,_super);function RewardWin(){var _this=_super.call(this)||this;_this.clickedBtnIdx=-1;_this.isTopLevel=true;_this.skinName="RewardWinSkin";return _this}RewardWin.prototype.createChildren=function(){};RewardWin.prototype.open=function(params){var _this=this;this.rewards=params[0];var t=params[1];if(t!=RewardWin.TYPE_DEFAULT&&t!=RewardWin.TYPE_TONGGUAN){this.btnGet.label=i18n("RewardWin_1")}if(t==RewardWin.TYPE_GXHD2){t=RewardWin.TYPE_DEFAULT}this.title.source=t;this.onClose=params[2];var isScroll=this.rewards.length>16;var item0=this.rewards[0];if(this.content!=null&&this.content!=this.list0&&this.content!=this.scroller1){this.content.parent.removeChild(this.content)}if(item0 instanceof egret.DisplayObject){this.content=item0;this.grpUI.addChild(item0);this.scroller1.visible=false;this.list0.visible=false}else{this.content=isScroll?this.scroller1:this.list0;this.scroller1.visible=isScroll;this.list0.visible=!isScroll}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.btnGet,this.onTap);this.addTouchEvent(this.bgPic0,this.cancelCounting);this.addTouchEvent(this.content,this.cancelCounting);this.list0.itemRenderer=ItemBase;this.list0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.cancelCounting,this);this.list1.itemRenderer=ItemBase;this.list1.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.cancelCounting,this);if(this.dy0==null){this.dy0=this.grpMain.height-this.list0.height;this.dyGrpUI=this.grpUI.y-this.list0.height/2;this.dy1=this.btnGet.y-this.list0.height/2;this.dybg=this.bgPic0.height-this.grpMain.height}this.btnGetLabel=this.btnGet.label;this.refreshItems(isScroll);this.start.addEventListener(egret.Event.COMPLETE,function(){playAnimation(_this.loop,true)},this);var tw=Tween.get(this);tw.wait(1e3).call(function(){_this.btnGet.label=_this.btnGetLabel.replace("5","4")}).wait(1e3).call(function(){_this.btnGet.label=_this.btnGetLabel.replace("5","3")}).wait(1e3).call(function(){_this.btnGet.label=_this.btnGetLabel.replace("5","2")}).wait(1e3).call(function(){_this.btnGet.label=_this.btnGetLabel.replace("5","1")}).wait(1e3).call(function(){ViewManager.ins().close(RewardWin)});this.start.play()};RewardWin.prototype.cancelCounting=function(){Tween.removeTweens(this);this.btnGet.label=this.btnGetLabel.substr(0,this.btnGetLabel.indexOf("("))};RewardWin.prototype.close=function(){Tween.removeTweens(this);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.btnGet,this.onTap);this.start.stop();this.loop.stop();if(this.onClose){this.onClose(this.clickedBtnIdx)}for(var _i=0,_a=RewardWin.onCloseOnces;_i<_a.length;_i++){var oco=_a[_i];oco()}RewardWin.onCloseOnces.splice(0)};RewardWin.addOnCloseOnce=function(onCloseOnce){RewardWin.onCloseOnces.push(onCloseOnce)};RewardWin.prototype.onTap=function(e){switch(e.currentTarget){case this.btnGet:this.clickedBtnIdx=0;case this.bgClose:ViewManager.ins().close(RewardWin);break}};RewardWin.prototype.refreshItems=function(isScroll){var item0=this.rewards[0];if(!(item0 instanceof egret.DisplayObject)){var list=isScroll?this.list1:this.list0;list.dataProvider=new ArrayCollection(this.rewards);var rewardCount=this.rewards.length;list.layout.requestedColumnCount=rewardCount<4?rewardCount:4}this.grpMain.height=this.content.height+this.dy0;this.bgPic0.height=this.dybg+this.grpMain.height;this.content.anchorOffsetX=this.content.width/2;this.content.anchorOffsetY=this.content.height/2;this.grpUI.y=this.dyGrpUI+this.content.height/2;this.btnGet.y=this.content.height/2+this.dy1};RewardWin.show=function(rewards,t,onClose){if(t===void 0){t=RewardWin.TYPE_DEFAULT}var rewardExp=new RewardData;rewardExp.type=0;rewardExp.id=0;rewardExp.count=0;var rewardGold=new RewardData;rewardGold.type=0;rewardGold.id=1;rewardGold.count=0;var rewardYuanbao=new RewardData;rewardYuanbao.type=0;rewardYuanbao.id=2;rewardYuanbao.count=0;for(var _i=0,rewards_5=rewards;_i<rewards_5.length;_i++){var reward=rewards_5[_i];if(reward.type==0){if(reward.id==0){rewardExp.count+=reward.count}else if(reward.id==1){rewardGold.count+=reward.count}else if(reward.id==2){rewardYuanbao.count+=reward.count}}}var displayRewards=[];if(rewardExp.count>0){displayRewards.push(rewardExp)}if(rewardGold.count>0){displayRewards.push(rewardGold)}if(rewardYuanbao.count>0){displayRewards.push(rewardYuanbao)}var mainJob=SubRoles.ins().getSubRoleByIndex(0).job;for(var _a=0,rewards_6=rewards;_a<rewards_6.length;_a++){var reward=rewards_6[_a];if(reward.type!=0||reward.type==0&&reward.id!=0&&reward.id!=1&&reward.id!=2){if(reward.job==null||reward.job==mainJob){displayRewards.push(reward)}}}ViewManager.ins().open(RewardWin,[displayRewards,t,onClose])};RewardWin.showAct=function(type,name,source,play,func,effmc,zlmodel,feijianModel,sqmc,wingmc,resDir){if(play===void 0){play=true}if(func===void 0){func=null}if(resDir===void 0){resDir=RES_DIR_EFF}var t=type==1?RewardWin.TYPE_JINJIE:RewardWin.TYPE_JIHUO;var content=new ActivationContent(type,name,source,play,func,effmc,zlmodel,feijianModel,sqmc,wingmc,resDir);ViewManager.ins().open(RewardWin,[[content],t,func])};RewardWin.onCloseOnces=[];RewardWin.TYPE_DEFAULT="RewardWinGXHD";RewardWin.TYPE_HUISHOU="RewardWinHSHD";RewardWin.TYPE_JIHUO="RewardWinJHCG";RewardWin.TYPE_JINJIE="RewardWinJJCG_png";RewardWin.TYPE_TONGGUAN="RewardWinTGLB";RewardWin.TYPE_GXHD2="RewardWinGXHD2";return RewardWin}(BaseEuiView);__reflect(RewardWin.prototype,"RewardWin");ViewManager.ins().reg(RewardWin,LayerManager.UI_Popup);var UserEquip=function(_super){__extends(UserEquip,_super);function UserEquip(){var _this=_super.call(this)||this;_this.priviRecycleYbSum=0;_this.equipCount=0;_this.ybCount=0;_this.stoneCount=0;_this.goldCount=0;_this.isFind=false;_this.posState=[0,0,0,0,0,0,0,0];_this.sysId=PackageID.Equip;_this.regNetMsg(1,_this.doUpDataEquip);_this.regNetMsg(2,_this.postSmeltEquipComplete);_this.regNetMsg(3,_this.doGrewupEquipResult);_this.regNetMsg(4,_this.doGrewupEquipResult);_this.regNetMsg(5,_this.postAddSpirit);_this.regNetMsg(7,_this.postAddSoul);_this.regNetMsg(8,_this.postZhiZunUpgrade);_this.regNetMsg(9,_this.postAutoSmeltFlag);_this.regNetMsg(10,_this.postActHuiShou);_this.observe(UserBag.ins().postItemChange,_this.delayCheckHaveCan);_this.observe(UserBag.ins().postItemAdd,_this.delayCheckHaveCan);_this.observe(UserBag.ins().postItemDel,_this.delayCheckHaveCan);_this.observe(UserBag.ins().postHuntStore,_this.delayCheckHaveCan);_this.observe(Actor.ins().postLevelChange,_this.delayCheckHaveCan);return _this}UserEquip.ins=function(){return _super.ins.call(this)};UserEquip.prototype.postActHuiShou=function(bytes){var equipCount=bytes.readInt();var ybCount=bytes.readInt();this.priviRecycleYbSum+=ybCount};UserEquip.prototype.sendAutoSmeltFlag=function(flag){if(flag===void 0){flag=0}var bytes=this.getBytes(9);bytes.writeInt(flag);this.sendToServer(bytes)};UserEquip.prototype.postAutoSmeltFlag=function(bytes){var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code!=0){console.log(i18n("UserEquip_0")+error_msg);return}var flag=bytes.readInt();console.log(i18n("UserEquip_1")+flag)};UserEquip.prototype.upgradeZhiZunEquip=function(roleId,subType){var bytes=this.getBytes(8);bytes.writeShort(roleId);bytes.writeShort(subType);this.sendToServer(bytes)};UserEquip.prototype.postZhiZunUpgrade=function(bytes){var roleId=bytes.readShort();var subType=bytes.readShort();var lv=bytes.readShort();var equipData=SubRoles.ins().getSubRoleByIndex(roleId).getEquipByIndex(subType);equipData.soulLv=lv};UserEquip.prototype.sendWearEquipment=function(itemHandle,pos,roleIndex){var bytes=this.getBytes(1);bytes.writeDouble(itemHandle);bytes.writeShort(roleIndex);bytes.writeShort(pos);this.sendToServer(bytes)};UserEquip.prototype.sendSmeltEquip=function(type,arr){var bytes=this.getBytes(2);bytes.writeInt(type);var pos=bytes.position;bytes.position+=4;var n=0;for(var i=0;i<arr.length;i++){if(arr[i]!=null){bytes.writeDouble(arr[i].handle);++n}}if(n==0)return false;bytes.position=pos;bytes.writeInt(n);this.sendToServer(bytes);return true};UserEquip.prototype.doUpDataEquip=function(bytes){var roleID=bytes.readShort();var equipPos=bytes.readShort();var item=new ItemData;item.parser(bytes);var role=SubRoles.ins().getSubRoleByIndex(roleID);var equip=role.getEquipByIndex(equipPos);equip.item=item;this.postEquipChange();if(equipPos==0||equipPos==2){var mainRole=EntityManager.ins().getEntityByHandle(role.handle);if(mainRole)mainRole.updateModel()}};UserEquip.prototype.postEquipChange=function(){return};UserEquip.prototype.clearRecycle=function(){this.equipCount=this.ybCount=this.stoneCount=this.goldCount=0;Activity.ins().activityRecycleYbSum=0;UserEquip.ins().priviRecycleYbSum=0};UserEquip.prototype.showRecycle=function(){if(this.ybCount<=0&&this.stoneCount<=0&&this.goldCount<=0){return}UserTips.ins().showRecycleTips3([this.equipCount,this.ybCount,this.stoneCount,this.goldCount]);var activityRecycleYbSum=Activity.ins().activityRecycleYbSum;if(activityRecycleYbSum>0){UserTips.ins().showRecycleTips3([this.equipCount,activityRecycleYbSum,0,0,"activity"])}var priviRecycleYbSum=UserEquip.ins().priviRecycleYbSum;if(priviRecycleYbSum>0){UserTips.ins().showRecycleTips3([this.equipCount,priviRecycleYbSum,0,0,"privilege"])}this.clearRecycle()};UserEquip.prototype.postSmeltEquipComplete=function(bytes){var state=bytes.readInt();if(state==0){UserTips.ins().showTips(i18n("UserEquip_2"));return}var equipCount=bytes.readInt();var ybCount=bytes.readInt();var stoneCount=bytes.readInt();var goldCount=bytes.readInt();this.equipCount+=equipCount;this.ybCount+=ybCount;this.stoneCount+=stoneCount;this.goldCount+=goldCount;var len=bytes.readInt();var arr=[];for(var i=0;i<len;i++){var idata={};idata.itemId=bytes.readInt();idata.count=bytes.readInt();arr.push(idata)}return arr};UserEquip.contrastEquip=function(sourceItem,item){if(!sourceItem||sourceItem.handle==0)return item;if(!item||item.handle==0)return sourceItem;var sourceItemScore=sourceItem.point;var itemScore=item.point;if(itemScore>sourceItemScore)return item;else return sourceItem};UserEquip.prototype.postEquipCheckList=function(param){return param};UserEquip.prototype.getEquipsByJobNPos=function(job,pos){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var roles=SubRoles.ins().getSubRoleByIndex(i);if(roles.job==job)return roles.getEquipByIndex(pos)}return null};UserEquip.prototype.getEquipConfigIDByPosAndQuality=function(equipPos,quality,job){if(job===void 0){job=1}var zhuan=UserZs.ins().lv||0;var level=Actor.level;var configID=1e5+1+equipPos*1e4+quality*100+1e3*job;for(var i=2;i<99;i++){var id=1e5+i+equipPos*1e4+quality*100+1e3*job;var config=GlobalConfig.ItemConfig[id];if(config!=undefined){var equipZhuan=config.zsLevel?config.zsLevel:0;var equipLevel=config.level?config.level:1;if(equipZhuan<=zhuan&&equipLevel<=level){configID=id}else{break}}else{break}}return configID};UserEquip.prototype.getEquipConfigIDByPosAndQualityByLegend=function(roleId,equipPos,quality,job){if(job===void 0){job=1}var zhuan=UserZs.ins().lv||0;var level=Actor.level;var configID=1e5+1+equipPos*1e4+quality*100+1e3*job;var role=SubRoles.ins().getSubRoleByIndex(roleId);var equipsData=role.getEquipByIndex(equipPos);for(var i=1;i<99;i++){var id=1e5+i+equipPos*1e4+quality*100+1e3*job;var config=GlobalConfig.ItemConfig[id];if(config!=undefined){var equipZhuan=config.zsLevel?config.zsLevel:0;var equipLevel=config.level?config.level:1;if(equipZhuan<=zhuan&&equipLevel<=level){if(equipsData&&equipsData.item.configID){var power=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[id]);var power2=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[equipsData.item.configID]);if(power2<power){configID=id;break}}else configID=id}else{break}}else{break}}return configID};UserEquip.prototype.getEquipConfigIDByPosAndQualityByGod=function(role,equipPos,quality,job){if(job===void 0){job=1}var zhuan=UserZs.ins().lv||0;var level=Actor.level;var configID0=-1;var configID=1e5+1+equipPos*1e4+quality*100+1e3*job;var gotBetter=false;var equipsData=role.getEquipByIndex(equipPos);for(var i=2;i<99;i++){var id=1e5+i+equipPos*1e4+quality*100+1e3*job;var config=GlobalConfig.ItemConfig[id];if(config!=undefined){var equipZhuan=config.zsLevel?config.zsLevel:0;var equipLevel=config.level?config.level:1;if(equipZhuan<=zhuan&&equipLevel<=level){if(equipsData&&equipsData.item.configID){var power=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[id]);var power2=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[equipsData.item.configID]);if(power2<=power){configID0=id}if(power2<power){configID=id;gotBetter=true;break}}else configID=id}else{break}}else{break}}if(!gotBetter&&configID0!=-1){configID=configID0}return configID};UserEquip.prototype.checkEquipsIsWear=function(item){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role.job!=ItemConfig.getJob(item.itemConfig)&&ItemConfig.getJob(item.itemConfig)!=0)continue;var equipLen=role.getEquipLen();for(var j=0;j<equipLen;j++){if(item.handle==role.getEquipByIndex(j).item.handle){return true}}}return false};UserEquip.prototype.doGrewupEquipResult=function(bytes){var roleId=bytes.readShort();var result=bytes.readInt();var configID=bytes.readInt();if(ItemConfig.getQuality(GlobalConfig.ItemConfig[configID])==4){this.postMixEquip(roleId,result,configID)}else{this.postMixGodEquip(roleId,result,configID)}};UserEquip.prototype.postMixEquip=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}return params};UserEquip.prototype.postMixGodEquip=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}return params};UserEquip.prototype.sendGrewupEquip=function(roleID,pos,isLegend){if(isLegend===void 0){isLegend=1}var bytes=this.getBytes(3);bytes.writeShort(roleID);bytes.writeShort(pos);bytes.writeShort(isLegend);this.sendToServer(bytes)};UserEquip.prototype.sendMixEquip=function(roleID,configID,pos){var bytes=this.getBytes(4);bytes.writeShort(roleID);bytes.writeInt(configID);bytes.writeInt(pos);this.sendToServer(bytes)};UserEquip.prototype.delayCheckHaveCan=function(){if(!TimerManager.ins().isExists(this.postCheckHaveCan,this))TimerManager.ins().doTimer(60,1,this.postCheckHaveCan,this)};UserEquip.prototype.postCheckHaveCan=function(){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){this.isFind=this.checkRedPoint(4,i);if(this.isFind)break}if(!this.isFind){for(var a=0;a<len;a++){for(var i=0;i<8;i++){this.isFind=this.setOrangeEquipItemState(i,SubRoles.ins().getSubRoleByIndex(a));if(this.isFind)return 1}}}if(!this.isFind){for(var i=0;i<len;i++){this.isFind=this.checkRedPoint(5,i);if(this.isFind)break}if(!this.isFind){for(var a=0;a<len;a++){for(var i=0;i<2;i++){this.isFind=this.setLegendEquipItemUpState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(a));this.isFind=this.setLegendEquipItemState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(a))||this.isFind;if(this.isFind)return 1}}}}if(!this.isFind){this.isFind=Boolean(UserBag.ins().getHuntGoods(0).length)}return this.isFind?1:0};UserEquip.prototype.checkRedPointEx=function(qualty,roleId){var itemList=UserBag.ins().getBagEquipsByQuality(qualty);var len=itemList.length;for(var i=0;i<len;i++){var job=void 0;var role=void 0;if(!isNaN(roleId)){job=ItemConfig.getJob(itemList[i].itemConfig);role=SubRoles.ins().getSubRoleByIndex(roleId);if(role.job!=job)return false}if(!role)return false;var id=this.getEquipConfigIDByPosAndQualityByGod(role,ItemConfig.getSubType(itemList[i].itemConfig),ItemConfig.getQuality(itemList[i].itemConfig));var fitConfig=GlobalConfig.ItemConfig[id];if(!fitConfig)continue;var equipZsLevel=itemList[i].itemConfig.zsLevel?itemList[i].itemConfig.zsLevel:0;var equipLevel=itemList[i].itemConfig.level?itemList[i].itemConfig.level:0;var fitZsLevel=fitConfig.zsLevel?fitConfig.zsLevel:0;var fitLevel=fitConfig.level?fitConfig.level:0;var L=equipZsLevel*1e4+equipLevel;var fitL=fitZsLevel*1e4+fitLevel;if(fitL>L){if(qualty==4){var curNum=UserBag.ins().getBagGoodsCountById(0,id);var comConfig=GlobalConfig.LegendComposeConfig[id];var needNum=comConfig?comConfig.count:0;if(curNum>=needNum)return true}else{return true}}}return false};UserEquip.prototype.checkRedPointExOrg=function(qualty,roleId){var itemList=UserBag.ins().getBagEquipsByQuality(qualty);var len=itemList.length;if(len){this.checkRedPoint(qualty,roleId)}else{if(isNaN(roleId)){if(this.IsEnoughChip(roleId))return true}else{for(var i=0;i<SubRoles.ins().subRolesLen;i++){if(this.IsEnoughChip(i))return true}}}return false};UserEquip.prototype.IsEnoughChip=function(roleId){var arr=[EquipPos.WEAPON,EquipPos.CLOTHES];var role=SubRoles.ins().getSubRoleByIndex(roleId);for(var j=0;j<arr.length;j++){var mixConfig=this.getMixConfig(role.index,arr[j]);if(!mixConfig)continue;var needNum=mixConfig.count;var costID=mixConfig.itemId;var curNum=UserBag.ins().getBagGoodsCountById(0,costID);if(curNum>=needNum){return true}}return false};UserEquip.prototype.getMixConfig=function(roleId,pos){var role=SubRoles.ins().getSubRoleByIndex(roleId);var configId=this.getEquipConfigIDByPosAndQualityByLegend(role.index,pos,5);var mixConfig=GlobalConfig.LegendComposeConfig[configId];return mixConfig};UserEquip.prototype.checkRedPoint=function(qualty,roleId){var itemList=UserBag.ins().getBagEquipsByQuality(qualty);var len=itemList.length;for(var i=0;i<len;i++){var job=void 0;var role=void 0;if(!isNaN(roleId)){job=ItemConfig.getJob(itemList[i].itemConfig);role=SubRoles.ins().getSubRoleByIndex(roleId);if(role.job!=job)return false}if(!role)return false;var id=this.getEquipConfigIDByPosAndQualityByGod(role,ItemConfig.getSubType(itemList[i].itemConfig),ItemConfig.getQuality(itemList[i].itemConfig));var fitConfig=GlobalConfig.ItemConfig[id];if(!fitConfig)continue;var equipZsLevel=itemList[i].itemConfig.zsLevel?itemList[i].itemConfig.zsLevel:0;var equipLevel=itemList[i].itemConfig.level?itemList[i].itemConfig.level:0;var fitZsLevel=fitConfig.zsLevel?fitConfig.zsLevel:0;var fitLevel=fitConfig.level?fitConfig.level:0;var L=equipZsLevel*1e4+equipLevel;var fitL=fitZsLevel*1e4+fitLevel;if(fitL>L){return true}}return false};UserEquip.prototype.setOrangeEquipItemState=function(index,role){var equipData=role.getEquipByIndex(index);var nextConfig;if(equipData.item.itemConfig&&ItemConfig.getQuality(equipData.item.itemConfig)<4)nextConfig=null;else nextConfig=GlobalConfig.ItemConfig[equipData.item.configID+1];var needNum=0;var costID=0;if(equipData.item.itemConfig&&ItemConfig.getQuality(equipData.item.itemConfig)==4&&equipData.item.itemConfig.zsLevel>=13)return false;if(equipData.item.itemConfig&&ItemConfig.getQuality(equipData.item.itemConfig)==5)return false;if(nextConfig!=null&&(nextConfig.level>Actor.level||nextConfig.zsLevel>UserZs.ins().lv))return false;if(nextConfig!=undefined&&equipData.item.handle!=0&&ItemConfig.getQuality(equipData.item.itemConfig)==4&&equipData.item.itemConfig.level!=1&&UserBag.fitleEquip.indexOf(equipData.item.configID)==-1){var grewupConfig=GlobalConfig.LegendLevelupConfig[equipData.item.configID];if(grewupConfig){needNum=grewupConfig.count;costID=grewupConfig.itemId}}else{var configId=UserEquip.ins().getEquipConfigIDByPosAndQualityByGod(role,index,4,role.job);var equipsData=role.getEquipByIndex(index);if(equipsData&&equipsData.item.configID){var power=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[configId]);var power2=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[equipsData.item.configID]);if(power2>power){return false}}var mixConfig=GlobalConfig.LegendComposeConfig[configId];if(mixConfig){needNum=mixConfig.count;costID=mixConfig.itemId}}var curNum=UserBag.ins().getBagGoodsCountById(0,costID);return curNum>=needNum};UserEquip.prototype.setLegendEquipItemState=function(index,role){var equipData=role.getEquipByIndex(index);var nextConfig=null;var q=ItemConfig.getQuality(equipData.item.itemConfig);if(equipData.item.itemConfig&&q==5){if(equipData.item.itemConfig.zsLevel>=10)return false;nextConfig=GlobalConfig.ItemConfig[equipData.item.configID+1]}else{nextConfig=null}var needNum=0;var costID=0;if(nextConfig!=null&&nextConfig.zsLevel>UserZs.ins().lv)return false;if(nextConfig!=null&&equipData.item.handle!=0&&q==5){var grewupConfig=GlobalConfig.LegendLevelupConfig[equipData.item.configID];needNum=grewupConfig.count;costID=grewupConfig.itemId}else{var configId=this.getEquipConfigIDByPosAndQualityByLegend(role.index,index,5);var mixConfig=GlobalConfig.LegendComposeConfig[configId];if(!mixConfig)return false;needNum=mixConfig.count;costID=mixConfig.itemId}var curNum=UserBag.ins().getBagGoodsCountById(0,costID);if(UserZs.ins().lv>=3)return curNum>=needNum;else return false};UserEquip.prototype.setLegendEquipItemUpState=function(index,role){var equipData=role.getEquipByIndex(index);var nextEquipData=GlobalConfig.ItemConfig[equipData.item.configID+1];var q=ItemConfig.getQuality(equipData.item.itemConfig);if(nextEquipData==undefined&&equipData.item.handle!=0&&q==5){return false}else{if(nextEquipData!=undefined&&equipData.item.handle!=0&&q==5){var configID=role.getEquipByIndex(index).item.configID;var nextEquipConfig=GlobalConfig.ItemConfig[configID+1];if(nextEquipConfig.level>Actor.level||nextEquipConfig.zsLevel>UserZs.ins().lv){return false}var grewupConfig=GlobalConfig.LegendLevelupConfig[configID];var curNum=UserBag.ins().getBagGoodsCountById(0,grewupConfig.itemId);return curNum>=grewupConfig.count}else{return false}}};UserEquip.prototype.getLegendEquipItemUpMax=function(roleId){for(var i=0;i<8;i++){if(i!=0&&i!=2)continue;var equipData=SubRoles.ins().getSubRoleByIndex(roleId).getEquipByIndex(i);if(!equipData)return true;var nextEquipData=GlobalConfig.ItemConfig[equipData.item.configID+1];var q=ItemConfig.getQuality(equipData.item.itemConfig);if(nextEquipData==undefined&&equipData.item.handle!=0&&q==5){}else{return false}}return true};UserEquip.prototype.requestAddSpirit=function(roleIndex,equipIndex,equipAry){var bytes=this.getBytes(5);bytes.writeShort(roleIndex);bytes.writeShort(equipIndex);bytes.writeShort(equipAry.length);for(var i=0;i<equipAry.length;i++){bytes.writeDouble(equipAry[i])}this.sendToServer(bytes)};UserEquip.prototype.postAddSpirit=function(bytes){var roleId=bytes.readShort();var equipIndex=bytes.readShort();var lv=bytes.readShort();var exp=bytes.readInt();var equipData=SubRoles.ins().getSubRoleByIndex(roleId).getEquipByIndex(equipIndex);equipData.spiritLv=lv;equipData.spiritExp=exp};UserEquip.prototype.requestAddSoul=function(roleIndex,equipIndex){var bytes=this.getBytes(7);bytes.writeShort(roleIndex);bytes.writeShort(equipIndex);this.sendToServer(bytes)};UserEquip.prototype.postAddSoul=function(bytes){var roleId=bytes.readShort();var equipIndex=bytes.readShort();var lv=bytes.readShort();var equipData=SubRoles.ins().getSubRoleByIndex(roleId).getEquipByIndex(equipIndex);equipData.soulLv=lv};UserEquip.FOEGE_MAX=8;return UserEquip}(BaseSystem);__reflect(UserEquip.prototype,"UserEquip");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userEquip=UserEquip.ins.bind(UserEquip)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UserJingMai=function(_super){__extends(UserJingMai,_super);function UserJingMai(){var _this=_super.call(this)||this;_this.sysId=PackageID.JingMai;_this.regNetMsg(1,_this.doUpData);_this.regNetMsg(4,_this.doBigUpLevel);return _this}UserJingMai.ins=function(){return _super.ins.call(this)};UserJingMai.prototype.sendBoost=function(roleId){var bytes=this.getBytes(1);bytes.writeShort(roleId);this.sendToServer(bytes)};UserJingMai.prototype.sendUpgrade=function(roleId){var bytes=this.getBytes(2);bytes.writeShort(roleId);this.sendToServer(bytes)};UserJingMai.prototype.doUpData=function(bytes){var index=bytes.readShort();SubRoles.ins().getSubRoleByIndex(index).jingMaiData.parser(bytes);this.postUpdate()};UserJingMai.prototype.postUpdate=function(){};UserJingMai.prototype.sendBigUpLevel=function(role){var bytes=this.getBytes(4);bytes.writeInt(role);this.sendToServer(bytes)};UserJingMai.prototype.doBigUpLevel=function(bytes){var result=bytes.readInt();var str;if(!result){var type=bytes.readInt();if(!type)str=i18n("UserJingMai_0")}else{str=i18n("UserJingMai_1")}if(str)UserTips.ins().showTips(str)};UserJingMai.prototype.canGradeupJingMai=function(){var boolList=[false,false,false];var config;var costNum=0;var itemNum=0;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);config=GlobalConfig.JingMaiLevelConfig[role.jingMaiData.level];costNum=config.count;if(costNum){var num=UserBag.ins().getBagGoodsCountById(0,200103);if(num){boolList[i]=true;break}itemNum=UserBag.ins().getBagGoodsCountById(0,config.itemId);boolList[i]=itemNum>=costNum}else{boolList[i]=false}}return boolList};return UserJingMai}(BaseSystem);__reflect(UserJingMai.prototype,"UserJingMai");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userJingMai=UserJingMai.ins.bind(UserJingMai)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UserRole=function(_super){__extends(UserRole,_super);function UserRole(){var _this=_super.call(this)||this;_this.timeID=0;_this.canChangeEquips=[[],[],[]];_this.observe(UserBag.ins().postItemChange,_this.startCheckHaveCan);_this.observe(UserBag.ins().postItemAdd,_this.startCheckHaveCan);_this.observe(UserBag.ins().postItemDel,_this.startCheckHaveCan);_this.observe(Actor.ins().postLevelChange,_this.startCheckHaveCan);_this.observe(GameLogic.ins().postSubRoleChange,_this.startCheckHaveCan);_this.observe(UserEquip.ins().postEquipChange,_this.startCheckHaveCan);_this.observe(JadeNew.ins().postJadeData,_this.startCheckHaveCan);_this.observe(LyMark.ins().postMarkData,_this.startCheckHaveCan);_this.observe(Wing.ins().postUseDanSuccess,_this.startCheckHaveCan);_this.observe(Wing.ins().postWingUpgrade,_this.startCheckHaveCan);_this.observe(Actor.ins().postGoldChange,_this.delayShowNavBtnRedPoint);_this.observe(GameLogic.ins().postRuneExchange,_this.delayShowNavBtnRedPoint);_this.observe(GameLogic.ins().postRuneShatter,_this.delayShowNavBtnRedPoint);_this.observe(UserBag.ins().postHuntStore,_this.delayShowNavBtnRedPoint);_this.observe(UserFb.ins().postFbRingInfo,_this.delayShowNavBtnRedPoint);_this.observe(DressCollectionMgr.ins().postDressCollectionInfo,_this.delayShowNavBtnRedPoint);return _this}UserRole.prototype.startCheckHaveCan=function(isWear,roleIndex){var _this=this;if(isWear===void 0){isWear=false}if(roleIndex===void 0){roleIndex=-1}if(this.timeID)return;this.timeID=1;TimerManager.ins().doTimer(50,1,function(){_this.checkHaveCan(isWear,roleIndex)},this)};UserRole.ins=function(){return _super.ins.call(this)};UserRole.prototype.checkHaveCan=function(isWear,roleIndex){if(isWear===void 0){isWear=false}if(roleIndex===void 0){roleIndex=-1}this.timeID=0;var equipItems=UserBag.ins().getBagEquipByType(0);if(!equipItems)return;var sr=SubRoles.ins();var startIndex=roleIndex>=0?roleIndex:0;var endIndex=roleIndex>=0?roleIndex+1:sr.subRolesLen;var tempChangeEquips=[[],[],[]];var slen=sr.subRolesLen;for(var i=0;i<slen;i++){for(var _i=0,_a=sr.getSubRoleByIndex(i).equipsData;_i<_a.length;_i++){var equip=_a[_i];tempChangeEquips[i].push(equip.item)}}for(var _b=0,equipItems_1=equipItems;_b<equipItems_1.length;_b++){var item=equipItems_1[_b];for(var j=startIndex;j<endIndex;j++){var job=ItemConfig.getJob(item.itemConfig);if(job!=0&&SubRoles.ins().getSubRoleByIndex(j).job!=job)continue;if(UserZs.ins().lv<item.itemConfig.zsLevel)continue;if(Actor.level<item.itemConfig.level)continue;var lowEquipIndex=UserBag.ins().getLowEquipIndex(tempChangeEquips[j],ItemConfig.getSubType(item.itemConfig));if(lowEquipIndex>=0)tempChangeEquips[j][lowEquipIndex]=this.contrastEquip(tempChangeEquips[j][lowEquipIndex]||sr.getSubRoleByIndex(j).equipsData[lowEquipIndex].item,item)}}var len=tempChangeEquips.length;for(var i=0;i<len;i++){for(var j=0;j<tempChangeEquips[i].length;j++){this.canChangeEquips[i][j]=false;if(tempChangeEquips[i][j]&&tempChangeEquips[i][j].handle!=sr.getSubRoleByIndex(i).equipsData[j].item.handle){if(isWear&&roleIndex==i){UserEquip.ins().sendWearEquipment(tempChangeEquips[i][j].handle,j,roleIndex);this.canChangeEquips[i][j]=false}else{this.canChangeEquips[i][j]=true}}}if(this.canChangeEquips[i].indexOf(true)<0)this.canChangeEquips[i].length=0}this.showNavBtnRedPoint()};UserRole.prototype.contrastEquip=function(sourceItem,item){if(!sourceItem||sourceItem.handle==0)return item;if(!item||item.handle==0)return sourceItem;var sourceItemScore=sourceItem.point;var itemScore=item.point;if(itemScore>sourceItemScore)return item;else return sourceItem};UserRole.prototype.getCanChangeEquips=function(){for(var i=0;i<this.canChangeEquips.length;i++){for(var j=0;j<this.canChangeEquips[i].length;j++){if(this.canChangeEquips[i][j]){return true}}}return false};UserRole.prototype.delayShowNavBtnRedPoint=function(){if(!TimerManager.ins().isExists(this.showNavBtnRedPoint,this))TimerManager.ins().doTimer(60,1,this.showNavBtnRedPoint,this)};UserRole.prototype.showNavBtnRedPoint=function(b){if(b===void 0){b=false}for(var i=0;i<this.canChangeEquips.length;i++){for(var j=0;j<this.canChangeEquips[i].length;j++){if(this.canChangeEquips[i][j]){b=true;break}}if(b)break}if(!b&&SamsaraModel.ins().isCanAddSpirit()){b=true}if(!b&&OpenSystem.ins().checkSysOpen(SystemType.RING)&&(SpecialRing.ins().checkHaveUpRing()||SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||LyMark.ins().checkRed()||SwordSkinMgr.ins().showRedPoint())){b=true}if(!b&&UserSkill.ins().canHejiEquip()){b=true}if(!b&&UserSkill.ins().canExchange()){b=true}if(!b&&UserSkill.ins().canSolve()){b=true}if(!b&&LongHun.ins().canShowRedPointInAll()){b=true}else if(!b&&UserZs.ins().canOpenZSWin()&&!UserZs.ins().isMaxLv()&&(UserZs.ins().canGet()>0||UserZs.ins().canUpgrade())){b=true}else if(!b&&this.and(Wing.ins().canGradeupWing())||this.and(Wing.ins().canItemGradeupWing())||Wing.ins().isHaveActivationWing()){b=true}if(!b&&Dress.ins().redPoint()){b=true}if(!b&&RuneRedPointMgr.ins().checkAllSituation(false)){b=true}if(!b){var len=SubRoles.ins().subRolesLen;for(var a=0;a<len;a++){var model=SubRoles.ins().getSubRoleByIndex(a);for(var i=0;i<8;i++){var equipItem=this["equip"+i];b=UserEquip.ins().setOrangeEquipItemState(i,model);if(!b&&i<2)b=UserEquip.ins().setLegendEquipItemState(i>0?2:0,model);if(b){var eb=UserBag.ins().checkEqRedPoint(i,model);b=eb!=null?eb:b}if(b)break}if(b)break}if(!b)for(var i=0;i<len;i++){b=UserEquip.ins().checkRedPointEx(5,i);if(b)break}if(!b)b=UserBag.ins().getLegendHasResolve();if(!b)b=Boolean(UserBag.ins().getHuntGoods(0).length)}if(!b)b=SubRoles.ins().isLockRole();if(!b)b=GodWingRedPoint.ins().getGodWingRedPoint();if(!b)b=SamsaraModel.ins().isCanUpgrade()||SamsaraModel.ins().isCanExchange()||SamsaraModel.ins().isCanUpgradeSoul();if(!b)b=JadeNew.ins().checkRed();if(!b)b=Wing.ins().canUseFlyUp();if(!b)b=Wing.ins().canUseAptitude();this.postRoleHint(b)};UserRole.prototype.postRoleHint=function(b){return b?1:0};UserRole.prototype.and=function(list){for(var k in list){if(list[k]==true)return true}return false};UserRole.prototype.seekRoleItem=function(){var isReturn=false;var len=UserBag.ins().getBagItemNum(0);for(var i=0;i<len;i++){if(isReturn)return isReturn;var item=UserBag.ins().getBagGoodsByIndex(0,i);switch(item.itemConfig.id){case 200001:break;case 200004:isReturn=this.roleHint(5);break;case 200013:isReturn=this.roleHint(0);break;case 200014:isReturn=this.roleHint(1);break}}return isReturn};UserRole.prototype.roleHint=function(type){var len=SubRoles.ins().subRolesLen;var flag=false;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);flag=this.roleHintCheck(role,type);if(flag){return flag}}return flag};UserRole.prototype.roleHintCheck=function(role,type){var lv=1;var costNum=0;var itemNum=0;var itemId=0;switch(type){case 0:lv=role.getExRingsData(0);var ring0Config=GlobalConfig["ExRing"+0+"Config"][lv];if(GlobalConfig["ExRing"+0+"Config"][lv+1]==null)return false;if(ring0Config){costNum=ring0Config.cost;itemId=GlobalConfig.ExRingConfig[0].costItem}break;case 1:lv=role.getExRingsData(1);var ring1Config=GlobalConfig["ExRing"+1+"Config"][lv];if(GlobalConfig["ExRing"+1+"Config"][lv+1]==null)return false;if(ring1Config){costNum=ring1Config.cost;itemId=GlobalConfig.ExRingConfig[1].costItem}break;case LongHun.TYPE_LONG_HUN:lv+=role.loongSoulData.level;var loongSoulConfig=GlobalConfig.LoongSoulConfig[lv];var loongSoulStageConfig=GlobalConfig.LoongSoulStageConfig[role.loongSoulData.stage];if(loongSoulConfig){costNum=loongSoulStageConfig.normalCost;itemId=loongSoulConfig.itemId}break;case LongHun.TYPE_HU_DUN:lv+=role.shieldData.level;var shieldConfig=GlobalConfig.ShieldConfig[lv];var shieldStageConfig=GlobalConfig.ShieldStageConfig[role.loongSoulData.stage];if(shieldConfig){costNum=shieldStageConfig.normalCost;itemId=shieldConfig.itemId}break;case 5:lv=role.jingMaiData.level;var jingMaiConfig=GlobalConfig.JingMaiLevelConfig[lv];if(jingMaiConfig){costNum=jingMaiConfig.count;itemId=jingMaiConfig.itemId}break}if(costNum){itemNum=UserBag.ins().getBagGoodsCountById(0,itemId);if(itemNum>=costNum)return true}return false};UserRole.prototype.setCanChange=function(){var roleWin=ViewManager.ins().getView(RoleWin);if(roleWin){roleWin.roleInfoPanel.setCanChange(this.canChangeEquips);roleWin.canChangeEquips=this.canChangeEquips}};UserRole.oneKeyOpenLevel=60;return UserRole}(BaseSystem);__reflect(UserRole.prototype,"UserRole");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userRole=UserRole.ins.bind(UserRole)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UserSkill=function(_super){__extends(UserSkill,_super);function UserSkill(){var _this=_super.call(this)||this;_this.hejiLevel=-1;_this.hejiCD=0;_this.hejiEnable=false;_this.isFirst=true;_this.fieldUse=false;_this.equipListData=[];_this.hejiProgressList=[];_this.reduceCD=0;_this.sysId=PackageID.Skill;_this.regNetMsg(1,_this.doSkillResult);_this.regNetMsg(2,_this.postDoBuff);_this.regNetMsg(3,_this.postDoRemoveBuff);_this.regNetMsg(6,_this.doAddEffect);_this.regNetMsg(7,_this.doRemoveEffect);_this.regNetMsg(4,_this.postSkillUpgrade);_this.regNetMsg(5,_this.postSkillUpgradeAll);_this.regNetMsg(9,_this.postHejiInfo);_this.regNetMsg(10,_this.doHejiEquipInfo);_this.regNetMsg(11,_this.doHejiEquipUpdate);_this.regNetMsg(12,_this.doHejiUpdateInfo);_this.regNetMsg(13,_this.postUpgradeForge);return _this}Object.defineProperty(UserSkill,"descArr",{get:function(){var _descArr=this._descArr;if(_descArr==null){_descArr=[i18n("UserSkill_0"),i18n("UserSkill_1"),i18n("UserSkill_2")];this._descArr=_descArr}return _descArr},enumerable:true,configurable:true});UserSkill.ins=function(){return _super.ins.call(this)};UserSkill.prototype.getPunchForge=function(){if(!this.punchEquipForge)this.punchEquipForge=new PunchEquipForgeData;return this.punchEquipForge};UserSkill.prototype.sendUseSkill=function(suorceHandle,handle,skillID){var bytes=this.getBytes(1);bytes.writeDouble(suorceHandle);bytes.writeDouble(handle);bytes.writeInt(skillID);this.sendToServer(bytes)};UserSkill.prototype.doSkillResult=function(bytes){var sourceHandle=bytes.readDouble();var skillID=bytes.readInt();var targetHandle=bytes.readDouble();var charSource=EntityManager.ins().getEntityByHandle(sourceHandle);if(!charSource){return}var charTarget=EntityManager.ins().getEntityByHandle(targetHandle);if(!charTarget){return}if(!charTarget.parent&&charSource.isMy){EntityShowMgr.ins().showHideSomeOne(targetHandle)}if(!charSource.parent&&charTarget.isMy){EntityShowMgr.ins().showHideSomeOne(sourceHandle)}if(!charSource.parent){return}var skillCfg=new SkillData(skillID);var damageType=0;if(Math.floor(skillID/1e4)==7){damageType=DamageTypes.Heji}var count=bytes.readShort();var handle;var type;var value;if(charSource.isMy){charTarget.showBlood(true);charTarget.showName(true)}if(charTarget.isMy){charSource.showBlood(true);charSource.showName(true)}var infoList=[];var info=[];for(var i=0;i<count;i++){handle=bytes.readDouble();info=[handle];infoList[i]=info}if(AIUtil.ins().userSkill(charSource,charTarget,skillCfg)){}if(charSource instanceof CharRole&&GuildWar.ins().getModel().checkinAppoint(2,true)&&SubRoles.ins().getIsMyPlayer(targetHandle)&&charSource.infoModel.name){GuildWar.ins().getModel().changeWeiXieList(charSource.infoModel.masterHandle,true,charSource.infoModel.name)}};UserSkill.prototype.postDoBuff=function(bytes){var handle=bytes.readDouble();var char=EntityManager.ins().getEntityByHandle(handle);if(char){var buff=ObjectPool.pop("EntityBuff");buff.effConfig=GlobalConfig.EffectsConfig[bytes.readInt()];buff.value=0;buff.addTime=egret.getTimer();char.addBuff(buff)}};UserSkill.prototype.postDoRemoveBuff=function(bytes){var handle=bytes.readDouble();var char=EntityManager.ins().getEntityByHandle(handle);if(char){var id=GlobalConfig.EffectsConfig[bytes.readInt()].group;if(char.hasBuff(id))char.removeBuff(char.buffList[id])}};UserSkill.prototype.doAddEffect=function(bytes){var handle=bytes.readDouble();var char=EntityManager.ins().getEntityByHandle(handle);if(char){var id=bytes.readInt();char.addEffect(id)}};UserSkill.prototype.doRemoveEffect=function(bytes){var handle=bytes.readDouble();var char=EntityManager.ins().getEntityByHandle(handle);if(char)char.removeEffect(bytes.readInt())};UserSkill.prototype.sendGrewUpSkill=function(roleId,skillID){var bytes=this.getBytes(4);bytes.writeShort(roleId);bytes.writeShort(skillID);this.sendToServer(bytes)};UserSkill.prototype.postSkillUpgrade=function(bytes){var roleId=bytes.readShort();var skillID=bytes.readShort();var level=bytes.readShort();var role=SubRoles.ins().getSubRoleByIndex(roleId);var lastLevel=role.skillsData[skillID].lv;role.skillsData[skillID]=SkillData.getSkillByJob(role.job,skillID+1,level);if(lastLevel==0&&level!=0){UserTips.ins().showSkillTips(role.skillsData[skillID].configID)}return[roleId,skillID,level]};UserSkill.prototype.sendGrewUpAllSkill=function(roleId,isAll,skillID){if(isAll===void 0){isAll=true}if(skillID===void 0){skillID=0}var bytes=this.getBytes(5);bytes.writeShort(isAll?1:0);bytes.writeShort(roleId);bytes.writeShort(skillID);this.sendToServer(bytes)};UserSkill.prototype.postSkillUpgradeAll=function(bytes){var roleId=bytes.readShort();var role=SubRoles.ins().getSubRoleByIndex(roleId);var old=role.skillsData;role.skillsData=[];for(var i=0;i<5;i++){role.skillsData.push(SkillData.getSkillByJob(role.job,i+1,bytes.readShort()))}return[old,roleId]};UserSkill.prototype.postHejiInfo=function(bytes){var hejiLevel=bytes.readUnsignedInt();var cd=bytes.readUnsignedInt();var isAct=false;if(this.hejiLevel==-1&&hejiLevel==1){isAct=true}if(this.hejiLevel!=hejiLevel){this.hejiLevel=hejiLevel;this.postHejiUpdate()}this.setHejiCD(cd);return{isAct:isAct}};UserSkill.prototype.doHejiEquipInfo=function(bytes){this.equipListData=[];var equip;for(var i=0;i<8;i++){equip=new ItemData;equip.parser(bytes);this.equipListData.push(equip)}this.setQimingInfo();this.postHejiEquipChange()};UserSkill.prototype.setQimingInfo=function(){this.qimingEquipDic={};if(!this.qmArr){this.qmArr=[];var td=GlobalConfig.TogetherHitEquipQmConfig;for(var tZs in td){for(var tLv in td[tZs]){if(!isNaN(Number(tZs))&&!isNaN(Number(tLv))){var tNum=Number(tZs)*1e4+Number(tLv);this.qmArr.push(tNum)}}}}for(var k in this.equipListData){if(this.equipListData[k].configID!=0){var item=this.equipListData[k].itemConfig;var lv=(item.zsLevel||0)*1e4+item.level;for(var j=0;j<this.qmArr.length;j++){if(lv<this.qmArr[j])continue;var tLv=this.qmArr[j];if(!this.qimingEquipDic[tLv]){this.qimingEquipDic[tLv]={num:0};this.qimingEquipDic[tLv].num=1}else{this.qimingEquipDic[tLv].num++}}}}this.setQmAttr()};UserSkill.prototype.setQmAttr=function(){var config=GlobalConfig.TogetherHitEquipQmConfig;this.qimingAttrDic={};for(var k in this.qimingEquipDic){var zsLv=Math.floor(Number(k)/1e4);var lv=Math.floor(Number(k)%1e4);var num=this.qimingEquipDic[k].num;var tempConfig=config[zsLv][lv];if(tempConfig){for(var i in tempConfig){if(num>=Number(i)){if(!this.qimingAttrDic[k])this.qimingAttrDic[k]={};this.qimingAttrDic[k][i]=tempConfig[i]}}}}this.qimingValueDic={};for(var k in this.qimingAttrDic){for(var l in this.qimingAttrDic[k]){var obj=this.qimingAttrDic[k][l];var totalAtt=obj.exAttr["0"];if(!this.qimingValueDic[l])this.qimingValueDic[l]=new Object;if(!this.qimingValueDic[l].value)this.qimingValueDic[l].value=0;this.qimingValueDic[l].type=totalAtt.type;this.qimingValueDic[l].value+=totalAtt.value}}};UserSkill.prototype.doHejiEquipUpdate=function(bytes){var pos=bytes.readShort();var equip=new ItemData;equip.parser(bytes);this.equipListData[pos]=equip;this.setQimingInfo();this.postHejiEquipChange()};UserSkill.prototype.checkHejiOpen=function(){var id=GlobalConfig.TogerherHitBaseConfig.actImbaId;if(Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(id))){return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(id)).open}return false};UserSkill.prototype.canHejiEquip=function(){if(UserSkill.ins().hejiLevel<=0)return false;if(Actor.level<UserSkill.HEJI_SHOW_LEVEL)return false;if(!this.equipListData)return false;for(var i=0;i<this.equipListData.length;i++){if(this.checkIsHaveBestEquip(i)){return true}}return false};UserSkill.prototype.canExchange=function(){if(UserSkill.ins().hejiLevel<=0)return false;if(Actor.level<UserSkill.HEJI_SHOW_LEVEL)return false;var cost;var maxZlv=this.getMaxzLv();for(var k in this.equipListData){var item=this.equipListData[k];if(item&&item.configID){for(var index=+k+1;;index+=8){var config=GlobalConfig.TogetherHitEquipExchangeConfig[index];if(!config){break}var lv=item.itemConfig.level?item.itemConfig.level:0;var zsLv=item.itemConfig.zsLevel?item.itemConfig.zsLevel:0;var tempLv=config.level;var tempZslv=config.zsLevel;var getItemId=config.getItem.id;if(tempLv<=lv&&tempZslv<=zsLv){continue}if(getItemId%1e4<=item.configID%1e4){continue}if(tempLv>Actor.level||tempZslv>UserZs.ins().lv){continue}if(tempZslv>maxZlv[0]||tempLv>maxZlv[1]){break}if(tempZslv>=zsLv){if(tempLv>=lv){cost=config.exchangeMaterial[0]["count"];if(config.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=cost){return true}else if(config.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=cost){return true}}}}}else{var tempData=GlobalConfig.TogetherHitEquipExchangeConfig[Number(k)+1];if(tempData){cost=tempData.exchangeMaterial[0]["count"];if(tempData.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=cost){return true}else if(tempData.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=cost){return true}}}}return false};UserSkill.prototype.getMaxzLv=function(){var maxLv=0;var zs=0;var lv=0;var dic=UserSkill.ins().qimingEquipDic;for(var lv_1 in dic){if(+lv_1>maxLv){maxLv=+lv_1}}zs=Math.floor(maxLv/1e4);lv=maxLv%1e4;if(maxLv==0||dic[maxLv].num==8){var config=GlobalConfig.TogetherHitEquipQmConfig;var zsArr=[];for(var z in config){zsArr.push(+z)}zsArr.sort(function(a,b){return a<b?-1:1});if(maxLv==0){zs=zsArr[0]}else{zs=zsArr[zsArr.indexOf(zs)+1];if(zs==undefined){zs=zsArr[zsArr.length-1]}}for(var v in config[zs]){lv=+v}}return[zs,lv]};UserSkill.prototype.getPunchExchangePageRedPoint=function(page){var cost;var maxZlv=this.getMaxzLv();for(var k in this.equipListData){var item=this.equipListData[k];if(item&&item.configID){if(page==1)continue;var oldIndex=+k+1+(page-2)*8;var config=GlobalConfig.TogetherHitEquipExchangeConfig[oldIndex];var getItemId=config.getItem.id;if(getItemId!=item.configID){continue}var index=+k+1+(page-1)*8;config=GlobalConfig.TogetherHitEquipExchangeConfig[index];if(config){var lv=item.itemConfig.level?item.itemConfig.level:0;var zsLv=item.itemConfig.zsLevel?item.itemConfig.zsLevel:0;var tempLv=config.level;var tempZslv=config.zsLevel;var getItemId_1=config.getItem.id;if(tempLv<=lv&&tempZslv<=zsLv){continue}if(getItemId_1%1e4<=item.configID%1e4){continue}if(tempLv>Actor.level||tempZslv>UserZs.ins().lv){continue}if(tempZslv>maxZlv[0]||tempLv>maxZlv[1]){continue}if(tempZslv>=zsLv){if(tempLv>=lv){cost=config.exchangeMaterial[0]["count"];if(config.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=cost){return true}else if(config.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=cost){return true}}}}}else if(page==1){var tempData=GlobalConfig.TogetherHitEquipExchangeConfig[Number(k)+1];if(tempData){cost=tempData.exchangeMaterial[0]["count"];if(tempData.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=cost){return true}else if(tempData.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=cost){return true}}}}return false};UserSkill.prototype.getPunchExchangeItemRedPoint=function(id){var index=(id-1)%8;var page=Math.ceil(id/8);var item=this.equipListData[index];var cost;if(page==1){if(item&&item.configID){return false}}else{if(!item||!item.configID){return false}var config=GlobalConfig.TogetherHitEquipExchangeConfig[id-8];if(config.getItem.id!=item.configID){return false}}var tempData=GlobalConfig.TogetherHitEquipExchangeConfig[id];if(tempData){if(tempData.zsLevel>UserZs.ins().lv||tempData.level>Actor.level){return false}cost=tempData.exchangeMaterial[0]["count"];if(tempData.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=cost){return true}else if(tempData.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=cost){return true}}return false};UserSkill.prototype.canAcitve=function(){return false};UserSkill.prototype.canSolve=function(){if(UserSkill.ins().hejiLevel<=0)return false;if(Actor.level<UserSkill.HEJI_SHOW_LEVEL)return false;var itemArr=[];UserBag.ins().checkHejiEquipsTodestroy(itemArr);if(itemArr.length)return true;return false};UserSkill.prototype.doHejiUpdateInfo=function(bytes){var len=bytes.readByte();this.hejiProgressList=[];for(var i=0;i<len;i++){var item=new HejiProgressData;item.parser(bytes);this.hejiProgressList[item.id-1]=item}};UserSkill.prototype.setHejiCD=function(cd){if(cd===void 0){cd=0}if(this.hejiLevel>0){var skill=UserSkill.ins().getHejiSkillId();this.reduceCD=0;var role=EntityManager.ins().getMainRole(0);if(role&&role.infoModel&&role.infoModel.getExAtt(ExAttributeType.eatTogetherHitCdSub)>0){this.reduceCD=role.infoModel.getExAtt(ExAttributeType.eatTogetherHitCdSub)/1e4*skill.cd}if(cd==-1){this.hejiCD=GameServer.serverTime+skill.cd-this.reduceCD}else{this.hejiCD=GameServer.serverTime+cd}this.postHejiStartCD()}};UserSkill.prototype.getHejiSkillId=function(){var config=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel];var model=SubRoles.ins().getSubRoleByIndex(0);if(!model){return new SkillData(GlobalConfig.SkillsConfig[config.skill_id[0]].id)}var curSkill=GlobalConfig.SkillsConfig[config.skill_id[model.job-1]];return new SkillData(curSkill.id)};UserSkill.prototype.getHejiSkillIdIcon=function(){var config=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel];var model=SubRoles.ins().getSubRoleByIndex(0);if(!model)model={job:1};var curSkill=GlobalConfig.SkillsConfig[config.skill_id[model.job-1]];var icon=Math.floor(curSkill.id/1e3)*1e3+"_png";return icon};UserSkill.prototype.getSkillIdIcon=function(id){var curSkill=GlobalConfig.SkillsConfig[id];var icon=Math.floor(curSkill.id/1e3)*1e3+"_png";return icon};UserSkill.prototype.sendGrewUpHejiSkill=function(){this.sendBaseProto(9)};UserSkill.prototype.sendUseHejiSkill=function(){this.sendBaseProto(10)};UserSkill.prototype.sendDressHejiEquip=function(equipId,pos){var bytes=this.getBytes(11);bytes.writeDouble(equipId);bytes.writeShort(pos);this.sendToServer(bytes)};UserSkill.prototype.sendExchangeHejiEquip=function(id){var bytes=this.getBytes(12);bytes.writeShort(id);this.sendToServer(bytes)};UserSkill.prototype.getWearEquipsData=function(pos){if(this.equipListData[pos])return this.equipListData[pos];return null};UserSkill.prototype.getSkillLimitLevel=function(){return UserZs.ins().lv>0?80+UserZs.ins().lv*10:Actor.level>80?80:Actor.level};UserSkill.prototype.getSingleSkillGrewUpCost=function(roleID,skillIndex){var limitLevel=this.getSkillLimitLevel();var singleSkillLevel=SubRoles.ins().getSubRoleByIndex(roleID).skillsData[skillIndex];var coin=Actor.gold;var cost=0;if(singleSkillLevel.lv>0){for(var i=singleSkillLevel.lv;i<limitLevel;i++){var cfg=GlobalConfig.SkillsUpgradeConfig[i];if(!cfg){continue}var upgradeCost=GlobalConfig.SkillsUpgradeConfig[i].cost;if(cost+upgradeCost>coin){return cost}else{cost+=upgradeCost}}return cost}return 0};UserSkill.prototype.canGrewupSkill=function(){var isOpens=[];var limitLevel=this.getSkillLimitLevel();var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);for(var j=0;j<role.skillsData.length;j++){var skillData=role.skillsData[j];if(skillData.lv>0&&limitLevel>skillData.lv){var cost=GlobalConfig.SkillsUpgradeConfig[skillData.lv].cost;if(Actor.gold>=cost){isOpens[i]=true;break}}}}return isOpens};UserSkill.prototype.canGrewupAllSkills=function(roleId){var skillMaxLevel=this.getSkillLimitLevel();var skillsLevel=SubRoles.ins().getSubRoleByIndex(roleId).skillsData;var isCan=false;var coin=Actor.gold;for(var i=0;i<skillsLevel.length;i++){var level=skillsLevel[i];if(level.configID==0)continue;var upgradeCof=GlobalConfig.SkillsUpgradeConfig[level.lv];if(upgradeCof){if(coin>=upgradeCof.cost&&level.configID!=skillMaxLevel)isCan=true}}if(isCan){for(var i=0;i<5;i++){var level=skillsLevel[i];if(level.lv>0){if(level.lv<UserSkill.ins().getSkillLimitLevel()){var costAllNum=UserSkill.ins().getSingleSkillGrewUpCost(roleId,i);if(costAllNum>0){return true}}}}return false}return isCan};UserSkill.prototype.postShowSkillWord=function(skillWord){return skillWord};UserSkill.prototype.postHejiUpdate=function(){};UserSkill.prototype.postHejiStartCD=function(){};UserSkill.prototype.postHejiRemove=function(){};UserSkill.prototype.postHejiEquipChange=function(){};UserSkill.prototype.checkIsHaveBestEquip=function(pos,roleIndex){if(roleIndex===void 0){roleIndex=-1}var wear=this.equipListData[pos];var itemList=UserBag.ins().getHejiEquipsByType(pos);if(itemList.length>0){var best=void 0;var level=200;for(var i=0;i<itemList.length;i++){best=itemList[i];var itemLv=best.itemConfig.level?best.itemConfig.level:0;var itemzsLv=best.itemConfig.zsLevel?best.itemConfig.zsLevel:0;if(best.itemConfig.level<=level&&(itemLv<=Actor.level||itemzsLv<=UserZs.ins().lv)&&best.itemConfig.level<=Actor.level&&itemzsLv<=UserZs.ins().lv){var wearPoint=0;if(wear&&wear.configID!=0){wearPoint=wear.point}else{if(!best.itemConfig.useCond){return true}else{continue}}var beatPoint=best.point;if(beatPoint>wearPoint&&best.itemConfig.useCond==wear.itemConfig.id){return true}}}}return false};UserSkill.prototype.sendUpgradeForge=function(pos){var bytes=this.getBytes(13);bytes.writeShort(pos);this.sendToServer(bytes)};UserSkill.prototype.postUpgradeForge=function(bytes){this.getPunchForge().parser(bytes)};UserSkill.prototype.sendChangeTogeatterHigh=function(num){var bytes=this.getBytes(14);bytes.writeInt(num);this.sendToServer(bytes)};UserSkill.prototype.isHejiSkill=function(id){for(var i in GlobalConfig.TogetherHitConfig){if(GlobalConfig.TogetherHitConfig[i].skill_id.indexOf(id)>=0)return true}return false};UserSkill.MAX_LEVEL=200;UserSkill.ACTIVE_LEVEL=10;UserSkill.HEJI_SKILL=7e4;UserSkill.HEJI_SHOW_LEVEL=60;return UserSkill}(BaseSystem);__reflect(UserSkill.prototype,"UserSkill");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userskill=UserSkill.ins.bind(UserSkill)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SHORT_SKILLID;(function(SHORT_SKILLID){SHORT_SKILLID[SHORT_SKILLID["MAGIC"]=24]="MAGIC";SHORT_SKILLID[SHORT_SKILLID["CURE"]=32]="CURE";SHORT_SKILLID[SHORT_SKILLID["POISONING"]=33]="POISONING";SHORT_SKILLID[SHORT_SKILLID["ARMOR"]=34]="ARMOR";SHORT_SKILLID[SHORT_SKILLID["SUMMON"]=35]="SUMMON"})(SHORT_SKILLID||(SHORT_SKILLID={}));window["SHORT_SKILLID"]=SHORT_SKILLID;var SkillConst=function(){function SkillConst(){}SkillConst.EFF_SKY_BALL=53001;SkillConst.HEJI_SKILLS=[71001,72001,73001];return SkillConst}();__reflect(SkillConst.prototype,"SkillConst");var Wing=function(_super){__extends(Wing,_super);function Wing(){var _this=_super.call(this)||this;_this.timeID=0;_this.godWing=[];_this.showOnce=[false,false,false];_this.isListen=false;_this.sysId=PackageID.Wing;_this.regNetMsg(1,_this.doUpDataWing);_this.regNetMsg(2,_this.doBoost);_this.regNetMsg(3,_this.postWingWear);_this.regNetMsg(4,_this.postActivate);_this.regNetMsg(5,_this.postGodWingData);_this.regNetMsg(8,_this.postUseDanSuccess);_this.regNetMsg(11,_this.postWingEquip);_this.observe(UserBag.ins().postItemAdd,_this.startCheckHaveCan);_this.observe(UserBag.ins().postItemDel,_this.startCheckHaveCan);_this.observe(GameLogic.ins().postSubRoleChange,_this.startCheckHaveCan);_this.observe(Actor.ins().postLevelChange,_this.startCheckHaveCan);_this.observe(_this.postWingUpgrade,_this.startCheckHaveCan);_this.observe(UserBag.ins().postItemChange,_this.startCheckHaveCan);_this.observe(_this.postUseDanSuccess,_this.startCheckHaveCan);return _this}Wing.ins=function(){return _super.ins.call(this)};Wing.prototype.initConfig=function(){if(!this.wingSkillDic){this.wingSkillDic=[];var config=GlobalConfig.WingLevelConfig;for(var k in config){if(config[k].pasSkillId){this.wingSkillDic.push(config[k].pasSkillId)}}}};Wing.prototype.getWingSkillByIndex=function(index){this.initConfig();return this.wingSkillDic[index]};Wing.prototype.startCheckHaveCan=function(isWear,roleIndex){if(isWear===void 0){isWear=false}if(roleIndex===void 0){roleIndex=-1}if(this.isListen)return;this.isListen=true;TimerManager.ins().doTimerDelay(3e3,1e3,1,this.showNavBtnRedPoint,this)};Wing.prototype.sendBoost=function(roleId,type){var bytes=this.getBytes(2);bytes.writeShort(roleId);bytes.writeByte(type);this.sendToServer(bytes)};Wing.prototype.sendUpgrade=function(roleId){var bytes=this.getBytes(3);bytes.writeShort(roleId);this.sendToServer(bytes)};Wing.prototype.sendActivate=function(roleId){var bytes=this.getBytes(4);bytes.writeShort(roleId);this.sendToServer(bytes)};Wing.prototype.dressWingEquip=function(roleId,itemId,dressIndex){var bytes=this.getBytes(11);bytes.writeDouble(itemId);bytes.writeShort(roleId);bytes.writeShort(dressIndex);this.sendToServer(bytes)};Wing.prototype.sendBigUpLevel=function(role){var bytes=this.getBytes(12);bytes.writeInt(role);this.sendToServer(bytes)};Wing.prototype.doBigUpLevel=function(bytes){var result=bytes.readInt();var str;if(!result){var type=bytes.readInt()}else{str=i18n("Wing_3")}UserTips.ins().showTips(str)};Wing.prototype.doUpDataWing=function(bytes){var index=bytes.readShort();SubRoles.ins().getSubRoleByIndex(index).wingsData.parser(bytes)};Wing.prototype.doBoost=function(bytes){var index=bytes.readShort();var lastLv=SubRoles.ins().getSubRoleByIndex(index).wingsData.lv;SubRoles.ins().getSubRoleByIndex(index).wingsData.parserBoost(bytes);var crit=0;var addExp=bytes.readInt();SubRoles.ins().getSubRoleByIndex(index).wingsData.parserClearTime(bytes,true,index);crit=bytes.readShort();this.postBoost(crit,addExp);if(lastLv!=SubRoles.ins().getSubRoleByIndex(index).wingsData.lv){var skillAct=GlobalConfig.WingLevelConfig[SubRoles.ins().getSubRoleByIndex(index).wingsData.lv];if(skillAct.pasSkillId){}SubRoles.ins().getSubRoleByIndex(index).setWingSkill();var role=EntityManager.ins().getMainRole(index);if(role)role.updateModel();this.postWingUpgrade();var mc=skillAct.appearance;RewardWin.showAct(1,skillAct.name,"",false,null,"","","","",mc,RES_DIR_ROLE)}this.postWingTime()};Wing.prototype.postBoost=function(crit,addExp){return[crit,addExp]};Wing.prototype.postWingUpgrade=function(){};Wing.prototype.postActivate=function(bytes){var index=bytes.readShort();SubRoles.ins().getSubRoleByIndex(index).wingsData.parserOpenStatus(bytes);var config=GlobalConfig.WingLevelConfig[0];var mc=config.appearance;RewardWin.showAct(1,config.name,"",true,null,"","","","",mc,RES_DIR_ROLE);var role=EntityManager.ins().getMainRole(index);if(!role)return;role.updateModel()};Wing.prototype.postWingEquip=function(bytes){var roleId=bytes.readShort();var index=bytes.readShort();var item=new ItemData;item.parser(bytes);SubRoles.ins().getSubRoleByIndex(roleId).wingsData.getEquipByIndex(index).item=item;var role=EntityManager.ins().getMainRole(roleId);if(!role)return;role.updateModel()};Wing.prototype.postWingTime=function(){};Wing.prototype.showNavBtnRedPoint=function(){this.isListen=false;var b=false;var actorLv=Actor.level;if(Actor.level>=GlobalConfig.WingCommonConfig.openLevel){if(!b&&this.and(this.canGradeupWing())){UserRole.ins().showNavBtnRedPoint(true);return}}if(this.canUseFlyUp()){UserRole.ins().showNavBtnRedPoint(true);return}if(this.canUseAptitude()){UserRole.ins().showNavBtnRedPoint(true);return}UserRole.ins().showNavBtnRedPoint(false)};Wing.prototype.and=function(list){for(var k in list){if(list[k]==true)return true}return false};Wing.prototype.getLevelBySkill=function(index){if(!this.wingSkillLevelDic){this.wingSkillLevelDic=[];var config=GlobalConfig.WingLevelConfig;for(var k in config){if(config[k].pasSkillId>0){this.wingSkillLevelDic.push(config[k].level)}}}if(this.wingSkillLevelDic[index]){return this.wingSkillLevelDic[index]}return 0};Wing.prototype.canGradeupWing=function(){var boolList=[false,false,false];return boolList};Wing.prototype.canItemGradeupWing=function(){var boolList=[false,false,false];var lvMax=Wing.WingMaxLv;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var roleOpenWing=SubRoles.ins().getSubRoleByIndex(i).wingsData.openStatus;if(roleOpenWing){var curlevel=SubRoles.ins().getSubRoleByIndex(i).wingsData.lv;if(curlevel<lvMax&&curlevel<Wing.WingExpRedPoint){var config=GlobalConfig.WingLevelConfig[curlevel];if(Assert(config,"get WingLevelConfig null "+curlevel))continue;var num=UserBag.ins().getBagGoodsCountById(0,config.itemId);boolList[i]=config.itemNum<=num}else{boolList[i]=false}if(!boolList[i]){var count=UserBag.ins().getBagGoodsCountById(0,GlobalConfig.WingCommonConfig.levelItemid);boolList[i]=count>0&&curlevel==Wing.WingExpRedPoint}}}return boolList};Wing.prototype.isHaveActivationWing=function(roleId){if(roleId===void 0){roleId=-1}var myLevel=Actor.level;var needLevel=GlobalConfig.WingCommonConfig.openLevel;if(myLevel<needLevel)return false;var len=SubRoles.ins().subRolesLen;if(roleId==-1){for(var i=0;i<len;i++){var wingData=SubRoles.ins().getSubRoleByIndex(i).wingsData;if(!wingData.openStatus)return true}}else{var wingData=SubRoles.ins().getSubRoleByIndex(roleId).wingsData;if(!wingData.openStatus)return true}return false};Wing.prototype.canRoleOpenWing=function(){var boolList=[false,false,false];var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var roleOpenWing=SubRoles.ins().getSubRoleByIndex(i).wingsData.openStatus;boolList[i]=!roleOpenWing&&Actor.level>=16}return boolList};Wing.prototype.sendWingWear=function(roleId,itemId){var bytes=this.getBytes(3);bytes.writeShort(roleId);bytes.writeInt(itemId);this.sendToServer(bytes)};Wing.prototype.postWingWear=function(bytes){var b=bytes.readBoolean();return b};Wing.prototype.postGodWingData=function(bytes){var roleId=bytes.readShort();if(!this.godWing[roleId])this.godWing[roleId]=new GodWingData;this.godWing[roleId].parser(bytes)};Wing.prototype.sendUseDan=function(id,type){var bytes=this.getBytes(8);bytes.writeByte(id);bytes.writeByte(type);this.sendToServer(bytes)};Wing.prototype.postUseDanSuccess=function(bytes){var wingsData=SubRoles.ins().getSubRoleByIndex(bytes.readByte()).wingsData;var type=bytes.readByte();var count=bytes.readShort();if(type==0)wingsData.aptitudeDan=count;else wingsData.flyUpDan=count};Wing.prototype.canUseFlyUp=function(){var len=SubRoles.ins().roles.length;for(var i=0;i<len;i++){if(this.canUseFlyUpByRoleID(i))return true}return false};Wing.prototype.canUseFlyUpByRoleID=function(roleID){var role=SubRoles.ins().getSubRoleByIndex(roleID);if(role.wingsData&&role.wingsData.openStatus==1){if(role.wingsData.flyUpDan<GlobalConfig.WingLevelConfig[role.wingsData.lv].flyPill){var itemData=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.flyPillId);var num=itemData?itemData.count:0;if(num)return true}}return false};Wing.prototype.canUseAptitude=function(){var len=SubRoles.ins().roles.length;for(var i=0;i<len;i++){if(this.canUseAptitudeByRoleID(i))return true}return false};Wing.prototype.canUseAptitudeByRoleID=function(roleID){var role=SubRoles.ins().getSubRoleByIndex(roleID);if(role.wingsData&&role.wingsData.openStatus==1){if(role.wingsData.aptitudeDan<GlobalConfig.WingLevelConfig[role.wingsData.lv].attrPill){var itemData=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.attrPillId);var num=itemData?itemData.count:0;if(num)return true}}return false};Wing.prototype.userDans=function(id){var len=SubRoles.ins().roles.length;var role;var maxRole=null;var maxLvRole=null;var maxUnOpen=0;var lvMax=0;var cfg;var useMax;var isZiZhi=id==GlobalConfig.WingCommonConfig.attrPillId;for(var i=0;i<len;i++){role=SubRoles.ins().getSubRoleByIndex(i);if(role.wingsData.openStatus==1){cfg=GlobalConfig.WingLevelConfig[role.wingsData.lv];useMax=isZiZhi&&role.wingsData.aptitudeDan>=cfg.attrPill||!isZiZhi&&role.wingsData.flyUpDan>=cfg.flyPill;if(!useMax){if(!maxRole)maxRole=role;if(role.wingsData.lv>maxRole.wingsData.lv)maxRole=role;if(!maxLvRole)maxLvRole=role;if(isZiZhi&&role.wingsData.aptitudeDan>maxRole.wingsData.aptitudeDan)maxLvRole=role;if(!isZiZhi&&role.wingsData.flyUpDan>maxRole.wingsData.flyUpDan)maxLvRole=role}else lvMax++}else maxUnOpen++}if(maxUnOpen>=len){UserTips.ins().showTips(i18n("Wing_5"));return}if(lvMax>=len){UserTips.ins().showTips(i18n("Wing_6")+(isZiZhi?i18n("Wing_7"):i18n("Wing_8"))+i18n("Wing_9"));return}var index=maxRole.index;if(maxRole.index!=maxLvRole.index&&maxRole.wingsData.lv==maxLvRole.wingsData.lv)index=maxLvRole.index;ViewManager.ins().open(RoleWin,3,index)};Wing.prototype.sendWingCompose=function(type,itemId,roleIndex){var tp=type;var bytes=this.getBytes(6);bytes.writeShort(tp);bytes.writeInt(itemId);if(tp==1){bytes.writeInt(roleIndex)}this.sendToServer(bytes)};Wing.prototype.sendResetGodWing=function(src,des){var bytes=this.getBytes(7);bytes.writeInt(src);bytes.writeInt(des);this.sendToServer(bytes)};Wing.prototype.getCurLevelItemId=function(roleId,slot){var glconfig;var level;if(!this.godWing[roleId])return null;level=this.godWing[roleId].getLevel(slot);if(!level)return null;glconfig=GlobalConfig.GodWingLevelConfig[level][slot];return glconfig};Wing.prototype.getNextLevelItemId=function(roleId,slot){var level;level=this.godWing[roleId].getLevel(slot);level=level?this.getNextLevel(level):0;if(!GlobalConfig.GodWingLevelConfig[level])return null;return GlobalConfig.GodWingLevelConfig[level][slot]};Wing.prototype.quickComposeRedPoint=function(roleIndex,slot){var lv=Wing.ins().getGodWing(roleIndex).getLevel(slot);var nextLvl=this.getNextLevel(lv);if(!nextLvl)return false;var cfg=GlobalConfig.GodWingLevelConfig[nextLvl][slot];if(!this.checkGodWingLevel(roleIndex,cfg.itemId))return false;if(this.checkGodWingItem(roleIndex,cfg.itemId,slot)){return true}return false};Wing.prototype.wearItemRedPoint=function(roleIndex,slot){if(this.checkSlotLevel(roleIndex,slot)){return true}return false};Wing.prototype.gridRedPoint=function(roleIndex,slot){if(this.wearItemRedPoint(roleIndex,slot)){return true}return this.quickComposeRedPoint(roleIndex,slot)};Wing.prototype.isWearGodWing=function(i){var role=SubRoles.ins().getSubRoleByIndex(i);if(!role)return false;for(var j=1;j<=Wing.GodWingMaxSlot;j++){if(this.gridRedPoint(role.index,j)){return true}}return false};Wing.prototype.checkSlot=function(roleId,slot){var lv=Wing.ins().getGodWing(roleId).getLevel(slot);if(!lv){return false}return true};Wing.prototype.getWearItem=function(roleId,slot){var lv=Wing.ins().getGodWing(roleId).getLevel(slot);var items=UserBag.ins().getBagGoodsByType(ItemType.TYPE_16);for(var i=0;i<items.length;i++){var itemConf=GlobalConfig.GodWingItemConfig[items[i].configID];if(this.checkGodWingLevel(roleId,itemConf.itemId)&&itemConf.slot==slot&&itemConf.level>lv){return itemConf.itemId}}return 0};Wing.prototype.checkSlotLevel=function(roleId,slot){var lv=Wing.ins().getGodWing(roleId).getLevel(slot);var items=UserBag.ins().getBagGoodsByType(ItemType.TYPE_16);for(var i=0;i<items.length;i++){var itemConf=GlobalConfig.GodWingItemConfig[items[i].configID];if(this.checkGodWingLevel(roleId,itemConf.itemId)&&itemConf.slot==slot&&itemConf.level>lv){return true}}return false};Wing.prototype.checkGodWingLevel=function(roleId,itemId){var gwconfig=GlobalConfig.GodWingItemConfig[itemId];var myWinglevel=0;var wd=SubRoles.ins().getSubRoleByIndex(roleId).wingsData;myWinglevel+=wd.lv;if(wd.openStatus)myWinglevel+=1;if(myWinglevel>=gwconfig.level){return true}return false};Wing.prototype.checkGodWingItem=function(roleId,itemId,slot){var gwconfig=GlobalConfig.GodWingItemConfig[itemId];var totalSum=gwconfig.composeItem.count;var mySum=0;var itemdata=UserBag.ins().getBagItemById(gwconfig.composeItem.id);if(itemdata)mySum=itemdata.count;if(slot){var isWear=this.getGodWing(roleId).getLevel(slot);if(isWear)totalSum-=1}if(mySum>=totalSum)return true;return false};Wing.prototype.isQuicComposeGodWing=function(roleId,slot){var role=SubRoles.ins().getSubRoleByIndex(roleId);if(!role)return false;var level=this.godWing[roleId].getLevel(slot);if(!level){level=this.getStartLevel(slot)}if(!level)return false;var myWinglevel=0;var wd=SubRoles.ins().getSubRoleByIndex(roleId).wingsData;myWinglevel+=wd.lv;if(wd.openStatus)myWinglevel+=1;if(myWinglevel<level){return false}var isAct=Wing.ins().getGodWing(roleId).getLevel(slot);if(isAct){level=this.getNextLevel(level);if(!level)return false}var itemId=GlobalConfig.GodWingLevelConfig[level][slot].itemId;var gwconfig=GlobalConfig.GodWingItemConfig[itemId];var totalSum=gwconfig.composeItem.count;var mySum=0;var itemdata=UserBag.ins().getBagItemById(gwconfig.composeItem.id);if(itemdata)mySum=itemdata.count;var myLevel=Wing.ins().getGodWing(roleId).getLevel(slot);if(myLevel){var lcfg=GlobalConfig.GodWingLevelConfig[myLevel][slot];if(lcfg.itemId==gwconfig.composeItem.id)mySum+=1}if(mySum>=totalSum)return true;return false};Wing.prototype.isComposeGodWingOnly=function(itemId){var gwconfig=GlobalConfig.GodWingItemConfig[itemId];var totalSum=gwconfig.composeItem.count;var mySum=0;var itemdata=UserBag.ins().getBagItemById(gwconfig.composeItem.id);if(itemdata)mySum=itemdata.count;if(mySum>=totalSum)return true;return false};Wing.prototype.isComposeGodWingAll=function(){for(var k in GlobalConfig.GodWingSuitConfig){var cfg=GlobalConfig.GodWingSuitConfig[k];for(var i=1;i<=Wing.GodWingMaxSlot;i++){var glcfg=GlobalConfig.GodWingLevelConfig[cfg.lv][i];if(this.isComposeGodWingOnly(glcfg.itemId))return true}}return false};Wing.prototype.isComposeGodWingLevel=function(lv,slot){var glcfg=GlobalConfig.GodWingLevelConfig[lv][slot];if(this.isComposeGodWingOnly(glcfg.itemId)){return true}return false};Wing.prototype.isComposeGodWingSlot=function(lv,slot){var cfg=GlobalConfig.GodWingSuitConfig[lv];var glcfg=GlobalConfig.GodWingLevelConfig[cfg.lv][slot];if(this.isComposeGodWingOnly(glcfg.itemId))return true;return false};Wing.prototype.isComposeGodWing=function(type){var len=SubRoles.ins().subRolesLen;for(var i=0;i<3;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(!role)continue;var slotData=this.calcGodWingSlot(i);for(var j=0;j<slotData.length;j++){var gl=GlobalConfig.GodWingLevelConfig[slotData[j].level][slotData[j].slot];if(type){var myWinglevel=0;var wd=SubRoles.ins().getSubRoleByIndex(i).wingsData;myWinglevel+=wd.lv;if(wd.openStatus)myWinglevel+=1;if(myWinglevel<gl.level){continue}}var gwconfig=GlobalConfig.GodWingItemConfig[gl.itemId];var itemId=gwconfig.composeItem.id;var itemData=UserBag.ins().getBagItemById(itemId);var totalSum=gwconfig.composeItem.count;var mySum=itemData?itemData.count:0;if(mySum>=totalSum){return true}}}return false};Wing.prototype.calcGodWingSlot=function(roleId){var slotData=[];for(var i=1;i<=Wing.GodWingMaxSlot;i++){var lv=Wing.ins().getGodWing(roleId).getLevel(i);var tmp={slot:0,level:0};tmp.slot=i;if(!lv){lv=this.getStartLevel(i)}tmp.level=lv;slotData.push(tmp)}return slotData};Wing.prototype.getStartLevel=function(slot){for(var k in GlobalConfig.GodWingLevelConfig){var gwconfig=GlobalConfig.GodWingLevelConfig[k];for(var j in gwconfig){if(gwconfig[j].slot==slot){return gwconfig[j].level}}}return 0};Wing.prototype.getPreLevel=function(curLevel){var prelevel=0;for(var k in GlobalConfig.GodWingLevelConfig){if(!prelevel){prelevel=Number(k);continue}if(Number(k)==curLevel)return prelevel;prelevel=Number(k)}return prelevel};Wing.prototype.getNextLevel=function(curLevel){var keys=[];for(var i in GlobalConfig.GodWingLevelConfig){keys.push(+i)}keys.sort(function(a,b){if(a<b)return-1;return 1});for(var _i=0,keys_2=keys;_i<keys_2.length;_i++){var k=keys_2[_i];if(curLevel<k)return k}return 0};Wing.prototype.getNameFromSlot=function(slot){var gwName="";switch(slot){case 1:gwName=i18n("Wing_10");break;case 2:gwName=i18n("Wing_11");break;case 3:gwName=i18n("Wing_12");break;case 4:gwName=i18n("Wing_13");break}return gwName};Wing.prototype.getGodWing=function(roleId){if(!this.godWing[roleId])this.godWing[roleId]=new GodWingData;return this.godWing[roleId]};Wing.prototype.showWingTips=function(index){if(index===void 0){index=-1}var len=SubRoles.ins().roles.length;for(var i=0;i<len;i++){var data=SubRoles.ins().getSubRoleByIndex(i).wingsData;if(data.clearTime>0&&!this.showOnce[i]&&(index==-1||index==i)){return true}}return false};Wing.WingMaxLv=9;Wing.WingExpRedPoint=3;Wing.GodWingMaxSlot=4;Wing.hint=true;return Wing}(BaseSystem);__reflect(Wing.prototype,"Wing");var GodWingData=function(){function GodWingData(){this.data={}}GodWingData.prototype.parser=function(bytes){var len=bytes.readShort();for(var i=0;i<len;i++){var slot=bytes.readShort();var level=bytes.readInt();this.data[slot]={slot:slot,level:level}}};GodWingData.prototype.getLevel=function(slot){return this.data[slot]?this.data[slot].level:0};GodWingData.prototype.getData=function(){return this.data};GodWingData.prototype.getSuitLevel=function(){var minLv=Number.MAX_VALUE;var slot=0;for(var i in this.data){if(this.data[i].level<minLv){slot=this.data[i].slot;minLv=this.data[i].level}}if(!slot)return 0;var glconfig=GlobalConfig.GodWingLevelConfig[minLv][slot];if(!glconfig)return 0;var ishave=[];for(var k in GlobalConfig.GodWingItemConfig){var gwconfig=GlobalConfig.GodWingItemConfig[k];if(ishave.length>=Wing.GodWingMaxSlot)break;if(gwconfig.level>=glconfig.level&&glconfig.slot!=gwconfig.slot){if(this.data[gwconfig.slot]&&this.data[gwconfig.slot].level>=gwconfig.level){ishave.push(gwconfig.itemId)}}}if(ishave.length>=Wing.GodWingMaxSlot-1)return minLv;return 0};GodWingData.prototype.getSuitSum=function(){var lv=this.getSuitLevel();var sum=0;for(var i in this.data){if(this.data[i].level>=lv){sum++}}return sum};return GodWingData}();__reflect(GodWingData.prototype,"GodWingData");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.wing=Wing.ins.bind(Wing)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var EquipsData=function(){function EquipsData(){}EquipsData.prototype.parser=function(bytes){this.strengthen=bytes.readInt();this.spiritLv=bytes.readInt();this.gem=bytes.readInt();this.item=new ItemData;this.item.parser(bytes);this.zhuling=bytes.readInt();this.soulLv=bytes.readInt();this.bless=bytes.readInt();this.spiritExp=bytes.readInt()};return EquipsData}();__reflect(EquipsData.prototype,"EquipsData");var JingMaiData=function(){function JingMaiData(){}JingMaiData.prototype.parser=function(bytes){this.level=bytes.readInt();this.stage=bytes.readInt()};JingMaiData.prototype.jingMaiCanUp=function(){var stagesConfig=GlobalConfig.JingMaiStageConfig[this.stage];if(stagesConfig.stage>=GlobalConfig.JingMaiCommonConfig.stageMax)return false;var lvConfig=GlobalConfig.JingMaiLevelConfig[this.level];var count=UserBag.ins().getBagGoodsCountById(0,lvConfig.itemId);return count>=lvConfig.count};return JingMaiData}();__reflect(JingMaiData.prototype,"JingMaiData");var PunchEquipForgeData=function(){function PunchEquipForgeData(){this.data=[]}PunchEquipForgeData.prototype.parser=function(bytes){var len=bytes.readShort();for(var i=0;i<len;i++){var pos=bytes.readShort();var lv=bytes.readInt();if(!this.data[pos]){var d=new PunchEquipData;d.id=pos;d.level=lv;this.data[pos]=d}else{this.data[pos].id=pos;this.data[pos].level=lv}}};Object.defineProperty(PunchEquipForgeData.prototype,"level",{get:function(){var level=0;for(var i=0;i<this.data.length;i++){var punch=this.data[i];level+=punch.level}return level},enumerable:true,configurable:true});PunchEquipForgeData.prototype.getSuitlevel=function(){var lv=0;for(var k in GlobalConfig.PunchEquipMasterConfig){var cfg=GlobalConfig.PunchEquipMasterConfig[k];if(Math.floor(this.level/8)>=cfg.level)lv=cfg.level}return lv};PunchEquipForgeData.prototype.getNextSuitlevel=function(){var lv=0;for(var k in GlobalConfig.PunchEquipMasterConfig){var cfg=GlobalConfig.PunchEquipMasterConfig[k];if(cfg.level>Math.floor(this.level/8)){lv=cfg.level;break}}return lv};PunchEquipForgeData.prototype.getPunchLevel=function(pos){return this.data[pos].level};PunchEquipForgeData.prototype.getCurCost=function(){var startPos;var minLv;var isRound=true;for(var i=0;i<8;i++){var punch=this.data[i];if(!i){startPos=i;minLv=punch.level;continue}if(minLv<punch.level){isRound=false;startPos=i;minLv=punch.level}}if(isRound){startPos=0;minLv++}return GlobalConfig.PunchEquipConfig[startPos][minLv]};PunchEquipForgeData.prototype.getNextConfig=function(pos){var slot=pos+1;var lv=this.getPunchLevel(pos);if(slot>7){slot=0;lv=this.getPunchLevel(slot)+1}return GlobalConfig.PunchEquipConfig[slot][lv]};PunchEquipForgeData.prototype.getPosNextLevelConfig=function(pos){var lv=this.getPunchLevel(pos);lv++;return GlobalConfig.PunchEquipConfig[pos][lv]};PunchEquipForgeData.prototype.isShowPunchEquipForge=function(){var list=UserSkill.ins().equipListData;for(var i=0;i<list.length;i++){var items=list[i];if(!items.itemConfig||!items.itemConfig.zsLevel||items.itemConfig.zsLevel<4)return false}return true};PunchEquipForgeData.prototype.isUpgradePunchForge=function(pos){var lv=1;if(this.data[pos]){lv=this.data[pos].level}if(!GlobalConfig.PunchEquipConfig[pos][lv+1])return PunchEquipForgeData.TYPE_MAX;if(!lv)lv=1;var cfg=GlobalConfig.PunchEquipConfig[pos][lv+1];var count=0;if(cfg.cost.id==MoneyConst.punch1){count=Actor.togeatter1}else if(cfg.cost.id==MoneyConst.punch2){count=Actor.togeatter2}if(count>=cfg.cost.count){return PunchEquipForgeData.TYPE_OK}return PunchEquipForgeData.TYPE_NO};PunchEquipForgeData.prototype.calcSelectPos=function(){var startPos;var minLv;var isRound=true;for(var i=0;i<8;i++){if(!this.data[i])continue;var punch=this.data[i];if(!i){startPos=i;minLv=punch.level;continue}if(minLv>punch.level){isRound=false;startPos=i;minLv=punch.level}}if(isRound){startPos=0;minLv++}return startPos};PunchEquipForgeData.prototype.getRedPoint=function(){if(!this.isShowPunchEquipForge())return false;var fullCount=0;var max=8;for(var i=0;i<max;i++){var b=this.isUpgradePunchForge(i);if(b==PunchEquipForgeData.TYPE_NO)return false;else if(b==PunchEquipForgeData.TYPE_MAX){fullCount++}}if(fullCount==max)return false;return true};PunchEquipForgeData.prototype.getAttributeData=function(){var attrs=[];for(var i=0;i<this.data.length;i++){var pos=this.data[i].id;var lv=this.data[i].level;var config=GlobalConfig.PunchEquipConfig[pos][lv];if(config){for(var j=0;j<config.attr.length;j++){if(!attrs.length){var at=new AttributeData;at.type=config.attr[j].type;at.value=config.attr[j].value;attrs.push(at)}else{var ishave=false;for(var k=0;k<attrs.length;k++){if(attrs[k].type==config.attr[j].type){ishave=true;attrs[k].value+=config.attr[j].value}}if(!ishave){var at=new AttributeData;at.type=config.attr[j].type;at.value=config.attr[j].value;attrs.push(at)}}}}}return attrs};PunchEquipForgeData.TYPE_NO=0;PunchEquipForgeData.TYPE_OK=1;PunchEquipForgeData.TYPE_MAX=2;return PunchEquipForgeData}();__reflect(PunchEquipForgeData.prototype,"PunchEquipForgeData");var PunchEquipData=function(){function PunchEquipData(){}return PunchEquipData}();__reflect(PunchEquipData.prototype,"PunchEquipData");var WingsData=function(){function WingsData(){this.openStatus=0;this.clearTime=0;this.aptitudeDan=0;this.flyUpDan=0}WingsData.prototype.getEquipByIndex=function(index){return this.equipdata[index]};Object.defineProperty(WingsData.prototype,"equipsLen",{get:function(){return this.equipdata.length},enumerable:true,configurable:true});WingsData.prototype.parser=function(bytes){this.parserBoost(bytes);this.parserOpenStatus(bytes);this.parserClearTime(bytes);this.parserDans(bytes)};WingsData.prototype.parserBoost=function(bytes){this.lv=bytes.readInt();this.exp=bytes.readUnsignedInt()};WingsData.prototype.parserOpenStatus=function(bytes){this.openStatus=bytes.readInt()};WingsData.prototype.parserClearTime=function(bytes,isBoost,index){if(isBoost===void 0){isBoost=false}if(index===void 0){index=0}var time=bytes.readUnsignedInt();if(isBoost&&this.clearTime==0&&time>0){Wing.ins().showOnce[index]=true}this.clearTime=time};WingsData.prototype.parserDans=function(bytes){this.aptitudeDan=bytes.readShort();this.flyUpDan=bytes.readShort()};WingsData.prototype.parserWingEqupip=function(bytes){this.equipdata=[];var equip;for(var i=0;i<4;i++){equip=new EquipsData;equip.parser(bytes);this.equipdata.push(equip)}};WingsData.prototype.getImgSource=function(){if(this.lv>Wing.WingMaxLv||this.lv<0)return"";return GlobalConfig.WingLevelConfig[this.lv].appearance};WingsData.getWingAllLevel=function(){var sumlevel=0;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var data=SubRoles.ins().getSubRoleByIndex(i).wingsData;sumlevel+=data.lv;if(data.openStatus)sumlevel+=1}return sumlevel};return WingsData}();__reflect(WingsData.prototype,"WingsData");var RoleAttrWin=function(_super){__extends(RoleAttrWin,_super);function RoleAttrWin(){var _this=_super.call(this)||this;_this._lastX=0;_this.proShowList=[1,2,3,4,5,6,7,AttributeType.atCritEnhance,8,9,10,11,12,13,14,15,16];_this.skinName="RoleAttrSkin";_this.isTopLevel=true;return _this}RoleAttrWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};RoleAttrWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curRole=param[0];this.setRoleAttr(this.curRole);var len=SubRoles.ins().subRolesLen;if(len>1){this.addTouchEvent(this.leftBtn,this.onTouch);this.addTouchEvent(this.rightBtn,this.onTouch);this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.addTouchEndEvent(this.bg,this.onMove)}this.addTouchEndEvent(this,this.otherClose)};RoleAttrWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var len=SubRoles.ins().subRolesLen;if(len>1){this.removeTouchEvent(this.leftBtn,this.onTouch);this.removeTouchEvent(this.rightBtn,this.onTouch);this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this);this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};RoleAttrWin.prototype.onClose=function(e){ViewManager.ins().close(this)};RoleAttrWin.prototype.otherClose=function(e){if(e.target==this.bg||e.target instanceof eui.Button)return;ViewManager.ins().close(this)};RoleAttrWin.prototype.onMove=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=e.localX;break;case egret.TouchEvent.TOUCH_END:if(this._lastX>e.localX){if(this.curRole<2){this.curRole++;this.setRoleAttr(this.curRole);this.moveAttr(-200)}}else if(this._lastX<e.localX){if(this.curRole>0){this.curRole--;this.setRoleAttr(this.curRole);this.moveAttr(200)}}break}};RoleAttrWin.prototype.moveAttr=function(num){var t=egret.Tween.get(this.attrGroup);var toNum;if(num>0)toNum=0;else toNum=242;t.to({x:this.attrGroup.x+num,alpha:0},200).to({x:toNum},200).to({x:80,alpha:1},200)};RoleAttrWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.leftBtn:if(this.curRole>0){this.curRole--;this.setRoleAttr(this.curRole);this.moveAttr(200)}break;case this.rightBtn:if(this.curRole<2){this.curRole++;this.setRoleAttr(this.curRole);this.moveAttr(-200)}break}};RoleAttrWin.prototype.setRoleAttr=function(roleId){var role=SubRoles.ins().getSubRoleByIndex(roleId);this.job.source="op_"+role.job;var str="";var value=0;var i=0;for(var j=0;j<this.proShowList.length;j++){i=this.proShowList[j];value=role.attributeData[i];if(i>1&&i<9){if(i==7||i==8){str+=value/100+"%"}else{str+=value}}else if(i>12&&i<15||i>15){if(i==AttributeType.atCritEnhance){value+=role.getAtt(AttributeType.atHuiXinDamage);value+=1e4}str+=value/100+"%"}else continue;if(j<this.proShowList.length-1)str+="\n"}this.attr.text=str;this.setBtn()};RoleAttrWin.prototype.setBtn=function(){var len=SubRoles.ins().subRolesLen;if(len==1){this.leftBtn.visible=false;this.rightBtn.visible=false}else if(len>1){if(this.curRole==0){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.curRole==1){this.leftBtn.visible=true;if(len<3)this.rightBtn.visible=false;else this.rightBtn.visible=true}else if(this.curRole==2){this.leftBtn.visible=true;this.rightBtn.visible=false}}};return RoleAttrWin}(BaseEuiView);__reflect(RoleAttrWin.prototype,"RoleAttrWin");ViewManager.ins().reg(RoleAttrWin,LayerManager.UI_Popup);var RoleChooseEquipWin=function(_super){__extends(RoleChooseEquipWin,_super);function RoleChooseEquipWin(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.itemList=[];_this.pos=0;_this.roleSelect=0;_this.curEquipId=-1;_this.curEquipLvl=-1;_this.curPoint=-1;return _this}RoleChooseEquipWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.skinName="RoleChooseEquipSkin";this.list.itemRenderer=RoleEquipChooseItem;this.wearItem=new RoleEquipChooseItem;this.itemGroup.addChild(this.wearItem)};RoleChooseEquipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.roleSelect=param[0];this.pos=param[1];var model=SubRoles.ins().getSubRoleByIndex(this.roleSelect);var data=model.getEquipDataByPos(this.pos);this.wearItem.setUpImage(false);this.wearItem.data=data.item;this.wearItem.setBtnStatu();var power=0;if(data&&data.item.configID!=0){this.curEquipId=data.item.configID;this.curPoint=data.item.point||0;this.scroll.y=170;this.scroll.height=400;this.wearItem.visible=true;power=data.item.point;var job=ItemConfig.getJob(data.item.itemConfig)==0?model.job:ItemConfig.getJob(data.item.itemConfig);UserBag.ins().setEquipPowerDic(job,ItemConfig.getSubType(data.item.itemConfig),power)}else{this.scroll.y=50;this.scroll.height=520;this.wearItem.visible=false}this.itemList=UserBag.ins().getEquipByPos(this.roleSelect,this.pos);this.list.dataProvider=new eui.ArrayCollection(this.itemList);this.list.validateNow();this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this,this.itemTap)};RoleChooseEquipWin.prototype.itemTap=function(e){if(e.target.name=="changeBtn"){var item=e.target.parent.data;if(item&&item instanceof ItemData){var lv=Actor.level;var zsLv=UserZs.ins().lv;if(item.itemConfig){var changePoint=item.point||1;if(this.curPoint>changePoint){NewEquip.notShowEquipIDs.push(this.curEquipId)}if(zsLv>=(item.itemConfig.zsLevel||0)&&lv>=(item.itemConfig.level||1)){}else{if(ItemConfig.getQuality(item.itemConfig)==5){UserTips.ins().showTips(i18n("RoleChooseEquipWin_0",item.itemConfig.name,item.itemConfig.zsLevel,item.itemConfig.level||1));return}UserTips.ins().showTips(i18n("RoleChooseEquipWin_1"));return}}UserEquip.ins().sendWearEquipment(item.handle,this.pos,this.roleSelect);ViewManager.ins().close(this);SoundUtil.ins().playEffect(SoundUtil.EQUIP)}}};RoleChooseEquipWin.prototype.onTap=function(e){ViewManager.ins().close(this)};RoleChooseEquipWin.prototype.sortFun=function(aItem,bItem){var att1=UserBag.ins().getEquipAttrs(aItem);var itemPoint1=UserBag.getAttrPower(att1);var att2=UserBag.ins().getEquipAttrs(bItem);var itemPoint2=UserBag.getAttrPower(att2);if(itemPoint1<itemPoint2)return 1;if(itemPoint1>itemPoint2)return-1;return 0};return RoleChooseEquipWin}(BaseEuiView);__reflect(RoleChooseEquipWin.prototype,"RoleChooseEquipWin");ViewManager.ins().reg(RoleChooseEquipWin,LayerManager.UI_Popup);var RoleChooseItemWin=function(_super){__extends(RoleChooseItemWin,_super);function RoleChooseItemWin(){var _this=_super.call(this)||this;_this.initMc();_this.skinName="weaponSoulUse";return _this}RoleChooseItemWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.id=args[0];this.addTouchEvent(this,this.onClick);this.addTouchEvent(this.btntupo,this.onTouch);this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn0,this.onTouch);this.observe(Weapons.ins().postWeaponsFlexibleCount,this.otherClose);this.init();this.setCurRole(this.id)};RoleChooseItemWin.prototype.init=function(){this.roles=[this.role1,this.role2,this.role3];for(var i=0;i<2;i++){var mc=this.roleMovie[i];this.roles[i+1].addChild(mc)}this.updateRole();this.updateSelect(this.id)};RoleChooseItemWin.prototype.getCurRole=function(){return this.id};RoleChooseItemWin.prototype.setCurRole=function(value){this.id=value;for(var i=0;i<this.roles.length;i++){var element=this.roles[i];element.selected=i==value}this.dispatchEventWith(egret.Event.CHANGE,false,this.id)};RoleChooseItemWin.prototype.initMc=function(){this.roleMovie=[];for(var i=0;i<2;i++){var mc=new MovieClip;mc.x=44;mc.y=44;mc.touchEnabled=false;this.roleMovie.push(mc)}};RoleChooseItemWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn0:ViewManager.ins().close(this);break;case this.btntupo:var role=SubRoles.ins().getSubRoleByIndex(this.id);if(!role){UserTips.ins().showTips(i18n("RoleChooseItemWin_0"));return}if(role.weapons.flexibleCount-1>=GlobalConfig.WeaponSoulBaseConfig.maxItemNum){UserTips.ins().showTips(i18n("RoleChooseItemWin_1",GlobalConfig.WeaponSoulBaseConfig.maxItemNum));return}Weapons.ins().sendWeaponsFlexibleCount(this.id);break}};RoleChooseItemWin.prototype.onClick=function(e){var index=this.roles.indexOf(e.target);if(index>-1)this.changeRole(index)};RoleChooseItemWin.prototype.changeRole=function(value){var model=SubRoles.ins().getSubRoleByIndex(value);if(model){this.setCurRole(value);this.updateSelect(value)}else{ViewManager.ins().open(NewRoleWin);this.roles[value].selected=false;ViewManager.ins().close(this)}};RoleChooseItemWin.prototype.updateSelect=function(roleId){for(var i=1;i<=3;i++){if(roleId+1==i){this["selectrole"+i].visible=true}else{this["selectrole"+i].visible=false}}var role=SubRoles.ins().getSubRoleByIndex(roleId);this.btntupo.visible=role.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum;var index=role.weapons.flexibleCount;index=index?index-1:1;index=index>=GlobalConfig.WeaponSoulBaseConfig.maxItemNum?GlobalConfig.WeaponSoulBaseConfig.maxItemNum:index;var config=GlobalConfig.WeaponSoulItemAttr[index];var nindex=role.weapons.flexibleCount?index+1:index;var nextconfig=GlobalConfig.WeaponSoulItemAttr[nindex];var curCount=role.weapons.flexibleCount?index:0;curCount=curCount>=GlobalConfig.WeaponSoulBaseConfig.maxItemNum?GlobalConfig.WeaponSoulBaseConfig.maxItemNum:curCount;this.curUse.text=curCount+"";this.nextUse.visible=true;for(var i=0;i<4;i++){this["name"+i].text=AttributeData.getAttrStrByType(config.attr[i].type);this["tpattr"+i].text=role.weapons.flexibleCount?config.attr[i].value:0;if(nextconfig){this.nextUse.text=nindex+"";this["ntpattr"+i].visible=this["dir"+i].visible=true;this["ntpattr"+i].text=nextconfig.attr[i].value}else{this["ntpattr"+i].visible=this["dir"+i].visible=false;this.nextUse.visible=false}}this["dir"].visible=this.nextUse.visible;this.material.data=GlobalConfig.WeaponSoulBaseConfig.itemid};RoleChooseItemWin.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}};RoleChooseItemWin.prototype.updateRole=function(){var role;var roleData;var len=this.roles.length;for(var i=0;i<len;i++){role=this.roles[i];roleData=SubRoles.ins().getSubRoleByIndex(i);if(roleData){role["jobImg"].visible=true;role["jobImg"].source="job"+roleData.job+"Item";role["stageImg"].visible=false;role["stageImg"].source="";role["lockImg"].visible=true;role.icon="yuanhead"+roleData.job+roleData.sex;if(this.roleMovie[i-1])DisplayUtils.removeFromParent(this.roleMovie[i-1])}else{var config=GlobalConfig.NewRoleConfig[i];if(!config){var parName=egret.getQualifiedClassName(this.parent);Assert(false,i18n("RoleChooseItemWin_2",i,parName));continue}role["jobImg"].visible=false;role["stageImg"].visible=true;role["lockImg"].visible=true;if(config.zsLevel){if(UserZs.ins().lv<config.zsLevel){role["stageImg"].source="toujiesuo"+config.zsLevel;role["lockImg"].visible=false}else{role["stageImg"].source="toujiesuo"}}else{if(Actor.level<config.level){role["stageImg"].source="toujiesuo"+config.level;role["lockImg"].visible=false}else{role["stageImg"].source="toujiesuo"}}if(config.vip&&UserVip.ins().lv>=config.vip){role["stageImg"].source="toujiesuo"}role.icon=""}if(this.roleMovie[i-1]&&role["stageImg"].source=="toujiesuo"&&role["stageImg"].visible){this.roleMovie[i-1].playFile(RES_DIR_EFF+"juesejiesuo",-1);this.showRedPoint(i,true)}}};RoleChooseItemWin.prototype.showRedPoint=function(index,b){if(this.roles==null)return;this.roles[index]["redPoint"].visible=b};RoleChooseItemWin.prototype.otherClose=function(){ViewManager.ins().close(this)};return RoleChooseItemWin}(BaseEuiView);__reflect(RoleChooseItemWin.prototype,"RoleChooseItemWin");ViewManager.ins().reg(RoleChooseItemWin,LayerManager.UI_Popup);var RoleEquipChooseItem=function(_super){__extends(RoleEquipChooseItem,_super);function RoleEquipChooseItem(){var _this=_super.call(this)||this;_this.showUpimage=true;_this.skinName="RoleChooseEquipItemSkin";return _this}RoleEquipChooseItem.prototype.dataChanged=function(){if(!this.data||!this.data.itemConfig)return;this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);var itemdata=this.data;this.itemIcon.setData(this.data.itemConfig);this.nameTxt.text=itemdata.itemConfig.name;this.nameTxt.textColor=ItemConfig.getQualityColor(this.data.itemConfig);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(this.data.itemConfig);var att=UserBag.ins().getEquipAttrs(this.data);var config=GlobalConfig.EquipConfig[this.data.itemConfig.id];var exPower=0;var itemPoint=this.data.point+exPower;this.power.text=i18n("RoleEquipChooseItem_0",itemPoint);var itemSubType=ItemConfig.getSubType(this.data.itemConfig);this.upImg.x=this.power.x+this.power.textWidth+10;var boo=Actor.level>=(this.data.itemConfig.level||1)&&UserZs.ins().lv>=(this.data.itemConfig.zsLevel||0);var color=boo?"0x03b154":"0xfe4444";if(itemSubType==EquipPos.DZI){this.levelStrText.text=i18n("RoleEquipChooseItem_1");this.levelText.text=UserBag.ins().getGuanyinLevel(itemdata.itemConfig)}else{this.levelStrText.text=i18n("RoleEquipChooseItem_2");var str=isNaN(this.data.itemConfig.zsLevel)?i18n("RoleEquipChooseItem_3",this.data.itemConfig.level||1):i18n("RoleEquipChooseItem_4",this.data.itemConfig.zsLevel);this.levelText.textFlow=TextFlowMaker.generateTextFlow(i18n("RoleEquipChooseItem_5",color,str))}var job=0;this.now.visible=!this.showUpimage;if(!this.data.itemConfig.job){var w=ViewManager.ins().getView(RoleChooseEquipWin);var index=w.roleSelect;var roleData=SubRoles.ins().getSubRoleByIndex(index);job=roleData.job}else{job=ItemConfig.getJob(this.data.itemConfig)}var comparePower=UserBag.ins().getEquipPowerDic(job,itemSubType);if(itemPoint>comparePower&&this.showUpimage&&boo){this.upImg.visible=true;var t=egret.Tween.get(this.upImg,{loop:true});t.to({y:this.upImg.y-3},250).to({y:this.upImg.y+3},250)}else{this.upImg.visible=false}if(this.itemIndex==0&&this.showUpimage&&boo){if(itemPoint>comparePower){this.best.visible=true;this.best.x=this.upImg.x+this.upImg.width+9}else{this.best.visible=false}}else{this.best.visible=false}var str1="";var str2="";for(var i=0;i<att.length;i++){if(att[i].type==0||att[i].value==0)continue;var str=AttributeData.getAttrNameByAttrbute(att[i],true);str1+=str+"\n"}this.attr1.textFlow=(new egret.HtmlTextParser).parser(str1);if(UserZs.ins().lv<(this.data.itemConfig.zsLevel||0)||Actor.level<(this.data.itemConfig.level||1)){this.changeBtn.visible=false}else{this.changeBtn.visible=true}};RoleEquipChooseItem.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);egret.Tween.removeTweens(this.upImg)};RoleEquipChooseItem.prototype.setUpImage=function(boo){this.showUpimage=boo};RoleEquipChooseItem.prototype.setBtnStatu=function(){this.changeBtn.visible=false;this.now.visible=true};return RoleEquipChooseItem}(eui.ItemRenderer);__reflect(RoleEquipChooseItem.prototype,"RoleEquipChooseItem");var RoleWin=function(_super){__extends(RoleWin,_super);function RoleWin(){var _this=_super.call(this)||this;_this.roleIndex=0;_this.oldIndex=0;_this.roleSelectVis=true;_this.skinName="RoleWinSkin";_this.isTopLevel=true;_this.addExclusionWin(egret.getQualifiedClassName(SmeltEquipTotalWin));return _this}RoleWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};RoleWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=param[0]?param[0]:0;this.addTouchEvent(this,this.onClick);this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.addChangeEvent(this.roleSelect,this.onChange);this.observe(UserRole.ins().postRoleHint,this.delayRedPoint);this.observe(UserZs.ins().postZsData,this.delayRedPoint);this.observe(Actor.ins().postLevelChange,this.delayRedPoint);this.observe(Actor.ins().postUpdateTogeatter,this.delayRedPoint);this.observe(UserFb.ins().postGuanKaIdChange,this.delayRedPoint);this.observe(UserSkill.ins().postUpgradeForge,this.delayRedPoint);this.observe(UserBag.ins().postItemAdd,this.delayRedPoint);this.observe(UserBag.ins().postItemChange,this.delayRedPoint);this.observe(UserBag.ins().postItemDel,this.delayRedPoint);this.observe(JadeNew.ins().postJadeData,this.delayRedPoint);this.observe(LyMark.ins().postMarkData,this.delayRedPoint);this.observe(Wing.ins().postUseDanSuccess,this.delayRedPoint);this.observe(Wing.ins().postWingUpgrade,this.delayRedPoint);this.observe(SamsaraCC.ins().postSamsaraInfo,this.delayRedPoint);this.observe(Actor.ins().postPowerChange,this.refreshPower);this.addTouchEvent(this.help,this.onClick);this.roleIndex=param[1]?param[1]:0;var index=this.viewStack.selectedIndex;this.roleSelect.setCurRole(this.roleIndex);if(index==4){this.roleSelect.setState("nohead")}this.setOpenIndex(index);this.redPoint()};RoleWin.prototype.openSamsara=function(){var index=this.viewStack.getChildIndex(this.reincarnationPanel);if(index<0){this.viewStack.addChild(this.reincarnationPanel)}this.tab.dataProvider=this.viewStack;this.redPointGroup.horizontalCenter=42;this.redPoint4.visible=SamsaraModel.ins().isCanUpgrade()||SamsaraModel.ins().isCanExchange()||!SamsaraModel.ins().isMaxSamsara(Actor.samsaraLv)&&SamsaraModel.ins().isCanUpgradeSoul()};RoleWin.prototype.inactiveSamsara=function(){var index=this.viewStack.getChildIndex(this.reincarnationPanel);if(index>=0){this.viewStack.removeChildAt(index)}this.tab.dataProvider=this.viewStack;this.redPointGroup.horizontalCenter=42+62;this.redPoint4.visible=false};RoleWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var uiview2=ViewManager.ins().getView(UIView2);if(uiview2)uiview2.closeNav(UIView2.NAV_ROLE);var num=this.viewStack.numChildren;for(var i=0;i<num;i++){this.viewStack.getChildAt(i).close()}};RoleWin.prototype.checkIsOpen=function(index){var config=GlobalConfig.TogetherHitConfig[1];if(index==1){if(UserSkill.ins().checkHejiOpen()){}else{UserTips.ins().showTips(i18n("RoleWin_0"));this.roleSelect.visible=this.roleSelectVis;return false}}else if(index==2){if(Actor.level<GlobalConfig.ZhuanShengConfig.level){UserTips.ins().showTips(i18n("RoleWin_1",GlobalConfig.ZhuanShengConfig.level));return false}}else if(index==3){if(Actor.level<GlobalConfig.WingCommonConfig.openLevel){UserTips.ins().showTips(i18n("RoleWin_2")+GlobalConfig.WingCommonConfig.openLevel+i18n("RoleWin_3"));return false}}return true};RoleWin.prototype.onTabTouch=function(e){var index=this.tab.selectedIndex;if(index==4){this.roleSelect.setState("nohead")}this.setOpenIndex(index)};RoleWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};RoleWin.prototype.onChange=function(e){this.setRoleId(this.roleSelect.getCurRole())};RoleWin.prototype.setRoleId=function(roleId){this.roleInfoPanel.curRole=this.wingPanel.curRole=roleId;this.setOpenIndex(this.viewStack.selectedIndex)};RoleWin.prototype.refreshPower=function(){this.roleSelect.refreshPower(this.roleSelect._curRole)};RoleWin.prototype.setTabSelectedIndex=function(index){this.tab.selectedIndex=index;this.oldIndex=index;this.setOpenIndex(index)};RoleWin.prototype.setOpenIndex=function(selectedIndex){this.roleSelectVis=this.roleSelect.visible;if(this.oldIndex&&this.oldIndex==3&&this.oldIndex!=selectedIndex){if(this.getWingPanelInfo()){this.doOpenHintWin(1,this.tab.selectedIndex);this.tab.selectedIndex=this.oldIndex;return}}if(selectedIndex!=1)this.hejiPanel.close();this.help.visible=false;this.roleinfoBg.visible=false;this.roleSelect.showNormalPower();this.roleSelect.refreshPower(this.roleSelect._curRole);switch(selectedIndex){case 0:this.roleinfoBg.visible=true;this.biaoti.source="biaoti_juese";this.roleSelect.setState("yhead");this.roleInfoPanel.open();break;case 1:this.biaoti.source="biaoti_heji";this.roleSelect.setState("nohead");this.hejiPanel.open();break;case 2:if(Actor.level>=GlobalConfig.ZhuanShengConfig.level){this.biaoti.source="biaoti_zhuansheng";this.roleSelect.setState("nohead");this.zsPanel.open();this.zsPanel.setData()}else{UserTips.ins().showTips(i18n("RoleWin_4",GlobalConfig.ZhuanShengConfig.level));this.tab.selectedIndex=this.viewStack.selectedIndex}break;case 3:if(Actor.level>=GlobalConfig.WingCommonConfig.openLevel){this.biaoti.source="biaoti_yuyi";this.roleSelect.setState("yhead");var self=this;var func=function(roleId){var power=self.wingPanel.getPower();return power};this.wingPanel.open();this.roleSelect.showOtherPower(func);this.roleSelect.refreshPower(this.roleSelect._curRole)}else{UserTips.ins().showTips(i18n("RoleWin_5")+GlobalConfig.WingCommonConfig.openLevel+i18n("RoleWin_6"));this.tab.selectedIndex=this.viewStack.selectedIndex}break;case 4:this.biaoti.source="biaoti_lunhui";this.roleSelect.setState("nohead");this.reincarnationPanel.open();this.tab.selectedIndex=this.viewStack.selectedIndex=4;this.help.visible=true;break}if(this.oldIndex!=selectedIndex){if(this.tab.selectedIndex!=this.viewStack.selectedIndex){this.viewStack.getElementAt(this.oldIndex)["close"]();this.oldIndex=selectedIndex}}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}this.redPoint()};RoleWin.prototype.onClick=function(e){switch(e.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);var uiview2=ViewManager.ins().getView(UIView2);if(uiview2)uiview2.closeNav(UIView2.NAV_ROLE);break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,22);break}};RoleWin.prototype.delayRedPoint=function(){if(!TimerManager.ins().isExists(this.redPoint,this))TimerManager.ins().doTimer(60,1,this.redPoint,this)};RoleWin.prototype.redPoint=function(){var zsIsOpens=[UserZs.ins().canOpenZSWin()&&!UserZs.ins().isMaxLv()&&(UserZs.ins().canGet()>0||UserZs.ins().canUpgrade())];var wingOpens=this.canWingEquip();var hejiOpens=UserSkill.ins().canHejiEquip()||UserSkill.ins().canExchange()||UserSkill.ins().canSolve()||UserSkill.ins().canAcitve();var equipIsOpens=this.canEquip();var samsaraOpen=SamsaraModel.ins().isOpen();var ringRed=OpenSystem.ins().checkSysOpen(SystemType.RING)&&(SpecialRing.ins().canUseSpecialRingItem()||SpecialRing.ins().checkHaveUpRing()||SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||LyMark.ins().checkRed()||SwordSkinMgr.ins().showRedPoint());var isOpens=[equipIsOpens,hejiOpens,zsIsOpens,wingOpens];this.redPoint0.visible=this.and(equipIsOpens)||ringRed||SubRoles.ins().isLockRole()||SamsaraModel.ins().isOpen()&&SamsaraModel.ins().isCanAddSpirit()||JadeNew.ins().checkRed()||ShenshouRedpoint.ins().redpoint;this.redPoint1.visible=hejiOpens||UserSkill.ins().getPunchForge().getRedPoint();this.redPoint2.visible=this.and(zsIsOpens);this.redPoint3.visible=this.and(wingOpens)||this.and(Wing.ins().canGradeupWing())||this.and(Wing.ins().canItemGradeupWing())||Wing.ins().isHaveActivationWing()||GodWingRedPoint.ins().getGodWingRedPoint()||Wing.ins().showWingTips();this.redPoint3.visible=Actor.level>=GlobalConfig.WingCommonConfig.openLevel?this.redPoint3.visible:false;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var isOpen=false;if(this.tab.selectedIndex<4){if(isOpens[this.tab.selectedIndex][i]){isOpen=true}this.roleSelect.showRedPoint(i,isOpen)}}if(SamsaraModel.ins().isOpen()){this.openSamsara();this.setSamsaraEquipVisible(true)}else{this.inactiveSamsara();this.setSamsaraEquipVisible(false)}};RoleWin.prototype.setSamsaraEquipVisible=function(visible){if(this.roleInfoPanel&&this.viewStack.selectedIndex==4&&this.roleInfoPanel.skinName){this.roleInfoPanel["item9"].visible=visible;this.roleInfoPanel["item10"].visible=visible;this.roleInfoPanel["item11"].visible=visible;this.roleInfoPanel["item12"].visible=visible}};RoleWin.prototype.and=function(list){for(var k in list){if(list[k]==true)return true}return false};RoleWin.prototype.canWingEquip=function(){var isOpens=[false,false,false];var isLevel=Wing.ins().canGradeupWing();var isLevelByItem=Wing.ins().canItemGradeupWing();var isRoleOpenWing=Wing.ins().canRoleOpenWing();var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(GlobalConfig.WingCommonConfig.openLevel>Actor.level){isOpens[i]=false;continue}if(isRoleOpenWing[i]){isOpens[i]=true;continue}if(isLevel[i]||isLevelByItem[i]){isOpens[i]=true}if(Wing.ins().canUseAptitudeByRoleID(i))isOpens[i]=true;if(Wing.ins().canUseFlyUpByRoleID(i))isOpens[i]=true;if(Wing.ins().showWingTips(i))isOpens[i]=true}return isOpens};RoleWin.prototype.canEquip=function(){var isOpens=[false,false,false];if(!this.canChangeEquips||!this.canChangeEquips[0].length){this.canChangeEquips=UserRole.ins().canChangeEquips}if(this.canChangeEquips){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var data=this.canChangeEquips[i];for(var k in data){if(data[k]){isOpens[i]=true;break}}if(isOpens[i]==false){for(var a=0;a<5;a++){var opens=[];if(a>1)opens=LongHun.ins().canGradeupLoongSoul(a);else opens=SpecialRing.ins().canGradeupRing(a);if(opens[i]){isOpens[i]=opens[i];break}}}var model=SubRoles.ins().getSubRoleByIndex(i);var bool=false;for(var j=0;j<8;j++){bool=UserEquip.ins().setOrangeEquipItemState(j,model);if(!bool&&j<2)bool=UserEquip.ins().setLegendEquipItemState(j>0?2:0,model);if(bool){var b=UserBag.ins().checkEqRedPoint(i,model);bool=b!=null?b:bool}if(bool)break}if(!bool)bool=UserEquip.ins().checkRedPointEx(4,i);if(!bool)bool=UserEquip.ins().checkRedPointEx(5,i);if(!bool)bool=Boolean(UserBag.ins().getHuntGoods(0).length);if(bool)isOpens[i]=bool;if(!isOpens[i]){isOpens[i]=SamsaraModel.ins().checkRoleCanAddSpirit(i)}}}return isOpens};RoleWin.prototype.getWingPanelInfo=function(){if(!this.isShow())return false;if(this.oldIndex!=3)return false;var chooseData;var len=SubRoles.ins().roles.length;for(var i=0;i<len;i++){var data=SubRoles.ins().getSubRoleByIndex(i).wingsData;if(!chooseData||chooseData.clearTime==0){chooseData=data}else if(chooseData.clearTime>data.clearTime&&data.clearTime>0){chooseData=data}}this.wingData=chooseData;return chooseData.clearTime>0&&Wing.hint};RoleWin.prototype.doOpenHintWin=function(type,index){if(index===void 0){index=0}ViewManager.ins().open(WingHintWin,type,index,this.wingData)};RoleWin.prototype.getEquipGrid=function(pos){this.validateNow();return this.roleInfoPanel.getEquipItem(pos)};RoleWin.prototype.playUIEff=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};return RoleWin}(BaseEuiView);__reflect(RoleWin.prototype,"RoleWin");ViewManager.ins().reg(RoleWin,LayerManager.UI_Main);var StarItem=function(_super){__extends(StarItem,_super);function StarItem(){var _this=_super.call(this)||this;_this.skinName="StarItemSkin";return _this}StarItem.prototype.isShow=function(num){this.starImg.source=num?"star2":""};StarItem.prototype.isShowFull=function(num){this.fullStarImg.source=num?"star1":""};return StarItem}(BaseView);__reflect(StarItem.prototype,"StarItem");var StarList=function(_super){__extends(StarList,_super);function StarList(listLength,starNum,spacing,isShowNum){if(listLength===void 0){listLength=10}if(starNum===void 0){starNum=0}if(spacing===void 0){spacing=50}if(isShowNum===void 0){isShowNum=1}var _this=_super.call(this)||this;_this._statListLength=listLength;_this._starNum=starNum;_this.list=[];for(var i=0;i<_this._statListLength;i++){var starItem=new StarItem;starItem.x=i*spacing+10;_this.addChild(starItem);if(i<=_this._starNum-1)starItem.isShow(1);starItem.isShowFull(isShowNum);_this.list.push(starItem)}_this.mc=new MovieClip;_this.mc.scaleX=1.5;_this.mc.scaleY=1.5;return _this}StarList.prototype.setStarNum=function(num,show){if(show===void 0){show=0}if(this._starNum==num)return;this._starNum=num;for(var i=0;i<this._statListLength;i++){if(i<=this._starNum-1){this.list[i].isShow(1);if(show==1&&i==this._starNum-1){this.mc.x=this.list[i].x+24;this.mc.y=this.list[i].y+28;if(!this.mc.parent){this.addChild(this.mc)}this.mc.playFile(RES_DIR_EFF+"minusstar",1)}}else{this.list[i].isShow(0)}}};Object.defineProperty(StarList.prototype,"starNum",{get:function(){return this._starNum},enumerable:true,configurable:true});Object.defineProperty(StarList.prototype,"listLength",{get:function(){return this._statListLength},enumerable:true,configurable:true});StarList.prototype.setlistLength=function(listLength,starNum,spacing,isShowNum){if(listLength===void 0){listLength=10}if(starNum===void 0){starNum=0}if(spacing===void 0){spacing=50}if(isShowNum===void 0){isShowNum=1}for(var i=this._statListLength;i<listLength;i++){var starItem=new StarItem;starItem.x=i*spacing+10;this.addChild(starItem);if(i<=starNum-1)starItem.isShow(1);starItem.isShowFull(isShowNum);this.list.push(starItem)}this._statListLength=listLength};return StarList}(BaseView);__reflect(StarList.prototype,"StarList");var WingHintWin=function(_super){__extends(WingHintWin,_super);function WingHintWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;return _this}WingHintWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WingWarnTips"};WingHintWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.up,this.onClick);this.addTouchEvent(this.BG,this.onClick);this.type=param[0];this.index=param[1];this.data=param[2];this.lastTimeDown=Math.floor((DateUtils.formatMiniDateTime(this.data.clearTime)-GameServer.serverTime)/1e3);this.lastTimeDown=(DateUtils.formatMiniDateTime(this.data.clearTime)-GameServer.serverTime)/1e3;this.lastTimeDown=Math.max(0,this.lastTimeDown);this.desc.textFlow=TextFlowMaker.generateTextFlow(i18n("WingHintWin_0",this.data.exp,DateUtils.getFormatBySecond(this.lastTimeDown,1)))};WingHintWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.up,this.onClick);this.removeTouchEvent(this.BG,this.onClick)};WingHintWin.prototype.onClick=function(e){ViewManager.ins().close(WingHintWin);switch(e.currentTarget){case this.closeBtn:if(this.type==1){var view=ViewManager.ins().getView(RoleWin);view.setTabSelectedIndex(this.index)}else if(this.type==2){ViewManager.ins().close(RoleWin)}break}Wing.hint=!this.nextHint.selected};return WingHintWin}(BaseEuiView);__reflect(WingHintWin.prototype,"WingHintWin");ViewManager.ins().reg(WingHintWin,LayerManager.UI_Popup);var WingSkillItemRender=function(_super){__extends(WingSkillItemRender,_super);function WingSkillItemRender(){var _this=_super.call(this)||this;_this.touchEnabled=false;_this.skinName="WingSkillItemSkin";return _this}WingSkillItemRender.prototype.dataChanged=function(){if(this.data){this.skillIcon.visible=true;this.skillIcon.source=this.data+"_png";this.blackImg.visible=false}};return WingSkillItemRender}(BaseItemRender);__reflect(WingSkillItemRender.prototype,"WingSkillItemRender");var WingSkillTipPanel=function(_super){__extends(WingSkillTipPanel,_super);function WingSkillTipPanel(){return _super.call(this)||this}WingSkillTipPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="WingSkillTipsPanel"};WingSkillTipPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var id=param[0];this.addTouchEndEvent(this,this.otherClose);this.setData(id)};WingSkillTipPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};WingSkillTipPanel.prototype.otherClose=function(evt){ViewManager.ins().close(this)};WingSkillTipPanel.prototype.setData=function(id){var config=new SkillData(id);if(config.name)this.nameLabel.text=config.name;if(config.desc)this.description.textFlow=TextFlowMaker.generateTextFlow(config.desc);this.BG.height=170+this.description.height};return WingSkillTipPanel}(BaseEuiView);__reflect(WingSkillTipPanel.prototype,"WingSkillTipPanel");ViewManager.ins().reg(WingSkillTipPanel,LayerManager.UI_Popup);var RollMapRankData=function(){function RollMapRankData(bytes){if(bytes===void 0){bytes=null}if(bytes){this.rank=bytes.readInt();this.actor_id=bytes.readInt();this.actor_name=bytes.readString();this.xiuwei=bytes.readInt();this.get_time=bytes.readInt()}}return RollMapRankData}();__reflect(RollMapRankData.prototype,"RollMapRankData");var RollMapRecordData=function(){function RollMapRecordData(data){this.roll_time=data.roll_time;this.game_tick=data.game_tick;this.used_dice=data.used_dice;this.cur_record=data.cur_record;this.cur_round=data.cur_round;this.cur_index=data.cur_index;this.cur_dice=data.cur_dice;this.cur_xiuwei=data.cur_xiuwei;this.cur_xiandai=data.cur_xiandai;this.add_dice=data.add_dice;this.dec_dice=data.dec_dice;this.get_xiuwei=data.get_xiuwei;this.get_xiandai=data.get_xiandai;this.get_round=data.get_round;this.get_forward=data.get_forward;this.get_forback=data.get_forback;this.award_list=data.award_list;this.g_acc_dice_inc=data.g_acc_dice_inc;this.g_acc_dice_dec=data.g_acc_dice_dec}return RollMapRecordData}();__reflect(RollMapRecordData.prototype,"RollMapRecordData");var RollMapResultData=function(){function RollMapResultData(bytes){if(bytes===void 0){bytes=null}this.steps_list=[];this.award_list=[];if(bytes){this.n=bytes.readByte();this.roll_time=bytes.readInt();this.game_tick=bytes.readDouble();this.used_dice=bytes.readShort();this.rand_choice=bytes.readShort();this.cur_round=bytes.readShort();this.cur_index=bytes.readByte();this.cur_dice=bytes.readInt();this.cur_xiuwei=bytes.readInt();this.cur_xiandai=bytes.readInt();this.add_dice=bytes.readShort();this.dec_dice=bytes.readShort();this.get_xiuwei=bytes.readShort();this.get_xiandai=bytes.readShort();this.get_round=bytes.readShort();this.get_shift=bytes.readShort();this.get_forward=bytes.readShort();this.get_forback=bytes.readShort();this.stepCount=bytes.readShort();for(var i=0;i<this.stepCount;i++){var n1=bytes.readByte();var n2=bytes.readByte();var n3=bytes.readShort();var n4=bytes.readShort();var arr=[n1,n2,n3,n4];this.steps_list[i]=arr}this.awardCount=bytes.readShort();for(var i=0;i<this.awardCount;i++){var rewardData=new RewardData;rewardData.id=bytes.readInt();rewardData.count=bytes.readInt();rewardData.type=bytes.readInt();this.award_list.push(rewardData)}}}return RollMapResultData}();__reflect(RollMapResultData.prototype,"RollMapResultData");var RollMapSys=function(_super){__extends(RollMapSys,_super);function RollMapSys(){var _this=_super.call(this)||this;_this.buyTimes={};_this.opened=false;_this.end_time=0;_this.redP0=0;_this.redP1=0;_this.redP2=0;_this.G_GRID_MAX=36;_this.g_cur_index=0;_this.g_cur_round=0;_this.g_cur_dice=0;_this.g_cur_xiuwei=0;_this.g_cur_xiandai=0;_this.g_acc_dice_inc=0;_this.g_acc_dice_dec=0;_this.grid_id=[];_this.grid_state=[];_this.isAuto=false;_this.rankList=[];_this.myRank=-1;_this.recordObj={};_this.recordArr=[];_this.sysId=PackageID.ROLLMAP;_this.regNetMsg(1,_this.postInfo);_this.regNetMsg(2,_this.postGrid);_this.regNetMsg(3,_this.postRollResult);_this.regNetMsg(4,_this.postRecord);_this.regNetMsg(5,_this.postRank);_this.regNetMsg(10,_this.postError);_this.regNetMsg(21,_this.postBuyTimes);_this.regNetMsg(22,_this.postGetDiceRes);_this.regNetMsg(23,_this.postSysOpenState);return _this}RollMapSys.ins=function(){return _super.ins.call(this)};RollMapSys.prototype.sendGetInfo=function(){var bytes=this.getBytes(11);this.sendToServer(bytes)};RollMapSys.prototype.sendRoll=function(n){if(n===void 0){n=1}if(this.isShowTime()){UserTips.ins().showTips(i18n("RollMapSys_0"));return}var bytes=this.getBytes(12);bytes.writeInt(n);this.sendToServer(bytes)};RollMapSys.prototype.sendGetGrid=function(){var bytes=this.getBytes(13);this.sendToServer(bytes)};RollMapSys.prototype.sendGetRank=function(){var bytes=this.getBytes(14);this.sendToServer(bytes)};RollMapSys.prototype.sendGetRecord=function(){var bytes=this.getBytes(15);this.sendToServer(bytes)};RollMapSys.prototype.postBuyTimes=function(bytes){var count=bytes.readInt();for(var i=0;i<count;i++){var id=bytes.readInt();var times=bytes.readInt();this.buyTimes[id]=times}};RollMapSys.prototype.getBuyTimes=function(id){if(id===void 0){id=1}return this.buyTimes&&this.buyTimes[id]||0};RollMapSys.prototype.sendGetDice=function(id){var bytes=this.getBytes(22);bytes.writeInt(id);this.sendToServer(bytes)};RollMapSys.prototype.postGetDiceRes=function(bytes){var err_code=bytes.readInt();var id=bytes.readInt();console.log("postGetDiceRes err_code:"+err_code+" id:"+id);return err_code};RollMapSys.prototype.postSysOpenState=function(bytes){var state=bytes.readByte();var time=bytes.readInt();this.opened=state>0;this.end_time=time;console.log("RollMapSys postSysOpenState open:"+state+" end_time:"+time)};RollMapSys.prototype.isOpen=function(){return this.opened};RollMapSys.prototype.getRedPoint=function(i){if(i===void 0){i=-1}this.redP0=UserBag.ins().canExchange(GlobalConfig.RollMapBaseConfig.exchangeId,-1)?1:0;this.redP1=UserTask.ins().hasSevenDayTaskReward(GlobalConfig.RollMapBaseConfig.taskId)?1:this.buyState(1)==eState.ok?1:0;this.redP2=0;if(i>=0&&i<=2){return this["redP"+i]}else{var sum=0;for(var i=0;i<=2;i++){sum+=this["redP"+i]}return sum}};RollMapSys.prototype.buyState=function(id){if(id===void 0){id=1}var cfg=GlobalConfig.RollMapStoreConfig[id];var limit=cfg.times||-1;var buyTimes=this.getBuyTimes(cfg.id);var b=limit>-1&&buyTimes<limit||limit==-1;return b?eState.ok:eState.no};Object.defineProperty(RollMapSys.prototype,"cur_index",{get:function(){return this.g_cur_index},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"cur_round",{get:function(){return this.g_cur_round},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"cur_dice",{get:function(){return this.g_cur_dice},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"cur_xiuwei",{get:function(){return this.g_cur_xiuwei},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"cur_xiandai",{get:function(){return this.g_cur_xiandai},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"cur_acc_dice_inc",{get:function(){return this.g_acc_dice_inc},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"cur_acc_dice_dec",{get:function(){return this.g_acc_dice_dec},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"grid_ids",{get:function(){return this.grid_id},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"grid_states",{get:function(){return this.grid_state},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"rank_list",{get:function(){return this.rankList},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"record_arr",{get:function(){return this.recordArr},enumerable:true,configurable:true});Object.defineProperty(RollMapSys.prototype,"my_rank",{get:function(){return this.myRank},enumerable:true,configurable:true});RollMapSys.prototype.postInfo=function(bytes){this.g_cur_index=bytes.readByte();this.g_cur_round=bytes.readInt();this.g_cur_dice=bytes.readInt();this.g_cur_xiuwei=bytes.readInt();this.g_cur_xiandai=bytes.readInt();this.g_acc_dice_inc=bytes.readInt();this.g_acc_dice_dec=bytes.readInt()};RollMapSys.prototype.postGrid=function(bytes){var arr=[];var arr2=[];this.G_GRID_MAX=bytes.readByte();for(var i=0;i<this.G_GRID_MAX;i++){var grid_id=bytes.readByte();arr[i]=grid_id;var grid_is_active=bytes.readByte();arr2[i]=grid_is_active}this.grid_id=arr;this.grid_state=arr2};RollMapSys.prototype.postRollResult=function(bytes){var res=new RollMapResultData(bytes);this.g_cur_index=res.cur_index;this.g_cur_round=res.cur_round;this.g_cur_dice=res.cur_dice;this.g_cur_xiuwei=res.cur_xiuwei;this.g_cur_xiandai=res.cur_xiandai;return res};RollMapSys.prototype.postRecord=function(bytes){var n=bytes.readInt();for(var i=0;i<n;i++){var str=bytes.readString();var data=JSON.parse(str);var recordData=new RollMapRecordData(data);var cur_record=recordData.cur_record;this.recordObj[cur_record]=data}this.sortRecord()};RollMapSys.prototype.sortRecord=function(){var tempArr=[];for(var k in this.recordObj){var v=this.recordObj[k];tempArr.push(v)}tempArr.sort(this.sortFunc);this.recordArr=tempArr};RollMapSys.prototype.sortFunc=function(a,b){var a1=a.cur_record;var b1=b.cur_record;if(a1>b1){return-1}if(a1<b1){return 1}return 0};RollMapSys.prototype.postRank=function(bytes){var ranklist=[];var n=bytes.readInt();var inRank=false;for(var i=0;i<n;i++){var data=new RollMapRankData(bytes);ranklist.push(data);if(data.actor_id==Actor.actorID){this.myRank=data.rank;inRank=true}}this.rankList=ranklist;if(!inRank){this.myRank=-1}return ranklist};RollMapSys.prototype.postError=function(bytes){var error_code=bytes.readShort();var error_info=bytes.readString();return error_code};RollMapSys.prototype.autoFlag=function(){return this.isAuto&&SysSetting.ins().getBool(SysSetting.ROLL_MAP_AUTO)};RollMapSys.prototype.postCloseAuto=function(){this.isAuto=false;SysSetting.ins().setBool(SysSetting.ROLL_MAP_AUTO,false)};RollMapSys.prototype.isShowTime=function(){var end_time=this.end_time;var time=Math.floor((DateUtils.formatMiniDateTime(end_time)-GameServer.serverTime)/1e3);if(time>0&&time<=GlobalConfig.RollMapBaseConfig.showTime){return true}};RollMapSys.prototype.getAwardStr=function(awards,split,end,needPre){if(split===void 0){split="*"}if(end===void 0){end=" "}if(needPre===void 0){needPre=false}var str="";var res="";for(var _i=0,awards_3=awards;_i<awards_3.length;_i++){var v=awards_3[_i];var itemid=v.id;if(itemid==MoneyConst.yuanbao){str+=i18n("CharItemName_1")+split+v.count.toString()+end}else{var data=new ItemData;data.configID=itemid;var name_11=data.itemConfig.name;str+=name_11+split+v.count.toString()+end}}str=str.slice(0,str.length-1);if(str.length>0){if(needPre){res=i18n("RollMapPanel_5",str)}else{res=str}}return res};RollMapSys.prototype.getFixTime=function(time){return time+1577808e3};return RollMapSys}(BaseSystem);__reflect(RollMapSys.prototype,"RollMapSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.rollmapsys=RollMapSys.ins.bind(RollMapSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var RollMapExchangeItemRender=function(_super){__extends(RollMapExchangeItemRender,_super);function RollMapExchangeItemRender(){var _this=_super.call(this)||this;_this.skinName="rollmapExchangeItemSkin";return _this}RollMapExchangeItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName;this.init()};RollMapExchangeItemRender.prototype.init=function(){this.btnExchange.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};RollMapExchangeItemRender.prototype.dataChanged=function(){if(!this.data){return}if(!this.data.config){return}var cfg=this.data.config;this.list.dataProvider=new eui.ArrayCollection(cfg.normal);var state=UserBag.ins().getExchangeState(cfg.id,cfg.eid);var count=cfg.materials[0]["count"]||0;this.btnExchange.enabled=state==eState.ok;this.btnExchange.label=state==eState.ok?i18n("RollMapExchangeItemRender_1",count.toString()):i18n("RollMapExchangeItemRender_0");this.redP();var disc=cfg.discount||100;this.discountGroup.visible=disc<100;this.discount.text=Math.floor(Math.min(100,disc)/10).toString();var limit=cfg.times||-1;this.type.text=cfg.type==loopMode.daily?i18n("PeachStoreItemRender_3"):i18n("PeachStoreItemRender_4");var t=UserBag.ins().getExchangedTimes(cfg.id,cfg.eid);if(limit>-1){this.limitGroup.visible=true;this.limit.text=t+"/"+limit}else{this.limitGroup.visible=false}};RollMapExchangeItemRender.prototype.redP=function(){var cfg=this.data.config;var b=UserBag.ins().canExchange(cfg.id,cfg.eid);this.redPoint.visible=b};RollMapExchangeItemRender.prototype.onClick=function(){var cfg=this.data.config;UserBag.ins().sendExchange(cfg.id,cfg.eid);RollMapSys.ins().postCloseAuto()};RollMapExchangeItemRender.prototype.onRemove=function(){this.btnExchange.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);TimerManager.ins().removeAll(this)};return RollMapExchangeItemRender}(BaseItemRender);__reflect(RollMapExchangeItemRender.prototype,"RollMapExchangeItemRender");var RollMapItemRender=function(_super){__extends(RollMapItemRender,_super);function RollMapItemRender(){var _this=_super.call(this)||this;_this.skinName="rollmapItemSkin";return _this}RollMapItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.init()};RollMapItemRender.prototype.init=function(){};RollMapItemRender.prototype.dataChanged=function(){};RollMapItemRender.prototype.onRemove=function(){TimerManager.ins().removeAll(this)};return RollMapItemRender}(BaseItemRender);__reflect(RollMapItemRender.prototype,"RollMapItemRender");var RollMapPanel=function(_super){__extends(RollMapPanel,_super);function RollMapPanel(){var _this=_super.call(this)||this;_this.curIndex=0;_this.grid_ids=[];_this.grid_states=[];_this.bubbleTime=2;_this.itemW=145;_this.gap=8;_this.len=8;_this.isPlaying=false;return _this}RollMapPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.listExchange.itemRenderer=RollMapExchangeItemRender;var self=this;for(var i=1;i<=36;i++){this["grid"+i]["itemIcon"].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this,true,0)}};RollMapPanel.prototype.open=function(){this.sysId=GlobalConfig.RollMapBaseConfig.exchangeId;this.addTouchEvent(this.arrowleft,this.onTap);this.addTouchEvent(this.arrowright,this.onTap);this.addTouchEvent(this.btn1,this.onTap);this.addTouchEvent(this.btn10,this.onTap);this.addTouchEvent(this.cbAuto,this.onTap);this.addTouchEvent(this.btnRecord,this.onTap);this.observe(UserBag.ins().postExchangeData,this.updateExchange);this.observe(UserBag.ins().postItemAdd,this.itemchange);this.observe(UserBag.ins().postItemDel,this.itemchange);this.observe(UserBag.ins().postItemChange,this.itemchange);this.observe(UserBag.ins().postExchangeRes,this.exchangeResult);this.observe(RollMapSys.ins().postInfo,this.setInfo);this.observe(RollMapSys.ins().postRollResult,this.startRolling);this.observe(RollMapSys.ins().postError,this.onError);this.observe(RollMapSys.ins().postCloseAuto,this.setAuto);RollMapSys.ins().sendGetInfo();this.initExchange();this.setFace();this.loadGrid();this.setInfo();this.hideBubble();this.setAuto()};RollMapPanel.prototype.setAuto=function(){this.cbAuto.selected=SysSetting.ins().getBool(SysSetting.ROLL_MAP_AUTO)};RollMapPanel.prototype.setInfo=function(dice_change,cur_round){if(dice_change===void 0){dice_change=undefined}if(cur_round===void 0){cur_round=undefined}var cur_dice;if(dice_change==undefined){cur_dice=RollMapSys.ins().cur_dice}else{cur_dice=Number(this.myScore.text)+dice_change}if(cur_round==undefined){cur_round=RollMapSys.ins().cur_round}cur_dice=Math.max(0,cur_dice);this.myScore.text=cur_dice.toString();this.myRecord.text=cur_round.toString()};RollMapPanel.prototype.setFace=function(){var roleData=SubRoles.ins().getSubRoleByIndex(0);this.face.source="yuanhead"+roleData.job+roleData.sex};RollMapPanel.prototype.createMc=function(){this.mc=ObjectPool.pop("MovieClip");this.mc.visible=false;this.movePointer.addChild(this.mc);this.mc.touchEnabled=false;this.mc.x=23;this.mc.y=65};RollMapPanel.prototype.removeMc=function(){if(this.mc){if(this.mc.parent){this.mc.parent.removeChild(this.mc)}this.mc.destroy()}};RollMapPanel.prototype.checkConfig=function(){var max=RollMapSys.ins().G_GRID_MAX;if(max>36){WarnWin.show(i18n("RollMapPanel_2",max),function(){},this);return false}return true};RollMapPanel.prototype.loadGrid=function(fakeState){if(fakeState===void 0){fakeState=false}var r=this.checkConfig();if(!r){return}var grid_ids=RollMapSys.ins().grid_ids;this.grid_ids=grid_ids;var grid_states=RollMapSys.ins().grid_states;var tempState=[];if(fakeState){for(var _i=0,grid_states_1=grid_states;_i<grid_states_1.length;_i++){var v=grid_states_1[_i];tempState.push(1)}this.grid_states=tempState}else{this.grid_states=grid_states}for(var i=0;i<RollMapSys.ins().G_GRID_MAX;i++){var idx=i+1;var gid=this.grid_ids[i];var state=this.grid_states[i];if(gid==undefined){return}if(state==undefined){return}var cfg=GlobalConfig.RollMapGridConfig;var icon=cfg[gid]&&cfg[gid].icon||"rm_item7";this["grid"+idx]["itemIcon"].source=icon;this["grid"+idx]["itemIcon"].visible=state>=1}var cur_index=RollMapSys.ins().cur_index;this.setGridPos(cur_index)};RollMapPanel.prototype.walkOnGrid=function(cb){if(cb===void 0){cb=null}var self=this;if(!cb){return}if(!this.result){console.log("RollMapPanel callback : L174");cb();return}var list=this.result.steps_list;if(list.length<1){console.log("RollMapPanel callback : L179");cb();return}var n1=list[0][0];var n2=list[0][1];var n3=list[0][2];var n4=list[0][3]||0;this.result.steps_list.splice(0,1);if(n1==0){this.loadGrid(true);this.setGridPos(0);this.setInfo(n4,n3);setTimeout(function(){self.walkOnGrid(cb)},300);return}var ci=this.curIndex;var end=ci+n1;var end_1=end-1;var gid=this.grid_ids[end_1]||0;if(end>36){console.log("walkOnGrid invalid index:"+end);cb();return}var isTemp=false;var nextList=this.result.steps_list;if(nextList.length<1){isTemp=false}else{var n1_1=nextList[0][0];if(n1_1==0){isTemp=true}else{isTemp=false}}isTemp=isTemp&&end==36;this.moveNext(n1>0?1:-1,200,end,isTemp,function(){self.walkOnGrid(cb)},gid)};RollMapPanel.prototype.moveNext=function(direction,time,tarGrid,isTemp,cb,gid){var _this=this;if(isTemp===void 0){isTemp=false}if(cb===void 0){cb=null}var self=this;var index=this.curIndex;var next=index+direction;if(next<0||next>36){console.log("RollMapPanel moveNext invalidGrid:"+next);return}var p=this.getGridPos(next);egret.Tween.removeTweens(this.movePointer);var tween=egret.Tween.get(this.movePointer);tween.to({x:p.x,y:p.y},time).call(function(){self.setGridPos(next);if(next!=tarGrid){self.moveNext(direction,time,tarGrid,isTemp,cb,gid)}else{if(isTemp){if(cb){cb()}return}var afterBubble=function(){self.hideBubble();if(cb){cb()}};var b=self.setBubble(gid,afterBubble,true);if(b){TimerManager.ins().doTimer(2e3,1,afterBubble,_this)}self.clearGrid(tarGrid)}},this)};RollMapPanel.prototype.clearGrid=function(index){if(index==0){return}this.grid_states[index-1]=0;this["grid"+index]["itemIcon"].visible=false};RollMapPanel.prototype.getGainDesc=function(gid,needPre){if(needPre===void 0){needPre=false}var desc="";var cfg=GlobalConfig.RollMapGridConfig[gid];if(!cfg){return desc}var gainType=this.getGainType(gid);var gain_count=cfg.gain_count||0;switch(gainType){case GAIN_TYPE.GET_AWARD:desc=RollMapSys.ins().getAwardStr(cfg.gain_award||[],"*"," ",needPre);break;case GAIN_TYPE.ADD_DICE:desc=i18n("RollMapPanel_6",gain_count);break;case GAIN_TYPE.DEC_DICE:desc=i18n("RollMapPanel_7",gain_count);break;case GAIN_TYPE.GOTO_AHEAD:desc=i18n("RollMapPanel_8",gain_count);break;case GAIN_TYPE.GOTO_BACK:desc=i18n("RollMapPanel_9",gain_count);break;case GAIN_TYPE.GOTO_START:desc=i18n("RollMapPanel_10");break}return desc};RollMapPanel.prototype.getGainType=function(gid){var cfg=GlobalConfig.RollMapGridConfig[gid];var gainType=cfg&&cfg.gain_type||1;return gainType};RollMapPanel.prototype.getMc=function(gid){var cfg=GlobalConfig.RollMapGridConfig[gid];var icon=cfg&&cfg.icon||"rm_item7";return icon};RollMapPanel.prototype.setGridPos=function(a){var p=this.getGridPos(a);this.movePointer.x=p.x;this.movePointer.y=p.y;this.curIndex=a};RollMapPanel.prototype.getGridPos=function(a){if(a==0){return{x:77.5,y:243}}if(a>36){a=a%36}return{x:this["grid"+a].x+44,y:this["grid"+a].y+40}};RollMapPanel.prototype.closeAuto=function(){if(this.isPlaying&&RollMapSys.ins().autoFlag){RollMapSys.ins().postCloseAuto()}else{RollMapSys.ins().isAuto=false}};RollMapPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.arrowleft:this.closeAuto();this.changeExchangePage(-3);break;case this.arrowright:this.closeAuto();this.changeExchangePage(3);break;case this.btn1:if(!this.isPlaying){RollMapSys.ins().isAuto=true;RollMapSys.ins().sendRoll(1)}else{if(RollMapSys.ins().autoFlag){RollMapSys.ins().postCloseAuto()}}break;case this.btn10:this.closeAuto();if(!this.isPlaying){RollMapSys.ins().sendRoll(10)}break;case this.cbAuto:SysSetting.ins().setBool(SysSetting.ROLL_MAP_AUTO,e.currentTarget.selected);break;case this.btnRecord:this.closeAuto();ViewManager.ins().open(RollMapRecordWin);break}};RollMapPanel.prototype.onClick=function(e){for(var i=1;i<=36;i++){if(e.currentTarget==this["grid"+i]["itemIcon"]){if(!this.isPlaying){this.setBubble(this.grid_ids[i-1],null,false)}}}};RollMapPanel.prototype.onError=function(error_code){if(error_code==-1){UserTips.ins().showTips(i18n("RollMapPanel_3"))}else if(error_code==-2){UserTips.ins().showTips(i18n("RollMapPanel_4"))}else if(error_code==-3){UserTips.ins().showTips(i18n("RollMapPanel_11"))}else if(error_code==-4){UserTips.ins().showTips(i18n("RollMapPanel_12"))}else if(error_code==-100){UserTips.ins().showTips(i18n("RollMapPanel_13"))}};RollMapPanel.prototype.startRolling=function(data){this.isPlaying=true;this.result=deepCopy(data);var self=this;var n=data.n;if(n<=1){var index=data.steps_list[1][0]||1;var cb=function(){self.walkOnGrid(function(){self.showRollResult(data)})};var list=this.result.steps_list;if(list.length<1){return}var n1=list[0][0];var n2=list[0][1];var n3=list[0][2];var n4=list[0][3]||0;if(n1==0&&n4==-1){this.setInfo(n4,n3);this.result.steps_list.splice(0,1);ViewManager.ins().open(RollMapTurnTableWin,data.rand_choice,cb,n)}}else{var cb=function(){self.showRollResult(data)};ViewManager.ins().open(RollMapTurnTableWin,1,cb,n)}};RollMapPanel.prototype.showRollResult=function(data){var n=data.n;this.isPlaying=false;this.result=null;this.loadGrid();this.setInfo();if(n==1){if(RollMapSys.ins().autoFlag()==true){RollMapSys.ins().sendRoll(n)}}else{ViewManager.ins().open(RollMapResultWin,data)}};RollMapPanel.prototype.hideBubble=function(){this.bubbleGroupDown.visible=false;this.bubbleGroupUp.visible=false;TimerManager.ins().removeAll(this)};RollMapPanel.prototype.getIndex=function(gid){for(var i=0;i<this.grid_ids.length;i++){var id=this.grid_ids[i];if(id==gid){return i+1}}return 0};RollMapPanel.prototype.setBubble=function(gid,cb,needPre){if(needPre===void 0){needPre=true}var i=this.getIndex(gid);var p=this.getGridPos(i);var s=this.grid_states[i-1]||0;if(s==0){if(cb){cb()}return false}this.awardLabelUp.text=this.getGainDesc(gid,needPre);this.awardLabelDown.text=this.getGainDesc(gid,needPre);this.timeLabelUp.text="(2)";this.timeLabelDown.text="(2)";var ty=p.y-this.bubbleGroupUp.height;if(ty<=30){this.setBubbleDown(gid)}else{this.setBubbleUp(gid)}this.bubbleTime=2;var self=this;var timeFunc=function(){self.bubbleTime-=1;if(self.bubbleTime<=0&&!cb){self.hideBubble()}self.timeLabelUp.text="("+self.bubbleTime.toString()+")";self.timeLabelDown.text="("+self.bubbleTime.toString()+")"};TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1e3,0,timeFunc,this);return true};RollMapPanel.prototype.setBubbleUp=function(gid){this.bubbleGroupUp.visible=true;this.bubbleGroupDown.visible=false;var p=this.getGridPos(this.getIndex(gid));var tx=p.x-this.bubbleGroupUp.width;var ty=p.y-this.bubbleGroupUp.height;this.bubble_bg_up.anchorOffsetX=this.bubble_bg_up.width;this.bubble_bg_up.anchorOffsetY=this.bubble_bg_up.height;if(tx<=5){this.bubble_bg_up.scaleX=-1;this.bubbleGroupUp.x=p.x;this.bubbleGroupUp.y=p.y-this.bubbleGroupUp.height}else{this.bubble_bg_up.scaleX=1;this.bubbleGroupUp.x=p.x-this.bubbleGroupUp.width;this.bubbleGroupUp.y=p.y-this.bubbleGroupUp.height}};RollMapPanel.prototype.setBubbleDown=function(gid){this.bubbleGroupUp.visible=false;this.bubbleGroupDown.visible=true;var p=this.getGridPos(this.getIndex(gid));var tx=p.x-this.bubbleGroupDown.width;var ty=p.y;if(tx<=5){this.bubble_bg_down.scaleX=-1;this.bubbleGroupDown.x=p.x;this.bubbleGroupDown.y=p.y}else{this.bubble_bg_down.scaleX=1;this.bubbleGroupDown.x=p.x-this.bubbleGroupDown.width;this.bubbleGroupDown.y=p.y}};RollMapPanel.prototype.changeExchangePage=function(index){if(index===void 0){index=0}var cur=this.scroller.viewport.scrollH;var next=index*(this.itemW+this.gap)+cur;var max=(this.itemW+this.gap)*(this.len-3);next=Math.max(0,next);next=Math.min(next,max);this.scroller.viewport.scrollH=next;if(next<=0){this.arrowleft.visible=false;this.arrowright.visible=true}else if(next>=max){this.arrowleft.visible=true;this.arrowright.visible=false}else{this.arrowleft.visible=true;this.arrowright.visible=true}};RollMapPanel.prototype.exchangeResult=function(param){var err_code=param[0]||0;var id=param[1];if(id==this.sysId&&err_code!=0){if(err_code==2){this.noXianBi()}}};RollMapPanel.prototype.noXianBi=function(){UserTips.ins().showTips(i18n("RollMapPanel_0"))};RollMapPanel.prototype.itemchange=function(){for(var i=0;i<this.listExchange.dataProvider.length;i++){var item=this.listExchange.getVirtualElementAt(i);if(item){item.redP()}}var id=GlobalConfig.RollMapBaseConfig.exchangeItemId;var isHave=UserBag.ins().getBagGoodsCountById(0,id);this.myXianbi.text=i18n("RollMapPanel_1",isHave)};RollMapPanel.prototype.initExchange=function(){var config=GlobalConfig.ItemExchangeConfig[this.sysId];var dataArr=[];for(var k in config){var eid=config[k].eid;var state=UserBag.ins().getExchangeState(this.sysId,eid);dataArr.push({config:config[k],state:state})}dataArr=dataArr.sort(this.sort);this.len=dataArr.length;this.dataArr=new eui.ArrayCollection(dataArr);this.listExchange.dataProvider=this.dataArr;this.itemchange()};RollMapPanel.prototype.updateExchange=function(){if(!this.dataArr){this.initExchange();return}var len=this.dataArr.source.length;for(var i=0;i<len;i++){var render=this.listExchange.getVirtualElementAt(i);if(render){render.dataChanged()}}this.itemchange()};RollMapPanel.prototype.sort=function(a,b){var eid1=a.config.eid;var eid2=b.config.eid;var state1=a.state;var state2=b.state;if(state1==eState.ok&&state2==eState.no){return-1}else if(state1==eState.no&&state2==eState.ok){return 1}if(eid1>eid2)return 1;else if(eid1<eid2)return-1;else return 0};RollMapPanel.prototype.close=function(){this.removeTouchEvent(this.arrowleft,this.onTap);this.removeTouchEvent(this.arrowright,this.onTap);this.removeTouchEvent(this.btn1,this.onTap);this.removeTouchEvent(this.btn10,this.onTap);for(var i=1;i<=36;i++){this["grid"+i]["itemIcon"].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}RollMapSys.ins().isAuto=false};return RollMapPanel}(BaseEuiView);__reflect(RollMapPanel.prototype,"RollMapPanel");var GAIN_TYPE;(function(GAIN_TYPE){GAIN_TYPE[GAIN_TYPE["GET_AWARD"]=1]="GET_AWARD";GAIN_TYPE[GAIN_TYPE["ADD_DICE"]=2]="ADD_DICE";GAIN_TYPE[GAIN_TYPE["DEC_DICE"]=3]="DEC_DICE";GAIN_TYPE[GAIN_TYPE["GOTO_AHEAD"]=4]="GOTO_AHEAD";GAIN_TYPE[GAIN_TYPE["GOTO_BACK"]=5]="GOTO_BACK";GAIN_TYPE[GAIN_TYPE["GOTO_START"]=6]="GOTO_START"})(GAIN_TYPE||(GAIN_TYPE={}));window["GAIN_TYPE"]=GAIN_TYPE;var RollMapRankItemRender=function(_super){__extends(RollMapRankItemRender,_super);function RollMapRankItemRender(){var _this=_super.call(this)||this;_this.skinName="rollmapRankItemSkin";return _this}RollMapRankItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};RollMapRankItemRender.prototype.dataChanged=function(){if(!this.data){return}var data=this.data;this.rank.text=data.rank.toString();this.nickname.text=data.actor_name;this.score.text=data.xiuwei.toString();var time=RollMapSys.ins().getFixTime(data.get_time);this.time.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_17);this.day.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_16)};return RollMapRankItemRender}(BaseItemRender);__reflect(RollMapRankItemRender.prototype,"RollMapRankItemRender");var RollMapRankPanel=function(_super){__extends(RollMapRankPanel,_super);function RollMapRankPanel(){return _super.call(this)||this}RollMapRankPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=RollMapRankItemRender;this.list1.itemRenderer=ItemBaseNoName;this.list2.itemRenderer=ItemBaseNoName;this.list3.itemRenderer=ItemBaseNoName};RollMapRankPanel.prototype.open=function(){TimerManager.ins().doTimer(100,0,this.lightAni,this);RollMapSys.ins().sendGetRank();this.addTouchEndEvent(this.btnAward1,this.onTouch);this.addTouchEndEvent(this.btnAward2,this.onTouch);this.addTouchEndEvent(this.btnAward3,this.onTouch);this.addTouchEndEvent(this.btnMore,this.onTouch);this.observe(RollMapSys.ins().postRank,this.setWinData);this.observe(RollMapSys.ins().postInfo,this.setMyInfo);this.observe(RollMapSys.ins().postRollResult,this.setMyInfo);this.setWinData()};RollMapRankPanel.prototype.setWinData=function(){var data=RollMapSys.ins().rank_list;this.list.dataProvider=new eui.ArrayCollection(data);this.state.visible=data.length<1;for(var i=1;i<=3;i++){var config=GlobalConfig.RollMapRankAwardConfig[i];var award=config.award;this["list"+i].dataProvider=new eui.ArrayCollection(award)}this.setMyInfo()};RollMapRankPanel.prototype.setMyInfo=function(){this.myScore.text=RollMapSys.ins().cur_xiuwei.toString();this.myRank.text=RollMapSys.ins().my_rank>-1?""+RollMapSys.ins().my_rank:i18n("RollMapRankPanel_0")};RollMapRankPanel.prototype.onTouch=function(e){switch(e.target){case this.btnAward1:break;case this.btnAward2:break;case this.btnAward3:break;case this.btnMore:ViewManager.ins().open(RollMapRankRewardWin);break}};RollMapRankPanel.prototype.lightAni=function(){this.light.rotation+=60};RollMapRankPanel.prototype.close=function(){TimerManager.ins().remove(this.lightAni,this)};return RollMapRankPanel}(BaseEuiView);__reflect(RollMapRankPanel.prototype,"RollMapRankPanel");var RollMapRankRewardItemRender=function(_super){__extends(RollMapRankRewardItemRender,_super);function RollMapRankRewardItemRender(){var _this=_super.call(this)||this;_this.textColors=[16710568,15526141,16569017,12176636];_this.strokeColors=[8076674,4538995,2380625,5782380];_this.skinName="rollmapRankRewardItemSkin";return _this}RollMapRankRewardItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};RollMapRankRewardItemRender.prototype.dataChanged=function(){if(!this.data)return;this.dwName.text="";this.levelImg.source="level_4";this.dwImg.source="number4";this.dwName.textColor=this.textColors[this.textColors.length-1];this.dwName.strokeColor=this.strokeColors[this.textColors.length-1];if(this.itemIndex<4){this.dwImg.source="number"+(this.itemIndex+1);this.levelImg.source="level_"+(this.itemIndex+1);this.dwName.textColor=this.textColors[this.itemIndex%4];this.dwName.strokeColor=this.strokeColors[this.itemIndex%4]}this.dwName.text=i18n("RollMapRankRewardItemRender_0",this.itemIndex+1);var award=GlobalConfig.RollMapRankAwardConfig[this.itemIndex+1].award;this.reward.dataProvider=new eui.ArrayCollection(award)};return RollMapRankRewardItemRender}(BaseItemRender);__reflect(RollMapRankRewardItemRender.prototype,"RollMapRankRewardItemRender");var RollMapRankRewardWin=function(_super){__extends(RollMapRankRewardWin,_super);function RollMapRankRewardWin(){var _this=_super.call(this)||this;_this.skinName="rollmapRankRewardSkin";return _this}RollMapRankRewardWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.close);this.list.itemRenderer=RollMapRankRewardItemRender;var award=[];for(var i in GlobalConfig.RollMapRankAwardConfig){award.push(i)}this.list.dataProvider=new eui.ArrayCollection(award)};RollMapRankRewardWin.prototype.close=function(){_super.prototype.close.call(this);ViewManager.ins().close(this)};return RollMapRankRewardWin}(BaseEuiView);__reflect(RollMapRankRewardWin.prototype,"RollMapRankRewardWin");ViewManager.ins().reg(RollMapRankRewardWin,LayerManager.UI_Popup);var RollMapRecordItemRender=function(_super){__extends(RollMapRecordItemRender,_super);function RollMapRecordItemRender(){var _this=_super.call(this)||this;_this.skinName="rollmapRecordItemSkin";return _this}RollMapRecordItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};RollMapRecordItemRender.prototype.dataChanged=function(){if(!this.data)return;var awardList=this.data.award_list;var get_xiandai=this.data.get_xiandai;if(get_xiandai>0){var data=new RewardData;data.id=GlobalConfig.RollMapBaseConfig.exchangeItemId;data.count=get_xiandai;data.type=1;var added=false;var l=0;for(var _i=0,awardList_1=awardList;_i<awardList_1.length;_i++){var v=awardList_1[_i];if(v.id==data.id){v.count=data.count;added=true}l++}if(!added){if(l>0){awardList.push(data)}else{awardList=[data]}}}if(awardList.length<1){this.awardLabel.text=""}else{this.awardLabel.text=RollMapSys.ins().getAwardStr(awardList," *","\n",false)}var time=this.data.roll_time;this.time.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_17);this.day.text=DateUtils.getFormatBySecond(time,DateUtils.TIME_FORMAT_16);this.used_dice.text=this.data.used_dice.toString();this.get_forward.text=this.data.get_forward.toString();this.get_forback.text=this.data.get_forback.toString();this.add_dice.text=this.data.add_dice.toString();this.get_xiuwei.text=this.data.get_xiuwei.toString()};return RollMapRecordItemRender}(BaseItemRender);__reflect(RollMapRecordItemRender.prototype,"RollMapRecordItemRender");var RollMapRecordWin=function(_super){__extends(RollMapRecordWin,_super);function RollMapRecordWin(){var _this=_super.call(this)||this;_this.skinName="rollmapRecordSkin";_this.itemList.itemRenderer=RollMapRecordItemRender;return _this}RollMapRecordWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.observe(RollMapSys.ins().postRecord,this.update);RollMapSys.ins().sendGetRecord();this.update()};RollMapRecordWin.prototype.update=function(){var arr=RollMapSys.ins().record_arr;this.itemList.dataProvider=new eui.ArrayCollection(arr)};RollMapRecordWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break}};RollMapRecordWin.prototype.close=function(){_super.prototype.close.call(this);this.removeTouchEvent(this.bgClose,this.onTap)};return RollMapRecordWin}(BaseEuiView);__reflect(RollMapRecordWin.prototype,"RollMapRecordWin");ViewManager.ins().reg(RollMapRecordWin,LayerManager.UI_Popup);var RollMapResultWin=function(_super){__extends(RollMapResultWin,_super);function RollMapResultWin(){var _this=_super.call(this)||this;_this.itemW=90;_this.gap=6;_this.len=2;_this.skinName="rollmapResultSkin";_this.itemList.itemRenderer=ItemBase;return _this}RollMapResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.moreBtn,this.onTap);this.addTouchEvent(this.confirmBtn,this.onTap);this.addTouchEvent(this.arrowleft,this.onTap);this.addTouchEvent(this.arrowright,this.onTap);this.data=param[0];this.update()};RollMapResultWin.prototype.update=function(){if(!this.data){return}var n=this.data.n;var awardList=this.data.award_list;this.moreBtn.label=n>1?i18n("RollMapResultWin_1"):i18n("RollMapResultWin_0");var get_xiandai=this.data.get_xiandai;if(get_xiandai>0){var data=new RewardData;data.id=GlobalConfig.RollMapBaseConfig.exchangeItemId;data.count=get_xiandai;data.type=1;var added=false;for(var _i=0,awardList_2=awardList;_i<awardList_2.length;_i++){var v=awardList_2[_i];if(v.id==data.id){v.count=data.count;added=true}}if(!added){awardList.push(data)}}this.itemList.dataProvider=new eui.ArrayCollection(awardList);this.len=awardList.length;this.itemScroller.width=awardList.length<3?90*awardList.length+(awardList.length-1)*6:290;this.add_dice.text=this.data.add_dice.toString();this.get_xiuwei.text=this.data.get_xiuwei.toString();this.get_xiandai.text=this.data.get_xiandai.toString();this.get_forback.text=this.data.get_forback.toString();this.used_dice.text=this.data.used_dice.toString();if(this.data.get_shift<0){this.get_forward.text=i18n("RollMapResultWin_2",-this.data.get_shift)}else if(this.data.get_shift>=0&&this.data.get_round==0){this.get_forward.text=i18n("RollMapResultWin_3",this.data.get_shift)}else if(this.data.get_shift>=0&&this.data.get_round>0){this.get_forward.text=i18n("RollMapResultWin_4",this.data.get_round,this.data.get_shift)}else{this.get_forward.text=""}var self=this;if(RollMapSys.ins().autoFlag()==true){setTimeout(function(){if(RollMapSys.ins().autoFlag()==true){self.onMore()}},5e3)}};RollMapResultWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:case this.confirmBtn:ViewManager.ins().close(this);RollMapSys.ins().isAuto=false;break;case this.moreBtn:RollMapSys.ins().isAuto=false;this.onMore();break;case this.arrowleft:this.changeAwardPage(-3);break;case this.arrowright:this.changeAwardPage(3);break}};RollMapResultWin.prototype.changeAwardPage=function(index){if(index===void 0){index=0}var cur=this.itemScroller.viewport.scrollH;var next=index*(this.itemW+this.gap)+cur;var max=(this.itemW+this.gap)*(this.len-3);next=Math.max(0,next);next=Math.min(next,max);this.itemScroller.viewport.scrollH=next;if(next<=0){this.arrowleft.visible=false;this.arrowright.visible=true}else if(next>=max){this.arrowleft.visible=true;this.arrowright.visible=false}else{this.arrowleft.visible=true;this.arrowright.visible=true}};RollMapResultWin.prototype.onMore=function(){ViewManager.ins().close(this);var data=this.data;if(!data){return}var n=this.data.n;RollMapSys.ins().sendRoll(n)};RollMapResultWin.prototype.close=function(){_super.prototype.close.call(this);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.moreBtn,this.onTap);this.removeTouchEvent(this.confirmBtn,this.onTap)};return RollMapResultWin}(BaseEuiView);__reflect(RollMapResultWin.prototype,"RollMapResultWin");ViewManager.ins().reg(RollMapResultWin,LayerManager.UI_Popup);var RollMapStoreItemRender=function(_super){__extends(RollMapStoreItemRender,_super);function RollMapStoreItemRender(){var _this=_super.call(this)||this;_this.skinName="rollmapStoreItemSkin";return _this}RollMapStoreItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.init()};RollMapStoreItemRender.prototype.init=function(){this.btnFree.addEventListener(egret.TouchEvent.TOUCH_END,this.onFreeClick,this);this.btnYB.addEventListener(egret.TouchEvent.TOUCH_END,this.onYBClick,this);this.btnRMB.addEventListener(egret.TouchEvent.TOUCH_END,this.onRMBClick,this)};RollMapStoreItemRender.prototype.dataChanged=function(){if(!this.data){return}if(!this.data.config){return}var cfg=this.data.config;this.itemName.text=cfg.name;this.itemIcon.data=cfg.awardList[0];this.itemIcon.hideName();this.itemIcon.showNum(false);var type=1;var yb=cfg.yb||0;var rechargeId=cfg.rechargeId||0;var disc=cfg.discount||100;var limit=cfg.times||-1;var buyTimes=RollMapSys.ins().getBuyTimes(cfg.id);this.redPoint.visible=false;this.discountGroup.visible=disc<100;this.discount.text=Math.floor(Math.min(100,disc)/10).toString();this.price.visible=(cfg.originPrice||0)>0;this.originPrice.text=i18n("RollMapStoreItemRender_1",cfg.originPrice);if(ChannelMgr.ins().isAnQiGeChannel()&&rechargeId>0){var rcfg=GlobalConfig.RechargeItemsConfig[rechargeId];this.originPrice.text=i18n("RollMapStoreItemRender_1",Math.floor(rcfg.channel_20121_NT/cfg.discount*100))}if(yb==0&&rechargeId==0){type=1;this.btnFree.enabled=this.data.state==eState.ok;this.redPoint.visible=this.btnFree.enabled}else if(yb>0){type=2;this.btnYB.enabled=this.data.state==eState.ok;this.btnYB["yb"].text=yb}else if(rechargeId>0){type=3;var rcfg=GlobalConfig.RechargeItemsConfig[rechargeId];this.btnRMB.label=i18n("RollMapStoreItemRender_0",rcfg.cash);this.btnRMB.enabled=this.data.state==eState.ok;if(ChannelMgr.ins().isAnQiGeChannel()){this.btnRMB.label=i18n("PeachStoreItemRender_6",rcfg.channel_20121_NT)}}if(yb==0&&rechargeId==0){this.type.text=i18n("RollMapStoreItemRender_2")}else{this.type.text=cfg.type==loopMode.daily?i18n("RollMapStoreItemRender_3"):i18n("RollMapStoreItemRender_4")}if(limit>-1){this.limit.textFlow=TextFlowMaker.generateTextFlow(i18n("RollMapStoreItemRender_5",buyTimes,limit))}else{this.limit.text=""}this.btnFree.visible=type==1;this.btnYB.visible=type==2;this.btnRMB.visible=type==3};RollMapStoreItemRender.prototype.onFreeClick=function(){var cfg=this.data.config;RollMapSys.ins().sendGetDice(cfg.id)};RollMapStoreItemRender.prototype.onYBClick=function(){this.onFreeClick()};RollMapStoreItemRender.prototype.onRMBClick=function(){var cfg=this.data.config;Recharge.ins().showReCharge(cfg.rechargeId)};RollMapStoreItemRender.prototype.onRemove=function(){this.btnFree.removeEventListener(egret.TouchEvent.TOUCH_END,this.onFreeClick,this);this.btnYB.removeEventListener(egret.TouchEvent.TOUCH_END,this.onYBClick,this);this.btnRMB.removeEventListener(egret.TouchEvent.TOUCH_END,this.onRMBClick,this);TimerManager.ins().removeAll(this)};return RollMapStoreItemRender}(BaseItemRender);__reflect(RollMapStoreItemRender.prototype,"RollMapStoreItemRender");var RollMapTaskItemRender=function(_super){__extends(RollMapTaskItemRender,_super);function RollMapTaskItemRender(){var _this=_super.call(this)||this;_this.skinName="rollmapTaskItemSkin";return _this}RollMapTaskItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName;this.progressBar.value=0;this.init();this.setMC()};RollMapTaskItemRender.prototype.setBar=function(value,max){if(value===void 0){value=0}if(max===void 0){max=100}this.progressBar.maximum=max;this.progressBar.value=value};RollMapTaskItemRender.prototype.init=function(){this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this)};RollMapTaskItemRender.prototype.dataChanged=function(){if(!this.data){return}if(!this.data.config){return}var r=this.data;switch(r.state){case 0:this.btnGet.enabled=true;this.btnGet.label=i18n("RollMapTaskItemRender_0");break;case 1:this.btnGet.enabled=true;this.btnGet.label=i18n("RollMapTaskItemRender_1");break;case 2:this.btnGet.enabled=false;this.btnGet.label=i18n("RollMapTaskItemRender_2");break;case 3:this.btnGet.enabled=false;this.btnGet.label=i18n("RollMapTaskItemRender_3");break;case 4:this.btnGet.enabled=false;this.btnGet.label=i18n("RollMapTaskItemRender_4");break}this.eff.visible=this.redPoint.visible=r.state==1;this.info.text=i18n("RollMapTaskItemRender_5",r.config.desc,r.data.value,r.config.target);this.setBar(r.data.value,r.config.target);this.list.dataProvider=new eui.ArrayCollection(r.config.awardList.slice())};RollMapTaskItemRender.prototype.onTap=function(e){var r=this.data;switch(e.currentTarget){case this.btnGet:if(r.state==0){if(!r.config.controlTarget)return;var cls=egret.getDefinitionByName(r.config.controlTarget[0]);if(!cls)return;ViewManager.ins().close(RollMapWin);(_a=ViewManager.ins()).open.apply(_a,[cls].concat(r.config.controlTarget.slice(1)))}else if(r.state==1){UserTask.ins().getSevenDayTaskReward(r.config.id)}break}var _a};RollMapTaskItemRender.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=51;this.mc.y=20;this.mc.width=102;this.mc.height=46;this.mc.scaleX=.66;this.mc.scaleY=.78;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.eff.addChild(this.mc)}};return RollMapTaskItemRender}(BaseItemRender);__reflect(RollMapTaskItemRender.prototype,"RollMapTaskItemRender");var RollMapTaskPanel=function(_super){__extends(RollMapTaskPanel,_super);function RollMapTaskPanel(){var _this=_super.call(this)||this;_this.itemW=145;_this.gap=8;_this.len=8;return _this}RollMapTaskPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.listDay.itemRenderer=RollMapTaskItemRender;this.listStore.itemRenderer=RollMapStoreItemRender};RollMapTaskPanel.prototype.open=function(){this.sysId=GlobalConfig.RollMapBaseConfig.taskId;this.addTouchEvent(this.arrowleft,this.onTap);this.addTouchEvent(this.arrowright,this.onTap);this.observe(UserTask.ins().postSevenDayTasks,this.updateTask);this.observe(RollMapSys.ins().postBuyTimes,this.updateStore);this.observe(RollMapSys.ins().postGetDiceRes,this.result);this.observe(UserBag.ins().postItemAdd,this.itemChange);this.observe(UserBag.ins().postItemDel,this.itemChange);this.observe(UserBag.ins().postItemChange,this.itemChange);this.observe(RollMapSys.ins().postInfo,this.setInfo);this.updateTask();this.updateStore();this.itemChange();this.setInfo();RollMapSys.ins().sendGetInfo();if(!TimerManager.ins().isExists(this.updateTime,this)){this.updateTime();TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}};RollMapTaskPanel.prototype.setInfo=function(){this.total.text=RollMapSys.ins().cur_acc_dice_inc.toString();this.used.text=RollMapSys.ins().cur_acc_dice_dec.toString()};RollMapTaskPanel.prototype.itemChange=function(){var id=GlobalConfig.RollMapBaseConfig.costItemId;var isHave=UserBag.ins().getBagGoodsCountById(0,id);this.cur.text=isHave.toString()};RollMapTaskPanel.prototype.result=function(param){var err_code=param||0;if(err_code==2){this.noYB()}};RollMapTaskPanel.prototype.noYB=function(){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("RollMapTaskPanel_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,this);warnWin.setBtnLabel(i18n("RollMapTaskPanel_2"),i18n("RollMapTaskPanel_1"))};RollMapTaskPanel.prototype.onTap=function(e){var tar=e.currentTarget;if(tar==this.arrowleft){this.changeStorePage(-3)}else if(tar==this.arrowright){this.changeStorePage(3)}};RollMapTaskPanel.prototype.updateStore=function(){var config=GlobalConfig.RollMapStoreConfig;var dataArr=[];for(var k in config){var state=RollMapSys.ins().buyState(config[k].id);var h=ChannelMgr.ins().isRechargeHidden();if(h&&config[k].rechargeId<=0||!h){dataArr.push({config:config[k],state:state})}}dataArr=dataArr.sort(this.sort2);this.len=dataArr.length;this.listStore.dataProvider=new eui.ArrayCollection(dataArr)};RollMapTaskPanel.prototype.sort2=function(a,b){var id1=a.config.id;var id2=b.config.id;var state1=a.state;var state2=b.state;if(state1==eState.ok&&state2==eState.no){return-1}else if(state1==eState.no&&state2==eState.ok){return 1}if(id1>id2)return 1;else if(id1<id2)return-1;else return 0};RollMapTaskPanel.prototype.changeStorePage=function(index){if(index===void 0){index=0}var cur=this.scroller.viewport.scrollH;var next=index*(this.itemW+this.gap)+cur;var max=(this.itemW+this.gap)*(this.len-3);next=Math.max(0,next);next=Math.min(next,max);this.scroller.viewport.scrollH=next;if(next<=0){this.arrowleft.visible=false;this.arrowright.visible=true}else if(next>=max){this.arrowleft.visible=true;this.arrowright.visible=false}else{this.arrowleft.visible=true;this.arrowright.visible=true}};RollMapTaskPanel.prototype.updateTime=function(){var totalNum=1*DateUtils.SECOND_PER_DAY;var left=totalNum-DateUtils.getTodayPassedSecond();this.timeTxtDay.text=DateUtils.getFormatBySecond(left,DateUtils.TIME_FORMAT_1,4)};RollMapTaskPanel.prototype.updateTask=function(){var ids1=[];var config=GlobalConfig.SystemTaskConfig[this.sysId][UserTask.ACTIVATE_TYPE_LOOP];var arr1=[];for(var k in config){var daily_reset=config[k].daily_reset;var task_ids=config[k].task_ids;if(daily_reset==1){for(var _i=0,task_ids_3=task_ids;_i<task_ids_3.length;_i++){var v=task_ids_3[_i];ids1.push(v)}}}var dCfg=GlobalConfig.DailyConfig;for(var _a=0,ids1_2=ids1;_a<ids1_2.length;_a++){var id=ids1_2[_a];var data=UserTask.ins().getSevenDayTaskById(id);if(!data)continue;arr1.push({config:dCfg[id],state:data.state,data:data,daily_reset:1})}arr1=arr1.sort(this.sort);this.listDay.dataProvider=new eui.ArrayCollection(arr1)};RollMapTaskPanel.prototype.sort=function(a,b){var id1=a.config.id;var id2=b.config.id;var state1=a.state;var state2=b.state;if(state1==1&&state2!=1){return-1}else if(state1!=1&&state2==1){return 1}if(state1!=1&&state2!=1){if(state1>state2){return 1}else if(state1<state2){return-1}}if(id1>id2)return 1;else if(id1<id2)return-1;else return 0};RollMapTaskPanel.prototype.close=function(){TimerManager.ins().removeAll(this)};return RollMapTaskPanel}(BaseEuiView);__reflect(RollMapTaskPanel.prototype,"RollMapTaskPanel");var RollMapTurnTableWin=function(_super){__extends(RollMapTurnTableWin,_super);function RollMapTurnTableWin(){var _this=_super.call(this)||this;_this.created=false;_this.opened=false;_this.skinName="rollmapTurnTableSkin";return _this}RollMapTurnTableWin.prototype.childrenCreated=function(){this.created=true;this.beginLottery(this.index,this.cb,this.count)};RollMapTurnTableWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var index=param[0]||1;this.index=this.checkIndex(index);this.cb=param[1]||null;this.count=param[2]||1;this.opened=true;this.addTouchEvent(this,this.onTap);this.beginLottery(this.index,this.cb,this.count)};RollMapTurnTableWin.prototype.onTap=function(){RollMapSys.ins().postCloseAuto()};RollMapTurnTableWin.prototype.checkIndex=function(index){index=Math.max(1,index);index=Math.min(6,index);return index};RollMapTurnTableWin.prototype.beginLottery=function(index,cb,count){if(cb===void 0){cb=null}if(count===void 0){count=1}if(!this.created||!this.opened){return}this.tttzhi.rotation=180;var rotat=180+360*4+(index-1)*60;var tween=egret.Tween.get(this.tttzhi);var self=this;if(count>1){index=Math.floor(Math.random()*6);index=this.checkIndex(index);rotat=180+360*6+(index-1)*60;tween.to({rotation:rotat},2e3).call(function(){if(cb){cb()}ViewManager.ins().close(RollMapTurnTableWin)},this);console.log("转盘十连随机展示:"+index)}else{tween.to({rotation:rotat},1800,egret.Ease.circOut).call(function(){if(cb){cb()}ViewManager.ins().close(RollMapTurnTableWin)},this);console.log("转盘单抽展示:"+index)}};RollMapTurnTableWin.prototype.close=function(){_super.prototype.close.call(this);egret.Tween.removeTweens(this.tttzhi)};return RollMapTurnTableWin}(BaseEuiView);__reflect(RollMapTurnTableWin.prototype,"RollMapTurnTableWin");ViewManager.ins().reg(RollMapTurnTableWin,LayerManager.UI_Popup);var RollMapWin=function(_super){__extends(RollMapWin,_super);function RollMapWin(){var _this=_super.call(this)||this;_this.skinName="rollmapWinSkin";_this.isTopLevel=true;return _this}RollMapWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};RollMapWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=param[0]?param[0]:0;this.addTouchEndEvent(this,this.onTouch);this.addChangeEvent(this.tab,this.onTabTouch);this.setOpenIndex(this.oldIndex);this.observe(UserBag.ins().postExchangeData,this.updateRed);this.observe(UserBag.ins().postItemAdd,this.updateRed);this.observe(UserBag.ins().postItemDel,this.updateRed);this.observe(UserBag.ins().postItemChange,this.updateRed);RollMapSys.ins().sendGetRank();this.checkState()};RollMapWin.prototype.checkState=function(){if(!TimerManager.ins().isExists(this.updateTime,this)){this.updateTime();TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}this.updateRed()};RollMapWin.prototype.close=function(){TimerManager.ins().removeAll(this)};RollMapWin.prototype.updateTime=function(){var end_time=RollMapSys.ins().end_time;var left=Math.floor((DateUtils.formatMiniDateTime(end_time)-GameServer.serverTime)/1e3);left=Math.max(0,left);this.timeTxt.text=DateUtils.getFormatBySecond(left,DateUtils.TIME_FORMAT_5,3)};RollMapWin.prototype.onTabTouch=function(e){var index=this.tab.selectedIndex;this.setOpenIndex(index)};RollMapWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[56].text);break}};RollMapWin.prototype.setOpenIndex=function(selectedIndex){if(selectedIndex==1&&RollMapSys.ins().isShowTime()){UserTips.ins().showTips(i18n("RollMapSys_0"));if(this.oldIndex!=selectedIndex){this.tab.selectedIndex=this.viewStack.selectedIndex=this.oldIndex}else{this.viewStack.getElementAt(this.oldIndex)["close"]();this.tab.selectedIndex=this.viewStack.selectedIndex=0;this.oldIndex=0}return}switch(selectedIndex){case 0:this.rollmap.open();break;case 1:this.task.open();break;case 2:this.rank.open();break}if(this.oldIndex!=selectedIndex){this.viewStack.getElementAt(this.oldIndex)["close"]();this.oldIndex=selectedIndex}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}};RollMapWin.prototype.updateRed=function(){this.redPoint0.visible=RollMapSys.ins().getRedPoint(0)>0;this.redPoint1.visible=RollMapSys.ins().getRedPoint(1)>0;this.redPoint2.visible=RollMapSys.ins().getRedPoint(2)>0};return RollMapWin}(BaseEuiView);__reflect(RollMapWin.prototype,"RollMapWin");ViewManager.ins().reg(RollMapWin,LayerManager.UI_Main);var Rune=function(_super){__extends(Rune,_super);function Rune(){var _this=_super.call(this)||this;_this.huntFreeTimes=0;_this.sysId=PackageID.Rune;_this.regNetMsg(1,_this.doInlay);_this.regNetMsg(2,_this.doUpgrade);_this.regNetMsg(3,_this.doOneKeyDecompose);_this.regNetMsg(5,_this.postHuntRuneInfo);_this.regNetMsg(6,_this.postBestListInfo);_this.regNetMsg(8,_this.postRuneBoxGift);_this.regNetMsg(10,_this.postDelRune);_this.boxs=[];return _this}Rune.ins=function(){return _super.ins.call(this)};Rune.prototype.sendInlay=function(role,pos,runeid){var bytes=this.getBytes(1);bytes.writeShort(role);bytes.writeShort(pos);bytes.writeDouble(runeid);this.sendToServer(bytes)};Rune.prototype.doInlay=function(bytes){var isSuccess=Boolean(bytes.readShort());var roleID=0;var pos=0;var id=0;if(isSuccess){roleID=bytes.readShort();pos=bytes.readShort();id=bytes.readInt()}this.postInlayResult([isSuccess,roleID,pos,id])};Rune.prototype.postInlayResult=function(param){return param};Rune.prototype.sendUpgrade=function(role,pos){var bytes=this.getBytes(2);bytes.writeShort(role);bytes.writeShort(pos);this.sendToServer(bytes)};Rune.prototype.doUpgrade=function(bytes){var isSuccess=Boolean(bytes.readByte());if(isSuccess){var roleID=bytes.readShort();var pos=bytes.readShort();var id=bytes.readInt();RuneDataMgr.ins().replaceRune(roleID,pos,id);this.postUpgradeResult([isSuccess,roleID,id,pos])}};Rune.prototype.postUpgradeResult=function(param){return param};Rune.prototype.sendOneKeyDecompose=function(uidList){var len=uidList.length;var packNum=Math.ceil(len/500);for(var p=0;p<packNum;p++){var bytes=this.getBytes(3);var pl=p<packNum-1?500:len%500;bytes.writeInt(pl);for(var i=0;i<pl;i++){bytes.writeInt(uidList[p*500+i].configID)}this.sendToServer(bytes)}};Rune.prototype.doOneKeyDecompose=function(bytes){var isSuccess=Boolean(bytes.readByte());var normalNum=bytes.readInt();this.postOneKeyDecomposeResult([isSuccess,normalNum])};Rune.prototype.postOneKeyDecomposeResult=function(param){return param};Rune.prototype.sendExchangeRune=function(id){var bytes=this.getBytes(4);bytes.writeUnsignedInt(id);this.sendToServer(bytes)};Rune.prototype.sendHuntRune=function(type){var bytes=this.getBytes(5);bytes.writeShort(type);this.sendToServer(bytes)};Rune.prototype.postHuntRuneInfo=function(bytes){var type=bytes.readUnsignedByte();var num=bytes.readUnsignedByte();var arr=[];for(var i=0;i<num;i++){arr[i]=[bytes.readInt(),bytes.readUnsignedByte()]}if(ViewManager.ins().isShow(HuntResultWin)){Hunt.ins().postHuntResult(type,arr,1)}else{ViewManager.ins().open(HuntResultWin,type,arr,1)}};Rune.prototype.postBestListInfo=function(bytes){var num=bytes.readUnsignedByte();var arr=[];for(var i=0;i<num;i++){arr[i]=[bytes.readString(),bytes.readInt()]}arr.reverse();return arr};Rune.prototype.sendRuneBoxGift=function(id){var bytes=this.getBytes(7);bytes.writeInt(id);this.sendToServer(bytes)};Rune.prototype.postRuneBoxGift=function(bytes){this.RuneRewards=bytes.readInt();this.runeCount=bytes.readInt();this.hope=bytes.readInt();var idx=0;for(var k in GlobalConfig.FuwenTreasureRewardConfig){var config=GlobalConfig.FuwenTreasureRewardConfig[k];this.boxs[idx]=this.RuneRewards>>config.id&1?Rune.ISNGET:this.runeCount>=config.needTime?Rune.CANGET:Rune.UNGET;idx++}Rune.ins().huntFreeTimes=bytes.readInt()};Rune.prototype.getIsGetBox=function(){for(var i=0;i<Rune.BoxSum;i++){switch(Rune.ins().boxs[i]){case Rune.UNGET:break;case Rune.CANGET:return true;case Rune.ISNGET:break}}return false};Rune.prototype.getIsGetTen=function(){var sum=this.getHuntItemNum();return sum>=10};Rune.prototype.sendRuneMerge=function(id){var bytes=this.getBytes(9);bytes.writeInt(id);this.sendToServer(bytes)};Rune.prototype.sendDelRune=function(roleId,posId){var bytes=this.getBytes(10);bytes.writeInt(roleId);bytes.writeInt(posId);this.sendToServer(bytes)};Rune.prototype.postDelRune=function(bytes){var item=RuneDataMgr.ins().getRune(bytes.readInt(),bytes.readInt());item.init()};Rune.prototype.isOpen=function(){var config=GlobalConfig.MergeTotal[4];if((config.openZs||0)<=UserZs.ins().lv&&(config.openLv||0)<=Actor.level){return true}return false};Rune.prototype.getRuneMergeEquipByLv=function(type){var arr=[];var configs=GlobalConfig.RuneComposeConfig;for(var it in configs){if(configs[it].mixId[1]==type)arr.push({type:MergeType.Rune,id:configs[it].id})}return arr};Rune.prototype.getRuneLevel=function(id){var lv=id%100||1;return lv};Rune.prototype.getRuneByLevel=function(id,lv){var runeid=Math.floor(id/100);runeid=runeid*100+lv;return runeid};Rune.prototype.runeIsSameKind=function(id1,id2){var res=false;return Math.floor(id1/100)==Math.floor(id2/100)};Rune.prototype.isRuneCanMergeByIDNew=function(id){var config=GlobalConfig.RuneComposeConfig[id];var mat=config.material;var mat1=mat[0];var mat2=mat[1];var res={type:Rune.CAN_MERGE,mat1:{id:mat1,roleid:0,posid:0},mat2:{id:mat2,roleid:0,posid:0},mat1_type:Rune.IN_BAG,mat2_type:Rune.IN_BAG};var mat1_lv=this.getRuneLevel(mat1);var mat2_lv=this.getRuneLevel(mat2);var num1=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,mat1);var num2=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,mat2);var num3=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.RuneOtherConfig.goldItemId);if(num3<config.count){res.type=Rune.CAN_NOT_MERGE;return res}if(num1>0&&num2>0){res.type=Rune.CAN_MERGE;res.mat1_type=Rune.IN_BAG;res.mat2_type=Rune.IN_BAG;return res}if(num1<=0){this.checkHighLevelRunes(res,mat1_lv,mat1,1)}if(res.type==Rune.CAN_NOT_MERGE){return res}if(num2<=0){this.checkHighLevelRunes(res,mat2_lv,mat2,2)}return res};Rune.prototype.checkHighLevelRunes=function(res,mat_lv,mat_id,index){if(index===void 0){index=1}var num1_1=0;for(var lv=mat_lv+1;lv<100;lv++){var rid=this.getRuneByLevel(mat_id,lv);var rid_count=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,rid);if(rid_count){num1_1=rid;break}}if(num1_1>0){res["mat"+index].id=num1_1;res["mat"+index+"_type"]=Rune.NEED_DECOM}else{var num1_2=0;var roleId=0;var posId=0;for(var roleid=0;roleid<SubRoles.ins().subRolesLen;roleid++){for(var pos=0;pos<RuneConfigMgr.ins().getOtherCfg().maxEquip;pos++){var rData=RuneDataMgr.ins().getRune(roleid,pos);if(rData&&rData.configID){var r=this.runeIsSameKind(rData.configID,mat_id);if(r){num1_2=rData.configID;roleId=roleid;posId=pos;break}}}}if(num1_2>0){res["mat"+index]={id:num1_2,roleid:roleId,posid:posId};res["mat"+index+"_type"]=Rune.NEED_DELETE}else{res.type=Rune.CAN_NOT_MERGE}}};Rune.prototype.isRuneCanMergeByType=function(type){var arr=[];var configs=GlobalConfig.RuneComposeConfig;for(var it in configs){var res=this.isRuneCanMergeByIDNew(configs[it].id);if(configs[it].mixId[1]==type&&res.type){return true}}return false};Rune.prototype.isRuneCanMerge=function(){var arr=[];var configs=GlobalConfig.RuneComposeConfig;for(var it in configs){var res=this.isRuneCanMergeByIDNew(configs[it].id);if(res.type){return true}}return false};Rune.prototype.getRuneMergeByID=function(id){var arr=[];var configs=GlobalConfig.RuneComposeConfig;for(var it in configs){var data=configs[it];for(var i in data.material){if(data.material[i]==id)return data}}return null};Rune.prototype.getIsMergeByID=function(id){var itemCfg1=GlobalConfig.ItemConfig[id];var tem=GlobalConfig.RuneComposeConfig;for(var it in tem){var itemCfg=GlobalConfig.ItemConfig[it];if(ItemConfig.getSubType(itemCfg1)==ItemConfig.getSubType(itemCfg)){return true}}return false};Rune.prototype.getMergeIndexByType=function(type,id){var configs=GlobalConfig.RuneComposeConfig;var index=0;for(var it in configs){if(configs[it].mixId[1]==type){if(id==configs[it].id)return index;index++}}return index};Rune.prototype.isEquipMerge=function(id,curRole,pos){var mId=this.isMergeId(id);var configs=GlobalConfig.RuneComposeConfig[mId];if(!configs)return false;var itemCfg=GlobalConfig.ItemConfig[id];var rdList=RuneDataMgr.ins().getRoleRune(curRole);if(!rdList)return false;var selectedRuneData=RuneDataMgr.ins().getRune(curRole,pos);var cfg;var len=rdList.length;for(var i=0;i<len;i++){var rd=rdList[i];cfg=RuneConfigMgr.ins().getBaseCfg(rd);if(cfg){var arr=this.getIsEquipMerge(configs.checkMaterial,mId);for(var j=0;j<arr.length;j++){var itemCfg1=GlobalConfig.ItemConfig[arr[j]];if(ItemConfig.getSubType(itemCfg1)==ItemConfig.getSubType(rd.itemConfig)){if(selectedRuneData){if(selectedRuneData.configID<=0){if(this.getIsMergeByID(id)||this.getRoleIsHasMerge(arr,curRole))return true}if(selectedRuneData.itemConfig){var b=this.getCurIsType(arr,ItemConfig.getSubType(selectedRuneData.itemConfig));if(b){if(this.getIsMergeByID(id)||this.getRoleIsHasMerge(arr,curRole))return true}}}}}}}return false};Rune.prototype.getRoleIsHasMerge=function(arr,curRole){var rdList=RuneDataMgr.ins().getRoleRune(curRole);if(!rdList)return false;var cfg;var len=rdList.length;for(var i=0;i<len;i++){var rd=rdList[i];cfg=RuneConfigMgr.ins().getBaseCfg(rd);if(cfg&&this.getIsMergeByID(cfg.id)){for(var j=0;j<arr.length;j++){var itemCfg1=GlobalConfig.ItemConfig[arr[j]];if(ItemConfig.getSubType(rd.itemConfig)==ItemConfig.getSubType(itemCfg1)){return true}}}}return false};Rune.prototype.getCurIsType=function(arr,type){var b=true;for(var j=0;j<arr.length;j++){var itemCfg1=GlobalConfig.ItemConfig[arr[j]];if(ItemConfig.getSubType(itemCfg1)==type){b=false;break}}return b};Rune.prototype.getIsEquipMerge=function(arr,id){var temArr=[];for(var i=0;i<arr.length;i++){temArr.push(arr[i])}temArr.push(id);return temArr};Rune.prototype.isMergeId=function(id){var myID=id;var itemCfg1=GlobalConfig.ItemConfig[id];var arr=GlobalConfig.RuneComposeConfig;for(var it in arr){var itemCfg=GlobalConfig.ItemConfig[it];if(ItemConfig.getSubType(itemCfg1)==ItemConfig.getSubType(itemCfg)){return parseInt(it)}for(var i in arr[it].material){var itemCfg2=GlobalConfig.ItemConfig[arr[it].material[i]];if(ItemConfig.getSubType(itemCfg1)==ItemConfig.getSubType(itemCfg2)){return parseInt(it)}}}return myID};Rune.prototype.isCanEquip=function(id,curRole,tiId,posIndex){var itemCfg=GlobalConfig.ItemConfig[id];var rdList=RuneDataMgr.ins().getRoleRune(curRole);if(!rdList)return true;var cfg;var len=rdList.length;for(var i=0;i<len;i++){var rd=rdList[i];cfg=RuneConfigMgr.ins().getBaseCfg(rd);if(cfg&&rd.itemConfig){var conf=GlobalConfig.RuneComposeConfig[cfg.id];if(!conf)continue;var arr=conf.checkMaterial;for(var j=0;j<arr.length;j++){var itemCfg1=GlobalConfig.ItemConfig[arr[j]];if(ItemConfig.getSubType(itemCfg1)==ItemConfig.getSubType(itemCfg)){if(tiId==0)return false;else{var itemCfg2=GlobalConfig.ItemConfig[tiId];if(ItemConfig.getSubType(itemCfg2)==ItemConfig.getSubType(itemCfg))return false}}}}}return true};Rune.prototype.getMergeRune=function(id,curRole,item){var mId=this.isMergeId(id);var itemCfg=GlobalConfig.ItemConfig[id];var configs=GlobalConfig.RuneComposeConfig[mId];var arr=[];if(!configs)return null;var rdList=RuneDataMgr.ins().getRoleRune(curRole);if(!rdList)return null;var cfg;var len=rdList.length;for(var i=0;i<len;i++){var rd=rdList[i];cfg=RuneConfigMgr.ins().getBaseCfg(rd);if(cfg){var arrTem=this.getIsEquipMerge(configs.checkMaterial,mId);for(var j=0;j<arrTem.length;j++){var itemCfg1=GlobalConfig.ItemConfig[arrTem[j]];if(ItemConfig.getSubType(itemCfg1)==ItemConfig.getSubType(rd.itemConfig)){if(item&&item.configID!=cfg.id&&this.getIsMergeByID(id)){arr=[i18n("Rune_0",GlobalConfig.ItemConfig[configs.id].name,GlobalConfig.ItemConfig[cfg.id].name),""+i];return arr}}}}}return null};Rune.prototype.canHuntFree=function(){var count=this.getHuntItemNum();var huntFreeTimes=this.huntFreeTimes;return count>0||huntFreeTimes>0};Rune.prototype.getHuntItemNum=function(){var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.FuwenTreasureConfig.huntItem);var count=item?item.count:0;return count};Rune.prototype.isRuneOpen=function(){var openlevel=GlobalConfig.FuwenTreasureConfig.openlevel;return Actor.level>=openlevel};Rune.prototype.showRedPoint=function(){return this.isRuneOpen()&&(this.canHuntFree()||this.getIsGetBox()||RuneRedPointMgr.ins().checkCanExchange())};Rune.UNGET=0;Rune.CANGET=1;Rune.ISNGET=2;Rune.BoxSum=5;Rune.CAN_NOT_MERGE=false;Rune.CAN_MERGE=true;Rune.IN_BAG=0;Rune.NEED_DECOM=1;Rune.NEED_DELETE=2;return Rune}(BaseSystem);__reflect(Rune.prototype,"Rune");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.rune=Rune.ins.bind(Rune)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var RunePanel=function(_super){__extends(RunePanel,_super);function RunePanel(){var _this=_super.call(this)||this;_this.runeList=null;_this.curRole=0;_this.selectedIndex=0;_this.upgradeDifference=0;_this.selectItem=null;_this.openNum=0;return _this}RunePanel.prototype.childrenCreated=function(){this.initRunes()};RunePanel.prototype.initRunes=function(){this.runeList=[];var len=10;var rd=null;for(var i=0;i<len;i++){rd=this["rune"+i];if(rd){this.runeList.push(rd)}}};RunePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var len=this.runeList.length;this.selectedIndex=isNaN(param[1])?this.selectedIndex:param[1];if(this.selectedIndex<0)this.selectedIndex=0;if(this.selectedIndex>=len)this.selectedIndex=len-1;this.addTouchEvent(this.replace,this.onTap);this.addTouchEvent(this.uplevel,this.onTap);this.addTouchEvent(this.runeBook,this.onTap);this.addTouchEvent(this.bookBtn,this.onTap);this.addTouchEvent(this.btn1,this.onTap);this.addTouchEvent(this.btn2,this.onTap);this.observe(Rune.ins().postInlayResult,this.onInlayResult);this.observe(Rune.ins().postUpgradeResult,this.onUpgradeResult);this.observe(UserZs.ins().postZsData,this.onLevelUp);this.observe(Actor.ins().postPowerChange,this.onLevelUp);this.observe(GameLogic.ins().postRuneShatter,this.onShatterChange);this.observe(UserBag.ins().postItemAdd,this.onItemChange);this.observe(UserBag.ins().postItemDel,this.onItemChange);this.observe(UserBag.ins().postItemChange,this.onItemChange);this.observe(Rune.ins().postDelRune,this.onLevelUp);this.updateRunes(true);var runeDisplay=null;for(var i=0;i<len;i++){runeDisplay=this.runeList[i];runeDisplay.init();if(runeDisplay&&runeDisplay.currentState==RuneDisplay.SKIN_STATE_UNLOCK){this.addTouchEvent(runeDisplay,this.onRuneTap);if(this["linebg"+i])this["linebg"+i].source="zwfwline2"}else{if(this["linebg"+i])this["linebg"+i].source="zwfwline1"}}this.updateRuneDetail();this.updateSelectedEffect();this.showRuneRedPoint();this.setNextOpenInfo()};RunePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.replace,this.onTap);this.removeTouchEvent(this.uplevel,this.onTap);this.removeTouchEvent(this.runeBook,this.onTap);this.removeTouchEvent(this.bookBtn,this.onTap);this.removeTouchEvent(this.btn1,this.onTap);this.removeTouchEvent(this.btn2,this.onTap);this.removeObserve();var runeDisplay=null;var len=this.runeList.length;for(var i=0;i<len;i++){runeDisplay=this.runeList[i];runeDisplay.close()}};RunePanel.prototype.setNextOpenInfo=function(){var rlpc=RuneConfigMgr.ins().getLockCfg(this.openNum);if(rlpc)this.levelsay.text=i18n("RunePanel_0",rlpc.lockLv);else this.levelsay.text=""};RunePanel.prototype.onLevelUp=function(){this.updateRunes();this.updateRuneDetail();this.showRuneRedPoint();this.showReplaceRedPoint()};RunePanel.prototype.onUpgradeResult=function(param){if(param[0]){UserTips.ins().showTips(i18n("RunePanel_1"));var roleIndex=param[1];this.curRole=roleIndex;this.updateRunes();this.updateRuneDetail();this.showRuneRedPoint();this.showReplaceRedPoint()}else{UserTips.ins().showTips(i18n("RunePanel_2"))}};RunePanel.prototype.onInlayResult=function(param){if(param[0]){UserTips.ins().showTips(i18n("RunePanel_3"));var roleIndex=param[1];var posIndex=param[2];var id=param[3];RuneDataMgr.ins().replaceRune(roleIndex,posIndex,id);this.curRole=roleIndex;this.updateRunes();this.updateRuneDetail();this.showRuneRedPoint();this.showReplaceRedPoint()}else{UserTips.ins().showTips(i18n("RunePanel_4"))}};RunePanel.prototype.onShatterChange=function(){this.updateRuneDetail();this.showRuneRedPoint()};RunePanel.prototype.onItemChange=function(){this.showRuneRedPoint();this.showReplaceRedPoint()};RunePanel.prototype.onTap=function(e){if(e&&e.currentTarget){switch(e.currentTarget){case this.replace:this.showReplaceWin();break;case this.uplevel:this.upgradeRune();break;case this.runeBook:ViewManager.ins().open(RuneAttrWin,this.curRole);break;case this.bookBtn:ViewManager.ins().open(RuneBookWin);break;case this.btn1:ViewManager.ins().open(TreasureHuntWin,1);break;case this.btn2:ViewManager.ins().open(FbWin,2);break}}};RunePanel.prototype.upgradeRune=function(){var rd=this.getRuneDisplay(this.selectedIndex);if(rd){switch(rd.currentState){case RuneDisplay.SKIN_STATE_LOCK:case RuneDisplay.SKIN_STATE_READY:UserTips.ins().showTips(i18n("RunePanel_5"));break;case RuneDisplay.SKIN_STATE_UNLOCK:var ic=this.getCurIC();if(ic){var next=GlobalConfig.ItemConfig[ic.id+1];if(!next){UserTips.ins().showTips(i18n("RunePanel_6"))}else{if(this.upgradeDifference<=0){Rune.ins().sendUpgrade(this.curRole,this.selectedIndex)}else{UserTips.ins().showTips(i18n("RunePanel_7"))}}}else{UserTips.ins().showTips(i18n("RunePanel_8"))}break}}};RunePanel.prototype.showReplaceWin=function(){var rd=this.getRuneDisplay(this.selectedIndex);if(rd){switch(rd.currentState){case RuneDisplay.SKIN_STATE_LOCK:case RuneDisplay.SKIN_STATE_READY:UserTips.ins().showTips(i18n("RunePanel_9"));break;case RuneDisplay.SKIN_STATE_UNLOCK:ViewManager.ins().open(RuneReplaceWin,this.selectedIndex,this.curRole,rd.data,this.runeTypeList);break}}};RunePanel.prototype.onRuneTap=function(e){if(e&&e.currentTarget){var rd=e.currentTarget;this.selectedIndex=rd.pos;this.updateRuneDetail();this.updateSelectedEffect();this.showReplaceRedPoint();if(rd.currentState==RuneDisplay.SKIN_STATE_UNLOCK){var runeData=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);if(runeData&&runeData.configID<=0){ViewManager.ins().open(RuneReplaceWin,this.selectedIndex,this.curRole,rd.data,this.runeTypeList)}}}};RunePanel.prototype.updateSelectedEffect=function(){if(this.runeList){for(var _i=0,_a=this.runeList;_i<_a.length;_i++){var v=_a[_i];if(v){v.showOrHideSelected(v.pos==this.selectedIndex)}}}};RunePanel.prototype.showLink=function(){this.linkGroup.visible=false;var rdList=RuneDataMgr.ins().getRoleRune(this.curRole);if(!rdList)return;var isShow=true;var cfg;var len=this.runeList.length;for(var i=0;i<len;i++){var rd=rdList[i];cfg=RuneConfigMgr.ins().getBaseCfg(rd);if(cfg){isShow=false;break}}this.linkGroup.visible=isShow};RunePanel.prototype.updateRunes=function(init){var rdList=RuneDataMgr.ins().getRoleRune(this.curRole);if(!rdList)return;this.openNum=0;this.runeTypeList=[];var lockNum=0;var rd=null;var cfg=null;var rDisplay=null;var len=this.runeList.length;var attrPoint=0;this.runeBook.visible=false;for(var i=0;i<len;i++){rd=rdList[i];cfg=RuneConfigMgr.ins().getBaseCfg(rd);if(cfg)attrPoint+=UserBag.getAttrPower(cfg.attr)+(cfg.power||0);rDisplay=this.runeList[i];if(rd.configID&&rd.itemConfig){this.runeTypeList.push(ItemConfig.getSubType(rd.itemConfig))}if(rDisplay){rDisplay.setPos(i);if(rd&&rd.itemConfig&&rd.itemConfig.id>0){rDisplay.setData(rd)}else{rDisplay.cleanData()}if(rDisplay.currentState==RuneDisplay.SKIN_STATE_UNLOCK)this.openNum+=1;if(rDisplay.currentState==RuneDisplay.SKIN_STATE_LOCK){lockNum+=1;if(lockNum==1)rDisplay.setLockTF(true);else rDisplay.setLockTF(false)}else{rDisplay.setLockTF(false)}}}this.powerPanel.setPower(attrPoint);if(init)this.setSelectedIndexRule(this.curRole);this.showLink()};RunePanel.prototype.updateRuneDetail=function(){var rd=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);this.selectItem=rd;if(rd&&rd.configID>0){this.rune10.showName(false);this.rune10.setData(rd);var itemCfg=GlobalConfig.ItemConfig[rd.itemConfig.id];var nameCfg=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(itemCfg)];this.nuneName.textFlow=TextFlowMaker.generateTextFlow(i18n("RunePanel_11",ItemConfig.getQualityColor(itemCfg),nameCfg.runeName,itemCfg.id%100));this.nuneName.strokeColor=ItemConfig.getQualityStrokeColor(itemCfg);var rbc=RuneConfigMgr.ins().getBaseCfg(rd);var ic=this.getCurIC();if(!ic||!rbc)return;this.up.visible=true;this.showReplaceRedPoint();var nextRBC=null;nextRBC=RuneConfigMgr.ins().getBaseCfg(rd,true);if(nextRBC){this.attrDesc.text=RuneConfigMgr.ins().getcfgAttrDesc(nextRBC);this.setCost(rbc);this.costImg.visible=true;this.cost.x=328;this.arrow.visible=true}else{this.attrDesc.text="";this.costImg.visible=false;this.arrow.visible=false;this.cost.textFlow=TextFlowMaker.generateTextFlow(i18n("RunePanel_10"));this.cost.x=310}this.addAttr.text=RuneConfigMgr.ins().getcfgAttrDesc(rbc)}else{this.up.visible=false}};RunePanel.prototype.setCost=function(cfg){if(!cfg)return;var needNum=cfg.expend;var curNum=Actor.runeShatter;this.upgradeDifference=needNum-curNum;if(this.upgradeDifference<0)this.upgradeDifference=0;var colorStr="";if(curNum>=needNum)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;this.cost.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+curNum+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+needNum+"</font> ")};RunePanel.prototype.getRuneDisplay=function(pos){if(this.runeList){return this.runeList[pos]}return null};RunePanel.prototype.getCurIC=function(){var rd=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);if(rd&&rd.configID>0){var itemCfg=GlobalConfig.ItemConfig[rd.configID];if(!this.assert(itemCfg,"ItemConfig("+rd.configID+")")){return itemCfg}}return null};RunePanel.prototype.showRuneRedPoint=function(){var isShow=false;var rd=null;for(var _i=0,_a=this.runeList;_i<_a.length;_i++){var v=_a[_i];if(v){isShow=RuneRedPointMgr.ins().checkSingleInlay(this.curRole,v.pos);if(!isShow){rd=v.data;if(rd&&rd instanceof ItemData&&rd.configID>0){isShow=RuneRedPointMgr.ins().checkSingleUpgrade(rd);if(!isShow)isShow=RuneRedPointMgr.ins().checkSingleReplace(this.curRole,rd)}}v.redPoint.visible=isShow}}};RunePanel.prototype.showReplaceRedPoint=function(){var rd=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);if(rd&&rd.configID>0){this.redPointReplace.visible=RuneRedPointMgr.ins().checkSingleReplace(this.curRole,rd);if(this.upRed){this.upRed.visible=RuneRedPointMgr.ins().checkSingleUpgrade(rd)}}else{this.redPointReplace.visible=false;if(this.upRed){this.upRed.visible=false}}};RunePanel.prototype.setSelectedIndexRule=function(roleId){var minItem=RuneDataMgr.ins().getMinRune(roleId,true);if(!minItem)return;for(var i=0;i<this.runeList.length;i++){if(this.runeList[i].getItemConfig()&&this.runeList[i].getItemConfig().id==minItem.configID){this.selectedIndex=this.runeList[i].pos;break}}};RunePanel.prototype.assert=function(value,msg){return Assert(value,"["+egret.getQualifiedClassName(RunePanel)+"] "+msg+"is null!")};return RunePanel}(BaseView);__reflect(RunePanel.prototype,"RunePanel");var RuneWin=function(_super){__extends(RuneWin,_super);function RuneWin(){var _this=_super.call(this)||this;_this.skinName="RuneSkin";_this.isTopLevel=true;return _this}RuneWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var selectedIndex=param?param[0]?param[0]:0:0;var viewIndex=param?param[1]?param[1]:0:0;this.roleSelect.setCurRole(selectedIndex);this.switchTab(viewIndex);this.addChangeEvent(this.roleSelect,this.onChange);this.addChangeEvent(this.tab,this.onTabTouch);this.addTouchEndEvent(this.closeBtn,this.onClick);this.observe(GameLogic.ins().postRuneExchange,this.refushRedPoint);this.observe(GameLogic.ins().postRuneShatter,this.refushRedPoint);this.observe(UserBag.ins().postHuntStore,this.refushRedPoint);this.observe(Rune.ins().postInlayResult,this.refushRedPoint);this.observe(Rune.ins().postUpgradeResult,this.refushRedPoint);this.observe(Actor.ins().postPowerChange,this.refreshPower);this.setRoleId(this.roleSelect.getCurRole());this.refushRedPoint()};RuneWin.prototype.onClick=function(e){ViewManager.ins().close(this)};RuneWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();if(ViewManager.ins().isShow(RuneBookWin))ViewManager.ins().close(RuneBookWin);this.runePanel.close();this.decomPanel.close();this.removeTouchEvent(this.closeBtn,this.onClick)};RuneWin.prototype.onChange=function(e){this.setRoleId(this.roleSelect.getCurRole());this.refushRedPoint()};RuneWin.prototype.refreshPower=function(){this.roleSelect.refreshPower(this.roleSelect._curRole)};RuneWin.prototype.switchTab=function(index){this.viewStack.selectedIndex=index;this.setOpenIndex(this.viewStack.selectedIndex)};RuneWin.prototype.onTabTouch=function(e){this.setOpenIndex(this.tab.selectedIndex)};RuneWin.prototype.setRoleId=function(roleId){this.runePanel.curRole=this.decomPanel.curRole=roleId;this.setOpenIndex(this.viewStack.selectedIndex)};RuneWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case 0:this.runePanel.open();break;case 1:this.decomPanel.open();break;case 2:break}};RuneWin.prototype.refushRedPoint=function(){this.redPoint1.visible=RuneRedPointMgr.ins().checkAllSituation(false);this.redPoint2.visible=RuneRedPointMgr.ins().checkCanDecomposeNum()?true:false;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var flag=RuneRedPointMgr.ins().checkRoleAllSituation(i);this.roleSelect.showRedPoint(i,flag)}};RuneWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var level=GlobalConfig.RuneOtherConfig.zsLevel;if(Actor.level<level){UserTips.ins().showTips(i18n("RuneWin_0",level));return false}return true};return RuneWin}(BaseEuiView);__reflect(RuneWin.prototype,"RuneWin");ViewManager.ins().reg(RuneWin,LayerManager.UI_Main);var RuneConfigMgr=function(_super){__extends(RuneConfigMgr,_super);function RuneConfigMgr(){var _this=_super.call(this)||this;_this.exchangeList=[];return _this}RuneConfigMgr.ins=function(){return _super.ins.call(this)};RuneConfigMgr.prototype.getBaseCfg=function(item,next){if(next===void 0){next=false}var runeBaseConfigs=GlobalConfig.RuneBaseConfig;if(Assert(runeBaseConfigs,"RuneBaseConfigs is null"))return null;var id=next?item.configID+1:item.configID;return runeBaseConfigs[id]};RuneConfigMgr.prototype.getBaseCfgByItemConfig=function(item){var runeBaseConfigs=GlobalConfig.RuneBaseConfig;if(Assert(runeBaseConfigs,"RuneBaseConfigs is null"))return null;return runeBaseConfigs[item.id]};RuneConfigMgr.prototype.getConverCfgByItemConfig=function(item){var runeConverConfigs=GlobalConfig.RuneConverConfig;if(Assert(runeConverConfigs,"RuneConverConfigs is null"))return null;return runeConverConfigs[item.configID]};RuneConfigMgr.prototype.getLockCfg=function(pos){var runeLockPosConfigs=GlobalConfig.RuneLockPosConfig;if(Assert(runeLockPosConfigs,"RuneLockPosConfigs is null"))return null;return runeLockPosConfigs[pos]};RuneConfigMgr.prototype.getNameCfg=function(type){var runeNameConfigs=GlobalConfig.RuneNameConfig;if(Assert(runeNameConfigs,"RuneNameConfigs is null"))return null;return runeNameConfigs[type]};RuneConfigMgr.prototype.getOtherCfg=function(){var runeOtherConfig=GlobalConfig.RuneOtherConfig;if(Assert(runeOtherConfig,"RuneOtherConfig is null"))return null;return runeOtherConfig};RuneConfigMgr.prototype.getcfgAttrData=function(cfg,isName){if(isName===void 0){isName=true}if(!cfg)return"";var str="";str+=this.getAttrNamesByList(cfg.attr,0,isName);str+=this.getAttrNamesByList(cfg.equipAttr,1,isName);str+=this.getAttrNamesByList(cfg.exAttr,2,isName);str+=this.getAttrNamesByList(cfg.specialAttr,3,isName);return str};RuneConfigMgr.prototype.getAttrNamesByList=function(attr,type,isName){var str="";if(!attr||attr.length<=0)return"";switch(type){case 0:for(var index in attr){if(attr[index]){if(isName){str+=AttributeData.getAttrStrByType(attr[index].type)+"\n"}else{var type_4=attr[index].type;if(type_4==7||type_4==8||type_4==11||type_4==12||type_4==13||type_4==14||type_4==17||type_4==23||type_4==24){var v=attr[index].value/100;str+="+"+v+"%\n"}else{str+="+"+attr[index].value+"\n"}}}}break;case 1:for(var index in attr){if(attr[index]){if(isName)str+=AttributeData.getEEquipAttrStrByType(attr[index].type)+"\n";else str+="+"+attr[index].value+"%\n"}}break;case 2:for(var index in attr){if(attr[index]){if(isName)str+=AttributeData.getExtAttrStrByType(attr[index].type)+"\n";else str+="+"+attr[index].value+"\n"}}break;case 3:for(var index in attr){if(attr[index]){if(isName)str+=(attr[index].type==1?"金币":"经验")+"\n";else str+="+"+attr[index].value+"%\n"}}break}return str};RuneConfigMgr.prototype.getcfgAttrDesc=function(cfg,specialType){if(specialType===void 0){specialType=false}if(!cfg)return"";var str="";str+=this.getAttrDescByList(cfg.attr,0,specialType);str+=this.getAttrDescByList(cfg.equipAttr,1,specialType);str+=this.getAttrDescByList(cfg.exAttr,2,specialType);str+=this.getAttrDescByList(cfg.specialAttr,3,specialType);if(str.lastIndexOf("\n")==str.length-1){str=str.substring(0,str.length-1)}return str};RuneConfigMgr.prototype.getAttrDescByList=function(attr,type,specialType){if(specialType===void 0){specialType=false}var str="";if(!attr||attr.length<=0)return"";switch(type){case 0:for(var index in attr){if(attr[index]){if(specialType){if(attr[index].type==5){}else if(attr[index].type==6){str+=i18n("RuneConfigMgr_1",attr[index].value)}else{var type_5=attr[index].type;if(type_5==7||type_5==8||type_5==11||type_5==12||type_5==13||type_5==14||type_5==17||type_5==23||type_5==24){str+=""+AttributeData.getAttrStrByType(attr[index].type);var v=attr[index].value/100;str+="+"+v+"%\n"}else{str+=AttributeData.getAttrNameByAttrbute(attr[index],true," + ")+"\n"}}}else{var type_6=attr[index].type;if(type_6==7||type_6==8||type_6==11||type_6==12||type_6==13||type_6==14||type_6==17||type_6==23||type_6==24){str+=""+AttributeData.getAttrStrByType(attr[index].type);var v=attr[index].value/100;str+="+"+v+"%\n"}else{str+=AttributeData.getAttrNameByAttrbute(attr[index],true," + ")+"\n"}}}}break;case 1:for(var index in attr){if(attr[index]){str+=AttributeData.getEEquipAttrStrByType(attr[index].type)+"  +"+attr[index].value+"%\n"}}break;case 2:for(var index in attr){if(attr[index]){str+=AttributeData.getExAttrNameByAttrbute(attr[index],true," + ")+"\n"}}break;case 3:for(var index in attr){if(attr[index]){str+=(attr[index].type==1?"金币":"经验")+"  +"+attr[index].value+"%\n"}}break}return str};RuneConfigMgr.prototype.getAttrByList=function(attr,type,specialType){if(specialType===void 0){specialType=false}var str="";if(!attr||attr.length<=0)return"";switch(type){case 0:for(var index in attr){if(attr[index]){str+=AttributeData.getAttrNameByAttrbute(attr[index],true,"：",false,16298305)+"\n"}}break;case 1:for(var index in attr){if(attr[index]){str+=AttributeData.getEEquipAttrStrByType(attr[index].type)+"：|C:"+16298305+"&T:"+attr[index].value+"%\n"}}break;case 2:for(var index in attr){if(attr[index]){str+=AttributeData.getExAttrNameByAttrbute(attr[index],true,"：",16298305)+"\n"}}break;case 3:for(var index in attr){if(attr[index]){str+=(attr[index].type==1?"金币":"经验")+"：|C:"+16298305+"&T:"+attr[index].value+"%\n"}}break}return str};RuneConfigMgr.prototype.getExchangeDataList=function(){if(this.exchangeList.length>0)return this.exchangeList;var cfg=GlobalConfig.RuneConverConfig;for(var key in cfg){this.exchangeList.push(cfg[key])}this.exchangeList.sort(this.sortExchange);return this.exchangeList};RuneConfigMgr.prototype.sortExchange=function(a,b){if(a.checkpoint<b.checkpoint){return-1}else if(a.checkpoint>b.checkpoint){return 1}return a.id-b.id};return RuneConfigMgr}(BaseClass);__reflect(RuneConfigMgr.prototype,"RuneConfigMgr");var RuneDataMgr=function(_super){__extends(RuneDataMgr,_super);function RuneDataMgr(){var _this=_super.call(this)||this;_this.posIsWear=null;return _this}RuneDataMgr.ins=function(){return _super.ins.call(this)};RuneDataMgr.prototype.getRoleRune=function(roleIndex){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);if(role){return role.runeDatas}return null};RuneDataMgr.prototype.getRune=function(roleIndex,pos){var runeDatas=this.getRoleRune(roleIndex);if(!runeDatas)return null;return runeDatas[pos]};RuneDataMgr.prototype.replaceRune=function(roleIndex,pos,id){var rdList=this.getRoleRune(roleIndex);if(rdList&&pos>=0){rdList[pos].configID=id}};RuneDataMgr.prototype.getMinRune=function(roleIndex,canUp){if(canUp===void 0){canUp=false}var runeDatas=this.getRoleRune(roleIndex);if(!runeDatas)return null;var exitDatas=[];for(var i=0;i<runeDatas.length;i++){if(runeDatas[i].itemConfig){exitDatas.push(runeDatas[i])}}exitDatas.sort(function(a,b){if(a.itemConfig.id%100<b.itemConfig.id%100)return-1;if(a.itemConfig.id%100>b.itemConfig.id%100)return 1;var quality1=ItemConfig.getQuality(a.itemConfig);var quality2=ItemConfig.getQuality(b.itemConfig);if(quality1>quality2)return-1;if(quality1<quality2)return 1;return 0});if(canUp){for(var _i=0,exitDatas_1=exitDatas;_i<exitDatas_1.length;_i++){var itemDt=exitDatas_1[_i];if(RuneRedPointMgr.ins().checkSingleUpgrade(itemDt))return itemDt}}return exitDatas[0]};return RuneDataMgr}(BaseClass);__reflect(RuneDataMgr.prototype,"RuneDataMgr");var RuneDecomposeItemData=function(){function RuneDecomposeItemData(){this.itemData=null;this.isSelected=false}return RuneDecomposeItemData}();__reflect(RuneDecomposeItemData.prototype,"RuneDecomposeItemData");var RuneRedPointMgr=function(_super){__extends(RuneRedPointMgr,_super);function RuneRedPointMgr(){return _super.call(this)||this}RuneRedPointMgr.ins=function(){return _super.ins.call(this)};RuneRedPointMgr.prototype.checkSingleUpgrade=function(item){if(!this.checkOpen())return false;var ic=item.itemConfig;if(this.assert(ic,"ItemConfig("+item.configID+")"))return false;var next=RuneConfigMgr.ins().getBaseCfg(item,true);if(!next)return false;var rbc=RuneConfigMgr.ins().getBaseCfg(item);if(this.assert(rbc,"RuneBaseConfig"))return false;var curNum=Actor.runeShatter;return curNum>=rbc.expend};RuneRedPointMgr.prototype.checkRoleUpgrade=function(roleID){if(!this.checkOpen())return false;var rdList=RuneDataMgr.ins().getRoleRune(roleID);if(rdList){for(var _i=0,rdList_1=rdList;_i<rdList_1.length;_i++){var v=rdList_1[_i];if(v&&v.itemConfig&&v.itemConfig.id>0&&this.checkSingleUpgrade(v)){return true}}}return false};RuneRedPointMgr.prototype.checkAllUpgrade=function(){if(!this.checkOpen())return false;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(this.checkRoleUpgrade(i)){return true}}return false};RuneRedPointMgr.prototype.checkSingleReplace=function(roleID,item){return false};RuneRedPointMgr.prototype.checkRoleReplace=function(roleID){if(!this.checkOpen())return false;var rdList=RuneDataMgr.ins().getRoleRune(roleID);if(rdList){for(var _i=0,rdList_2=rdList;_i<rdList_2.length;_i++){var v=rdList_2[_i];if(v&&v.itemConfig&&v.itemConfig.id>0&&this.checkSingleReplace(roleID,v)){return true}}}return false};RuneRedPointMgr.prototype.checkAllReplace=function(){if(!this.checkOpen())return false;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(this.checkRoleReplace(i)){return true}}return false};RuneRedPointMgr.prototype.checkSingleInlay=function(roleID,pos){if(!this.checkOpen())return false;var rplc=RuneConfigMgr.ins().getLockCfg(pos);if(this.assert(rplc,"RuneLockPosConfig("+pos+")"))return false;var lockLv=rplc.lockLv;var level=SkyLevelModel.ins().cruLevel;if(level>lockLv){var rd=RuneDataMgr.ins().getRune(roleID,pos);if(rd&&rd.configID<=0){var itemDatas=UserBag.ins().getBagGoodsBySort(1);var runeType=0;var rdList=RuneDataMgr.ins().getRoleRune(roleID);var canInlay=true;for(var _i=0,itemDatas_1=itemDatas;_i<itemDatas_1.length;_i++){var v=itemDatas_1[_i];if(v){runeType=ItemConfig.getSubType(v.itemConfig);if(runeType>0&&rdList){canInlay=true;if(canInlay){for(var _a=0,rdList_3=rdList;_a<rdList_3.length;_a++){var rdv=rdList_3[_a];if(rdv&&rdv.itemConfig&&rdv.itemConfig.id>0){if(runeType==ItemConfig.getSubType(rdv.itemConfig)){canInlay=false;break}}}}if(canInlay){return true}}}}}}return false};RuneRedPointMgr.prototype.checkRoleInlay=function(roleID){if(!this.checkOpen())return false;for(var i=0;i<RuneConfigMgr.ins().getOtherCfg().maxEquip;i++){if(this.checkSingleInlay(roleID,i)){return true}}return false};RuneRedPointMgr.prototype.checkAllInlay=function(){if(!this.checkOpen())return false;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(this.checkRoleInlay(i)){return true}}return false};RuneRedPointMgr.prototype.checkRoleAllSituation=function(roleID){if(!this.checkOpen())return false;var canShow=this.checkRoleInlay(roleID);if(!canShow)canShow=this.checkRoleUpgrade(roleID);if(!canShow)canShow=this.checkRoleReplace(roleID);return canShow};RuneRedPointMgr.prototype.checkAllSituation=function(exchange){if(exchange===void 0){exchange=true}if(!this.checkOpen())return false;var canShow=this.checkAllInlay();if(!canShow)canShow=this.checkAllUpgrade();if(!canShow)canShow=this.checkAllReplace();if(exchange)if(!canShow)canShow=this.checkCanExchange();return canShow};RuneRedPointMgr.prototype.checkCanExchange=function(){var data=RuneConfigMgr.ins().getExchangeDataList();for(var i=0;i<data.length;i++){var cfg=data[i];if(Actor.runeExchange>=cfg.conversion)return true}return false};RuneRedPointMgr.prototype.checkCanDecomposeNum=function(){var count=0;var list=UserBag.ins().getBagGoodsByType(6);if(list&&list.length>0){for(var _i=0,list_16=list;_i<list_16.length;_i++){var v=list_16[_i];count+=v.count||0}}return count};RuneRedPointMgr.prototype.checkOpen=function(){return Actor.level>=RuneConfigMgr.ins().getOtherCfg().zsLevel};RuneRedPointMgr.prototype.assert=function(value,msg){return Assert(value,"["+egret.getQualifiedClassName(RuneRedPointMgr)+"] "+msg+"is null")};return RuneRedPointMgr}(BaseClass);__reflect(RuneRedPointMgr.prototype,"RuneRedPointMgr");var RuneAttrWin=function(_super){__extends(RuneAttrWin,_super);function RuneAttrWin(){var _this=_super.call(this)||this;_this._lastX=0;_this.proShowList=null;_this.curRole=0;_this.skinName="RuneAttrsSkin";return _this}RuneAttrWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};RuneAttrWin.prototype.setAttrList=function(){this.proShowList=[];var role=SubRoles.ins().getSubRoleByIndex(this.curRole);var runeList=role.runeDatas;var runeBaseConfig=GlobalConfig.RuneBaseConfig;if(!Assert(runeBaseConfig,"RuneAttrTypeConfig is null")){for(var k in runeList){var item=runeList[k];if(item.configID){var cfg=runeBaseConfig[item.configID];if(!Assert(cfg,"cfg is null   id == "+item.configID))this.setProShowList(cfg)}}}};RuneAttrWin.prototype.setProShowList=function(cfg){this.checkIsRepeat(cfg.attr,0);this.checkIsRepeat(cfg.equipAttr,1);this.checkIsRepeat(cfg.exAttr,2);this.checkIsRepeat(cfg.specialAttr,3)};RuneAttrWin.prototype.checkIsRepeat=function(addList,index){if(!this.proShowList[index]){this.proShowList[index]=[]}var list=this.proShowList[index];if(!addList){return}var flag=false;var additem;for(var i in addList){additem=addList[i];flag=false;for(var k in list){if(list[k].type==additem.type){list[k].value=list[k].value+additem.value;flag=true}}if(!flag){list.push(additem)}}};RuneAttrWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curRole=isNaN(param[0])?0:param[0];this.addTouchEvent(this.leftBtn,this.onTap);this.addTouchEvent(this.rightBtn,this.onTap);this.addTouchEvent(this.closeBtn,this.onClose);this.addTouchEndEvent(this.bg,this.onMove);this.addTouchEndEvent(this,this.otherClose);this.setAttrList();this.setAttrs();this.setBtns()};RuneAttrWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}MessageCenter.ins().removeAll(this)};RuneAttrWin.prototype.onClose=function(e){ViewManager.ins().close(this)};RuneAttrWin.prototype.otherClose=function(e){if(e.target==this.bg||e.target instanceof eui.Button)return;ViewManager.ins().close(this)};RuneAttrWin.prototype.onTap=function(e){if(e&&e.currentTarget){switch(e.currentTarget){case this.leftBtn:this.curRole--;this.setAttrList();this.setAttrs();this.setBtns();break;case this.rightBtn:this.curRole++;this.setAttrList();this.setAttrs();this.setBtns();break}}};RuneAttrWin.prototype.onMove=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=e.localX;break;case egret.TouchEvent.TOUCH_END:if(this._lastX>e.localX){if(this.curRole<3){this.curRole++;this.setAttrList();this.setAttrs();this.setBtns()}}else if(this._lastX<e.localX){if(this.curRole>0){this.curRole--;this.setAttrList();this.setAttrs();this.setBtns()}}break}};RuneAttrWin.prototype.setAttrs=function(){var role=SubRoles.ins().getSubRoleByIndex(this.curRole);if(role){this.job.source="op_"+role.job;var str="";for(var j=this.imgGroup.numChildren-1;j>=0;j--){var item=this.imgGroup.getChildAt(j);DisplayUtils.removeFromParent(item);item=null}var count=0;for(var i=0;i<this.proShowList.length;i++){var list=this.proShowList[i];str+=RuneConfigMgr.ins().getAttrByList(list,i);for(var k in list){var img=new eui.Image;img.source="tongyongdian";img.y=28*count+2;this.imgGroup.addChild(img);count++}}if(str.length<=0){str=i18n("RuneAttrWin_0")}this.attr.textFlow=TextFlowMaker.generateTextFlow(str);this.mainGroup.height=this.attr.height+190}};RuneAttrWin.prototype.setBtns=function(){var len=SubRoles.ins().subRolesLen;if(len==1){this.leftBtn.visible=false;this.rightBtn.visible=false}else if(len>1){if(this.curRole==0){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.curRole==1){this.leftBtn.visible=true;this.rightBtn.visible=len>=3}else if(this.curRole==2){this.leftBtn.visible=true;this.rightBtn.visible=false}}};return RuneAttrWin}(BaseEuiView);__reflect(RuneAttrWin.prototype,"RuneAttrWin");ViewManager.ins().reg(RuneAttrWin,LayerManager.UI_Popup);var RuneBookItemRenderer=function(_super){__extends(RuneBookItemRenderer,_super);function RuneBookItemRenderer(){var _this=_super.call(this)||this;_this.keys=["red","orange","purple","green","white"];_this.skinName="RuneOverViewItem";return _this}RuneBookItemRenderer.prototype.dataChanged=function(){var data=this.data;if(data.title){this.currentState="title";this.lbName.text=data.title}else{var rbc=data.data;if(rbc){if(rbc.checkpoint==0){this.currentState="rune"}else{this.currentState="nune_lock";var config=GlobalConfig.FbChallengeConfig[rbc.checkpoint];this.lbName.text=i18n("RuneBookItemRenderer_0",UserFb.ins().getFbChName(config.group))}var maxId=rbc.id;var _loop_27=function(i){var id=maxId-100*i;var icon=this_21[this_21.keys[i]];var ItemConfig_1=GlobalConfig.ItemConfig[id];var Func=function(){if(data&&data.data)ViewManager.ins().open(RuneBookItemTipsWin,data.data,ItemConfig_1)};this_21.reMoveListener(icon,Func);icon.setDataByItemConfig(ItemConfig_1);this_21.setListenOnClick(icon,Func)};var this_21=this;for(var i=0;i<this.keys.length;i++){_loop_27(i)}}}};RuneBookItemRenderer.prototype.reMoveListener=function(icon,func){icon.removeEventListener(egret.TouchEvent.TOUCH_END,func,icon)};RuneBookItemRenderer.prototype.setListenOnClick=function(icon,func){icon.addEventListener(egret.TouchEvent.TOUCH_END,func,icon)};return RuneBookItemRenderer}(BaseItemRender);__reflect(RuneBookItemRenderer.prototype,"RuneBookItemRenderer");var RuneBookItemData=function(){function RuneBookItemData(data,title){this.data=data;this.title=title;if(this.data){this._itemConfig=GlobalConfig.ItemConfig[this.data.id]}}RuneBookItemData.prototype.getItemConfig=function(){return this._itemConfig};return RuneBookItemData}();__reflect(RuneBookItemData.prototype,"RuneBookItemData");var RuneBookItemTipsWin=function(_super){__extends(RuneBookItemTipsWin,_super);function RuneBookItemTipsWin(){var _this=_super.call(this)||this;_this.QUALITY_LABEL_LIST=[i18n("RuneBookItemTipsWin_0"),i18n("RuneBookItemTipsWin_1"),i18n("RuneBookItemTipsWin_2"),i18n("RuneBookItemTipsWin_3"),i18n("RuneBookItemTipsWin_4"),i18n("RuneBookItemTipsWin_5")];_this.SPECIAL_LABEL_LIST=[i18n("RuneBookItemTipsWin_6"),i18n("RuneBookItemTipsWin_7")];_this.skinName="RuneGainTipsSkin";_this.isTopLevel=true;return _this}RuneBookItemTipsWin.prototype.initUI=function(){this.gainList.itemRendererSkinName="RuneGainTipsItemSkin";this.gainList.itemRenderer=GainGoodsNoSkinItem;_super.prototype.initUI.call(this)};RuneBookItemTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.setData(param[0],param[1])};RuneBookItemTipsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.resetView()};RuneBookItemTipsWin.prototype.otherClose=function(e){ViewManager.ins().close(RuneBookItemTipsWin)};RuneBookItemTipsWin.prototype.onTouchList=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2]);ViewManager.ins().close(RuneBookItemTipsWin)}};RuneBookItemTipsWin.prototype.setData=function(item,itemCfg){if(itemCfg){this.nameLabel.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+ItemConfig.getQualityColor(itemCfg)+"'>"+itemCfg.name+(itemCfg.level||1)+"级"+"</font>");this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(itemCfg);this.itemIcon.setData(itemCfg);var runeCfg=GlobalConfig.RuneBaseConfig[itemCfg.id];this.attrName.text=RuneConfigMgr.ins().getcfgAttrData(runeCfg);this.attrValue.text=RuneConfigMgr.ins().getcfgAttrData(runeCfg,false);if(item.checkpoint==0){this.attrDes.text=i18n("RuneBookItemTipsWin_8")}else{this.attrDes.text=i18n("RuneBookItemTipsWin_9",UserFb.ins().getFbChName(Math.round(item.checkpoint/10)))}var gainConfig=GlobalConfig.GainItemConfig[itemCfg.id];var listHeight=0;if(gainConfig){this.gainList.dataProvider=new eui.ArrayCollection(gainConfig.gainWay);listHeight=gainConfig.gainWay.length*60}else{this.gainList.dataProvider=new eui.ArrayCollection([])}}else{this.resetView()}};RuneBookItemTipsWin.prototype.resetView=function(){this.nameLabel.text="";this.itemIcon.setData(null)};return RuneBookItemTipsWin}(BaseEuiView);__reflect(RuneBookItemTipsWin.prototype,"RuneBookItemTipsWin");ViewManager.ins().reg(RuneBookItemTipsWin,LayerManager.UI_Popup);var RuneBookWin=function(_super){__extends(RuneBookWin,_super);function RuneBookWin(){var _this=_super.call(this)||this;_this.dataCollection=null;_this.skinName="RuneOverViewSkin";_this.isTopLevel=true;return _this}RuneBookWin.prototype.initUI=function(){this.nuneList.itemRenderer=RuneBookItemRenderer;_super.prototype.initUI.call(this)};RuneBookWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.showList()};RuneBookWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.cleanList();this.nuneList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this)};RuneBookWin.prototype.onTap=function(e){if(e&&e.currentTarget){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(RuneBookWin);break}}};RuneBookWin.prototype.onListTap=function(e){var rbc=e.item;if(rbc&&rbc.data){var target=e.item;var depth=6;while(depth>0&&target){if(target.getItemConfig){var itemConfig=target.getItemConfig();ViewManager.ins().open(RuneBookItemTipsWin,rbc.data,itemConfig);break}target=target.parent;depth-=1}}};RuneBookWin.prototype.showList=function(){if(!this.dataCollection){var arr=[];arr.push(new RuneBookItemData(null,i18n("RuneBookWin_0")));var data=RuneConfigMgr.ins().getExchangeDataList();for(var i in data){arr.push(new RuneBookItemData(data[i]))}this.dataCollection=new eui.ArrayCollection(arr)}this.nuneList.dataProvider=this.dataCollection};RuneBookWin.prototype.cleanList=function(){if(this.dataCollection){this.dataCollection=null}this.nuneList.dataProvider=null};return RuneBookWin}(BaseEuiView);__reflect(RuneBookWin.prototype,"RuneBookWin");ViewManager.ins().reg(RuneBookWin,LayerManager.UI_Main);var RuneDecomposeItemRenderer=function(_super){__extends(RuneDecomposeItemRenderer,_super);function RuneDecomposeItemRenderer(){var _this=_super.call(this)||this;_this.skinName="RuneSeletctItemSkin";_this.mc=new MovieClip;_this.mc.x=56;_this.mc.y=64;_this.mc.scaleX=1.5;_this.mc.scaleY=1.5;_this.addChild(_this.mc);return _this}RuneDecomposeItemRenderer.prototype.dataChanged=function(){this.cb.touchChildren=false;this.cb.touchEnabled=false;var rdid=this.data;var itemData=rdid.itemData;if(itemData&&itemData instanceof ItemData){var rbc=RuneConfigMgr.ins().getBaseCfg(itemData);if(rbc){this.itemIcon.setData(itemData);this.power.text=RuneConfigMgr.ins().getcfgAttrDesc(rbc,true)}else{this.resetView()}}else{this.resetView()}this.cb.selected=rdid.isSelected};RuneDecomposeItemRenderer.prototype.resetView=function(){this.itemIcon.setData(null);this.power.text=""};RuneDecomposeItemRenderer.prototype.playEffect=function(){if(!this.cb.selected)return;this.mc.playFile(RES_DIR_EFF+"litboom",1)};return RuneDecomposeItemRenderer}(eui.ItemRenderer);__reflect(RuneDecomposeItemRenderer.prototype,"RuneDecomposeItemRenderer");var RuneDecomposePanel=function(_super){__extends(RuneDecomposePanel,_super);function RuneDecomposePanel(){var _this=_super.call(this)||this;_this.cardList=null;_this.cardCollection=null;_this.checkBoxNum=5;_this.itemListScrollV=0;_this.resolveIng=false;_this._addNum=0;_this._chipNum=0;return _this}RuneDecomposePanel.prototype.childrenCreated=function(){this.itemList.itemRenderer=RuneDecomposeItemRenderer;this.itemList.useVirtualLayout=true};RuneDecomposePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.checkBoxNum;i++){if(this["cb"+i]){this.addTouchEvent(this["cb"+i],this.onCBTap)}}this.addTouchEvent(this.decomposeBtn,this.onTap);this.addTouchEvent(this.itemList,this.onListTap);this.observe(GameLogic.ins().postRuneShatter,this.onShatterChange);this.observe(GameLogic.ins().postRuneExchange,this.onShatterChange);this.observe(Rune.ins().postOneKeyDecomposeResult,this.onDecomposeResult);this.initCardList();this.resetCheckBox();this.updateShatter()};RuneDecomposePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();this.cleanCardList()};RuneDecomposePanel.prototype.onDecomposeResult=function(param){var _this=this;if(param[0]){var normalNum=param[1];var specialNum=param[2];var str="";var num=0;if(normalNum>0){str=i18n("RuneDecomposePanel_0");num=normalNum}else if(specialNum>0){str=i18n("RuneDecomposePanel_1");num=specialNum}if(this._addNum)UserTips.ins().showTips(i18n("RuneDecomposePanel_2",this._addNum));if(this._chipNum)UserTips.ins().showTips(i18n("RuneDecomposePanel_4",this._chipNum));this.playEffect();TimerManager.ins().doTimer(500,1,function(){_this.initCardList();_this.updateShatter();_this.updateAddShatter();_this.resolveIng=false},this)}else{UserTips.ins().showTips(i18n("RuneDecomposePanel_5"))}};RuneDecomposePanel.prototype.playEffect=function(){var num=this.itemList.numChildren;for(var i=0;i<num;i++){var item=this.itemList.getChildAt(i);if(item){item.playEffect()}}};RuneDecomposePanel.prototype.onShatterChange=function(){this.updateShatter()};RuneDecomposePanel.prototype.onListTap=function(e){if(e&&e.currentTarget){var index=this.itemList.selectedIndex;if(index<0){return}var itemRenderer=this.itemList.getVirtualElementAt(index);if(itemRenderer&&itemRenderer instanceof RuneDecomposeItemRenderer&&itemRenderer.cb){var data=itemRenderer.data;if(data){data.isSelected=!data.isSelected;this.cardCollection.itemUpdated(data)}}this.itemList.selectedIndex=-1;this.updateAddShatter()}};RuneDecomposePanel.prototype.onTap=function(e){if(e&&e.currentTarget){switch(e.currentTarget){case this.decomposeBtn:this.decomposeRune();break}}};RuneDecomposePanel.prototype.decomposeRune=function(){var _this=this;if(this.resolveIng)return;if(this.cardList&&this.cardList.length>0){var hasMaxQuality=false;var rbc=null;var ic=null;var idList_4=[];for(var _i=0,_a=this.cardList;_i<_a.length;_i++){var v=_a[_i];if(v&&v.isSelected&&v.itemData&&v.itemData.itemConfig){idList_4.push(v.itemData);rbc=RuneConfigMgr.ins().getBaseCfg(v.itemData);ic=v.itemData.itemConfig;if(ItemConfig.getQuality(ic)>=RuneConfigMgr.ins().getOtherCfg().maxQuality){hasMaxQuality=true}}}if(hasMaxQuality){var specialStr="";var qualityStr="";var plusStr="";if(hasMaxQuality)qualityStr="<font color = '"+ItemBase.QUALITY_COLOR[RuneConfigMgr.ins().getOtherCfg().maxQuality]+i18n("RuneDecomposePanel_7");var str=specialStr+plusStr+qualityStr;var finalStr=i18n("RuneDecomposePanel_9")+str+i18n("RuneDecomposePanel_10");WarnWin.show(finalStr,function(){_this.resolveIng=true;Rune.ins().sendOneKeyDecompose(idList_4)},this);return}else{if(idList_4.length>0){this.resolveIng=true;Rune.ins().sendOneKeyDecompose(idList_4);return}}}UserTips.ins().showTips(i18n("RuneDecomposePanel_11"))};RuneDecomposePanel.prototype.onCBTap=function(e){if(e&&e.currentTarget){var cb=e.currentTarget;if(cb&&cb instanceof eui.CheckBox){var tempCB=null;for(var i=0;i<this.checkBoxNum;i++){tempCB=this["cb"+i];if(tempCB&&tempCB===cb){this.setQualitySelected(i+1,cb.selected);return}}}}};RuneDecomposePanel.prototype.updateShatter=function(){var shatter=Actor.runeShatter;this.curLab.text=shatter.toString();var rune=Actor.runeExchange;this.suipianNow.text=rune.toString();this.materialLab.text=""+UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,ItemConst.JINGJIN)};RuneDecomposePanel.prototype.updateAddShatter=function(){var addNum=0;var chip=0;var materiaCount=0;var rbc=null;var materialName=GlobalConfig.ItemConfig[GlobalConfig.RuneOtherConfig.goldItemId].name;if(this.cardList&&this.cardList.length>0){for(var _i=0,_a=this.cardList;_i<_a.length;_i++){var v=_a[_i];if(v&&v.isSelected&&v.itemData&&v.itemData.itemConfig){rbc=RuneConfigMgr.ins().getBaseCfg(v.itemData);if(rbc){addNum+=rbc.gain;if(rbc.chip)chip+=rbc.chip;var config=GlobalConfig.RuneComposeConfig[rbc.id];if(config){materiaCount+=config.count}}}}}this._addNum=addNum;this._chipNum=chip;this.addLab.text=addNum>0?"+"+addNum+"  ":"";this.suipianAdd.text=chip?"+"+chip:"";this.materialLab.text=""+UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,ItemConst.JINGJIN);this.addMaterialLab.text=materiaCount>0?"  +"+materiaCount:""};RuneDecomposePanel.prototype.setQualitySelected=function(qua,selected){if(qua<0){for(var _i=0,_a=this.cardList;_i<_a.length;_i++){var v=_a[_i];if(v.itemData&&v.itemData.itemConfig){v.isSelected=false}}}else{for(var _b=0,_c=this.cardList;_b<_c.length;_b++){var v=_c[_b];if(v.itemData&&v.itemData.itemConfig){if(ItemConfig.getQuality(v.itemData.itemConfig)==qua){v.isSelected=selected}}}}var len=this.cardCollection.length;for(var i=0;i<len;i++){this.cardCollection.itemUpdated(this.cardList[i])}this.updateAddShatter()};RuneDecomposePanel.prototype.getCheckBoxSelected=function(qualityIndex){var cb=this["cb"+(qualityIndex-1)];if(cb){return cb.selected}return false};RuneDecomposePanel.prototype.resetCheckBox=function(defaultIndex){if(defaultIndex===void 0){defaultIndex=1}var cb=null;for(var i=0;i<this.checkBoxNum;i++){cb=this["cb"+i];if(cb&&cb instanceof eui.CheckBox){cb.selected=i+1==defaultIndex}}this.setQualitySelected(defaultIndex,true)};RuneDecomposePanel.prototype.initCardList=function(){this.cleanCardList();this.cardList=[];var list=UserBag.ins().getBagGoodsByType(6);if(list&&list.length>0){var rdid=null;for(var _i=0,list_17=list;_i<list_17.length;_i++){var v=list_17[_i];for(var i=0;i<v.count;i++){rdid=new RuneDecomposeItemData;rdid.itemData=v;this.cardList.push(rdid)}}this.cardList.sort(this.sortList)}this.cardCollection=new eui.ArrayCollection(this.cardList);this.itemList.dataProvider=this.cardCollection};RuneDecomposePanel.prototype.cleanCardList=function(){this.cardList=null;this.cardCollection=null;this.itemList.dataProvider=null};RuneDecomposePanel.prototype.sortList=function(a,b){var aq=ItemConfig.getQuality(a.itemData.itemConfig);var bq=ItemConfig.getQuality(b.itemData.itemConfig);if(aq>bq)return-1;if(aq<bq)return 1;var arbc=RuneConfigMgr.ins().getBaseCfg(a.itemData);var brbc=RuneConfigMgr.ins().getBaseCfg(b.itemData);if(arbc&&brbc){var lvlA=arbc.id%100;var lvlB=brbc.id%100;if(lvlA>lvlB){return-1}else if(lvlA<lvlB){return 1}}return a.itemData.configID-b.itemData.configID};return RuneDecomposePanel}(BaseView);__reflect(RuneDecomposePanel.prototype,"RuneDecomposePanel");var RuneDisplay=function(_super){__extends(RuneDisplay,_super);function RuneDisplay(){var _this=_super.call(this)||this;_this.pos=-1;_this.isShowName=true;return _this}RuneDisplay.prototype.init=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.noOpenTF,this.onTap)};RuneDisplay.prototype.close=function(){this.removeTouchEvent(this.noOpenTF,this.onTap)};RuneDisplay.prototype.onTap=function(e){var target=e.target;if(target==this.noOpenTF){ViewManager.ins().open(FbWin,2)}};RuneDisplay.prototype.setPos=function(pos){this.pos=pos;var rlpc=RuneConfigMgr.ins().getLockCfg(pos);if(!this.assert(rlpc,"RuneLockPosConfig("+pos+")")){var lv=SkyLevelModel.ins().cruLevel;var lockLv=rlpc.lockLv;if(lv>lockLv){this.currentState=RuneDisplay.SKIN_STATE_UNLOCK}else{this.currentState=RuneDisplay.SKIN_STATE_LOCK}}};RuneDisplay.prototype.setLockTF=function(show){if(this.pos<0)return;if(this.currentState!=RuneDisplay.SKIN_STATE_LOCK&&this.currentState!=RuneDisplay.SKIN_STATE_READY){return}var cfg=RuneConfigMgr.ins().getLockCfg(this.pos);if(this.assert(cfg,"RuneLockPosConfig("+this.pos+")"))return;var upPosCfg=null;if(this.pos>=1)upPosCfg=RuneConfigMgr.ins().getLockCfg(this.pos-1);if(upPosCfg&&upPosCfg.lockLv<=SkyLevelModel.ins().cruLevel&&show){var info=GlobalConfig.FbChallengeConfig[cfg.lockLv];var model=SkyLevelModel.ins();var nextCfg=model.getNextOpenLevel();var layer=0;if(nextCfg)layer=nextCfg.layer;var str=i18n("RuneDisplay_0",UserFb.ins().getFbChName(info.group),layer);this.noOpenTF.textFlow=TextFlowMaker.generateTextFlow1(str)}else{this.noOpenTF.text=""}};RuneDisplay.prototype.setData=function(data){if(!data||data.itemConfig&&data.itemConfig.id<=0)return;this.data=data;var itemCfg=GlobalConfig.ItemConfig[data.itemConfig.id];this._itemConfig=itemCfg;if(!this.assert(itemCfg,"ItemConfig("+data.itemConfig.id+")")){this.nameBG.visible=this.isShowName;this.nameTF.visible=this.isShowName;this.iconImg.source=itemCfg.icon+"_png";var nameCfg=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(itemCfg)];this.nameTF.textFlow=TextFlowMaker.generateTextFlow(i18n("RuneDisplay_1",ItemConfig.getQualityColor(itemCfg),nameCfg.runeName,itemCfg.id%100));this.nameTF.strokeColor=ItemConfig.getQualityStrokeColor(itemCfg)}};RuneDisplay.prototype.setDataByItemConfig=function(data){if(!data)return;this._itemConfig=data;this.currentState=RuneDisplay.SKIN_STATE_UNLOCK;this.nameBG.visible=this.isShowName;this.nameTF.visible=this.isShowName;this.iconImg.source=data.icon+"_png";var nameCfg=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(data)];if(data.level&&data.level!=0)this.nameTF.textFlow=TextFlowMaker.generateTextFlow(i18n("RuneDisplay_2",ItemConfig.getQualityColor(data),nameCfg.runeName,data.level%100));else this.nameTF.textFlow=TextFlowMaker.generateTextFlow(i18n("RuneDisplay_3",ItemConfig.getQualityColor(data),nameCfg.runeName));this.nameTF.strokeColor=ItemConfig.getQualityStrokeColor(data)};RuneDisplay.prototype.getItemConfig=function(){return this._itemConfig};RuneDisplay.prototype.cleanData=function(){this.data=null;this._itemConfig=null;this.iconImg.source=null;this.nameTF.text="";this.nameTF.visible=false;this.nameBG.visible=false};RuneDisplay.prototype.showOrHideSelected=function(isShow){this.selectedImg.visible=isShow};RuneDisplay.prototype.showName=function(boo){this.isShowName=boo};RuneDisplay.prototype.assert=function(value,msg){return Assert(value,"["+egret.getQualifiedClassName(RuneDisplay)+"] "+msg+"is null!")};RuneDisplay.SKIN_STATE_LOCK="lock";RuneDisplay.SKIN_STATE_READY="ready";RuneDisplay.SKIN_STATE_UNLOCK="unlock";return RuneDisplay}(BaseComponent);__reflect(RuneDisplay.prototype,"RuneDisplay");var RuneExchangeItemRenderer=function(_super){__extends(RuneExchangeItemRenderer,_super);function RuneExchangeItemRenderer(){var _this=_super.call(this)||this;_this.skinName="RuneExchangeItemSkin";_this.goBtn.name="goBtn";return _this}RuneExchangeItemRenderer.prototype.dataChanged=function(){var cfg=this.data;if(cfg){var itemCfg=GlobalConfig.ItemConfig[cfg.id];this.icon.setDataByItemConfig(itemCfg);var info=RuneConfigMgr.ins().getBaseCfgByItemConfig(itemCfg);this.descLab.text=RuneConfigMgr.ins().getcfgAttrDesc(info);var config=GlobalConfig.FbChallengeConfig[cfg.checkpoint];if(!config){this.descLab1.text=i18n("RuneExchangeItemRenderer_0")}else{this.descLab1.text=i18n("RuneExchangeItemRenderer_1",UserFb.ins().getFbChName(config.group))}var colorStr="";if(Actor.runeExchange>=cfg.conversion)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;this.nameLab0.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+Actor.runeExchange+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+cfg.conversion+"</font> ");this.setEff(itemCfg)}else{this.retView()}};RuneExchangeItemRenderer.prototype.setEff=function(itemCfg){var quality=ItemConfig.getQuality(itemCfg);if(quality==5){this.EquipEffect=this.EquipEffect||new MovieClip;this.EquipEffect.touchEnabled=false;if(!this.EquipEffect.parent)this.addChild(this.EquipEffect);this.EquipEffect.playFile(RES_DIR_EFF+"chuanqizbeff",-1);this.EquipEffect.x=this.effpos.x;this.EquipEffect.y=this.effpos.y;this.EquipEffect.scaleX=this.effpos.scaleX;this.EquipEffect.scaleY=this.effpos.scaleY}};RuneExchangeItemRenderer.prototype.close=function(){DisplayUtils.removeFromParent(this.EquipEffect)};RuneExchangeItemRenderer.prototype.retView=function(){this.descLab.text="";this.descLab1.text="";this.nameLab0.text="";this.icon.setData(null);this.close()};return RuneExchangeItemRenderer}(eui.ItemRenderer);__reflect(RuneExchangeItemRenderer.prototype,"RuneExchangeItemRenderer");var RuneExchangePanel=function(_super){__extends(RuneExchangePanel,_super);function RuneExchangePanel(){var _this=_super.call(this)||this;_this._scrollV=0;_this.skinName="RuneSkinExchange";_this.menulist0.itemRenderer=RuneExchangeItemRenderer;return _this}RuneExchangePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(GameLogic.ins().postRuneExchange,this.updateList);this.addTouchEvent(this.menulist0,this.onListTap);this.updateList()};RuneExchangePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();for(var i=0;i<this.menulist0.numElements;i++){var render=this.menulist0.getVirtualElementAt(i);render.close()}};RuneExchangePanel.prototype.updateList=function(){var data=RuneConfigMgr.ins().getExchangeDataList();this.menulist0.dataProvider=new eui.ArrayCollection(data);var scro=this.menulist0.parent;scro.validateNow();scro.stopAnimation();this.menulist0.scrollV=this._scrollV};RuneExchangePanel.prototype.onListTap=function(e){if(e.target.name!="goBtn"){return}var cfg=this.menulist0.selectedItem;if(!cfg||cfg&&cfg.conversion>Actor.runeExchange){UserWarn.ins().setBuyGoodsWarn(500008,cfg.conversion-Actor.runeExchange);UserTips.ins().showTips(i18n("RuneExchangePanel_0"));return}if(SkyLevelModel.ins().lastPass||SkyLevelModel.ins().cruLevel>=cfg.checkpoint){}else{UserTips.ins().showTips(i18n("RuneExchangePanel_1"));return}Rune.ins().sendExchangeRune(cfg.id);this._scrollV=this.menulist0.scrollV};return RuneExchangePanel}(BaseView);__reflect(RuneExchangePanel.prototype,"RuneExchangePanel");var RuneReplaceItemRenderer=function(_super){__extends(RuneReplaceItemRenderer,_super);function RuneReplaceItemRenderer(){var _this=_super.call(this)||this;_this.skinName="RuneEquipChangeSkinItem";_this.changeBtn.name="changeBtn";_this.changeBtn0.name="changeBtn";_this.getBtn.name="getBtn";return _this}RuneReplaceItemRenderer.prototype.dataChanged=function(){var curData=this.data;var itemData=curData.data;this.currentState="all";this.validateNow();if(itemData&&itemData instanceof ItemData){if(itemData.configID){var rbc=RuneConfigMgr.ins().getBaseCfg(itemData);if(rbc){this.itemIcon.showName(false);this.itemIcon.setData(itemData);var itemCfg=GlobalConfig.ItemConfig[itemData.itemConfig.id];var nameCfg=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(itemCfg)];this.runeName.textFlow=TextFlowMaker.generateTextFlow(i18n("RuneReplaceItemRenderer_1",ItemConfig.getQualityColor(itemCfg),nameCfg.runeName,itemCfg.id%100));this.runeName.strokeColor=ItemConfig.getQualityStrokeColor(itemCfg);this.back.text=i18n("RuneReplaceItemRenderer_0",rbc.gain);this.attr.text=RuneConfigMgr.ins().getcfgAttrDesc(rbc);this.changeBtn.visible=curData.canEquip&&RuneDataMgr.ins().posIsWear;this.changeBtn0.visible=curData.canEquip&&!RuneDataMgr.ins().posIsWear;this.now.visible=!curData.canEquip&&RuneDataMgr.ins().posIsWear&&RuneDataMgr.ins().posIsWear.configID==itemData.configID;this.already.visible=!curData.canEquip&&RuneDataMgr.ins().posIsWear!=itemData;if(!this.already.visible){var win=ViewManager.ins().getView(RuneReplaceWin);if(win){this.already.visible=Rune.ins().isEquipMerge(itemData.configID,win.roleIndex,win.posIndex);this.changeBtn.visible=this.changeBtn0.visible=!this.already.visible}}}else{this.resetView()}}else{this.setBtnStatu();this.resetView()}}else{this.resetView()}};RuneReplaceItemRenderer.prototype.setBtnStatu=function(){if(this.data==null||this.data.data==null){this.currentState="dis";this.itemIcon.currentState="emp"}else{if(this.data.data.configID){this.currentState="all";this.changeBtn.visible=false;this.changeBtn0.visible=false;this.now.visible=true;this.already.visible=false}else{this.currentState="get"}}};RuneReplaceItemRenderer.prototype.getItemId=function(){if(this.data&&this.data.data)return this.data.data.configID;return 0};RuneReplaceItemRenderer.prototype.resetView=function(){this.itemIcon.setData(null);this.nameLab.text="";this.attr.text=""};return RuneReplaceItemRenderer}(eui.ItemRenderer);__reflect(RuneReplaceItemRenderer.prototype,"RuneReplaceItemRenderer");var RuneReplaceItemData=function(){function RuneReplaceItemData(data){this.data=data}return RuneReplaceItemData}();__reflect(RuneReplaceItemData.prototype,"RuneReplaceItemData");var RuneReplaceSpecialItemRenderer=function(_super){__extends(RuneReplaceSpecialItemRenderer,_super);function RuneReplaceSpecialItemRenderer(){return _super.call(this)||this}RuneReplaceSpecialItemRenderer.prototype.dataChanged=function(){var itemData=this.data;if(itemData&&itemData instanceof ItemData){var rbc=RuneConfigMgr.ins().getBaseCfg(itemData);this.itemIcon.setData(itemData.itemConfig);this.nameLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+ItemConfig.getQualityColor(itemData.itemConfig)+"'>"+itemData.itemConfig.name+"</font>");this.nameLab.strokeColor=ItemConfig.getQualityStrokeColor(itemData.itemConfig);if(rbc.attr){this.power.text=i18n("RuneReplaceSpecialItemRenderer_0")+UserBag.getAttrPower(rbc.attr)}else{this.power.text=i18n("RuneReplaceSpecialItemRenderer_1")+rbc.power}this.numLab.text=itemData.count.toString();this.specialEffLab.text=rbc.specialDesc}else{this.resetView()}};RuneReplaceSpecialItemRenderer.prototype.resetView=function(){this.itemIcon.setData(null);this.nameLab.text="";this.specialEffLab.text="";this.power.text="";this.numLab.text=""};return RuneReplaceSpecialItemRenderer}(eui.ItemRenderer);__reflect(RuneReplaceSpecialItemRenderer.prototype,"RuneReplaceSpecialItemRenderer");var RuneReplaceWin=function(_super){__extends(RuneReplaceWin,_super);function RuneReplaceWin(){var _this=_super.call(this)||this;_this.posIndex=0;_this.roleIndex=0;_this.item=null;return _this}RuneReplaceWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="RuneEquipChangeSkin";this.isTopLevel=true;this.list.itemRenderer=RuneReplaceItemRenderer;this.myItem=new RuneReplaceItemRenderer;this.itemGroup.addChild(this.myItem)};RuneReplaceWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.posIndex=isNaN(param[0])?0:param[0];this.roleIndex=isNaN(param[1])?0:param[1];this.item=param[2];this.runeTypeList=param[3];RuneDataMgr.ins().posIsWear=this.item;this.myItem.data=new RuneReplaceItemData(this.item);this.myItem.setBtnStatu();this.addTouchEvent(this.list,this.onListTap);this.observe(Rune.ins().postInlayResult,this.onInlayResult);this.updateList()};RuneReplaceWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}MessageCenter.ins().removeAll(this);this.list.dataProvider=null};RuneReplaceWin.prototype.onListTap=function(e){var _this=this;if(e.target.name!="changeBtn"){if(e.target.name=="getBtn"){ViewManager.ins().open(FbWin,2)}return}var item=null;var rData=this.list.selectedItem;if(rData)item=rData.data;var flag=false;if(item&&item instanceof ItemData){var itemCfg=GlobalConfig.ItemConfig[item.configID];var selectedRuneData=RuneDataMgr.ins().getRune(this.roleIndex,this.posIndex);if(selectedRuneData){var selectedRuneCfg=null;if(selectedRuneData.configID>0)selectedRuneCfg=RuneConfigMgr.ins().getBaseCfg(selectedRuneData);if(selectedRuneCfg&&selectedRuneData.itemConfig&&ItemConfig.getSubType(itemCfg)==ItemConfig.getSubType(selectedRuneData.itemConfig)){}else{var rdList=RuneDataMgr.ins().getRoleRune(this.roleIndex);if(rdList){var tempCfg=null;for(var _i=0,rdList_4=rdList;_i<rdList_4.length;_i++){var v=rdList_4[_i];if(v&&v.itemConfig&&v.itemConfig.id>0){tempCfg=GlobalConfig.ItemConfig[v.configID];if(tempCfg&&ItemConfig.getSubType(tempCfg)==ItemConfig.getSubType(itemCfg)){flag=true;break}}}}}}if(flag||!Rune.ins().isCanEquip(item.configID,this.roleIndex,this.myItem.getItemId(),this.posIndex)){UserTips.ins().showTips(i18n("RuneReplaceWin_0"));return}var arrStr=Rune.ins().getMergeRune(item.configID,this.roleIndex,this.item);if(arrStr){WarnWin.show(arrStr[0],function(){Rune.ins().sendInlay(_this.roleIndex,_this.posIndex,item.handle)},this);return}Rune.ins().sendInlay(this.roleIndex,this.posIndex,item.handle)}};RuneReplaceWin.prototype.updateList=function(){var itemDataList=UserBag.ins().getBagGoodsByType(6);if(itemDataList){var arr1=[];var arr2=[];var curType=this.item&&this.item.itemConfig?ItemConfig.getSubType(this.item.itemConfig):-1;for(var _i=0,itemDataList_1=itemDataList;_i<itemDataList_1.length;_i++){var v=itemDataList_1[_i];if(v&&RuneConfigMgr.ins().getBaseCfg(v)){var type=ItemConfig.getSubType(v.itemConfig);if(curType==type||this.runeTypeList.indexOf(type)<0){if(curType>-1&&this.item.configID==v.configID){}else{if(Rune.ins().isEquipMerge(v.configID,this.roleIndex,this.posIndex)){arr2.push(v)}else{arr1.push(v)}}}else{arr2.push(v)}}}arr1.sort(this.sortRunes);arr2.sort(this.sortRunes);var arr=[].concat(arr1,arr2);var tempItem=new ItemData;arr.push(tempItem);var datas=[];for(var i=0;i<arr.length;i++){var data=new RuneReplaceItemData(arr[i]);data.canEquip=false;if(i<arr1.length){data.canEquip=true}datas.push(data)}this.list.dataProvider=new eui.ArrayCollection(datas)}};RuneReplaceWin.prototype.sortRunes=function(a,b){var aq=ItemConfig.getQuality(a.itemConfig);var bq=ItemConfig.getQuality(b.itemConfig);if(aq>bq)return-1;if(aq<bq)return 1;var arbc=RuneConfigMgr.ins().getBaseCfg(a);var brbc=RuneConfigMgr.ins().getBaseCfg(b);if(arbc&&brbc){var lvlA=arbc.id%100;var lvlB=brbc.id%100;if(lvlA>lvlB){return-1}else if(lvlA<lvlB){return 1}}return a.configID-b.configID};RuneReplaceWin.prototype.onInlayResult=function(param){if(param[0]){ViewManager.ins().close(RuneReplaceWin)}};return RuneReplaceWin}(BaseEuiView);__reflect(RuneReplaceWin.prototype,"RuneReplaceWin");ViewManager.ins().reg(RuneReplaceWin,LayerManager.UI_Main);var SamsaraCC=function(_super){__extends(SamsaraCC,_super);function SamsaraCC(){var _this=_super.call(this)||this;_this.sysId=PackageID.Samsara;_this.regNetMsg(1,_this.postSamsaraInfo);_this.regNetMsg(4,_this.postCompose);return _this}SamsaraCC.ins=function(){return _super.ins.call(this)};SamsaraCC.prototype.exchangeSamsaraExp=function(type){var bytes=this.getBytes(2);bytes.writeByte(type);this.sendToServer(bytes)};SamsaraCC.prototype.upgradeSamsaraLv=function(){var bytes=this.getBytes(3);this.sendToServer(bytes)};SamsaraCC.prototype.postSamsaraInfo=function(bytes){var isInit=SamsaraModel.ins().samsaraInfo?false:true;var lastYeli=SamsaraModel.ins().samsaraInfo?SamsaraModel.ins().samsaraInfo.exp:0;SamsaraModel.ins().samsaraInfo=new SamsaraVO(bytes.readInt(),bytes.readInt(),bytes.readShort(),bytes.readShort(),bytes.readShort());if(!isInit){var val=SamsaraModel.ins().samsaraInfo.exp-lastYeli;if(val)UserTips.ins().showTips(i18n("SamsaraCC_0",val))}};SamsaraCC.prototype.requestCompose=function(itemId,roleIndex){var bytes=this.getBytes(4);bytes.writeInt(itemId);bytes.writeShort(roleIndex);this.sendToServer(bytes)};SamsaraCC.prototype.postCompose=function(bytes){};return SamsaraCC}(BaseSystem);__reflect(SamsaraCC.prototype,"SamsaraCC");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.samsaraCC=SamsaraCC.ins.bind(SamsaraCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SamsaraUpgradeType;(function(SamsaraUpgradeType){SamsaraUpgradeType[SamsaraUpgradeType["level"]=1]="level";SamsaraUpgradeType[SamsaraUpgradeType["normal"]=2]="normal";SamsaraUpgradeType[SamsaraUpgradeType["advanced"]=3]="advanced"})(SamsaraUpgradeType||(SamsaraUpgradeType={}));window["SamsaraUpgradeType"]=SamsaraUpgradeType;var ExchangeVO=function(){function ExchangeVO(){}return ExchangeVO}();__reflect(ExchangeVO.prototype,"ExchangeVO");var ReincarnationDemonLevel=function(){function ReincarnationDemonLevel(){}return ReincarnationDemonLevel}();__reflect(ReincarnationDemonLevel.prototype,"ReincarnationDemonLevel");var ReincarnationLinkLevel=function(){function ReincarnationLinkLevel(){}return ReincarnationLinkLevel}();__reflect(ReincarnationLinkLevel.prototype,"ReincarnationLinkLevel");var ReincarnationSoulLevel=function(){function ReincarnationSoulLevel(){}return ReincarnationSoulLevel}();__reflect(ReincarnationSoulLevel.prototype,"ReincarnationSoulLevel");var SamsaraModel=function(_super){__extends(SamsaraModel,_super);function SamsaraModel(){var _this=_super.call(this)||this;_this.samsaraEquipMap={};_this.composeEquipMap={};_this.composeEquipTypes=[];_this.equipCompose={};var data=GlobalConfig.ReincarnationBase;_this.samsaraDescAry=[data.hellsName,data.ghostsName,data.animalsName,data.demigodsName,data.humansName,data.godsName];_this.initComposeEquip();_this.composeEquipTypes=_this.getComposeMenu();return _this}SamsaraModel.ins=function(){return _super.ins.call(this)};SamsaraModel.prototype.isCanUpgrade=function(){if(!this.samsaraInfo)return false;var lv=this.samsaraInfo.lv;var nextLv=lv+1;var cfg=GlobalConfig.ReincarnationLevel[nextLv];var result=false;if(nextLv<CommonUtils.getObjectLength(GlobalConfig.ReincarnationLevel)&&this.samsaraInfo.exp>=cfg.consume){result=true}return result};SamsaraModel.prototype.getExpExchangeTimes=function(){if(!this.samsaraInfo)return 0;var times=GlobalConfig.ReincarnationBase.levelExchangeTimes-this.samsaraInfo.expUpgradeNum;return times};SamsaraModel.prototype.getNormalExchangeTimes=function(){if(!this.samsaraInfo)return 0;var times=GlobalConfig.ReincarnationBase.normalItem.time-this.samsaraInfo.normalUpgradeNum;return times};SamsaraModel.prototype.getAdvancedExchangeTimes=function(){if(!this.samsaraInfo)return 0;var times=GlobalConfig.ReincarnationBase.advanceItem.time-this.samsaraInfo.advancedUpgradeNum;return times};SamsaraModel.prototype.isCanExpExchange=function(){var result=false;if(Actor.level>=GlobalConfig.ReincarnationBase.levelLimit&&this.getExpExchangeTimes()>0){result=true}return result};SamsaraModel.prototype.isCanItemExchange=function(){var count;if(this.getNormalExchangeTimes()>0){count=UserBag.ins().getBagGoodsCountById(0,GlobalConfig.ReincarnationBase.normalItem.id);if(count>0){return true}}if(this.getAdvancedExchangeTimes()>0){count=UserBag.ins().getBagGoodsCountById(0,GlobalConfig.ReincarnationBase.advanceItem.id);if(count>0){return true}}return false};SamsaraModel.prototype.isCanExchange=function(){if(this.isMaxSamsara(Actor.samsaraLv)){return false}else{return this.isCanExpExchange()||this.isCanItemExchange()}};SamsaraModel.prototype.isOpen=function(){var roleLv=UserZs.ins().lv*1e3+Actor.level;return roleLv>=GlobalConfig.ReincarnationBase.openLevel};SamsaraModel.prototype.isMaxSamsara=function(samsaraLv){var length=CommonUtils.getObjectLength(GlobalConfig.ReincarnationLevel);var cfg=GlobalConfig.ReincarnationLevel[length-1];return samsaraLv>=cfg.level};SamsaraModel.prototype.isSuit=function(index,role){var baseLv=this.getEquipSamsaraLvByRole(index,role);for(var i=EquipPos.HAT;i<EquipPos.MAX;i++){if(i!=index){var lv=this.getEquipSamsaraLvByRole(i,role);if(lv<baseLv){return false}}}return true};SamsaraModel.prototype.lowSuitEquips=function(index,role){var items=[];var baseLv=this.getEquipSamsaraLvByRole(index,role);for(var i=EquipPos.HAT;i<EquipPos.MAX;i++){var lv=this.getEquipSamsaraLvByRole(i,role);if(lv<baseLv){items.push(0)}else{items.push(1)}}return items};SamsaraModel.prototype.getEquipSamsaraLvByRole=function(index,role){var data=role.getEquipByIndex(index);if(!data.item.itemConfig)return 0;return this.getEquipSamsaraLv(data.item.itemConfig.id)};SamsaraModel.prototype.getEquipSamsaraLv=function(equipId){var zsLv=GlobalConfig.ItemConfig[equipId].zsLevel;return zsLv};SamsaraModel.prototype.getReincarnateSuit=function(equipId){var zsLv=GlobalConfig.ItemConfig[equipId].zsLevel;return GlobalConfig.ReincarnateSuit[zsLv]};SamsaraModel.prototype.getSamsara=function(equipSamsaraLv){var lv=0;if(equipSamsaraLv>=7){lv=Math.ceil((equipSamsaraLv-6)/6)}return lv};SamsaraModel.prototype.getSamsaraDesc=function(samsara){return this.samsaraDescAry[samsara]};SamsaraModel.prototype.getSamsaraLv=function(equipSamsaraLv){var lv=0;if(equipSamsaraLv==0){lv=-1}else{lv=Math.ceil((equipSamsaraLv-1)%6)}return lv};SamsaraModel.prototype.getSamsaraLvDesc=function(samsaraLv){var index=samsaraLv+1;return GlobalConfig.ReincarnationBase.state[index]};SamsaraModel.prototype.getAddSpiritEquips=function(role,equipPos,maxLength){if(maxLength===void 0){maxLength=10}var equips=[];var equipCount=UserBag.ins().itemCount[1];var equipData=role.getEquipByIndex(equipPos);if(equipCount&&!this.checkSpiritLvIsMax(equipData,equipPos)){for(var equip in equipCount){if(GlobalConfig.ReincarnateEquip[equip]){var id=+equip;var isCan=this.isEquipCanAddSpirit(role,equipPos,id);if(isCan){var count=equipCount[equip];while(count>0){equips.unshift(id);if(equips.length>=maxLength){return equips}count--}}}}}return equips};SamsaraModel.prototype.isEquipCanAddSpirit=function(role,equipPos,id){var data=role.getEquipByIndex(equipPos);var currentZsLv=GlobalConfig.ItemConfig[data.item.itemConfig.id].zsLevel;var zslv=GlobalConfig.ItemConfig[id].zsLevel;if(currentZsLv<zslv)return false;return this.checkEquip(id)};SamsaraModel.prototype.checkEquip=function(equipId){var item=GlobalConfig.ItemConfig[equipId];var targetJob=ItemConfig.getJob(item);var tempRole=SubRoles.ins().getSubRoleByJob(targetJob);if(tempRole){var targetData=tempRole.getEquipByIndex(ItemConfig.getSubType(item));if(targetData.item.itemConfig){var zslv=GlobalConfig.ItemConfig[targetData.item.itemConfig.id].zsLevel;if(zslv>=item.zsLevel){var shengEquipId=this.getTargetShengEquipById(equipId,item.zsLevel);return this.checkNormalEquip(targetData,shengEquipId)}}}return false};SamsaraModel.prototype.checkNormalEquip=function(data,equipId){var point=data.item.point;var item=new ItemData;item.configID=equipId;var targetPoint=item.point;return point>targetPoint};SamsaraModel.prototype.getTargetShengEquipById=function(id,zsLv){var cfg=this.equipCompose[id];if(cfg){return this.getTargetShengEquipById(cfg.id,zsLv)}return id};SamsaraModel.prototype.isCanAddSpirit=function(){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);for(var j=EquipPos.HAT;j<EquipPos.MAX;j++){var data=role.getEquipByIndex(j);if(!data.item.itemConfig)continue;var list=this.getAddSpiritEquips(role,j,1);if(list.length>0){return true}}}return false};SamsaraModel.prototype.checkRoleCanAddSpirit=function(index){var role=SubRoles.ins().getSubRoleByIndex(index);for(var j=EquipPos.HAT;j<EquipPos.MAX;j++){var data=role.getEquipByIndex(j);if(!data.item.itemConfig)continue;var list=this.getAddSpiritEquips(role,j,1);if(list.length>0){return true}}return false};SamsaraModel.prototype.checkEquipPosCanAddSpirit=function(role,equipIndex){var data=role.getEquipByIndex(equipIndex);if(data.item.itemConfig&&!this.checkSpiritLvIsMax(data,equipIndex)){var list=this.getAddSpiritEquips(role,equipIndex,1);if(list.length>0){return true}}return false};SamsaraModel.prototype.checkSpiritLvIsMax=function(data,index){var lv=data.spiritLv;return!GlobalConfig.ReincarnateSpirit[index][lv+1]};SamsaraModel.prototype.getExtraPower=function(role,addPercent,attrType){var power=0;var attr=0;for(var i=EquipPos.HAT;i<=EquipPos.SHIELD;i++){var data=role.getEquipByIndex(i);if(data.item.itemConfig){var itemId=data.item.itemConfig.id;if(itemId&&GlobalConfig.EquipConfig[itemId].baseAttr1){var attr1=GlobalConfig.EquipConfig[itemId].baseAttr1;attr+=attr1.value}}}if(attrType){var powerConfig=GlobalConfig.AttrPowerConfig;var config=powerConfig[attrType];power=attr*config.relate_power*addPercent}return power};SamsaraModel.prototype.initComposeEquip=function(){var ary=GlobalConfig.ReincarnationBase.headName;var count=ary.length;for(var i=1;i<=count;i++){if(!this.composeEquipMap[i])this.composeEquipMap[i]={}}for(var j in GlobalConfig.ReincarnateEquipCompose){var cfg=GlobalConfig.ReincarnateEquipCompose[j];this.equipCompose[cfg.material.id]=cfg;var type=cfg.distinguishi;var obj=this.composeEquipMap[type];var itemCfg=GlobalConfig.ItemConfig[cfg.id];var zsLv=itemCfg.zsLevel;var items=obj[zsLv];if(!items)items=[];items.push({type:MergeType.SamsareEquip,id:cfg.id});obj[zsLv]=items;this.composeEquipMap[type]=obj}};SamsaraModel.prototype.getComposeMenu=function(){var ary=GlobalConfig.ReincarnationBase.headName;var count=ary.length;var data=[];for(var i=1;i<=count;i++){data.push(i)}return data};SamsaraModel.prototype.getComposeZsList=function(type){var lv=UserZs.ins().lv;var list=GlobalConfig.ReincarnationBase.equipsList[type-1];var ary=[];for(var i in list){if(list[i]<=lv){ary.push({type:type,zsLv:list[i]})}}return ary};SamsaraModel.prototype.getComposeDesc=function(type){return GlobalConfig.ReincarnationBase.headName[type-1]};SamsaraModel.prototype.isCanCompose=function(){return this.getComposeEquipList().length>0};SamsaraModel.prototype.getComposeEquipId=function(type,zsLv){var id=0;var list=this.getComposeEquipList();for(var i in list){var itemId=list[i];var targetId=this.getComposeTarget(itemId);if(GlobalConfig.ItemConfig[targetId].zsLevel==zsLv&&GlobalConfig.ReincarnateEquipCompose[targetId].distinguishi==type){return itemId}}return id};SamsaraModel.prototype.getComposeEquipList=function(){var result=[];var equipCount=UserBag.ins().itemCount[1];for(var equip in equipCount){if(this.equipCompose[equip]){var itemId=+equip;var targetId=this.composeMaxEquip(itemId);if(targetId&&this.isCanWear(targetId)){result.push(itemId)}}}return result};SamsaraModel.prototype.isCanWear=function(itemId){if(!itemId)return false;var itemData=GlobalConfig.ItemConfig[itemId];var roleLv=UserZs.ins().lv*1e3+Actor.level;var equipLv=itemData.zsLevel*1e3+itemData.level;if(roleLv<equipLv)return false;var job=ItemConfig.getJob(itemData);var subType=ItemConfig.getSubType(itemData);var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role.job==job){var data=role.getEquipByIndex(subType);var itemCfg=data.item.itemConfig;if(itemCfg){var point=data.item.point;var tempItem=new ItemData;tempItem.configID=itemId;var targetPoint=tempItem.point;if(targetPoint>point){return true}}else{return true}}}return false};SamsaraModel.prototype.composeMaxEquip=function(itemId){var num=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_EQUIP,itemId);if(num){var material=new RewardData;material.id=itemId;material.count=0;var data=this.composeEquip(material);if(data&&data.id!=itemId){return data.id}}return 0};SamsaraModel.prototype.composeEquip=function(material){var itemId=material.id;var num=material.count+UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_EQUIP,itemId)+this.wearCount(itemId);var data;var cfg=this.equipCompose[itemId];if(cfg){if(num>=cfg.material.count){data=new RewardData;data.id=cfg.id;data.count=Math.floor(num/cfg.material.count);return this.composeEquip(data)}else{return material}}return material};SamsaraModel.prototype.wearCount=function(itemId){var itemData=GlobalConfig.ItemConfig[itemId];var job=ItemConfig.getJob(itemData);var subType=ItemConfig.getSubType(itemData);var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role.job==job){var data=role.getEquipByIndex(subType);var itemCfg=data.item.itemConfig;if(itemCfg&&itemCfg.id==itemId){return 1}}}return 0};SamsaraModel.prototype.getRoleIndexByEquip=function(itemId){var itemData=GlobalConfig.ItemConfig[itemId];var job=ItemConfig.getJob(itemData);var subType=ItemConfig.getSubType(itemData);var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role.job==job){var data=role.getEquipByIndex(subType);var itemCfg=data.item.itemConfig;if(itemCfg&&itemCfg.id==itemId){return i}}}return 4};SamsaraModel.prototype.isCanTypeCompose=function(type){var list=this.getComposeEquipList();for(var i in list){var equipId=list[i];var cfg=GlobalConfig.ReincarnateEquipCompose[this.getComposeTarget(equipId)];if(cfg.distinguishi==type){return true}}return false};SamsaraModel.prototype.getComposeTarget=function(materialId){var obj=this.equipCompose[materialId];if(obj)return obj.id;return 0};SamsaraModel.prototype.isCanZsLvCompose=function(type,zsLv){var list=this.getComposeEquipList();for(var i in list){var equipId=list[i];var targetId=this.getComposeTarget(equipId);var cfg=GlobalConfig.ReincarnateEquipCompose[targetId];var zsLevel=GlobalConfig.ItemConfig[targetId].zsLevel;if(zsLv==zsLevel&&cfg.distinguishi==type){return true}}return false};SamsaraModel.prototype.isCanEquipCompose=function(equipId){var list=this.getComposeEquipList();return list.indexOf(equipId)>=0};SamsaraModel.prototype.getReincarnationLinkLevel=function(pos,linkLv){for(var i in GlobalConfig.ReincarnationLinkLevel){if(i!=pos.toString())continue;for(var j in GlobalConfig.ReincarnationLinkLevel[i]){for(var k in GlobalConfig.ReincarnationLinkLevel[i][j]){if(k==linkLv.toString()){return GlobalConfig.ReincarnationLinkLevel[i][j][k]}}}}return null};SamsaraModel.prototype.getSoulLinkDesc=function(type){var desc;switch(type){case 11:desc=i18n("SamsaraModel_0");break;case 55:desc=i18n("SamsaraModel_1");break;case 19:desc=i18n("SamsaraModel_2");break;case 56:desc=i18n("SamsaraModel_3");break}return desc};SamsaraModel.prototype.getSoulMaxLevel=function(){return CommonUtils.getObjectLength(GlobalConfig.ReincarnationDemonLevel[EquipPos.HAT])};SamsaraModel.prototype.getSoulLinkLv=function(role,mainPos,soullv){var secPos=this.getLinkEquipPos(mainPos);var mainEquip=role.getEquipByIndex(mainPos);var secEquip=role.getEquipByIndex(secPos);if(mainEquip&&secEquip){return Math.min(mainEquip.soulLv,secEquip.soulLv)}return 0};SamsaraModel.prototype.getLinkEquipPos=function(mainPos){for(var i in GlobalConfig.ReincarnationLinkLevel){if(i==mainPos.toString()){for(var j in GlobalConfig.ReincarnationLinkLevel[i]){return+j}}}return null};SamsaraModel.prototype.isCanUpgradeSoul=function(){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){for(var j=EquipPos.HAT;j<=EquipPos.SHIELD;j++){var isCan=this.checkUpgradeSoul(SubRoles.ins().getSubRoleByIndex(i),j);if(isCan)return true}}return false};SamsaraModel.prototype.checkUpgradeSoul=function(role,pos){var mainEquip=role.getEquipByIndex(pos);var soulLv=mainEquip.soulLv;if(soulLv==this.getSoulMaxLevel()||!mainEquip.item.itemConfig){return false}else{var soulCfg=GlobalConfig.ReincarnationSoulLevel[role.job][pos][soulLv+1];var count=UserBag.ins().getBagGoodsCountById(0,soulCfg.materialInfo.id);return count>=soulCfg.materialInfo.count}};return SamsaraModel}(BaseClass);__reflect(SamsaraModel.prototype,"SamsaraModel");var SamsaraVO=function(){function SamsaraVO(lv,exp,expUpgradeNum,normalUpgradeNum,advancedUpgradeNum){this.lv=lv;this.exp=exp;this.expUpgradeNum=expUpgradeNum;this.normalUpgradeNum=normalUpgradeNum;this.advancedUpgradeNum=advancedUpgradeNum}return SamsaraVO}();__reflect(SamsaraVO.prototype,"SamsaraVO");var AddSpiritView=function(_super){__extends(AddSpiritView,_super);function AddSpiritView(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="ReincarnateSpiritSkin";return _this}AddSpiritView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.lunhuiList.itemRenderer=ItemBase;this.addTouchEvent(this.upBtn,this.addSpirit);this.addTouchEvent(this.bgClose,this.closeWin);this.addTouchEvent(this.closeBtn,this.closeWin);this.observe(UserEquip.ins().postAddSpirit,this.updateView);this.index=param[1];this.roleIndex=param[0];this.updateView()};AddSpiritView.prototype.updateView=function(){var role=SubRoles.ins().getSubRoleByIndex(this.roleIndex);var data=role.getEquipByIndex(this.index);this.setData(data)};AddSpiritView.prototype.addSpirit=function(){var data=this.lunhuiList.dataProvider;if(SamsaraModel.ins().checkSpiritLvIsMax(this.equipData,this.index)){UserTips.ins().showTips(i18n("AddSpiritView_0"));return}if(data.length==0){UserTips.ins().showTips(i18n("AddSpiritView_1"))}else{var filterAry=[];for(var i=0;i<data.length;i++){var id=data.getItemAt(i);var itemData=UserBag.ins().getFilterBagItemById(id,filterAry,UserBag.BAG_TYPE_EQUIP);if(itemData&&itemData.handle){filterAry.push(itemData.handle)}}if(filterAry.length>0)UserEquip.ins().requestAddSpirit(this.roleIndex,this.index,filterAry)}};AddSpiritView.prototype.setData=function(data){this.equipData=data;var lv=data.spiritLv;var level=i18n("Level_0");this.lvTxt.text="("+lv+"("+level+")";var cfg=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,lv);var nextCfg=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,lv+1);var power=0;this.attr4.text="0";this.attr5.text="0";this.attr6.text="0";this.attr7.text="0";if(cfg){power=UserBag.getAttrPower(cfg.attrs);this.attr4.text=cfg.attrs[0].value.toString();this.attr5.text=cfg.attrs[1].value.toString();this.attr6.text=cfg.attrs[2].value.toString();this.attr7.text=cfg.attrs[3].value.toString()}this.powerPanel.setPower(power);if(lv==CommonUtils.getObjectLength(GlobalConfig.ReincarnateSpirit[this.index])){this.attrGroup2.visible=false;this.expBar.maximum=100;this.expBar.value=100}else{this.attrGroup2.visible=true;this.attr8.text=nextCfg.attrs[0].value.toString();this.attr9.text=nextCfg.attrs[1].value.toString();this.attr10.text=nextCfg.attrs[2].value.toString();this.attr11.text=nextCfg.attrs[3].value.toString();this.expBar.maximum=nextCfg.consume;this.expBar.value=data.spiritExp}this.expLabel.text=this.expBar.value+"/"+this.expBar.maximum;var role=SubRoles.ins().getSubRoleByIndex(this.roleIndex);var ary=SamsaraModel.ins().getAddSpiritEquips(role,this.index);this.lunhuiList.dataProvider=new ArrayCollection(ary);this.redPoint.visible=SamsaraModel.ins().checkEquipPosCanAddSpirit(role,this.index)};AddSpiritView.prototype.closeWin=function(){ViewManager.ins().close(this)};return AddSpiritView}(BaseEuiView);__reflect(AddSpiritView.prototype,"AddSpiritView");ViewManager.ins().reg(AddSpiritView,LayerManager.UI_Popup);var GetSamsaraExpPanel=function(_super){__extends(GetSamsaraExpPanel,_super);function GetSamsaraExpPanel(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="GainYeLiSkin";return _this}GetSamsaraExpPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.redPoint1.visible=false;this.redPoint2.visible=false;var reward=new RewardData;reward.type=0;reward.id=0;reward.count=0;this.item0.data=reward;this.item0.isShowName(false);this.item1.isShowName(false);this.item2.isShowName(false);this.addTouchEvent(this.bgClose,this.closeWin);this.addTouchEvent(this.closeBtn,this.closeWin);this.addTouchEvent(this.btn0,this.expUpgrade);this.addTouchEvent(this.btn1,this.normalUpgrade);this.addTouchEvent(this.btn2,this.advanceUpgrade);this.observe(SamsaraCC.ins().postSamsaraInfo,this.updateView);this.observe(Shop.ins().postBuyResult,this.updateView);this.observe(Shop.ins().postBuyCount,this.updateView);this.updateView()};GetSamsaraExpPanel.prototype.expUpgrade=function(){if(this.btn0.enabled){if(Actor.level>=GlobalConfig.ReincarnationBase.levelLimit){this.lastYeli=SamsaraModel.ins().samsaraInfo.exp;SamsaraCC.ins().exchangeSamsaraExp(SamsaraUpgradeType.level)}else{UserTips.ins().showTips(i18n("GetSamsaraExpPanel_0",GlobalConfig.ReincarnationBase.levelLimit))}}};GetSamsaraExpPanel.prototype.normalUpgrade=function(){if(this.btn1.label==i18n("GetSamsaraExpPanel_1")){this.buy(1,GlobalConfig.ReincarnationBase.normalItem.id)}else{this.lastYeli=SamsaraModel.ins().samsaraInfo.exp;SamsaraCC.ins().exchangeSamsaraExp(SamsaraUpgradeType.normal)}};GetSamsaraExpPanel.prototype.advanceUpgrade=function(){if(this.btn2.label==i18n("GetSamsaraExpPanel_2")){this.buy(2,GlobalConfig.ReincarnationBase.advanceItem.id)}else{this.lastYeli=SamsaraModel.ins().samsaraInfo.exp;SamsaraCC.ins().exchangeSamsaraExp(SamsaraUpgradeType.advanced)}};GetSamsaraExpPanel.prototype.buy=function(index,id){var price=this["priceIcon"+index].getPrice();if(Actor.yb<price){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("GetSamsaraExpPanel_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GetSamsaraExpPanel_4"));ViewManager.ins().close(this)}else{var conf=CommonUtils.getObjectByAttr(GlobalConfig.ItemStoreConfig,"itemId",id);this.buyGoods(conf.id)}};GetSamsaraExpPanel.prototype.buyGoods=function(id){if(Shop.ins().shopData.checkBuyGoodsId(id)){ViewManager.ins().open(BuyWin,id)}};GetSamsaraExpPanel.prototype.closeWin=function(){ViewManager.ins().close(this)};GetSamsaraExpPanel.prototype.updateView=function(){if(this.lastYeli!=undefined&&SamsaraModel.ins().samsaraInfo.exp-this.lastYeli>0){this.lastYeli=SamsaraModel.ins().samsaraInfo.exp}if(Actor.level>=GlobalConfig.ReincarnationBase.levelLimit){var cfg=GlobalConfig.ReincarnationExchange[Actor.level];this.yeli0.text=cfg.value.toString();this.redPoint0.visible=SamsaraModel.ins().getExpExchangeTimes()>0;this.btn0.enabled=SamsaraModel.ins().getExpExchangeTimes()>0;this.limit.visible=false}else{this.yeli0.text=GlobalConfig.ReincarnationExchange[GlobalConfig.ReincarnationBase.levelLimit].value.toString();this.redPoint0.visible=false;this.limit.visible=true}this.toDay0.text=SamsaraModel.ins().getExpExchangeTimes().toString();this.updateItem(GlobalConfig.ReincarnationBase.normalItem,1,SamsaraModel.ins().getNormalExchangeTimes());this.updateItem(GlobalConfig.ReincarnationBase.advanceItem,2,SamsaraModel.ins().getAdvancedExchangeTimes())};GetSamsaraExpPanel.prototype.updateItem=function(vo,index,times){var itemCfg=GlobalConfig.ItemConfig[vo.id];this["item"+index].data=vo.id;this["toDay"+index].text=times.toString();if(times>0){this["toDay"+index].textColor=65280}else{this["toDay"+index].textColor=16711680}this["yeli"+index].text=vo.value.toString();var count=UserBag.ins().getBagGoodsCountById(0,vo.id);if(count>0){this["name"+index].text=i18n("GetSamsaraExpPanel_5",itemCfg.name,count);this["priceIcon"+index].visible=false;this["redPoint"+index].visible=times>0;this["btn"+index].label=i18n("GetSamsaraExpPanel_6")}else{this["name"+index].text=itemCfg.name;this["priceIcon"+index].visible=true;this["priceIcon"+index].setPrice(CommonUtils.getObjectByAttr(GlobalConfig.ItemStoreConfig,"itemId",vo.id).price);this["redPoint"+index].visible=false;this["btn"+index].label=i18n("GetSamsaraExpPanel_7")}};return GetSamsaraExpPanel}(BaseEuiView);__reflect(GetSamsaraExpPanel.prototype,"GetSamsaraExpPanel");ViewManager.ins().reg(GetSamsaraExpPanel,LayerManager.UI_Popup);var SamsaraComposePanel=function(_super){__extends(SamsaraComposePanel,_super);function SamsaraComposePanel(){return _super!==null&&_super.apply(this,arguments)||this}SamsaraComposePanel.prototype.childrenCreated=function(){this.initUI()};SamsaraComposePanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.list.itemRenderer=SamsaraComposeMenuItem;this.list0.itemRenderer=SamsaraComposeItem;this._listData=new eui.ArrayCollection;this.list0.dataProvider=this._listData;this._tabListData=new eui.ArrayCollection;this.list.dataProvider=this._tabListData};SamsaraComposePanel.prototype.open=function(){this.updateState();this.observe(UserBag.ins().postItemAdd,this.buffUpdata);this.observe(UserBag.ins().postItemDel,this.buffUpdata);this.observe(UserBag.ins().postItemCountChange,this.buffUpdata);this.observe(SamsaraCC.ins().postCompose,this.buffUpdata)};SamsaraComposePanel.prototype.buffUpdata=function(){TimerManager.ins().remove(this.updateState,this);TimerManager.ins().doTimer(100,1,this.updateState,this)};SamsaraComposePanel.prototype.updateState=function(){var data=SamsaraModel.ins().getComposeEquipList();var type;var zsLv;if(data&&data.length>0){this.materialId=data[0];var targetId=SamsaraModel.ins().getComposeTarget(this.materialId);var itemCfg=GlobalConfig.ItemConfig[targetId];var cfg=GlobalConfig.ReincarnateEquipCompose[targetId];type=cfg.distinguishi;zsLv=itemCfg.zsLevel}else{this.materialId=0;type=1;zsLv=GlobalConfig.ReincarnationBase.equipsList[0][0]}this.zsLv=zsLv;this.type=type;this._tabListData.source=SamsaraModel.ins().getComposeMenu();this.updateView(type,zsLv,this.materialId)};SamsaraComposePanel.prototype.selectList=function(composeItem,zsLv){var list=composeItem.list;var count=list.dataProvider.length;for(var i=0;i<count;i++){var item=list.getElementAt(i);if(item){if(zsLv==item.data["zsLv"]){composeItem.selectList(i);return}}}};SamsaraComposePanel.prototype.unSelectList=function(){var count=this.list.dataProvider.length;for(var i=0;i<count;i++){var item=this.list.getElementAt(i);var tempList=item.list;for(var j=0;j<tempList.dataProvider.length;j++){var tempItem=tempList.getElementAt(j);if(tempItem)tempItem.setSelect(false)}}};SamsaraComposePanel.prototype.updateView=function(type,zsLv,materialId){if(materialId===void 0){materialId=0}var data=SamsaraModel.ins().composeEquipMap[type][zsLv];this._listData.source=data;this.refushBarList(materialId)};SamsaraComposePanel.prototype.refushBarList=function(materialId){if(!materialId){this.contentScroller.viewport.scrollV=0;return}var targetId=SamsaraModel.ins().getComposeTarget(this.materialId);var data=this.list0.dataProvider;for(var i=0;i<data.length;i++){if(targetId==data.getItemAt(i)){this.contentScroller.viewport.validateNow();this.contentScroller.viewport.scrollV=i*101;if(this.contentScroller.viewport.contentHeight-this.contentScroller.viewport.scrollV<this.contentScroller.viewport.height){this.contentScroller.viewport.scrollV=this.contentScroller.viewport.contentHeight-this.contentScroller.height}break}}};SamsaraComposePanel.prototype.close=function(){this.removeObserve()};return SamsaraComposePanel}(BaseEuiView);__reflect(SamsaraComposePanel.prototype,"SamsaraComposePanel");var SamsaraEquipTips=function(_super){__extends(SamsaraEquipTips,_super);function SamsaraEquipTips(){var _this=_super.call(this)||this;_this.skinName="ReincarnateEquipTipsSkin";return _this}SamsaraEquipTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(param[1]!=undefined){this.roleIndex=-1;this.roleModel=param[1];this.index=param[2];var roleIndex=param[0];var isSelfRole=false;if(roleIndex>=0&&roleIndex<=SubRoles.ins().subRolesLen-1){var temp=SubRoles.ins().getSubRoleByIndex(roleIndex);if(temp.handle==this.roleModel.handle){isSelfRole=true;this.roleIndex=this.roleModel.index}}var data=this.roleModel.getEquipByIndex(this.index);this.setData(data);if(isSelfRole){this.addTouchEvent(this.spiritBtn,this.addSpirit);this.addTouchEvent(this.soulBtn,this.addSoul);this.spiritBtn.visible=true;this.soulBtn.visible=true}else{this.spiritBtn.visible=false;this.soulBtn.visible=false}}else{this.setTips(param[0])}this.addTouchEvent(this.bgClose,this.closeWin)};SamsaraEquipTips.prototype.setTips=function(itemId){this.spiritBtn.visible=false;this.soulBtn.visible=false;this.redPoint.visible=false;this.redPoint1.visible=false;var itemConfig=GlobalConfig.ItemConfig[itemId];this.updateBaseView(itemConfig);var itemData=new ItemData;itemData.itemConfig=itemConfig;var power=ItemConfig.calculateBagItemScore(itemData);this.powerPanel.setPower(power);this.score.text=i18n("SamsaraEquipTips_0",power);var subType=ItemConfig.getSubType(itemConfig);var isHat;if(subType==EquipPos.HAT){this.currentState="noSpirit0";isHat=true}else{isHat=false;this.currentState="noSpirit1"}this.updateBaseAttr(itemId,isHat);this.setSoulAttr(0);this.setSoulLink(0,0);var itemType=[0,0,0,0];switch(subType){case EquipPos.HAT:itemType[0]=1;break;case EquipPos.VIZARD:itemType[1]=1;break;case EquipPos.CLOAK:itemType[2]=1;break;case EquipPos.SHIELD:itemType[3]=1;break}this.setSuitAttr(itemConfig.id,itemType)};SamsaraEquipTips.prototype.setData=function(data){this.soulBtn.visible=true;this.spiritBtn.visible=true;this.redPoint.visible=this.roleIndex>=0&&SamsaraModel.ins().checkEquipPosCanAddSpirit(this.roleModel,this.index);this.redPoint1.visible=this.roleIndex>=0&&SamsaraModel.ins().checkUpgradeSoul(this.roleModel,this.index);var itemConfig=data.item.itemConfig;this.updateBaseView(itemConfig,data.soulLv);var equipCfg=GlobalConfig.EquipConfig[itemConfig.id];var spiritLv=data.spiritLv;var isHat;if(spiritLv==0&&data.spiritExp==0){if(this.index==EquipPos.HAT){this.currentState="noSpirit0";isHat=true}else{this.currentState="noSpirit1";isHat=false}}else{var isMax=spiritLv==CommonUtils.getObjectLength(GlobalConfig.ReincarnateSpirit[this.index]);if(this.index==EquipPos.HAT){this.currentState="doSpirit0";isHat=true}else{this.currentState="doSpirit1";isHat=false}this.setSpirit(data.spiritExp,data.spiritLv,isMax,isHat)}this.updateBaseAttr(itemConfig.id,isHat);var itemType=SamsaraModel.ins().lowSuitEquips(this.index,this.roleModel);this.setSuitAttr(itemConfig.id,itemType);this.score.text=i18n("SamsaraEquipTips_1",data.item.point);var count=0;for(var i=0;i<itemType.length;i++){if(itemType[i])count++}var isSuit=count==4;var suitCfg=SamsaraModel.ins().getReincarnateSuit(itemConfig.id);var power=data.item.point;power=this.setSoulAttr(data.soulLv,itemConfig.id,power);power=this.setSoulLink(data.soulLv,SamsaraModel.ins().getSoulLinkLv(this.roleModel,this.index,data.soulLv),itemConfig.id,power);if(this.roleModel&&equipCfg&&equipCfg.baseAttr2){var per=equipCfg.baseAttr2.value/100;power+=SamsaraModel.ins().getExtraPower(this.roleModel,per,equipCfg.baseAttr2.type)}if(isSuit){power+=UserBag.getAttrPower(suitCfg.attrs)}if(spiritLv>0){var cfg=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,spiritLv);power+=UserBag.getAttrPower(cfg.attrs)}power=power>>0;this.powerPanel.setPower(power)};SamsaraEquipTips.prototype.updateBaseView=function(itemConfig,soulLv){if(soulLv===void 0){soulLv=0}var q=ItemConfig.getQuality(itemConfig);var subType=ItemConfig.getSubType(itemConfig);var job=ItemConfig.getJob(itemConfig);this.nameLabel.text=itemConfig.name;if(soulLv>0){var desc=i18n("SamsaraEquipTips_2");switch(soulLv){case 1:desc+="Ⅰ";break;case 2:desc+="Ⅱ";break;case 3:desc+="Ⅲ";break;case 4:desc+="Ⅳ";break}this.nameLabel.text=desc+"."+itemConfig.name;this.itemIcon.setSoul(true)}this.nameLabel.textColor=ItemConfig.getQualityColor(itemConfig);this.nameLabel.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.quali.source=q>0?"quali"+q:"";this.itemIcon.setData(itemConfig);this.type.text=Role.getEquipNameByType(subType);this.lv.text=i18n("SamsaraEquipTips_3",itemConfig.zsLevel);this.lv.textColor=UserZs.ins().lv<itemConfig.zsLevel?15937822:242004;this.career.text=Role.getJobNameByJob(job)};SamsaraEquipTips.prototype.updateBaseAttr=function(id,isHat){var equipCfg=GlobalConfig.EquipConfig[id];this.attr0.text=equipCfg.atk.toString();this.attr1.text=equipCfg.hp.toString();this.attr2.text=equipCfg.def.toString();this.attr3.text=equipCfg.res.toString();this.attr4.text=equipCfg.baseAttr1.value.toString();if(isHat)this.attr5.text=equipCfg.baseAttr2.value/100+"%"};SamsaraEquipTips.prototype.setSuitAttr=function(id,itemType){var equipSamsaraLv=SamsaraModel.ins().getEquipSamsaraLv(id);var desc=SamsaraModel.ins().getSamsaraDesc(equipSamsaraLv-7);var suitCfg=SamsaraModel.ins().getReincarnateSuit(id);this.suitName.text=i18n("SamsaraEquipTips_4",desc);this.attr12.text=this.getValue(suitCfg.attrs,AttributeType.atAttack);this.attr13.text=this.getValue(suitCfg.attrs,AttributeType.atMaxHp);this.attr14.text=this.getValue(suitCfg.attrs,AttributeType.atDef);this.attr15.text=this.getValue(suitCfg.attrs,AttributeType.atRes);this.attr16.text=suitCfg.exAttrs[0].value/100+"%";var cor1=itemType[0]?ColorUtil.GREEN_COLOR:"0xff0000";var cor2=itemType[1]?ColorUtil.GREEN_COLOR:"0xff0000";var cor3=itemType[2]?ColorUtil.GREEN_COLOR:"0xff0000";var cor4=itemType[3]?ColorUtil.GREEN_COLOR:"0xff0000";var count=0;for(var i=0;i<itemType.length;i++){if(itemType[i])count++}this.suitState.textFlow=TextFlowMaker.generateTextFlow("<font color="+cor1+">"+Role.getEquipNameByType(EquipPos.HAT)+"、</font><font color="+cor2+">"+Role.getEquipNameByType(EquipPos.VIZARD)+"、</font><font color="+cor3+">"+Role.getEquipNameByType(EquipPos.CLOAK)+"、</font><font color="+cor4+">"+Role.getEquipNameByType(EquipPos.SHIELD)+"</font>");var isSuit=count==4;var cor5=isSuit?ColorUtil.GREEN_COLOR_N:16711680;this.suitNum.textColor=cor5;this.suitNum.text="("+count+"/4)";this.setSuitAttrTextColor(isSuit)};SamsaraEquipTips.prototype.setSuitAttrTextColor=function(isSuit){var color=isSuit?16711935:6710886;this.attr12.textColor=color;this.attr13.textColor=color;this.attr14.textColor=color;this.attr15.textColor=color;this.attr16.textColor=color;this.attrDesc.textColor=color;this.attrDesc1.textColor=color};SamsaraEquipTips.prototype.setSpirit=function(exp,lv,isMax,isHat){var lvDesc;var cfg=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,lv);if(isMax){lvDesc=""}else{lvDesc="("+exp+"/"+cfg.consume+")"}var level=i18n("Level_0");this.spiritLv.text=""+lv+level;this.spiritCost.text=lvDesc;if(lv==0){this.attr6.text="0";this.attr7.text="0";this.attr8.text="0";this.attr9.text="0"}else{this.attr6.text=this.getValue(cfg.attrs,AttributeType.atAttack);this.attr7.text=this.getValue(cfg.attrs,AttributeType.atMaxHp);this.attr8.text=this.getValue(cfg.attrs,AttributeType.atDef);this.attr9.text=this.getValue(cfg.attrs,AttributeType.atRes)}};SamsaraEquipTips.prototype.getValue=function(attrs,typeValue){var obj=CommonUtils.getObjectByAttr(attrs,"type",typeValue);return obj.value.toString()};SamsaraEquipTips.prototype.addSpirit=function(){this.closeWin();ViewManager.ins().open(AddSpiritView,this.roleIndex,this.index)};SamsaraEquipTips.prototype.addSoul=function(){this.closeWin();ViewManager.ins().open(SamsaraSoulWin,this.roleIndex,this.index)};SamsaraEquipTips.prototype.setSoulAttr=function(soulLv,id,power){if(id===void 0){id=0}if(power===void 0){power=0}if(soulLv==0){this["soulDescLable"].visible=false;this.soulAddAttr0.text="";this.soulAddAttr1.text="";this.soulAddAttr2.text="";this.soulAddAttr3.text="";this.soulAddAttr4.text=""}else{this["soulDescLable"].visible=true;var equipCfg=GlobalConfig.EquipConfig[id];var atk=equipCfg.atk;var hp=equipCfg.hp;var def=equipCfg.def;var res=equipCfg.res;var exAttr=equipCfg.baseAttr1.value;var subType=ItemConfig.getSubType(GlobalConfig.ItemConfig[id]);var cfg=GlobalConfig.ReincarnationDemonLevel[subType][soulLv];var percent=cfg.precent/1e4;this.soulAddAttr0.text=Math.floor(atk*percent).toString();this.soulAddAttr1.text=Math.floor(hp*percent).toString();this.soulAddAttr2.text=Math.floor(def*percent).toString();this.soulAddAttr3.text=Math.floor(res*percent).toString();this.soulAddAttr4.text=Math.floor(exAttr*percent).toString();var holyAttr=0;if(equipCfg.baseAttr2){holyAttr=UserBag.getAttrPower([equipCfg.baseAttr2])}power=(power-holyAttr)*(1+percent)+holyAttr;if(soulLv>0){var data=GlobalConfig.ReincarnationSoulLevel[ItemConfig.getJob(GlobalConfig.ItemConfig[id])][subType][soulLv];power+=UserBag.getAttrPower(data.attrs)}power=power>>0}return power};SamsaraEquipTips.prototype.setSoulLink=function(soulLv,soulLinlLv,itemId,power){if(itemId===void 0){itemId=0}if(power===void 0){power=0}if(soulLv==0){if(this.chainGroup.parent){this.chainGroup.parent.removeChild(this.chainGroup)}if(this.soulGroup.parent){this.soulGroup.parent.removeChild(this.soulGroup)}}else{if(!this.chainGroup.parent){this.suitGroup.parent.addChild(this.soulGroup)}if(!this.soulGroup.parent){this.suitGroup.parent.addChild(this.soulGroup)}}var level=i18n("Level_0");this.soulLv.text=""+soulLv+level;var showSoulLinlLv=soulLinlLv;if(soulLinlLv==0)showSoulLinlLv=1;this.chainLv.text=""+showSoulLinlLv+level;if(itemId){var subType=ItemConfig.getSubType(GlobalConfig.ItemConfig[itemId]);if(showSoulLinlLv>0){var cfg=SamsaraModel.ins().getReincarnationLinkLevel(subType,showSoulLinlLv);this.chainPos.text=i18n("SamsaraEquipTips_5",Role.getEquipNameByType(cfg.secondSlot));this.chainAttr.text=SamsaraModel.ins().getSoulLinkDesc(cfg.attrs[0].type);this.chainValue.text=cfg.attrs[0].value/100+"%";var colour=void 0;if(soulLinlLv==0){colour=6710886}else{colour=16776960}this.chainPos.textColor=colour;this.chainAttr.textColor=colour;this.chainState.textColor=colour;this.chainValue.textColor=colour;if(soulLinlLv>0){var role=this.roleModel;var temp=UserBag.getAttrPower([cfg.attrs[0]])+ItemConfig.relatePower(cfg.attrs[0],role);power+=temp}}if(soulLv>0){var demon=GlobalConfig.ReincarnationDemonLevel[subType][soulLv];var soulAttrDesc=void 0;var per=demon.precent/100;per+=100;soulAttrDesc=per+"%";this.soulAttr.text=soulAttrDesc}}return power};SamsaraEquipTips.prototype.closeWin=function(){ViewManager.ins().close(this)};return SamsaraEquipTips}(BaseEuiView);__reflect(SamsaraEquipTips.prototype,"SamsaraEquipTips");ViewManager.ins().reg(SamsaraEquipTips,LayerManager.UI_Popup);var SamsaraPanel=function(_super){__extends(SamsaraPanel,_super);function SamsaraPanel(){return _super!==null&&_super.apply(this,arguments)||this}SamsaraPanel.prototype.childrenCreated=function(){this.init()};SamsaraPanel.prototype.init=function(){this.lvImgAry=[this.lv0,this.lv1,this.lv2,this.lv3,this.lv4,this.lv5];this.effectContainerAry=[this.eff0,this.eff1,this.eff2,this.eff3,this.eff4,this.eff5];for(var i in this.effectContainerAry){var effect=new MovieClip;effect.playFile(RES_DIR_EFF+"reincarnation_fire",-1);effect.scaleX=2;effect.scaleY=2;effect.x=effect.x+25;effect.y=effect.y+20;this.effectContainerAry[i].addChild(effect)}this.ballEffect=new MovieClip;this.ballEffect.playFile(RES_DIR_EFF+"reincarnation_ball",-1);this.ball.addChild(this.ballEffect);this.labelEffect=new MovieClip;this.labelEffect.scaleX=.7;this.labelEffect.scaleY=.5;this.labelEffect.touchEnabled=false;this.redPoint.visible=false;this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getItemTxt.text+"</u></a>")};SamsaraPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.getItemTxt,this.getItem);this.addTouchEvent(this.upBtn,this.upgrade);this.observe(SamsaraCC.ins().postSamsaraInfo,this.updateView);this.updateView();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.liuDao)};SamsaraPanel.prototype.upgrade=function(){if(this.isExpEnough){SamsaraCC.ins().upgradeSamsaraLv()}else{UserTips.ins().showTips(i18n("SamsaraPanel_0"))}};SamsaraPanel.prototype.getItem=function(){ViewManager.ins().open(GetSamsaraExpPanel)};SamsaraPanel.prototype.getValue=function(attrs,typeValue){var obj=CommonUtils.getObjectByAttr(attrs,"type",typeValue);return obj.value.toString()};SamsaraPanel.prototype.updateView=function(){var mode=SamsaraModel.ins().samsaraInfo;var lv=mode.lv;var cfg=GlobalConfig.ReincarnationLevel[lv];var attrDesc=AttributeData.getAttStr(cfg.attrs,0,1,"  :  ");this.attr1.text=attrDesc;var power=UserBag.getAttrPower(cfg.attrs)*3;this.powerPanel1.setPower(power);var percent;var nextLv=lv+1;var isMax=nextLv>=CommonUtils.getObjectLength(GlobalConfig.ReincarnationLevel);if(isMax){this.powerPanel0.setPower(power);this.attr0.text=attrDesc;this.yeliValue.text=i18n("SamsaraPanel_1");percent=1}else{var nextCfg=GlobalConfig.ReincarnationLevel[nextLv];var nextPower=UserBag.getAttrPower(nextCfg.attrs)*3;this.powerPanel2.setPower(nextPower);attrDesc=AttributeData.getAttStr(nextCfg.attrs,0,1,"  :  ");this.attr2.text=attrDesc;var colorStr=void 0;var exp=mode.exp;var needExp=nextCfg.consume;if(exp>=needExp){colorStr=ColorUtil.GREEN_COLOR;this.isExpEnough=true}else{colorStr=ColorUtil.RED_COLOR;this.isExpEnough=false}this.yeliValue.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+exp+'</font><font color="#fef2ad">/'+needExp+"</font> ");percent=exp/needExp}this.setMaxSamsaraState(isMax);if(SamsaraModel.ins().isCanExchange()){this.addLabelEffect()}else{this.removeLabelEffect()}var lv1=SamsaraModel.ins().getSamsara(Actor.samsaraLv);var lv2=SamsaraModel.ins().getSamsaraLv(Actor.samsaraLv);var desc=SamsaraModel.ins().getSamsaraDesc(lv1)+"·"+SamsaraModel.ins().getSamsaraLvDesc(lv2);this.lunhuiLv.text=desc;this.setLvImgState(lv2);this.maskImage(percent);this.redPoint.visible=this.upBtn.visible&&SamsaraModel.ins().isCanUpgrade()};SamsaraPanel.prototype.setMaxSamsaraState=function(isMax){this.attrGroup0.visible=isMax;this["arrow"].visible=!isMax;this.attrGroup1.visible=!isMax;this.attrGroup2.visible=!isMax;this.upBtn.visible=!isMax;this.getItemTxt.visible=!isMax;this.maxLevel.visible=isMax};SamsaraPanel.prototype.setLvImgState=function(samsaraLv){for(var i in this.lvImgAry){this.lvImgAry[i].visible=false;this.effectContainerAry[i].visible=false}for(var i=0;i<=samsaraLv;i++){this.lvImgAry[i].visible=true;this.effectContainerAry[i].visible=true}};SamsaraPanel.prototype.addLabelEffect=function(){var _this=this;TimerManager.ins().doNext(function(){DisplayUtils.removeFromParent(_this.labelEffect);_this.labelEffect.x=_this.getItemTxt.x+_this.getItemTxt.width/2;_this.labelEffect.y=_this.getItemTxt.y+_this.getItemTxt.height/2;if(_this.labelEffect.parent==null){_this.getItemTxt.parent.addChild(_this.labelEffect)}_this.labelEffect.playFile(RES_DIR_EFF+"chargeff1",-1)},this)};SamsaraPanel.prototype.maskImage=function(percent){if(percent>=1){DisplayUtils.removeFromParent(this.masksp);this.masksp=null;return}var imgHeight=103;if(!this.masksp){this.masksp=new egret.Sprite;var square=new egret.Shape;square.graphics.beginFill(16776960);square.graphics.drawRect(this.ball.x-60,this.ball.y-45,120,imgHeight);square.graphics.endFill();this.masksp.addChild(square);this.ball.parent.addChild(this.masksp);this.ball.mask=this.masksp}this.masksp.y=imgHeight*(1-percent)};SamsaraPanel.prototype.removeLabelEffect=function(){this.labelEffect.stop();DisplayUtils.removeFromParent(this.labelEffect)};SamsaraPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};return SamsaraPanel}(BaseView);__reflect(SamsaraPanel.prototype,"SamsaraPanel");var SamsaraSoulWin=function(_super){__extends(SamsaraSoulWin,_super);function SamsaraSoulWin(){var _this=_super.call(this)||this;_this.skinName="ReincarnateSoulSkin";_this.isTopLevel=true;return _this}SamsaraSoulWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(UserEquip.ins().postAddSoul,this.updateView);this.addTouchEvent(this.soulBtn,this.addSoul);this.addTouchEvent(this.closeBtn,this.closeWin);this.roleIndex=param[0];this.subType=param[1];this.updateView()};SamsaraSoulWin.prototype.closeWin=function(){ViewManager.ins().close(this)};SamsaraSoulWin.prototype.addSoul=function(){UserEquip.ins().requestAddSoul(this.roleIndex,this.subType)};SamsaraSoulWin.prototype.updateView=function(){var role=SubRoles.ins().getSubRoleByIndex(this.roleIndex);var data=role.getEquipByIndex(this.subType);this.itemId=data.item.itemConfig.id;var mainEquip=role.getEquipByIndex(this.subType);this.soulLv=mainEquip.soulLv;this.soulLinkLv=SamsaraModel.ins().getSoulLinkLv(role,this.subType,mainEquip.soulLv);var itemCfg=GlobalConfig.ItemConfig[this.itemId];var subType=ItemConfig.getSubType(itemCfg);var job=ItemConfig.getJob(itemCfg);var maxLv=SamsaraModel.ins().getSoulMaxLevel();var isSoulMax=this.soulLv==maxLv;var isChainMax=this.soulLinkLv==maxLv;this.nextSoulTextGroup.visible=!(this.soulLv==0||isSoulMax);this.nextChainTextGroup.visible=!(this.soulLinkLv==0||isChainMax);if(this.nextChainTextGroup.visible){var tempCfg=SamsaraModel.ins().getReincarnationLinkLevel(subType,this.soulLinkLv+1);this.nextChain0.text=tempCfg.attrs[0].value/100+"%"}if(this.nextSoulTextGroup.visible){var tempCfg=GlobalConfig.ReincarnationDemonLevel[subType][this.soulLv+1];this.nextChain1.text=100+tempCfg.precent/100+"%"}var showSoulLinkLv=0;if(this.soulLinkLv==0){showSoulLinkLv=1}else{showSoulLinkLv=this.soulLinkLv}var showSoulLv=0;if(this.soulLv==0){showSoulLv=1}else{showSoulLv=this.soulLv}var cfg=SamsaraModel.ins().getReincarnationLinkLevel(subType,showSoulLinkLv);this.chainPos.text=i18n("SamsaraSoulWin_0",Role.getEquipNameByType(cfg.secondSlot));this.chainAttr.text=SamsaraModel.ins().getSoulLinkDesc(cfg.attrs[0].type);this.chainState.text=i18n("SamsaraSoulWin_1");this.chainValue.text=cfg.attrs[0].value/100+"%";var demon=GlobalConfig.ReincarnationDemonLevel[subType][showSoulLv];var soulAttrDesc;var per=demon.precent/100;per+=100;soulAttrDesc=per+"%";this.soulAttr.text=soulAttrDesc;var soulCfg=GlobalConfig.ReincarnationSoulLevel[job][subType][showSoulLv];var attrDesc=AttributeData.getAttStr(soulCfg.attrs,0,1,"  :  ");var power=UserBag.getAttrPower(soulCfg.attrs);power+=this.getChainAddPower(this.soulLinkLv);power+=this.getSoulAddPower(data,this.soulLv);if(!isSoulMax)this.powerPanel0.setPower(power);if(this.soulLv==0){this.attr0.text=i18n("SamsaraSoulWin_3");this.powerPanel0.setPower(0)}else{this.attr0.text=attrDesc}var nextSoulCfg;if(isSoulMax){this.attrGroup0.visible=false;this.attrGroup1.visible=false;this.attrGroup3.visible=true;this.attr3.text=attrDesc;this.powerPanel3.setPower(power)}else{this.attrGroup0.visible=true;this.attrGroup1.visible=true;this.attrGroup3.visible=false;nextSoulCfg=GlobalConfig.ReincarnationSoulLevel[job][subType][this.soulLv+1];var attrDesc1=AttributeData.getAttStr(nextSoulCfg.attrs,0,1,"  :  ");this.attr1.text=attrDesc1;var nextPower=UserBag.getAttrPower(nextSoulCfg.attrs);nextPower+=this.getChainAddPower(this.soulLinkLv+1);nextPower+=this.getSoulAddPower(data,this.soulLv+1);this.powerPanel1.setPower(nextPower)}var level=i18n("Level_0");this.chainLv0.text=""+showSoulLinkLv+level;this.soulLvText.text=""+showSoulLv+level;var materialId=soulCfg.materialInfo.id;var count=UserBag.ins().getBagGoodsCountById(0,materialId);var isCanAdd=false;if(nextSoulCfg)isCanAdd=count>=nextSoulCfg.materialInfo.count;this.materialLabel.text=GlobalConfig.ItemConfig[materialId].name;this.costImg.source=GlobalConfig.ItemConfig[materialId].icon+"_png";this.num.text=count.toString();if(nextSoulCfg){this.needNum.text="/"+nextSoulCfg.materialInfo.count.toString()}else{this.needNum.text="/0"}this.soulBtn.enabled=isCanAdd&&!isSoulMax;if(isCanAdd){this.num.textColor=ColorUtil.GREEN_COLOR_N}else{this.num.textColor=ColorUtil.RED_COLOR_N}this.redPoint.visible=isCanAdd&&!isSoulMax;this.arrow0.visible=!isSoulMax;this.rein_title.source="rein_demon_soul_"+job+subType};SamsaraSoulWin.prototype.getChainAddPower=function(soulLinkLv){if(soulLinkLv==0)return 0;var cfg=SamsaraModel.ins().getReincarnationLinkLevel(this.subType,soulLinkLv);var role=SubRoles.ins().getSubRoleByIndex(this.roleIndex);var temp=UserBag.getAttrPower([cfg.attrs[0]])+ItemConfig.relatePower(cfg.attrs[0],role);return temp>>0};SamsaraSoulWin.prototype.getSoulAddPower=function(equipData,soulLv){if(soulLv==0)return 0;var cfg=GlobalConfig.ReincarnationDemonLevel[this.subType][soulLv];var percent=cfg.precent/1e4;var baseAttrs=ItemConfig.getBaseAttrData(equipData.item.itemConfig);return UserBag.getAttrPower(baseAttrs)*percent>>0};SamsaraSoulWin.prototype.getValue=function(attrs,typeValue){var obj=CommonUtils.getObjectByAttr(attrs,"type",typeValue);return obj.value.toString()};return SamsaraSoulWin}(BaseEuiView);__reflect(SamsaraSoulWin.prototype,"SamsaraSoulWin");ViewManager.ins().reg(SamsaraSoulWin,LayerManager.UI_Main);var SamsaraComposeItem=function(_super){__extends(SamsaraComposeItem,_super);function SamsaraComposeItem(){return _super!==null&&_super.apply(this,arguments)||this}SamsaraComposeItem.prototype.childrenCreated=function(){this.compose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this.compose1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)};SamsaraComposeItem.prototype.dataChanged=function(){var item=this.data;if(item){var cfg=void 0;var id=void 0,count=void 0;if(item.type==MergeType.SamsareEquip){cfg=GlobalConfig.ReincarnateEquipCompose[item.id];id=cfg.material.id;count=cfg.material.count;this.currentState="state1"}else if(item.type==MergeType.ZhanlingEquip){cfg=GlobalConfig.ZhanLingEquip[item.id];id=cfg.mat[0].id;count=cfg.mat[0].count;this.currentState="state1"}else if(item.type==MergeType.Rune){this.currentState="state2";this.setState2Info(item.type,item.id);return}this.need.showName=true;this.need.data=id;this.num.text=count.toString();this.target.showName=true;this.target.data=item.id;var isCan=MergeCC.ins().isCanMergeTargetId(item.type,item.id);this.redPoint.visible=isCan;if(isCan){this.content.filters=null}else{this.content.filters=FilterUtil.ARRAY_GRAY_FILTER}}};SamsaraComposeItem.prototype.onTouch=function(){if(this.redPoint.visible){var item=this.data;var cfg=void 0;if(item.type==MergeType.SamsareEquip){cfg=GlobalConfig.ReincarnateEquipCompose[item.id];var roleIndex=SamsaraModel.ins().getRoleIndexByEquip(cfg.material.id);SamsaraCC.ins().requestCompose(item.id,roleIndex)}else if(item.type==MergeType.ZhanlingEquip){ZhanLing.ins().sendZhanLingComposeItem(item.id)}}else if(this.redPoint1.visible){if(this.data.type==MergeType.Rune){this.mergeConfirm()}}else{UserTips.ins().showTips(i18n("SamsaraComposeItem_0"))}};SamsaraComposeItem.prototype.getRuneName=function(mat,mat_type){var data=new ItemData;data.configID=mat.id;var str=data.itemConfig.name;var lv=Rune.ins().getRuneLevel(mat.id);if(mat_type==Rune.NEED_DELETE){var roleid=mat.roleid;var role=SubRoles.ins().getSubRoleByIndex(roleid);var jobName=Role.getJobNameByJob(role.job);str+="（"+lv+i18n("SamsaraComposeItem_1")+jobName+i18n("SamsaraComposeItem_2")}else{str+="（"+lv+i18n("SamsaraComposeItem_3")+i18n("SamsaraComposeItem_4")}if(ItemConfig.getQualityColor(data.itemConfig)==15203915)str="<font color="+14502316+">"+str+"</font>";else str="<font color="+ItemConfig.getQualityColor(data.itemConfig)+">"+str+"</font>";return str};SamsaraComposeItem.prototype.getGain=function(mat,mat_type){var gain=0;var data=new ItemData;data.configID=mat.id;if(mat_type==Rune.NEED_DECOM||Rune.ins().getRuneLevel(mat.id)>1){var rbc=RuneConfigMgr.ins().getBaseCfg(data);if(rbc){gain+=rbc.gain}}return gain};SamsaraComposeItem.prototype.mergeConfirm=function(){var self=this;var str=i18n("SamsaraComposeItem_5");var str1="";var str2="";var str3="";var str4="";var res=Rune.ins().isRuneCanMergeByIDNew(this.target1.itemConfig.id);if(res.type){var mat1=res.mat1;var mat2=res.mat2;var mat1_type=res.mat1_type;var mat2_type=res.mat2_type;str1=this.getRuneName(mat1,mat1_type);str2=this.getRuneName(mat2,mat2_type);str3=this.target1.itemConfig.name+i18n("SamsaraComposeItem_6");if(ItemConfig.getQualityColor(this.target1.itemConfig)==15203915)str3="<font color="+14502316+">"+str3+"</font>";else str3="<font color="+ItemConfig.getQualityColor(this.target1.itemConfig)+">"+str3+"</font>";var gainNum=this.getGain(mat1,mat1_type)+this.getGain(mat2,mat2_type);str4=gainNum.toString();if(gainNum>0){str=i18n("SamsaraComposeItem_7")+str1+i18n("SamsaraComposeItem_8")+str2+i18n("SamsaraComposeItem_9")+str3+i18n("SamsaraComposeItem_10")+str4+i18n("SamsaraComposeItem_11")}else{str=i18n("SamsaraComposeItem_12")+str1+i18n("SamsaraComposeItem_13")+str2+i18n("SamsaraComposeItem_14")+str3+"？"}}WarnWin.show(str,function(){self.runeMerge()},this)};SamsaraComposeItem.prototype.runeMerge=function(){var res=Rune.ins().isRuneCanMergeByIDNew(this.target1.itemConfig.id);if(res.type){var mat1=res.mat1;var mat2=res.mat2;var mat1_type=res.mat1_type;var mat2_type=res.mat2_type;var tempTime=0;var self=this;var data1=new ItemData;data1.configID=mat1.id;var data2=new ItemData;data2.configID=mat2.id;var delay=10;if(mat1_type==Rune.NEED_DELETE){tempTime=delay;Rune.ins().sendDelRune(mat1.roleid,mat1.posid)}if(mat2_type==Rune.NEED_DELETE){tempTime=delay;Rune.ins().sendDelRune(mat2.roleid,mat2.posid)}setTimeout(function(){Rune.ins().sendRuneMerge(self.data.id)},tempTime)}else{console.log("SamsaraComposeItem.ts L90 res.type == Rune.CAN_NOT_MERGE!")}};SamsaraComposeItem.prototype.setState2Info=function(type,id){this.redPoint.visible=false;this.need0.showName=true;this.need1.showName=true;this.need2.showName=true;this.target1.showName=true;if(type==MergeType.Rune){var conf=GlobalConfig.RuneComposeConfig[id];var goldItemId=GlobalConfig.RuneOtherConfig.goldItemId;this.need0.data=conf.material[0];this.need1.data=conf.material[1];this.need2.num=conf.count;this.need2.data=goldItemId;this.target1.data=conf.id;var ins=UserBag.ins()}var isCan=MergeCC.ins().isCanMergeTargetId(type,id);this.redPoint1.visible=isCan;this.compose1.enabled=isCan};SamsaraComposeItem.prototype.onRemove=function(e){if(this.content)this.content.filters=null};return SamsaraComposeItem}(BaseItemRender);__reflect(SamsaraComposeItem.prototype,"SamsaraComposeItem");var SamsaraComposeMenuItem=function(_super){__extends(SamsaraComposeMenuItem,_super);function SamsaraComposeMenuItem(){return _super.call(this)||this}SamsaraComposeMenuItem.prototype.childrenCreated=function(){this.list.itemRenderer=SamsaraComposeSecMenuItem;this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this)};SamsaraComposeMenuItem.prototype.onListChange=function(){var data=this.list.selectedItem;var compose=ViewManager.ins().getView(BagWin).reinComposePanel;compose.updateView(data.type,data.zsLv,SamsaraModel.ins().getComposeEquipId(data.type,data.zsLv));compose.unSelectList();this.list.getElementAt(this.list.selectedIndex).setSelect(true)};SamsaraComposeMenuItem.prototype.selectList=function(index){this.list.selectedIndex=index;var item=this.list.getElementAt(this.list.selectedIndex);item.selected=true;item.setSelect(true)};SamsaraComposeMenuItem.prototype.dataChanged=function(){var type=this.data;this.nameLabel.text=i18n("SamsaraComposeMenuItem_0",GlobalConfig.ReincarnationBase.headName[type-1]);this.list.dataProvider=new ArrayCollection(SamsaraModel.ins().getComposeZsList(type));this.redPoint.visible=SamsaraModel.ins().isCanTypeCompose(type);if(type==1){this.rein_equips.source="merge_1"}else{this.rein_equips.source="merge_2"}};return SamsaraComposeMenuItem}(BaseItemRender);__reflect(SamsaraComposeMenuItem.prototype,"SamsaraComposeMenuItem");var SamsaraComposeSecMenuItem=function(_super){__extends(SamsaraComposeSecMenuItem,_super);function SamsaraComposeSecMenuItem(){return _super!==null&&_super.apply(this,arguments)||this}SamsaraComposeSecMenuItem.prototype.dataChanged=function(){var type=this.data["type"];var zsLv=this.data["zsLv"];var desc=SamsaraModel.ins().getComposeDesc(type);this.head.text=desc;this.lv.text=i18n("SamsaraComposeSecMenuItem_0",zsLv);this.redPoint.visible=SamsaraModel.ins().isCanZsLvCompose(type,zsLv);var compose=ViewManager.ins().getView(BagWin).reinComposePanel;if(compose.type==type&&compose.zsLv==zsLv){this.setSelect(true)}};SamsaraComposeSecMenuItem.prototype.setSelect=function(isSelect){this.chosen.visible=isSelect};return SamsaraComposeSecMenuItem}(BaseItemRender);__reflect(SamsaraComposeSecMenuItem.prototype,"SamsaraComposeSecMenuItem");var GameServer=function(_super){__extends(GameServer,_super);function GameServer(){var _this=_super.call(this)||this;_this.sysId=PackageID.Default;_this.regNetMsg(23,_this.postServerOpenDay);_this.regNetMsg(14,_this.doServerTime);return _this}GameServer.ins=function(){return _super.ins.call(this)};Object.defineProperty(GameServer,"serverTime",{get:function(){return GameServer._serverTime+egret.getTimer()},enumerable:true,configurable:true});GameServer.setServerTime=function(t){GameServer._serverTime=DateUtils.formatMiniDateTime(t)-egret.getTimer()};GameServer.prototype.postServerOpenDay=function(bytes){GameServer.serverOpenDay=bytes.readInt();GameServer._serverZeroTime=bytes.readInt();GameServer._serverHeZeroTime=bytes.readInt();GameServer._hefuCount=bytes.readInt();GameServer.isOpenLF=bytes.readBoolean()};GameServer.prototype.doServerTime=function(bytes){GameServer.setServerTime(bytes.readUnsignedInt());this.postServerTime()};GameServer.prototype.postServerTime=function(){};return GameServer}(BaseSystem);__reflect(GameServer.prototype,"GameServer");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.gameServer=GameServer.ins.bind(GameServer)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var changeheadWin=function(_super){__extends(changeheadWin,_super);function changeheadWin(){var _this=_super.call(this)||this;_this.skinName="changeheadSkin";_this.isPlayOpenSound=true;_this.headlist.itemRenderer=setheadItemRender;_this.kuanglist.itemRenderer=setkuangItemRender;return _this}changeheadWin.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.btnhead,this.onTouch);this.addTouchEvent(this.btnkuang,this.onTouch);this.initHeadUI()};changeheadWin.prototype.onTouch=function(e){var tar=e.currentTarget;if(tar==this.bgClose||tar==this.closeBtn){ViewManager.ins().close(this)}else if(tar==this.btnhead){this.initHeadUI()}else if(tar==this.btnkuang){this.initKuangUI()}};changeheadWin.prototype.initHeadUI=function(){this.btnhead.currentState="down";this.btnkuang.currentState="up";this.head.visible=true;this.kuang.visible=false;var datalist=[];for(var i=0;i<12;i++){datalist.push("yuanhead10")}this.headlist.dataProvider=new eui.ArrayCollection(datalist)};changeheadWin.prototype.initKuangUI=function(){this.btnhead.currentState="up";this.btnkuang.currentState="down";this.head.visible=false;this.kuang.visible=true;var datalist=[];for(var i=0;i<12;i++){datalist.push("yuanhead21")}this.kuanglist.dataProvider=new eui.ArrayCollection(datalist)};return changeheadWin}(BaseEuiView);__reflect(changeheadWin.prototype,"changeheadWin");ViewManager.ins().reg(changeheadWin,LayerManager.UI_Popup);var setheadItemRender=function(_super){__extends(setheadItemRender,_super);function setheadItemRender(){var _this=_super.call(this)||this;_this.touchEnabled=true;_this.skinName="setheaditemskin";return _this}setheadItemRender.prototype.dataChanged=function(){if(this.data){this.roleHead.source=this.data+"_png"}};setheadItemRender.prototype.getImgSource=function(source){for(var i=0;i<Object.keys(GlobalConfig.SmallExpressionConf).length;i++){var item=GlobalConfig.SmallExpressionConf[i+1];if(item.source==source)return item.expressionStr}return""};return setheadItemRender}(BaseItemRender);__reflect(setheadItemRender.prototype,"setheadItemRender");var setkuangItemRender=function(_super){__extends(setkuangItemRender,_super);function setkuangItemRender(){var _this=_super.call(this)||this;_this.touchEnabled=true;_this.skinName="setkuangitemskin";return _this}setkuangItemRender.prototype.dataChanged=function(){if(this.data){this.roleHead.source=this.data+"_png"}};return setkuangItemRender}(BaseItemRender);__reflect(setkuangItemRender.prototype,"setkuangItemRender");var UTFMsgByJson=function(_super){__extends(UTFMsgByJson,_super);function UTFMsgByJson(){return _super.call(this)||this}UTFMsgByJson.prototype.decode=function(msg){return JSON.parse(msg)};UTFMsgByJson.prototype.encode=function(msg){return JSON.stringify(msg)};return UTFMsgByJson}(UTFMsg);__reflect(UTFMsgByJson.prototype,"UTFMsgByJson");var SettingView=function(_super){__extends(SettingView,_super);function SettingView(){var _this=_super.call(this)||this;_this.skinName="settingskin";_this.isPlayOpenSound=true;return _this}SettingView.prototype.open=function(){this.addTouchEvent(this.cbSound,this.onTouch);this.addTouchEvent(this.cbShake,this.onTouch);this.addTouchEvent(this.cbShowSword,this.onTouch);this.addTouchEvent(this.cbShowSkillEff,this.onTouch);this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.btnCopy,this.onTouch);this.addTouchEvent(this.cbShowDanmu,this.onTouch);this.addTouchEvent(this.cbShowDanmu1,this.onTouch);this.addTouchEvent(this.btnchangeFace,this.onTouch);this.addTouchEvent(this.loginoutBtn,this.onLoginout);this.btnchangeFace.visible=false;this.cbSound.selected=SysSetting.ins().getBool(SysSetting.SOUND_EFFECT);this.cbShake.selected=SysSetting.ins().getBool(SysSetting.SHAKE_WIN);this.cbShowSword.selected=SysSetting.ins().getBool(SysSetting.SHOW_SWORD);this.cbShowSkillEff.selected=SysSetting.ins().getBool(SysSetting.SHOW_SKILL_EFF);this.cbShowDanmu.selected=SysSetting.ins().getBool(SysSetting.SHOW_DANMU);this.cbShowDanmu1.selected=SysSetting.ins().getBool(SysSetting.SHOW_DANMU_TEAM);this.id.text=i18n("SettingView_0")+Actor.actorID;if(ChannelMgr.ins().isChuDongChannel()){this.openid.visible=true;this.openid.text="OpenID: "+window["OPEN_DATA"].openid}else{this.openid.visible=false;this.openid.text=""}this.initShow();this.inviteGroup.visible=false;this.updateInviteInfo();this.observe(Invite.ins().postInviteInfo,this.updateInviteInfo);this.isshowLoginoutBtn()};SettingView.prototype.initShow=function(){var roleData=SubRoles.ins().getSubRoleByIndex(0);this.face.source="yuanhead"+roleData.job+roleData.sex;this.txtrolename.text=Actor.myName;this.txtpower.text=Actor.power+"";if(roleData.guildName)this.txtguild.text=roleData.guildName;else this.txtguild.text=""};SettingView.prototype.isshowLoginoutBtn=function(){this.loginoutBtn.visible=false;if(ChannelMgr.ins().isYYB()){this.loginoutBtn.visible=true}if(ChannelMgr.ins().isJuHeAppChannel()){this.loginoutBtn.visible=true;this.loginoutBtn.label="切换账号"}};SettingView.prototype.onLoginout=function(){channelLogout()};SettingView.prototype.updateInviteInfo=function(){if(Invite.ins().is_inviter==1&&Invite.ins().invite_id){this.mainGroup.height=509;this.addTouchEvent(this.btnCopy1,this.onTouch);this.inviteIdTxt.text=i18n("SettingView_1")+Invite.ins().invite_id;this.inviteGroup.visible=true}else{this.mainGroup.height=509;this.removeTouchEvent(this.btnCopy1,this.onTouch);this.inviteGroup.visible=false}};SettingView.prototype.onTouch=function(e){var tar=e.currentTarget;if(tar==this.cbSound){SysSetting.ins().setBool(SysSetting.SOUND_EFFECT,tar.selected)}else if(tar==this.cbShake){SysSetting.ins().setBool(SysSetting.SHAKE_WIN,tar.selected)}else if(tar==this.cbShowSword){SysSetting.ins().setBool(SysSetting.SHOW_SWORD,tar.selected);for(var i=0;i<SubRoles.ins().subRolesLen;i++){var myChar=EntityManager.ins().getMainRole(i);if(myChar){myChar.playBody(null)}}}else if(tar==this.cbShowSkillEff){SysSetting.ins().setBool(SysSetting.SHOW_SKILL_EFF,tar.selected)}else if(tar==this.bgClose||tar==this.closeBtn){ViewManager.ins().close(this)}else if(tar==this.btnCopy){copyToClipboard(Actor.actorID.toString())}else if(tar==this.btnCopy1){if(Invite.ins().is_inviter==1&&Invite.ins().invite_id){copyToClipboard(Invite.ins().invite_id)}}else if(tar==this.cbShowDanmu){SysSetting.ins().setBool(SysSetting.SHOW_DANMU,tar.selected)}else if(tar==this.cbShowDanmu1){SysSetting.ins().setBool(SysSetting.SHOW_DANMU_TEAM,tar.selected)}else if(tar==this.btnchangeFace){ViewManager.ins().open(changeheadWin)}};return SettingView}(BaseEuiView);__reflect(SettingView.prototype,"SettingView");ViewManager.ins().reg(SettingView,LayerManager.UI_Popup);var SysSetting=function(_super){__extends(SysSetting,_super);function SysSetting(){var _this=_super.call(this)||this;_this._storage={};_this._tempStorage={};_this.defaultValue={sound_effect:1,shake_win:1,auto_heji:1,show_sword:1,show_skill_eff:1,dice:0,show_danmu:1,show_danmu_team:1};_this.init();return _this}SysSetting.ins=function(){return _super.ins.call(this)};SysSetting.prototype.setItem=function(key,value){if(this._storage[key]!=value){this._storage[key]=value;if(key==SysSetting.SOUND_EFFECT){SoundManager.ins().setEffectOn(this.getBool(key));SoundManager.ins().setBgOn(this.getBool(key))}else if(key==SysSetting.SHAKE_WIN){DisplayUtils.setShakeOn(this.getBool(key))}else if(key==SysSetting.DICE){Millionaire.ins().autoTurnDice=value}if(!TimerManager.ins().isExists(this.storage,this)){TimerManager.ins().doNext(this.storage,this)}}else{if(key==SysSetting.DICE){Millionaire.ins().autoTurnDice=value}}};SysSetting.prototype.getItem=function(key){return this._storage[key]};SysSetting.prototype.setBool=function(key,b){this.setItem(key,b?1:0)};SysSetting.prototype.getBool=function(key){return!!this.getItem(key)};SysSetting.prototype.setValue=function(key,value){this._tempStorage[key]=value};SysSetting.prototype.getValue=function(key){return this._tempStorage[key]};SysSetting.prototype.init=function(){var __this=this;LoginMgr.getItem(__this.getStorageKey(),function(str){try{if(str){var jsonData=str;if(typeof str=="string"){jsonData=JSON.parse(str)}__this._storage=jsonData||{}}else{__this._storage={}}}catch(e){console.log(e);__this._storage={}}__this.initValue()})};SysSetting.prototype.initValue=function(){for(var key in this.defaultValue){if(this._storage[key]==undefined){this._storage[key]=this.defaultValue[key]}}SoundManager.ins().setEffectOn(this.getBool(SysSetting.SOUND_EFFECT));SoundManager.ins().setBgOn(this.getBool(SysSetting.SOUND_EFFECT));DisplayUtils.setShakeOn(this.getBool(SysSetting.SHAKE_WIN))};SysSetting.prototype.storage=function(){try{var str=JSON.stringify(this._storage);LoginMgr.setItem(this.getStorageKey(),str)}catch(e){}};SysSetting.prototype.getStorageKey=function(){return Actor.actorID+""||"game_longlin"};SysSetting.ONLINE_FRIEND="online_friend";SysSetting.OPPOSITE_SEX_FRIEND="opposite_sex_friend";SysSetting.SOUND_EFFECT="sound_effect";SysSetting.SHAKE_WIN="shake_win";SysSetting.AUTO_HEJI="auto_heji";SysSetting.SHOW_SWORD="show_sword";SysSetting.SHOW_SKILL_EFF="show_skill_eff";SysSetting.DICE="dice";SysSetting.SHOW_DANMU="show_danmu";SysSetting.SHOW_DANMU_TEAM="show_danmu_team";SysSetting.ROLL_MAP_AUTO="roll_map_auto";SysSetting.BATTLE_GROUND_AUTO="battle_ground_auto";SysSetting.SPRING_ACT_WIN="spring_act_win";return SysSetting}(BaseClass);__reflect(SysSetting.prototype,"SysSetting");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.syssetting=SysSetting.ins.bind(Setting)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SevenDayIconBase=function(_super){__extends(SevenDayIconBase,_super);function SevenDayIconBase(){return _super!==null&&_super.apply(this,arguments)||this}SevenDayIconBase.prototype.showDetail=function(){};SevenDayIconBase.prototype.onClick=function(){};return SevenDayIconBase}(ItemBase);__reflect(SevenDayIconBase.prototype,"SevenDayIconBase");var RES_RESOURCE="resource";window["RES_RESOURCE"]=RES_RESOURCE;var RES_DIR="resource/res";window["RES_DIR"]=RES_DIR;var MAP_DIR="resource/map";window["MAP_DIR"]=MAP_DIR;var RES_DIR_BLOOD=RES_DIR+"/blood/";window["RES_DIR_BLOOD"]=RES_DIR_BLOOD;var RES_DIR_BODY=RES_DIR+"/body/";window["RES_DIR_BODY"]=RES_DIR_BODY;var RES_DIR_EFF=RES_DIR+"/eff/";window["RES_DIR_EFF"]=RES_DIR_EFF;var RES_DIR_SQ=RES_DIR+"/sq/";window["RES_DIR_SQ"]=RES_DIR_SQ;var RES_DIR_ROLE=RES_DIR+"/role/";window["RES_DIR_ROLE"]=RES_DIR_ROLE;var RES_DIR_STORY=RES_DIR+"/story/";window["RES_DIR_STORY"]=RES_DIR_STORY;var RES_DIR_ITEM=RES_DIR+"/item/";window["RES_DIR_ITEM"]=RES_DIR_ITEM;var RES_DIR_MONSTER=RES_DIR+"/monster/";window["RES_DIR_MONSTER"]=RES_DIR_MONSTER;var RES_DIR_SKILL=RES_DIR+"/skill/";window["RES_DIR_SKILL"]=RES_DIR_SKILL;var RES_DIR_SKILLEFF=RES_DIR+"/skilleff/";window["RES_DIR_SKILLEFF"]=RES_DIR_SKILLEFF;var RES_DIR_WARSPIRIT=RES_DIR+"/warspirit/";window["RES_DIR_WARSPIRIT"]=RES_DIR_WARSPIRIT;var RES_DIR_WEAPON=RES_DIR+"/weapon/";window["RES_DIR_WEAPON"]=RES_DIR_WEAPON;var RES_DIR_WING=RES_DIR+"/wing/";window["RES_DIR_WING"]=RES_DIR_WING;var RES_DIR_CITY=RES_DIR+"/city/";window["RES_DIR_CITY"]=RES_DIR_CITY;var RES_DIR_XIANYUEFFECT=RES_DIR+"/xianyueff/";window["RES_DIR_XIANYUEFFECT"]=RES_DIR_XIANYUEFFECT;var RES_DIR_FLYSWORD=RES_DIR+"/feijian/";window["RES_DIR_FLYSWORD"]=RES_DIR_FLYSWORD;var RES_DIR_EXPRESSION=RES_DIR+"/expression/";window["RES_DIR_EXPRESSION"]=RES_DIR_EXPRESSION;var SevenDayLogItem=function(_super){__extends(SevenDayLogItem,_super);function SevenDayLogItem(){var _this=_super.call(this)||this;_this.day=0;_this.state=0;_this.skinName="SevenDayLogItemSkin";_this.awardsList.itemRenderer=ItemBase;return _this}Object.defineProperty(SevenDayLogItem,"ChineseNum",{get:function(){var _ChineseNum=this._ChineseNum;if(_ChineseNum==null){_ChineseNum=[i18n("SevenDayLogItem_0"),i18n("SevenDayLogItem_1"),i18n("SevenDayLogItem_2"),i18n("SevenDayLogItem_3"),i18n("SevenDayLogItem_4"),i18n("SevenDayLogItem_5"),i18n("SevenDayLogItem_6"),i18n("SevenDayLogItem_7"),i18n("SevenDayLogItem_8"),i18n("SevenDayLogItem_9")];this._ChineseNum=_ChineseNum}return _ChineseNum},enumerable:true,configurable:true});SevenDayLogItem.prototype.dataChanged=function(){var data=this.data;if(data){this.day=data.day;this.dayTxt.text=i18n("SevenDayLogItem_10")+SevenDayLogItem.ChineseNum[this.day]+i18n("SevenDayLogItem_11");if(Activity.ins().dayNum>=this.day){if(this.getRemindByIndex(this.day)){this.sureBtn.visible=false;this.sureImg.visible=true}else{this.sureBtn.visible=true;this.sureImg.visible=false}}else{this.sureBtn.visible=false;this.sureImg.visible=false}var arr=[];for(var i=0;i<data.rewards.length;i++){var reward=data.rewards[i];if(reward.job){var role=SubRoles.ins().getSubRoleByIndex(0);var mjob=role.job;if(mjob==reward.job){arr.push(reward)}}else{arr.push(reward)}}this.awardsList.dataProvider=new eui.ArrayCollection(arr)}};SevenDayLogItem.prototype.getRemindByIndex=function(index){return(Activity.ins().isAwards>>index&1)==1};return SevenDayLogItem}(BaseItemRender);__reflect(SevenDayLogItem.prototype,"SevenDayLogItem");var SevenDayLogWin=function(_super){__extends(SevenDayLogWin,_super);function SevenDayLogWin(){var _this=_super.call(this)||this;_this.itemary=[];_this.dayindex=0;_this.itemList=[];_this.skinName="act14logSkin";_this.itemary=[];_this.itemList=[];for(var i=0;i<14;i++){_this.itemList[i]=_this["dayNum"+(i+1)];_this.itemList[i].touchEnabled=false}return _this}SevenDayLogWin.prototype.open=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.suerBtn,this.onTouch);for(var i=0;i<14;i++){this.addTouchEvent(this.itemList[i],this.itemTouch)}this.observe(Activity.ins().postSevendayAwardCallback,this.setList);this.observe(Activity.ins().postSevendayIsAwards,this.changeList);this.changeList();this.showRedPoint();var dayNum=param[0];if(dayNum){this.setList(dayNum)}if(this.dayindex>7){TimerManager.ins().doNext(function(){_this.scroller.viewport.scrollV=_this.scroller.viewport.contentHeight-_this.scroller.height},this)}};SevenDayLogWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.suerBtn,this.onTouch);DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<14;i++){this.removeTouchEvent(this.itemList[i],this.itemTouch)}this.removeObserve()};SevenDayLogWin.prototype.changeList=function(){var day=0;var dayNum=Activity.ins().dayNum;if(dayNum>=14)day=13;else day=dayNum;for(var i=1;i<=day;i++){var config=GlobalConfig.LoginRewardsConfig[i];if(config){if(dayNum>=config.day){if((Activity.ins().isAwards>>config.day&1)==0){this.setList(i-1);return}}}}this.setList(day)};SevenDayLogWin.prototype.onTouch=function(e){switch(e.currentTarget){case this.suerBtn:if(Activity.ins().dayNum>=this.day){Activity.ins().sendGetSevenDayAwards(this.day);if(ChannelMgr.ins().isQQSmallGameChannel()&&this.dayindex==13){var env=window["qq"];var openid=ChannelNet.ins().getOpenId();console.log("channel "+ChannelMgr.ins().main_channel+" authorize scope.recentColorSign");env.authorize({scope:"scope.recentColorSign",success:function(res){console.log("channel "+ChannelMgr.ins().main_channel+" addRecentColorSign");env.addRecentColorSign({query:"invitor_open_id="+openid,success:function(res){console.log("channel "+ChannelMgr.ins().main_channel+" addRecentColorSign success: ",res)},fail:function(err){console.log("channel "+ChannelMgr.ins().main_channel+" addRecentColorSign fail: ",err)},complete:function(res){console.log("channel "+ChannelMgr.ins().main_channel+" addRecentColorSign complete: ",res)}})},fail:function(err){console.log("channel "+ChannelMgr.ins().main_channel+" scope.recentColorSign fail: ",err)},complete:function(res){console.log("channel "+ChannelMgr.ins().main_channel+" scope.recentColorSign complete: ",res)}})}}else{UserTips.ins().showTips(i18n("SevenDayLogWin_0"))}break}};SevenDayLogWin.prototype.itemTouch=function(e){this.setList(e.currentTarget.data-1)};SevenDayLogWin.prototype.setList=function(index){if(index===void 0){index=-1}if(index==-1){index=this.dayindex}this.dayindex=index;var list;var len=CommonUtils.getObjectLength(GlobalConfig.LoginRewardsConfig);list=GlobalConfig.LoginRewardsConfig[index+1].rewards;var arr=[];for(var i=0;i<list.length;i++){var reward=list[i];if(reward.job){var mjob=SubRoles.ins().getFirstJob();if(mjob==reward.job){arr.push(reward)}}else{arr.push(reward)}}list=arr;this.day=GlobalConfig.LoginRewardsConfig[index+1].day;var today=0;today=Activity.ins().dayNum;this.daylabel.text=i18n("SevenDayLogWin_1",today);this.daylabel.visible=true;var flag=(Activity.ins().isAwards>>this.day&1)==1;this.dayaward.text=i18n("SevenDayLogWin_2",TextFlowMaker.getCStr(index+1));this.suerBtn.visible=true;if(Activity.ins().dayNum>=this.day){if(!flag){this.btnMC=this.btnMC||new MovieClip;this.btnMC.x=this.suerBtn.width/2;this.btnMC.y=this.suerBtn.height/2-5;this.btnMC.playFile(RES_DIR_EFF+"chargeff1",-1);this.suerBtn.addChild(this.btnMC);this.redPoint.visible=true}else{this.daylabel.visible=false;this.suerBtn.visible=false;this.redPoint.visible=false}}else{DisplayUtils.removeFromParent(this.btnMC);this.suerBtn.visible=false;this.redPoint.visible=false}this.itemary.forEach(function(element){if(element.parent){element.parent.removeChild(element);element=null}});this.itemary=[];for(var i_21=0;i_21<list.length;i_21++){var item=new ItemBase;this.group1.addChild(item);item.data=list[i_21];this.itemary.push(item)}for(var i_22=0;i_22<14;i_22++){this.itemList[i_22].data=i_22+1;if(i_22==index||i_22==13&&index==13){this.itemList[i_22].setSelectImg(true)}else{this.itemList[i_22].setSelectImg(false)}}this.showRedPoint()};SevenDayLogWin.prototype.showRedPoint=function(){};return SevenDayLogWin}(BaseView);__reflect(SevenDayLogWin.prototype,"SevenDayLogWin");var BtnSelectDay=function(_super){__extends(BtnSelectDay,_super);function BtnSelectDay(){var _this=_super.call(this)||this;_this.skinName="BtnSelectDaySkin";return _this}BtnSelectDay.prototype.dataChanged=function(){var day=this.data||1;var isOpen=day-1<=(UserTask.ins().createDays||0);var state=isOpen?this.selected?BtnSelectDay.IS_SELECT:BtnSelectDay.IS_OPEN:BtnSelectDay.IS_LOCK;var redPoint=false;switch(state){case BtnSelectDay.IS_LOCK:this.bg.source="daybg2";this.locked.visible=true;this.touchChildren=this.touchEnabled=false;this.redPoint.visible=false;this.title.textColor=9333676;break;case BtnSelectDay.IS_OPEN:this.bg.source="daybg2";this.locked.visible=false;this.touchChildren=this.touchEnabled=true;this.title.textColor=9333676;this.redPoint.visible=UserTask.ins().hasSevenDayTaskReward(UserTask.SYS_CHENGZHANG,day)||UserTask.ins().hasSevenDayTaskReward(UserTask.SYS_XIANSHI,day);break;case BtnSelectDay.IS_SELECT:this.bg.source="daybg1";this.locked.visible=false;this.touchChildren=this.touchEnabled=true;this.title.textColor=11626786;this.redPoint.visible=UserTask.ins().hasSevenDayTaskReward(UserTask.SYS_CHENGZHANG,day)||UserTask.ins().hasSevenDayTaskReward(UserTask.SYS_XIANSHI,day);break}this.title.text=i18n("BtnSelectDay_0",BtnSelectDay.txt[day])};BtnSelectDay.txt={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七"};BtnSelectDay.IS_LOCK=0;BtnSelectDay.IS_OPEN=1;BtnSelectDay.IS_SELECT=2;return BtnSelectDay}(BaseItemRender);__reflect(BtnSelectDay.prototype,"BtnSelectDay");var BtnSelectType=function(_super){__extends(BtnSelectType,_super);function BtnSelectType(){var _this=_super.call(this)||this;_this.skinName="BtnSelectTypeSkin";return _this}BtnSelectType.prototype.dataChanged=function(){var d=this.data;this.skin.currentState=this.selected?"down":"up";this.labelDisplay.text=d.label;this.tip.visible=d.hasTip;this.redPoint.visible=d.redPoint};return BtnSelectType}(BaseItemRender);__reflect(BtnSelectType.prototype,"BtnSelectType");var SevenDayTaskItem=function(_super){__extends(SevenDayTaskItem,_super);function SevenDayTaskItem(){var _this=_super.call(this)||this;_this.skinName="SevenDayTaskItemSkin";_this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);_this.setMC();return _this}SevenDayTaskItem.prototype.dataChanged=function(){var r=this.data;switch(r.state){case 0:this.checkMask.visible=false;this.checked.visible=false;this.select.visible=false;this.btnGet.visible=false;break;case 1:this.checkMask.visible=false;this.checked.visible=false;this.select.visible=true;this.btnGet.visible=true;break;case 2:this.checkMask.visible=true;this.checked.visible=true;this.select.visible=false;this.btnGet.visible=false;break}this.title.text="第"+r.day+"天";this.item.data=r.config.awardList[0];this.item.showNum(false)};SevenDayTaskItem.prototype.onTap=function(e){var r=this.data;switch(e.currentTarget){case this.btnGet:if(r.state==1){UserTask.ins().getSevenDayTaskReward(r.config.id)}break}};SevenDayTaskItem.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=38;this.mc.y=38;this.mc.width=76;this.mc.height=76;this.mc.scaleX=.5;this.mc.scaleY=1.3;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.select.addChild(this.mc)}};return SevenDayTaskItem}(BaseItemRender);__reflect(SevenDayTaskItem.prototype,"SevenDayTaskItem");var SevenDayTaskItem2=function(_super){__extends(SevenDayTaskItem2,_super);function SevenDayTaskItem2(){var _this=_super.call(this)||this;_this.skinName="SevenDayTaskItem2Skin";_this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);_this.setMC();return _this}SevenDayTaskItem2.prototype.dataChanged=function(){var r=this.data;this.barGroup.visible=false;this.tip.visible=false;switch(r.state){case UserTask.NOT_DO:this.btnGet.enabled=true;this.btnGet.label=i18n("SevenDayTaskItem2_0");this.eff.visible=false;this.barGroup.visible=true;break;case UserTask.CAN_GET:this.btnGet.enabled=true;this.btnGet.label=i18n("SevenDayTaskItem2_1");this.eff.visible=true;this.barGroup.visible=true;break;case UserTask.ALREADY_GET:this.btnGet.enabled=false;this.btnGet.label=i18n("SevenDayTaskItem2_2");this.eff.visible=false;this.barGroup.visible=true;break;case UserTask.NOT_OPEN:this.btnGet.enabled=false;this.btnGet.label=i18n("SevenDayTaskItem2_3");this.eff.visible=false;this.tip.visible=true;this.tip.text=i18n("SevenDayTaskItem2_5",r.openDay||0);break;case UserTask.IS_OVER:this.btnGet.enabled=false;this.btnGet.label=i18n("SevenDayTaskItem2_4");this.eff.visible=false;break}this.title.text=r.config.desc;this.bar.value=r.data.value/r.config.target*100;this.label.textFlow=TextFlowMaker.generateTextFlow("|C:0xFA6D0B&T:"+r.data.value+"|/"+r.config.target);this.activeGroup.visible=r.config.activeValue?true:false;this.activenum.text=r.config.activeValue+"";this.reward.data=r.config.awardList[0]};SevenDayTaskItem2.prototype.onTap=function(e){var r=this.data;switch(e.currentTarget){case this.btnGet:if(r.state==0){if(!r.config.controlTarget)return;ViewManager.ins().close(SevenDayTaskWin);var cls=egret.getDefinitionByName(r.config.controlTarget[0]);if(!cls&&r.config.control){GameGuider.taskGuidance(r.data.id,0)}else{(_a=ViewManager.ins()).open.apply(_a,[cls].concat(r.config.controlTarget.slice(1)))}}else if(r.state==1){UserTask.ins().getSevenDayTaskReward(r.config.id)}break}var _a};SevenDayTaskItem2.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=51;this.mc.y=20;this.mc.width=102;this.mc.height=46;this.mc.scaleX=.66;this.mc.scaleY=.78;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.eff.addChild(this.mc)}};return SevenDayTaskItem2}(BaseItemRender);__reflect(SevenDayTaskItem2.prototype,"SevenDayTaskItem2");var SevenDayTaskWin=function(_super){__extends(SevenDayTaskWin,_super);function SevenDayTaskWin(){var _this=_super.call(this)||this;_this.ui={};_this.curDay=1;_this.sysId=2;_this.isTopLevel=true;_this.initUI();return _this}SevenDayTaskWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="SevenDayTaskWinSkin";this.ui["num1"]=this.num1;this.ui["num2"]=this.num2;this.ui["num3"]=this.num3;this.ui["num4"]=this.num4;this.ui["num5"]=this.num5;this.ui["num6"]=this.num6;this.ui["num7"]=this.num7;this.ui["day1"]=this.day1;this.ui["day2"]=this.day2;this.ui["day3"]=this.day3;this.ui["day4"]=this.day4;this.ui["day5"]=this.day5;this.ui["day6"]=this.day6;this.ui["day7"]=this.day7;this.dayList.itemRenderer=BtnSelectDay;this.dayListData=new eui.ArrayCollection;this.dayList.dataProvider=this.dayListData;this.taskListData=new eui.ArrayCollection;this.taskListData2=new eui.ArrayCollection;this.taskList.itemRenderer=SevenDayTaskItem2;this.taskList.dataProvider=this.taskListData;this.taskList2.itemRenderer=SevenDayTaskItem2;this.taskList2.dataProvider=this.taskListData2;this.typeList.itemRenderer=BtnSelectType;this.typeListData=new eui.ArrayCollection;this.typeList.dataProvider=this.typeListData;this.setRoleMc()};SevenDayTaskWin.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this.curDay=params[0]===undefined?UserTask.ins().createDays:params[0]+1;this.dayList.selectedIndex=this.curDay-1;if(params[1]===undefined){params[1]=1;var f=UserTask.ins().hasSevenDayTaskReward(UserTask.SYS_CHENGZHANG,this.curDay);var s=UserTask.ins().hasSevenDayTaskReward(UserTask.SYS_XIANSHI,this.curDay);params[1]=f&&s||!(f||s)?params[1]:f?0:1}this.sysId=params[1]||0?UserTask.SYS_XIANSHI:UserTask.SYS_CHENGZHANG;this.typeList.selectedIndex=this.sysId-2;this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.help,this.onTap);this.addTouchEvent(this.rectClose,this.onTap);this.addTouchEvent(this.btnInfoClose,this.onTap);this.dayList.addEventListener(egret.Event.CHANGE,this.onTap,this);this.typeList.addEventListener(egret.Event.CHANGE,this.onTap,this);this.observe(UserTask.ins().postSevenDayTasks,this.updateShow);TimerManager.ins().doTimerDelay(1e3,1e3,0,this.updateTimer,this);UserTask.ins().getSevenDayTasks();this.updateShow()};SevenDayTaskWin.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.help,this.onTap);this.removeTouchEvent(this.rectClose,this.onTap);this.removeTouchEvent(this.btnInfoClose,this.onTap);this.dayList.removeEventListener(egret.Event.CHANGE,this.onTap,this);this.typeList.removeEventListener(egret.Event.CHANGE,this.onTap,this);TimerManager.ins().remove(this.updateTimer,this);ViewManager.ins().close(this)};SevenDayTaskWin.prototype.updateShow=function(){this.updateActiveTask();this.updateDayList();this.updateMainTask();this.updateTimer();this.updateTypeBtn()};SevenDayTaskWin.prototype.updateActiveTask=function(){var taskids=GlobalConfig.SystemTaskConfig[UserTask.SYS_HUOYUE][UserTask.ACTIVATE_TYPE_CHUANGJUE][1].task_ids;var max=0;var value=0;for(var k=0;k<taskids.length;k++){var task=GlobalConfig.DailyConfig[taskids[k]];var taskData=UserTask.ins().getSevenDayTaskById(task.id);var day=k+1;var state=taskData.state>2?0:taskData.state;this.ui["num"+day].text=""+task.target;this.ui["day"+day].data={config:task,data:taskData,day:day,state:state};value=taskData.value>value?taskData.value:value;max=max>=task.target?max:task.target}this.activeBar.maximum=max;this.activeBar.value=value;this.activenum.text=value+""};SevenDayTaskWin.prototype.updateDayList=function(){var r=[1,2,3,4,5,6,7];this.dayList.selectedIndex=this.curDay-1;this.dayListData.replaceAll(r)};SevenDayTaskWin.prototype.updateMainTask=function(){var taskListData,scroller,taskList;if(this.sysId==UserTask.SYS_XIANSHI){this.timeTip.visible=true;this.scroller2.visible=true;this.scroller.visible=false;taskListData=this.taskListData2;scroller=this.scroller2;taskList=this.taskList2}else{this.timeTip.visible=false;this.scroller.visible=true;this.scroller2.visible=false;taskListData=this.taskListData;scroller=this.scroller;taskList=this.taskList}var atCfg=GlobalConfig.SystemTaskConfig[this.sysId][UserTask.ACTIVATE_TYPE_CHUANGJUE][this.curDay];if(!atCfg)return;var isOpen=UserTask.ins().createDays>=atCfg.activate_value;var isOver=atCfg.id==UserTask.SYS_XIANSHI&&UserTask.ins().createDays!=atCfg.activate_value?true:false;var dCfg=GlobalConfig.DailyConfig;var r;var r0=[];var r1=[];var r2=[];var r3=[];for(var i=0;i<atCfg.task_ids.length;i++){var id=atCfg.task_ids[i];var cfg=dCfg[id];var data=UserTask.ins().getSevenDayTaskById(id);if(!data)continue;var state=isOpen?isOver?UserTask.IS_OVER:data.state:UserTask.NOT_OPEN;var item={config:cfg,data:data,state:state,openDay:atCfg.activate_value};switch(data.state){case UserTask.NOT_DO:r0.push(item);break;case UserTask.CAN_GET:r1.push(item);break;case UserTask.ALREADY_GET:r2.push(item);break;default:r3.push(item)}}r=r1.concat(r0,r2,r3);taskListData.replaceAll(r);scroller.stopAnimation();taskList.scrollV=0};SevenDayTaskWin.prototype.updateTimer=function(){var createDays=UserTask.ins().createDays||0;var now=new Date(GameServer.serverTime);var year=now.getFullYear();var month=now.getMonth()+1;var date=now.getDate();var activityEnd=new Date(year+"-"+month+"-"+date+" 00:00");activityEnd.setDate(activityEnd.getDate()+7-(createDays-1));var dayEnd=new Date(year+"-"+month+"-"+date+" 00:00");dayEnd.setDate(dayEnd.getDate()+1);var t1=Math.floor((Number(activityEnd)-Number(now))/1e3);this.time1.text=DateUtils.getFormatBySecond(t1,DateUtils.TIME_FORMAT_5);var t2=Math.floor((Number(dayEnd)-Number(now))/1e3);this.time2.text=DateUtils.getFormatBySecond(t2,DateUtils.TIME_FORMAT_1);this.lblDay.text=createDays+""};SevenDayTaskWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:this.close();break;case this.help:this.openInforMask();break;case this.rectClose:;case this.btnInfoClose:this.closeInforMask();break;case this.dayList:this.dayChanged();break;case this.typeList:this.typeChanged();break}};SevenDayTaskWin.prototype.openInforMask=function(){this.inforMask.visible=true};SevenDayTaskWin.prototype.closeInforMask=function(){this.inforMask.visible=false};SevenDayTaskWin.prototype.dayChanged=function(e){var oldv=this.curDay;this.curDay=this.dayList.selectedIndex+1;if(this.curDay!=oldv){this.updateDayList();this.updateMainTask();this.updateTypeBtn()}};SevenDayTaskWin.prototype.showReward=function(reward){ViewManager.ins().open(ActivityRewardTipWin,reward)};SevenDayTaskWin.prototype.typeChanged=function(e){var oldv=this.sysId;this.sysId=this.typeList.selectedIndex+2;if(oldv!=this.sysId){this.updateMainTask()}};SevenDayTaskWin.prototype.updateTypeBtn=function(){var r=[{label:i18n("SevenDayTaskWin_0"),hasTip:false,redPoint:UserTask.ins().hasSevenDayTaskReward(UserTask.SYS_CHENGZHANG,this.curDay)},{label:i18n("SevenDayTaskWin_1"),hasTip:true,redPoint:UserTask.ins().hasSevenDayTaskReward(UserTask.SYS_XIANSHI,this.curDay)}];this.typeList.selectedIndex=this.sysId-2;this.typeListData.replaceAll(r)};SevenDayTaskWin.prototype.setRoleMc=function(){var taskids=GlobalConfig.SystemTaskConfig[UserTask.SYS_HUOYUE][UserTask.ACTIVATE_TYPE_CHUANGJUE][1].task_ids;var item=GlobalConfig.DailyConfig[taskids[taskids.length-1]].awardList[0];var itemId=ShapeShiftingMgr.ins().isBianshenProp(item.id);var itemData=GlobalConfig.ShapeShiftingConfig[itemId];this.modelName.text=itemData.name;var level=ShapeShiftingMgr.ins().getMaxLevel(itemId);var cfg=GlobalConfig.ShapeShiftingLevelConfig[itemId][1][level];var appearance=cfg.appearance||"body001r_0_c";if(!this.mc)this.mc=new MovieClip;this.mc.x=150;this.mc.y=200;this.mc.scaleX=this.mc.scaleY=.6;this.mc.playFile(RES_DIR_ROLE+appearance,-1);this.roleModel.addChild(this.mc)};return SevenDayTaskWin}(BaseEuiView);__reflect(SevenDayTaskWin.prototype,"SevenDayTaskWin");ViewManager.ins().reg(SevenDayTaskWin,LayerManager.UI_Main);var ShapeShiftingMgr=function(_super){__extends(ShapeShiftingMgr,_super);function ShapeShiftingMgr(){var _this=_super.call(this)||this;_this.selectedShapeId={};_this.myShapeShiftingInfo={};_this.othersShapeShiftingInfo={};_this.isInShape=false;_this.PROP_TYPE_SHAPESHIFTING=26;_this.shapeChip=0;_this.exp=0;_this.power=0;_this.storeList={};_this.skillList={};_this.sysId=PackageID.ShapeShifting;_this.regNetMsg(1,_this.postShapeShiftingInfo);_this.regNetMsg(2,_this.postShapeShiftingActivate);_this.regNetMsg(3,_this.postShapeShiftingUpgrade);_this.regNetMsg(4,_this.postShapeShiftingUpgradeBreak);_this.regNetMsg(5,_this.postShapeWear);_this.regNetMsg(6,_this.postShapeStart);_this.regNetMsg(7,_this.postShapeEnd);_this.regNetMsg(8,_this.postPropLevelUp);_this.regNetMsg(9,_this.postStoreList);_this.regNetMsg(10,_this.postBuyRes);_this.regNetMsg(11,_this.postRefreshRes);_this.regNetMsg(12,_this.postRefreshSkill);_this.regNetMsg(13,_this.postRefreshExp);_this.regNetMsg(14,_this.postRefreshPower);_this.regNetMsg(15,_this.postRefreshChip);_this.regNetMsg(16,_this.postTask);_this.regNetMsg(17,_this.postTaskTotal);_this.regNetMsg(18,_this.postTaskAwards);_this.regNetMsg(19,_this.postExchangeRes);return _this}ShapeShiftingMgr.ins=function(){return _super.ins.call(this)};ShapeShiftingMgr.prototype.isBianshenProp=function(itemId){if(itemId===void 0){itemId=0}var cfgs=GlobalConfig.ShapeShiftingConfig;var len=Object.keys(cfgs).length;for(var i=1;i<=len;i++){var cfg=cfgs[i];var mat=cfg&&cfg.mat||1;if(itemId==mat){return cfg.id}}return null};ShapeShiftingMgr.prototype.isMaxLevel=function(shapeId){if(shapeId===void 0){shapeId=1}var cfg=GlobalConfig.ShapeShiftingLevelConfig[shapeId];if(!cfg){return false}var stage=1;var cfgs=GlobalConfig.ShapeShiftingLevelConfig[shapeId][stage];var max=0;var len=Object.keys(cfgs).length;for(var i=1;i<=len;i++){var c=cfgs[i];var l=c.level;if(l>max){max=l}}var info=this.myShapeShiftingInfo[shapeId];var level=info.level;return level>=max};ShapeShiftingMgr.prototype.isMaxPropLevel=function(shapeId){if(shapeId===void 0){shapeId=1}var plevel=this.myShapeShiftingInfo[shapeId]["plevel"]||0;var max=this.getMaxPropLevel(shapeId);return plevel>=max};ShapeShiftingMgr.prototype.getCurBreakSkill=function(shapeId){if(shapeId===void 0){shapeId=1}var plevel=ShapeShiftingMgr.ins().myShapeShiftingInfo[shapeId].plevel||0;var breakskill=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel].breakskill||0;return breakskill};ShapeShiftingMgr.prototype.getNextBreakSkill=function(shapeId){if(shapeId===void 0){shapeId=1}var cur=this.getCurBreakSkill(shapeId);var cfg=GlobalConfig.ShapeShiftingPropConfig[shapeId];for(var level in cfg){var breakSkill=cfg[level].breakskill;if(breakSkill>cur){return breakSkill}}return cur};ShapeShiftingMgr.prototype.getNextBreakSkillPropLevel=function(shapeId){if(shapeId===void 0){shapeId=1}var cur=this.getCurBreakSkill(shapeId);var cfg=GlobalConfig.ShapeShiftingPropConfig[shapeId];for(var level in cfg){var breakSkill=cfg[level].breakskill;if(breakSkill>cur){return level}}var plevel=ShapeShiftingMgr.ins().myShapeShiftingInfo[shapeId].plevel||0;return plevel};ShapeShiftingMgr.prototype.getMaxLevel=function(shapeId){if(shapeId===void 0){shapeId=1}var max=1;var cfgs=GlobalConfig.ShapeShiftingLevelConfig[shapeId][1];if(!cfgs){return max}var len=Object.keys(cfgs).length;for(var i=0;i<len;i++){var cfg=cfgs[i];var level=cfg&&cfg.level||0;if(level>max){max=level}}return max};ShapeShiftingMgr.prototype.getMaxPropLevel=function(shapeId){if(shapeId===void 0){shapeId=1}var max=0;var cfgs=GlobalConfig.ShapeShiftingPropConfig[shapeId];if(!cfgs){return max}var len=Object.keys(cfgs).length;for(var i=0;i<len;i++){var cfg=cfgs[i];var level=cfg&&cfg.level||0;if(level>max){max=level}}return max};ShapeShiftingMgr.prototype.getTotalLevel=function(){var level=0;var info=this.myShapeShiftingInfo;for(var shapeId in info){var v=info[shapeId];if(v.level>0){level+=v.level}}return level};ShapeShiftingMgr.prototype.getTotalPower=function(){return this.power};ShapeShiftingMgr.prototype.noActivate=function(){var res=true;var info=this.myShapeShiftingInfo;for(var shapeId in info){var v=info[shapeId];if(v.stage>0){res=false;return res}}return res};ShapeShiftingMgr.prototype.getUselessProp=function(){var res=[];var cfgs=GlobalConfig.ShapeShiftingConfig;var len=Object.keys(cfgs).length;for(var i=1;i<=len;i++){var cfg=cfgs[i];var id=cfg&&cfg.id||1;var actWay=cfg&&cfg.actWay||1;var job=cfg.job||0;var mjob=SubRoles.ins().getFirstJob();if(job>=1&&job<=3){if(job==mjob){actWay=1}else{actWay=2}}if(actWay==2){var s=ShapeShiftingMgr.ins().getStateByID(id);if(s.state==ShapeState.activated||s.state==ShapeState.wearing){var max=this.getMaxPropLevel(id);var plevel=this.myShapeShiftingInfo[id].plevel||0;if(plevel>=max){res.push(cfg.mat)}}}}return res};ShapeShiftingMgr.prototype.getShowJob=function(){var job=-1;for(var i=1;i<=3;i++){var id=this.selectedShapeId[i];if(id>0){job=SubRoles.ins().getFirstJob();break}}return job};ShapeShiftingMgr.prototype.showSmeltRedP=function(){var res=false;var smeltList=UserBag.ins().getShapeShiftingOutEquips();var res=smeltList.length>0?true:false;return res};ShapeShiftingMgr.prototype.showBsRedTask=function(shapeId){if(shapeId===void 0){shapeId=0}if(shapeId>0){var info_7=this.myShapeShiftingInfo[shapeId];if(!info_7){return false}var state1=info_7["task"]&&info_7["task"]["task1state"]||0;var state2=info_7["task"]&&info_7["task"]["task2state"]||0;if(state1==1){return true}if(state2==1){return true}return false}for(var shapeID in GlobalConfig.ShapeShiftingConfig){var info=this.myShapeShiftingInfo[shapeID];var isShow=this.isShowShape(Number(shapeID));if(!isShow||!info){continue}var state1=info["task"]&&info["task"]["task1state"]||0;var state2=info["task"]&&info["task"]["task2state"]||0;if(state1==1){return true}if(state2==1){return true}}return false};ShapeShiftingMgr.prototype.showBsRedP=function(){var res=false;for(var shapeID in GlobalConfig.ShapeShiftingConfig){var info=this.getStateByID(Number(shapeID));var isShow=this.isShowShape(Number(shapeID));if(info.state==ShapeState.activatable&&isShow){res=true;break}}return res};ShapeShiftingMgr.prototype.showSjRedP=function(){var res=false;for(var shapeID in GlobalConfig.ShapeShiftingConfig){var isShow=this.isShowShape(Number(shapeID));var res=this.canLevelUp(Number(shapeID));if(res&&isShow){break}res=this.canPropLevelUp(Number(shapeID));if(res&&isShow){break}}return res};ShapeShiftingMgr.prototype.getHejiCount=function(zsLv){var currCount=0;for(var j=0;j<UserSkill.ins().equipListData.length;j++){var item=UserSkill.ins().equipListData[j].itemConfig;if(item){var zsLevel=item.zsLevel?item.zsLevel:0;var level=item.level?item.level:1;var lv=zsLv==0?60:80;if(zsLevel>=zsLv&&level>=lv){currCount++}}}return currCount};ShapeShiftingMgr.prototype.getInfoByID=function(shapeID){if(shapeID===void 0){shapeID=1}return this.myShapeShiftingInfo[shapeID]};ShapeShiftingMgr.prototype.getStateByID=function(shapeId){if(shapeId===void 0){shapeId=1}var res={state:ShapeState.unActivated,roleId:-1};for(var roleId=1;roleId<=3;roleId++){var sid=this.selectedShapeId[roleId]||-1;if(sid==shapeId){res.state=ShapeState.wearing;res.roleId=roleId;return res}}var info=this.myShapeShiftingInfo[shapeId];var stage=info&&info.stage||-1;var level=info&&info.level||1;if(stage>0){res.state=ShapeState.activated;return res}else{var cfg=GlobalConfig.ShapeShiftingConfig[shapeId];var actWay=cfg&&cfg.actWay||1;var job=cfg&&cfg.job||0;var mjob=SubRoles.ins().getFirstJob();if(job>=1&&job<=3){if(job==mjob){actWay=1}else{actWay=2}}var mat=cfg&&cfg.mat||0;var suit=cfg&&cfg.suit||0;if(mat&&actWay==2){var isHave=UserBag.ins().getBagGoodsCountById(0,mat);if(isHave>0){res.state=ShapeState.activatable;return res}}if(actWay==1){var count=this.getHejiCount(suit);if(count>=8){res.state=ShapeState.activatable;return res}}return res}};ShapeShiftingMgr.prototype.canLevelUp=function(shapeId){if(shapeId===void 0){shapeId=1}var res=false;var info=this.myShapeShiftingInfo[shapeId];var stage=info&&info.stage||1;if(stage<1){return res}var lv=info&&info.level||1;var cfg=GlobalConfig.ShapeShiftingLevelConfig[shapeId][stage][lv];if(!cfg){console.log("ShapeShiftingMgr.ts L27 !cfg return");return}var needzslv=cfg.needzslv||0;var zslv=UserZs.ins().lv;if(needzslv>0&&zslv<needzslv){return false}var needlv=cfg.needlv||0;var level=Actor.level;if(needlv>0&&level<needlv){return false}if(cfg.breakcost||cfg.breaklevel!=undefined){var breakcost=cfg.breakcost;var breaklevel=cfg.breaklevel||0;var plevel=this.myShapeShiftingInfo[shapeId].plevel||0;if(plevel<breaklevel){return false}for(var _i=0,breakcost_1=breakcost;_i<breakcost_1.length;_i++){var v=breakcost_1[_i];var id=v.id;var num=v.num;var isHave=UserBag.ins().getBagGoodsCountById(0,id);if(isHave<num){return res}}return true}else{return false}};ShapeShiftingMgr.prototype.canPropLevelUp=function(shapeId){if(shapeId===void 0){shapeId=1}var info=this.myShapeShiftingInfo[shapeId];var stage=info&&info.stage||1;if(stage<1){return false}var plevel=info&&info.plevel||0;var cfg=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel];if(!cfg){console.log("ShapeShiftingMgr.ts L354 !cfg return");return false}var max=this.getMaxPropLevel(shapeId);if(plevel>=max){return false}else{var costItemId=GlobalConfig.ShapeShiftingConfig[shapeId].mat;var isHave=UserBag.ins().getBagGoodsCountById(0,costItemId);var costNum=cfg.needCount;if(isHave>=costNum){return true}}return false};ShapeShiftingMgr.prototype.getEnterSkillData=function(roleId){if(roleId===void 0){roleId=1}var data=null;var id=null;var shapeID=this.selectedShapeId[roleId]||-1;if(shapeID==-1){}else{var plevel=this.myShapeShiftingInfo[shapeID].plevel||0;id=GlobalConfig.ShapeShiftingPropConfig[shapeID][plevel].enterskill}if(id&&id>0){data=new SkillData(id)}return data};ShapeShiftingMgr.prototype.getIsInShape=function(roleId){if(roleId===void 0){roleId=-1}if(!this.isInShape){return false}for(var r=1;r<=SubRoles.ins().subRolesLen;r++){var shapeID=this.selectedShapeId[r]||-1;if(roleId>-1){if(r==roleId+1&&shapeID>0){return true}}else{if(shapeID>0){return true}}}return false};ShapeShiftingMgr.prototype.getShowApperance=function(roleId){if(roleId===void 0){roleId=1}var a="";var d="";var g=0;var s=1;if(!this.isInShape){return[a,d,g,s]}else{var shapeID=this.selectedShapeId[roleId]||-1;if(shapeID==-1){return[a,d,g,s]}else{var info=this.myShapeShiftingInfo[shapeID];var stage=Math.max(info&&info.stage||1,1);var level=Math.max(info&&info.level||1,1);a=GlobalConfig.ShapeShiftingLevelConfig[shapeID][stage][level].showApperance||"";if(a&&a.indexOf("body")>-1){a=RES_DIR_BODY+a}if(a&&a.indexOf("monster")>-1){a=RES_DIR_MONSTER+a}var rank=GlobalConfig.ShapeShiftingConfig[shapeID].rank;d=GlobalConfig.ShapeShiftingConfig[shapeID].dz;s=GlobalConfig.ShapeShiftingConfig[shapeID].scale/100;g=this.rankToDis(rank,s)}}return[a,d,g,s]};ShapeShiftingMgr.prototype.rankToDis=function(rank,s){if(rank===void 0){rank=1}if(s===void 0){s=1}var dis=-50;switch(rank){case 1:dis=-50*s;break;case 2:dis=-60*s;break;case 3:dis=-70*s;break}return dis};ShapeShiftingMgr.prototype.getOthersShowApperance=function(handleid){if(handleid===void 0){handleid=1}var a="";var d="";var g=0;var s=1;var info=this.othersShapeShiftingInfo[handleid];if(!info){return[a,d,g,s]}var shapeID=info["shapeID"];var stage=info["stage"];var level=info["level"]||1;if(shapeID>0&&stage>0&&level>=1){a=GlobalConfig.ShapeShiftingLevelConfig[shapeID][stage][level].showApperance||"";var rank=GlobalConfig.ShapeShiftingConfig[shapeID].rank;d=GlobalConfig.ShapeShiftingConfig[shapeID].dz;s=GlobalConfig.ShapeShiftingConfig[shapeID].scale/100;g=this.rankToDis(rank)}if(a&&a.indexOf("body")>-1){a=RES_DIR_BODY+a}if(a&&a.indexOf("monster")>-1){a=RES_DIR_MONSTER+a}return[a,d,g,s]};ShapeShiftingMgr.prototype.startShape=function(){this.isInShape=true;console.log("this.isInShape = true")};ShapeShiftingMgr.prototype.endShape=function(){this.isInShape=false;console.log("this.isInShape = false")};Object.defineProperty(ShapeShiftingMgr.prototype,"SelectedShapeId",{get:function(){return this.selectedShapeId},enumerable:true,configurable:true});Object.defineProperty(ShapeShiftingMgr.prototype,"ShapeShiftingInfo",{get:function(){return this.myShapeShiftingInfo},enumerable:true,configurable:true});ShapeShiftingMgr.prototype.getSkillList=function(shapeId,skillType){if(shapeId===void 0){shapeId=1}if(skillType===void 0){skillType=ShapeSkillType.atkskill}var cfgs=GlobalConfig.ShapeShiftingPropConfig[shapeId];if(!cfgs){return{}}var list={};var len=Object.keys(cfgs).length;for(var i=0;i<len;i++){var cfg=cfgs[i];var id=void 0;switch(skillType){case ShapeSkillType.atkskill:id=cfg.atkskill;break;case ShapeSkillType.talent:id=cfg.talent;break;case ShapeSkillType.enterskill:id=cfg.enterskill;break}if(id){var isNew=true;for(var k in list){var v=list[k];if(v==id){isNew=false;break}}if(isNew){var level=cfg.level;list[level]=id}}}return list};ShapeShiftingMgr.prototype.isShowShape=function(id){if(id===void 0){id=1}var cfg=GlobalConfig.ShapeShiftingConfig[id];var isShow=cfg.isShow;return isShow==1||Setting.ins().getValue(ClientSet.showAllShape)==1};ShapeShiftingMgr.prototype.getPropUpCb=function(id){var self=this;var cb;var mat=GlobalConfig.ShapeShiftingConfig[id].mat;var have1=UserBag.ins().getBagGoodsCountById(0,mat);var have2=0;var have3=0;var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[id];var plevel=Math.max(info&&info.plevel||0,0);var needCount=GlobalConfig.ShapeShiftingPropConfig[id][plevel].needCount||0;var id2=GlobalConfig.ShapeShiftingConfig[id].limitBreakItem||0;if(id2>0){have2=UserBag.ins().getBagGoodsCountById(0,id2)}var id3=GlobalConfig.ShapeShiftingBaseConfig.publicBreakItem||0;if(id3>0){have3=UserBag.ins().getBagGoodsCountById(0,id3)}if(have1>=needCount){cb=function(){ShapeShiftingMgr.ins().sendPropLevelUp(id)}}else if(have1+have2>=needCount){cb=function(){WarnWin.show(i18n("ShapeShiftingPropDetailWin_2",GlobalConfig.ItemConfig[id2].name,needCount-have1,GlobalConfig.ItemConfig[id2].name,have2),function(){ShapeShiftingMgr.ins().sendPropLevelUp(id)},this,null,null)}}else if(have1+have2+have3>=needCount){cb=function(){if(have2>0){WarnWin.show(i18n("ShapeShiftingPropDetailWin_3",GlobalConfig.ItemConfig[id2].name,have2,GlobalConfig.ItemConfig[id3].name,needCount-have1-have2,GlobalConfig.ItemConfig[id2].name,have2,GlobalConfig.ItemConfig[id3].name,have3),function(){ShapeShiftingMgr.ins().sendPropLevelUp(id)},this,null,null)}else{WarnWin.show(i18n("ShapeShiftingPropDetailWin_2",GlobalConfig.ItemConfig[id3].name,needCount-have1,GlobalConfig.ItemConfig[id3].name,have3),function(){ShapeShiftingMgr.ins().sendPropLevelUp(id)},this,null,null)}}}return cb};ShapeShiftingMgr.prototype.sendGetShapeShiftingInfo=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postShapeShiftingInfo=function(bytes){for(var i=1;i<=3;i++){this.selectedShapeId[i]=bytes.readShort()}this.myShapeShiftingInfo={};var count=bytes.readShort();for(var i=0;i<count;i++){var shapeId=bytes.readShort();var stage=bytes.readShort();var level=bytes.readShort();var exp=bytes.readInt();var plevel=bytes.readShort();var id1=bytes.readShort();var progress1=bytes.readShort();var state1=bytes.readByte();var level2=bytes.readShort();var point2=bytes.readShort();var state2=bytes.readByte();this.myShapeShiftingInfo[shapeId]={stage:stage,level:level,exp:exp,plevel:plevel,task:{task1id:id1,task1progress:progress1,task1state:state1,task2level:level2,task2point:point2,task2state:state2}}}this.shapeChip=bytes.readInt();this.exp=bytes.readNumber();console.log("postShapeShiftingInfo:");console.log(this.selectedShapeId);console.log(this.myShapeShiftingInfo);console.log("shapeChip:"+this.shapeChip);console.log("exp:"+this.exp)};ShapeShiftingMgr.prototype.sendShapeShiftingActivate=function(shapeId){var bytes=this.getBytes(2);bytes.writeInt(shapeId);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postShapeShiftingActivate=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var shapeId=bytes.readInt();console.log("postShapeShiftingActivate");if(errid==0){this.myShapeShiftingInfo[shapeId]={stage:1,level:0,exp:0,plevel:0}}else{console.log(errmsg)}return[errid,errmsg,shapeId]};ShapeShiftingMgr.prototype.sendShapeShiftingUpgrade=function(shapeId){var bytes=this.getBytes(3);bytes.writeInt(shapeId);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postShapeShiftingUpgrade=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var shapeId=bytes.readInt();var stage=bytes.readInt();var level=bytes.readInt();var exp=bytes.readNumber();console.log("postShapeShiftingUpgrade");if(errid==0){this.myShapeShiftingInfo[shapeId].level=level;this.exp=exp}else{console.log(errmsg)}return[errid,errmsg]};ShapeShiftingMgr.prototype.sendShapeShiftingUpgradeBreak=function(shapeId){var bytes=this.getBytes(4);bytes.writeInt(shapeId);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postShapeShiftingUpgradeBreak=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var shapeId=bytes.readInt();var stage=bytes.readInt();var level=bytes.readInt();var exp=bytes.readInt();console.log("postShapeShiftingUpgrade");if(errid==0){this.myShapeShiftingInfo[shapeId].stage=stage;this.myShapeShiftingInfo[shapeId].level=level;this.myShapeShiftingInfo[shapeId].exp=exp}else{console.log(errmsg)}return[errid,errmsg]};ShapeShiftingMgr.prototype.sendShapeWear=function(shapeId,roleId){if(shapeId===void 0){shapeId=1}if(roleId===void 0){roleId=1}var bytes=this.getBytes(5);bytes.writeInt(shapeId);bytes.writeInt(roleId);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postShapeWear=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var shapeId=bytes.readInt();var roleId=bytes.readInt();console.log("postShapeWear");if(errid==0){this.selectedShapeId[roleId]=shapeId}else{console.log(errmsg)}return[errid,errmsg]};ShapeShiftingMgr.prototype.postShapeStart=function(bytes){var isMe=false;console.log("postShapeStart");var toMe=bytes.readBoolean();var actorid=bytes.readInt();var count=bytes.readShort();if(actorid==Actor.actorID){if(toMe){isMe=true;this.startShape()}}else{isMe=false;for(var i=0;i<count;i++){var handleid=bytes.readInt();var shapeid=bytes.readShort();var stage=bytes.readShort();var level=bytes.readShort();if(level<1){level=1}if(handleid&&handleid>0&&shapeid&&shapeid>0&&stage>0&&level>=1){this.othersShapeShiftingInfo[handleid]={shapeID:shapeid,stage:stage,level:level}}}}return isMe};ShapeShiftingMgr.prototype.postShapeStartClient=function(isMe,info){if(isMe===void 0){isMe=false}if(info===void 0){info={}}console.log("postShapeStartClient");if(isMe){this.startShape();return isMe}for(var handleid in info){var shapeid=info[handleid];this.othersShapeShiftingInfo[handleid]={shapeID:shapeid,stage:1,level:1}}return isMe};ShapeShiftingMgr.prototype.postShapeEnd=function(bytes){console.log("postShapeEnd");var isMe=false;var actorid=bytes.readInt();var count=bytes.readShort();if(actorid==Actor.actorID){isMe=true;this.endShape()}else{isMe=false;for(var i=0;i<count;i++){var handleid=bytes.readInt();if(handleid&&handleid>0&&this.othersShapeShiftingInfo[handleid]){this.othersShapeShiftingInfo[handleid]=null}}}return isMe};ShapeShiftingMgr.prototype.postShapeEndClient=function(isMe,info){if(isMe===void 0){isMe=false}if(info===void 0){info={}}console.log("postShapeEndClient");if(isMe){this.endShape();return isMe}for(var handleid in info){if(handleid&&Number(handleid)>0&&this.othersShapeShiftingInfo[handleid]){this.othersShapeShiftingInfo[handleid]=null}}return isMe};ShapeShiftingMgr.prototype.sendPropLevelUp=function(shapeId){if(shapeId===void 0){shapeId=1}var bytes=this.getBytes(8);bytes.writeInt(shapeId);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postPropLevelUp=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var shapeId=bytes.readInt();var plevel=bytes.readShort();console.log("postPropLevelUp");if(errid==0){this.myShapeShiftingInfo[shapeId].plevel=plevel}else{UserTips.ins().showTips(errmsg)}return[errid,errmsg]};ShapeShiftingMgr.prototype.sendGetStoreList=function(){var bytes=this.getBytes(9);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postStoreList=function(bytes){this.storeList={};var len=bytes.readInt();for(var i=1;i<=len;i++){this.storeList[i]=bytes.readInt()}console.log("postStoreList:"+this.storeList)};ShapeShiftingMgr.prototype.sendBuyReq=function(idx){if(idx===void 0){idx=1}var bytes=this.getBytes(10);bytes.writeInt(idx);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postBuyRes=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var idx=bytes.readInt();console.log("postBuyRes errid:"+errid);return[errid,errmsg]};ShapeShiftingMgr.prototype.sendRefreshReq=function(){var bytes=this.getBytes(11);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postRefreshRes=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();console.log("postRefreshRes errid:"+errid);return[errid,errmsg]};ShapeShiftingMgr.prototype.sendPowerReq=function(){var bytes=this.getBytes(12);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postRefreshSkill=function(bytes){var roleId=bytes.readInt();var len=bytes.readInt();var activeList=[];var passiveList=[];for(var i=0;i<len;i++){activeList.push(new SkillData(bytes.readInt()))}len=bytes.readInt();for(i=0;i<len;i++){passiveList.push(new SkillData(bytes.readInt()))}this.skillList[roleId-1]={activeList:activeList,passiveList:passiveList}};ShapeShiftingMgr.prototype.postRefreshExp=function(bytes){var exp=bytes.readNumber();var last=this.exp;if(last<exp){UserTips.ins().showTips2(i18n("ShapeShiftingMgr_2")+(exp-last))}this.exp=exp};ShapeShiftingMgr.prototype.postRefreshPower=function(bytes){var power=bytes.readInt();this.power=power};ShapeShiftingMgr.prototype.postRefreshChip=function(bytes){var chip=bytes.readInt();var lastChip=this.shapeChip;this.shapeChip=chip;if(this.shapeChip>lastChip){UserTips.ins().showTips(i18n("ShapeShiftingMgr_0")+(this.shapeChip-lastChip)+i18n("ShapeShiftingMgr_1"))}};ShapeShiftingMgr.prototype.postTask=function(bytes){var shapeId=bytes.readShort();var id=bytes.readShort();var progress=bytes.readShort();var state=bytes.readByte();var info=this.myShapeShiftingInfo[shapeId]["task"];if(info==undefined){info={}}info["task1id"]=id;info["task1progress"]=progress;info["task1state"]=state;info["task2level"]=info&&info["task2level"]||1;info["task2point"]=info&&info["task2point"]||0;info["task2state"]=info&&info["task2state"]||0;this.myShapeShiftingInfo[shapeId]["task"]=info};ShapeShiftingMgr.prototype.postTaskTotal=function(bytes){var shapeId=bytes.readShort();var level=bytes.readShort();var point=bytes.readShort();var state=bytes.readByte();var info=this.myShapeShiftingInfo[shapeId]["task"];if(info==undefined){info={}}info["task1id"]=info&&info["task1id"]||1;info["task1progress"]=info&&info["task1progress"]||0;info["task1state"]=info&&info["task1state"]||0;info["task2level"]=level;info["task2point"]=point;info["task2state"]=state;this.myShapeShiftingInfo[shapeId]["task"]=info};ShapeShiftingMgr.prototype.sendTaskAwardReq=function(shapeid,type){if(shapeid===void 0){shapeid=1}if(type===void 0){type=0}var bytes=this.getBytes(18);bytes.writeShort(shapeid);bytes.writeByte(type);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postTaskAwards=function(bytes){var shapeId=bytes.readShort();var errid=bytes.readByte();return[shapeId,errid]};ShapeShiftingMgr.prototype.sendExchangeReq=function(num){if(num===void 0){num=0}var bytes=this.getBytes(19);bytes.writeInt(num);this.sendToServer(bytes)};ShapeShiftingMgr.prototype.postExchangeRes=function(bytes){var errid=bytes.readByte();return errid};ShapeShiftingMgr.prototype.postToId=function(shapeId){if(shapeId===void 0){shapeId=1}return[shapeId]};return ShapeShiftingMgr}(BaseSystem);__reflect(ShapeShiftingMgr.prototype,"ShapeShiftingMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.shapeshiftingMgr=ShapeShiftingMgr.ins.bind(ShapeShiftingMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ShapeState;(function(ShapeState){ShapeState[ShapeState["activatable"]=0]="activatable";ShapeState[ShapeState["wearing"]=1]="wearing";ShapeState[ShapeState["activated"]=2]="activated";ShapeState[ShapeState["unActivated"]=3]="unActivated"})(ShapeState||(ShapeState={}));window["ShapeState"]=ShapeState;var ShapeSkillType;(function(ShapeSkillType){ShapeSkillType[ShapeSkillType["atkskill"]=1]="atkskill";ShapeSkillType[ShapeSkillType["talent"]=2]="talent";ShapeSkillType[ShapeSkillType["enterskill"]=3]="enterskill"})(ShapeSkillType||(ShapeSkillType={}));window["ShapeSkillType"]=ShapeSkillType;var ShapeShiftingGainExpWin=function(_super){__extends(ShapeShiftingGainExpWin,_super);function ShapeShiftingGainExpWin(){return _super.call(this)||this}ShapeShiftingGainExpWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ShapeShiftingGainExpSkin";this.infoTxts=[this["infoTxt0"],this["infoTxt1"],this["infoTxt2"],this["infoTxt3"]];this.expTxts=[this["expTxt0"],this["expTxt1"],this["expTxt2"],this["expTxt3"]];this.countTxts=[this["countTxt0"],this["countTxt1"],this["countTxt2"],this["countTxt3"]];this.items=[null,this["item1"],this["item2"],this["item3"]];this.btns=[this["btn0"],this["btn1"],this["btn2"],this["btn3"]];var cfg=GlobalConfig.ShapeShiftingBaseConfig;this.itemID=[0,cfg.lowItem,cfg.normalItem,cfg.highItem];for(var i=1;i<this.items.length;i++){this.items[i].isShowName(false)}this.isTopLevel=true};ShapeShiftingGainExpWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);this.observe(UserBag.ins().postItemAdd,this.setData);this.observe(UserBag.ins().postItemDel,this.setData);this.setData()};ShapeShiftingGainExpWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTap);this.removeObserve()};ShapeShiftingGainExpWin.prototype.setData=function(){this.countTxts[0].textFlow=TextFlowMaker.generateTextFlow(i18n("ShapeShiftingGainExpWin_0",UserFb.ins().ssExpEff));for(var i=1;i<=3;i++){var itemID=this.itemID[i];this.items[i].data=itemID;var itemConfig=GlobalConfig.ItemConfig[itemID];this.infoTxts[i].text=itemConfig.name;var useArg=itemConfig.useArg;var exp=useArg&&useArg["exp"]||0;this.expTxts[i].textFlow=TextFlowMaker.generateTextFlow(i18n("ShapeShiftingGainExpWin_1",exp));var isHave=UserBag.ins().getBagGoodsCountById(0,itemID);if(isHave>0){this.countTxts[i].textFlow=TextFlowMaker.generateTextFlow(i18n("ShapeShiftingGainExpWin_3",isHave));this.btns[i].label=i18n("ShapeShiftingGainExpWin_5")}else{this.countTxts[i].textFlow=TextFlowMaker.generateTextFlow(i18n("ShapeShiftingGainExpWin_2",isHave));this.btns[i].label=i18n("ShapeShiftingGainExpWin_4")}}};ShapeShiftingGainExpWin.prototype.onTap=function(e){switch(e.target){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;default:var index=this.btns.indexOf(e.target);if(index>-1){if(index==0){ViewManager.ins().closeTopLevel();var uiview2=ViewManager.ins().getView(UIView2);if(uiview2)uiview2.guanqiaBtnClick(null)}else if(this.btns[index].label==i18n("ShapeShiftingGainExpWin_4")){ViewManager.ins().open(ShopGoodsWarn).setData(this.itemID[index],1)}else{this.onUse(index)}}}};ShapeShiftingGainExpWin.prototype.onUse=function(index){var itemID=this.itemID[index];var config=GlobalConfig.ItemConfig[itemID];var lv=config.level?config.level:0;var zslv=config.zsLevel?config.zsLevel:0;if(Actor.level>=lv&&UserZs.ins().lv>=zslv){}else{var tips="";if(UserZs.ins().lv<zslv){tips+=i18n("ItemUseTipsWin_7",zslv)}if(Actor.level<lv){tips+=i18n("ItemUseTipsWin_8",lv)}UserTips.ins().showTips(i18n("ItemUseTipsWin_9",tips));return}var isHave=UserBag.ins().getBagGoodsCountById(0,itemID);UserBag.ins().sendUseItem(itemID,isHave)};return ShapeShiftingGainExpWin}(BaseEuiView);__reflect(ShapeShiftingGainExpWin.prototype,"ShapeShiftingGainExpWin");ViewManager.ins().reg(ShapeShiftingGainExpWin,LayerManager.UI_Popup);var ShapeShiftingGainWayBtn=function(_super){__extends(ShapeShiftingGainWayBtn,_super);function ShapeShiftingGainWayBtn(label,winName,param){var _this=_super.call(this)||this;_this.skinName="Btn1002Skin";_this.btnLabel.text=label;_this.winName=winName;_this.param=param;_this.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onClick,_this);_this.addEventListener(egret.Event.REMOVED_FROM_STAGE,_this.onRemove,_this);return _this}ShapeShiftingGainWayBtn.prototype.onClick=function(){if(this.winName){ViewManager.ins().open(this.winName,this.param);if(this.winName=="TreasureHuntWin"){ViewManager.ins().close(ShapeShiftingWin)}}};ShapeShiftingGainWayBtn.prototype.onRemove=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)};return ShapeShiftingGainWayBtn}(eui.Button);__reflect(ShapeShiftingGainWayBtn.prototype,"ShapeShiftingGainWayBtn");var ShapeShiftingGiftTips=function(_super){__extends(ShapeShiftingGiftTips,_super);function ShapeShiftingGiftTips(){var _this=_super.call(this)||this;_this.shapeId=1;_this.skinName="ShapeshiftingGiftTipsSkin";return _this}ShapeShiftingGiftTips.prototype.initUI=function(){_super.prototype.initUI.call(this)};ShapeShiftingGiftTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.addTouchEvent(this.bgClose,this.otherClose);this.shapeId=param[0];this.setState();this.setInfo()};ShapeShiftingGiftTips.prototype.setState=function(){var cur=ShapeShiftingMgr.ins().getCurBreakSkill(this.shapeId);var next=ShapeShiftingMgr.ins().getNextBreakSkill(this.shapeId);var isMax=cur>=next;var state=ShapeShiftingMgr.ins().getStateByID(this.shapeId);this.currentState=state.state==ShapeState.activatable||state.state==ShapeState.unActivated?"unactive":isMax?"max":"active"};ShapeShiftingGiftTips.prototype.setInfo=function(){var cur=ShapeShiftingMgr.ins().getCurBreakSkill(this.shapeId);var cfg=GlobalConfig.ShapeShiftingGiftConfig[cur]||undefined;if(!cfg){return}var des=cfg.des;this.icon.icon=cfg.des.icon;this.nameTxt.text=cfg.des.name;var attrs=cfg.attrs;var desc=AttributeData.getAttStr(attrs,0,1,"：")+"\n";this.attr1.text=desc;var next=ShapeShiftingMgr.ins().getNextBreakSkill(this.shapeId);cfg=GlobalConfig.ShapeShiftingGiftConfig[next]||undefined;if(!cfg){return}attrs=cfg.attrs;desc=AttributeData.getAttStr(attrs,0,1,"：")+"\n";this.attr2.text=desc;if(this.currentState=="unactive"){this.cond.text=i18n("ShapeShiftingGiftTips_0")}else if(next>cur){var plevel=ShapeShiftingMgr.ins().getNextBreakSkillPropLevel(this.shapeId);var txt=GlobalConfig.ShapeShiftingPropConfig[this.shapeId][plevel].levelText;this.cond.text=i18n("ShapeShiftingGiftTips_1",txt)}else{this.cond.text=""}};ShapeShiftingGiftTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};ShapeShiftingGiftTips.prototype.otherClose=function(e){ViewManager.ins().close(this)};return ShapeShiftingGiftTips}(BaseEuiView);__reflect(ShapeShiftingGiftTips.prototype,"ShapeShiftingGiftTips");ViewManager.ins().reg(ShapeShiftingGiftTips,LayerManager.UI_Popup);var ShapeShiftingItemRenderer=function(_super){__extends(ShapeShiftingItemRenderer,_super);function ShapeShiftingItemRenderer(){var _this=_super.call(this)||this;var self=_this;_this.skinName="ShapeShiftingItemSkin";_this.touchChildren=true;return _this}ShapeShiftingItemRenderer.prototype.dataChanged=function(){var obj=this.data;this.imgIcon.source=obj["icon"];this.imgBg.source="quality"+obj["rank"];this.blackImg.visible=obj["state"]==ShapeState.activatable||obj["state"]==ShapeState.unActivated;this.state.text="";this.roleIdx.text="";this.jobImg.source="";this.level.text=obj["level"]+i18n("ShapeShiftingItemRenderer_0");if(obj["id"]<0){this.hideLevel()}this.sState_wearing.visible=false;this.setPropLevel();if(obj["state"]==ShapeState.activatable){this.state.text=i18n("ShapeShiftingItemRenderer_1");this.hideLevel()}else if(obj["state"]==ShapeState.wearing){this.sState_wearing.visible=true;var job=SubRoles.ins().getSubRoleByIndex(obj["roleId"]-1).job;this.jobImg.source="job"+job+"Item"}else if(obj["state"]==ShapeState.unActivated){this.hideLevel()}this.showRedPoint()};ShapeShiftingItemRenderer.prototype.activate=function(){this.data["state"]=ShapeState.activated;this.dataChanged()};ShapeShiftingItemRenderer.prototype.levelUp=function(level,plevel){this.data["level"]=level;this.data["plevel"]=plevel;this.dataChanged()};ShapeShiftingItemRenderer.prototype.setPropLevel=function(plevel){if(plevel===void 0){plevel=0}var obj=this.data;this.propImg.visible=obj["state"]==ShapeState.wearing||obj["state"]==ShapeState.activated&&obj["id"]>0;if(!this.propImg.visible){return}var cfg=GlobalConfig.ShapeShiftingPropConfig[obj["id"]][obj["plevel"]];var levelbg=cfg&&cfg.levelbg||"";this.propImg.source=levelbg};ShapeShiftingItemRenderer.prototype.showRedPoint=function(){var obj=this.data;if(obj["pageId"]==1){this.redPoint.visible=obj["state"]==ShapeState.activatable||ShapeShiftingMgr.ins().showBsRedTask(obj["id"])}else if(obj["pageId"]==3){this.redPoint.visible=false}else{this.redPoint.visible=ShapeShiftingMgr.ins().canLevelUp(obj["id"])||ShapeShiftingMgr.ins().canPropLevelUp(obj["id"])}};ShapeShiftingItemRenderer.prototype.hideLevel=function(){this.level.text="";this.propImg.visible=false};return ShapeShiftingItemRenderer}(BaseItemRender);__reflect(ShapeShiftingItemRenderer.prototype,"ShapeShiftingItemRenderer");var ShapeShiftingItemData=function(){function ShapeShiftingItemData(){this.id=-1;this.sort=1;this.icon="";this.rank=0;this.state=ShapeState.unActivated;this.roleId=-1;this.pageId=1;this.level=1;this.plevel=0}return ShapeShiftingItemData}();__reflect(ShapeShiftingItemData.prototype,"ShapeShiftingItemData");var ShapeShiftingMatialTransformWin=function(_super){__extends(ShapeShiftingMatialTransformWin,_super);function ShapeShiftingMatialTransformWin(){var _this=_super.call(this)||this;_this.useNum=0;_this.maxNum=0;_this.skinName="ShapeShiftingMatialTransformSkin";_this.isTopLevel=true;return _this}ShapeShiftingMatialTransformWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.numLabel.restrict="0-9"};ShapeShiftingMatialTransformWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.addChangeEvent(this.numLabel,this.onTxtChange);this.observe(ShapeShiftingMgr.ins().postExchangeRes,this.checkChange);this.update()};ShapeShiftingMatialTransformWin.prototype.onTxtChange=function(e){var num=Number(this.numLabel.text);if(num>this.maxNum){num=this.maxNum}else if(num<=0){num=1}this.useNum=num;this.setCount1()};ShapeShiftingMatialTransformWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeObserve()};ShapeShiftingMatialTransformWin.prototype.checkChange=function(errid){if(errid===void 0){errid=0}if(errid==0)this.update()};ShapeShiftingMatialTransformWin.prototype.update=function(){var isHave=this.getNum();this.count0.text=isHave+"";this.transformBtn.enabled=isHave>0;this.maxNum=isHave;if(this.useNum>this.maxNum){this.useNum=this.maxNum}this.setCount1()};ShapeShiftingMatialTransformWin.prototype.getNum=function(){var id=GlobalConfig.ShapeShiftingBaseConfig.exchangeUse;var isHave=UserBag.ins().getBagGoodsCountById(0,id);return isHave};ShapeShiftingMatialTransformWin.prototype.onTouch=function(e){switch(e.target){case this.minBtn:this.useNum=0;this.setCount1();break;case this.maxBtn:if(this.useNum>=this.maxNum){this.showTip()}this.useNum=this.maxNum;this.setCount1();break;case this.sub1Btn:this.useNum--;if(this.useNum<0){this.useNum=0}this.setCount1();break;case this.add1Btn:this.useNum++;if(this.useNum>this.maxNum){this.useNum=this.maxNum;this.showTip()}this.setCount1();break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.transformBtn:var self_17=this;var warnWin=WarnWin.show(i18n("ShapeShiftingMatialTransformWin_2"),function(){self_17.sendExchange(self_17.getNum())},this,function(){},this);break;case this.quicklytransformBtn:this.sendExchange(this.useNum);break}};ShapeShiftingMatialTransformWin.prototype.showTip=function(){if(this.maxNum==0){UserTips.ins().showTips(i18n("ShapeShiftingMatialTransformWin_0"))}else{UserTips.ins().showTips(i18n("ShapeShiftingMatialTransformWin_1"))}};ShapeShiftingMatialTransformWin.prototype.sendExchange=function(num){if(num===void 0){num=0}if(num>0){ShapeShiftingMgr.ins().sendExchangeReq(num)}};ShapeShiftingMatialTransformWin.prototype.setCount1=function(){this.quicklytransformBtn.enabled=this.useNum>0;this.count1.text=this.useNum*GlobalConfig.ShapeShiftingBaseConfig.exchangeGet.count+"";this.numLabel.text=this.useNum+""};return ShapeShiftingMatialTransformWin}(BaseEuiView);__reflect(ShapeShiftingMatialTransformWin.prototype,"ShapeShiftingMatialTransformWin");ViewManager.ins().reg(ShapeShiftingMatialTransformWin,LayerManager.UI_Popup);var ShapeShiftingPropDetailWin=function(_super){__extends(ShapeShiftingPropDetailWin,_super);function ShapeShiftingPropDetailWin(){return _super.call(this)||this}ShapeShiftingPropDetailWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ShapeShiftingPropDetailSkin";this.gainList.itemRenderer=GainGoodsItem};ShapeShiftingPropDetailWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.upBtn,this.onTap);this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.observe(Shop.ins().postBuyResult,this.buyCallBack);this.observe(ShapeShiftingMgr.ins().postPropLevelUp,this.onPropLevelUp)};ShapeShiftingPropDetailWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap)};ShapeShiftingPropDetailWin.prototype.onTap=function(e){switch(e.currentTarget){case this.upBtn:if(this.btnCb){this.btnCb()}break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(ShapeShiftingPropDetailWin);break}};ShapeShiftingPropDetailWin.prototype.onTouchList=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2],true);ViewManager.ins().close(this)}};ShapeShiftingPropDetailWin.prototype.buyCallBack=function(num){if(num>0){ViewManager.ins().close(ShopGoodsWarn)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}else{var warnWin=WarnWin.show(i18n("ShopGoodsWarn_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("ShopGoodsWarn_4"))}ViewManager.ins().close(this)}};ShapeShiftingPropDetailWin.prototype.onPropLevelUp=function(param){var errid=param[0];if(errid==0){this.setData(this.shapeID)}};ShapeShiftingPropDetailWin.prototype.setData=function(shapeId){if(shapeId===void 0){shapeId=1}this.shapeID=shapeId;this.itemID=GlobalConfig.ShapeShiftingConfig[shapeId].mat;var data=new ItemData;data.configID=this.itemID;var gainConfig=GlobalConfig.GainItemConfig[this.itemID];if(gainConfig){this.gainList.dataProvider=new eui.ArrayCollection(gainConfig.gainWay)}else{this.gainList.dataProvider=new eui.ArrayCollection([])}var isMax=ShapeShiftingMgr.ins().isMaxPropLevel(shapeId);this.currentState=isMax?"max":"normal";var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[this.shapeID];var showStage=Math.max(info&&info.stage||1,1);var level=Math.max(info&&info.level||0,1);var plevel=Math.max(info&&info.plevel||0,0);var max=ShapeShiftingMgr.ins().getMaxPropLevel(shapeId);var next_plevel=plevel+1;if(next_plevel>max){next_plevel=max}var cfg=GlobalConfig.ShapeShiftingLevelConfig[shapeId][showStage][level];var cfgp=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel];var cfgp_next=GlobalConfig.ShapeShiftingPropConfig[shapeId][next_plevel];this.level_img.source=cfgp&&cfgp.levelbg||"bsbl_kuang_0";this.label_name.text=cfgp&&cfgp.levelText||"";this.level_img_next.source=cfgp_next&&cfgp_next.levelbg||"bsbl_kuang_0";this.label_name_next.text=cfgp_next&&cfgp_next.levelText||"";var attrs=cfg.attrs;var next_attrs=cfg.attrs;var attrRatio=cfgp.attrRatio;var attrRatio_next=cfgp_next.attrRatio;var attrRatio_unwear=cfgp.unwearAttrRatio;var attrRatio_unwear_next=cfgp_next.unwearAttrRatio;if((attrRatio||0)>=0){this.label_attr.text=i18n("ShapeShiftingWin_18")+(attrRatio||0)+"%"}if((attrRatio_next||0)>=0){this.label_attr_next.text=i18n("ShapeShiftingWin_19")+(attrRatio_next||0)+"%"}if((attrRatio_unwear||0)>=0){this.label_attr_unwear.text=i18n("ShapeShiftingWin_34",attrRatio_unwear||0)}if((attrRatio_unwear_next||0)>=0){this.label_attr_unwear_next.text=i18n("ShapeShiftingWin_34",attrRatio_unwear_next||0)}var attrs_ext=[];for(var _i=0,attrs_2=attrs;_i<attrs_2.length;_i++){var v=attrs_2[_i];var a={type:v.type,value:Math.floor(v.value*(1+attrRatio/100))};attrs_ext.push(a)}var next_attrs_ext=[];for(var _a=0,next_attrs_1=next_attrs;_a<next_attrs_1.length;_a++){var v=next_attrs_1[_a];var a={type:v.type,value:Math.floor(v.value*(1+attrRatio_next/100))};next_attrs_ext.push(a)}var curAttrs=AttributeData.getAttStr(attrs_ext,0,1,"：")+"\n";var nextAttrs=AttributeData.getAttStr(next_attrs_ext,0,1,"：")+"\n";this.curAtt.text=curAttrs;this.curAtt_next.text=nextAttrs;var have1=UserBag.ins().getBagGoodsCountById(0,this.itemID);var have2=0;var have3=0;var needCount=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel].needCount||0;if(have1<needCount){this.have1.textFlow=TextFlowMaker.generateTextFlow1(i18n("ShapeShiftingPropDetailWin_0",have1))}else{this.have1.textFlow=TextFlowMaker.generateTextFlow1(i18n("ShapeShiftingPropDetailWin_1",have1))}this.setItemName(this.itemID,this.item1);this.needCount.text=needCount.toString();var id2=GlobalConfig.ShapeShiftingConfig[this.shapeID].limitBreakItem||0;if(id2==0){DisplayUtils.removeFromParent(this.group2)}if(id2>0){this.setItemName(id2,this.item2);have2=UserBag.ins().getBagGoodsCountById(0,id2);this.have2.text=have2.toString()}var id3=GlobalConfig.ShapeShiftingBaseConfig.publicBreakItem||0;if(id3>0){this.setItemName(id3,this.item3);have3=UserBag.ins().getBagGoodsCountById(0,id3);this.have3.text=have3.toString()}this.upBtn.enabled=have1+have2+have3>=needCount;this.btnCb=ShapeShiftingMgr.ins().getPropUpCb(this.shapeID)};ShapeShiftingPropDetailWin.prototype.setItemName=function(id,label){var itemConfig=GlobalConfig.ItemConfig[id];label.text=itemConfig.name};return ShapeShiftingPropDetailWin}(BaseEuiView);__reflect(ShapeShiftingPropDetailWin.prototype,"ShapeShiftingPropDetailWin");ViewManager.ins().reg(ShapeShiftingPropDetailWin,LayerManager.UI_Popup);var ShapeShiftingRandomStorePanel=function(_super){__extends(ShapeShiftingRandomStorePanel,_super);function ShapeShiftingRandomStorePanel(){var _this=_super.call(this)||this;_this.skinName="ShapeShiftingRandomStoreSkin";return _this}ShapeShiftingRandomStorePanel.prototype.childrenCreated=function(){this.listView.itemRenderer=ShapeShiftingRandomStoreItemRenderer;this.dataArr=new eui.ArrayCollection;this.listView.dataProvider=this.dataArr};ShapeShiftingRandomStorePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.refreshShopBtn,this.onRefresh);this.addTouchEvent(this.btnHelp,this.onBtnHelp);this.observe(ShapeShiftingMgr.ins().postStoreList,this.updateData);this.observe(ShapeShiftingMgr.ins().postBuyRes,this.onBuyRes);this.observe(ShapeShiftingMgr.ins().postRefreshRes,this.onRefreshRes);ShapeShiftingMgr.ins().sendGetStoreList();TimerManager.ins().doTimer(1e3,0,this.updateRefreshTime,this);this.updateRefreshTime()};ShapeShiftingRandomStorePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.$onClose();this.removeTouchEvent(this.refreshShopBtn,this.onRefresh);TimerManager.ins().remove(this.updateRefreshTime,this)};ShapeShiftingRandomStorePanel.prototype.onBuyRes=function(param){var errid=param[0];var errmsg=param[1];if(errid!=0){UserTips.ins().showTips(errmsg)}};ShapeShiftingRandomStorePanel.prototype.onRefreshRes=function(param){var errid=param[0];var errmsg=param[1];UserTips.ins().showTips(errmsg)};ShapeShiftingRandomStorePanel.prototype.onRefresh=function(){ShapeShiftingMgr.ins().sendRefreshReq()};ShapeShiftingRandomStorePanel.prototype.onBtnHelp=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[49].text)};ShapeShiftingRandomStorePanel.prototype.updateData=function(){var arr=[];var list=ShapeShiftingMgr.ins().storeList;for(var k in list){var data={};var id=list[k];var cfg=GlobalConfig.ShapeShiftingRandomStoreConfig[id];data["idx"]=k;data["id"]=id;data["rate"]=cfg.rate;data["costMoney"]=cfg.costMoney;data["goods"]=cfg.goods;data["discountImg"]=cfg.discountImg;data["origPrice"]=cfg.origPrice;arr.push(data)}this.dataArr.replaceAll(arr);this.myLabel.text=ShapeShiftingMgr.ins().shapeChip+"";this.price.text=GlobalConfig.ShapeShiftingBaseConfig.refreshYuanBao.toString();this.noGoods.visible=arr.length<=0};ShapeShiftingRandomStorePanel.prototype.updateRefreshTime=function(){var curTime=GameServer.serverTime;var refreshTime=GlobalConfig.ShapeShiftingBaseConfig.refreshTime;var today=new Date;var offzet=curTime-today.getTime();var next;for(var _i=0,refreshTime_1=refreshTime;_i<refreshTime_1.length;_i++){var h=refreshTime_1[_i];var time=new Date(today.getFullYear(),today.getMonth(),today.getDate(),h,0,0).getTime()+offzet;if(time>curTime){next=time;break}}if(!next){next=new Date(today.getFullYear(),today.getMonth(),today.getDate(),refreshTime[0],0,0).getTime()+offzet+24*3600*1e3}this.refreshTime.text=i18n("ShapeShiftingRandomStorePanel_0")+DateUtils.getFormatBySecond(Math.floor((next-curTime)/1e3))};return ShapeShiftingRandomStorePanel}(BaseView);__reflect(ShapeShiftingRandomStorePanel.prototype,"ShapeShiftingRandomStorePanel");var ShapeShiftingSkillDescItemRender=function(_super){__extends(ShapeShiftingSkillDescItemRender,_super);function ShapeShiftingSkillDescItemRender(){var _this=_super.call(this)||this;_this.skinName="ShapeShiftingSkillDescSkin";return _this}ShapeShiftingSkillDescItemRender.prototype.dataChanged=function(){if(!this.data){return}var id=this.data["id"];var type=this.data["type"];var level=this.data["level"];var desc=this.data["desc"];var condition=this.data["condition"];var showCond=this.data["showCond"];var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[id];if(!info){return}var plevel=info.plevel||0;if(level<=plevel){var str=i18n("ShapeShiftingSkillDescItemRender_0",desc);this.desc.textFlow=TextFlowMaker.generateTextFlow1(str)}else{var str=i18n("ShapeShiftingSkillWin_0",desc,condition);if(!showCond){str=i18n("ShapeShiftingSkillWin_1",desc)}this.desc.textFlow=TextFlowMaker.generateTextFlow1(str)}};return ShapeShiftingSkillDescItemRender}(BaseItemRender);__reflect(ShapeShiftingSkillDescItemRender.prototype,"ShapeShiftingSkillDescItemRender");var ShapeShiftingSkillWin=function(_super){__extends(ShapeShiftingSkillWin,_super);function ShapeShiftingSkillWin(){var _this=_super.call(this)||this;_this.id=1;_this.type=ShapeSkillType.atkskill;_this.listData={};_this.isTopLevel=true;_this.skinName="ShapeShiftingSkillSkin";return _this}ShapeShiftingSkillWin.prototype.childrenCreated=function(){this.scrollBar.viewport=this.list;this.list.itemRenderer=ShapeShiftingSkillDescItemRender;this._listDt=new eui.ArrayCollection;this.list.dataProvider=this._listDt};ShapeShiftingSkillWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};ShapeShiftingSkillWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.id=param[0];this.type=param[1];this.listData=ShapeShiftingMgr.ins().getSkillList(this.id,this.type);this.addTouchEndEvent(this.bg,this.otherClose);this.setData()};ShapeShiftingSkillWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};ShapeShiftingSkillWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};ShapeShiftingSkillWin.prototype.getLowest=function(){var l=100;for(var k in this.listData){if(Number(k)<l){l=Number(k)}}if(l==100){l=0}return l};ShapeShiftingSkillWin.prototype.getSkillInfo=function(id,type,plevel,getName,getcondition){if(getName===void 0){getName=false}if(getcondition===void 0){getcondition=false}var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[id];if(!info){return""}var cfgs=GlobalConfig.ShapeShiftingPropConfig[id];if(!cfgs){return""}var cfg=cfgs[plevel];if(!cfg){return""}if(getcondition){return cfg.levelText}var skillId;switch(type){case ShapeSkillType.atkskill:skillId=cfg["atkskill"];break;case ShapeSkillType.talent:skillId=cfg["talent"];break;case ShapeSkillType.enterskill:skillId=cfg["enterskill"];break}if(!skillId){return""}var descID=GlobalConfig.SkillsConfig[skillId].desc;var desc=GlobalConfig.SkillsDescConfig[descID].desc;var name=GlobalConfig.SkillsDescConfig[descID].name;if(getName){return name}else{return desc}};ShapeShiftingSkillWin.prototype.setData=function(){var len=Object.keys(this.listData).length;if(len>1){this.currentState="multi";this.showMulti()}else{this.currentState="single"}var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[this.id];var plevel=Math.max(info&&info.plevel||0,0);var lowest=this.getLowest();var desc=this.getSkillInfo(this.id,this.type,lowest);var condition=this.getSkillInfo(this.id,this.type,lowest,false,true);var name=this.getSkillInfo(this.id,this.type,plevel,true);this.setSkillName(name);this.setSkillDesc(desc,condition)};ShapeShiftingSkillWin.prototype.setSkillName=function(name){this.nameLabel.text=name};ShapeShiftingSkillWin.prototype.setSkillDesc=function(desc,condition){var info=ShapeShiftingMgr.ins().getStateByID(this.id);if(info.state==ShapeState.unActivated||info.state==ShapeState.activatable){this.setGrey(desc,condition,true)}else{this.setGrey(desc,condition,false)}};ShapeShiftingSkillWin.prototype.setGrey=function(desc,condition,grey){if(grey===void 0){grey=false}var label;if(this.currentState=="single"){label=this.desc0}else{label=this.desc1}label.textFlow=TextFlowMaker.generateTextFlow1(desc);if(!grey){return}var desc_=label.text;var str=i18n("ShapeShiftingSkillWin_0",desc_,condition);if(grey){str=i18n("ShapeShiftingSkillWin_2",desc_)}label.textFlow=TextFlowMaker.generateTextFlow1(str)};ShapeShiftingSkillWin.prototype.showMulti=function(){var data=[];var lowest=this.getLowest();var showed=false;for(var k in this.listData){var level=Number(k);if(level>lowest){var desc=this.getSkillInfo(this.id,this.type,level);var condition=this.getSkillInfo(this.id,this.type,level,false,true);var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[this.id];var plevel=info&&info.plevel||0;var s=plevel<level&&!showed;if(s){showed=true}data.push({id:this.id,type:this.type,level:level,desc:desc,condition:condition,showCond:s})}}this._listDt.replaceAll(data)};return ShapeShiftingSkillWin}(BaseEuiView);__reflect(ShapeShiftingSkillWin.prototype,"ShapeShiftingSkillWin");ViewManager.ins().reg(ShapeShiftingSkillWin,LayerManager.UI_Popup);var ShapeShiftingStorePanel=function(_super){__extends(ShapeShiftingStorePanel,_super);function ShapeShiftingStorePanel(){var _this=_super.call(this)||this;_this.skinName="ShapeShiftingStoreSkin";return _this}ShapeShiftingStorePanel.prototype.childrenCreated=function(){this.listView.itemRenderer=ShapeShiftingMarketItemRenderer;this.dataArr=new eui.ArrayCollection;this.listView.dataProvider=this.dataArr};ShapeShiftingStorePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.getWay,this.onGetway);this.addTouchEvent(this.exchange,this.onExchange);this.addTouchEvent(this.btnHelp,this.onBtnHelp);this.observe(Shop.ins().postRefresSsMessage,this.updateData);this.observe(ShapeShiftingMgr.ins().postRefreshChip,this.callback);this.observe(Shop.ins().postUpdateBuySS,this.callback);this.observe(UserEquip.ins().postSmeltEquipComplete,this.showRedPoint);Shop.ins().sendSSMessage()};ShapeShiftingStorePanel.prototype.showRedPoint=function(){var canSmelt=ShapeShiftingMgr.ins().showSmeltRedP();this.redPoint_smelt.visible=canSmelt};ShapeShiftingStorePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.$onClose();this.removeTouchEvent(this.getWay,this.onGetway);this.removeTouchEvent(this.exchange,this.onExchange)};ShapeShiftingStorePanel.prototype.callback=function(){Shop.ins().sendSSMessage()};ShapeShiftingStorePanel.prototype.onGetway=function(){ViewManager.ins().open(PunchResWin,ShapeShiftingMgr.ins().PROP_TYPE_SHAPESHIFTING)};ShapeShiftingStorePanel.prototype.onExchange=function(){ViewManager.ins().open(ShapeShiftingMatialTransformWin)};ShapeShiftingStorePanel.prototype.onBtnHelp=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[44].text)};ShapeShiftingStorePanel.prototype.updateData=function(){var arr=[];var dataProvider=GlobalConfig.ShapeShiftingStoreConfig;for(var k in dataProvider){var isPush=true;if(dataProvider[k].buyType==FEATS_TYPE.forever&&Shop.ins().ssData){for(var i in Shop.ins().ssData.exchangeCount){if(dataProvider[k].id==Number(i)&&dataProvider[k].dayCount){if(Shop.ins().ssData.exchangeCount[i]>=dataProvider[k].dayCount){isPush=false}break}}}if(isPush)arr.push(dataProvider[k])}this.dataArr.replaceAll(arr);this.myLabel.text=ShapeShiftingMgr.ins().shapeChip+"";var text=this.getWay.text;this.getWay.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+text);text=this.exchange.text;this.exchange.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+text);this.showRedPoint()};return ShapeShiftingStorePanel}(BaseView);__reflect(ShapeShiftingStorePanel.prototype,"ShapeShiftingStorePanel");var ShapeShiftingTaskWin=function(_super){__extends(ShapeShiftingTaskWin,_super);function ShapeShiftingTaskWin(){var _this=_super.call(this)||this;_this.shapeId=1;_this.isTopLevel=true;return _this}ShapeShiftingTaskWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ShapeShiftingTaskWinSkin";this.list.itemRenderer=ItemBase;this.list0.itemRenderer=ItemBase};ShapeShiftingTaskWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.shapeId=param&&param[0]||1;this.data=param&&param[1]||[];this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.btnGet,this.onTouch);this.addTouchEvent(this.btnGet0,this.onTouch);this.addTouchEvent(this.arrowLast,this.onTouch);this.addTouchEvent(this.arrowNext,this.onTouch);this.observe(ShapeShiftingMgr.ins().postShapeShiftingInfo,this.setData);this.observe(ShapeShiftingMgr.ins().postTask,this.setData);this.observe(ShapeShiftingMgr.ins().postTaskTotal,this.setData);this.init()};ShapeShiftingTaskWin.prototype.init=function(){this.progressBar.labelDisplay.visible=false;this.setData()};ShapeShiftingTaskWin.prototype.onTouch=function(e){var num=0;switch(e.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.btnGet:ShapeShiftingMgr.ins().sendTaskAwardReq(this.shapeId,1);break;case this.btnGet0:ShapeShiftingMgr.ins().sendTaskAwardReq(this.shapeId,0);break;case this.arrowLast:this.toLast();break;case this.arrowNext:this.toNext();break}};ShapeShiftingTaskWin.prototype.toLast=function(){var id=this.getLast(this.shapeId);if(id>-1){this.toID(id)}};ShapeShiftingTaskWin.prototype.toNext=function(){var id=this.getNext(this.shapeId);if(id>0){this.toID(id)}};ShapeShiftingTaskWin.prototype.toID=function(id){ShapeShiftingMgr.ins().postToId(id);this.shapeId=id;this.init()};ShapeShiftingTaskWin.prototype.getIndex=function(id){for(var _i=0,_a=this.data;_i<_a.length;_i++){var v=_a[_i];if(v.id==id){return this.data.indexOf(v)}}return-1};ShapeShiftingTaskWin.prototype.getLast=function(id){var index=this.getIndex(id);var last=index-1;for(var i=last;i>=0;i--){var id_3=this.data[i].id;var res=ShapeShiftingMgr.ins().showBsRedTask(id_3);if(res){return id_3}}if(last>-1){return this.data[last].id}else{return-1}};ShapeShiftingTaskWin.prototype.getNext=function(id){var index=this.getIndex(id);var next=index+1;for(var i=next;i<this.data.length;i++){var id_4=this.data[i].id;var res=ShapeShiftingMgr.ins().showBsRedTask(id_4);if(res){return id_4}}if(next<this.data.length){return this.data[next].id}else{return-1}};ShapeShiftingTaskWin.prototype.setData=function(){this.setTaskTotal();this.setTask();var last=this.getLast(this.shapeId);var next=this.getNext(this.shapeId);this.arrowLast.visible=last>0;this.arrowNext.visible=next>0;this.redPointLast.visible=last>0&&ShapeShiftingMgr.ins().showBsRedTask(last);this.redPointNext.visible=next>0&&ShapeShiftingMgr.ins().showBsRedTask(next)};ShapeShiftingTaskWin.prototype.setTaskTotal=function(){var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[this.shapeId]["task"];var cfg=GlobalConfig.ShapeShiftingTaskAwardsConfig[this.shapeId];var level=info["task2level"]||1;var reward=cfg[level].reward;var pointTarget=cfg[level].pointTarget;var point=info["task2point"]||0;var state=info["task2state"]||0;this.list.dataProvider=new ArrayCollection(reward);this.btnGet.touchEnabled=state==1;this.redPoint.visible=state==1;this.btnGet.visible=state!=2;this.btnGet.enabled=state==1;if(state==2){this.unfinish.visible=false;this.finished.visible=true}else{this.unfinish.visible=true;this.finished.visible=false;this.setBar(point,pointTarget)}};ShapeShiftingTaskWin.prototype.setTask=function(){var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[this.shapeId]["task"];var cfg=GlobalConfig.ShapeShiftingTaskConfig[this.shapeId];var id=info["task1id"]||1;var reward=cfg[id].reward;var desc=cfg[id].targetdesc;var state=info["task1state"]||0;this.list0.dataProvider=new ArrayCollection([reward[0]]);this.desc.textFlow=TextFlowMaker.generateTextFlow(desc);this.btnGet0.enabled=state==1;this.redPoint0.visible=state==1;this.btnGet0.visible=state!=2};ShapeShiftingTaskWin.prototype.setBar=function(value,max){if(value===void 0){value=0}if(max===void 0){max=100}this.progressBar.maximum=max;this.progressBar.value=value;this.barTxt.text=value+"/"+max};return ShapeShiftingTaskWin}(BaseEuiView);__reflect(ShapeShiftingTaskWin.prototype,"ShapeShiftingTaskWin");ViewManager.ins().reg(ShapeShiftingTaskWin,LayerManager.UI_Popup);var ShapeshiftingTips=function(_super){__extends(ShapeshiftingTips,_super);function ShapeshiftingTips(){var _this=_super.call(this)||this;_this.RES_DIR=RES_DIR_ROLE;_this.skinName="ShapeshiftingTipsSkin";return _this}ShapeshiftingTips.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.gainList.itemRenderer=RingGainItem};ShapeshiftingTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var itemConfig=param[0];if(!itemConfig){return}var id=ShapeShiftingMgr.ins().isBianshenProp(itemConfig.id);if(!id){return}this.itemData=GlobalConfig.ShapeShiftingConfig[id];this.nameLabel.text=this.itemData.name;var rankRes=this.itemData.rankRes;var mc=new MovieClip;mc.playFile(RES_DIR_EFF+rankRes,-1);this.rankGroup.addChild(mc);var mcX=201;var mcY=279;var level=ShapeShiftingMgr.ins().getMaxLevel(id);var cfg=GlobalConfig.ShapeShiftingConfig[id];var cfg2=GlobalConfig.ShapeShiftingLevelConfig[id][1][level];var appearance=cfg2.appearance||"body001r_0_c";if(appearance.indexOf("monster")>-1){this.RES_DIR=RES_DIR_MONSTER}else{this.RES_DIR=RES_DIR_ROLE}this.mcGroup.x=mcX;this.mcGroup.y=mcY;var showScale=(cfg["showScale"]||100)/100;this.mcGroup.scaleX=this.mcGroup.scaleY=showScale*.7;imageToMc(this.mcImg,appearance,this.mcGroup,null,this.RES_DIR,false,true);var attrs=cfg2.attrs;var curAttrs=AttributeData.getAttStr(attrs,2,1,"：",true,true,null,"",true);this.attr.text=curAttrs;var power=UserBag.getAttrPower(attrs);this.powerPanel.setPower(power);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.btnUse,this.onTap);this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);var gainConfig=GlobalConfig.GainItemConfig[this.itemData.mat];if(gainConfig){this.gainList.dataProvider=new eui.ArrayCollection(gainConfig.gainWay)}};ShapeshiftingTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this)};ShapeshiftingTips.prototype.onTouchList=function(e){ViewManager.ins().close(this);var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2],true)}};ShapeshiftingTips.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.btnUse:ViewManager.ins().close(this);ViewManager.ins().open(ShapeShiftingWin,0,this.itemData.id);break}};return ShapeshiftingTips}(BaseEuiView);__reflect(ShapeshiftingTips.prototype,"ShapeshiftingTips");ViewManager.ins().reg(ShapeshiftingTips,LayerManager.UI_Popup);var ShapeShiftingWearWin=function(_super){__extends(ShapeShiftingWearWin,_super);function ShapeShiftingWearWin(){var _this=_super.call(this)||this;_this.skinName="ShapeShiftWearSkin";_this.isTopLevel=true;return _this}ShapeShiftingWearWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this.bg,this.otherClose);this.addTouchEndEvent(this.closeBtn,this.otherClose);this.observe(ShapeShiftingMgr.ins().postShapeShiftingInfo,this.initUI);this.observe(GameLogic.ins().postSubRoleChange,this.initUI);this.shapeID=param[0];this.initUI()};ShapeShiftingWearWin.prototype.initUI=function(){this.state_wear2.visible=false;this.removeBtnEvent();this.jobImg1.source="";this.jobImg2.source="";this.jobImg3.source="";var len=SubRoles.ins().subRolesLen;for(var i=1;i<=len;i++){var lock=this["bs_lock"+i];var btn=this["btn"+i];var item=this["item"+i];var job=SubRoles.ins().roles[i-1].job||1;this["jobImg"+i].source="job"+job+"Item";lock.visible=false;var data=this.getItemData(i);if(data.id==this.shapeID){btn.visible=false;this.state_wear2.visible=true;this.state_wear2.x=btn.x+3}else{if(data.id>-1&&data.id!=this.shapeID){btn.label=i18n("ShapeShiftingWearWin_0")}else if(data.id<1){btn.label=i18n("ShapeShiftingWearWin_1");item.hideLevel()}btn.visible=true;this.addTouchEvent(btn,this.wearShape)}var data=this.getItemData(i);item.data=data}for(var i=len+1;i<=3;i++){var lock=this["bs_lock"+i];var btn=this["btn"+i];var item=this["item"+i];lock.visible=true;btn.label=i18n("ShapeShiftingWearWin_2");this.addTouchEvent(btn,this.unlockRole);var data=this.getItemData(i);item.data=data;item.hideLevel()}};ShapeShiftingWearWin.prototype.getItemData=function(roleId){if(roleId===void 0){roleId=1}var obj=new ShapeShiftingItemData;obj["state"]=ShapeState.activated;obj["pageId"]=3;var cfg=GlobalConfig.ShapeShiftingConfig;var selectedShapeId=ShapeShiftingMgr.ins().SelectedShapeId;var shapeID=selectedShapeId[roleId];var v=cfg[shapeID];var info=ShapeShiftingMgr.ins().myShapeShiftingInfo;if(!v){return obj}if(shapeID>-1){obj["icon"]=v.icon;obj["roleId"]=roleId;obj["id"]=shapeID;obj["rank"]=v.rank;obj["level"]=info[shapeID].level||1;obj["plevel"]=info[shapeID].plevel||0}return obj};ShapeShiftingWearWin.prototype.unlockRole=function(e){switch(e.target){case this.btn1:case this.btn2:case this.btn3:ViewManager.ins().open(NewRoleWin);break}};ShapeShiftingWearWin.prototype.wearShape=function(e){switch(e.target){case this.btn1:this.sendWearShape(1);break;case this.btn2:this.sendWearShape(2);break;case this.btn3:this.sendWearShape(3);break}};ShapeShiftingWearWin.prototype.sendWearShape=function(roleId){if(ShapeShiftingMgr.ins().getIsInShape()){UserTips.ins().showCenterTips(i18n("ShapeShiftingWearWin_3"));return}ShapeShiftingMgr.ins().sendShapeWear(this.shapeID,roleId)};ShapeShiftingWearWin.prototype.removeBtnEvent=function(){for(var i=1;i<=3;i++){var btn=this["btn"+i];this.removeTouchEvent(btn,this.wearShape);this.removeTouchEvent(btn,this.unlockRole)}};ShapeShiftingWearWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeBtnEvent();this.removeTouchEvent(this.bg,this.otherClose);this.removeTouchEvent(this.closeBtn,this.otherClose)};ShapeShiftingWearWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};return ShapeShiftingWearWin}(BaseEuiView);__reflect(ShapeShiftingWearWin.prototype,"ShapeShiftingWearWin");ViewManager.ins().reg(ShapeShiftingWearWin,LayerManager.UI_Main);var ShapeShiftingWin=function(_super){__extends(ShapeShiftingWin,_super);function ShapeShiftingWin(){var _this=_super.call(this)||this;_this.giftlistData=[];_this.itemlistData=[];_this.itemlistData2=[];_this.curShapeID=null;_this.needPlay=false;_this.gainBtnPos={1:[{x:100,y:0}],2:[{x:50,y:0},{x:150,y:0}]};_this.canBreak=false;_this.lastLevel=0;_this.green=5893404;_this.red=15937822;_this.costItemId=0;_this.costItemId0=0;_this.costNum=0;_this.costNum0=0;_this.pageID=0;_this.sValue=null;_this.clicked=false;_this.skinName="ShapeShiftingWinSkin";_this.isTopLevel=true;return _this}ShapeShiftingWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.itemList.itemRenderer=ShapeShiftingItemRenderer;this.itemScroller.viewport=this.itemList;this.giftList.itemRenderer=SwordSkinGiftRenderer;this.giftScroller.viewport=this.giftList};ShapeShiftingWin.prototype.childrenCreated=function(){if(ChannelMgr.ins().isRechargeHidden()){this.shop1.name=i18n("ShapeShiftingWin_41");this.shop2.name=i18n("ShapeShiftingWin_42")}else{this.shop1.name=i18n("ShapeShiftingWin_43");this.shop2.name=i18n("ShapeShiftingWin_44")}};ShapeShiftingWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var guanQiaID=UserFb.ins().guanqiaID;var openChapterLevel=GlobalConfig.ShapeShiftingBaseConfig.openChapterLevel;if(guanQiaID<openChapterLevel){UserTips.ins().showTips(i18n("ShapeShiftingWin_0",guanQiaID))}return guanQiaID>=openChapterLevel};ShapeShiftingWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var page=param[0]||0;if(page==1&&ShapeShiftingMgr.ins().noActivate()){UserTips.ins().showTips(i18n("ShapeShiftingWin_26"));page=0}var id=param[1]||null;if(id){this.curShapeID=id;this.needPlay=true}this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.btnHelp,this.onClick);this.addTouchEvent(this.btnActivate,this.onClick);this.addTouchEvent(this.btnSet,this.onClick);this.addTouchEvent(this.btnUpgrade,this.onClick);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.checkIsOpen);this.addTouchEvent(this.btnUp,this.onClick);this.addTouchEvent(this.btnSkill,this.onClick);this.addTouchEvent(this.btnTalent,this.onClick);this.addTouchEvent(this.btnEnterSkill,this.onClick);this.addTouchEvent(this.btnBreakSkill,this.onClick);this.addTouchEvent(this.btnDetail,this.onClick);this.addTouchEvent(this.propbg,this.onClick);this.addTouchEvent(this.btnProp,this.onClick);this.addTouchEvent(this.btnTask,this.onClick);this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.giftList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGiftTap,this);this.observe(ShapeShiftingMgr.ins().postShapeShiftingInfo,this.updatePanel);this.observe(ShapeShiftingMgr.ins().postShapeShiftingActivate,this.onActivate);this.observe(ShapeShiftingMgr.ins().postShapeShiftingUpgrade,this.onUpgrade);this.observe(ShapeShiftingMgr.ins().postShapeShiftingUpgradeBreak,this.onUpgradeBreak);this.observe(ShapeShiftingMgr.ins().postTask,this.onTaskRefresh);this.observe(ShapeShiftingMgr.ins().postTaskTotal,this.onTaskRefresh);this.observe(ShapeShiftingMgr.ins().postPropLevelUp,this.onPropLevelUp);this.observe(ShapeShiftingMgr.ins().postRefreshExp,this.refreshExp);this.observe(ShapeShiftingMgr.ins().postToId,this.toId);this.observe(UserZs.ins().postZsLv,this.refreshShape);this.observe(Actor.ins().postLevelChange,this.refreshShape);this.observe(Shop.ins().postBuyResult,this.refreshCost);this.observe(UserEquip.ins().postSmeltEquipComplete,this.showRedPoint);this.observe(UserBag.ins().postItemAdd,this.updatePropLevelUp);this.observe(UserBag.ins().postItemDel,this.updatePropLevelUp);this.observe(UserBag.ins().postItemChange,this.updatePropLevelUp);ShapeShiftingMgr.ins().sendGetShapeShiftingInfo();var self=this;setTimeout(function(){self.tab.selectedIndex=page;self.setOpenIndex(page)},50)};ShapeShiftingWin.prototype.onGiftTap=function(e){this.giftList.selectedIndex=e.itemIndex;this.showGiftDetail()};ShapeShiftingWin.prototype.getGiftIcon=function(giftID){var icon="";if(giftID<1){return icon}var cfg=GlobalConfig.ShapeShiftingGiftConfig[giftID];if(!cfg){return icon}icon=cfg.des["icon"]||"";return icon};ShapeShiftingWin.prototype.updateGift=function(attrs){var self=this;var arr=[];var cfg=GlobalConfig.ShapeShiftingConfig[this.curShapeID];var exskill=cfg.exskill;var power=UserBag.getAttrPower(attrs);if(!exskill){this.giftList.dataProvider=new eui.ArrayCollection(arr);this.giftlistData=arr;this.powerPanel.setPower(power);return}var giftIDs=[];if(exskill&&exskill.length>0){for(var i=0;i<exskill.length;i++){giftIDs.push(exskill[i])}}var unlockedID=[];for(var i=0;i<giftIDs.length;i++){var obj=giftIDs[i];var id=obj["id"];var openlv=obj["openlv"];var data=new SwordSkinGiftData;data.id=id;data.icon=this.getGiftIcon(id);data.activated=false;data.openlv=openlv;var info=ShapeShiftingMgr.ins().getInfoByID(this.curShapeID);if(info["stage"]&&info["stage"]>=openlv){data.activated=true;unlockedID.push(data.id)}arr.push(data)}this.giftList.dataProvider=new eui.ArrayCollection(arr);this.giftlistData=arr;for(var i=0;i<unlockedID.length;i++){var attrs2=this.getGiftAttrs(unlockedID[i]);power+=UserBag.getAttrPower(attrs2)}this.powerPanel.setPower(power)};ShapeShiftingWin.prototype.getGiftAttrs=function(giftID){var attrs=[];var cfg=GlobalConfig.ShapeShiftingGiftConfig[giftID];if(!cfg){console.log(i18n("ShapeShiftingWin_1")+giftID);return null}attrs=cfg.attrs;if(!attrs||attrs.length<1){console.log(i18n("ShapeShiftingWin_2")+giftID);return null}return attrs};ShapeShiftingWin.prototype.showGiftDetail=function(){var idx=this.giftList.selectedIndex;var data=this.giftlistData[idx];if(!data){return}var gid=data.id;var cfg=GlobalConfig.ShapeShiftingGiftConfig[gid];if(!cfg){return}var name=cfg.des["name"]||"";var attrs=this.getGiftAttrs(gid);var desc=AttributeData.getAttStr(attrs,0,1,"：")+"\n";var cond=numToJie(data.openlv);if(data.activated){cond=""}ViewManager.ins().open(SwordSkinGiftTips,name,desc,cond)};ShapeShiftingWin.prototype.updatePanel=function(){var cfg=GlobalConfig.ShapeShiftingConfig;var arr=[];var arr2=[];var info=ShapeShiftingMgr.ins().myShapeShiftingInfo;for(var key in cfg){var v=cfg[key];var s=ShapeShiftingMgr.ins().getStateByID(v.id);var isShow=ShapeShiftingMgr.ins().isShowShape(v.id);if(isShow){var obj=new ShapeShiftingItemData;obj["id"]=v.id;obj["sort"]=v.sort;obj["icon"]=v.icon;obj["rank"]=v.rank;obj["state"]=s.state;obj["roleId"]=s.roleId;obj["pageId"]=1;obj["level"]=info[v.id].level||1;obj["plevel"]=info[v.id].plevel||0;arr.push(obj);if(s.state==ShapeState.activated||s.state==ShapeState.wearing){var obj2=new ShapeShiftingItemData;obj2["id"]=v.id;obj2["sort"]=v.sort;obj2["icon"]=v.icon;obj2["rank"]=v.rank;obj2["state"]=s.state;obj2["roleId"]=s.roleId;obj2["pageId"]=2;obj2["level"]=info[v.id].level||1;obj2["plevel"]=info[v.id].plevel||0;arr2.push(obj2)}}}arr.sort(this.sortFunc);arr2.sort(this.sortFunc2);var tempArr=this.tab.selectedIndex==0?arr:arr2;this.itemlistData=tempArr;this.itemlistData2=arr2;this.itemList.dataProvider=new eui.ArrayCollection(tempArr);this.arrowleft.visible=tempArr.length>5;this.arrowright.visible=this.arrowleft.visible;this.IDchange(tempArr)};ShapeShiftingWin.prototype.IDchange=function(tempArr){var index=this.idToIndex(this.curShapeID);this.itemList.selectedIndex=index;var self=this;if(index>4){if(index+2<tempArr.length){setTimeout(function(){self.itemScroller.viewport.scrollH=(index-3)*88},10)}else{setTimeout(function(){self.itemScroller.viewport.scrollH=(self.itemlistData.length-5)*88},10)}}this.updateDetail();this.showRedPoint()};ShapeShiftingWin.prototype.toId=function(param){var id=param[0];this.curShapeID=id;this.needPlay=true;this.IDchange(this.itemlistData)};ShapeShiftingWin.prototype.showRedPoint=function(){this.redPoint_task.visible=ShapeShiftingMgr.ins().showBsRedTask(this.curShapeID);this.redPoint_bs.visible=ShapeShiftingMgr.ins().showBsRedP()||ShapeShiftingMgr.ins().showBsRedTask();this.redPoint_sj.visible=ShapeShiftingMgr.ins().showSjRedP();this.redPoint_sd.visible=ShapeShiftingMgr.ins().showSmeltRedP()};ShapeShiftingWin.prototype.idToIndex=function(shapeID){var index=0;if(!shapeID){shapeID=this.curShapeID}if(!shapeID){return index}for(var i=0;i<this.itemlistData.length;i++){if(this.itemlistData[i].id==shapeID){index=i;break}}return index};ShapeShiftingWin.prototype.updateDetail=function(){var self=this;var curIdx=this.itemList.selectedIndex;var data=this.itemlistData[curIdx];if(!data){return}var shapeId=data.id;var needReplay=false;if(this.curShapeID==shapeId){if(this.needPlay){needReplay=true;this.needPlay=false}else{needReplay=false}}else{this.curShapeID=shapeId;needReplay=true}var cfg=GlobalConfig.ShapeShiftingConfig[shapeId];if(!cfg){console.log("ShapeShiftingConfig["+shapeId+"] = null");return}var bsname=cfg["name"];this.nameLabel.text=bsname;var bg=cfg["bg"]||"bs_bg_1_jpg";this.bs_bg.source=bg;var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[shapeId];var showStage=Math.max(info&&info.stage||1,1);var level=Math.max(info&&info.level||0,1);var plevel=Math.max(info&&info.plevel||0,0);var cfg2=GlobalConfig.ShapeShiftingLevelConfig[shapeId][showStage][level];var cfg_nextLevel=GlobalConfig.ShapeShiftingLevelConfig[shapeId][showStage][level+1];var appearance=cfg2.appearance||"body001r_0_c";if(appearance.indexOf("monster")>-1){appearance=RES_DIR_MONSTER+appearance}else{appearance=RES_DIR_ROLE+appearance}if(needReplay){var dizuo="";var eff="";if(bg=="bs_bg_1_jpg"){dizuo="bs_bg_1_dz_png";eff="bs_bg_1_dzeff"}else if(bg=="bs_bg_2_jpg"){dizuo="bs_bg_2_dz_png";eff="bs_bg_2_dzeff"}else if(bg=="bs_bg_3_jpg"){dizuo="bs_bg_3_dz_png";eff="bs_bg_3_dzeff"}this.imgDizuo.source=dizuo;imageToMc(this.imgDizuo,eff,this.dzMc,null,RES_DIR_EFF,false,true);var offX=cfg["offX"]||0;var offY=cfg["offY"]||0;var dzoffY=cfg["dzoffY"]||0;this.mcGroup.y=-100-offY;this.mcGroup.horizontalCenter=5.5+offX;this.imgDizuo.y=0-dzoffY;var showScale=(cfg["showScale"]||100)/100;this.mcGroup.scaleX=this.mcGroup.scaleY=showScale;this.mcGroup.removeChildren();this.iconMc=new MovieClip;this.iconMc.x=0;this.iconMc.y=0;this.mcGroup.addChild(this.iconMc);this.iconMc.playFile(appearance,-1);this.lastLevel=level;var rankRes=cfg["rankRes"];var mc=new MovieClip;mc.playFile(RES_DIR_EFF+rankRes,-1);this.rankGroup.removeChildren();this.rankGroup.addChild(mc)}this.lv.text=numToJie(showStage);this.level.text=level.toString()+i18n("ShapeShiftingWin_3");var cfg3=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel];var levelText=cfg3&&cfg3.levelText||"";var levelbg=cfg3&&cfg3.levelbg||"bsbl_kuang_0";this.btnProp["bg"].source=levelbg;this.propbg.source=levelbg;var breakskill=cfg3.breakskill||0;var cfg4=GlobalConfig.ShapeShiftingGiftConfig[breakskill]||undefined;if(cfg4){this.btnBreakSkill.icon=cfg4.des.icon}var attrs=cfg2.attrs;var next_attrs=cfg_nextLevel&&cfg_nextLevel.attrs||attrs;var max=ShapeShiftingMgr.ins().getMaxPropLevel(shapeId);var attrRatio=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel].attrRatio;var attrs_ext=[];for(var _i=0,attrs_3=attrs;_i<attrs_3.length;_i++){var v=attrs_3[_i];var a={type:v.type,value:Math.floor(v.value*(1+attrRatio/100))};attrs_ext.push(a)}var next_attrs_ext=[];for(var _a=0,next_attrs_2=next_attrs;_a<next_attrs_2.length;_a++){var v=next_attrs_2[_a];var a={type:v.type,value:Math.floor(v.value*(1+attrRatio/100))};next_attrs_ext.push(a)}var curAttrs=AttributeData.getAttStr(attrs_ext,0,1,"：",false,true,null,"",false,65280,16777215)+"\n";var nextAttrs=AttributeData.getAttStr(next_attrs_ext,0,1,"：",false,true,null,"",false,65280,16777215)+"\n";var attrRatioValue=attrRatio||0;this.cAttr.text="("+(100+attrRatioValue)+"%)";this.c1Attr.text="("+(100+attrRatioValue)+"%)";this.nAttr.text="("+(100+attrRatioValue)+"%)";this.attr.text="("+(100+attrRatioValue)+"%)";this.curAtt0.textFlow=TextFlowMaker.generateTextFlow(curAttrs);this.curAtt.textFlow=TextFlowMaker.generateTextFlow(curAttrs);this.curAtt1.textFlow=TextFlowMaker.generateTextFlow(curAttrs);this.nextAtt.textFlow=TextFlowMaker.generateTextFlow(nextAttrs);this.clevel.text=cfg2.level+i18n("ShapeShiftingWin_5");this.c1level.text=cfg2.level+i18n("ShapeShiftingWin_6");this.nlevel.text=(cfg_nextLevel&&cfg_nextLevel.level||160)+i18n("ShapeShiftingWin_7");if(ShapeShiftingMgr.ins().isMaxLevel(shapeId)==false){this.cGroup.visible=this.cursor.visible=this.nGroup.visible=true;this.c1Group.visible=false}else{this.cGroup.visible=this.cursor.visible=this.nGroup.visible=false;this.c1Group.visible=true}this.updateBianshen(shapeId,attrs_ext);this.updateLevelUp(shapeId,showStage,level);this.updateGainWay(shapeId,cfg.gainWay)};ShapeShiftingWin.prototype.refreshExp=function(){if(!ShapeShiftingMgr.ins().myShapeShiftingInfo||!this.curShapeID){return}var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[this.curShapeID];var stage=Math.max(info&&info.stage||1,1);var level=Math.max(info&&info.level||0,1);var cfg=GlobalConfig.ShapeShiftingLevelConfig[this.curShapeID][stage][level];var exp=ShapeShiftingMgr.ins().exp;this.expTxt.text=exp.toString();var cost=cfg.exp;this.expTxt.textColor=exp>=cost?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N};ShapeShiftingWin.prototype.refreshCost=function(){if(!ShapeShiftingMgr.ins().myShapeShiftingInfo||!this.curShapeID){return}var shapeId=this.curShapeID;var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[shapeId];var showStage=Math.max(info&&info.stage||1,1);var level=Math.max(info&&info.level||0,1);this.updateLevelUp(shapeId,showStage,level)};ShapeShiftingWin.prototype.updateGainWay=function(shapeId,gainWay){if(gainWay===void 0){gainWay=[]}this.gainWayGroup.removeChildren();var info=ShapeShiftingMgr.ins().getStateByID(shapeId);if(info.state==ShapeState.activated||info.state==ShapeState.wearing){this.noGainWay.visible=false;return}if(!gainWay||gainWay.length<1){this.noGainWay.visible=true;return}this.noGainWay.visible=false;var btnList=[];for(var i=0;i<gainWay.length;i++){var way=gainWay[i];var label=way[0];var winName=way[1];var param=way[2];if(label&&winName){var btn=new ShapeShiftingGainWayBtn(label,winName,param);this.gainWayGroup.addChild(btn);btnList.push(btn)}}for(var i=0;i<btnList.length;i++){var btn=btnList[i];btn.anchorOffsetX=btn.width/2;btn.x=this.gainBtnPos[btnList.length][i].x;btn.y=this.gainBtnPos[btnList.length][i].y}};ShapeShiftingWin.prototype.updateBianshen=function(shapeId,attrs){var shapeState=ShapeShiftingMgr.ins().getStateByID(shapeId);var state=shapeState.state;var roleId=shapeState.roleId;this.activateGroup.visible=false;this.btnSet.visible=false;this.redPoint.visible=false;this.sState_unactivated.visible=false;this.sState_wearing.visible=false;this.noMat.visible=false;this.btnActivate.currentState="up";this.btnActivate.$touchEnabled=true;this.propbg.visible=true;this.countGroup.visible=false;this.btnDetail.visible=true;var cfg=GlobalConfig.ShapeShiftingConfig[shapeId];this.btnSkill.icon=cfg.asIcon||"bs_skill";this.btnTalent.icon=cfg.tsIcon||"bs_talent";this.btnEnterSkill.icon=cfg.esIcon||"bs_enter";switch(state){case ShapeState.activatable:this.activateGroup.visible=true;this.redPoint.visible=true;break;case ShapeState.activated:this.btnSet.visible=true;this.btnSet.label=i18n("ShapeShiftingWin_10");this.countGroup.visible=true;break;case ShapeState.unActivated:this.activateGroup.visible=true;this.sState_unactivated.visible=true;this.btnActivate.currentState="disabled";this.btnActivate.touchEnabled=false;break;case ShapeState.wearing:this.btnSet.visible=true;this.sState_wearing.visible=true;this.btnSet.label=i18n("ShapeShiftingWin_11");this.countGroup.visible=true;break}this.updateCost();this.updateGift(attrs)};ShapeShiftingWin.prototype.updateLevelUp=function(shapeId,stageLevel,lv){if(stageLevel===void 0){stageLevel=1}if(lv===void 0){lv=0}this.redPoint0.visible=ShapeShiftingMgr.ins().canLevelUp(this.curShapeID);this.updateGroup.visible=true;this.canBreak=false;this.levelUpGroup.visible=true;this.breakUpGroup.visible=false;this.updatePropLevelUp();var cfg=GlobalConfig.ShapeShiftingLevelConfig[shapeId][stageLevel][lv];if(!cfg){console.log("ShapeShiftingWin.ts L335 !cfg return");return}this.costItemId=GlobalConfig.ShapeShiftingBaseConfig.costItemId;var costNum=cfg.count;this.btnUpgrade.label=i18n("ShapeShiftingWin_13");this.btnProp["label_mat"].visible=false;if(!ShapeShiftingMgr.ins().isMaxLevel(shapeId)){this.maxDesc.visible=false;this.levelUpGroup.visible=false;this.breakUpGroup.visible=true;this.updateGroup.visible=true;var level=Actor.level;var zslv=UserZs.ins().lv;if((cfg.needzslv||0)>0&&zslv<(cfg.needzslv||0)){this.costTxt1.text=i18n("ShapeShiftingWin_36");this.costTxt0.textFlow=TextFlowMaker.generateTextFlow(i18n("ShapeShiftingWin_38",cfg.needzslv))}else if((cfg.needlv||0)>0&&level<(cfg.needlv||0)){this.costTxt1.text=i18n("ShapeShiftingWin_35");this.costTxt0.textFlow=TextFlowMaker.generateTextFlow(i18n("ShapeShiftingWin_37",cfg.needlv))}else if(cfg.breakcost||cfg.breakcost!=undefined){var breaklevel=GlobalConfig.ShapeShiftingLevelConfig[shapeId][stageLevel][lv].breaklevel;var plevel=ShapeShiftingMgr.ins().myShapeShiftingInfo[shapeId].plevel;var levelText=GlobalConfig.ShapeShiftingPropConfig[shapeId][breaklevel].levelText;if(plevel<breaklevel){this.costItemId=GlobalConfig.ShapeShiftingConfig[shapeId].mat;this.costNum=GlobalConfig.ShapeShiftingPropConfig[shapeId][breaklevel].needCount;this.costTxt1.text=i18n("ShapeShiftingWin_39");this.costTxt0.textFlow=TextFlowMaker.generateTextFlow(i18n("ShapeShiftingWin_40",levelText))}var breakcost=GlobalConfig.ShapeShiftingLevelConfig[shapeId][stageLevel][lv].breakcost;var str="";for(var _i=0,breakcost_2=breakcost;_i<breakcost_2.length;_i++){var v=breakcost_2[_i];var id=v.id;var num=v.num;var cfg3=GlobalConfig.ItemConfig[id];if(!cfg3){console.log(i18n("ShapeShiftingWin_15")+id);return}var mat_name=cfg3.name;var isHave=UserBag.ins().getBagGoodsCountById(0,id);var color=this.green;if(isHave<num){color=this.red;if(plevel>=breaklevel){this.costItemId=id;this.costNum=num}}str+=i18n("ShapeShiftingWin_28")+color+"&T:"+mat_name+" "+isHave+i18n("ShapeShiftingWin_29")+num+"|"}if(plevel>=breaklevel){this.costTxt1.text=i18n("ShapeShiftingWin_14");this.costTxt0.textFlow=TextFlowMaker.generateTextFlow1(str)}}else{this.levelUpGroup.visible=true;this.breakUpGroup.visible=false;this.btnUpgrade.label=i18n("ShapeShiftingWin_12");var exp=ShapeShiftingMgr.ins().exp;this.expTxt.text=exp.toString();var cost=cfg.exp;this.costExp.text=" / "+cost.toString();this.expTxt.textColor=exp>=cost?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N;var cfg2=GlobalConfig.ItemConfig[this.costItemId];if(!cfg2){console.log(i18n("ShapeShiftingWin_25")+this.costItemId);return}if(exp<cost){var useArg=cfg2.useArg;var per=useArg&&useArg["exp"]||-1;if(per>0){var count=Math.ceil((cost-exp)/per);this.costNum=count}else{this.costNum=0}}else{this.costNum=0}}}else{this.maxDesc.visible=true;this.levelUpGroup.visible=false;this.breakUpGroup.visible=false;this.updateGroup.visible=false}if(cfg.breakcost||cfg.breakcost!=undefined){var breaklevel=GlobalConfig.ShapeShiftingLevelConfig[shapeId][stageLevel][lv].breaklevel;var plevel=ShapeShiftingMgr.ins().myShapeShiftingInfo[shapeId].plevel;this.btnProp["label_mat"].visible=plevel<breaklevel&&!this.btnUp.visible}};ShapeShiftingWin.prototype.updatePropLevelUp=function(){var shapeId=this.curShapeID;var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[shapeId];var plevel=info&&info.plevel||0;var stage=info&&info.stage||-1;if(stage==-1){this.propGroup.visible=false;return}var max=ShapeShiftingMgr.ins().getMaxPropLevel(shapeId);var attrRatio=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel].attrRatio||0;var needCount=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel].needCount||0;var nattrRatio=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel+1>max?max:plevel+1].attrRatio||0;this.propGroup.visible=true;if(plevel>=max){this.btnProp["countGroup"].visible=false;this.countGroup.visible=false;this.btnProp["label_mat"].visible=false;this.btnUp.visible=false;this.redPoint1.visible=false;return}this.btnProp["countGroup"].visible=true;this.countGroup.visible=true;var mat=GlobalConfig.ShapeShiftingConfig[shapeId].mat;var limitBreakItem=GlobalConfig.ShapeShiftingConfig[shapeId].limitBreakItem;var publicBreakItem=GlobalConfig.ShapeShiftingBaseConfig.publicBreakItem;var have1=UserBag.ins().getBagGoodsCountById(0,mat);var have2=UserBag.ins().getBagGoodsCountById(0,limitBreakItem);var have3=UserBag.ins().getBagGoodsCountById(0,publicBreakItem);var itemConfig=GlobalConfig.ItemConfig[mat];var itemName=itemConfig.name;var mat_color=this.green;var color=ColorUtil.RED_COLOR_N;if(have1+have2+have3<needCount){this.btnUp.visible=false}else{this.btnProp["label_mat"].visible=false;color=242004;this.btnUp.visible=true}this.btnCb=ShapeShiftingMgr.ins().getPropUpCb(shapeId);if(have1<needCount){this.redPoint1.visible=false}else{this.redPoint1.visible=true}var str=have1.toString();if(have2+have3>0){str+="+"+(have2+have3).toString()}this.btnProp["label_count"].textFlow=TextFlowMaker.generateTextFlow1("|C:"+color+"\n\t\t\t&T:"+str+"||C:0x99BDB8&T:/"+needCount+"|");this.label_count0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+color+"\n\t\t\t&T:"+str+"||C:0x99BDB8&T:/"+needCount+"|")};ShapeShiftingWin.prototype.setUpEff=function(){this.upGroup.removeChildren();this.upEffect=new MovieClip;this.upGroup.addChild(this.upEffect);this.upEffect.playFile(RES_DIR_EFF+"promoteeff",1);UserTips.ins().showTips(i18n("ShapeShiftingWin_21"))};ShapeShiftingWin.prototype.updateCost=function(){var shapeId=this.curShapeID;var color=this.green;var cfg=GlobalConfig.ShapeShiftingConfig[shapeId];this.costTxt.y=5;if(!cfg){console.log("ShapeShiftingConfig["+shapeId+"] = null");return}var actWay=cfg.actWay||1;var job=cfg.job||0;var mjob=SubRoles.ins().getFirstJob();if(job>=1&&job<=3){if(job==mjob){actWay=1}else{actWay=2}}if(actWay==1){var zsLv=cfg.suit;var currCount=ShapeShiftingMgr.ins().getHejiCount(zsLv);if(currCount<8){color=this.red}this.costTxt.textFlow=TextFlowMaker.generateTextFlow1(i18n("ShapeShiftingWin_22")+(zsLv>0?i18n("ShapeShiftingWin_23",zsLv,color,currCount):i18n("ShapeShiftingWin_24",color,currCount)))}else{var mat=cfg.mat;var cfg2=GlobalConfig.ItemConfig[mat];if(!cfg2){console.log(i18n("ShapeShiftingWin_25")+mat);return}var mat_name=cfg2.name;var isHave=UserBag.ins().getBagGoodsCountById(0,mat);if(isHave<1){color=this.red}else{this.costTxt.y=15}this.costItemId0=mat;this.costNum0=1;this.costTxt.textFlow=TextFlowMaker.generateTextFlow1("需要消耗：|C:0xfef2ad\n\t\t\t&T:"+mat_name+" ||C:"+color+"\n\t\t\t&T:"+isHave+"||C:0x59ed1c&T:/1|")}};ShapeShiftingWin.prototype.onTabTouch=function(e){var index=this.tab.selectedIndex;this.setOpenIndex(index)};ShapeShiftingWin.prototype.checkIsOpen=function(e){var tab=e.target;var canLevelUp=!ShapeShiftingMgr.ins().noActivate();if(tab.selectedIndex==1&&!canLevelUp){UserTips.ins().showTips(i18n("ShapeShiftingWin_26"));e.preventDefault();return}};ShapeShiftingWin.prototype.setOpenIndex=function(selectedIndex){this.updatePanel();this.groupBianshen.visible=selectedIndex==0?true:false;this.groupShengji.visible=selectedIndex==1?true:false;this.storePanel.visible=selectedIndex==2?true:false;this.randomStorePanel.visible=selectedIndex==3?true:false;this.pageID=selectedIndex;if(selectedIndex==2){this.storePanel.open()}else{this.storePanel.close()}if(selectedIndex==3){this.randomStorePanel.open()}else{this.randomStorePanel.close()}};ShapeShiftingWin.prototype.sortFunc=function(a,b){var astate=a.state;var bstate=b.state;if(astate>bstate){return 1}if(astate<bstate){return-1}if(astate==bstate){if(astate==ShapeState.wearing){var a_roleId=a.roleId;var b_roleId=b.roleId;if(a_roleId>b_roleId){return 1}if(a_roleId<b_roleId){return-1}}else{var alevel=a.level;var blevel=b.level;if(alevel<blevel){return 1}if(alevel>blevel){return-1}if(alevel==blevel){var aid=a.sort;var bid=b.sort;if(aid>bid){return 1}if(aid<bid){return-1}}}return 0}};ShapeShiftingWin.prototype.sortFunc2=function(a,b){var aid=a.id;var bid=b.id;var ar=ShapeShiftingMgr.ins().canLevelUp(aid)||ShapeShiftingMgr.ins().canPropLevelUp(aid);var br=ShapeShiftingMgr.ins().canLevelUp(bid)||ShapeShiftingMgr.ins().canPropLevelUp(bid);if(!ar&&br){return 1}if(ar&&!br){return-1}if(ar==br){var astate=a.state;var bstate=b.state;if(astate>bstate){return 1}if(astate<bstate){return-1}if(astate==bstate){if(astate==ShapeState.wearing){var a_roleId=a.roleId;var b_roleId=b.roleId;if(a_roleId>b_roleId){return 1}if(a_roleId<b_roleId){return-1}}else{var alevel=a.level;var blevel=b.level;if(alevel<blevel){return 1}if(alevel>blevel){return-1}if(alevel==blevel){var aid=a.sort;var bid=b.sort;if(aid>bid){return 1}if(aid<bid){return-1}}}return 0}}};ShapeShiftingWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.btnActivate,this.onClick);this.removeTouchEvent(this.btnSet,this.onClick);this.removeTouchEvent(this.btnUpgrade,this.onClick);this.removeTouchEvent(this.btnUp,this.onClick);this.removeTouchEvent(this.btnSkill,this.onClick);this.removeTouchEvent(this.btnTalent,this.onClick);this.removeTouchEvent(this.btnEnterSkill,this.onClick);this.removeTouchEvent(this.btnBreakSkill,this.onClick);this.removeTouchEvent(this.btnDetail,this.onClick);this.removeTouchEvent(this.propbg,this.onClick);this.removeTouchEvent(this.btnProp,this.onClick);this.removeTouchEvent(this.btnTask,this.onClick);this.itemList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.giftList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGiftTap,this);ViewManager.ins().close(ShapeShiftingWearWin)};ShapeShiftingWin.prototype.onClick=function(e){switch(e.target){case this.btnSkill:ViewManager.ins().open(ShapeShiftingSkillWin,this.curShapeID,1);break;case this.btnTalent:ViewManager.ins().open(ShapeShiftingSkillWin,this.curShapeID,2);break;case this.btnEnterSkill:ViewManager.ins().open(ShapeShiftingSkillWin,this.curShapeID,3);break;case this.btnBreakSkill:ViewManager.ins().open(ShapeShiftingGiftTips,this.curShapeID);break;case this.closeBtn:ViewManager.ins().close(ShapeShiftingWin);break;case this.btnHelp:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[44].text);break;case this.btnActivate:this.onClickActivate();break;case this.btnSet:ViewManager.ins().open(ShapeShiftingWearWin,this.curShapeID);break;case this.btnUpgrade:if(this.canBreak){this.sendUpgradeBreak()}else{this.sendUpgrade()}break;case this.btnUp:if(this.btnCb){this.btnCb()}break;case this.btnDetail:case this.propbg:case this.btnProp:ViewManager.ins().open(ShapeShiftingPropDetailWin).setData(this.curShapeID);break;case this.btnTask:ViewManager.ins().open(ShapeShiftingTaskWin,this.curShapeID,this.itemlistData);break}};ShapeShiftingWin.prototype.onClickActivate=function(){if(this.clicked){return}this.clicked=true;this.sendActivate();var self=this;setTimeout(function(){self.clicked=false},500)};ShapeShiftingWin.prototype.activateShape=function(shapeId){if(shapeId===void 0){shapeId=1}var index=null;for(var i=0;i<this.itemlistData.length;i++){if(this.itemlistData[i].id==shapeId){this.itemlistData[i].state=ShapeState.activated;index=i;break}}if(index!=null){var render=this.itemList.getVirtualElementAt(index);render.activate()}this.updateDetail();this.showRedPoint()};ShapeShiftingWin.prototype.itemRedPoint=function(){for(var i=0;i<this.itemlistData.length;i++){var render=this.itemList.getVirtualElementAt(i);render.showRedPoint()}};ShapeShiftingWin.prototype.refreshShape=function(){this.itemRedPoint();var index=null;var myShapeShiftingInfo=ShapeShiftingMgr.ins().myShapeShiftingInfo[this.curShapeID];var level=1;var plevel=0;if(myShapeShiftingInfo){level=ShapeShiftingMgr.ins().myShapeShiftingInfo[this.curShapeID].level||1;plevel=ShapeShiftingMgr.ins().myShapeShiftingInfo[this.curShapeID].plevel||0}else{level=1;plevel=0}for(var i=0;i<this.itemlistData.length;i++){if(this.itemlistData[i].id==this.curShapeID){this.itemlistData[i].level=level;index=i;break}}if(index!=null){var render=this.itemList.getVirtualElementAt(index);render.levelUp(level,plevel)}this.updateDetail();this.showRedPoint()};ShapeShiftingWin.prototype.sendActivate=function(){var curIdx=this.itemList.selectedIndex;var data=this.itemlistData[curIdx];if(!data){return}var shapeId=data.id;ShapeShiftingMgr.ins().sendShapeShiftingActivate(shapeId)};ShapeShiftingWin.prototype.sendUpgrade=function(){ShapeShiftingMgr.ins().sendShapeShiftingUpgrade(this.curShapeID)};ShapeShiftingWin.prototype.sendUpgradeBreak=function(){ShapeShiftingMgr.ins().sendShapeShiftingUpgradeBreak(this.curShapeID)};ShapeShiftingWin.prototype.onActivate=function(param){var errid=param[0];var errmsg=param[1];var shapeId=param[2];if(errid==0){this.activateShape(this.curShapeID);UserTips.ins().showTips(errmsg)}else{if(errid==3){ViewManager.ins().open(ShopGoodsWarn).setData(this.costItemId0,this.costNum0)}else{WarnWin.show(errmsg,function(){},this,undefined,undefined,"sure")}}};ShapeShiftingWin.prototype.onUpgrade=function(param){var errid=param[0];var errmsg=param[1];if(errid==0){this.setUpEff();this.refreshShape()}else{if(errid==5){ViewManager.ins().open(ShapeShiftingGainExpWin)}else if(errid==6){if(this.redPoint1.visible==true){ViewManager.ins().open(ShapeShiftingPropDetailWin).setData(this.curShapeID);return}ViewManager.ins().open(ShopGoodsWarn).setData(this.costItemId,this.costNum);UserTips.ins().showTips(errmsg)}else if(errid==7){ViewManager.ins().open(ShopGoodsWarn).setData(this.costItemId,this.costNum);UserTips.ins().showTips(errmsg)}else{UserTips.ins().showTips(errmsg)}}};ShapeShiftingWin.prototype.onPropLevelUp=function(param){var errid=param[0];var errmsg=param[1];if(errid==0){this.refreshShape()}};ShapeShiftingWin.prototype.onTaskRefresh=function(){this.itemRedPoint();this.showRedPoint()};ShapeShiftingWin.prototype.getBreakMat=function(shapeId){var info=ShapeShiftingMgr.ins().myShapeShiftingInfo[shapeId];var stage=info.stage;var level=info.level;var breakcost=GlobalConfig.ShapeShiftingLevelConfig[shapeId][stage][level].breakcost;for(var _i=0,breakcost_3=breakcost;_i<breakcost_3.length;_i++){var v=breakcost_3[_i];var id=v.id;var num=v.num;var isHave=UserBag.ins().getBagGoodsCountById(0,id);if(isHave<num){return v}}};ShapeShiftingWin.prototype.onUpgradeBreak=function(param){var errid=param[0];var errmsg=param[1];if(errid==0){this.refreshShape();UserTips.ins().showTips(errmsg)}else{if(errid==5){var mat=this.getBreakMat(this.curShapeID);if(mat){ViewManager.ins().open(ShopGoodsWarn).setData(mat.id,mat.num)}}else{WarnWin.show(errmsg,function(){},this,undefined,undefined,"sure")}}};ShapeShiftingWin.prototype.onItemTap=function(e){this.itemList.selectedIndex=e.itemIndex;this.updateDetail();this.showRedPoint()};return ShapeShiftingWin}(BaseEuiView);__reflect(ShapeShiftingWin.prototype,"ShapeShiftingWin");ViewManager.ins().reg(ShapeShiftingWin,LayerManager.UI_Main);var ShapeShiftingTreasure=function(_super){__extends(ShapeShiftingTreasure,_super);function ShapeShiftingTreasure(){var _this=_super.call(this)||this;_this.huntTimes=0;_this.huntBoxInfo=[];_this.huntHope=0;_this.huntFreeTimes=0;_this.huntRecords=[];_this.box8Idx=0;_this.upRequest=false;_this.sysId=PackageID.ShapeShiftingTreasure;_this.regNetMsg(1,_this.postShapeShiftingTreasureInfo);_this.regNetMsg(4,_this.doHuntBack);_this.regNetMsg(5,_this.postHuntRecord);_this.regNetMsg(7,_this.postHuntBoxInfo);return _this}ShapeShiftingTreasure.ins=function(){return _super.ins.call(this)};ShapeShiftingTreasure.prototype.startTimer=function(){TimerManager.ins().removeAll(this.randomBox8);var cfg=GlobalConfig.ShapeShiftingTreasureConfig;var hour=cfg.intervel;TimerManager.ins().doTimer(hour*3600*1e3,0,this.randomBox8,this)};ShapeShiftingTreasure.prototype.randomBox8=function(){var cfg=GlobalConfig.ShapeShiftingTreasureConfig;var box8=cfg.box8;var idx=this.box8Idx;idx+=1;if(idx>box8.length-1){idx=0}this.box8Idx=idx;this.postIdxChange()};ShapeShiftingTreasure.prototype.postIdxChange=function(){};ShapeShiftingTreasure.prototype.sendShapeShiftingTreasureAdd=function(slot){var bytes=this.getBytes(1);bytes.writeByte(slot);this.sendToServer(bytes)};ShapeShiftingTreasure.prototype.sendShapeShiftingTreasureAct=function(roleId,slot){var bytes=this.getBytes(2);bytes.writeByte(roleId);bytes.writeByte(slot);this.sendToServer(bytes)};ShapeShiftingTreasure.prototype.sendShapeShiftingTreasureUpLevel=function(roleId,slot){var bytes=this.getBytes(3);bytes.writeByte(roleId);bytes.writeByte(slot);this.upRequest=true;this.sendToServer(bytes)};ShapeShiftingTreasure.prototype.postShapeShiftingTreasureInfo=function(bytes){};ShapeShiftingTreasure.prototype.sendHunt=function(times){var bytes=this.getBytes(4);bytes.writeByte(times);this.sendToServer(bytes)};ShapeShiftingTreasure.prototype.sendHuntRecord=function(){this.sendBaseProto(5)};ShapeShiftingTreasure.prototype.sendHuntAward=function(index){var bytes=this.getBytes(6);bytes.writeInt(index);this.sendToServer(bytes)};ShapeShiftingTreasure.prototype.doHuntBack=function(bytes){var type=bytes.readUnsignedByte();var num=bytes.readUnsignedByte();var arr=[];for(var i=0;i<num;i++)arr[i]=[bytes.readInt(),bytes.readUnsignedByte()];if(ViewManager.ins().isShow(HuntResultWin))this.postHuntResult(type,arr,4);else{ViewManager.ins().open(HuntResultWin,type,arr,4);this.postHuntResult(type,arr,4)}};ShapeShiftingTreasure.prototype.postHuntResult=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}return params};ShapeShiftingTreasure.prototype.postHuntRecord=function(bytes){this.huntRecords=[];var num=bytes.readUnsignedByte();for(var i=0;i<num;i++)this.huntRecords[i]=[bytes.readString(),bytes.readInt()];this.huntRecords.reverse()};ShapeShiftingTreasure.prototype.postHuntBoxInfo=function(bytes){var state=bytes.readInt();this.huntTimes=bytes.readInt();this.huntHope=bytes.readInt();this.huntFreeTimes=bytes.readShort();var config;var i=0;for(var k in GlobalConfig.ShapeShiftingTreasureRewardConfig){config=GlobalConfig.ShapeShiftingTreasureRewardConfig[k];this.huntBoxInfo[i]=state>>config.id&1?ShapeShiftingTreasure.ISNGET:this.huntTimes>=config.needTime?ShapeShiftingTreasure.CANGET:ShapeShiftingTreasure.UNGET;i++}};ShapeShiftingTreasure.prototype.getIsGetBox=function(){return this.huntBoxInfo.indexOf(ShapeShiftingTreasure.CANGET)!=-1};ShapeShiftingTreasure.prototype.getIsGetTen=function(){var sum=this.getHuntItemNum();return sum>=10};ShapeShiftingTreasure.prototype.isOpen=function(){var guanQiaID=UserFb.ins().guanqiaID;var openChapterLevel=GlobalConfig.ShapeShiftingTreasureConfig.openChapterLevel;return guanQiaID>=openChapterLevel};ShapeShiftingTreasure.prototype.canHuntFree=function(){var count=this.getHuntItemNum();var huntFreeTimes=this.huntFreeTimes;return count>0||huntFreeTimes>0};ShapeShiftingTreasure.prototype.getHuntItemNum=function(){var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.ShapeShiftingTreasureConfig.huntItem);var count=item?item.count:0;return count};ShapeShiftingTreasure.prototype.showRedPoint=function(){return this.isOpen()&&(this.canHuntFree()||this.getIsGetBox())};ShapeShiftingTreasure.UNGET=0;ShapeShiftingTreasure.CANGET=1;ShapeShiftingTreasure.ISNGET=2;return ShapeShiftingTreasure}(BaseSystem);__reflect(ShapeShiftingTreasure.prototype,"ShapeShiftingTreasure");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.shapeShiftingTreasure=ShapeShiftingTreasure.ins.bind(ShapeShiftingTreasure)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ShenshouRedpoint=function(_super){__extends(ShenshouRedpoint,_super);function ShenshouRedpoint(){var _this=_super.call(this)||this;_this.redpointEquips1=[];_this.redpointEquips2=[];_this.redpoints=[];_this.redpoint=false;_this.associated(_this.postRedPoint,_this.postRedPoint1,_this.postRedPoint2,ShenshouSys.ins().postBattleState);_this.associated(_this.postRedPoint1,ShenshouSys.ins().postInfo,UserBag.ins().postItemAdd,UserBag.ins().postItemDel,UserBag.ins().postItemCountChange);_this.associated(_this.postRedPoint2,ShenshouSys.ins().postInfo,ShenshouSys.ins().postUpdateExp,ShenshouSys.ins().postWearEquip);return _this}ShenshouRedpoint.prototype.postRedPoint=function(){if(!ShenshouModel.ins().checkOpen()){this.redpoint=false;return 0}this.redpoints=[];for(var id in GlobalConfig.ShenShouBase){this.redpoints[id]=this.redpointEquips1[id]&&this.redpointEquips1[id].indexOf(1)>-1;if(!this.redpoints[id]&&this.redpointEquips2[id])this.redpoints[id]=this.redpointEquips2[id].indexOf(1)>-1;if(!this.redpoints[id]){var data=ShenshouModel.ins().getDataById(parseInt(id));this.redpoints[id]=data&&data.state==ShenshouState.State_Can&&ShenshouModel.ins().isCanBattle()}}this.redpoint=this.redpoints.indexOf(true)>-1;return this.redpoint?1:0};ShenshouRedpoint.prototype.postRedPoint1=function(){if(!ShenshouModel.ins().checkOpen()){this.redpointEquips1=[];return}for(var id in GlobalConfig.ShenShouBase){var data=ShenshouSys.ins().dataList[id];this.redpointEquips1[id]=[];for(var i=1;i<=GlobalConfig.ShenShouConfig.posCount;i++){var list=ShenshouModel.ins().findCanWearEquips(+id,i);if(list.length>0){this.redpointEquips1[id][i]=1;if(data&&data.equipIDs[i]&&ShenshouModel.ins().checkEquipScore(data.equipIDs[i],list[0].id)){this.redpointEquips1[id][i]=0}}else{this.redpointEquips1[id][i]=0}}}};ShenshouRedpoint.prototype.postRedPoint2=function(){if(!ShenshouModel.ins().checkOpen()){this.redpointEquips2=[];return}for(var id in ShenshouSys.ins().dataList){var data=ShenshouSys.ins().dataList[id];this.redpointEquips2[id]=[];for(var pos=1;pos<=5;pos++){if(data.equipIDs[pos]&&this.getForgeRedpoint(data.equipIDs[pos],ShenshouSys.ins().exp)&&data.state!=ShenshouState.State_No){this.redpointEquips2[id][pos]=1}else{this.redpointEquips2[id][pos]=0}}}};ShenshouRedpoint.prototype.getForgeRedpoint=function(id,exp){return GlobalConfig.ShenShouEquip[id+1]&&exp>=GlobalConfig.ShenShouEquip[id].exp};return ShenshouRedpoint}(BaseSystem);__reflect(ShenshouRedpoint.prototype,"ShenshouRedpoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.shenshouRedpoint=ShenshouRedpoint.ins.bind(ShenshouRedpoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ShenshouSys=function(_super){__extends(ShenshouSys,_super);function ShenshouSys(){var _this=_super.call(this)||this;_this.maxLimit=0;_this.dataList={};_this.exp=0;_this.sysId=PackageID.Shenshou;_this.regNetMsg(1,_this.postInfo);_this.regNetMsg(2,_this.postWearEquip);_this.regNetMsg(4,_this.postBattleState);_this.regNetMsg(5,_this.postBattleMaxLimit);_this.regNetMsg(6,_this.postUpdateExp);_this.regNetMsg(7,_this.postUpEquip);_this.regNetMsg(8,_this.postDepartEquip);return _this}ShenshouSys.ins=function(){return _super.ins.call(this)};ShenshouSys.prototype.postInfo=function(bytes){var len=bytes.readByte();for(var i=0;i<len;i++){var dt=new ShenshouData(bytes);this.dataList[dt.id]=dt}this.maxLimit=bytes.readByte();this.exp=bytes.readInt()};ShenshouSys.prototype.postWearEquip=function(bytes){var id=bytes.readByte();var pos=bytes.readByte();var equipId=bytes.readInt();if(this.dataList[id]){this.dataList[id].equipIDs[pos]=equipId}else{var dt=new ShenshouData;dt.equipIDs[pos]=equipId;dt.id=id;this.dataList[id]=dt}this.dataList[id].checkState();ViewManager.ins().close(ShenshouWearEquipWin)};ShenshouSys.prototype.postBattleState=function(bytes){this.dataList[bytes.readByte()].state=bytes.readByte()};ShenshouSys.prototype.postBattleMaxLimit=function(bytes){this.maxLimit=bytes.readByte();ViewManager.ins().close(ShenshouDanUseWin)};ShenshouSys.prototype.postUpdateExp=function(bytes){var oldExp=this.exp;this.exp=bytes.readInt();if(this.exp-oldExp>0){UserTips.ins().showTips(i18n("ShenshouSys_2",this.exp-oldExp))}};ShenshouSys.prototype.postUpEquip=function(bytes){var id=bytes.readByte();var pos=bytes.readByte();var equipId=bytes.readInt();this.dataList[id].equipIDs[pos]=equipId;return equipId};ShenshouSys.prototype.postDepartEquip=function(bytes){};ShenshouSys.prototype.sendWearEquip=function(id,pos,equipId){var bytes=this.getBytes(2);bytes.writeByte(id);bytes.writeByte(pos);bytes.writeInt(equipId);this.sendToServer(bytes)};ShenshouSys.prototype.sendComposeEquip=function(equipIds){var bytes=this.getBytes(3);var len=equipIds.length;while(--len>0){bytes.writeInt(equipIds[len])}this.sendToServer(bytes)};ShenshouSys.prototype.sendBattle=function(id){var bytes=this.getBytes(4);bytes.writeByte(id);this.sendToServer(bytes)};ShenshouSys.prototype.sendUpLimitMax=function(){this.sendBaseProto(5)};ShenshouSys.prototype.sendUpEquip=function(id,pos){var bytes=this.getBytes(7);bytes.writeByte(id);bytes.writeByte(pos);this.sendToServer(bytes)};ShenshouSys.prototype.sendDepartEquip=function(equips){var bytes=this.getBytes(8);var count=equips.length;bytes.writeByte(count);for(var i=0;i<count;i++){bytes.writeInt(equips[i])}this.sendToServer(bytes)};return ShenshouSys}(BaseSystem);__reflect(ShenshouSys.prototype,"ShenshouSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.shenshouSys=ShenshouSys.ins.bind(ShenshouSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ShenshouData=function(){function ShenshouData(bytes){this.equipIDs=[];this.state=0;for(var i=1;i<=5;i++){this.equipIDs[i]=0}if(bytes)this.readData(bytes)}ShenshouData.prototype.readData=function(bytes){this.id=bytes.readByte();this.equipIDs=[];var len=bytes.readByte();for(var i=0;i<len;i++){this.equipIDs[i+1]=bytes.readInt()}this.state=bytes.readByte();if(this.equipIDs.indexOf(0)>-1&&this.state!=ShenshouState.State_Has)this.state=ShenshouState.State_No};ShenshouData.prototype.checkState=function(){if(this.state==ShenshouState.State_Has)return;if(this.equipIDs.indexOf(0)>-1)this.state=ShenshouState.State_No;else this.state=ShenshouState.State_Can};return ShenshouData}();__reflect(ShenshouData.prototype,"ShenshouData");var ShenshouEquipData=function(){function ShenshouEquipData(){}return ShenshouEquipData}();__reflect(ShenshouEquipData.prototype,"ShenshouEquipData");var ShenshouState;(function(ShenshouState){ShenshouState[ShenshouState["State_No"]=2]="State_No";ShenshouState[ShenshouState["State_Can"]=0]="State_Can";ShenshouState[ShenshouState["State_Has"]=1]="State_Has"})(ShenshouState||(ShenshouState={}));window["ShenshouState"]=ShenshouState;var ShenshouModel=function(_super){__extends(ShenshouModel,_super);function ShenshouModel(){return _super.call(this)||this}Object.defineProperty(ShenshouModel,"EQUIPE_QUALITY_CN",{get:function(){var _EQUIPE_QUALITY_CN=this._EQUIPE_QUALITY_CN;if(_EQUIPE_QUALITY_CN==null){_EQUIPE_QUALITY_CN=[i18n("ShenshouModel_0"),i18n("ShenshouModel_1"),i18n("ShenshouModel_2"),i18n("ShenshouModel_3"),i18n("ShenshouModel_4")];this._EQUIPE_QUALITY_CN=_EQUIPE_QUALITY_CN}return _EQUIPE_QUALITY_CN},enumerable:true,configurable:true});ShenshouModel.ins=function(){return _super.ins.call(this)};ShenshouModel.prototype.findCanWearEquips=function(id,pos){var equips=UserBag.ins().getBagGoodsByType(ItemType.TYPE_23);var list=[];var myEquipScore=0;var data=ShenshouSys.ins().dataList[id];if(data&&data.equipIDs[pos])myEquipScore=UserBag.getAttrPower(GlobalConfig.ShenShouEquip[data.equipIDs[pos]].attrs);for(var _i=0,equips_2=equips;_i<equips_2.length;_i++){var item=equips_2[_i];var quality=this.getEquipQuality(item.configID);var socre=UserBag.getAttrPower(GlobalConfig.ShenShouEquip[item.configID].attrs);if(ItemConfig.getSubType(item.itemConfig)==pos-1&&GlobalConfig.ShenShouBase[id].minLevel[pos-1]<=quality){var dt=new ShenshouEquipData;dt.id=item.configID;dt.pos=pos;dt.shenshuId=id;var aData=GlobalConfig.ShenShouEquip[item.configID];dt.sortIndex=UserBag.getAttrPower(aData.attrs);dt.best=dt.sortIndex>myEquipScore;list.push(dt)}}list.sort(this.compareFun);return list};ShenshouModel.prototype.checkEquipScore=function(id,tId){var mySocre=UserBag.getAttrPower(GlobalConfig.ShenShouEquip[id].attrs);var toSocre=UserBag.getAttrPower(GlobalConfig.ShenShouEquip[tId].attrs);return mySocre>=toSocre};ShenshouModel.prototype.compareFun=function(a,b){if(a.sortIndex>b.sortIndex)return-1;else if(a.sortIndex<b.sortIndex)return 1;else return 0};ShenshouModel.prototype.calcEquipScore=function(id){var data=this.getDataById(id);var score=0;if(data){for(var i=1;i<=data.equipIDs.length;i++){var equipData=GlobalConfig.ShenShouEquip[data.equipIDs[i]];if(!equipData)continue;score+=UserBag.getAttrPower(equipData.attrs);if(equipData.expower)score+=equipData.expower}}return score};ShenshouModel.prototype.getDataById=function(id){var data=ShenshouSys.ins().dataList[id];return data};ShenshouModel.prototype.getAttrValue=function(id,attrType){var data=this.getDataById(id);if(data){var value=0;for(var pos in data.equipIDs){if(!pos)continue;var equip=GlobalConfig.ShenShouEquip[data.equipIDs[pos]];if(!equip)continue;for(var _i=0,_a=equip.attrs;_i<_a.length;_i++){var attr=_a[_i];if(attrType==attr.type)value+=attr.value}}return value}return 0};ShenshouModel.prototype.getCurStatus=function(id){var data=this.getDataById(id);if(data){return data.state}return ShenshouState.State_No};ShenshouModel.prototype.getCurBattle=function(){var count=0;for(var id in ShenshouSys.ins().dataList){if(ShenshouSys.ins().dataList[id].state==ShenshouState.State_Has)count++}return count};ShenshouModel.prototype.getCountBattle=function(){return GlobalConfig.ShenShouConfig.minCount+ShenshouSys.ins().maxLimit};ShenshouModel.prototype.isCanBattle=function(){return this.getCurBattle()<this.getCountBattle()};ShenshouModel.prototype.getNowAttr=function(equip){var nowAttrList=[];for(var index=0;index<equip.attrs.length;index++){var newAttr=new AttributeData(equip.attrs[index].type,equip.attrs[index].value-equip.starattrs[index].value);nowAttrList.push(newAttr)}return nowAttrList};ShenshouModel.prototype.getEquipLv=function(id){return parseInt((id+"").slice(4,7))};ShenshouModel.prototype.getEquipQuality=function(id){return parseInt((id+"").slice(2,4))};ShenshouModel.prototype.getEquipBaseId=function(id){return(id/1e3>>0)*1e3+1};ShenshouModel.prototype.checkOpen=function(){return UserZs.ins().lv>=GlobalConfig.ShenShouConfig.openzhuanshenglv&&GameServer.serverOpenDay+1>=GlobalConfig.ShenShouConfig.openserverday};return ShenshouModel}(BaseClass);__reflect(ShenshouModel.prototype,"ShenshouModel");var ShenshouDanUseWin=function(_super){__extends(ShenshouDanUseWin,_super);function ShenshouDanUseWin(){var _this=_super.call(this)||this;_this.skinName="SsItemUseTips";return _this}ShenshouDanUseWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.useBtn,this.onTouch);this.addTouchEvent(this.cancelBtn,this.onTouch);this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);var itemConfig=args[0];this.itemIcon.data=itemConfig.id;this.ownCount.text=i18n("ShenshouDanUseWin_0",UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.ShenShouConfig.battleCountItem));this.itemIcon.hideName()};ShenshouDanUseWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.closeBtn:case this.cancelBtn:ViewManager.ins().close(this);break;case this.useBtn:ShenshouSys.ins().sendUpLimitMax();break}};return ShenshouDanUseWin}(BaseEuiView);__reflect(ShenshouDanUseWin.prototype,"ShenshouDanUseWin");ViewManager.ins().reg(ShenshouDanUseWin,LayerManager.UI_Popup);var BresenhamLine=function(){function BresenhamLine(){}BresenhamLine.isAbleToThrough=function(ox,oy,tx,ty){var x1=0,y1=0,x2=0,y2=0;var xstep=0,ystep=0,dx=0,x=0,y=0,lastY=0;var ny=0,k=0,b=0,i=0;if(!this.throughCheckResult){this.throughCheckResult=new Array(4)}this.throughCheckResult[0]=0;this.throughCheckResult[1]=0;k=(ty-oy)/(tx-ox);b=ty-k*tx;xstep=tx>ox?1:-1;ystep=ty>oy?1:-1;x1=ox>>0,y1=oy>>0,x2=tx>>0,y2=ty>>0;dx=x2-x1,dx=(dx^dx>>31)-(dx>>31);x=x1,lastY=y1;this.throughCheckResult[2]=x,this.throughCheckResult[3]=lastY;for(i=0;i<dx;i++){x+=xstep;ny=k*x+b;y=ny>>0;while(lastY!=y){lastY+=ystep;if(!GameMap.checkWalkable(x,lastY))return this.throughCheckResult;this.throughCheckResult[2]=x,this.throughCheckResult[3]=lastY}if(!GameMap.checkWalkable(x,y))return this.throughCheckResult;this.throughCheckResult[2]=x,this.throughCheckResult[3]=y}while(lastY!=y2){lastY+=ystep;if(!GameMap.checkWalkable(x,lastY))return this.throughCheckResult;this.throughCheckResult[2]=x,this.throughCheckResult[3]=lastY}this.throughCheckResult[0]=1;return this.throughCheckResult};BresenhamLine.tileLine=function(ox,oy,tx,ty){var is_swap=false;if(Math.abs(ty-oy)>Math.abs(tx-ox)){is_swap=true;var tmp=ox;ox=oy;oy=tmp;tmp=tx;tx=ty;ty=tmp}var k=(ty-oy)/(tx-ox);var b=ty-k*tx;var dx=tx>ox?1:-1;var loop=Math.abs(tx-ox);var result=[];for(var j=0;j<loop;++j){var x=ox+j*dx>>0;var y=k*x+b>>0;if(is_swap){var tmp=x;x=y;y=tmp}result.push(x);result.push(y)}return result};BresenhamLine.getPointOnLine=function(ox,oy,tx,ty,ds){var os=0,ts=0,dx=0,dy=0;dx=tx-ox,dy=ty-oy;os=Math.sqrt(dx*dx+dy*dy);ts=os+ds;return[Math.round(ox+dx*ts/os),Math.round(oy+dy*ts/os)]};BresenhamLine.shortenPath=function(ox,oy,path,distance){var sx=ox,sy=oy;var tx=path[path.length-2],ty=path[path.length-1];var dx=0,dy=0;var pt;if(path.length>=4){sx=path[path.length-4],sy=path[path.length-3]}dx=tx-sx,dy=ty-sy;if(dx*dx+dy*dy>distance*distance){pt=BresenhamLine.getPointOnLine(sx,sy,tx,ty,-distance);path[path.length-2]=pt[0],path[path.length-1]=pt[1]}else{path.length-=2}};return BresenhamLine}();__reflect(BresenhamLine.prototype,"BresenhamLine");var ShenshouEquipItem1=function(_super){__extends(ShenshouEquipItem1,_super);function ShenshouEquipItem1(){return _super.call(this)||this}ShenshouEquipItem1.prototype.playDepartMc=function(){if(!this.mc)this.mc=new MovieClip;this.mc.x=43;this.mc.y=44;this.mc.scaleX=1.5;this.mc.scaleY=1.5;this.addChild(this.mc);this.mc.playFile(RES_DIR_EFF+"litboom",1)};ShenshouEquipItem1.prototype.dataChanged=function(){if(!isNaN(this.data)&&this.data){this.itemConfig=GlobalConfig.ItemConfig[this.data];this.nameTxt.text="";this.imgBg.source="quality"+ItemConfig.getQuality(this.itemConfig);this.imgIcon.source=this.itemConfig.icon+"_png";var lv=ShenshouModel.ins().getEquipLv(this.itemConfig.id)-1;this.equipLv.text=lv>0?"+"+lv:""}};return ShenshouEquipItem1}(ShenshouEquipItem);__reflect(ShenshouEquipItem1.prototype,"ShenshouEquipItem1");var ShenshouEquipTip=function(_super){__extends(ShenshouEquipTip,_super);function ShenshouEquipTip(){var _this=_super.call(this)||this;_this.posType=[i18n("ShenshouEquipTip_0"),i18n("ShenshouEquipTip_1"),i18n("ShenshouEquipTip_2"),i18n("ShenshouEquipTip_3"),i18n("ShenshouEquipTip_4")];_this.skinName="shenshouEquipTips";return _this}ShenshouEquipTip.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.changeBtn,this.onTouch);this.addTouchEvent(this.takeoffBtn,this.onTouch);this.addTouchEvent(this.forgeBtn,this.onTouch);this.shenshouId=args[0];this.pos=args[1];if(!this.shenshouId){this.changeBtn.visible=false;this.forgeBtn.visible=false;this.takeoffBtn.visible=false;this.changeRedPoint.visible=false;this.forgeRedPoint.visible=false;this.anigroup.height=505}else{this.refRedpoint();var data=ShenshouModel.ins().getDataById(this.shenshouId);if(data.state==ShenshouState.State_No){this.forgeBtn.visible=false}}this.itemDp=GlobalConfig.ItemConfig[args[2]];this.initUi()};ShenshouEquipTip.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}};ShenshouEquipTip.prototype.initUi=function(){var quality=ItemConfig.getQuality(this.itemDp);this.quali.source=quality?"quali"+quality:"";this.equipIcon.data=this.itemDp.id;this.equipIcon.hideName();this.nameTxt.text=this.itemDp.name;this.nameTxt.textColor=ItemConfig.getQualityColor(this.itemDp);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(this.itemDp);this.type.text=this.posType[ItemConfig.getSubType(this.itemDp)];this.lv.text=ShenshouModel.ins().getEquipLv(this.itemDp.id)+i18n("ShenshouEquipTip_5");this.career.text=i18n("ShenshouEquipTip_6");var equipDp=GlobalConfig.ShenShouEquip[this.itemDp.id];var score=UserBag.getAttrPower(equipDp.attrs);if(equipDp.expower)score+=equipDp.expower;this.powerPanel.setPower(score*SubRoles.ins().subRolesLen);var baseEquip=GlobalConfig.ShenShouEquip[ShenshouModel.ins().getEquipBaseId(this.itemDp.id)];var nowAttr=ShenshouModel.ins().getNowAttr(baseEquip);for(var i=0;i<3;i++){if(nowAttr[i]){this["attr"+(i+1)].visible=true;this["attr"+(i+1)].text=AttributeData.getAttStrByType(nowAttr[i],0,":");var addValue=equipDp.attrs[i].value-baseEquip.attrs[i].value;this["forgeAttr"+(i+1)].visible=baseEquip&&baseEquip.id!=equipDp.id&&addValue>0;if(baseEquip&&baseEquip.id!=equipDp.id&&addValue>0)this["forgeAttr"+(i+1)].text="+"+addValue}else{this["attr"+(i+1)].visible=false;this["forgeAttr"+(i+1)].visible=false}}for(var i=0;i<3;i++){if(equipDp.starattrs[i]){this["starAttr"+(i+1)].visible=true;this["starAttr"+(i+1)].text=AttributeData.getAttStrByType(equipDp.starattrs[i],0,":")}else{this["starAttr"+(i+1)].visible=false}}};ShenshouEquipTip.prototype.onTouch=function(e){switch(e.target){case this.bgClose:break;case this.changeBtn:ViewManager.ins().open(ShenshouWearEquipWin,this.shenshouId,this.pos,this.itemDp.id);break;case this.takeoffBtn:if(ShenshouModel.ins().getDataById(this.shenshouId).state==ShenshouState.State_Has){UserTips.ins().showCenterTips(i18n("ShenshouEquipTip_7"));return}ShenshouSys.ins().sendWearEquip(this.shenshouId,this.pos,0);break;case this.forgeBtn:ViewManager.ins().open(ShenshouForgeWin,this.shenshouId,this.pos,this.itemDp);break}ViewManager.ins().close(this)};ShenshouEquipTip.prototype.refRedpoint=function(){this.changeRedPoint.visible=ShenshouRedpoint.ins().redpointEquips1[this.shenshouId]&&ShenshouRedpoint.ins().redpointEquips1[this.shenshouId][this.pos];this.forgeRedPoint.visible=ShenshouRedpoint.ins().redpointEquips2[this.shenshouId]&&ShenshouRedpoint.ins().redpointEquips2[this.shenshouId][this.pos]};return ShenshouEquipTip}(BaseEuiView);__reflect(ShenshouEquipTip.prototype,"ShenshouEquipTip");ViewManager.ins().reg(ShenshouEquipTip,LayerManager.UI_Popup);var ShenshouForgeWin=function(_super){__extends(ShenshouForgeWin,_super);function ShenshouForgeWin(){var _this=_super.call(this)||this;_this.skinName="SsEquipForgeSkin";return _this}ShenshouForgeWin.prototype.childrenCreated=function(){this.list.itemRenderer=ShenshouEquipItem1;this.listDt=new eui.ArrayCollection;this.list.dataProvider=this.listDt;this.nowList=[];this.exp.value=0;this.exp.labelFunction=function(value,max){return ShenshouSys.ins().exp+"/"+max}};ShenshouForgeWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.shenshouId=args[0];this.pos=args[1];this.curItemDp=args[2];this.filterList=[];this.addTouchEvent(this.departBtn,this.onTouch);this.addTouchEvent(this.lvUpBtn,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.list,this.onList);this.observe(ShenshouSys.ins().postUpEquip,this.onUpEquip);this.observe(ShenshouSys.ins().postUpdateExp,this.refUIData);this.observe(ShenshouSys.ins().postDepartEquip,this.onDecompose);this.observe(ShenshouRedpoint.ins().postRedPoint2,this.refRedpoint);this.refRedpoint();this.refUIData();this.refList()};ShenshouForgeWin.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}DisplayUtils.removeFromParent(this.forgetMC)};ShenshouForgeWin.prototype.onUpExp=function(){this.exp.value=ShenshouSys.ins().exp;this.exp.maximum=GlobalConfig.ShenShouEquip[this.curItemDp.id].exp;this.exp.value=ShenshouSys.ins().exp;this.exp.labelDisplay.text=ShenshouSys.ins().exp+"/"+this.exp.maximum};ShenshouForgeWin.prototype.onUpEquip=function(equipId){this.curItemDp=GlobalConfig.ItemConfig[equipId];this.refUIData();if(!this.forgetMC){this.forgetMC=new MovieClip;this.forgetMC.x=62;this.forgetMC.y=62}this.forgetMC.playFile(RES_DIR_EFF+"forgeSuccess",1);this.iconGroup.addChild(this.forgetMC)};ShenshouForgeWin.prototype.refUIData=function(){var shenshouEquip=GlobalConfig.ShenShouEquip[this.curItemDp.id];this.curScore=UserBag.getAttrPower(shenshouEquip.attrs);if(shenshouEquip.expower)this.curScore+=shenshouEquip.expower;this.powerPanel.setPower(this.curScore*SubRoles.ins().subRolesLen);this.equipName.text=this.curItemDp.name;this.equipName.textColor=ItemConfig.getQualityColor(this.curItemDp);this.equipName.strokeColor=ItemConfig.getQualityStrokeColor(this.curItemDp);this.itemIcon.data=this.curItemDp.id;this.itemIcon.hideName();var lv=ShenshouModel.ins().getEquipLv(this.curItemDp.id);var level=i18n("Level_0");this.attrPanel["lvNow"].text=""+lv+level;this.attrPanel["lvNext"].text=""+(lv+1)+level;this.maxExpImg.visible=false;this.maxExpTxt.visible=false;var nextEquip=GlobalConfig.ShenShouEquip[this.curItemDp.id+1];if(!nextEquip){this.lvUpBtn.enabled=false;this.attrPanel.currentState="max";this.exp.visible=false;this.maxExpImg.visible=true;this.maxExpTxt.visible=true}for(var i=0;i<3;i++){if(shenshouEquip.attrs[i]){this.attrPanel["attr"+(i+1)+"Now"].visible=true;this.attrPanel["attr"+(i+1)+"Next"].visible=nextEquip&&nextEquip.attrs[i];this.attrPanel["attr"+(i+1)+"Now"].text=AttributeData.getAttStrByType(shenshouEquip.attrs[i],0,":");if(nextEquip&&nextEquip.attrs[i]){this.attrPanel["attr"+(i+1)+"Next"].text=AttributeData.getAttStrByType(nextEquip.attrs[i],0,":")}}else{this.attrPanel["attr"+(i+1)+"Next"].visible=false;this.attrPanel["attr"+(i+1)+"Now"].visible=false}}this.onUpExp()};ShenshouForgeWin.prototype.onDecompose=function(){var num=this.list.numChildren;for(var i=0;i<num;i++){var item=this.list.getChildAt(i);if(item){item.playDepartMc()}}TimerManager.ins().doTimer(500,1,this.refList,this)};ShenshouForgeWin.prototype.refList=function(){var items=UserBag.ins().getBagGoodsByType(ItemType.TYPE_23);this.nowList=[];var max=13;while(--max>=0){if(items[max]){if(items[max].count>1){for(var i=0;i<items[max].count;i++){if(this.filterList.indexOf(items[max].configID)>-1||!this.checkCurEquip(items[max].configID))continue;this.nowList.push(items[max].configID)}}else{if(this.filterList.indexOf(items[max].configID)>-1||!this.checkCurEquip(items[max].configID))continue;this.nowList.push(items[max].configID)}}}this.listDt.replaceAll(this.nowList)};ShenshouForgeWin.prototype.checkCurEquip=function(id){var equipData=GlobalConfig.ShenShouEquip[id];var score=equipData?UserBag.getAttrPower(equipData.attrs):0;return this.curScore>=score};ShenshouForgeWin.prototype.onList=function(e){if(e.target instanceof ShenshouEquipItem1&&this.filterList.indexOf(e.target.data)==-1){this.filterList.push(e.target.data)}this.refList()};ShenshouForgeWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.lvUpBtn:if(ShenshouSys.ins().exp<this.exp.maximum){UserTips.ins().showCenterTips(i18n("ShenshouForgeWin_0"));return}ShenshouSys.ins().sendUpEquip(this.shenshouId,this.pos);break;case this.departBtn:if(!this.nowList.length){UserTips.ins().showCenterTips(i18n("ShenshouForgeWin_1"));return}ShenshouSys.ins().sendDepartEquip(this.nowList);break}};ShenshouForgeWin.prototype.refRedpoint=function(){this.rightRed.visible=ShenshouRedpoint.ins().redpointEquips2[this.shenshouId][this.pos]};__decorate([callLater],ShenshouForgeWin.prototype,"onUpExp",null);__decorate([callLater],ShenshouForgeWin.prototype,"refRedpoint",null);return ShenshouForgeWin}(BaseEuiView);__reflect(ShenshouForgeWin.prototype,"ShenshouForgeWin");ViewManager.ins().reg(ShenshouForgeWin,LayerManager.UI_Popup);var ShenshouInfoPanel=function(_super){__extends(ShenshouInfoPanel,_super);function ShenshouInfoPanel(){return _super.call(this)||this}ShenshouInfoPanel.prototype.setID=function(value){this.curId=value;this.currentState=""+value};ShenshouInfoPanel.prototype.close=function(){this.stopBeatAnimat()};ShenshouInfoPanel.prototype.refEquipData=function(){for(var i=0;i<GlobalConfig.ShenShouConfig.posCount;i++){var pos=i+1;this["item"+i].name=pos;var data=ShenshouModel.ins().getDataById(this.curId);if(data&&data.equipIDs[pos]){this["item"+i].data=data.equipIDs[pos]}else{this["item"+i].setPosData(this.curId,pos)}}};ShenshouInfoPanel.prototype.refState=function(state){var _this=this;var bodySource="";this.stopBeatAnimat();this.shenshouImg.source=bodySource;switch(state){case ShenshouState.State_No:bodySource="ss_"+this.curId+"b_png";break;case ShenshouState.State_Can:bodySource="ss_"+this.curId+"b_png";break;case ShenshouState.State_Has:this.startBeatAnimat();bodySource="ss_"+this.curId+"a_png";break}egret.callLater(function(){_this.shenshouImg.source=bodySource},this)};ShenshouInfoPanel.prototype.startBeatAnimat=function(){if(!this.imgCopy)this.imgCopy=new eui.Image;this.imgCopy.touchEnabled=false;this.imgCopy.source="ss_"+this.curId+"a_png";this.imgCopy.visible=false;this.addChild(this.imgCopy);TimerManager.ins().doTimer(4e3,0,this.runTween,this);TimerManager.ins().doTimer(500,1,this.runTween,this)};ShenshouInfoPanel.prototype.runTween=function(){this.imgCopy.visible=true;this.imgCopy.alpha=0;this.imgCopy.scaleX=this.imgCopy.scaleY=1;this.imgCopy.x=this.shenshouImg.x+(this.shenshouImg.width>>1);this.imgCopy.y=this.shenshouImg.y+(this.shenshouImg.height>>1);this.imgCopy.anchorOffsetX=this.shenshouImg.width>>1;this.imgCopy.anchorOffsetY=this.shenshouImg.height>>1;this.imgCopy.top=this.shenshouImg.top;this.imgCopy.horizontalCenter=this.shenshouImg.horizontalCenter;Tween.get(this.imgCopy).to({alpha:1},250).to({alpha:0,scaleX:1.2,scaleY:1.2},2e3,egret.Ease.cubicInOut)};ShenshouInfoPanel.prototype.stopBeatAnimat=function(){TimerManager.ins().remove(this.runTween,this);if(this.imgCopy){Tween.removeTweens(this.imgCopy);this.imgCopy.visible=false}};return ShenshouInfoPanel}(BaseView);__reflect(ShenshouInfoPanel.prototype,"ShenshouInfoPanel");var ShenshouSkillTip=function(_super){__extends(ShenshouSkillTip,_super);function ShenshouSkillTip(){var _this=_super.call(this)||this;_this.skinName="shenshouSkillTips";return _this}ShenshouSkillTip.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTouch);var skillDp=args[0];this.quali.source=skillDp.quality?"quali"+skillDp.quality:"";this.equipIcon["skillQuality"].source="quality"+skillDp.quality;this.equipIcon["skillImg"].source=skillDp.icon;this.equipIcon["skillName"].text="";this.nameTxt.text=skillDp.name;this.targetTxt.text=skillDp.target==1?i18n("ShenshouSkillTip_0"):i18n("ShenshouSkillTip_1");this.targetTxt0.textFlow=TextFlowMaker.generateTextFlow1(skillDp.desc)};ShenshouSkillTip.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}};ShenshouSkillTip.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break}};return ShenshouSkillTip}(BaseEuiView);__reflect(ShenshouSkillTip.prototype,"ShenshouSkillTip");ViewManager.ins().reg(ShenshouSkillTip,LayerManager.UI_Tips);var ShenshouTab=function(_super){__extends(ShenshouTab,_super);function ShenshouTab(){return _super.call(this)||this}ShenshouTab.prototype.dataChanged=function(){if(this.data.id){var shendshouData=ShenshouModel.ins().getDataById(this.data.id);this.redPoint.visible=ShenshouRedpoint.ins().redpoints[this.data.id];this.activityImg.visible=shendshouData&&shendshouData.state==ShenshouState.State_Has;if(shendshouData&&shendshouData.state!=ShenshouState.State_No){this.btnName.source=GlobalConfig.ShenShouBase[this.data.id].activeImg}else{this.btnName.source=GlobalConfig.ShenShouBase[this.data.id].iconImg}}};Object.defineProperty(ShenshouTab.prototype,"selected",{set:function(value){this.select.visible=value},enumerable:true,configurable:true});return ShenshouTab}(BaseItemRender);__reflect(ShenshouTab.prototype,"ShenshouTab");var ShenshouWearEquipItem=function(_super){__extends(ShenshouWearEquipItem,_super);function ShenshouWearEquipItem(){return _super.call(this)||this}ShenshouWearEquipItem.prototype.childrenCreated=function(){};ShenshouWearEquipItem.prototype.dataChanged=function(){if(this.data instanceof ShenshouEquipData){this.itemIcon.data=this.data.id;var itemConfig=GlobalConfig.ItemConfig[this.data.id];this.quality.text=ShenshouModel.EQUIPE_QUALITY_CN[ItemConfig.getQuality(itemConfig)];this.quality.textColor=ItemConfig.getQualityColor(itemConfig);this.quality.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.now.visible=false;this.best.visible=false;this.changeBtn.visible=true;if(this.data.sortIndex==Number.MAX_VALUE){this.now.visible=true;this.changeBtn.visible=false}if(this.data.best){this.best.visible=true}var baseEquip=GlobalConfig.ShenShouEquip[ShenshouModel.ins().getEquipBaseId(this.data.id)];var equipDp=GlobalConfig.ShenShouEquip[this.data.id];var myDt=ShenshouModel.ins().getDataById(this.data.shenshuId);var myBaseEquip=myDt?GlobalConfig.ShenShouEquip[ShenshouModel.ins().getEquipBaseId(myDt.equipIDs[this.data.pos])]:null;for(var i=0;i<3;i++){if(equipDp.attrs[i]){this["attr"+i].visible=true;this["attr"+i].text=AttributeData.getAttStrByType(baseEquip.attrs[i],0,":");this["betterArrow"+i].visible=!myBaseEquip||myBaseEquip&&baseEquip.attrs[i].value>myBaseEquip.attrs[i].value;if(equipDp.attrs[i].value>baseEquip.attrs[i].value){this["forgeAttr"+i].visible=true;this["forgeAttr"+i].text="+"+(equipDp.attrs[i].value-baseEquip.attrs[i].value)}else{this["forgeAttr"+i].visible=false}}else{this["attr"+i].visible=false;this["betterArrow"+i].visible=false;this["forgeAttr"+i].visible=false}}var score=UserBag.getAttrPower(equipDp.attrs);if(equipDp.expower)score+=equipDp.expower;this.power.text=i18n("ShenshouWearEquipItem_0",score*3)}};return ShenshouWearEquipItem}(BaseItemRender);__reflect(ShenshouWearEquipItem.prototype,"ShenshouWearEquipItem");var ShenshouWearEquipWin=function(_super){__extends(ShenshouWearEquipWin,_super);function ShenshouWearEquipWin(){var _this=_super.call(this)||this;_this.skinName="SsEquipChooseSkin";return _this}ShenshouWearEquipWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.addTouchEvent(this.list,this.onTouch);this.list.itemRenderer=ShenshouWearEquipItem;this.listDt=new eui.ArrayCollection;this.list.dataProvider=this.listDt;this.shenshouId=args[0];this.pos=args[1];var items=ShenshouModel.ins().findCanWearEquips(this.shenshouId,this.pos);if(items.length>0){if(args[2]){var myEquip=new ShenshouEquipData;myEquip.pos=this.pos;myEquip.shenshuId=this.shenshouId;myEquip.sortIndex=Number.MAX_VALUE;myEquip.id=args[2];items.splice(0,0,myEquip)}this.listDt.replaceAll(items);this.tipLabel2.visible=false}else{this.tipLabel2.visible=true}};ShenshouWearEquipWin.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}};ShenshouWearEquipWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;default:if(e.target instanceof eui.Button&&e.target.parent instanceof ShenshouWearEquipItem){var data=e.target.parent.data;ShenshouSys.ins().sendWearEquip(this.shenshouId,this.pos,data.id)}}};return ShenshouWearEquipWin}(BaseEuiView);__reflect(ShenshouWearEquipWin.prototype,"ShenshouWearEquipWin");ViewManager.ins().reg(ShenshouWearEquipWin,LayerManager.UI_Popup);var ShenshouWin=function(_super){__extends(ShenshouWin,_super);function ShenshouWin(){var _this=_super.call(this)||this;_this.curId=1;_this.MAX_SKILL=4;return _this}ShenshouWin.prototype.childrenCreated=function(){this.listMenu.itemRenderer=ShenshouTab;this.listMenuDt=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.ShenShouBase));this.listMenu.dataProvider=this.listMenuDt};ShenshouWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.rightBtn,this.onTouch);this.addTouchEvent(this.leftBtn,this.onTouch);this.addTouchEvent(this.activityBtn,this.onTouch);this.addTouchEvent(this.shenshouItem,this.onTouch);this.addEvent(eui.ItemTapEvent.ITEM_TAP,this.listMenu,this.onTouchMenu);this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange);for(var i=1;i<=this.MAX_SKILL;i++){this.addTouchEvent(this["skill"+i],this.onTouch)}this.observe(ShenshouRedpoint.ins().postRedPoint,this.refRedPoint);this.observe(ShenshouSys.ins().postWearEquip,this.refEquipData);this.observe(ShenshouSys.ins().postUpEquip,this.refEquipData);this.observe(ShenshouSys.ins().postInfo,this.refData);this.observe(ShenshouSys.ins().postBattleState,this.refData);this.listMenu.selectedIndex=0;this.showUI(this.curId);this.onChange();this.refRedPoint();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.shengShou)};ShenshouWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack);this.shenshouItem.close()};ShenshouWin.prototype.onTouchMenu=function(e){this.curId=e.item.id;this.showUI(this.curId)};ShenshouWin.prototype.onChange=function(){if(this.listMenu.scrollH<20){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.listMenu.scrollH>(this.listMenu.dataProvider.length-5)*88+2){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.listMenu.dataProvider.length<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}this.refArrowRedpoint()};ShenshouWin.prototype.showUI=function(id){var model=ShenshouModel.ins();var sys=ShenshouSys.ins();var data=model.getDataById(id);var dp=GlobalConfig.ShenShouBase[id];for(var i=0;i<this.MAX_SKILL;i++){if(dp.skill&&dp.skill[i]){this["skill"+(i+1)].visible=true;this["skill"+(i+1)].touchChildren=false;var skillData=GlobalConfig.ShenShouSkill[dp.skill[i]];this["skill"+(i+1)].name=dp.skill[i];this["skill"+(i+1)].skillImg.source=skillData.icon;this["skill"+(i+1)].skillName.text=skillData.name;this["skill"+(i+1)].skillQuality.source="quality"+skillData.quality}else{this["skill"+(i+1)].visible=false}}this.shenshouItem.setID(id);this.refEquipData()};ShenshouWin.prototype.refEquipData=function(){var model=ShenshouModel.ins();this.shenshouItem.refEquipData();this.attr1.text="+"+model.getAttrValue(this.curId,AttributeType.atAttack);this.attr2.text="+"+model.getAttrValue(this.curId,AttributeType.atMaxHp);this.attr3.text="+"+model.getAttrValue(this.curId,AttributeType.atDef);this.attr4.text="+"+model.getAttrValue(this.curId,AttributeType.atRes);this.powerPanel.setPower(ShenshouModel.ins().calcEquipScore(this.curId)*SubRoles.ins().subRolesLen);this.refEquipRedpoint();this.refData()};ShenshouWin.prototype.refData=function(){var model=ShenshouModel.ins();var sys=ShenshouSys.ins();this.fightCount.text=i18n("ShenshouWin_0",model.getCurBattle(),model.getCountBattle());var state=model.getCurStatus(this.curId);this.shenshouItem.refState(state);switch(state){case ShenshouState.State_No:this.activityBtn.enabled=false;this.activityBtn.label=i18n("ShenshouWin_1");break;case ShenshouState.State_Can:this.activityBtn.enabled=true;this.activityBtn.label=i18n("ShenshouWin_2");break;case ShenshouState.State_Has:this.activityBtn.enabled=true;this.activityBtn.label=i18n("ShenshouWin_3");break}this.listMenuDt.replaceAll(CommonUtils.objectToArray(GlobalConfig.ShenShouBase))};ShenshouWin.prototype.refArrowRedpoint=function(){this.rightRed.visible=false;this.leftRed.visible=false;if(this.leftBtn.visible){var redList=ShenshouRedpoint.ins().redpoints.slice(0,4);this.leftRed.visible=redList.indexOf(true)>-1}if(this.rightBtn.visible){var redList=ShenshouRedpoint.ins().redpoints.slice(5,9);this.rightRed.visible=redList.indexOf(true)>-1}};ShenshouWin.prototype.refRedPoint=function(){this.refArrowRedpoint();this.listMenuDt.replaceAll(CommonUtils.objectToArray(GlobalConfig.ShenShouBase));this.refEquipRedpoint()};ShenshouWin.prototype.refEquipRedpoint=function(){for(var i=0;i<GlobalConfig.ShenShouConfig.posCount;i++){if(ShenshouRedpoint.ins().redpointEquips1[this.curId]&&ShenshouRedpoint.ins().redpointEquips1[this.curId][i+1]||ShenshouRedpoint.ins().redpointEquips2[this.curId]&&ShenshouRedpoint.ins().redpointEquips2[this.curId][i+1]){this.shenshouItem["item"+i].redPoint.visible=true}else{this.shenshouItem["item"+i].redPoint.visible=false}}};ShenshouWin.prototype.onTouch=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.rightBtn:scrollH=this.listMenu.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.listMenu.contentWidth-this.listScroller.width){scrollH=this.listMenu.contentWidth-this.listScroller.width}this.listMenu.scrollH=scrollH;this.onChange();break;case this.leftBtn:scrollH=this.listMenu.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.listMenu.scrollH=scrollH;this.onChange();break;case this.activityBtn:if(ShenshouModel.ins().getCurStatus(this.curId)==ShenshouState.State_Can){var curNum=ShenshouModel.ins().getCurBattle();if(curNum<GlobalConfig.ShenShouConfig.maxCount&&UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.ShenShouConfig.battleCountItem)&&curNum>=ShenshouModel.ins().getCountBattle()){ViewManager.ins().open(ShenshouDanUseWin,GlobalConfig.ItemConfig[GlobalConfig.ShenShouConfig.battleCountItem]);return}if(curNum>=ShenshouModel.ins().getCountBattle()){UserTips.ins().showCenterTips(i18n("ShenshouWin_4"));return}}ShenshouSys.ins().sendBattle(this.curId);break;default:if(e.target.skinName=="shenshouEquipItem"){var pos=parseInt(e.target.name);if(e.target.data){ViewManager.ins().open(ShenshouEquipTip,this.curId,pos,e.target.data)}else{ViewManager.ins().open(ShenshouWearEquipWin,this.curId,pos)}}else if(e.target.parent.skinName=="shenshouSkillItem"||e.target.skinName=="shenshouSkillItem"){ViewManager.ins().open(ShenshouSkillTip,GlobalConfig.ShenShouSkill[e.target.name])}}};__decorate([callLater],ShenshouWin.prototype,"refEquipData",null);return ShenshouWin}(BaseView);__reflect(ShenshouWin.prototype,"ShenshouWin");var MapGrid=function(_super){__extends(MapGrid,_super);function MapGrid(){var _this=_super.call(this)||this;_this.touchEnabled=false;_this._poolNodes=[];return _this}Object.defineProperty(MapGrid.prototype,"numCols",{get:function(){return this._numCols},enumerable:true,configurable:true});Object.defineProperty(MapGrid.prototype,"numRows",{get:function(){return this._numRows},enumerable:true,configurable:true});MapGrid.prototype.getNode=function(x,y){if(this._nodes[x])return this._nodes[x][y];else return undefined};MapGrid.prototype.isWalkableTile=function(x,y){if(x<0||x>=this._numCols||y<0||y>=this._numRows)return false;else return this._nodes[x][y].walkable};MapGrid.prototype.destruct=function(){this.clearNodes()};MapGrid.prototype.initMapInfo=function(mapInfo,turn){if(this._nodes)this.clearNodes();this._numRows=mapInfo.maxY;this._numCols=mapInfo.maxX;this._nodes=[];var node;for(var i=0;i<this._numCols;i++){this._nodes[i]=[];for(var j=0;j<this._numRows;j++){node=this.getGridNode();node.flags=mapInfo.grids[i*this._numRows+j];this._nodes[i][j]=node}}if(turn)this._nodes.reverse()};MapGrid.prototype.clearNodes=function(){for(var i in this._nodes){this._poolNodes=this._poolNodes.concat(this._nodes[i]);this._nodes[i].length=0}this._nodes.length=0};MapGrid.prototype.getGridNode=function(){return this._poolNodes.pop()||new MapGridNode};MapGrid.prototype._trace=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}if(this.debugTrace!=null)this.debugTrace.apply(null,args)};return MapGrid}(egret.Sprite);__reflect(MapGrid.prototype,"MapGrid");var FeatsStoreData=function(){function FeatsStoreData(len,bytes){this.exchangeCount=[];var _index;var _exchangeCount;for(var i=0;i<len;i++){_index=bytes.readInt();_exchangeCount=bytes.readInt();this.exchangeCount[_index]=_exchangeCount}}FeatsStoreData.prototype.checkHonorBuy=function(id){var feats=GlobalConfig.FeatsStore[id];if(Actor.chip<feats.costMoney.count)return false;switch(feats.buyType){case FEATS_TYPE.day:if(this.exchangeCount[feats.index-1]>=feats.daycount){return true}break;case FEATS_TYPE.infinite:return true;case FEATS_TYPE.forever:if(this.exchangeCount[feats.index-1]>=feats.daycount){return true}break}return false};FeatsStoreData.prototype.checkHonorRedPoint=function(){for(var i in GlobalConfig.FeatsStore){var b=this.checkHonorBuy(GlobalConfig.FeatsStore[i].goods[0].id);if(b)return true}return false};return FeatsStoreData}();__reflect(FeatsStoreData.prototype,"FeatsStoreData");var FEATS_TYPE;(function(FEATS_TYPE){FEATS_TYPE[FEATS_TYPE["day"]=1]="day";FEATS_TYPE[FEATS_TYPE["infinite"]=2]="infinite";FEATS_TYPE[FEATS_TYPE["forever"]=3]="forever"})(FEATS_TYPE||(FEATS_TYPE={}));window["FEATS_TYPE"]=FEATS_TYPE;var FEATS_SHOP_TYPE;(function(FEATS_SHOP_TYPE){FEATS_SHOP_TYPE[FEATS_SHOP_TYPE["Money"]=1]="Money";FEATS_SHOP_TYPE[FEATS_SHOP_TYPE["Item"]=2]="Item"})(FEATS_SHOP_TYPE||(FEATS_SHOP_TYPE={}));window["FEATS_SHOP_TYPE"]=FEATS_SHOP_TYPE;var SsStoreData=function(){function SsStoreData(len,bytes){this.exchangeCount=[];var _index;var _exchangeCount;for(var i=0;i<len;i++){_index=bytes.readInt();_exchangeCount=bytes.readInt();this.exchangeCount[_index]=_exchangeCount}}SsStoreData.prototype.checkHonorBuy=function(id){var cfg=GlobalConfig.ShapeShiftingStoreConfig[id];if(ShapeShiftingMgr.ins().shapeChip<cfg.costMoney.count)return false;switch(cfg.buyType){case FEATS_TYPE.day:if(this.exchangeCount[cfg.id-1]>=cfg.dayCount){return true}break;case FEATS_TYPE.infinite:return true;case FEATS_TYPE.forever:if(this.exchangeCount[cfg.id-1]>=cfg.dayCount){return true}break}return false};SsStoreData.prototype.checkHonorRedPoint=function(){for(var i in GlobalConfig.ShapeShiftingStoreConfig){var b=this.checkHonorBuy(GlobalConfig.ShapeShiftingStoreConfig[i].goods[0].id);if(b)return true}return false};return SsStoreData}();__reflect(SsStoreData.prototype,"SsStoreData");var BlackMarketItemRenderer=function(_super){__extends(BlackMarketItemRenderer,_super);function BlackMarketItemRenderer(){var _this=_super.call(this)||this;_this.goodsID=0;_this.skinName="BlackMarketItem";_this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.showTip,_this);return _this}Object.defineProperty(BlackMarketItemRenderer,"moneyTypeToIcon",{get:function(){var _moneyTypeToIcon=this._moneyTypeToIcon;if(_moneyTypeToIcon==null){_moneyTypeToIcon=[i18n("BlackMarketItemRenderer_0"),"szjinbi","szyuanbao"];this._moneyTypeToIcon=_moneyTypeToIcon}return _moneyTypeToIcon},enumerable:true,configurable:true});BlackMarketItemRenderer.prototype.dataChanged=function(){var shopItem=this.data;var itemData=shopItem.item;var itemConfig=GlobalConfig.ItemConfig[itemData.configID];this.goodsID=shopItem.id;var costStr="";if(shopItem.costType==2){costStr=shopItem.costNum+""}else if(shopItem.costNum>1e5){costStr=Math.floor(shopItem.costNum/1e4)+i18n("BlackMarketItemRenderer_1")}else{costStr=shopItem.costNum+""}this.money.text=costStr;this.itemName.text=itemConfig.name;this.itemName.textColor=ItemConfig.getQualityColor(itemConfig);if(itemConfig.zsLevel&&itemConfig.zsLevel>0){this.level.text="("+itemConfig.zsLevel+i18n("BlackMarketItemRenderer_2")}else if(itemConfig.level&&itemConfig.level>0){this.level.text="("+itemConfig.level+"级)"}else this.level.text="";this.level.x=this.itemName.x+this.itemName.width;this.num.text=itemData.count==1?"":itemData.count+"";this.moneyIcon.source=BlackMarketItemRenderer.moneyTypeToIcon[shopItem.costType];this.itemIcon.setData(itemConfig);if(ItemConfig.getJob(itemConfig)!=0){var ceGap=UserBag.ins().calculationScore(shopItem.item);if(ceGap>0){this.arrowIcon.visible=true;this.CEKey.visible=true;this.CEValue.visible=true;this.CEValue.text=ceGap+""}else{this.arrowIcon.visible=false;this.CEKey.visible=false;this.CEValue.visible=false}}else{this.arrowIcon.visible=false;this.CEKey.visible=false;this.CEValue.visible=false}var dic=shopItem.discountType;if(dic){var dic2=0;if(dic%10==0){dic2=dic/10;if(dic2==10){this.discount.visible=false;this.wuzhe.visible=false;this.discountNum.visible=false}else{this.discount.source="shangzk0";this.wuzhe.visible=false;this.discountNum.visible=true;this.discountNum.text=dic2.toString()}}else if(dic%10!=0){dic2=dic;this.discount.source="shangzk0";this.wuzhe.visible=false;this.discountNum.visible=true;this.discountNum.text=dic2.toString()}}else{var eqcfg=GlobalConfig.EquipItemConfig[this.goodsID];this.discount.source=eqcfg.discountImg;this.wuzhe.visible=false;this.discountNum.visible=false}};BlackMarketItemRenderer.prototype.showTip=function(){var configID;var shopData=Shop.ins().shopData;var len=shopData.getShopEquipDataLength();var sed=null;for(var i=0;i<len;i++){sed=shopData.getShopEquipDataByIndex(i);if(sed!=null){if(sed.id==this.goodsID){configID=sed.item.configID;break}}}if(configID==undefined){new Error(i18n("BlackMarketItemRenderer_3"))}var itemConfig=GlobalConfig.ItemConfig[configID];var type=ItemConfig.getType(itemConfig);if(type!=undefined){if(type==0){ViewManager.ins().open(EquipDetailedWin,1,this.data.item.handle,itemConfig.id)}else{ViewManager.ins().open(ItemDetailedWin,0,itemConfig.id,this.data.item.count)}}};return BlackMarketItemRenderer}(BaseItemRender);__reflect(BlackMarketItemRenderer.prototype,"BlackMarketItemRenderer");var BlackMarketPanel=function(_super){__extends(BlackMarketPanel,_super);function BlackMarketPanel(){var _this=_super.call(this)||this;_this.name=i18n("BlackMarketPanel_0");return _this}BlackMarketPanel.prototype.childrenCreated=function(){this.init()};BlackMarketPanel.prototype.init=function(){};BlackMarketPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.listView.itemRenderer=BlackMarketItemRenderer;this.addTouchEvent(this,this.onTap);this.addTouchEvent(this.buyAllItemBtn,this.buyAllItem);this.addTouchEvent(this.refreshShopBtn,this.refreshShop);this.addTouchEvent(this.goodsOverView,this.onClick);this.observe(Shop.ins().postUpdateShopData,this.updateData);this.observe(Shop.ins().postBuyResult,this.buyResultCB);this.observe(ShopRedPoint.ins().postBlackMarketRedPoint,this.updateRedPoint);this.price.text=GlobalConfig.StoreCommonConfig.refreshYuanBao+"";var text=this.goodsOverView.text;this.goodsOverView.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+text);this.updateData()};BlackMarketPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buyAllItemBtn,this.buyAllItem);this.removeTouchEvent(this.refreshShopBtn,this.refreshShop);this.removeTouchEvent(this,this.onTap);this.removeTouchEvent(this.goodsOverView,this.onClick);this.removeObserve();TimerManager.ins().removeAll(this)};BlackMarketPanel.prototype.onClick=function(e){switch(e.currentTarget){case this.goodsOverView:ViewManager.ins().open(ShopBestTips);break}};BlackMarketPanel.prototype.updateRedPoint=function(){this.redPoint.visible=ShopRedPoint.ins().blackMarketRedPoint};BlackMarketPanel.prototype.buyAllItem=function(e){var arr=[];var allGold=0;var allYb=0;var bagNum=0;var shopData=Shop.ins().shopData;var len=shopData.getShopEquipDataLength();var sed=null;var point=0;for(var i=0;i<len;i++){sed=shopData.getShopEquipDataByIndex(i);if(sed!=null){if(ItemConfig.getType(sed.item.itemConfig)==0){point=UserBag.ins().calculationScore(sed.item);if(point>0){bagNum+=1}else{continue}}arr.push([sed.id,1]);if(sed.costType==1){allGold+=sed.costNum}else{allYb+=sed.costNum}}}if(UserBag.ins().getSurplusCount()<bagNum){var strTips=i18n("BlackMarketPanel_1");UserTips.ins().showTips(strTips);return}if(Actor.gold<allGold){UserWarn.ins().setBuyGoodsWarn(1);return}if(Actor.yb<allYb){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("BlackMarketPanel_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("BlackMarketPanel_3"));return}if(allGold==0&&allYb==0){UserTips.ins().showTips(i18n("BlackMarketPanel_4"));return}Shop.ins().sendBuy(2,arr)};BlackMarketPanel.prototype.refreshShop=function(e){if(Shop.ins().shopData.times>GlobalConfig.StoreCommonConfig.refreshLimit){UserTips.ins().showTips(i18n("BlackMarketPanel_5"));return}if(Shop.ins().shopData.refushTime<=0){Shop.ins().sendRefreshShop()}else{var itemData=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.StoreCommonConfig.refreshItem);var num=itemData?itemData.count:0;if(num){Shop.ins().sendRefreshShop()}else{if(Actor.yb<GlobalConfig.StoreCommonConfig.refreshYuanBao){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("BlackMarketPanel_6"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("BlackMarketPanel_7"));return}Shop.ins().sendRefreshShop()}}};BlackMarketPanel.prototype.onTap=function(e){if(e.target.name=="buy"){if(UserBag.ins().getSurplusCount()<=0){var strTips=i18n("BlackMarketPanel_8");UserTips.ins().showTips(strTips);return}var goodsID=e.target.parent["goodsID"];var sed=Shop.ins().shopData.getShopEquipDataById(goodsID);if(Assert(sed,i18n("BlackMarketPanel_9",goodsID))){return}if(sed.costType==1){if(Actor.gold<sed.costNum){UserWarn.ins().setBuyGoodsWarn(1);return}}else{if(Actor.yb<sed.costNum){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("BlackMarketPanel_10"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("BlackMarketPanel_11"));return}}var item=sed.item;var job=ItemConfig.getJob(item.itemConfig);var type=ItemConfig.getType(item.itemConfig);if(type==0&&job!=0){var point=UserBag.ins().calculationScore(item);if(point>0){var arr=[goodsID,1];Shop.ins().sendBuy(2,[arr])}else{WarnWin.show(i18n("BlackMarketPanel_12"),function(){},this,null,null,"sure")}}else{var arr=[goodsID,1];Shop.ins().sendBuy(2,[arr])}}};BlackMarketPanel.prototype.buyResultCB=function(result){if(result==1){UserTips.ins().showTips(i18n("BlackMarketPanel_13"))}else{UserTips.ins().showTips(i18n("BlackMarketPanel_14"))}this.updateOthersUI()};BlackMarketPanel.prototype.updateOthersUI=function(){var itemData=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.StoreCommonConfig.refreshItem);var num=itemData?itemData.count:0;var colorStr="";if(num){colorStr=i18n("BlackMarketPanel_20")}else{colorStr=ColorUtil.RED_COLOR}this.keylabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+num+"</font> ");if(Shop.ins().shopData.refushTime<=0)this.refreshShopBtn.label=i18n("BlackMarketPanel_15");else this.refreshShopBtn.label=i18n("BlackMarketPanel_16")};BlackMarketPanel.prototype.updateData=function(){var arr=[];var shopData=Shop.ins().shopData;var len=shopData.getShopEquipDataLength();var sed=null;for(var i=0;i<len;i++){sed=shopData.getShopEquipDataByIndex(i);if(sed!=null){arr.push(sed)}}this.listView.dataProvider=new eui.ArrayCollection(arr);if(!TimerManager.ins().isExists(this.refushEndTime,this)){TimerManager.ins().doTimer(1e3,Shop.ins().shopData.refushTime,this.refushEndTime,this);this.refushEndTime()}if(arr.length<=0){this.noGoods.visible=true}else{this.noGoods.visible=false}this.point.text=i18n("BlackMarketPanel_17")+Shop.ins().shopData.point;this.updateOthersUI();this.updateRedPoint()};BlackMarketPanel.prototype.refushEndTime=function(){this.tip.text=i18n("BlackMarketPanel_18")+DateUtils.getFormatBySecond(Shop.ins().shopData.refushTime);this.tipsBg.visible=this.tip.visible=this.costGroup.visible=true;if(Shop.ins().shopData.refushTime<=0){this.tipsBg.visible=this.tip.visible=this.costGroup.visible=false}};return BlackMarketPanel}(BaseComponent);__reflect(BlackMarketPanel.prototype,"BlackMarketPanel");ViewManager.ins().reg(BlackMarketPanel,LayerManager.UI_Main);var BuySpecialWin=function(_super){__extends(BuySpecialWin,_super);function BuySpecialWin(){return _super.call(this)||this}BuySpecialWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="BuySpecialSkin";this.num=3};BuySpecialWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.add1Btn,this.onTap);this.addTouchEvent(this.add10Btn,this.onTap);this.addTouchEvent(this.sub1Btn,this.onTap);this.addTouchEvent(this.sub10Btn,this.onTap);this.addTouchEvent(this.buyBtn,this.buy);this.addTouchEvent(this.bgClose,this.onTap);this.addChangeEvent(this.numLabel,this.inputOver);this.num=3;this.updateView()};BuySpecialWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.add1Btn,this.onTap);this.removeTouchEvent(this.add10Btn,this.onTap);this.removeTouchEvent(this.sub1Btn,this.onTap);this.removeTouchEvent(this.sub10Btn,this.onTap);this.removeTouchEvent(this.buyBtn,this.buy);this.removeTouchEvent(this.bgClose,this.onTap);this.numLabel.removeEventListener(egret.Event.CHANGE,this.inputOver,this)};BuySpecialWin.prototype.updateView=function(){this.numLabel.text=this.num+"";this.unitPrice.text=""+GlobalConfig.GuardGodWeaponConf.sSummonCost[0];this.allPrice.text=this.num*parseInt(this.unitPrice.text)+""};BuySpecialWin.prototype.onTap=function(e){switch(e.currentTarget){case this.sub10Btn:this.num-=10;break;case this.sub1Btn:this.num-=1;break;case this.add10Btn:this.num+=10;break;case this.add1Btn:this.num+=1;break;case this.bgClose:ViewManager.ins().close(this);break}if(this.num<0)this.num=0;if(this.num>this.maxNum){this.num=this.maxNum}this.numLabel.text=this.num+"";this.inputOver()};BuySpecialWin.prototype.closeCB=function(e){ViewManager.ins().close(BuyWin)};BuySpecialWin.prototype.buy=function(e){if(Actor.yb>=parseInt(this.allPrice.text)){UserFb.ins().sendShSweep(parseInt(this.numLabel.text));ViewManager.ins().close(this)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("BuySpecialWin_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("BuySpecialWin_1"))}};BuySpecialWin.prototype.inputOver=function(e){this.num=parseInt(this.numLabel.text);if(isNaN(this.num)||this.num<0)this.num=0;if(this.num>3)this.num=3;if(this.num>this.maxNum){this.num=this.maxNum}this.numLabel.text=this.num+"";this.allPrice.text=this.num*parseInt(this.unitPrice.text)+""};return BuySpecialWin}(BaseEuiView);__reflect(BuySpecialWin.prototype,"BuySpecialWin");ViewManager.ins().reg(BuySpecialWin,LayerManager.UI_Popup);var BuyWin=function(_super){__extends(BuyWin,_super);function BuyWin(){return _super.call(this)||this}BuyWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="BuySkin";this.num=1;this.itemIcon.imgJob.visible=false};BuyWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.add1Btn,this.onTap);this.addTouchEvent(this.add10Btn,this.onTap);this.addTouchEvent(this.sub1Btn,this.onTap);this.addTouchEvent(this.sub10Btn,this.onTap);this.addTouchEvent(this.buyBtn,this.buy);this.addTouchEvent(this.bgClose,this.onTap);this.addChangeEvent(this.numLabel,this.inputOver);this.num=1;this.shopID=param[0];this.shopType=param[1]?param[1]:0;this.yuanbao0.visible=this.yuanbao1.visible=true;if(this.shopType==2||this.shopType==3){this.yuanbao0.visible=this.yuanbao1.visible=false;this.num=this.getChipNumRule();this.honor0.source=this.shopType==2?"ZSchip":"204076_png";this.honor1.source=this.shopType==2?"ZSchip":"204076_png"}if(this.shopType==4){this.yuanbao0.visible=this.yuanbao1.visible=false;this.num=this.getChipNumRule4();this.honor0.source="ZSbschip";this.honor1.source="ZSbschip"}this.honor0.visible=this.honor1.visible=!this.yuanbao0.visible;this.updateView()};BuyWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.add1Btn,this.onTap);this.removeTouchEvent(this.add10Btn,this.onTap);this.removeTouchEvent(this.sub1Btn,this.onTap);this.removeTouchEvent(this.sub10Btn,this.onTap);this.removeTouchEvent(this.buyBtn,this.buy);this.removeTouchEvent(this.bgClose,this.onTap);this.numLabel.removeEventListener(egret.Event.CHANGE,this.inputOver,this)};BuyWin.prototype.getChipNumRule=function(){var feats=GlobalConfig.FeatsStore[this.shopID];var sum=0;if(feats.shopType==FEATS_SHOP_TYPE.Money){if(Actor.chip<feats.costMoney.count){this.maxNum=1;return this.maxNum}sum=Math.floor(Actor.chip/feats.costMoney.count)}else if(feats.shopType==FEATS_SHOP_TYPE.Item){var costItemNum=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,feats.costItem.id);if(costItemNum<feats.costItem.count){this.maxNum=1;return this.maxNum}sum=Math.floor(costItemNum/feats.costItem.count)}var count=0;if(!Shop.ins().medalData)return 0;var exchangeCount=Shop.ins().medalData.exchangeCount[this.shopID];exchangeCount=exchangeCount?exchangeCount:0;switch(feats.buyType){case FEATS_TYPE.day:count=feats.daycount-exchangeCount;count=count>0?count:1;count=count>sum?sum:count;break;case FEATS_TYPE.infinite:count=sum;break;case FEATS_TYPE.forever:count=feats.daycount-exchangeCount;count=count>0?count:1;count=count>sum?sum:count;break}this.maxNum=count;return this.maxNum};BuyWin.prototype.getChipNumRule4=function(){var cfg=GlobalConfig.ShapeShiftingStoreConfig[this.shopID];var sum=0;if(ShapeShiftingMgr.ins().shapeChip<cfg.costMoney.count){this.maxNum=1;return this.maxNum}sum=Math.floor(ShapeShiftingMgr.ins().shapeChip/cfg.costMoney.count);var count=0;if(!Shop.ins().ssData)return 0;var exchangeCount=Shop.ins().ssData.exchangeCount[this.shopID];exchangeCount=exchangeCount?exchangeCount:0;switch(cfg.buyType){case FEATS_TYPE.day:count=cfg.dayCount-exchangeCount;count=count>0?count:1;count=count>sum?sum:count;break;case FEATS_TYPE.infinite:count=sum;break;case FEATS_TYPE.forever:count=cfg.dayCount-exchangeCount;count=count>0?count:1;count=count>sum?sum:count;break}this.maxNum=count;return 1};BuyWin.prototype.updateView=function(){var shopConfig;var itemConfig;if(this.shopType!=2&&this.shopType!=3&&this.shopType!=4){shopConfig=GlobalConfig.ItemStoreConfig[this.shopID];itemConfig=GlobalConfig.ItemConfig[shopConfig.itemId];this.itemIcon.setData(itemConfig);if(shopConfig.vipLimit){this.maxNum=shopConfig.vipLimit[UserVip.ins().lv]-Shop.ins().shopData.getHadBuyCount(shopConfig.itemId);this.itemName0.text=i18n("BuyWin_0",this.maxNum);this.itemName0.visible=true}else{this.maxNum=Number.MAX_VALUE;this.itemName0.visible=false}if(this.num>this.maxNum){this.num=this.maxNum}this.unitPrice.text=shopConfig.price+"";this.allPrice.text=this.num*shopConfig.price+"";this.numLabel.text=this.num+"";this.itemName.text=itemConfig.name;this.itemName.textColor=ItemBase.QUALITY_COLOR[ItemConfig.getQuality(itemConfig)];this.itemName.strokeColor=ItemBase.QUALITY_STROKE_COLOR[ItemConfig.getQuality(itemConfig)];this.used.text="（"+shopConfig.use+"）";this.used.x=this.itemName.x+this.itemName.width;return}if(this.shopType==2||this.shopType==3){shopConfig=GlobalConfig.FeatsStore[this.shopID];this.goodId=shopConfig.index}if(this.shopType==4){shopConfig=GlobalConfig.ShapeShiftingStoreConfig[this.shopID];this.goodId=shopConfig.id}this.itemName0.visible=false;itemConfig=GlobalConfig.ItemConfig[shopConfig.goods[0].id];this.itemIcon.setData(itemConfig);if(this.shopType==2)this.unitPrice.text=shopConfig.costMoney.count+"";else if(this.shopType==3)this.unitPrice.text=shopConfig.costItem.count+"";else if(this.shopType==4)this.unitPrice.text=shopConfig.costMoney.count+"";this.allPrice.text=this.num*parseInt(this.unitPrice.text)+"";this.numLabel.text=this.num+"";this.itemName.text=itemConfig.name;this.itemName.textColor=ItemBase.QUALITY_COLOR[ItemConfig.getQuality(itemConfig)];this.itemName.strokeColor=ItemBase.QUALITY_STROKE_COLOR[ItemConfig.getQuality(itemConfig)];if(shopConfig.use){this.used.text="（"+shopConfig.use+"）"}};BuyWin.prototype.onTap=function(e){switch(e.currentTarget){case this.sub10Btn:this.num-=10;break;case this.sub1Btn:this.num-=1;break;case this.add10Btn:this.num+=10;break;case this.add1Btn:this.num+=1;break;case this.bgClose:ViewManager.ins().close(this);break}if(this.num<1)this.num=1;if(this.num>this.maxNum){this.num=this.maxNum}this.numLabel.text=this.num+"";this.inputOver()};BuyWin.prototype.closeCB=function(e){ViewManager.ins().close(BuyWin)};BuyWin.prototype.buy=function(e){if(this.shopType==2){if(Actor.chip>=parseInt(this.allPrice.text)){Shop.ins().sendBuyMedal(this.goodId,this.num);ViewManager.ins().close(this)}else{UserTips.ins().showTips(i18n("BuyWin_1"))}}else if(this.shopType==3){var feats=GlobalConfig.FeatsStore[this.shopID];if(UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,feats.costItem.id)>=parseInt(this.allPrice.text)){Shop.ins().sendBuyMedal(this.goodId,this.num);ViewManager.ins().close(this)}else UserTips.ins().showTips(i18n("BuyWin_2"))}else if(this.shopType==4){if(ShapeShiftingMgr.ins().shapeChip>=parseInt(this.allPrice.text)){Shop.ins().sendBuySS(this.goodId,this.num);ViewManager.ins().close(this)}else{UserTips.ins().showTips(i18n("BuyWin_3"))}}else{if(Actor.yb>=parseInt(this.allPrice.text)){var arr=[this.shopID,this.num];Shop.ins().sendBuy(1,[arr]);ViewManager.ins().close(this)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("BuyWin_4"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("BuyWin_5"))}}};BuyWin.prototype.inputOver=function(e){this.num=parseInt(this.numLabel.text);if(isNaN(this.num)||this.num<1)this.num=1;if(this.num>9999)this.num=9999;if(this.num>this.maxNum){this.num=this.maxNum}this.numLabel.text=this.num+"";this.allPrice.text=this.num*parseInt(this.unitPrice.text)+""};return BuyWin}(BaseEuiView);__reflect(BuyWin.prototype,"BuyWin");ViewManager.ins().reg(BuyWin,LayerManager.UI_Popup);var HonorMarketPanel=function(_super){__extends(HonorMarketPanel,_super);function HonorMarketPanel(){var _this=_super.call(this)||this;_this.name=i18n("HonorMarketPanel_0");return _this}HonorMarketPanel.prototype.childrenCreated=function(){this.init()};HonorMarketPanel.prototype.init=function(){this.listView.itemRenderer=HonorMarketItemRenderer;this.dataArr=new eui.ArrayCollection;this.listView.dataProvider=this.dataArr};HonorMarketPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.listView.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this);this.addTouchEndEvent(this.get,this.onClick);this.observe(Shop.ins().postRefresMedalMessage,this.updateData);this.observe(Actor.ins().postFeatsChange,this.callback);this.observe(Shop.ins().postUpdateBuyMedal,this.callback);Shop.ins().sendMedalMessage()};HonorMarketPanel.prototype.callback=function(){Shop.ins().sendMedalMessage()};HonorMarketPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.get,this.onClick);this.removeObserve()};HonorMarketPanel.prototype.updateData=function(){var arr=[];var dataProvider=GlobalConfig.FeatsStore;for(var k in dataProvider){var isPush=true;if(dataProvider[k].buyType==FEATS_TYPE.forever){for(var i in Shop.ins().medalData.exchangeCount){if(dataProvider[k].index==Number(i)&&dataProvider[k].daycount){if(Shop.ins().medalData.exchangeCount[i]>=dataProvider[k].daycount){isPush=false}break}}}if(isPush)arr.push(dataProvider[k])}this.dataArr.replaceAll(arr);this.myAttrValue0.text=Actor.feats+"";var text=this.get.text;this.get.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+text)};HonorMarketPanel.prototype.onClick=function(e){switch(e.currentTarget){case this.get:UserWarn.ins().setBuyGoodsWarn(7);break}};HonorMarketPanel.prototype.onTap=function(e){};return HonorMarketPanel}(BaseView);__reflect(HonorMarketPanel.prototype,"HonorMarketPanel");ViewManager.ins().reg(HonorMarketPanel,LayerManager.UI_Main);var IntegrationItemRenderer=function(_super){__extends(IntegrationItemRenderer,_super);function IntegrationItemRenderer(){var _this=_super.call(this)||this;_this.skinName="ShopPointItem";_this.item=new ItemBase;_this.item.x=21;_this.item.y=8;_this.item.isShowName(false);_this.addChild(_this.item);return _this}IntegrationItemRenderer.prototype.dataChanged=function(){var shopItem=this.data;var itemConfig=GlobalConfig.ItemConfig[shopItem.itemId];if(itemConfig==undefined)return;this.goodsID=shopItem.index;this.money.text=CommonUtils.overLength(shopItem.price);this.integration.text=CommonUtils.overLength(shopItem.integral);this.itemName.text=itemConfig.name;this.itemName.textColor=ItemConfig.getQualityColor(itemConfig);this.itemName.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.used.text="";this.used.x=this.itemName.x+this.itemName.width;var red=new RewardData;red.id=itemConfig.id;red.count=shopItem.count;red.type=shopItem.type;this.item.data=red};return IntegrationItemRenderer}(BaseItemRender);__reflect(IntegrationItemRenderer.prototype,"IntegrationItemRenderer");var IntegrationPanel=function(_super){__extends(IntegrationPanel,_super);function IntegrationPanel(){var _this=_super.call(this)||this;_this.name=i18n("IntegrationPanel_0");_this.skinName="ShopPointSkin";_this.list.itemRenderer=IntegrationItemRenderer;return _this}IntegrationPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.observe(Shop.ins().postRefreshIntegrationSucc,this.buyResultCB);this.updateData()};IntegrationPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.removeObserve()};IntegrationPanel.prototype.buyResultCB=function(result,num){if(result[0]==1){UserTips.ins().showTips(i18n("IntegrationPanel_1"))}else{UserTips.ins().showTips(i18n("IntegrationPanel_2"))}this.label1.text=i18n("IntegrationPanel_3",CommonUtils.overLength(result[1]))};IntegrationPanel.prototype.updateData=function(){var arr=[];var dataProvider=GlobalConfig.IntegralStore;for(var k in dataProvider){arr.push(dataProvider[k])}this.list.dataProvider=new eui.ArrayCollection(arr);this.label1.text=i18n("IntegrationPanel_4",CommonUtils.overLength(Shop.ins().shopData.point))};IntegrationPanel.prototype.onTap=function(e){if(e.target.name=="buy"){var goodsID=e.target.parent["goodsID"];var dataProvider=GlobalConfig.IntegralStore;var integ=void 0;for(var k in dataProvider){var element=dataProvider[k];if(element.index==goodsID){integ=element}}if(integ.type!=1){if(UserBag.ins().getSurplusCount()<=0){var strTips=i18n("IntegrationPanel_5");UserTips.ins().showTips(strTips);return}}if(Actor.yb<integ.price){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("IntegrationPanel_6"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("IntegrationPanel_7"));return}if(Shop.ins().shopData.point<integ.integral){UserTips.ins().showTips(i18n("IntegrationPanel_8"));return}Shop.ins().sendIntegrationShop(goodsID)}};return IntegrationPanel}(BaseView);__reflect(IntegrationPanel.prototype,"IntegrationPanel");var ItemShopPanel=function(_super){__extends(ItemShopPanel,_super);function ItemShopPanel(){var _this=_super.call(this)||this;_this.name=i18n("ItemShopPanel_0");return _this}ItemShopPanel.prototype.childrenCreated=function(){this.init()};ItemShopPanel.prototype.init=function(){this.listView.itemRenderer=ItemShopItemRenderer};ItemShopPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.observe(Shop.ins().postBuyCount,this.refreshList);this.updateData()};ItemShopPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.removeObserve()};ItemShopPanel.prototype.refreshList=function(){var len=this.listView.dataProvider.length;for(var i=0;i<len;i++){var dataProvider=this.listView.dataProvider;var item=dataProvider.getItemAt(i);dataProvider.itemUpdated(item)}};ItemShopPanel.prototype.updateData=function(){var arr=[];var dataProvider=GlobalConfig.ItemStoreConfig;for(var k in dataProvider){if(dataProvider[k]&&dataProvider[k].use&&dataProvider[k].use.indexOf(i18n("ItemShopPanel_1"))>-1)arr.unshift(dataProvider[k]);else arr.push(dataProvider[k])}this.listView.dataProvider=new eui.ArrayCollection(arr)};ItemShopPanel.prototype.onTap=function(e){if(e.target.name=="buy"){var goodsID=e.target.parent["goodsID"];var shopItem=GlobalConfig.ItemStoreConfig[goodsID];if(Shop.ins().shopData.checkBuyGoodsId(goodsID)){ViewManager.ins().open(BuyWin,goodsID)}}};return ItemShopPanel}(BaseView);__reflect(ItemShopPanel.prototype,"ItemShopPanel");var MedalShopItemRenderer=function(_super){__extends(MedalShopItemRenderer,_super);function MedalShopItemRenderer(){var _this=_super.call(this)||this;_this.skinName="FeatsShopItem";_this.item=new ItemBase;_this.item.x=21;_this.item.y=8;_this.item.isShowName(false);_this.addChild(_this.item);if(_this.btnGet){_this.btnGet.name="buy"}return _this}MedalShopItemRenderer.prototype.dataChanged=function(){var _data=this.data;this.item.data=_data.goods[0];this.itemName.text=this.item.getText();this.itemName.textColor=this.item.getTextColor();this.labelPrice.text=""+_data.costMoney.count;if(_data.daycount){this.labelTimes.visible=true;this.labelTimes.text=i18n("MedalShopItemRenderer_0")+_data.exchangeCount+"/"+_data.daycount}else{this.labelTimes.visible=false}};return MedalShopItemRenderer}(BaseItemRender);__reflect(MedalShopItemRenderer.prototype,"MedalShopItemRenderer");var MedalShopPanel=function(_super){__extends(MedalShopPanel,_super);function MedalShopPanel(){var _this=_super.call(this)||this;_this.coin=0;_this.name=i18n("MedalShopPanel_0");_this.skinName="FeatsShopSkin";_this.labelGetCoin.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+_this.labelGetCoin.text+"</u></a>");_this.list.itemRenderer=MedalShopItemRenderer;_this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF;return _this}MedalShopPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}Shop.ins().sendMedalMessage();this.observe(Shop.ins().postRefresMedalMessage,this.updataData);this.observe(Shop.ins().postUpdateBuyMedal,this.buyResult);this.addTouchEvent(this.list,this.onBuy);this.addTouchEvent(this.labelGetCoin,this.onGetCoin)};MedalShopPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.list,this.onBuy);this.removeTouchEvent(this.labelGetCoin,this.onGetCoin);this.removeObserve()};MedalShopPanel.prototype.updataData=function(){var _data=GlobalConfig.FeatsStore;var data=Shop.ins().medalData;for(var k in _data){var exchangeCount=data.exchangeCount[_data[k].index];if(!isNaN(exchangeCount)){_data[k].exchangeCount=exchangeCount}else{_data[k].exchangeCount=0}}this.setListData(_data)};MedalShopPanel.prototype.onBuy=function(e){if(e.target.name=="buy"){var feats=Actor.feats;var tag=e.target.parent;var _data=tag.data;if(_data.exchangeCount>=_data.daycount&&_data.daycount!=0){var str=i18n("MedalShopPanel_1");UserTips.ins().showTips(str)}else if(_data.costMoney.count>feats){var str=i18n("MedalShopPanel_2");UserTips.ins().showTips(str)}else{Shop.ins().sendBuyMedal(_data.index,1)}}};MedalShopPanel.prototype.buyResult=function(exchangeData){var str=i18n("MedalShopPanel_3");var price=0;var _data=GlobalConfig.FeatsStore;for(var k in _data){if(_data[k].index==exchangeData[0]){_data[k].exchangeCount=exchangeData[1];price=_data[k].costMoney.count}}str=str+price+i18n("MedalShopPanel_4");UserTips.ins().showTips(str);this.setListData(_data)};MedalShopPanel.prototype.setListData=function(_data){var arr=new eui.ArrayCollection;for(var k in _data){arr.addItem(_data[k])}this.list.dataProvider=arr;var feats=Actor.feats;this.labelCoin.text=Actor.feats.toString()};MedalShopPanel.prototype.onGetCoin=function(e){ViewManager.ins().open(ShopGoodsWarn).setData(7,1)};return MedalShopPanel}(BaseView);__reflect(MedalShopPanel.prototype,"MedalShopPanel");var NobleShopItemRender=function(_super){__extends(NobleShopItemRender,_super);function NobleShopItemRender(){var _this=_super.call(this)||this;_this.shopType=2;_this.goodsID=0;_this.skinName="NobleshoSkinItemShopItem";_this.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.showTip,_this);_this.itemIcon.imgJob.visible=false;return _this}NobleShopItemRender.prototype.dataChanged=function(){var shopItem=this.data;if(!shopItem)return;var itemConfig=GlobalConfig.ItemConfig[shopItem.itemId];this.goodsID=shopItem.index;var costStr="";if(shopItem.price>1e5){costStr=Math.floor(shopItem.price/1e4)+i18n("NobleShopItemRender_0")}else{costStr=shopItem.price+""}this.money0.text=costStr;if(shopItem.showYuanBao>1e5){costStr=Math.floor(shopItem.showYuanBao/1e4)+i18n("NobleShopItemRender_1")}else{costStr=shopItem.showYuanBao+""}this.money.text=costStr;this.itemName.text=itemConfig.name;this.itemName.textColor=ItemConfig.getQualityColor(itemConfig);this.itemName.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.used.text="（"+shopItem.use+"）";this.used.x=this.itemName.x+this.itemName.width;if(this.itemIcon&&this.itemIcon.setData){this.itemIcon.setData(itemConfig)}};NobleShopItemRender.prototype.showTip=function(){var items=GlobalConfig.IntegralStore;var configID;if(items[this.goodsID]){configID=items[this.goodsID].itemId}if(configID==undefined){new Error(i18n("NobleShopItemRender_2"))}var itemConfig=GlobalConfig.ItemConfig[configID];ViewManager.ins().open(ItemDetailedWin,0,itemConfig.id,1)};return NobleShopItemRender}(BaseItemRender);__reflect(NobleShopItemRender.prototype,"NobleShopItemRender");var NobleShopPanel=function(_super){__extends(NobleShopPanel,_super);function NobleShopPanel(){var _this=_super.call(this)||this;_this.name=i18n("NobleShopPanel_0");return _this}NobleShopPanel.prototype.childrenCreated=function(){this.init()};NobleShopPanel.prototype.init=function(){this.listView.itemRenderer=NobleShopItemRender};NobleShopPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(param[0]){this.listView.addEventListener(egret.Event.ENTER_FRAME,this.scrollBottom,this)}this.addTouchEvent(this,this.onTap);this.addTouchEvent(this.tipImg,this.onTap);this.updateData()};NobleShopPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTap);this.removeTouchEvent(this.tipImg,this.onTap);this.listView.removeEventListener(egret.Event.ENTER_FRAME,this.scrollBottom,this)};NobleShopPanel.prototype.updateData=function(){var arr=[];var dataProvider=GlobalConfig.IntegralStore;for(var k in dataProvider){arr.push(dataProvider[k])}this.listView.dataProvider=new eui.ArrayCollection(arr)};NobleShopPanel.prototype.onTap=function(e){if(e.target.name=="buy"){var goodsID=e.target.parent["goodsID"];var shopType=e.target.parent["shopType"];if(!Recharge.ins().getIsForeve())UserTips.ins().showTips(i18n("NobleShopPanel_1"));else ViewManager.ins().open(BuyWin,goodsID,shopType)}else if(e.currentTarget==this.tipImg){ViewManager.ins().open(FuliWin,"MonthCardWin")}};NobleShopPanel.prototype.scrollBottom=function(){this.listView.removeEventListener(egret.Event.ENTER_FRAME,this.scrollBottom,this);this.listView.scrollV=this.listView.contentHeight-this.listView.height};return NobleShopPanel}(BaseView);__reflect(NobleShopPanel.prototype,"NobleShopPanel");var ShopBestTips=function(_super){__extends(ShopBestTips,_super);function ShopBestTips(){var _this=_super.call(this)||this;_this.skinName="GoodsOverViewSkin";return _this}ShopBestTips.prototype.initUI=function(){_super.prototype.initUI.call(this);this.shopList.itemRenderer=ItemBase};ShopBestTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClick);this.addTouchEvent(this.closeBtn,this.onClick);var items=[];for(var k in GlobalConfig.TreasureOverViewConfig){items.push(GlobalConfig.TreasureOverViewConfig[k].itemId)}this.shopList.dataProvider=new eui.ArrayCollection(items)};ShopBestTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick)};ShopBestTips.prototype.onClick=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};return ShopBestTips}(BaseEuiView);__reflect(ShopBestTips.prototype,"ShopBestTips");ViewManager.ins().reg(ShopBestTips,LayerManager.UI_Popup);var ShopRedPoint=function(_super){__extends(ShopRedPoint,_super);function ShopRedPoint(){var _this=_super.call(this)||this;_this.shopRedPoint=false;_this.blackMarketRedPoint=false;_this.associated(_this.postShopRedPoint,_this.postBlackMarketRedPoint);_this.associated(_this.postBlackMarketRedPoint,Shop.ins().postUpdateShopData);return _this}ShopRedPoint.prototype.postShopRedPoint=function(){var old=this.shopRedPoint;this.shopRedPoint=this.blackMarketRedPoint;return this.shopRedPoint!=old};ShopRedPoint.prototype.postBlackMarketRedPoint=function(){var old=this.blackMarketRedPoint;this.blackMarketRedPoint=Shop.ins().shopData.refushTime<=0;return this.blackMarketRedPoint!=old};return ShopRedPoint}(BaseSystem);__reflect(ShopRedPoint.prototype,"ShopRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){var shopRedPoint=ShopRedPoint.ins.bind(ShopRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ShopWin=function(_super){__extends(ShopWin,_super);function ShopWin(){var _this=_super.call(this)||this;_this.lastIndex=0;_this.scrollBottom=false;_this.skinName="ShopSkin";_this.isTopLevel=true;return _this}ShopWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};ShopWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.closeBtn0,this.onClick);this.addChangeEvent(this.tab,this.onTabTouch);this.observe(UserBag.ins().postItemAdd,this.buyToUse);this.observe(ShopRedPoint.ins().postBlackMarketRedPoint,this.updateRedPoint);this.lastIndex=param[0]==undefined?this.lastIndex:param[0];if(param[1])this.scrollBottom=param[1];this.tab.selectedIndex=this.lastIndex;this.viewStack.selectedIndex=this.lastIndex;this.setOpenIndex(this.lastIndex);Shop.ins().postRefreshGoodsSuccess(false);this.updateRedPoint()};ShopWin.prototype.updateRedPoint=function(){this.redPoint0.visible=ShopRedPoint.ins().blackMarketRedPoint};ShopWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var num=this.viewStack.numChildren;for(var i=0;i<num;i++){this.viewStack.getChildAt(i).close()}};ShopWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};ShopWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex)};ShopWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case 0:this.blackMarketPanel.open();break;case 1:this.itemShopPanel.open();break;case 2:this.honorMarketPanel.open();break}if(this.lastIndex!=selectedIndex){this.viewStack.getElementAt(this.lastIndex)["close"]();this.lastIndex=selectedIndex}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}};ShopWin.prototype.buyToUse=function(){if(!Shop.ins().shopBuyArr)Shop.ins().shopBuyArr=[];for(var i=0;i<Shop.ins().shopBuyArr.length;i++){var tmp=Shop.ins().shopBuyArr[i];UserBag.ins().sendUseItem(tmp.id,tmp.count)}};return ShopWin}(BaseEuiView);__reflect(ShopWin.prototype,"ShopWin");ViewManager.ins().reg(ShopWin,LayerManager.UI_Main);var ShoppingGift=function(_super){__extends(ShoppingGift,_super);function ShoppingGift(){var _this=_super.call(this)||this;_this.data={};_this.minTime=0;_this.openGift=[];_this.newId=[];_this.hasNewData=false;_this.hasDataChanged=false;_this.openHash="";_this._showState=0;_this.sysId=PackageID.ShoppingGift;_this.regNetMsg(1,_this.postInfo);return _this}Object.defineProperty(ShoppingGift.prototype,"showState",{get:function(){return this._showState},set:function(v){v=v||0;this._showState=v>this._showState?v:this._showState},enumerable:true,configurable:true});ShoppingGift.ins=function(){return _super.ins.call(this)};ShoppingGift.prototype.sort=function(a,b){var at=a.endTime||0;var bt=b.endTime||0;if(at>0&&bt>0){return at-bt}if(at==0){return 1}if(bt==0){return-1}};ShoppingGift.prototype.getOpenGift=function(){this.openGift=[];for(var k in this.data){if(this.data[k]&&this.data[k].state==ShoppingGift.OPEN){this.openGift.push(this.data[k])}}this.openGift.sort(this.sort);var oldv=this.openHash;this.openHash=this.openGift.map(function(e){return e.id}).toString();this.hasDataChanged=this.openHash!=oldv;return this.openGift};ShoppingGift.prototype.getFirstGift=function(){if(this.openGift&&this.openGift.length>0){return this.firstGift=this.openGift[0]}else{return this.firstGift=null}};ShoppingGift.prototype.sendInfo=function(){if(ShoppingGift.SYSTEM_STATE==0)return;var bytes=this.getBytes(1);this.sendToServer(bytes)};ShoppingGift.prototype.postInfo=function(bytes){var oldData=this.data||{};this.data={};var len;if(ShoppingGift.SYSTEM_STATE==0||!bytes)len=0;else len=bytes.readInt();for(var i=0;i<len;i++){var v=new ShoppingGiftData;v.parser(bytes);this.data[v.id]=v;if(!oldData[v.id]){this.newId.push(v.id);this.hasNewData=true}}this.getOpenGift();this.getFirstGift()};ShoppingGift.prototype.sendDadian=function(id){if(id<=0)return;var bytes=this.getBytes(2);bytes.writeInt(id);this.sendToServer(bytes)};ShoppingGift.prototype.control=function(flag){if(flag===void 0){flag=1}ShoppingGift.SYSTEM_STATE=flag;if(ShoppingGift.SYSTEM_STATE==1){this.sendInfo()}else{this.postInfo()}};ShoppingGift.CLOSE=0;ShoppingGift.OPEN=1;ShoppingGift.OVER=2;ShoppingGift.DONE=3;ShoppingGift.STATE_BRFORE_SET_TIMER=0;ShoppingGift.STATE_AFTER_SET_TIMER=1;ShoppingGift.STATE_CAN_FIRST_OPEN=2;ShoppingGift.STATE_ALREADY_FIRST_OPEN=3;ShoppingGift.SYSTEM_STATE=1;return ShoppingGift}(BaseSystem);__reflect(ShoppingGift.prototype,"ShoppingGift");var ShoppingGiftData=function(){function ShoppingGiftData(){}ShoppingGiftData.prototype.parser=function(bytes){this.id=bytes.readInt();this.state=bytes.readInt();this.endTime=bytes.readInt()};return ShoppingGiftData}();__reflect(ShoppingGiftData.prototype,"ShoppingGiftData");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.shoppingGift=ShoppingGift.ins.bind(ShoppingGift)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ShoppingGiftRender=function(_super){__extends(ShoppingGiftRender,_super);function ShoppingGiftRender(){var _this=_super.call(this)||this;_this.skinName="ShoppingGiftRenderSkin";_this.rewards.itemRenderer=ItemBase;_this.dataProvider=new eui.ArrayCollection;_this.rewards.dataProvider=_this.dataProvider;_this.setMC();return _this}ShoppingGiftRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};ShoppingGiftRender.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);this.update()};ShoppingGiftRender.prototype.update=function(){this.buy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.buy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var data=this.data;var cfg=GlobalConfig.ShoppingGiftConfig[data.id];this.talkGroup.visible=cfg.describe?true:false;this.talk.text=cfg.describe||"";this.dataProvider.replaceAll([].concat(cfg.goods||[]));this.price.text=i18n("ShoppingGiftRender_0",cfg.money||0);if(ChannelMgr.ins().isAnQiGeChannel()){var recharge=cfg.recharge;var rcfg=GlobalConfig.RechargeItemsConfig[recharge];var channel_20121_itemName=rcfg.channel_20121_itemName;this.price.text=channel_20121_itemName;for(var i=0;i<cfg.goods.length;i++){if(cfg.goods[i].id==2){cfg.goods[i].count=cfg.yuanbao||0;break}}this.dataProvider.replaceAll([].concat(cfg.goods||[]))}this.t=data.endTime-Math.floor(GameServer.serverTime/1e3);this.leftTime.text=DateUtils.getFormatBySecond(this.t,DateUtils.TIME_FORMAT_5,3);this.lblGroup.visible=this.t>0?true:false;this.wrap.alpha=0;this.bitNum=BitmapNumber.ins().createNumPic((cfg.rebate||0)+"%","zglb",10);this.rebate.removeChildren();this.rebate.addChild(this.bitNum);this.rebate.width=this.bitNum.width;this.rebate.height=this.bitNum.height};ShoppingGiftRender.prototype.play=function(){egret.Tween.removeTweens(this.lightGroup);this.lightGroup.rotation=0;egret.Tween.get(this.lightGroup,{loop:true}).to({rotation:360},4e3);if(this.mc)this.mc.play();if(this.btnMc)this.btnMc.play();TimerManager.ins().remove(this.setTime,this);TimerManager.ins().doTimer(1e3,0,this.setTime,this);egret.Tween.removeTweens(this.wrap);egret.Tween.get(this.wrap).to({alpha:1},200,egret.Ease.cubicIn)};ShoppingGiftRender.prototype.stop=function(){this.lightGroup.rotation=0;egret.Tween.removeTweens(this.lightGroup);if(this.mc)this.mc.stop();if(this.btnMc)this.btnMc.stop();TimerManager.ins().remove(this.setTime,this);egret.Tween.removeTweens(this.wrap);egret.Tween.get(this.wrap).to({alpha:0},200,egret.Ease.cubicIn)};ShoppingGiftRender.prototype.setTime=function(){var data=this.data;if(this.t>0){this.t=data.endTime-Math.floor(GameServer.serverTime/1e3);this.leftTime.text=DateUtils.getFormatBySecond(this.t,DateUtils.TIME_FORMAT_5,3)}else{TimerManager.ins().remove(this.setTime,this);if(data.endTime){ShoppingGift.ins().sendInfo()}}};ShoppingGiftRender.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.playFile(RES_DIR_EFF+"zglb_rweff",-1);this.mcGroup.addChild(this.mc);this.mc.stop()}if(!this.btnMc){this.btnMc=new MovieClip;this.btnMc.playFile(RES_DIR_EFF+"sjxb_aneff",-1);this.btnMc.x=this.buy.width/2;this.btnMc.y=this.buy.height/2;this.buy.addChild(this.btnMc);this.btnMc.stop()}};ShoppingGiftRender.prototype.onTap=function(e){var data=this.data;var cfg=GlobalConfig.ShoppingGiftConfig[data.id];switch(e.currentTarget){case this.buy:ViewManager.ins().close(ShoppingGiftWin);ShoppingGift.ins().sendDadian(cfg.id);Recharge.ins().showReCharge(cfg.recharge,cfg.id);break}};return ShoppingGiftRender}(ItemRenderer);__reflect(ShoppingGiftRender.prototype,"ShoppingGiftRender");var ShoppingGiftTip=function(_super){__extends(ShoppingGiftTip,_super);function ShoppingGiftTip(){var _this=_super.call(this)||this;_this.skinName="ShoppingGiftTipSkin";_this.setMc();return _this}ShoppingGiftTip.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.t=data.endTime-Math.floor(GameServer.serverTime/1e3);this.leftTime.text=DateUtils.getFormatBySecond(this.t,DateUtils.TIME_FORMAT_1,3);this.lblGroup.visible=this.t>0?true:false;TimerManager.ins().remove(this.setTimer,this);TimerManager.ins().doTimerDelay(1e3,1e3,0,this.setTimer,this);this.btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.setMc();if(this.mc)this.mc.play()};ShoppingGiftTip.prototype.onTap=function(e){switch(e.currentTarget){case this.btn:ViewManager.ins().open(ShoppingGiftWin);break}};ShoppingGiftTip.prototype.setTimer=function(){var data=this.data;if(this.t>0){this.t=data.endTime-Math.floor(GameServer.serverTime/1e3);this.leftTime.text=DateUtils.getFormatBySecond(this.t,DateUtils.TIME_FORMAT_1,3)}else{TimerManager.ins().remove(this.setTimer,this);if(data.endTime){ShoppingGift.ins().sendInfo()}}};ShoppingGiftTip.prototype.setMc=function(){if(this.mc)this.mc.destroy();this.mc=new MovieClip;this.mc.playFile(RES_DIR_EFF+"zglb_rkeff",-1);this.mcGroup.addChild(this.mc);this.mc.stop()};ShoppingGiftTip.prototype.close=function(){if(this.mc)this.mc.stop();TimerManager.ins().remove(this.setTimer,this)};return ShoppingGiftTip}(ItemRenderer);__reflect(ShoppingGiftTip.prototype,"ShoppingGiftTip");var ShoppingGiftWin=function(_super){__extends(ShoppingGiftWin,_super);function ShoppingGiftWin(){var _this=_super.call(this)||this;_this.lastIndex=0;_this.index=0;_this.isPlay=false;_this._hasMove=false;_this._stageX=0;_this.skinName="ShoppingGiftWinSkin";return _this}ShoppingGiftWin.openCheck=function(){return ShoppingGift.ins().openGift.length>0};ShoppingGiftWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var page=args[0]||this.findNewPage();this.index=page-1;this.isPlay=false;this.addTouchEvent(this.btnClose,this.onTap);this.addTouchEvent(this.btnRight,this.onTap);this.addTouchEvent(this.btnLeft,this.onTap);this.setScroll();this.observe(ShoppingGift.ins().postInfo,this.update);this.bg.alpha=0;this.bg1.alpha=0;ShoppingGift.ins().hasDataChanged=true;ShoppingGift.ins().hasNewData=false;ShoppingGift.ins().showState=ShoppingGift.STATE_ALREADY_FIRST_OPEN;this.update()};ShoppingGiftWin.prototype.update=function(){var _this=this;var data=ShoppingGift.ins().openGift;if(data.length==0){this.close();return}if(!ShoppingGift.ins().hasDataChanged)return;ShoppingGift.ins().hasDataChanged=false;clearTimeout(this.timer);this.timer=setTimeout(function(){_this.data=data;if(_this.bg.alpha==0){egret.Tween.removeTweens(_this.bg);egret.Tween.get(_this.bg).to({alpha:1},200,egret.Ease.cubicIn)}if(_this.bg1.alpha==0){egret.Tween.removeTweens(_this.bg1);egret.Tween.get(_this.bg1).to({alpha:1},200,egret.Ease.cubicIn)}if(!_this.render){_this.render=new ShoppingGiftRender;_this.render.width=_this.scroller.width;_this.render.height=_this.scroller.height;_this.group.addChild(_this.render)}_this.rect.width=_this.data.length*_this.scroller.width;_this.setPage(_this.index)},50)};ShoppingGiftWin.prototype.close=function(){clearTimeout(this.timer);ShoppingGift.ins().hasDataChanged=false;ShoppingGift.ins().newId=[];this.removeTouchEvent(this.btnClose,this.onTap);this.removeTouchEvent(this.btnRight,this.onTap);this.removeTouchEvent(this.btnLeft,this.onTap);this.scroller.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onScroll,this,true);this.scroller.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onScroll,this,true);this.scroller.removeEventListener(egret.TouchEvent.TOUCH_END,this.onScroll,this,true);this.removeObserve();if(this.render)this.render.stop();ViewManager.ins().close(this)};ShoppingGiftWin.prototype.onTap=function(e){switch(e.currentTarget){case this.btnClose:this.close();break;case this.btnLeft:this.setPage(this.index-1);break;case this.btnRight:this.setPage(this.index+1);break}};ShoppingGiftWin.prototype.setPage=function(index){var _this=this;if(this.isPlay)return;this.isPlay=true;var len=this.data.length;this.lastIndex=this.index;this.index=(index+len||0)%len;this.pageNum.text=""+(this.index+1);this.pageSum.text=""+len;var scrollH=this.index*(this.scroller.width||0);if(this.lastIndex!=this.index){this.render.stop();egret.Tween.get(this.group).to({scrollH:scrollH},400,egret.Ease.quintInOut).call(function(){_this.render.data=_this.data[_this.index];_this.render.x=scrollH;_this.render.play();_this.isPlay=false})}else{this.group.scrollH=scrollH;this.render.data=this.data[this.index];this.render.x=scrollH;this.render.play();this.isPlay=false}};ShoppingGiftWin.prototype.setScroll=function(){this.scroller.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onScroll,this,true)};ShoppingGiftWin.prototype.onScroll=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this._stageX=e.stageX;this.scroller.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onScroll,this,true);this.scroller.once(egret.TouchEvent.TOUCH_END,this.onScroll,this,true);break;case egret.TouchEvent.TOUCH_MOVE:this._hasMove=true;break;case egret.TouchEvent.TOUCH_END:this.scroller.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onScroll,this,true);var x=e.stageX-this._stageX;var y=100;this.scroller.stopAnimation();if(this._hasMove){this._hasMove=false;if(x>=y){this.setPage(this.index-1)}else if(x<=-y){this.setPage(this.index+1)}else{this.setPage(this.index)}}break}};ShoppingGiftWin.prototype.findNewPage=function(){var index=0;if(ShoppingGift.ins().newId.length){for(var i=0;i<ShoppingGift.ins().openGift.length;i++){var x=ShoppingGift.ins().newId.indexOf(ShoppingGift.ins().openGift[i].id);if(x>=0){index=i;break}}}ShoppingGift.ins().newId=[];return index+1};return ShoppingGiftWin}(BaseEuiView);__reflect(ShoppingGiftWin.prototype,"ShoppingGiftWin");ViewManager.ins().reg(ShoppingGiftWin,LayerManager.UI_Popup);var SkillData=function(){function SkillData(id){this._specialCD=0;this.configID=id}Object.defineProperty(SkillData.prototype,"lv",{get:function(){return this._id%1e3},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"job",{get:function(){return Math.floor(this._id%1e5/1e4)},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"id",{get:function(){return Math.floor(this._id/1e3)*1e3},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"icon",{get:function(){return this.id+"_png"},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"configID",{get:function(){return this._id},set:function(id){this._id=id;this.config=GlobalConfig.SkillsConfig[id];this._preId=NaN},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"preId",{get:function(){return this._preId},set:function(id){this._preId=id},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"lv1ConfigID",{get:function(){return this.id+1},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"castType",{get:function(){return isNaN(this.config&&this.config.castType)?2:this.config.castType},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"targetType",{get:function(){return isNaN(this.config&&this.config.targetType)?2:this.config.targetType},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"desc",{get:function(){var levelConfig=this.config||GlobalConfig.SkillsConfig[this.lv1ConfigID];if(Assert(levelConfig,i18n("SkillData_0",this.configID))){return""}var config=GlobalConfig.SkillsDescConfig[levelConfig.desc];var str=config?config.desc:"";if(!str.length||!levelConfig.desc_ex)return str;var len=levelConfig.desc_ex.length;for(var i=0;i<len;i++){str=str.replace("%s%",levelConfig.desc_ex[i]+"")}return str},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"affectRange",{get:function(){return isNaN(this.config.affectRange)?1:this.config.affectRange},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"affectRangeEx",{get:function(){return this.config.affectRangeEx},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"affectCount",{get:function(){return isNaN(this.config.affectCount)?1:this.config.affectCount},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"calcType",{get:function(){return isNaN(this.config.calcType)?1:this.config.calcType},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"herdMonRate",{get:function(){var config=GlobalConfig.SkillsDescConfig[this.descID];return config?isNaN(config.herdMonRate)?100:config.herdMonRate:100},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"herdPlayerRate",{get:function(){var config=GlobalConfig.SkillsDescConfig[this.descID];return config?isNaN(config.herdPlayerRate)?10:config.herdPlayerRate:10},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"cd",{get:function(){if(this._specialCD)return this._specialCD;var config=GlobalConfig.SkillsDescConfig[this.descID];return config?config.cd:0},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"specialCD",{set:function(value){this._specialCD=value},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"isPassive",{get:function(){return!!this.config.passive},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"rate",{get:function(){return this.config.passive&&this.config.passive.rate||0},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"cond",{get:function(){return this.config.passive&&this.config.passive.cond||0},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"castRange",{get:function(){var config=GlobalConfig.SkillsDescConfig[this.descID];return config?config.castRange:0},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"repelDistance",{get:function(){return this.config.repelDistance},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"teleport",{get:function(){return this.config.teleport},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"actionType",{get:function(){var config=GlobalConfig.SkillsDescConfig[this.descID];return config?config.actionType:""},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"tarEff",{get:function(){return this.config&&this.config.tarEff||[]},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"otarEff",{get:function(){return this.config&&this.config.otarEff||[]},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"selfEff",{get:function(){return this.config&&this.config.selfEff||[]},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"canUse",{get:function(){return this.config&&!!this.lv},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"name",{get:function(){var config=GlobalConfig.SkillsDescConfig[this.descID];return config?config.name:""},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"args",{get:function(){return this.config.args},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"wordEff",{get:function(){var config=GlobalConfig.SkillsDescConfig[this.descID];return config?config.wordEff:""},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"effType",{get:function(){return this.config.effType},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"otherSkills",{get:function(){return this.config.otherSkills},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"effectId",{get:function(){var config=GlobalConfig.SkillsDescConfig[this.descID];return config?config.effectId:0},enumerable:true,configurable:true});Object.defineProperty(SkillData.prototype,"sound",{get:function(){var config=GlobalConfig.SkillsDescConfig[this.descID];return config?config.sound:""},enumerable:true,configurable:true});SkillData.getSkillByJob=function(job,index,lv){if(index===void 0){index=1}if(lv===void 0){lv=1}return new SkillData(job*1e4+index*1e3+lv)};Object.defineProperty(SkillData.prototype,"descID",{get:function(){var config=GlobalConfig.SkillsConfig[this.configID]||GlobalConfig.SkillsConfig[this.lv1ConfigID];return config?config.desc:0},enumerable:true,configurable:true});return SkillData}();__reflect(SkillData.prototype,"SkillData");var MijiItemEx=function(_super){__extends(MijiItemEx,_super);function MijiItemEx(){var _this=_super.call(this)||this;_this.skinName="MijiWithNameItemSkin";_this.init();return _this}MijiItemEx.prototype.dataChanged=function(){if(!this.data)return;this.miji.data=this.data;var config=GlobalConfig.MiJiSkillConfig[this.data];var cfg=GlobalConfig.ItemConfig[config.item];this.nameTF.text=cfg.name};MijiItemEx.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};MijiItemEx.prototype.onClick=function(){var config=GlobalConfig.MiJiSkillConfig[this.data];ViewManager.ins().open(PropGainTipsWin,0,config.item)};return MijiItemEx}(BaseItemRender);__reflect(MijiItemEx.prototype,"MijiItemEx");var MijiLookItem=function(_super){__extends(MijiLookItem,_super);function MijiLookItem(){var _this=_super.call(this)||this;_this.skinName="MijiOverViewItemSkin";return _this}MijiLookItem.prototype.dataChanged=function(){if(!this.data)return;if(typeof this.data=="string"){this.currentState="title";if(this.data=="middle"){this.name1.text=i18n("MijiLookItem_0")}else{this.name1.text=i18n("MijiLookItem_1")}}else if(typeof this.data=="object"&&this.data.length){this.currentState="miji";var len=5;for(var i=0;i<len;i++){var config=this.data[i];if(this["item"+i]&&config){this["item"+i].visible=true;this["item"+i].data=config.id;var itemcfg=GlobalConfig.ItemConfig[config.item];this.name1.text=itemcfg.name}else{this["item"+i].visible=false}}}};return MijiLookItem}(BaseItemRender);__reflect(MijiLookItem.prototype,"MijiLookItem");var MijiLookWin=function(_super){__extends(MijiLookWin,_super);function MijiLookWin(){var _this=_super.call(this)||this;_this.skinName="MijiOverViewSkin";_this.isTopLevel=true;return _this}MijiLookWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.list.itemRenderer=MijiLookItem;var arr=[];var arrEx=[];var rolarr=[];var rolarrEx=[];for(var i in GlobalConfig.MiJiSkillConfig){var mj=GlobalConfig.MiJiSkillConfig[i];var itemconfig=GlobalConfig.ItemConfig[mj.item];if(UserMiji.ins().getMijiLevel(mj.id)==15&&!UserMiji.ins().isMiJiIdBound(mj.id)){if(UserMiji.ins().getMijiColor(mj.id)==0){if(!arr.length)arr.push("middle");if(rolarr.length<5)rolarr.push(mj);else{arr.push(rolarr);rolarr=[];rolarr.push(mj)}}else{if(!arrEx.length)arrEx.push("high");if(rolarrEx.length<5)rolarrEx.push(mj);else{arrEx.push(rolarrEx);rolarrEx=[];rolarrEx.push(mj)}}}}if(rolarr.length)arr.push(rolarr);if(rolarrEx.length)arrEx.push(rolarrEx);var totoalArr=arr.concat(arrEx);this.list.dataProvider=new eui.ArrayCollection(totoalArr)};MijiLookWin.prototype.onTap=function(e){switch(e.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};MijiLookWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap)};MijiLookWin.prototype.setData=function(){};return MijiLookWin}(BaseEuiView);__reflect(MijiLookWin.prototype,"MijiLookWin");ViewManager.ins().reg(MijiLookWin,LayerManager.UI_Main);var SkillPreviewWin=function(_super){__extends(SkillPreviewWin,_super);function SkillPreviewWin(){var _this=_super.call(this)||this;_this.skillID=1620341;_this.castRange=1.3;_this.affectRange=1;_this.affectCount=1;_this.source="body005ssr_1";_this.castTarget="";_this.target="monster10009";_this.targetNum=1;_this.dir=2;_this.sourceX=900;_this.sourceY=500;_this.dirMap={0:4,1:5,2:6,3:7,4:0,5:1,6:2,7:3};_this.castVisible=true;_this.affVisible=true;_this.skinName="SkillPreviewSkin";return _this}SkillPreviewWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}RoleAI.ins().setStoryMode(true);var view=ViewManager.ins().getView(PlayFunView);if(view){view.visible=false}var uiview2=ViewManager.ins().getView(UIView2);if(uiview2){uiview2.visible=false}GameLogic.ins().inSkillPreview=true;this._effBottomLayer_=SkillEffPlayer.bottomLayer;this._effTopLayer_=SkillEffPlayer.topLayer;this._effNewTopLayer_=SkillEffNewPlayer.layerTop;var stage=StageUtils.ins().getStage();var layer=new egret.DisplayObjectContainer;SkillEffPlayer.bottomLayer=layer;stage.addChildAt(layer,200);layer=new egret.DisplayObjectContainer;this._entityLayer=layer;stage.addChildAt(layer,300);layer=new egret.DisplayObjectContainer;SkillEffPlayer.topLayer=layer;stage.addChildAt(layer,400);layer=new egret.DisplayObjectContainer;SkillEffNewPlayer.layerTop=layer;stage.addChildAt(layer,500);this.addTouchEvent(this.btnPlay,this.onBtnPlay);this.addTouchEvent(this.btnCast,this.onBtnCast);this.addTouchEvent(this.btnAff,this.onBtnAff);this.addTouchEvent(this.btnDetail,this.onBtnDetail);this.addChangeEvent(this.tSkillId,this.onTxtChange);this.addChangeEvent(this.tCastRange,this.onTxtChange);this.addChangeEvent(this.tAffectRange,this.onTxtChange);this.addChangeEvent(this.tSource,this.onTxtChange);this.addChangeEvent(this.tCastTar,this.onTxtChange);this.addChangeEvent(this.tDir,this.onTxtChange);this.addChangeEvent(this.tTar,this.onTxtChange);this.addChangeEvent(this.tTarNum,this.onTxtChange);this.setTxt();this.checkInputChange(true)};SkillPreviewWin.prototype.setTxt=function(){if(!this.tSkillId.text){this.tSkillId.text=this.skillID.toString()}this.tCastRange.text=this.castRange.toString();this.tAffectRange.text=this.affectRangeEx?JSON.stringify(this.affectRangeEx):this.affectRange.toString();this.tSource.text=this.source.toString();this.tCastTar.text=this.castTarget.toString();this.tDir.text=this.dir.toString();this.tTar.text=this.target.toString();this.tTarNum.text=this.targetNum.toString()};SkillPreviewWin.prototype.onTxtChange=function(e){var _this=this;var skillChanged=false;switch(e.currentTarget){case this.tSkillId:skillChanged=true;break}TimerManager.ins().doTimer(500,1,function(){_this.checkInputChange(skillChanged)},this)};SkillPreviewWin.prototype.checkInputChange=function(skillChanged){if(skillChanged===void 0){skillChanged=false}var id=Number(this.tSkillId.text);var cfg=GlobalConfig.SkillsConfig[id];if(!cfg){return}this.skillID=id;if(skillChanged&&cfg){var desc=cfg.desc;var descCfg=GlobalConfig.SkillsDescConfig[desc];this.castRange=descCfg.castRange||0;this.affectRange=cfg.affectRange||1;this.affectRangeEx=cfg.affectRangeEx||null}else{this.castRange=Number(this.tCastRange.text);if(cfg){if(cfg.affectRangeEx){this.affectRangeEx=JSON.parse(this.tAffectRange.text)}else{this.affectRange=Number(this.tAffectRange.text)}}}this.source=this.tSource.text;this.castTarget=this.tCastTar.text;this.dir=Number(this.tDir.text);if(this.dir<0||this.dir>7){this.dir=1;this.tDir.text=this.dir.toString()}this.target=this.tTar.text;this.targetNum=Number(this.tTarNum.text);if(skillChanged){this.setTxt();this.onBtnPlay()}};SkillPreviewWin.prototype.close=function(){GameLogic.ins().inSkillPreview=false;RoleAI.ins().setStoryMode(false);var view=ViewManager.ins().getView(PlayFunView);if(view){view.visible=true}var uiview2=ViewManager.ins().getView(UIView2);if(uiview2){uiview2.visible=true}this.clearAll();SkillEffPlayer.bottomLayer=this._effBottomLayer_;SkillEffPlayer.topLayer=this._effTopLayer_;SkillEffNewPlayer.layerTop=this._effNewTopLayer_};SkillPreviewWin.prototype.clearAll=function(){SkillEffPlayer.bottomLayer.removeChildren();SkillEffPlayer.topLayer.removeChildren();SkillEffNewPlayer.layerTop.removeChildren();this._entityLayer.removeChildren();EntityManager.ins().entityListSkill=[]};SkillPreviewWin.prototype.onBtnCast=function(){this.castVisible=!this.castVisible;this.btnCast.label=this.castVisible?i18n("SkillEditWin_0"):i18n("SkillEditWin_1");this.checkShape()};SkillPreviewWin.prototype.onBtnAff=function(){this.affVisible=!this.affVisible;this.btnAff.label=this.affVisible?i18n("SkillEditWin_2"):i18n("SkillEditWin_3");this.checkShape()};SkillPreviewWin.prototype.checkShape=function(){this.castCirle.visible=this.castVisible;this.affShape.visible=this.affVisible};SkillPreviewWin.prototype.onBtnDetail=function(){ViewManager.ins().open(CommonHelpWin,i18n("SkillEditWin_4"));this.clearAll()};SkillPreviewWin.prototype.onBtnPlay=function(){this.clearAll();var id=Number(this.tSkillId.text);var cfg=GlobalConfig.SkillsConfig[id];if(!cfg){UserTips.ins().showCenterTips(i18n("SkillEffPlayer_1",id));return}var dirMons=this.dirMap[this.dir];var pos=this.getTarPos();var target=this.createEntity(this.castTarget,dirMons,pos.x,pos.y,true);var source=this.createEntity(this.source,this.dir,this.sourceX,this.sourceY,false);var tarArr=[];for(var i=0;i<this.targetNum;i++){var t=this.createEntity(this.target,dirMons,getRandom()*StageUtils.ins().getWidth(),getRandom()*StageUtils.ins().getHeight(),true);tarArr.push(t)}var effID=0;cfg=GlobalConfig.SkillsConfig[this.skillID];if(cfg){var desc=cfg.desc;var descCfg=GlobalConfig.SkillsDescConfig[desc];if(descCfg.actionType){source.playAction(descCfg.actionType)}if(descCfg.effectId){effID=descCfg.effectId}}var castTarget=target;if(cfg&&cfg.castType==3){castTarget=source}this.castCirle=this.drawCircle(this.castRange*GameMap.CELL_SIZE,16711680,.4,source);if(cfg&&cfg.affectRangeEx){var r=this.affectRangeEx;if(r["t"]==1){this.affShape=this.drawFan(r,source,16711680,.4)}else{this.affShape=this.drawRect(r,source,16711680,.4)}}else{this.affShape=this.drawCircle(this.affectRange*GameMap.CELL_SIZE,16711680,.4,castTarget)}this.checkShape();if(effID>0){var list_18=EntityManager.ins().screeningTargetByPos(castTarget,false,cfg.affectCount,this.affectRange||0,tarArr,this.affectRangeEx||null,source,true);SkillEffPlayer.play(effID,source,[target],function(){target.playAction(EntityAction.DIE);for(var _i=0,list_19=list_18;_i<list_19.length;_i++){var v=list_19[_i];v.playAction(EntityAction.DIE)}},1,null,"",undefined,list_18)}};SkillPreviewWin.prototype.drawCircle=function(r,color,alpha,entity){if(r===void 0){r=1*GameMap.CELL_SIZE}if(color===void 0){color=15937822}if(alpha===void 0){alpha=1}var circle=new egret.Shape;circle.graphics.beginFill(color);circle.graphics.drawCircle(0,0,r);circle.graphics.endFill();circle.x=entity.x;circle.y=entity.y;circle.alpha=alpha;SkillEffPlayer.bottomLayer.addChild(circle);return circle};SkillPreviewWin.prototype.drawFan=function(affectRangeEx,entity,color,alpha){if(color===void 0){color=15937822}if(alpha===void 0){alpha=1}if(!affectRangeEx){return null}var dir=entity.dir;var r=affectRangeEx["d"]*GameMap.CELL_SIZE;var a=affectRangeEx["f"]*180;var ro=(180-a)/2+360/8*dir+180;var fan=new egret.Shape;fan.graphics.beginFill(color);fan.graphics.moveTo(0,0);fan.graphics.lineTo(r,0);fan.graphics.drawArc(0,0,r,0,a*Math.PI/180,false);fan.graphics.lineTo(0,0);fan.graphics.endFill();fan.alpha=alpha;fan.x=entity.x;fan.y=entity.y;fan.rotation=ro;SkillEffPlayer.bottomLayer.addChild(fan);return fan};SkillPreviewWin.prototype.drawRect=function(affectRangeEx,entity,color,alpha){if(color===void 0){color=15937822}if(alpha===void 0){alpha=1}var dir=entity.dir;var f=affectRangeEx["f"]*GameMap.CELL_SIZE;var d=affectRangeEx["d"]*GameMap.CELL_SIZE;var ro=360/8*dir+180;var rect=new egret.Shape;rect.graphics.beginFill(color);rect.graphics.drawRect(0,0,f,d);rect.graphics.endFill();rect.alpha=alpha;rect.anchorOffsetX=f/2;rect.anchorOffsetY=0;rect.x=entity.x;rect.y=entity.y;rect.rotation=ro;SkillEffPlayer.bottomLayer.addChild(rect);return rect};SkillPreviewWin.prototype.getTarPos=function(){var dirMons=this.dirMap[this.dir];var xMons,yMons;var dis=this.castRange*GameMap.CELL_SIZE;var sqt=dis/Math.sqrt(2);switch(dirMons){case 0:xMons=this.sourceX;yMons=this.sourceY+dis;break;case 1:xMons=this.sourceX-sqt;yMons=this.sourceY+sqt;break;case 2:xMons=this.sourceX-dis;yMons=this.sourceY;break;case 3:xMons=this.sourceX-sqt;yMons=this.sourceY-sqt;break;case 4:xMons=this.sourceX;yMons=this.sourceY-dis;break;case 5:xMons=this.sourceX+sqt;yMons=this.sourceY-sqt;break;case 6:xMons=this.sourceX+dis;yMons=this.sourceY;break;case 7:xMons=this.sourceX+sqt;yMons=this.sourceY+sqt;break}return{x:xMons,y:yMons}};SkillPreviewWin.prototype.createEntity=function(body,dir,x,y,save){if(dir===void 0){dir=0}if(save===void 0){save=false}var entity;var model=new EntityModel;model.isMy=false;model._dirNum=8;entity=ObjectPool.pop("CharMonster");entity.visible=true;entity.reset();entity.infoModel=model;entity.showBodyContainer();entity.removeAll();var monster=body.indexOf("monster")>-1?true:false;entity.initBody((monster?RES_DIR_MONSTER:RES_DIR_BODY)+body);entity.myHeight=EntityManager.CHAR_DEFAULT_HEIGHT;entity.typeface=EntityManager.CHAR_DEFAULT_TYPEFACE;entity["_nameGroup"].visible=false;entity["titleContainer"].visible=false;entity.dir=dir;entity["sortEffect"].apply(entity);var model=entity.infoModel;model.x=x;model.y=y;entity.x=model.x;entity.y=model.y;this._entityLayer.addChild(entity);entity.action=EntityAction.STAND;if(save){EntityManager.ins().entityListSkill.push(entity)}return entity};return SkillPreviewWin}(BaseEuiView);__reflect(SkillPreviewWin.prototype,"SkillPreviewWin");ViewManager.ins().reg(SkillPreviewWin,LayerManager.UI_Popup);var SkillWin=function(_super){__extends(SkillWin,_super);function SkillWin(){var _this=_super.call(this)||this;_this.lastIndex=0;_this.skinName="ZsSkin";_this.isTopLevel=true;return _this}SkillWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};SkillWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.help,this.onTap);this.addChangingEvent(this.tab,this.onTabTouching);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangeEvent(this.roleSelect,this.onChange);this.observe(UserBag.ins().postItemAdd,this.updateRedPoint);this.observe(UserBag.ins().postItemDel,this.updateRedPoint);this.observe(UserBag.ins().postItemChange,this.updateRedPoint);this.observe(NeiGong.ins().postNeiGongDataChange,this.updateRedPoint);this.observe(UserJingMai.ins().postUpdate,this.updateRedPoint);this.observe(Actor.ins().postGoldChange,this.updateRedPoint);this.observe(Actor.ins().postLevelChange,this.updateRedPoint);this.observe(UserSkill.ins().postSkillUpgradeAll,this.updateRedPoint);this.observe(UserMiji.ins().postBagUseMiji,this.onBagUseMiji);this.observe(ZhanLing.ins().postZhanLingComposeItem,this.updateRedPoint);this.observe(ZhanLing.ins().postZhanLingInfo,this.updateRedPoint);this.observe(ZhanLing.ins().postZhanLingUpExp,this.updateRedPoint);this.observe(ZhanLing.ins().postZhanLingDrug,this.updateRedPoint);this.observe(ZhanLing.ins().postZhanLingWear,this.updateRedPoint);this.checkPage();var selectIndex=param[0]!=undefined?param[0]:SkillWin.Panel_JINENG;var roleIndex=param[1];if(selectIndex==SkillWin.Panel_JINENG&&roleIndex==null){var minLvRole=0;var minLv=Number.MAX_VALUE;var roleNum=SubRoles.ins().subRolesLen;for(var i=0;i<roleNum;++i){var skillsData=SubRoles.ins().getSubRoleByIndex(i).skillsData;var sum=0;var count=0;for(var skillIndex in skillsData){var data=skillsData[skillIndex];sum+=data.lv;count+=1}var avglv=sum/count;if(avglv<minLv){minLv=avglv;minLvRole=i}}roleIndex=minLvRole}if(roleIndex==null){roleIndex=0}this.viewStack.selectedIndex=this.tab.selectedIndex=selectIndex;this.roleSelect.setCurRole(roleIndex);this.setOpenIndex(selectIndex)};SkillWin.prototype.checkPage=function(){if(!ZhanLingModel.ins().ZhanLingOpen()){if(this.zhanlingPanel.parent)this.viewStack.removeChild(this.zhanlingPanel);if(this["redPoint"+SkillWin.Panel_ZHANLING].parent)DisplayUtils.removeFromParent(this["redPoint"+SkillWin.Panel_ZHANLING])}else{if(!this.zhanlingPanel.parent)this.viewStack.addChild(this.zhanlingPanel);if(!this["redPoint"+SkillWin.Panel_ZHANLING].parent)this.redPointGroup.addChild(this["redPoint"+SkillWin.Panel_ZHANLING])}};SkillWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().removeAll(this);var uiview2=ViewManager.ins().getView(UIView2);if(uiview2)uiview2.closeNav(UIView2.NAV_SKILL);var num=this.viewStack.numChildren;for(var i=0;i<num;i++){this.viewStack.getChildAt(i).close()}};SkillWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex)};SkillWin.prototype.onTabTouching=function(e){if(!SkillWin.checkIsOpen(e.currentTarget.selectedIndex)){e.preventDefault();return}};SkillWin.prototype.setOpenIndex=function(selectedIndex){var openLevel;var openGuanqia;this.roleSelect.setState("uphead");this.help.visible=false;this.skillTitle.top=1;switch(selectedIndex){case SkillWin.Panel_JINENG:this.skillPanel.open();this.skillTitle.source="biaoti_jineng";break;case SkillWin.Panel_NEIGONG:openLevel=GlobalConfig.NeiGongBaseConfig.openLevel;openGuanqia=GlobalConfig.NeiGongBaseConfig.openGuanqia;if(UserFb.ins().guanqiaID<=openGuanqia){UserTips.ins().showTips(i18n("SkillWin_0",openGuanqia));selectedIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=this.lastIndex}else{this.neiGongPanel.open(this.roleSelect.getCurRole());this.skillTitle.source="biaoti_neigong"}break;case SkillWin.Panel_JINGMAI:openLevel=GlobalConfig.JingMaiCommonConfig.openLevel;if(Actor.level<openLevel){UserTips.ins().showTips(i18n("SkillWin_1",openLevel));selectedIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=this.lastIndex}else{this.jingMai.open();this.skillTitle.source="biaoti_jingmai"}break;case SkillWin.Panel_MIJI:if(!UserMiji.isOpen()){UserTips.ins().showTips(i18n("SkillWin_2",UserMiji.guanqiaID));selectedIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=this.lastIndex}else{this.mijiPanel.open();this.skillTitle.source="biaoti_miji";if(MijiGuideMgr.ins().getStep()==2){MijiGuideMgr.ins().toStep(3)}}break;case SkillWin.Panel_ZHANLING:if(!ZhanLingModel.ins().ZhanLingOpen()){UserTips.ins().showTips(i18n("SkillWin_3",GlobalConfig.ZhanLingConfig.openserverday,GlobalConfig.ZhanLingConfig.openzhuanshenglv))}else{this.help.visible=true;this.roleSelect.setState("nohead");this.zhanlingPanel.open();this.skillTitle.source="biaoti_zhanling";this.skillTitle.top=5}break}if(this.lastIndex!=selectedIndex){this.viewStack.getElementAt(this.lastIndex)["close"]();this.lastIndex=selectedIndex}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}this.updateRedPoint()};SkillWin.checkIsOpen=function(index){var openLevel;var openGuanqia;switch(index){case SkillWin.Panel_JINENG:break;case SkillWin.Panel_NEIGONG:openLevel=GlobalConfig.NeiGongBaseConfig.openLevel;openGuanqia=GlobalConfig.NeiGongBaseConfig.openGuanqia;if(UserFb.ins().guanqiaID<=openGuanqia){UserTips.ins().showTips(i18n("SkillWin_4",openGuanqia));return false}break;case SkillWin.Panel_JINGMAI:openLevel=GlobalConfig.JingMaiCommonConfig.openLevel;if(Actor.level<openLevel){UserTips.ins().showTips(i18n("SkillWin_5",openLevel));return false}break;case SkillWin.Panel_MIJI:if(!UserMiji.isOpen()){UserTips.ins().showTips(i18n("SkillWin_6",UserMiji.guanqiaID));return false}break;case SkillWin.Panel_ZHANLING:if(!ZhanLingModel.ins().ZhanLingOpen()){UserTips.ins().showTips(i18n("SkillWin_7",GlobalConfig.ZhanLingConfig.openserverday,GlobalConfig.ZhanLingConfig.openzhuanshenglv));return false}break}return true};SkillWin.prototype.updateRedPoint=function(){if(!TimerManager.ins().isExists(this.updateRed,this))TimerManager.ins().doTimer(100,1,this.updateRed,this)};SkillWin.prototype.onBagUseMiji=function(itemId){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(!UserMiji.ins().hasEquipMiji(itemId,i)){this.roleSelect.setCurRole(i);this.setRoleId(i);break}}this.mijiPanel.onBagUseMiji(itemId)};SkillWin.prototype.updateRed=function(){this.redPoint0.visible=this.and(UserSkill.ins().canGrewupSkill());this.redPoint1.visible=NeiGongModel.ins().canUp();this.redPoint2.visible=this.jingMaiCanUp();this.redPoint3.visible=UserMiji.ins().isMjiSum();this.redPoint4.visible=ZhanLing.ins().checkRedPoint();var len=SubRoles.ins().subRolesLen;this.roleSelect.clearRedPoint();for(var i=0;i<len;i++){var isCanUpLevel=void 0;if(this.tab.selectedIndex==SkillWin.Panel_JINENG){isCanUpLevel=UserSkill.ins().canGrewupAllSkills(i)}else if(this.tab.selectedIndex==SkillWin.Panel_NEIGONG){isCanUpLevel=NeiGongModel.ins().canUpById(i)}else if(this.tab.selectedIndex==SkillWin.Panel_JINGMAI){var data=SubRoles.ins().roles[i].jingMaiData;isCanUpLevel=data.jingMaiCanUp()}else if(this.tab.selectedIndex==SkillWin.Panel_MIJI){isCanUpLevel=UserMiji.ins().isMjiSum(i)}this.roleSelect.showRedPoint(i,isCanUpLevel)}};SkillWin.prototype.onChange=function(e){this.setRoleId(this.roleSelect.getCurRole())};SkillWin.prototype.setRoleId=function(roleId){if(roleId!=this.skillPanel.curRole){this.neiGongPanel.curRole=this.mijiPanel.curRole=this.skillPanel.curRole=this.jingMai.curRole=roleId;this.setOpenIndex(this.viewStack.selectedIndex)}};SkillWin.prototype.and=function(list){for(var _i=0,list_20=list;_i<list_20.length;_i++){var k=list_20[_i];if(k==true)return true}return false};SkillWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.help:if(this.viewStack.selectedIndex==SkillWin.Panel_ZHANLING){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[35].text)}break}};SkillWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var index=param[0]||SkillWin.Panel_JINENG;return SkillWin.checkIsOpen(index)};SkillWin.prototype.jingMaiCanUp=function(){var data;for(var i in SubRoles.ins().roles){data=SubRoles.ins().roles[i].jingMaiData;if(data.jingMaiCanUp()){var openLevel=GlobalConfig.JingMaiCommonConfig.openLevel;if(Actor.level>=openLevel)return true}}return false};SkillWin.Panel_JINENG=0;SkillWin.Panel_NEIGONG=1;SkillWin.Panel_JINGMAI=2;SkillWin.Panel_MIJI=3;SkillWin.Panel_ZHANLING=4;return SkillWin}(BaseEuiView);__reflect(SkillWin.prototype,"SkillWin");ViewManager.ins().reg(SkillWin,LayerManager.UI_Main);var SmallGameActivityBtnRenderer=function(_super){__extends(SmallGameActivityBtnRenderer,_super);function SmallGameActivityBtnRenderer(){var _this=_super.call(this)||this;_this.skinName="ActBtnSkin";DisplayUtils.removeFromParent(_this.mc);_this.mc=null;return _this}SmallGameActivityBtnRenderer.prototype.dataChanged=function(){var type=this.data;var isShowEff=false;switch(type){case QQsmallgameActivityType.invite:isShowEff=ChannelNet.ins().showInviteRedPoint()||ChannelNet.ins().showClickGiftRedPoint()||ChannelNet.ins().showFriendGiftRedPoint();this.iconDisplay.source="sg_icon_share";this.setRedPoint(isShowEff);break;case QQsmallgameActivityType.subscribe:isShowEff=ChannelNet.ins().canGetAward(awardType.qqSubscribe);this.iconDisplay.source="sg_icon_subscirbe";this.setRedPoint(isShowEff);break;case QQsmallgameActivityType.addToDesktop:isShowEff=ChannelNet.ins().canGetAward(awardType.qqAddToDeskTop);this.iconDisplay.source="sg_icon_save";this.setRedPoint(isShowEff);break;case QQsmallgameActivityType.ad:isShowEff=ChannelNet.ins().canGetAdAward(adType.ad);this.iconDisplay.source="sg_icon_ad";this.setRedPoint(isShowEff);break;case QQsmallgameActivityType.hongbao:isShowEff=ChannelNet.ins().showLoginRedPoint();this.iconDisplay.source="sg_icon_hongbao";this.setRedPoint(isShowEff);break;case QQsmallgameActivityType.recharge:isShowEff=ChannelNet.ins().showRechargeRedPoint();this.iconDisplay.source="sg_icon_recharge";this.setRedPoint(isShowEff);break}};SmallGameActivityBtnRenderer.prototype.setRedPoint=function(isShowEff){if(isShowEff){if(!this.mc){this.mc=new MovieClip;this.mc.x=45;this.mc.y=49}this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1);this.eff.addChild(this.mc)}else{DisplayUtils.removeFromParent(this.mc);this.mc=null}this.redPoint.visible=isShowEff};return SmallGameActivityBtnRenderer}(BaseItemRender);__reflect(SmallGameActivityBtnRenderer.prototype,"SmallGameActivityBtnRenderer");var SmallGameActivityWin=function(_super){__extends(SmallGameActivityWin,_super);function SmallGameActivityWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.ActBtnMark=[];_this.skinName="SmallGameActivityWinSkin";_this.isTopLevel=true;_this.selectIndex=0;_this.menuList.itemRenderer=SmallGameActivityBtnRenderer;_this.dataArr=new eui.ArrayCollection;_this.menuList.dataProvider=_this.dataArr;return _this}SmallGameActivityWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};SmallGameActivityWin.openCheck=function(){return true};SmallGameActivityWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.addChangeEvent(this.menuScroller,this.onChange);ChannelNet.ins().sendShareStart(awardType.qqSubscribe);ChannelNet.ins().sendShareStart(awardType.qqAddToDeskTop)};SmallGameActivityWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i]){this.activityPanelList[i].close()}}};SmallGameActivityWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr)};SmallGameActivityWin.prototype.updateView=function(){var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this.ActBtnMark=[];this.BtnArr=[2,3,1,4];if(ChannelNet.ins().hideShare()){var index_1=this.BtnArr.indexOf(QQsmallgameActivityType.invite);if(index_1>-1){this.BtnArr.splice(index_1,1);console.log("channel "+ChannelMgr.ins().main_channel+" hideShare == true")}}for(i=0;i<this.BtnArr.length;i++){var type=this.BtnArr[i];switch(type){case QQsmallgameActivityType.invite:this.activityPanelList[i]=new SmallGameSharePanel;break;case QQsmallgameActivityType.subscribe:this.activityPanelList[i]=new SmallGameSubscribePanel;break;case QQsmallgameActivityType.addToDesktop:this.activityPanelList[i]=new SmallGameAddToDesktopPanel;break;case QQsmallgameActivityType.ad:this.activityPanelList[i]=new SmallGameAdPanel;break;case QQsmallgameActivityType.hongbao:this.activityPanelList[i]=new SmallGameHongbaoPanel;break;case QQsmallgameActivityType.recharge:this.activityPanelList[i]=new SmallGameRechargePanel;break}if(this.activityPanelList[i]){this.viewStack.addChild(this.activityPanelList[i])}}this.dataArr.replaceAll(this.BtnArr);this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};SmallGameActivityWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};SmallGameActivityWin.prototype.setOpenIndex=function(selectedIndex){if(this.activityPanelList[selectedIndex]){this.activityPanelList[selectedIndex].open()}this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;this.refushRedPoint();if(this.BtnArr[selectedIndex]==QQsmallgameActivityType.invite){ViewManager.ins().close(SmallGameActivityWin);ViewManager.ins().open(SmallGameInviteWin)}};SmallGameActivityWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;this.setOpenIndex(this.selectIndex)};SmallGameActivityWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}if(this.leftBtn.visible)this.leftRed.visible=this.getRedMark();else this.leftRed.visible=false;if(this.rightBtn.visible)this.rightRed.visible=this.getRedMark();else this.rightRed.visible=false};SmallGameActivityWin.prototype.getRedMark=function(){for(var k in this.ActBtnMark){if(this.ActBtnMark[k]==true)return true}return false};SmallGameActivityWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};return SmallGameActivityWin}(BaseEuiView);__reflect(SmallGameActivityWin.prototype,"SmallGameActivityWin");ViewManager.ins().reg(SmallGameActivityWin,LayerManager.UI_Main);var SmallGameHongBaoWin=function(_super){__extends(SmallGameHongBaoWin,_super);function SmallGameHongBaoWin(){var _this=_super.call(this)||this;_this.activityPanelList=[];_this.ActBtnMark=[];_this.skinName="SmallGameActivityWinSkin";_this.isTopLevel=true;_this.selectIndex=0;_this.menuList.itemRenderer=SmallGameActivityBtnRenderer;_this.dataArr=new eui.ArrayCollection;_this.menuList.dataProvider=_this.dataArr;return _this}SmallGameHongBaoWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};SmallGameHongBaoWin.openCheck=function(){return true};SmallGameHongBaoWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.updateView();this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.addChangeEvent(this.menuScroller,this.onChange);ChannelNet.ins().channelShareInit()};SmallGameHongBaoWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.activityPanelList.length;i++){if(this.activityPanelList[i]){this.activityPanelList[i].close()}}};SmallGameHongBaoWin.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr)};SmallGameHongBaoWin.prototype.updateView=function(){var index=0;var i=0;for(i=0;i<this.viewStack.numElements;i++){ObjectPool.push(this.viewStack.getElementAt(i))}this.viewStack.removeChildren();this.activityPanelList=[];this.ActBtnMark=[];this.BtnArr=[5,6];if(ChannelNet.ins().loginGift_left_period<=0){var index_2=this.BtnArr.indexOf(QQsmallgameActivityType.hongbao);if(index_2>-1){this.BtnArr.splice(index_2,1);console.log("channel "+ChannelMgr.ins().main_channel+" loginGift_left_period <= 0")}}if(ChannelNet.ins().cashGift_left_period<=0){var index_3=this.BtnArr.indexOf(QQsmallgameActivityType.recharge);if(index_3>-1){this.BtnArr.splice(index_3,1);console.log("channel "+ChannelMgr.ins().main_channel+" cashGift_left_period <= 0")}}for(i=0;i<this.BtnArr.length;i++){var type=this.BtnArr[i];switch(type){case QQsmallgameActivityType.invite:this.activityPanelList[i]=new SmallGameSharePanel;break;case QQsmallgameActivityType.subscribe:this.activityPanelList[i]=new SmallGameSubscribePanel;break;case QQsmallgameActivityType.addToDesktop:this.activityPanelList[i]=new SmallGameAddToDesktopPanel;break;case QQsmallgameActivityType.ad:this.activityPanelList[i]=new SmallGameAdPanel;break;case QQsmallgameActivityType.hongbao:this.activityPanelList[i]=new SmallGameHongbaoPanel;break;case QQsmallgameActivityType.recharge:this.activityPanelList[i]=new SmallGameRechargePanel;break}if(this.activityPanelList[i]){this.viewStack.addChild(this.activityPanelList[i])}}this.dataArr.replaceAll(this.BtnArr);this.onChange();if(this.viewStack.numElements>0){this.setOpenIndex(index)}this.viewStack.validateNow();this.menuList.validateNow();if(index>=5){var scrollH=92*index;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH}};SmallGameHongBaoWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};SmallGameHongBaoWin.prototype.setOpenIndex=function(selectedIndex){if(this.activityPanelList[selectedIndex]){this.activityPanelList[selectedIndex].open()}this.viewStack.selectedIndex=selectedIndex;this.menuList.selectedIndex=selectedIndex;this.refushRedPoint();if(this.BtnArr[selectedIndex]==QQsmallgameActivityType.invite){ViewManager.ins().close(SmallGameActivityWin);ViewManager.ins().open(SmallGameInviteWin)}};SmallGameHongBaoWin.prototype.onClickMenu=function(e){if(this.selectIndex!=e.currentTarget.selectedIndex){SoundUtil.ins().playEffect(SoundUtil.WINDOW);if(this.activityPanelList[this.selectIndex])this.activityPanelList[this.selectIndex].close()}this.selectIndex=e.currentTarget.selectedIndex;this.setOpenIndex(this.selectIndex)};SmallGameHongBaoWin.prototype.onChange=function(){if(this.menuList.scrollH<46){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.viewStack.numElements<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}if(this.leftBtn.visible)this.leftRed.visible=this.getRedMark();else this.leftRed.visible=false;if(this.rightBtn.visible)this.rightRed.visible=this.getRedMark();else this.rightRed.visible=false};SmallGameHongBaoWin.prototype.getRedMark=function(){for(var k in this.ActBtnMark){if(this.ActBtnMark[k]==true)return true}return false};SmallGameHongBaoWin.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};return SmallGameHongBaoWin}(BaseEuiView);__reflect(SmallGameHongBaoWin.prototype,"SmallGameHongBaoWin");ViewManager.ins().reg(SmallGameHongBaoWin,LayerManager.UI_Main);var SmallGameInviteWin=function(_super){__extends(SmallGameInviteWin,_super);function SmallGameInviteWin(){var _this=_super.call(this)||this;_this.skinName="SmallGameInviteWinSkin";_this.isTopLevel=true;return _this}SmallGameInviteWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=param[0]?param[0]:0;this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.setOpenIndex(this.oldIndex);this.addTouchEvent(this.closeBtn,this.onBtnClose);this.observe(ChannelNet.ins().postInviteInfo,this.refRedpoint);this.observe(ChannelNet.ins().postInviteReward,this.refRedpoint);this.observe(ChannelNet.ins().postClickGiftInfo,this.refRedpoint);this.observe(ChannelNet.ins().postClickGiftReward,this.refRedpoint);this.observe(ChannelNet.ins().postFriendGiftInfo,this.refRedpoint);this.observe(ChannelNet.ins().postFriendGiftReward,this.refRedpoint);ChannelNet.ins().sendGetInviteInfo();ChannelNet.ins().sendGetClickGiftInfo();ChannelNet.ins().sendGetFriendGiftInfo();this.refRedpoint()};SmallGameInviteWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.viewStack.getElementAt(this.oldIndex)){this.viewStack.getElementAt(this.oldIndex)["close"]()}};SmallGameInviteWin.prototype.onTabTouch=function(e){var index=this.tab.selectedIndex;this.setOpenIndex(index)};SmallGameInviteWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};SmallGameInviteWin.prototype.checkIsOpen=function(index){return true};SmallGameInviteWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case 0:this.invitePanel.open();break;case 1:this.clickGiftPanel.open();break;case 2:this.friendGiftPanel.open();break}if(this.oldIndex!=selectedIndex){this.viewStack.getElementAt(this.oldIndex)["close"]();this.oldIndex=selectedIndex}else{this.tab.selectedIndex=this.viewStack.selectedIndex=selectedIndex}};SmallGameInviteWin.prototype.refRedpoint=function(){this.redPoint0.visible=ChannelNet.ins().showInviteRedPoint();this.redPoint1.visible=ChannelNet.ins().showClickGiftRedPoint();this.redPoint2.visible=ChannelNet.ins().showFriendGiftRedPoint()};SmallGameInviteWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}return true};SmallGameInviteWin.prototype.onBtnClose=function(){this.removeTouchEvent(this.closeBtn,this.onBtnClose);ViewManager.ins().close(this)};return SmallGameInviteWin}(BaseEuiView);__reflect(SmallGameInviteWin.prototype,"SmallGameInviteWin");ViewManager.ins().reg(SmallGameInviteWin,LayerManager.UI_Main);var SmallGameAdItemRender=function(_super){__extends(SmallGameAdItemRender,_super);function SmallGameAdItemRender(){var _this=_super.call(this)||this;_this.skinName="SmallGameAdItemSkin";_this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onClick,_this);return _this}SmallGameAdItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName};SmallGameAdItemRender.prototype.dataChanged=function(){if(!this.data)return;var channel=this.data.channel;var id=this.data.id;var state=ChannelNet.ins().getAdState(channel,id);this.redPoint.visible=state==0;this.btn.enabled=state==0;this.btn.label=state==0?i18n("SmallGameAdItemRender_0"):i18n("SmallGameAdItemRender_1");var award=GlobalConfig.AdRewardConfig[channel][id].awards;this.list.dataProvider=new eui.ArrayCollection(award)};SmallGameAdItemRender.prototype.onClick=function(){var self=this;var getAward=function(){ChannelNet.ins().sendAdReward(self.data.channel,adType.ad,self.data.id)};ChannelNet.ins().playQQadVedio(adType.ad,getAward)};return SmallGameAdItemRender}(BaseItemRender);__reflect(SmallGameAdItemRender.prototype,"SmallGameAdItemRender");var SmallGameAdPanel=function(_super){__extends(SmallGameAdPanel,_super);function SmallGameAdPanel(){var _this=_super.call(this)||this;_this.isClosed=false;_this.skinName="SmallGameAdPanelSkin";return _this}SmallGameAdPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.list.itemRenderer=SmallGameAdItemRender;var award=[];var c=ChannelMgr.ins().getFullChannel();var cfg=GlobalConfig.AdRewardConfig;var conf=cfg[c];for(var k in conf){var v=conf[k];var s=ChannelNet.ins().getAdState(c,v.id);var data={channel:c,id:v.id,state:s};award.push(data)}award.sort(this.sort);this.list.dataProvider=new eui.ArrayCollection(award);this.observe(ChannelNet.ins().postAdRewardRes,this.updatePanel);this.observe(ChannelNet.ins().postAdInfo,this.updatePanel)};SmallGameAdPanel.prototype.updatePanel=function(param){var errid=param[0];var channel=param[1];var type=param[2];if(errid!=0){return}if(channel!=ChannelMgr.ins().getFullChannel()){return}if(type!=adType.ad){return}for(var i=0;i<this.list.dataProvider.length;i++){var render=this.list.getVirtualElementAt(i);if(render){render.dataChanged()}}};SmallGameAdPanel.prototype.sort=function(a,b){var id1=a.id;var id2=b.id;var state1=a.state;var state2=b.state;if(state1==0&&state2==1){return-1}else if(state1==1&&state2==0){return 1}if(id1>id2)return 1;else if(id1<id2)return-1;else return 0};SmallGameAdPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true};return SmallGameAdPanel}(BaseView);__reflect(SmallGameAdPanel.prototype,"SmallGameAdPanel");var SmallGameAddToDesktopPanel=function(_super){__extends(SmallGameAddToDesktopPanel,_super);function SmallGameAddToDesktopPanel(){var _this=_super.call(this)||this;_this.n=0;_this.isClosed=false;_this.skinName="SmallGameAddToDesktopPanelSkin";_this.list.itemRenderer=ItemBase;return _this}SmallGameAddToDesktopPanel.prototype.open=function(){this.isClosed=false;this.addTouchEvent(this.btn,this.onTouch);this.observe(ChannelNet.ins().postShareStart,this.updatePanel);this.observe(ChannelNet.ins().postShareEnd,this.onShareEnd);this.type=awardType.qqAddToDeskTop;var n=ChannelNet.ins().award_count[this.type]||0;this.updatePanel([this.type,n]);ChannelNet.ins().sendShareStart(this.type)};SmallGameAddToDesktopPanel.prototype.onShareEnd=function(error_code){if(error_code==0){this.n=1}this.updatePanel(null)};SmallGameAddToDesktopPanel.prototype.updatePanel=function(param){if(param){this.type=param[0]||1;this.n=param[1]||0}var cfg=GlobalConfig.QzoneShareConfig[this.type];var awards=cfg&&cfg.awards||[];var limit=cfg.max_count||0;var left=Math.max(0,limit-this.n);this.btn.label=left>0?i18n("SmallGameAddToDesktopPanel_0"):i18n("SmallGameAddToDesktopPanel_1");this.btn.enabled=left>0;this.list.dataProvider=new eui.ArrayCollection(awards);this.redPoint.visible=left>0};SmallGameAddToDesktopPanel.prototype.onTouch=function(e){var tar=e.currentTarget;var self=this;if(tar==this.btn){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.saveDesktop");dyb.saveDesktop(function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.saveDesktop callback:"+JSON.stringify(callback));var code=callback.code;if(code==1||code=="1"){console.log("ChannelNet.ins().sendShareEnd("+self.type+")");ChannelNet.ins().sendShareEnd(self.type)}})}};SmallGameAddToDesktopPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true;this.removeTouchEvent(this.btn,this.onTouch)};return SmallGameAddToDesktopPanel}(BaseView);__reflect(SmallGameAddToDesktopPanel.prototype,"SmallGameAddToDesktopPanel");var SmallGameHongbaoItemRender=function(_super){__extends(SmallGameHongbaoItemRender,_super);function SmallGameHongbaoItemRender(){var _this=_super.call(this)||this;_this.skinName="SmallGameHongbaoItemSkin";return _this}SmallGameHongbaoItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.init()};SmallGameHongbaoItemRender.prototype.init=function(){this.btnOpen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this,true,0)};SmallGameHongbaoItemRender.prototype.dataChanged=function(){var data=this.data;var login_days=this.data.login_days;var login_day=this.data.login_day;var open=this.data.open;this.got.visible=open==1;var conf=GlobalConfig.LoginRebateConfig;var draw=conf[login_day]&&conf[login_day].draw||0;this.tips.visible=draw==1;this.day.text=login_day.toString();this.redPoint.visible=login_days==login_day&&open==0};SmallGameHongbaoItemRender.prototype.onRemove=function(){TimerManager.ins().removeAll(this);this.btnOpen.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)};SmallGameHongbaoItemRender.prototype.onClick=function(){var data=this.data;var open=this.data.open;var login_days=this.data.login_days;var login_day=this.data.login_day;if(login_day>login_days){console.log("smallgamehongbao login_day > login_days! login_day:"+login_day+" login_days:"+login_days)}else if(open==0){var openid=ChannelNet.ins().getOpenId();ChannelNet.ins().sendOpenLoginRedPacket(openid)}else{console.log("smallgamehongbao opend already!")}};return SmallGameHongbaoItemRender}(BaseItemRender);__reflect(SmallGameHongbaoItemRender.prototype,"SmallGameHongbaoItemRender");var SmallGameHongbaoPanel=function(_super){__extends(SmallGameHongbaoPanel,_super);function SmallGameHongbaoPanel(){var _this=_super.call(this)||this;_this.time=0;_this.isClosed=false;_this.skinName="SmallGameHongbaoPanelSkin";return _this}SmallGameHongbaoPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.addTouchEvent(this.withdrawBtn,this.onTouch);this.addTouchEvent(this.btnDetail,this.onTouch);this.observe(ChannelNet.ins().postLoginInfo,this.updatePanel);this.observe(ChannelNet.ins().postOpenLoginRedPacket,this.openLoginRedPacketResult);this.observe(ChannelNet.ins().postWithdrawLoginCash,this.withdrawLoginCashResult);this.updatePanel();var openId=ChannelNet.ins().getOpenId();ChannelNet.ins().sendLoginInfo(openId)};SmallGameHongbaoPanel.prototype.updatePanel=function(){var login_days=ChannelNet.ins().login_days;for(var day=1;day<=7;day++){var open_1=0;if(day<login_days){open_1=1}else if(day==login_days){open_1=ChannelNet.ins().open}else{open_1=0}var data={};data["login_days"]=login_days;data["login_day"]=day;data["open"]=open_1;this["r"+day].data=data;this["r"+day].dataChanged()}var v=ChannelNet.ins().sum_cash/100;this.sum_cash.text=v.toFixed(2);var conf=GlobalConfig.LoginRebateConfig;var draw=conf[login_days]&&conf[login_days].draw||0;this.withdrawBtn.enabled=draw==1;this.redPoint.visible=draw==1&&v>0;TimerManager.ins().removeAll(this);this.updateTime();this.time=ChannelNet.ins().loginGift_left_period;TimerManager.ins().doTimer(1e3,0,this.updateTime,this)};SmallGameHongbaoPanel.prototype.updateTime=function(){this.time-=1;var left=this.time;left=Math.max(0,left);this.left_period.text=DateUtils.getFormatBySecond(left,DateUtils.TIME_FORMAT_5,4)};SmallGameHongbaoPanel.prototype.withdrawLoginCashResult=function(param){var error_code=param[0]||0;var login_days=param[1]||1;var sum_cash=param[2]||1;switch(error_code){case 0:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_3"));this.updatePanel();break;case 1:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_0"));break;case 2:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_4"));break;case 3:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_5"));break;case 4:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_6"));break;case 5:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_7"));break;case 6:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_8"));break;case 7:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_9"));break}};SmallGameHongbaoPanel.prototype.openLoginRedPacketResult=function(param){var error_code=param[0]||0;var login_days=param[1]||1;var cash=param[2]||1;var sum_cash=param[3]||1;switch(error_code){case 0:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_2",(cash/100).toFixed(2)));this.updatePanel();break;case 1:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_0"));break;case 2:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_1"));break}};SmallGameHongbaoPanel.prototype.onTouch=function(e){var tar=e.currentTarget;if(tar==this.withdrawBtn){var openid=ChannelNet.ins().getOpenId();ChannelNet.ins().sendWithdrawLoginCash(openid)}else if(tar==this.btnDetail){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[59].text)}};SmallGameHongbaoPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true;this.removeTouchEvent(this.withdrawBtn,this.onTouch);TimerManager.ins().removeAll(this)};return SmallGameHongbaoPanel}(BaseView);__reflect(SmallGameHongbaoPanel.prototype,"SmallGameHongbaoPanel");var SmallGameClickGiftItemRender=function(_super){__extends(SmallGameClickGiftItemRender,_super);function SmallGameClickGiftItemRender(){var _this=_super.call(this)||this;_this.state=0;_this.skinName="SmallGameClickGiftItemSkin";return _this}SmallGameClickGiftItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName;this.init();this.setMC()};SmallGameClickGiftItemRender.prototype.init=function(){this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this)};SmallGameClickGiftItemRender.prototype.dataChanged=function(){var id=this.data;var cfg=GlobalConfig.InviteClickGiftConfig[id];if(!cfg){return}var count=cfg.count;this.sum.text=count.toString();this.sum2.text=count.toString();var cur=ChannelNet.ins().clickGiftInfo["sum_cnt"]||0;this.count.text=cur.toString();this.state=ChannelNet.ins().getClickGiftRewardState(id);this.btnGet.enabled=true;if(this.state==2){this.btnGet.enabled=false;this.btnGet.label=i18n("SmallGameClickGiftItemRender_2")}else if(this.state==1){this.btnGet.label=i18n("SmallGameClickGiftItemRender_1")}else{this.btnGet.label=i18n("SmallGameClickGiftItemRender_0")}this.eff.visible=this.redPoint.visible=this.state==1;var rewards=cfg.rewards;this.list.dataProvider=new eui.ArrayCollection(rewards)};SmallGameClickGiftItemRender.prototype.onTap=function(e){switch(e.currentTarget){case this.btnGet:if(this.state==1){ChannelNet.ins().sendGetClickGiftReward(this.data)}else if(this.state==0){ChannelNet.ins().qqSmallGameShare()}break}};SmallGameClickGiftItemRender.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=51;this.mc.y=20;this.mc.width=102;this.mc.height=46;this.mc.scaleX=.66;this.mc.scaleY=.78;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.eff.addChild(this.mc)}};return SmallGameClickGiftItemRender}(BaseItemRender);__reflect(SmallGameClickGiftItemRender.prototype,"SmallGameClickGiftItemRender");var SmallGameClickGiftPanel=function(_super){__extends(SmallGameClickGiftPanel,_super);function SmallGameClickGiftPanel(){var _this=_super.call(this)||this;_this.isClosed=false;_this.skinName="SmallGameClickGiftPanelSkin";return _this}SmallGameClickGiftPanel.prototype.childrenCreated=function(){this.list.itemRenderer=SmallGameClickGiftItemRender};SmallGameClickGiftPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.observe(ChannelNet.ins().postClickGiftInfo,this.updatePanel);this.observe(ChannelNet.ins().postClickGiftReward,this.onClickGiftReward);ChannelNet.ins().sendGetClickGiftInfo();this.updatePanel()};SmallGameClickGiftPanel.prototype.updatePanel=function(){this.sum.text="3";this.count.text=ChannelNet.ins().clickGiftInfo["today_cnt"]||0;var cfg=GlobalConfig.InviteClickGiftConfig;var data=[];for(var k in cfg){var id=cfg[k].id;var state=ChannelNet.ins().getClickGiftRewardState(id);data.push({id:id,state:state})}data.sort(this.sort);var ids=[];for(var _i=0,data_12=data;_i<data_12.length;_i++){var v=data_12[_i];ids.push(v.id)}this.list.dataProvider=new eui.ArrayCollection(ids)};SmallGameClickGiftPanel.prototype.sort=function(a,b){var id1=a.id;var id2=b.id;var state1=a.state;var state2=b.state;if(state1==1&&state2!=1){return-1}else if(state1!=1&&state2==1){return 1}if(state1==0&&state2==2){return-1}else if(state1==2&&state2==0){return 1}if(id1>id2)return 1;else if(id1<id2)return-1;else return 0};SmallGameClickGiftPanel.prototype.onClickGiftReward=function(param){var result=param[0];switch(result){case 0:this.updatePanel();break;case 1:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_3"));break;case 2:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_4"));break;case 3:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_5"));break;case 4:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_6"));break}};SmallGameClickGiftPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true};return SmallGameClickGiftPanel}(BaseView);__reflect(SmallGameClickGiftPanel.prototype,"SmallGameClickGiftPanel");var SmallGameFriendGiftItemRender=function(_super){__extends(SmallGameFriendGiftItemRender,_super);function SmallGameFriendGiftItemRender(){var _this=_super.call(this)||this;_this.state=0;_this.skinName="SmallGameFriendGiftItemSkin";return _this}SmallGameFriendGiftItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName;this.init();this.setMC()};SmallGameFriendGiftItemRender.prototype.init=function(){this.btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this)};SmallGameFriendGiftItemRender.prototype.dataChanged=function(){var id=this.data;var cfg=GlobalConfig.InviteFriendGiftConfig[id];if(!cfg){return}var count=cfg.count;var type=cfg.type;var value=cfg.value;var reset=cfg.reset;var str="";var sum=0;switch(type){case 1:if(reset==0){str=i18n("SmallGameFriendGiftItemRender_10",count)}else{str=i18n("SmallGameFriendGiftItemRender_11",count)}sum=count;break;case 2:if(reset==0){str=i18n("SmallGameFriendGiftItemRender_20",count,value)}else{str=i18n("SmallGameFriendGiftItemRender_21",count,value)}sum=count;break;case 3:if(reset==0){str=i18n("SmallGameFriendGiftItemRender_30",count,value)}else{str=i18n("SmallGameFriendGiftItemRender_31",count,value)}sum=count;break;case 4:if(reset==0){str=i18n("SmallGameFriendGiftItemRender_40",count,value)}else{str=i18n("SmallGameFriendGiftItemRender_41",count,value)}sum=count;break;case 5:if(reset==0){str=i18n("SmallGameFriendGiftItemRender_50",count)}else{str=i18n("SmallGameFriendGiftItemRender_51",count)}sum=count;break}this.title.text=str;this.sum.text=sum.toString();var info=ChannelNet.ins().friendGiftInfo[id];this.count.text=(info&&info["count"]||0).toString();this.state=ChannelNet.ins().getFriendGiftRewardState(id);this.btnGet.enabled=true;if(this.state==2){this.btnGet.enabled=false;this.btnGet.label=i18n("SmallGameClickGiftItemRender_2")}else if(this.state==1){this.btnGet.label=i18n("SmallGameClickGiftItemRender_1")}else{this.btnGet.label=i18n("SmallGameClickGiftItemRender_0")}this.eff.visible=this.redPoint.visible=this.state==1;var rewards=cfg.rewards;this.list.dataProvider=new eui.ArrayCollection(rewards)};SmallGameFriendGiftItemRender.prototype.onTap=function(e){switch(e.currentTarget){case this.btnGet:if(this.state==1){ChannelNet.ins().sendGetFriendGiftReward(this.data)}else if(this.state==0){ChannelNet.ins().qqSmallGameShare()}break}};SmallGameFriendGiftItemRender.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=51;this.mc.y=20;this.mc.width=102;this.mc.height=46;this.mc.scaleX=.66;this.mc.scaleY=.78;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.eff.addChild(this.mc)}};return SmallGameFriendGiftItemRender}(BaseItemRender);__reflect(SmallGameFriendGiftItemRender.prototype,"SmallGameFriendGiftItemRender");var SmallGameFriendGiftPanel=function(_super){__extends(SmallGameFriendGiftPanel,_super);function SmallGameFriendGiftPanel(){var _this=_super.call(this)||this;_this.isClosed=false;_this.skinName="SmallGameFriendGiftPanelSkin";return _this}SmallGameFriendGiftPanel.prototype.childrenCreated=function(){this.list.itemRenderer=SmallGameFriendGiftItemRender};SmallGameFriendGiftPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.observe(ChannelNet.ins().postFriendGiftInfo,this.updatePanel);this.observe(ChannelNet.ins().postFriendGiftReward,this.onFriendGiftReward);ChannelNet.ins().sendGetFriendGiftInfo();this.updatePanel()};SmallGameFriendGiftPanel.prototype.updatePanel=function(){var cfg=GlobalConfig.InviteFriendGiftConfig;var data=[];for(var k in cfg){var id=cfg[k].id;var state=ChannelNet.ins().getFriendGiftRewardState(id);data.push({id:id,state:state})}data.sort(this.sort);var ids=[];for(var _i=0,data_13=data;_i<data_13.length;_i++){var v=data_13[_i];ids.push(v.id)}this.list.dataProvider=new eui.ArrayCollection(ids)};SmallGameFriendGiftPanel.prototype.sort=function(a,b){var id1=a.id;var id2=b.id;var state1=a.state;var state2=b.state;if(state1==1&&state2!=1){return-1}else if(state1!=1&&state2==1){return 1}if(state1==0&&state2==2){return-1}else if(state1==2&&state2==0){return 1}if(id1>id2)return 1;else if(id1<id2)return-1;else return 0};SmallGameFriendGiftPanel.prototype.onFriendGiftReward=function(param){var result=param[0];switch(result){case 0:this.updatePanel();break;case 1:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_3"));break;case 2:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_4"));break;case 3:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_5"));break}};SmallGameFriendGiftPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true};return SmallGameFriendGiftPanel}(BaseView);__reflect(SmallGameFriendGiftPanel.prototype,"SmallGameFriendGiftPanel");var SmallGameInvitePanel=function(_super){__extends(SmallGameInvitePanel,_super);function SmallGameInvitePanel(){var _this=_super.call(this)||this;_this.isClosed=false;_this.skinName="SmallGameInvitePanelSkin";return _this}SmallGameInvitePanel.prototype.childrenCreated=function(){this.list.itemRenderer=ItemBaseNoName};SmallGameInvitePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.observe(ChannelNet.ins().postInviteInfo,this.updatePanel);this.observe(ChannelNet.ins().postInviteReward,this.onInviteRewardRes);this.addTouchEvent(this.btn,this.onTouch);ChannelNet.ins().sendGetInviteInfo();this.updatePanel()};SmallGameInvitePanel.prototype.updatePanel=function(){var cfg=GlobalConfig.InviteGiftConfig;var rewards=cfg[1].rewards;this.list.dataProvider=new eui.ArrayCollection(rewards);var sum=cfg[1].count;var count=ChannelNet.ins().inviteInfo["count"]||0;var got=ChannelNet.ins().inviteInfo["got"]||0;this.sum.text=sum.toString();this.count.text=count.toString();var v=Math.min(100,count/sum*100);this.bar.value=v;this.btn.enabled=true;this.redPoint.visible=false;if(count>=sum){if(got){this.btn.enabled=false;this.btn.label=i18n("SmallGameInvitePanel2_2")}else{this.btn.label=i18n("SmallGameInvitePanel2_1");this.redPoint.visible=true}}else{this.btn.label=i18n("SmallGameInvitePanel2_0")}};SmallGameInvitePanel.prototype.onInviteRewardRes=function(param){var result=param[0];switch(result){case 0:this.updatePanel();break;case 1:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_3"));break;case 2:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_4"));break;case 3:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_5"));break;case 4:UserTips.ins().showTips(i18n("SmallGameInvitePanel2_6"));break}};SmallGameInvitePanel.prototype.onTouch=function(e){var tar=e.currentTarget;if(tar==this.btn){switch(this.btn.label){case i18n("SmallGameInvitePanel2_0"):ChannelNet.ins().qqSmallGameShare();break;case i18n("SmallGameInvitePanel2_1"):ChannelNet.ins().sendGetInviteReward(1);break}}};SmallGameInvitePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true;this.removeTouchEvent(this.btn,this.onTouch)};return SmallGameInvitePanel}(BaseView);__reflect(SmallGameInvitePanel.prototype,"SmallGameInvitePanel");var SmallGameSharePanel=function(_super){__extends(SmallGameSharePanel,_super);function SmallGameSharePanel(){var _this=_super.call(this)||this;_this.skinName="SmallGameSharePanelSkin";return _this}SmallGameSharePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};SmallGameSharePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};return SmallGameSharePanel}(BaseView);__reflect(SmallGameSharePanel.prototype,"SmallGameSharePanel");var SmallGameRechargePanel=function(_super){__extends(SmallGameRechargePanel,_super);function SmallGameRechargePanel(){var _this=_super.call(this)||this;_this.giftId=1;_this.curSelectIndex=0;_this.last=2;_this.time=0;_this.isClosed=false;_this.skinName="SmallGameRechargePanelSkin";return _this}SmallGameRechargePanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=ItemBaseNoName};SmallGameRechargePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=false;this.addChangeEvent(this.tab,this.onTabTouch);this.addTouchEvent(this.btn2,this.onTouch);this.addTouchEvent(this.btn3,this.onTouch);this.addTouchEvent(this.btn4,this.onTouch);this.addTouchEvent(this.btnDetail,this.onTouch);this.addTouchEvent(this.withdrawBtn,this.onTouch);this.observe(ChannelNet.ins().postCashGiftInfo,this.updatePanel);this.observe(ChannelNet.ins().postCheckCashGift,this.onCheckRes);this.observe(ChannelNet.ins().postWithdrawGiftCash,this.onWithdrawRes);this.updatePanel();var openId=ChannelNet.ins().getOpenId();ChannelNet.ins().sendGetCashGiftInfo(openId)};SmallGameRechargePanel.prototype.updatePanel=function(){var buyId=-1;for(var i=2;i<=4;i++){var cashGiftInfo=ChannelNet.ins().cashGiftInfo[i];var buyed=cashGiftInfo&&cashGiftInfo.buyed||0;var withdrew=cashGiftInfo&&cashGiftInfo.withdrew||0;if(buyed){buyId=i;this.last=i}}if(buyId!=-1){for(var i=2;i<=4;i++){this["btn"+i].enable=i==buyId}}this.rebateGroup.x=315;this.rebateGroup.y=118;this.chooseGroup.visible=false;switch(this.curSelectIndex){case 0:this.giftId=1;break;case 1:this.giftId=this.last;this.rebateGroup.x=406;this.rebateGroup.y=118;this.chooseGroup.visible=true;break;case 2:this.giftId=5;break}var cfg=GlobalConfig.GiftRebateConfig[this.giftId];if(!cfg){console.log("SmallGameRechargePanel wrong GiftRebateConfig, giftId:"+this.giftId);return}var award=cfg.rewards;var rebate=cfg.rebate;this.list.dataProvider=new eui.ArrayCollection(award);this.rebate.text=(rebate/100).toFixed(0);this.btn1.name=GlobalConfig.GiftRebateConfig[1].desc;this.btn5.name=GlobalConfig.GiftRebateConfig[5].desc;for(var i=2;i<=4;i++){var recharge_id=GlobalConfig.GiftRebateConfig[i].recharge_id;var rCfg=GlobalConfig.RechargeItemsConfig[recharge_id];var cash=rCfg.cash;this["btn"+i].label=i18n("SmallGameRechargePanel_0",cash);this["btn"+i].currentState=this.giftId==i?"down":"up"}this.updateWithdrawBtn();TimerManager.ins().removeAll(this);this.updateTime();this.time=ChannelNet.ins().cashGift_left_period;TimerManager.ins().doTimer(1e3,0,this.updateTime,this)};SmallGameRechargePanel.prototype.updateTime=function(){this.time-=1;var left=this.time;left=Math.max(0,left);this.left_period.text=DateUtils.getFormatBySecond(left,DateUtils.TIME_FORMAT_5,4)};SmallGameRechargePanel.prototype.updateWithdrawBtn=function(){var cashGiftInfo=ChannelNet.ins().cashGiftInfo[this.giftId];var buyed=cashGiftInfo&&cashGiftInfo.buyed||0;var withdrew=cashGiftInfo&&cashGiftInfo.withdrew||0;this.withdrawBtn.label=buyed?withdrew?i18n("SmallGameRechargePanel_3"):i18n("SmallGameRechargePanel_2"):i18n("SmallGameRechargePanel_1");this.withdrawBtn.enabled=!buyed||!withdrew;this.redPoint.visible=!buyed||!withdrew};SmallGameRechargePanel.prototype.onTabTouch=function(e){var selectedIndex=e.currentTarget.selectedIndex;this.setSelectedIndex(selectedIndex)};SmallGameRechargePanel.prototype.setSelectedIndex=function(selectedIndex){this.curSelectIndex=selectedIndex;this.updatePanel()};SmallGameRechargePanel.prototype.onCheckRes=function(param){var error_code=param[0]||0;var gift_id=param[1];switch(error_code){case 0:this.buy(gift_id);break;case 1:UserTips.ins().showTips(i18n("SmallGameRechargePanel_4"));break;case 2:UserTips.ins().showTips(i18n("SmallGameRechargePanel_5"));break}};SmallGameRechargePanel.prototype.onWithdrawRes=function(param){var error_code=param[0]||0;var gift_id=param[1];switch(error_code){case 0:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_3"));this.updateWithdrawBtn();break;case 1:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_10"));break;case 2:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_6"));break;case 3:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_7"));break;case 4:UserTips.ins().showTips(i18n("SmallGameHongbaoPanel_9"));break}};SmallGameRechargePanel.prototype.onTouch=function(e){var tar=e.currentTarget;switch(tar){case this.btn2:this.onChoose(2);break;case this.btn3:this.onChoose(3);break;case this.btn4:this.onChoose(4);break;case this.btnDetail:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[60].text);break;case this.withdrawBtn:this.onBtn();break}};SmallGameRechargePanel.prototype.onChoose=function(giftId){this.giftId=giftId;this.last=giftId;this.updatePanel()};SmallGameRechargePanel.prototype.onBtn=function(){switch(this.withdrawBtn.label){case i18n("SmallGameRechargePanel_1"):this.checkBuy();break;case i18n("SmallGameRechargePanel_2"):this.withdraw();break}};SmallGameRechargePanel.prototype.checkBuy=function(){var openid=ChannelNet.ins().getOpenId();ChannelNet.ins().sendCheckCashGift(openid,this.giftId)};SmallGameRechargePanel.prototype.buy=function(gift_id){var cfg=GlobalConfig.GiftRebateConfig[gift_id];if(!cfg){console.log("SmallGameRechargePanel buy item wrong GiftRebateConfig, giftId:"+gift_id);return}var recharge_id=cfg.recharge_id;var rCfg=GlobalConfig.RechargeItemsConfig[recharge_id];if(!rCfg){console.log("SmallGameRechargePanel buy item wrong RechargeItemsConfig, recharge_id:"+recharge_id);return}Recharge.ins().showReCharge(recharge_id)};SmallGameRechargePanel.prototype.withdraw=function(){var openid=ChannelNet.ins().getOpenId();ChannelNet.ins().sendWithdrawGiftCash(openid,this.giftId)};SmallGameRechargePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true;this.removeTouchEvent(this.btn2,this.onTouch);this.removeTouchEvent(this.btn3,this.onTouch);this.removeTouchEvent(this.btn4,this.onTouch);this.removeTouchEvent(this.btnDetail,this.onTouch);this.removeTouchEvent(this.withdrawBtn,this.onTouch);TimerManager.ins().removeAll(this)};return SmallGameRechargePanel}(BaseView);__reflect(SmallGameRechargePanel.prototype,"SmallGameRechargePanel");var SmallGameSubscribePanel=function(_super){__extends(SmallGameSubscribePanel,_super);function SmallGameSubscribePanel(){var _this=_super.call(this)||this;_this.n=0;_this.isClosed=false;_this.skinName="SmallGameSubscribePanelSkin";_this.list.itemRenderer=ItemBase;return _this}SmallGameSubscribePanel.prototype.open=function(){this.isClosed=false;this.addTouchEvent(this.btn,this.onTouch);this.observe(ChannelNet.ins().postShareStart,this.updatePanel);this.observe(ChannelNet.ins().postShareEnd,this.onShareEnd);this.type=awardType.qqSubscribe;var n=ChannelNet.ins().award_count[this.type]||0;this.updatePanel([this.type,n]);ChannelNet.ins().sendShareStart(this.type)};SmallGameSubscribePanel.prototype.onShareEnd=function(error_code){if(error_code==0){this.n=1}this.updatePanel(null)};SmallGameSubscribePanel.prototype.updatePanel=function(param){if(param){this.type=param[0]||1;this.n=param[1]||0}var cfg=GlobalConfig.QzoneShareConfig[this.type];var awards=cfg&&cfg.awards||[];var limit=cfg.max_count||0;var left=Math.max(0,limit-this.n);this.btn.label=left>0?i18n("SmallGameSubscribePanel_0"):i18n("SmallGameSubscribePanel_1");this.btn.enabled=left>0;this.list.dataProvider=new eui.ArrayCollection(awards);this.redPoint.visible=left>0};SmallGameSubscribePanel.prototype.onTouch=function(e){var tar=e.currentTarget;var self=this;if(tar==this.btn){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.subscribeMsg");dyb.subscribeMsg(function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.subscribeMsg callback:"+JSON.stringify(callback));var code=callback.code;if(code==1||code=="1"){console.log("ChannelNet.ins().sendShareEnd("+self.type+")");ChannelNet.ins().sendShareEnd(self.type)}if(self.redPoint.visible){if(code==2||code=="2"){console.log("ChannelNet.ins().sendShareEnd("+self.type+")");ChannelNet.ins().sendShareEnd(self.type)}}})}};SmallGameSubscribePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isClosed=true;this.removeTouchEvent(this.btn,this.onTouch)};return SmallGameSubscribePanel}(BaseView);__reflect(SmallGameSubscribePanel.prototype,"SmallGameSubscribePanel");var SoundUtil=function(_super){__extends(SoundUtil,_super);function SoundUtil(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this._delayTime=0;_this._delayStartTime=0;_this._runTimeGap=700;_this._runTimeStart=0;_this._waitTime=0;_this._waitStartTime=0;_this.timeV1FB=22;_this.timeV1Boss=16;_this.timeV1Normal1=72;_this.timeV1Normal2=73;_this.timeMainBGSound=0;_this.playTimeMainBG=0;_this.lastEffectName="";_this.defaultVolume=.3;_this.upVolume=.8;_this.upVolumeEffects=[SoundUtil.BUTTON_CLICK01,SoundUtil.V1Normal1,SoundUtil.V1Normal2,SoundUtil.V1PVP,SoundUtil.V1Boss];_this.mainBGOrder=[];_this.mainBGCount=2;return _this}SoundUtil.ins=function(){return _super.ins.call(this)};SoundUtil.prototype.playRunSound=function(){if(egret.getTimer()-this._runTimeStart>=this._runTimeGap){this._runTimeStart=egret.getTimer();SoundManager.ins().playEffect(SoundUtil.RUN)}};SoundUtil.prototype.playRun=function(){if(egret.getTimer()-this._runTimeStart>this._runTimeGap+100){this.playRunSound()}if(!TimerManager.ins().isExists(this.playRunSound,this)){TimerManager.ins().doTimer(this._runTimeGap,0,this.playRunSound,this)}};SoundUtil.prototype.stopRun=function(){TimerManager.ins().remove(this.playRunSound,this)};SoundUtil.prototype.delayTime=function(time){this._delayTime=time;this._delayStartTime=egret.getTimer()};SoundUtil.prototype.addActivateListenter=function(stage){if(!stage)return;stage.removeEventListener(egret.Event.ACTIVATE,this.bgSoundOn,this);stage.removeEventListener(egret.Event.DEACTIVATE,this.bgSoundOff,this);stage.addEventListener(egret.Event.ACTIVATE,this.bgSoundOn,this);stage.addEventListener(egret.Event.DEACTIVATE,this.bgSoundOff,this)};SoundUtil.prototype.bgSoundOn=function(){this.playBGSound()};SoundUtil.prototype.bgSoundOff=function(){this.clearTimer();SoundManager.ins().stopBg()};SoundUtil.prototype.waitToCanPlayEffect=function(waitTime){this._waitTime=waitTime;this._waitStartTime=egret.getTimer()};SoundUtil.prototype.playEffect=function(effectName,times){if(times===void 0){times=1}if(egret.getTimer()-this._waitStartTime<this._waitTime){return}this.reSetVolumeByEffName(effectName);SoundManager.ins().playEffect(effectName,times)};SoundUtil.prototype.reSetVolumeByEffName=function(effectName){var volume=this.defaultVolume;if(this.upVolumeEffects.indexOf(effectName)>-1){volume=this.upVolume}SoundManager.ins().setEffectVolume(volume)};SoundUtil.prototype.rePlayBGByEffName=function(effectName){SoundManager.ins().stopBg();SoundManager.ins().playBg(effectName)};SoundUtil.prototype.stopChannels=function(){SoundManager.ins().stopChannels()};SoundUtil.prototype.changeSceneSound=function(){if(GameMap.fbType==GameMap.lastFbTyp&&GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){return}this.playBGSound()};SoundUtil.prototype.playBGSound=function(){if(RoleAI.ins().inStoryMode){return}this.clearTimer();if(GameMap.sceneInMain()&&!Encounter.ins().isEncounter()){this.playMainBGSound()}else if(GameMap.fbType==UserFb.FB_TYPE_ZHENGBA||GameMap.fubenID==5e4||GameMap.fbType==UserFb.FB_TYPE_PEAKED||GameMap.fbType==UserFb.FB_TYPE_KF_ARENA||GameMap.fbType==UserFb.FB_TYPE_XIANMO||GameMap.fbType==UserFb.FB_TYPE_YUNDIAN||Encounter.ins().isEncounter()){this.playPVPBGSound()}else if(ViewManager.ins().isShow(StartGameWin)||ViewManager.ins().isShow(CreateRoleView)){this.playStartBGSound()}else{this.playPVESound()}};SoundUtil.prototype.clearTimer=function(){TimerManager.ins().remove(this.loopPlayMainBGSound,this)};SoundUtil.prototype.playMainBGSound=function(){this.initMainBGData();if(!TimerManager.ins().isExists(this.loopPlayMainBGSound,this)){TimerManager.ins().doTimer(1e3,0,this.loopPlayMainBGSound,this)}};SoundUtil.prototype.initMainBGData=function(){this.playTimeMainBG=0;this.lastEffectName="";this.timeMainBGSound=this.timeV1Normal1+this.timeV1Normal2;this.mainBGOrder=this.createMainBGOrder()};SoundUtil.prototype.loopPlayMainBGSound=function(){var effectName=this.getCurMainBGEffName(this.playTimeMainBG);if(this.lastEffectName!=effectName){this.lastEffectName=effectName;this.rePlayBGByEffName(effectName)}this.playTimeMainBG++;if(this.playTimeMainBG>=this.timeMainBGSound){this.initMainBGData()}};SoundUtil.prototype.createMainBGOrder=function(){var mainBGCount=this.mainBGCount;var mainBGOrder=[];while(mainBGOrder.length<mainBGCount){var effNameIdx=Math.floor(Math.random()*mainBGCount);if(mainBGOrder.indexOf(effNameIdx)==-1){mainBGOrder.push(effNameIdx)}}return mainBGOrder};SoundUtil.prototype.getCurMainBGEffName=function(playTime){var effectName=this.lastEffectName;var mainBGOrder=this.mainBGOrder;var mainBGEffName=[SoundUtil.V1Normal1,SoundUtil.V1Normal2];var mainBGtimes=[this.timeV1Normal1,this.timeV1Normal2];switch(playTime){case 0:effectName=mainBGEffName[mainBGOrder[0]];break;case mainBGtimes[mainBGOrder[0]]:effectName=mainBGEffName[mainBGOrder[1]];break}return effectName};SoundUtil.prototype.playPVPBGSound=function(){this.rePlayBGByEffName(SoundUtil.V1PVP)};SoundUtil.prototype.playPVESound=function(){this.rePlayBGByEffName(SoundUtil.V1Boss)};SoundUtil.prototype.playStartBGSound=function(){this.rePlayBGByEffName(SoundUtil.V1Normal1)};SoundUtil.RUN="longlin_a_pd_mp3";SoundUtil.WINDOW="button_click01_mp3";SoundUtil.TASK="longlin_b_renwu_mp3";SoundUtil.LEVEL_UP="longlin_b_shengji_mp3";SoundUtil.SCENE="longlin_a_zyz_mp3";SoundUtil.EQUIP="longlin_a_chuandai_mp3";SoundUtil.CREATE_ROLE="longlin_a_chuangjue_mp3";SoundUtil.FORGE="longlin_a_qianghua_mp3";SoundUtil.SMELT="longlin_b_ronglian_mp3";SoundUtil.SKILL_UP="longlin_b_jineng_mp3";SoundUtil.ROLE_ZHENWU="longlin_a_zhenwu_mp3";SoundUtil.ROLE_LINGLONG="longlin_a_linglong_mp3";SoundUtil.ROLE_TIANHUA="longlin_a_tianhua_mp3";SoundUtil.WINDOW_OPEN=false;SoundUtil.BUTTON_CLICK01="button_click01_mp3";SoundUtil.PAGE_CLICK01="page_click01_mp3";SoundUtil.V1Boss="V1Boss_mp3";SoundUtil.V1PVP="V1PVP_mp3";SoundUtil.V1Normal1="V1Normal1_mp3";SoundUtil.V1Normal2="V1Normal2_mp3";return SoundUtil}(BaseClass);__reflect(SoundUtil.prototype,"SoundUtil");var LyMark=function(_super){__extends(LyMark,_super);function LyMark(){var _this=_super.call(this)||this;_this._lyMarkLv=0;_this._lyMarkExp=0;_this._isMax=false;_this.sysId=PackageID.LyMark;_this.regNetMsg(1,_this.postMarkData);_this.regNetMsg(2,_this.postUpgrade);return _this}LyMark.ins=function(){return _super.ins.call(this)};Object.defineProperty(LyMark.prototype,"lyMarkLv",{get:function(){return this._lyMarkLv},enumerable:true,configurable:true});Object.defineProperty(LyMark.prototype,"lyMarkExp",{get:function(){return this._lyMarkExp},enumerable:true,configurable:true});Object.defineProperty(LyMark.prototype,"skills",{get:function(){return this._skills},enumerable:true,configurable:true});Object.defineProperty(LyMark.prototype,"isMax",{get:function(){return this._isMax},enumerable:true,configurable:true});LyMark.prototype.getSkillLvById=function(id){if(!this._skills||this._skills.length<id)return 0;return this._skills[id-1]};LyMark.prototype.postMarkData=function(bytes){this._lyMarkLv=bytes.readShort();this._lyMarkExp=bytes.readInt();var len=bytes.readByte();this._skills=[];this._skills.length=len;for(var i=0;i<len;i++)this._skills[i]=bytes.readShort();this._isMax=this._lyMarkLv>=Object.keys(GlobalConfig.FlameStampLevel).length};LyMark.prototype.postUpgrade=function(bytes){var crit=bytes.readByte();return[crit]};LyMark.prototype.sendUpgrade=function(){this.sendBaseProto(2)};LyMark.prototype.sendUpSkill=function(skillID){var bytes=this.getBytes(3);bytes.writeByte(skillID);this.sendToServer(bytes)};LyMark.prototype.sendCompound=function(itemID){var bytes=this.getBytes(4);bytes.writeInt(itemID);this.sendToServer(bytes)};LyMark.prototype.checkOpen=function(){if(!SpecialRing.ins().isFireRingActivate())return false;var ring=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(!ring||ring.level<GlobalConfig.FlameStamp.openLevel)return false;return true};LyMark.prototype.checkRed=function(){if(!this.checkOpen())return false;if(!LyMark.ins().isMax){var cfg=GlobalConfig.FlameStampLevel[this.lyMarkLv];if(Assert(cfg,"LyMark lv:"+this.lyMarkLv+", exp:"+this.lyMarkExp))return false;var itemData=UserBag.ins().getBagItemById(cfg.costItem);var count=itemData?itemData.count:0;var needExp=cfg.exp-this._lyMarkExp;if(count>=cfg.costCount&&count*GlobalConfig.FlameStampMat[cfg.costItem].exp>=needExp)return true}var skillCfg,skillLv;for(var i=0;i<=6;i++){if(i==0)continue;skillLv=LyMark.ins().getSkillLvById(i+1);var isMax=skillLv>=Object.keys(GlobalConfig.FlameStampEffect[i+1]).length;if(isMax)continue;skillCfg=GlobalConfig.FlameStampEffect[i+1][skillLv<=0?1:skillLv+1];if(skillCfg.costItem){var itemConfig=GlobalConfig.ItemConfig[skillCfg.costItem];var itemData=UserBag.ins().getBagItemById(skillCfg.costItem);var count=itemData?itemData.count:0;if(count>=skillCfg.costCount&&LyMark.ins().lyMarkLv>=skillCfg.stampLevel)return true}}return false};LyMark.prototype.getCurSkillID=function(){var skillLv,effectCfg;var skillID=0,realLv=0;for(var i=0;i<=6;i++){realLv=skillLv=this.getSkillLvById(i+1);if(!skillLv)skillLv=1;effectCfg=GlobalConfig.FlameStampEffect[i+1][skillLv];if((i+1==1||i+1==2)&&realLv)skillID=effectCfg.skillId}return skillID};LyMark.prototype.getCurSkillCD=function(){var skillID=this.getCurSkillID();var lv=this.getSkillLvById(3);var mCd=lv?GlobalConfig.FlameStampEffect[3][lv].reloadTime:0;var skillDes=GlobalConfig.SkillsDescConfig[GlobalConfig.SkillsConfig[skillID].desc];return skillDes.cd-mCd};return LyMark}(BaseSystem);__reflect(LyMark.prototype,"LyMark");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.lyMark=LyMark.ins.bind(LyMark)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var BaseSpriteLayer=function(_super){__extends(BaseSpriteLayer,_super);function BaseSpriteLayer(){var _this=_super.call(this)||this;_this.touchEnabled=false;return _this}return BaseSpriteLayer}(egret.DisplayObjectContainer);__reflect(BaseSpriteLayer.prototype,"BaseSpriteLayer");var BookSkillInfo=function(){function BookSkillInfo(){this.itemId=0;this.num=0}return BookSkillInfo}();__reflect(BookSkillInfo.prototype,"BookSkillInfo");var OtherFireRingData=function(){function OtherFireRingData(){this.lyMarkLv=0;this.lyMarkSkills=[]}OtherFireRingData.prototype.parser=function(bytes){this.lv=bytes.readInt();this.skillBooks=[];this.abilityItems=[];if(this.lv>0){var bookCount=bytes.readShort();for(var i=0;i<bookCount;i++){var skillInfo=new RingSkillInfo;skillInfo.position=bytes.readShort();skillInfo.skillId=bytes.readShort();skillInfo.skillLvl=bytes.readShort();this.skillBooks.push(skillInfo)}var itemCount=bytes.readShort();for(var i=0;i<itemCount;i++){var id=bytes.readShort();var lv=bytes.readShort();this.abilityItems[id]=lv}this.lyMarkLv=bytes.readShort();this.lyMarkSkills=[];var len=bytes.readByte();this.lyMarkSkills.length=len;for(var i=0;i<len;i++)this.lyMarkSkills[i]=bytes.readShort()}};return OtherFireRingData}();__reflect(OtherFireRingData.prototype,"OtherFireRingData");var RingSkillInfo=function(){function RingSkillInfo(){this.position=0;this.skillId=0;this.skillLvl=0;this.isOpen=false}return RingSkillInfo}();__reflect(RingSkillInfo.prototype,"RingSkillInfo");var SpecialRingData=function(){function SpecialRingData(){this.id=0;this.level=0;this.exp=0;this.fight=0;this.order=0;this.isUnLock=0}SpecialRingData.prototype.parser=function(bytes){this.id=bytes.readShort();this.level=bytes.readShort();this.exp=bytes.readInt();this.fight=bytes.readByte();this.isUnLock=bytes.readByte();this.order=GlobalConfig.ActorExRingConfig[this.id].order};return SpecialRingData}();__reflect(SpecialRingData.prototype,"SpecialRingData");var FireRingAbilityView=function(_super){__extends(FireRingAbilityView,_super);function FireRingAbilityView(){var _this=_super.call(this)||this;_this.skinName="LYRAbilitySkin";_this.isTopLevel=true;return _this}FireRingAbilityView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.list.itemRenderer=FireRingAbilityItem;this.addTouchEndEvent(this.colorCanvas,this.otherClose);this.addTouchEndEvent(this.closeBtn,this.otherClose);var ary=[];for(var i in GlobalConfig.ActorExRingAbilityConfig){ary.push(parseInt(i))}this.list.dataProvider=new ArrayCollection(ary)};FireRingAbilityView.prototype.otherClose=function(evt){ViewManager.ins().close(this)};return FireRingAbilityView}(BaseEuiView);__reflect(FireRingAbilityView.prototype,"FireRingAbilityView");ViewManager.ins().reg(FireRingAbilityView,LayerManager.UI_Popup);var FireRingInfoPanel=function(_super){__extends(FireRingInfoPanel,_super);function FireRingInfoPanel(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.isItemEnough=false;return _this}FireRingInfoPanel.prototype.open=function(){this.addCustomEvent();this.initView();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.shengXing)};FireRingInfoPanel.prototype.addCustomEvent=function(){this.addTouchEvent(this.showBtn,this.showDetail);this.addTouchEvent(this.lvupBtn,this.upStar);this.addTouchEvent(this.checkBtn,this.showAbility);this.addTouchEvent(this.ultraBtn,this.showUltra);this.addTouchEvent(this.btnSwordSkin,this.showSwordSkin);this.addTouchEvent(this.labelViewSwords,this.onViewSwords);this.observe(SpecialRing.ins().postSpicelRingUpdate,this.initView);this.observe(SpecialRing.ins().postSRStairUp,this.initView);this.observe(UserBag.ins().postItemDel,this.updateUltra);this.observe(UserBag.ins().postItemChange,this.updateUltra)};FireRingInfoPanel.prototype.onViewSwords=function(){ViewManager.ins().open(RingInfoView)};FireRingInfoPanel.prototype.showUltra=function(){ViewManager.ins().open(RingUpgradeWin)};FireRingInfoPanel.prototype.showSwordSkin=function(){ViewManager.ins().open(SwordSkinWin)};FireRingInfoPanel.prototype.showAbility=function(){ViewManager.ins().open(FireRingAbilityView)};FireRingInfoPanel.prototype.upStar=function(){if(this.starList.starNum==10){SpecialRing.ins().sendRingLevelUp(SpecialRing.FIRE_RING_ID)}else{if(!this.isItemEnough){UserTips.ins().showTips(i18n("FireRingInfoPanel_0"))}else{SpecialRing.ins().sendSpicelRingUpdate(SpecialRing.FIRE_RING_ID)}}};FireRingInfoPanel.prototype.showDetail=function(){ViewManager.ins().open(RingDetailPanel,this.powerAttr)};FireRingInfoPanel.prototype.updateUltra=function(){if(SpecialRing.ins().getAbilityID()){this.ultraBtn.icon="ability_0N";this.nameImg.source="ring_title2"}else{this.ultraBtn.icon="ability_0L";this.nameImg.source="ring_title"}};FireRingInfoPanel.prototype.initView=function(){var data=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);var stage=SpecialRing.ins().getRingStair(data.level);var star=SpecialRing.ins().getRingStar(data.level);var isUpgrade=0;if(this.lastStar==undefined){isUpgrade=0}else{if(this.lastStar<star){isUpgrade=1}else{isUpgrade=0}}this.lastStar=star;var cfg=SpecialRing.ins().getRingConfigById(SpecialRing.FIRE_RING_ID,data.level);var itemCfg=GlobalConfig.ItemConfig[cfg.costItem];var nextCfg=SpecialRing.ins().getRingConfigById(SpecialRing.FIRE_RING_ID,data.level+1);this.lv.text=StringUtils.NumberToChinese(stage)+i18n("FireRingInfoPanel_1");this.costImg.source=itemCfg.icon+"_png";var itemCount=UserBag.ins().getBagGoodsCountById(0,cfg.costItem);var colorStr="";var cost=cfg.cost;if(star==10){itemCount=0;cost=0;this.costImg.visible=false;this.costCount.visible=false;this.costTitle.visible=false;this.lvupBtn.label=i18n("FireRingInfoPanel_2")}else{this.costImg.visible=true;this.costCount.visible=true;this.costTitle.visible=true;this.lvupBtn.label=i18n("FireRingInfoPanel_3")}if(itemCount>=cost){colorStr=ColorUtil.GREEN_COLOR;this.isItemEnough=true}else{colorStr=ColorUtil.RED_COLOR;this.isItemEnough=false}this.costCount.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+itemCount+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+cost+"</font> ");this.nowAttr.text=AttributeData.getAttStr(cfg.attrAward,0,1,"：");if(nextCfg){this.nextAttr.text=AttributeData.getAttStr(nextCfg.attrAward,0,1,"：")}else{this.nextAttr.text=i18n("FireRingInfoPanel_4")}this.powerAttr=FireRingInfoPanel.getRingTotalAttribute();var p=UserBag.getAttrPower(this.powerAttr);p=p*SubRoles.ins().subRolesLen;this.power.setPower(p);if(!this.starList){this.starList=new StarList(10);this.starList.x=15;this.starGroup.addChild(this.starList)}this.starList.setStarNum(star,isUpgrade);this.info.text=this.getNextStageAbility(stage);this.updateUltra();if(this.ringMc==null){this.ringMc=new MovieClip;var config=GlobalConfig.ActorExRingConfig[7];var effSoure=config.icon;this.ringMc.playFile(RES_DIR_EFF+effSoure,-1);this.ringMcGroup.addChild(this.ringMc)}};FireRingInfoPanel.getRingTotalAttribute=function(){var attr;var _loop_28=function(i){var lvl=1;if(i==SpecialRing.FIRE_RING_ID){lvl=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level}var cfg=SpecialRing.ins().getRingConfigById(i,lvl);if(!attr){attr=cfg.attrAward}else{if(i==SpecialRing.FIRE_RING_ID){var addAttr=CommonUtils.copyDataHandler(cfg.attrAward);var abilityId=SpecialRing.ins().getAbilityID();if(abilityId){var exRingCfg_1=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID][abilityId][SpecialRing.ins().abilityIds[abilityId]];addAttr.forEach(function(dp,index){dp.value*=1+exRingCfg_1.attrPer/1e4;dp.value=Math.round(dp.value)})}attr=AttributeData.AttrAddition(attr,addAttr)}else{attr=AttributeData.AttrAddition(attr,cfg.attrAward)}}};for(var i=2;i<=7;i++){_loop_28(i)}return attr};FireRingInfoPanel.prototype.getNextStageAbility=function(stage){var nextstage=stage+1;if(nextstage<2)nextstage=2;var count=0;for(var i in GlobalConfig.ActorExRing7Config){if(GlobalConfig.ActorExRing7Config[i]instanceof ActorExRing7Config){count++}}var cfg=GlobalConfig.ActorExRing7Config[count];var maxStage=SpecialRing.ins().getRingStair(cfg.level);while(nextstage<maxStage){var skillName=SpecialRing.ins().getNextStageSkillName(nextstage);if(skillName){return nextstage+i18n("FireRingInfoPanel_5")+SpecialRing.ins().getNextStageSkillName(nextstage)}else{nextstage++}}return""};FireRingInfoPanel.prototype.checkPoint=function(){if(!this.redPoint0){return}this.redPoint0.visible=SwordSkinMgr.ins().showRedPoint();this.redPoint1.visible=SpecialRing.ins().canUseSpecialRingItem()};return FireRingInfoPanel}(BaseComponent);__reflect(FireRingInfoPanel.prototype,"FireRingInfoPanel");var ArrayCollection=eui.ArrayCollection;window["ArrayCollection"]=ArrayCollection;var FireRingSkillPanel=function(_super){__extends(FireRingSkillPanel,_super);function FireRingSkillPanel(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.skillId=0;_this.isEoughItemUpgrade=false;_this.skillName="";return _this}FireRingSkillPanel.prototype.open=function(){this.initView();this.addCustomEvent();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.ringSkill)};FireRingSkillPanel.prototype.addCustomEvent=function(){this.addTouchEvent(this.opraBtn,this.opration);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this);this.learnList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onLearnListChange,this);this.observe(SpecialRing.ins().postSkillInfo,this.refreshView)};FireRingSkillPanel.prototype.opration=function(){var data=SpecialRing.ins().skillInfo[this.lastSelectIndex];if(data.skillId==0){SpecialRing.ins().requestLearnSkill(this.skillId,data.position)}else{if(data.skillLvl==SpecialRing.ins().getSkillMaxLvl(data.skillId)){UserTips.ins().showTips(this.skillName+i18n("FireRingSkillPanel_0"))}else if(this.isEoughItemUpgrade){SpecialRing.ins().requestUpgradeSkill(data.position)}else{UserTips.ins().showTips(this.skillName+i18n("FireRingSkillPanel_1"))}}};FireRingSkillPanel.prototype.onListChange=function(e){var data=SpecialRing.ins().skillInfo[this.list.selectedIndex];if(!data.isOpen){var lvl=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level;var stage=SpecialRing.ins().getRingStair(lvl);if(lvl>=SpecialRing.GRID_OPEN_LEVEL){var data_14=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];if(Actor.yb>=data_14.skillGridYb){var warnWin=WarnWin.show(i18n("FireRingSkillPanel_5",data_14.skillGridYb),function(){SpecialRing.ins().requestOpenGrid()},this,function(){},this,"normal")}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("FireRingSkillPanel_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("FireRingSkillPanel_3"))}}else{UserTips.ins().showTips(SpecialRing.GRID_OPEN_LEVEL+i18n("FireRingSkillPanel_4"))}}else{this.updateView(e.itemIndex)}};FireRingSkillPanel.prototype.onLearnListChange=function(e){this.selectSkill(this.learnList.selectedIndex)};FireRingSkillPanel.prototype.initView=function(){this.list.itemRenderer=FireRingSkillItem;this.learnList.itemRenderer=FireRingSkillBookItem;this.updateList();this.updateView(0)};FireRingSkillPanel.prototype.updateList=function(){this.list.dataProvider=new ArrayCollection(SpecialRing.ins().skillInfo)};FireRingSkillPanel.prototype.refreshView=function(){this.updateList();this.updateView(this.lastSelectIndex)};FireRingSkillPanel.prototype.updateView=function(index){this.lastSelectIndex=index;this.list.selectedIndex=index;this.selectList();var skill=SpecialRing.ins().skillInfo[index];if(skill.skillId){this.currentState="upgrade";this.opraBtn.enabled=true;var cfg_6=SpecialRing.ins().getActorExRingBookConfig(skill.skillId,skill.skillLvl);this.skillName=cfg_6.skillName;this.nextLv.visible=true;this.opraBtn.visible=true;this.nowLvDesc.textFlow=TextFlowMaker.generateTextFlow(cfg_6.skillDesc);if(skill.skillLvl<SpecialRing.ins().getSkillMaxLvl(skill.skillId)){this.nextLv.visible=true;var nextcfg=SpecialRing.ins().getActorExRingBookConfig(skill.skillId,skill.skillLvl+1);this.nextLvDesc.textFlow=TextFlowMaker.generateTextFlow(nextcfg.skillDesc);this.cost.text="X"+nextcfg.num;this.needItem.data=nextcfg.itemId;this.isEoughItemUpgrade=UserBag.ins().getBagGoodsCountById(0,cfg_6.itemId)>=nextcfg.num;if(this.isEoughItemUpgrade){this.cost.textColor=ColorUtil.GREEN_COLOR_N;this.updateRp.visible=true}else{this.cost.textColor=ColorUtil.RED_COLOR_N;this.updateRp.visible=false}this.updateGroup.visible=true}else{this.isEoughItemUpgrade=true;this.updateGroup.visible=false;this.nextLv.visible=false;this.updateRp.visible=false}}else{this.currentState="study";this.learnList.dataProvider=new ArrayCollection(SpecialRing.ins().getStudyBook());if(this.learnList.dataProvider.length==0){this.nowLvDesc.visible=false;this.nextLvDesc.visible=false;this.opraBtn.enabled=false;this.nobook.visible=true}else{this.nowLvDesc.visible=true;this.nextLvDesc.visible=true;this.opraBtn.enabled=true;this.nobook.visible=false;this.selectSkill(SpecialRing.ins().getFirstStudyBookIndex())}}var count=SpecialRing.ins().skillInfo.length;var attr;var cfg;var book;var addPower=0;var addPercent;for(var i=0;i<count;i++){cfg=SpecialRing.ins().skillInfo[i];if(cfg.skillId>0){book=SpecialRing.ins().getActorExRingBookConfig(cfg.skillId,cfg.skillLvl);if(cfg.skillId<=4){if(!attr){attr=book.attr}else{attr=AttributeData.AttrAddition(attr,book.attr)}}else if(cfg.skillId==5){addPercent=book.bookAttrPer}else if(cfg.skillId>5&&book.exPower){addPower+=book.exPower}}}var p=addPower;if(attr){if(addPercent){attr=AttributeData.AttrMultiply(attr,addPercent)}p+=UserBag.getAttrPower(attr)}p=p*SubRoles.ins().subRolesLen;this.power.setPower(p)};FireRingSkillPanel.prototype.selectSkill=function(index){this.learnList.selectedIndex=index;var data=this.learnList.dataProvider.getItemAt(index);var skillId=SpecialRing.ins().getSkillIdByItemId(data.id);var cfg=SpecialRing.ins().getActorExRingBookConfig(skillId,1);this.skillId=skillId;this.nowLvDesc.textFlow=TextFlowMaker.generateTextFlow(cfg.skillDesc);var nextCfg=SpecialRing.ins().getActorExRingBookConfig(skillId,2);this.nextLvDesc.textFlow=TextFlowMaker.generateTextFlow(nextCfg.skillDesc);this.selectLearnList()};FireRingSkillPanel.prototype.selectList=function(){var count=this.list.dataProvider.length;for(var i=0;i<count;i++){var item=this.list.getElementAt(i);if(item){if(i!=this.list.selectedIndex){item.setSelect(false)}else{item.setSelect(true)}}}};FireRingSkillPanel.prototype.selectLearnList=function(){var count=this.learnList.dataProvider.length;for(var i=0;i<count;i++){var item=this.learnList.getElementAt(i);if(item){if(i!=this.learnList.selectedIndex){item.setSelect(false)}else{item.setSelect(true)}}}if(this.learnList.selectedItem!=undefined&&this.learnList.selectedItem.id!=undefined){this.opraBtn.enabled=SpecialRing.ins().isBookCanStudy(this.learnList.selectedItem.id)}};return FireRingSkillPanel}(BaseComponent);__reflect(FireRingSkillPanel.prototype,"FireRingSkillPanel");var FireRingWin=function(_super){__extends(FireRingWin,_super);function FireRingWin(){var _this=_super.call(this)||this;_this.lastSelect=0;_this.skinName="LYRingSkin";_this.isTopLevel=true;return _this}FireRingWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(SpecialRing.ins().isFireRingFuse()){return true}else if(SpecialRing.ins().checkRingOpen()){ViewManager.ins().open(RingInfoView)}else{UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.RING))}return false};FireRingWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.initUI()};FireRingWin.prototype.initUI=function(){this.openPage(true)};FireRingWin.prototype.openPage=function(open){if(open===void 0){open=true}if(!this.viewStack){return}var page=this.viewStack.getElementAt(this.lastSelect);if(!page){return}if(open){page["open"]()}if(!open){page["close"]()}};FireRingWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.lastSelect=param[0]||0;this.addChangingEvent(this.tab,this.onTabTouching);this.tab.addEventListener(egret.Event.CHANGE,this.setSelectedIndex,this);this.tab.selectedIndex=this.lastSelect;this.viewStack.selectedIndex=this.lastSelect;this.openPage(true);this.checkPoint();this.observe(SpecialRing.ins().postSRStairUp,this.checkPoint);this.observe(SpecialRing.ins().postSkillInfo,this.checkPoint);this.observe(UserFb.ins().postFbRingInfo,this.checkPoint);this.observe(UserBag.ins().postItemAdd,this.checkPoint);this.observe(UserBag.ins().postItemDel,this.checkPoint);this.observe(UserBag.ins().postItemCountChange,this.checkPoint);this.observe(LyMark.ins().postMarkData,this.checkPoint);this.observe(Actor.ins().postPowerChange,this.refreshPower)};FireRingWin.prototype.close=function(){this.removeObserve();this.removeEventListener(egret.Event.CHANGING,this.onTabTouching,this.tab);this.removeEventListener(egret.Event.CHANGE,this.setSelectedIndex,this);this.openPage(false);ViewManager.ins().close(SwordSkinWin)};FireRingWin.prototype.refreshPower=function(){this.roleSelect.refreshPower(this.roleSelect._curRole)};FireRingWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(this.tab.selectedIndex)){e.preventDefault()}};FireRingWin.prototype.checkIsOpen=function(index){if(index==2&&!LyMark.ins().checkOpen()){UserTips.ins().showTips(i18n("FireRingWin_0"));return false}return true};FireRingWin.prototype.setSelectedIndex=function(e){this.openPage(false);this.lastSelect=this.viewStack.selectedIndex;this.openPage(true)};FireRingWin.prototype.checkPoint=function(){this.redPoint0.visible=SpecialRing.ins().checkHaveUpRing()||SwordSkinMgr.ins().showRedPoint()||SpecialRing.ins().canUseSpecialRingItem();this.redPoint1.visible=SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill();this.redPoint2.visible=LyMark.ins().checkRed();this.LYRBase.checkPoint()};return FireRingWin}(BaseEuiView);__reflect(FireRingWin.prototype,"FireRingWin");ViewManager.ins().reg(FireRingWin,LayerManager.UI_Main);var RingDetailPanel=function(_super){__extends(RingDetailPanel,_super);function RingDetailPanel(){var _this=_super.call(this)||this;_this.skinName="LYRAttrSkin";_this.isTopLevel=true;return _this}RingDetailPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var attrs=param[0];this.attrValue.text=AttributeData.getAttStr(attrs,0,1,"    ",false,false);this.addTouchEndEvent(this.bgClose,this.otherClose)};RingDetailPanel.prototype.otherClose=function(evt){ViewManager.ins().close(this)};return RingDetailPanel}(BaseEuiView);__reflect(RingDetailPanel.prototype,"RingDetailPanel");ViewManager.ins().reg(RingDetailPanel,LayerManager.UI_Popup);var specialRing=GameSystem.specialRing;window["specialRing"]=specialRing;var RingInfoView=function(_super){__extends(RingInfoView,_super);function RingInfoView(){var _this=_super.call(this)||this;_this.barbc=new ProgressBarEff;_this.cruCostId=0;_this.isAutoUp=false;_this.canUpdate=false;_this.FIRE_RING_ID=7;_this.fuseMcs=[];_this.skinName="ring";_this.isTopLevel=true;return _this}RingInfoView.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(SpecialRing.ins().isFireRingFuse()){ViewManager.ins().open(FireRingWin)}else if(SpecialRing.ins().checkRingOpen()){return true}else{UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.RING))}return false};RingInfoView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.barbc.setWidth(400);this.barbc.x=-15;this.barbc.y=25;this.barGroup.addChild(this.barbc);this.starList=new StarList(SpecialRing.perStar);this.starList.x=15;this.starList.y=0;this.star.addChild(this.starList);this.iconMc=new MovieClip;this.iconMc.x=0;this.iconMc.y=0;this.ringMcGroup.addChild(this.iconMc);this.reliveEff=new MovieClip;this.reliveEff.x=200;this.reliveEff.y=62;this.reliveEff.scaleX=1.15;this.baojiMc=new MovieClip;this.baojiMc.x=245;this.baojiMc.y=650;this.menuList.itemRenderer=SpecialRingItem;this.menuList.selectedIndex=0;this.menuListData=new eui.ArrayCollection;this.menuList.dataProvider=this.menuListData;this.ringget.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.ringget.text+"</u></a>");this.upgradebtn.label=i18n("RingInfoView_0");this.uplevel.label=i18n("RingInfoView_1");this.countTxt.textColor=ColorUtil.NORMAL_COLOR};RingInfoView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addChangeEvent(this.menuList,this.onClickMenu);this.addTouchEvent(this.uplevel,this.onTap);this.addTouchEvent(this.acivebtn,this.onTap);this.addTouchEvent(this.ringget,this.onTap);this.addTouchEvent(this.upgradebtn,this.onTap);this.addTouchEvent(this.goQuicklyOpen,this.onQuickOpen);this.addTouchEvent(this.btnSwordSkin,this.onBtnSwordSkin);this.addTouchEvent(this.labelGetItem,this.onGetItem);SpecialRing.ins().sendGetOpenItemNum();this.observe(SpecialRing.ins().postUnLock,this.updateView);this.observe(UserTask.ins().postUpdateAchieve,this.updateView);this.observe(SpecialRing.ins().postSpicelRingUpdate,this.playEffect);this.observe(SpecialRing.ins().postActiveRing,this.showActivityView);this.observe(SpecialRing.ins().postActiveRing,this.updateView);this.observe(SpecialRing.ins().postSRStairUp,this.updateView);this.observe(SpecialRing.ins().postGetOpenItemNum,this.updateView);this.observe(UserBag.ins().postItemAdd,this.checkPoint);this.observe(UserBag.ins().postItemDel,this.checkPoint);this.observe(UserBag.ins().postItemCountChange,this.checkPoint);this.barbc.reset();this.updateView();this.setIcon();this.checkPoint()};RingInfoView.prototype.onGetItem=function(){var config=GlobalConfig.ActorExRingConfig[this.currData.id];ViewManager.ins().open(ShopGoodsWarn).setData(config.openItem.id,config.openItem.count-SpecialRing.ins().openItemNum)};RingInfoView.prototype.checkPoint=function(){if(!this.ssRedPoint){return}this.ssRedPoint.visible=SwordSkinMgr.ins().showRedPoint()};RingInfoView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.uplevel,this.onTap);this.removeTouchEvent(this.ringget,this.onTap);this.removeTouchEvent(this.acivebtn,this.onTap);this.removeTouchEvent(this.upgradebtn,this.onTap);this.removeTouchEvent(this.goQuicklyOpen,this.onQuickOpen);this.removeTouchEvent(this.btnSwordSkin,this.onBtnSwordSkin);this.removeTouchEvent(this.labelGetItem,this.onGetItem);DisplayUtils.removeFromParent(this.reliveEff);this.removeObserve();if(this.isAutoUp){this.stopAutoUp()}ViewManager.ins().close(SwordSkinWin)};RingInfoView.prototype.onBtnSwordSkin=function(e){ViewManager.ins().open(SwordSkinWin)};RingInfoView.prototype.onQuickOpen=function(e){var config=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];var costMoney=config.useYb;if(Actor.yb>=costMoney){SpecialRing.ins().sendActiveRing(SpecialRing.FIRE_RING_ID,1)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("RingInfoView_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("RingInfoView_3"))}};RingInfoView.prototype.onTap=function(e){switch(e.currentTarget){case this.uplevel:this.warnShow();break;case this.acivebtn:if(this.currData.id==SpecialRing.FIRE_RING_ID){SpecialRing.ins().requestDeblock(this.currData.id)}else{var config=GlobalConfig.ActorExRingConfig[this.currData.id];if(SpecialRing.ins().openItemNum>=config.openItem.count){SpecialRing.ins().sendActiveRing(this.currData.id)}else{ViewManager.ins().open(ShopGoodsWarn).setData(config.openItem.id,config.openItem.count-SpecialRing.ins().openItemNum)}}break;case this.upgradebtn:UserTips.ins().showTips(i18n("RingInfoView_4"));break;case this.ringget:UserWarn.ins().setBuyGoodsWarn(this.cruCostId);break;default:break}};RingInfoView.prototype.showActivityView=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var config=GlobalConfig.ActorExRingConfig[this.currData.id];if(this.currData.id==SpecialRing.FIRE_RING_ID){ViewManager.ins().close(this);ViewManager.ins().open(FireRingWin)}else{this.upDateItem.apply(this,param)}var effSoure=config.icon;RewardWin.showAct(0,config.name,"",true,undefined,undefined,undefined,effSoure)};RingInfoView.prototype.upDateItem=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var id=0;if(param&&param[0]){id=param[0][0]}var item=SpecialRing.ins().getSpecialRingDataById(id);var config=GlobalConfig.ActorExRingConfig[this.currData.id];this.menuListData.replaceItemAt(item,config.order-1);this.currData=item;this.updateDetail(true)};RingInfoView.prototype.playEffect=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.upDateItem.apply(this,param);var baoji=0;var config=GlobalConfig.ActorExRingConfig[this.currData.id];if(param&&param[0])baoji=param[0][1];var attrConfig=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level);if(baoji>0){this.baojiMc.playFile(RES_DIR_EFF+"moneytreecrit",1);this.addChild(this.baojiMc)}var label=new eui.Label;label.size=14;label.textColor=242004;label.width=450;label.textAlign=egret.HorizontalAlign.CENTER;label.x=19;label.y=420;label.text=i18n("RingInfoView_7",config.name,attrConfig.addPower);this.addChild(label);var t=egret.Tween.get(label);t.to({y:label.y-45},500).call(function(){_this.removeChild(label)},this)};RingInfoView.prototype.onClickMenu=function(e){var data=this.specialDatas[e.currentTarget.selectedIndex];if(!data){return}this.barbc.reset();this.currData=data;this.updateDetail();this.setIcon()};RingInfoView.prototype.setIcon=function(){var config=GlobalConfig.ActorExRingConfig[this.currData.id];var effSoure=config.icon;this.iconMc.playFile(RES_DIR_EFF+effSoure,-1)};RingInfoView.prototype.updateView=function(){this.updateMenuList();this.updateDetail()};RingInfoView.prototype.updateMenuList=function(){this.specialDatas=CommonUtils.copyDataHandler(SpecialRing.ins().ringList);this.menuListData.source=this.specialDatas.sort(function(obj1,obj2){return Algorithm.sortAscAttr(obj1,obj2,"order")});if(this.currData){for(var i in this.specialDatas){if(this.currData.id==this.specialDatas[i].id){this.currData=this.specialDatas[i];break}}}else{this.currData=this.specialDatas[0]}};RingInfoView.prototype.updateFuseView=function(){var config=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];this.price0.setPrice(config.useYb);var ringIds=[7,5,3,4,6,2];var scales=[1,.5,.5,.5,.5,.5];for(var i=0;i<=5;++i){var config_16=GlobalConfig.ActorExRingConfig[ringIds[i]];var effSoure=config_16.icon;var mc=this.fuseMcs[i];if(!mc){mc=new MovieClip;mc.playFile(RES_DIR_EFF+effSoure,-1);mc.scaleX=mc.scaleY=scales[i];this["ringMcGroup"+i].addChild(mc)}}};RingInfoView.prototype.updateDetail=function(upStar){if(upStar===void 0){upStar=false}var config=GlobalConfig.ActorExRingConfig[this.currData.id];var isFireRingOpen=SpecialRing.ins().isFireRingActivate();if(isFireRingOpen&&!SpecialRing.ins().isFireRingFuse()){this.currentState="tejie8";this.updateFuseView();this.currData.id=this.FIRE_RING_ID}else{if(this.currData.id==this.FIRE_RING_ID){this.currentState="disable";this.resetUI();this.attrBg0.visible=true;this.skillnamebg.visible=false;this.acivebtn.label=i18n("RingInfoView_8");var cfg=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];this.grpVip.visible=cfg.openVip!=-1;this.labelVip.text=""+cfg.openVip;this.ringname.text=""+cfg.name;this.Explain0.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(cfg));this.labelGetItem.visible=this.openItemImg.visible=this.openDesc.visible=false;this.openDesc2.text=i18n("RingInfoView_9");if(SpecialRing.ins().isFireRingCanActivate()&&!SpecialRing.ins().isFireRingFuse()){this.acivebtn.visible=true;this.openDesc2.visible=false;this.addReliveEff()}else{this.acivebtn.visible=false;this.openDesc2.visible=!SpecialRing.ins().isFireRingFuse();DisplayUtils.removeFromParent(this.reliveEff)}}else{this.attrBg0.visible=true;this.skillnamebg.visible=true;this.acivebtn.label=i18n("RingInfoView_10");var configLevel=this.currData.level==0?1:this.currData.level;var attrConfig=SpecialRing.ins().getRingConfigById(this.currData.id,configLevel);var level=SpecialRing.ins().getRingStair(this.currData.level);this.ringname.text=""+config.name;this.stageImg.setValue(level);if(this.currData.level>0){if(Actor.level>=config.needLevel&&UserZs.ins().lv>=config.needZs){if(!SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1)){this.currentState="final"}else{this.currentState="open"}this.setOpenInfo(upStar)}else{this.currentState="wait";this.Explain0.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(config));var info1=config.needZs>0?config.needZs+i18n("RingInfoView_11"):"";var info2=config.needLevel>0?config.needLevel+i18n("RingInfoView_12"):"";this.openLevelDesc.text=i18n("RingInfoView_13",info1,info2);if(attrConfig.attrAward){this.setLayoutAttr(attrConfig);var point=UserBag.getAttrPower(attrConfig.attrAward);this.powerPanel.setPower(point)}else{this.setLayoutAttr(attrConfig,true);this.powerPanel.setPower(0)}}}else{this.currentState="disable";this.grpVip.visible=config.openVip!=-1;this.labelVip.text=""+config.openVip;if(attrConfig.attrAward){this.setLayoutAttr(attrConfig);var point=UserBag.getAttrPower(attrConfig.attrAward);this.powerPanel.setPower(point)}else{this.setLayoutAttr(attrConfig,true);this.powerPanel.setPower(0)}this.Explain0.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(config));var flag=SpecialRing.ins().checkRedPoint(this.currData.id,this.currData.level);this.labelGetItem.visible=this.openItemImg.visible=this.openDesc.visible=config.openItem.count>0;this.openDesc2.visible=false;if(flag){this.acivebtn.visible=true;this.acivebtn.alpha=1;this.addReliveEff();this.openDesc.textFlow=TextFlowMaker.generateTextFlow(i18n("RingInfoView_26",SpecialRing.ins().openItemNum,config.openItem.count))}else{var cfg=GlobalConfig.ActorExRingConfig[this.currData.id];this.acivebtn.visible=true;this.acivebtn.alpha=.5;var lilianLv=cfg.openLv;var trainCfg=GlobalConfig.TrainLevelConfig[lilianLv];DisplayUtils.removeFromParent(this.reliveEff);this.openDesc.textFlow=TextFlowMaker.generateTextFlow(i18n("RingInfoView_25",SpecialRing.ins().openItemNum,config.openItem.count))}this.canUpdate=false}this.skillname.text=attrConfig.SpecialRingSkin}}};RingInfoView.prototype.addReliveEff=function(){this.reliveEff.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.reliveEff.parent)this.aciveGroup.addChild(this.reliveEff)};RingInfoView.prototype.resetUI=function(){this.setLayoutAttr(null,true);this.Explain0.text="";this.skillname.text="";this.openDesc.text=""};RingInfoView.prototype.setLayoutAttr=function(attrConfig,clean){for(var i=0;i<4;i++){if(!clean){var spl=AttributeData.getAttStr(this.getAttrArray(attrConfig.attrAward),1);var attstrs=spl.split("\n");this["attrLabel"+(i+1)].text=attstrs[i]}else{this["attrLabel"+(i+1)].text=""}}};RingInfoView.prototype.getAttrArray=function(attr){var noShowType=[11,12,23,24];var showAttr=[];for(var i=0;i<attr.length;i++){if(noShowType.indexOf(attr[i].type)<0){showAttr.push(attr[i])}}return showAttr};RingInfoView.prototype.setOpenInfo=function(upStar){if(upStar===void 0){upStar=false}var config=GlobalConfig.ActorExRingConfig[this.currData.id];var configLevel=this.currData.level==0?1:this.currData.level;var attrConfig=SpecialRing.ins().getRingConfigById(this.currData.id,configLevel);this.cruCostId=attrConfig.costItem;this.Explain0.textFlow=this.Explain.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(config));var count=UserBag.ins().getBagGoodsCountById(0,attrConfig.costItem);this.countTxt.text=i18n("RingInfoView_18",GlobalConfig.ItemConfig[attrConfig.costItem].name);var colorStr="";if(count>=attrConfig.cost)colorStr=ColorUtil.GREEN_COLOR;else colorStr=ColorUtil.RED_COLOR;this.useTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+colorStr+">"+count+"</font><font color="+ColorUtil.UI_ITEMNUMBER_BULE+">/"+attrConfig.cost+"</font> ");this.canUpdate=count>=attrConfig.cost;var nextAttrConfig;this.upgradebtn.visible=false;if(this.currentState!="final")this.uplevel.visible=true;var curStar=SpecialRing.ins().getRingStar(this.currData.level);if(attrConfig.judgeup>0){nextAttrConfig=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1);if(this.currData.exp>=attrConfig.upPower){this.starList.setStarNum(curStar,Number(upStar));this.upgradebtn.visible=true;this.uplevel.visible=false;if(!SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1)){this.upgradebtn.label=i18n("RingInfoView_19")}else{this.upgradebtn.label=i18n("RingInfoView_20")}}else{this.starList.setStarNum(curStar,Number(upStar))}}else{nextAttrConfig=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1);this.starList.setStarNum(curStar,Number(upStar))}if(nextAttrConfig){if(nextAttrConfig.attrAward){this.nextAttrLabel.text=AttributeData.getAttStr(this.getAttrArray(nextAttrConfig.attrAward),1)}else{this.nextAttrLabel.text=""}}this.expBarChange();if(attrConfig.attrAward){this.setLayoutAttr(attrConfig);var point=UserBag.getAttrPower(attrConfig.attrAward);this.powerPanel.setPower(point)}else{this.setLayoutAttr(attrConfig,true);this.attrLabel.text="";this.powerPanel.setPower(0)}};RingInfoView.prototype.warnShow=function(){if(!this.canUpdate){var attrConfig=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level);UserTips.ins().showTips(i18n("RingInfoView_21",GlobalConfig.ItemConfig[attrConfig.costItem].name));return}var config=GlobalConfig.ActorExRingConfig[this.currData.id];if(!(Actor.level>=config.needLevel&&UserZs.ins().lv>=config.needZs)){var info1=config.needZs>0?config.needZs+i18n("RingInfoView_22"):"";var info2=config.needLevel>0?config.needLevel+i18n("RingInfoView_23"):"";UserTips.ins().showTips(i18n("RingInfoView_24",info1,info2))}SpecialRing.ins().sendSpicelRingUpdate(this.currData.id)};RingInfoView.prototype.stopAutoUp=function(){this.isAutoUp=false;TimerManager.ins().remove(this.autoUpStar,this)};RingInfoView.prototype.autoUpStar=function(){var attrConfig=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level);var count=UserBag.ins().getBagGoodsCountById(0,attrConfig.costItem);if(count){SpecialRing.ins().sendSpicelRingUpdate(this.currData.id)}else{this.isAutoUp=false;TimerManager.ins().remove(this.autoUpStar,this)}};RingInfoView.prototype.expBarChange=function(){var attrConfig=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level);var maxExp=attrConfig.upPower;var curExp=this.currData.exp;if(!SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1)){curExp=maxExp}else{curExp=this.currData.exp>maxExp?maxExp:this.currData.exp}if(this.barbc.getMaxValue()!=maxExp){this.barbc.setData(curExp,maxExp)}else{this.barbc.setValue(curExp)}};RingInfoView.prototype.countStrDesc=function(config){var configLevel=this.currData.level==0?1:this.currData.level;var attrConfig=SpecialRing.ins().getRingConfigById(this.currData.id,configLevel);var arr=config.explain.split("$");var str="";if(arr.length>0){for(var i=0;i<arr.length;i++){if(Number(arr[i])){var num=Number(arr[i]);var tempConfig=void 0;if(num/200>=1){tempConfig=attrConfig.extAttrAward}else{tempConfig=attrConfig.attrAward}for(var k in tempConfig){if(tempConfig[k].type==num%100){if(num>200){str+=AttributeData.getExtAttStrByType(tempConfig[k],0,"",false,false)}else{str+=AttributeData.getAttStrByType(tempConfig[k],0,"",false,false)}break}}}else{str+=arr[i]}}}else{str=config.explain}return str};return RingInfoView}(BaseEuiView);__reflect(RingInfoView.prototype,"RingInfoView");ViewManager.ins().reg(RingInfoView,LayerManager.UI_Main);var RingTurnDisplayer=function(_super){__extends(RingTurnDisplayer,_super);function RingTurnDisplayer(){var _this=_super.call(this)||this;_this.gAngle=180;_this.gHasReset=true;_this.gInitPos=true;_this.isMaxX=false;_this.isMaxY=false;_this.gemPos1=[64,-52,-68,-80,-84,-80,-64,-90,-50,-100,40,-110,64,-80,64,-52];_this.mc=new MovieClip;_this.gFollowItem=new egret.DisplayObjectContainer;_this.addChild(_this.gFollowItem);_this.gCenterPos=new egret.Point;_this.gTurnItem=new egret.DisplayObjectContainer;_this.gTurnItem.addChild(_this.mc);_this.gFollowItem.addChild(_this.gTurnItem);TimerManager.ins().doTimer(20,0,_this.update,_this);return _this}RingTurnDisplayer.prototype.setOwner=function(player){this.gOwner=player;this.gTurnTime=1e4+1e4*Math.random()+egret.getTimer();this.gAngle=RingTurnDisplayer.STAR_ANGLE;this.gStopTime=0};RingTurnDisplayer.prototype.update=function(){if(this.gInitPos){this.gFollowItem.x=RingTurnDisplayer.TARGET_POINT_X;this.gFollowItem.y=RingTurnDisplayer.TARGET_POINT_Y-this.gOwner.height;this.gInitPos=false}else{this.gFollowItem.x=this.gFollowItem.x-(this.gOwner.x-this.gOwnerLastX);this.gFollowItem.y=this.gFollowItem.y-(this.gOwner.y-this.gOwnerLastY)}this.gCenterPos=new egret.Point(this.effectX,this.effectY);this.moveCenterPoint();this.gOwnerLastX=this.gOwner.x;this.gOwnerLastY=this.gOwner.y};RingTurnDisplayer.prototype.setEffectXY=function(dir){var sx=this.gemPos1[dir*2];var sy=this.gemPos1[dir*2+1];this.effectX=sx+Math.ceil(100*Math.random()-50);this.effectY=sy+Math.ceil(100*Math.random()-50)};RingTurnDisplayer.prototype.moveCenterPoint=function(){var _local1;var _local2=this.gCenterPos.x-this.gFollowItem.x;if(_local2!=0){if(Math.abs(_local2)>RingTurnDisplayer.MAX_DIS){_local1=Math.ceil(Math.abs(_local2)*RingTurnDisplayer.SPEED_RATIO)*2*3/2;if(_local2>0){if(_local2>_local1)this.gFollowItem.x=this.gFollowItem.x+_local1}else if(_local2<0){if(Math.abs(_local2)>_local1)this.gFollowItem.x=this.gFollowItem.x-_local1}}else{this.isMaxX=false;_local1=Math.ceil(Math.abs(_local2)*RingTurnDisplayer.SPEED_RATIO)*3/2*1.35;if(_local2>0){if(_local2>_local1)this.gFollowItem.x=this.gFollowItem.x+_local1}else if(_local2<0){if(Math.abs(_local2)>_local1)this.gFollowItem.x=this.gFollowItem.x-_local1}}}var _local3=this.gCenterPos.y-this.gFollowItem.y;if(_local3!=0){if(Math.abs(_local3)>RingTurnDisplayer.MAX_DIS){_local1=Math.ceil(Math.abs(_local3)*RingTurnDisplayer.SPEED_RATIO)*2*3/2;if(_local3>=0){if(_local3>_local1)this.gFollowItem.y=this.gFollowItem.y+_local1}else if(_local3<0){if(Math.abs(_local3)>_local1)this.gFollowItem.y=this.gFollowItem.y-_local1}}else{this.isMaxY=false;_local1=Math.ceil(Math.abs(_local3)*RingTurnDisplayer.SPEED_RATIO)*3/2*1.35;if(_local3>=0){if(_local3>_local1)this.gFollowItem.y=this.gFollowItem.y+_local1}else if(_local3<0){if(Math.abs(_local3)>_local1)this.gFollowItem.y=this.gFollowItem.y-_local1}}}};RingTurnDisplayer.prototype.setModel=function(id,infoModel,topContainer){this.infomodel=infoModel;if(infoModel.masterHandle&&infoModel.masterHandle==Actor.handle){if(id<0||id==null)return;if(EntityManager.ins().getMainRole(0)&&EntityManager.ins().getMainRole(0).infoModel.handle!=infoModel.handle)return}if(infoModel.masterHandle&&SpecialRing.ins().hasHanlder(infoModel.masterHandle)){if(this.lastID!=id){this.showRing(id);this.lastID=id}return}this.showRing(id);topContainer.addChild(this)};RingTurnDisplayer.prototype.showRing=function(id){this.mc.alpha=1;this.ringInfo=GlobalConfig.ActorExRingConfig[id];var monConfig=GlobalConfig.MonstersConfig[this.ringInfo.avatarFileName];this.mc.playFile(RES_DIR_MONSTER+"monster"+monConfig.avatar+"_0a",-1)};RingTurnDisplayer.prototype.reset=function(){if(this.mc){DisplayUtils.removeFromParent(this.mc)}SpecialRing.ins().delHanlder(this.infomodel.masterHandle);this.gOwnerLastX=0;this.gOwnerLastY=0;this.gCenterPos.x=0;this.gCenterPos.y=0;this.gHasReset=true;this.gInitPos=true;this.gModelUrl="";TimerManager.ins().removeAll(this)};RingTurnDisplayer.TARGET_POINT_X=95;RingTurnDisplayer.TARGET_POINT_Y=-40;RingTurnDisplayer.MAX_DIS=60;RingTurnDisplayer.STAR_ANGLE=0;RingTurnDisplayer.SPEED_RATIO=.015;return RingTurnDisplayer}(egret.DisplayObjectContainer);__reflect(RingTurnDisplayer.prototype,"RingTurnDisplayer");var RingUpgradeWin=function(_super){__extends(RingUpgradeWin,_super);function RingUpgradeWin(){var _this=_super.call(this)||this;_this.skinName="LYRUltraSkin";_this.isTopLevel=true;return _this}RingUpgradeWin.prototype.addBossImg=function(id){this.ring0eff.removeChildren();this.bossImage=new MovieClip;this.bossImage.scaleX=-1;this.bossImage.scaleY=1;this.bossImage.x=this.ring0eff.width/2;this.bossImage.y=115;this.ring0eff.addChild(this.bossImage);var monster=GlobalConfig.MonstersConfig[id];this.bossImage.playFile(RES_DIR_MONSTER+("monster"+monster.avatar+"_3s"),-1)};RingUpgradeWin.prototype.addNextBossImg=function(id){this.ring1eff.removeChildren();this.nextBossImage=new MovieClip;this.nextBossImage.scaleX=-1;this.nextBossImage.scaleY=1;this.nextBossImage.x=this.ring1eff.width/2;this.nextBossImage.y=115;this.ring1eff.addChild(this.nextBossImage);var monster=GlobalConfig.MonstersConfig[id];this.nextBossImage.playFile(RES_DIR_MONSTER+("monster"+monster.avatar+"_3s"),-1)};RingUpgradeWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.colorCanvas,this.otherClose);this.addTouchEvent(this.closeBtn,this.otherClose);this.addTouchEvent(this.useBtn,this.onBtnUse);this.observe(UserBag.ins().postItemAdd,this.update);this.observe(UserBag.ins().postItemDel,this.update);this.observe(UserBag.ins().postItemChange,this.update);this.update()};RingUpgradeWin.prototype.update=function(){var abilityId=SpecialRing.ins().getAbilityID();if(abilityId==0)abilityId=1;var lv=SpecialRing.ins().abilityIds[abilityId];var cv=!lv?1:lv;var cfg=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID][abilityId][cv];var monId=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID].monsterId;var nextMonId=monId+cfg.monId;this.abilityDesc.textFlow=TextFlowMaker.generateTextFlow(cfg.abilityDesc);this.level.text=lv?i18n("RingUpgradeWin_2",lv):"";this.addBossImg(monId);this.addNextBossImg(nextMonId);this.showItem()};RingUpgradeWin.prototype.showItem=function(){var id=GlobalConfig.ActorExRingCommon.ExRingItem;var cfg=GlobalConfig.ItemConfig[id];if(!cfg){return}this.itemName.text=this.itemName2.text=cfg.name+":";var isHave=UserBag.ins().getBagGoodsCountById(0,id);if(isHave>0){this.itemNum.textFlow=TextFlowMaker.generateTextFlow(i18n("RingUpgradeWin_0",isHave))}else{this.itemNum.textFlow=TextFlowMaker.generateTextFlow(i18n("RingUpgradeWin_1",isHave))}};RingUpgradeWin.prototype.onBtnUse=function(){var id=GlobalConfig.ActorExRingCommon.ExRingItem;if(!SpecialRing.ins().checkCanUseByItem(id)){UserTips.ins().showTips(i18n("ItemUseTipsWin_3"));ViewManager.ins().close(this);return}var cfg=GlobalConfig.ItemConfig[id];if(UserBag.ins().sendUseItem(id,1)||cfg.split){ViewManager.ins().close(this)}};RingUpgradeWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};return RingUpgradeWin}(BaseEuiView);__reflect(RingUpgradeWin.prototype,"RingUpgradeWin");ViewManager.ins().reg(RingUpgradeWin,LayerManager.UI_Popup);var SpecialRingShow=function(_super){__extends(SpecialRingShow,_super);function SpecialRingShow(){var _this=_super.call(this)||this;_this.ringLv=0;_this.skinName="RingShowtips";return _this}SpecialRingShow.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.iconMc=new MovieClip;this.iconMc.x=170;this.iconMc.y=160};SpecialRingShow.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.index=param[0];if(this.iconMc&&!this.iconMc.parent)this.mcGroup.addChild(this.iconMc);this.addTouchEvent(this.bgClose,this.onTap);this.showData();if(this.height0==null){this.height0=this["attr"+0].parent.height}};SpecialRingShow.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.colorCanvas0,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);DisplayUtils.removeFromParent(this.iconMc)};SpecialRingShow.prototype.onTap=function(e){switch(e.currentTarget){case this.colorCanvas0:case this.bgClose:ViewManager.ins().close(this);break}};SpecialRingShow.prototype.showIcon=function(){var effSoure=this.index?"hushen":"mabi";this.iconMc.playFile(RES_DIR_EFF+effSoure,-1)};SpecialRingShow.prototype.showData=function(isUpgrade){if(isUpgrade===void 0){isUpgrade=false}this.ringLv=1;this.showIcon();var config=GlobalConfig.ExRingConfig[this.index];var ringConfig=GlobalConfig["ExRing"+this.index+"Config"][this.ringLv];this.labelLevel.text=this.ringLv.toString()+i18n("SpecialRingShow_0");var power=0;if(ringConfig){var attName="";var value=0;var i=0;var index=0;var str="";var attrAward=ringConfig.attrAward;var attrLen=attrAward.length;for(var j=0;j<attrLen;j++){i=attrAward[j].type;if(i==15||i==13)continue;attName=AttributeData.getAttrStrByType(i);value=attrAward[j].value;if(attName.length<3)attName=AttributeData.inserteBlank(attName,7);this["attr"+index].text=attName+"：";if(i>1&&i<9||i==26||i==31){if(i==7||i==8){str=value/100+"%"}else{str=value.toString()}}else if(i>12&&i<15||i>15){if(i==AttributeType.atCritEnhance)str=value/100+150+"%";else str=value/100+"%"}this["value"+index].text=str;index++}if(index==4){this["attr"+0].parent.height=this.height0-50}else{this["attr"+0].parent.height=this.height0}for(;index<7;++index){this["attr"+index].text="";this["value"+index].text=""}power=UserBag.getAttrPower(ringConfig.attrAward);power+=ringConfig.power;this.powerPanel.setPower(power);this.powerPanel.setMcVisible(false);var itemCfg=GlobalConfig.ItemConfig[config.costItem];this.specialAttr.textFlow=TextFlowMaker.generateTextFlow1(itemCfg.desc);this.nameLabel.text=""+config.name}};SpecialRingShow.prototype.getPower=function(){if(this.currentState=="actived"){return this.powerPanel.power}return 0};return SpecialRingShow}(BaseEuiView);__reflect(SpecialRingShow.prototype,"SpecialRingShow");ViewManager.ins().reg(SpecialRingShow,LayerManager.UI_Main);var SpecialRingWin=function(_super){__extends(SpecialRingWin,_super);function SpecialRingWin(){var _this=_super.call(this)||this;_this.ringLv=0;_this.skinName="RingTips";return _this}SpecialRingWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.iconMc=new MovieClip;this.iconMc.x=170;this.iconMc.y=160;this.gainList0.itemRenderer=RingGainItem};SpecialRingWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.index=param[0];if(param[1]==null)param[1]=0;this.roleSelect.setCurRole(param[1]);if(this.iconMc&&!this.iconMc.parent)this.mcGroup.addChild(this.iconMc);this.addTouchEvent(this.btnUse,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.gainList0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.addSpecialListener();this.observe(UserBag.ins().postItemAdd,this.roleChange);this.observe(UserBag.ins().postItemChange,this.roleChange);this.observe(Actor.ins().postPowerChange,this.refreshPower);var config=GlobalConfig.ExRingConfig[this.index];var gainConfig=GlobalConfig.GainItemConfig[config.costItem];this.gainList0.dataProvider=new eui.ArrayCollection(gainConfig.gainWay);if(this.height0==null){this.height0=this["attr"+0].parent.height}this.roleChange()};SpecialRingWin.prototype.refreshPower=function(){this.roleSelect.refreshPower(this.roleSelect._curRole)};SpecialRingWin.prototype.addSpecialListener=function(){this.observe(SpecialRing.ins().postRingUpdate,this.roleChange)};SpecialRingWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.colorCanvas0,this.onTap);this.removeTouchEvent(this.btnUse,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.gainList0.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);DisplayUtils.removeFromParent(this.iconMc);this.removeObserve()};SpecialRingWin.prototype.onTouchList=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2],true)}};SpecialRingWin.prototype.onTap=function(e){switch(e.currentTarget){case this.colorCanvas0:case this.bgClose:ViewManager.ins().close(this);break;case this.btnUse:var select=this.roleSelect.getCurRole();this.ringLv=SubRoles.ins().getSubRoleByIndex(select).getExRingsData(this.index);var config=GlobalConfig.ExRingConfig[this.index];var ringConfig=GlobalConfig["ExRing"+this.index+"Config"][this.ringLv];var itemCount=UserBag.ins().getBagGoodsCountById(0,config.costItem);if(itemCount<ringConfig.cost){this.openBuyGoods()}else{this.sendUpgrade()}break}};SpecialRingWin.prototype.showIcon=function(){var effSoure=this.index?"hushen":"mabi";this.iconMc.playFile(RES_DIR_EFF+effSoure,-1)};SpecialRingWin.prototype.roleChange=function(isUpgrade){if(isUpgrade===void 0){isUpgrade=false}this.setRedPoint();var select=this.roleSelect.getCurRole();this.ringLv=SubRoles.ins().getSubRoleByIndex(select).getExRingsData(this.index);this.showIcon();var config=GlobalConfig.ExRingConfig[this.index];var ringConfigArr=GlobalConfig["ExRing"+this.index+"Config"];var ringConfig=ringConfigArr[this.ringLv];var ringNextConfig=ringConfigArr[this.ringLv+1];var itemCount=UserBag.ins().getBagGoodsCountById(0,config.costItem);if(this.ringLv==0){var len=CommonUtils.getObjectLength(ringConfigArr);if(itemCount<ringConfig.cost){this.currentState="lock"}else{this.currentState="active"}this.validateNow();this.tips.source="tjweijihuo";this.labelUserItemCount.visible=this.labelUpgradeCost.visible=this.labelLevel.visible=false}else{this.currentState="actived";this.validateNow();this.tips.source="tjyijihuo";this.labelUserItemCount.visible=this.labelUpgradeCost.visible=this.labelLevel.visible=ringNextConfig!=null;this.labelLevel.text=this.ringLv.toString()+i18n("SpecialRingWin_0");this.labelUserItemCount.text=itemCount.toString();this.labelUserItemCount.textColor=itemCount>=ringConfig.cost?242004:15937822;this.labelUpgradeCost.text="/"+ringConfig.cost}this.btnUse.visible=ringNextConfig!=null;var power=0;if(ringConfig){var attName="";var value=0;var i=0;var index=0;var str="";var attrAward=ringConfig.attrAward;if(this.ringLv==0){attrAward=ringNextConfig.attrAward}var attrLen=attrAward.length;for(var j=0;j<attrLen;j++){i=attrAward[j].type;if(i==15||i==13)continue;attName=AttributeData.getAttrStrByType(i);value=attrAward[j].value;if(attName.length<3)attName=AttributeData.inserteBlank(attName,7);this["attr"+index].text=attName+"：";if(i>1&&i<9||i==26||i==31){if(i==7||i==8){str=value/100+"%"}else{str=value.toString()}}else if(i>12&&i<15||i>15){if(i==AttributeType.atCritEnhance)str=value/100+150+"%";else str=value/100+"%"}this["value"+index].text=str;index++}if(index==4){this["attr"+0].parent.height=this.height0-50}else{this["attr"+0].parent.height=this.height0}for(;index<7;++index){this["attr"+index].text="";this["value"+index].text=""}power=UserBag.getAttrPower(ringConfig.attrAward);power+=ringConfig.power}this.powerPanel.setPower(power);this.powerPanel.setMcVisible(true);var itemCfg=GlobalConfig.ItemConfig[config.costItem];this.specialAttr.textFlow=TextFlowMaker.generateTextFlow1(ringConfig.desc);this.nameLabel.text=""+config.name};SpecialRingWin.prototype.sendUpgrade=function(){SpecialRing.ins().sendUpGrade(this.index,this.roleSelect.getCurRole())};SpecialRingWin.prototype.openBuyGoods=function(){UserWarn.ins().setBuyGoodsWarn(GlobalConfig.ExRingConfig[this.index].costItem)};SpecialRingWin.prototype.setRedPoint=function(){var len=SubRoles.ins().subRolesLen;for(var index=0;index<len;index++){var role=SubRoles.ins().getSubRoleByIndex(index);this.roleSelect.showRedPoint(index,UserRole.ins().roleHintCheck(role,this.index))}};SpecialRingWin.prototype.getPower=function(){if(this.currentState=="actived"){return this.powerPanel.power}return 0};return SpecialRingWin}(BaseEuiView);__reflect(SpecialRingWin.prototype,"SpecialRingWin");ViewManager.ins().reg(SpecialRingWin,LayerManager.UI_Main);var FireRingAbilityItem=function(_super){__extends(FireRingAbilityItem,_super);function FireRingAbilityItem(){return _super!==null&&_super.apply(this,arguments)||this}FireRingAbilityItem.prototype.dataChanged=function(){var index=this.data;var cfg=GlobalConfig.ActorExRingAbilityConfig[index];this.nameTxt.text=cfg.abilityName;this.descLabel.textFlow=TextFlowMaker.generateTextFlow(cfg.abilityDesc);this.imgIcon.source=cfg.abilityIcon;var ringData=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);var stage=SpecialRing.ins().getRingStair(ringData.level);if(stage>=cfg.ringLv){this.stateLabel.text=""}else{this.stateLabel.text="("+SpecialRing.ins().getUnLockStage(index)+i18n("FireRingAbilityItem_0");this.stateLabel.textColor=ColorUtil.RED_COLOR_N}};return FireRingAbilityItem}(ItemRenderer);__reflect(FireRingAbilityItem.prototype,"FireRingAbilityItem");var FireRingFb=function(_super){__extends(FireRingFb,_super);function FireRingFb(){var _this=_super.call(this)||this;_this.isUse=false;_this.name=i18n("FireRingFb_0");return _this}FireRingFb.prototype.open=function(){if(this.exrewardList){this.exrewardList.itemRenderer=ItemBase}this.addTouchEvent(this,this.onTap);this.observe(UserFb.ins().postFbRingInfo,this.onUpdate);this.observe(UserBag.ins().postItemCountChange,this.UseToItem);this.onUpdate()};FireRingFb.prototype.close=function(){this.removeTouchEvent(this,this.onTap);this.removeObserve();DisplayUtils.removeFromParent(this.eff);this.eff=null};FireRingFb.prototype.onUpdate=function(){this.isUse=false;var fbExp=UserFb.ins().fbRings;var index=0;if(fbExp.canTakeAward){index=1;this.currentState="free"}else if(Recharge.ins().franchise){if(UserFb.ins().fbRings.challengeTime>0){this.currentState="sdget";index=1}else{this.currentState="sdfb";index=0}}else{index=0;this.currentState="challenge"}this.validateNow();this.onInitIndex(index);this.showExRewardList()};FireRingFb.prototype.showExRewardList=function(){if(this.exrewardList){var rewardList=[];var config=GlobalConfig.ActorExRing7Config;var lvl=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level;var showgroup=config[lvl].extraRewardshow;for(var _i=0,showgroup_1=showgroup;_i<showgroup_1.length;_i++){var i=showgroup_1[_i];rewardList.push(i)}this.exrewardList.dataProvider=new eui.ArrayCollection(rewardList)}};FireRingFb.prototype.UseToItem=function(){if(this.isUse){this.isUse=false;UserFb.ins().sendChallengeFbRing()}};FireRingFb.prototype.getChangeNum=function(lv){if(lv==undefined)lv=UserVip.ins().lv;var count=GlobalConfig.ActorExRingFubenConfig.freeCount;return(GlobalConfig.ActorExRingFubenConfig.vipCount[lv]||0)+count};FireRingFb.prototype.onInitIndex=function(index){var fbExp=UserFb.ins().fbRings;var awards=GlobalConfig.ActorExRingFubenConfig.reward;var exp=awards[0].count;if(index==0){this.lbTime.text=i18n("FireRingFb_2",fbExp.challengeTime);this.lbExp.text=""+exp;if(fbExp.challengeTime){this.btnChallenge.enabled=true}else{var curTime=this.getChangeNum();var nextLv=UserVip.ins().lv+1;var nextTime=this.getChangeNum(nextLv);while(nextTime!=undefined&&nextTime>=curTime){nextLv+=1;nextTime=this.getChangeNum(nextLv);if(GlobalConfig.ActorExRingFubenConfig.vipCount[nextLv]==undefined){break}}if(nextTime-curTime>0){this.lbTime.text=i18n("FireRingFb_3",nextLv,nextTime-curTime)}}}else if(index==1){var recPrice=GlobalConfig.ActorExRingFubenConfig.recPrice;var index_4=0;for(var i in recPrice){this["lbExp"+index_4].textFlow=TextFlowMaker.generateTextFlow1("  "+exp*(+i+1));var needGold=GlobalConfig.ActorExRingFubenConfig.recPrice[i];this["gold"+index_4].setPrice(needGold);index_4+=1}if(Recharge.ins().franchise)this.lbSweepTime.text=i18n("FireRingFb_4",fbExp.challengeTime);if(Setting.ins().getValue(ClientSet.expFirst)==0){if(!this.eff){this.eff=new MovieClip;this.eff.scaleX=.75;this.eff.scaleY=.75;this.eff.touchEnabled=false;this.eff.x=this.btnGet2.x+this.btnGet2.width/2;this.eff.y=this.btnGet2.y+this.btnGet2.height/2;this.eff.playFile(RES_DIR_EFF+"chargeff1",-1);this.g2.addChild(this.eff)}}if(Actor.level<80){this.g1.visible=this.g2.visible=false;this.g0.horizontalCenter=0}else{this.g1.visible=this.g2.visible=true}}};FireRingFb.prototype.onTap=function(e){var tar=e.target;var fbExp=UserFb.ins().fbRings;if(this.checkBtnGet(tar)){}else if(tar==this.btnChallenge){if(UserFb.ins().checkInFB())return;if(fbExp.challengeTime<=0){var tipText="";var item_8=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,ItemConst.FIRE_FB);if(item_8){tipText=i18n("FireRingFb_5",item_8.itemConfig.name);WarnWin.show(tipText,function(){this.isUse=true;UserBag.ins().sendUseItem(item_8.configID,1)},this);return}if(fbExp.buyTime<(GlobalConfig.ActorExRingFubenConfig.vipCount[UserVip.ins().lv]||0)){tipText=i18n("FireRingFb_6",GlobalConfig.ActorExRingFubenConfig.vipcost);WarnWin.show(tipText,function(){UserFb.ins().sendChallengeFbRing()},this);return}tipText=i18n("FireRingFb_7");UserTips.ins().showTips(tipText);return}UserFb.ins().sendChallengeFbRing()}};FireRingFb.prototype.checkBtnGet=function(tar){var index=0;if(tar==this.btnGet0){index=1}else if(tar==this.btnGet1){index=2}else if(tar==this.btnGet2){index=3}if(index>0){var cost=GlobalConfig.ActorExRingFubenConfig.recPrice[index-1];if(Actor.yb<cost){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("FireRingFb_8"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("FireRingFb_9"));return}var fbRings=UserFb.ins().fbRings;if(fbRings.canTakeAward){UserFb.ins().sendFbRingTakeAward(index)}else if(Recharge.ins().franchise){UserFb.ins().sendRingSweep(index)}else{UserFb.ins().sendFbRingTakeAward(index)}}return index>0};return FireRingFb}(BaseView);__reflect(FireRingFb.prototype,"FireRingFb");var FireRingSkillBookItem=function(_super){__extends(FireRingSkillBookItem,_super);function FireRingSkillBookItem(){var _this=_super.call(this)||this;_this.isOpenSelectImg=true;_this.addEventListener(egret.Event.REMOVED_FROM_STAGE,_this.onRemove,_this);return _this}FireRingSkillBookItem.prototype.init=function(){};FireRingSkillBookItem.prototype.dataChangeHandler=function(){var count=this.data.count;if(count>0){this.itemIcon.imgIcon.filters=null;this.itemIcon.imgBg.filters=null}else{this.itemIcon.imgIcon.filters=FilterUtil.ARRAY_GRAY_FILTER;this.itemIcon.imgBg.filters=FilterUtil.ARRAY_GRAY_FILTER}};FireRingSkillBookItem.prototype.onRemove=function(){if(this.itemIcon){this.itemIcon.imgIcon.filters=null;this.itemIcon.imgBg.filters=null}};return FireRingSkillBookItem}(ItemBase);__reflect(FireRingSkillBookItem.prototype,"FireRingSkillBookItem");var MapGridNode=function(){function MapGridNode(){}Object.defineProperty(MapGridNode.prototype,"hidden",{get:function(){return(this.flags&1<<1)>0},enumerable:true,configurable:true});Object.defineProperty(MapGridNode.prototype,"walkable",{get:function(){return(this.flags&1<<0)>0},enumerable:true,configurable:true});MapGridNode.FLAG_WALKABLE=32768;MapGridNode.FLAG_HIDDEN=16384;return MapGridNode}();__reflect(MapGridNode.prototype,"MapGridNode");var RingGainItem=function(_super){__extends(RingGainItem,_super);function RingGainItem(){var _this=_super.call(this)||this;_this.skinName="RuneGainTipsItemSkin";return _this}RingGainItem.prototype.dataChanged=function(){this.desc.text=this.data[0]};Object.defineProperty(RingGainItem.prototype,"userData",{get:function(){return this.data},enumerable:true,configurable:true});return RingGainItem}(BaseItemRender);__reflect(RingGainItem.prototype,"RingGainItem");var SpecialRingItem=function(_super){__extends(SpecialRingItem,_super);function SpecialRingItem(){var _this=_super.call(this)||this;_this.skinName="ringtogglebtn";return _this}SpecialRingItem.prototype.dataChanged=function(){var config=GlobalConfig.ActorExRingConfig[this.data.id];if(!config){return}this.addEvent();this.ringNameTxt.text=config.name;this.levelTxt.visible=this.textBg.visible=false;if(this.data.level>0){this.openLv.text="";this.noopen.visible=false;this.ringicon.source=config.icon}else{this.noopen.visible=true;this.ringicon.source=config.icon+"a";if(this.data.order==6){this.openLv.text=i18n("SpecialRingItem_1")}else if(config.openItem.count>0){this.openLv.text=i18n("SpecialRingItem_7")}else{this.openLv.text=i18n("SpecialRingItem_6")}}this.updateRedPoint()};SpecialRingItem.prototype.addEvent=function(){if(this.isAddEvent){return}this.isAddEvent=true;MessageCenter.addListener(UserBag.ins().postItemAdd,this.updateRedPoint,this);MessageCenter.addListener(UserBag.ins().postItemDel,this.updateRedPoint,this);MessageCenter.addListener(UserBag.ins().postItemCountChange,this.updateRedPoint,this);MessageCenter.addListener(UserVip.ins().postUpdateVipData,this.updateRedPoint,this);MessageCenter.addListener(SpecialRing.ins().postActiveRing,this.updateRedPoint,this);this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)};SpecialRingItem.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);this.destruct()};SpecialRingItem.prototype.destruct=function(){MessageCenter.ins().removeAll(this);this.isAddEvent=false};SpecialRingItem.prototype.updateRedPoint=function(){if(this.data.level>0){this.actTxt.visible=false}else{if(this.data.id==SpecialRing.FIRE_RING_ID){this.actTxt.visible=SpecialRing.ins().isFireRingCanActivate()}else{this.actTxt.visible=SpecialRing.ins().checkCanActive(this.data.id)}}this.openLv.visible=!this.actTxt.visible;this.redPoint.visible=SpecialRing.ins().checkRedPoint(this.data.id,this.data.level)};return SpecialRingItem}(BaseItemRender);__reflect(SpecialRingItem.prototype,"SpecialRingItem");var StudySkillNeedItem=function(){function StudySkillNeedItem(){}StudySkillNeedItem.prototype.setData=function(itemId){var cfg=GlobalConfig.ItemConfig[itemId];this.itemIcon.setData(cfg);this.nameTxt.text=cfg.name};return StudySkillNeedItem}();__reflect(StudySkillNeedItem.prototype,"StudySkillNeedItem");var LyMarkEffect=function(){function LyMarkEffect(ring,infoModel){this._angle=.1;this._angles=[0,0,0,0,0,0,0];this._circleCenter={x:0,y:-72};this._a=60;this._b=30;this._oldBallNum=0;this._curTimes=0;this._isShowBall=true;this._ring=ring;this._infoModel=infoModel;MessageCenter.addListener(LyMark.ins().postMarkData,this.dataChange,this);this.usedLyMarkSkill()}LyMarkEffect.prototype.dataChange=function(){if(!this._infoModel||this._infoModel.masterHandle!=Actor.handle)return;this.update()};Object.defineProperty(LyMarkEffect.prototype,"_parent",{get:function(){return this._ring.parent},enumerable:true,configurable:true});LyMarkEffect.prototype.usedLyMarkSkill=function(){this.resetBalls();TimerManager.ins().removeAll(this);var lv=this.getSkillLvById(1);if(!lv)return;var cfg=GlobalConfig.FlameStampEffect[1][lv];lv=this.getSkillLvById(3);var mCd=lv?GlobalConfig.FlameStampEffect[3][lv].reloadTime:0;var skillID=cfg.skillId;var count=cfg.stamp;if(this.getSkillLvById(2)){lv=this.getSkillLvById(2);skillID=GlobalConfig.FlameStampEffect[2][lv].skillId;count=GlobalConfig.FlameStampEffect[2][lv].stamp}var skillDes=GlobalConfig.SkillsDescConfig[GlobalConfig.SkillsConfig[skillID].desc];var cdPer=(skillDes.cd-mCd)/count>>0;TimerManager.ins().doTimer(cdPer,count,this.doTimer,this);this._curTimes=0};LyMarkEffect.prototype.doTimer=function(){this._curTimes++;this.updateBalls(this._curTimes)};LyMarkEffect.prototype.update=function(){var skillLv,effectCfg;var bollNum=0,realLv=0;for(var i=0;i<=6;i++){realLv=skillLv=this.getSkillLvById(i+1);if(!skillLv)skillLv=1;effectCfg=GlobalConfig.FlameStampEffect[i+1][skillLv];if((i+1==1||i+1==2)&&realLv)bollNum=effectCfg.stamp}this.updateBalls(bollNum)};LyMarkEffect.prototype.updateBalls=function(bollNum){if(!this._ring||!this._parent)return;if(bollNum&&this._oldBallNum!=bollNum){this.resetBalls();this._oldBallNum=bollNum;if(!this._balls){this._balls=[];TimerManager.ins().doTimer(17*3,0,this.doCircle,this)}var ball=void 0;var radian=2*Math.PI/bollNum;for(var i=0;i<bollNum;i++){ball=ObjectPool.pop("MovieClip");if(this._isShowBall)this._parent.addChild(ball);this._angles[i]=radian*i;ball.x=this._a*Math.cos(radian*i)+this._circleCenter.x;ball.y=this._b*Math.sin(radian*i)+this._circleCenter.y;this._balls.push(ball);ball.playFile(RES_DIR_SKILLEFF+"skill6204a",-1)}}};LyMarkEffect.prototype.doCircle=function(){if(!this._balls){TimerManager.ins().remove(this.doCircle,this);return}if(!this._isShowBall)return;if(!this._ring||!this._parent)return;var len=this._balls.length,ball;var parent;var imgIndex=0,selfIndex=0;for(var i=0;i<len;i++){ball=this._balls[i];ball.x=this._a*Math.cos(this._angles[i])+this._circleCenter.x;ball.y=this._b*Math.sin(this._angles[i])+this._circleCenter.y;this._angles[i]+=this._angle;this._angles[i]=this._angles[i]%(2*Math.PI);parent=ball.parent;imgIndex=parent.getChildIndex(this._ring);selfIndex=parent.getChildIndex(ball);if(this._angles[i]>=2.5&&this._angles[i]<=6){if(selfIndex>imgIndex)parent.addChildAt(ball,imgIndex)}else{if(selfIndex<imgIndex)parent.addChildAt(ball,parent.numChildren)}}};LyMarkEffect.prototype.resetBalls=function(){TimerManager.ins().remove(this.doCircle,this);this._oldBallNum=0;if(this._balls){var len=this._balls.length;for(var i=0;i<len;i++){this._balls[i].destroy()}this._balls=null}};LyMarkEffect.prototype.getSkillLvById=function(id){var skills=this._infoModel.masterHandle==Actor.handle?LyMark.ins().skills:this._infoModel.lyMarkSkills;if(!skills||skills.length<id)return 0;return skills[id-1]};LyMarkEffect.prototype.getLyMarkLv=function(){return this._infoModel.masterHandle==Actor.handle?LyMark.ins().lyMarkLv:this._infoModel.lyMarkLv};LyMarkEffect.prototype.showBall=function(){if(this._isShowBall)return;this._isShowBall=true;this.updateBalls(this._curTimes);if(this._balls){var len=this._balls.length;for(var i=0;i<len;i++){this._parent.addChild(this._balls[i])}}};LyMarkEffect.prototype.hideBall=function(){if(!this._isShowBall)return;this._isShowBall=false;this.resetBalls()};LyMarkEffect.prototype.destruct=function(){this.resetBalls();TimerManager.ins().removeAll(this);this._ring=null;this._infoModel=null;MessageCenter.ins().removeAll(this)};return LyMarkEffect}();__reflect(LyMarkEffect.prototype,"LyMarkEffect");var LyMarkMixItemRender=function(_super){__extends(LyMarkMixItemRender,_super);function LyMarkMixItemRender(){var _this=_super.call(this)||this;_this.skinName="markMixItemSkin";return _this}LyMarkMixItemRender.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.MixBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};LyMarkMixItemRender.prototype.dataChanged=function(){var hasCost=this.data.cfg.costItem;this.limitLv.textFlow=TextFlowMaker.generateTextFlow1(this.data.cfg.mixDesc);this.cost.textFlow=TextFlowMaker.generateTextFlow1(hasCost?i18n("LyMarkMixItemRender_0")+i18n("LyMarkMixItemRender_6",this.data.count?242004:5375653,this.data.itemName,this.data.cfg.costCount):"");this.stock.textFlow=TextFlowMaker.generateTextFlow1(i18n("LyMarkMixItemRender_2",this.data.itemCount?242004:5375653,this.data.itemCount));this.MixBtn.label=hasCost?i18n("LyMarkMixItemRender_3"):i18n("LyMarkMixItemRender_4");this.MixBtn.enabled=!hasCost||LyMark.ins().lyMarkLv>=this.data.cfg.limitLv;this.redpoint.visible=hasCost&&LyMark.ins().lyMarkLv>=this.data.cfg.limitLv&&this.data.count>=this.data.cfg.costCount;this.itemIcon.data=this.data.cfg.itemId};LyMarkMixItemRender.prototype.onTap=function(e){if(this.data.cfg.costItem){if(this.data.count>=this.data.cfg.costCount)LyMark.ins().sendCompound(this.data.cfg.itemId);else UserTips.ins().showTips(i18n("LyMarkMixItemRender_5"))}else UserWarn.ins().setBuyGoodsWarn(this.data.cfg.itemId)};LyMarkMixItemRender.prototype.destruct=function(){this.MixBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};return LyMarkMixItemRender}(BaseItemRender);__reflect(LyMarkMixItemRender.prototype,"LyMarkMixItemRender");var LyMarkMixWin=function(_super){__extends(LyMarkMixWin,_super);function LyMarkMixWin(){var _this=_super.call(this)||this;_this.skinName="markMixSkin";_this.isTopLevel=true;return _this}LyMarkMixWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.list.itemRenderer=LyMarkMixItemRender};LyMarkMixWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this,this.onTouch);this.observe(UserBag.ins().postItemAdd,this.update);this.observe(UserBag.ins().postItemChange,this.update);this.update()};LyMarkMixWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeObserve()};LyMarkMixWin.prototype.update=function(){if(!this._collect){this._collect=new ArrayCollection;this.list.dataProvider=this._collect}var datas=[];var itemData,cfg;var count,itemName,itemCount;for(var key in GlobalConfig.FlameStampMat){cfg=GlobalConfig.FlameStampMat[key];if(cfg.costItem){itemData=UserBag.ins().getBagItemById(cfg.costItem);itemName=GlobalConfig.ItemConfig[cfg.costItem].name;count=itemData?itemData.count:0}else{count=0;itemName=""}itemData=UserBag.ins().getBagItemById(cfg.itemId);itemCount=itemData?itemData.count:0;datas.push({cfg:cfg,count:count,itemName:itemName,itemCount:itemCount})}this._collect.source=datas};LyMarkMixWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};return LyMarkMixWin}(BaseEuiView);__reflect(LyMarkMixWin.prototype,"LyMarkMixWin");ViewManager.ins().reg(LyMarkMixWin,LayerManager.UI_Main);var LyMarkPanel=function(_super){__extends(LyMarkPanel,_super);function LyMarkPanel(){var _this=_super.call(this)||this;_this._angle=.1;_this._angles=[0,0,0,0,0,0,0];_this._circleCenter={x:279,y:229};_this._a=155;_this._b=80;_this._oldBallNum=0;_this.expBar=new ProgressBarEff;return _this}LyMarkPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.mixItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.mixItemTxt.text);this.expBar.setWidth(470);this.expBar.x=-85;this.expBar.y=-15;this.schedule.addChild(this.expBar);this.iconMc=new MovieClip;this.iconMc.x=0;this.iconMc.y=0;var config=GlobalConfig.ActorExRingConfig[7];var effSoure=config.icon;this.iconMc.playFile(RES_DIR_EFF+effSoure,-1);this.ringMcGroup.addChild(this.iconMc)};LyMarkPanel.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.observe(LyMark.ins().postMarkData,this.update);this.observe(UserBag.ins().postItemAdd,this.updateMaterial);this.observe(UserBag.ins().postItemChange,this.updateMaterial);this.observe(LyMark.ins().postUpgrade,this.updateEff);this.addTouchEvent(this,this.onTouch);this._oldBallNum=0;this.update();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.wuShuangYin)};LyMarkPanel.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeObserve();this._materailInfo=null;this.resetBalls();this.clearRedEff();this.expBar.reset();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};LyMarkPanel.prototype.resetBalls=function(){TimerManager.ins().removeAll(this);if(this._balls){var len=this._balls.length;for(var i=0;i<len;i++){this._balls[i].destroy();this._balls[i]=null}this._balls.length=0;this._balls=null}};LyMarkPanel.prototype.update=function(){var max=LyMark.ins().isMax,level=LyMark.ins().lyMarkLv;this.currentState=max?"max":"normal";this.lvtxt.text=LyMark.ins().lyMarkLv+i18n("Level_0");var objAtts=[];var cfg=GlobalConfig.FlameStampLevel[level];var attr;for(var k in cfg.attrs)objAtts.push(new AttributeData(cfg.attrs[k].type,cfg.attrs[k].value));var totalPower=UserBag.getAttrPower(objAtts);this.nowAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："));if(this.expBar.getMaxValue()!=cfg.exp){this.expBar.setData(LyMark.ins().lyMarkExp,cfg.exp)}else this.expBar.setValue(LyMark.ins().lyMarkExp);if(!max){objAtts=[];var nextCfg=GlobalConfig.FlameStampLevel[level+1];for(var k in nextCfg.attrs)objAtts.push(new AttributeData(nextCfg.attrs[k].type,nextCfg.attrs[k].value));this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(objAtts,0,1,"："));var itemConfig=GlobalConfig.ItemConfig[cfg.costItem];this.costImg.source=itemConfig.icon+"_png";this.updateMaterial()}else this.clearRedEff();var skillLv,effectCfg;var bollNum=0,realLv=0;for(var i=0;i<=6;i++){realLv=skillLv=LyMark.ins().getSkillLvById(i+1);if(!skillLv)skillLv=1;effectCfg=GlobalConfig.FlameStampEffect[i+1][skillLv];this["skill"+i].setCfg(effectCfg);if((i+1==1||i+1==2)&&realLv)bollNum=effectCfg.stamp;if(realLv)totalPower+=effectCfg.exPower}var roleNum=SubRoles.ins().subRolesLen;this.power.setPower(totalPower*roleNum);if(bollNum&&this._oldBallNum!=bollNum){this.resetBalls();this._oldBallNum=bollNum;if(!this._balls){this._balls=[];TimerManager.ins().doTimer(17*3,0,this.doCircle,this)}var ball=void 0;var radian=2*Math.PI/bollNum;for(var i=0;i<bollNum;i++){ball=ObjectPool.pop("MovieClip");this.ringMcGroup.parent.addChild(ball);this._angles[i]=radian*i;ball.x=this._a*Math.cos(radian*i)+this._circleCenter.x;ball.y=this._b*Math.sin(radian*i)+this._circleCenter.y;this._balls.push(ball);ball.playFile(RES_DIR_EFF+"lymarkeff",-1)}}};LyMarkPanel.prototype.doCircle=function(){if(!this._balls){TimerManager.ins().removeAll(this);return}var len=this._balls.length,ball;var parent;var imgIndex=0,selfIndex=0;for(var i=0;i<len;i++){ball=this._balls[i];ball.x=this._a*Math.cos(this._angles[i])+this._circleCenter.x;ball.y=this._b*Math.sin(this._angles[i])+this._circleCenter.y;this._angles[i]+=this._angle;this._angles[i]=this._angles[i]%(2*Math.PI);parent=ball.parent;imgIndex=parent.getChildIndex(this.ringMcGroup);selfIndex=parent.getChildIndex(ball);if(this._angles[i]>=2.5&&this._angles[i]<=6){if(selfIndex>imgIndex)parent.addChildAt(ball,3)}else{if(selfIndex<imgIndex)parent.addChildAt(ball,parent.numChildren)}}};LyMarkPanel.prototype.updateMaterial=function(){if(LyMark.ins().isMax)return;var cfg=GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv];var itemData=UserBag.ins().getBagItemById(cfg.costItem);var count=itemData?itemData.count:0;this.costCount.textFlow=TextFlowMaker.generateTextFlow1(i18n("LyMarkPanel_1",count<cfg.costCount?"0xFF0000":"0x00FF00",count,cfg.costCount));this._materailInfo={enough:count>=cfg.costCount,id:cfg.costItem};var needExp=cfg.exp-LyMark.ins().lyMarkExp;if(count>=cfg.costCount&&count*GlobalConfig.FlameStampMat[cfg.costItem].exp>=needExp){if(!this._redEffect){this._redEffect=ObjectPool.pop("MovieClip");this._redEffect.touchEnabled=false;this.lvupGroup.addChild(this._redEffect);this._redEffect.x=77;this._redEffect.y=28;this._redEffect.playFile(RES_DIR_EFF+"chargeff1",-1)}}else this.clearRedEff()};LyMarkPanel.prototype.clearRedEff=function(){if(this._redEffect){this._redEffect.destroy();this._redEffect=null}};LyMarkPanel.prototype.onTouch=function(e){switch(e.target){case this.lvupBtn:if(this._materailInfo.enough)LyMark.ins().sendUpgrade();else UserTips.ins().showTips(i18n("LyMarkPanel_0"));break;case this.mixItemTxt:ViewManager.ins().open(LyMarkMixWin);break;case this.skill0:case this.skill1:case this.skill2:case this.skill3:case this.skill4:case this.skill5:case this.skill6:ViewManager.ins().open(LyMarkSkillTipsWin,e.target.getCfg());break}};LyMarkPanel.prototype.updateEff=function(param){var crit=param[0];if(crit>1){var img_3=new eui.Image("xn_wingup"+crit);img_3.horizontalCenter=0;img_3.verticalCenter=0;img_3.scaleX=img_3.scaleY=.5;var t=egret.Tween.get(img_3);t.to({scaleX:1.5,scaleY:1.5,alpha:0},500).call(function(){DisplayUtils.removeFromParent(img_3)},this);this.actEff.addChild(img_3)}};return LyMarkPanel}(BaseEuiView);__reflect(LyMarkPanel.prototype,"LyMarkPanel");var LyMarkSkillItem=function(_super){__extends(LyMarkSkillItem,_super);function LyMarkSkillItem(){var _this=_super.call(this)||this;_this.touchEnabled=true;_this.touchChildren=false;_this.addEventListener(egret.Event.ADDED_TO_STAGE,_this.addToStage,_this);return _this}Object.defineProperty(LyMarkSkillItem.prototype,"className",{get:function(){return this._className},set:function(v){this._className=v},enumerable:true,configurable:true});LyMarkSkillItem.prototype.setCfg=function(cfg){this._cfg=cfg;this.update()};LyMarkSkillItem.prototype.getCfg=function(){return this._cfg};LyMarkSkillItem.prototype.addToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this);MessageCenter.addListener(LyMark.ins().postMarkData,this.update,this);MessageCenter.addListener(UserBag.ins().postItemAdd,this.update,this);MessageCenter.addListener(UserBag.ins().postItemChange,this.update,this);this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this)};LyMarkSkillItem.prototype.removeStage=function(e){MessageCenter.ins().removeAll(this);this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this)};LyMarkSkillItem.prototype.update=function(){if(!this._cfg)return;this.skillImg.source=this._cfg.icon;this.skillName.textFlow=TextFlowMaker.generateTextFlow1(this._cfg.skillname);var lv=LyMark.ins().getSkillLvById(this._cfg.id);this.lock.visible=!lv;this.redpoint.visible=false;if(this._cfg.id!=1){var isMax=lv>=Object.keys(GlobalConfig.FlameStampEffect[this._cfg.id]).length;if(isMax)return;var nextCfg=GlobalConfig.FlameStampEffect[this._cfg.id][lv<=0?1:lv+1];if(nextCfg.costItem){var itemConfig=GlobalConfig.ItemConfig[nextCfg.costItem];var itemData=UserBag.ins().getBagItemById(nextCfg.costItem);var count=itemData?itemData.count:0;this.redpoint.visible=count>=nextCfg.costCount&&LyMark.ins().lyMarkLv>=nextCfg.stampLevel}}};return LyMarkSkillItem}(eui.Component);__reflect(LyMarkSkillItem.prototype,"LyMarkSkillItem");var LyMarkSkillTipsWin=function(_super){__extends(LyMarkSkillTipsWin,_super);function LyMarkSkillTipsWin(){var _this=_super.call(this)||this;_this.skinName="markSkillTipsSkin";_this.isTopLevel=true;return _this}LyMarkSkillTipsWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._cfg=args[0];this.addTouchEvent(this,this.onTouch);this.observe(LyMark.ins().postMarkData,this.resetCfg);this.observe(UserBag.ins().postItemAdd,this.updateData);this.observe(UserBag.ins().postItemChange,this.updateData);this.updateData()};LyMarkSkillTipsWin.prototype.close=function(){this.removeTouchEvent(this,this.onTouch);this.removeObserve();if(this._uiEffect){this._uiEffect.destroy();this._uiEffect=null}};LyMarkSkillTipsWin.prototype.resetCfg=function(){var skillLv=LyMark.ins().getSkillLvById(this._cfg.id);if(!skillLv)skillLv=1;this._cfg=GlobalConfig.FlameStampEffect[this._cfg.id][skillLv];this.updateData()};LyMarkSkillTipsWin.prototype.updateData=function(){this.currentState="skill"+(this._cfg.id-1);this.skillImg.source=this._cfg.icon;this.nametxt.text=this._cfg.skillname;var lv=LyMark.ins().getSkillLvById(this._cfg.id);this.lvtxt.text=lv+i18n("Level_0");this.redpoint.visible=false;this.nextLevel.text="";if(this._cfg.id==1){var time=0;var lv3=LyMark.ins().getSkillLvById(3);var mCd=lv3?GlobalConfig.FlameStampEffect[3][lv3].reloadTime:0;var skillID=this._cfg.skillId;var count=this._cfg.stamp;if(!lv)mCd=0;else if(LyMark.ins().getSkillLvById(2)){lv3=LyMark.ins().getSkillLvById(2);skillID=GlobalConfig.FlameStampEffect[2][lv3].skillId;count=GlobalConfig.FlameStampEffect[2][lv3].stamp}var skillDes=GlobalConfig.SkillsDescConfig[GlobalConfig.SkillsConfig[skillID].desc];time=(skillDes.cd-mCd)/1e3>>0;this.keyDesctxt.text=i18n("LyMarkSkillTipsWin_0")+time+i18n("LyMarkSkillTipsWin_1");this.skillDesctxt.textFlow=TextFlowMaker.generateTextFlow1(skillDes.desc.replace("{0}",i18n("LyMarkSkillTipsWin_11",65280,time/count>>0)).replace("{1}",i18n("LyMarkSkillTipsWin_12",65280,count)));this.damageDesctxt.textFlow=TextFlowMaker.generateTextFlow1(LyMark.ins().lyMarkLv?GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv].bulletDesc:"")}else{if(this._cfg.id==2||this._cfg.id==3||this._cfg.id==7)this.keyDesctxt.text=i18n("LyMarkSkillTipsWin_2")+Object.keys(GlobalConfig.FlameStampEffect[this._cfg.id]).length;else this.keyDesctxt.text=i18n("LyMarkSkillTipsWin_3")+(GlobalConfig.EffectsConfig[this._cfg.id==4?this._cfg.selfEffId:this._cfg.effId].probabilityBuff/100>>0)+"%";this.skillDesctxt.textFlow=TextFlowMaker.generateTextFlow1(this._cfg.skillDesc);var isMax=lv>=Object.keys(GlobalConfig.FlameStampEffect[this._cfg.id]).length;this.cost.visible=false;this.update.visible=false;if(!isMax){var nextCfg=GlobalConfig.FlameStampEffect[this._cfg.id][lv<=0?1:lv+1];if(nextCfg.costItem){var itemConfig=GlobalConfig.ItemConfig[nextCfg.costItem];this.costImg.source=itemConfig.icon+"_png";var itemData=UserBag.ins().getBagItemById(nextCfg.costItem);var count=itemData?itemData.count:0;this.costNum.textFlow=TextFlowMaker.generateTextFlow1(i18n("LyMarkSkillTipsWin_13",count<nextCfg.costCount?16711680:13746831,nextCfg.costCount));this.costItemId=nextCfg.costItem;this.costNumber=nextCfg.costCount-count;this.redpoint.visible=count>=nextCfg.costCount&&LyMark.ins().lyMarkLv>=nextCfg.stampLevel;this._nextCfg=nextCfg;if(LyMark.ins().lyMarkLv>=nextCfg.stampLevel){this.cost.visible=count<nextCfg.costCount;this.update.visible=!this.cost.visible}else this.nextLevel.text=i18n("LyMarkSkillTipsWin_4")+nextCfg.stampLevel+i18n("LyMarkSkillTipsWin_5")}else if(LyMark.ins().lyMarkLv<nextCfg.stampLevel){this.nextLevel.text=i18n("LyMarkSkillTipsWin_6")+nextCfg.stampLevel+i18n("LyMarkSkillTipsWin_7")}}}if(!this._uiEffect){this._uiEffect=ObjectPool.pop("MovieClip");this.uieff.addChild(this._uiEffect)}this._uiEffect.playFile(""+RES_DIR_EFF+this._cfg.uiEff,-1)};LyMarkSkillTipsWin.prototype.onTouch=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.update:if(this.redpoint.visible)LyMark.ins().sendUpSkill(this._cfg.id);else{if(this._nextCfg.stampLevel>LyMark.ins().lyMarkLv)UserTips.ins().showTips(i18n("LyMarkSkillTipsWin_8")+this._nextCfg.stampLevel+i18n("LyMarkSkillTipsWin_9"));else UserTips.ins().showTips(i18n("LyMarkSkillTipsWin_10"))}break;case this.btnGet:ViewManager.ins().open(ShopGoodsWarn).setData(this.costItemId,this.costNumber);break}};return LyMarkSkillTipsWin}(BaseEuiView);__reflect(LyMarkSkillTipsWin.prototype,"LyMarkSkillTipsWin");ViewManager.ins().reg(LyMarkSkillTipsWin,LayerManager.UI_Main);var NewStoryMgr=function(_super){__extends(NewStoryMgr,_super);function NewStoryMgr(){var _this=_super.call(this)||this;_this.sounds={};_this.entityInStory={};_this.pics={};_this.showTextInfo={txt:"",curLen:0};_this.savedMapPos=null;_this.sysId=PackageID.NewStory;_this.regNetMsg(1,_this.postGetStatus);_this.doStoryFuncs={map:_this.doStory_map,camera:_this.doStory_camera,playmusic:_this.doStory_playmusic,stopmusic:_this.doStory_stopmusic,particle:_this.doStory_particle,role:_this.doStory_role,enter:_this.doStory_enter,leave:_this.doStory_leave,move:_this.doStory_move,wait:_this.doStory_wait,text:_this.doStory_text,skill:_this.doStory_skill,stopskill:_this.doStory_stopskill,shake:_this.doStory_shake,showpic:_this.doStory_showpic,hidepic:_this.doStory_hidepic,waitclick:_this.doStory_waitclick};return _this}NewStoryMgr.prototype.postGetStatus=function(bytes){var storyId=bytes.readInt();var finished=bytes.readInt();if(storyId==1&&finished==0){ViewManager.ins().open(NewStoryWin,1)}};NewStoryMgr.prototype.sendGetStatus=function(storyId){var bytes=this.getBytes(1);bytes.writeInt(storyId);this.sendToServer(bytes)};NewStoryMgr.prototype.sendFinishStory=function(storyId){var bytes=this.getBytes(2);bytes.writeInt(storyId);this.sendToServer(bytes)};NewStoryMgr.prototype.playNext=function(){var nextSid=this.curSid+1;var stories=GlobalConfig.NewStoryConfig[this.curStoryId];if(stories){var story=stories[nextSid];if(story){this.curSid=nextSid;TimerManager.ins().remove(this.showText,this);var view=this.getView();if(view){view.labelGroup.visible=false;view.textGroup.visible=false}var pause=this.doStory(story);if(!pause){this.playNext()}}else{this.endStory()}}};NewStoryMgr.prototype.endStory=function(){var view=this.getView();view.doTransition(this.stopCurStory,this,this.destroyStoryWin,this)};NewStoryMgr.prototype.destroyStoryWin=function(){ViewManager.ins().close(NewStoryWin)};NewStoryMgr.prototype.doStory=function(story){var func=this.doStoryFuncs[story.actionType];if(func){return func.apply(this,[story])}};NewStoryMgr.prototype.doStory_map=function(story){var view=this.getView();var self=this;if(view.blackMask.visible){this.doStory_mapImpl(story)}else{view.doTransition(function(){self.doStory_mapImpl(story);self.playNext();view.btnSkip.visible=true},this);return true}};NewStoryMgr.prototype.doStory_mapImpl=function(story){var mapName=story.actionData.res;this.setMap(mapName)};NewStoryMgr.prototype.setMap=function(mapName){var mapView=GameSceneView.instance.map;var mapBg=mapView["_mapImage"];var mapInfo=GameMap["mapZip"][mapName];if(!mapInfo){return}this.CELL_SIZE=mapInfo.title_wh;this.MAX_HEIGHT=mapInfo.pixHeight;this.MAX_WIDTH=mapInfo.pixWidth;var COL=mapInfo.maxX;var ROW=mapInfo.maxY;mapBg.initThumbnail(this.MAX_WIDTH,this.MAX_HEIGHT,mapName,0)};NewStoryMgr.prototype.doStory_camera=function(story){var mapView=GameSceneView.instance.map;var mapBg=mapView["_mapImage"];var x=story.actionData.x*this.CELL_SIZE;var y=story.actionData.y*this.CELL_SIZE;var sw=StageUtils.ins().getWidth();var sh=StageUtils.ins().getHeight();var fun=function(tx,stw,mv,offset){if(offset===void 0){offset=0}return-Math.min(Math.max(tx-offset-(stw>>1),0),mv-stw)};mapView.x=fun(x*mapView.scaleX,sw,this.MAX_WIDTH);mapView.y=fun(y*mapView.scaleY,sh,this.MAX_HEIGHT,60);mapBg.updateHDMap({x:fun(x,sw/mapView.scaleX,this.MAX_WIDTH),y:fun(y,sh/mapView.scaleY,this.MAX_HEIGHT,60)},true)};NewStoryMgr.prototype.doStory_playmusic=function(story){var effFile=story.actionData.res;var count=story.actionData.count;var eff=SoundManager.ins().playEffectImpl(effFile+"_mp3",count);var playedEffs=this.sounds[effFile];if(playedEffs==null){playedEffs=[];this.sounds[effFile]=playedEffs}playedEffs.push(eff)};NewStoryMgr.prototype.doStory_stopmusic=function(story){var effFile=story.actionData.res;var v=this.sounds[effFile];if(v){for(var _i=0,v_3=v;_i<v_3.length;_i++){var vv=v_3[_i];SoundManager.ins().stopEffect(vv)}}};NewStoryMgr.prototype.doStory_particle=function(story){this.sparkTween(story.actionData.res)};NewStoryMgr.prototype.doStory_role=function(story){this.roles[story.role]=story.actionData};NewStoryMgr.prototype.doStory_enter=function(story){var role=this.roleEntitys[story.role];var actionData=story.actionData;if(role==null){var model=new EntityModel;model.isMy=false;model._dirNum=8;var roleInfo=this.roles[story.role];role=ObjectPool.pop("CharMonster");role.visible=true;role.reset();role.infoModel=model;role.showBodyContainer();role.removeAll();role.initBody((roleInfo.monster?RES_DIR_MONSTER:RES_DIR_BODY)+roleInfo.body);if(roleInfo.weapon&&roleInfo.weapon!=""){role.addMc(CharMcOrder.WEAPON,"resource/res/weapon/"+roleInfo.weapon)}if(roleInfo.wing&&roleInfo.wing!=""){role.addMc(CharMcOrder.WING,"resource/res/wing/"+roleInfo.wing)}if(roleInfo.sword&&roleInfo.sword!=""){model.flySwordAct=1;model.flySwordSkin=roleInfo.sword}role.myHeight=EntityManager.CHAR_DEFAULT_HEIGHT;if(roleInfo.height!=undefined){role.myHeight=roleInfo.height}role.typeface=EntityManager.CHAR_DEFAULT_TYPEFACE;role.setCharName(story.role);role["_nameGroup"].visible=true;role["titleContainer"].visible=true;role["titleContainer"].anchorOffsetY=role.myHeight;role.dir=actionData.dir;role.updateFlySword();role["sortEffect"].apply(role);var existedEntity=this.roleEntitys[story.role];if(existedEntity){existedEntity.parent.removeChild(existedEntity);delete this.entityInStory[existedEntity.hashCode]}this.roleEntitys[story.role]=role;this.entityInStory[role.hashCode]=1}var model=role.infoModel;model.x=actionData.x*this.CELL_SIZE;model.y=actionData.y*this.CELL_SIZE;role.x=model.x;role.y=model.y;var mapView=GameSceneView.instance.map;mapView.addEntity(role)};NewStoryMgr.prototype.doStory_leave=function(story){var role=this.roleEntitys[story.role];if(role){role.parent.removeChild(role);delete this.entityInStory[role.hashCode];delete this.roleEntitys[story.role];var v=this.roleSkills[story.role];if(v){this.stopSkill(v)}}};NewStoryMgr.prototype.doStory_move=function(story){var role=this.roleEntitys[story.role];if(role){var actionData=story.actionData;var sx=Math.floor(role.x/this.CELL_SIZE);var sy=Math.floor(role.y/this.CELL_SIZE);var tx=Math.floor(actionData.x);var ty=Math.floor(actionData.y);var path=[new AStarNode(tx,ty,DirUtil.get8DirBy2Point({x:role.x,y:role.y},{x:actionData.x*this.CELL_SIZE,y:actionData.y*this.CELL_SIZE}))];var speed=actionData.speed;if(speed==null){speed=4}role.infoModel.attributeData[AttributeType.atMoveSpeed]=speed*1e3;var mapView=GameSceneView.instance.map;mapView.moveEntity([role,path,true])}};NewStoryMgr.prototype.doStory_wait=function(story){var second=story.actionData.second;if(second==0){TimerManager.ins().doTimer(50,0,this.checkEntityMoving,this)}else{TimerManager.ins().doTimer(second*1e3,1,this.playNext,this)}return true};NewStoryMgr.prototype.clearSkills=function(){for(var k in this.roleSkills){var v=this.roleSkills[k];this.stopSkill(v)}this.roleSkills=undefined};NewStoryMgr.prototype.stopSkill=function(v){TimerManager.ins().remove(v.skillFunc,v.roleEntity);v.finished=true};NewStoryMgr.prototype.onFinishSkill=function(v){v.finished=true};NewStoryMgr.prototype.doStory_skill=function(story){var self=this;var selfEntity=this.roleEntitys[story.role];var v={skillFunc:function(){self.doStory_skillImpl(story)},roleEntity:selfEntity,finished:false};var oldV=this.roleSkills[story.role];if(oldV){this.stopSkill(oldV)}this.roleSkills[story.role]=v;v.skillFunc();TimerManager.ins().doTimer(story.actionData.interval*1e3,story.actionData.count,v.skillFunc,v.roleEntity,function(){self.onFinishSkill(v)})};NewStoryMgr.prototype.doStory_skillImpl=function(story){var actionData=story.actionData;var self=this;var selfEntity=this.roleEntitys[story.role];var targetEntity=null;if(actionData.target){targetEntity=this.roleEntitys[actionData.target];if(targetEntity){selfEntity.dir=DirUtil.get8DirBy2Point(selfEntity,targetEntity)}}else if(actionData.dir!=null){selfEntity.dir=actionData.dir}var action=actionData.action;if(action==null||action.length==0){action=EntityAction.ATTACK}if(action=="d"){selfEntity.removeMc(CharMcOrder.WING)}selfEntity.playAction(action,function(){var v=self.roleSkills[story.role];var roleInfo=self.roles[story.role];if(v==null||v.finished||roleInfo&&roleInfo.monster){if(action!="d"){selfEntity.playAction(EntityAction.STAND)}}});var scale=actionData.scale;if(actionData.res!=null&&actionData.res!=""){SkillEffPlayer.play(actionData.res,selfEntity,targetEntity?[targetEntity]:undefined,undefined,undefined,actionData.offset,undefined,scale,targetEntity?[targetEntity]:undefined)}if(actionData.multires!=null){for(var _i=0,_a=actionData.multires;_i<_a.length;_i++){var res=_a[_i];SkillEffPlayer.play(res.res,selfEntity,targetEntity?[targetEntity]:undefined,undefined,undefined,res.offset,undefined,scale,targetEntity?[targetEntity]:undefined)}}};NewStoryMgr.prototype.doStory_stopskill=function(story){var oldV=this.roleSkills[story.role];if(oldV){this.stopSkill(oldV)}delete this.roleSkills[story.role]};NewStoryMgr.prototype.doStory_text=function(story){var view=this.getView();if(view){var actionData=story.actionData;view.labelGroup.visible=true;view.textGroup.visible=true;var entity=this.roleEntitys[story.role];if(entity){var bubblePosG=entity.localToGlobal(0,-entity.myHeight);var bubblePosUI=view.bubbleBgGroup.parent.globalToLocal(bubblePosG.x,bubblePosG.y,bubblePosG);view.bubbleBgGroup.x=bubblePosUI.x;view.bubbleBgGroup.y=bubblePosUI.y}var roleInfo=this.roles[story.role];view.portraitGroup.visible=false;if(roleInfo){if(!roleInfo.monster){view.portraitGroup.visible=true;var body=this.showMc(view.bodyMc,RES_DIR_ROLE+roleInfo.body+"_c");if(roleInfo.weapon!=""&&roleInfo.weapon!=null){this.showMc(view.weaponMc,RES_DIR_ROLE+roleInfo.weapon+"_c",body)}else{view.weaponMc.visible=false}if(roleInfo.wing!=""&&roleInfo.wing!=null){this.showMc(view.wingMc,RES_DIR_ROLE+roleInfo.wing,body)}else{view.wingMc.visible=false}}}view.nameLabel.text=story.role;view.textLabel.text="";this.showTextInfo.txt=actionData.dialog;this.showTextInfo.curLen=-2;TimerManager.ins().doTimer(50,0,this.showText,this)}return true};NewStoryMgr.prototype.doStory_shake=function(story){var ad=story.actionData;var gsv=ViewManager.ins().getView(GameSceneView);DisplayUtils.shakeItHeji(gsv.map,ad.range,ad.duration,ad.times)};NewStoryMgr.prototype.doStory_showpic=function(story){var ad=story.actionData;var name=ad.name;var res=ad.res;var x=ad.x;if(x==undefined){x=0}var y=ad.y;if(y==undefined){y=0}var scale=ad.scale;var duration=ad.duration;var pics=this.pics;var pic=pics[name];if(pic!=null){egret.Tween.removeTweens(pic.img);pic.data=ad}else{var img=new eui.Image(res);if(scale!=null){img.scaleX=img.scaleY=scale}this.getView().picGroup.addChild(img);pic={img:img,data:ad};pics[name]=pic}var grp=this.getView().picGroup;var img=pic.img;img.x=x;img.y=y;img.alpha=0;Tween.get(img).to({alpha:1},duration*1e3)};NewStoryMgr.prototype.doStory_hidepic=function(story){var ad=story.actionData;var name=ad.name;var duration=ad.duration;if(duration==null){duration=1}var pics=this.pics;var pic=pics[name];if(pic!=null){egret.Tween.removeTweens(pic.img);var img=pic.img;Tween.get(img).to({alpha:0},duration*1e3).call(function(){img.parent.removeChild(img);delete pics[name]})}};NewStoryMgr.prototype.removeAllPics=function(){var pics=this.pics;for(var name in pics){var pic=pics[name];if(pic!=null){egret.Tween.removeTweens(pic.img);var img=pic.img;img.parent.removeChild(img);delete pics[name]}}};NewStoryMgr.prototype.doStory_waitclick=function(story){return true};NewStoryMgr.prototype.showMc=function(mc,mcFile,_body){if(_body===void 0){_body=null}mc.dispose();mc.visible=true;mc.playFile(mcFile,-1,null,true,function(){if(_body){mc.addEventListener(egret.Event.CHANGE,function(){mc.removeEventListener(egret.Event.CHANGE,null,null);mc.gotoAndPlay(_body.currentFrame,-1)},null);_body.addEventListener(egret.Event.CHANGE,function(){mc.gotoAndPlay(_body.currentFrame,-1)},null)}});return mc};NewStoryMgr.prototype.showText=function(){this.showTextInfo.curLen+=1;var view=this.getView();if(view){if(this.showTextInfo.curLen>0){if(this.showTextInfo.curLen>=this.showTextInfo.txt.length){TimerManager.ins().remove(this.showText,this);view.textLabel.text=this.showTextInfo.txt}else{view.textLabel.text=this.showTextInfo.txt.substr(0,this.showTextInfo.curLen)}}}};NewStoryMgr.prototype.onTouch=function(){if(this.curStoryId!=undefined){var story=GlobalConfig.NewStoryConfig[this.curStoryId][this.curSid];if(story&&story.actionType=="text"){if(this.showTextInfo.curLen<this.showTextInfo.txt.length){this.showTextInfo.curLen=this.showTextInfo.txt.length-1;this.showText()}else{this.playNext()}}if(story&&story.actionType=="waitclick"){this.playNext()}}};NewStoryMgr.prototype.checkEntityMoving=function(){for(var k in this.roleEntitys){var entity=this.roleEntitys[k];if(entity._state!=EntityAction.STAND&&entity._state!=EntityAction.DIE){return}}TimerManager.ins().remove(this.checkEntityMoving,this);this.playNext()};NewStoryMgr.prototype.isStoryEntity=function(entity){if(!this.entityInStory){return false}return entity.hashCode in this.entityInStory};NewStoryMgr.prototype.sparkTween=function(particlePic){var _this=this;for(var i=0;i<15;i++){TimerManager.ins().doTimer(Math.random()*1e3+1500,1,function(){_this.randomSpark(particlePic)},this)}TimerManager.ins().doTimer(1500,1,function(){_this.sparkTween(particlePic)},this)};NewStoryMgr.prototype.getView=function(){return ViewManager.ins().getView(NewStoryWin)};NewStoryMgr.prototype.randomSpark=function(particlePic){var image=ObjectPool.pop("eui.Image");image.source=particlePic;image.x=Math.random()*580;image.rotation=Math.random()*180;image.touchEnabled=false;var view=this.getView();if(view==null){return}var groupSpark=view.groupSpark;groupSpark.addChild(image);var scale=MathUtils.limit(.7,1);image.scaleX=image.scaleY=scale;image.y=MathUtils.limit(-150,0);var t=egret.Tween.get(image);t.to({x:Math.random()*580,y:Math.random()*500+600},4500).call(function(){image.parent.removeChild(image);egret.Tween.removeTweens(image);ObjectPool.push(image)})};NewStoryMgr.prototype.closeTween=function(){if(!this.getView()){return}var groupSpark=this.getView().groupSpark;var len=groupSpark.numChildren;var allChildren=[];for(var i=0;i<len;++i){allChildren.push(groupSpark.getChildAt(i))}for(var i_23=0;i_23<len;i_23++){var obj=allChildren[i_23];egret.Tween.removeTweens(obj);obj.parent.removeChild(obj);ObjectPool.push(obj)}};NewStoryMgr.prototype.clearSounds=function(){for(var k in this.sounds){var v=this.sounds[k];for(var _i=0,v_4=v;_i<v_4.length;_i++){var vv=v_4[_i];SoundManager.ins().stopEffect(vv)}}this.sounds={}};NewStoryMgr.prototype.stopCurStory=function(){this.sendFinishStory(this.curStoryId);var view=this.getView();if(view){view.portraitGroup.visible=false;view.labelGroup.visible=false;view.textGroup.visible=false}this.curStoryId=undefined;this.setUIVisible(true);this.clearSounds();this.closeTween();this.roles=undefined;for(var k in this.roleEntitys){var roleEnt=this.roleEntitys[k];roleEnt.parent.removeChild(roleEnt)}this.roleEntitys=undefined;this.entityInStory=undefined;TimerManager.ins().removeAll(this);this.clearSkills();GameSceneView.instance.stateImg.visible=true;this.setMap(this.savedMapName);var mapView=GameSceneView.instance.map;var mapBg=mapView["_mapImage"];if(!this.savedMapPos){return}mapView.x=this.savedMapPos.mapx;mapView.y=this.savedMapPos.mapy;mapBg.updateHDMap({x:this.savedMapPos.updatex,y:this.savedMapPos.updatey},true);RoleAI.ins().setStoryMode(false);SoundUtil.ins().bgSoundOn();this.resetPos()};NewStoryMgr.prototype.resetPos=function(){EntityManager.ins().resetRole();for(var handle in this.aiList){var char=EntityManager.ins().getEntityByHandle(handle);if(char&&char.AI_STATE!=AI_State.Die){RoleAI.ins().add(char)}}this.aiList={};var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var i in mylist){var char=mylist[i];var pos=this.rolePositions[char.infoModel.handle];if(pos){char.x=pos.x;char.y=pos.y}}this.rolePositions={}};NewStoryMgr.prototype.playStory=function(id){this.curStoryId=id;this.curSid=0;this.roles={};this.pics={};this.roleEntitys={};this.entityInStory={};this.roleSkills={};SoundUtil.ins().bgSoundOff();SoundUtil.ins().stopRun();GameSceneView.instance.stateImg.visible=false;this.setUIVisible(false);var mapView=GameSceneView.instance.map;var mapBg=mapView["_mapImage"];this.savedMapName=mapBg.mapName;this.savedMapPos={mapx:mapView.x,mapy:mapView.y,updatex:mapBg.lastUpdateX,updatey:mapBg.lastUpdateY};this.rolePositions={};this.aiList=RoleAI.ins().getAIList();RoleAI.ins().clearAIList();DropHelp.clearDrop();var mylist=EntityManager.ins().getEntityByTeam(Team.My);for(var _i=0,mylist_8=mylist;_i<mylist_8.length;_i++){var char=mylist_8[_i];char.stopMove();char.playAction(EntityAction.STAND);if(char instanceof CharRole){this.rolePositions[char.infoModel.handle]={x:char.x,y:char.y,dir:char.dir}}EntityManager.ins().removeByHandle(char.infoModel.handle)}this.playNext()};NewStoryMgr.prototype.setUIVisible=function(visible){var layers=[LayerManager.UI_Main,LayerManager.UI_Main2,LayerManager.UI_Popup,LayerManager.UI_Message];for(var _i=0,layers_1=layers;_i<layers_1.length;_i++){var layer=layers_1[_i];layer.visible=visible}var views=[UIView2,PlayFunView,ChatMainUI,GameBlackView];for(var _a=0,views_1=views;_a<views_1.length;_a++){var view=views_1[_a];var v=ViewManager.ins().getView(view);if(v){v.visible=visible}}GameSceneView.instance.addChildAt(GameSceneView.instance.map,0)};NewStoryMgr.ins=function(){return _super.ins.call(this)};return NewStoryMgr}(BaseSystem);__reflect(NewStoryMgr.prototype,"NewStoryMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.newStoryMgr=NewStoryMgr.ins.bind(NewStoryMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var NewStoryWin=function(_super){__extends(NewStoryWin,_super);function NewStoryWin(){var _this=_super.call(this)||this;_this.isTransiting=false;_this.skinName="NewStoryWinSkin";return _this}NewStoryWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};NewStoryWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.addTouchEvent(this,this.onTap);this.addTouchEvent(this.btnSkip,this.onTap);var bubbleMc=new MovieClip;bubbleMc.playFile(RES_DIR_EFF+"gc_dhkeff",-1);this.bubbleMcGroup.addChild(bubbleMc);this.wingMc=new MovieClip;this.wingMcGroup.addChild(this.wingMc);this.weaponMc=new MovieClip;this.weaponMcGroup.addChild(this.weaponMc);this.bodyMc=new MovieClip;this.bodyMcGroup.addChild(this.bodyMc);this.transitionMc=new MovieClip;this.transitionMcGroup.addChild(this.transitionMc);this.transitionMc.playFile(RES_DIR_EFF+"gceff",-1);this.transitionMc.visible=false;this.transitionMc2=new MovieClip;this.transitionMc2.y=170;this.transitionMcGroup.addChild(this.transitionMc2);this.transitionMc2.playFile(RES_DIR_EFF+"gc_sglzeff",-1);this.transitionMc2.visible=false};NewStoryWin.prototype.onTap=function(e){switch(e.target){case this.btnSkip:var pics=NewStoryMgr.ins().pics;var picNum=0;for(var k in pics){picNum+=1}if(picNum==0){NewStoryMgr.ins().endStory();this.isTransiting=true;break}else{var storyMgr=NewStoryMgr.ins();var nextSid=storyMgr.curSid+1;var stories=GlobalConfig.NewStoryConfig[storyMgr.curStoryId];if(stories){while(true){var story=stories[nextSid];if(story){if(story.actionType=="waitclick"){storyMgr.removeAllPics();storyMgr.curSid=nextSid;storyMgr.playNext();break}}else{storyMgr.endStory();this.isTransiting=true;break}nextSid=nextSid+1}}}break;default:if(!this.isTransiting){NewStoryMgr.ins().onTouch()}break}};NewStoryWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.storyId=param[0];this.isTransiting=true;this.doTransition(this.startStory,this,undefined,undefined,1e3)};Object.defineProperty(NewStoryWin.prototype,"maskF",{get:function(){return(this.blackMask.scaleX-1)/25},set:function(f){this.blackMask.scaleX=this.blackMask.scaleY=1+f*25},enumerable:true,configurable:true});NewStoryWin.prototype.doTransition=function(func,funcObj,endFunc,endFuncObj,delay){if(delay===void 0){delay=1}egret.Tween.removeTweens(this);egret.Tween.removeTweens(this.transitionMc);this.transitionMcGroup.visible=true;this.blackMask.visible=true;this.transitionMc.visible=true;this.transitionMc.alpha=0;this.transitionMc2.visible=true;this.transitionMc2.alpha=0;this.labelGroup.visible=false;this.textGroup.visible=false;this.btnSkip.visible=false;this.maskF=1;this.isTransiting=true;var FADE_TIME=1500;var WAIT_TIME=1200;var tw=egret.Tween.get(this,{loop:false}).wait(delay).to({maskF:0},FADE_TIME).call(func,funcObj).wait(WAIT_TIME).to({maskF:1},FADE_TIME).call(this.hideBlackImg,this);egret.Tween.get(this.transitionMc,{loop:false}).wait(delay).wait(FADE_TIME-500).to({alpha:1},500).wait(WAIT_TIME).to({alpha:0},500);egret.Tween.get(this.transitionMc2,{loop:false}).wait(delay).wait(FADE_TIME-500).to({alpha:1},500).wait(WAIT_TIME).to({alpha:0},500);if(endFunc){tw.call(endFunc,endFuncObj)}};NewStoryWin.prototype.hideBlackImg=function(){this.transitionMcGroup.visible=false;this.blackMask.visible=false;this.transitionMc.visible=false;this.transitionMc2.visible=false;this.isTransiting=false};NewStoryWin.prototype.startStory=function(){this.btnSkip.visible=true;RoleAI.ins().setStoryMode(true);ViewManager.ins().close(OfflineRewardWin);ViewManager.ins().close(LimitStartTipsView);NewStoryMgr.ins().playStory(1)};NewStoryWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.btnSkip,this.onTap);this.removeTouchEvent(this,this.onTap)};return NewStoryWin}(BaseEuiView);__reflect(NewStoryWin.prototype,"NewStoryWin");ViewManager.ins().reg(NewStoryWin,LayerManager.UI_Tips);var StoryWin=function(_super){__extends(StoryWin,_super);function StoryWin(){var _this=_super.call(this)||this;_this.sid=0;_this.needBody=false;_this.particlePic="";_this.bgm=null;_this.eff1=null;_this.eff2=null;_this.dbAni=null;_this.skinName="storyPanelSkin";return _this}StoryWin.prototype.initUI=function(){_super.prototype.initUI.call(this)};StoryWin.prototype.createChildren=function(){_super.prototype.createChildren.call(this);this.validateNow()};StoryWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);this.closeCallback=param[1];this.needBody=param[2];this.setData(param[0]);RoleAI.ins().setStoryMode(true);this.sparkTween()};StoryWin.prototype.sparkTween=function(){var _this=this;for(var i=0;i<15;i++){TimerManager.ins().doTimer(Math.random()*1e3+1500,1,function(){_this.randomSpark()},this)}TimerManager.ins().doTimer(1500,1,function(){_this.sparkTween()},this)};StoryWin.prototype.randomSpark=function(){var image=ObjectPool.pop("eui.Image");if(!this.particlePic){return}image.source=this.particlePic;image.x=Math.random()*580;image.rotation=Math.random()*180;image.touchEnabled=false;this.groupSpark.addChild(image);var scale=MathUtils.limit(.7,1);image.scaleX=image.scaleY=scale;image.y=MathUtils.limit(-150,0);var t=egret.Tween.get(image);t.to({x:Math.random()*580,y:Math.random()*500+600},4500).call(function(){image.parent.removeChild(image);egret.Tween.removeTweens(image);ObjectPool.push(image)})};StoryWin.prototype.closeTween=function(){var len=this.groupSpark.numChildren;for(var i=0;i<len;i++){var obj=this.groupSpark.getChildAt(i);egret.Tween.removeTweens(obj)}};StoryWin.prototype.sortFunc=function(a,b){var asid=a.sid;var bsid=b.sid;if(asid>bsid)return 1;if(asid<bsid)return-1;return 0};StoryWin.prototype.setData=function(data){this.mcGroup.removeChildren();this.storys=[];for(var k in data){var d=data[k];this.storys.push(d)}this.storys.sort(this.sortFunc);this.showStoryBySid(0)};StoryWin.prototype.getRolePic=function(pic){var rolePic=pic||"";if(rolePic.indexOf("zhanshi")>-1){var job=SubRoles.ins().getFirstJob();switch(job){case 1:rolePic="story_zhanshi";break;case 2:rolePic="story_fashi";break;case 3:rolePic="story_daoshi";break}}return rolePic};StoryWin.prototype.showStoryBySid=function(sid){if(sid===void 0){sid=0}var self=this;if(sid>=self.storys.length){this.endUpStory();return}var story=self.storys[sid];if(!story){this.endUpStory();return}var bgmFile=story.bgmFile;var bgmMode=story.bgmMode;if(bgmFile&&sid==0){this.stopBGM();this.bgm=SoundManager.ins().playEffectImpl(bgmFile+"_mp3",bgmMode=="loop"?0:1)}var title=story.title;self.leftTitle.text=self.rightTitle.text=title||"";self.leftIcon.source=this.getRolePic(story.leftIconFile)||"";self.rightIcon.source=this.getRolePic(story.rightIconFile)||"";self.context.text=story.content||"";var speakerPos=story.speakerPos;self.currentState=speakerPos=="L"?"left":"right";var bgPic=story.bgPic;self.bgPic.source=bgPic;var particlePic=story.particlePic||"";self.particlePic=particlePic;this.blackImg.visible=false;this.btnSkip.visible=false;self.showDragonMcBySid(sid)};StoryWin.prototype.playSoundBySid=function(sid){if(sid===void 0){sid=0}var self=this;if(sid>=self.storys.length){this.endUpStory();return}var story=self.storys[sid];if(!story){this.endUpStory();return}this.stopEff();var effFile1=story.effFile1;var effMode1=story.effMode1;var effFile2=story.effFile2;var effMode2=story.effMode2;if(effFile1){this.eff1=SoundManager.ins().playEffectImpl(effFile1+"_mp3",effMode1=="loop"?0:1)}if(effFile2){this.eff2=SoundManager.ins().playEffectImpl(effFile2+"_mp3",effMode2=="loop"?0:1)}};StoryWin.prototype.showDragonMcBySid=function(sid){if(sid===void 0){sid=0}var self=this;self.sid=sid;var story=self.storys[sid];if(!story){return}self.mcGroup.visible=true;self.labelGroup.visible=false;var dbFile=story.dbFile;var dbTextureNum=story.dbTextureNum||1;var mcFiles=story.mcFiles||[];var mcMode=story.mcMode||"once";var content=story.content||"";var nextFunc=function(){if(content.length>0){self.showContext()}else{self.showNextRow()}};if(!dbFile){console.log(i18n("StoryWin_0"));nextFunc();return}if(mcFiles.length<=1){self.showContext()}if(!mcFiles){console.log(i18n("StoryWin_1"));nextFunc();return}var compFunc=function(){if(mcFiles.length>1){nextFunc()}};if(!self.dbAni){var ani=new DragonBones(dbFile,dbTextureNum,compFunc,mcFiles,true,"_png",this.needBody);ani.x=this.mcGroup.width/2;ani.y=this.mcGroup.height/2;self.mcGroup.addChild(ani);self.dbAni=ani}else{self.dbAni.playActionArray(mcFiles,mcMode=="loop"?true:false,compFunc)}};StoryWin.prototype.showContext=function(){var self=this;var story=this.storys[this.sid];if(!story){return}self.playSoundBySid(this.sid);if(this.bgPic.source){setTimeout(function(){if(self.context.text.length>0){self.labelGroup.visible=true;self.btnSkip.visible=true;self.blackImg.visible=true}else{console.log(i18n("StoryWin_2"))}},1500)}else{if(self.context.text.length>0){self.labelGroup.visible=true;self.btnSkip.visible=true;self.blackImg.visible=true}else{console.log(i18n("StoryWin_3"))}}};StoryWin.prototype.clearSound=function(){this.stopBGM();this.stopEff()};StoryWin.prototype.stopBGM=function(){if(this.bgm){SoundManager.ins().stopEffect(this.bgm)}this.bgm=null};StoryWin.prototype.stopEff=function(){if(this.eff1){SoundManager.ins().stopEffect(this.eff1)}if(this.eff2){SoundManager.ins().stopEffect(this.eff2)}this.eff1=null;this.eff2=null};StoryWin.prototype.endUpStory=function(){console.log("endUpStory!!!!!");RoleAI.ins().setStoryMode(false);this.clearSound();TimerManager.ins().removeAll(this);ViewManager.ins().close(this)};StoryWin.prototype.showNextRow=function(){this.sid++;if(this.sid>=this.storys.length){this.endUpStory()}else{this.showStoryBySid(this.sid)}};StoryWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTap);if(this.closeCallback){this.closeCallback()}this.closeTween()};StoryWin.prototype.onTap=function(e){switch(e.target){case this.btnNext:this.showNextRow();break;case this.btnSkip:this.endUpStory();break}};return StoryWin}(BaseEuiView);__reflect(StoryWin.prototype,"StoryWin");ViewManager.ins().reg(StoryWin,LayerManager.UI_Popup);var StrategySys=function(_super){__extends(StrategySys,_super);function StrategySys(){var _this=_super.call(this)||this;_this.sysId=PackageID.StrategyReward;_this.regNetMsg(1,_this.postGetData);_this.regNetMsg(2,_this.postGetReward);_this.initData();return _this}StrategySys.ins=function(){if(this._instance==null){this._instance=new StrategySys}return this._instance};StrategySys.prototype.initData=function(){this.data=[]};StrategySys.prototype.canReward=function(){for(var i=1;i<this.data.length;i++){if((this.data[i]||0)<1)return true}return false};StrategySys.prototype.getStateById=function(strategyId){return this.data[strategyId]||0};StrategySys.prototype.sendGetData=function(){var bytes=this.getBytes(1);this.sendToServer(bytes);console.log("97-1: send")};StrategySys.prototype.postGetData=function(bytes){var len=bytes.readInt();for(var i=1;i<=len;i++){this.data[i]=bytes.readInt()}console.log("97-1: post");this.postChange()};StrategySys.prototype.sendGetReward=function(strategyId){var bytes=this.getBytes(2);bytes.writeInt(strategyId);this.sendToServer(bytes);console.log("97-2: send")};StrategySys.prototype.postGetReward=function(bytes){var strategyId=bytes.readInt();this.data[strategyId]=1;console.log("97-2: post");this.postChange();this.postShowReward(GlobalConfig.StrategyRewardConfig[strategyId].reward)};StrategySys.prototype.postChange=function(){};StrategySys.prototype.postShowReward=function(reward){return reward};return StrategySys}(BaseSystem);__reflect(StrategySys.prototype,"StrategySys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.strategySys=StrategySys.ins.bind(StrategySys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var StrategyTabRender=function(_super){__extends(StrategyTabRender,_super);function StrategyTabRender(){var _this=_super.call(this)||this;_this.skinName="BtnTab9Skin";return _this}StrategyTabRender.prototype.dataChanged=function(){var data=this.data;this.labelDisplay.text=data.title+"";if(this.selected){this.skin.currentState="down"}else{this.skin.currentState="up"}};return StrategyTabRender}(BaseItemRender);__reflect(StrategyTabRender.prototype,"StrategyTabRender");var StrategyWin=function(_super){__extends(StrategyWin,_super);function StrategyWin(){var _this=_super.call(this)||this;_this.selectedIndex=-1;_this.strategyId=1;_this.skinName="StrategyWinSkin";_this.isTopLevel=true;_this.list.itemRenderer=StrategyTabRender;_this.listData=new eui.ArrayCollection;_this.list.dataProvider=_this.listData;return _this}StrategyWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.addTouchEvent(this.btnClose,this.onTap);this.addTouchEvent(this.btnGetReward,this.onTap);this.addChangeEvent(this.list,this.onTab);this.observe(StrategySys.ins().postChange,this.updateShow);this.observe(StrategySys.ins().postShowReward,this.showReward);this.observe(Rank.ins().postRankingData,this.setRank);Rank.ins().sendGetRankingData(RankDataType.TYPE_POWER);this.list.selectedIndex=args[0]||0;if(!this.cfg||this.cfg.length<=0){this.cfg=[];var list=GlobalConfig.StrategyConfig[this.strategyId];for(var k in list){if(list[k])this.cfg.push(list[k])}}if(!this.cfgReward){this.cfgReward=GlobalConfig.StrategyRewardConfig[this.strategyId]}this.listData.replaceAll(this.cfg);this.updateShow()};StrategyWin.prototype.close=function(){this.removeTouchEvent(this.btnClose,this.onTap);this.removeObserve();ViewManager.ins().close(this)};StrategyWin.prototype.onTap=function(e){switch(e.currentTarget){case this.btnClose:this.close();break;case this.btnGetReward:StrategySys.ins().sendGetReward(this.strategyId);break}};StrategyWin.prototype.updateShow=function(){this.setInfo()};StrategyWin.prototype.setInfo=function(){this.nameTxt.text=Actor.myName;var roleData=SubRoles.ins().getSubRoleByIndex(0);this.face.source="yuanhead"+roleData.job+roleData.sex;var lv=Actor.level;var zs=UserZs.ins()?UserZs.ins().lv:0;this.lblLv.textFlow=TextFlowMaker.generateTextFlow(zs>0?i18n("StrategyWin_1",zs,lv):i18n("StrategyWin_1_2",lv));this.lblZhanli.textFlow=TextFlowMaker.generateTextFlow(i18n("StrategyWin_2",Actor.power));this.lblZhanliPH.textFlow=TextFlowMaker.generateTextFlow(i18n("StrategyWin_3",this.selfPos?this.selfPos:i18n("RankingWin_0")));this.lblTitle.text=this.list.selectedItem.title;this.lblDesc.text=this.list.selectedItem.desc;if(this.cfgReward){this.itemGroup.visible=true;this.reward.data=this.cfgReward.reward[0];var state=StrategySys.ins().getStateById(this.strategyId);switch(state){case 0:this.redPoint.visible=true;this.btnGetReward.label="领取";this.btnGetReward.enabled=true;break;case 1:this.redPoint.visible=false;this.btnGetReward.skin.currentState="disabled";this.btnGetReward.label="已领";this.btnGetReward.touchEnabled=false;break;default:this.itemGroup.visible=false}}else{this.itemGroup.visible=false}};StrategyWin.prototype.onTab=function(e){this.lblTitle.text=this.list.selectedItem.title;this.lblDesc.text=this.list.selectedItem.desc};StrategyWin.prototype.setRank=function(rankModel){if(rankModel.type!=RankDataType.TYPE_POWER)return;this.selfPos=rankModel.selfPos;this.setInfo()};StrategyWin.prototype.showReward=function(reward){if(reward){ViewManager.ins().open(ActivityRewardTipWin,reward)}};return StrategyWin}(BaseEuiView);__reflect(StrategyWin.prototype,"StrategyWin");ViewManager.ins().reg(StrategyWin,LayerManager.UI_Main);var StrengthMgr=function(_super){__extends(StrengthMgr,_super);function StrengthMgr(){var _this=_super.call(this)||this;_this.rates=[.8,.95,1.1];_this.titles=[i18n("StrengthMgr_0"),i18n("StrengthMgr_1"),i18n("StrengthMgr_2"),i18n("StrengthMgr_3")];_this.colors=[16777215,12248317,16633513,16562877];_this.targetType={zjLevel:1,zhanLi:2,neiGong:3};_this.curRoleId=StrengthMgr.ROLE_ONE_ID;_this.rewardData=[];_this.progRates={};_this.sysId=PackageID.Strength;_this.regNetMsg(1,_this.postGetInfo);_this.regNetMsg(2,_this.postGetZLReward);return _this}StrengthMgr.ins=function(){return _super.ins.call(this)};StrengthMgr.prototype.sendGetInfoReq=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};StrengthMgr.prototype.postGetInfo=function(bytes){this.lastGetLevel=bytes.readInt();this.lastGetZSLevel=bytes.readInt()};Object.defineProperty(StrengthMgr.prototype,"lastGetLevel",{get:function(){return this._lastGetLevel},set:function(value){if(value<0)value=0;if(value>StrengthMgr.MAX_LEVEL)value=StrengthMgr.MAX_LEVEL;this._lastGetLevel=value},enumerable:true,configurable:true});Object.defineProperty(StrengthMgr.prototype,"lastGetZSLevel",{get:function(){return this._lastGetZSLevel},set:function(value){if(value<0)value=0;if(value>StrengthMgr.MAX_ZSLEVEL)value=StrengthMgr.MAX_ZSLEVEL;this._lastGetZSLevel=value},enumerable:true,configurable:true});StrengthMgr.prototype.sendGetZLReward=function(getLv,zsLevel,totalZhanLi,rewardData){this.rewardData=rewardData;var bytes=this.getBytes(2);bytes.writeInt(getLv);bytes.writeInt(zsLevel);bytes.writeInt(totalZhanLi);this.sendToServer(bytes)};StrengthMgr.prototype.postGetZLReward=function(bytes){var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code==0&&this.rewardData){ViewManager.ins().open(StrengthWarnWin,this.rewardData)}UserTips.ins().showTips(error_msg)};StrengthMgr.prototype.getTotalZhanLi=function(){return SubRoles.ins().getTotalPower()};StrengthMgr.prototype.getRoleZhanLiById=function(roleId){var model=SubRoles.ins().getSubRoleByIndex(roleId);return model?model.power:0};StrengthMgr.prototype.isOpen=function(){return Actor.level>=StrengthMgr.START_LEVEL};StrengthMgr.prototype.isHaveTask=function(){var len=SubRoles.ins().subRolesLen;for(var id=0;id<len;++id){if(this.isHaveTaskByRoleId(id)){return true}}return false};StrengthMgr.prototype.isHaveTaskByRoleId=function(roleId){var cfg=this.getTaskCfgByRoleId(roleId);this.getSortedDataById(roleId);for(var c in cfg){if(cfg[c]&&StrengthTaskRedPoint.ins().getVisibleByWinId(cfg[c].winId)&&this.progRates&&this.progRates[roleId]&&this.progRates[roleId][cfg[c].id]<1&&this.progRates[roleId][cfg[c].id]>=0){return true}}return false};StrengthMgr.prototype.getTaskCfgByRoleId=function(roleId){var cfg;switch(roleId){case StrengthMgr.ROLE_ONE_ID:cfg=GlobalConfig.RoleOneTaskConfig;break;case StrengthMgr.ROLE_TWO_ID:cfg=GlobalConfig.RoleTwoTaskConfig;break;case StrengthMgr.ROLE_THREE_ID:cfg=GlobalConfig.RoleThreeTaskConfig;break}return cfg};StrengthMgr.prototype.getSortedDataById=function(roleId){var taskCfg=this.getTaskCfgByRoleId(roleId);var targetIdx=this.getTargetIdx();var tasksNoPlay=[];var tasksPlaying=[];var tasksFinished=[];var fbRate;if(taskCfg&&targetIdx){for(var id in taskCfg){var data=taskCfg[id];if(data){if(data.winId==WinType.fb){fbRate={id:id,rate:StrengthMgr.TASK_STATUS_NOPLAY};continue}if(WinOpenMgr.ins().isOpen(data.winId)){var progRate_1=0;var targetType=this.targetType;var targetValue=data[targetIdx]||1;if(data.dataformat==targetType.zhanLi){var totalZhanLi=ZhanLiData.ins().getZhanLi(data.winId,data.iconId);progRate_1=totalZhanLi/targetValue}else if(data.dataformat==targetType.zjLevel){var curLevel=this.getZhanJiLv(roleId,parseInt(id)-1);progRate_1=curLevel/targetValue}else if(data.dataformat==targetType.neiGong){var neiGongData=NeiGongModel.ins().neiGongList[roleId];progRate_1=neiGongData&&neiGongData.stage!=null?neiGongData.stage/targetValue:0}progRate_1=progRate_1?parseFloat(progRate_1.toFixed(2)):progRate_1;if(progRate_1>=1){tasksFinished.push({id:id,rate:StrengthMgr.TASK_STATUS_FINISHED})}else if(progRate_1>0){tasksPlaying.push({id:id,rate:progRate_1})}else if(progRate_1==0){tasksNoPlay.push({id:id,rate:StrengthMgr.TASK_STATUS_NOPLAY})}}}}}tasksNoPlay.sort(function(a,b){return parseInt(a.id)-parseInt(b.id)});tasksPlaying.sort(function(a,b){return a.rate-b.rate});tasksFinished.sort(function(a,b){return parseInt(a.id)-parseInt(b.id)});if(fbRate&&WinOpenMgr.ins().isOpen(WinType.fb)){if(FbRedPoint.ins().redpoint){tasksNoPlay.unshift(fbRate)}else{tasksFinished.unshift(fbRate)}}var taskRates=[];taskRates=taskRates.concat(tasksNoPlay,tasksPlaying,tasksFinished);var taskDataSorted=[];var progRates={};for(var i=0;i<taskRates.length;++i){if(taskCfg[taskRates[i].id]){taskDataSorted.push(taskCfg[taskRates[i].id]);progRates[taskRates[i].id]=taskRates[i].rate}}this.progRates[roleId]=progRates;return taskDataSorted};StrengthMgr.prototype.getTargetIdx=function(){var level=Actor.level;var zsLevel=UserZs.ins().lv;var levelStr="level_";var targetIdx=zsLevel>0?levelStr+zsLevel:levelStr+this.getFormatLv(level);return targetIdx};StrengthMgr.prototype.getFormatLv=function(level){if(level<StrengthMgr.START_LEVEL)return StrengthMgr.START_LEVEL;var maxLevel=StrengthMgr.MAX_LEVEL;if(level>=maxLevel)return maxLevel;return level-level%StrengthMgr.INTERVAL_LEVEL};StrengthMgr.prototype.getNextFormatLv=function(level){if(level<=0)return StrengthMgr.START_LEVEL;return this.getFormatLv(level)+StrengthMgr.INTERVAL_LEVEL};StrengthMgr.prototype.isHaveZhanLiReward=function(){var totalZhanLi=StrengthMgr.ins().getTotalZhanLi();var level=Actor.level;var zsLevel=UserZs.ins().lv;var nextZSLevel=StrengthMgr.ins().lastGetZSLevel+1;var nextFormatLv=StrengthMgr.ins().getNextFormatLv(StrengthMgr.ins().lastGetLevel);var cfg;if(zsLevel>0&&nextZSLevel>StrengthMgr.MAX_ZSLEVEL||zsLevel<=0&&nextFormatLv>StrengthMgr.MAX_LEVEL){}else{var lastGetLevel=StrengthMgr.ins().lastGetLevel;var startLv=StrengthMgr.START_LEVEL;if(lastGetLevel<StrengthMgr.MAX_LEVEL){if(level>=nextFormatLv){cfg=GlobalConfig.StrengthLvZhanLiConfig[nextFormatLv];if(cfg&&totalZhanLi>=cfg.zhanLi){return true}}}else{var lastGetZSLevel=StrengthMgr.ins().lastGetZSLevel;if(zsLevel>lastGetZSLevel){cfg=GlobalConfig.StrengthLvZhanLiConfig[nextZSLevel];if(cfg&&totalZhanLi>=cfg.zhanLi){return true}}}}return false};StrengthMgr.prototype.getIndexByRate=function(rate){var index=0;while(rate>=this.rates[index]&&index<this.rates.length)++index;return index};StrengthMgr.prototype.isChaoShenByIndex=function(index){return index>=this.rates.length-1};StrengthMgr.prototype.getZhanJiLv=function(roleId,taskId){var level=0;var role=SubRoles.ins().getSubRoleByIndex(this.curRoleId);if(role){var skillLevel=role.skillsData[taskId];level=skillLevel?skillLevel.lv:0}return level};StrengthMgr.prototype.isShowByLevel=function(cfglevel){var zsLevel=UserZs.ins().lv;var aLevel=Actor.level;var showLv=zsLevel>0?zsLevel:this.getFormatLv(aLevel);return cfglevel==showLv};StrengthMgr.ROLE_ONE_ID=0;StrengthMgr.ROLE_TWO_ID=1;StrengthMgr.ROLE_THREE_ID=2;StrengthMgr.START_LEVEL=50;StrengthMgr.INTERVAL_LEVEL=10;StrengthMgr.MAX_LEVEL=80;StrengthMgr.MAX_ZSLEVEL=12;StrengthMgr.TASK_STATUS_NOPLAY=0;StrengthMgr.TASK_STATUS_PLAYING=2;StrengthMgr.TASK_STATUS_FINISHED=1;return StrengthMgr}(BaseSystem);__reflect(StrengthMgr.prototype,"StrengthMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.strength=StrengthMgr.ins.bind(StrengthMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var progRate=function(){function progRate(){}return progRate}();__reflect(progRate.prototype,"progRate");var StrengthTaskRedPoint=function(_super){__extends(StrengthTaskRedPoint,_super);function StrengthTaskRedPoint(){return _super.call(this)||this}StrengthTaskRedPoint.ins=function(){if(this._instance==null){this._instance=new StrengthTaskRedPoint}return this._instance};StrengthTaskRedPoint.prototype.hasTask=function(){var hasTask=false;var cfgs=GlobalConfig.WinOpenConfig;for(var winId in cfgs){if(cfgs[winId]&&cfgs[winId].winId&&this.getVisibleByWinId(cfgs[winId].winId)){hasTask=true;break}}return hasTask};StrengthTaskRedPoint.prototype.getVisibleByWinId=function(winId){var visible=false;switch(winId){case WinType.shengXing:visible=SpecialRing.ins().checkHaveUpRing();break;case WinType.ringSkill:visible=SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill();break;case WinType.wuShuangYin:visible=LyMark.ins().checkRed();break;case WinType.jueShi:visible=ExtremeEquipModel.ins().getRedPoint();break;case WinType.heirloom:visible=Heirloom.ins().checkRedPoint();break;case WinType.yuXi:var len0=SubRoles.ins().subRolesLen;for(var i=0;i<len0;i++){visible=JadeNew.ins().checkRedByRoleID(i);break}break;case WinType.yuPei:var len1=SubRoles.ins().subRolesLen;for(var i=0;i<len1;i++){visible=JadeNew.ins().checkRedByRoleID(i);break}break;case WinType.bingFa:visible=this.getBingFaVisible();break;case WinType.hunPo:visible=this.getHunPoVisible();break;case WinType.fuWen:var len2=SubRoles.ins().subRolesLen;for(var i=0;i<len2;i++){visible=RuneRedPointMgr.ins().checkRoleAllSituation(i);break}break;case WinType.wing:visible=this.getWingVisible();break;case WinType.lingYu:visible=GodWingRedPoint.ins().getGodWingRedPoint();break;case WinType.liuDao:visible=SamsaraModel.ins().isCanUpgrade()||SamsaraModel.ins().isCanExchange()||!SamsaraModel.ins().isMaxSamsara(Actor.samsaraLv)&&SamsaraModel.ins().isCanUpgradeSoul();break;case WinType.neiGong:visible=NeiGongModel.ins().canUp();break;case WinType.xueWei:visible=this.getXueWeiVisible();break;case WinType.xianYu:visible=UserMiji.ins().isMjiSum();break;case WinType.guanZhi:visible=LiLian.ins().getLilianShenGongStast()||LiLian.ins().isGetTrainDayAwardAll();break;case WinType.yingHun:visible=BookRedPoint.ins().redpoint||BookRedPoint.ins().canLvlUp;break;case WinType.qiangHua:visible=ForgeRedPoint.ins().getRedPoint(0);break;case WinType.yeLian:visible=ForgeRedPoint.ins().getRedPoint(1);break;case WinType.jingDiao:visible=ForgeRedPoint.ins().getRedPoint(2);break;case WinType.jianLing:visible=ForgeRedPoint.ins().getRedPoint(3);break;case WinType.zhanJi:visible=this.and(UserSkill.ins().canGrewupSkill());break;case WinType.fb:visible=FbRedPoint.ins().redpoint;break}return visible};Object.defineProperty(StrengthTaskRedPoint.prototype,"curRole",{get:function(){return StrengthMgr.ins().curRoleId},enumerable:true,configurable:true});StrengthTaskRedPoint.prototype.and=function(list){for(var _i=0,list_21=list;_i<list_21.length;_i++){var k=list_21[_i];if(k==true)return true}return false};StrengthTaskRedPoint.prototype.getBingFaVisible=function(){var id=this.curRole;var visible=false;var roleTabs=HeartMethodRedPoint.ins().roleTabs;if(!roleTabs[id])return visible;for(var k in roleTabs[id]){if(roleTabs[id][k]){return true}}return visible};StrengthTaskRedPoint.prototype.getHunPoVisible=function(){var id=this.curRole;var visible=false;var roleTabs=HunguRedPoint.ins().roleTabs;if(roleTabs[id]){visible=roleTabs[id]}return visible};StrengthTaskRedPoint.prototype.getWingVisible=function(){var visible=Wing.ins().isHaveActivationWing()||GodWingRedPoint.ins().getGodWingRedPoint();return Actor.level>=GlobalConfig.WingCommonConfig.openLevel?visible:false};StrengthTaskRedPoint.prototype.getXueWeiVisible=function(){var visible=false;var role=SubRoles.ins().roles[this.curRole];if(role){var data=role.jingMaiData;if(data.jingMaiCanUp()){var openLevel=GlobalConfig.JingMaiCommonConfig.openLevel;if(Actor.level>=openLevel)visible=true}}return visible};return StrengthTaskRedPoint}(BaseSystem);__reflect(StrengthTaskRedPoint.prototype,"StrengthTaskRedPoint");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.strengthRedPoint=StrengthTaskRedPoint.ins.bind(StrengthTaskRedPoint)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ZhanLiData=function(_super){__extends(ZhanLiData,_super);function ZhanLiData(){var _this=_super.call(this)||this;_this.heartPages=[];_this.exPower=0;_this.observe(UserMiji.ins().postAdditionUpdate,_this.additionUpdate);return _this}ZhanLiData.ins=function(){if(this._instance==null){this._instance=new ZhanLiData}return this._instance};ZhanLiData.prototype.getZhanLi=function(type,id){var zhanLi=0;switch(type){case WinType.shengXing:zhanLi=this.getShengXingZL();break;case WinType.ringSkill:zhanLi=this.getRingSkillZL();break;case WinType.wuShuangYin:zhanLi=this.getWuShuangYinZL();break;case WinType.jueShi:zhanLi=this.getJueShiZL();break;case WinType.heirloom:zhanLi=this.getHeirloomZL();break;case WinType.yuXi:zhanLi=this.getYuXiZL();break;case WinType.yingHun:zhanLi=Book.ins().getBookPowerNumEx();break;case WinType.yuPei:zhanLi=this.getYuPeiZL();break;case WinType.bingFa:zhanLi=this.getBingFaZL();break;case WinType.hunPo:zhanLi=this.getHunPoZL();break;case WinType.fuWen:zhanLi=this.getFuWenZL();break;case WinType.wing:zhanLi=this.getWingZL();break;case WinType.lingYu:zhanLi=this.getLingYuZL();break;case WinType.liuDao:zhanLi=this.getLiuDaoZL();break;case WinType.xueWei:zhanLi=this.getXueWeiZL();break;case WinType.xianYu:zhanLi=this.getXianYuZL();break;case WinType.guanZhi:zhanLi=this.getGuanZhiZL();break;case WinType.qiangHua:zhanLi=this.getQiangHuaZL();break;case WinType.yeLian:zhanLi=this.getYeLianZL();break;case WinType.jingDiao:zhanLi=this.getJingDiaoZL();break;case WinType.jianLing:zhanLi=this.getJianLingZL();break}return zhanLi};Object.defineProperty(ZhanLiData.prototype,"curRole",{get:function(){return StrengthMgr.ins().curRoleId},enumerable:true,configurable:true});ZhanLiData.prototype.getShengXingZL=function(){var powerAttr=FireRingInfoPanel.getRingTotalAttribute();var p=UserBag.getAttrPower(powerAttr);p=p*SubRoles.ins().subRolesLen;return p};ZhanLiData.prototype.getRingSkillZL=function(){var info=SpecialRing.ins().skillInfo;if(!info)return 0;var count=info.length;var attr;var cfg;var book;var addPower=0;var addPercent;for(var i=0;i<count;i++){cfg=SpecialRing.ins().skillInfo[i];if(cfg&&cfg.skillId>0){book=SpecialRing.ins().getActorExRingBookConfig(cfg.skillId,cfg.skillLvl);if(!book)continue;if(cfg.skillId<=4){if(!attr){attr=book.attr}else{attr=AttributeData.AttrAddition(attr,book.attr)}}else if(cfg.skillId==5){addPercent=book.bookAttrPer}else if(cfg.skillId>5&&book.exPower){addPower+=book.exPower}}}var p=addPower;if(attr){if(addPercent){attr=AttributeData.AttrMultiply(attr,addPercent)}p+=UserBag.getAttrPower(attr)}p=p*SubRoles.ins().subRolesLen;return p};ZhanLiData.prototype.getJueShiZL=function(){var role=SubRoles.ins().getSubRoleByIndex(this.curRole);if(!role)return 0;var job=role.job;var positions=ExtremeEquipModel.ins().positions;var power=0;for(var i=0;i<positions.length;++i){power+=this.selectEquip(job,positions[i])}return power};ZhanLiData.prototype.selectEquip=function(job,subType){var role=SubRoles.ins().getSubRoleByJob(job);if(!role)return 0;var zhiZunLv=ExtremeEquipModel.ins().getZhiZunLv(job,subType);if(!zhiZunLv){return 0}else if(zhiZunLv>=ExtremeEquipModel.ins().getMaxZhiZunEquipLevel(subType)){var cfg=GlobalConfig.ZhiZunEquipLevel[subType][zhiZunLv];if(!cfg)return 0;var power2=Math.floor(UserBag.getAttrPower(cfg.attrs))+cfg.ex_power;power2+=ExtremeEquipPanel.getChainAddPower(subType,zhiZunLv,this.curRole);return power2}else{var preCfg=void 0;if(zhiZunLv==0){preCfg=GlobalConfig.ZhiZunEquipLevel[subType][1]}else{preCfg=GlobalConfig.ZhiZunEquipLevel[subType][zhiZunLv]}if(!preCfg)return 0;var power0=Math.floor(UserBag.getAttrPower(preCfg.attrs))+preCfg.ex_power;power0+=ExtremeEquipPanel.getChainAddPower(subType,zhiZunLv,this.curRole);return power0}};ZhanLiData.prototype.getWuShuangYinZL=function(){var level=LyMark.ins().lyMarkLv;var objAtts=[];var cfg=GlobalConfig.FlameStampLevel[level];var attr;if(!cfg)return 0;for(var k in cfg.attrs)objAtts.push(new AttributeData(cfg.attrs[k].type,cfg.attrs[k].value));var totalPower=UserBag.getAttrPower(objAtts);var skillLv,effectCfg;var bollNum=0,realLv=0;for(var i=0;i<=6;i++){realLv=skillLv=LyMark.ins().getSkillLvById(i+1);if(!skillLv)skillLv=1;effectCfg=GlobalConfig.FlameStampEffect[i+1][skillLv];if(!effectCfg)return 0;if(realLv)totalPower+=effectCfg.exPower}var roleNum=SubRoles.ins().subRolesLen;totalPower=totalPower*roleNum;return totalPower};ZhanLiData.prototype.getHeirloomZL=function(){var roleId=StrengthMgr.ins().curRoleId;var role=SubRoles.ins().getSubRoleByIndex(roleId);if(!role)return 0;var power=role.getAllHeirloomPower();return power};ZhanLiData.prototype.getYuXiZL=function(){var role=SubRoles.ins().getSubRoleByIndex(StrengthMgr.ins().curRoleId);var lv=role.loongSoulData.level;var config=GlobalConfig.LoongSoulConfig[lv];if(!config)return 0;var power=UserBag.getAttrPower(config.attr);return power};ZhanLiData.prototype.getYuPeiZL=function(){var curRole=StrengthMgr.ins().curRoleId;var jadeData=JadeNew.ins().getJadeDataByID(curRole);if(!jadeData)return 0;this._jadeData=jadeData;var level=jadeData.lv;var objAtts=[];var cfg=GlobalConfig.JadePlateLevelConfig[level];var attr;if(!cfg||!cfg.attrs)return 0;for(var k in cfg.attrs){attr=cfg.attrs[k];objAtts.push(new AttributeData(attr.type,attr.value))}objAtts=JadeNewPanel.addDanAtt(objAtts,this._jadeData);return UserBag.getAttrPower(objAtts,SubRoles.ins().getSubRoleByIndex(curRole))||0};ZhanLiData.prototype.getBingFaZL=function(){var power=0;var curRole=StrengthMgr.ins().curRoleId;for(var heartPos=0;heartPos<4;++heartPos){var id=this.getHeartId(heartPos);var proShowList=HeartMethod.ins().proShowList;var attrvalue=HeartMethod.ins().calcHeartTotalValue(this.curRole,id);var attr=[];for(var i=0;i<proShowList.length;i++){if(!proShowList[i])continue;var at=new AttributeData;at.type=proShowList[i].id;at.value=attrvalue[i];attr.push(at)}power=power+UserBag.getAttrPower(attr);if(!HeartMethod.ins().HeartMethodInfo)continue;var hminfo=HeartMethod.ins().HeartMethodInfo[this.curRole];if(hminfo){var hmdata=hminfo[id];if(hmdata){var hmLevelConfig=GlobalConfig.HeartMethodLevelConfig[id][hmdata.lv];if(hmLevelConfig){var lpower=hmLevelConfig.power?hmLevelConfig.power:0;power+=lpower}}}var suitLv=HeartMethod.ins().calcHeartSkillLevel(this.curRole,id);if(suitLv){var suitConfig=GlobalConfig.HeartMethodSuitConfig[id][suitLv];var expower=suitConfig&&suitConfig.power?suitConfig.power:0;power+=expower}}return power};ZhanLiData.prototype.getHeartId=function(posId){if(this.heartPages.length<=0){for(var k in GlobalConfig.HeartMethodConfig){this.heartPages.push(GlobalConfig.HeartMethodConfig[k])}this.heartPages.sort(function(a,b){if(a.sort<b.sort)return-1;else return 1})}if(this.heartPages[posId])return this.heartPages[posId].id||0;return 0};ZhanLiData.prototype.getHunPoZL=function(){var roleId=this.curRole;var ins=Hungu.ins();var power=ins.getResonancePower(roleId);var suit=ins.getSuitData(roleId);for(var i=0;i<GlobalConfig.HunGuConf.equipCount;i++){power+=ins.getHunguPosPower(roleId,i,suit,true)}return power};ZhanLiData.prototype.getFuWenZL=function(){var rdList=RuneDataMgr.ins().getRoleRune(this.curRole);if(!rdList)return;var rd=null;var cfg=null;var len=8;var attrPoint=0;for(var i=0;i<len;i++){rd=rdList[i];cfg=RuneConfigMgr.ins().getBaseCfg(rd);if(cfg)attrPoint+=UserBag.getAttrPower(cfg.attr)+(cfg.power||0)}return attrPoint};ZhanLiData.prototype.getWuShuangZL=function(){var equipList=UserSkill.ins().equipListData;var num=0;var len=equipList.length;if(equipList&&equipList.length<=0)return 0;for(var i=0;i<len;i++){var item=equipList[i];if(item&&item.configID){num+=item.point}}return num*SubRoles.ins().subRolesLen};ZhanLiData.prototype.getWingZL=function(){var role=SubRoles.ins().getSubRoleByIndex(this.curRole);if(!role)return 0;var wingsData=role.wingsData;var config=GlobalConfig.WingLevelConfig[wingsData.lv];var nextLvConfig=GlobalConfig.WingLevelConfig[wingsData.lv+1];var power=0;var totalPower=UserBag.getAttrPower(config.attr);var addAttrs=WingPanel.getDanAttrs(wingsData.lv,this.curRole);totalPower+=UserBag.getAttrPower(addAttrs);if(wingsData&&wingsData.exp&&nextLvConfig){var tempAttr=[];var attr=nextLvConfig.attr;if(!attr)return 0;var configPercent=GlobalConfig.WingCommonConfig.tempattr?GlobalConfig.WingCommonConfig.tempattr:1;for(var index=0;index<attr.length;index++){var attrs=new AttributeData;if(!attr[index])continue;attrs.type=attr[index].type;attrs.value=Math.ceil(wingsData.exp/config.exp*(configPercent*attr[index].value));tempAttr.push(attrs)}power=UserBag.getAttrPower(tempAttr)}totalPower=totalPower+power;return totalPower};ZhanLiData.prototype.getLingYuZL=function(){var gw=Wing.ins().getGodWing(this.curRole);if(!gw)return 0;var gwdata=gw.getData();var powers=0;var percent=0;var suitsum=gw.getSuitSum();if(suitsum>=Wing.GodWingMaxSlot){var minLevel=gw.getSuitLevel();var tmp=GlobalConfig.GodWingSuitConfig[minLevel];if(tmp)percent=tmp.precent/1e4}for(var k in gwdata){var glconfig=GlobalConfig.GodWingLevelConfig[gwdata[k].level][gwdata[k].slot];if(!glconfig)continue;var gwconfig=GlobalConfig.GodWingItemConfig[glconfig.itemId];if(!gwconfig)continue;var exPower=gwconfig.exPower?gwconfig.exPower:0;var newAttr=AttributeData.getPercentAttr(gwconfig.attr,percent);powers+=Math.floor(UserBag.getAttrPower(newAttr))+exPower}return powers};ZhanLiData.prototype.getLiuDaoZL=function(){var mode=SamsaraModel.ins().samsaraInfo;if(!mode)return 0;var lv=mode.lv;var cfg=GlobalConfig.ReincarnationLevel[lv];if(!cfg)return 0;var attrDesc=AttributeData.getAttStr(cfg.attrs,0,1,"  :  ");var power=UserBag.getAttrPower(cfg.attrs)*3;return power};ZhanLiData.prototype.getNeiGongZL=function(){var data=NeiGongModel.ins().neiGongList[this.curRole];if(!data){return 0}var cruLevelCfg=GlobalConfig.NeiGongStageConfig[data.stage][data.level];if(!cruLevelCfg){return 0}return UserBag.getAttrPower(cruLevelCfg.attribute)};ZhanLiData.prototype.getXueWeiZL=function(){var role=SubRoles.ins().getSubRoleByIndex(this.curRole);if(!role)return 0;var data=role.jingMaiData;var stagesConfig=GlobalConfig.JingMaiStageConfig[data.stage];var lvConfig=GlobalConfig.JingMaiLevelConfig[data.level];if(!stagesConfig||!lvConfig)return 0;return UserBag.getAttrPower(AttributeData.AttrAddition(stagesConfig.attr,lvConfig.attr))};ZhanLiData.prototype.getXianYuZL=function(){return this.exPower};ZhanLiData.prototype.additionUpdate=function(params){var roldid=params[0];var canEnhance=params[1];var minNewLevel=params[2];var exPower=params[3];if(roldid==this.curRole){this.exPower=exPower;console.log("curRole = "+this.curRole+" exPower = "+exPower)}};ZhanLiData.prototype.getGuanZhiZL=function(){return LiLian.ins().getPower()};ZhanLiData.prototype.getShenBingMaxZL=function(){var index=1;while(index<Artifact.ins().getMaxIndex()){if(this.getIsNext(index))index++}return Artifact.ins().getNewArtifactPower(index)||0};ZhanLiData.prototype.getIsNext=function(index){if(index==1)return true;var pidx=index-1;var cafd=Artifact.ins().getNewArtifactBy(pidx);if(!cafd||!cafd.open)return false;return true};ZhanLiData.prototype.getBingFuZL=function(){var lv=LiLian.ins().nobilityLv;var config=GlobalConfig.KnighthoodConfig[lv];if(!config)return 0;return UserBag.getAttrPower(config.attrs)||0};ZhanLiData.prototype.getQiangHuaZL=function(){return this.getForgeZLByType(ForgeWin.Page_Select_Boost)};ZhanLiData.prototype.getYeLianZL=function(){return this.getForgeZLByType(ForgeWin.Page_Select_Gem)};ZhanLiData.prototype.getJingDiaoZL=function(){return this.getForgeZLByType(ForgeWin.Page_Select_ZhuLing)};ZhanLiData.prototype.getForgeZLByType=function(type){var model=SubRoles.ins().getSubRoleByIndex(this.curRole);if(!model)return 0;return model.getForgeTotalPower(type)};ZhanLiData.prototype.getJianLingZL=function(){var role=SubRoles.ins().getSubRoleByIndex(this.curRole);if(!role)return 0;return role.getWeaponTotalPower()};return ZhanLiData}(BaseSystem);__reflect(ZhanLiData.prototype,"ZhanLiData");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.zhanLiData=ZhanLiData.ins.bind(ZhanLiData)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var StrengthRewardsRenderer=function(_super){__extends(StrengthRewardsRenderer,_super);function StrengthRewardsRenderer(){var _this=_super.call(this)||this;_this.skinName="StrengthRewardsItemSkin";var listItems=_this.listItems;listItems.dataProvider=new ArrayCollection([]);listItems.itemRenderer=ItemBase;return _this}StrengthRewardsRenderer.prototype.dataChanged=function(){var cfglevel=this.data;if(cfglevel==null)return;var cfg=GlobalConfig.StrengthLvZhanLiConfig[cfglevel];if(!cfg)return;this.rectCurLevelBg.visible=false;this.imgCurLevelBg.visible=false;this.imgLine.visible=true;this.lblGet.visible=false;if(cfglevel>=StrengthMgr.START_LEVEL){this.lblName.text=cfglevel+i18n("StrengthRewardsRenderer_0");this.lblGet.visible=cfglevel<=StrengthMgr.ins().lastGetLevel}else{this.lblGet.visible=cfglevel<=StrengthMgr.ins().lastGetZSLevel;this.lblName.text=cfglevel+i18n("StrengthRewardsRenderer_1")}if(StrengthMgr.ins().isShowByLevel(cfglevel)){this.rectCurLevelBg.visible=true;this.imgCurLevelBg.visible=true;this.imgLine.visible=false}this.lblZhanLi.text=cfg.zhanLi+"";var listData=[];var rewards=cfg.rewards;for(var i in rewards){if(rewards[i]){listData.push(rewards[i])}}var dataPro=this.listItems.dataProvider;dataPro.replaceAll(listData)};return StrengthRewardsRenderer}(BaseItemRender);__reflect(StrengthRewardsRenderer.prototype,"StrengthRewardsRenderer");var StrengthTaskItemRenderer=function(_super){__extends(StrengthTaskItemRenderer,_super);function StrengthTaskItemRenderer(){var _this=_super.call(this)||this;_this.lockSkin="Btn42Skin";_this.unlockSkin="Btn3Skin";_this.skinName="StrengthTaskItemSkin";return _this}StrengthTaskItemRenderer.prototype.initUI=function(){this.barTaskProg.value=0;this.lblProg.text="0%";this.redPoint.visible=true;this.lblComment.visible=true;this.btnGo.skinName=this.unlockSkin;this.btnGo.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGo,this)};StrengthTaskItemRenderer.prototype.dataChanged=function(){var data=this.data;if(data==null)return;this.initUI();var lblCurState=this.lblCurState;var lblComment=this.lblComment;var barTaskProg=this.barTaskProg;var btnGo=this.btnGo;var redPoint=this.redPoint;var groupProgress=this.groupProgress;var lblCurWord=this.lblCurWord;var lblDesc=this.lblDesc;var iconCfg=GlobalConfig.StrengthTargetIconConfig[data.iconId];var curRoleId=StrengthMgr.ins().curRoleId;this.imgTaskIcon.source=iconCfg?iconCfg.source:"";this.lblTaskTitle.text=data.title;var targetIdx=StrengthMgr.ins().getTargetIdx();var targetValue=data[targetIdx];var roleId=StrengthMgr.ins().curRoleId;var progRate=StrengthMgr.ins().progRates[roleId][data.id];var curState="";var progDesc="";var targetType=StrengthMgr.ins().targetType;var isZhanLi=data.dataformat==targetType.zhanLi;if(isZhanLi){progDesc=data.goaldesc+targetValue;if(data.isTotal&&data.isTotal==1){var totalZhanLi=StrengthMgr.ins().getTotalZhanLi();curState=totalZhanLi+""}else{var roleZhanLi=StrengthMgr.ins().getRoleZhanLiById(curRoleId);curState=roleZhanLi+""}}else if(data.dataformat==targetType.zjLevel){curState=StrengthMgr.ins().getZhanJiLv(curRoleId,data.id-1)+i18n("StrengthTaskItemRenderer_0");progDesc=data.goaldesc+(targetValue||"")+i18n("StrengthTaskItemRenderer_1")}else if(data.dataformat==targetType.neiGong){var neiGongData=NeiGongModel.ins().neiGongList[curRoleId];curState=neiGongData.stage+i18n("StrengthTaskItemRenderer_2");progDesc=data.goaldesc+targetValue+i18n("StrengthTaskItemRenderer_3")}progRate=progRate?parseFloat(progRate.toFixed(2)):progRate;lblCurState.text=curState;lblDesc.text=progDesc;var comment="";if(progRate<.8){comment=i18n("StrengthTaskItemRenderer_4")}else if(progRate<.9){comment=i18n("StrengthTaskItemRenderer_5")}else if(progRate<1){comment=i18n("StrengthTaskItemRenderer_6")}else if(progRate>=1){comment=i18n("StrengthTaskItemRenderer_7")}lblComment.text=comment;lblComment.y=isZhanLi?12:42;lblCurWord.visible=lblCurState.visible=!isZhanLi;btnGo.label=i18n("StrengthTaskItemRenderer_8");if(WinOpenMgr.ins().isOpen(data.winId)){barTaskProg.maximum=targetValue;barTaskProg.value=progRate*targetValue;groupProgress.visible=true;this.lblProg.text=parseInt(progRate*100+"")+"%";redPoint.visible=StrengthTaskRedPoint.ins().getVisibleByWinId(data.winId);this.lblTaskTitle.y=12;this.groupLock.visible=true}else{btnGo.label=i18n("StrengthTaskItemRenderer_9");btnGo.skinName=this.lockSkin;redPoint.visible=false;groupProgress.visible=false;this.lblTaskTitle.y=40;this.groupLock.visible=false}btnGo.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGo,this);if(progRate>=1){btnGo.label=i18n("StrengthTaskItemRenderer_10");redPoint.visible=false}if(data.winId==WinType.fb){lblDesc.text=data.goaldesc;groupProgress.visible=false;lblCurState.visible=false;lblComment.visible=false;lblCurWord.visible=false}};StrengthTaskItemRenderer.prototype.onBtnGo=function(){var data=this.data;if(data==null)return;if(WinOpenMgr.ins().isOpen(data.winId)){var winCfg=GlobalConfig.WinOpenConfig[data.winId];if(winCfg&&winCfg.winClass){if(winCfg.winId==WinType.lingYu||winCfg.winId==WinType.fuWen||winCfg.winId==WinType.heirloom){ViewManager.ins().open(winCfg.winClass,StrengthMgr.ins().curRoleId,winCfg.subWinId||0)}else{ViewManager.ins().open(winCfg.winClass,winCfg.subWinId||0,StrengthMgr.ins().curRoleId)}}}else{UserTips.ins().showTips(i18n("StrengthTaskItemRenderer_11"))}};return StrengthTaskItemRenderer}(BaseItemRender);__reflect(StrengthTaskItemRenderer.prototype,"StrengthTaskItemRenderer");var StrengthWarnWin=function(_super){__extends(StrengthWarnWin,_super);function StrengthWarnWin(){var _this=_super.call(this)||this;_this.skinName="StrengthWarnSkin";return _this}StrengthWarnWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.sureBtn,this.onClose);if(param&&param[0]){var selectIndex=param[0];var rewardsList=this.rewardsList;rewardsList.dataProvider=new ArrayCollection(param[0]);rewardsList.itemRenderer=ItemBase}};StrengthWarnWin.prototype.onClose=function(){this.close()};StrengthWarnWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeTouchEvent(this.sureBtn,this.onClose);_super.prototype.close.call(this);ViewManager.ins().close(this)};return StrengthWarnWin}(BaseEuiView);__reflect(StrengthWarnWin.prototype,"StrengthWarnWin");ViewManager.ins().reg(StrengthWarnWin,LayerManager.UI_Popup);var StrengthWin=function(_super){__extends(StrengthWin,_super);function StrengthWin(){var _this=_super.call(this)||this;_this.lastRoleId=0;_this.isNotMove=true;_this.greenColor=2358279;_this.yellowColor=16349795;_this.rewardData=[];_this.getLv=StrengthMgr.START_LEVEL;_this.skinName="StrengthSkin";_this.isTopLevel=true;return _this}StrengthWin.prototype.initUI=function(){this.lastRoleId=StrengthMgr.ROLE_ONE_ID;var listTask=this.listTask;listTask.dataProvider=new ArrayCollection([]);listTask.itemRenderer=StrengthTaskItemRenderer;var listReward=this.listReward;listReward.dataProvider=new ArrayCollection([]);listReward.itemRenderer=ItemBase;this.createPowerView()};StrengthWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}UserMiji.ins().sendAdditionUpdate(this.lastRoleId);this.addTouchEvent(this.btnClose,this.onClose);this.addTouchEvent(this.btnDetail,this.onBtnXiangQing);this.addTouchEvent(this.btnRecharge,this.onBtnRecharge);this.addTouchEvent(this.btnStrategy,this.onBtnStrategy);this.addChangeEvent(this.roleSelect,this.onSelectRole);this.observe(UserFb.ins().postGuanKaIdChange,this.updateShow);this.observe(UserZs.ins().postZsLv,this.updateShow);this.observe(GameServer.ins().postServerOpenDay,this.updateShow);this.observe(UserTask.ins().postUpdteTaskTrace,this.updateShow);this.observe(Actor.ins().postPowerChange,this.updateShow);this.observe(Actor.ins().postLevelChange,this.updateShow);this.observe(StrengthMgr.ins().postGetInfo,this.updateShow);this.observe(StrengthMgr.ins().postGetZLReward,this.updateShow);this.observe(UserMiji.ins().postAdditionUpdate,this.updateShow);this.observe(StrategySys.ins().postChange,this.updateStrategy);this.updateShow()};StrengthWin.prototype.playEff=function(){var groupEff=this.groupEff;var effMc=new MovieClip;effMc.x=0;effMc.y=0;var soure=RES_DIR_EFF+"chaoshen_eff";effMc.playFile(soure,-1);this.groupEff.addChild(effMc)};StrengthWin.prototype.updateShow=function(){this.updateRoleInfoById(this.lastRoleId);this.updateZhanLiInfo();this.updateStrategy()};StrengthWin.prototype.updateZhanLiInfo=function(){this.updateRecommendZhanLi();this.updateTotalPower();this.removeBtnEvent();var lblReward=this.lblReward;var totalZhanLi=StrengthMgr.ins().getTotalZhanLi();var level=Actor.level;var zsLevel=UserZs.ins().lv;this.lblLevel.text=zsLevel>0?zsLevel+i18n("StrengthWin_0"):level+i18n("StrengthWin_1");var nextZSLevel=StrengthMgr.ins().lastGetZSLevel+1;var nextFormatLv=StrengthMgr.ins().getNextFormatLv(StrengthMgr.ins().lastGetLevel);var hadGet=false;var cfg;var unit=zsLevel>0?i18n("StrengthWin_2"):i18n("StrengthWin_3");if(zsLevel>0&&nextZSLevel>StrengthMgr.MAX_ZSLEVEL||zsLevel<=0&&nextFormatLv>StrengthMgr.MAX_LEVEL){var cfgLevel=StrengthMgr.START_LEVEL;cfgLevel=zsLevel>0?StrengthMgr.ins().lastGetZSLevel:StrengthMgr.ins().lastGetLevel;cfg=GlobalConfig.StrengthLvZhanLiConfig[cfgLevel];if(zsLevel<=0&&nextFormatLv>StrengthMgr.MAX_LEVEL){cfg=GlobalConfig.StrengthLvZhanLiConfig[1];if(cfg&&totalZhanLi>=cfg.zhanLi&&zsLevel>=1){lblReward.text=i18n("StrengthWin_4");this.addRewardEvent()}else{lblReward.text=i18n("StrengthWin_5");this.addRechargeEvent()}}else{lblReward.textFlow=TextFlowMaker.generateTextFlow(cfgLevel+unit+i18n("StrengthWin_6")+i18n("StrengthWin_7"));this.addRechargeEvent()}}else{var lastGetLevel=StrengthMgr.ins().lastGetLevel;var startLv=StrengthMgr.START_LEVEL;unit=lastGetLevel<StrengthMgr.MAX_LEVEL?i18n("StrengthWin_8"):i18n("StrengthWin_9");if(lastGetLevel<StrengthMgr.MAX_LEVEL){if(level>=nextFormatLv){cfg=GlobalConfig.StrengthLvZhanLiConfig[nextFormatLv];if(cfg&&totalZhanLi>=cfg.zhanLi){lblReward.text=nextFormatLv+unit+i18n("StrengthWin_10");this.getLv=nextFormatLv;this.addRewardEvent()}else{lblReward.text=nextFormatLv+unit+i18n("StrengthWin_11");this.addRechargeEvent()}}else{var formatLv=StrengthMgr.ins().getFormatLv(lastGetLevel);cfg=GlobalConfig.StrengthLvZhanLiConfig[formatLv];lblReward.textFlow=TextFlowMaker.generateTextFlow(formatLv+unit+i18n("StrengthWin_12")+i18n("StrengthWin_13"));this.addRechargeEvent()}}else{var lastGetZSLevel=StrengthMgr.ins().lastGetZSLevel;if(zsLevel>lastGetZSLevel){cfg=GlobalConfig.StrengthLvZhanLiConfig[nextZSLevel];if(cfg&&totalZhanLi>=cfg.zhanLi){lblReward.text=nextZSLevel+unit+i18n("StrengthWin_14");this.addRewardEvent()}else{lblReward.text=nextZSLevel+unit+i18n("StrengthWin_15");this.addRechargeEvent()}}else{lastGetZSLevel=lastGetZSLevel<=0?1:lastGetZSLevel;cfg=GlobalConfig.StrengthLvZhanLiConfig[lastGetZSLevel];lblReward.textFlow=TextFlowMaker.generateTextFlow(lastGetZSLevel+unit+i18n("StrengthWin_16")+i18n("StrengthWin_17"));this.addRechargeEvent()}}}this.updateRewardData(cfg)};StrengthWin.prototype.updateRecommendZhanLi=function(){var level=Actor.level;var zsLevel=UserZs.ins().lv;var cfg;if(level<StrengthMgr.MAX_LEVEL){var formatLv=StrengthMgr.ins().getFormatLv(level);cfg=GlobalConfig.StrengthLvZhanLiConfig[formatLv]}else{if(zsLevel<=0){cfg=GlobalConfig.StrengthLvZhanLiConfig[StrengthMgr.MAX_LEVEL]}else{var cfgLevel=zsLevel>StrengthMgr.MAX_ZSLEVEL?StrengthMgr.MAX_ZSLEVEL:zsLevel;cfg=GlobalConfig.StrengthLvZhanLiConfig[cfgLevel]}}if(cfg){var totalZhanLi=StrengthMgr.ins().getTotalZhanLi();this.lblRecZhanLi.text=""+cfg.zhanLi;this.lblRecZhanLi.textColor=totalZhanLi>cfg.zhanLi?this.greenColor:this.yellowColor;var rate=totalZhanLi/cfg.zhanLi;var index=StrengthMgr.ins().getIndexByRate(rate);this.lblScore.text=StrengthMgr.ins().titles[index]||"";this.lblScore.textColor=StrengthMgr.ins().colors[index]||16777215;this.groupEff.removeChildren();if(StrengthMgr.ins().isChaoShenByIndex(index)){this.playEff()}}};StrengthWin.prototype.createPowerView=function(){this.totalPower=BitmapNumber.ins().createNumPic(0,"8",5);this.groupTotalPower.addChild(this.totalPower);this.totalPower.x=0;this.totalPower.y=0};StrengthWin.prototype.updateTotalPower=function(){var power=StrengthMgr.ins().getTotalZhanLi();BitmapNumber.ins().changeNum(this.totalPower,power,"8",5)};StrengthWin.prototype.removeBtnEvent=function(){this.btnGetReward.visible=false;this.btnRecharge.visible=false;this.redPoint.visible=false;this.removeTouchEvent(this.btnGetReward,this.onBtnGetReward);this.removeTouchEvent(this.btnRecharge,this.onBtnRecharge)};StrengthWin.prototype.addRewardEvent=function(){this.btnGetReward.visible=true;this.redPoint.visible=true;this.addTouchEvent(this.btnGetReward,this.onBtnGetReward)};StrengthWin.prototype.addRechargeEvent=function(){this.btnRecharge.visible=true;this.addTouchEvent(this.btnRecharge,this.onBtnRecharge)};StrengthWin.prototype.updateRewardData=function(cfg){var rewardData=[];if(cfg&&cfg.rewards){for(var k in cfg.rewards){rewardData.push(cfg.rewards[k])}}var dataPro=this.listReward.dataProvider;dataPro.replaceAll(rewardData);this.rewardData=rewardData};StrengthWin.prototype.onBtnGetReward=function(){var getLv=this.getLv>StrengthMgr.MAX_LEVEL?StrengthMgr.MAX_LEVEL:this.getLv;var getZSLv=StrengthMgr.ins().lastGetZSLevel+1;var totalZhanLi=StrengthMgr.ins().getTotalZhanLi();StrengthMgr.ins().sendGetZLReward(getLv,getZSLv,totalZhanLi,this.rewardData)};StrengthWin.prototype.onSelectRole=function(e){var id=this.roleSelect.getCurRole();UserMiji.ins().sendAdditionUpdate(id);this.updateRoleInfoById(id)};StrengthWin.prototype.updateRoleInfoById=function(roleId){this.updateRoleRedPoint();this.lblRoleZhanLi.text=StrengthMgr.ins().getRoleZhanLiById(roleId)+"";this.imgRoleNum.source="strengthrolenum"+(roleId+1);StrengthMgr.ins().curRoleId=roleId;var dataPro=this.listTask.dataProvider;dataPro.replaceAll(StrengthMgr.ins().getSortedDataById(roleId));if(this.lastRoleId!=roleId){this.lastRoleId=roleId;this.scroller.viewport.scrollV=0}};StrengthWin.prototype.updateRoleRedPoint=function(){this.roleSelect.clearRedPoint()};StrengthWin.prototype.onBtnXiangQing=function(){ViewManager.ins().open(StrengthXiangQingWin)};StrengthWin.prototype.onBtnRecharge=function(){Recharge.ins().tryShowChargeFirstWin()};StrengthWin.prototype.onClose=function(){this.close()};StrengthWin.prototype.close=function(){this.removeTouchEvent(this.btnClose,this.onClose);this.removeTouchEvent(this.btnDetail,this.onBtnXiangQing);this.removeTouchEvent(this.btnRecharge,this.onBtnRecharge);this.addChangeEvent(this.roleSelect,this.onSelectRole);this.removeObserve();ViewManager.ins().close(this);_super.prototype.close.call(this)};StrengthWin.prototype.onBtnStrategy=function(){ViewManager.ins().open(StrategyWin)};StrengthWin.prototype.updateStrategy=function(){this.redPoint0.visible=StrategySys.ins().canReward()};return StrengthWin}(BaseEuiView);__reflect(StrengthWin.prototype,"StrengthWin");ViewManager.ins().reg(StrengthWin,LayerManager.UI_Main);var StrengthXiangQingWin=function(_super){__extends(StrengthXiangQingWin,_super);function StrengthXiangQingWin(){var _this=_super.call(this)||this;_this.skinName="StrengthXiangQingSkin";_this.isTopLevel=true;_this.visible=false;return _this}StrengthXiangQingWin.prototype.initUI=function(){var listRewards=this.listRewards;listRewards.dataProvider=new ArrayCollection([]);listRewards.itemRenderer=StrengthRewardsRenderer};StrengthXiangQingWin.prototype.open=function(){var _this=this;var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.visible=false;this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.btnPreview,this.onBtnPreview);this.addTouchEvent(this.btnDetail,this.onBtnDetail);var listRewards=this.listRewards;var cfgs=GlobalConfig.StrengthLvZhanLiConfig;var levelData=[];var zsLevelData=[];for(var level in cfgs){if(cfgs[level].rewards){if(parseInt(level)>=StrengthMgr.START_LEVEL)levelData.push(level);else zsLevelData.push(level)}}levelData=levelData.concat(zsLevelData);var showIdx=0;for(var index in levelData){if(StrengthMgr.ins().isShowByLevel(levelData[index])){showIdx=parseInt(index);break}}var dataProvider=listRewards.dataProvider;dataProvider.replaceAll(levelData);TimerManager.ins().doTimer(40,1,function(){_this.scroller.viewport.scrollV=showIdx*120;_this.visible=true},this);if(args&&args[0]==1){this.onBtnDetail()}else{this.onBtnPreview()}};StrengthXiangQingWin.prototype.onBtnPreview=function(){this.groupRewards.visible=true;this.groupDetail.visible=false;this.title.text=i18n("StrengthXiangQingWin_0")};StrengthXiangQingWin.prototype.onBtnDetail=function(){this.groupRewards.visible=false;this.groupDetail.visible=true;this.title.text=i18n("StrengthXiangQingWin_1")};StrengthXiangQingWin.prototype.onClose=function(){this.close()};StrengthXiangQingWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeTouchEvent(this.btnPreview,this.onBtnPreview);this.removeTouchEvent(this.btnDetail,this.onBtnDetail);ViewManager.ins().close(this);_super.prototype.close.call(this)};return StrengthXiangQingWin}(BaseEuiView);__reflect(StrengthXiangQingWin.prototype,"StrengthXiangQingWin");ViewManager.ins().reg(StrengthXiangQingWin,LayerManager.UI_Main);var SwordSkinMgr=function(_super){__extends(SwordSkinMgr,_super);function SwordSkinMgr(){var _this=_super.call(this)||this;_this.selectedSkinId={};_this.swordSkinInfo={};_this.sysId=PackageID.SwordSkin;_this.regNetMsg(1,_this.postSwordSkinInfo);_this.regNetMsg(2,_this.postSwordSkinActivate);_this.regNetMsg(3,_this.postSwordSkinUpgrade);_this.regNetMsg(4,_this.postSwordSkinSelect);_this.regNetMsg(5,_this.postSwordSkinInvalid);return _this}SwordSkinMgr.ins=function(){return _super.ins.call(this)};Object.defineProperty(SwordSkinMgr.prototype,"SelectedSkinId",{get:function(){return this.selectedSkinId},enumerable:true,configurable:true});SwordSkinMgr.prototype.getSwordSkinNum=function(roleId){var num=0;for(var k in this.swordSkinInfo){var v=this.swordSkinInfo[k];var level=v[roleId];if(level>=0){num+=1}}return num};SwordSkinMgr.prototype.getSkinLevel=function(skinId,roleId){var levels=this.swordSkinInfo[skinId];var level=levels&&levels[roleId];return level};SwordSkinMgr.prototype.isSkinSelected=function(skinId,roleId){var res=false;var curSkinId=this.selectedSkinId[roleId];if(curSkinId&&curSkinId==skinId){res=true}return res};SwordSkinMgr.prototype.getCurSkin=function(roleId){var skinId=this.selectedSkinId[roleId]||-1;return skinId};SwordSkinMgr.prototype.getSelectedSkin=function(roleId){var skinId=this.selectedSkinId[roleId];var cfg=GlobalConfig.SwordSkinConfig[skinId];var a=cfg&&cfg.appearance||null;return a};SwordSkinMgr.prototype.showRedPoint2=function(skinId,roleId){var res=this.isSkinActivatable(skinId,roleId);if(res){return res}var res2=this.isSkinCanLevelUp(skinId,roleId);return res||res2};SwordSkinMgr.prototype.isSkinActivatable=function(skinId,roleId){var res=false;var cfg=GlobalConfig.SwordSkinConfig[skinId];var tryOn=cfg.tryOn;var item=tryOn&&tryOn.item||0;var mat=cfg&&cfg.mat||null;var level=this.getSkinLevel(skinId,roleId);if(item>0){var isHave=UserBag.ins().getBagGoodsCountById(0,item);if(isHave>0){res=true}}if(level==-1||level==0){if(mat){var isHave=UserBag.ins().getBagGoodsCountById(0,mat);if(isHave>0){res=true}}}return res};SwordSkinMgr.prototype.isSkinCanLevelUp=function(skinId,roleId){var res=false;var level=this.getSkinLevel(skinId,roleId);if(level<=0){return res}if(level>=10){return res}var cfg=GlobalConfig.SwordSkinLevelConfig[skinId][level];var mat=cfg&&cfg.cost&&cfg.cost.itemId||null;var num=cfg&&cfg.cost&&cfg.cost.num||0;if(mat){var isHave=UserBag.ins().getBagGoodsCountById(0,mat);res=isHave>=num}return res};SwordSkinMgr.prototype.showRedPoint=function(roleId){if(roleId===void 0){roleId=-1}var res=this.isSkinsActivatable(roleId);if(res){return res}var res2=this.isSkinsCanLevelUp(roleId);return res||res2};SwordSkinMgr.prototype.isSkinsActivatable=function(roleId){if(roleId===void 0){roleId=-1}var res=false;var cfg=GlobalConfig.SwordSkinConfig;for(var skinId in cfg){var row=cfg[skinId];if(!row){continue}if(roleId>0){if(row.roletype==roleId){res=SwordSkinMgr.ins().isSkinActivatable(row.id,row.roletype)}else{continue}}else{res=SwordSkinMgr.ins().isSkinActivatable(row.id,row.roletype)}if(res){break}}return res};SwordSkinMgr.prototype.isSkinsCanLevelUp=function(roleId){if(roleId===void 0){roleId=-1}var res=false;var cfg=GlobalConfig.SwordSkinConfig;for(var skinId in cfg){var row=cfg[skinId];if(!row){continue}if(roleId>0){if(row.roletype==roleId){res=SwordSkinMgr.ins().isSkinCanLevelUp(row.id,row.roletype)}else{continue}}else{res=SwordSkinMgr.ins().isSkinCanLevelUp(row.id,row.roletype)}if(res){break}}return res};SwordSkinMgr.prototype.getIdSwordSkinId=function(itemId){var allData=GlobalConfig.SwordSkinConfig;for(var key in allData){var element=allData[key];if(element.mat==itemId){return itemId}}return 0};SwordSkinMgr.prototype.isTrival=function(itemId){return itemId==this.getIdTrialId(itemId)};SwordSkinMgr.prototype.getIdTrialId=function(itemId){var allData=GlobalConfig.SwordSkinConfig;for(var key in allData){var element=allData[key];if(element.tryOn&&element.tryOn.item==itemId){return itemId}}return 0};SwordSkinMgr.prototype.getIdByTrialId=function(itemId){var info=this.swordSkinInfo;var allData=GlobalConfig.SwordSkinConfig;var trials=[];var elements=[];for(var key in allData){var element_4=allData[key];if(element_4.tryOn&&element_4.tryOn.item==itemId){elements.push(element_4);var id=element_4.id;for(var job=1;job<=3;job++){trials.push(element_4)}}}var e=null;var r=0;for(var _i=0,trials_2=trials;_i<trials_2.length;_i++){var element=trials_2[_i];var job_1=element.roletype;var role=SubRoles.ins().getSubRoleByJob(job_1);if(role){e=element;r=1;break}}if(!e){if(trials[0]){e=trials[0];r=2}else{var job_2=SubRoles.ins().getFirstJob();e=elements[job_2-1];r=0}}return[e,r]};SwordSkinMgr.prototype.sendGetSwordSkinInfo=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};SwordSkinMgr.prototype.postSwordSkinInfo=function(bytes){for(var i=1;i<=3;i++){this.selectedSkinId[i]=bytes.readInt()}this.swordSkinInfo={};var count=bytes.readInt();for(var i=0;i<count;i++){var skinId=bytes.readInt();var levelIDs={};for(var j=1;j<=3;j++){levelIDs[j]=bytes.readInt()}this.swordSkinInfo[skinId]=levelIDs}};SwordSkinMgr.prototype.sendSwordSkinActivate=function(skinId,roleId,isTrival){if(isTrival===void 0){isTrival=0}var bytes=this.getBytes(2);bytes.writeInt(skinId);bytes.writeInt(roleId);bytes.writeByte(isTrival);this.sendToServer(bytes)};SwordSkinMgr.prototype.postSwordSkinActivate=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var skinId=bytes.readInt();var roleId=bytes.readInt();var isTrival=bytes.readByte();console.log("postSwordSkinActivate");if(errid==0){this.swordSkinInfo[skinId][roleId]=isTrival==1?0:1}else{console.log(errmsg)}return[errid,errmsg]};SwordSkinMgr.prototype.sendSwordSkinUpgrade=function(skinId,roleId){var bytes=this.getBytes(3);bytes.writeInt(skinId);bytes.writeInt(roleId);this.sendToServer(bytes)};SwordSkinMgr.prototype.postSwordSkinUpgrade=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var skinId=bytes.readInt();var roleId=bytes.readInt();var newLevel=bytes.readInt();console.log("postSwordSkinUpgrade");if(errid==0){this.swordSkinInfo[skinId][roleId]=newLevel}else{console.log(errmsg)}return[errid,errmsg]};SwordSkinMgr.prototype.sendSwordSkinSelect=function(skinId,roleId){var bytes=this.getBytes(4);bytes.writeInt(skinId);bytes.writeInt(roleId);this.sendToServer(bytes)};SwordSkinMgr.prototype.postSwordSkinSelect=function(bytes){var errid=bytes.readInt();var errmsg=bytes.readString();var skinId=bytes.readInt();var roleId=bytes.readInt();console.log("postSwordSkinSelect");if(errid==0){this.selectedSkinId[roleId]=skinId}else{console.log(errmsg)}return[errid,errmsg]};SwordSkinMgr.prototype.postSwordSkinInvalid=function(bytes){var skinId=bytes.readInt();var cfg=GlobalConfig.SwordSkinConfig[skinId];var power=bytes.readInt();var str=i18n("SwordSkinMgr_0",cfg.name,power);PlayFunView.addExpiredFuncTip(str)};return SwordSkinMgr}(BaseSystem);__reflect(SwordSkinMgr.prototype,"SwordSkinMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.swordskinMgr=SwordSkinMgr.ins.bind(SwordSkinMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SwordSkinGiftRenderer=function(_super){__extends(SwordSkinGiftRenderer,_super);function SwordSkinGiftRenderer(){var _this=_super.call(this)||this;var self=_this;_this.skinName="SwordSkinGiftSkin";_this.touchChildren=true;return _this}SwordSkinGiftRenderer.prototype.dataChanged=function(){var obj=this.data;this.imgIcon.source=obj["icon"];this.blackImg.visible=!obj["activated"]};return SwordSkinGiftRenderer}(BaseItemRender);__reflect(SwordSkinGiftRenderer.prototype,"SwordSkinGiftRenderer");var SwordSkinGiftData=function(){function SwordSkinGiftData(){}return SwordSkinGiftData}();__reflect(SwordSkinGiftData.prototype,"SwordSkinGiftData");var SwordSkinGiftTips=function(_super){__extends(SwordSkinGiftTips,_super);function SwordSkinGiftTips(){var _this=_super.call(this)||this;_this.skinName="SwordSkinGiftTipsSkin";return _this}SwordSkinGiftTips.prototype.initUI=function(){_super.prototype.initUI.call(this)};SwordSkinGiftTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.addTouchEvent(this.bgClose,this.otherClose);this.giftName.text=param[0];this.attrDesc.text=param[1];if(!param[2]){this.condition.text=""}else{this.condition.text=param[2]+i18n("SwordSkinGiftTips_0")}this.extraDesc.text=param[3]||""};SwordSkinGiftTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};SwordSkinGiftTips.prototype.otherClose=function(e){ViewManager.ins().close(this)};return SwordSkinGiftTips}(BaseEuiView);__reflect(SwordSkinGiftTips.prototype,"SwordSkinGiftTips");ViewManager.ins().reg(SwordSkinGiftTips,LayerManager.UI_Popup);var SwordSkinItemRenderer=function(_super){__extends(SwordSkinItemRenderer,_super);function SwordSkinItemRenderer(){var _this=_super.call(this)||this;var self=_this;_this.skinName="SwordSkinBtn";_this.touchChildren=true;return _this}SwordSkinItemRenderer.prototype.dataChanged=function(){var obj=this.data;this.ringicon.source=obj["icon"];this.showRedPoint();this.rare.source="ss_rare_"+obj["rare"]};SwordSkinItemRenderer.prototype.showRedPoint=function(){var obj=this.data;this.state.visible=obj["level"]>=0?false:true;this.redPoint.visible=obj["activatable"]};SwordSkinItemRenderer.prototype.getId=function(){return this.data.id};return SwordSkinItemRenderer}(BaseItemRender);__reflect(SwordSkinItemRenderer.prototype,"SwordSkinItemRenderer");var SwordSkinItemData=function(){function SwordSkinItemData(){}return SwordSkinItemData}();__reflect(SwordSkinItemData.prototype,"SwordSkinItemData");var SwordSkinWin=function(_super){__extends(SwordSkinWin,_super);function SwordSkinWin(){var _this=_super.call(this)||this;_this.roleIndex=0;_this.isNotMove=true;_this.itemlistData=[];_this.costColor=14832565;_this.costItemId=0;_this.costNum=0;_this.recycleType=1;_this.giftlistData=[];_this.giftRatio=1;_this.nextGiftRatio=1;_this.sValue=null;_this.cSkin=-1;_this.cSkin2=-1;_this.skinName="SwordSkinWinSkin";return _this}SwordSkinWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.itemList.itemRenderer=SwordSkinItemRenderer;this.itemScroller.viewport=this.itemList;this.giftList.itemRenderer=SwordSkinGiftRenderer;this.giftScroller.viewport=this.giftList};SwordSkinWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.closeCallback=param[0];this.roleIndex=param[1]?param[1]:0;var id=param[2]||null;if(id){this.cSkin2=id}this.addChangeEvent(this.roleSelect,this.onChange);this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.btnActivate,this.onClick);this.addTouchEvent(this.btnUpgrade,this.onClick);this.addTouchEvent(this.btnSelect,this.onClick);this.addTouchEvent(this.btnCancel,this.onClick);this.addTouchEvent(this.btnCostDetail,this.onClick);this.addTouchEvent(this.arrowUp,this.onClick);this.addTouchEvent(this.arrowDown,this.onClick);this.addChangeEvent(this.itemScroller,this.onScroll);this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.giftList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGiftTap,this);this.observe(SwordSkinMgr.ins().postSwordSkinInfo,this.updatePanel);this.observe(SwordSkinMgr.ins().postSwordSkinActivate,this.onActivate);this.observe(SwordSkinMgr.ins().postSwordSkinUpgrade,this.onUpgrade);this.observe(SwordSkinMgr.ins().postSwordSkinSelect,this.onSelect);this.roleSelect.setCurRole(this.roleIndex);SwordSkinMgr.ins().sendGetSwordSkinInfo()};SwordSkinWin.prototype.onChange=function(e){this.sValue=null;this.roleIndex=this.roleSelect.getCurRole();this.reloadList();this.updatePanel()};SwordSkinWin.prototype.onItemTap=function(e){this.toId(e.itemIndex,false)};SwordSkinWin.prototype.onGiftTap=function(e){this.giftList.selectedIndex=e.itemIndex};SwordSkinWin.prototype.showGiftDetail=function(){var idx=0;var data=this.giftlistData[idx];if(!data){return}var gid=data.id;var cfg=GlobalConfig.SwordSkinGiftConfig[gid];if(!cfg){return}var name=cfg.des["name"]||"";var attrs=this.getGiftAttrs(gid);var desc=AttributeData.getAttStr(attrs,0,1,"：")+"\n";var extraDesc=i18n("SwordSkinWin_0")+Math.floor(this.getGiftRatio(gid)*100-100)+"%";var self=this;var curIdx=this.itemList.selectedIndex;var data2=this.itemlistData[curIdx];if(!data2){return}var openlv=10;var nextOpenlv=10;var skinId=data2.id;var roleId=this.roleIndex+1;var cfg2=GlobalConfig.SwordSkinConfig[skinId];var skill=cfg2.skill;for(var i=0;i<skill.length;i++){var v=skill[i];if(v["id"]==gid){openlv=v.openlv;nextOpenlv=skill[i+1]&&skill[i+1].openlv||10;break}}var cond=numToJie(openlv);var condNext=numToJie(nextOpenlv);if(data.activated){if(openlv<nextOpenlv){this.condition.text=condNext+i18n("SwordSkinWin_1")}else{this.condition.text=""}}else{this.condition.text=cond+i18n("SwordSkinWin_2")}this.giftName.text=name;this.attrDesc.text=desc;this.extraDesc.text=extraDesc||""};SwordSkinWin.prototype.showRedPoint=function(){for(var i=0;i<SubRoles.ins().subRolesLen;i++){var isShow=SwordSkinMgr.ins().showRedPoint(i+1);this.roleSelect.showRedPoint(i,isShow)}};SwordSkinWin.prototype.childrenCreated=function(){this.reloadList()};SwordSkinWin.prototype.reloadList=function(){var roleId=this.roleIndex+1;var cfg=GlobalConfig.SwordSkinConfig;var arr=[];for(var key in cfg){var v=cfg[key];if(v.roletype==roleId){var skinId=v.id;var level=SwordSkinMgr.ins().getSkinLevel(skinId,roleId);var obj=new SwordSkinItemData;obj["id"]=v.id;obj["icon"]=v.icon;obj["level"]=level;obj["sort"]=v.sort;obj["activatable"]=SwordSkinMgr.ins().showRedPoint2(skinId,roleId);obj["rare"]=v.rare;arr.push(obj)}}arr.sort(this.sortFunc);this.itemlistDt=new eui.ArrayCollection(arr);this.itemList.dataProvider=this.itemlistDt;this.itemlistData=arr};SwordSkinWin.prototype.refreshList=function(){var roleId=this.roleIndex+1;for(var i=0;i<this.itemlistDt.source.length;i++){var data=this.itemlistDt.source[i];var skinId=data.id;var level=SwordSkinMgr.ins().getSkinLevel(skinId,roleId);data["level"]=level;data["activatable"]=SwordSkinMgr.ins().showRedPoint2(skinId,roleId)}};SwordSkinWin.prototype.updatePanel=function(){var self=this;this.roleSelect.refreshPower(this.roleSelect._curRole);this.refreshList();var roleId=this.roleIndex+1;var curSkinId=SwordSkinMgr.ins().getCurSkin(roleId);if(this.cSkin2>-1){curSkinId=this.cSkin2;setTimeout(function(){self.cSkin2=-1},200)}if(this.cSkin>-1){curSkinId=this.cSkin;this.cSkin=-1}var id=this.skinIdToIndex(curSkinId);this.toId(id)};SwordSkinWin.prototype.skinIdToIndex=function(skinId){if(skinId<0){return 0}for(var i=0;i<this.itemlistData.length;i++){var item=this.itemlistData[i];if(item.id==skinId){return i}}return 0};SwordSkinWin.prototype.onActivate=function(param){var errid=param[0];var errmsg=param[1];if(errid==0){UserTips.ins().showTips(errmsg)}else{if(errid==3){ViewManager.ins().open(ShopGoodsWarn).setData(this.costItemId,this.costNum)}else{WarnWin.show(errmsg,function(){},this,undefined,undefined,"sure")}}};SwordSkinWin.prototype.onUpgrade=function(param){var errid=param[0];var errmsg=param[1];if(errid==0){this.updatePanel();this.updateDetail();UserTips.ins().showTips(errmsg)}else{if(errid==5){ViewManager.ins().open(ShopGoodsWarn).setData(this.costItemId,this.costNum)}else{WarnWin.show(errmsg,function(){},this,undefined,undefined,"sure")}}};SwordSkinWin.prototype.onSelect=function(param){var errid=param[0];var errmsg=param[1];if(errid==0){this.updateDetail();UserTips.ins().showTips(errmsg)}else{WarnWin.show(errmsg,function(){},this,undefined,undefined,"sure")}};SwordSkinWin.prototype.updateDetail=function(){var self=this;var curIdx=this.itemList.selectedIndex;var data=this.itemlistData[curIdx];if(!data){return}var skinId=data.id;var roleId=this.roleIndex+1;var cfg=GlobalConfig.SwordSkinConfig[skinId];var fjName=cfg["fjName"];this.fjNameImg.source=fjName;var rare=cfg["rare"];if(rare<1){rare=1}if(rare>5){rare=5}this.rareImg.source="ss_rare_"+rare;var fjMcFile=cfg["fjMcFile"];this.mcGroup.removeChildren();this.iconMc=new MovieClip;this.iconMc.x=0;this.iconMc.y=0;this.mcGroup.addChild(this.iconMc);this.iconMc.playFile(RES_DIR_EFF+fjMcFile,-1);var level=SwordSkinMgr.ins().getSkinLevel(skinId,roleId);var showLevel=level>0?level:1;this.lv.text=numToJie(showLevel);this.trialTxt.visible=false;this.btnActivate.visible=false;this.redPoint.visible=SwordSkinMgr.ins().showRedPoint2(skinId,roleId);this.btnUpgrade.visible=false;var cfg=GlobalConfig.SwordSkinConfig[skinId];var tryOn=cfg.tryOn;var item=tryOn&&tryOn.item||0;var lv=tryOn&&tryOn.level||80;var myLv=Actor.level;var mat=cfg&&cfg.mat||null;var type=1;var res1=false;var res2=false;if(item>0){var isHave=UserBag.ins().getBagGoodsCountById(0,item);res1=isHave>0}if(mat){var isHave=UserBag.ins().getBagGoodsCountById(0,mat);res2=isHave>0}if(res1&&!res2){type=2}if(!res1&&res2){type=3}if(res1&&res2){type=4}if(level==-1){switch(type){case 1:this.updateCost(cfg,skinId,level,2);this.btnActivate.visible=true;this.btnActivate.label=i18n("SwordSkinWin_11");break;case 2:this.updateCost(cfg,skinId,level,1);this.btnActivate.visible=true;this.btnActivate.label=myLv>=lv?i18n("SwordSkinWin_13"):i18n("SwordSkinWin_12");this.recycleType=1;break;case 3:this.updateCost(cfg,skinId,level,2);this.btnActivate.visible=true;this.btnActivate.label=i18n("SwordSkinWin_11");break;case 4:if(myLv>=lv){this.updateCost(cfg,skinId,level,2);this.btnActivate.label=i18n("SwordSkinWin_11")}else{this.updateCost(cfg,skinId,level,1);this.btnActivate.label=i18n("SwordSkinWin_12")}this.btnActivate.visible=true;break}}else if(level==0){this.trialTxt.visible=true;this.trialTxt.text=i18n("SwordSkinWin_19",lv);switch(type){case 1:this.updateCost(cfg,skinId,level,2);this.btnActivate.visible=true;this.btnActivate.label=i18n("SwordSkinWin_11");break;case 2:this.updateCost(cfg,skinId,level,1);this.btnActivate.visible=true;this.btnActivate.label=i18n("SwordSkinWin_13");this.recycleType=2;break;case 3:this.updateCost(cfg,skinId,level,2);this.btnActivate.visible=true;this.btnActivate.label=i18n("SwordSkinWin_11");break;case 4:this.updateCost(cfg,skinId,level,2);this.btnActivate.label=i18n("SwordSkinWin_11");this.btnActivate.visible=true;break}}else if(level<10){switch(type){case 1:this.updateCost(cfg,skinId,level,3);this.btnUpgrade.visible=true;break;case 2:this.updateCost(cfg,skinId,level,1);this.btnActivate.visible=true;this.btnActivate.label=i18n("SwordSkinWin_13");this.recycleType=3;break;case 3:this.updateCost(cfg,skinId,level,3);this.btnUpgrade.visible=true;break;case 4:this.updateCost(cfg,skinId,level,1);this.btnActivate.label=i18n("SwordSkinWin_13");this.btnActivate.visible=true;this.recycleType=3;break}}else{this.updateCost(cfg,skinId,level,4)}var num=SwordSkinMgr.ins().getSwordSkinNum(roleId);var used=SpecialRing.ins().isFireRingFuse();this.btnSelect.visible=level>=0&&level<=10&&(num>1||used)&&!SwordSkinMgr.ins().isSkinSelected(skinId,roleId)?true:false;this.btnCancel.visible=level>=0&&level<=10&&(num>1||used)&&SwordSkinMgr.ins().isSkinSelected(skinId,roleId)?true:false;this.giftRatio=1;this.nextGiftRatio=1;this.updateGift(cfg,skinId,roleId,level);this.updateLevelAttrs(cfg,skinId,roleId,level)};SwordSkinWin.prototype.showCostDetail=function(){if(!this.costItemId){return}var num=UserBag.ins().getBagGoodsCountById(0,this.costItemId);ViewManager.ins().open(ItemDetailedWin,0,this.costItemId,num)};SwordSkinWin.prototype.updateCost=function(cfg,skinId,level,costType){if(costType===void 0){costType=1}var colorStr=this.costColor;if(costType==1){var tryOn=cfg.tryOn;var item=tryOn.item||0;var cfg5=GlobalConfig.ItemConfig[item];if(!cfg5){console.log(i18n("SwordSkinWin_3")+item);this.clearCostText();return}var mat_name=cfg5.name;this.costTxt.textFlow=TextFlowMaker.generateTextFlow1(i18n("SwordSkinWin_4",colorStr,mat_name));this.costItemId=item;this.costNum=1;this.btnCostDetail.visible=true}else if(costType==2){var mat=cfg.mat;var cfg2=GlobalConfig.ItemConfig[mat];if(!cfg2){console.log(i18n("SwordSkinWin_3")+mat);this.clearCostText();return}var mat_name=cfg2.name;this.costTxt.textFlow=TextFlowMaker.generateTextFlow1(i18n("SwordSkinWin_4",colorStr,mat_name));this.costItemId=mat;this.costNum=1;this.btnCostDetail.visible=true}else if(costType==3){var cfg4=GlobalConfig.SwordSkinLevelConfig[skinId];var cost=cfg4&&cfg4[level]&&cfg4[level].cost||null;if(!cost){console.log(i18n("SwordSkinWin_5")+skinId+" level = "+level);this.clearCostText();return}var itemid=cost["itemId"];var num=cost["num"];var cfg3=GlobalConfig.ItemConfig[itemid];if(!cfg3){console.log(i18n("SwordSkinWin_6")+itemid);this.clearCostText();return}var cost_name=cfg3.name;this.costTxt.textFlow=TextFlowMaker.generateTextFlow1(i18n("SwordSkinWin_7",colorStr,cost_name,num));this.costItemId=itemid;this.costNum=num;this.btnCostDetail.visible=true}else{this.clearCostText()}};SwordSkinWin.prototype.clearCostText=function(){this.costTxt.text="";this.costItemId=0;this.costNum=0;this.btnCostDetail.visible=false};SwordSkinWin.prototype.updateGift=function(cfg,skinId,roleId,level){if(roleId===void 0){roleId=1}var self=this;var giftIDs=[];var skill=cfg["skill"];if(skill&&skill.length>0){for(var i=0;i<skill.length;i++){giftIDs.push(skill[i])}}var arr=[];for(var i=0;i<giftIDs.length;i++){var obj=giftIDs[i];var id=obj["id"];var openlv=obj["openlv"];var ratio=this.getGiftRatio(id);var data=new SwordSkinGiftData;data.id=id;data.icon=this.getGiftIcon(id);data.activated=false;data.openlv=openlv;var curLv=SwordSkinMgr.ins().getSkinLevel(skinId,roleId);var nextLv=curLv+1;if(nextLv>10){nextLv=10}if(curLv>=openlv){data.activated=true;if(ratio>this.giftRatio){this.giftRatio=ratio}}if(nextLv>openlv){if(ratio>this.nextGiftRatio){this.nextGiftRatio=ratio}}arr.push(data)}var arr_1=[];for(var i=0;i<arr.length;i++){var v=arr[i];if(v.activated==true){arr_1=[v]}}if(arr_1.length<=0){arr_1[0]=arr[0]}this.giftList.dataProvider=new eui.ArrayCollection(arr_1);this.giftlistData=arr_1;this.showGiftDetail()};SwordSkinWin.prototype.updateLevelAttrs=function(cfg,skinId,roleId,level){if(roleId===void 0){roleId=1}var self=this;this.cursor.visible=true;this.curAtt0.text="";if(level<1){var attrsRight=GlobalConfig.SwordSkinLevelConfig[skinId][1].attr;if(!attrsRight){return}var attrsLeft=[];for(var i=0;i<attrsRight.length;i++){var item=attrsRight[i];var t=item["type"];var v=0;attrsLeft.push({type:t,value:v})}var curAttrs=AttributeData.getAttStr(attrsLeft,0,1,"：")+"\n";var netAttrs=AttributeData.getAttStr(this.addGiftRatio(attrsRight,this.nextGiftRatio-1),0,1,"：")+"\n";this.curAtt.text=curAttrs;this.nextAtt.text=netAttrs}else if(level<10){var attrsLeft=GlobalConfig.SwordSkinLevelConfig[skinId][level].attr;var attrsRight=GlobalConfig.SwordSkinLevelConfig[skinId][level+1].attr;this.curAtt.text=AttributeData.getAttStr(this.addGiftRatio(attrsLeft,this.giftRatio-1),0,1,"：")+"\n";this.nextAtt.text=AttributeData.getAttStr(this.addGiftRatio(attrsRight,this.nextGiftRatio-1),0,1,"：")+"\n"}else{var attrsLeft=GlobalConfig.SwordSkinLevelConfig[skinId][level].attr;this.cursor.visible=false;this.curAtt.text="";this.curAtt0.text=AttributeData.getAttStr(this.addGiftRatio(attrsLeft,this.giftRatio-1),0,1,"：")+"\n";this.nextAtt.text=""}};SwordSkinWin.prototype.addGiftRatio=function(attrs,ratio){var attrsRes=[];for(var i=0;i<attrs.length;i++){var item=attrs[i];var t=item["type"];var v=Math.floor(item["value"]*(ratio+1));attrsRes.push({type:t,value:v})}return attrsRes};SwordSkinWin.prototype.sumAttrsToString=function(gids){var sum=null;for(var i=0;i<gids.length;i++){var gid=gids[i];var attr=this.getGiftAttrs(gid);if(attr){if(!sum){sum=attr}else{sum=AttributeData.AttrAddition(sum,attr)}}}var sumStr="";if(sum&&sum.length>0){sumStr=AttributeData.getAttStr(sum,0,1,"：")+"\n"}return sumStr};SwordSkinWin.prototype.getGiftAttrs=function(giftID){var attrs=[];var cfg=GlobalConfig.SwordSkinGiftConfig[giftID];if(!cfg){console.log(i18n("SwordSkinWin_8")+giftID);return null}attrs=cfg.attrs;var attrs2=[];if(!attrs||attrs.length<1){console.log(i18n("SwordSkinWin_9")+giftID);return null}for(var i=0;i<attrs.length;i++){var v=attrs[i];attrs2.push({type:v.type,value:v.value})}return attrs2};SwordSkinWin.prototype.getGiftRatio=function(giftID){var ratio=1;var cfg=GlobalConfig.SwordSkinGiftConfig[giftID];if(!cfg){console.log(i18n("SwordSkinWin_10")+giftID);return null}ratio=cfg.ratio;return ratio};SwordSkinWin.prototype.getGiftIcon=function(giftID){var icon="";if(giftID<1){return icon}var cfg=GlobalConfig.SwordSkinGiftConfig[giftID];if(!cfg){return icon}icon=cfg.des["icon"]||"";return icon};SwordSkinWin.prototype.sortFunc=function(a,b){var asid=a.sort;var bsid=b.sort;if(asid>bsid)return 1;if(asid<bsid)return-1;return 0};SwordSkinWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.btnActivate,this.onClick);this.removeTouchEvent(this.btnUpgrade,this.onClick);this.removeTouchEvent(this.btnSelect,this.onClick);this.removeTouchEvent(this.btnCancel,this.onClick);this.removeTouchEvent(this.btnCostDetail,this.onClick);this.removeTouchEvent(this.arrowUp,this.onClick);this.removeTouchEvent(this.arrowDown,this.onClick);this.itemList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.giftList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGiftTap,this)};SwordSkinWin.prototype.onClick=function(e){switch(e.target){case this.closeBtn:ViewManager.ins().close(this);if(this.closeCallback){this.closeCallback()}break;case this.btnUpgrade:this.sValue=this.itemScroller.viewport.scrollV;var curIdx=this.itemList.selectedIndex;var data=this.itemlistData[curIdx];var skinId=data.id;this.cSkin=skinId;if(this.sValue==0){this.sValue+=.001}this.sendUpgrade();break;case this.btnActivate:this.sValue=this.itemScroller.viewport.scrollV;if(this.sValue==0){this.sValue+=.001}this.sendActivate();break;case this.btnSelect:this.sendSelect();break;case this.btnCancel:this.sendCancel();break;case this.btnCostDetail:this.showCostDetail();break;case this.arrowUp:this.onUP();break;case this.arrowDown:this.onDown();break}};SwordSkinWin.prototype.onUP=function(){var id=this.itemList.selectedIndex-1;if(id>-1){this.toId(id)}};SwordSkinWin.prototype.onDown=function(){var id=this.itemList.selectedIndex+1;if(id<this.itemlistDt.length){this.toId(id)}};SwordSkinWin.prototype.toId=function(id,needScroll){if(needScroll===void 0){needScroll=true}var self=this;this.itemList.selectedIndex=id;if(needScroll){if(self.sValue){self.itemScroller.viewport.scrollV=self.sValue;self.sValue=null}else{var max=(self.itemlistData.length-2)*2+100*(self.itemlistData.length-3);var ci=102*self.itemList.selectedIndex;var cv=Math.min(max,ci);self.itemScroller.viewport.scrollV=cv}}this.onScroll();this.updateDetail();this.showRedPoint()};SwordSkinWin.prototype.onScroll=function(){var up=0;var down=this.itemlistDt.length-1;if(this.itemList&&this.itemList.numChildren>0){for(var i=0;i<this.itemList.numChildren;i++){var item=this.itemList.getChildAt(i);item.showRedPoint();if(i==0){up=item.getId()}if(i==this.itemList.numChildren-1){down=item.getId()}}}var upI=this.skinIdToIndex(up);var downI=this.skinIdToIndex(down);this.redPointUp.visible=false;for(var i=0;i<upI;i++){if(this.itemlistData[i].activatable){this.redPointUp.visible=true;break}}this.redPointDown.visible=false;for(var i=downI+1;i<this.itemlistData.length;i++){if(this.itemlistData[i].activatable){this.redPointDown.visible=true;break}}};SwordSkinWin.prototype.sendActivate=function(){var curIdx=this.itemList.selectedIndex;var data=this.itemlistData[curIdx];if(!data){return}var skinId=data.id;var roleId=this.roleIndex+1;var label=this.btnActivate.label;var isTrial=label==i18n("SwordSkinWin_11")?0:1;if(label==i18n("SwordSkinWin_13")){var str="";switch(this.recycleType){case 1:str=i18n("SwordSkinWin_14");break;case 2:str=i18n("SwordSkinWin_15");break;case 3:str=i18n("SwordSkinWin_16");break}var w=WarnWin.show(str,null,null,function(){SwordSkinMgr.ins().sendSwordSkinActivate(skinId,roleId,isTrial)});w.setBtnLabel(i18n("SwordSkinWin_17"),i18n("SwordSkinWin_18"))}else{SwordSkinMgr.ins().sendSwordSkinActivate(skinId,roleId,isTrial)}};SwordSkinWin.prototype.sendUpgrade=function(){var curIdx=this.itemList.selectedIndex;var data=this.itemlistData[curIdx];if(!data){return}var skinId=data.id;var roleId=this.roleIndex+1;SwordSkinMgr.ins().sendSwordSkinUpgrade(skinId,roleId)};SwordSkinWin.prototype.sendSelect=function(){var curIdx=this.itemList.selectedIndex;var data=this.itemlistData[curIdx];if(!data){return}var skinId=data.id;var roleId=this.roleIndex+1;SwordSkinMgr.ins().sendSwordSkinSelect(skinId,roleId)};SwordSkinWin.prototype.sendCancel=function(){var curIdx=this.itemList.selectedIndex;var data=this.itemlistData[curIdx];if(!data){return}var roleId=this.roleIndex+1;SwordSkinMgr.ins().sendSwordSkinSelect(-1,roleId)};return SwordSkinWin}(BaseEuiView);__reflect(SwordSkinWin.prototype,"SwordSkinWin");ViewManager.ins().reg(SwordSkinWin,LayerManager.UI_Main);var SysPreview=function(_super){__extends(SysPreview,_super);function SysPreview(){var _this=_super.call(this)||this;_this.openSysList=[];_this._rechargeHidden=undefined;_this.sysId=PackageID.OpenSystem;_this.regNetMsg(1,_this.postInitInfo);_this.regNetMsg(2,_this.postGetReward);_this.initData();return _this}Object.defineProperty(SysPreview.prototype,"configList",{get:function(){var oldv=this._rechargeHidden;this._rechargeHidden=ChannelMgr.ins().isRechargeHidden();if(!this._configs||oldv!==this._rechargeHidden){this._configs={};for(var key in GlobalConfig.OpenSystemConfig){if(Number(key)!=Number(key)||GlobalConfig.OpenSystemConfig[key].showUi==0)continue;var previewId=GlobalConfig.OpenSystemConfig[key].previewId;if(SysPreview.maybeClose(previewId)&&this._rechargeHidden){previewId=undefined}if(previewId){this._configs[previewId]=GlobalConfig.OpenSystemConfig[key]}}}return this._configs},enumerable:true,configurable:true});SysPreview.maybeClose=function(previewId){switch(previewId){case 3:case 22:case 23:case 24:return true;default:return false}};SysPreview.prototype.initData=function(){this.stateList={}};SysPreview.ins=function(){return _super.ins.call(this)};SysPreview.prototype.canGetReward=function(){for(var k in this.configList){var state=this.getState(this.configList[k].previewId);if(state==SysPreview.TYPE.open)return true}return false};SysPreview.prototype.nextSys=function(){var id=0;if(SysPreview.SYSTEM_STATE==0)return id;for(var k in this.configList){var state=this.getState(this.configList[k].previewId);if(state==SysPreview.TYPE.close){return this.configList[k].previewId}if(state==SysPreview.TYPE.open){id=id||this.configList[k].previewId}}return id};SysPreview.prototype.nextRewardSys=function(){var previewId=0;for(var k in this.configList){if(this.getState(this.configList[k].previewId)==SysPreview.TYPE.open){previewId=this.configList[k].previewId;break}}return previewId};SysPreview.prototype.getConfig=function(id){return this.configList[id]};SysPreview.prototype.getState=function(id){return this.stateList[id]||SysPreview.TYPE.close};SysPreview.prototype.sendGetInfo=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};SysPreview.prototype.postInitInfo=function(bytes){if(!bytes||SysPreview.SYSTEM_STATE==0){this.stateList={};this.openSysList=[];this.postChange();return}var len;this.stateList={};len=bytes.readInt();for(var i=1;i<=len;i++){var previewId=bytes.readInt();var state=bytes.readInt();this.stateList[previewId]=SysPreview.TYPE[state]||SysPreview.TYPE.close}len=bytes.readInt();for(var j=0;j<len;j++){var previewId=bytes.readInt();if(ChannelMgr.ins().isRechargeHidden()&&previewId==3)continue;this.openSysList.push(previewId)}this.postChange();if(this.openSysList.length)this.postNewOpen()};SysPreview.prototype.sendGetReward=function(previewId){var bytes=this.getBytes(2);bytes.writeInt(previewId);this.sendToServer(bytes)};SysPreview.prototype.postGetReward=function(bytes){var previewId=bytes.readInt();this.stateList[previewId]=SysPreview.TYPE.done;this.postChange()};SysPreview.prototype.postChange=function(){};SysPreview.prototype.postNewOpen=function(){};SysPreview.prototype.control=function(flag){if(flag===void 0){flag=1}SysPreview.SYSTEM_STATE=flag;if(SysPreview.SYSTEM_STATE==1){this.sendGetInfo()}else{ViewManager.ins().close(SysPreviewTip);this.postInitInfo()}};SysPreview.TYPE={close:0,open:1,done:2,0:0,1:2,2:1};SysPreview.SYSTEM_STATE=1;return SysPreview}(BaseSystem);__reflect(SysPreview.prototype,"SysPreview");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.sysPreview=SysPreview.ins.bind(SysPreview)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SysPreviewIcon=function(_super){__extends(SysPreviewIcon,_super);function SysPreviewIcon(){var _this=_super.call(this)||this;_this.skinName="SysPreviewIconSkin";_this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);return _this}SysPreviewIcon.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};SysPreviewIcon.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);this.setInfo()};SysPreviewIcon.prototype.onTap=function(e){switch(e.currentTarget){case this.btn:ViewManager.ins().open(SysPreviewWin2);break}};SysPreviewIcon.prototype.setInfo=function(){if(!this.data){return}var data=this.data;var sys=data.config;var state=data.state;if(!sys){return}this.btn.icon=sys.icon;if(state==0){this.tip0.visible=false;this.tip1.visible=true;this.redPoint.visible=false;var t="";if((sys.openzs||0)>0){t+=i18n("SysPreviewIcon_1",sys.openzs)}if((sys.openlevel||0)>0){t+=i18n("SysPreviewIcon_2",sys.openlevel)}if((sys.opencheck||0)>0){t+=i18n("SysPreviewIcon_3",sys.opencheck)}this.tip1.text=i18n("SysPreviewIcon_0",t)}else if(state==1){this.tip0.visible=true;this.tip1.visible=false}this.redPoint.visible=SysPreview.ins().canGetReward()};return SysPreviewIcon}(ItemRenderer);__reflect(SysPreviewIcon.prototype,"SysPreviewIcon");var SysPreviewItem2=function(_super){__extends(SysPreviewItem2,_super);function SysPreviewItem2(){var _this=_super.call(this)||this;_this.skinName="SysPreviewItem2Skin";_this.setMC();return _this}SysPreviewItem2.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};SysPreviewItem2.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);this.setInfo()};SysPreviewItem2.prototype.setInfo=function(){var data=this.data;this.imgTitle.source=data.config.icon;var t="";if((data.config.openzs||0)>0){t+=i18n("SysPreviewItem2_1",data.config.openzs)}if((data.config.openlevel||0)>0){t+=i18n("SysPreviewItem2_2",data.config.openlevel)}if((data.config.opencheck||0)>0){t+=i18n("SysPreviewItem2_3",data.config.opencheck)}this.lblCondition.text=data.state?i18n("SysPreviewItem2_7"):i18n("SysPreviewItem2_0",t);switch(data.state){case 0:this.lblState.textFlow=TextFlowMaker.generateTextFlow(i18n("SysPreviewItem2_6"));this.redPoint.visible=this.mcg.visible=false;break;case 1:this.lblState.textFlow=TextFlowMaker.generateTextFlow(i18n("SysPreviewItem2_4"));this.redPoint.visible=this.mcg.visible=true;break;case 2:this.lblState.textFlow=TextFlowMaker.generateTextFlow(i18n("SysPreviewItem2_5"));this.redPoint.visible=this.mcg.visible=false;break}this.imgSelect.visible=this.selected;this.imgNotSelect.visible=!this.selected};SysPreviewItem2.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=45;this.mc.y=52;this.mc.width=90;this.mc.height=90;this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1);this.mcg.addChild(this.mc)}};return SysPreviewItem2}(ItemRenderer);__reflect(SysPreviewItem2.prototype,"SysPreviewItem2");var SysPreviewTip=function(_super){__extends(SysPreviewTip,_super);function SysPreviewTip(){var _this=_super.call(this)||this;_this.skinName="SysPreviewTipSkin";_this.isTopLevel=true;return _this}SysPreviewTip.openCheck=function(){if(SysPreview.SYSTEM_STATE==1&&SysPreview.ins().openSysList&&SysPreview.ins().openSysList.length>0)return true;else return false};SysPreviewTip.prototype.open=function(){if(SysPreviewTip.sys)return;this.addEventListener(egret.Event.ENTER_FRAME,this.rotate,this);this.addTouchEvent(this.rect2,this.onTap);this.updateView()};SysPreviewTip.prototype.updateView=function(){SysPreviewTip.sys=SysPreview.ins().getConfig(SysPreview.ins().openSysList.shift());this.sysImg.source=SysPreviewTip.sys.icon;egret.Tween.removeTweens(this.rect);this.rect.alpha=0;egret.Tween.get(this.rect).to({alpha:1},400,egret.Ease.cubicOut);egret.Tween.removeTweens(this.group);this.group.scaleX=0;this.group.scaleY=0;egret.Tween.get(this.group).to({scaleX:1,scaleY:1},400,egret.Ease.cubicOut);TimerManager.ins().remove(this.closeWin,this);TimerManager.ins().doTimerDelay(5e3,0,1,this.closeWin,this)};SysPreviewTip.prototype.closeWin=function(){if(SysPreview.SYSTEM_STATE==1&&SysPreview.ins().openSysList&&SysPreview.ins().openSysList.length>0){this.updateView()}else{ViewManager.ins().close(this)}};SysPreviewTip.prototype.close=function(){SysPreviewTip.sys=undefined;egret.Tween.removeTweens(this.rect);egret.Tween.removeTweens(this.group);this.removeTouchEvent(this.rect2,this.onTap);this.removeEventListener(egret.Event.ENTER_FRAME,this.rotate,this);TimerManager.ins().remove(this.closeWin,this)};SysPreviewTip.prototype.onTap=function(e){switch(e.currentTarget){case this.rect2:this.closeWin();break}};SysPreviewTip.prototype.rotate=function(e){this.cycle1.rotation=(this.cycle1.rotation-1+360)%360;this.cycle2.rotation=(this.cycle2.rotation+1+360)%360;this.cycle3.rotation=(this.cycle3.rotation-1+360)%360};return SysPreviewTip}(BaseEuiView);__reflect(SysPreviewTip.prototype,"SysPreviewTip");ViewManager.ins().reg(SysPreviewTip,LayerManager.UI_Popup);var SysPreviewWin2=function(_super){__extends(SysPreviewWin2,_super);function SysPreviewWin2(){var _this=_super.call(this)||this;_this.skinName="SysPreviewWin2Skin";_this.data=new eui.ArrayCollection;_this.sysList.itemRenderer=SysPreviewItem2;_this.sysList.dataProvider=_this.data;_this.addChangeEvent(_this.sysList,_this.onTapList);_this.setMC();return _this}SysPreviewWin2.openCheck=function(){return SysPreview.SYSTEM_STATE==1?true:false};SysPreviewWin2.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var i=SysPreview.ins().nextSys()-1;this.sysList.selectedIndex=i>=0?i:0;TimerManager.ins().doTimerDelay(200,1,1,this.setScroll,this);this.setScroll();this.observe(SysPreview.ins().postChange,this.updateShow);this.addTouchEvent(this.btnClose,this.onTouch);this.addTouchEvent(this.btnClose0,this.onTouch);this.addTouchEvent(this.btn0,this.onTouch);this.addTouchEvent(this.btn1,this.onTouch);this.addTouchEvent(this.btn2,this.onTouch);this.addTouchEvent(this.btn3,this.onTouch);this.updateShow()};SysPreviewWin2.prototype.close=function(){this.removeTouchEvent(this.btnClose,this.onTouch);this.removeTouchEvent(this.btnClose0,this.onTouch);this.removeTouchEvent(this.btn0,this.onTouch);this.removeTouchEvent(this.btn1,this.onTouch);this.removeTouchEvent(this.btn2,this.onTouch);this.removeTouchEvent(this.btn3,this.onTouch);this.removeObserve();ViewManager.ins().close(this)};SysPreviewWin2.prototype.onTouch=function(e){var item=this.sysList.selectedItem;var cfg=item.config;switch(e.currentTarget){case this.btnClose:case this.btnClose0:ViewManager.ins().close(this);break;case this.btn0:SysPreview.ins().sendGetReward(cfg.previewId);break;case this.btn2:if(this.nextRewardSysId){this.sysList.selectedIndex=this.nextRewardSysId-1;this.updateShow();this.setScroll()}break;case this.btn1:;case this.btn3:var win=GlobalConfig.WinOpenConfig[cfg.openWin];var cls=egret.getDefinitionByName(win.winClass);if(!cls)return;ViewManager.ins().close(this);ViewManager.ins().open(cls,win.subWinId);break}};SysPreviewWin2.prototype.onTapList=function(e){this.updateShow()};SysPreviewWin2.prototype.setScroll=function(){this.sysList.scrollV=Math.floor(this.sysList.selectedIndex/3)*177};SysPreviewWin2.prototype.updateShow=function(){var configList=SysPreview.ins().configList;var arr=[];for(var i in configList){var state=SysPreview.ins().getState(configList[i].previewId);arr.push({config:configList[i],state:state})}this.data.replaceAll(arr);this.showSelectedItem()};SysPreviewWin2.prototype.showSelectedItem=function(){var item=this.sysList.selectedItem;var cfg=item.config;this.titleIcon.source=cfg.titleIcon;this.lblDesc.text=cfg.describe;this.reward.data=cfg.openReward[0];this.g0.visible=this.g1.visible=this.g2.visible=this.g3.visible=this.checked.visible=false;switch(item.state){case 0:this.g0.visible=true;var t="";if((cfg.openzs||0)>0){t+=i18n("SysPreviewIcon_1",cfg.openzs)}if((cfg.openlevel||0)>0){t+=i18n("SysPreviewIcon_2",cfg.openlevel)}if((cfg.opencheck||0)>0){t+=i18n("SysPreviewIcon_3",cfg.opencheck)}this.lblTip.text=i18n("SysPreviewIcon_0",t);break;case 1:this.g1.visible=true;break;case 2:this.checked.visible=true;this.nextRewardSysId=SysPreview.ins().nextRewardSys();if(this.nextRewardSysId){this.g2.visible=true}else{this.g3.visible=true}break}};SysPreviewWin2.prototype.showReward=function(reward){ViewManager.ins().open(ActivityRewardTipWin,reward)};SysPreviewWin2.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=77.5;this.mc.y=25;this.mc.width=155;this.mc.height=52;this.mc.scaleX=1.03;this.mc.scaleY=.84;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.mcg.addChild(this.mc)}};return SysPreviewWin2}(BaseEuiView);__reflect(SysPreviewWin2.prototype,"SysPreviewWin2");ViewManager.ins().reg(SysPreviewWin2,LayerManager.UI_Popup);var TargetListCC=function(_super){__extends(TargetListCC,_super);function TargetListCC(){var _this=_super.call(this)||this;_this.isStopAutoAttack=true;_this.masterAtkTarget={};_this.tipsCD=false;_this.attackMeHandles=[];_this.canAttackHandles=[];_this.teamHandles=[];_this.observe(GameLogic.ins().postEntityHpChange,_this.attackAndShowTip);_this.observe(BattleCC.ins().postEnterSuccess,_this.campChange);_this.observe(GameLogic.ins().postAllAtkTarget,_this.updateAtkTarget);_this.observe(GameLogic.ins().postEnterMap,_this.onEnterMap);_this.observe(MapView.onGridClick,_this.onStopAutoAttack);return _this}TargetListCC.prototype.onEnterMap=function(){var _this=this;this.masterAtkTarget={};this.attackMeHandles.length=0;this.canAttackHandles.length=0;this.teamHandles.length=0;TimerManager.ins().removeAll(this);ViewManager.ins().close(TargetListPanel);TimerManager.ins().doTimer(600,1,function(){if(_this.isShow){TimerManager.ins().doTimer(1e3,0,_this.update,_this);_this.update();ViewManager.ins().open(TargetListPanel);if(!TimerManager.ins().isExists(_this.onAutoAttackReliveEnemy,_this)){TimerManager.ins().doTimer(500,0,_this.onAutoAttackReliveEnemy,_this)}}},this)};Object.defineProperty(TargetListCC.prototype,"isShow",{get:function(){return CityCC.ins().isCity||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||BattleGround.ins().isPaoDian||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||DarkMjBoss.ins().isDarkBoss||WJBattlefieldSys.ins().isWJBattle||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena||GameMap.fbType==UserFb.FB_TYPE_HARD_FB},enumerable:true,configurable:true});TargetListCC.prototype.update=function(){if(!this.isShow)return;this.postChangeCanAttackHandle();this.updateAttackMe()};TargetListCC.prototype.campChange=function(){if(BattleCC.ins().isBattle()){var char=void 0;var roleList=EntityManager.ins().getAllEntity();for(var i in roleList){char=roleList[i];if(char&&char.infoModel){if(char.infoModel.type==EntityType.Role){char.setCharName(char.infoModel.guildAndName)}}}}};TargetListCC.prototype.postChangeCanAttackHandle=function(){var char;var roleList=EntityManager.ins().getAllEntity();if(!KfArenaSys.ins().isKFArena){this.canAttackHandles.length=0;this.teamHandles.length=0}var infoModel;var addMonster=false;var monsterCannotAttack=CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||KFBossSys.ins().isKFBossBattle||DarkMjBoss.ins().isDarkBoss||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena;var addedMonNames={};for(var i in roleList){char=roleList[i];infoModel=char.infoModel;if(!infoModel)continue;if(infoModel.type==EntityType.Role){var char_01=roleList[i];var infoModel_01=char_01.infoModel;if(char_01.isSafety()==false&&infoModel_01.getAtt(AttributeType.atHp)>0){if(BattleCC.ins().isBattle()){this.updateCanAttackHandle(infoModel_01.masterHandle,true)}else if(DevildomSys.ins().isDevildomBattle||BattleGround.ins().isPaoDian){if(!infoModel_01.guildID||infoModel_01.guildID&&infoModel_01.guildID!=Guild.ins().guildID){this.updateCanAttackHandle(char_01.infoModel.masterHandle,true)}}else this.updateCanAttackHandle(infoModel_01.masterHandle,true)}}else if(infoModel.type==EntityType.Monster&&infoModel.getAtt(AttributeType.atHp)>0&&!addMonster){if(BattleGround.ins().isPaoDian){continue}if(monsterCannotAttack){continue}var monsterConfig=GlobalConfig.MonstersConfig[infoModel.configID];if(!monsterConfig)continue;if(monsterConfig.type==4||monsterConfig.type==3)continue;if(!this.checkMonHead(monsterConfig))continue;if(GlobalConfig.CampBattleConfig.noAttack.indexOf(infoModel.configID)==-1){if(GameMap.fbType!=UserFb.FB_TYPE_HARD_FB){addMonster=true}else{if(infoModel.name in addedMonNames){continue}addedMonNames[infoModel.name]=1}this.updateCanAttackHandle(infoModel.handle,true,true)}}}if(KFBossSys.ins().isKFBossBattle&&KFBossSys.ins().flagHandle&&KFBossSys.ins().flagTimes>0){this.updateCanAttackHandle(KFBossSys.ins().flagHandle,true,true)}else if(KfArenaSys.ins().isKFArena&&KfArenaSys.ins().flagHandle){this.updateCanAttackHandle(KfArenaSys.ins().flagHandle,true,true)}};TargetListCC.prototype.checkMonHead=function(config){return!Assert(config.head,i18n("TargetListCC_0",config.id,config.name))};TargetListCC.prototype.updateAttackMe=function(){for(var _i=0,_a=this.attackMeHandles;_i<_a.length;_i++){var masterHandle=_a[_i];var chars_1=EntityManager.ins().getMasterList(masterHandle);if(!chars_1||chars_1.length==0){this.postTargetList(masterHandle,0)}else{var isDead=true;for(var _b=0,chars_2=chars_1;_b<chars_2.length;_b++){var char=chars_2[_b];if(char&&char.infoModel&&char.infoModel.getAtt(AttributeType.atHp)>0){isDead=false;break}}if(isDead)this.postTargetList(masterHandle,0)}}};TargetListCC.prototype.clear=function(){this.attackMeHandles.length=0;this.canAttackHandles.length=0;this.teamHandles.length=0;this.isStopAutoAttack=true;GameLogic.ins().currAttackHandle=0;UserBoss.ins().monsterID=0;TimerManager.ins().remove(this.onAutoAttackReliveEnemy,this)};TargetListCC.prototype.updateCanAttackHandle=function(handle,add,firstPos){if(firstPos===void 0){firstPos=false}var rootHandle=EntityManager.ins().getRootMasterHandle(handle);if(rootHandle==0||rootHandle==Actor.handle)return;var idx=this.canAttackHandles.indexOf(rootHandle);if(add&&idx==-1){if(firstPos){this.canAttackHandles.unshift(rootHandle)}else{var charSource=EntityManager.ins().getEntityByHandle(rootHandle)||EntityManager.ins().getEntityBymasterhHandle(rootHandle);if(charSource){var infoModel=charSource.infoModel;if(KfArenaSys.ins().isKFArena&&infoModel.camp!=undefined&&KfArenaSys.ins().myCampId!=undefined&&infoModel.camp==KfArenaSys.ins().myCampId){if(this.teamHandles.indexOf(rootHandle)==-1){this.teamHandles.push(rootHandle)}}else if(BattleCC.ins().isBattle()&&infoModel.camp!=undefined&&BattleCC.ins().camp!=undefined&&infoModel.camp==BattleCC.ins().camp){if(this.teamHandles.indexOf(rootHandle)==-1){this.teamHandles.push(rootHandle)}}else{if(KfArenaSys.ins().isKFArena&&(infoModel.camp==undefined||KfArenaSys.ins().myCampId==undefined)){}else if(BattleCC.ins().isBattle()&&(infoModel.camp==undefined||BattleCC.ins().camp==undefined)){}else{if(this.canAttackHandles.indexOf(rootHandle)==-1){this.canAttackHandles.push(rootHandle)}}}}}}else if(!add&&idx!=-1){if(!KfArenaSys.ins().isKFArena){this.canAttackHandles.splice(idx,1)}}};TargetListCC.prototype.postTargetList=function(sourceHandle,targetHandle){if(sourceHandle==0&&targetHandle==0)return;var rootSource=EntityManager.ins().getRootMasterHandle(sourceHandle);var rootTarget=EntityManager.ins().getRootMasterHandle(targetHandle);var idx=this.attackMeHandles.indexOf(rootSource);if(rootSource==Actor.handle){var target=EntityManager.ins().getEntityByHandle(targetHandle);if(target&&target.infoModel&&target.infoModel.type==EntityType.CollectionMonst)return;if(target&&target.infoModel&&target.infoModel.getAtt(AttributeType.atHp)>0){GameLogic.ins().postChangeTarget(target.infoModel.type==EntityType.Monster?target.infoModel.handle:target.infoModel.masterHandle)}else{GameLogic.ins().postChangeTarget(0);ViewManager.ins().close(TargetPlayerBigBloodPanel)}if(ViewManager.ins().isShow(TargetListPanel))ViewManager.ins().getView(TargetListPanel).showTarget(targetHandle!=0)}else if(idx!=-1&&rootTarget==0)this.attackMeHandles.splice(idx,1)};TargetListCC.prototype.attackAndShowTip=function(_a){var targetRole=_a[0],sourceRole=_a[1],type=_a[2],value=_a[3];if(!this.isShow||!targetRole||!sourceRole||value<=0)return;if(!targetRole.isMy&&!sourceRole.isMy)return;var rootSource=EntityManager.ins().getRootMasterHandle(sourceRole.infoModel.handle);var rootTarget=EntityManager.ins().getRootMasterHandle(targetRole.infoModel.handle);if(rootTarget!=Actor.handle&&rootSource==Actor.handle){if(GameLogic.ins().currAttackHandle!=0&&!ViewManager.ins().isShow(TargetPlayerBigBloodPanel)){if(BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||BattleGround.ins().isPaoDian)ViewManager.ins().open(TargetPlayerBigBloodPanel);else if(CityCC.ins().isCity&&CityCC.ins().cityBossId==0)ViewManager.ins().open(TargetPlayerBigBloodPanel)}return}var idx=this.attackMeHandles.indexOf(rootSource);if(idx==-1&&rootTarget==Actor.handle&&rootSource!=Actor.handle&&this.masterAtkTarget[rootSource]==rootTarget){if(sourceRole.infoModel.type==EntityType.Role){this.attackMeHandles.push(rootSource);if(this.attackMeHandles.length>0){if(!ViewManager.ins().isShow(TargetListPanel)){ViewManager.ins().open(TargetListPanel);CityCC.ins().postChangeAttStatue(1)}}this.postTargetList(0,0)}}if(targetRole.infoModel.isMy&&targetRole.infoModel.getAtt(AttributeType.atHp)<=0&&!EntityManager.ins().getNoDieRole()){if(ViewManager.ins().isShow(TargetListPanel))ViewManager.ins().getView(TargetListPanel).showTarget(false)}};TargetListCC.prototype.updateAtkTarget=function(_a){var sourceHandle=_a[0],targetHandle=_a[1];var sourceMaster=EntityManager.ins().getRootMasterHandle(sourceHandle);var targetMaster=EntityManager.ins().getRootMasterHandle(targetHandle);this.masterAtkTarget[sourceMaster]=targetMaster};TargetListCC.prototype.onStopAutoAttack=function(){this.isStopAutoAttack=true};TargetListCC.prototype.onAutoAttackReliveEnemy=function(){if(this.isStopAutoAttack)return;if(KfArenaSys.ins().isKFArena){TimerManager.ins().remove(this.onAutoAttackReliveEnemy,this);return}var lastAttackHandle=this.lastAttackHandle;var attackHandle=TargetListCC.INITE_HANDLE;if(this.canAttackHandles.indexOf(lastAttackHandle)>-1){attackHandle=lastAttackHandle}else{var canAttackHandles=this.canAttackHandles;var len=canAttackHandles.length;if(len<1)return;else if(len==1||this.lastAttackIndex==0){attackHandle=canAttackHandles[0]}else{if(this.attackMeHandles.length>0){attackHandle=this.attackMeHandles[0]}else{attackHandle=this.findNearestLiveEnemy()}}}var charSource=EntityManager.ins().getEntityByHandle(attackHandle)||EntityManager.ins().getEntityBymasterhHandle(attackHandle);if(charSource&&attackHandle>TargetListCC.INITE_HANDLE){var role=EntityManager.ins().getNoDieRole();if(role){if(this.attackHandle!=attackHandle){GameLogic.ins().postChangeAttrPoint(attackHandle);this.attackHandle=attackHandle}}}};TargetListCC.prototype.findNearestLiveEnemy=function(){var nearesthandle=TargetListCC.INITE_HANDLE;var minDist=Number.MAX_VALUE;var canAttackHandles=this.canAttackHandles;var len=canAttackHandles.length;var myMainRole=EntityManager.ins().getMainRole(0);if(!myMainRole)return nearesthandle;for(var i=len-1;len>0&&i>0;--i){var _handle=canAttackHandles[i];var charSource=EntityManager.ins().getEntityByHandle(_handle)||EntityManager.ins().getEntityBymasterhHandle(_handle);if(charSource){var hpInfo=this.getCharRolesHpByHandle(_handle);if(hpInfo.curHp>0){var dist=Math.pow(myMainRole.x-charSource.x,2)+Math.pow(myMainRole.y-charSource.y,2);if(dist<minDist){minDist=dist;nearesthandle=_handle}}}}return nearesthandle};TargetListCC.prototype.getCharRolesHpByHandle=function(handle){var hpInfo={maximum:0,curHp:0};var rolesList=EntityManager.ins().getEntitysBymasterhHandle(handle);if(!rolesList)return;var len=rolesList.length;for(var i=0;i<len;++i){var charRole=rolesList[i];if(charRole){hpInfo.maximum+=charRole.getHpBar().maximum;hpInfo.curHp+=charRole.getHpBar().value}}return hpInfo};TargetListCC.prototype.isInMyCamp=function(camp,handle){if(camp==KfArenaSys.ins().myCampId){if(this.teamHandles.indexOf(handle)>-1){return true}}return false};TargetListCC.ins=function(){return _super.ins.call(this)};TargetListCC.INITE_HANDLE=-1;return TargetListCC}(BaseSystem);__reflect(TargetListCC.prototype,"TargetListCC");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.targetListCC=TargetListCC.ins.bind(TargetListCC)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var TargetListPanel=function(_super){__extends(TargetListPanel,_super);function TargetListPanel(){var _this=_super.call(this)||this;_this.skinName="TargetListSkin";_this.list0.itemRenderer=TargetMemberHeadRender1;_this.list1.itemRenderer=WorldBossHeadRender;_this.list2.itemRenderer=TargetMemberHeadRender1;_this.list3.itemRenderer=TargetMemberHeadRender;_this.list0Dt=new eui.ArrayCollection;_this.list0Dt.source=TargetListCC.ins().teamHandles;_this.list0.dataProvider=_this.list0Dt;_this.list2Dt=new eui.ArrayCollection;_this.list2Dt.source=TargetListCC.ins().canAttackHandles;_this.list2.dataProvider=_this.list2Dt;return _this}TargetListPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(GameLogic.ins().postChangeTarget,this.updateTarget);this.observe(TargetListCC.ins().postTargetList,this.updateBeAttackList);this.observe(TargetListCC.ins().postChangeCanAttackHandle,this.updateCanAttackList);this.observe(TargetListCC.ins().postChangeCanAttackHandle,this.updateTeamList);this.observe(KfArenaSys.ins().postRelive,this.hideGuideGroup);this.update();this.attackGroup0.visible=false;this.guideGroup.visible=false;this.list2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTab,this);if(BattleGround.ins().isPaoDian){this.currentState="battleGround"}else{this.currentState="normal"}};TargetListPanel.prototype.update=function(){this.updateTarget();this.updateBeAttackList();this.updateCanAttackList();this.updateTeamList()};TargetListPanel.prototype.showTarget=function(b){this.attackGroup0.visible=b};TargetListPanel.prototype.updateTarget=function(){if(!this.attackGroup0.visible)return;if(this.checkIsTeamHandle()){GameLogic.ins().currAttackHandle=0;this.attackGroup0.visible=false;return}if(!this.list1.dataProvider){this.list1.dataProvider=new eui.ArrayCollection([GameLogic.ins().currAttackHandle])}else{var dataPro=this.list1.dataProvider;dataPro.replaceAll([GameLogic.ins().currAttackHandle])}};TargetListPanel.prototype.checkIsTeamHandle=function(){if(KfArenaSys.ins().isKFArena){return TargetListCC.ins().isInMyCamp(KfArenaSys.ins().myCampId,GameLogic.ins().currAttackHandle)}return false};TargetListPanel.prototype.updateBeAttackList=function(){var data=TargetListCC.ins().attackMeHandles;this.beAttackGroup0.visible=data.length>0;if(!this.beAttackGroup0.visible)return;if(!this.list3.dataProvider){this.list3.dataProvider=new eui.ArrayCollection(data)}else{var dataPro=this.list3.dataProvider;dataPro.replaceAll(data)}};TargetListPanel.prototype.updateCanAttackList=function(){var data=TargetListCC.ins().canAttackHandles;this.canAttackGroup0.visible=data.length>0;if(!this.canAttackGroup0.visible)return;this.list2Dt.replaceAll(TargetListCC.ins().canAttackHandles)};TargetListPanel.prototype.updateTeamList=function(){var data=TargetListCC.ins().teamHandles;this.teamGroup.visible=data.length>0;if(!this.teamGroup.visible)return;this.list0Dt.replaceAll(TargetListCC.ins().teamHandles)};TargetListPanel.prototype.showGuideGroup=function(){this.guideGroup.visible=true;console.log("TargetListPanel showGuideGroup")};TargetListPanel.prototype.onTab=function(e){if(!e)return;var selectedIndex=this.list2.selectedIndex;if(e.currentTarget==this.list2&&selectedIndex>=0&&selectedIndex<=3){this.hideGuideGroup(this.list2.selectedIndex)}};TargetListPanel.prototype.hideGuideGroup=function(selectedIndex){if(selectedIndex===void 0){selectedIndex=-1}if(selectedIndex>=0&&selectedIndex<=3){this.guideGroup.visible=false;console.log("TargetListPanel hideGuideGroup")}};TargetListPanel.prototype.close=function(){_super.prototype.close.call(this);this.list2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTab,this)};__decorate([callLater],TargetListPanel.prototype,"updateTarget",null);__decorate([callLater],TargetListPanel.prototype,"updateBeAttackList",null);__decorate([callLater],TargetListPanel.prototype,"updateCanAttackList",null);__decorate([callLater],TargetListPanel.prototype,"updateTeamList",null);return TargetListPanel}(BaseEuiView);__reflect(TargetListPanel.prototype,"TargetListPanel");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.targetlistpanel=function(){ViewManager.ins().reg(TargetListPanel,LayerManager.Main_View)}})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SceneManager=function(_super){__extends(SceneManager,_super);function SceneManager(){return _super.call(this)||this}SceneManager.ins=function(){return _super.ins.call(this)};SceneManager.prototype.clear=function(){var nowScene=this._currScene;if(nowScene){nowScene.onExit();this._currScene=undefined}};SceneManager.prototype.runScene=function(SceneClass){if(SceneClass==null){Log.trace("runScene:scene is null");return}var oldScene=this._currScene;if(oldScene){oldScene.onExit();oldScene=undefined}var s=new SceneClass;s.onEnter();this._currScene=s};SceneManager.prototype.getCurrScene=function(){return this._currScene};SceneManager.prototype.getSceneName=function(){if(this._currScene){return egret.getQualifiedClassName(this._currScene)}return""};SceneManager.CREATE_ROLE="CreateRoleScene";SceneManager.MAIN="MainScene";return SceneManager}(BaseClass);__reflect(SceneManager.prototype,"SceneManager");var TargetMemberHeadRender1=function(_super){__extends(TargetMemberHeadRender1,_super);function TargetMemberHeadRender1(){return _super.call(this)||this}TargetMemberHeadRender1.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);if(!isNaN(this.data)){if(this.isPlayerHead()){var charSource=EntityManager.ins().getEntityByHandle(this.data)||EntityManager.ins().getEntityBymasterhHandle(this.data);if(charSource){KfArenaSys.ins().updateCampInfoByRole(charSource);this.headBg.visible=false;this.headBg1.visible=true;this.hpBar.visible=true;var hpInfo=TargetListCC.ins().getCharRolesHpByHandle(this.data);charSource._hpBar.maximum=charSource._hpBar.maximum>0?charSource._hpBar.maximum:1;var value=charSource.getHP()/charSource._hpBar.maximum*100;if(hpInfo.maximum>0&&hpInfo.curHp>0){value=hpInfo.curHp/hpInfo.maximum*100}this.hpBar.value=value>0?value:0;this.deadTxt.visible=value>0?false:true;var camp=charSource.infoModel.camp;if(TargetListCC.ins().isInMyCamp(camp,this.data)){this.hpBar.skinName="bar5Skin"}else{this.hpBar.skinName="bar3Skin"}}}}};return TargetMemberHeadRender1}(TargetMemberHeadRender);__reflect(TargetMemberHeadRender1.prototype,"TargetMemberHeadRender1");var TargetPlayerBigBloodPanel=function(_super){__extends(TargetPlayerBigBloodPanel,_super);function TargetPlayerBigBloodPanel(){var _this=_super.call(this)||this;_this.curValue=1;return _this}TargetPlayerBigBloodPanel.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="TargetPlayerSmallBloodSkin";this.bloodBar.slideDuration=0;this.grayImg.source="bosshp2";this.grayImgMask=new egret.Rectangle(0,0,this.grayImg.width,this.grayImg.height);this.grayImg.mask=this.grayImgMask;TargetPlayerBigBloodPanel.GRAYIMG_WIDTH=this.grayImg.width;this.bloodBar.labelDisplay.visible=false;this.playerBloodGroup.top=BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||BattleGround.ins().isPaoDian?this.playerBloodGroup.top:60};TargetPlayerBigBloodPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(GameLogic.ins().postEntityHpChange,this.updateHP);this.observe(GameLogic.ins().postChangeTarget,this.updateTarget);this.observe(GameLogic.ins().postOtherAttChange,this.updateAtt);this.updateTarget()};TargetPlayerBigBloodPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.grayImgMask)egret.Tween.removeTweens(this.grayImgMask);this.currAttackHandle=0};TargetPlayerBigBloodPanel.prototype.changeHp=function(){var roleList=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(roleList&&roleList.length>0){var len=roleList.length;var hpValue=0;var hpTotal=0;var neigongValue=0;var neigongTotal=0;var mainRoleInfo=void 0;for(var i=0;i<len;i++){var role=roleList[i];if(role){var curHp=role.infoModel.getAtt(AttributeType.atHp)||0;var maxHp=role.infoModel.getAtt(AttributeType.atMaxHp)||0;hpValue+=curHp;hpTotal+=maxHp;var curNeigong=role.infoModel.getAtt(AttributeType.cruNeiGong)||0;var maxNeigong=role.infoModel.getAtt(AttributeType.maxNeiGong)||0;neigongValue+=curNeigong;neigongTotal+=maxNeigong}}if(BattleCC.ins().isBattle()){hpValue=hpValue/hpTotal*100;hpTotal=100}this.hudunbloodBar0.maximum=neigongTotal;this.hudunbloodBar0.value=neigongValue;this.bloodBar.maximum=hpTotal;this.bloodBar.value=hpValue;this.curValue=Math.floor(hpValue/hpTotal*100);this.tweenBlood()}else{var monster=EntityManager.ins().getEntityByHandle(this.currAttackHandle);if(monster&&monster.infoModel&&monster.infoModel.type==EntityType.Monster){this.hudunbloodBar0.maximum=monster.infoModel.getAtt(AttributeType.maxNeiGong)||0;this.hudunbloodBar0.value=monster.infoModel.getAtt(AttributeType.cruNeiGong)||0;this.bloodBar.maximum=monster.infoModel.getAtt(AttributeType.atMaxHp)||0;this.bloodBar.value=monster.infoModel.getAtt(AttributeType.atHp)||0;this.curValue=Math.floor(this.bloodBar.value/this.bloodBar.maximum*100);this.tweenBlood()}}};TargetPlayerBigBloodPanel.prototype.updateTarget=function(){if(GameLogic.ins().currAttackHandle==0){ViewManager.ins().close(this)}if(this.currAttackHandle!=0&&this.currAttackHandle!=GameLogic.ins().currAttackHandle){this.currAttackHandle=GameLogic.ins().currAttackHandle;if(this.currAttackHandle!=0){var mainRoleInfo=void 0;var roleList=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(roleList&&roleList.length>0){mainRoleInfo=roleList[0].infoModel;var tname=mainRoleInfo.name;var strlist=tname.split("\n");if(strlist[1])tname=strlist[1];else tname=strlist[0];this.nameTxt.textFlow=TextFlowMaker.generateTextFlow(tname);this.head.source="yuanhead"+mainRoleInfo.job+mainRoleInfo.sex;this.bloodBar.thumb.source="bosshp3";this.changeHp()}else{var monster=EntityManager.ins().getEntityByHandle(this.currAttackHandle);if(monster&&monster.infoModel&&monster.infoModel.type==EntityType.Monster){var config=GlobalConfig.MonstersConfig[monster.infoModel.configID];this.nameTxt.textFlow=(new egret.HtmlTextParser).parser(config.name);this.head.source="monhead"+config.head+"_png";this.bloodBar.thumb.source="bosshp1";this.changeHp()}}}}};TargetPlayerBigBloodPanel.prototype.updateHP=function(param){if(!CityCC.ins().isCity&&!BattleCC.ins().isBattle()&&!PaoDianCC.ins().isPaoDian&&!BattleGround.ins().isPaoDian&&!GwBoss.ins().isGwBoss&&!GwBoss.ins().isGwTopBoss)return;var targetRole=param[0];var sourceRole=param[1];var type=param[2];var value=param[3];if(targetRole&&(targetRole.infoModel.masterHandle==this.currAttackHandle||targetRole.infoModel.handle==this.currAttackHandle))this.changeHp()};TargetPlayerBigBloodPanel.prototype.updateAtt=function(char){if(!char||!char.infoModel)return;if(!CityCC.ins().isCity&&!BattleCC.ins().isBattle()&&!PaoDianCC.ins().isPaoDian&&!BattleGround.ins().isPaoDian)return;if(char.infoModel.masterHandle==this.currAttackHandle||char.infoModel.handle==this.currAttackHandle)this.changeHp()};TargetPlayerBigBloodPanel.prototype.tweenBlood=function(){var _this=this;var bloodPer=this.curValue*TargetPlayerBigBloodPanel.GRAYIMG_WIDTH/100;var self=this;egret.Tween.removeTweens(this.grayImgMask);if(bloodPer<3)return;var t=egret.Tween.get(this.grayImgMask,{onChange:function(){if(self.grayImg)self.grayImg.mask=_this.grayImgMask}},self);t.to({width:bloodPer-3},1e3).call(function(){if(bloodPer<=0){self.grayImgMask.width=0;egret.Tween.removeTweens(this.grayImgMask);ViewManager.ins().close(this)}},self)};TargetPlayerBigBloodPanel.GRAYIMG_WIDTH=0;return TargetPlayerBigBloodPanel}(BaseEuiView);__reflect(TargetPlayerBigBloodPanel.prototype,"TargetPlayerBigBloodPanel");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.targetPlayerBigBloodPanel=function(){ViewManager.ins().reg(TargetPlayerBigBloodPanel,LayerManager.Main_View)}})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var AchievementData=function(){function AchievementData(){}return AchievementData}();__reflect(AchievementData.prototype,"AchievementData");var LimitTaskData=function(){function LimitTaskData(){this.id=0;this.name="";this.desc="";this.target=0;this.control=0;this.type=0;this.state=0;this.progress=0}LimitTaskData.prototype.setBaseData=function(obj){this.id=obj.id;this.name=obj.name;this.desc=obj.desc;this.target=obj.target;this.awardList=obj.awardList;this.control=obj.control;this.controlTarget=obj.controlTarget;this.type=obj.type};LimitTaskData.prototype.parser=function(bytes){this.progress=bytes.readInt();this.state=bytes.readByte()};return LimitTaskData}();__reflect(LimitTaskData.prototype,"LimitTaskData");var TaskData=function(){function TaskData(){}return TaskData}();__reflect(TaskData.prototype,"TaskData");var UserTask=function(_super){__extends(UserTask,_super);function UserTask(){var _this=_super.call(this)||this;_this.limitTaskList=[];_this.limitTaskDic={};_this.limitTaskState=0;_this.limitTaskCount=0;_this.limitTaskEndTime=-1;_this.currTaskListsId=-1;_this.lastState=-1;_this.sysId=PackageID.Task;_this.regNetMsg(1,_this.doTaskData);_this.regNetMsg(2,_this.doTaskChangeData);_this.regNetMsg(3,_this.doVitality);_this.regNetMsg(4,_this.doVitalityAwards);_this.regNetMsg(5,_this.doAchieveData);_this.regNetMsg(7,_this.doJoinAchieveData);_this.regNetMsg(8,_this.doAchieveChangeData);_this.regNetMsg(9,_this.doLimitDataChange);_this.regNetMsg(10,_this.doUpdateLimitData);_this.regNetMsg(11,_this.postSevenDayTasks);_this.achiEvement=[];_this.sevenDayTask={};return _this}UserTask.ins=function(){return _super.ins.call(this)};UserTask.prototype.sendGetTask=function(id){var bytes=this.getBytes(1);bytes.writeInt(id);this.sendToServer(bytes)};UserTask.prototype.sendGetVitalityAwards=function(id){var bytes=this.getBytes(2);bytes.writeInt(id);this.sendToServer(bytes)};UserTask.prototype.sendGetAchieve=function(id){var bytes=this.getBytes(3);bytes.writeInt(id);this.sendToServer(bytes)};UserTask.prototype.doTaskData=function(bytes){this.task=[];this.vitalityAwards=[];var count=bytes.readInt();for(var i=0;i<count;i++){var data=new TaskData;data.id=bytes.readInt();data.value=bytes.readInt();data.state=bytes.readInt();this.task.push(data)}this.vitality=bytes.readInt();var awardsCount=bytes.readInt();for(var i=0;i<awardsCount;i++){var awardsData=new VitalityData;awardsData.id=bytes.readInt();awardsData.state=bytes.readInt();this.vitalityAwards.push(awardsData)}this.sortTask()};UserTask.prototype.doTaskChangeData=function(bytes){var id=bytes.readInt();var data=UserTask.ins().getTaskDataById(id);if(ErrorLog.Assert(data,"UserTask  doTaskChangeData id  = "+id)){return}data.value=bytes.readInt();data.state=bytes.readInt();UserTask.ins().sortTask();UserTask.ins().postTaskChangeData()};UserTask.prototype.postTaskChangeData=function(){};UserTask.prototype.doVitality=function(bytes){this.vitality=bytes.readInt()};UserTask.prototype.doVitalityAwards=function(bytes){var id=bytes.readInt();var data=this.getVitalityAwardsById(id);data.state=bytes.readInt();UserTask.ins().postTaskChangeData()};UserTask.prototype.doAchieveData=function(bytes){this.achiEvement.length=0;var count=bytes.readInt();for(var i=0;i<count;i++){var data=new AchievementData;data.achievementId=bytes.readInt();data.id=bytes.readInt();data.state=bytes.readInt();data.value=bytes.readInt();var cfg=this.getAchieveConfById(data.id);if(cfg==null){debug.warn(i18n("UserTask_0")+data.id+i18n("UserTask_1"))}else{data.achievementType=cfg.achievementType}if(data.achievementId==1e3){this.taskTrace=data;if(this.taskTrace.id==100003&&this.taskTrace.state==0){}UserTask.ins().postUpdteTaskTrace()}else{this.achiEvement.push(data)}}this.sortAchiEvement();this.postUpdateAchieve()};UserTask.prototype.getTaskData=function(achievementId,taskId){var count=this.achiEvement.length;var data;for(var i=0;i<count;i++){var temp=this.achiEvement[i];if(temp.achievementId==achievementId&&temp.id==taskId){data=temp;break}}return data};UserTask.prototype.getTaskTarget=function(taskId){var target=0;var cfg=this.getAchieveConfById(taskId);if(cfg){target=cfg.target}return target};UserTask.prototype.postUpdateAchieve=function(){};UserTask.prototype.postUpdteTaskTrace=function(){};UserTask.prototype.postUpdteLimitTaskData=function(taskData){return taskData};UserTask.prototype.postLimitTaskEnd=function(){};UserTask.prototype.doJoinAchieveData=function(bytes){this.changeAchieve(bytes)};UserTask.prototype.doAchieveChangeData=function(bytes){this.changeAchieve(bytes)};UserTask.prototype.doLimitDataChange=function(bytes){var state=bytes.readByte();this.limitTaskState=state;this.limitTaskCount=0;if(state==0){this.currTaskListsId=bytes.readInt();this.initLimitTaskData(this.currTaskListsId)}else if(state==1){this.currTaskListsId=bytes.readInt();this.initLimitTaskData(this.currTaskListsId);this.limitTaskEndTime=bytes.readInt();var config=GlobalConfig.LimitTimeConfig[this.currTaskListsId];if(this.currTaskListsId==1&&config.time==this.limitTaskEndTime){ViewManager.ins().open(LimitStartTipsView)}this.limitTaskEndTime+=Math.floor(GameServer.serverTime/1e3);var len=bytes.readShort();for(var i=0;i<len;i++){var id=bytes.readInt();this.limitTaskDic[id].parser(bytes);if(this.limitTaskDic[id].state==2)this.limitTaskCount++}}UserTask.ins().postUpdteLimitTaskData()};UserTask.prototype.initLimitTaskData=function(id){this.limitTaskList=[];this.limitTaskDic={};var config=GlobalConfig.LimitTimeConfig[id];for(var k in config.taskIds){var baseData=GlobalConfig.LimitTimeTaskConfig[config.taskIds[k]];var item=new LimitTaskData;item.setBaseData(baseData);this.limitTaskList.push(item);this.limitTaskDic[item.id]=item}};UserTask.prototype.doUpdateLimitData=function(bytes){var id=bytes.readInt();var item=this.limitTaskDic[id];if(!item){debug.log(i18n("UserTask_2")+id);return}item.parser(bytes);if(item.state==2)this.limitTaskCount++;UserTask.ins().postUpdteLimitTaskData(item)};UserTask.prototype.sendGetLimitTask=function(){this.sendBaseProto(5)};UserTask.prototype.sendGetLimitTaskReward=function(id){var bytes=this.getBytes(6);bytes.writeInt(id);this.sendToServer(bytes)};UserTask.prototype.changeAchieve=function(bytes){var achievementId=bytes.readInt();var data;if(achievementId==1e3){data=this.taskTrace}else data=this.getAchieveDataById(achievementId);if(ErrorLog.Assert(data,"UserTask  data is null  achievementId = "+achievementId)){return}data.id=bytes.readInt();data.state=bytes.readInt();data.value=bytes.readInt();if(data.achievementId==1e3){UserTask.ins().postUpdteTaskTrace()}else{this.sortAchiEvement();UserTask.ins().postTaskChangeData()}};UserTask.prototype.getChengjiuDataByType=function(type){if(this.achiEvement==undefined){Log.trace(i18n("UserTask_3"));return}var reArr=[];for(var i=0;i<this.achiEvement.length;i++){if(this.achiEvement[i].achievementType==type)reArr.push(this.achiEvement[i])}return this.sortAchievementAcByType(reArr)};UserTask.prototype.sortAchievementAcByType=function(reArr){if(reArr){reArr.sort(function(a,b){if(a.state==2)return 1;if(b.state==2)return-1;return b.state-a.state})}return reArr};UserTask.prototype.getAchieveDataById=function(id){if(this.achiEvement==undefined){Log.trace(i18n("UserTask_4"));return}for(var i=0;i<this.achiEvement.length;i++){if(this.achiEvement[i].achievementId==id)return this.achiEvement[i]}return null};UserTask.prototype.getAchieveByTaskId=function(id){for(var i=0;i<this.achiEvement.length;i++){if(this.achiEvement[i].id==id)return this.achiEvement[i]}return null};UserTask.prototype.getVitalityAwardsById=function(id){for(var i=0;i<this.vitalityAwards.length;i++){if(this.vitalityAwards[i].id==id)return this.vitalityAwards[i]}return null};UserTask.prototype.getTaskDataById=function(id){if(!this.task)return null;for(var i=0;i<this.task.length;i++){if(this.task[i].id==id)return this.task[i]}return null};UserTask.prototype.getAchieveConfById=function(id){var list=GlobalConfig.AchievementTaskConfig;var i;for(i in list){var config=list[i];if(config.taskId==id)return config}return null};UserTask.prototype.getAwardsConfigById=function(id){var list=GlobalConfig.DailyAwardConfig;var i;for(i in list){var config=list[i];if(config.id==id)return config}return null};UserTask.prototype.getTaskStast=function(){if(this.task){var i=void 0;for(i=0;i<this.task.length;i++){if(this.task[i].state==1){UserTask.ins().postUpdataTaskPoint(true);return}}for(i=0;i<this.vitalityAwards.length;i++){var config=this.getAwardsConfigById(this.vitalityAwards[i].id);if(this.vitality>=config.valueLimit&&this.vitalityAwards[i].state==0){UserTask.ins().postUpdataTaskPoint(true);return}}for(i=0;i<this.achiEvement.length;i++){if(this.achiEvement[i].state==1){UserTask.ins().postUpdataTaskPoint(true);return}}UserTask.ins().postUpdataTaskPoint(false);return}};UserTask.prototype.postUpdataTaskPoint=function(bo){return bo};UserTask.prototype.sortTask=function(){if(this.task.length>2){this.task.sort(this.sort);var state1Task=[];for(var i=0;i<this.task.length;i++){if(this.task[i].state!=0){state1Task.push(this.task[i]);this.task.splice(i,1);i--}}if(state1Task.length>0)this.task=this.task.concat(state1Task)}};UserTask.prototype.sort=function(a,b){var s1=a.id;var s2=b.id;if(s1<s2)return-1;else if(s1>s2)return 1;else return 0};UserTask.prototype.sortAchiEvement=function(){for(var i=0;i<this.achiEvement.length;i++){var data=this.achiEvement[i];if(data.state==1){this.achiEvement.splice(i,1);this.achiEvement.unshift(data)}else if(data.state==2){this.achiEvement.splice(i,1);this.achiEvement.push(data)}}};UserTask.prototype.getIsOpenChengjiu=function(){return Actor.level>=7};UserTask.prototype.getIsHaveChengjiuReward=function(){if(!this.getIsOpenChengjiu())return false;var maxTypeDatas=LiLian.ins().chengjiuMaxData();for(var _i=0,maxTypeDatas_1=maxTypeDatas;_i<maxTypeDatas_1.length;_i++){var type=maxTypeDatas_1[_i];var datas=this.getChengjiuDataByType(type);if(datas==undefined){Log.trace(i18n("UserTask_5"));return}for(var _a=0,datas_3=datas;_a<datas_3.length;_a++){var d=datas_3[_a];if(d.state==1)return true}}return false};UserTask.prototype.getIsHaveChengjiuRewardBytype=function(type){var datas=this.getChengjiuDataByType(type);for(var _i=0,datas_4=datas;_i<datas_4.length;_i++){var d=datas_4[_i];if(d.state==1)return true}return false};UserTask.prototype.getTaskState=function(){var data=UserTask.ins().taskTrace;if(data){var config=UserTask.ins().getAchieveConfById(data.id);var nextConfig=UserTask.ins().getAchieveConfById(data.id+1);if(!nextConfig&&data.state==2)return false;else return true}return false};UserTask.prototype.getLimitTaskRed=function(){for(var i=0;i<UserTask.ins().limitTaskList.length;i++){if(UserTask.ins().limitTaskList[i].state==1){return 1}}return 0};UserTask.prototype.postParabolicItem=function(){};UserTask.prototype.getLimitTimeId=function(id){for(var k in GlobalConfig.LimitTimeConfig){var cfg=GlobalConfig.LimitTimeConfig[k];if(cfg.taskIds.indexOf(id)!=-1){return cfg.id}}return 0};UserTask.prototype.getSevenDayTasks=function(){var bytes=this.getBytes(11);this.sendToServer(bytes)};UserTask.prototype.postSevenDayTasks=function(bytes){this.createDays=bytes.readInt();if(!this.sevenDayTask)this.sevenDayTask={};var len=bytes.readInt();for(var i=0;i<len;i++){var data=new TaskData;data.id=bytes.readInt();data.value=bytes.readInt();data.state=bytes.readInt();this.sevenDayTask[data.id+""]=data}};UserTask.prototype.getSevenDayTaskReward=function(taskId){var bytes=this.getBytes(7);bytes.writeInt(taskId);this.sendToServer(bytes)};UserTask.prototype.getSevenDayTaskById=function(taskId){return this.sevenDayTask[taskId+""]||{id:taskId,state:0,value:0}};UserTask.prototype.hasSevenDayTaskReward=function(sysId,day){var cfgs;var cfg;if(sysId==UserTask.SYS_PEACH||sysId==UserTask.SYS_ROLLMAP){var c=void 0;if(!(cfgs=GlobalConfig.SystemTaskConfig[sysId]))return false;if(!(c=cfgs[UserTask.ACTIVATE_TYPE_LOOP]))return false;for(var k in c){var v=c[k];for(var i=0;i<v.task_ids.length;i++){var taskData=this.getSevenDayTaskById(v.task_ids[i]);if(!taskData)continue;if(taskData.state==1)return true}}return false}if(sysId&&day){if(!(cfgs=GlobalConfig.SystemTaskConfig[sysId]))return false;if(!(cfg=cfgs[UserTask.ACTIVATE_TYPE_CHUANGJUE][day]))return false;var isOpen=this.createDays>=cfg.activate_value;var isOver=cfg.id==UserTask.SYS_XIANSHI&&this.createDays!=cfg.activate_value?true:false;for(var i=0;i<cfg.task_ids.length;i++){var taskData=this.getSevenDayTaskById(cfg.task_ids[i]);if(!taskData)continue;if(isOpen&&!isOver&&taskData.state==1)return true}}else{for(sysId=UserTask.SYS_CHENGZHANG;sysId<=UserTask.SYS_HUOYUE;sysId++){for(var day_2=1;day_2<=7;day_2++){if(this.hasSevenDayTaskReward(sysId,day_2))return true}}}return false};UserTask.SYS_RICHANG=1;UserTask.SYS_CHENGZHANG=2;UserTask.SYS_XIANSHI=3;UserTask.SYS_HUOYUE=4;UserTask.SYS_PEACH=5;UserTask.SYS_ROLLMAP=6;UserTask.ACTIVATE_TYPE_CHUANGJUE=1;UserTask.ACTIVATE_TYPE_WEEK=2;UserTask.ACTIVATE_TYPE_LOOP=3;UserTask.NOT_DO=0;UserTask.CAN_GET=1;UserTask.ALREADY_GET=2;UserTask.NOT_OPEN=3;UserTask.IS_OVER=4;return UserTask}(BaseSystem);__reflect(UserTask.prototype,"UserTask");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userTask=UserTask.ins.bind(UserTask)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var VitalityData=function(){function VitalityData(){}return VitalityData}();__reflect(VitalityData.prototype,"VitalityData");var AchieveItem=function(_super){__extends(AchieveItem,_super);function AchieveItem(){var _this=_super.call(this)||this;_this.skinName="TaskItemSkin";return _this}AchieveItem.prototype.dataChanged=function(){var data=this.data;if(data){var config=UserTask.ins().getAchieveConfById(data.id);this.taskImg.source="";this.taskName.textFlow=TextFlowMaker.generateTextFlow(config.name+i18n("AchieveItem_0")+data.value+"/"+config.target+")|");this.taskInfo.text=config.desc;var i=void 0;var num=1;for(i in config.awardList){this["awards"+num++].setData(config.awardList[i])}switch(data.state){case 0:this.gotoBtn.visible=true;this.awardsBtn.visible=false;this.completeImg.visible=this.completeLabel.visible=false;break;case 1:this.gotoBtn.visible=false;this.awardsBtn.visible=true;this.completeImg.visible=this.completeLabel.visible=false;break;case 2:this.gotoBtn.visible=false;this.awardsBtn.visible=false;this.completeImg.visible=this.completeLabel.visible=true;break}if(config.control==0)this.gotoBtn.visible=false}};return AchieveItem}(BaseItemRender);__reflect(AchieveItem.prototype,"AchieveItem");var AchievePanel=function(_super){__extends(AchievePanel,_super);function AchievePanel(){var _this=_super.call(this)||this;_this.skinName="AchievePanelSkin";_this.name=i18n("AchievePanel_0");_this.list.itemRenderer=AchieveItem;return _this}AchievePanel.prototype.open=function(){this.addTouchEvent(this.list,this.onSendFunc);this.observe(UserTask.ins().postTaskChangeData,this.setPanel);this.setPanel()};AchievePanel.prototype.close=function(){this.removeTouchEvent(this.list,this.onSendFunc);this.removeObserve()};AchievePanel.prototype.onSendFunc=function(e){if(!(e.target instanceof eui.Button))return;var item=e.target.parent;switch(e.target){case item.gotoBtn:GameGuider.taskGuidance(item.data.id,1);break;case item.awardsBtn:UserTask.ins().sendGetAchieve(item.data.achievementId);break}};AchievePanel.prototype.setPanel=function(){this._achieve=UserTask.ins().achiEvement;this.list.dataProvider=new eui.ArrayCollection(this._achieve)};return AchievePanel}(BaseView);__reflect(AchievePanel.prototype,"AchievePanel");var GuideArrow2=function(_super){__extends(GuideArrow2,_super);function GuideArrow2(needEff){if(needEff===void 0){needEff=false}var _this=_super.call(this)||this;_this.needEff=false;_this.skinName="guideArrowSkin";_this.needEff=needEff;return _this}GuideArrow2.prototype.childrenCreated=function(){var mc=new MovieClip;this.eff.addChild(mc);mc.playFile(RES_DIR_EFF+"guideff",-1);this.eff.visible=this.needEff};GuideArrow2.prototype.setDirection=function(direction){egret.Tween.removeTweens(this);this.visible=true;if(direction==1){this.currentState="right";egret.Tween.get(this.fingerL,{loop:true}).to({x:-25-40,y:-55+40},1e3).to({x:-25-40,y:-55+40},200).to({x:-25,y:-55},800)}else if(direction==0){this.currentState="left";egret.Tween.get(this.fingerR,{loop:true}).to({x:175+40,y:-55+40},1e3).to({x:175+40,y:-55+40},200).to({x:175,y:-55},800)}else if(direction==2){this.currentState="down";this.zIndex=1e4}this.eff.visible=this.needEff};GuideArrow2.prototype.setTips=function(tips){this.lab.text=tips};GuideArrow2.prototype.setLabelBgVisible=function(b){if(b===void 0){b=true}this.labelbg.visible=b};GuideArrow2.prototype.removeTweens=function(){egret.Tween.removeTweens(this)};return GuideArrow2}(BaseEuiView);__reflect(GuideArrow2.prototype,"GuideArrow2");var LimitStartTipsView=function(_super){__extends(LimitStartTipsView,_super);function LimitStartTipsView(){var _this=_super.call(this)||this;_this.skinName="LimitStartTipsSkin";_this.isTopLevel=true;_this.name=i18n("LimitStartTipsView_0");return _this}LimitStartTipsView.prototype.open=function(){this.addTouchEvent(this.btn,this.onStart)};LimitStartTipsView.prototype.close=function(){_super.prototype.close.call(this)};LimitStartTipsView.prototype.onStart=function(){ViewManager.ins().close(LimitStartTipsView);ViewManager.ins().open(LimitTaskView)};return LimitStartTipsView}(BaseEuiView);__reflect(LimitStartTipsView.prototype,"LimitStartTipsView");ViewManager.ins().reg(LimitStartTipsView,LayerManager.UI_Popup);var LimitTaskItem=function(_super){__extends(LimitTaskItem,_super);function LimitTaskItem(){var _this=_super.call(this)||this;_this.skinName="LimitTimeItem";return _this}LimitTaskItem.prototype.dataChanged=function(){this.goBtn.visible=true;this.done.visible=false;this.taskNameTxt.text=this.data.name;this.taskIcon.isShowName(false);this.taskIcon.data=this.data.awardList[0];this.progTxt.text="("+this.data.progress+"/"+this.data.target+")";if(this.data.type==83){if(this.data.progress>=this.data.target){this.progTxt.text="1/1"}else{this.progTxt.text="0/1"}}this.progTxt.textColor=12849664;if(this.data.state==0){this.stateTxt.text=i18n("LimitTaskItem_0");this.goBtn.label=i18n("LimitTaskItem_1")}else if(this.data.state==1){this.stateTxt.text=i18n("LimitTaskItem_2");this.goBtn.label=i18n("LimitTaskItem_3");this.progTxt.textColor=4823887}else if(this.data.state==2){this.stateTxt.text=i18n("LimitTaskItem_4");this.goBtn.visible=false;this.done.visible=true;this.progTxt.textColor=4823887}this.redPoint.visible=this.data.state==1;this.taskIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTopIcon,this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)};LimitTaskItem.prototype.onTopIcon=function(e){e.stopImmediatePropagation();e.stopPropagation()};LimitTaskItem.prototype.onTap=function(e){if(this.data.state==0){var para=this.data.controlTarget[1]?this.data.controlTarget[1]:0;if(this.data.controlTarget[0]=="GuanQiaRewardWin"){this.gotoQuanQia();return}ViewManager.ins().open(this.data.controlTarget[0],para)}else if(this.data.state==1){if(UserBag.ins().getSurplusCount()<1){UserTips.ins().showTips(i18n("LimitTaskItem_5"))}else{UserTask.ins().sendGetLimitTaskReward(this.data.id)}}};LimitTaskItem.prototype.gotoQuanQia=function(){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().closeTopLevel();ViewManager.ins().open(BagFullTipsWin)}else{if(UserFb.ins().currentEnergy>=UserFb.ins().energy){ViewManager.ins().closeTopLevel();UserFb.ins().autoPk()}else{UserTips.ins().showTips(i18n("LimitTaskItem_6"))}}return false};return LimitTaskItem}(BaseItemRender);__reflect(LimitTaskItem.prototype,"LimitTaskItem");var LimitTaskView=function(_super){__extends(LimitTaskView,_super);function LimitTaskView(){var _this=_super.call(this)||this;_this.skinName="limittime";_this.name=i18n("LimitTaskView_0");_this.isTopLevel=true;return _this}LimitTaskView.prototype.open=function(){this.addTouchEvent(this.list,this.onTouch);this.addTouchEvent(this.viewBtn,this.onTouch);this.addTouchEvent(this.closeBtn,this.onTouch);this.observe(UserTask.ins().postUpdteLimitTaskData,this.setPanel);this.observe(UserTask.ins().postUpdteLimitTaskData,this.updateFly);this.setPanel()};LimitTaskView.prototype.close=function(){TimerManager.ins().remove(this.runTime,this)};LimitTaskView.prototype.onTouch=function(e){switch(e.target){case this.viewBtn:ViewManager.ins().open(RoleWin,1);break;case this.closeBtn:ViewManager.ins().close(this);break}};LimitTaskView.prototype.setPanel=function(){var list=this.sortList();this.list.removeChildren();for(var _i=0,list_22=list;_i<list_22.length;_i++){var data=list_22[_i];var item=new LimitTaskItem;item.data=data;this.list.addChild(item)}this.list.layout.updateDisplayList(this.list.width,this.list.height);var taskId=UserTask.ins().currTaskListsId;var config=GlobalConfig.LimitTimeConfig[taskId];if(!config){UserTips.ins().showCenterTips(i18n("LimitTaskView_1")+taskId+i18n("LimitTaskView_2"));return}var str="";if(config.openZhuan>0){str=i18n("LimitTaskView_3",config.openZhuan)}else{str=i18n("LimitTaskView_4",config.openLevel)}var titleArr=["title0","title1","title2"];for(var i=0;i<titleArr.length;i++){if(i==taskId-1){this[titleArr[i]].visible=true}else{this[titleArr[i]].visible=false}}for(var i=0;i<8;i++){this["item"+i].redPoint.visible=false}this.link0.text=str;this.expBarChange();this.itemChange();this.updateAttr();if(UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3)>0){this.runTime();TimerManager.ins().doTimer(1e3,0,this.runTime,this)}else{this.time.text=i18n("LimitTaskView_5")}};LimitTaskView.prototype.runTime=function(){var time=UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3);if(time>=0){this.time.text=DateUtils.getFormatBySecond(time,1)}else{this.time.text=i18n("LimitTaskView_6");TimerManager.ins().remove(this.runTime,this)}};LimitTaskView.prototype.expBarChange=function(){var maxCount=UserTask.ins().limitTaskList.length;var currCount=UserTask.ins().limitTaskCount;if(this.expBar.maximum!=maxCount){this.expBar.maximum=maxCount}this.expBar.value=currCount;if(currCount==0){this.playAllEffect()}else{this.removeAllEffect()}};LimitTaskView.prototype.itemChange=function(){var list=UserTask.ins().limitTaskList;for(var i=0;i<list.length;i++){var item=list[i];var punchItem=this["item"+i];if(item.state==2){punchItem.visible=false}else{punchItem.visible=true}var award=item.awardList[0];punchItem.data=award;punchItem.destruct();punchItem.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)}};LimitTaskView.prototype.updateAttr=function(){var config=GlobalConfig.TogetherHitEquipQmConfig;var award=UserTask.ins().limitTaskList[0].awardList[0];var awardConfig=GlobalConfig.ItemConfig[award.id];var lv=awardConfig.zsLevel||0;for(var k in config){if(k+""==lv+""){for(var l in config[k]){var obj=config[k][l];for(var m in obj){if(m+""=="3"){this.link4.textFlow=TextFlowMaker.generateTextFlow1(obj[m].desc)}else if(m+""=="5"){this.link6.textFlow=TextFlowMaker.generateTextFlow1(obj[m].desc)}else{this.link8.textFlow=TextFlowMaker.generateTextFlow1(obj[m].desc)}}}break}}};LimitTaskView.prototype.onTouchItem=function(e){var item=e.currentTarget;var award=item.data;ViewManager.ins().open(HejiEquipTipsWin,award,false)};LimitTaskView.prototype.sortList=function(){var list=UserTask.ins().limitTaskList;var rewardList=[];var noRewardList=[];for(var i=0;list&&i<list.length;i++){if(list[i].state==1){rewardList.push(list[i])}else{noRewardList.push(list[i])}}return rewardList.concat(noRewardList.sort(this.sort))};LimitTaskView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.time.text="";this.expBar.slideDuration=0;this.effArr=[];for(var i=0;i<8;i++){var eff=new MovieClip;eff.x=177;eff.y=174;eff.rotation=i*45;eff.touchEnabled=false;this.effArr.push(eff)}};LimitTaskView.prototype.sort=function(a,b){var s1=a.state;var s2=b.state;return Algorithm.sortAsc(s1,s2)};LimitTaskView.prototype.playAllEffect=function(){for(var i=0;i<this.effArr.length;i++){if(!this.effArr[i].parent){this.effArr[i].playFile(RES_DIR_EFF+"hejizbjihuoeff",-1);this.EffectGroup.addChild(this.effArr[i])}}};LimitTaskView.prototype.removeAllEffect=function(){for(var i=0;i<this.effArr.length;i++){if(this.effArr[i].parent){DisplayUtils.removeFromParent(this.effArr[i])}}};LimitTaskView.prototype.updateFly=function(taskData){if(taskData&&taskData.state==2){var index=UserTask.ins().limitTaskList.indexOf(taskData);if(index>=0){this.addFly(index)}}};LimitTaskView.prototype.addFly=function(index){var item=this["item"+index];var newItem=new PunchEquipItemBase;newItem.currentState=item.currentState;newItem.anchorOffsetX=item.width/2;newItem.anchorOffsetY=item.height/2;newItem.scaleX=.53;newItem.scaleY=.53;newItem.alpha=.8;var par=item.parent;var p=new egret.Point;par.parent.localToGlobal(par.x+(item.x+item.width/2)*.53,par.y+(item.y+item.height/2)*.53,p);this.globalToLocal(p.x,p.y,p);newItem.x=p.x;newItem.y=p.y;this.addChild(newItem);var award=UserTask.ins().limitTaskList[index].awardList[0];newItem.validateNow();newItem.data=award;var uiview2=ViewManager.ins().getView(UIView2);var roleBtn=uiview2.getToggleBtn(0);var tar=new egret.Point;roleBtn.parent.localToGlobal(roleBtn.x+roleBtn.width/2,roleBtn.y+roleBtn.height/2,tar);var tw=egret.Tween.get(newItem);var dx=8;tw.to({scaleX:.8,scaleY:.8},300).to({x:p.x+dx},50).to({x:p.x-dx},50).to({x:p.x+dx},50).to({x:p.x-dx},50).to({x:p.x+dx},50).to({x:p.x-dx},50).to({x:p.x+dx},50).to({x:p.x-dx},50).to({x:p.x},25).to({x:tar.x,y:tar.y,scaleX:.15,scaleY:.15},800).call(function(){if(newItem.parent){newItem.parent.removeChild(newItem)}})};LimitTaskView.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(ChannelMgr.ins().isRechargeHidden()){return false}if(UserTask.ins().currTaskListsId>0)return true;WarnWin.show(i18n("LimitTaskView_7"),function(){},this,undefined,this,"sure");return false};return LimitTaskView}(BaseEuiView);__reflect(LimitTaskView.prototype,"LimitTaskView");ViewManager.ins().reg(LimitTaskView,LayerManager.UI_Main);var TaskAlertWin=function(_super){__extends(TaskAlertWin,_super);function TaskAlertWin(){var _this=_super.call(this)||this;_this.CLOSE_TIME=40;_this.timeCount=0;_this.skinName="TaskSkin";return _this}TaskAlertWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.rewardList.itemRenderer=ItemBase};TaskAlertWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.gotoBtn,this.onClick);this.setView()};TaskAlertWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve();TimerManager.ins().removeAll(this);this.removeTouchEvent(this.gotoBtn,this.onClick);egret.Tween.removeTweens(this.arrowGroup)};TaskAlertWin.prototype.setView=function(){var data=UserTask.ins().taskTrace;if(data){var config=UserTask.ins().getAchieveConfById(data.id);if(config){this.rewardList.dataProvider=new eui.ArrayCollection(config.awardList);if(config.type==79){this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(config.longdesc)}else{this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(config.longdesc)}}this.taskName.textFlow=TextFlowMaker.generateTextFlow(config.name+i18n("TaskAlertWin_5")+data.value+"/"+config.target+")|");switch(data.state){case 0:this.gotoBtn.label=i18n("TaskAlertWin_0");break;case 1:this.gotoBtn.label=i18n("TaskAlertWin_1");break}}var t=egret.Tween.get(this.arrowGroup,{loop:true});t.to({y:this.arrowGroup.y-10},400).to({y:this.arrowGroup.y+10},400);TimerManager.ins().remove(this.onTimeCount,this);this.timeCount=this.CLOSE_TIME;TimerManager.ins().doTimer(1e3,this.timeCount,this.onTimeCount,this);this.timeText.text=i18n("TaskAlertWin_2",this.timeCount)};TaskAlertWin.prototype.onTimeCount=function(){this.timeCount--;this.timeText.text=i18n("TaskAlertWin_3",this.timeCount);if(this.timeCount==0){TimerManager.ins().remove(this.onTimeCount,this);this.doTask()}};TaskAlertWin.prototype.onClick=function(e){switch(e.target){case this.gotoBtn:this.doTask();break}};TaskAlertWin.prototype.doTask=function(){var data=UserTask.ins().taskTrace;if(data.state==0){GameGuider.taskGuidance(data.id,1);GuideUtils.ins().updateByClick()}else{UserTask.ins().sendGetAchieve(data.achievementId);UserTask.ins().postParabolicItem();Hint.ins().postAchievementAft(data);if(!UserTask.ins().getAchieveConfById(data.id+1)){UserTips.ins().showTips(i18n("TaskAlertWin_4"))}}ViewManager.ins().close(TaskAlertWin)};return TaskAlertWin}(BaseEuiView);__reflect(TaskAlertWin.prototype,"TaskAlertWin");ViewManager.ins().reg(TaskAlertWin,LayerManager.Game_Main);var TaskEffectView=function(_super){__extends(TaskEffectView,_super);function TaskEffectView(){var _this=_super.call(this)||this;_this.init();return _this}TaskEffectView.prototype.init=function(){this._effGroup=new eui.Group;this.addChild(this._effGroup);this._arrowGroup=new eui.Group;this.addChild(this._arrowGroup);this._effCir=new MovieClip;this._effGroup.addChild(this._effCir);this._effCir.x=-20;this._arrow=new GuideArrow2;this._arrowGroup.addChild(this._arrow);this._arrow.x=20;this._arrow.y=20;this.touchChildren=false;this.touchEnabled=false};TaskEffectView.prototype.start=function(){TimerManager.ins().remove(this.update,this);TimerManager.ins().doTimer(500,0,this.update,this)};TaskEffectView.prototype.stop=function(){TimerManager.ins().remove(this.update,this);this.hide()};TaskEffectView.prototype.show=function(tips){if(!this._isShow){this._isShow=true;var view=ViewManager.ins().getView(PlayFunView);if(!view){this.hide();return}egret.Tween.removeTweens(this);this.alpha=0;egret.Tween.get(this).to({alpha:1},300);var target=view["taskTraceBtn"];this.x=target.width>>1;this.y=target.height>>1;this.x+=60;target.addChild(this);this._arrow.setDirection(1);this._effCir.playFile(RES_DIR_EFF+"guideff",-1)}this._arrow.setTips(tips)};TaskEffectView.prototype.hide=function(){if(this._isShow){this._isShow=false;this._arrow.removeTweens();if(this.parent)this.parent.removeChild(this)}};TaskEffectView.prototype.isShow=function(){return this._isShow};TaskEffectView.prototype.update=function(){var taskData=UserTask.ins().taskTrace;if(taskData){var config=UserTask.ins().getAchieveConfById(taskData.id);var noShowWin=["WelcomeWin"];for(var _i=0,noShowWin_1=noShowWin;_i<noShowWin_1.length;_i++){var win=noShowWin_1[_i];if(ViewManager.ins().getView(win)){this.hide();return}}if(config){if(taskData.state==0&&config.startwarning){this.show(config.startwarning)}else if(taskData.state==1&&config.finishwarning){this.show(config.finishwarning)}else{this.hide()}}}};return TaskEffectView}(egret.DisplayObjectContainer);__reflect(TaskEffectView.prototype,"TaskEffectView");var TaskItem=function(_super){__extends(TaskItem,_super);function TaskItem(){var _this=_super.call(this)||this;_this.skinName="TaskItemSkin";return _this}TaskItem.prototype.dataChanged=function(){var data=this.data;if(data){var config=GlobalConfig.DailyConfig[data.id];this.taskImg.source="";this.taskName.textFlow=TextFlowMaker.generateTextFlow(config.name+i18n("TaskItem_1")+config.activeValue+i18n("TaskItem_0"));this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(config.desc+i18n("TaskItem_2")+data.value+"/"+config.target+")");var i=void 0;var num=1;for(i in config.awardList){this["awards"+num++].setData(config.awardList[i])}if(num>2)this.awards2.visible=true;else this.awards2.visible=false;switch(data.state){case 0:this.gotoBtn.visible=true;this.awardsBtn.visible=false;this.completeImg.visible=this.completeLabel.visible=false;break;case 1:this.gotoBtn.visible=false;this.awardsBtn.visible=true;this.completeImg.visible=this.completeLabel.visible=false;break;case 2:this.gotoBtn.visible=false;this.awardsBtn.visible=false;this.completeImg.visible=this.completeLabel.visible=true;break}if(config.control==0)this.gotoBtn.visible=false}};return TaskItem}(BaseItemRender);__reflect(TaskItem.prototype,"TaskItem");var TGuide=function(_super){__extends(TGuide,_super);function TGuide(){var _this=_super.call(this)||this;_this.guide={};_this.handles={};_this.hasGuide=false;_this.loopTime=300;_this.sysId=PackageID.TGuide;_this.regNetMsg(1,_this.postInfo);ViewManager.ins().addAllViewListener(_this.delayUpdateHandles,_this);return _this}TGuide.ins=function(){return _super.ins.call(this)};TGuide.prototype.postInfo=function(bytes){this.guide={};var len=bytes.readInt();this.hasGuide=false;for(var i=0;i<len;i++){var id=bytes.readInt();var step=bytes.readInt();this.guide[id]=step;if(step>0&&!GlobalConfig.TGuideDetailConfig[id][step]){this.guide[id]=TGuide.TYPE.end}this.hasGuide=this.hasGuide||this.guide[id]>0}this.delayUpdateHandles()};TGuide.prototype.sendFinish=function(id,step){var bytes=this.getBytes(2);bytes.writeInt(id);bytes.writeInt(step);this.sendToServer(bytes)};TGuide.prototype.updateHandles=function(view){var container;var tar;var id;var step;for(var k in this.guide){id=k;step=this.guide[id];if(step<=0||view&&GlobalConfig.TGuideDetailConfig[id][step].view!=view){if(this.handles[id])this.handles[id].close();continue}try{tar=eval(GlobalConfig.TGuideDetailConfig[id][step].target);container=ViewManager.ins().getView(GlobalConfig.TGuideDetailConfig[id][step].view);if(tar&&tar.parent&&container&&container.parent&&tar.visible&&tar.parent.visible&&container.visible&&container.parent.visible){this.addGuide(id,step,tar,container);if(view)break}else{if(this.handles[id])this.handles[id].close()}}catch(e){}}};TGuide.prototype.delayUpdateHandles=function(view){var _this=this;clearTimeout(this._timer);this._timer=setTimeout(function(){_this.updateHandles();if(_this.hasGuide)_this.delayUpdateHandles(view)},this.loopTime)};TGuide.prototype.addGuide=function(id,step,tar,container){var _this=this;if(this.handles[id]){if(this.handles[id].tar!=tar||this.handles[id].container!=container||!tar.parent||!container.parent){this.handles[id].close()}else{this.handles[id].updatePosition();return}}else{this.handles[id]=new TGuideView}var finger=GlobalConfig.TGuideDetailConfig[id][step].finger;var text=GlobalConfig.TGuideDetailConfig[id][step].desc;var preventDefault=GlobalConfig.TGuideDetailConfig[id][step].preventDefault;var force=GlobalConfig.TGuideDetailConfig[id][step].force;var tGuideView=this.handles[id];tGuideView.open(finger,text,tar,container,function(){_this.sendFinish(id,step);try{eval(GlobalConfig.TGuideDetailConfig[id][step].afterClick)}catch(e){}},preventDefault,force)};TGuide.TYPE={close:0,end:-1};return TGuide}(BaseSystem);__reflect(TGuide.prototype,"TGuide");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.tGuide=TGuide.ins.bind(TGuide)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var TGuideView=function(_super){__extends(TGuideView,_super);function TGuideView(){var _this=_super.call(this)||this;_this.skinName="TGuideViewSkin";_this.width=0;_this.height=0;return _this}TGuideView.prototype.open=function(state,text,tar,container,callback,preventDefault,force){this.skin.currentState=""+(state||1);this.lab.text=""+(text||"");this.callback=callback||null;this.tar=tar;this.container=container;this.preventDefault=preventDefault;this.force=force;var x=-117;var y=-68;var z=40;this.finger.x=x;this.finger.y=y;egret.Tween.removeTweens(this.finger);egret.Tween.get(this.finger,{loop:true}).to({x:x-z,y:y+z},1e3).to({x:x-z,y:y+z},200).to({x:x,y:y},800);if(this.mc)this.mc.destroy();this.mc=new MovieClip;this.mc.playFile(RES_DIR_EFF+"guideff",-1);this.eff.addChild(this.mc);this.removeTouchEvent(this.rect,this.onTap);this.addTouchEvent(this.rect,this.onTap);container.addChild(this);this.updatePosition()};TGuideView.prototype.close=function(){if(this.mc){this.mc.destroy()}egret.Tween.removeTweens(this.finger);this.removeTouchEvent(this.rect,this.onTap);this.removeFromParent();this.tar=null;this.container=null};TGuideView.prototype.onTap=function(e){if(this.callback){this.callback();if(!this.preventDefault){this.tar.dispatchEventWith(egret.TouchEvent.TOUCH_END);this.tar.dispatchEventWith(egret.TouchEvent.TOUCH_TAP)}}this.close()};TGuideView.prototype.updatePosition=function(){var p=this.tar.localToGlobal();var p2=this.container.localToGlobal();var tx=p.x-p2.x+this.tar.width/2;if(tx!=this.x)this.x=tx;var ty=p.y-p2.y+this.tar.height/2;if(ty!=this.y)this.y=ty;var bw=this.force?this.container.width:0;if(bw!=this.bg.width)this.bg.width=bw;var bh=this.force?this.container.height:0;if(bh!=this.bg.height)this.bg.height=bh;var bx=this.force?-this.x:0;if(bx!=this.bg.x)this.bg.x=bx;var by=this.force?-this.y:0;if(by!=this.bg.y)this.bg.y=by};return TGuideView}(BaseEuiView);__reflect(TGuideView.prototype,"TGuideView");var TaskChains=function(){function TaskChains(){}return TaskChains}();__reflect(TaskChains.prototype,"TaskChains");var TicketSys=function(_super){__extends(TicketSys,_super);function TicketSys(){var _this=_super.call(this)||this;_this.taskChains={};_this.goodsInfo=[];_this.boxsInfo=[];_this.canGetTaskIds=[];_this.lsNormalToHigh=0;_this.lsHighToSuper=0;_this.lsNormalToUp=0;_this.isCompleted=true;_this.btnRedPointShow=false;_this.changedChainId=0;_this.sysId=PackageID.Ticket;_this.regNetMsg(1,_this.postGetInfo);_this.regNetMsg(2,_this.postBuyTicket);_this.regNetMsg(3,_this.postFinishTask);_this.regNetMsg(4,_this.postTaskInfo);_this.regNetMsg(5,_this.postDaoHangLv);_this.regNetMsg(6,_this.postBuyGood);_this.regNetMsg(7,_this.postBoxReward);return _this}TicketSys.ins=function(){if(this._ticketSys==null){this._ticketSys=new TicketSys}return this._ticketSys};TicketSys.prototype.sendGetInfoReq=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};TicketSys.prototype.postGetInfo=function(bytes){var taskChainNum=bytes.readInt();var taskChains={};for(var i=0;i<taskChainNum;++i){var chainId=bytes.readInt();var curTaskId=bytes.readInt();var finishedNum=bytes.readInt();var cycledNum=bytes.readInt();taskChains[chainId]={curTaskId:curTaskId,finishedNum:finishedNum,cycledNum:cycledNum}}this.taskChains=taskChains;this.curDaoHang=bytes.readInt();this.getLv=bytes.readInt();this.curLingShi=bytes.readInt();this.ticketId=bytes.readInt();this.hadBuyHigh=bytes.readInt();this.lsNormalToHigh=bytes.readInt();this.lsHighToSuper=bytes.readInt();this.lsNormalToUp=bytes.readInt();var goodsInfo=[];var goodsCount=bytes.readInt();for(var i=0;i<goodsCount;++i){var id=bytes.readInt();var dailyLimit=bytes.readInt();goodsInfo[id]=dailyLimit}this.goodsInfo=goodsInfo;var boxsCount=bytes.readInt();for(var j=0;j<boxsCount;j++){var id_5=bytes.readInt();var newState=bytes.readInt();var oldState=this.boxsInfo[id_5]||0;this.boxsInfo[id_5]=newState>oldState?newState:oldState}};TicketSys.prototype.sendBuyTicket=function(ticketId){if(ticketId>0){var bytes=this.getBytes(2);bytes.writeInt(ticketId);this.sendToServer(bytes)}};TicketSys.prototype.postBuyTicket=function(bytes){var ticketId=bytes.readInt();var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code==0){var getLinShi=bytes.readInt();this.ticketId=ticketId;if(getLinShi>0){var str=i18n("TicketSys_0",getLinShi);UserTips.ins().showTips2(str)}}else{UserTips.ins().showTips(error_msg)}};TicketSys.prototype.sendFinishTask=function(chainId,subId){var _this=this;this.isCompleted=false;var bytes=this.getBytes(3);bytes.writeInt(chainId);bytes.writeInt(subId);this.sendToServer(bytes);clearTimeout(this.finishTaskTimer);this.finishTaskTimer=setTimeout(function(){_this.isCompleted=true},2e3)};TicketSys.prototype.postFinishTask=function(bytes){clearTimeout(this.finishTaskTimer);var chainId=bytes.readInt();var subId=bytes.readInt();var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code==0){var rewardYb=bytes.readInt();var rewardStone=bytes.readInt();var rewardDaoHang=bytes.readInt();this.curDaoHang=bytes.readInt();this.getLv=bytes.readInt();if(rewardStone>0){var str=i18n("TicketSys_1",rewardStone);UserTips.ins().showTips2(str)}}else{UserTips.ins().showTips(error_msg)}};TicketSys.prototype.postFinishTaskcb=function(){};TicketSys.prototype.postTaskInfo=function(bytes){var chainId=bytes.readInt();this.changedChainId=chainId;if(this.taskChains[chainId]){var curTaskId=bytes.readInt();var finishedNum=bytes.readInt();var cycledNum=bytes.readInt();if(cycledNum==0&&curTaskId<this.taskChains[chainId].curTaskId){console.log("TicketSys postTaskInfo chainId = "+chainId+" curTaskId = "+curTaskId+" finishedNum = "+finishedNum);console.log("TicketSys postTaskInfo chainId = "+chainId+" this.curTaskId = "+this.taskChains[chainId].curTaskId+" this.finishedNum = "+this.taskChains[chainId].finishedNum);return}this.taskChains[chainId]={curTaskId:curTaskId,finishedNum:finishedNum,cycledNum:cycledNum}}};TicketSys.prototype.sendDaoHangLv=function(daoHangLv){var bytes=this.getBytes(5);bytes.writeInt(daoHangLv);this.sendToServer(bytes)};TicketSys.prototype.postDaoHangLv=function(bytes){this.getLv=bytes.readInt();this.curDaoHang=bytes.readInt();var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code==0){this.curLingShi=bytes.readInt();var getLingShi=bytes.readInt();if(getLingShi>0){var str=i18n("TicketSys_2",getLingShi);UserTips.ins().showTips2(str)}ViewManager.ins().open(DaoHangBreakWin,this.getLv,this.curDaoHang)}else{UserTips.ins().showTips(error_msg)}};TicketSys.prototype.sendBuyGood=function(buyId,count){var bytes=this.getBytes(6);bytes.writeInt(buyId);bytes.writeInt(count);this.sendToServer(bytes)};TicketSys.prototype.postBuyGood=function(bytes){var buyId=bytes.readInt();var count=bytes.readInt();var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code==0){this.goodsInfo[buyId]=bytes.readInt();this.curLingShi=bytes.readInt();var config=GlobalConfig.TicketLingShiShopConfig;if(config[buyId]&&count>0){}}else{UserTips.ins().showTips(error_msg)}};TicketSys.prototype.getSortedDataById=function(pageId){var cfg=GlobalConfig.TicketRewardConfig;var taskChains=this.taskChains;var finishedFlag=-1;var taskNoOpen=[];var taskHasReward=[];var taskNoReward=[];for(var chainId in taskChains){var chainInfo=taskChains[chainId];if(chainInfo){var curTaskId=chainInfo.curTaskId;if(curTaskId!=null&&curTaskId!=finishedFlag){var taskCfg=cfg[chainId][curTaskId];if(taskCfg&&taskCfg.pageid==pageId){var status_7=this.getTaskStatus(taskCfg.winOpenId,chainInfo.finishedNum,taskCfg.targetValue,taskCfg.provalue);if(status_7==TicketTaskStatus.hasReward){taskHasReward.push(taskCfg)}else if(status_7==TicketTaskStatus.noReward){taskNoReward.push(taskCfg)}else if(status_7==TicketTaskStatus.noOpen){taskNoOpen.push(taskCfg)}}}}}var sortedData=taskHasReward.concat(taskNoReward,taskNoOpen);return sortedData||[]};TicketSys.prototype.isBossTask=function(winOpenId){return winOpenId==WinType.grBoss||winOpenId==WinType.syBoss||winOpenId==WinType.ywBoss};TicketSys.prototype.getTaskStatus=function(winOpenId,finishedNum,targetValue,provalue){var status=TicketTaskStatus.noOpen;if(WinOpenMgr.ins().isOpen(winOpenId)){if(this.isBossTask(winOpenId)){return finishedNum==targetValue?TicketTaskStatus.hasReward:TicketTaskStatus.noReward}if(winOpenId==WinType.bazhuang){var finishedFirst=Math.floor(finishedNum/100);var finishedSec=finishedNum%100;var targetFirst=Math.floor(targetValue/100);var targetSec=targetValue%100;if(finishedFirst>=targetFirst&&finishedSec>=targetSec){status=TicketTaskStatus.hasReward}else{status=TicketTaskStatus.noReward}return status}if(provalue==1){finishedNum=Math.floor(finishedNum/targetValue);if(finishedNum>=provalue){status=TicketTaskStatus.hasReward}else{status=TicketTaskStatus.noReward}return status}if(finishedNum>=targetValue){status=TicketTaskStatus.hasReward}else{status=TicketTaskStatus.noReward}}else{status=TicketTaskStatus.noOpen}return status};TicketSys.prototype.isHasRewardByPageId=function(pageId){var isHas=false;var finishedFlag=-1;var taskChains=this.taskChains;var cfg=GlobalConfig.TicketRewardConfig;for(var chainId in taskChains){var chainInfo=taskChains[chainId];if(chainInfo){var curTaskId=chainInfo.curTaskId;if(curTaskId!=null&&curTaskId!=finishedFlag){var taskCfg=cfg[chainId][curTaskId];if(taskCfg&&taskCfg.pageid==pageId){var status_8=this.getTaskStatus(taskCfg.winOpenId,chainInfo.finishedNum,taskCfg.targetValue,taskCfg.provalue);if(status_8==TicketTaskStatus.hasReward){isHas=true;break}}}}}return isHas};TicketSys.prototype.isHasTicketReward=function(){var isHas=false;var pageCfg=GlobalConfig.TicketPageTitles;for(var pageId in pageCfg){if(pageCfg[pageId]&&pageCfg[pageId].id){if(this.isHasRewardByPageId(pageCfg[pageId].id)){isHas=true;break}}}return isHas};TicketSys.prototype.hasBuySuperTicket=function(){return this.ticketId>=TicketSys.SUPER};TicketSys.prototype.hasBuyHighTicket=function(){return this.ticketId>=TicketSys.HIGH};TicketSys.prototype.openRechargeWin=function(){Recharge.ins().tryShowChargeFirstWin()};TicketSys.prototype.getMaxDaoHangLv=function(){var cfg=GlobalConfig.TicketDaoHangLvConfig;var max=0;for(var id in cfg){if(cfg[id]&&cfg[id].id>max)max=cfg[id].id}return max};TicketSys.prototype.calculateScore=function(a){var ratios=[360,180,180,20];var score=0;if(a&&a.length>=ratios.length){for(var i=0;i<a.length;++i){score+=a[i]*ratios[i]}}return Math.floor(score/100)};TicketSys.prototype.postBtnRedPoint=function(){this.btnRedPointShow=true};TicketSys.prototype.getSortedAllData=function(){var cfg=GlobalConfig.TicketRewardConfig;var taskChains=this.taskChains;var finishedFlag=-1;var taskNoOpen=[];var taskHasReward=[];var taskNoReward=[];for(var chainId in taskChains){var chainInfo=taskChains[chainId];if(chainInfo){var curTaskId=chainInfo.curTaskId;if(curTaskId!=null&&curTaskId!=finishedFlag){var taskCfg=cfg[chainId][curTaskId];if(taskCfg){var status_9=this.getTaskStatus(taskCfg.winOpenId,chainInfo.finishedNum,taskCfg.targetValue,taskCfg.provalue);if(status_9==TicketTaskStatus.hasReward){taskHasReward.push(taskCfg)}else if(status_9==TicketTaskStatus.noReward){taskNoReward.push(taskCfg)}else if(status_9==TicketTaskStatus.noOpen){taskNoOpen.push(taskCfg)}}}}}var sortedData=taskHasReward.concat(taskNoReward,taskNoOpen);return sortedData||[]};TicketSys.prototype.allLingShi=function(){var count=0;for(var k in GlobalConfig.TicketDaoHangLvConfig){count+=GlobalConfig.TicketDaoHangLvConfig[k].vipStone||0}return count};TicketSys.prototype.sendGetBoxReward=function(boxId){if(!boxId)return;var bytes=this.getBytes(7);bytes.writeInt(boxId);this.sendToServer(bytes);console.log("82-7")};TicketSys.prototype.postBoxReward=function(bytes){var boxId=bytes.readInt();this.boxsInfo[boxId]=2;return boxId};TicketSys.prototype.getBoxState=function(boxId){return this.boxsInfo[boxId]||0};TicketSys.prototype.sendGetAllTasksReward=function(){var bytes=this.getBytes(8);this.sendToServer(bytes)};TicketSys.NORMAL=0;TicketSys.HIGH=1;TicketSys.SUPER=2;return TicketSys}(BaseSystem);__reflect(TicketSys.prototype,"TicketSys");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.ticketSys=TicketSys.ins.bind(TicketSys)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var TicketTaskStatus;(function(TicketTaskStatus){TicketTaskStatus[TicketTaskStatus["noOpen"]=0]="noOpen";TicketTaskStatus[TicketTaskStatus["hasReward"]=1]="hasReward";TicketTaskStatus[TicketTaskStatus["noReward"]=2]="noReward"})(TicketTaskStatus||(TicketTaskStatus={}));window["TicketTaskStatus"]=TicketTaskStatus;var DaoHangBreakWin=function(_super){__extends(DaoHangBreakWin,_super);function DaoHangBreakWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="DaoHangBreakSkin";_this.reward.itemRenderer=ItemBase;return _this}DaoHangBreakWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.rectClose,this.onClose);if(param&&param[0]!=null&&param[1]!=null){var getLv=param[0];var curDaoHang=param[1];var preConfig=GlobalConfig.TicketDaoHangLvConfig[getLv-1];var curConfig=GlobalConfig.TicketDaoHangLvConfig[getLv];var valueArr=[];if(preConfig){this.labelLastDuan.text=preConfig.title;var arrt=preConfig.attr;for(var i in arrt){this["labelPre"+i].text=""+arrt[i].value;valueArr.push(arrt[i].value)}this.labelPreValue.text=TicketSys.ins().calculateScore(valueArr)+""}if(curConfig){valueArr=[];this.labelCurDuan.text=curConfig.title;var arrt=curConfig.attr;for(var i in arrt){this["labelcur"+i].text=""+arrt[i].value;valueArr.push(arrt[i].value)}this.labelCurValue.text=TicketSys.ins().calculateScore(valueArr)+""}var ls=(TicketSys.ins().ticketId||0)!=TicketSys.NORMAL?GlobalConfig.TicketDaoHangLvConfig[getLv].vipStone:0;if(ls){this.skin.currentState="1";this.reward.dataProvider=new eui.ArrayCollection([{id:18,count:ls,type:0}])}else{this.skin.currentState="0"}this.play()}};DaoHangBreakWin.prototype.onClose=function(){this.close()};DaoHangBreakWin.prototype.close=function(){this.removeTouchEvent(this.rectClose,this.onClose);this.stopPlay();ViewManager.ins().close(this)};DaoHangBreakWin.prototype.play=function(){var _this=this;var gH=this.group.height;this.group.height=0;egret.Tween.get(this.group).to({height:gH},200);this.g1.alpha=0;egret.Tween.get(this.g1).to({alpha:0},200).to({alpha:1},200);var g1X=this.g1.x;var arrowsX=this.arrows.x;this.arrows.x=g1X;this.arrows.alpha=0;egret.Tween.get(this.arrows).to({alpha:0},200).to({x:arrowsX,alpha:1},200);var g2X=this.g2.x;this.g2.x=g1X;this.g2.alpha=0;egret.Tween.get(this.g2).to({alpha:0},200).to({x:g2X,alpha:1},200);if(this.skin.currentState=="1"){this.rewardGroup.alpha=0;TimerManager.ins().doTimerDelay(200,0,1,function(){_this.effGroup.scaleX=0;_this.effGroup.scaleY=0;egret.Tween.get(_this.effGroup).to({scaleX:1,scaleY:1},300,egret.Ease.bounceIn);_this.light.rotation=0;egret.Tween.get(_this.light,{loop:true}).to({rotation:360},2e3);_this.rewardTitle.scaleX=_this.rewardTitle.scaleY=.8;egret.Tween.get(_this.rewardTitle,{loop:true}).to({scaleX:.81,scaleY:.81},600,egret.Ease.circInOut);_this.light2.scaleX=_this.light2.scaleY=0;egret.Tween.get(_this.light2).to({scaleX:.8,scaleY:.8},500,egret.Ease.bounceOut).to({scaleX:0,scaleY:0},0);_this.rewardTitleBg.scaleX=_this.rewardTitleBg.scaleY=.8;egret.Tween.get(_this.rewardTitleBg,{loop:true}).to({scaleX:.81,scaleY:.81},600,egret.Ease.circInOut);egret.Tween.get(_this.rewardGroup).to({alpha:1},100)},this)}};DaoHangBreakWin.prototype.stopPlay=function(){egret.Tween.removeTweens(this.effGroup);egret.Tween.removeTweens(this.light);egret.Tween.removeTweens(this.rewardTitle);egret.Tween.removeTweens(this.light2);egret.Tween.removeTweens(this.rewardTitleBg);TimerManager.ins().removeAll(this)};return DaoHangBreakWin}(BaseEuiView);__reflect(DaoHangBreakWin.prototype,"DaoHangBreakWin");ViewManager.ins().reg(DaoHangBreakWin,LayerManager.UI_Main);var DaoHangRewardItem=function(_super){__extends(DaoHangRewardItem,_super);function DaoHangRewardItem(){var _this=_super.call(this)||this;_this.skinName="RewardItemSkin";return _this}DaoHangRewardItem.prototype.dataChanged=function(){var data=this.data;if(data==null)return;var ticketId=TicketSys.ins().ticketId;this.showGroup3();var showLv=TicketSys.ins().getLv+1;var maxLv=TicketSys.ins().getMaxDaoHangLv();showLv=showLv>=maxLv?maxLv:showLv;this.imageSelected.visible=data.id==showLv};DaoHangRewardItem.prototype.showGroup0=function(){var data=this.data;if(data==null)return;this.group0.visible=true;this.group1.visible=false;this.group2.visible=false;this.group3.visible=false;this.lblLvName0.text=""+data.title;this.lblDaoHang0.text="("+data.reachcount+")";this.lblSuperLingShi0.text=data.superstone+data.normalstone+"";this.lblHighLingShi0.text=data.highstone+data.normalstone+"";this.lblNormalYuanbao0.text=data.normalyb+"";this.lblNormalLingShi0.text=data.normalstone+""};DaoHangRewardItem.prototype.showGroup1=function(){var data=this.data;if(data==null)return;this.group0.visible=false;this.group1.visible=true;this.group2.visible=false;this.group3.visible=false;this.lblLvName1.text=""+data.title;this.lblDaoHang1.text="("+data.reachcount+")";this.lblSuperLingShi1.text=data.superstone+data.normalstone+"";this.lblHighLingShi1.text=data.highstone+data.normalstone+"";this.lblNormalYuanbao1.text=data.normalyb+""};DaoHangRewardItem.prototype.showGroup2=function(){var data=this.data;if(data==null)return;this.group0.visible=false;this.group1.visible=false;this.group2.visible=true;this.group3.visible=false;this.lblLvName2.text=""+data.title;this.lblDaoHang2.text="("+data.reachcount+")";this.lblSuperLingShi2.text=data.superstone+data.normalstone+"";this.lblNormalYuanbao2.text=data.normalyb+""};DaoHangRewardItem.prototype.showGroup3=function(){var data=this.data;if(data==null)return;this.group0.visible=false;this.group1.visible=false;this.group2.visible=false;this.group3.visible=true;this.lblDaoHang3.text="("+data.reachcount+")";this.lblLvName3.text=""+data.title;var attr=data.attr;if(attr&&attr.length>=4){this.lblAttack.text=""+attr[0].value;this.lblMagic.text=""+attr[1].value;this.lblDefence.text=""+attr[2].value;this.lblLife.text=""+attr[3].value}var ticketId=TicketSys.ins().ticketId||0;this.lock.visible=ticketId==TicketSys.NORMAL;this.lblLingshi.text=""+data.vipStone;this.checked.visible=data.id<=TicketSys.ins().getLv&&TicketSys.ins().ticketId>TicketSys.NORMAL;this.lingshi.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);this.lingshi.touchEnabled=false;if(this.lock.visible){this.lingshi.touchEnabled=true;this.lingshi.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)}};DaoHangRewardItem.prototype.onTap=function(e){switch(e.currentTarget){case this.lingshi:ViewManager.ins().close(DaoHangRewardWin);ViewManager.ins().open(XianMenJoinWin);break}};return DaoHangRewardItem}(BaseItemRender);__reflect(DaoHangRewardItem.prototype,"DaoHangRewardItem");var DaoHangRewardWin=function(_super){__extends(DaoHangRewardWin,_super);function DaoHangRewardWin(){var _this=_super.call(this)||this;_this.btnType=1;_this.isTopLevel=true;_this.skinName="DaoHangRewardSkin";return _this}DaoHangRewardWin.prototype.open=function(){this.addTouchEvent(this.rectClose,this.onClose);this.addTouchEvent(this.btnClose0,this.onClose);this.btnType=DaoHangRewardWin.BTN_REWARD;this.changeView()};DaoHangRewardWin.prototype.onTab=function(e){if(!e||e.currentTarget){switch(e.currentTarget){}this.changeView()}};DaoHangRewardWin.prototype.changeView=function(){var _this=this;DaoHangRewardWin.currentType=this.btnType;var listReward=this.listReward;listReward.dataProvider=new ArrayCollection([]);listReward.itemRenderer=DaoHangRewardItem;var rewardData=[];var cfg=GlobalConfig.TicketDaoHangLvConfig;for(var levelId in cfg){if(cfg[levelId]&&cfg[levelId].reachcount!=null){rewardData.push(cfg[levelId])}}var dataPro=listReward.dataProvider;dataPro.replaceAll(rewardData);if(TicketSys.ins().getLv>=TicketSys.ins().getMaxDaoHangLv()-6){TimerManager.ins().doTimer(50,1,function(){_this.scroller.viewport.scrollV=70*53},this)}else{TimerManager.ins().doTimer(50,1,function(){_this.scroller.viewport.scrollV=70*TicketSys.ins().getLv},this)}};DaoHangRewardWin.prototype.onClose=function(){this.close()};DaoHangRewardWin.prototype.close=function(){this.removeTouchEvent(this.rectClose,this.onClose);this.removeTouchEvent(this.btnClose0,this.onClose);ViewManager.ins().close(this)};DaoHangRewardWin.currentType=1;DaoHangRewardWin.BTN_ATTRIBUTE=0;DaoHangRewardWin.BTN_REWARD=1;return DaoHangRewardWin}(BaseEuiView);__reflect(DaoHangRewardWin.prototype,"DaoHangRewardWin");ViewManager.ins().reg(DaoHangRewardWin,LayerManager.UI_Main);var LingShiShopItem=function(_super){__extends(LingShiShopItem,_super);function LingShiShopItem(){var _this=_super.call(this)||this;_this.skinName="LingShiShopItemSkin";var list=_this.listItem;list.itemRenderer=ItemBase;list.dataProvider=new ArrayCollection([]);return _this}LingShiShopItem.prototype.dataChanged=function(){var data=this.data;if(data==null)return;this.lblLimitTime.text="";this.rewardsData=[];this.btnBuy.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnBuy,this);var buyCount=TicketSys.ins().goodsInfo[data.id];var leftBuyCount=0;if(data.isDailyLimit){leftBuyCount=Math.max(data.dailyLimit-buyCount,0);this.btnBuy.visible=leftBuyCount>0;this.lblLimitTime.visible=data.dailyLimit>0;this.lblLimitTime.textFlow=TextFlowMaker.generateTextFlow(i18n("LingShiShopItem_0")+ColorUtil.GREEN_COLOR_N+"&T:"+leftBuyCount+"|/"+data.dailyLimit+" )")}else if(data.isKfLimit){leftBuyCount=Math.max(data.kfLimit-buyCount,0);this.btnBuy.visible=leftBuyCount>0;this.lblLimitTime.visible=data.kfLimit>0;this.lblLimitTime.textFlow=TextFlowMaker.generateTextFlow(i18n("LingShiShopItem_1")+ColorUtil.GREEN_COLOR_N+"&T:"+leftBuyCount+"|/"+data.kfLimit+" )")}else{this.lblLimitTime.visible=false}if(data.isTimeLimit){}this.btnBuy.label=data.lsprice+"";if(data.isNeiMen){var ticketId=TicketSys.ins().ticketId;if(ticketId<TicketSys.SUPER){this.lblLimitTime.visible=false;this.btnBuy.skinName="Btn63Skin";this.btnBuy.label=i18n("LingShiShopItem_2")}}this.imgHotSale.visible=data.isHot>0;this.btnBuy.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnBuy,this);var rewardsData=[];for(var k in data.rewards){if(data.rewards[k]["id"]){rewardsData.push(data.rewards[k])}}var dataProvider=this.listItem.dataProvider;dataProvider.replaceAll(rewardsData);this.rewardsData=rewardsData};LingShiShopItem.prototype.onBtnBuy=function(){var data=this.data;if(data==null)return;if(data.isNeiMen&&TicketSys.ins().ticketId<TicketSys.SUPER){ViewManager.ins().open(XianMenJoinWin)}else{ViewManager.ins().open(TicketBuyGoodsWin,this.rewardsData,data.id)}};return LingShiShopItem}(BaseItemRender);__reflect(LingShiShopItem.prototype,"LingShiShopItem");var LingShiShopWin=function(_super){__extends(LingShiShopWin,_super);function LingShiShopWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="LingShiShopSkin";_this.observe(TicketSys.ins().postBuyGood,_this.updateShow);return _this}LingShiShopWin.prototype.open=function(){this.addTouchEvent(this.rectClose,this.onClose);this.addTouchEvent(this.btnClose0,this.onClose);var list=this.itemList;list.dataProvider=new ArrayCollection([]);list.itemRenderer=LingShiShopItem;this.updateShow()};LingShiShopWin.prototype.updateShow=function(){var goodsData=[];var cfg=GlobalConfig.TicketLingShiShopConfig;if(cfg){for(var id in cfg){if(cfg[id]&&cfg[id].id){goodsData.push(cfg[id])}}}goodsData.sort(this.sort);var dataProvider=this.itemList.dataProvider;dataProvider.replaceAll(goodsData)};LingShiShopWin.prototype.onClose=function(){this.close()};LingShiShopWin.prototype.close=function(){this.removeTouchEvent(this.rectClose,this.onClose);this.removeTouchEvent(this.btnClose0,this.onClose);this.removeObserve();ViewManager.ins().close(this);_super.prototype.close.call(this)};LingShiShopWin.prototype.sort=function(a,b){return(a.sort||0)-(b.sort||0)};return LingShiShopWin}(BaseEuiView);__reflect(LingShiShopWin.prototype,"LingShiShopWin");ViewManager.ins().reg(LingShiShopWin,LayerManager.UI_Main);var TicketBoxItem=function(_super){__extends(TicketBoxItem,_super);function TicketBoxItem(){var _this=_super.call(this)||this;_this.hasAnimation=false;_this.skinName="TicketBoxItemSkin";_this.box.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);return _this}TicketBoxItem.prototype.dataChanged=function(){var cfg=this.data;var itemCfg=GlobalConfig.ItemConfig[cfg.itemId];this.boxName.text=itemCfg.name;this.boxName.textColor=ItemConfig.getQualityColor(itemCfg);this.boxName.strokeColor=ItemConfig.getQualityStrokeColor(itemCfg);this.period.text=""+cfg.reachcount;this.box.icon="ticketbox"+cfg.id;var state=TicketSys.ins().getBoxState(cfg.id);if(state==0&&TicketSys.ins().curDaoHang>=cfg.reachcount){state=1}else if(state==1){state=2}this.state=state;switch(state){case 0:this.checked.visible=false;this.setShake(false);this.setLight(0);break;case 1:this.checked.visible=false;this.setShake(true);this.setLight(1);break;case 2:this.checked.visible=true;this.setShake(false);this.setLight(0);break}if(!this.itemBase)this.itemBase=new ItemBase;var reward=new RewardData;reward.id=cfg.itemId;reward.type=1;reward.count=1;this.itemBase.data=reward};TicketBoxItem.prototype.onTap=function(e){var cfg=this.data;switch(e.currentTarget){case this.box:if(this.state==1){this.setLight(2);setTimeout(function(){TicketSys.ins().sendGetBoxReward(cfg.id)},300)}else{this.itemBase.onClick()}break}};TicketBoxItem.prototype.setShake=function(open){if(open){if(this.hasAnimation)return;this.hasAnimation=true;this.box.rotation=-3;var t=egret.Tween.get(this.box,{loop:true});t.to({rotation:3},300,function(p){return Math.cos(2*Math.PI*p)})}else{if(!this.hasAnimation)return;this.hasAnimation=false;egret.Tween.removeTweens(this.box);this.box.rotation=0}};TicketBoxItem.prototype.setLight=function(state){switch(state){case 0:if(this.mc1&&this.eff1.getChildIndex(this.mc1)>=0){this.eff1.removeChild(this.mc1)}if(this.mc2&&this.eff2.getChildIndex(this.mc2)>=0){this.eff2.removeChild(this.mc2)}break;case 1:if(!this.mc1){this.mc1=new MovieClip;this.mc1.playFile(RES_DIR_EFF+"czzl_bxhdeff",-1)}if(this.eff1.getChildIndex(this.mc1)<0){this.eff1.addChild(this.mc1)}if(this.mc2&&this.eff2.getChildIndex(this.mc2)>=0){this.eff2.removeChild(this.mc2)}break;case 2:if(!this.mc2){this.mc2=new MovieClip;this.mc2.playFile(RES_DIR_EFF+"czzl_bxbkeff",-1)}if(this.eff2.getChildIndex(this.mc2)<0){this.eff2.addChild(this.mc2)}if(this.mc1&&this.eff1.getChildIndex(this.mc1)>=0){this.eff1.removeChild(this.mc1)}break}};TicketBoxItem.prototype.setPressure=function(open){if(open){this.checked.visible=true;this.checked.scaleX=this.checked.scaleY=1.8;var t=egret.Tween.get(this.checked);t.to({scaleX:1,scaleY:1},300,function(p){return p*p*p})}};return TicketBoxItem}(BaseItemRender);__reflect(TicketBoxItem.prototype,"TicketBoxItem");var TicketBuyGoodsWin=function(_super){__extends(TicketBuyGoodsWin,_super);function TicketBuyGoodsWin(){var _this=_super.call(this)||this;_this.lackTip=i18n("TicketBuyGoodsWin_0");_this.isTopLevel=true;_this.skinName="TicketBuyGoodsSkin";var list=_this.listItem;list.itemRenderer=ItemBase;list.dataProvider=new ArrayCollection([]);return _this}TicketBuyGoodsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.btnClose,this.onClose);this.addTouchEvent(this.btnAdd,this.onTouch);this.addTouchEvent(this.btnMax,this.onTouch);this.addTouchEvent(this.btnDec,this.onTouch);this.addTouchEvent(this.btnBuy,this.onBuy);this.inputCount.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onFocusOut,this);this.observe(TicketSys.ins().postBuyGood,this.onFocusOut);if(param&&param[0]!=null&&param[1]!=null){var dataPro=this.listItem.dataProvider;dataPro.replaceAll(param[0]);this.itemId=param[1];this.inputCount.text=0+"";this.lblTotalCost.text=0+"";this.lastTouchObj=this.btnAdd;this.inputCount.restrict="0-9";this.updateData()}};TicketBuyGoodsWin.prototype.onTouch=function(e){if(!e||!e.currentTarget)return;this.lastTouchObj=e.currentTarget;this.updateData()};TicketBuyGoodsWin.prototype.onFocusOut=function(){this.lastTouchObj=this.inputCount;this.updateData()};TicketBuyGoodsWin.prototype.updateData=function(){var cfg=GlobalConfig.TicketLingShiShopConfig[this.itemId];if(!cfg){console.log("TicketBuyGoodsWin updateData itemId error,itemId = "+this.itemId);return}var lingShi=TicketSys.ins().curLingShi;var price=cfg.lsprice;var curCount=parseInt(this.inputCount.text);var maxCount=Math.floor(lingShi/price);this.lblLimitTime.visible=false;if(cfg.isDailyLimit&&cfg.dailyLimit){var buyCount=TicketSys.ins().goodsInfo[this.itemId];var leftBuyCount=cfg.dailyLimit-buyCount;leftBuyCount=Math.max(leftBuyCount,0);maxCount=Math.min(leftBuyCount,maxCount);this.lblLimitTime.textFlow=TextFlowMaker.generateTextFlow(i18n("TicketBuyGoodsWin_1")+ColorUtil.GREEN_COLOR_N+"&T:"+leftBuyCount+"|/"+cfg.dailyLimit+" )");this.lblLimitTime.visible=true;if(leftBuyCount<=0){this.inputCount.text=maxCount+"";this.lblTotalCost.text=""+maxCount*price;UserTips.ins().showTips(i18n("TicketBuyGoodsWin_2"));this.checkInputText();return}}else if(cfg.isKfLimit&&cfg.kfLimit){var buyCount=TicketSys.ins().goodsInfo[this.itemId];var leftBuyCount=cfg.kfLimit-buyCount;leftBuyCount=Math.max(leftBuyCount,0);maxCount=Math.min(leftBuyCount,maxCount);this.lblLimitTime.textFlow=TextFlowMaker.generateTextFlow(i18n("TicketBuyGoodsWin_1")+ColorUtil.GREEN_COLOR_N+"&T:"+leftBuyCount+"|/"+cfg.kfLimit+" )");this.lblLimitTime.visible=true;if(leftBuyCount<=0){this.inputCount.text=maxCount+"";this.lblTotalCost.text=""+maxCount*price;UserTips.ins().showTips(i18n("TicketBuyGoodsWin_2"));this.checkInputText();return}}if(this.lastTouchObj==this.btnAdd||this.lastTouchObj==this.btnMax||this.lastTouchObj==this.inputCount){if(maxCount==0){this.inputCount.text=maxCount+"";this.lblTotalCost.text=""+maxCount*price;UserTips.ins().showTips(this.lackTip);this.checkInputText();return}else if(curCount>=maxCount){this.inputCount.text=maxCount+"";this.lblTotalCost.text=""+maxCount*price;UserTips.ins().showTips(i18n("TicketBuyGoodsWin_3"));this.checkInputText();return}}switch(this.lastTouchObj){case this.btnAdd:curCount++;break;case this.btnMax:curCount=maxCount;break;case this.btnDec:curCount--;curCount=Math.max(curCount,0);break;case this.inputCount:break}this.inputCount.text=curCount+"";this.lblTotalCost.text=""+curCount*price;this.checkInputText()};TicketBuyGoodsWin.prototype.checkInputText=function(){if(this.inputCount.text=="0"){this.removeTouchEvent(this.btnBuy,this.onBuy);this.btnBuy.skinName="Btn42Skin";this.inputCount.textColor=16711718}else{this.addTouchEvent(this.btnBuy,this.onBuy);this.btnBuy.skinName="Btn3Skin";this.inputCount.textColor=14668213}};TicketBuyGoodsWin.prototype.onBuy=function(){var lingShi=TicketSys.ins().curLingShi;var curCount=parseInt(this.inputCount.text);var cfg=GlobalConfig.TicketLingShiShopConfig[this.itemId];if(!cfg){UserTips.ins().showTips(i18n("TicketBuyGoodsWin_4"));return}var cost=curCount*cfg.lsprice;if(lingShi<=0||lingShi<cost){UserTips.ins().showTips(this.lackTip)}else if(cost>0&&lingShi>=cost){TicketSys.ins().sendBuyGood(this.itemId,curCount)}else if(cost<=0){UserTips.ins().showTips(i18n("TicketBuyGoodsWin_5"))}};TicketBuyGoodsWin.prototype.onClose=function(){this.close()};TicketBuyGoodsWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeTouchEvent(this.btnAdd,this.onTouch);this.removeTouchEvent(this.btnMax,this.onTouch);this.removeTouchEvent(this.btnBuy,this.onBuy);this.removeTouchEvent(this.btnDec,this.onTouch);this.inputCount.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onFocusOut,this);this.removeObserve();ViewManager.ins().close(this)};return TicketBuyGoodsWin}(BaseEuiView);__reflect(TicketBuyGoodsWin.prototype,"TicketBuyGoodsWin");ViewManager.ins().reg(TicketBuyGoodsWin,LayerManager.UI_Popup);var TicketGoodWarnWin=function(_super){__extends(TicketGoodWarnWin,_super);function TicketGoodWarnWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="TicketGoodWarnSkin";var list=_this.listItem;list.itemRenderer=ItemBase;list.dataProvider=new ArrayCollection([]);return _this}TicketGoodWarnWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.btnSure,this.onClose);var buyId=param[0];var count=param[1];var config=GlobalConfig.TicketLingShiShopConfig;var data=[];var rewards=config[buyId].rewards;for(var i in rewards){if(rewards[i].count){var id=rewards[i].id;var type=rewards[i].type;data.push({id:id,count:count,type:type})}}var dataProvider=this.listItem.dataProvider;dataProvider.replaceAll(data)};TicketGoodWarnWin.prototype.onClose=function(){this.close()};TicketGoodWarnWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeTouchEvent(this.btnSure,this.onClose);ViewManager.ins().close(this)};return TicketGoodWarnWin}(BaseEuiView);__reflect(TicketGoodWarnWin.prototype,"TicketGoodWarnWin");ViewManager.ins().reg(TicketGoodWarnWin,LayerManager.UI_Popup);var TicketPageItem=function(_super){__extends(TicketPageItem,_super);function TicketPageItem(){var _this=_super.call(this)||this;_this.pageSrc="ticketpage";_this.skinName="TicketPageItemSkin";return _this}TicketPageItem.prototype.dataChanged=function(){if(this.data==null)return;var pageId=this.itemIndex+1;this.imgPage.source=this.pageSrc+pageId;this.redPoint.visible=TicketSys.ins().isHasRewardByPageId(pageId);if(this.selected){if(!this.mc){this.mc=new MovieClip;this.mc.x=40;this.mc.y=72}this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1);this.addChild(this.mc)}else{if(this.mc){DisplayUtils.removeFromParent(this.mc);this.mc=null}}};return TicketPageItem}(BaseItemRender);__reflect(TicketPageItem.prototype,"TicketPageItem");var TicketTaskItem=function(_super){__extends(TicketTaskItem,_super);function TicketTaskItem(){var _this=_super.call(this)||this;_this.skinName="TicketTaskItemSkin";_this.setMC();return _this}TicketTaskItem.prototype.clearUI=function(){this.lblYuanBao.text="";this.lblLingShi.text="";this.lblTaskDesc.text="";this.lblDaoHang.text="";this.barProgress.value=0;this.labelDisplay.text="0 / 0";this.redPoint.visible=this.mcg.visible=false;this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGetBtn,this);this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGo,this);this.groupLingShi.removeEventListener(egret.TouchEvent.TOUCH_END,this.onGroupLingShi,this);this.btnGetAll.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGetAll,this)};TicketTaskItem.prototype.dataChanged=function(){var data=this.data;if(data==null)return;this.clearUI();var barProgress=this.barProgress;var btnGet=this.btnGet;var groupProgress=this.groupProgress;var ybNum=0;var lsNum=0;var ticketId=TicketSys.ins().ticketId;if(ticketId==TicketSys.NORMAL){ybNum=data.normalyb;lsNum=data.normalstone||0}else if(ticketId==TicketSys.HIGH){ybNum=data.normalyb;lsNum=data.highstone}else if(ticketId==TicketSys.SUPER){ybNum=data.normalyb;lsNum=data.superstone}this.lblYuanBao.text=""+ybNum;this.lblLingShi.text=""+(lsNum==0?i18n("TicketTaskItem_0"):lsNum);this.lblTaskDesc.text=data.taskdesc;this.lblDaoHang.text=i18n("TicketTaskItem_1")+data.daohang;this.btnGetAll.visible=false;this.btnGet.visible=true;this.item.data=data.reward[0];if(data.isShowBar==1){groupProgress.visible=true;var finishedNum=0;var curTaskInfo=TicketSys.ins().taskChains[data.chainid];if(curTaskInfo&&curTaskInfo.curTaskId==data.subid){finishedNum=curTaskInfo.finishedNum}if(data.provalue==1){if(TicketSys.ins().isBossTask(data.winOpenId)){finishedNum=finishedNum==data.targetValue?1:0}else{finishedNum=Math.floor(finishedNum/data.targetValue)}}var maximum=data.targetValue;finishedNum=finishedNum>maximum?maximum:finishedNum;this.labelDisplay.text=finishedNum+" / "+data.provalue;barProgress.maximum=data.provalue;barProgress.value=finishedNum;if(.9<barProgress.value/barProgress.maximum&&barProgress.value/barProgress.maximum<1){barProgress.value=barProgress.maximum*.9}}else{groupProgress.visible=false}var taskChains=TicketSys.ins().taskChains;var chainInfo=taskChains[data.chainid];var status=TicketSys.ins().getTaskStatus(data.winOpenId,chainInfo.finishedNum,data.targetValue,data.provalue);if(status==TicketTaskStatus.hasReward){if(TicketSys.ins().hasBuySuperTicket()&&this.itemIndex==0){this.btnGet.visible=this.mcg.visible=false;this.btnGetAll.visible=true;this.btnGetAll.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGetAll,this)}else{this.btnGetAll.visible=false;this.btnGet.visible=this.redPoint.visible=this.mcg.visible=true;btnGet.label=i18n("TicketTaskItem_2");btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onGetBtn,this)}this.redPoint.visible=true}else if(status==TicketTaskStatus.noReward){btnGet.label=i18n("TicketTaskItem_3");btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGo,this)}else if(status==TicketTaskStatus.noOpen){groupProgress.visible=false;btnGet.label=i18n("TicketTaskItem_4");btnGet.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnGo,this);if(data.unlockWin){btnGet.label=i18n("TicketTaskItem_6")}}if(!TicketSys.ins().hasBuySuperTicket()){this.groupLingShi.addEventListener(egret.TouchEvent.TOUCH_END,this.onGroupLingShi,this)}this.cycle.visible=data.signMark?true:false;this.cycle.source=data.signMark||"";this.tip.visible=status==TicketTaskStatus.noOpen?true:false;this.tip.text=data.annotation||""};TicketTaskItem.prototype.onGetBtn=function(){if(!TicketSys.ins().isCompleted){return}var data=this.data;TicketSys.ins().sendFinishTask(data.chainid,data.subid)};TicketTaskItem.prototype.onBtnGo=function(){var data=this.data;if(data==null)return;if(data.winOpenId<=0){ViewManager.ins().close(TicketWin);return}var winCfg=GlobalConfig.WinOpenConfig[data.winOpenId];if(WinOpenMgr.ins().isOpen(data.winOpenId)){if(winCfg&&winCfg.winClass){if(winCfg.winId==WinType.lingYu||winCfg.winId==WinType.fuWen||winCfg.winId==WinType.heirloom){ViewManager.ins().open(winCfg.winClass,0,winCfg.subWinId||0)}else{ViewManager.ins().open(winCfg.winClass,winCfg.subWinId||0,0)}}}else{if(data.unlockWin){ViewManager.ins().open(FuliWin,data.unlockWin[0])}else{UserTips.ins().showTips(i18n("TicketTaskItem_5"))}}};TicketTaskItem.prototype.onBtnGoUnlock=function(){var data=this.data;if(data==null)return;if(data.winOpenId<=0){ViewManager.ins().close(TicketWin);return}var winCfg=GlobalConfig.WinOpenConfig[data.winOpenId];if(WinOpenMgr.ins().isOpen(data.winOpenId)){if(winCfg&&winCfg.winClass){ViewManager.ins().open(winCfg.winClass,winCfg.subWinId||0,0)}}else{UserTips.ins().showTips(i18n("TicketTaskItem_5"))}};TicketTaskItem.prototype.onGroupLingShi=function(){if(!TicketSys.ins().hasBuySuperTicket()){ViewManager.ins().open(XianMenJoinWin)}};TicketTaskItem.prototype.onBtnGetAll=function(){TicketSys.ins().sendGetAllTasksReward()};TicketTaskItem.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=59.5;this.mc.y=24;this.mc.width=119;this.mc.height=52;this.mc.scaleX=.81;this.mc.scaleY=.86;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.mcg.addChild(this.mc)}};return TicketTaskItem}(BaseItemRender);__reflect(TicketTaskItem.prototype,"TicketTaskItem");var TicketWin=function(_super){__extends(TicketWin,_super);function TicketWin(){var _this=_super.call(this)||this;_this.isGetDaoHangReward=false;_this.ticketType=0;_this.showType=0;_this.showTag="hanshow";_this.isTopLevel=true;_this.skinName="Ticket2Skin";return _this}TicketWin.prototype.initLists=function(){var listTask=this.listTask;listTask.dataProvider=new ArrayCollection([]);listTask.itemRenderer=TicketTaskItem};TicketWin.prototype.initTicketType=function(){var ticketId=TicketSys.ins().ticketId;this.ticketType=ticketId==TicketSys.NORMAL?TicketSys.HIGH:ticketId};TicketWin.prototype.open=function(){this.addTouchEvent(this.btnRecharge,this.onTouch);this.addTouchEvent(this.lblMyLingShi,this.onTouch);this.addTouchEvent(this.btnLingShiShop,this.onTouch);this.addTouchEvent(this.btnXunBaoShop,this.onTouch);this.addTouchEvent(this.roleBtn,this.onTouch);this.addTouchEvent(this.btnClose0,this.onClose);this.addTouchEvent(this.btnPreview,this.onBtnPreview);this.addTouchEvent(this.ticketName,this.onTouch);this.addTouchEvent(this.btnBaishi,this.onTouch);this.observe(Actor.ins().postYbChange,this.updateData);this.observe(TicketSys.ins().postGetInfo,this.updateShow);this.observe(TicketSys.ins().postBuyTicket,this.updateAfterBuyTicket);this.observe(TicketSys.ins().postFinishTask,this.doFinishTaskResult);this.observe(TicketSys.ins().postTaskInfo,this.updateShow);this.observe(TicketSys.ins().postDaoHangLv,this.updateShow);this.observe(TicketSys.ins().postBuyGood,this.updateShow);this.observe(TicketSys.ins().postFinishTaskcb,this.getAllTaskReward);this.observe(TicketSys.ins().postBoxReward,this.updateBoxById);this.observe(TicketSys.ins().postBuyTicket,this.updateTicket);this.initLists();this.initTicketType();this.updateShow();this.startPlay();this.updateRewardInfo(TicketSys.ins().ticketId);var self=this;this.setRoleModel();TicketSys.ins().isCompleted=true;this.autoShowTip();TimerManager.ins().doTimer(3e4,0,this.autoShowTip,this)};TicketWin.prototype.setRoleModel=function(){var roleData=SubRoles.ins().getSubRoleByIndex(0);var sex=roleData.sex;if(!this.roleMc){this.roleMc=new MovieClip;this.roleMc.playFile(RES_DIR_EFF+(sex?"czzl_nveff":"czzl_naneff"),-1);this.imgModel.removeChildren();this.imgModel.addChild(this.roleMc)}var y=this.imgModel.y;var tw=egret.Tween.get(this.imgModel,{loop:true});tw.to({y:y-4},700).to({y:y},700)};TicketWin.prototype.onPostTaskInfo=function(){this.updateTaskInfo()};TicketWin.prototype.updateTaskInfo=function(){var chainId=TicketSys.ins().changedChainId;var listTask=this.listTask;var source=listTask.dataProvider.source;var chainIdx=-1;for(var i in source){if(source[i]&&source[i].chainid==chainId){chainIdx=parseInt(i);break}}if(chainIdx>=0){var taskItemUI=listTask.getElementAt(chainIdx);if(taskItemUI){taskItemUI.dataChanged()}}};TicketWin.prototype.updateAfterBuyTicket=function(){this.updateShow();this.updateRewardInfo(TicketSys.ins().ticketId)};TicketWin.prototype.doFinishTaskResult=function(){this.updateShow();TicketSys.ins().isCompleted=true};TicketWin.prototype.updateShow=function(){var _this=this;clearTimeout(this._updateShowTimer);this._updateShowTimer=setTimeout(function(){_this.updateData();_this.updateDaoHangInfo();_this.updateListTask();_this.addUIEff();_this.updateBox();_this.updateTicket()},100)};TicketWin.prototype.addUIEff=function(){this.eff=new MovieClip;this.eff.touchEnabled=false;this.mcGroup.addChild(this.eff);this.eff.playFile(RES_DIR_EFF+"xxch_eff",-1)};TicketWin.prototype.updateData=function(){CommonUtils.labelIsOverLenght(this.lblMyLingShi,TicketSys.ins().curLingShi||0);CommonUtils.labelIsOverLenght(this.lblMyYuanBao,Actor.yb||0)};TicketWin.prototype.updateDaoHangInfo=function(){var sysIns=TicketSys.ins();var btnPreview=this.btnPreview;var curDaoHang=sysIns.curDaoHang;this.btnredPoint.visible=false;TicketSys.ins().btnRedPointShow=false;var levelCount=4;var showStarNum=sysIns.getLv%levelCount;if(sysIns.getLv>=sysIns.getMaxDaoHangLv())showStarNum=4;for(var i=1;i<levelCount;++i){var imgStar=this["imgStar"+i];if(imgStar){imgStar.visible=i<=showStarNum}}var showLv=sysIns.getLv+1;showLv=showLv>=TicketSys.ins().getMaxDaoHangLv()?TicketSys.ins().getMaxDaoHangLv():showLv;var showCfg;var showtitleCfg;if(showLv>=TicketSys.ins().getMaxDaoHangLv()){showCfg=GlobalConfig.TicketDaoHangLvConfig[TicketSys.ins().getMaxDaoHangLv()];showtitleCfg=GlobalConfig.TicketDaoHangLvConfig[TicketSys.ins().getMaxDaoHangLv()]}else{showCfg=GlobalConfig.TicketDaoHangLvConfig[showLv];showtitleCfg=GlobalConfig.TicketDaoHangLvConfig[showLv-1]}var reachcount=1;btnPreview.skinName="BtnPreviewSkin";btnPreview.label=i18n("TicketWin_10");this.isGetDaoHangReward=false;if(showCfg&&sysIns.getLv<TicketSys.ins().getMaxDaoHangLv()){var imageIndex=Math.floor((showLv-1)/4)+1;if(!showtitleCfg)btnPreview.label=i18n("TicketWin_10");else btnPreview.label=showtitleCfg.title;reachcount=showCfg.reachcount;if(curDaoHang>=showCfg.reachcount){btnPreview.skinName="BtnBreakSkin";this.btnredPoint.visible=true;TicketSys.ins().postBtnRedPoint();this.isGetDaoHangReward=true}}else{btnPreview.label=showtitleCfg.title;btnPreview.skinName="BtnPreviewSkin";this.btnredPoint.visible=false}this.setRoleBreakMc(this.btnredPoint.visible);var barDaoHang=this.barDaoHang;barDaoHang.maximum=reachcount;barDaoHang.value=curDaoHang;this.lblCurDaoHang.text=""+curDaoHang;this.lblTaskDaoHang.text="/"+reachcount;var moreLingShi=0;if(sysIns.lsNormalToHigh>0){moreLingShi+=sysIns.lsNormalToHigh}if(sysIns.lsHighToSuper>0){moreLingShi+=sysIns.lsHighToSuper}if(TicketSys.ins().ticketId!=TicketSys.NORMAL){this.removeTouchEvent(this.ticketName,this.onTouch)}this.baishilingshi.text=""+TicketSys.ins().lsNormalToUp;this.baishitip.visible=TicketSys.ins().ticketId==TicketSys.NORMAL&&TicketSys.ins().lsNormalToUp>0;this.btnBaishiGroup.visible=this.btnBaishi.visible=TicketSys.ins().ticketId!=TicketSys.SUPER;if(TicketSys.ins().ticketId==TicketSys.NORMAL){this.nextTicketName.text=i18n("TicketWin_3")}else if(TicketSys.ins().ticketId==TicketSys.HIGH){this.nextTicketName.text=i18n("TicketWin_14")}};TicketWin.prototype.updateRewardInfo=function(ticketType){var showLv=TicketSys.ins().getLv+1;var maxLv=TicketSys.ins().getMaxDaoHangLv();showLv=showLv>=maxLv?maxLv:showLv;var cfg=GlobalConfig.TicketDaoHangLvConfig[showLv];var title="";var yuanBaoNum=0;var lingShiNum=0;var ticketId=TicketSys.ins().ticketId;var status,statusColor;if(ticketType<ticketId){ticketType=ticketId}if(ticketType==ticketId&&(ticketType==TicketSys.NORMAL||ticketType==TicketSys.HIGH)){ticketType++}this.ticketType=ticketType;if(ticketType!=ticketId&&ticketId<TicketSys.SUPER&&ticketType>ticketId){status=i18n("TicketWin_5");statusColor=15991812}else{status=i18n("TicketWin_4");statusColor=242004}};TicketWin.prototype.updateListTask=function(){var dataProv=this.listTask.dataProvider;var data=TicketSys.ins().getSortedAllData();if(data){dataProv.replaceAll(data);this.listTask.visible=data.length>0;this.imgNoTaskBg.visible=data.length<=0}};TicketWin.prototype.getAllTaskReward=function(isAuto){TicketSys.ins().sendGetAllTasksReward()};TicketWin.prototype.onTouch=function(e){if(!e||!e.currentTarget)return;switch(e.currentTarget){case this.btnLingShiShop:this.openSubWin(LingShiShopWin);break;case this.btnXunBaoShop:this.openSubWin(TicketLingShiTreasureWin);break;case this.btnBaishi:case this.roleBtn:case this.lingshiTip:case this.lblLingShiTip:case this.imgModel:case this.btnRecharge:case this.lblMyLingShi:this.openSubWin(XianMenJoinWin);break}};TicketWin.prototype.startPlay=function(){if(!TimerManager.ins().isExists(this.changeShowReward,this)&&!TicketSys.ins().hasBuyHighTicket()){TimerManager.ins().doTimer(3e3,0,this.changeShowReward,this)}};TicketWin.prototype.stopPlay=function(){this.showType=this.ticketType;TimerManager.ins().remove(this.changeShowReward,this)};TicketWin.prototype.waitTimeGo=function(){TimerManager.ins().doTimer(5e3,1,this.startPlay,this)};TicketWin.prototype.changeShowReward=function(){this.showType++;this.showType=this.showType>TicketSys.SUPER?TicketSys.ins().ticketId:this.showType;var type=this.showType%3;this.updateRewardInfo(type)};TicketWin.prototype.openSubWin=function(subWin){ViewManager.ins().open(subWin)};TicketWin.prototype.onBtnPreview=function(){if(this.isGetDaoHangReward){if(TicketSys.ins().getLv>=TicketSys.ins().getMaxDaoHangLv()){this.openSubWin(DaoHangRewardWin)}else TicketSys.ins().sendDaoHangLv(TicketSys.ins().getLv+1)}else{this.openSubWin(DaoHangRewardWin)}};TicketWin.prototype.onClose=function(){this.close()};TicketWin.prototype.close=function(){this.removeTouchEvent(this.btnRecharge,this.onTouch);this.removeTouchEvent(this.lblMyLingShi,this.onTouch);this.removeTouchEvent(this.btnLingShiShop,this.onTouch);this.removeTouchEvent(this.btnXunBaoShop,this.onTouch);this.removeTouchEvent(this.btnClose0,this.onClose);this.removeTouchEvent(this.btnPreview,this.onBtnPreview);this.removeTouchEvent(this.roleBtn,this.onTouch);this.removeObserve();TimerManager.ins().removeAll(this);clearTimeout(this._timer);ViewManager.ins().close(this);_super.prototype.close.call(this);DisplayUtils.removeFromParent(this.eff)};TicketWin.prototype.autoShowTip=function(){var _this=this;this.lblLingShiTip.textFlow=TextFlowMaker.generateTextFlow(i18n("TicketWin_13",TicketSys.ins().lsNormalToUp));var tw=egret.Tween.get(this.lingshiTip);if(TicketSys.ins().ticketId==TicketSys.NORMAL){this.lingshiTip.visible=true;clearTimeout(this._timer);this._timer=setTimeout(function(){_this.lingshiTip.visible=false},5e3)}else{this.lingshiTip.visible=false;TimerManager.ins().remove(this.autoShowTip,this);clearTimeout(this._timer)}};TicketWin.prototype.updateBox=function(){var config=GlobalConfig.TicketPeriodRewardConfig;var baseValue=100;var index=0;var len=0;for(var k in config){if(Number(k)!=Number(k))continue;len++;if(TicketSys.ins().curDaoHang>=config[k].reachcount&&Number(k)>index){index=Number(k)}this["box"+k].data=config[k]}var overValue=TicketSys.ins().curDaoHang-(config[index]?config[index].reachcount:0);var space=config[index+1]?config[index+1].reachcount-(config[index]?config[index].reachcount:0):0;this.bar.maximum=len*baseValue;this.bar.value=index*baseValue+(space?Math.floor(baseValue*overValue/space):0);this.daoHangValue.text=""+TicketSys.ins().curDaoHang};TicketWin.prototype.updateBoxById=function(boxId){console.log("updateBoxById:"+boxId);if(this["box"+boxId]){this["box"+boxId].setPressure(true);this["box"+boxId].dataChanged()}};TicketWin.prototype.updateTicket=function(){this.ticketNameGroup.visible=true;if(TicketSys.ins().ticketId==TicketSys.HIGH){this.ticketName.source="waimenticketname"}else if(TicketSys.ins().ticketId==TicketSys.SUPER){this.ticketName.source="neimenticketname"}else{this.ticketNameGroup.visible=false}};TicketWin.prototype.setRoleBreakMc=function(open){var roleData=SubRoles.ins().getSubRoleByIndex(0);var sex=roleData.sex;if(open){if(!this.eff2)this.eff2=new MovieClip;this.eff2.playFile(RES_DIR_EFF+(sex?"czzl_nvalleff":"czzl_nanalleff"),-1);if(this.groupFly.getChildIndex(this.eff2)<0)this.groupFly.addChild(this.eff2)}else{if(this.eff2&&this.groupFly.getChildIndex(this.eff2)>=0){this.groupFly.removeChild(this.eff2)}}};return TicketWin}(BaseEuiView);__reflect(TicketWin.prototype,"TicketWin");ViewManager.ins().reg(TicketWin,LayerManager.UI_Main);var XianMenJoinWin=function(_super){__extends(XianMenJoinWin,_super);function XianMenJoinWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="XianMenJoin2Skin";_this.reward.itemRenderer=ItemBase;return _this}XianMenJoinWin.prototype.open=function(){this.addTouchEvent(this.btnClose,this.onClose);this.addTouchEvent(this.rectClose,this.onClose);this.addTouchEvent(this.tipMask,this.onTouch);this.addTouchEvent(this.xiangxi,this.onTouch);this.addTouchEvent(this.btnInfoClose,this.onTouch);this.addTouchEvent(this.btnBuyHigh,this.onTouch);this.addTouchEvent(this.btnBuySuper,this.onTouch);this.addTouchEvent(this.btnInfoClose0,this.onTouch);this.addTouchEvent(this.btnBack,this.onTouch);this.addTouchEvent(this.btnOk,this.onTouch);this.addTouchEvent(this.rectClose2,this.onTouch);this.observe(TicketSys.ins().postBuyTicket,this.updateShow);this.updateShow()};XianMenJoinWin.prototype.updateShow=function(){this.updateNeiMenShow();this.updateWaiMenShow();this.cangetlingshi.text=""+TicketSys.ins().lsNormalToUp;this.toptip.visible=(TicketSys.ins().ticketId||0)==TicketSys.NORMAL&&(TicketSys.ins().lsNormalToUp||0)>0;if(this.toptip.visible){this.setMC()}};XianMenJoinWin.prototype.updateNeiMenShow=function(){if((TicketSys.ins().ticketId||0)==TicketSys.SUPER){this.neiMenGroup.visible=false;this.isNeiMenGroup.visible=true;this.setRoleModel()}else{this.neiMenGroup.visible=true;this.isNeiMenGroup.visible=false;var cfg=GlobalConfig.TicketItemConfig[2];var cfg0=GlobalConfig.TicketItemConfig[1];this.lblLsSuper.text="x"+TicketSys.ins().allLingShi();this.daohamgzhi.text="+"+(cfg.bonus||0);var items=[];for(var k in GlobalConfig.TicketLingShiShopConfig){if(GlobalConfig.TicketLingShiShopConfig[k]&&GlobalConfig.TicketLingShiShopConfig[k].isNeiMen){items=items.concat(GlobalConfig.TicketLingShiShopConfig[k].rewards)}}this.reward.dataProvider=new eui.ArrayCollection(items);var state=TicketSys.ins().hasBuyHighTicket();this.lblSuperVip.text=i18n("XianMenJoinWin_11",cfg.vip);if(state){this.neimp=cfg.priceYb-cfg0.priceYb;this.btnBuySuper.label=""+this.neimp;this.groupDisc.visible=false;this.OldSuperPriceGroup.visible=false;this.buysuperLabel0.visible=false;this.buysuperLabel1.visible=true}else{this.neimp=cfg.newPrice;this.lblOldSuperPrice.text=""+cfg.priceYb;this.btnBuySuper.label=""+this.neimp;this.groupDisc.visible=true;this.OldSuperPriceGroup.visible=true;this.buysuperLabel0.visible=true;this.buysuperLabel1.visible=false}}};XianMenJoinWin.prototype.updateWaiMenShow=function(){if((TicketSys.ins().ticketId||0)==TicketSys.SUPER){this.group0.removeChild(this.groupHigh)}else if((TicketSys.ins().ticketId||0)==TicketSys.HIGH){this.isWaiMenImg.visible=true;this.waiMenGroup.visible=false}else{var cfg=GlobalConfig.TicketItemConfig[1];this.waimp=cfg.priceYb;this.isWaiMenImg.visible=false;this.waiMenGroup.visible=true;this.lblLsHigh.text="x"+TicketSys.ins().allLingShi();this.btnBuyHigh.label=""+this.waimp;this.lblHighVip.text=i18n("XianMenJoinWin_11",cfg.vip)}};XianMenJoinWin.prototype.onTouch=function(e){if(!e||!e.currentTarget)return;switch(e.currentTarget){case this.btnBuyHigh:this.openWaiMenTip();break;case this.btnBuySuper:this.sendBuySuperTicket();break;case this.tipMask:this.closeTip();break;case this.xiangxi:this.openInfo();break;case this.btnInfoClose:this.closeInfo();break;case this.btnInfoClose0:case this.btnBack:case this.rectClose2:this.closeWaiMenTip();break;case this.btnOk:this.sendBuyHighTicket();break}};XianMenJoinWin.prototype.sendBuyHighTicket=function(){var vipLv=UserVip.ins().lv;var cfg=GlobalConfig.TicketItemConfig;var vip=cfg[1].vip;if(Actor.yb<this.waimp){UserTips.ins().showTips(i18n("XianMenJoinWin_10"))}else if(vipLv>=vip){TicketSys.ins().sendBuyTicket(TicketSys.HIGH);this.closeWaiMenTip()}else{UserTips.ins().showTips(i18n("XianMenJoinWin_5")+vip);this.openTip(i18n("XianMenJoinWin_8",vip))}};XianMenJoinWin.prototype.sendBuySuperTicket=function(){var vipLv=UserVip.ins().lv;var cfg=GlobalConfig.TicketItemConfig;var vip=cfg[2].vip;if(Actor.yb<this.neimp){UserTips.ins().showTips(i18n("XianMenJoinWin_10"))}else if(vipLv>=vip){TicketSys.ins().sendBuyTicket(TicketSys.SUPER)}else{UserTips.ins().showTips(i18n("XianMenJoinWin_6")+vip);this.openTip(i18n("XianMenJoinWin_9",vip))}};XianMenJoinWin.prototype.onClose=function(){this.close()};XianMenJoinWin.prototype.close=function(){this.removeTouchEvent(this.btnClose,this.onClose);this.removeTouchEvent(this.rectClose,this.onClose);this.removeTouchEvent(this.tipMask,this.onTouch);this.removeTouchEvent(this.xiangxi,this.onTouch);this.removeTouchEvent(this.btnInfoClose,this.onTouch);this.removeTouchEvent(this.btnBuyHigh,this.onTouch);this.removeTouchEvent(this.btnBuySuper,this.onTouch);this.removeObserve();this.removeRoleModel();ViewManager.ins().close(this)};XianMenJoinWin.prototype.closeTip=function(){this.tipMask.visible=false};XianMenJoinWin.prototype.openTip=function(tip){this.tipMask.visible=true;this.labelTip.text=tip||""};XianMenJoinWin.prototype.openInfo=function(){this.info.text=GlobalConfig.HelpInfoConfig[52].text;this.inforMask.visible=true};XianMenJoinWin.prototype.closeInfo=function(){this.inforMask.visible=false};XianMenJoinWin.prototype.openWaiMenTip=function(){var vipLv=UserVip.ins().lv;var cfg=GlobalConfig.TicketItemConfig;var vip=cfg[1].vip;if(Actor.yb<this.waimp){UserTips.ins().showTips(i18n("XianMenJoinWin_10"))}else if(vipLv>=vip){this.waiMenTip.visible=true}else{UserTips.ins().showTips(i18n("XianMenJoinWin_5")+vip);this.openTip(i18n("XianMenJoinWin_8",vip))}};XianMenJoinWin.prototype.closeWaiMenTip=function(){this.waiMenTip.visible=false};XianMenJoinWin.prototype.setRoleModel=function(){var roleData=SubRoles.ins().getSubRoleByIndex(0);var sex=roleData.sex;if(!this.roleMc){this.roleMc=new MovieClip;this.roleMc.playFile(RES_DIR_EFF+(sex?"czzl_nveff":"czzl_naneff"),-1);this.imgModel.removeChildren();this.imgModel.addChild(this.roleMc)}var y=this.imgModel.y;var tw=egret.Tween.get(this.imgModel,{loop:true});tw.to({y:y-4},700).to({y:y},700)};XianMenJoinWin.prototype.removeRoleModel=function(){if(this.roleMc){this.roleMc.stop();this.roleMc=null}this.imgModel.removeChildren();egret.Tween.removeTweens(this.imgModel)};XianMenJoinWin.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=-7;this.mc.y=0;this.mc.scaleX=.8;this.mc.scaleY=.5;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.mcg.addChild(this.mc)}};return XianMenJoinWin}(BaseEuiView);__reflect(XianMenJoinWin.prototype,"XianMenJoinWin");ViewManager.ins().reg(XianMenJoinWin,LayerManager.UI_Main);var TicketLingShiTreasure=function(_super){__extends(TicketLingShiTreasure,_super);function TicketLingShiTreasure(){var _this=_super.call(this)||this;_this.huntTimes=0;_this.huntBoxInfo=[];_this.huntHope=0;_this.huntFreeTimes=0;_this.huntRecords=[];_this.upRequest=false;_this.sysId=PackageID.TicketLingShiTreasure;_this.regNetMsg(1,_this.postTicketLingShiTreasureMgrInfo);_this.regNetMsg(4,_this.doHuntBack);_this.regNetMsg(5,_this.postHuntRecord);_this.regNetMsg(7,_this.postHuntBoxInfo);return _this}TicketLingShiTreasure.ins=function(){return _super.ins.call(this)};TicketLingShiTreasure.prototype.sendTicketLingShiTreasureMgrAdd=function(slot){var bytes=this.getBytes(1);bytes.writeByte(slot);this.sendToServer(bytes)};TicketLingShiTreasure.prototype.sendTicketLingShiTreasureMgrAct=function(roleId,slot){var bytes=this.getBytes(2);bytes.writeByte(roleId);bytes.writeByte(slot);this.sendToServer(bytes)};TicketLingShiTreasure.prototype.sendTicketLingShiTreasureMgrUpLevel=function(roleId,slot){var bytes=this.getBytes(3);bytes.writeByte(roleId);bytes.writeByte(slot);this.upRequest=true;this.sendToServer(bytes)};TicketLingShiTreasure.prototype.postTicketLingShiTreasureMgrInfo=function(bytes){};TicketLingShiTreasure.prototype.sendHunt=function(times){var bytes=this.getBytes(4);bytes.writeByte(times);this.sendToServer(bytes)};TicketLingShiTreasure.prototype.sendHuntRecord=function(){this.sendBaseProto(5)};TicketLingShiTreasure.prototype.sendHuntAward=function(index){var bytes=this.getBytes(6);bytes.writeInt(index);this.sendToServer(bytes)};TicketLingShiTreasure.prototype.doHuntBack=function(bytes){var type=bytes.readUnsignedByte();var num=bytes.readUnsignedByte();var arr=[];for(var i=0;i<num;i++)arr[i]=[bytes.readInt(),bytes.readUnsignedByte()];if(ViewManager.ins().isShow(HuntResultWin))this.postHuntResult(type,arr,5);else{ViewManager.ins().open(HuntResultWin,type,arr,5);this.postHuntResult(type,arr,5)}};TicketLingShiTreasure.prototype.postHuntResult=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}return params};TicketLingShiTreasure.prototype.postHuntRecord=function(bytes){this.huntRecords=[];var num=bytes.readUnsignedByte();for(var i=0;i<num;i++)this.huntRecords[i]=[bytes.readString(),bytes.readInt()];this.huntRecords.reverse()};TicketLingShiTreasure.prototype.postHuntBoxInfo=function(bytes){var state=bytes.readInt();this.huntTimes=bytes.readInt();this.huntHope=bytes.readInt();this.huntFreeTimes=bytes.readShort();var config;var i=0;for(var k in GlobalConfig.TicketLingShiTreasureRewardConfig){config=GlobalConfig.TicketLingShiTreasureRewardConfig[k];this.huntBoxInfo[i]=state>>config.id&1?TicketLingShiTreasure.HADGET:this.huntTimes>=config.needTime?TicketLingShiTreasure.CANGET:TicketLingShiTreasure.UNGET;i++}};TicketLingShiTreasure.prototype.getIsGetBox=function(){return this.huntBoxInfo.indexOf(TicketLingShiTreasure.CANGET)!=-1||this.huntFreeTimes>0};TicketLingShiTreasure.prototype.isTicketLingShiTreasureMgrHuntOpen=function(){return Actor.level>=GlobalConfig.TicketLingShiTreasureConfig.openlevel};TicketLingShiTreasure.UNGET=0;TicketLingShiTreasure.CANGET=1;TicketLingShiTreasure.HADGET=2;return TicketLingShiTreasure}(BaseSystem);__reflect(TicketLingShiTreasure.prototype,"TicketLingShiTreasure");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.ticketLingShiTreasureMgr=TicketLingShiTreasure.ins.bind(TicketLingShiTreasure)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var TicketLingShiTreasureWin=function(_super){__extends(TicketLingShiTreasureWin,_super);function TicketLingShiTreasureWin(){var _this=_super.call(this)||this;_this.addBoxEvent=false;_this.huntType=0;_this.isTopLevel=true;_this.skinName="TicketLingShiTreasureSkin";return _this}TicketLingShiTreasureWin.prototype.childrenCreated=function(){this.init()};TicketLingShiTreasureWin.prototype.init=function(){var cfg=GlobalConfig.TicketLingShiTreasureConfig;var len=cfg.boxes.length;var gift;for(var i=0;i<len;i++){gift=this["gift"+i];gift.data=cfg.boxes[i]}this.eff=new MovieClip;this.eff.x=59;this.eff.y=23;this.eff.scaleX=.8;this.eff.scaleY=.8;this.eff.touchEnabled=false;this.list.itemRenderer=HuntListRenderer;this.zb1.text=cfg.huntOnce+"";this.zb10.text=cfg.huntTenth+"";this.btnGroup.visible=false;this.mcGroup.removeChildren();this.iconMc=new MovieClip;this.iconMc.x=0;this.iconMc.y=0;this.mcGroup.addChild(this.iconMc);this.iconMc.playFile(RES_DIR_BODY+cfg.showBody,-1);this.mcDizuo.removeChildren();this.dizuoMc=new MovieClip;this.dizuoMc.x=0;this.dizuoMc.y=0;this.mcDizuo.addChild(this.dizuoMc);this.dizuoMc.playFile(RES_DIR_EFF+cfg.showDizuo,-1);this.mcGroup0.removeChildren();this.iconMc0=new MovieClip;this.iconMc0.x=0;this.iconMc0.y=0;this.mcGroup0.addChild(this.iconMc0);this.iconMc0.playFile(RES_DIR_BODY+cfg.showBody0,-1);this.mcDizuo0.removeChildren();this.dizuoMc0=new MovieClip;this.dizuoMc0.x=0;this.dizuoMc0.y=0;this.mcDizuo0.addChild(this.dizuoMc0);this.dizuoMc0.playFile(RES_DIR_EFF+cfg.showDizuo0,-1)};TicketLingShiTreasureWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.buy1,this.onBuy);this.addTouchEvent(this.buy10,this.onBuy);this.addTouchEvent(this.btnClose0,this.onTouch);this.addTouchEvent(this.btnAddLs,this.onTouch);this.addTouchEvent(this.btnAddYb,this.onTouch);this.observe(TicketLingShiTreasure.ins().postHuntRecord,this.listRefush);this.observe(TicketLingShiTreasure.ins().postHuntBoxInfo,this.updateBox);this.observe(TicketSys.ins().postGetInfo,this.updateData);this.observe(Actor.ins().postYbChange,this.updateData);this.listRefush();TicketLingShiTreasure.ins().sendHuntRecord();this.updateBox();this.addBoxEvent=true;this.updateData()};TicketLingShiTreasureWin.prototype.updateData=function(){CommonUtils.labelIsOverLenght(this.lblMyLingShi,TicketSys.ins().curLingShi||0);CommonUtils.labelIsOverLenght(this.lblMyYuanBao,Actor.yb||0)};TicketLingShiTreasureWin.prototype.onTouch=function(e){if(!e||!e.target)return;switch(e.target){case this.btnAddLs:ViewManager.ins().open(XianMenJoinWin);break;case this.btnAddYb:TicketSys.ins().openRechargeWin();break;case this.btnClose0:this.close();break;default:break}};TicketLingShiTreasureWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buy1,this.onBuy);this.removeTouchEvent(this.buy10,this.onBuy);this.removeTouchEvent(this.btnClose0,this.onTouch);this.removeTouchEvent(this.btnAddLs,this.onTouch);this.removeTouchEvent(this.btnAddYb,this.onTouch);this.removeObserve();DisplayUtils.removeFromParent(this.eff);this.addBoxEvent=false;ViewManager.ins().close(this)};TicketLingShiTreasureWin.prototype.listRefush=function(){this.list.dataProvider=new eui.ArrayCollection(TicketLingShiTreasure.ins().huntRecords)};TicketLingShiTreasureWin.prototype.onBuy=function(e){switch(e.target){case this.buy1:this.buyHunt(0);break;case this.buy10:this.buyHunt(1);break;default:break}};TicketLingShiTreasureWin.prototype.buyHunt=function(type){if(type==0&&TicketLingShiTreasure.ins().huntFreeTimes>0){--TicketLingShiTreasure.ins().huntFreeTimes;TicketLingShiTreasure.ins().sendHunt(type);return}this.huntType=type;var huntOnce=type==0?GlobalConfig.TicketLingShiTreasureConfig.huntOnce:GlobalConfig.TicketLingShiTreasureConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TicketLingShiTreasurePanel-HuntResultWin"+type,this.huntWarnFun.bind(this),i18n("TicketLingShiTreasureWin_0",huntOnce,type?10:1))};TicketLingShiTreasureWin.prototype.huntWarnFun=function(){var huntOnce=this.huntType==0?GlobalConfig.TicketLingShiTreasureConfig.huntOnce:GlobalConfig.TicketLingShiTreasureConfig.huntTenth;if(TicketSys.ins().curLingShi>=huntOnce){TicketLingShiTreasure.ins().sendHunt(this.huntType)}else{var warnWin=WarnWin.show(i18n("TicketLingShiTreasureWin_1"),function(){ViewManager.ins().open(XianMenJoinWin)},this,null,null,"sure");warnWin.setBtnLabel(i18n("TicketLingShiTreasureWin_2"))}};TicketLingShiTreasureWin.prototype.updateBox=function(){var lenBox=TicketLingShiTreasure.ins().huntBoxInfo.length;var state;var config;var i=0;var cfg=GlobalConfig.TicketLingShiTreasureRewardConfig;for(var k in cfg){if(!cfg[k]||!cfg[k].needTime)continue;config=cfg[k];this["time"+i].text=config.needTime+i18n("TicketLingShiTreasureWin_3");this["time"+i].visible=true;this["done"+i].visible=false;this["boxPoint"+i].visible=false;this["bar"+i].value=0;this["box"+i].source="ticketlingshibox1";this["box"+i].name="box"+(i+1);if(!this.addBoxEvent)this.addTouchEvent(this["box"+i],this.onGetAward);if(i<lenBox){state=TicketLingShiTreasure.ins().huntBoxInfo[i];if(state==TicketLingShiTreasure.CANGET){this["box"+i].source="ticketlingshibox";this["bar"+i].value=100;this["boxPoint"+i].visible=true}else if(state==TicketLingShiTreasure.HADGET){this["time"+i].visible=false;this["done"+i].visible=true;this["bar"+i].value=100}}i++}this.hopeValue0.text=TicketLingShiTreasure.ins().huntHope+"";this.times.text=TicketLingShiTreasure.ins().huntTimes+"";this.maskImage();this.redPoint3.visible=TicketLingShiTreasure.ins().huntFreeTimes>0;this.buy1.label=i18n("TicketLingShiTreasureWin_4")};TicketLingShiTreasureWin.prototype.maskImage=function(){var curPross=TicketLingShiTreasure.ins().huntHope;var maxPross=GlobalConfig.TicketLingShiTreasureConfig.maxBlissVal;var percent=curPross/maxPross;percent=percent<1?percent:1;if(percent>=1){if(this.maxHopeValue0.mask)this.maxHopeValue0.mask=null;if(this.maskShape){this.maskShape.graphics.clear();this.maskShape=null}return}if(!this.maxHopeValue0.mask){this.maskShape=new egret.Shape;this.maskShape.graphics.beginFill(16776960);this.maskShape.graphics.drawRect(this.maxHopeValue0.x,this.maxHopeValue0.y,this.maxHopeValue0.width,this.maxHopeValue0.height);this.maxHopeValue0.parent.addChild(this.maskShape);this.maxHopeValue0.mask=this.maskShape}this.maskShape.y=this.maxHopeValue0.height*(1-percent)};TicketLingShiTreasureWin.prototype.onGetAward=function(e){var index=e.target.name.slice(3,4);var state=TicketLingShiTreasure.ins().huntBoxInfo[index-1];if(state==TicketLingShiTreasure.CANGET)TicketLingShiTreasure.ins().sendHuntAward(index);else ViewManager.ins().open(HuntBoxsTips,index,6)};return TicketLingShiTreasureWin}(BaseEuiView);__reflect(TicketLingShiTreasureWin.prototype,"TicketLingShiTreasureWin");ViewManager.ins().reg(TicketLingShiTreasureWin,LayerManager.UI_Main);var TimeCardMgr=function(_super){__extends(TimeCardMgr,_super);function TimeCardMgr(){var _this=_super.call(this)||this;_this.tianZhu=0;_this.curProValue=0;_this.ybToMaster=0;_this.tzToMaster=0;_this.type=0;_this.startime=0;_this.getInfo={};_this.goodsInfo={};_this.sysId=PackageID.TimeCard;_this.regNetMsg(1,_this.postInfo);_this.regNetMsg(2,_this.postBuyResult);_this.regNetMsg(3,_this.postGetReward);_this.observe(Actor.ins().postLevelChange,_this.checkOpen);_this.observe(UserFb.ins().postGuanKaIdChange,_this.checkOpen);return _this}TimeCardMgr.ins=function(){if(this._instace==null){this._instace=new TimeCardMgr}return this._instace};TimeCardMgr.prototype.checkOpen=function(){if(OpenSystem.ins().checkSysOpen(SystemType.TIMECARD)){this.sendCheckTimeOut();this.removeObserve()}};TimeCardMgr.prototype.sendGetInfo=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};TimeCardMgr.prototype.postInfo=function(bytes){this.tianZhu=bytes.readInt();this.curProValue=bytes.readInt();this.ybToMaster=bytes.readInt();this.tzToMaster=bytes.readInt();this.type=bytes.readInt();this.startime=bytes.readInt();var len1=bytes.readInt();var getInfo={};for(var i=0;i<len1;++i){var id=bytes.readInt();var flag=bytes.readInt();getInfo[id]=flag}this.getInfo=getInfo;var len2=bytes.readInt();var goodsnfo={};for(var i=0;i<len2;++i){var id=bytes.readInt();var flag=bytes.readInt();goodsnfo[id]=flag}this.goodsInfo=goodsnfo};TimeCardMgr.prototype.sendBuyMaster=function(type){if(type===void 0){type=0}type=this.type+1;var bytes=this.getBytes(2);bytes.writeInt(type);this.sendToServer(bytes)};TimeCardMgr.prototype.postBuyResult=function(bytes){var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code==0){this.type=bytes.readInt()}UserTips.ins().showTips(error_msg)};TimeCardMgr.prototype.sendGetReward=function(id){var bytes=this.getBytes(3);bytes.writeInt(id);this.sendToServer(bytes)};TimeCardMgr.prototype.postGetReward=function(bytes){var error_code=bytes.readInt();var error_msg=bytes.readString();var id=bytes.readInt();UserTips.ins().showTips(error_msg)};TimeCardMgr.prototype.sendCheckTimeOut=function(){var bytes=this.getBytes(4);this.sendToServer(bytes)};TimeCardMgr.prototype.sendBuyGood=function(id,count){var bytes=this.getBytes(5);bytes.writeInt(id);bytes.writeInt(count);this.sendToServer(bytes)};TimeCardMgr.prototype.postBuyGood=function(bytes){var buyId=bytes.readInt();var count=bytes.readInt();var error_code=bytes.readInt();var error_msg=bytes.readString();if(error_code==0){var dailyLimit=bytes.readInt();var tianZhu=bytes.readInt()}UserTips.ins().showTips(error_msg)};TimeCardMgr.prototype.hasCanGetReward=function(){var config=GlobalConfig.TimeCardRewardConfig;for(var id in config){var idNum=parseInt(id);if(this.canGetRewardById(idNum)&&this.hasRewardById(idNum)){return true}}return false};TimeCardMgr.prototype.canGetRewardById=function(id){var cfg=GlobalConfig.TimeCardRewardConfig[id];return cfg&&this.curProValue>=cfg.value};TimeCardMgr.prototype.hasReward=function(){var config=GlobalConfig.TimeCardRewardConfig;for(var id in config){if(this.hasRewardById(parseInt(id))){return true}}return false};TimeCardMgr.prototype.hasRewardById=function(id){var record=this.getInfo[id];return record!=null&&record==0};return TimeCardMgr}(BaseSystem);__reflect(TimeCardMgr.prototype,"TimeCardMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.timeCardMgr=TimeCardMgr.ins.bind(TimeCardMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var TimeCardBuyGoodWin=function(_super){__extends(TimeCardBuyGoodWin,_super);function TimeCardBuyGoodWin(){var _this=_super.call(this)||this;_this.lackTip=i18n("TimeCardBuyGoodWin_0");_this.isTopLevel=true;_this.skinName="TimeCardBuyGoodSkin";var list=_this.listItem;list.itemRenderer=ItemBase;list.dataProvider=new ArrayCollection([]);return _this}TimeCardBuyGoodWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.btnClose,this.onClose);this.addTouchEvent(this.btnAdd,this.onTouch);this.addTouchEvent(this.btnMax,this.onTouch);this.addTouchEvent(this.btnDec,this.onTouch);this.addTouchEvent(this.btnBuy,this.onBuy);this.inputCount.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onFocusOut,this);this.observe(TimeCardMgr.ins().postBuyGood,this.onFocusOut);if(param&&param[0]!=null&&param[1]!=null){var dataPro=this.listItem.dataProvider;dataPro.replaceAll(param[0]);this.itemId=param[1];this.inputCount.text=0+"";this.lblTotalCost.text=0+"";this.lastTouchObj=this.btnAdd;this.inputCount.restrict="0-9";this.updateData()}};TimeCardBuyGoodWin.prototype.onTouch=function(e){if(!e||!e.currentTarget)return;this.lastTouchObj=e.currentTarget;this.updateData()};TimeCardBuyGoodWin.prototype.onFocusOut=function(){this.lastTouchObj=this.inputCount;this.updateData()};TimeCardBuyGoodWin.prototype.updateData=function(){var cfg=GlobalConfig.TimeCardShopConfig[this.itemId];if(!cfg){console.log("TimeCardBuyGoodWin updateData itemId error,itemId = "+this.itemId);return}var tianZhu=TimeCardMgr.ins().tianZhu;var price=cfg.price;var curCount=parseInt(this.inputCount.text);var maxCount=Math.floor(tianZhu/price);this.lblLimitTime.visible=false;if(cfg.dailyLimit){var buyCount=TimeCardMgr.ins().goodsInfo[this.itemId];var leftBuyCount=cfg.dailyLimit-buyCount;leftBuyCount=Math.max(leftBuyCount,0);maxCount=Math.min(leftBuyCount,maxCount);this.lblLimitTime.textFlow=TextFlowMaker.generateTextFlow(i18n("TimeCardBuyGoodWin_1")+ColorUtil.GREEN_COLOR_N+"&T:"+leftBuyCount+"|/"+cfg.dailyLimit+" )");this.lblLimitTime.visible=true;if(leftBuyCount<=0){this.inputCount.text=maxCount+"";this.lblTotalCost.text=""+maxCount*price;UserTips.ins().showTips(i18n("TimeCardBuyGoodWin_2"));this.checkInputText();return}}if(this.lastTouchObj==this.btnAdd||this.lastTouchObj==this.btnMax||this.lastTouchObj==this.inputCount){if(maxCount==0){this.inputCount.text=maxCount+"";this.lblTotalCost.text=""+maxCount*price;UserTips.ins().showTips(this.lackTip);this.checkInputText();return}else if(curCount>=maxCount){this.inputCount.text=maxCount+"";this.lblTotalCost.text=""+maxCount*price;UserTips.ins().showTips(i18n("TimeCardBuyGoodWin_3"));this.checkInputText();return}}switch(this.lastTouchObj){case this.btnAdd:curCount++;break;case this.btnMax:curCount=maxCount;break;case this.btnDec:curCount--;curCount=Math.max(curCount,0);break;case this.inputCount:break}this.inputCount.text=curCount+"";this.lblTotalCost.text=""+curCount*price;this.checkInputText()};TimeCardBuyGoodWin.prototype.checkInputText=function(){if(this.inputCount.text=="0"){this.removeTouchEvent(this.btnBuy,this.onBuy);this.btnBuy.skinName="Btn42Skin";this.inputCount.textColor=16711718}else{this.addTouchEvent(this.btnBuy,this.onBuy);this.btnBuy.skinName="Btn3Skin";this.inputCount.textColor=14668213}};TimeCardBuyGoodWin.prototype.onBuy=function(){var tianZhu=TimeCardMgr.ins().tianZhu;var curCount=parseInt(this.inputCount.text);var cfg=GlobalConfig.TimeCardShopConfig[this.itemId];if(!cfg){UserTips.ins().showTips(i18n("TimeCardBuyGoodWin_4"));return}var cost=curCount*cfg.price;if(tianZhu<=0||tianZhu<cost){UserTips.ins().showTips(this.lackTip)}else if(cost>0&&tianZhu>=cost){TimeCardMgr.ins().sendBuyGood(this.itemId,curCount)}else if(cost<=0){UserTips.ins().showTips(i18n("TimeCardBuyGoodWin_5"))}};TimeCardBuyGoodWin.prototype.onClose=function(){this.close()};TimeCardBuyGoodWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeTouchEvent(this.btnAdd,this.onTouch);this.removeTouchEvent(this.btnMax,this.onTouch);this.removeTouchEvent(this.btnBuy,this.onBuy);this.removeTouchEvent(this.btnDec,this.onTouch);this.inputCount.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onFocusOut,this);this.removeObserve();ViewManager.ins().close(this)};return TimeCardBuyGoodWin}(BaseEuiView);__reflect(TimeCardBuyGoodWin.prototype,"TimeCardBuyGoodWin");ViewManager.ins().reg(TimeCardBuyGoodWin,LayerManager.UI_Popup);var TimeCardCurrencyPanel=function(_super){__extends(TimeCardCurrencyPanel,_super);function TimeCardCurrencyPanel(){var _this=_super.call(this)||this;_this.skinName="TimeCardCurrencyPanelSkin";_this.observe(Actor.ins().postYbChange,_this.updateData);_this.observe(TimeCardMgr.ins().postInfo,_this.updateData);_this.observe(TimeCardMgr.ins().postGetReward,_this.updateData);_this.observe(TimeCardMgr.ins().postBuyResult,_this.updateData);_this.addTouchEvent(_this.btnTianZhu,_this.onTouch);_this.addTouchEvent(_this.imageYuanBao,_this.onTouch);return _this}TimeCardCurrencyPanel.prototype.updateData=function(){CommonUtils.labelIsOverLenght(this.labelTianZhu,TimeCardMgr.ins().tianZhu||0);CommonUtils.labelIsOverLenght(this.labelYuanBao,Actor.yb||0)};TimeCardCurrencyPanel.prototype.onTouch=function(e){if(!e||!e.currentTarget)return;switch(e.currentTarget){case this.btnTianZhu:break;case this.imageYuanBao:TicketSys.ins().openRechargeWin();break}};return TimeCardCurrencyPanel}(BaseView);__reflect(TimeCardCurrencyPanel.prototype,"TimeCardCurrencyPanel");var TimeCardRewardRenderer=function(_super){__extends(TimeCardRewardRenderer,_super);function TimeCardRewardRenderer(){var _this=_super.call(this)||this;_this.lockSkin="Btn42Skin";_this.unlockSkin="Btn3Skin";_this.skinName="TimeCardRewardItemSkin";return _this}TimeCardRewardRenderer.prototype.dataChanged=function(){var data=this.data;if(data==null)return;this.labelNormalYb.text="";this.labelSuperYb.text="";this.labelTianZhu.text="";this.labelTianZhu.text="";this.labelValue.text="";this.imageRedPoint.visible=false;this.btnGet.skinName=this.unlockSkin;this.btnGet.label=i18n("TimeCardRewardRenderer_0");this.btnGet.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGet,this);this.labelNormalYb.text=data.normalYb+"";this.labelSuperYb.text=data.masterYb+"";this.labelTianZhu.text=data.masterTianZhu+"";this.labelValue.text=data.value+"";var id=data.id;if(TimeCardMgr.ins().canGetRewardById(id)){this.imageRedPoint.visible=true}if(!TimeCardMgr.ins().hasRewardById(id)){this.imageRedPoint.visible=false;this.btnGet.skinName=this.lockSkin;this.btnGet.label=i18n("TimeCardRewardRenderer_1")}this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnGet,this)};TimeCardRewardRenderer.prototype.onBtnGet=function(){var data=this.data;if(data==null)return;var id=data.id;if(!TimeCardMgr.ins().canGetRewardById(id)){UserTips.ins().showTips(i18n("TimeCardRewardRender_0"));return}if(!TimeCardMgr.ins().hasRewardById(id)){UserTips.ins().showTips(i18n("TimeCardRewardRender_1"));return}TimeCardMgr.ins().sendGetReward(id)};return TimeCardRewardRenderer}(BaseItemRender);__reflect(TimeCardRewardRenderer.prototype,"TimeCardRewardRenderer");var TimeCardShopRenderer=function(_super){__extends(TimeCardShopRenderer,_super);function TimeCardShopRenderer(){var _this=_super.call(this)||this;_this.skinName="TimeCardShopItemSkin";var list=_this.listItem;list.itemRenderer=ItemBase;list.dataProvider=new ArrayCollection([]);return _this}TimeCardShopRenderer.prototype.dataChanged=function(){var data=this.data;if(data==null)return;this.lblLimitTime.text="";this.rewardsData=[];this.btnBuy.removeEventListener(egret.TouchEvent.TOUCH_END,this.onBtnBuy,this);var buyCount=TimeCardMgr.ins().goodsInfo[data.id];var leftBuyCount=data.dailyLimit-buyCount;leftBuyCount=Math.max(leftBuyCount,0);this.lblLimitTime.visible=data.dailyLimit>0;this.lblLimitTime.textFlow=TextFlowMaker.generateTextFlow(i18n("TimeCardShopRenderer_0")+ColorUtil.GREEN_COLOR_N+"&T:"+leftBuyCount+"|/"+data.dailyLimit+" )");this.btnBuy.label=data.price+"";this.btnBuy.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtnBuy,this);var rewardsData=[];for(var k in data.rewards){if(data.rewards[k]["id"]){rewardsData.push(data.rewards[k])}}var dataProvider=this.listItem.dataProvider;dataProvider.replaceAll(rewardsData);this.rewardsData=rewardsData};TimeCardShopRenderer.prototype.onBtnBuy=function(){var data=this.data;if(data==null)return;ViewManager.ins().open(TimeCardBuyGoodWin,this.rewardsData,data.id)};return TimeCardShopRenderer}(BaseItemRender);__reflect(TimeCardShopRenderer.prototype,"TimeCardShopRenderer");var TimeCardShopWarnWin=function(_super){__extends(TimeCardShopWarnWin,_super);function TimeCardShopWarnWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="TimeCardShopWarnSkin";var list=_this.listItem;list.itemRenderer=ItemBase;list.dataProvider=new ArrayCollection([]);return _this}TimeCardShopWarnWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.btnSure,this.onClose);var buyId=param[0];var count=param[1];var config=GlobalConfig.TimeCardShopConfig;var data=[];var rewards=config[buyId].rewards;for(var i in rewards){if(rewards[i].count){var id=rewards[i].id;var type=rewards[i].type;data.push({id:id,count:count,type:type})}}var dataProvider=this.listItem.dataProvider;dataProvider.replaceAll(data)};TimeCardShopWarnWin.prototype.onClose=function(){this.close()};TimeCardShopWarnWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeTouchEvent(this.btnSure,this.onClose);ViewManager.ins().close(this)};return TimeCardShopWarnWin}(BaseEuiView);__reflect(TimeCardShopWarnWin.prototype,"TimeCardShopWarnWin");ViewManager.ins().reg(TimeCardShopWarnWin,LayerManager.UI_Popup);var TimeCardShopWin=function(_super){__extends(TimeCardShopWin,_super);function TimeCardShopWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="TimeCardShopSkin";_this.observe(TimeCardMgr.ins().postBuyGood,_this.updateShow);return _this}TimeCardShopWin.prototype.open=function(){this.addTouchEvent(this.rectClose,this.onClose);this.addTouchEvent(this.btnClose,this.onClose);var list=this.itemList;list.dataProvider=new ArrayCollection([]);list.itemRenderer=TimeCardShopRenderer;this.updateShow()};TimeCardShopWin.prototype.updateShow=function(){var goodsData=[];var cfg=GlobalConfig.TimeCardShopConfig;if(cfg){for(var id in cfg){if(cfg[id]&&cfg[id].id){goodsData.push(cfg[id])}}}var dataProvider=this.itemList.dataProvider;dataProvider.replaceAll(goodsData)};TimeCardShopWin.prototype.onClose=function(){this.close()};TimeCardShopWin.prototype.close=function(){this.removeTouchEvent(this.rectClose,this.onClose);this.removeTouchEvent(this.btnClose,this.onClose);this.removeObserve();ViewManager.ins().close(this);_super.prototype.close.call(this)};return TimeCardShopWin}(BaseEuiView);__reflect(TimeCardShopWin.prototype,"TimeCardShopWin");ViewManager.ins().reg(TimeCardShopWin,LayerManager.UI_Main);var TimeCardWin=function(_super){__extends(TimeCardWin,_super);function TimeCardWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;_this.skinName="TimeCardSkin";return _this}TimeCardWin.prototype.initList=function(){var listReward=this.listReward;listReward.dataProvider=new ArrayCollection([]);listReward.itemRenderer=TimeCardRewardRenderer};TimeCardWin.prototype.open=function(){this.addTouchEvent(this.btnTianZhu,this.onTouch);this.addTouchEvent(this.btnShop,this.onTouch);this.addTouchEvent(this.btnMaster,this.onTouch);this.addTouchEvent(this.btnClose,this.onTouch);this.addTouchEvent(this.btnDetail,this.onTouch);this.observe(TimeCardMgr.ins().postInfo,this.updateShow);this.observe(TimeCardMgr.ins().postGetReward,this.updateShow);this.observe(TimeCardMgr.ins().postBuyResult,this.updateShow);this.initList();this.updateShow()};TimeCardWin.prototype.updateShow=function(){this.updateInfo();this.updateRewardList()};TimeCardWin.prototype.updateRewardList=function(){var config=GlobalConfig.TimeCardRewardConfig;var data=[];for(var i in config){if(config[i]&&config[i].id!=null){data.push(config[i])}}var dataProvider=this.listReward.dataProvider;dataProvider.replaceAll(data)};TimeCardWin.prototype.updateInfo=function(){this.labelCurProValue.text=""+TimeCardMgr.ins().curProValue;var lastDay=GlobalConfig.TimeCardBaseConfig.lastDay;this.endTime=Math.floor(TimeCardMgr.ins().startime+lastDay*DateUtils.SECOND_PER_DAY-GameServer.serverTime/1e3);this.labelLeftTime.text=""+DateUtils.getFormatBySecond(this.endTime,DateUtils.TIME_FORMAT_5,3);if(!TimerManager.ins().isExists(this.timeGo,this)){TimerManager.ins().doTimer(1e3,0,this.timeGo,this)}if(TimeCardMgr.ins().type>0){this.removeTouchEvent(this.btnMaster,this.onTouch)}};TimeCardWin.prototype.timeGo=function(){if(this.endTime>0){this.endTime--;this.labelLeftTime.text=""+DateUtils.getFormatBySecond(this.endTime,DateUtils.TIME_FORMAT_5,3)}else{TimerManager.ins().remove(this.timeGo,this);TimeCardMgr.ins().sendCheckTimeOut()}};TimeCardWin.prototype.onTouch=function(e){if(!e||!e.currentTarget)return;switch(e.currentTarget){case this.btnMaster:if(TimeCardMgr.ins().type>0){UserTips.ins().showTips(i18n("TimeCardWin_0"))}else{TimeCardMgr.ins().sendBuyMaster()}break;case this.btnTianZhu:break;case this.btnShop:ViewManager.ins().open(TimeCardShopWin);break;case this.btnClose:this.onClose();break;case this.btnDetail:break}};TimeCardWin.prototype.onClose=function(){this.close()};TimeCardWin.prototype.close=function(){this.removeTouchEvent(this.btnTianZhu,this.onTouch);this.removeTouchEvent(this.btnMaster,this.onTouch);this.removeTouchEvent(this.btnClose,this.onTouch);this.removeTouchEvent(this.btnDetail,this.onTouch);this.removeObserve();ViewManager.ins().close(this);_super.prototype.close.call(this)};return TimeCardWin}(BaseEuiView);__reflect(TimeCardWin.prototype,"TimeCardWin");ViewManager.ins().reg(TimeCardWin,LayerManager.UI_Main);var UserTips=function(_super){__extends(UserTips,_super);function UserTips(){return _super.call(this)||this}Object.defineProperty(UserTips.prototype,"view",{get:function(){if(!this._view||!this._view.parent){ViewManager.ins().open(TipsView);this._view=ViewManager.ins().getView(TipsView)}return this._view},enumerable:true,configurable:true});UserTips.prototype.showTips=function(str,func){if(str==i18n("UserTips_0")||str==i18n("UserTips_1")){if(ChannelMgr.ins().isRechargeHidden()){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showTips,str);return}var w=WarnWin.show(i18n("UserTips_2"),null,null,function(){Recharge.ins().tryShowChargeFirstWin();if(func&&typeof func=="function")func()});w.setBtnLabel(i18n("UserTips_3"),i18n("UserTips_4"));return}DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showTips,str)};UserTips.prototype.showTips2=function(str,func){if(str==i18n("UserTips_0")||str==i18n("UserTips_1")){if(ChannelMgr.ins().isRechargeHidden()){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showTips2,str);return}var w=WarnWin.show(i18n("UserTips_2"),null,null,function(){Recharge.ins().tryShowChargeFirstWin();if(func&&typeof func=="function")func()});w.setBtnLabel(i18n("UserTips_3"),i18n("UserTips_4"));return}DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showTips2,str)};UserTips.prototype.showRecycleTips3=function(param){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showRecycleTips3,param)};UserTips.prototype.showCenterTips=function(str){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips,str)};UserTips.prototype.showCenterTips2=function(str){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips2,str)};UserTips.prototype.showCenterTips3=function(str){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips3,str)};UserTips.prototype.showDownTips=function(str){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showDownTips,str)};UserTips.prototype.showSceneTips=function(str){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showSceneTips,str)};UserTips.prototype.showTaskTips=function(str){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showTaskTips,str)};UserTips.prototype.showAttrTips=function(type,value){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showAttrTips,[type,value])};UserTips.prototype.showGoodEquipTips=function(itemData){this.view.showGoodEquipTip(itemData)};UserTips.prototype.showSkillTips=function(skillID){this.view.showSkillTip(skillID)};UserTips.prototype.showItemTips=function(itemID){this.view.showItemTip(itemID)};UserTips.prototype.showHeartItemTips=function(itemID){this.view.showHeartItemTip(itemID)};UserTips.prototype.showBoxTips=function(id){this.view.showBoxTip(id)};UserTips.prototype.showBoostPower=function(currentValue,lastValue){ViewManager.ins().open(BoostPowerView).showBoostPower(currentValue,lastValue)};UserTips.prototype.showFuncNotice=function(lv){ViewManager.ins().open(FuncNoticeWin).showWin(lv)};UserTips.prototype.showRewardBox=function(type){this.view.showRewardBox(type)};UserTips.prototype.showEverTips=function(str){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showEverTips,str)};UserTips.prototype.showHintTips=function(pic){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showHintTips,pic)};UserTips.prototype.showGoodRewardTips=function(itemData){this.view.showGoodRewardTip(itemData)};return UserTips}(BaseClass);__reflect(UserTips.prototype,"UserTips");var AttriteChangeView=function(_super){__extends(AttriteChangeView,_super);function AttriteChangeView(){var _this=_super.call(this)||this;_this.touchEnabled=_this.touchChildren=false;_this.initView();return _this}AttriteChangeView.prototype.initView=function(){this._sp=new egret.Sprite;this.addChild(this._sp);this._bgImg=new eui.Image;this._sp.addChild(this._bgImg)};AttriteChangeView.prototype.setLabelText=function(type,value){var _this=this;this._sp.x=0;this._sp.alpha=1;this._bgImg.source="attr"+type;var powerImg=BitmapNumber.ins().createNumPic(value,"attr",5);powerImg.x=90;powerImg.y=4;this._sp.addChild(powerImg);var t1=egret.Tween.get(this._sp);t1.wait(1e3).to({alpha:0,x:-300},500).call(function(){BitmapNumber.ins().desstroyNumPic(powerImg);powerImg.x=0;powerImg.y=0;DisplayUtils.removeFromParent(_this)},this)};return AttriteChangeView}(BaseView);__reflect(AttriteChangeView.prototype,"AttriteChangeView");var BoostPowerView=function(_super){__extends(BoostPowerView,_super);function BoostPowerView(){var _this=_super.call(this)||this;_this.defaultValue=0;_this.boostIdx=0;_this.touchEnabled=_this.touchChildren=false;return _this}BoostPowerView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.horizontalCenter=100;this.bottom=-100;this.mcGroup=new eui.Group;this.mcGroup.x=50;this.mcGroup.y=438;this.mcGroup.alpha=1;this.mcGroup.touchEnabled=false;this.mcGroupTop=new eui.Group;this.mcGroupTop.x=50;this.mcGroupTop.y=438;this.mcGroupTop.alpha=1;this.mcGroupTop.touchEnabled=false;this.mcLoopUp=new MovieClip;this.mcLoopUp.x=130;this.mcLoopUp.y=35;this.mcLoopUp.playFile(RES_DIR_EFF+"zdlloop_eff",-1);this.mcGroup.addChild(this.mcLoopUp);this.mcLoopDown=new MovieClip;this.mcLoopDown.x=130;this.mcLoopDown.y=35;this.mcLoopDown.playFile(RES_DIR_EFF+"zdlloopdown_eff",-1);this.mcGroup.addChild(this.mcLoopDown);this.mcLoopDown.visible=false;this.sp=new egret.Sprite;this.sp.x=180;this.sp.y=474;this.lastTime=0;this.lastPower=0;this.addChild(this.mcGroup);this.addChild(this.sp);this.addChild(this.mcGroupTop);this.clearShow()};BoostPowerView.prototype.showMcOnce=function(){this.mcGroupTop.removeChildren();this.mcOnce=new MovieClip;this.mcOnce.x=130;this.mcOnce.y=35;this.mcGroupTop.addChild(this.mcOnce);this.mcOnce.playFile(RES_DIR_EFF+"zdlonce_eff",1)};BoostPowerView.prototype.showBoostPower=function(currentValue,lastValue){this.defaultValue=lastValue;if(this.lastPower==0){this.lastPower=lastValue}TimerManager.ins().doTimer(500,1,this.delayPowerUp,this)};BoostPowerView.prototype.clearShow=function(){this.sp.removeChildren();egret.Tween.removeTweens(this.mcGroup);egret.Tween.removeTweens(this.mcGroupTop);this.mcGroup.visible=false;this.mcGroupTop.visible=false;TimerManager.ins().removeAll(this);egret.clearTimeout(this.ii);this.ii=0};BoostPowerView.prototype.delayPowerUp=function(){var lastPower=this.lastPower?this.lastPower:this.defaultValue;var currentPower=Actor.power;this.showPowerUp(lastPower,currentPower)};BoostPowerView.prototype.showPowerUp=function(lasterPower,nowPower){var _this=this;var numBoostPower=nowPower-lasterPower;if(numBoostPower==0){return}this.clearShow();this.mcGroup.visible=true;this.mcGroup.alpha=1;this.mcGroupTop.visible=true;this.mcGroupTop.alpha=1;this.showMcOnce();var currentPower=BitmapNumber.ins().createNumPic(lasterPower,"8",5);currentPower.y=-7;this.sp.addChild(currentPower);this.mcLoopUp.visible=numBoostPower>0;this.mcLoopDown.visible=numBoostPower<0;var times=25;this.boostIdx=0;TimerManager.ins().doTimer(20,times,function(){var num=Math.floor(lasterPower+numBoostPower/times*_this.boostIdx);BitmapNumber.ins().changeNum(currentPower,num,"8",5);_this.boostIdx+=1},this,function(){BitmapNumber.ins().changeNum(currentPower,Actor.power,"8",5);var numStr="+"+numBoostPower;var boostPower=BitmapNumber.ins().createNumPic(numStr,"r0",5);BitmapNumber.ins().changeNum(boostPower,numStr,"r0",5);if(numBoostPower<0){numStr="-"+Math.abs(numBoostPower);boostPower=BitmapNumber.ins().createNumPic(numStr,"rj0",5);BitmapNumber.ins().changeNum(boostPower,numStr,"rj0",5)}boostPower.x=currentPower.x+currentPower.width+10;boostPower.y=currentPower.y+20;_this.sp.addChild(boostPower);var moveTime=200;var hideTime=2e3;_this.lastPower=0;var t=egret.Tween.get(boostPower);t.to({y:boostPower.y-30},moveTime).to({alpha:0},hideTime).call(function(){DisplayUtils.removeFromParent(boostPower)},_this);var tt=egret.Tween.get(currentPower);tt.wait(moveTime).to({alpha:0},hideTime).call(function(){DisplayUtils.removeFromParent(currentPower)},_this);var ttt=egret.Tween.get(_this.mcGroup);ttt.wait(moveTime).to({alpha:0},hideTime).call(function(){_this.mcGroup.visible=false},_this);var tttt=egret.Tween.get(_this.mcGroupTop);tttt.wait(moveTime).to({alpha:0},hideTime).call(function(){_this.mcGroupTop.visible=false},_this)},this)};return BoostPowerView}(BaseEuiView);__reflect(BoostPowerView.prototype,"BoostPowerView");ViewManager.ins().reg(BoostPowerView,LayerManager.UI_Tips);var CenterTipsItem=function(_super){__extends(CenterTipsItem,_super);function CenterTipsItem(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(CenterTipsItem.prototype,"labelText",{set:function(value){this.setSkinName();this._labelText=value;this.lab.textColor=16777215;this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText);this.bg.width=this.lab.width+150;this.bg.source="zjmgonggaobg";this.bg.visible=true;this.lab.alpha=1;this.bg.y=0;this.lab.horizontalCenter=0;this.lab.verticalCenter=0;if(!this.addToEvent){this.addToEvent=true;TimerManager.ins().doTimer(5e3,1,this.removeFromParent,this)}},enumerable:true,configurable:true});Object.defineProperty(CenterTipsItem.prototype,"labelText2",{set:function(value){this.setSkinName();this._labelText=value;this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText);this.bg.width=this.lab.width+150;this.bg.source="zjmgonggaobg";this.bg.visible=true;this.lab.alpha=1;this.bg.y=0;this.lab.horizontalCenter=0;this.lab.verticalCenter=0;if(!this.addToEvent){this.addToEvent=true;TimerManager.ins().doTimer(1e3,1,this.removeFromParent,this)}},enumerable:true,configurable:true});Object.defineProperty(CenterTipsItem.prototype,"labelText3",{set:function(value){this.setSkinName();this._labelText=value;this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText);this.bg.width=this.lab.width+150;this.bg.source="zjmgonggaobg";this.bg.visible=true;this.lab.alpha=1;this.bg.y=0;this.lab.horizontalCenter=0;this.lab.verticalCenter=0;if(!this.addToEvent){this.addToEvent=true;TimerManager.ins().doTimer(3e3,1,this.removeFromParent,this)}},enumerable:true,configurable:true});Object.defineProperty(CenterTipsItem.prototype,"recycle",{set:function(param){var flag=param[4];if(flag=="activity"){this.setSkinName("TipsRecycleSkinActivity");this.ybNum.text=(param[1]||0).toString()}else if(flag=="privilege"){this.setSkinName("TipsRecycleSkinPrivilege");this.ybNum.text=(param[1]||0).toString()}else{this.setSkinName("TipsRecycleSkin");this.equipNum.text=(param[0]||0).toString();this.ybNum.text=(param[1]||0).toString()}this.bg.source="tongyongtip02";this.bg.scale9Grid=new egret.Rectangle(24,2,32,49);this.bg.width=233+(this.equipNum!=null?this.equipNum.width:0)+this.ybNum.width;this.bg.visible=true;this.content.alpha=1;this.bg.y=0;this.content.horizontalCenter=0;this.content.verticalCenter=0;var stage=StageUtils.ins().getStage();MainAniMgr.ins().playExplode(RES_DIR_EFF+"yuanbaofly_eff",60,stage.stageWidth/2,stage.stageHeight/2);if(!this.addToEvent){this.addToEvent=true;TimerManager.ins().doTimer(3e3,1,this.removeFromParent,this)}},enumerable:true,configurable:true});return CenterTipsItem}(TipsItem);__reflect(CenterTipsItem.prototype,"CenterTipsItem");var ChatTipsView=function(_super){__extends(ChatTipsView,_super);function ChatTipsView(){var _this=_super.call(this)||this;_this.showOver=false;_this.skinName="ChatMessage";return _this}ChatTipsView.prototype.setData=function(msg){this.lab.textFlow=TextFlowMaker.generateTextFlow(msg.str);this.setshowTime()};ChatTipsView.prototype.setshowTime=function(){if(!this.showOver){TimerManager.ins().remove(this.showOverInfo,this)}TimerManager.ins().doTimer(5e3,1,this.showOverInfo,this)};ChatTipsView.prototype.showOverInfo=function(){this.showOver=true;DisplayUtils.removeFromParent(this)};return ChatTipsView}(eui.Component);__reflect(ChatTipsView.prototype,"ChatTipsView");var EverTipsItem=function(_super){__extends(EverTipsItem,_super);function EverTipsItem(){var _this=_super.call(this)||this;_this.index=0;_this.skinName="TipsSkin";_this.bg.source="zjmqipao";_this.currentState="normal";return _this}EverTipsItem.prototype.setIndex=function(value){this.index=value};Object.defineProperty(EverTipsItem.prototype,"labelText",{get:function(){return this._labelText},set:function(value){var _this=this;this.bg.alpha=1;this._labelText=value;this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText);this.bg.width=this.lab.width+80;this.lab.alpha=1;this.bg.y=0;this.lab.verticalCenter=-1;var t1=egret.Tween.get(this.bg);t1.to({y:0},500).wait(500).to({alpha:0},200).call(function(){DisplayUtils.removeFromParent(_this)},this)},enumerable:true,configurable:true});return EverTipsItem}(BaseView);__reflect(EverTipsItem.prototype,"EverTipsItem");var FuncNoticeWin=function(_super){__extends(FuncNoticeWin,_super);function FuncNoticeWin(){return _super.call(this)||this}FuncNoticeWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="FuncNoticeSkin"};FuncNoticeWin.prototype.showWin=function(lv){this.curConfig=FuncNoticeWin.getFuncNoticeConfigById(lv);var openLv=this.curConfig.openLv;lv==openLv?this.sureBtn.icon="yg_002":this.sureBtn.icon="yg_001";this.bodyImg.source="yg_"+this.curConfig.index+"_png";this.txt.textFlow=TextFlowMaker.generateTextFlow(i18n("FuncNoticeWin_1")+openLv+i18n("FuncNoticeWin_0"));this.addTouchEvent(this.sureBtn,this.onTouch)};FuncNoticeWin.prototype.onTouch=function(e){var btn=e.target;if(btn.icon=="yg_002"){var winName=this.curConfig.openPanel[0].toString();var page=this.curConfig.openPanel[1];GameGuider.guidance(winName,page)}this.removeTouchEvent(this.sureBtn,this.onTouch);ViewManager.ins().close(this)};FuncNoticeWin.getFuncNoticeConfigById=function(id){var config=GlobalConfig.FuncNoticeConfig;for(var i in config){if(config[i].openLv>=id){return config[i]}}return null};return FuncNoticeWin}(BaseEuiView);__reflect(FuncNoticeWin.prototype,"FuncNoticeWin");ViewManager.ins().reg(FuncNoticeWin,LayerManager.UI_Tips);var HintTipsItem=function(_super){__extends(HintTipsItem,_super);function HintTipsItem(){var _this=_super.call(this)||this;_this.skinName="TipsSkin";_this.lab.visible=false;_this.bg.visible=false;_this.currentState="normal";return _this}HintTipsItem.prototype.setTips=function(res){var _this=this;this.pic.source=res+"_png";this.pic.alpha=0;this.pic.y=0;var t1=egret.Tween.get(this.pic);t1.to({alpha:1},500).wait(3e3).to({alpha:0},200).call(function(){DisplayUtils.removeFromParent(_this)},this)};return HintTipsItem}(BaseView);__reflect(HintTipsItem.prototype,"HintTipsItem");var SceneTipsItem=function(_super){__extends(SceneTipsItem,_super);function SceneTipsItem(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(SceneTipsItem.prototype,"labelText",{set:function(value){var _this=this;this.setSkinName();this._labelText=value;this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText);this.bg.width=this.lab.width;this.bg.visible=false;this.lab.alpha=1;this.bg.y=0;this.lab.verticalCenter=-1;TimerManager.ins().doTimer(500,1,function(){DisplayUtils.removeFromParent(_this)},this)},enumerable:true,configurable:true});return SceneTipsItem}(TipsItem);__reflect(SceneTipsItem.prototype,"SceneTipsItem");var TipsEquipAlertPanel=function(_super){__extends(TipsEquipAlertPanel,_super);function TipsEquipAlertPanel(){var _this=_super.call(this)||this;_this.skinName="OrangeEquipNoticeSkin2";_this.isUsing=false;_this.horizontalCenter=0;return _this}Object.defineProperty(TipsEquipAlertPanel.prototype,"data",{set:function(itemid){var itemConfig=GlobalConfig.ItemConfig[itemid];this.item.setItemImg(itemConfig.icon+"_png");this.item.isShowJob(false);this.item.setImgBg(ItemConfig.getQuality(itemConfig));this.desc.text=itemConfig.name;this.skillName.visible=false;this.item.isShowName(false);this.item.showNum(false);if(itemid>=180001&&itemid<=180278){this.item.visible=false;this.LabelGroup.x=60}else{this.item.visible=true;this.LabelGroup.x=110}},enumerable:true,configurable:true});return TipsEquipAlertPanel}(BaseView);__reflect(TipsEquipAlertPanel.prototype,"TipsEquipAlertPanel");var TipsGoodEquip=function(_super){__extends(TipsGoodEquip,_super);function TipsGoodEquip(){var _this=_super.call(this)||this;_this.skinName="OrangeEquipNoticeSkin";_this.isUsing=false;_this.horizontalCenter=0;return _this}Object.defineProperty(TipsGoodEquip.prototype,"data",{set:function(item){this.item.isShowName(false);if(item instanceof ItemData){var q=ItemConfig.getQuality(item.itemConfig);this.item.showNum(true);this.item.data=item;if(q==4){this.desc.text=i18n("TipsGoodEquip_0");this.itemName.visible=true}else if(q==5){this.desc.text=i18n("TipsGoodEquip_1");this.itemName.visible=true}if(ItemConfig.getType(item.itemConfig)==7){this.desc.text=i18n("TipsGoodEquip_2")}this.itemName.text=item.itemConfig.name;this.itemName.textColor=ItemBase.QUALITY_COLOR[q];this.itemName.strokeColor=ItemBase.QUALITY_STROKE_COLOR[q]}else{this.desc.text=i18n("TipsGoodEquip_3");var data=item;this.item.setItemImg(data.imgClose);this.itemName.text=data.name;this.itemName.textColor=ItemBase.QUALITY_COLOR[data.quality];this.itemName.strokeColor=ItemBase.QUALITY_STROKE_COLOR[data.quality];this.item.showNum(false)}},enumerable:true,configurable:true});return TipsGoodEquip}(BaseView);__reflect(TipsGoodEquip.prototype,"TipsGoodEquip");var TipsGoodReward=function(_super){__extends(TipsGoodReward,_super);function TipsGoodReward(){var _this=_super.call(this)||this;_this.skinName="OrangeEquipNoticeSkin2";_this.isUsing=false;_this.horizontalCenter=0;return _this}Object.defineProperty(TipsGoodReward.prototype,"data",{set:function(item){if(item instanceof RewardData){switch(item.id){case MoneyConst.yuanbao:this.desc.text=i18n("TipsGoodReward_0");this.skillName.text=""+item.count;this.item.setItemImg(RewardData.CURRENCY_RES[item.id]);this.item.isShowName(false);this.item.showNum(false);this.item.isShowJob(false);break}}},enumerable:true,configurable:true});return TipsGoodReward}(BaseView);__reflect(TipsGoodReward.prototype,"TipsGoodReward");var TipsHeartEquipAlertPanel=function(_super){__extends(TipsHeartEquipAlertPanel,_super);function TipsHeartEquipAlertPanel(){var _this=_super.call(this)||this;_this.skinName="guardGodWeaponNoticeTip";_this.isUsing=false;_this.horizontalCenter=0;return _this}Object.defineProperty(TipsHeartEquipAlertPanel.prototype,"data",{set:function(itemid){var itemConfig=GlobalConfig.ItemConfig[itemid];this.item.setItemImg(itemConfig.icon+"_png");this.item.isShowJob(false);this.item.setImgBg(ItemConfig.getQuality(itemConfig));var color=ItemConfig.getQualityColor(itemConfig);this.desc.textFlow=TextFlowMaker.generateTextFlow1("C:"+color+"&T:"+itemConfig.name);this.desc.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.itemName.visible=false;this.item.isShowName(false);this.item.showNum(false)},enumerable:true,configurable:true});return TipsHeartEquipAlertPanel}(BaseView);__reflect(TipsHeartEquipAlertPanel.prototype,"TipsHeartEquipAlertPanel");var AudioContextPlayer=function(){function AudioContextPlayer(){this.bufs={};this.preloaded={};this.lastPlayId=0;this.playStates={};var _AudioContext=window["AudioContext"]||window["webkitAudioContext"]||window["mozAudioContext"];if(_AudioContext){try{this.audioCtx=new(window["AudioContext"]||window["webkitAudioContext"]||window["mozAudioContext"])}catch(e){}}TimerManager.ins().doTimer(1*60*1e3,0,this.deletePlayStates,this)}AudioContextPlayer.ins=function(){if(this._singleton==null){this._singleton=new AudioContextPlayer}return this._singleton};AudioContextPlayer.prototype.deletePlayStates=function(){var now=egret.getTimer();var playStates=this.playStates;var toDelete=[];for(var k in playStates){var ps=playStates[k];if(ps.times!=0&&now-ps.playTime>SoundManager.CLEAR_TIME){toDelete.push(k)}}for(var _i=0,toDelete_2=toDelete;_i<toDelete_2.length;_i++){var delKey=toDelete_2[_i];delete playStates[delKey]}};AudioContextPlayer.prototype.getBuffer=function(link){var _this=this;var self=this;return new Promise(function(resolve,reject){if(_this.audioCtx){var request_2=new XMLHttpRequest;request_2.open("GET",link,true);request_2.responseType="arraybuffer";request_2.onload=function(){self.audioCtx.decodeAudioData(request_2.response,function(buffer){resolve(buffer)},function(e){console.log("reject");reject(e)})};request_2.send()}else{reject("not support AudioContext")}})};AudioContextPlayer.prototype.createSound=function(buffer){var self=this;if(self.audioCtx.state!="running"){console.log(i18n("AudioContextPlayer_0"));self.audioCtx.resume()}var analyser=self.audioCtx.createAnalyser();var gainNode=self.audioCtx.createGain();var source=self.audioCtx.createBufferSource();source.buffer=buffer;source.connect(analyser);analyser.connect(gainNode);gainNode.connect(self.audioCtx.destination);return source};AudioContextPlayer.prototype.preload=function(src,cb){if(this.preloaded[src]){return}this.preloaded[src]=true;var self=this;this.getBuffer(src).then(function(buf){if(self.bufs[src]==null){self.bufs[src]={buf:buf,src:src};if(cb){cb()}}}).catch(function(e){console.log(e)})};AudioContextPlayer.prototype.play=function(src,times){if(times===void 0){times=1}var self=this;var sound;var item=self.bufs[src];var curPlayId=self.lastPlayId+1;self.lastPlayId=curPlayId;if(item){sound=self.createSound(item.buf);sound.start(0);sound.loop=times==0;self.playStates[curPlayId]={channel:sound,stopped:false,times:times,playTime:egret.getTimer()}}else{if(!self.preloaded[src]){self.preload(src,function(){if(self.playStates[curPlayId]&&!self.playStates[curPlayId].stopped){item=self.bufs[src];sound=self.createSound(item.buf);sound.start(0);sound.loop=times==0;self.playStates[curPlayId]={channel:sound,stopped:false,times:times,playTime:egret.getTimer()}}});self.playStates[curPlayId]={channel:null,stopped:false,times:times,playTime:egret.getTimer()}}}return curPlayId};return AudioContextPlayer}();__reflect(AudioContextPlayer.prototype,"AudioContextPlayer");var TipsSkillAlertPanel=function(_super){__extends(TipsSkillAlertPanel,_super);function TipsSkillAlertPanel(){var _this=_super.call(this)||this;_this.skinName="OrangeEquipNoticeSkin2";_this.isUsing=false;_this.horizontalCenter=0;return _this}Object.defineProperty(TipsSkillAlertPanel.prototype,"data",{set:function(skillid){var skillConfig=new SkillData(skillid);this.item.setItemImg(skillConfig.icon);this.skillName.text=skillConfig.name;this.skillName.textColor=ItemBase.QUALITY_COLOR[4];this.skillName.strokeColor=ItemBase.QUALITY_STROKE_COLOR[4];this.item.isShowName(false);this.item.showNum(false)},enumerable:true,configurable:true});return TipsSkillAlertPanel}(BaseView);__reflect(TipsSkillAlertPanel.prototype,"TipsSkillAlertPanel");var TipsView=function(_super){__extends(TipsView,_super);function TipsView(){var _this=_super.call(this)||this;_this.labCount=0;_this.warnList=[];_this.list=[];_this.listCenter=[];_this.centerList=[];_this.taskTipsList=[];_this.sceneList=[];_this.attrList=[];_this.everList=[];_this.hintList=[];_this.picList=[];_this.rewardTipList=[];_this.goodEquipList=[];_this.skillTipList=[];_this.equipItemList=[];_this.equipHeartItemList=[];return _this}TipsView.prototype.initUI=function(){_super.prototype.initUI.call(this);this.touchChildren=false;this.touchEnabled=false;this.rewardTip=new TipsGoodReward;this.equipTip1=new TipsGoodEquip;this.skillTip1=new TipsSkillAlertPanel;this.equipTip=new TipsEquipAlertPanel;this.boxTip=new BoxGetHintTips;this.equipHeartTip=new TipsHeartEquipAlertPanel;this.observe(Actor.ins().postExp,this.showExp)};TipsView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};TipsView.prototype.showExp=function(exp){if(!exp)return;this.showTips2(i18n("TipsView_0",exp))};TipsView.prototype.showHintTips=function(pic){var tips=ObjectPool.pop("HintTipsItem");tips.verticalCenter=200;tips.horizontalCenter=0;tips.setTips(pic);if(this.picList.indexOf(pic)==-1){this.picList.unshift(pic);this.addChild(tips);this.hintList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHintTip,this);for(var i=this.hintList.length-1;i>=0;i--){egret.Tween.removeTweens(this.hintList[i]);var t=egret.Tween.get(this.hintList[i]);t.to({verticalCenter:200+i*-30},300)}}else{}};TipsView.prototype.removeHintTip=function(e){var index=this.hintList.indexOf(e.currentTarget);this.hintList.splice(index,1);egret.Tween.removeTweens(e.currentTarget);e.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHintTip,this);ObjectPool.push(e.currentTarget)};TipsView.prototype.showEverTips=function(para){var tips=ObjectPool.pop("EverTipsItem");tips.x=para.x;tips.y=para.y;tips.labelText=para.str;this.addChild(tips);this.everList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeEverTip,this);for(var i=this.everList.length-1;i>=0;i--){egret.Tween.removeTweens(this.everList[i]);var t=egret.Tween.get(this.everList[i]);t.to({y:tips.y-i*30},300)}};TipsView.prototype.removeEverTip=function(e){var index=this.everList.indexOf(e.currentTarget);this.everList.splice(index,1);egret.Tween.removeTweens(e.currentTarget);e.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeEverTip,this);ObjectPool.push(e.currentTarget)};TipsView.prototype.showAttrTips=function(para){var tips=ObjectPool.pop("AttriteChangeView");tips.left=30;tips.bottom=190;tips.setLabelText(para[0],para[1]);this.addChild(tips);this.attrList.unshift(tips);tips.once(egret.Event.REMOVED_FROM_STAGE,this.removeAttrTip,this);for(var i=this.attrList.length-1;i>=0;i--){egret.Tween.removeTweens(this.attrList[i]);var t=egret.Tween.get(this.attrList[i]);t.to({bottom:190+i*40},300)}};TipsView.prototype.removeAttrTip=function(e){var index=this.attrList.indexOf(e.currentTarget);this.attrList.splice(index,1);egret.Tween.removeTweens(e.currentTarget);ObjectPool.push(e.currentTarget)};TipsView.prototype.showCenterTips=function(str){var tips=ObjectPool.pop("CenterTipsItem");tips.verticalCenter=0;tips.horizontalCenter=0;tips.labelText=str;this.addChild(tips);this.centerList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var t=egret.Tween.get(this.centerList[i]);t.to({verticalCenter:0+i*-30},500)}};TipsView.prototype.removeCenterTip=function(e){var tips=e.currentTarget;var index=this.centerList.indexOf(tips);this.centerList.splice(index,1);tips.horizontalCenter=NaN;tips.verticalCenter=NaN;egret.Tween.removeTweens(tips);tips.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this);ObjectPool.push(tips)};TipsView.prototype.showCenterTips2=function(str){var tips=ObjectPool.pop("CenterTipsItem");tips.horizontalCenter=0;tips.verticalCenter=-60;this.addChild(tips);tips.labelText2=str;this.centerList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip2,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var t=egret.Tween.get(this.centerList[i]);t.to({verticalCenter:-120-i*30},300)}};TipsView.prototype.removeCenterTip2=function(e){var tips=e.currentTarget;tips.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip2,this);tips.horizontalCenter=NaN;tips.verticalCenter=NaN;var index=this.centerList.indexOf(tips);this.centerList.splice(index,1)};TipsView.prototype.showCenterTips3=function(str){var tips=ObjectPool.pop("CenterTipsItem");tips.verticalCenter=0;tips.horizontalCenter=0;tips.labelText3=str;this.addChild(tips);this.centerList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip3,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var t=egret.Tween.get(this.centerList[i]);t.to({verticalCenter:0+i*-30},500)}};TipsView.prototype.showDownTips=function(str){var tips=ObjectPool.pop("CenterTipsItem");tips.verticalCenter=230;tips.horizontalCenter=0;tips.labelText=str;this.addChild(tips);this.centerList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var t=egret.Tween.get(this.centerList[i]);t.to({verticalCenter:230+i*0},500)}};TipsView.prototype.removeCenterTip3=function(e){var tips=e.currentTarget;var index=this.centerList.indexOf(tips);this.centerList.splice(index,1);tips.horizontalCenter=NaN;tips.verticalCenter=NaN;egret.Tween.removeTweens(tips);tips.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip3,this);ObjectPool.push(tips)};TipsView.prototype.showRecycleTips3=function(param){var tips=ObjectPool.pop("CenterTipsItem");tips.verticalCenter=0;tips.horizontalCenter=0;tips.recycle=param;this.addChild(tips);this.centerList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeRecycleTips3,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var t=egret.Tween.get(this.centerList[i]);t.to({verticalCenter:0+i*-30},500)}};TipsView.prototype.removeRecycleTips3=function(e){var tips=e.currentTarget;var index=this.centerList.indexOf(tips);this.centerList.splice(index,1);tips.horizontalCenter=NaN;tips.verticalCenter=NaN;egret.Tween.removeTweens(tips);tips.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this);ObjectPool.push(tips)};TipsView.prototype.showSceneTips=function(str){var tips=ObjectPool.pop("SceneTipsItem");tips.verticalCenter=-175;tips.horizontalCenter=0;tips.labelText=str;this.addChild(tips);this.sceneList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeSceneTip,this);for(var i=this.sceneList.length-1;i>=0;i--){egret.Tween.removeTweens(this.sceneList[i]);var t=egret.Tween.get(this.sceneList[i]);t.to({verticalCenter:-175+i*-30},500)}};TipsView.prototype.removeSceneTip=function(e){var index=this.sceneList.indexOf(e.currentTarget);this.sceneList.splice(index,1);egret.Tween.removeTweens(e.currentTarget);e.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeSceneTip,this);ObjectPool.push(e.currentTarget)};TipsView.prototype.showTaskTips=function(str){var tips=ObjectPool.pop("CenterTipsItem");tips.currentState="normal";tips.bottom=232;tips.horizontalCenter=0;tips.labelText=str;this.addChild(tips);this.taskTipsList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTaskTip,this);for(var i=this.taskTipsList.length-1;i>=0;i--){egret.Tween.removeTweens(this.taskTipsList[i]);var t=egret.Tween.get(this.taskTipsList[i]);t.to({bottom:232+i*30},500)}};TipsView.prototype.removeTaskTip=function(e){var index=this.taskTipsList.indexOf(e.currentTarget);this.taskTipsList.splice(index,1);egret.Tween.removeTweens(e.currentTarget);e.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTaskTip,this);ObjectPool.push(e.currentTarget)};TipsView.prototype.showTips2=function(str){var tips=ObjectPool.pop("TipsItem");tips.setSkinName("TipsSkin");tips.left=0;tips.bottom=190;this.addChild(tips);tips.lab.textColor=ColorUtil.RED_COLOR_N;tips.labelText=str;tips.lab.stroke=1;tips.lab.strokeColor=0;this.list.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipsItem,this);for(var i=this.list.length-1;i>=0;i--){egret.Tween.removeTweens(this.list[i]);var t=egret.Tween.get(this.list[i]);t.to({bottom:190+i*30},300)}};TipsView.prototype.showTips=function(str){var tips=ObjectPool.pop("TipsWarnItem");tips.horizontalCenter=0;tips.verticalCenter=-120;this.addChild(tips);tips.setLabel(str);this.warnList.unshift(tips);tips.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipWarnItem,this);for(var i=this.warnList.length-1;i>=0;i--){egret.Tween.removeTweens(this.warnList[i]);var t=egret.Tween.get(this.warnList[i]);t.to({verticalCenter:-120+i*52},300)}};TipsView.prototype.removeTipsItem=function(e){var tips=e.currentTarget;tips.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipsItem,this);tips.left=NaN;tips.bottom=NaN;var index=this.list.indexOf(tips);this.list.splice(index,1);ObjectPool.push(tips)};TipsView.prototype.removeTipWarnItem=function(e){var tips=e.currentTarget;tips.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipWarnItem,this);tips.left=NaN;tips.bottom=NaN;var index=this.warnList.indexOf(tips);this.warnList.splice(index,1);ObjectPool.push(tips)};TipsView.prototype.showGoodRewardTip=function(item){this.rewardTipList.push(item);if(TimerManager.ins().isExists(this.goodRewardTimer,this)){}else{TimerManager.ins().doTimer(16,0,this.goodRewardTimer,this)}};TipsView.prototype.showGoodEquipTip=function(item){this.goodEquipList.push(item);if(TimerManager.ins().isExists(this.goodEquipTimer,this)){}else{TimerManager.ins().doTimer(16,0,this.goodEquipTimer,this)}};TipsView.prototype.showBoxTip=function(id){var conf=GlobalConfig.TreasureBoxConfig[id];this.goodEquipList.push(conf);if(TimerManager.ins().isExists(this.goodEquipTimer,this)){}else{TimerManager.ins().doTimer(16,0,this.goodEquipTimer,this)}};TipsView.prototype.goodRewardTimer=function(){var _this=this;if(this.rewardTipList.length==0){TimerManager.ins().remove(this.goodEquipTimer,this);return}if(this.isWait){return}var equipTip;if(!this.rewardTip.isUsing){equipTip=this.rewardTip}if(!equipTip){return}equipTip.x=50;equipTip.y=750;equipTip.alpha=1;if(!equipTip.parent)this.addChild(equipTip);equipTip.isUsing=true;this.isWait=true;equipTip.data=this.rewardTipList.pop();var t=egret.Tween.get(equipTip);t.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){equipTip.isUsing=false;_this.isWait=false;_this.removeChild(equipTip)})};TipsView.prototype.goodEquipTimer=function(){var _this=this;if(this.goodEquipList.length==0){TimerManager.ins().remove(this.goodEquipTimer,this);return}if(this.isWait){return}var equipTip;if(!this.equipTip1.isUsing){equipTip=this.equipTip1}if(!equipTip){return}equipTip.x=50;equipTip.y=750;equipTip.alpha=1;if(!equipTip.parent)this.addChild(equipTip);equipTip.isUsing=true;this.isWait=true;equipTip.data=this.goodEquipList.pop();var t=egret.Tween.get(equipTip);t.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){equipTip.isUsing=false;_this.isWait=false;_this.removeChild(equipTip)})};TipsView.prototype.showRewardBox=function(type){var conf=GlobalConfig.TreasureBoxConfig[type];this.goodEquipList.push(conf);if(TimerManager.ins().isExists(this.goodEquipTimer,this)){}else{TimerManager.ins().doTimer(16,0,this.goodEquipTimer,this)}};TipsView.prototype.showSkillTip=function(item){this.skillTipList.push(item);if(TimerManager.ins().isExists(this.skillTipTimer,this)){}else{TimerManager.ins().doTimer(16,0,this.skillTipTimer,this)}};TipsView.prototype.skillTipTimer=function(){var _this=this;if(this.skillTipList.length==0){TimerManager.ins().remove(this.skillTipTimer,this);return}if(this.isWait){return}var skillTip;if(!this.skillTip1.isUsing){skillTip=this.skillTip1}if(!skillTip){return}skillTip.x=50;skillTip.y=750;skillTip.alpha=1;this.addChild(skillTip);skillTip.isUsing=true;this.isWait=true;skillTip.data=this.skillTipList.pop();var t=egret.Tween.get(skillTip);t.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){skillTip.isUsing=false;_this.isWait=false;_this.removeChild(skillTip)})};TipsView.prototype.showItemTip=function(item){this.equipItemList.push(item);if(TimerManager.ins().isExists(this.itemTipTimer,this)){}else{TimerManager.ins().doTimer(16,0,this.itemTipTimer,this)}};TipsView.prototype.itemTipTimer=function(){var _this=this;if(this.equipItemList.length==0){TimerManager.ins().remove(this.itemTipTimer,this);return}if(this.isWait){return}var itemTip;if(!this.equipTip.isUsing){itemTip=this.equipTip}if(!itemTip){return}itemTip.x=50;itemTip.y=750;itemTip.alpha=1;this.addChild(itemTip);itemTip.isUsing=true;this.isWait=true;itemTip.data=this.equipItemList.pop();var t=egret.Tween.get(itemTip);t.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){itemTip.isUsing=false;_this.isWait=false;_this.removeChild(itemTip)})};TipsView.prototype.showHeartItemTip=function(item){this.equipHeartItemList.push(item);if(TimerManager.ins().isExists(this.itemHeartTipTimer,this)){}else{TimerManager.ins().doTimer(16,0,this.itemHeartTipTimer,this)}};TipsView.prototype.itemHeartTipTimer=function(){var _this=this;if(this.equipHeartItemList.length==0){TimerManager.ins().remove(this.itemHeartTipTimer,this);return}if(this.isWait){return}var itemTip;if(!this.equipHeartTip.isUsing){itemTip=this.equipHeartTip}if(!itemTip){return}itemTip.x=50;itemTip.y=750-37;itemTip.alpha=1;this.addChild(itemTip);itemTip.isUsing=true;this.isWait=true;itemTip.data=this.equipHeartItemList.pop();var t=egret.Tween.get(itemTip);t.to({y:600-37},300).wait(1e3).to({alpha:0},1e3).call(function(){itemTip.isUsing=false;_this.isWait=false;_this.removeChild(itemTip)})};return TipsView}(BaseEuiView);__reflect(TipsView.prototype,"TipsView");ViewManager.ins().reg(TipsView,LayerManager.UI_Tips);var TipsWarnItem=function(_super){__extends(TipsWarnItem,_super);function TipsWarnItem(){var _this=_super.call(this)||this;_this.skinName="TipsWarnSkin";return _this}TipsWarnItem.prototype.setLabel=function(str){str=str||"";this.lab.textFlow=TextFlowMaker.generateTextFlow(str);if(!this.addToEvent){this.addToEvent=true;TimerManager.ins().doTimer(1200,1,this.removeFromParent,this)}};TipsWarnItem.prototype.removeFromParent=function(){this.addToEvent=false;DisplayUtils.removeFromParent(this);egret.Tween.removeTweens(this);ObjectPool.push(this)};return TipsWarnItem}(BaseView);__reflect(TipsWarnItem.prototype,"TipsWarnItem");var Title=function(_super){__extends(Title,_super);function Title(){var _this=_super.call(this)||this;_this.showTitleDic={};_this.curSelectRole=0;_this.sysId=PackageID.Title;_this.regNetMsg(1,_this.postListUpdate);_this.regNetMsg(2,_this.doAdd);_this.regNetMsg(3,_this.doRemove);_this.regNetMsg(4,_this.doUpdateShow);return _this}Title.ins=function(){return _super.ins.call(this)};Title.prototype.getTotalPower=function(){var count=this.list.length;var power=0;for(var i=0;i<count;i++){var data=this.list.getItemAt(i);if(data.endTime>=0){power+=data.power}}return power};Title.prototype.postUseTitle=function(data){return data};Title.prototype.sendGetList=function(){this.sendBaseProto(1)};Title.prototype.postListUpdate=function(bytes){var timeDict={};var n=bytes.readInt();for(var i=0;i<n;++i){timeDict[bytes.readInt()]=bytes.readUnsignedInt()}this.initList(timeDict);this.showTitleDic={};var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);if(role==null)continue;this.showTitleDic[Number(i)]=role.title}};Title.prototype.doAdd=function(bytes){this.change(bytes.readInt(),bytes.readUnsignedInt())};Title.prototype.doRemove=function(bytes){this.change(bytes.readInt(),-1)};Title.prototype.sendChangeShow=function(roleID,title){var bytes=this.getBytes(4);bytes.writeShort(roleID);bytes.writeInt(title);this.sendToServer(bytes)};Title.prototype.doUpdateShow=function(bytes){var role=EntityManager.ins().getEntityByHandle(bytes.readDouble());if(role){role.infoModel.title=bytes.readInt();role.updateTitle();if(role.team==Team.My){var index=role.infoModel.index;var title=0;var lastTitle=this.showTitleDic[index]||0;var roleModel=role.infoModel;title=role.infoModel.title;this.showTitleDic[index]=title;this.postTitleShow(index,title,lastTitle)}}};Title.prototype.postTitleShow=function(param1,param2,param3){return[param1,param2,param3]};Title.prototype.setTitle=function(roleIndex,titleID){for(var k in this.showTitleDic){if(this.showTitleDic[k]==titleID){this.sendChangeShow(Number(k),0);break}}this.sendChangeShow(roleIndex,titleID)};Title.prototype.sortFunc=function(a,b){return a.endTime<0==b.endTime<0?a.config.sort>b.config.sort?1:-1:a.endTime<0?1:-1};Title.prototype.initList=function(timeDict){this.timeDict=timeDict;this.infoDict={};this._totalAttrs=[];this._totalAttrsText=new eui.ArrayCollection;var infoList=[];var configList=GlobalConfig.TitleConf;for(var i in configList){var info=new TitleInfo(configList[i]);if(info.config.Id in timeDict){info.endTime=timeDict[info.config.Id];for(var i_24 in info.config.attrs){this._totalAttrs[info.config.attrs[i_24].type]=(this._totalAttrs[info.config.attrs[i_24].type]||0)+info.config.attrs[i_24].value}}else{info.endTime=-1}if(i!="35"){infoList[infoList.length]=this.infoDict[info.config.Id]=info}else if(i=="35"&&ChannelMgr.ins().isQQZoneChannel()){infoList[infoList.length]=this.infoDict[info.config.Id]=info}info.attrsTotal=this._totalAttrsText}infoList.sort(this.sortFunc);this.list=new eui.ArrayCollection(infoList);this.updateTotalAttrs()};Title.prototype.change=function(id,time){if(!this.infoDict||!(id in this.infoDict))return;if(id in this.timeDict==time>=0)return;var info=this.infoDict[id];info.endTime=time;if(time<0){var info_8=this.infoDict[id];var power=Math.floor(UserBag.getAttrPower(AttributeData.transformAttr(info_8.config.attrs)));var str=i18n("Title_0",info_8.config.name,power);PlayFunView.addExpiredFuncTip(str);delete this.timeDict[id]}else{this.timeDict[id]=time}this.list.source.sort(this.sortFunc);this.list.refresh();var sign=time<0?-1:1;for(var _i=0,_a=info.config.attrs;_i<_a.length;_i++){var attr=_a[_i];this._totalAttrs[attr.type]=(this._totalAttrs[attr.type]||0)+sign*attr.value}this.updateTotalAttrs();if(sign>0)this.autoWearTitle(info)};Title.prototype.updateTotalAttrs=function(){var list=this._totalAttrsText.source;list.length=0;for(var i in this._totalAttrs){if(this._totalAttrs[i]>0)list.push(TitleInfo.formatAttr(Number(i),this._totalAttrs[i]))}if(list.length==0){var attrs=this.infoDict[1].config.attrs;for(var _i=0,attrs_4=attrs;_i<attrs_4.length;_i++){var attr=attrs_4[_i];list.push(TitleInfo.formatAttr(attr.type,0))}}this._totalAttrsText.refresh()};Title.prototype.autoWearTitle=function(info){if(info.config.Id!=17)return;if(info instanceof TitleInfo){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(!Title.ins().showTitleDic[i]){Title.ins().setTitle(i,info.config.Id);break}}}};Title.TITLE_WIN_REFLASH_PANEL="TITLE_WIN_REFLASH_PANEL";Title.SIMLPE_HEIGHT=86;Title.EXPAND_HEIGHT=380;return Title}(BaseSystem);__reflect(Title.prototype,"Title");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.title=Title.ins.bind(Title)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var TitleInfo=function(){function TitleInfo(config){this.config=config}Object.defineProperty(TitleInfo.prototype,"attrsText",{get:function(){if(!this._attrsText){var attrs=[];var n=this.config.attrs.length;while(n--){attrs[n]=TitleInfo.formatAttr(this.config.attrs[n].type,this.config.attrs[n].value)}this._attrsText=new eui.ArrayCollection(attrs);this.power=UserBag.getAttrPower(this.config.attrs)}return this._attrsText},enumerable:true,configurable:true});TitleInfo.formatAttr=function(type,value){if(type==AttributeType.atHpEx||type==AttributeType.atAtkEx||type==AttributeType.atDamageReduction||type==AttributeType.atDefEx||type==AttributeType.atResEx){return{h:AttributeData.getAttrStrByType(type)+"：",t:value/100+"%",textColor:4883880}}return{h:AttributeData.getAttrStrByType(type)+"：",t:String(value),textColor:4883880}};return TitleInfo}();__reflect(TitleInfo.prototype,"TitleInfo");var TitleItem=function(_super){__extends(TitleItem,_super);function TitleItem(){return _super.call(this)||this}Object.defineProperty(TitleItem,"rareText",{get:function(){var _rareText=this._rareText;if(_rareText==null){_rareText=[i18n("TitleItem_0"),i18n("TitleItem_1"),i18n("TitleItem_2"),i18n("TitleItem_3"),i18n("TitleItem_4")];this._rareText=_rareText}return _rareText},enumerable:true,configurable:true});TitleItem.prototype.onTap=function(e){if(e.target==this.btnSet){Title.ins().postUseTitle(this.data)}else{this.currentState=this.currentState!="expand"?"expand":"simple";MessageCenter.ins().dispatch(Title.TITLE_WIN_REFLASH_PANEL,this,this.currentState)}};TitleItem.prototype.dataChanged=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);if(this.data instanceof TitleInfo){var titleInfo=this.data;this.conditionTxt.text=i18n("TitleItem_5",titleInfo.config.condition);this.img.source=titleInfo.config.img;if(titleInfo.config.eff){if(!this.titleMc){this.titleMc=ObjectPool.pop("MovieClip");this.titleMc.x=118;this.titleMc.y=30;this.addChildAt(this.titleMc,20)}var eff=RES_DIR_EFF+titleInfo.config.eff;this.titleMc.playFile(eff,-1)}else{if(this.titleMc){this.titleMc.destroy();this.titleMc=null}}if(titleInfo.endTime>=0){this.btnSet.label=titleInfo.config.Id==Title.ins().showTitleDic[Title.ins().curSelectRole]?i18n("TitleItem_6"):Title.ins().showTitleDic[Title.ins().curSelectRole]?i18n("TitleItem_7"):i18n("TitleItem_8");this.btnSet.visible=true;this.time.visible=true;var s=titleInfo.endTime;this.time.text=titleInfo.endTime==0?i18n("TitleItem_9"):i18n("TitleItem_10")+DateUtils.getFormatBySecond(s,2);this.labLack.visible=false}else{this.btnSet.visible=false;this.time.visible=false;this.labLack.visible=true}if(typeof TitleItem.rareText[titleInfo.config.rare]=="string"){TitleItem._rareText[titleInfo.config.rare]=TextFlowMaker.generateTextFlow(i18n("TitleItem_11")+TitleItem.rareText[titleInfo.config.rare])}this.labRare.textFlow=TitleItem.rareText[titleInfo.config.rare];if(this._power!=titleInfo.power){if(this._power)BitmapNumber.ins().desstroyNumPic(this.power.getChildAt(0));this.power.addChildAt(BitmapNumber.ins().createNumPic(titleInfo.power*SubRoles.ins().subRolesLen,"8"),0);this._power=titleInfo.power}this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)}else{this.img.source="";this.conditionTxt.text="";if(this._power){this._power=0;BitmapNumber.ins().desstroyNumPic(this.power.getChildAt(0))}this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)}};TitleItem.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);WatcherUtil.removeFromArrayCollection(this.attrs.dataProvider);WatcherUtil.removeFromArrayCollection(this.attrsTotal.dataProvider);this.attrs.dataProvider=null;this.attrsTotal.dataProvider=null};return TitleItem}(BaseItemRender);__reflect(TitleItem.prototype,"TitleItem");var TrainGift=function(_super){__extends(TrainGift,_super);function TrainGift(){var _this=_super.call(this)||this;_this.hasRedPoint=false;_this.sysId=PackageID.OnlineTrain;_this.initData();_this.regNetMsg(1,_this.postGetInfo);_this.regNetMsg(2,_this.postGetReward);return _this}Object.defineProperty(TrainGift.prototype,"cfgDaily",{get:function(){if(!this._cfgDaily||this._cfgDaily.length<=1){this._cfgDaily=[];for(var k in GlobalConfig.OnlineRewardsConfig){if(Number(k)!=Number(k))continue;this._cfgDaily[k]=GlobalConfig.OnlineRewardsConfig[k]}}return this._cfgDaily},enumerable:true,configurable:true});Object.defineProperty(TrainGift.prototype,"cfgAcc",{get:function(){if(!this._cfgAcc||this._cfgAcc.length<=1){this._cfgAcc=[];for(var k in GlobalConfig.OnlineAccrueRewardConfig){if(Number(k)!=Number(k))continue;this._cfgAcc[k]=GlobalConfig.OnlineAccrueRewardConfig[k]}}return this._cfgAcc},enumerable:true,configurable:true});TrainGift.ins=function(){return _super.ins.call(this)};TrainGift.prototype.initData=function(){this.seconds=0;this.days=0;this.MAX_TIME=0;this.dailyRewardState=[];this.accumulateRewardState=[]};TrainGift.prototype.sendGetInfo=function(){var bytes=this.getBytes(1);this.sendToServer(bytes)};TrainGift.prototype.postGetInfo=function(bytes){this.seconds=bytes.readInt();this.days=bytes.readInt();var state;var len=bytes.readInt();for(var i=1;i<=len;i++){state=bytes.readInt();var oldv=this.dailyRewardState[i]||0;var newv=state==1?2:state;this.dailyRewardState[i]=newv>oldv?newv:oldv}len=bytes.readInt();for(var j=1;j<=len;j++){state=bytes.readInt();var oldv=this.accumulateRewardState[j]||0;var newv=state==1?2:state;this.accumulateRewardState[j]=newv>oldv?newv:oldv}TimerManager.ins().removeAll(this);TimerManager.ins().doTimer(1e3,0,this.updateTime,this);this.checkState();this.postChange()};TrainGift.prototype.sendGetReward=function(type,id){console.log("96-2: type="+type+", id="+id);var bytes=this.getBytes(2);bytes.writeByte(type);bytes.writeShort(id);this.sendToServer(bytes)};TrainGift.prototype.postGetReward=function(bytes){var result=bytes.readInt();var type=bytes.readByte();var id=bytes.readShort();var reward=type==0?this.cfgDaily[id].reward:this.cfgAcc[id].reward;switch(result){case 0:if(type==0){this.dailyRewardState[id]=2}else{this.accumulateRewardState[id]=2}this.postChange();this.checkState();break;default:console.log("96-2: "+result)}};TrainGift.prototype.updateTime=function(){if(!this.MAX_TIME){for(var i=1;i<this.cfgDaily.length;i++){var t=this.cfgDaily[i].minutes*60;if(t>this.MAX_TIME){this.MAX_TIME=t}}}if(this.seconds+1<=this.MAX_TIME){this.seconds++;this.postChangeTime()}this.checkState();if(this.isCompleted()||!this.isOpen()){TimerManager.ins().removeAll(this)}};TrainGift.prototype.checkState=function(){var newr=false,oldr=this.hasRedPoint;for(var i=1;i<this.cfgDaily.length;i++){if(!this.cfgDaily[i]||this.dailyRewardState[i]==2)continue;if((this.dailyRewardState[i]||0)==0&&this.seconds>=this.cfgDaily[i].minutes*60)this.dailyRewardState[i]=1;if(this.dailyRewardState[i]==1){newr=true;break}}for(var j=1;j<this.cfgAcc.length;j++){if(!this.cfgAcc[j]||this.accumulateRewardState[j]==2)continue;if((this.accumulateRewardState[j]||0)==0&&this.days>=this.cfgAcc[j].days)this.accumulateRewardState[j]=1;if(this.accumulateRewardState[j]==1){newr=true;break}}this.hasRedPoint=newr;if(newr!=oldr)this.postChangeState()};TrainGift.prototype.getDailyStateById=function(id){return this.dailyRewardState[id]||0};TrainGift.prototype.getAccStateById=function(id){return this.accumulateRewardState[id]||0};TrainGift.prototype.isOpen=function(){var endDay=this.cfgAcc[this.cfgAcc.length-1].days||0;return endDay!=0&&(this.days||0)<=endDay};TrainGift.prototype.isCompleted=function(){var r=true;for(var i=1;i<this.cfgAcc.length;i++){if(this.days<=this.cfgAcc[i].days){r=false;break}}for(var j=1;j<this.cfgDaily.length;j++){if(this.seconds<=this.cfgDaily[j].minutes*60){r=false;break}}return r};TrainGift.prototype.postChange=function(){};TrainGift.prototype.postChangeTime=function(){};TrainGift.prototype.postChangeState=function(){};TrainGift.prototype.postShowReward=function(reward){if(reward===void 0){reward=[]}return reward};return TrainGift}(BaseSystem);__reflect(TrainGift.prototype,"TrainGift");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.trainGift=TrainGift.ins.bind(TrainGift)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var TrainGiftItem=function(_super){__extends(TrainGiftItem,_super);function TrainGiftItem(){var _this=_super.call(this)||this;_this.skinName="TrainGiftItemSkin";_this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);_this.setMC();return _this}TrainGiftItem.prototype.dataChanged=function(){var data=this.data;this.item.data=data.config.reward[0];var day=data.config.days;this.title.removeChildren();this.titleTxt=BitmapNumber.ins().createNumPic("d"+day+"t","fl");this.title.addChild(this.titleTxt);this.title.width=this.titleTxt.width;switch(data.state){case 0:this.checkMask.visible=false;this.checked.visible=false;this.btnGet.visible=true;this.btnGet.label=i18n("TrainGiftItem_0");this.btnGet.enabled=false;this.select.visible=false;break;case 1:this.checkMask.visible=false;this.checked.visible=false;this.btnGet.visible=true;this.btnGet.label=i18n("TrainGiftItem_1");this.btnGet.enabled=true;this.select.visible=true;break;case 2:this.checkMask.visible=true;this.checked.visible=true;this.btnGet.visible=false;this.select.visible=false;break;default:this.checkMask.visible=false;this.checked.visible=false;this.btnGet.visible=false;this.select.visible=false}};TrainGiftItem.prototype.onTap=function(e){var data=this.data;switch(e.currentTarget){case this.btnGet:TrainGift.ins().sendGetReward(1,data.config.id);break}};TrainGiftItem.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=38;this.mc.y=38;this.mc.width=76;this.mc.height=76;this.mc.scaleX=.5;this.mc.scaleY=1.3;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.select.addChild(this.mc)}};return TrainGiftItem}(BaseItemRender);__reflect(TrainGiftItem.prototype,"TrainGiftItem");var TrainGiftWin=function(_super){__extends(TrainGiftWin,_super);function TrainGiftWin(){var _this=_super.call(this)||this;_this.initUI();return _this}TrainGiftWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="TrainGiftWinSkin";this.uiData={};this.uiData["bar5"]=this.bar5;this.uiData["bar1"]=this.bar1;this.uiData["bar2"]=this.bar2;this.uiData["bar3"]=this.bar3;this.uiData["bar4"]=this.bar4;this.uiData["timeGift5"]=this.timeGift5;this.uiData["timeGift1"]=this.timeGift1;this.uiData["timeGift2"]=this.timeGift2;this.uiData["timeGift3"]=this.timeGift3;this.uiData["timeGift4"]=this.timeGift4;this.uiData["dayGift6"]=this.dayGift6;this.uiData["dayGift1"]=this.dayGift1;this.uiData["dayGift2"]=this.dayGift2;this.uiData["dayGift3"]=this.dayGift3;this.uiData["dayGift4"]=this.dayGift4;this.uiData["dayGift5"]=this.dayGift5};TrainGiftWin.prototype.open=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}this.updateShow();this.observe(TrainGift.ins().postChange,this.updateShow);this.observe(TrainGift.ins().postChangeTime,this.updateTimer);this.observe(TrainGift.ins().postShowReward,this.showReward);TrainGift.ins().sendGetInfo()};TrainGiftWin.prototype.close=function(){this.removeObserve()};TrainGiftWin.prototype.updateShow=function(){this.updateDailyTrain();this.updateAccumulateTrain()};TrainGiftWin.prototype.updateDailyTrain=function(){this.updateBar();this.updateTimer();this.updateDailyReward()};TrainGiftWin.prototype.updateBar=function(){var t=TrainGift.ins().seconds;var config=TrainGift.ins().cfgDaily;for(var i=1;i<config.length;i++){if(t<config[i].minutes*60){this.uiData["bar"+i].value=0}else{this.uiData["bar"+i].value=100}}};TrainGiftWin.prototype.updateTimer=function(){var t=TrainGift.ins().seconds;var config=TrainGift.ins().cfgDaily;var leftTime=0;this.lblTime0.visible=false;this.lblTime.visible=true;for(var i=1;i<config.length;i++){leftTime=config[i].minutes*60-t;if(leftTime>=0){this.lblTime.text=DateUtils.getFormatBySecond(leftTime,DateUtils.TIME_FORMAT_1);if(leftTime==0){TrainGift.ins().sendGetInfo()}return}}this.lblTime0.visible=true;this.lblTime.visible=false;this.lblTime0.text=i18n("TrainGiftWin_2")};TrainGiftWin.prototype.updateDailyReward=function(){var t=TrainGift.ins().seconds;var config=TrainGift.ins().cfgDaily;for(var i=1;i<config.length;i++){var state=t>=config[i].minutes*60?TrainGift.ins().getDailyStateById(config[i].id)||1:TrainGift.ins().getDailyStateById(config[i].id);this.uiData["timeGift"+i].data={config:config[i],state:state}}};TrainGiftWin.prototype.updateAccumulateTrain=function(){var days=TrainGift.ins().days;this.lblDays.text=i18n("TrainGiftWin_1",days);var config=TrainGift.ins().cfgAcc;for(var i=1;i<config.length;i++){var state=days>=config[i].days?TrainGift.ins().getAccStateById(config[i].id)||1:TrainGift.ins().getAccStateById(config[i].id);this.uiData["dayGift"+i].data={config:config[i],state:state}}};TrainGiftWin.prototype.showReward=function(reward){ViewManager.ins().open(ActivityRewardTipWin,reward)};return TrainGiftWin}(BaseEuiView);__reflect(TrainGiftWin.prototype,"TrainGiftWin");ViewManager.ins().reg(TrainGiftWin,LayerManager.UI_Popup);var TrainGiftItem2=function(_super){__extends(TrainGiftItem2,_super);function TrainGiftItem2(){var _this=_super.call(this)||this;_this.skinName="TrainGiftItem2Skin";_this.btnGet.addEventListener(egret.TouchEvent.TOUCH_TAP,_this.onTap,_this);_this.setMC();return _this}TrainGiftItem2.prototype.dataChanged=function(){var data=this.data;this.item.data=data.config.reward[0];this.time.text=i18n("TrainGiftItem2_0",data.config.minutes);switch(data.state){case 0:this.checkMask.visible=false;this.checked.visible=false;this.btnGet.visible=false;this.select.visible=false;break;case 1:this.checkMask.visible=false;this.checked.visible=false;this.btnGet.visible=true;this.select.visible=true;break;case 2:this.checkMask.visible=true;this.checked.visible=true;this.btnGet.visible=false;this.select.visible=false;break}};TrainGiftItem2.prototype.onTap=function(e){var data=this.data;switch(e.currentTarget){case this.btnGet:TrainGift.ins().sendGetReward(0,data.config.id);break}};TrainGiftItem2.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.x=38;this.mc.y=38;this.mc.width=76;this.mc.height=76;this.mc.scaleX=.5;this.mc.scaleY=1.3;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.select.addChild(this.mc)}};return TrainGiftItem2}(BaseItemRender);__reflect(TrainGiftItem2.prototype,"TrainGiftItem2");var BreakDownListItemData=function(){function BreakDownListItemData(){}return BreakDownListItemData}();__reflect(BreakDownListItemData.prototype,"BreakDownListItemData");var Hunt=function(_super){__extends(Hunt,_super);function Hunt(){var _this=_super.call(this)||this;_this.huntBoxInfo=[];_this.huntTimes=0;_this.huntHope=0;_this.huntFreeTimes=0;_this.sysId=PackageID.TreasureHunt;_this.regNetMsg(1,_this.doHuntResult);_this.regNetMsg(2,_this.postBestListInfo);_this.regNetMsg(3,_this.postHuntBoxInfo);return _this}Hunt.ins=function(){return _super.ins.call(this)};Hunt.prototype.sendHunt=function(type){var bytes=this.getBytes(1);bytes.writeShort(type);this.sendToServer(bytes)};Hunt.prototype.sendHuntList=function(){this.sendBaseProto(2)};Hunt.prototype.doHuntResult=function(bytes){var type=bytes.readShort();var num=bytes.readInt();var arr=[];for(var i=0;i<num;i++){arr[i]=[bytes.readInt(),bytes.readInt()]}if(arr&&arr.length>0&&type==Hunt.TYPE_BUY_TEN_TIME){var _arr=[];var len=arr.length;var last_id=arr[0][0];_arr[0]=arr[0];var _len=1;for(var i=1;i<len;++i){var new_id=arr[i][0];if(new_id==last_id){_arr[_len-1][1]+=arr[i][1]}else{last_id=new_id;++_len;_arr[_len-1]=arr[i]}}arr=_arr}if(ViewManager.ins().isShow(HuntResultWin)){this.postHuntResult(type,arr,0)}else{ViewManager.ins().open(HuntResultWin,type,arr,0);this.postHuntResult(type,arr,0)}};Hunt.prototype.postHuntResult=function(){var params=[];for(var _i=0;_i<arguments.length;_i++){params[_i]=arguments[_i]}return params};Hunt.prototype.postBestListInfo=function(bytes){var num=bytes.readShort();var arr=[];for(var i=0;i<num;i++){arr[i]=[bytes.readString(),bytes.readInt()]}arr.reverse();return arr};Hunt.prototype.postFreeTime=function(bytes){Hunt.ins().huntFreeTimes=bytes.readInt()};Hunt.prototype.postHuntBoxInfo=function(bytes){this.huntFreeTimes=bytes.readInt();var state=bytes.readInt();this.huntTimes=bytes.readInt();var config;var i=0;for(var k in GlobalConfig.TreasureRewardConfig){config=GlobalConfig.TreasureRewardConfig[k];this.huntBoxInfo[i]=state>>config.id&1?Hunt.ISNGET:this.huntTimes>=config.needTimes?Hunt.CANGET:Hunt.UNGET;i++}};Hunt.prototype.getIsGetBox=function(){return this.huntBoxInfo.indexOf(Hunt.CANGET)!=-1};Hunt.prototype.getIsGetTen=function(){var sum=this.getHuntItemNum();return sum>=10};Hunt.prototype.sendHuntAward=function(index){var bytes=this.getBytes(3);bytes.writeInt(index);this.sendToServer(bytes)};Hunt.prototype.canHuntFree=function(){var count=this.getHuntItemNum();var huntFreeTimes=this.huntFreeTimes;return count>0||huntFreeTimes>0};Hunt.prototype.getHuntItemNum=function(){var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.TreasureHuntConfig.huntItem);var count=item?item.count:0;return count};Hunt.prototype.showRedPoint=function(){return this.canHuntFree()||this.getIsGetBox()};Hunt.TYPE_BUY_ONE_TIME=0;Hunt.TYPE_BUY_TEN_TIME=1;Hunt.UNGET=0;Hunt.CANGET=1;Hunt.ISNGET=2;return Hunt}(BaseSystem);__reflect(Hunt.prototype,"Hunt");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.hunt=Hunt.ins.bind(Hunt)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var AdvanEquipWin=function(_super){__extends(AdvanEquipWin,_super);function AdvanEquipWin(){var _this=_super.call(this)||this;_this.curRole=0;_this.curSelectIndex=0;_this.skinName="AdvanEquipWinSkin";_this.panelArr=[_this.orangeEquipPanel,_this.legendEquipPanel,_this.extremeEquipPanel];_this.isTopLevel=true;return _this}AdvanEquipWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.viewStack.selectedIndex=AdvanEquipWin.ShenZhuang;this.tab.dataProvider=this.viewStack};AdvanEquipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var page=param[0]?param[0]:AdvanEquipWin.ShenZhuang;var selectedIndex=param[1]?param[1]:AdvanEquipWin.ShenZhuang;this.roleSelect.setCurRole(selectedIndex);this.addTouchEvent(this.closeBtn,this.onClick);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.observe(UserBag.ins().postItemChange,this.setRedPoint);this.observe(UserBag.ins().postItemAdd,this.setRedPoint);this.observe(UserBag.ins().postItemDel,this.setRedPoint);this.observe(GameLogic.ins().postSubRoleChange,this.setRedPoint);this.observe(Actor.ins().postPowerChange,this.refreshPower);this.addChangeEvent(this.roleSelect,this.switchRole);this.setSelectedIndex(page);this.setRedPoint()};AdvanEquipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.panelArr[this.curSelectIndex].close()};AdvanEquipWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};AdvanEquipWin.prototype.refreshPower=function(){this.roleSelect.refreshPower(this.roleSelect._curRole)};AdvanEquipWin.prototype.switchRole=function(){var curRole=this.roleSelect.getCurRole();this.panelArr[this.curSelectIndex].setRoleId(curRole)};AdvanEquipWin.prototype.onTabTouching=function(e){if(e.currentTarget.selectedIndex==AdvanEquipWin.XunBao){ViewManager.ins().open(TreasureHuntWin,0);e.preventDefault();return}if(!this.checkIsOpen(e.currentTarget.selectedIndex)){e.preventDefault();return}};AdvanEquipWin.prototype.checkIsOpen=function(index){switch(index){case AdvanEquipWin.ShenZhuang:break;case AdvanEquipWin.ChuanQi:break;case AdvanEquipWin.ZhiZun:if(!OpenSystem.ins().checkSysOpen(SystemType.ZHIZUN)){UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ZHIZUN));return false}break}return true};AdvanEquipWin.prototype.onTabTouch=function(e){this.panelArr[this.curSelectIndex].close();var selectedIndex=e.currentTarget.selectedIndex;this.setSelectedIndex(selectedIndex);this.setRedPoint();ViewManager.ins().close(LimitTaskView)};AdvanEquipWin.prototype.setSelectedIndex=function(selectedIndex){this.curSelectIndex=selectedIndex;var curRole=this.roleSelect.getCurRole();this.panelArr[selectedIndex].open(curRole);this.viewStack.selectedIndex=selectedIndex};AdvanEquipWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(Actor.level>=10)return true;UserTips.ins().showTips(i18n("AdvanEquipWin_0"));return false};AdvanEquipWin.prototype.setRedPoint=function(){this.redPoint3.visible=this.redPoint2.visible=this.redPoint0.visible=this.redPoint1.visible=false;var bool=false;var len=SubRoles.ins().subRolesLen;var rolePoint=[false,false,false];for(var a=0;a<len;a++){for(var i=0;i<8;i++){bool=UserEquip.ins().setOrangeEquipItemState(i,SubRoles.ins().getSubRoleByIndex(a));var s=UserEquip.ins().posState[i];if(s==2){bool=true}if(bool)break}this.roleSelect.showRedPoint(a,bool);if(bool)this.redPoint0.visible=bool}bool=false;for(var a=0;a<len;a++){for(var i=0;i<2;i++){bool=UserEquip.ins().setLegendEquipItemUpState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(a));bool=UserEquip.ins().setLegendEquipItemState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(a))||bool;if(i==1){if(bool){this.redPoint1.visible=bool;break}}}if(this.viewStack.selectedIndex==AdvanEquipWin.ChuanQi){this.roleSelect.showRedPoint(a,bool)}}if(this.redPoint1.visible==false){this.redPoint1.visible=UserEquip.ins().checkRedPointEx(5,this.roleSelect.getCurRole())||this.legendEquipPanel.setRedPoint()}this.redPoint2.visible=Boolean(UserBag.ins().getHuntGoods(0).length);if(this.viewStack.selectedIndex==AdvanEquipWin.ZhiZun){this.roleSelect.clearRedPoint();for(var i=0;i<SubRoles.ins().subRolesLen;i++){var role=SubRoles.ins().getSubRoleByIndex(i);var b=ExtremeEquipModel.ins().getRedPointByJob(role.job);if(b){this.roleSelect.showRedPoint(i,b)}}}this.redPoint3.visible=ExtremeEquipModel.ins().getRedPoint()};AdvanEquipWin.ShenZhuang=0;AdvanEquipWin.ChuanQi=1;AdvanEquipWin.ZhiZun=2;AdvanEquipWin.XunBao=3;return AdvanEquipWin}(BaseEuiView);__reflect(AdvanEquipWin.prototype,"AdvanEquipWin");ViewManager.ins().reg(AdvanEquipWin,LayerManager.UI_Main);var BreakDownItemRenderer=function(_super){__extends(BreakDownItemRenderer,_super);function BreakDownItemRenderer(){var _this=_super.call(this)||this;_this.configID=0;return _this}BreakDownItemRenderer.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.itemIcon.imgJob.visible=false};BreakDownItemRenderer.prototype.dataChanged=function(){var itemConfig=this.data.itemConfig;if(itemConfig.zsLevel>0){this.level.text=itemConfig.zsLevel+i18n("BreakDownItemRenderer_0")}else{this.level.text=itemConfig.level?itemConfig.level+"级":"1级"}this.itemIcon.setData(itemConfig);this.equipName.text=""+itemConfig.name;this.equipName.textColor=ItemConfig.getQualityColor(itemConfig);this.equipName.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.equipName.stroke=1;if(ItemConfig.getType(itemConfig)==ItemType.TYPE_9){var decomConf=Book.ins().getDecomposeConfigByItemId(itemConfig.id);var descValue=0;if(decomConf)descValue=decomConf.value;else{var cfg=GlobalConfig.DecomposeConfig[67];if(cfg)descValue=cfg.value}this.desc.text=i18n("BreakDownItemRenderer_1",descValue);this.tip.visible=true;this.tip.x=this.equipName.x+this.equipName.width;this.level.text=""}else{var currItem=GlobalConfig.EquipConfig[itemConfig.id];if(!currItem)return;var rewardItem=GlobalConfig.ItemConfig[currItem.stoneId];if(!rewardItem)return;this.desc.text=rewardItem.name+" x "+currItem.stoneNum;this.desc.textColor=this.equipName.textColor;this.desc.strokeColor=this.equipName.strokeColor;this.desc.stroke=1;var subType=ItemConfig.getSubType(itemConfig);var id=UserEquip.ins().getEquipConfigIDByPosAndQuality(subType,ItemConfig.getQuality(itemConfig));var fitConfig=GlobalConfig.ItemConfig[id];var l1zs=itemConfig.zsLevel?itemConfig.zsLevel:0;var flzs=fitConfig.zsLevel?fitConfig.zsLevel:0;var l1lv=itemConfig.level?itemConfig.level:0;var fllv=fitConfig.level?fitConfig.level:0;var L=l1zs*1e4+l1lv;var fitL=flzs*1e4+fllv;if(fitL>L){if(UserZs.ins().lv>=flzs&&Actor.level>=fllv){this.tip.visible=false}else{this.tip.visible=true;this.tip.x=this.equipName.x+this.equipName.width}}else{this.tip.visible=false}}this.configID=this.data.handle};return BreakDownItemRenderer}(BaseItemRender);__reflect(BreakDownItemRenderer.prototype,"BreakDownItemRenderer");var BreakDownListview=function(_super){__extends(BreakDownListview,_super);function BreakDownListview(){return _super.call(this)||this}BreakDownListview.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="BreakDownSkin";this.isTopLevel=true;this.equipList.itemRenderer=BreakDownItemRenderer;this.listData=new eui.ArrayCollection;this.equipList.dataProvider=this.listData;this.gainList.itemRenderer=GainGoodsItem;this.goList=new eui.ArrayCollection;this.gainList.dataProvider=this.goList};BreakDownListview.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.observe(UserBag.ins().postItemDel,this.updateData);this.addTouchEvent(this,this.onTap);this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this);this.quality=param[0];this.updateData()};BreakDownListview.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this,this.onTap);this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this);this.removeObserve()};BreakDownListview.prototype.updateData=function(){var itemData=UserBag.ins().getBagEquipsByQuality(this.quality);itemData.sort(function(n1,n2){var config1=GlobalConfig.ItemConfig[n1.configID];var config2=GlobalConfig.ItemConfig[n2.configID];if(config1.zsLevel>config2.zsLevel){return 1}if(config1.zsLevel<config2.zsLevel){return-1}if(config1.level>config2.level){return 1}if(config1.level<config2.level){return-1}return 0});this.listData.source=itemData;var dataList=this.itemList[this.quality];var dataNum=dataList.length;this.goList.removeAll();for(var i=0;i<dataList.length;i++){this.goList.addItem(dataList[i])}this.refushPos(dataNum)};BreakDownListview.prototype.refushPos=function(len){this.contrain.height=60*len;this.equipScroller.height=310+60*(3-len)};BreakDownListview.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn0:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;default:if(e.target instanceof eui.Button){switch(e.target.name){case"breakDown":UserEquip.ins().sendSmeltEquip(1,[e.target.parent["data"]]);break}}}};BreakDownListview.prototype.onGo=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){GameGuider.guidance(item[1],item[2]);ViewManager.ins().close(this)}};return BreakDownListview}(BaseEuiView);__reflect(BreakDownListview.prototype,"BreakDownListview");ViewManager.ins().reg(BreakDownListview,LayerManager.UI_Popup);var HuntBoxsTips=function(_super){__extends(HuntBoxsTips,_super);function HuntBoxsTips(){var _this=_super.call(this)||this;_this.type=0;return _this}HuntBoxsTips.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="TreasureRuneGift"};HuntBoxsTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.index=param[0];if(param.length>=2){this.type=param[1];this.activityID=param[2]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.gift.itemRenderer=ItemBase;if(this.type==3)this.initActivity();else if(this.type==2)this.initHeirloom();else if(this.type==5)this.initShapeShifting();else if(this.type==4)this.initTreasureHunt();else if(this.type==6)this.initTicketLingShi();else this.initInfo()};HuntBoxsTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeObserve()};HuntBoxsTips.prototype.initInfo=function(){var config=GlobalConfig.FuwenTreasureRewardConfig[this.index];if(!config)return;this.gift.dataProvider=new eui.ArrayCollection(config.reward);this.num0.text=Rune.ins().runeCount.toString();if(Rune.ins().boxs[this.index-1]==Rune.UNGET){var sum=config.needTime-Rune.ins().runeCount;this.num1.text=sum>0?sum+"":"0";this.already.visible=false}else{this.num1.visible=this.num2.visible=this.num3.visible=false;this.already.visible=true}};HuntBoxsTips.prototype.initTreasureHunt=function(){var config=GlobalConfig.TreasureRewardConfig[this.index];if(!config)return;this.gift.dataProvider=new eui.ArrayCollection(config.awards);this.num0.text=Hunt.ins().huntTimes.toString();if(Hunt.ins().huntBoxInfo[this.index-1]==Hunt.UNGET){var sum=config.needTimes-Hunt.ins().huntTimes;this.num1.text=sum>0?sum+"":"0";this.already.visible=false}else{this.num1.visible=this.num2.visible=this.num3.visible=false;this.already.visible=true}};HuntBoxsTips.prototype.initHeirloom=function(){var config=GlobalConfig.HeirloomTreasureRewardConfig[this.index];if(!config)return;this.gift.dataProvider=new eui.ArrayCollection(config.reward);this.num0.text=Heirloom.ins().huntTimes.toString();if(Heirloom.ins().huntBoxInfo[this.index-1]==Heirloom.UNGET){var sum=config.needTime-Heirloom.ins().huntTimes;this.num1.text=sum>0?sum+"":"0";this.already.visible=false}else{this.num1.visible=this.num2.visible=this.num3.visible=false;this.already.visible=true}};HuntBoxsTips.prototype.initShapeShifting=function(){var config=GlobalConfig.ShapeShiftingTreasureRewardConfig[this.index];if(!config)return;this.gift.dataProvider=new eui.ArrayCollection(config.reward);this.num0.text=ShapeShiftingTreasure.ins().huntTimes.toString();if(ShapeShiftingTreasure.ins().huntBoxInfo[this.index-1]==ShapeShiftingTreasure.UNGET){var sum=config.needTime-ShapeShiftingTreasure.ins().huntTimes;this.num1.text=sum>0?sum+"":"0";this.already.visible=false}else{this.num1.visible=this.num2.visible=this.num3.visible=false;this.already.visible=true}};HuntBoxsTips.prototype.initTicketLingShi=function(){var config=GlobalConfig.TicketLingShiTreasureRewardConfig[this.index];if(!config)return;this.gift.dataProvider=new eui.ArrayCollection(config.reward);this.num0.text=TicketLingShiTreasure.ins().huntTimes.toString();if(TicketLingShiTreasure.ins().huntBoxInfo[this.index-1]==TicketLingShiTreasure.UNGET){var sum=config.needTime-TicketLingShiTreasure.ins().huntTimes;this.num1.text=sum>0?sum+"":"0";this.already.visible=false}else{this.num1.visible=this.num2.visible=this.num3.visible=false;this.already.visible=true}};HuntBoxsTips.prototype.initActivity=function(){var config=GlobalConfig.ActivityType18Config[this.activityID][this.index];this.gift.dataProvider=new eui.ArrayCollection(config.rewards);var data=Activity.ins().getActivityDataById(this.activityID);this.num0.text=data.num+"";var sum=config.dbCount-data.num;this.num1.text=sum>0?sum+"":"0";if(data.getStateByIndex(this.index)==1){this.already.visible=true}else{this.already.visible=false}};HuntBoxsTips.prototype.onTap=function(){ViewManager.ins().close(this)};return HuntBoxsTips}(BaseEuiView);__reflect(HuntBoxsTips.prototype,"HuntBoxsTips");ViewManager.ins().reg(HuntBoxsTips,LayerManager.UI_Popup);var HuntListRenderer=function(_super){__extends(HuntListRenderer,_super);function HuntListRenderer(){var _this=_super.call(this)||this;_this.job=["",i18n("HuntListRenderer_2"),i18n("HuntListRenderer_3"),i18n("HuntListRenderer_4")];_this.skinName="HuntListRendererSkin";return _this}HuntListRenderer.prototype.dataChanged=function(){var arr=this.data;var item=GlobalConfig.ItemConfig[arr[1]];if(item==null)return;var str;var cstr=ItemConfig.getQualityColor(item);var type=ItemConfig.getType(item);var color="<font color = "+ColorUtil.HUNT_ITEMLIST_NAME+">";if(type==0){str=color+arr[0]+i18n("HuntListRenderer_0")+cstr+"'>"+this.makeNameList(item)+"</font>"}else{str=color+arr[0]+i18n("HuntListRenderer_1")+cstr+"'>"+item.name+"</font>"}this.showText.textFlow=TextFlowMaker.generateTextFlow(str)};HuntListRenderer.prototype.makeNameList=function(item){var name="";name=item.name;if(item.zsLevel>0){name+="("+item.zsLevel+i18n("HuntListRenderer_5")}else{name+="("+item.level+i18n("HuntListRenderer_6")}name+=this.job[ItemConfig.getJob(item)]+")";return name};HuntListRenderer.QUALITY_COLOR=["#e2dfd4","#03b154","#d242fb","#ff750f","#f3311e","#ffd93f"];return HuntListRenderer}(BaseItemRender);__reflect(HuntListRenderer.prototype,"HuntListRenderer");var HuntResultNoticeWin=function(_super){__extends(HuntResultNoticeWin,_super);function HuntResultNoticeWin(){return _super.call(this)||this}HuntResultNoticeWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="HuntResultNotice";this.isTopLevel=true};HuntResultNoticeWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.noticeItems=param[0];this.addTouchEvent(this.btnClose,this.closeWin);this.addTouchEvent(this.bgClose,this.closeWin);this.addTouchEvent(this.itemicon,this.onItemClicked);this.updateView();this.cdSeconds=6;TimerManager.ins().doTimer(1e3,0,this.onCountDown,this);this.onCountDown()};HuntResultNoticeWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.btnClose,this.closeWin);this.removeTouchEvent(this.bgClose,this.closeWin);this.removeTouchEvent(this.itemicon,this.onItemClicked);this.removeObserve();TimerManager.ins().remove(this.onCountDown,this)};HuntResultNoticeWin.prototype.onItemClicked=function(){TimerManager.ins().remove(this.onCountDown,this);this.labelCountDown.visible=false};HuntResultNoticeWin.prototype.onCountDown=function(){this.cdSeconds--;this.labelCountDown.text="("+this.cdSeconds+i18n("HuntResultNoticeWin_0");if(this.cdSeconds==0){TimerManager.ins().remove(this.onCountDown,this);this.closeWin()}};HuntResultNoticeWin.prototype.closeWin=function(){ViewManager.ins().close(this);if(this.noticeItems.length>1){this.noticeItems.shift();ViewManager.ins().open(HuntResultNoticeWin,this.noticeItems)}};HuntResultNoticeWin.prototype.updateView=function(){this.itemicon.data=this.noticeItems[0].id;this.itemicon.isShowName(true);this.itemicon.showNum(false);this.playResult()};HuntResultNoticeWin.prototype.playResult=function(fun){};return HuntResultNoticeWin}(BaseEuiView);__reflect(HuntResultNoticeWin.prototype,"HuntResultNoticeWin");ViewManager.ins().reg(HuntResultNoticeWin,LayerManager.UI_Main);var c_launchX=180;window["c_launchX"]=c_launchX;var c_launchY=500;window["c_launchY"]=c_launchY;var c_firstX=0;window["c_firstX"]=c_firstX;var c_firstY=0;window["c_firstY"]=c_firstY;var c_distantX=77;window["c_distantX"]=c_distantX;var c_distantY=93;window["c_distantY"]=c_distantY;var c_depotX=320;window["c_depotX"]=c_depotX;var c_depotY=620;window["c_depotY"]=c_depotY;var waitTime=50;window["waitTime"]=waitTime;var HuntResultWin=function(_super){__extends(HuntResultWin,_super);function HuntResultWin(){var _this=_super.call(this)||this;_this.arr=[];_this.items=[];_this.type=0;_this.recordListData=[];return _this}HuntResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="HuntResult";this.isTopLevel=true;this.recordList.itemRenderer=ShapeShiftingRecordItemRenderer;this.recordScroller.viewport=this.recordList};HuntResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.buyBtn,this.buy);this.addTouchEvent(this.rectBg,this.closeWin);this.addTouchEvent(this.closeBtn,this.closeWin);this.observe(Hunt.ins().postHuntResult,this.updateView);this.observe(Heirloom.ins().postHuntResult,this.updateView);this.observe(ShapeShiftingTreasure.ins().postHuntResult,this.updateView);this.observe(TicketLingShiTreasure.ins().postHuntResult,this.updateView);this.observe(Activity.ins().postHuntResult,this.updateView);this.updateView([param[0],param[1],param[2],param[3]])};HuntResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buyBtn,this.buy);this.removeTouchEvent(this.rectBg,this.closeWin);this.removeTouchEvent(this.closeBtn,this.closeWin);this.removeObserve()};HuntResultWin.prototype.closeWin=function(){ViewManager.ins().close(HuntResultWin)};HuntResultWin.prototype.updateView=function(param){this.shapeshiftingGroup.visible=false;this.canClicck=true;this.huntType=param[0];this.arr=param[1];this.type=param[2];this.activityID=param[3];if(this.type==3){this.currentState="noItem"}else{this.currentState="normal"}this.validateNow();if(this.huntType==0){var num=0;if(this.type==0)num=GlobalConfig.TreasureHuntConfig.huntOnce;else if(this.type==1)num=GlobalConfig.FuwenTreasureConfig.huntOnce;else if(this.type==2)num=GlobalConfig.HeirloomTreasureConfig.huntOnce;else if(this.type==3)num=GlobalConfig.ActivityType18Config[this.activityID][1].yb;else if(this.type==4)num=GlobalConfig.ShapeShiftingTreasureConfig.huntOnce;else if(this.type==5){num=GlobalConfig.TicketLingShiTreasureConfig.huntOnce;this.lblLingshi.text=num+""}this.yb=num;this.buyBtn.labelDisplay.text=i18n("HuntResultWin_0")}else{var num=0;if(this.type==0)num=GlobalConfig.TreasureHuntConfig.huntTenth;else if(this.type==1)num=GlobalConfig.FuwenTreasureConfig.huntTenth;else if(this.type==2)num=GlobalConfig.HeirloomTreasureConfig.huntTenth;else if(this.type==3)num=GlobalConfig.ActivityType18Config[this.activityID][2].yb;else if(this.type==4)num=GlobalConfig.ShapeShiftingTreasureConfig.huntTenth;else if(this.type==5){num=GlobalConfig.TicketLingShiTreasureConfig.huntTenth;this.lblLingshi.text=num+""}this.yb=num;this.buyBtn.labelDisplay.text=i18n("HuntResultWin_1")}if(this.type==4){this.showProp()}if(this.type==5){this.groupLingshi.visible=true;this.zwHunt.visible=false}else{this.groupLingshi.visible=false;this.zwHunt.visible=true}var itemId;if(this.type==0)itemId=GlobalConfig.TreasureHuntConfig.huntItem;else if(this.type==1)itemId=GlobalConfig.FuwenTreasureConfig.huntItem;else if(this.type==2)itemId=GlobalConfig.HeirloomTreasureConfig.huntItem;else if(this.type==3)itemId=GlobalConfig.ActivityType18Config[this.activityID][1].item;else if(this.type==4)itemId=GlobalConfig.ShapeShiftingTreasureConfig.huntItem;else if(this.type==5)itemId=0;this.zw.text=this.yb+"";var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,itemId);var times=this.huntType?10:1;var sum=item?item.count:0;this.zwNum1.textFlow=TextFlowMaker.generateTextFlow("<font color="+(sum>=times?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+sum+"</font> ");if(GlobalConfig.ItemConfig[itemId])this.icon.source=GlobalConfig.ItemConfig[itemId].icon+"_png";this.zwNum2.text=this.huntType==0?"/1）":"/10）";this.playResult()};HuntResultWin.prototype.showProp=function(){this.shapeshiftingGroup.visible=true;var temp=[];for(var i=0;i<this.arr.length;i++){var item=this.arr[i];var itemID=item[0];var oldInx=this.recordListData.indexOf(itemID);if(oldInx>-1){this.recordListData.splice(oldInx,1)}var id=ShapeShiftingMgr.ins().isBianshenProp(itemID);if(id){var isMax=ShapeShiftingMgr.ins().isMaxPropLevel(id);if(!isMax){if(temp.indexOf(itemID)>-1){temp.splice(temp.indexOf(itemID,1))}temp.push(itemID)}}}temp.reverse();var arr=temp.concat(this.recordListData);this.recordList.dataProvider=new eui.ArrayCollection(arr);this.recordListData=arr};HuntResultWin.prototype.playResult=function(fun){var _this=this;this.releaseAllItem();var count=this.arr.length;var needNoticeItems=[];for(var i=0;i<count;i++){this.items[i]=this.createItem(this.arr[i]);var cfg=GlobalConfig.ItemConfig[this.arr[i][0]];if(cfg.needNotice){needNoticeItems.push(cfg)}var t=egret.Tween.get(this.items[i]);this.items[i].x=i%5*c_distantX+c_firstX;this.items[i].y=Math.floor(i/5)*c_distantY+c_firstY;this.items[i].alpha=0;t.wait(i*waitTime).to({alpha:1},200).call(function(){count--;if(count==0){if(fun!=undefined){fun()}_this.canClicck=true}})}if(needNoticeItems.length>0){ViewManager.ins().open(HuntResultNoticeWin,needNoticeItems)}};HuntResultWin.prototype.playGet=function(fun){var _this=this;var count=this.arr.length;for(var i=0;i<count;i++){if(!this.items[i])continue;var t=egret.Tween.get(this.items[i]);t.to({y:c_depotY,x:c_depotX,scaleX:0,scaleY:0},300-Math.floor(i/5)*50).call(function(){count--;if(count==0){if(fun!=undefined){fun()}_this.releaseAllItem()}})}};HuntResultWin.prototype.createItem=function(data){var item=new ItemBase;this.listCon.addChild(item);var cfg=GlobalConfig.ItemConfig[data[0]];if(cfg){item.num=data[1];item.data=data[0]}else{item.data={type:0,count:data[1],id:data[0]}}item.x=c_launchX;item.y=c_launchY;return item};HuntResultWin.prototype.releaseAllItem=function(){for(var k in this.items){this.items[k].destruct();this.listCon.removeChild(this.items[k])}this.items=[]};HuntResultWin.prototype.closeCB=function(e){var _this=this;if(!this.canClicck){return}this.canClicck=false;var func=function(){ViewManager.ins().close(_this)};this.playGet(func)};HuntResultWin.prototype.buy=function(e){var _this=this;if(this.type==3){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH){ViewManager.ins().open(BagFullTipsWin);return}}if(!this.canClicck){return}if(this.type==0&&this.huntType==0&&Hunt.ins().huntFreeTimes>0){--Hunt.ins().huntFreeTimes;Hunt.ins().sendHunt(this.huntType);return}if(this.type==1&&this.huntType==0&&Rune.ins().huntFreeTimes>0){--Rune.ins().huntFreeTimes;Rune.ins().sendHuntRune(this.huntType);return}if(this.type==2&&this.huntType==0&&Heirloom.ins().huntFreeTimes>0){--Heirloom.ins().huntFreeTimes;Heirloom.ins().sendHunt(this.huntType);return}if(this.type==4&&this.huntType==0&&ShapeShiftingTreasure.ins().huntFreeTimes>0){--ShapeShiftingTreasure.ins().huntFreeTimes;ShapeShiftingTreasure.ins().sendHunt(this.huntType);return}if(this.type==5&&this.huntType==0&&TicketLingShiTreasure.ins().huntFreeTimes>0){--TicketLingShiTreasure.ins().huntFreeTimes;TicketLingShiTreasure.ins().sendHunt(this.huntType);return}var itemId=0;if(this.type==3)itemId=GlobalConfig.ActivityType18Config[this.activityID][1].item;else if(this.type==5)itemId=0;else if(this.type==4)itemId=GlobalConfig.ShapeShiftingTreasureConfig.huntItem;else if(this.type==2)itemId=GlobalConfig.HeirloomTreasureConfig.huntItem;else if(this.type==1)itemId=GlobalConfig.FuwenTreasureConfig.huntItem;else itemId=GlobalConfig.TreasureHuntConfig.huntItem;var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,itemId);if(item&&item.count){var func=function(){if(_this.type==0)Hunt.ins().sendHunt(_this.huntType);else if(_this.type==1)Rune.ins().sendHuntRune(_this.huntType);else if(_this.type==2)Heirloom.ins().sendHunt(_this.huntType);else if(_this.type==3)Activity.ins().sendReward(_this.activityID,_this.huntType==0?1:2);else if(_this.type==4)ShapeShiftingTreasure.ins().sendHunt(_this.huntType);else if(_this.type==5)TicketLingShiTreasure.ins().sendHunt(_this.huntType)};this.playGet(func);this.canClicck=false}else{var times=this.huntType?10:1;var consumeName=this.type==5?i18n("HuntResultWin_2"):i18n("HuntResultWin_3");HuntWarnBuyWin.showBuyWarn(this.getPanelNameByType(this.type)+"-HuntResultWin"+this.huntType,this.huntWarnFun.bind(this),i18n("HuntResultWin_4",this.yb)+consumeName+i18n("HuntResultWin_5",itemId>0?GlobalConfig.ItemConfig[itemId].name:"",times))}};HuntResultWin.prototype.getPanelNameByType=function(type){if(this.type==3)return"OSATarget18Panel1";else if(this.type==5)return"TicketLingShiTreasureWin";else if(this.type==4)return"TreasureShapeShiftingPanel";else if(this.type==2)return"TreasureChuanshiPanel";else if(this.type==1)return"TreasureRunePanel";else return"TreasureHuntPanel"};HuntResultWin.prototype.huntWarnFun=function(){var _this=this;if(this.type==5){if(TicketSys.ins().curLingShi>=this.yb){TicketLingShiTreasure.ins().sendHunt(this.huntType)}else{if(this.type==5){var warnWin=WarnWin.show(i18n("HuntResultWin_6"),function(){ViewManager.ins().open(XianMenJoinWin)},this,null,null,"sure");warnWin.setBtnLabel(i18n("HuntResultWin_7"))}}return}if(Actor.yb>=this.yb){var func=function(){if(_this.type==0)Hunt.ins().sendHunt(_this.huntType);else if(_this.type==1)Rune.ins().sendHuntRune(_this.huntType);else if(_this.type==2)Heirloom.ins().sendHunt(_this.huntType);else if(_this.type==3)Activity.ins().sendReward(_this.activityID,_this.huntType==0?1:2);else if(_this.type==4)ShapeShiftingTreasure.ins().sendHunt(_this.huntType)};this.playGet(func);this.canClicck=false}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("HuntResultWin_8"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("HuntResultWin_9"))}};return HuntResultWin}(BaseEuiView);__reflect(HuntResultWin.prototype,"HuntResultWin");ViewManager.ins().reg(HuntResultWin,LayerManager.UI_Main);var HuntWarnBuyWin=function(_super){__extends(HuntWarnBuyWin,_super);function HuntWarnBuyWin(){var _this=_super.call(this)||this;_this.skinName="WarnBuySkin";_this.isTopLevel=true;return _this}HuntWarnBuyWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.panel=args[0];this.callback=args[1];this.des=args[2];this.addTouchEndEvent(this,this.onTouch);this.update()};HuntWarnBuyWin.prototype.close=function(){this.panel=null;this.callback=null;this.removeTouchEvent(this,this.onTouch)};HuntWarnBuyWin.showBuyWarn=function(panel,callback,des){if(HuntWarnBuyWin.loginRecords[panel]==true){callback&&callback()}else{ViewManager.ins().open(HuntWarnBuyWin,panel,callback,des)}};HuntWarnBuyWin.prototype.update=function(){this.tipsCheckbox.selected=false;this.desTxt.textFlow=TextFlowMaker.generateTextFlow(this.des)};HuntWarnBuyWin.prototype.onTouch=function(e){switch(e.target){case this.noBtn:case this.BG:ViewManager.ins().close(this);break;case this.yesBtn:HuntWarnBuyWin.loginRecords[this.panel]=this.tipsCheckbox.selected;this.callback&&this.callback();ViewManager.ins().close(this);break}};HuntWarnBuyWin.loginRecords={};return HuntWarnBuyWin}(BaseEuiView);__reflect(HuntWarnBuyWin.prototype,"HuntWarnBuyWin");ViewManager.ins().reg(HuntWarnBuyWin,LayerManager.UI_Main);var LegendEquipPanel=function(_super){__extends(LegendEquipPanel,_super);function LegendEquipPanel(){var _this=_super.call(this)||this;_this._roleId=0;return _this}LegendEquipPanel.prototype.childrenCreated=function(){this.init()};LegendEquipPanel.prototype.init=function(){this.curIndex=0;this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getTreasureBtn.text+"</u></a>");this.getTreasureBtn.touchEnabled=true;this.legendMc=new MovieClip;this.legendMc1=new MovieClip;this.legendMc2=new MovieClip;this.chargeEff1=new MovieClip;this.chargeEff1.x=this.getTreasureBtn.x+this.getTreasureBtn.width/2;this.chargeEff1.y=this.getTreasureBtn.y+this.getTreasureBtn.height/2;this.chargeEff1.touchEnabled=false;this.chargeEff1.scaleY=.7;this.chargeEff1.scaleX=.9;this._weaponEffect=new MovieClip;this._bodyEffect=new MovieClip;this.zhanshiMc=new MovieClip;this.zhanshiMcGroup.addChild(this.zhanshiMc)};LegendEquipPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.legendMc.playFile(RES_DIR_EFF+"artifacteff",-1);this.addChild(this.legendMc);this.legendMc1.playFile(RES_DIR_EFF+"chuanqizbeff",-1);this.legendMc1.x=this.legend1.x+this.legend1.width/2;this.legendMc1.y=this.legend1.y+this.legend1.height/2;this.legendMc1.scaleX=this.legendMc1.scaleY=1.4;this.addChild(this.legendMc1);this.legendMc2.playFile(RES_DIR_EFF+"chuanqizbeff",-1);this.legendMc2.x=this.legend2.x+this.legend2.width/2;this.legendMc2.y=this.legend2.y+this.legend2.height/2;this.legendMc2.scaleX=this.legendMc2.scaleY=1.4;this.addChild(this.legendMc2);this.getTreasureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this);this.addTouchEvent(this.mixSwordBtn,this.onSelect);this.addTouchEvent(this.mixArmorBtn,this.onSelect);this.addTouchEvent(this.armorIcon,this.onSelect);this.addTouchEvent(this.swordIcon,this.onSelect);this.addTouchEvent(this.executeBtn,this.executeCB);this.observe(UserEquip.ins().postMixGodEquip,this.mixCB);this.observe(UserBag.ins().postItemAdd,this.updateView);this.observe(UserBag.ins().postItemDel,this.updateView);this.observe(UserBag.ins().postItemChange,this.updateView);this.observe(GameLogic.ins().postSubRoleChange,this.updateSubRoleChange);TimerManager.ins().doTimer(2e3,0,this.mcChange,this);this.updateView()};LegendEquipPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.getTreasureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this);this.removeTouchEvent(this.mixSwordBtn,this.onSelect);this.removeTouchEvent(this.mixArmorBtn,this.onSelect);this.removeTouchEvent(this.armorIcon,this.onSelect);this.removeTouchEvent(this.swordIcon,this.onSelect);this.removeTouchEvent(this.executeBtn,this.executeCB);TimerManager.ins().remove(this.mcChange,this);this.removeObserve();DisplayUtils.removeFromParent(this.legendMc);DisplayUtils.removeFromParent(this.legendMc1);DisplayUtils.removeFromParent(this.legendMc2);DisplayUtils.removeFromParent(this._weaponEffect);DisplayUtils.removeFromParent(this._bodyEffect);DisplayUtils.removeFromParent(this.zhanshiMc)};LegendEquipPanel.prototype.mcChange=function(){egret.Tween.removeTweens(this.bgMc);var tween=egret.Tween.get(this.bgMc);tween.to({alpha:0},1e3).to({alpha:1},1e3)};LegendEquipPanel.prototype.executeCB=function(e){var c_mix=i18n("OrangeEquipPanel_1");if(parseInt(this.cur.text)<parseInt(this.need.text.substr(1))){UserTips.ins().showTips(i18n("LegendEquipPanel_0"));return}if(this.executeBtn.label==i18n("OrangeEquipPanel_0")){this.grewup()}else if(this.executeBtn.label==c_mix){if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin)}else{this.mix()}}};LegendEquipPanel.prototype.grewup=function(){var nextEquipConfig=GlobalConfig.ItemConfig[this.curEquipConfigId+1];if(nextEquipConfig.level>Actor.level||nextEquipConfig.zsLevel>UserZs.ins().lv){UserTips.ins().showTips(i18n("LegendEquipPanel_1"));return}UserEquip.ins().sendGrewupEquip(this._roleId,this.curIndex,0)};LegendEquipPanel.prototype.grewupCB=function(roleId,result,configID){if(result==0){UserTips.ins().showTips(i18n("LegendEquipPanel_2"));return}UserTips.ins().showTips(i18n("LegendEquipPanel_3"));this.updateView()};LegendEquipPanel.prototype.mix=function(){var id=UserEquip.ins().getEquipConfigIDByPosAndQualityByLegend(this._roleId,this.curIndex,5);var config=GlobalConfig.ItemConfig[id];if(config.level<=Actor.level&&config.zsLevel<=UserZs.ins().lv){UserEquip.ins().sendMixEquip(this._roleId,this.curEquipConfigId,this.curIndex)}else{UserTips.ins().showTips(i18n("LegendEquipPanel_4"))}};LegendEquipPanel.prototype.mixCB=function(roleId,result,configID){if(result==0){UserTips.ins().showTips(i18n("LegendEquipPanel_5"));return}UserTips.ins().showTips(i18n("LegendEquipPanel_6"));this.updateView()};LegendEquipPanel.prototype.openSmeltView=function(e){ViewManager.ins().open(BreakDownView,BreakDownView.type_legend,5)};LegendEquipPanel.prototype.onSelect=function(e){var level=Actor.level;switch(e.currentTarget){case this.mixSwordBtn:case this.swordIcon:this.curIndex=0;break;case this.mixArmorBtn:case this.armorIcon:this.curIndex=2;break}this.updateView()};LegendEquipPanel.prototype.setRoleId=function(id){this._roleId=id;var role=SubRoles.ins().getSubRoleByIndex(this._roleId);var equipData0=role.getEquipByIndex(0);var equipData2=role.getEquipByIndex(2);if(equipData0&&this.checkQuality(equipData0)){this.curIndex=0}else if(equipData2&&this.checkQuality(equipData2)){this.curIndex=2}this.updateView()};LegendEquipPanel.prototype.updateView=function(){this.updateAttrPanel();this.updateIconAndDesc();var red=this.setRedPoint();if(red){this.setEff()}};LegendEquipPanel.prototype.setEff=function(){var itemData=UserBag.ins().getLegendOutEquips();if(!itemData.length){DisplayUtils.removeFromParent(this.chargeEff1)}else{this.chargeEff1.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.chargeEff1.parent)this.getTreasureBtn.parent.addChild(this.chargeEff1)}};LegendEquipPanel.prototype.updateSubRoleChange=function(){var red=this.setRedPoint();if(red){this.setEff()}};LegendEquipPanel.prototype.checkQuality=function(data){var rtn=false;if(data&&data.item&&data.item.itemConfig){rtn=ItemConfig.getQuality(data.item.itemConfig)==5}return rtn};LegendEquipPanel.prototype.updateAttrPanel=function(){var equipData=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex);var nextEquipData=GlobalConfig.ItemConfig[equipData.item.configID+1];var needNum=0;var costID=0;var c_mix=i18n("OrangeEquipPanel_1");var q=ItemConfig.getQuality(equipData.item.itemConfig);if(nextEquipData==undefined&&equipData.item.handle!=0&&q==5){this.mixAttributes.visible=true;this.grewupAttributes.visible=false;this.curEquipConfigId=this.updateMixPanel();this.topLevel.visible=true;this.costGroup.visible=false;this.executeBtn.visible=false;this.redPoint.visible=false;this.need.text="";this.cur.text=""}else{if(nextEquipData!=undefined&&equipData.item.handle!=0&&q==5){this.mixAttributes.visible=false;this.grewupAttributes.visible=true;this.curEquipConfigId=this.updateGrewupPanel();this.executeBtn.label=i18n("OrangeEquipPanel_0");var grewupConfig=GlobalConfig.LegendLevelupConfig[this.curEquipConfigId];needNum=grewupConfig.count;costID=grewupConfig.itemId}else{this.mixAttributes.visible=true;this.grewupAttributes.visible=false;this.curEquipConfigId=this.updateMixPanel();if(this.curEquipConfigId==null)return;this.executeBtn.label=c_mix;var mixConfig=GlobalConfig.LegendComposeConfig[this.curEquipConfigId];needNum=mixConfig.count;costID=mixConfig.itemId}this.executeBtn.visible=true;this.topLevel.visible=false;this.costGroup.visible=true;var curNum=UserBag.ins().getBagGoodsCountById(0,costID);this.need.text="/"+needNum;this.cur.text=curNum+"";if(curNum>=needNum){this.cur.textColor=ColorUtil.GREEN_COLOR_N;this.redPoint.visible=true}else{this.cur.textColor=ColorUtil.RED_COLOR_N;this.redPoint.visible=false}}};LegendEquipPanel.prototype.updateMixPanel=function(){var level=Actor.level;if(level<10){debug.log(i18n("LegendEquipPanel_7"));return}var configID=UserEquip.ins().getEquipConfigIDByPosAndQualityByLegend(this._roleId,this.curIndex,5);var config=GlobalConfig.EquipConfig[configID];if(!config)return;var nameList=[];var baseAttrList=[];var randAttrList=[];for(var k in AttributeData.translate){if(!config[k]||config[k]<=0)continue;baseAttrList.push(config[k]+"");nameList.push(AttributeData.getAttrStrByType(AttributeData.translate[k]))}this.mixAttributes["baseAttr"].text=ItemData.getStringByNextList(baseAttrList,randAttrList);this.mixAttributes["nameAttr"].text=ItemData.getStringByList(nameList);this.mixAttributes["randAttr"].text="";this.mixAttributes["score"].text=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[configID]);return configID};LegendEquipPanel.prototype.updateGrewupPanel=function(){var equipData=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex);var configID=equipData.item.configID;var curItemData=GlobalConfig.ItemConfig[configID];var nextItemData=GlobalConfig.ItemConfig[configID+1];if(nextItemData==undefined){}else{for(var i=1;i<=4;i++){this.grewupAttributes["arrow"+i].visible=false}var nameList=[];var baseAttrList=[];var randAttrList=[];var nextBaseAttrList=[];var nextRandAttrList=[];var curEquipData=GlobalConfig.EquipConfig[configID];var nextEquipData=GlobalConfig.EquipConfig[configID+1];var data=equipData.item;var ii=1;for(var k in AttributeData.translate){if(!curEquipData[k]||curEquipData[k]<=0)continue;if(data!=undefined){var attr=data.att;for(var index=0;index<attr.length;index++){if(attr[index].type==AttributeData.translate[k]){break}}}this.grewupAttributes["arrow"+ii].visible=true;ii++;baseAttrList.push(curEquipData[k]+"");nextBaseAttrList.push(nextEquipData[k]+"");nameList.push(AttributeData.getAttrStrByType(AttributeData.translate[k]))}this.grewupAttributes["curBaseAttr"].text=ItemData.getStringByNextList(baseAttrList,randAttrList);this.grewupAttributes["nextBaseAttr"].text=ItemData.getStringByNextList(nextBaseAttrList,nextRandAttrList);this.grewupAttributes["nameAttr"].text=ItemData.getStringByList(nameList);this.grewupAttributes["curScore"].text=i18n("LegendEquipPanel_8")+ItemConfig.pointCalNumber(curItemData);this.grewupAttributes["nextScore"].text=i18n("LegendEquipPanel_9")+ItemConfig.pointCalNumber(nextItemData)}return configID};LegendEquipPanel.prototype.updateIconAndDesc=function(){var role=SubRoles.ins().getSubRoleByIndex(this._roleId);var equipData0=role.getEquipByIndex(0);var equipData2=role.getEquipByIndex(2);if(this.curIndex==0){this.swordSelect.visible=true;this.armorSelect.visible=false;this.currentState="jian";this.setWeaponEffect(equipData0.item.configID,"wPos",role.sex,this.weaponEffect,this._weaponEffect);this._bodyEffect.parent&&this._bodyEffect.parent.removeChild(this._bodyEffect);this.zhanshiMc.parent&&this.zhanshiMc.parent.removeChild(this.zhanshiMc)}else{this.swordSelect.visible=false;this.armorSelect.visible=true;if(!this.zhanshiMc.parent){this.zhanshiMcGroup.addChild(this.zhanshiMc)}this.zhanshiMc.playFile(RES_DIR_EFF+"chuanqi_1",-1);this.currentState="jia";this.setWeaponEffect(equipData2.item.configID,"bPos",role.sex,this.bodyEffect,this._bodyEffect,2);this._weaponEffect.parent&&this._weaponEffect.parent.removeChild(this._weaponEffect)}this.updateItem(equipData0,this.swordIcon,this.swordLevel,this.mixSwordBtn,0);this.updateItem(equipData2,this.armorIcon,this.armorLevel,this.mixArmorBtn,2)};LegendEquipPanel.prototype.updateItem=function(equipData,icon,levelLabel,mixBtn,pos){var zhuan=GlobalConfig.ItemConfig[UserEquip.ins().getEquipConfigIDByPosAndQualityByLegend(this._roleId,pos,5)].zsLevel;if(equipData.item.handle!=0&&ItemConfig.getQuality(equipData.item.itemConfig)==5){var itemConfig=GlobalConfig.ItemConfig[equipData.item.configID];mixBtn.visible=false;levelLabel.text=itemConfig.zsLevel+i18n("LegendEquipPanel_10");var nextItem=void 0;for(var i=this.curEquipConfigId;i%100!=99;i++){nextItem=GlobalConfig.ItemConfig[this.curEquipConfigId+1];if(nextItem!=undefined){break}}if(pos==ItemConfig.getSubType(equipData.item.itemConfig)&&nextItem!=undefined){levelLabel.x=mixBtn.x+15-levelLabel.width/2}else{levelLabel.x=mixBtn.x+15}}else{mixBtn.visible=false;levelLabel.text=zhuan+i18n("LegendEquipPanel_11");levelLabel.x=mixBtn.x+15}};LegendEquipPanel.prototype.setRedPoint=function(){var showRed=false;var boo=false;for(var i=0;i<2;i++){boo=UserEquip.ins().setLegendEquipItemUpState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(this._roleId));boo=UserEquip.ins().setLegendEquipItemState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(this._roleId))||boo;if(this["redPoint"+i])this["redPoint"+i].visible=boo;if(!showRed)showRed=boo;if(!showRed){var itemData=UserBag.ins().getLegendOutEquips();showRed=itemData.length>0}}return showRed};LegendEquipPanel.prototype.setWeaponEffect=function(id,posStr,sex,group,suitEff,pos){if(pos===void 0){pos=0}var cfg=GlobalConfig.EquipWithEffConfig[id+"_"+sex];var showFirst=false;if(!cfg){cfg=GlobalConfig.EquipWithEffConfig[(pos==0?LegendEquipPanel.swrodImg[0]:LegendEquipPanel.armorImg[0])+"_"+sex];showFirst=true}suitEff.scaleX=suitEff.scaleY=cfg.scaling;suitEff.x=this[posStr+sex].x;suitEff.y=this[posStr+sex].y;if(!suitEff.parent)group.addChild(suitEff);suitEff.playFile(RES_DIR_EFF+(showFirst?cfg.inShowEff:cfg.nextShowEff),-1)};LegendEquipPanel.swrodImg=["101501"];LegendEquipPanel.armorImg=["121501"];return LegendEquipPanel}(BaseView);__reflect(LegendEquipPanel.prototype,"LegendEquipPanel");var OrangeEquipPanel=function(_super){__extends(OrangeEquipPanel,_super);function OrangeEquipPanel(){var _this=_super.call(this)||this;_this._roleId=0;_this.posItem=[null,null,null,null,null,null,null,null];_this.name=i18n("OrangeEquipPanel_3");return _this}OrangeEquipPanel.prototype.childrenCreated=function(){this.init()};OrangeEquipPanel.prototype.init=function(){this.curIndex=0;this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getTreasureBtn.text+"</u></a>");this.getTreasureBtn.touchEnabled=true;this.chargeEff1=new MovieClip;this.chargeEff1.x=this.getTreasureBtn.x+this.getTreasureBtn.width/2;this.chargeEff1.y=this.getTreasureBtn.y+this.getTreasureBtn.height/2;this.chargeEff1.touchEnabled=false;this.chargeEff1.scaleY=.7;this.chargeEff1.scaleX=.9};OrangeEquipPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.getTreasureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this);for(var i=0;i<8;i++){var equipItem=this["equip"+i];this.addTouchEvent(equipItem,this.onSelect);this.addTouchEvent(equipItem.mixBtn,this.onSelect)}this.addTouchEvent(this.executeBtn,this.executeCB);this.observe(UserEquip.ins().postMixEquip,this.mixCB);this.observe(UserBag.ins().postItemAdd,this.updateView);this.observe(UserBag.ins().postItemDel,this.updateView);this.observe(UserBag.ins().postItemChange,this.updateView);this.observe(UserEquip.ins().postEquipChange,this.updateView);this.curIndex=this.computerCurIndex();this.updateView();this.effArr=[]};OrangeEquipPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.getTreasureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this);for(var i=0;i<8;i++){var equipItem=this["equip"+i];this.removeTouchEvent(equipItem,this.onSelect);this.removeTouchEvent(equipItem.mixBtn,this.onSelect)}DisplayUtils.removeFromParent(this.chargeEff1);this.removeTouchEvent(this.executeBtn,this.executeCB);this.removeObserve();this.cleanEff()};OrangeEquipPanel.prototype.onSelect=function(e){var level=Actor.level;switch(e.currentTarget){case this.equip0:case this.equip0["mixBtn"]:this.curIndex=0;break;case this.equip1:case this.equip1["mixBtn"]:this.curIndex=1;break;case this.equip2:case this.equip2["mixBtn"]:this.curIndex=2;break;case this.equip3:case this.equip3["mixBtn"]:this.curIndex=3;break;case this.equip4:case this.equip4["mixBtn"]:this.curIndex=4;break;case this.equip5:case this.equip5["mixBtn"]:this.curIndex=5;break;case this.equip6:case this.equip6["mixBtn"]:this.curIndex=6;break;case this.equip7:case this.equip7["mixBtn"]:this.curIndex=7;break}this.updateView()};OrangeEquipPanel.prototype.executeCB=function(e){var _this=this;var c_equip=i18n("OrangeEquipPanel_2");if(this.executeBtn.label==c_equip){UserEquip.ins().sendWearEquipment(this.posItem[this.curIndex]["handle"],this.curIndex,this._roleId)}if(parseInt(this.cur.text)<parseInt(this.need.text.substr(1))){UserTips.ins().showTips(i18n("OrangeEquipPanel_5"));return}var c_mix=i18n("OrangeEquipPanel_1");var c_grewup=i18n("OrangeEquipPanel_0");if(this.executeBtn.label==c_grewup){if(UserEquip.ins().posState[this.curIndex]==1){var self_18=this;UserEquip.ins().sendWearEquipment(this.posItem[this.curIndex]["handle"],this.curIndex,this._roleId);setTimeout(function(){self_18.grewup()},200)}else{this.grewup()}}else if(this.executeBtn.label==c_mix){var equipData=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex);var configID=equipData.item.configID;var curItemData=GlobalConfig.ItemConfig[configID];if(UserBag.ins().isBagFull()){ViewManager.ins().open(BagFullTipsWin)}else if(curItemData!=undefined&&ItemConfig.getQuality(curItemData)==5){var config=GlobalConfig.ItemConfig[equipData.item.configID];var str=config.zsLevel>0?config.zsLevel+i18n("OrangeEquipPanel_6"):config.level+i18n("OrangeEquipPanel_7");var color=14502316;WarnWin.show(i18n("OrangeEquipPanel_8",color.toString(16),str),function(){_this.mix()},this)}else{this.mix()}}};OrangeEquipPanel.prototype.grewup=function(){var nextEquipConfig=GlobalConfig.ItemConfig[this.curEquipConfigId+1];if(nextEquipConfig.level>Actor.level||nextEquipConfig.zsLevel>UserZs.ins().lv){UserTips.ins().showTips(i18n("OrangeEquipPanel_9"));return}UserEquip.ins().sendGrewupEquip(this._roleId,this.curIndex)};OrangeEquipPanel.prototype.grewupCB=function(roleId,result,configID){if(result==0){UserTips.ins().showTips(i18n("OrangeEquipPanel_10"));return}UserTips.ins().showTips(i18n("OrangeEquipPanel_11"));this.updateView()};OrangeEquipPanel.prototype.mix=function(){UserEquip.ins().sendMixEquip(this._roleId,this.curEquipConfigId,this.curIndex)};OrangeEquipPanel.prototype.mixCB=function(roleId,result,configID){if(result==0){UserTips.ins().showTips(i18n("OrangeEquipPanel_12"));return}UserTips.ins().showTips(i18n("OrangeEquipPanel_13"));this.updateView()};OrangeEquipPanel.prototype.openSmeltView=function(e){ViewManager.ins().open(BreakDownView,BreakDownView.type_legend,4)};OrangeEquipPanel.prototype.updateView=function(){this.updateAllEquipItem();this.updateDetailPanel();this.setItemRedPoint();if(!UserBag.ins().getLegendHasResolve()){this.chargeEff1.visible=false;DisplayUtils.removeFromParent(this.chargeEff1)}else{this.chargeEff1.visible=true;this.chargeEff1.playFile(RES_DIR_EFF+"chargeff1",-1);if(!this.chargeEff1.parent)this.btnGroup.addChild(this.chargeEff1)}};OrangeEquipPanel.prototype.updateDetailPanel=function(){var equipData=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex);if(equipData==null)return;var nextEquipData=GlobalConfig.ItemConfig[equipData.item.configID+1];var needNum=0;var costID=0;var c_grewup=i18n("OrangeEquipPanel_0");var c_mix=i18n("OrangeEquipPanel_1");var c_equip=i18n("OrangeEquipPanel_2");this.costNum.visible=true;var q=ItemConfig.getQuality(equipData.item.itemConfig);this.costNum.visible=true;if(UserEquip.ins().posState[this.curIndex]==1){nextEquipData=GlobalConfig.ItemConfig[this.posItem[this.curIndex]["_configID"]+1];if(nextEquipData!=undefined&&UserBag.fitleEquip.indexOf(this.posItem[this.curIndex]["_configID"])==-1){this.mixPanel.visible=false;this.grewupPanel.visible=true;this.curEquipConfigId=this.updateGrewupPanel(this.posItem[this.curIndex]["_configID"]);this.executeBtn.label=c_grewup;var grewupConfig=GlobalConfig.LegendLevelupConfig[this.curEquipConfigId];needNum=grewupConfig.count;costID=grewupConfig.itemId}var curNum=UserBag.ins().getBagGoodsCountById(0,costID);this.need.text="/"+needNum;this.cur.text=curNum+"";if(curNum>=needNum){this.cur.textColor=ColorUtil.GREEN_COLOR_N}else{this.cur.textColor=ColorUtil.RED_COLOR_N}this.executeBtn.visible=true;this.labelMax.visible=false}else if(UserEquip.ins().posState[this.curIndex]==2){this.mixPanel.visible=true;this.grewupPanel.visible=false;this.curEquipConfigId=this.updateMixPanel(this.posItem[this.curIndex]["_configID"]);this.executeBtn.label=c_equip;this.costNum.visible=false;this.executeBtn.visible=true;this.labelMax.visible=false}else if(nextEquipData==undefined&&equipData.item.handle!=0&&q==4){this.mixPanel.visible=true;this.labelMax.visible=true;this.grewupPanel.visible=false;this.curEquipConfigId=this.updateMixPanel();this.executeBtn.visible=false;this.need.text="";this.cur.text="";this.costNum.visible=false}else{if(nextEquipData!=undefined&&equipData.item.handle!=0&&q==4&&equipData.item.itemConfig.level!=1&&UserBag.fitleEquip.indexOf(equipData.item.configID)==-1){this.mixPanel.visible=false;this.grewupPanel.visible=true;this.curEquipConfigId=this.updateGrewupPanel();this.executeBtn.label=c_grewup;var grewupConfig=GlobalConfig.LegendLevelupConfig[this.curEquipConfigId];needNum=grewupConfig.count;costID=grewupConfig.itemId}else{this.mixPanel.visible=true;this.grewupPanel.visible=false;this.curEquipConfigId=this.updateMixPanel();this.executeBtn.label=c_mix;var mixConfig=GlobalConfig.LegendComposeConfig[this.curEquipConfigId];needNum=mixConfig.count;costID=mixConfig.itemId}var curNum=UserBag.ins().getBagGoodsCountById(0,costID);this.need.text="/"+needNum;this.cur.text=curNum+"";if(curNum>=needNum){this.cur.textColor=ColorUtil.GREEN_COLOR_N}else{this.cur.textColor=ColorUtil.RED_COLOR_N}this.executeBtn.visible=true;this.labelMax.visible=false}};OrangeEquipPanel.prototype.updateMixPanel=function(configID){if(configID===void 0){configID=0}var level=Actor.level;var itemData;if(level>=1){var pos=this.curIndex;var role=SubRoles.ins().getSubRoleByIndex(this._roleId);if(!configID){configID=UserEquip.ins().getEquipConfigIDByPosAndQualityByGod(role,pos,4,SubRoles.ins().getSubRoleByIndex(this._roleId).job)}itemData=GlobalConfig.ItemConfig[configID]}if(itemData!=undefined){if(itemData.zsLevel>0){this.mixPanel["level"].text=itemData.zsLevel+i18n("OrangeEquipPanel_14")}else{var level_1=i18n("Level_0");this.mixPanel["level"].text=itemData.level?""+itemData.level+level_1:"1"+level_1}this.mixPanel["equipName"].text=itemData.name;this.mixPanel["itemIcon"].imgJob.visible=false;this.mixPanel["itemIcon"].setData(itemData)}var nameList=[];var baseAttrList=[];var randAttrList=[];var config=GlobalConfig.EquipConfig[configID];for(var k in AttributeData.translate){if(!config[k]||config[k]<=0)continue;baseAttrList.push(config[k]+"");nameList.push(AttributeData.getAttrStrByType(AttributeData.translate[k]))}this.mixPanel["attributes"].baseAttr.text=ItemData.getStringByNextList(baseAttrList,randAttrList);this.mixPanel["attributes"].randAttr.text="";this.mixPanel["attributes"].nameAttr.text=ItemData.getStringByList(nameList);this.mixPanel["attributes"].score.text=ItemConfig.pointCalNumber(itemData);return configID};OrangeEquipPanel.prototype.updateGrewupPanel=function(configID){if(configID===void 0){configID=0}var equipData=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex);if(!configID){configID=equipData.item.configID}var curItemData=GlobalConfig.ItemConfig[configID];var nextItemData=GlobalConfig.ItemConfig[configID+1];if(nextItemData==undefined){}else{var level=i18n("Level_0");this.grewupPanel["curName"].text=curItemData.name+"";this.grewupPanel["nextName"].text=nextItemData.name+"";if(curItemData.zsLevel>0){this.grewupPanel["curLevel"].text=curItemData.zsLevel+i18n("OrangeEquipPanel_15")}else{this.grewupPanel["curLevel"].text=curItemData.level?""+curItemData.level+level:"1"+level}if(nextItemData.zsLevel>0){this.grewupPanel["nextLevel"].text=nextItemData.zsLevel+i18n("OrangeEquipPanel_16")}else{this.grewupPanel["nextLevel"].text=nextItemData.level?""+nextItemData.level+level:"1"+level}this.grewupPanel["curItemIcon"].imgJob.visible=false;this.grewupPanel["nextItemIcon"].imgJob.visible=false;this.grewupPanel["curItemIcon"].setData(curItemData);this.grewupPanel["nextItemIcon"].setData(nextItemData);for(var i=1;i<=4;i++){this.grewupPanel["attributes"]["arrow"+i].visible=false}var nameList=[];var baseAttrList=[];var randAttrList=[];var nextBaseAttrList=[];var nextRandAttrList=[];var curEquipData=GlobalConfig.EquipConfig[configID];var nextEquipData=GlobalConfig.EquipConfig[configID+1];var data=equipData.item;var ii=1;for(var k in AttributeData.translate){if(!curEquipData[k]||curEquipData[k]<=0)continue;if(data!=undefined){var attr=data.att;for(var index=0;index<attr.length;index++){if(attr[index].type==AttributeData.translate[k]){break}}}this.grewupPanel["attributes"]["arrow"+ii].visible=true;ii++;baseAttrList.push(curEquipData[k]+"");nextBaseAttrList.push(nextEquipData[k]+"");nameList.push(AttributeData.getAttrStrByType(AttributeData.translate[k]))}this.grewupPanel["attributes"].curBaseAttr.text=ItemData.getStringByNextList(baseAttrList,randAttrList);this.grewupPanel["attributes"].nextBaseAttr.text=ItemData.getStringByNextList(nextBaseAttrList,nextRandAttrList);this.grewupPanel["attributes"].nameAttr.text=ItemData.getStringByList(nameList);this.grewupPanel["attributes"].curScore.text=i18n("OrangeEquipPanel_17")+ItemConfig.pointCalNumber(curItemData);this.grewupPanel["attributes"].nextScore.text=i18n("OrangeEquipPanel_18")+ItemConfig.pointCalNumber(nextItemData)}return configID};OrangeEquipPanel.prototype.updateAllEquipItem=function(){for(var i=0;i<8;i++){this.updateEquipItem(i)}};OrangeEquipPanel.prototype.getItemsByPos=function(equipPos,quality,job,items){var arr=[];for(var i=0;i<items.length;i++){var item=items[i];if(Math.floor(item._configID/1e5)==1&&Math.floor(item._configID%1e5/1e4)==equipPos&&Math.floor(item._configID%1e4/1e3)==job&&Math.floor(item._configID%1e3/100)==quality){arr.push(item)}}return arr};OrangeEquipPanel.prototype.updateEquipItem=function(index){var equipItem=this["equip"+index];if(equipItem==null)return;var equipData=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(index);var itemIcon=equipItem.itemIcon;itemIcon.imgJob.visible=false;var curPower=equipData&&equipData.item&&equipData.item._configID?ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[equipData.item._configID]):0;if(UserBag.fitleEquip.indexOf(equipData.item.configID)!=-1||equipData.item.handle==0||ItemConfig.getQuality(equipData.item.itemConfig)<4||equipData.item.itemConfig.level==1&&!equipData.item.itemConfig.zsLevel){var myRedDressItems=UserBag.ins().getBagSortQualityEquips(4,1,0);var job=SubRoles.ins().getSubRoleByIndex(this._roleId).job;var myRedDressInPos=this.getItemsByPos(index,4,job,myRedDressItems);if(myRedDressInPos.length>0){var needUpgrade=true;var showIdx=-1;for(var i=0;i<myRedDressInPos.length;i++){var redDressItem=myRedDressInPos[i];var cCfg=GlobalConfig.ItemConfig[redDressItem._configID];var power=ItemConfig.pointCalNumber(cCfg);var canWear=false;var lv=Actor.level;var zsLv=UserZs.ins().lv;if(zsLv>=(cCfg.zsLevel||0)&&lv>=(cCfg.level||1)){canWear=true}if(power>curPower&&canWear){needUpgrade=false;showIdx=i;break}}if(needUpgrade){for(var i=myRedDressInPos.length-1;i>-1;i--){var redDressItem=myRedDressInPos[i];var cCfg=GlobalConfig.ItemConfig[redDressItem._configID+1];var canWear=false;var lv=Actor.level;var zsLv=UserZs.ins().lv;if(cCfg&&zsLv>=(cCfg.zsLevel||0)&&lv>=(cCfg.level||1)){canWear=true;showIdx=i;break}}}if(showIdx>=0){var targetItem=myRedDressInPos[showIdx];if(targetItem.itemConfig.zsLevel>0){equipItem.level.text=targetItem.itemConfig.zsLevel+i18n("OrangeEquipPanel_19")}else{var level=i18n("Level_0");equipItem.level.text=targetItem.itemConfig.level?""+targetItem.itemConfig.level+level:"1"+level}itemIcon.setData(targetItem.itemConfig);equipItem.upGrade.visible=true;if(needUpgrade){equipItem.tips.text=i18n("OrangeEquipPanel_20");UserEquip.ins().posState[index]=1;var curNum=0;var nextEquipData=GlobalConfig.ItemConfig[targetItem.itemConfig.id+1];if(nextEquipData!=undefined){var grewupConfig=GlobalConfig.LegendLevelupConfig[targetItem.itemConfig.id];var needNum=grewupConfig.count;var costID=grewupConfig.itemId;curNum=UserBag.ins().getBagGoodsCountById(0,costID)}if(curNum>=needNum){equipItem.tips.text=i18n("OrangeEquipPanel_21")}else{equipItem.tips.text=i18n("OrangeEquipPanel_22")}}else{equipItem.tips.text=i18n("OrangeEquipPanel_23");UserEquip.ins().posState[index]=2}this.posItem[index]=targetItem}else{UserEquip.ins().posState[index]=0;equipItem.upGrade.visible=false;itemIcon.setData(null);itemIcon.imgIcon.source=OrangeEquipPanel.defaultEquipIcon[index];equipItem.level.text="";equipItem.mixBtn.visible=false;this.cleanEffOnly(index);this.posItem[index]=null}}else{UserEquip.ins().posState[index]=0;equipItem.upGrade.visible=false;itemIcon.setData(null);itemIcon.imgIcon.source=OrangeEquipPanel.defaultEquipIcon[index];equipItem.level.text="";equipItem.mixBtn.visible=false;this.cleanEffOnly(index);this.posItem[index]=null}}else{UserEquip.ins().posState[index]=3;equipItem.upGrade.visible=false;equipItem.mixBtn.visible=false;if(equipData.item.itemConfig.zsLevel>0){equipItem.level.text=equipData.item.itemConfig.zsLevel+i18n("OrangeEquipPanel_24")}else{var level=i18n("Level_0");equipItem.level.text=equipData.item.itemConfig.level?""+equipData.item.itemConfig.level+level:"1"+level}itemIcon.setData(equipData.item.itemConfig);this.playEff(index);UserEquip.ins().posState[index]=equipData.item._configID}if(this.curIndex==index){equipItem.select.visible=true}else{equipItem.select.visible=false}};OrangeEquipPanel.prototype.playEff=function(index){if(index<0||index>7)return;var i=index;if(!this["effArr"+i]){this["effArr"+i]=new MovieClip;this["effArr"+i].x+=this["equip"+i].width/2;this["effArr"+i].y+=this["equip"+i].height/2-15;this["equip"+i].addChild(this["effArr"+i]);this["effArr"+i].playFile(RES_DIR_EFF+"quality_05",-1)}};OrangeEquipPanel.prototype.cleanEffOnly=function(index){if(index<0||index>7)return;var i=index;if(this["effArr"+i]){DisplayUtils.removeFromParent(this["effArr"+i]);this["effArr"+i]=null}};OrangeEquipPanel.prototype.cleanEff=function(){for(var i=0;i<8;i++){if(!this["effArr"+i])continue;DisplayUtils.removeFromParent(this["effArr"+i]);this["effArr"+i]=null}};OrangeEquipPanel.prototype.setItemRedPoint=function(){for(var i=0;i<8;i++){var equipItem=this["equip"+i];var role=SubRoles.ins().getSubRoleByIndex(this._roleId);equipItem["redPoint"].visible=UserEquip.ins().setOrangeEquipItemState(i,role);if(equipItem["redPoint"].visible){var b=UserBag.ins().checkEqRedPoint(i,role,true);equipItem["redPoint"].visible=b!=null?b:equipItem["redPoint"].visible}if(UserEquip.ins().posState[i]==2){equipItem["redPoint"].visible=true}}};OrangeEquipPanel.prototype.computerCurIndex=function(){return 0};OrangeEquipPanel.prototype.setRoleId=function(id){this._roleId=id;this.updateView()};OrangeEquipPanel.defaultEquipIcon=["xb_10","xb_11","xb_12","xb_13","xb_14","xb_15","xb_16","xb_17"];return OrangeEquipPanel}(BaseView);__reflect(OrangeEquipPanel.prototype,"OrangeEquipPanel");var RuneExchangeShopWin=function(_super){__extends(RuneExchangeShopWin,_super);function RuneExchangeShopWin(){var _this=_super.call(this)||this;_this.curSelectIndex=0;_this.skinName="RuneExchangeShop";_this.isTopLevel=true;return _this}RuneExchangeShopWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.panelArr=[this.runeShop];this.viewStack.selectedIndex=0;this.tab.dataProvider=this.viewStack};RuneExchangeShopWin.prototype.destoryView=function(){_super.prototype.destoryView.call(this)};RuneExchangeShopWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.menulist1,this.onClick);this.addTouchEvent(this.tab,this.onTabTouch);this.runeShop.curRole=0;this.setSelectedIndex(0)};RuneExchangeShopWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.menulist1,this.onClick);this.tab.removeEventListener(egret.Event.CHANGE,this.onTabTouch,this);this.removeObserve();this.panelArr[this.curSelectIndex].close()};RuneExchangeShopWin.prototype.onTabTouch=function(e){this.setOpenIndex(this.tab.selectedIndex)};RuneExchangeShopWin.prototype.setOpenIndex=function(selectedIndex){switch(selectedIndex){case 0:this.runeShop.open();break}};RuneExchangeShopWin.prototype.onClick=function(e){};RuneExchangeShopWin.prototype.setSelectedIndex=function(selectedIndex){this.curSelectIndex=selectedIndex;this.panelArr[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex};return RuneExchangeShopWin}(BaseEuiView);__reflect(RuneExchangeShopWin.prototype,"RuneExchangeShopWin");ViewManager.ins().reg(RuneExchangeShopWin,LayerManager.UI_Main);var ShapeShiftingRecordItemRenderer=function(_super){__extends(ShapeShiftingRecordItemRenderer,_super);function ShapeShiftingRecordItemRenderer(){var _this=_super.call(this)||this;_this.skinName="ShapeShiftingRecordItem";return _this}ShapeShiftingRecordItemRenderer.prototype.dataChanged=function(){var itemId=this.data;var shapeId=ShapeShiftingMgr.ins().isBianshenProp(itemId);var info=ShapeShiftingMgr.ins().myShapeShiftingInfo;var stage=info[shapeId]["stage"]||-1;var plevel=info[shapeId]["plevel"]||0;var needCount=GlobalConfig.ShapeShiftingPropConfig[shapeId][plevel].needCount||0;var isHave=UserBag.ins().getBagGoodsCountById(0,itemId);var cfg=GlobalConfig.ItemConfig[itemId];var nameColor=ItemConfig.getQualityColor(cfg);var green=5893404;var red=15937822;var name=cfg.name;var str=i18n("ShapeShiftingRecordItemRenderer_4",nameColor,name);if(stage<1){str+=i18n("ShapeShiftingRecordItemRenderer_0",5375653)}else if(isHave>=needCount){str+=i18n("ShapeShiftingRecordItemRenderer_1",5375653)}else{var need=needCount-isHave;str+=i18n("ShapeShiftingRecordItemRenderer_2",16777215)+i18n("ShapeShiftingRecordItemRenderer_5",red,need)+i18n("ShapeShiftingRecordItemRenderer_3",16777215)}this.info.textFlow=TextFlowMaker.generateTextFlow(str)};return ShapeShiftingRecordItemRenderer}(BaseItemRender);__reflect(ShapeShiftingRecordItemRenderer.prototype,"ShapeShiftingRecordItemRenderer");var TreasureChuanshiGiftWin=function(_super){__extends(TreasureChuanshiGiftWin,_super);function TreasureChuanshiGiftWin(){var _this=_super.call(this)||this;_this.lastSelected=-1;_this.maxNum=0;_this.skinName="TreasureChuanshiGift";return _this}TreasureChuanshiGiftWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.type=args[0];this.id=args[1];this.num=args[2];this.addTouchEvent(this,this.onTouch);this.observe(UserBag.ins().postGiftResult,this.otherClose);this.addTouchEndEvent(this.minBtn0,this.onTap);this.addTouchEndEvent(this.maxBtn0,this.onTap);this.addTouchEndEvent(this.sub1Btn0,this.onTap);this.addTouchEndEvent(this.add1Btn0,this.onTap);this.addChangeEvent(this.numLabel0,this.onTxtChange);this.numLabel0.restrict="0-9";this.numLabel0.text="0";this.add.touchEnabled=false;this.add.touchChildren=false;this.update()};TreasureChuanshiGiftWin.prototype.update=function(){var config=GlobalConfig.OptionalGiftConfig[this.id];this.gift.itemRenderer=TreasureChuanshiItemRender;if(config.show[0]["reward"].length<=4){this.currentState="special"}else{this.currentState="normal"}this.validateNow();this.gift.dataProvider=new eui.ArrayCollection(config.show[0]["reward"]);this.gift.validateNow();this.choose.textFlow=TextFlowMaker.generateTextFlow1(config.show[0]["str"]);this.maxNum=this.num;this.useNum=0};TreasureChuanshiGiftWin.prototype.close=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTouch);this.lastSelected=-1};TreasureChuanshiGiftWin.prototype.onTouch=function(e){if(e.target==this.get){if(this.gift.selectedIndex<0){UserTips.ins().showTips(i18n("TreasureChuanshiGiftWin_0"));return}if(!this.useNum){UserTips.ins().showTips(i18n("TreasureChuanshiGiftWin_1"));return}UserBag.ins().sendChoosableGift(this.id,this.useNum,this.gift.selectedIndex)}else if(e.target.parent==this.gift){if(this.lastSelected>=0)this.gift.getChildAt(this.lastSelected).checkSelcted(this.gift.selectedIndex);this.lastSelected=this.gift.selectedIndex;if(this.gift.dataProvider&&this.lastSelected>-1&&this.lastSelected<this.gift.dataProvider.length){this.gift.getChildAt(this.lastSelected).checkSelcted(this.gift.selectedIndex)}this.add.touchChildren=true;this.useNum=1;this.numLabel0.text=this.useNum+""}else if(e.target==this.bgClose||e.target==this.closeBtn)this.otherClose()};TreasureChuanshiGiftWin.prototype.otherClose=function(){ViewManager.ins().close(this)};TreasureChuanshiGiftWin.prototype.onTap=function(e){switch(e.target){case this.minBtn0:this.useNum=1;break;case this.maxBtn0:this.useNum=this.maxNum;break;case this.sub1Btn0:this.useNum--;if(this.useNum<=0){this.useNum=1}break;case this.add1Btn0:this.useNum++;if(this.useNum>this.maxNum){this.useNum=this.maxNum}break}this.numLabel0.text=this.useNum+""};TreasureChuanshiGiftWin.prototype.onTxtChange=function(e){var num=Number(this.numLabel0.text);if(num>this.maxNum){num=this.maxNum}else if(num<=0){num=1}this.useNum=num;this.numLabel0.text=this.useNum+""};return TreasureChuanshiGiftWin}(BaseEuiView);__reflect(TreasureChuanshiGiftWin.prototype,"TreasureChuanshiGiftWin");ViewManager.ins().reg(TreasureChuanshiGiftWin,LayerManager.UI_Popup);var TreasureChuanshiItemRender=function(_super){__extends(TreasureChuanshiItemRender,_super);function TreasureChuanshiItemRender(){var _this=_super.call(this)||this;_this.skinName="TreasureChuanshiItem";_this.touchChildren=false;_this.touchEnabled=true;return _this}TreasureChuanshiItemRender.prototype.dataChanged=function(){this.gift.data=this.data;this.select.visible=this.select2.visible=false};TreasureChuanshiItemRender.prototype.checkSelcted=function(index){this.select.visible=this.select2.visible=this.itemIndex==index;if(this.itemIndex==index)this.gift.onClick()};return TreasureChuanshiItemRender}(BaseItemRender);__reflect(TreasureChuanshiItemRender.prototype,"TreasureChuanshiItemRender");var TreasureChuanshiPanel=function(_super){__extends(TreasureChuanshiPanel,_super);function TreasureChuanshiPanel(){var _this=_super.call(this)||this;_this.addBoxEvent=false;_this.huntType=0;_this.mcSmallItemEffs=[null,null,null,null,null,null,null,null,null,null,null];_this.playBoxAniIdx=-1;_this.name=i18n("TreasureChuanshiPanel_0");return _this}TreasureChuanshiPanel.prototype.childrenCreated=function(){this.init()};TreasureChuanshiPanel.prototype.init=function(){var len=GlobalConfig.HeirloomTreasureConfig.boxes.length;var gift;var qualityBgNames={0:"",1:"",2:"treasurehuntitembg6",3:"treasurehuntitembg5",4:"treasurehuntitembg4",5:"treasurehuntitembg3"};for(var i=0;i<len;i++){gift=this["gift"+i];gift.data=GlobalConfig.HeirloomTreasureConfig.boxes[i];var itemConfig=GlobalConfig.ItemConfig[GlobalConfig.HeirloomTreasureConfig.boxes[i].id];var itemBgName=qualityBgNames[ItemConfig.getQuality(itemConfig)];var itembg=new eui.Image(itemBgName);itembg.horizontalCenter=0;itembg.y=-20;itembg.scaleX=itembg.scaleY=1.2;if(i!=11)gift.addChildAt(itembg,0)}this.eff=new MovieClip;this.eff.x=59;this.eff.y=23;this.eff.scaleX=.8;this.eff.scaleY=.8;this.eff.touchEnabled=false;this.list.itemRenderer=HuntListRenderer;this.zb1.text=GlobalConfig.HeirloomTreasureConfig.huntOnce+"";this.zb10.text=GlobalConfig.HeirloomTreasureConfig.huntTenth+"";this.btnGroup.visible=false;var btnBuys=[this.buy1,this.buy10];for(var _i=0,btnBuys_1=btnBuys;_i<btnBuys_1.length;_i++){var btnBuy=btnBuys_1[_i];var btnAni=new MovieClip;btnAni.playFile("resource/res/eff/sjxb_aneff",-1);btnBuy["eff"].addChild(btnAni)}};TreasureChuanshiPanel.prototype.open=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.buy1,this.onBuy);this.addTouchEvent(this.buy10,this.onBuy);this.addTouchEvent(this.btnRecord,this.onTap);this.addTouchEvent(this.grpRecord,this.onTap);this.observe(Heirloom.ins().postHuntRecord,this.listRefush);this.observe(UserBag.ins().postItemAdd,this.updateRedPoint);this.observe(Heirloom.ins().postHuntBoxInfo,this.updateBox);this.observe(Heirloom.ins().postHuntResult,this.updateMaterial);this.observe(Heirloom.ins().postHuntResult,function(){_this.buy1.enabled=true;_this.buy10.enabled=true});this.buy1.enabled=true;this.buy10.enabled=true;this.listRefush();Heirloom.ins().sendHuntRecord();this.updateBox();this.addBoxEvent=true;this.updateMaterial();this.setRedStatu();var leftDate=DateUtils.calcWeekFirstDay();this.endedTime=leftDate.getTime()/1e3;TimerManager.ins().remove(this.timeClock,this);TimerManager.ins().doTimer(1e3,0,this.timeClock,this);TimerManager.ins().remove(this.playBoxAni,this);TimerManager.ins().doTimer(400,0,this.playBoxAni,this)};TreasureChuanshiPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buy1,this.onBuy);this.removeTouchEvent(this.buy10,this.onBuy);this.removeTouchEvent(this.btnRecord,this.onTap);this.removeTouchEvent(this.grpRecord,this.onTap);this.removeObserve();DisplayUtils.removeFromParent(this.eff);TimerManager.ins().remove(this.timeClock,this);this.addBoxEvent=false};TreasureChuanshiPanel.prototype.timeClock=function(){this.endedTime-=1;if(this.endedTime<=0){var leftDate=DateUtils.calcWeekFirstDay();this.endedTime=leftDate.getTime()/1e3}this.leftTimeTxt.text=DateUtils.getFormatBySecond(this.endedTime,DateUtils.TIME_FORMAT_5,4)};TreasureChuanshiPanel.prototype.listRefush=function(){this.list.dataProvider=new eui.ArrayCollection(Heirloom.ins().huntRecords)};TreasureChuanshiPanel.prototype.onBuy=function(e){switch(e.target){case this.buy1:this.checkBuyHunt(0);break;case this.buy10:this.checkBuyHunt(1);break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Heirloom);break;default:break}};TreasureChuanshiPanel.prototype.checkBuyHunt=function(type){if(type==0&&Heirloom.ins().huntFreeTimes>0){this.startHuntAni(type);return}this.huntType=type;var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.HeirloomTreasureConfig.huntItem);if(item&&item.count){this.startHuntAni(type)}else{var huntOnce=type==0?GlobalConfig.HeirloomTreasureConfig.huntOnce:GlobalConfig.HeirloomTreasureConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureChuanshiPanel-HuntResultWin"+type,this.huntWarnFun.bind(this),i18n("TreasureChuanshiPanel_1",huntOnce,GlobalConfig.ItemConfig[GlobalConfig.HeirloomTreasureConfig.huntItem].name,type?10:1))}};TreasureChuanshiPanel.prototype.startHuntAni=function(type){var _this=this;if(type===void 0){type=0}var tt=200;var tc=12;var cycleCount=10;this.buy1.enabled=false;this.buy10.enabled=false;for(var i=0;i<cycleCount;++i){TimerManager.ins().doTimer(tt*i,1,function(){var idxs=[Math.floor(Math.random()*tc),Math.floor(Math.random()*tc)];if(type==1){idxs.push(Math.floor(Math.random()*tc),Math.floor(Math.random()*tc))}_this.playItemFlash(idxs)},this)}TimerManager.ins().doTimer(tt*cycleCount,1,function(){_this.playItemFlash([]);_this.buyHunt(type)},this)};TreasureChuanshiPanel.prototype.playItemFlash=function(idxs){for(var _i=0,_a=this.mcSmallItemEffs;_i<_a.length;_i++){var mc=_a[_i];if(mc!=null){mc.visible=false}}for(var _b=0,idxs_1=idxs;_b<idxs_1.length;_b++){var idx=idxs_1[_b];var mc=this.mcSmallItemEffs[idx];if(mc==null){var item=this["gift"+idx];mc=new MovieClip;mc.playFile("resource/res/eff/sjxb_kuangeff",0);mc.x=item.width/2;mc.y=item.height/2-5;item.addChild(mc);this.mcSmallItemEffs[idx]=mc}mc.visible=true;mc.gotoAndPlay(0,1)}};TreasureChuanshiPanel.prototype.buyHunt=function(type){if(type==0&&Heirloom.ins().huntFreeTimes>0){--Heirloom.ins().huntFreeTimes;Heirloom.ins().sendHunt(type);return}Heirloom.ins().sendHunt(type)};TreasureChuanshiPanel.prototype.huntWarnFun=function(){var huntOnce=this.huntType==0?GlobalConfig.HeirloomTreasureConfig.huntOnce:GlobalConfig.HeirloomTreasureConfig.huntTenth;if(Actor.yb>=huntOnce){this.startHuntAni(this.huntType)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("TreasureChuanshiPanel_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("TreasureChuanshiPanel_3"))}};TreasureChuanshiPanel.prototype.setRedStatu=function(){};TreasureChuanshiPanel.prototype.updateBox=function(){var lenBox=Heirloom.ins().huntBoxInfo.length;var state;var config;var i=0;for(var k in GlobalConfig.HeirloomTreasureRewardConfig){config=GlobalConfig.HeirloomTreasureRewardConfig[k];this["time"+i].text=config.needTime+i18n("TreasureChuanshiPanel_4");this["time"+i].visible=true;this["done"+i].visible=false;this["boxPoint"+i].visible=false;this["bar"+i].value=0;this["box"+i].source="treasurehuntboxg";this["box"+i].name="box"+(i+1);if(!this.addBoxEvent)this.addTouchEvent(this["box"+i],this.onGetAward);if(i<lenBox){state=Heirloom.ins().huntBoxInfo[i];if(state==Heirloom.CANGET){this["box"+i].source="treasurehuntboxc";this["bar"+i].value=100;this["boxPoint"+i].visible=true}else if(state==Heirloom.ISNGET){this["time"+i].visible=false;this["done"+i].visible=true;this["bar"+i].value=100}}i++}this.hopeValue0.text=Heirloom.ins().huntHope+"";this.times.text=Heirloom.ins().huntTimes+"";this.maskImage();this.updateRedPoint();var isFree=Heirloom.ins().huntFreeTimes>0;this.zbHunt1_2.visible=!isFree;this.free.visible=isFree;this.free.text=i18n("TreasureChuanshiPanel_5",Heirloom.ins().huntFreeTimes||0)};TreasureChuanshiPanel.prototype.maskImage=function(){var curPross=Heirloom.ins().huntHope;var maxPross=GlobalConfig.HeirloomTreasureConfig.maxBlissVal;var percent=curPross/maxPross;percent=percent<1?percent:1;if(percent>=1){if(this.maxHopeValue0.mask)this.maxHopeValue0.mask=null;if(this.maskShape){this.maskShape.graphics.clear();this.maskShape=null}return}if(!this.maxHopeValue0.mask){this.maskShape=new egret.Shape;this.maskShape.graphics.beginFill(16776960);this.maskShape.graphics.drawRect(this.maxHopeValue0.x,this.maxHopeValue0.y,this.maxHopeValue0.width,this.maxHopeValue0.height);this.maxHopeValue0.parent.addChild(this.maskShape);this.maxHopeValue0.mask=this.maskShape}this.maskShape.y=this.maxHopeValue0.height*(1-percent)};TreasureChuanshiPanel.prototype.onGetAward=function(e){var index=e.target.name.slice(3,4);var state=Heirloom.ins().huntBoxInfo[index-1];if(state==Heirloom.CANGET)Heirloom.ins().sendHuntAward(index);else ViewManager.ins().open(HuntBoxsTips,index,2)};TreasureChuanshiPanel.prototype.updateMaterial=function(){var sum=Heirloom.ins().getHuntItemNum();this.num1.textFlow=TextFlowMaker.generateTextFlow(i18n("TreasureChuanshiPanel_7",sum?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N,sum));this.num10.textFlow=TextFlowMaker.generateTextFlow(i18n("TreasureChuanshiPanel_8",sum>=10?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N,sum));this.updateRedPoint()};TreasureChuanshiPanel.prototype.updateRedPoint=function(){this.redPoint3.visible=Heirloom.ins().canHuntFree();this.redPoint4.visible=Heirloom.ins().getIsGetTen()};TreasureChuanshiPanel.prototype.onTap=function(e){switch(e.target){case this.btnRecord:this.grpRecord.visible=true;break;case this.grpRecord:this.grpRecord.visible=false;break}};TreasureChuanshiPanel.prototype.playBoxAni=function(){this.playBoxAniIdx+=1;var availBoxIdxs=[];var i=0;var lenBox=Heirloom.ins().huntBoxInfo.length;for(var k in GlobalConfig.HeirloomTreasureRewardConfig){if(i<lenBox){var state=Heirloom.ins().huntBoxInfo[i];if(state==Heirloom.CANGET){availBoxIdxs.push(i)}}i++}if(this.playBoxAniIdx>=availBoxIdxs.length){this.playBoxAniIdx=-2}if(this.playBoxAniIdx<0){return}var pi=availBoxIdxs[this.playBoxAniIdx];var box=this["box"+pi];var boxAni=this["boxAni"+pi];if(boxAni==null){boxAni=new MovieClip;this["boxAni"+pi]=boxAni;boxAni.x=box.x+box.width/2;boxAni.y=box.y+box.height/2;box.parent.addChildAt(boxAni,1);boxAni["__origin_y"]=boxAni.y}boxAni.y=boxAni["__origin_y"];box.alpha=0;boxAni.visible=true;egret.Tween.removeTweens(boxAni);egret.Tween.get(boxAni).to({y:boxAni["__origin_y"]-20},200).to({y:boxAni["__origin_y"]},200).call(function(){box.alpha=1;boxAni.visible=false});boxAni.playFile("resource/res/eff/sjxb_bxsmalleff",1,undefined,false)};return TreasureChuanshiPanel}(BaseView);__reflect(TreasureChuanshiPanel.prototype,"TreasureChuanshiPanel");var TreasureHuntPanel=function(_super){__extends(TreasureHuntPanel,_super);function TreasureHuntPanel(){var _this=_super.call(this)||this;_this.huntType=0;_this.addBoxEvent=false;_this.mcBigItemEffs=[null,null,null,null];_this.mcSmallItemEffs=[null,null,null,null,null,null,null,null];_this.playBoxAniIdx=-1;_this.name=i18n("TreasureHuntPanel_0");return _this}TreasureHuntPanel.prototype.childrenCreated=function(){this.init()};TreasureHuntPanel.prototype.init=function(){var _this=this;this.updateDescEx();var config;if(Activity.ins().IsHefuXunBaoTimer()){this.bdsz.visible=false;config=GlobalConfig.TreasureHuntPoolHefuConfig}else{config=GlobalConfig.TreasureHuntPoolConfig}var reward1=config[1].reward[0];var reward2=config[2].reward[0];var reward3=config[5].reward[0];var reward4=config[6].reward[0];this.id1=reward1.id;this.id2=reward2.id;this.id3=reward3.id;this.id4=reward4.id;this.list1.itemRenderer=ItemBase;this.list2.itemRenderer=ItemBase;this.list1.dataProvider=new eui.ArrayCollection(config[3].reward);this.list2.dataProvider=new eui.ArrayCollection(config[4].reward);var itemConfig=GlobalConfig.ItemConfig;var effs=[reward1["eff"],reward2["eff"],reward3["eff"],reward4["eff"]];var icons=[this.icon1,this.icon2,this.icon3,this.icon4];var powers=[this.power0,this.power1,this.power2,this.power3];var items=[itemConfig[this.id1],itemConfig[this.id2],itemConfig[this.id3],itemConfig[this.id4]];for(var i=0;i<4;++i){var mc=new MovieClip;mc.playFile("resource/"+effs[i],-1);icons[i].addChild(mc);if(i<=1){powers[i].text=""+ItemConfig.pointCalNumber(items[i])}else{powers[i].text=""+TreasureHuntPanel.calcSpecialRingPower(i-2,1)}}this.list.itemRenderer=HuntListRenderer;this.listRefush([]);this.longZhuEff=new MovieClip;this.longZhuEff.x=75;this.longZhuEff.y=35;this.longZhuEff.touchEnabled=false;this.eff=new MovieClip;this.eff.x=59;this.eff.y=23;this.eff.scaleX=.8;this.eff.scaleY=.8;this.eff.touchEnabled=false;this.btnGroup.visible=false;this.open();var mcHuntEff=new MovieClip;mcHuntEff.playFile("resource/res/eff/zbxb_jiahueff",1,function(){},false,function(){TimerManager.ins().doNext(function(){mcHuntEff.gotoAndStop(1)},_this)});this.mcHuntEff=mcHuntEff;this.grpEquipEff.addChild(mcHuntEff);var grpPowers=[this.grpPower0,this.grpPower1,this.grpPower2,this.grpPower3];for(var i=0;i<4;++i){var mcPower=new MovieClip;mcPower.playFile("resource/res/eff/sjxb_zdleff",-1);grpPowers[i].addChild(mcPower)}var btnBuys=[this.buy1,this.buy10];for(var _i=0,btnBuys_2=btnBuys;_i<btnBuys_2.length;_i++){var btnBuy=btnBuys_2[_i];var btnAni=new MovieClip;btnAni.playFile("resource/res/eff/sjxb_aneff",-1);btnBuy["eff"].addChild(btnAni)}};TreasureHuntPanel.calcSpecialRingPower=function(index,ringLv){if(ringLv===void 0){ringLv=1}var config=GlobalConfig.ExRingConfig[index];var ringConfigArr=GlobalConfig["ExRing"+index+"Config"];var ringConfig=ringConfigArr[ringLv];var power=0;if(ringConfig){var attrAward=ringConfig.attrAward;power=UserBag.getAttrPower(ringConfig.attrAward);power+=ringConfig.power}return power};TreasureHuntPanel.prototype.open=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.buy1,this.onBuy);this.addTouchEvent(this.buy10,this.onBuy);this.addTouchEvent(this.btnIcon1,this.onClick);this.addTouchEvent(this.btnIcon2,this.onClick);this.addTouchEvent(this.btnIcon3,this.onClick);this.addTouchEvent(this.btnIcon4,this.onClick);this.addTouchEvent(this.btnRecord,this.onClick);this.addTouchEvent(this.grpRecord,this.onClick);this.observe(Hunt.ins().postBestListInfo,this.listRefush);this.observe(UserBag.ins().postItemAdd,this.updateRedPoint);this.observe(Hunt.ins().postHuntResult,function(){_this.buy1.enabled=true;_this.buy10.enabled=true;_this.callHuntResult()});this.observe(Hunt.ins().postHuntBoxInfo,this.callHuntResult);this.observe(Hunt.ins().postHuntBoxInfo,this.updateBox);this.updateBox();this.listRefush([]);Hunt.ins().sendHuntList();this.setRedStatu();GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.zhuangBei);this.buy1.enabled=true;this.buy10.enabled=true;TimerManager.ins().remove(this.playBoxAni,this);TimerManager.ins().doTimer(400,0,this.playBoxAni,this)};TreasureHuntPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buy1,this.onBuy);this.removeTouchEvent(this.buy10,this.onBuy);this.removeTouchEvent(this.btnIcon1,this.onClick);this.removeTouchEvent(this.btnIcon2,this.onClick);this.removeTouchEvent(this.btnIcon3,this.onClick);this.removeTouchEvent(this.btnIcon4,this.onClick);this.removeTouchEvent(this.btnRecord,this.onClick);this.removeTouchEvent(this.grpRecord,this.onClick);DisplayUtils.removeFromParent(this.eff);this.removeObserve();GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack);TimerManager.ins().removeAll(this)};TreasureHuntPanel.prototype.updateBox=function(){this.times.text=Hunt.ins().huntTimes+"";var lenBox=Hunt.ins().huntBoxInfo.length;var state;var config;var i=0;for(var k in GlobalConfig.TreasureRewardConfig){config=GlobalConfig.TreasureRewardConfig[k];this["time"+i].text=config.needTimes+i18n("TreasureHuntPanel_1");this["time"+i].visible=true;this["done"+i].visible=false;this["boxPoint"+i].visible=false;this["bar"+i].value=0;this["box"+i].source="treasurehuntboxg";this["box"+i].name="box"+(i+1);if(!this.addBoxEvent)this.addTouchEvent(this["box"+i],this.onGetAward);if(i<lenBox){state=Hunt.ins().huntBoxInfo[i];if(state==Hunt.CANGET){this["box"+i].source="treasurehuntboxc";this["bar"+i].value=100;this["boxPoint"+i].visible=true}else if(state==Hunt.ISNGET){this["time"+i].visible=false;this["done"+i].visible=true;this["bar"+i].value=100}}i++}};TreasureHuntPanel.prototype.onGetAward=function(e){var index=e.target.name.slice(3,4);var state=Hunt.ins().huntBoxInfo[index-1];if(state==Hunt.CANGET)Hunt.ins().sendHuntAward(index);else ViewManager.ins().open(HuntBoxsTips,index,4)};TreasureHuntPanel.prototype.setRedStatu=function(){};TreasureHuntPanel.prototype.listRefush=function(data){this.list.dataProvider=new eui.ArrayCollection(data)};TreasureHuntPanel.prototype.onBuy=function(e){switch(e.target){case this.buy1:if(UserBag.ins().getSurplusCount()<10){ViewManager.ins().open(BagFullTipsWin,10)}else{this.checkBuyHunt(0)}break;case this.buy10:if(UserBag.ins().getSurplusCount()<10){ViewManager.ins().open(BagFullTipsWin,10)}else{this.checkBuyHunt(1)}break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Equip);break;default:break}};TreasureHuntPanel.prototype.checkBuyHunt=function(type){if(type==0&&Hunt.ins().huntFreeTimes>0){this.startHuntAni(type);return}this.huntType=type;var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.TreasureHuntConfig.huntItem);if(!(item&&item.count)){var huntOnce=type==0?GlobalConfig.TreasureHuntConfig.huntOnce:GlobalConfig.TreasureHuntConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureHuntPanel-HuntResultWin"+type,this.huntWarnFun.bind(this),i18n("TreasureHuntPanel_2",huntOnce,GlobalConfig.ItemConfig[GlobalConfig.TreasureHuntConfig.huntItem].name,type?10:1))}else{this.startHuntAni(type)}};TreasureHuntPanel.prototype.buyHunt=function(type){if(type==0&&Hunt.ins().huntFreeTimes>0){--Hunt.ins().huntFreeTimes;Hunt.ins().sendHunt(type);return}Hunt.ins().sendHunt(type)};TreasureHuntPanel.prototype.huntWarnFun=function(){var huntOnce=this.huntType==0?GlobalConfig.TreasureHuntConfig.huntOnce:GlobalConfig.TreasureHuntConfig.huntTenth;if(Actor.yb>=huntOnce){this.startHuntAni(this.huntType)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("TreasureHuntPanel_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("TreasureHuntPanel_4"))}};TreasureHuntPanel.prototype.onClick=function(e){switch(e.target){case this.btnIcon1:ViewManager.ins().open(EquipDetailedWin,1,undefined,this.id1);break;case this.btnIcon2:ViewManager.ins().open(EquipDetailedWin,1,undefined,this.id2);break;case this.btnIcon3:ViewManager.ins().open(SpecialRingShow,0);break;case this.btnIcon4:ViewManager.ins().open(SpecialRingShow,1);break;case this.btnRecord:this.grpRecord.visible=true;break;case this.grpRecord:this.grpRecord.visible=false;break;default:break}};TreasureHuntPanel.prototype.callHuntResult=function(){this.updateDescEx()};TreasureHuntPanel.prototype.updateDescEx=function(){var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.TreasureHuntConfig.huntItem);var sum=item?item.count:0;var isFree=Hunt.ins().huntFreeTimes>0;this.num1.textFlow=TextFlowMaker.generateTextFlow("<font color="+(sum?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+sum+"</font> ");this.num10.textFlow=TextFlowMaker.generateTextFlow("<font color="+(sum>=10?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+sum+"</font> ");this.zb1.text=GlobalConfig.TreasureHuntConfig.huntOnce+"";this.zb10.text=GlobalConfig.TreasureHuntConfig.huntTenth+"";this.zbHunt1_2.visible=!isFree;this.free.visible=isFree;this.free.text=i18n("TreasureHuntPanel_5",Hunt.ins().huntFreeTimes||0);this.updateRedPoint()};TreasureHuntPanel.prototype.updateRedPoint=function(){this.redPoint3.visible=Hunt.ins().canHuntFree();this.redPoint4.visible=Hunt.ins().getIsGetTen()};TreasureHuntPanel.prototype.playItemFlash=function(idxs){for(var _i=0,_a=this.mcBigItemEffs;_i<_a.length;_i++){var mc=_a[_i];if(mc!=null){mc.visible=false}}for(var _b=0,_c=this.mcSmallItemEffs;_b<_c.length;_b++){var mc=_c[_b];if(mc!=null){mc.visible=false}}var bgs=[this["bgup"],this["bgdown"],this["bgleft"],this["bgright"]];for(var _d=0,idxs_2=idxs;_d<idxs_2.length;_d++){var idx=idxs_2[_d];if(idx<4){var mc=this.mcBigItemEffs[idx];if(mc==null){var curbg=bgs[idx];mc=new MovieClip;mc.playFile("resource/res/eff/zbxb_bigkuangeff",0);mc.x=curbg.x+curbg.width/2;mc.y=curbg.y+curbg.height/2;this.chuanqi.addChild(mc);this.mcBigItemEffs[idx]=mc}mc.visible=true;mc.gotoAndPlay(0,1)}else{var mc=this.mcSmallItemEffs[idx];if(mc==null){var item;var idx2=idx-4;if(idx2<4){item=this.list1.getElementAt(idx2)}else{item=this.list2.getElementAt(idx2-4)}mc=new MovieClip;mc.playFile("resource/res/eff/zbxb_smallkuangeff",0);mc.x=item.width/2;mc.y=item.width/2*.8;item.addChild(mc);this.mcSmallItemEffs[idx]=mc}mc.visible=true;mc.gotoAndPlay(0,1)}}};TreasureHuntPanel.prototype.startHuntAni=function(type){var _this=this;if(type===void 0){type=0}var tt=200;var tc=12;this.mcHuntEff.playFile("resource/res/eff/zbxb_jiahueff",-1);this.buy1.enabled=false;this.buy10.enabled=false;for(var i=0;i<tc;++i){TimerManager.ins().doTimer(tt*i,1,function(){var idxs=[Math.floor(Math.random()*12),Math.floor(Math.random()*12)];if(type==1){idxs.push(Math.floor(Math.random()*12),Math.floor(Math.random()*12))}_this.playItemFlash(idxs)},this)}TimerManager.ins().doTimer(tt*tc,1,function(){if(_this.mcHuntEff.frameEvents!=null){_this.mcHuntEff.gotoAndStop(1)}_this.playItemFlash([]);_this.buyHunt(type)},this)};TreasureHuntPanel.prototype.playBoxAni=function(){this.playBoxAniIdx+=1;var availBoxIdxs=[];var i=0;var lenBox=Hunt.ins().huntBoxInfo.length;for(var k in GlobalConfig.TreasureRewardConfig){if(i<lenBox){var state=Hunt.ins().huntBoxInfo[i];if(state==Hunt.CANGET){availBoxIdxs.push(i)}}i++}if(this.playBoxAniIdx>=availBoxIdxs.length){this.playBoxAniIdx=-2}if(this.playBoxAniIdx<0){return}var pi=availBoxIdxs[this.playBoxAniIdx];var box=this["box"+pi];var boxAni=this["boxAni"+pi];if(boxAni==null){boxAni=new MovieClip;this["boxAni"+pi]=boxAni;boxAni.x=box.x+box.width/2;boxAni.y=box.y+box.height/2;box.parent.addChildAt(boxAni,1);boxAni["__origin_y"]=boxAni.y}boxAni.y=boxAni["__origin_y"];box.alpha=0;boxAni.visible=true;egret.Tween.removeTweens(boxAni);egret.Tween.get(boxAni).to({y:boxAni["__origin_y"]-20},200).to({y:boxAni["__origin_y"]},200).call(function(){box.alpha=1;boxAni.visible=false});boxAni.playFile("resource/res/eff/sjxb_bxsmalleff",1,undefined,false)};return TreasureHuntPanel}(BaseView);__reflect(TreasureHuntPanel.prototype,"TreasureHuntPanel");var TreasureHuntWin=function(_super){__extends(TreasureHuntWin,_super);function TreasureHuntWin(){var _this=_super.call(this)||this;_this.curRole=0;_this.curSelectIndex=0;_this.skinName="TreasureHuntSkin";_this.isTopLevel=true;return _this}TreasureHuntWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.panelArr=[this.treasureHuntPanel,this.treasureShapeShifting,this.treasureRune,this.treasureMillionaire,this.treasureChuanshi];this.viewStack.selectedIndex=0;this.checkHeirloomOpen();this.tab.dataProvider=this.viewStack};TreasureHuntWin.prototype.destoryView=function(){_super.prototype.destoryView.call(this)};TreasureHuntWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var page=param[0]?param[0]:0;this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.help,this.onClick);this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.checkIsOpen);this.observe(Millionaire.ins().postMillionaireInfo,this.callbackMillionaireInfo);this.observe(Millionaire.ins().postTurnDice,this.MillionaireRedPoint);this.observe(Millionaire.ins().postRoundReward,this.MillionaireRedPoint);this.observe(Millionaire.ins().postMillionaireUpdate,this.MillionaireRedPoint);this.observe(UserBag.ins().postItemChange,this.setRedPoint);this.observe(UserBag.ins().postItemAdd,this.setRedPoint);this.observe(UserBag.ins().postItemDel,this.setRedPoint);this.observe(GameLogic.ins().postSubRoleChange,this.setRedPoint);this.observe(Rune.ins().postRuneBoxGift,this.setRedPoint);this.observe(ShapeShiftingTreasure.ins().postHuntBoxInfo,this.setRedPoint);this.observe(GameServer.ins().postServerOpenDay,this.checkHeirloomOpen);this.observe(UserZs.ins().postZsLv,this.checkHeirloomOpen);this.setSelectedIndex(page);this.setRedPoint()};TreasureHuntWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.panelArr[this.curSelectIndex].close()};TreasureHuntWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.help:var helpIndex=void 0;if(this.tab.selectedIndex==0)helpIndex=39;else if(this.tab.selectedIndex==1)helpIndex=47;else if(this.tab.selectedIndex==2)helpIndex=13;else if(this.tab.selectedIndex==3)helpIndex=19;else if(this.tab.selectedIndex==4)helpIndex=40;if(helpIndex)ViewManager.ins().open(ZsBossRuleSpeak,helpIndex);break}};TreasureHuntWin.prototype.switchRole=function(){};TreasureHuntWin.prototype.checkIsOpen=function(e){var tab=e.target;var guanQiaID=UserFb.ins().guanqiaID;var openChapterLevel=GlobalConfig.ShapeShiftingTreasureConfig.openChapterLevel;if(tab.selectedIndex==1&&!ShapeShiftingTreasure.ins().isOpen()){UserTips.ins().showTips(i18n("TreasureHuntWin_3",openChapterLevel));e.$cancelable=true;e.preventDefault();return}var openlevel=GlobalConfig.FuwenTreasureConfig.openlevel;if(tab.selectedIndex==2&&!Rune.ins().isRuneOpen()){UserTips.ins().showTips(i18n("TreasureHuntWin_0",openlevel));e.$cancelable=true;e.preventDefault();return}if(tab.selectedIndex==3&&!MillionaireWin.openCheck()){e.$cancelable=true;e.preventDefault();return}};TreasureHuntWin.prototype.onTabTouch=function(e){this.panelArr[this.curSelectIndex].close();var selectedIndex=e.currentTarget.selectedIndex;this.setSelectedIndex(selectedIndex);this.setRedPoint();ViewManager.ins().close(LimitTaskView)};TreasureHuntWin.prototype.setSelectedIndex=function(selectedIndex){this.curSelectIndex=selectedIndex;this.panelArr[selectedIndex].open();this.viewStack.selectedIndex=selectedIndex};TreasureHuntWin.openCheck=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(param[0]){if(param[0]==4){if(!Heirloom.ins().isHeirloomHuntOpen()){UserTips.ins().showTips(i18n("TreasureHuntWin_1",GlobalConfig.HeirloomTreasureConfig.openDay+1,GlobalConfig.HeirloomTreasureConfig.openZSlevel));return false}}else if(param[0]==2){if(!Rune.ins().isRuneOpen()){UserTips.ins().showTips(i18n("TreasureHuntWin_2",GlobalConfig.FuwenTreasureConfig.openlevel));return false}}else if(param[0]==1){var guanQiaID=UserFb.ins().guanqiaID;var openChapterLevel=GlobalConfig.ShapeShiftingTreasureConfig.openChapterLevel;if(!ShapeShiftingTreasure.ins().isOpen()){UserTips.ins().showTips(i18n("TreasureHuntWin_3",openChapterLevel));return false}}else if(param[0]==3){if(!MillionaireWin.openCheck()){UserTips.ins().showTips(i18n("TreasureHuntWin_2",GlobalConfig.RichManBaseConfig.openLv));return false}}}if(OpenSystem.ins().checkSysOpen(SystemType.TREASURE)){ViewManager.ins().close(LiLianWin);return true}UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.TREASURE));return false};TreasureHuntWin.prototype.setRedPoint=function(){this.redPoint0.visible=Hunt.ins().showRedPoint();this.redPoint1.visible=ShapeShiftingTreasure.ins().showRedPoint();this.redPoint2.visible=Rune.ins().showRedPoint();this.redPoint3.visible=Millionaire.ins().showRedPoint();this.redPoint4.visible=Heirloom.ins().showRedPoint()};TreasureHuntWin.prototype.checkHeirloomOpen=function(){if(Heirloom.ins().isHeirloomHuntOpen()){if(this.viewStack.length<4){this.viewStack.addChild(this.treasureChuanshi);this.redGroup.addChild(this.redPoint4);this.tab.dataProvider=this.viewStack}}else{if(this.viewStack.length>4){this.viewStack.removeChildAt(4);this.redGroup.removeChildAt(4);this.tab.dataProvider=this.viewStack}}};TreasureHuntWin.prototype.callbackMillionaireInfo=function(){var view=ViewManager.ins().getView(MillionaireWin);if(!MillionaireWin.isFirstOpen){this.setSelectedIndex(2)}this.redPoint3.visible=Millionaire.ins().showRedPoint()};TreasureHuntWin.prototype.MillionaireRedPoint=function(){this.redPoint3.visible=Millionaire.ins().showRedPoint()};return TreasureHuntWin}(BaseEuiView);__reflect(TreasureHuntWin.prototype,"TreasureHuntWin");ViewManager.ins().reg(TreasureHuntWin,LayerManager.UI_Main);var TreasureItem=function(_super){__extends(TreasureItem,_super);function TreasureItem(){var _this=_super.call(this)||this;_this.skinName="TreasureItemSkin";return _this}TreasureItem.prototype.dataChanged=function(){var data=this.data;this.item.data=data;var itemBgName=TreasureItem.qualityBgNames[ItemConfig.getQuality(GlobalConfig.ItemConfig[data.id])];this.bg.source=itemBgName};TreasureItem.qualityBgNames={0:"",1:"",2:"treasurehuntitembg6",3:"treasurehuntitembg5",4:"treasurehuntitembg4",5:"treasurehuntitembg3"};return TreasureItem}(BaseItemRender);__reflect(TreasureItem.prototype,"TreasureItem");var TreasureRunePanel=function(_super){__extends(TreasureRunePanel,_super);function TreasureRunePanel(){var _this=_super.call(this)||this;_this.huntType=0;_this.mcSmallItemEffs=[];_this.playBoxAniIdx=-1;_this.name=i18n("TreasureRunePanel_0");return _this}TreasureRunePanel.prototype.childrenCreated=function(){this.init()};TreasureRunePanel.prototype.init=function(){this.updateDescEx();var config=GlobalConfig.FuwenTreasureLevelConfig;var lv=SkyLevelModel.ins().cruLevel;var useCfg=null;for(var str in config){var cfg=config[str];if(lv>=cfg.level&&lv<=cfg.levelend){useCfg=cfg;break}}var array=this.sortRunes(useCfg.showicon);this.list1.itemRenderer=TreasureItem;this.list1.dataProvider=new eui.ArrayCollection(array);this.mcSmallItemEffs=[];for(var i=0;i<array.length;i++){this.mcSmallItemEffs[i]=null}this.eff=new MovieClip;this.eff.x=59;this.eff.y=23;this.eff.scaleX=.8;this.eff.scaleY=.8;this.eff.touchEnabled=false;this.btnGroup.visible=false;var btnBuys=[this.buy1,this.buy10];for(var _i=0,btnBuys_3=btnBuys;_i<btnBuys_3.length;_i++){var btnBuy=btnBuys_3[_i];var btnAni=new MovieClip;btnAni.playFile("resource/res/eff/sjxb_aneff",-1);btnBuy["eff"].addChild(btnAni)}this.open()};TreasureRunePanel.prototype.sortFunc=function(a,b){var rune1=GlobalConfig.ItemConfig[a.id];var rune2=GlobalConfig.ItemConfig[b.id];var q1=ItemConfig.getQuality(rune1);var q2=ItemConfig.getQuality(rune2);var r1=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(rune1)];var r2=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(rune2)];if(q1!=q2){return q2-q1}else{return r1.type-r2.type}};TreasureRunePanel.prototype.sortRunes=function(array){var runes=[].concat(array);runes.sort(this.sortFunc);return runes};TreasureRunePanel.prototype.open=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.buy1,this.onBuy);this.addTouchEvent(this.buy10,this.onBuy);this.addTouchEvent(this.outBag0,this.onBuy);this.observe(Rune.ins().postHuntRuneInfo,this.callRuneResult);for(var i=0;i<Rune.BoxSum;i++){this.addTouchEvent(this["box"+i],this.onTab)}this.observe(UserBag.ins().postHuntStore,this.setRedStatu);this.observe(UserBag.ins().postItemAdd,this.updateRedPoint);this.observe(Rune.ins().postRuneBoxGift,this.callback);this.observe(Rune.ins().postHuntRuneInfo,function(){_this.buy1.enabled=true;_this.buy10.enabled=true});this.buy1.enabled=true;this.buy10.enabled=true;Hunt.ins().sendHuntList();this.setRedStatu();this.setBoxData();var leftDate=DateUtils.calcWeekFirstDay();this.endedTime=leftDate.getTime()/1e3;TimerManager.ins().remove(this.timeClock,this);TimerManager.ins().doTimer(1e3,0,this.timeClock,this);TimerManager.ins().remove(this.playBoxAni,this);TimerManager.ins().doTimer(400,0,this.playBoxAni,this);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.fuWenXunBao)};TreasureRunePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buy1,this.onBuy);this.removeTouchEvent(this.buy10,this.onBuy);DisplayUtils.removeFromParent(this.eff);for(var i=0;i<Rune.BoxSum;i++){this.removeTouchEvent(this["box"+i],this.onTab)}this.removeObserve();TimerManager.ins().remove(this.timeClock,this);GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};TreasureRunePanel.prototype.timeClock=function(){this.endedTime-=1;if(this.endedTime<=0){var leftDate=DateUtils.calcWeekFirstDay();this.endedTime=leftDate.getTime()/1e3}this.leftTime.text=i18n("TreasureRunePanel_1")+DateUtils.getFormatBySecond(this.endedTime,DateUtils.TIME_FORMAT_5,4)};TreasureRunePanel.prototype.setRedStatu=function(){this.redPoint0.visible=RuneRedPointMgr.ins().checkCanExchange()};TreasureRunePanel.prototype.onBuy=function(e){switch(e.target){case this.buy1:this.checkBuyHunt(0);break;case this.buy10:this.checkBuyHunt(1);break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Rune);break;case this.outBag0:ViewManager.ins().open(RuneExchangeShopWin);break;default:break}};TreasureRunePanel.prototype.onTab=function(e){for(var i=0;i<Rune.BoxSum;i++){if(e.target==this["box"+i]){if(Rune.ins().boxs[i]==Rune.UNGET){ViewManager.ins().open(HuntBoxsTips,i+1);break}else if(Rune.ins().boxs[i]==Rune.ISNGET){ViewManager.ins().open(HuntBoxsTips,i+1);break}this.boxId=i+1;Rune.ins().sendRuneBoxGift(i+1);break}}};TreasureRunePanel.prototype.checkBuyHunt=function(type){if(type==0&&Rune.ins().huntFreeTimes>0){this.startHuntAni(type);return}this.huntType=type;var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.FuwenTreasureConfig.huntItem);if(item&&item.count){this.startHuntAni(type)}else{var huntOnce=type==0?GlobalConfig.FuwenTreasureConfig.huntOnce:GlobalConfig.FuwenTreasureConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureRunePanel-HuntResultWin"+type,this.huntWarnFun.bind(this),i18n("TreasureRunePanel_2",huntOnce,GlobalConfig.ItemConfig[GlobalConfig.FuwenTreasureConfig.huntItem].name,type?10:1))}};TreasureRunePanel.prototype.startHuntAni=function(type){var _this=this;if(type===void 0){type=0}var tt=200;var tc=this.list1.numElements;var cycleCount=10;this.buy1.enabled=false;this.buy10.enabled=false;for(var i=0;i<cycleCount;++i){TimerManager.ins().doTimer(tt*i,1,function(){var idxs=[Math.floor(Math.random()*tc),Math.floor(Math.random()*tc)];if(type==1){idxs.push(Math.floor(Math.random()*tc),Math.floor(Math.random()*tc))}_this.playItemFlash(idxs)},this)}TimerManager.ins().doTimer(tt*cycleCount,1,function(){_this.playItemFlash([]);_this.buyHunt(type)},this)};TreasureRunePanel.prototype.playItemFlash=function(idxs){for(var _i=0,_a=this.mcSmallItemEffs;_i<_a.length;_i++){var mc=_a[_i];if(mc!=null){mc.visible=false}}for(var _b=0,idxs_3=idxs;_b<idxs_3.length;_b++){var idx=idxs_3[_b];var mc=this.mcSmallItemEffs[idx];if(mc==null){var item=this.list1.$children[idx];if(!item)continue;mc=new MovieClip;mc.playFile("resource/res/eff/sjxb_kuangeff",0);mc.x=item.width/2;mc.y=item.height/2-5;item.addChild(mc);this.mcSmallItemEffs[idx]=mc}mc.visible=true;mc.gotoAndPlay(0,1)}};TreasureRunePanel.prototype.buyHunt=function(type){if(type==0&&Rune.ins().huntFreeTimes>0){--Rune.ins().huntFreeTimes;Rune.ins().sendHuntRune(type);return}Rune.ins().sendHuntRune(type)};TreasureRunePanel.prototype.huntWarnFun=function(){var huntOnce=this.huntType==0?GlobalConfig.FuwenTreasureConfig.huntOnce:GlobalConfig.FuwenTreasureConfig.huntTenth;if(Actor.yb>=huntOnce){this.startHuntAni(this.huntType)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("TreasureRunePanel_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("TreasureRunePanel_4"))}};TreasureRunePanel.prototype.callback=function(){if(this.boxId){var cfg=GlobalConfig.FuwenTreasureRewardConfig[this.boxId];if(cfg)for(var i=0;i<cfg.reward.length;i++){UserTips.ins().showTips(i18n("TreasureRunePanel_5",cfg.reward[i].count))}this.boxId=0}this.setBoxData();this.callRuneResult()};TreasureRunePanel.prototype.setBoxData=function(){this.times.text=Rune.ins().runeCount+"";for(var i=0;i<Rune.BoxSum;i++){var config=GlobalConfig.FuwenTreasureRewardConfig[i+1];var count=config.needTime?config.needTime:0;this["time"+i].text=count+i18n("TreasureRunePanel_7");this["time"+i].visible=true;this["done"+i].visible=false;this["boxPoint"+i].visible=false;this["bar"+i].value=0;this["box"+i].source="treasurehuntboxg";this["box"+i].name="box"+(i+1);var state=Rune.ins().boxs[i];if(state==Rune.CANGET){this["box"+i].source="treasurehuntboxc";this["bar"+i].value=100;this["boxPoint"+i].visible=true}else if(state==Rune.ISNGET){this["time"+i].visible=false;this["done"+i].visible=true;this["bar"+i].value=100}}};TreasureRunePanel.prototype.callRuneResult=function(){this.updateDescEx()};TreasureRunePanel.prototype.updateDescEx=function(){var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.FuwenTreasureConfig.huntItem);var sum=item?item.count:0;var isFree=Rune.ins().huntFreeTimes>0;this.num1.textFlow=TextFlowMaker.generateTextFlow("<font color="+(sum?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+sum+"</font> ");this.num10.textFlow=TextFlowMaker.generateTextFlow("<font color="+(sum>=10?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+sum+"</font> ");this.zw1.text=GlobalConfig.FuwenTreasureConfig.huntOnce+"";this.zw10.text=GlobalConfig.FuwenTreasureConfig.huntTenth+"";this.hopeValue.text=Rune.ins().hope+"";this.maskImage();this.zwHunt1_2.visible=!isFree;this.free.visible=isFree;this.free.text=i18n("TreasureRunePanel_12",Rune.ins().huntFreeTimes||0);this.updateRedPoint()};TreasureRunePanel.prototype.maskImage=function(){var curPross=Rune.ins().hope;var maxPross=GlobalConfig.FuwenTreasureConfig.maxBlissVal;var percent=curPross/maxPross;percent=percent<1?percent:1;if(percent>=1){DisplayUtils.removeFromParent(this.masksp);this.masksp=null;return}if(!this.masksp){this.masksp=new egret.Sprite;var square=new egret.Shape;square.graphics.beginFill(16776960);square.graphics.drawRect(this.maxHopeValue.x,this.maxHopeValue.y,this.maxHopeValue.width,this.maxHopeValue.height);square.graphics.endFill();this.masksp.addChild(square);this.maxHopeValue.parent.addChild(this.masksp);this.maxHopeValue.mask=this.masksp}this.masksp.y=this.maxHopeValue.height*(1-percent)};TreasureRunePanel.prototype.updateRedPoint=function(){this.redPoint3.visible=Rune.ins().canHuntFree();this.redPoint4.visible=Rune.ins().getIsGetTen()};TreasureRunePanel.prototype.playBoxAni=function(){this.playBoxAniIdx+=1;var availBoxIdxs=[];var i=0;var lenBox=Rune.ins().boxs.length;for(var k in GlobalConfig.FuwenTreasureRewardConfig){if(i<lenBox){var state=Rune.ins().boxs[i];if(state==Rune.CANGET){availBoxIdxs.push(i)}}i++}if(this.playBoxAniIdx>=availBoxIdxs.length){this.playBoxAniIdx=-2}if(this.playBoxAniIdx<0){return}var pi=availBoxIdxs[this.playBoxAniIdx];var box=this["box"+pi];var boxAni=this["boxAni"+pi];if(boxAni==null){boxAni=new MovieClip;this["boxAni"+pi]=boxAni;boxAni.x=box.x+box.width/2;boxAni.y=box.y+box.height/2;box.parent.addChildAt(boxAni,1);boxAni["__origin_y"]=boxAni.y}boxAni.y=boxAni["__origin_y"];box.alpha=0;boxAni.visible=true;egret.Tween.removeTweens(boxAni);egret.Tween.get(boxAni).to({y:boxAni["__origin_y"]-20},200).to({y:boxAni["__origin_y"]},200).call(function(){box.alpha=1;boxAni.visible=false});boxAni.playFile("resource/res/eff/sjxb_bxsmalleff",1,undefined,false)};return TreasureRunePanel}(BaseView);__reflect(TreasureRunePanel.prototype,"TreasureRunePanel");var TreasureShapeShiftingPanel=function(_super){__extends(TreasureShapeShiftingPanel,_super);function TreasureShapeShiftingPanel(){var _this=_super.call(this)||this;_this.addBoxEvent=false;_this.huntType=0;_this.mcSmallItemEffs=[null,null,null,null,null,null,null,null];_this.playBoxAniIdx=-1;_this.name=i18n("TreasureShapeShiftingPanel_0");return _this}TreasureShapeShiftingPanel.prototype.childrenCreated=function(){this.init()};TreasureShapeShiftingPanel.prototype.init=function(){var cfg=GlobalConfig.ShapeShiftingTreasureConfig;var len=cfg.boxes.length;var gift;var qualityBgNames={0:"",1:"",2:"treasurehuntitembg6",3:"treasurehuntitembg5",4:"treasurehuntitembg4",5:"treasurehuntitembg3"};for(var i=0;i<len;i++){gift=this["gift"+i];gift.data=cfg.boxes[i];var itemConfig=GlobalConfig.ItemConfig[cfg.boxes[i].id];var itemBgName=qualityBgNames[ItemConfig.getQuality(itemConfig)];var itembg=new eui.Image(itemBgName);itembg.x=5;itembg.y=-5;gift.addChildAt(itembg,0)}var mcPower=new MovieClip;mcPower.playFile("resource/res/eff/sjxb_zdleff",-1);this.grpPower0.addChild(mcPower);this.eff=new MovieClip;this.eff.x=59;this.eff.y=23;this.eff.scaleX=.8;this.eff.scaleY=.8;this.eff.touchEnabled=false;this.list.itemRenderer=HuntListRenderer;this.zb1.text=cfg.huntOnce+"";this.zb10.text=cfg.huntTenth+"";this.btnGroup.visible=false;this.updateGift8();ShapeShiftingTreasure.ins().startTimer();var btnBuys=[this.buy1,this.buy10];for(var _i=0,btnBuys_4=btnBuys;_i<btnBuys_4.length;_i++){var btnBuy=btnBuys_4[_i];var btnAni=new MovieClip;btnAni.playFile("resource/res/eff/sjxb_aneff",-1);btnBuy["eff"].addChild(btnAni)}this.setMC()};TreasureShapeShiftingPanel.prototype.getMcRes=function(){var cfg=GlobalConfig.ShapeShiftingTreasureConfig;var idx=ShapeShiftingTreasure.ins().box8Idx;var data=cfg.box8[idx];var id=data.id;var sid=1;var dz="";var cfg2=GlobalConfig.ShapeShiftingConfig;for(var shapeId in cfg2){var mat=cfg2[shapeId].mat;if(id==mat){sid=cfg2[shapeId].id;dz=cfg2[shapeId].dz;break}}var cfg3=GlobalConfig.ShapeShiftingLevelConfig;var body=cfg3[sid][1][1].showApperance+"_c";return{dz:dz,body:body,sid:sid}};TreasureShapeShiftingPanel.prototype.updateGift8=function(){var sstcfg=GlobalConfig.ShapeShiftingTreasureConfig;var idx=ShapeShiftingTreasure.ins().box8Idx;var gift8=this["gift"+8];gift8.data=sstcfg.box8[idx];var res=this.getMcRes();this.mcGroup.removeChildren();this.iconMc=new MovieClip;this.iconMc.x=0;this.iconMc.y=0;this.mcGroup.addChild(this.iconMc);this.iconMc.playFile(RES_DIR_ROLE+res.body,-1);var id=res.sid;this.curShapeID=id;var itemData=GlobalConfig.ShapeShiftingConfig[id];var cfg=GlobalConfig.ShapeShiftingConfig[id];var cfg2=GlobalConfig.ShapeShiftingLevelConfig[id][1][1];var showScale=(cfg["showScale"]||100)/100;this.mcGroup.scaleX=this.mcGroup.scaleY=showScale*.7;var attrs=cfg2.attrs;var power=UserBag.getAttrPower(attrs);this.power0.text=""+power;this.btnSkill.icon=cfg.asIcon||"bs_skill";this.btnTalent.icon=cfg.tsIcon||"bs_talent";this.btnEnterSkill.icon=cfg.esIcon||"bs_enter"};TreasureShapeShiftingPanel.prototype.open=function(){var _this=this;var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnRecord,this.onClick);this.addTouchEvent(this.grpRecord,this.onClick);this.addTouchEvent(this.btnSkill,this.onClick);this.addTouchEvent(this.btnTalent,this.onClick);this.addTouchEvent(this.btnEnterSkill,this.onClick);this.addTouchEvent(this.buy1,this.onBuy);this.addTouchEvent(this.buy10,this.onBuy);this.addTouchEvent(this.btnShapeshifting,this.onBtnSS);this.observe(ShapeShiftingTreasure.ins().postHuntRecord,this.listRefush);this.observe(ShapeShiftingTreasure.ins().postHuntResult,function(){_this.buy1.enabled=true;_this.buy10.enabled=true});this.observe(UserBag.ins().postItemAdd,this.updateRedPoint);this.observe(ShapeShiftingTreasure.ins().postHuntBoxInfo,this.updateBox);this.observe(ShapeShiftingTreasure.ins().postHuntResult,this.updateMaterial);this.observe(ShapeShiftingTreasure.ins().postIdxChange,this.updateGift8);this.listRefush();ShapeShiftingTreasure.ins().sendHuntRecord();this.updateBox();this.addBoxEvent=true;this.updateMaterial();this.setRedStatu();var leftDate=DateUtils.calcWeekFirstDay();this.endedTime=leftDate.getTime()/1e3;TimerManager.ins().remove(this.timeClock,this);TimerManager.ins().doTimer(1e3,0,this.timeClock,this);TimerManager.ins().remove(this.playBoxAni,this);TimerManager.ins().doTimer(400,0,this.playBoxAni,this);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.shenJiang);this.buy1.enabled=true;this.buy10.enabled=true};TreasureShapeShiftingPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.buy1,this.onBuy);this.removeTouchEvent(this.buy10,this.onBuy);this.removeTouchEvent(this.btnRecord,this.onClick);this.removeTouchEvent(this.grpRecord,this.onClick);this.removeTouchEvent(this.btnSkill,this.onClick);this.removeTouchEvent(this.btnTalent,this.onClick);this.removeTouchEvent(this.btnEnterSkill,this.onClick);this.removeObserve();DisplayUtils.removeFromParent(this.eff);TimerManager.ins().removeAll(this);this.addBoxEvent=false;GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};TreasureShapeShiftingPanel.prototype.onClick=function(e){switch(e.target){case this.btnRecord:this.grpRecord.visible=true;break;case this.grpRecord:this.grpRecord.visible=false;break;case this.btnSkill:ViewManager.ins().open(ShapeShiftingSkillWin,this.curShapeID,1);break;case this.btnTalent:ViewManager.ins().open(ShapeShiftingSkillWin,this.curShapeID,2);break;case this.btnEnterSkill:ViewManager.ins().open(ShapeShiftingSkillWin,this.curShapeID,3);break}};TreasureShapeShiftingPanel.prototype.timeClock=function(){this.endedTime-=1;if(this.endedTime<=0){var leftDate=DateUtils.calcWeekFirstDay();this.endedTime=leftDate.getTime()/1e3}this.leftTimeTxt.text=DateUtils.getFormatBySecond(this.endedTime,DateUtils.TIME_FORMAT_5,4)};TreasureShapeShiftingPanel.prototype.listRefush=function(){this.list.dataProvider=new eui.ArrayCollection(ShapeShiftingTreasure.ins().huntRecords)};TreasureShapeShiftingPanel.prototype.onBuy=function(e){switch(e.target){case this.buy1:this.checkBuyHunt(0);break;case this.buy10:this.checkBuyHunt(1);break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.ShapeShiftingTreasure);break;default:break}};TreasureShapeShiftingPanel.prototype.onBtnSS=function(){ViewManager.ins().open(ShapeShiftingWin)};TreasureShapeShiftingPanel.prototype.checkBuyHunt=function(type){if(type==0&&ShapeShiftingTreasure.ins().huntFreeTimes>0){this.startHuntAni(type);return}this.huntType=type;var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.ShapeShiftingTreasureConfig.huntItem);if(!(item&&item.count)){var huntOnce=type==0?GlobalConfig.ShapeShiftingTreasureConfig.huntOnce:GlobalConfig.ShapeShiftingTreasureConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureShapeShiftingPanel-HuntResultWin"+type,this.huntWarnFun.bind(this),i18n("TreasureShapeShiftingPanel_1",huntOnce,GlobalConfig.ItemConfig[GlobalConfig.ShapeShiftingTreasureConfig.huntItem].name,type?10:1))}else{this.startHuntAni(type)}};TreasureShapeShiftingPanel.prototype.buyHunt=function(type){if(type==0&&ShapeShiftingTreasure.ins().huntFreeTimes>0){--ShapeShiftingTreasure.ins().huntFreeTimes;ShapeShiftingTreasure.ins().sendHunt(type);return}ShapeShiftingTreasure.ins().sendHunt(type)};TreasureShapeShiftingPanel.prototype.huntWarnFun=function(){var huntOnce=this.huntType==0?GlobalConfig.ShapeShiftingTreasureConfig.huntOnce:GlobalConfig.ShapeShiftingTreasureConfig.huntTenth;if(Actor.yb>=huntOnce){this.startHuntAni(this.huntType)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("TreasureShapeShiftingPanel_2"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("TreasureShapeShiftingPanel_3"))}};TreasureShapeShiftingPanel.prototype.setRedStatu=function(){};TreasureShapeShiftingPanel.prototype.updateBox=function(){var lenBox=ShapeShiftingTreasure.ins().huntBoxInfo.length;var state;var config;var i=0;for(var k in GlobalConfig.ShapeShiftingTreasureRewardConfig){config=GlobalConfig.ShapeShiftingTreasureRewardConfig[k];this["time"+i].text=config.needTime+i18n("TreasureShapeShiftingPanel_4");this["time"+i].visible=true;this["done"+i].visible=false;this["boxPoint"+i].visible=false;this["bar"+i].value=0;this["box"+i].source="treasurehuntboxg";this["box"+i].name="box"+(i+1);if(!this.addBoxEvent)this.addTouchEvent(this["box"+i],this.onGetAward);if(i<lenBox){state=ShapeShiftingTreasure.ins().huntBoxInfo[i];if(state==ShapeShiftingTreasure.CANGET){this["box"+i].source="treasurehuntboxc";this["bar"+i].value=100;this["boxPoint"+i].visible=true}else if(state==ShapeShiftingTreasure.ISNGET){this["time"+i].visible=false;this["done"+i].visible=true;this["bar"+i].value=100}}i++}this.hopeValue0.text=ShapeShiftingTreasure.ins().huntHope+"";this.times.text=ShapeShiftingTreasure.ins().huntTimes+"";this.maskImage();this.updateLuckMc();this.updateRedPoint();var isFree=ShapeShiftingTreasure.ins().huntFreeTimes>0;this.zbHunt1_2.visible=!isFree;this.free.visible=isFree;this.free.text=i18n("TreasureShapeShiftingPanel_5",ShapeShiftingTreasure.ins().huntFreeTimes||0)};TreasureShapeShiftingPanel.prototype.updateLuckMc=function(){var mcGroups=[this.grpLuckMc0,this.grpLuckMc1,this.grpLuckMc2];var curPross=ShapeShiftingTreasure.ins().huntHope;var maxPross=GlobalConfig.ShapeShiftingTreasureConfig.maxBlissVal;var showMc=curPross>=maxPross;if(showMc){this.imgLuckBg.visible=false;var mcNames=["resource/res/eff/xjxb_xyzzieff","resource/res/eff/xjxb_xyzhdeff","resource/res/eff/sjxb_200bxeff"];for(var i=0;i<3;++i){var mcGroup=mcGroups[i];mcGroup.visible=true;if(mcGroup.numChildren==0){var mc=new MovieClip;mc.playFile(mcNames[i],-1);mcGroup.addChild(mc)}mcGroup.getChildAt(0).play(-1)}}else{this.imgLuckBg.visible=true;for(var _i=0,mcGroups_1=mcGroups;_i<mcGroups_1.length;_i++){var mcGroup=mcGroups_1[_i];if(mcGroup.visible){mcGroup.visible=false;if(mcGroup.numChildren>0){mcGroup.getChildAt(0).stop()}}}}};TreasureShapeShiftingPanel.prototype.maskImage=function(){var curPross=ShapeShiftingTreasure.ins().huntHope;var maxPross=GlobalConfig.ShapeShiftingTreasureConfig.maxBlissVal;var percent=curPross/maxPross;percent=percent<1?percent:1;if(percent>=1){if(this.maxHopeValue0.mask)this.maxHopeValue0.mask=null;if(this.maskShape){this.maskShape.graphics.clear();this.maskShape=null}return}if(!this.maxHopeValue0.mask){this.maskShape=new egret.Shape;this.maskShape.graphics.beginFill(16776960);this.maskShape.graphics.drawRect(this.maxHopeValue0.x,this.maxHopeValue0.y,this.maxHopeValue0.width,this.maxHopeValue0.height);this.maxHopeValue0.parent.addChild(this.maskShape);this.maxHopeValue0.mask=this.maskShape}this.maskShape.y=this.maxHopeValue0.height*(1-percent)};TreasureShapeShiftingPanel.prototype.onGetAward=function(e){var index=e.target.name.slice(3,4);var state=ShapeShiftingTreasure.ins().huntBoxInfo[index-1];if(state==ShapeShiftingTreasure.CANGET)ShapeShiftingTreasure.ins().sendHuntAward(index);else ViewManager.ins().open(HuntBoxsTips,index,5)};TreasureShapeShiftingPanel.prototype.updateMaterial=function(){var item=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.ShapeShiftingTreasureConfig.huntItem);var sum=item?item.count:0;this.num1.textFlow=TextFlowMaker.generateTextFlow(i18n("TreasureShapeShiftingPanel_7",sum?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N,sum));this.num10.textFlow=TextFlowMaker.generateTextFlow(i18n("TreasureShapeShiftingPanel_8",sum>=10?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N,sum));this.updateRedPoint()};TreasureShapeShiftingPanel.prototype.updateRedPoint=function(){var count=ShapeShiftingTreasure.ins().getHuntItemNum();this.redPoint3.visible=ShapeShiftingTreasure.ins().canHuntFree();this.redPoint4.visible=ShapeShiftingTreasure.ins().getIsGetTen()};TreasureShapeShiftingPanel.prototype.playItemFlash=function(idxs){for(var _i=0,_a=this.mcSmallItemEffs;_i<_a.length;_i++){var mc=_a[_i];if(mc!=null){mc.visible=false}}var bgs=[this["bgup"],this["bgdown"],this["bgleft"],this["bgright"]];for(var _b=0,idxs_4=idxs;_b<idxs_4.length;_b++){var idx=idxs_4[_b];var mc=this.mcSmallItemEffs[idx];if(mc==null){var item=this["gift"+idx];mc=new MovieClip;mc.playFile("resource/res/eff/sjxb_kuangeff",0);mc.x=item.width/2;mc.y=item.height/2-5;item.addChild(mc);this.mcSmallItemEffs[idx]=mc}mc.visible=true;mc.gotoAndPlay(0,1)}};TreasureShapeShiftingPanel.prototype.startHuntAni=function(type){var _this=this;if(type===void 0){type=0}var tt=200;var tc=8;this.buy1.enabled=false;this.buy10.enabled=false;for(var i=0;i<tc;++i){TimerManager.ins().doTimer(tt*i,1,function(){var idxs=[Math.floor(Math.random()*tc),Math.floor(Math.random()*tc)];if(type==1){idxs.push(Math.floor(Math.random()*tc),Math.floor(Math.random()*tc))}_this.playItemFlash(idxs)},this)}TimerManager.ins().doTimer(tt*tc,1,function(){_this.playItemFlash([]);_this.buyHunt(type)},this)};TreasureShapeShiftingPanel.prototype.playBoxAni=function(){this.playBoxAniIdx+=1;var availBoxIdxs=[];var i=0;var lenBox=ShapeShiftingTreasure.ins().huntBoxInfo.length;for(var k in GlobalConfig.ShapeShiftingTreasureRewardConfig){if(i<lenBox){var state=ShapeShiftingTreasure.ins().huntBoxInfo[i];if(state==ShapeShiftingTreasure.CANGET){availBoxIdxs.push(i)}}i++}if(this.playBoxAniIdx>=availBoxIdxs.length){this.playBoxAniIdx=-2}if(this.playBoxAniIdx<0){return}var pi=availBoxIdxs[this.playBoxAniIdx];var box=this["box"+pi];var boxAni=this["boxAni"+pi];if(boxAni==null){boxAni=new MovieClip;this["boxAni"+pi]=boxAni;boxAni.x=box.x+box.width/2;boxAni.y=box.y+box.height/2;box.parent.addChildAt(boxAni,1);boxAni["__origin_y"]=boxAni.y}boxAni.y=boxAni["__origin_y"];box.alpha=0;boxAni.visible=true;egret.Tween.removeTweens(boxAni);egret.Tween.get(boxAni).to({y:boxAni["__origin_y"]-20},200).to({y:boxAni["__origin_y"]},200).call(function(){box.alpha=1;boxAni.visible=false});boxAni.playFile("resource/res/eff/sjxb_bxsmalleff",1,undefined,false)};TreasureShapeShiftingPanel.prototype.setMC=function(){if(!this.mc){this.mc=new MovieClip;this.mc.playFile(RES_DIR_EFF+"sjxb_sheff",-1);this.effGroup.removeChildren();this.effGroup.addChild(this.mc)}};return TreasureShapeShiftingPanel}(BaseView);__reflect(TreasureShapeShiftingPanel.prototype,"TreasureShapeShiftingPanel");var ItemBaseStore=function(_super){__extends(ItemBaseStore,_super);function ItemBaseStore(){return _super!==null&&_super.apply(this,arguments)||this}ItemBaseStore.prototype.onClick=function(){var uuid=this.data.handle;UserBag.ins().sendGetGoodsByStore(uuid)};return ItemBaseStore}(ItemBase);__reflect(ItemBaseStore.prototype,"ItemBaseStore");var TreasureStorePanel=function(_super){__extends(TreasureStorePanel,_super);function TreasureStorePanel(){var _this=_super.call(this)||this;_this.isTopLevel=true;return _this}TreasureStorePanel.prototype.childrenCreated=function(){this.init()};TreasureStorePanel.prototype.init=function(){this.skinName="TreasureStore";this.list.itemRenderer=ItemBaseStore;this.listScroller.viewport=this.list};TreasureStorePanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.type=param[0];this.addTouchEvent(this.get,this.getGoods);this.observe(UserBag.ins().postHuntStore,this.updateData);this.updateData()};TreasureStorePanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.get,this.getGoods);this.removeObserve()};TreasureStorePanel.prototype.updateData=function(){var datas=UserBag.ins().getHuntGoodsBySort(this.type);this.list.dataProvider=new eui.ArrayCollection(datas)};TreasureStorePanel.prototype.getGoods=function(e){if(this.list.dataProvider.length>0){UserBag.ins().sendGetGoodsByStore(this.type)}};return TreasureStorePanel}(BaseEuiView);__reflect(TreasureStorePanel.prototype,"TreasureStorePanel");ViewManager.ins().reg(TreasureStorePanel,LayerManager.UI_Main);var UserVip=function(_super){__extends(UserVip,_super);function UserVip(){var _this=_super.call(this)||this;_this.weekState=0;_this.vipGiftState=[];_this.vipDailyLogState=0;_this.lv=0;_this.exp=0;_this.sysId=PackageID.Vip;_this.regNetMsg(1,_this.postUpdateVipData);_this.regNetMsg(2,_this.postUpdataExp);_this.regNetMsg(3,_this.postUpdateVipAwards);_this.regNetMsg(4,_this.postUpdateWeekAwards);_this.regNetMsg(5,_this.postVipGiftBuy);_this.regNetMsg(6,_this.postSuperVipInfo);_this.regNetMsg(7,_this.postVipDailyRewards);return _this}UserVip.ins=function(){return _super.ins.call(this)};UserVip.prototype.initLogin=function(){};UserVip.prototype.postSuperVipData=function(data){return data};UserVip.prototype.sendGetAwards=function(lv){var bytes=this.getBytes(1);bytes.writeInt(lv);this.sendToServer(bytes)};UserVip.prototype.sendGetWeekAwards=function(){this.sendBaseProto(4)};UserVip.prototype.sendGetVipGift=function(id){var bytes=this.getBytes(5);bytes.writeByte(id);this.sendToServer(bytes)};UserVip.prototype.sendGetSuperVipInfo=function(){this.sendBaseProto(6)};UserVip.prototype.postUpdateVipData=function(bytes){this.lv=bytes.readShort();this.exp=bytes.readInt();this.state=bytes.readInt();this.weekState=bytes.readShort();var len=bytes.readShort();this.vipGiftState=[];for(var i=0;i<len;i++){var id=bytes.readUnsignedInt();var state=bytes.readByte();var vipGift={id:id,state:state};this.vipGiftState.push(vipGift)}this.vipDailyLogState=bytes.readInt()};UserVip.prototype.postUpdataExp=function(bytes){var lv=bytes.readShort();this.exp=bytes.readInt();this.weekState=bytes.readShort();if(lv>this.lv){this.lv=lv}};UserVip.prototype.postUpdateVipAwards=function(bytes){this.state=bytes.readInt()};UserVip.prototype.postUpdateWeekAwards=function(bytes){var boo=bytes.readBoolean();if(boo){this.weekState=0}};UserVip.prototype.postVipGiftBuy=function(bytes){var len=bytes.readShort();for(var j=0;j<len;j++){var id=bytes.readUnsignedInt();var state=bytes.readByte();for(var i=0;i<this.vipGiftState.length;i++){if(id==this.vipGiftState[i].id){this.vipGiftState[i].state=state}}}};UserVip.prototype.postSuperVipInfo=function(bytes){this.superVip=this.superVip||[];var len=2;for(var i=0;i<len;i++){this.superVip[i]=Math.floor(bytes.readInt()/100)}};UserVip.prototype.getSuperVipState=function(){if(this.superVip){for(var id in GlobalConfig.SuperVipConfig){var config=GlobalConfig.SuperVipConfig[id];var i=+id-1;if(config.money<=(this.superVip[i]||0)){return true}}}return false};UserVip.prototype.getVipState=function(){var bool=false;for(var i=0;i<this.lv;i++){if(this.state!=undefined&&(this.state>>i&1)==0){bool=true;return bool}}return bool};UserVip.prototype.getVipGiftCanBuy=function(id){var config=GlobalConfig.VipGiftConfig[id];if(config.cond){for(var _i=0,_a=config.cond;_i<_a.length;_i++){var i=_a[_i];if((this.vipGiftState[+i-1].state&1)==0){return false}}}return true};UserVip.prototype.getVipGiftIsBuy=function(id){return(this.vipGiftState[id-1].state&1)==1};UserVip.prototype.getVipGiftRedPoint=function(id){var config=GlobalConfig.VipGiftConfig[id];if(this.lv>=config.vipLv){return this.getVipGiftCanBuy(id)&&!this.getVipGiftIsBuy(id)&&config.needYb<=Actor.yb}return false};UserVip.prototype.getVipIndex=function(pageIndex){for(var k in GlobalConfig.VipGiftConfig){var hfTimes=GlobalConfig.VipGiftConfig[k].hfTimes;hfTimes=hfTimes?hfTimes:0;if(hfTimes==pageIndex)return GlobalConfig.VipGiftConfig[k]}return null};UserVip.prototype.checkVipSuccess=function(hfcount){var b=true;for(var k in GlobalConfig.VipGiftConfig){var hfTimes=GlobalConfig.VipGiftConfig[k].hfTimes;hfTimes=hfTimes?hfTimes:0;if(hfTimes==hfcount){var id=GlobalConfig.VipGiftConfig[k].id;if(!this.getVipGiftIsBuy(id)){b=false;break}}}return b};UserVip.prototype.getVipPage=function(){var maxVipPage=[];for(var k in GlobalConfig.VipGiftConfig){var hfTimes=GlobalConfig.VipGiftConfig[k].hfTimes;hfTimes=hfTimes?hfTimes:0;if(GameServer._hefuCount>=hfTimes&&maxVipPage.indexOf(hfTimes)==-1){maxVipPage.push(hfTimes)}}return maxVipPage};UserVip.prototype.canSmeltAll=function(){return UserVip.ins().lv&&UserVip.ins().lv>=GlobalConfig.PrivilegeData.autoSynthetise};UserVip.prototype.sendVipDailyRewards=function(){if(this.lv>0&&this.vipDailyLogState==0){var bytes=this.getBytes(7);this.sendToServer(bytes)}};UserVip.prototype.postVipDailyRewards=function(bytes){var r=bytes.readInt();this.vipDailyLogState=r?r:this.vipDailyLogState};UserVip.prototype.hasVipDailyReward=function(){return this.lv>0&&this.vipDailyLogState==0};return UserVip}(BaseSystem);__reflect(UserVip.prototype,"UserVip");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userVip=UserVip.ins.bind(UserVip)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var Vip3Win=function(_super){__extends(Vip3Win,_super);function Vip3Win(){var _this=_super.call(this)||this;_this.isTopLevel=true;return _this}Vip3Win.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="Vip3Skin";this.artifactEff=new MovieClip;this.artifactEff.x=233;this.artifactEff.y=335;var proportionW=.178;var proportionH=this.height*.556;this.qualityEff1=new MovieClip;this.qualityEff1.x=this.width*proportionW;this.qualityEff1.y=proportionH;this.qualityEff2=new MovieClip;this.qualityEff2.x=this.width*.5;this.qualityEff2.y=proportionH;this.qualityEff3=new MovieClip;this.qualityEff3.x=this.width*(1-proportionW);this.qualityEff3.y=proportionH;this.closeBtn1Eff=new MovieClip;this.closeBtn1Eff.x=this.closeBtn1.x+this.closeBtn1.width/2-2;this.closeBtn1Eff.y=this.closeBtn1.y+this.closeBtn1.height/2+2;this.closeBtn1Eff.touchEnabled=false};Vip3Win.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.closeBtn1,this.onTap);this.addTouchEvent(this.sureBtn,this.onTap);this.qualityEff1.playFile(RES_DIR_EFF+"quality_05",-1);this.addChild(this.qualityEff1);this.qualityEff2.playFile(RES_DIR_EFF+"quality_05",-1);this.addChild(this.qualityEff2);this.qualityEff3.playFile(RES_DIR_EFF+"quality_05",-1);this.addChild(this.qualityEff3);this.closeBtn1Eff.playFile(RES_DIR_EFF+"chongzhi",-1);this.addChild(this.closeBtn1Eff);if(UserVip.ins().lv<3){this.sureBtn.visible=false}else{this.sureBtn.visible=true;this.closeBtn1.visible=false}};Vip3Win.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.closeBtn1,this.onTap);this.removeTouchEvent(this.sureBtn,this.onTap)};Vip3Win.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(Vip3Win);break;case this.closeBtn1:Recharge.ins().tryShowChargeFirstWin();break;case this.sureBtn:ViewManager.ins().open(VipWin);ViewManager.ins().close(Vip3Win);break}};return Vip3Win}(BaseEuiView);__reflect(Vip3Win.prototype,"Vip3Win");ViewManager.ins().reg(Vip3Win,LayerManager.UI_Main);var VipWin=function(_super){__extends(VipWin,_super);function VipWin(){var _this=_super.call(this)||this;_this.barbc=new ProgressBarEff;_this._curLv=0;_this.skinName="VipSkin";return _this}VipWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.isTopLevel=true;this.barbc.setWidth(300);this.barbc.x=88;this.barbc.y=10;this.topGroup.addChild(this.barbc);this.list.itemRenderer=ItemBase;this.list0.itemRenderer=ItemBase;this.mc2=new MovieClip;this.mc2.playFile(RES_DIR_EFF+"vip_zz_eff",-1);this.mc2.x=49;this.mc2.y=50;this.vipGroup.addChild(this.mc2);this.vipValue=BitmapNumber.ins().createNumPic(0,"vip_v",5);this.vipValue.x=32;this.vipValue.y=28;this.vipGroup.addChild(this.vipValue);this.mc3=new MovieClip;this.mc3.playFile(RES_DIR_EFF+"vip_dk_eff",-1);this.mcGroup.addChild(this.mc3)};VipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.topUpBtn,this.onTap);this.addTouchEvent(this.leftBtn,this.onTap);this.addTouchEvent(this.rightBtn,this.onTap);this.addTouchEvent(this.suerBtn,this.onTap);this.addTouchEvent(this.suerBtn0,this.onTap);this.observe(UserVip.ins().postUpdataExp,this.changeExpBar);this.observe(UserVip.ins().postUpdateVipAwards,this.changeAwards);this.observe(UserVip.ins().postUpdateVipData,this.changeAwards);this.observe(UserVip.ins().postUpdateWeekAwards,this.changeAwards);this.barbc.reset();this.changeExpBar();this.changeAwards();this._curLv=param[0]?param[0]:this.getVipLevel();var playPunView=ViewManager.ins().getView(PlayFunView);if(playPunView){if(playPunView.vip.visible)this._curLv=3;playPunView.preVip=playPunView.vip.visible=false}var firstChargeView=ViewManager.ins().getView(Recharge1Win);if(firstChargeView){this._curLv=1}if(this._curLv){var config=GlobalConfig.VipConfig[this._curLv];this.showVipInfo(config)}};VipWin.openCheck=function(){var open=!ChannelMgr.ins().isRechargeHidden();if(!open){UserTips.ins().showCenterTips(i18n("VipWin_13"))}return open};VipWin.prototype.getVipLevel=function(){if(UserVip.ins().lv){for(var i=0;i<UserVip.ins().lv;i++){if(!(UserVip.ins().state>>i&1)){return i+1}}}var maxVipLevel=Object.keys(GlobalConfig.VipConfig).length;if(UserVip.ins().lv>=maxVipLevel-1)return maxVipLevel;return UserVip.ins().lv+1};VipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.topUpBtn,this.onTap);this.removeTouchEvent(this.leftBtn,this.onTap);this.removeTouchEvent(this.rightBtn,this.onTap);this.removeTouchEvent(this.suerBtn,this.onTap);this.removeObserve()};VipWin.prototype.onTap=function(e){var config;switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(VipWin);break;case this.topUpBtn:ViewManager.ins().close(VipWin);Recharge.ins().tryShowChargeFirstWin();break;case this.leftBtn:config=GlobalConfig.VipConfig[--this._curLv];this.showVipInfo(config);break;case this.rightBtn:config=GlobalConfig.VipConfig[++this._curLv];this.showVipInfo(config);break;case this.suerBtn:config=GlobalConfig.VipConfig[this._curLv];var num=0;var awards=config.awards;var len=awards.length;for(var i=0;i<len;i++){if(awards[i].type==1&&awards[i].id<2e5)num++}if(UserBag.ins().getSurplusCount()>=num)UserVip.ins().sendGetAwards(this._curLv);else UserTips.ins().showTips(i18n("VipWin_0"));break;case this.suerBtn0:UserVip.ins().sendGetWeekAwards();break}};VipWin.prototype.showVipInfo=function(config){if(config){this.setAwards(config)}else{this._curLv=UserVip.ins().lv}this.changeBtn()};VipWin.prototype.changeExpBar=function(){var vipData=UserVip.ins();var config=GlobalConfig.VipConfig[vipData.lv];var curLv=0;var curNeedYb=vipData.exp;if(config){curLv=vipData.lv}var nextConfig=GlobalConfig.VipConfig[curLv+1];var nextNeedYb=0;var ybValue=0;var str="";if(nextConfig){nextNeedYb=nextConfig.needYb-curNeedYb;var needYb=nextNeedYb-ybValue;str=i18n("VipWin_1")+nextNeedYb+i18n("VipWin_2")+(vipData.lv+1);this.barbc.setData(curNeedYb,nextConfig.needYb)}else{str=i18n("VipWin_3");this.barbc.setData(curNeedYb,config.needYb);this.barbc.setLbValueText(curNeedYb+"/"+config.needYb)}this.titleLabel.textFlow=TextFlowMaker.generateTextFlow(str);config=GlobalConfig.VipConfig[this._curLv];this.showVipInfo(config)};VipWin.prototype.changeAwards=function(){var config;this._curLv=UserVip.ins().lv;if(this._curLv>=0){for(var i=0;i<this._curLv;i++){if(!this.getRemindByIndex(i)||this.checkWeekReward(i)){config=GlobalConfig.VipConfig[i+1];this._curLv=i+1;this.setAwards(config?config:config=GlobalConfig.VipConfig[--this._curLv]);this.changeBtn();return}}config=GlobalConfig.VipConfig[++this._curLv];this.setAwards(config?config:config=GlobalConfig.VipConfig[--this._curLv]);this.changeBtn()}};VipWin.prototype.setAwards=function(config){this.depictLabel.textFlow=TextFlowMaker.generateTextFlow(config.description);this.list.dataProvider=new eui.ArrayCollection(config.awards);this.list0.dataProvider=new eui.ArrayCollection(config.weekReward);this.vipImg.source=config.vipImg;var curNeedYb=UserVip.ins().exp;var needYb=config.needYb-curNeedYb;var str="";if(needYb>0){str=i18n("VipWin_4")+needYb+i18n("VipWin_5")+config.id}else{str=""}this.more.textFlow=TextFlowMaker.generateTextFlow1(str);var str1=i18n("VipWin_6",config.needYb,config.id);this.show.textFlow=TextFlowMaker.generateTextFlow1(str1);BitmapNumber.ins().changeNum(this.vipValue,UserVip.ins().lv,"vip_v",3);if(UserVip.ins().lv<10){this.vipValue.x=42;this.vipValue.y=28}else{this.vipValue.x=32;this.vipValue.y=28}this.titleText.text=i18n("VipWin_7",this._curLv);this.suerBtn.visible=false;this.suerBtn.enabled=false;if(this.mc){DisplayUtils.removeFromParent(this.mc)}if(this.mc1){DisplayUtils.removeFromParent(this.mc1)}if(this.getRemindByIndex(config.id-1)){this.suerBtn.visible=true;this.suerBtn.label=i18n("VipWin_8")}else{if(UserVip.ins().lv>=config.id){this.suerBtn.visible=true;this.suerBtn.enabled=true;this.suerBtn.label=i18n("VipWin_9");this.mc=this.mc||new MovieClip;this.mc.x=49;this.mc.y=22;this.mc.scaleX=.6;this.mc.scaleY=.85;this.mc.playFile(RES_DIR_EFF+"chargeff1",-1);this.suerBtn.addChild(this.mc)}}if(UserVip.ins().lv==config.id){this.suerBtn0.visible=true;if(UserVip.ins().weekState==0){this.suerBtn0.enabled=false;this.suerBtn0.label=i18n("VipWin_10")}else{this.suerBtn0.enabled=true;this.suerBtn0.label=i18n("VipWin_11");this.mc1=this.mc1||new MovieClip;this.mc1.x=49;this.mc1.y=22;this.mc1.scaleX=.6;this.mc1.scaleY=.85;this.mc1.playFile(RES_DIR_EFF+"chargeff1",-1);this.suerBtn0.addChild(this.mc1)}}else{this.suerBtn0.visible=false;this.suerBtn0.label=i18n("VipWin_12")}};VipWin.prototype.getRemindByIndex=function(index){var uservip=UserVip.ins();var state=uservip.state;if(uservip.lv<=0)return false;return(state>>index&1)==1};VipWin.prototype.checkWeekReward=function(index){if(UserVip.ins().lv<=0)return false;return index+1==UserVip.ins().lv&&UserVip.ins().weekState==1};VipWin.prototype.changeBtn=function(){if(this._curLv>1){this.leftBtn.visible=true;this.rightBtn.visible=true;if(this._curLv>=CommonUtils.getObjectLength(GlobalConfig.VipConfig))this.rightBtn.visible=false}else if(this._curLv<=1){this.leftBtn.visible=false;this.rightBtn.visible=true}};return VipWin}(BaseEuiView);__reflect(VipWin.prototype,"VipWin");ViewManager.ins().reg(VipWin,LayerManager.UI_Main);var SuperVipWin=function(_super){__extends(SuperVipWin,_super);function SuperVipWin(){var _this=_super.call(this)||this;_this.skinName="gsvipSkin";return _this}SuperVipWin.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.pey,this.onTap);this.addTouchEvent(this.copy,this.onTap);this.observe(UserVip.ins().postSuperVipInfo,this.initView);UserVip.ins().sendGetSuperVipInfo();this.initView()};SuperVipWin.prototype.initView=function(){if(UserVip.ins().getSuperVipState()){this.qqtxt.text=UserVip.ins().superVipData?""+UserVip.ins().superVipData.data.qq:"";this.nopay0.visible=false;this.nopay1.visible=false;this.copy.visible=true;this.pay0.visible=true}else{this.qqtxt.text="??????";this.nopay0.visible=true;this.nopay1.visible=true;this.copy.visible=false;this.pay0.visible=false}if(UserVip.ins().superVip){for(var id in GlobalConfig.SuperVipConfig){var i=+id-1;var config=GlobalConfig.SuperVipConfig[id];this["cond"+i].text="("+(UserVip.ins().superVip[i]||0)+"/"+config.money+")"}}};SuperVipWin.prototype.onTap=function(e){var tar=e.currentTarget;switch(tar){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.pey:Recharge.ins().tryShowChargeFirstWin();ViewManager.ins().close(this);break;case this.copy:if(window.prompt){if(DeviceUtils.IsMobile)window.prompt(i18n("SuperVipWin_0"),UserVip.ins().superVipData.data.qq+"");else window.prompt(i18n("SuperVipWin_1"),UserVip.ins().superVipData.data.qq+"")}break}};return SuperVipWin}(BaseEuiView);__reflect(SuperVipWin.prototype,"SuperVipWin");ViewManager.ins().reg(SuperVipWin,LayerManager.UI_Popup);var Vip3MWin=function(_super){__extends(Vip3MWin,_super);function Vip3MWin(){var _this=_super.call(this)||this;_this.skinName="Vip3Skin";_this.isTopLevel=true;return _this}Vip3MWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.pay,this.onTouchBtn);this.addTouchEvent(this.closeBtn,this.onTouchBtn);this.addTouchEvent(this.closeBtn0,this.onTouchBtn);var vipIndex=param[0];this.init(vipIndex)};Vip3MWin.prototype.init=function(vipIndex){var vconfig=GlobalConfig.VipConfig[vipIndex];for(var i=0;i<3;i++){this["gift"+i].data=vconfig.awards[i+1].id;var power=this.getPower(vconfig.awards[i+1].id,i);this["power"+i].setPower(power)}this.pay.label=UserVip.ins().lv<3?i18n("Vip3MWin_0"):i18n("Vip3MWin_1");this.setIconEff()};Vip3MWin.prototype.setIconEff=function(){if(!this.mc)this.mc=new MovieClip;if(!this.mc.parent)this.mcGroup.addChild(this.mc);this.mc.playFile(RES_DIR_EFF+"mabi",-1);var power=0;var ringConfig=GlobalConfig.ExRing0Config[1];power=UserBag.getAttrPower(ringConfig.attrAward);power+=ringConfig.power;this.powerPanel.setPower(power)};Vip3MWin.prototype.getPower=function(id,pos){var power=0;var config=GlobalConfig.EquipConfig[id];if(!config)return power;var transfrom=["hp","atk","def","res"];var totalAttr=[];var idx=0;FOR:for(var k in config){for(var i in transfrom){if(transfrom[i]==k&&config[k]){var value=config[k];if(value==undefined||value==0)continue;var type=Role.getAttrTypeByName(k);var attrs=new AttributeData;var attrStr="";attrStr+=AttributeData.getAttrStrByType(type)+":";attrStr+=config[k];attrs.type=type;attrs.value=config[k];totalAttr.push(attrs);if(!idx)this["at"+pos].text=attrStr;else if(idx==1)this["att"+pos].text=attrStr;idx++;if(idx>1)break FOR}}}power=Math.floor(UserBag.getAttrPower(totalAttr));return power};Vip3MWin.prototype.onTouchBtn=function(e){switch(e.target){case this.pay:this.onBtn();break;case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};Vip3MWin.prototype.onBtn=function(){if(UserVip.ins().lv<3){Recharge.ins().tryShowChargeFirstWin();ViewManager.ins().close(this);return}ViewManager.ins().open(VipWin,3);ViewManager.ins().close(this)};return Vip3MWin}(BaseEuiView);__reflect(Vip3MWin.prototype,"Vip3MWin");ViewManager.ins().reg(Vip3MWin,LayerManager.UI_Main);var VipDailyLogItem=function(_super){__extends(VipDailyLogItem,_super);function VipDailyLogItem(){var _this=_super.call(this)||this;_this.skinName="VipDailyLogItemSkin";return _this}VipDailyLogItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};VipDailyLogItem.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var data=this.data;this.reward.dataProvider=new eui.ArrayCollection(data.dailyReward);var num=BitmapNumber.ins().createNumPic(data.id,"j1");this.vipLvGroup.removeChildren();this.vipLvGroup.addChild(num);data.id==UserVip.ins().lv;this.bg.source=data.id==UserVip.ins().lv?"marry_gift3":"scitembg"};return VipDailyLogItem}(BaseItemRender);__reflect(VipDailyLogItem.prototype,"VipDailyLogItem");var VipDailyLogPanel=function(_super){__extends(VipDailyLogPanel,_super);function VipDailyLogPanel(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var _this=_super.call(this)||this;_this.skinName="VipDailyLogPanelSkin";_this.initUI();return _this}VipDailyLogPanel.prototype.initUI=function(){this.tip1.textFlow=TextFlowMaker.generateTextFlow1(i18n("VipDailyLogPanel_1"))};VipDailyLogPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.dailyReward.itemRenderer=VipDailyLogItem;this.dataProvider=new eui.ArrayCollection;this.dailyReward.dataProvider=this.dataProvider};VipDailyLogPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.rewardBtn,this.onTap);this.addTouchEvent(this.tip1,this.onTap);this.observe(UserVip.ins().postUpdateVipData,this.updateShow);this.observe(UserVip.ins().postVipDailyRewards,this.updateBtn);this.updateShow()};VipDailyLogPanel.prototype.updateShow=function(){this.updateBtn();this.updateList()};VipDailyLogPanel.prototype.updateBtn=function(){if(UserVip.ins().lv<=0){this.tip0.visible=false;this.noVipTip.visible=true;this.rewardBtn.skin.currentState="disabled";this.rewardBtn.touchEnabled=false;this.rewardBtn.label=i18n("VipDailyLogPanel_3");this.redPoint.visible=false}else{if(UserVip.ins().vipDailyLogState==0){this.tip0.visible=true;this.tip0.text=i18n("VipDailyLogPanel_2",UserVip.ins().lv);this.noVipTip.visible=false;this.rewardBtn.skin.currentState="up";this.rewardBtn.touchEnabled=true;this.rewardBtn.label=i18n("VipDailyLogPanel_3");this.redPoint.visible=true}else if(UserVip.ins().vipDailyLogState==1){this.tip0.visible=true;this.tip0.text=i18n("VipDailyLogPanel_2",UserVip.ins().lv);this.noVipTip.visible=false;this.rewardBtn.skin.currentState="disabled";this.rewardBtn.touchEnabled=false;this.rewardBtn.label=i18n("VipDailyLogPanel_4");this.redPoint.visible=false}}};VipDailyLogPanel.prototype.updateList=function(){this.datas=[];var curVip;for(var key in GlobalConfig.VipConfig){if(UserVip.ins().lv==GlobalConfig.VipConfig[key].id){curVip=GlobalConfig.VipConfig[key]}else{this.datas.push(GlobalConfig.VipConfig[key])}}if(curVip)this.datas.push(curVip);this.datas.reverse();this.dataProvider.replaceAll(this.datas)};VipDailyLogPanel.prototype.onTap=function(e){switch(e.currentTarget){case this.rewardBtn:UserVip.ins().sendVipDailyRewards();break;case this.tip1:ViewManager.ins().open(VipWin);break}};VipDailyLogPanel.prototype.close=function(){this.removeTouchEvent(this.rewardBtn,this.onTap);this.removeTouchEvent(this.tip1,this.onTap);this.removeObserve()};return VipDailyLogPanel}(BaseView);__reflect(VipDailyLogPanel.prototype,"VipDailyLogPanel");var VipGiftBtnRender=function(_super){__extends(VipGiftBtnRender,_super);function VipGiftBtnRender(){var _this=_super.call(this)||this;_this.skinName="VipGiftBtnSkin";return _this}VipGiftBtnRender.prototype.dataChanged=function(){var data=this.data;this.item.source=data.img;this.viptxt.text="v"+data.vipLv;var isShowEff=UserVip.ins().getVipGiftRedPoint(data.id);if(isShowEff){if(!this.mc){this.mc=new MovieClip;this.mc.x=40;this.mc.y=42}this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1);this.addChild(this.mc)}else{DisplayUtils.removeFromParent(this.mc);this.mc=null}this.redPoint.visible=isShowEff};return VipGiftBtnRender}(BaseItemRender);__reflect(VipGiftBtnRender.prototype,"VipGiftBtnRender");var VipGiftItemView=function(_super){__extends(VipGiftItemView,_super);function VipGiftItemView(){var _this=_super.call(this)||this;_this.skinName="VipGiftItemSkin";return _this}VipGiftItemView.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.reward.itemRenderer=ItemBase};VipGiftItemView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curId=param[0]||1;this.updateData();this.close();this.addTouchEvent(this.getBtn,this.onGet);this.observe(UserVip.ins().postVipGiftBuy,this.updateData)};VipGiftItemView.prototype.close=function(){this.removeTouchEvent(this,this.onGet);this.removeObserve()};VipGiftItemView.prototype.onGet=function(){var config=GlobalConfig.VipGiftConfig[this.curId];if(UserVip.ins().lv<config.vipLv){var warnWin=WarnWin.show(i18n("VipGiftItemView_1"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("VipGiftItemView_2"),i18n("VipGiftItemView_3"));return}if(Actor.yb<config.needYb){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("VipGiftItemView_4"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("VipGiftItemView_5"));return}if(UserBag.ins().getSurplusCount()<=0){UserTips.ins().showTips(i18n("VipGiftItemView_6"));return}UserVip.ins().sendGetVipGift(this.curId)};VipGiftItemView.prototype.updateData=function(){var config=GlobalConfig.VipGiftConfig[this.curId];var awards=config.awards;this.reward.dataProvider=new eui.ArrayCollection(awards.concat());this.ggtxt.source=config.adImg;this.tu.source=config.bgImg;this.getBtn.visible=UserVip.ins().getVipGiftCanBuy(this.curId)&&!UserVip.ins().getVipGiftIsBuy(this.curId);this.getBtn.label=config.needYb+i18n("VipGiftItemView_7");this.redPoint.visible=UserVip.ins().getVipGiftRedPoint(this.curId);this.already.visible=UserVip.ins().getVipGiftIsBuy(this.curId)};return VipGiftItemView}(BaseView);__reflect(VipGiftItemView.prototype,"VipGiftItemView");var VipGiftPanel=function(_super){__extends(VipGiftPanel,_super);function VipGiftPanel(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var _this=_super.call(this)||this;_this.curIndex=param[0]?param[0]:0;_this.skinName="VipGift"+_this.curIndex+"Skin";return _this}VipGiftPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};VipGiftPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.curIndex=param[0]?param[0]:0;this.menuList.itemRenderer=VipGiftBtnRender;this.addTouchEvent(this.leftBtn,this.onTouchBtn);this.addTouchEvent(this.rightBtn,this.onTouchBtn);this.addEvent(eui.ItemTapEvent.ITEM_TAP,this.menuList,this.onTouchMenu);this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange);this.observe(UserVip.ins().postVipGiftBuy,this.onUpdate);this.roleSelect.setState("nohead");this.updateMenu();this.setDefault()};VipGiftPanel.prototype.onTouchMenu=function(e){SoundUtil.ins().playEffect(SoundUtil.WINDOW);this.setGiftId(e.item.id)};VipGiftPanel.prototype.onChange=function(){if(this.menuList.scrollH<20){this.leftBtn.visible=false;this.rightBtn.visible=true}else if(this.menuList.scrollH>(this.menuList.dataProvider.length-5)*88+2){this.leftBtn.visible=true;this.rightBtn.visible=false}else{this.leftBtn.visible=true;this.rightBtn.visible=true}if(this.menuList.dataProvider.length<=5){this.leftBtn.visible=false;this.rightBtn.visible=false}};VipGiftPanel.prototype.updateMenu=function(){var configs=GlobalConfig.VipGiftConfig;var arr=[];for(var id in configs){var hfTimes=configs[id].hfTimes?configs[id].hfTimes:0;if(this.curIndex==hfTimes)arr.push(configs[id])}arr.sort(function(a,b){return a.id<b.id?-1:1});this.menuList.dataProvider=new eui.ArrayCollection(arr);this.menuList.validateNow()};VipGiftPanel.prototype.setDefault=function(){var _this=this;var startId=0;var endId=Object.keys(GlobalConfig.VipGiftConfig).length;for(var k in GlobalConfig.VipGiftConfig){var hfTimes=GlobalConfig.VipGiftConfig[k].hfTimes;hfTimes=hfTimes?hfTimes:0;if(hfTimes==this.curIndex){if(!startId){startId=GlobalConfig.VipGiftConfig[k].id}endId=+k}}var state=UserVip.ins().vipGiftState;var defId=endId;for(var id=startId?startId:1;id<=endId;id++){if((state[id-1].state&1)==0){defId=id;break}}this.setGiftId(defId);startId=startId?startId:1;var menuIndex=defId-startId;this.menuList.selectedIndex=menuIndex;TimerManager.ins().doNext(function(){var scroH=menuIndex*92;if(scroH>_this.menuList.contentWidth-_this.menuScroller.width){scroH=_this.menuList.contentWidth-_this.menuScroller.width}_this.menuList.scrollH=scroH;_this.onChange()},this)};VipGiftPanel.prototype.onTouchBtn=function(e){var num=92*5;var scrollH=0;switch(e.target){case this.leftBtn:scrollH=this.menuList.scrollH-num;scrollH=Math.round(scrollH/92)*92;if(scrollH<0){scrollH=0}this.menuList.scrollH=scrollH;break;case this.rightBtn:scrollH=this.menuList.scrollH+num;scrollH=Math.round(scrollH/92)*92;if(scrollH>this.menuList.contentWidth-this.menuScroller.width){scrollH=this.menuList.contentWidth-this.menuScroller.width}this.menuList.scrollH=scrollH;break}this.onChange()};VipGiftPanel.prototype.onUpdate=function(){var arr=this.menuList.dataProvider;for(var i=0;i<arr.length;i++){arr.itemUpdated(arr.getItemAt(i))}this.setDefault()};VipGiftPanel.prototype.setGiftId=function(id){this.vipGiftItem.open(id)};VipGiftPanel.prototype.close=function(){this.vipGiftItem.close();this.menuList.dataProvider=new eui.ArrayCollection;this.removeObserve();this.removeTouchEvent(this.leftBtn,this.onTouchBtn);this.removeTouchEvent(this.rightBtn,this.onTouchBtn)};return VipGiftPanel}(BaseView);__reflect(VipGiftPanel.prototype,"VipGiftPanel");var VipGiftWin=function(_super){__extends(VipGiftWin,_super);function VipGiftWin(){var _this=_super.call(this)||this;_this.VipPanelList=[];_this.skinName="VipGiftMainSkin";_this.isTopLevel=true;return _this}VipGiftWin.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};VipGiftWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addChangeEvent(this.tab,this.onTabTouch);this.addChangingEvent(this.tab,this.onTabTouching);this.addTouchEvent(this.closeBtn,this.onTouch);this.observe(UserVip.ins().postVipGiftBuy,this.updateRedPoint);this.curIndex=param[0]?param[0]:0;this.checkIndex();this.create();this.updateView()};VipGiftWin.prototype.checkIndex=function(){var page=UserVip.ins().getVipPage();if(UserVip.ins().checkVipSuccess(page[this.curIndex])){for(var i=0;i<page.length;i++){if(this.curIndex==i)continue;var hfcount=page[i];if(UserVip.ins().checkVipSuccess(hfcount))continue;this.curIndex=i;break}}};VipGiftWin.prototype.updateView=function(){this.VipPanelList[this.curIndex].open(this.curIndex);this.tab.selectedIndex=this.viewStack.selectedIndex=this.curIndex;this.updateRedPoint();var maxVipPage=UserVip.ins().getVipPage();for(var i=0;i<maxVipPage.length;i++){var hfcount=maxVipPage[i];var b=UserVip.ins().checkVipSuccess(hfcount);if(b){DisplayUtils.removeFromParent(this.VipPanelList[i]);DisplayUtils.removeFromParent(this["redPoint"+i])}}};VipGiftWin.prototype.updateRedPoint=function(){var maxVipPage=UserVip.ins().getVipPage();for(var i=0;i<maxVipPage.length;i++){var hfcount=maxVipPage[i];this["redPoint"+i].visible=false;for(var k in GlobalConfig.VipGiftConfig){var hfTimes=GlobalConfig.VipGiftConfig[k].hfTimes?GlobalConfig.VipGiftConfig[k].hfTimes:0;if(hfcount!=hfTimes)continue;this["redPoint"+i].visible=UserVip.ins().getVipGiftRedPoint(GlobalConfig.VipGiftConfig[k].id);if(this["redPoint"+i].visible)break}}};VipGiftWin.prototype.onTabTouching=function(e){if(!this.checkIsOpen(e.currentTarget.selectedIndex)){e.preventDefault();return}};VipGiftWin.prototype.onTouch=function(e){ViewManager.ins().close(this)};VipGiftWin.prototype.onTabTouch=function(e){this.setOpenIndex(e.currentTarget.selectedIndex)};VipGiftWin.prototype.setOpenIndex=function(selectedIndex){this.VipPanelList[selectedIndex].open(this.hfcount[selectedIndex])};VipGiftWin.prototype.checkIsOpen=function(index){if(index>GameServer._hefuCount){UserTips.ins().showTips(i18n("VipGiftWin_0",index));return false}return true};VipGiftWin.prototype.close=function(){for(var i=0;i<this.VipPanelList.length;i++){this.VipPanelList[i].close()}};VipGiftWin.prototype.create=function(){this.viewStack.removeChildren();this.redPointGroup.removeChildren();this.hfcount=UserVip.ins().getVipPage();for(var i=0;i<this.hfcount.length;i++){var panel=new VipGiftPanel(this.hfcount[i]);if(!panel)continue;panel.top=0;panel.left=0;panel.bottom=0;panel.right=0;var config=UserVip.ins().getVipIndex(this.hfcount[i]);if(config)panel.name=config.pageName?config.pageName:"";this.VipPanelList[i]=panel;this.viewStack.addChild(this.VipPanelList[i]);this.redPointGroup.addChild(this["redPoint"+i]);this["redPoint"+i].visible=false}};VipGiftWin.prototype.getVipPanel=function(index){for(var i=0;i<this.VipPanelList.length;i++){if(this.VipPanelList[i].curIndex==index){return this.VipPanelList[i]}}return null};return VipGiftWin}(BaseEuiView);__reflect(VipGiftWin.prototype,"VipGiftWin");ViewManager.ins().reg(VipGiftWin,LayerManager.UI_Main);var UserWarn=function(_super){__extends(UserWarn,_super);function UserWarn(){return _super.call(this)||this}UserWarn.ins=function(){return _super.ins.call(this)};UserWarn.prototype.setWarnLabel=function(str,callBackFun,callBackFun2,statu,align){if(statu===void 0){statu="normal"}if(align===void 0){align="left"}var rtn=ViewManager.ins().open(WarnWin);rtn.setWarnLabel(str,callBackFun,callBackFun2,statu,align);return rtn};UserWarn.prototype.setBuyGoodsWarn=function(id,num){if(num===void 0){num=1}var rtn=ViewManager.ins().open(ShopGoodsWarn);rtn.setData(id,num);return rtn};return UserWarn}(BaseSystem);__reflect(UserWarn.prototype,"UserWarn");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userWarn=UserWarn.ins.bind(UserWarn)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var WelcomWinSys=function(_super){__extends(WelcomWinSys,_super);function WelcomWinSys(){var _this=_super.call(this)||this;_this.sysId=PackageID.Promote;_this.regNetMsg(20,_this.postWelcomeResult);return _this}WelcomWinSys.ins=function(){return _super.ins.call(this)};WelcomWinSys.prototype.sendGetWelcomeReward=function(){var bytes=this.getBytes(20);this.sendToServer(bytes)};WelcomWinSys.prototype.postWelcomeResult=function(bytes){var isSuccess=bytes.readInt();if(isSuccess==0){var stage=StageUtils.ins().getStage();MainAniMgr.ins().playExplode(RES_DIR_EFF+"yuanbaofly_eff",60,stage.stageWidth/2,stage.stageHeight/2)}};return WelcomWinSys}(BaseSystem);__reflect(WelcomWinSys.prototype,"WelcomWinSys");var BagAddItemWarn=function(_super){__extends(BagAddItemWarn,_super);function BagAddItemWarn(){return _super.call(this)||this}BagAddItemWarn.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="OpenCellSkin";this.price.setType(MoneyConst.yuanbao)};BagAddItemWarn.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.decBtn,this.onTap);this.addTouchEvent(this.addBtn,this.onTap);this.addTouchEvent(this.sureBtn,this.onTap);this.addTouchEvent(this.cancelBtn,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.setCount(5)};BagAddItemWarn.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.decBtn,this.onTap);this.removeTouchEvent(this.addBtn,this.onTap);this.removeTouchEvent(this.sureBtn,this.onTap);this.removeTouchEvent(this.cancelBtn,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap)};BagAddItemWarn.prototype.onTap=function(e){switch(e.currentTarget){case this.decBtn:this.setCount(Number(this.count.text)-5);break;case this.addBtn:this.setCount(Number(this.count.text)+5);break;case this.sureBtn:if(Actor.yb>=this.price.getPrice()){UserBag.ins().sendAddBagGrid(Number(this.count.text)/5)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("BagAddItemWarn_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("BagAddItemWarn_1"))}ViewManager.ins().close(this);break}case this.cancelBtn:case this.closeBtn:ViewManager.ins().close(BagAddItemWarn);break;case this.bgClose:ViewManager.ins().close(BagAddItemWarn);break}};BagAddItemWarn.prototype.setCount=function(num){var config=GlobalConfig.BagBaseConfig;var bagExConfig=GlobalConfig.BagExpandConfig;var bagExConfigLen=CommonUtils.getObjectLength(bagExConfig);var row=(UserBag.ins().bagNum-config.baseSize)/config.rowSize;var canOpenNum=(bagExConfigLen-row)*config.rowSize;if(num<5){num=5;UserTips.ins().showTips(i18n("BagAddItemWarn_2"))}else if(num>canOpenNum){num=canOpenNum;UserTips.ins().showTips(i18n("BagAddItemWarn_3"))}this.count.text=""+num;var ybNum=0;var len=num/config.rowSize;for(var i=1;i<=len;i++){ybNum+=bagExConfig[row+i].cost}this.price.setPrice(ybNum)};return BagAddItemWarn}(BaseEuiView);__reflect(BagAddItemWarn.prototype,"BagAddItemWarn");ViewManager.ins().reg(BagAddItemWarn,LayerManager.UI_Popup);var BagFullTipsWin=function(_super){__extends(BagFullTipsWin,_super);function BagFullTipsWin(){var _this=_super.call(this)||this;_this.skinName="FullBagSkin";return _this}BagFullTipsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.sureBtn,this.onTap);var num=20;if(param[0])num=param[0];this.numText.text=""+num};BagFullTipsWin.prototype.close=function(){this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.sureBtn,this.onTap)};BagFullTipsWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.sureBtn:ViewManager.ins().close(this);ViewManager.ins().open(SmeltEquipTotalWin);break}};return BagFullTipsWin}(BaseEuiView);__reflect(BagFullTipsWin.prototype,"BagFullTipsWin");ViewManager.ins().reg(BagFullTipsWin,LayerManager.UI_Popup);var DisplayPolicyWin=function(_super){__extends(DisplayPolicyWin,_super);function DisplayPolicyWin(){return _super.call(this)||this}DisplayPolicyWin.show=function(strs,title,func,thisObj,func2,thisObj2,statu,align){if(func2===void 0){func2=null}if(thisObj2===void 0){thisObj2=null}if(statu===void 0){statu="normal"}if(align===void 0){align="left"}var rtn=this.setWarnLabel2(strs,title,{func:func,thisObj:thisObj},{func2:func2,thisObj2:thisObj2},statu,align);return rtn};DisplayPolicyWin.setWarnLabel2=function(strs,title,callBackFun,callBackFun2,statu,align){if(statu===void 0){statu="normal"}if(align===void 0){align="left"}var rtn=ViewManager.ins().open(DisplayPolicyWin);rtn.setWarnLabel(strs,callBackFun,callBackFun2,statu,align);rtn.labelTitle.text=title;return rtn};DisplayPolicyWin.prototype.showUI=function(icon1,label1,icon2,label2){this.leftGroup.visible=false;this.icon1.visible=false;this.label1.visible=false;this.rightGroup.visible=false;this.icon2.visible=false;this.label2.visible=false;if(icon1||label1){this.leftGroup.visible=true;if(icon1){this.icon1.visible=true;this.icon1.source=icon1}if(label1){this.label1.visible=true;this.label1.text=label1}}if(icon2||label2){this.rightGroup.visible=true;if(icon2){this.icon2.visible=true;this.icon2.source=icon2}if(label2){this.label2.visible=true;this.label2.text=label2}}};DisplayPolicyWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="DisplayPolicyWinSkin"};DisplayPolicyWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.sureBtn,this.onTap);this.addTouchEvent(this.notBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.cbx,this.onTap);Main.reposUI(this);this.bgClose.width=StageUtils.ins().getStage().width+10;this.cbx.selected=SysSetting.ins().getBool(SysSetting.DICE)};DisplayPolicyWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.sureBtn,this.onTap);this.removeTouchEvent(this.notBtn,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.cbx,this.onTap)};DisplayPolicyWin.prototype.onTap=function(e){switch(e.currentTarget){case this.sureBtn:if(this.callBack.func!=null)this.callBack.func.call(this.callBack.thisObj);break;case this.notBtn:case this.bgClose:if(this.calback2.func2){this.calback2.func2.call(this.calback2.thisObj2)}break;case this.cbx:SysSetting.ins().setBool(SysSetting.DICE,e.currentTarget.selected);break}if(e.currentTarget!=this.cbx)if(typeof Js2JavaInterface!="undefined"){if(Js2JavaInterface.saveScreenShoot){}else{ViewManager.ins().close(DisplayPolicyWin)}}else{ViewManager.ins().close(DisplayPolicyWin)}};Object.defineProperty(DisplayPolicyWin.prototype,"isShowWin",{get:function(){return this._isShowWin},set:function(bool){if(this._isShowWin==bool)return;this._isShowWin=bool},enumerable:true,configurable:true});DisplayPolicyWin.prototype.setWarnLabel=function(strs,callbackFunc,calbackFun2,statu,align){if(calbackFun2===void 0){calbackFun2=null}if(statu===void 0){statu="normal"}if(align===void 0){align="left"}var labels=[this.warnLabel1,this.warnLabel2,this.warnLabel3,this.warnLabel4,this.warnLabel5,this.warnLabel6,this.warnLabel7];var y=labels[0].y;for(var i=0,c=Math.min(labels.length,strs.length);i<c;++i){var lbl=labels[i];var str=strs[i];if(ChannelMgr.ins().isAWYCChannel()||ChannelMgr.ins().isFKYLCChannel()){str=str.replace(/力港武林盟主/g,i18n("DisplayPolicyWin_20"))}else if(ChannelMgr.ins().isWXSmallGameChannel1()){str=str.replace(/力港武林盟主/g,i18n("DisplayPolicyWin_21"))}else if(ChannelMgr.ins().isAnQiGeChannel()){str=str.replace(/力港武林盟主/g,i18n("DisplayPolicyWin_22"))}else if(ChannelMgr.ins().isQQDaTingChannel()||ChannelMgr.ins().isQQZoneChannel()){str=str.replace(/力港武林盟主/g,i18n("DisplayPolicyWin_23"))}else if(ChannelMgr.ins().isWXSmallGameChannel2()){str=str.replace(/力港武林盟主/g,i18n("DisplayPolicyWin_24"))}else if(ChannelMgr.ins().isWXSmallGameChannel3()){str=str.replace(/力港武林盟主/g,i18n("DisplayPolicyWin_25"))}lbl.textFlow=TextFlowMaker.generateTextFlow1(str);lbl.textAlign=align;lbl.y=y;y+=lbl.height}this.callBack=callbackFunc;this.calback2=calbackFun2;this.currentState=statu};DisplayPolicyWin.prototype.setBtnLabel=function(leftTxt,rightTxt){if(leftTxt)this.sureBtn.label=leftTxt;if(rightTxt)this.notBtn.label=rightTxt};return DisplayPolicyWin}(BaseEuiView);__reflect(DisplayPolicyWin.prototype,"DisplayPolicyWin");var GainGoodsItem=function(_super){__extends(GainGoodsItem,_super);function GainGoodsItem(){var _this=_super.call(this)||this;_this.skinName="GainGoodsItemSkin";_this.graycolor=12761776;return _this}GainGoodsItem.prototype.dataChanged=function(){this.greencolor=this.desc.textColor;this.norcolor=this.desc2.textColor;this.desc.text=this.data[0]};GainGoodsItem.prototype.gainData=function(isOpen,stars,condition){this.stars.visible=true;if(!isOpen){this.desc.textColor=this.graycolor;this.desc2.textColor=this.graycolor;if(condition){var str="";if(condition.needZs)str+=i18n("GainGoodsItem_0",condition.needZs);if(condition.needLv)str+=i18n("GainGoodsItem_1",condition.needLv);if(condition.guanka)str+=i18n("GainGoodsItem_2",condition.guanka);this.desc2.text=str}this.dir.visible=false;for(var i=1;i<=5;i++){this["star"+i].visible=false}}else{for(var i=1;i<=5;i++){this["star"+i].visible=i<=stars}}};Object.defineProperty(GainGoodsItem.prototype,"userData",{get:function(){return this.data},enumerable:true,configurable:true});return GainGoodsItem}(BaseItemRender);__reflect(GainGoodsItem.prototype,"GainGoodsItem");var GainGoodsItem1=function(_super){__extends(GainGoodsItem1,_super);function GainGoodsItem1(){var _this=_super.call(this)||this;_this.skinName="GainGoodsItemSkin";return _this}GainGoodsItem1.prototype.dataChanged=function(){var newData=this.data;this.desc.text=newData.str};Object.defineProperty(GainGoodsItem1.prototype,"userData",{get:function(){return this.data},enumerable:true,configurable:true});return GainGoodsItem1}(BaseItemRender);__reflect(GainGoodsItem1.prototype,"GainGoodsItem1");var GainGoodsNoSkinItem=function(_super){__extends(GainGoodsNoSkinItem,_super);function GainGoodsNoSkinItem(){return _super.call(this)||this}GainGoodsNoSkinItem.prototype.dataChanged=function(){this.desc.text=this.data[0]};Object.defineProperty(GainGoodsNoSkinItem.prototype,"userData",{get:function(){return this.data},enumerable:true,configurable:true});return GainGoodsNoSkinItem}(BaseItemRender);__reflect(GainGoodsNoSkinItem.prototype,"GainGoodsNoSkinItem");var SaveNewCountWin=function(_super){__extends(SaveNewCountWin,_super);function SaveNewCountWin(){return _super.call(this)||this}SaveNewCountWin.show=function(str,func,thisObj,func2,thisObj2,statu,align){if(func2===void 0){func2=null}if(thisObj2===void 0){thisObj2=null}if(statu===void 0){statu="normal"}if(align===void 0){align="center"}var rtn=this.setWarnLabel2(str,{func:func,thisObj:thisObj},{func2:func2,thisObj2:thisObj2},statu,align);return rtn};SaveNewCountWin.setWarnLabel2=function(str,callBackFun,callBackFun2,statu,align){if(statu===void 0){statu="normal"}if(align===void 0){align="left"}var rtn=ViewManager.ins().open(SaveNewCountWin);rtn.setWarnLabel(str,callBackFun,callBackFun2,statu,align);return rtn};SaveNewCountWin.prototype.showUI=function(icon1,label1,icon2,label2){this.leftGroup.visible=false;this.icon1.visible=false;this.label1.visible=false;this.rightGroup.visible=false;this.icon2.visible=false;this.label2.visible=false;if(icon1||label1){this.leftGroup.visible=true;if(icon1){this.icon1.visible=true;this.icon1.source=icon1}if(label1){this.label1.visible=true;this.label1.text=label1}}if(icon2||label2){this.rightGroup.visible=true;if(icon2){this.icon2.visible=true;this.icon2.source=icon2}if(label2){this.label2.visible=true;this.label2.text=label2}}};SaveNewCountWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="saveNewCountWinSkin"};SaveNewCountWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.sureBtn,this.onTap);this.addTouchEvent(this.notBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.cbx,this.onTap);Main.reposUI(this);this.bgClose.width=StageUtils.ins().getStage().width+10;this.cbx.selected=SysSetting.ins().getBool(SysSetting.DICE)};SaveNewCountWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.sureBtn,this.onTap);this.removeTouchEvent(this.notBtn,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.cbx,this.onTap)};SaveNewCountWin.prototype.onTap=function(e){switch(e.currentTarget){case this.sureBtn:if(this.callBack.func!=null)this.callBack.func.call(this.callBack.thisObj);break;case this.notBtn:if(this.calback2.func2){this.calback2.func2.call(this.calback2.thisObj2)}break;case this.cbx:SysSetting.ins().setBool(SysSetting.DICE,e.currentTarget.selected);break}if(e.currentTarget!=this.cbx){if(JsNativeCallMgr.hasMethod("saveScreenShoot")){}else{var closeTime=500;egret.Tween.removeTweens(this.groupAll);egret.Tween.get(this.bgClose).to({alpha:0},closeTime*.9);var endX=0,endY=0;var startGameWin=ViewManager.ins().getView(StartGameWin);if(startGameWin){var btn=startGameWin.btnViewAccount;var ptStage=btn.localToGlobal(btn.width/2,btn.height/2);var ptGroup=this.groupAll.parent.globalToLocal(ptStage.x,ptStage.y);endX=ptGroup.x-(this.groupAll.x+this.groupAll.width/2);endY=ptGroup.y-(this.groupAll.y+this.groupAll.height/2)}egret.Tween.get(this.groupAll).to({scaleX:0,scaleY:0,horizontalCenter:endX,verticalCenter:endY},closeTime,egret.Ease.cubicOut).call(function(){ViewManager.ins().close(SaveNewCountWin)},this)}}};Object.defineProperty(SaveNewCountWin.prototype,"isShowWin",{get:function(){return this._isShowWin},set:function(bool){if(this._isShowWin==bool)return;this._isShowWin=bool},enumerable:true,configurable:true});SaveNewCountWin.prototype.setWarnLabel=function(str,callbackFunc,calbackFun2,statu,align){if(calbackFun2===void 0){calbackFun2=null}if(statu===void 0){statu="normal"}if(align===void 0){align="left"}this.warnLabel.textFlow=TextFlowMaker.generateTextFlow(str);this.callBack=callbackFunc;this.calback2=calbackFun2;this.currentState=statu;this.warnLabel.textAlign=align};SaveNewCountWin.prototype.setBtnLabel=function(leftTxt,rightTxt){if(leftTxt)this.sureBtn.label=leftTxt;if(rightTxt)this.notBtn.label=rightTxt};return SaveNewCountWin}(BaseEuiView);__reflect(SaveNewCountWin.prototype,"SaveNewCountWin");var ShopGoodsWarn=function(_super){__extends(ShopGoodsWarn,_super);function ShopGoodsWarn(){return _super.call(this)||this}ShopGoodsWarn.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GainGoodsSkin";this.gainList.itemRenderer=GainGoodsItem;this.countTxt.restrict="0-9";this.price.setType(MoneyConst.yuanbao);this.totalPrice.setType(MoneyConst.yuanbao);this.itemIcon.imgJob.visible=false};ShopGoodsWarn.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.decBtn,this.onTap);this.addTouchEvent(this.addBtn,this.onTap);this.addTouchEvent(this.dec10Btn,this.onTap);this.addTouchEvent(this.add10Btn,this.onTap);this.addTouchEvent(this.buyBtn,this.onTap);this.addTouchEvent(this.buyBtn0,this.onTap);this.addTouchEvent(this.topUpBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.closeBtn,this.onTap);this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.addChangeEvent(this.countTxt,this.onTxtChange);this.observe(Shop.ins().postBuyResult,this.buyCallBack);if(ChannelMgr.ins().isRechargeHidden()){this.buyBtn0.visible=true;this.buyBtn.visible=false;this.topUpBtn.visible=false;this.desc.text=i18n("ShopGoodsWarn_12")}else{this.buyBtn0.visible=false;this.buyBtn.visible=true;this.topUpBtn.visible=true;this.desc.text=i18n("ShopGoodsWarn_11")}};ShopGoodsWarn.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.removeTouchEvent(this.decBtn,this.onTap);this.removeTouchEvent(this.addBtn,this.onTap);this.removeTouchEvent(this.dec10Btn,this.onTap);this.removeTouchEvent(this.add10Btn,this.onTap);this.removeTouchEvent(this.buyBtn,this.onTap);this.removeTouchEvent(this.buyBtn0,this.onTap);this.removeTouchEvent(this.topUpBtn,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap);this.countTxt.removeEventListener(egret.TouchEvent.CHANGE,this.onTxtChange,this)};ShopGoodsWarn.prototype.onTap=function(e){switch(e.currentTarget){case this.decBtn:this.setTotalPrice(this._totalNum-1);break;case this.addBtn:this.setTotalPrice(this._totalNum+1);break;case this.dec10Btn:this.setTotalPrice(this._totalNum-10);break;case this.add10Btn:this.setTotalPrice(this._totalNum+10);break;case this.buyBtn:case this.buyBtn0:if(Actor.yb>=this.totalPrice.getPrice()){Shop.ins().sendBuy(1,[[this._goodsId,this._totalNum]])}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("ShopGoodsWarn_0"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("ShopGoodsWarn_1"))}ViewManager.ins().close(this)}break;case this.topUpBtn:var rdata=Recharge.ins().getRechargeData(0);if(!rdata||rdata.num!=2){ViewManager.ins().close(ShopGoodsWarn);ViewManager.ins().open(Recharge1Win)}else{ViewManager.ins().open(ChargeFirstWin)}break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(ShopGoodsWarn);break}};ShopGoodsWarn.prototype.onTouchList=function(e){var item=e.item;if(e.item==null){return}var openSuccess=ViewManager.ins().viewOpenCheck(item[1],item[2]);if(openSuccess){var isShow=true;if(item[1]=="Recharge2Win"){var rdata=Recharge.ins().getRechargeData(0);if(!rdata||!rdata.num){isShow=false;ViewManager.ins().open(Recharge1Win)}}if(isShow&&item[1]!=""){if(item[0]&&(item[0].indexOf("GuildBoss")!=-1||item[1]=="GuildWarMainWin")){if(Guild.ins().guildID==undefined||Guild.ins().guildID==0){item[1]="GuildApplyWin"}}GameGuider.guidance(item[1],item[2],item[3])}ViewManager.ins().close(ShopGoodsWarn);ViewManager.ins().close(BookUpWin);ViewManager.ins().close(WeaponPanel);ViewManager.ins().close(WeaponSoulBreakWin);if(item[1]!="HeirloomCom")ViewManager.ins().close(HeirloomCom);if(item[1]=="LadderWin")ViewManager.ins().close(ForgeWin);if(item[1]=="PlayFunView"){ViewManager.ins().close(ShopWin)}}};ShopGoodsWarn.prototype.buyCallBack=function(num){if(num>0){ViewManager.ins().close(ShopGoodsWarn)}else{var warnWin=WarnWin.show(i18n("ShopGoodsWarn_3"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("ShopGoodsWarn_4"));ViewManager.ins().close(this)}};ShopGoodsWarn.prototype.onTxtChange=function(e){var num=Number(this.countTxt.text);this.setTotalPrice(num)};ShopGoodsWarn.prototype.setData=function(id,num){var shopConfig;if(id>2e4){var itemConfig=GlobalConfig.ItemConfig[id];this.itemIcon.setData(itemConfig);this.nameTxt.text=""+itemConfig.name;this.nameTxt.textColor=ItemConfig.getQualityColor(itemConfig);this.nameTxt.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);shopConfig=ItemStoreConfig.getStoreByItemID(id);this.titleTxt.text=i18n("ShopGoodsWarn_5")}else{this.itemIcon.setData(null);switch(id){case MoneyConst.gold:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[id];this.nameTxt.text=RewardData.CURRENCY_NAME[id];this.titleTxt.text=i18n("ShopGoodsWarn_6");break;case MoneyConst.soul:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[id];this.nameTxt.text=RewardData.CURRENCY_NAME[id];this.titleTxt.text=i18n("ShopGoodsWarn_7");break;case 7:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[id];this.nameTxt.text=RewardData.CURRENCY_NAME[id];this.titleTxt.text=i18n("ShopGoodsWarn_8");break;case 8:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[id];this.nameTxt.text=RewardData.CURRENCY_NAME[id];this.titleTxt.text=i18n("ShopGoodsWarn_9");break;case MoneyConst.weiWang:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[id];this.nameTxt.text=RewardData.CURRENCY_NAME[id];this.titleTxt.text=i18n("ShopGoodsWarn_10");break}this.nameTxt.textColor=16758826}var gainConfig=GlobalConfig.GainItemConfig[id];var listHeight=0;if(gainConfig){this.gainList.dataProvider=new eui.ArrayCollection(gainConfig.gainWay);listHeight=gainConfig.gainWay.length*60}else{this.gainList.dataProvider=new eui.ArrayCollection([])}if(shopConfig){this.goodsGroup.visible=true;this.nameTxt.x=225;this.nameTxt.y=170;this.nameTxt.textAlign="center";this.itemIcon.x=145;this.frame.height=410+listHeight;this.gainListGroup.y=352;this._goodsId=shopConfig.id;this.price.setPrice(shopConfig.price);this.setTotalPrice(num)}else{this.goodsGroup.visible=false;this.nameTxt.x=182;this.nameTxt.y=200;this.nameTxt.textAlign="center";this.itemIcon.x=172;this.frame.height=340+listHeight;this.gainListGroup.y=280}};ShopGoodsWarn.prototype.setTotalPrice=function(num){if(num<=0)this._totalNum=1;else if(num>=1e4)this._totalNum=9999;else this._totalNum=num;this.countTxt.text=this._totalNum+"";this.totalPrice.setPrice(this._totalNum*this.price.getPrice())};return ShopGoodsWarn}(BaseEuiView);__reflect(ShopGoodsWarn.prototype,"ShopGoodsWarn");ViewManager.ins().reg(ShopGoodsWarn,LayerManager.UI_Popup);var SubmitIDWin=function(_super){__extends(SubmitIDWin,_super);function SubmitIDWin(){return _super.call(this)||this}SubmitIDWin.show=function(str,func,thisObj,func2,thisObj2,statu,align){if(func2===void 0){func2=null}if(thisObj2===void 0){thisObj2=null}if(statu===void 0){statu="normal"}if(align===void 0){align="center"}var rtn=this.setWarnLabel2(str,{func:func,thisObj:thisObj},{func2:func2,thisObj2:thisObj2},statu,align);return rtn};SubmitIDWin.setWarnLabel2=function(str,callBackFun,callBackFun2,statu,align){if(statu===void 0){statu="normal"}if(align===void 0){align="left"}var rtn=ViewManager.ins().open(SubmitIDWin);rtn.setWarnLabel(str,callBackFun,callBackFun2,statu,align);return rtn};SubmitIDWin.prototype.showUI=function(icon1,label1,icon2,label2){this.leftGroup.visible=false;this.icon1.visible=false;this.label1.visible=false;this.rightGroup.visible=false;this.icon2.visible=false;this.label2.visible=false;if(icon1||label1){this.leftGroup.visible=true;if(icon1){this.icon1.visible=true;this.icon1.source=icon1}if(label1){this.label1.visible=true;this.label1.text=label1}}if(icon2||label2){this.rightGroup.visible=true;if(icon2){this.icon2.visible=true;this.icon2.source=icon2}if(label2){this.label2.visible=true;this.label2.text=label2}}};SubmitIDWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="SubmitIDWinSkin"};SubmitIDWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.sureBtn,this.onTap);this.addTouchEvent(this.notBtn,this.onTap);this.showReward();this.setTouchEnable();Main.reposUI(this);this.bgClose.width=StageUtils.ins().getStage().width+10;if(ChannelMgr.ins().getDistEnv()!="prd"){this.inputID.text="110101199003076990";this.inputName.text="名字"}};SubmitIDWin.prototype.setTouchEnable=function(){this.listReward.touchChildren=false};SubmitIDWin.prototype.showReward=function(){var list=this.listReward;list.itemRenderer=ItemBase;list.dataProvider=new ArrayCollection([]);var data=[];var rnrc=GlobalConfig.getConfigByName("RealNameRewardConfig");for(var id in rnrc){if(rnrc[id]&&rnrc[id].reward){var reward=rnrc[id].reward;for(var _i=0,reward_1=reward;_i<reward_1.length;_i++){var v=reward_1[_i];data.push(v)}}break}var dp=list.dataProvider;dp.replaceAll(data)};SubmitIDWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.sureBtn,this.onTap);this.removeTouchEvent(this.notBtn,this.onTap)};SubmitIDWin.prototype.checkIDCard=function(idcode){var weight_factor=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2];var check_code=["1","0","X","9","8","7","6","5","4","3","2"];var code=idcode+"";var last=idcode[17];var seventeen=code.substring(0,17);var arr=seventeen.split("");var len=arr.length;var num=0;for(var i=0;i<len;i++){num=num+parseInt(arr[i])*weight_factor[i]}var resisue=num%11;var last_no=check_code[resisue];var idcard_patter=/^[1-9][0-9]{5}([1][9][0-9]{2}|[2][0][0|1][0-9])([0][1-9]|[1][0|1|2])([0][1-9]|[1|2][0-9]|[3][0|1])[0-9]{3}([0-9]|[X])$/;var format=idcard_patter.test(idcode);return last===last_no&&format?true:false};SubmitIDWin.prototype.isHanChinese=function(s){var pattern=new RegExp("[一-龥]+");return pattern.test(s)};SubmitIDWin.prototype.checkInput=function(){var namestr=this.inputName.text.trim();var idstr=this.inputID.text.trim();if(namestr==""){return i18n("SubmitIDWin_0")}if(!this.isHanChinese(namestr)){return i18n("SubmitIDWin_1")}if(idstr==""){return i18n("SubmitIDWin_2")}if(!this.checkIDCard(idstr)){return i18n("SubmitIDWin_3")}return null};SubmitIDWin.prototype.onTap=function(e){switch(e.currentTarget){case this.sureBtn:var errInfo=this.checkInput();if(errInfo!=null){this.labelHint.text=errInfo;return}var namestr=this.inputName.text.trim();var idstr=this.inputID.text.trim();LoginMgr.ins().sendSubmitRealName(namestr,idstr);if(this.callBack.func!=null){this.callBack.func.call(this.callBack.thisObj)}break;case this.notBtn:if(this.calback2.func2){this.calback2.func2.call(this.calback2.thisObj2)}break}ViewManager.ins().close(SubmitIDWin)};Object.defineProperty(SubmitIDWin.prototype,"isShowWin",{get:function(){return this._isShowWin},set:function(bool){if(this._isShowWin==bool)return;this._isShowWin=bool},enumerable:true,configurable:true});SubmitIDWin.prototype.setWarnLabel=function(str,callbackFunc,calbackFun2,statu,align){if(calbackFun2===void 0){calbackFun2=null}if(statu===void 0){statu="normal"}if(align===void 0){align="left"}this.callBack=callbackFunc;this.calback2=calbackFun2;this.currentState=statu};SubmitIDWin.prototype.setBtnLabel=function(leftTxt,rightTxt){if(leftTxt)this.sureBtn.label=leftTxt;if(rightTxt)this.notBtn.label=rightTxt};return SubmitIDWin}(BaseEuiView);__reflect(SubmitIDWin.prototype,"SubmitIDWin");var WarnWin=function(_super){__extends(WarnWin,_super);function WarnWin(){return _super.call(this)||this}WarnWin.show=function(str,func,thisObj,func2,thisObj2,statu,align){if(func2===void 0){func2=null}if(thisObj2===void 0){thisObj2=null}if(statu===void 0){statu="normal"}if(align===void 0){align="center"}var rtn=UserWarn.ins().setWarnLabel(str,{func:func,thisObj:thisObj},{func2:func2,thisObj2:thisObj2},statu,align);return rtn};WarnWin.prototype.showUI=function(icon1,label1,icon2,label2){this.leftGroup.visible=false;this.icon1.visible=false;this.label1.visible=false;this.rightGroup.visible=false;this.icon2.visible=false;this.label2.visible=false;if(icon1||label1){this.leftGroup.visible=true;if(icon1){this.icon1.visible=true;this.icon1.source=icon1}if(label1){this.label1.visible=true;this.label1.text=label1}}if(icon2||label2){this.rightGroup.visible=true;if(icon2){this.icon2.visible=true;this.icon2.source=icon2}if(label2){this.label2.visible=true;this.label2.text=label2}}};WarnWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="warnFrameSkin"};WarnWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.sureBtn,this.onTap);this.addTouchEvent(this.notBtn,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.cbx,this.onTap);this.cbx.selected=false};WarnWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.sureBtn,this.onTap);this.removeTouchEvent(this.notBtn,this.onTap);this.removeTouchEvent(this.bgClose,this.onTap);this.removeTouchEvent(this.cbx,this.onTap)};WarnWin.prototype.onTap=function(e){switch(e.currentTarget){case this.sureBtn:if(this.callBack.func!=null)this.callBack.func.call(this.callBack.thisObj);break;case this.notBtn:case this.bgClose:if(this.calback2.func2){this.calback2.func2.call(this.calback2.thisObj2)}break;case this.cbx:SysSetting.ins().setBool(SysSetting.DICE,e.currentTarget.selected);break}if(e.currentTarget!=this.cbx)ViewManager.ins().close(WarnWin)};Object.defineProperty(WarnWin.prototype,"isShowWin",{get:function(){return this._isShowWin},set:function(bool){if(this._isShowWin==bool)return;this._isShowWin=bool},enumerable:true,configurable:true});WarnWin.prototype.setWarnLabel=function(str,callbackFunc,calbackFun2,statu,align){if(calbackFun2===void 0){calbackFun2=null}if(statu===void 0){statu="normal"}if(align===void 0){align="left"}this.warnLabel.textFlow=TextFlowMaker.generateTextFlow(str);this.callBack=callbackFunc;this.calback2=calbackFun2;this.currentState=statu;this.warnLabel.textAlign=align};WarnWin.prototype.setBtnLabel=function(leftTxt,rightTxt){if(leftTxt)this.sureBtn.label=leftTxt;if(rightTxt)this.notBtn.label=rightTxt};return WarnWin}(BaseEuiView);__reflect(WarnWin.prototype,"WarnWin");ViewManager.ins().reg(WarnWin,LayerManager.UI_Popup);var WelcomePanel2=function(_super){__extends(WelcomePanel2,_super);function WelcomePanel2(){var _this=_super.call(this)||this;_this.TYPE_SEX=1;_this.TYPE_ROLE=2;_this.skinName="welcomeSkin2";return _this}WelcomePanel2.prototype.initUI=function(){_super.prototype.initUI.call(this)};WelcomePanel2.prototype.createChildren=function(){_super.prototype.createChildren.call(this);this.validateNow()};WelcomePanel2.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.sureBtn,this.onTap);this.showUI();this.playEff()};WelcomePanel2.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTap);egret.Tween.removeTweens(this.aniGroup)};WelcomePanel2.prototype.showUI=function(){var config=GlobalConfig.Welcome2Reward;this.name0.text=config[1].title;this.name1.text=config[2].title;this.name2.text=config[3].title;this.initWord(config);this.initGroup0(config[1]);this.initGroup1(config[2]);this.initGroup2(config[3])};WelcomePanel2.prototype.initWord=function(config){var roleData=SubRoles.ins().getSubRoleByIndex(0);var firstjob=roleData.job;for(var i=0;i<3;i++){this["word"+i].text=config[i+1]["words"+firstjob]}};WelcomePanel2.prototype.initGroup2=function(config){this.itemMc20.removeChildren();this.itemMc21.removeChildren();this.itemMc22.removeChildren();this.itemMc23.removeChildren();this.itemMc24.removeChildren();var mc20=new MovieClip;var mc21=new MovieClip;var mc22=new MovieClip;var mc23=new MovieClip;var mc24=new MovieClip;this.itemMc20.addChild(mc20);this.itemMc21.addChild(mc21);this.itemMc22.addChild(mc22);this.itemMc23.addChild(mc23);this.itemMc24.addChild(mc24);mc20.playFile(config.value1,-1);mc21.playFile(config.value2,-1);mc22.playFile(config.value3,-1);mc23.playFile(config.value4,-1);mc24.playFile(config.value5,-1)};WelcomePanel2.prototype.initGroup1=function(config){var roleData=SubRoles.ins().getSubRoleByIndex(0);var firstjob=roleData.job;this.itemMc10.removeChildren();var mc10=new MovieClip;this.itemMc10.addChild(mc10);mc10.playFile(config["value"+firstjob],-1)};WelcomePanel2.prototype.initGroup0=function(config){var roleData=SubRoles.ins().getSubRoleByIndex(0);var firstsex=roleData.sex;for(var i=0;i<3;i++){this["itemMc0"+i].removeChildren();if(i==0){var mc00=new MovieClip;this["itemMc0"+i].addChild(mc00);mc00.playFile(config.value1,-1)}else if(i==1){var mc01=new MovieClip;this["itemMc0"+i].addChild(mc01);if(firstsex==0){mc01.playFile(config.value2,-1)}else{mc01.playFile(config.value3,-1)}}else if(i==2){var mc02=new MovieClip;this["itemMc0"+i].addChild(mc02);if(firstsex==0){mc02.playFile(config.value4,-1)}else{mc02.playFile(config.value5,-1)}}}};WelcomePanel2.prototype.onTap=function(e){var _this=this;this.sureBtn.visible=false;var tw=egret.Tween.get(this.aniGroup);var endPoint=this.location;if(endPoint){var p=endPoint.localToGlobal();this.sureGroup.globalToLocal(p.x,p.y,p);tw.to({scaleX:0,scaleY:0,x:p.x,y:p.y},500).call(function(){ViewManager.ins().close(WelcomePanel2);var stage=StageUtils.ins().getStage();MainAniMgr.ins().playExplode(RES_DIR_EFF+"yuanbaofly_eff",60,stage.stageWidth/2,stage.stageHeight/2);var awards=_this.getRewardDataList(GlobalConfig.WelcomeConfig);RewardWin.show(awards,RewardWin.TYPE_GXHD2)})}if(this.eff){DisplayUtils.removeFromParent(this.eff);this.eff=null}};WelcomePanel2.prototype.getRewardDataList=function(cfgList){var list=[];list=list.concat(cfgList.reward);return list};WelcomePanel2.prototype.playEff=function(){var self=this;if(!this.eff){this.eff=new MovieClip;this.eff.x=this.effgroup.width/2;this.eff.y=this.effgroup.height/2;this.effgroup.addChild(this.eff)}this.eff.playFile(RES_DIR_EFF+"gamestarbtn",-1,null,true,function(){self.btn.visible=false})};return WelcomePanel2}(BaseEuiView);__reflect(WelcomePanel2.prototype,"WelcomePanel2");ViewManager.ins().reg(WelcomePanel2,LayerManager.UI_Popup);var WelcomeWin=function(_super){__extends(WelcomeWin,_super);function WelcomeWin(){var _this=_super.call(this)||this;_this.skinName="welcomePanelSkin";return _this}WelcomeWin.prototype.initUI=function(){_super.prototype.initUI.call(this);var reward=GlobalConfig.WelcomeConfig.reward;this.list.itemRenderer=ItemBase;this.list.dataProvider=new ArrayCollection(reward)};WelcomeWin.prototype.createChildren=function(){_super.prototype.createChildren.call(this);this.validateNow()};WelcomeWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.sureBtn,this.onTap);this.playEff()};WelcomeWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTap);egret.Tween.removeTweens(this.aniGroup)};WelcomeWin.prototype.onTap=function(e){this.sureBtn.visible=false;var tw=egret.Tween.get(this.aniGroup);var endPoint=this.location;if(endPoint){var p=endPoint.localToGlobal();this.sureGroup.globalToLocal(p.x,p.y,p);tw.to({scaleX:0,scaleY:0,x:p.x,y:p.y},500).call(function(){ViewManager.ins().close(WelcomeWin)})}if(this.eff){DisplayUtils.removeFromParent(this.eff);this.eff=null}Hint.ins().postWelcome();ViewManager.ins().open(WelcomePanel2)};WelcomeWin.prototype.playEff=function(){var self=this;if(!this.eff){this.eff=new MovieClip;this.eff.x=this.effgroup.width/2;this.eff.y=this.effgroup.height/2;this.effgroup.addChild(this.eff)}this.eff.playFile(RES_DIR_EFF+"gamestarbtnlqjl",-1,null,true,function(){self.btn.visible=false})};return WelcomeWin}(BaseEuiView);__reflect(WelcomeWin.prototype,"WelcomeWin");ViewManager.ins().reg(WelcomeWin,LayerManager.UI_Popup);var Weapons=function(_super){__extends(Weapons,_super);function Weapons(){var _this=_super.call(this)||this;_this.sysId=PackageID.Weapons;_this.regNetMsg(0,_this.postWeaponsInfo);_this.regNetMsg(1,_this.postWeaponsUpLevel);_this.regNetMsg(2,_this.postWeaponsAct);_this.regNetMsg(3,_this.postWeaponsUse);_this.regNetMsg(4,_this.postWeaponsFlexibleAct);_this.regNetMsg(5,_this.postWeaponsFlexibleCount);return _this}Weapons.ins=function(){return _super.ins.call(this)};Weapons.prototype.checkRedPoint=function(roleId){if(!OpenSystem.ins().checkSysOpen(SystemType.WEAPONS)){return false}var role=SubRoles.ins().getSubRoleByIndex(roleId);for(var k in GlobalConfig.WeaponSoulConfig){var wsconfig=GlobalConfig.WeaponSoulConfig[k];if(role.weapons.getRedPointBySuit(wsconfig.id))return true}var fb=ForgeRedPoint.ins().getFlexibleRedPoint(roleId);if(fb)return true;var item=UserBag.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid);if(item&&role.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum)return true;return false};Weapons.prototype.checkIsUseFlexible=function(roleId,id){var role=SubRoles.ins().getSubRoleByIndex(roleId);if(role.weapons.getFlexibleData().indexOf(id)!=-1){return true}return false};Weapons.prototype.sendWeaponsUpLevel=function(roleId,slot){var bytes=this.getBytes(1);bytes.writeByte(roleId);bytes.writeShort(slot);this.sendToServer(bytes)};Weapons.prototype.sendWeaponsAct=function(roleId,weaponId){var bytes=this.getBytes(2);bytes.writeByte(roleId);bytes.writeShort(weaponId);this.sendToServer(bytes)};Weapons.prototype.sendWeaponsUse=function(roleId,weaponId){var bytes=this.getBytes(3);bytes.writeByte(roleId);bytes.writeShort(weaponId);this.sendToServer(bytes)};Weapons.prototype.sendWeaponsFlexibleAct=function(roleId,control,weaponId){var bytes=this.getBytes(4);bytes.writeByte(roleId);bytes.writeByte(control);bytes.writeShort(weaponId);this.sendToServer(bytes)};Weapons.prototype.sendWeaponsFlexibleCount=function(roleId){var bytes=this.getBytes(5);bytes.writeByte(roleId);this.sendToServer(bytes)};Weapons.prototype.postWeaponsInfo=function(bytes){var roleId=bytes.readUnsignedByte();var role=SubRoles.ins().getSubRoleByIndex(roleId);role.weapons.parser(bytes)};Weapons.prototype.postWeaponsUpLevel=function(bytes){var roleId=bytes.readUnsignedByte();var role=SubRoles.ins().getSubRoleByIndex(roleId);role.weapons.parserInfoOnly(bytes)};Weapons.prototype.postWeaponsAct=function(bytes){var roleId=bytes.readUnsignedByte();var role=SubRoles.ins().getSubRoleByIndex(roleId);role.weapons.parserSoulInfoOnly(bytes,roleId)};Weapons.prototype.postWeaponsUse=function(bytes){var roleId=bytes.readUnsignedByte();var role=SubRoles.ins().getSubRoleByIndex(roleId);role.weapons.weaponsId=bytes.readShort();var mainRole=EntityManager.ins().getEntityByHandle(role.handle);if(mainRole)mainRole.updateModel()};Weapons.prototype.postWeaponsFlexibleAct=function(bytes){var roleId=bytes.readUnsignedByte();var control=bytes.readUnsignedByte();var id=bytes.readShort();var role=SubRoles.ins().getSubRoleByIndex(roleId);var weapons=role.weapons.getFlexibleData();if(control==WeaponFlex.act){if(weapons.indexOf(id)==-1)weapons.push(id)}else{for(var i=0;i<weapons.length;i++){if(weapons[i]==id){weapons.splice(i,1);break}}}};Weapons.prototype.postWeaponsFlexibleCount=function(bytes){var roleId=bytes.readByte();var flexibleCount=bytes.readShort();var role=SubRoles.ins().getSubRoleByIndex(roleId);if(role){role.weapons.flexibleCount=flexibleCount?flexibleCount+1:0}};return Weapons}(BaseSystem);__reflect(Weapons.prototype,"Weapons");var WeaponFlex;(function(WeaponFlex){WeaponFlex[WeaponFlex["act"]=0]="act";WeaponFlex[WeaponFlex["cancel"]=1]="cancel"})(WeaponFlex||(WeaponFlex={}));window["WeaponFlex"]=WeaponFlex;var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.weapons=Weapons.ins.bind(Weapons)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var WeaponsData=function(){function WeaponsData(){var configIds=Object.keys(GlobalConfig.WeaponSoulConfig);this.WeaponsSoulInfoData={};for(var i=0;i<configIds.length;i++){var index=configIds[i];var info=new WeaponsSoulInfo;this.WeaponsSoulInfoData[index]=info}configIds=Object.keys(GlobalConfig.WeaponSoulPosConfig);this.WeaponsInfoData={};for(var i=0;i<configIds.length;i++){var index=configIds[i];if(!this.WeaponsInfoData[index])this.WeaponsInfoData[index]={}}this.WeaponsFlexibleInfoData=[];this.weaponsId=0;this.flexibleCount=0}WeaponsData.prototype.getSuitConfig=function(id){var winfos=this.getInfoData();var minLv=0;var everyLv=false;var soulConfig=GlobalConfig.WeaponSoulConfig[id];for(var z=0;z<soulConfig.actcond.length;z++){var slot=soulConfig.actcond[z];everyLv=true;if(!Object.keys(winfos[slot]).length)everyLv=false;else for(var k in winfos[slot]){var info=winfos[slot][k];if(z==0)minLv=info.level;if(!info.level){everyLv=false;break}if(info.level<=minLv)minLv=info.level}if(!everyLv)break}var suitConfig;if(everyLv){var minSuitId="";for(var i in GlobalConfig.WeaponSoulSuit[id]){if(minLv>=Number(i))minSuitId=i;else break}if(minSuitId)suitConfig=GlobalConfig.WeaponSoulSuit[id][minSuitId]}var result=new WeaponSoulSuit;for(var k in suitConfig){result[k]=suitConfig[k]}result.level=minLv;return result};WeaponsData.prototype.getNextSuitConfig=function(id){var curConfig=this.getSuitConfig(id);var nextConfig;if(!curConfig)curConfig=GlobalConfig.WeaponSoulSuit[id][0];for(var i in GlobalConfig.WeaponSoulSuit[id]){if(GlobalConfig.WeaponSoulSuit[id][i].level>curConfig.level){nextConfig=GlobalConfig.WeaponSoulSuit[id][i];break}}return nextConfig};WeaponsData.prototype.parser=function(bytes){this.parserInfo(bytes);this.parserSoulInfo(bytes);this.parserWeaponFlexibleInfo(bytes)};WeaponsData.prototype.parserInfo=function(bytes){var len=bytes.readShort();for(var i=0;i<len;i++){var id=bytes.readShort();var level=bytes.readInt();this.WeaponsInfoData[id]={};var info=new WeaponsInfo;info.setInfo(id,level);this.WeaponsInfoData[id][level]=info}};WeaponsData.prototype.parserSoulInfo=function(bytes){var len=bytes.readShort();for(var i=0;i<len;i++){var id=bytes.readShort();this.WeaponsSoulInfoData[id].setSoulInfo(id)}};WeaponsData.prototype.parserWeaponFlexibleInfo=function(bytes){var len=bytes.readShort();for(var i=0;i<len;i++){var id=bytes.readShort();this.WeaponsFlexibleInfoData.push(id)}this.flexibleCount=bytes.readShort();if(this.flexibleCount)this.flexibleCount++};WeaponsData.prototype.parserInfoOnly=function(bytes){var id=bytes.readShort();var level=bytes.readInt();this.WeaponsInfoData[id]={};var info=new WeaponsInfo;info.setInfo(id,level);this.WeaponsInfoData[id][level]=info};WeaponsData.prototype.parserSoulInfoOnly=function(bytes,roleId){var id=bytes.readShort();if(id>0){this.WeaponsSoulInfoData[id].setSoulInfo(id);var role=SubRoles.ins().getSubRoleByIndex(roleId);if(role){var eff=this.WeaponsSoulInfoData[id].inside[role.job-1];if(eff){ViewManager.ins().close(WeaponPanel);RewardWin.showAct(0,this.WeaponsSoulInfoData[id].name,"weapsdao_png",true,function(){var view=ViewManager.ins().getView(ForgeWin);if(view&&view.weaponsoul){ViewManager.ins().open(WeaponPanel,view.weaponsoul.roleId,view.weaponsoul.weaponId)}},eff)}}}};WeaponsData.prototype.getRedPointBySuit=function(id){var wsconfig=GlobalConfig.WeaponSoulConfig[id];if(!wsconfig)return false;if(!this.WeaponsSoulInfoData[id].id&&this.IsActivityWeapon(id)){return true}for(var k in wsconfig.actcond){var slot=wsconfig.actcond[k];var level=this.getInfoLevel(slot);var wspconfig=GlobalConfig.WeaponSoulPosConfig[slot][level];var need=wspconfig.costNum;var nextwspconfig=GlobalConfig.WeaponSoulPosConfig[slot][level+1];if(!need||!nextwspconfig)continue;var itemData=UserBag.ins().getBagItemById(wspconfig.costItem);var costItemLen=itemData?itemData.count:0;if(costItemLen>=need)return true}return this.IsHaveAndNotWear(id)};WeaponsData.prototype.IsHaveAndNotWear=function(id){if(!this.weaponsId){for(var i in this.WeaponsSoulInfoData){var info=this.WeaponsSoulInfoData[i];if(id){if(id==info.id)return true}else{if(info.id)return true}}}return false};WeaponsData.prototype.getInfoLevel=function(id){var level=0;if(!this.WeaponsInfoData[id])return 0;for(var j in this.WeaponsInfoData[id]){level=this.WeaponsInfoData[id][j].level;break}return level};WeaponsData.prototype.getSlotByInfo=function(id){var wsinfo;if(!this.WeaponsInfoData[id])return wsinfo;for(var j in this.WeaponsInfoData[id]){wsinfo=this.WeaponsInfoData[id][j];break}return wsinfo};WeaponsData.prototype.getWeapsInfoBySoulId=function(id){var wsinfo=this.WeaponsSoulInfoData[id];return wsinfo};WeaponsData.prototype.IsActivityWeapon=function(id){var wsconfig=GlobalConfig.WeaponSoulConfig[id];if(wsconfig){for(var i=0;i<wsconfig.actcond.length;i++){var slot=wsconfig.actcond[i];if(!CommonUtils.getObjectLength(this.WeaponsInfoData[slot]))return false}return true}return false};WeaponsData.prototype.getInfoData=function(){return this.WeaponsInfoData};WeaponsData.prototype.getSoulInfoData=function(){return this.WeaponsSoulInfoData};WeaponsData.prototype.getFlexibleData=function(){return this.WeaponsFlexibleInfoData};return WeaponsData}();__reflect(WeaponsData.prototype,"WeaponsData");var WeaponsInfo=function(){function WeaponsInfo(){this.id=0;this.level=0;this.costItem=0;this.costNum=0;this.showlv=0;this.assault=0;this.icon="";this.name="";this.attr=[];this.ex_attr=[]}WeaponsInfo.prototype.setInfo=function(slot,lv){if(slot>0&&lv>0){var wConfig=GlobalConfig.WeaponSoulPosConfig[slot][lv];if(!wConfig)return;this.id=wConfig.id;this.level=wConfig.level;this.costItem=wConfig.costItem;this.costNum=wConfig.costNum;this.showlv=wConfig.showlv;this.assault=wConfig.assault;this.icon=wConfig.icon;this.name=wConfig.name;this.attr=wConfig.attr;this.ex_attr=wConfig.ex_attr}};return WeaponsInfo}();__reflect(WeaponsInfo.prototype,"WeaponsInfo");var WeaponsSoulInfo=function(){function WeaponsSoulInfo(){this.icon="";this.id=0;this.name="";this.actcond=[];this.inside=[];this.outside=[];this.pic=[];this.icon=""}WeaponsSoulInfo.prototype.setSoulInfo=function(id){if(id>0){var wsConfig=GlobalConfig.WeaponSoulConfig[id];if(!wsConfig)return;this.id=wsConfig.id;this.name=wsConfig.name;this.actcond=wsConfig.actcond;this.inside=wsConfig.inside;this.outside=wsConfig.outside;this.pic=wsConfig.pic;this.icon=wsConfig.icon}};return WeaponsSoulInfo}();__reflect(WeaponsSoulInfo.prototype,"WeaponsSoulInfo");var WeaponsSuitInfo=function(){function WeaponsSuitInfo(){this.id=0;this.level=0;this.attr={};this.ex_attr={}}WeaponsSuitInfo.prototype.setInfo=function(id){};return WeaponsSuitInfo}();__reflect(WeaponsSuitInfo.prototype,"WeaponsSuitInfo");var MovieClipEvent=egret.MovieClipEvent;window["MovieClipEvent"]=MovieClipEvent;var WeaponListItem=function(_super){__extends(WeaponListItem,_super);function WeaponListItem(){var _this=_super.call(this)||this;_this.skinName="soulItemSkin";return _this}WeaponListItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};WeaponListItem.prototype.dataChanged=function(){if(!this.data||!this.data.showId)return;var id=this.data.id;var isuse=this.data.isuse;var isRedPoint=this.data.isRedPoint;var level=this.data.level;var isSelect=this.data.isSelect;var wsconfig=GlobalConfig.WeaponSoulConfig[id];var showId=this.data.showId;var job=this.data.job;if(!wsconfig){wsconfig=GlobalConfig.WeaponSoulConfig[showId];this.setEff(wsconfig,job);var wssconfig=GlobalConfig.WeaponSoulSuit[wsconfig.id];var wss=void 0;for(var k in wssconfig){wss=wssconfig[k];break}this.timelabel.text=wsconfig.name;this.huanhuaImage.visible=false;this.redPoint0.visible=isRedPoint;this.levellabel.text=wss.level+i18n("WeaponListItem_0");this.setGray(this.mc);return}this.setEff(wsconfig,job);this.timelabel.text=wsconfig.name;this.huanhuaImage.visible=isuse;this.redPoint0.visible=isRedPoint;this.levellabel.text=level+i18n("WeaponListItem_1")};WeaponListItem.prototype.setEff=function(wsconfig,job){if(!wsconfig)return;if(!this.mc)this.mc=new MovieClip;if(!this.mc.parent){this.effpos.parent.addChild(this.mc);this.mc.x=this.effpos.x;this.mc.y=this.effpos.y;this.mc.rotation=this.effpos.rotation}var eff=wsconfig.inside[job-1];this.mc.playFile(RES_DIR_EFF+eff,-1);this.touchEnabled=false;this.mc.touchEnabled=false;this.effpos.parent.touchEnabled=false;this.cleanFilters(this.mc)};WeaponListItem.prototype.setGray=function(pic){if(this.mc){this.cleanFilters(this.mc)}if(pic){var colorMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];pic.filters=[new egret.ColorMatrixFilter(colorMatrix)]}};WeaponListItem.prototype.cleanFilters=function(pic){if(pic){pic.filters=[]}};WeaponListItem.prototype.clear=function(){this.cleanFilters(this.mc)};WeaponListItem.prototype.destruct=function(){this.clear()};return WeaponListItem}(BaseItemRender);__reflect(WeaponListItem.prototype,"WeaponListItem");var WeaponPanel=function(_super){__extends(WeaponPanel,_super);function WeaponPanel(){var _this=_super.call(this)||this;_this.skinName="weaponSoulSkin2";_this.isTopLevel=true;return _this}WeaponPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.skillicon,this.onEvent);this.addTouchEvent(this.upGradeBtn0,this.onEvent);this.addTouchEvent(this.turnTxt,this.onEvent);this.addTouchEvent(this.closeBtn,this.onEvent);this.observe(Weapons.ins().postWeaponsAct,this.callback);this.observe(Weapons.ins().postWeaponsUse,this.callback);this.observe(Weapons.ins().postWeaponsUpLevel,this.callback);this.weaponShowPanel.open();this.roleId=param[0];this.weaponId=param[1];this.init(this.weaponId)};WeaponPanel.prototype.init=function(id){this.updateUI(id)};WeaponPanel.prototype.updateUI=function(id){var wsconfig=GlobalConfig.WeaponSoulConfig[id];if(!wsconfig){for(var k in GlobalConfig.WeaponSoulConfig){wsconfig=GlobalConfig.WeaponSoulConfig[k];break}}var JieSuo=i18n("WeaponPanel_0");var role=SubRoles.ins().getSubRoleByIndex(this.roleId);this.ringname.text=wsconfig.name;var wsinfo=role.weapons.getSoulInfoData()[id];var wss=role.weapons.getSuitConfig(id);var descex=i18n("WeaponPanel_1");var color=i18n("WeaponPanel_13");if(!wsinfo||!wsinfo.id){color="";for(var k in GlobalConfig.WeaponSoulSuit[id]){wss=GlobalConfig.WeaponSoulSuit[id][k];break}}if(role.weapons.getFlexibleData().indexOf(id)==-1)descex="";this.levellabel.text=wss.level+i18n("WeaponPanel_2");this.skillicon.data={icon:wss.skillicon};this.skillname.text=wss.skillname;this.powerPanel.setPower(role.getWeaponTotalPower(id));var filterAttr=[4,2,6,5];var attrValue=[0,0,0,0];for(var i=0;i<wsconfig.actcond.length;i++){var slot=wsconfig.actcond[i];var wsinfo_1=role.weapons.getSlotByInfo(slot);if(wsinfo_1){for(var j=0;j<wsinfo_1.attr.length;j++){var attr=wsinfo_1.attr[j];if(filterAttr.indexOf(attr.type)!=-1){for(var z=0;z<filterAttr.length;z++){if(filterAttr[z]==attr.type)attrValue[z]+=attr.value}}}}}for(var i=0;i<4;i++){if(this["attr"+i]){var attname=AttributeData.getAttrStrByType(filterAttr[i]);this["attr"+i].text=attname+"+"+attrValue[i]}}this.skill.textFlow=TextFlowMaker.generateTextFlow1(""+color+wss.skilldesc+descex);var ws=role.weapons.getWeapsInfoBySoulId(id);if(this.turnTxt.parent)this.turnTxt.textFlow=TextFlowMaker.generateTextFlow1(i18n("WeaponPanel_3"));this.descGroup.visible=true;if(role.weapons.flexibleCount){this.desc.text=i18n("WeaponPanel_4");if(!this.turnTxt.parent){this.desc.parent.addChild(this.turnTxt)}}else{this.desc.text=i18n("WeaponPanel_5");DisplayUtils.removeFromParent(this.turnTxt)}if(!ws||!ws.id){this.upGradeBtn0.label=JieSuo;this.huanhuaImage.visible=false;this.redPoint.visible=role.weapons.IsActivityWeapon(id);this.descGroup.visible=false}else if(role.weapons.weaponsId==ws.id){this.upGradeBtn0.label=i18n("WeaponPanel_6");this.huanhuaImage.visible=true;this.redPoint.visible=false}else if(!role.weapons.weaponsId){this.upGradeBtn0.label=i18n("WeaponPanel_7");this.huanhuaImage.visible=false;this.redPoint.visible=true}else{this.upGradeBtn0.label=i18n("WeaponPanel_8");this.huanhuaImage.visible=false;this.redPoint.visible=false}this.weaponShowPanel.init(id,this.roleId)};WeaponPanel.prototype.onEvent=function(e){switch(e.currentTarget){case this.skillicon:ViewManager.ins().open(WeaponSoulSkillTips,this.roleId,this.weaponId);break;case this.upGradeBtn0:var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var JieSuo=i18n("WeaponPanel_0");if(this.upGradeBtn0.label==JieSuo){var minSuitConfig=role.weapons.getSuitConfig(this.weaponId);if(!minSuitConfig){UserTips.ins().showTips(i18n("WeaponPanel_9"));return}Weapons.ins().sendWeaponsAct(this.roleId,this.weaponId)}else if(this.upGradeBtn0.label==i18n("WeaponPanel_10")){Weapons.ins().sendWeaponsUse(this.roleId,this.weaponId)}else if(this.upGradeBtn0.label==i18n("WeaponPanel_11")){Weapons.ins().sendWeaponsUse(this.roleId,0)}else if(this.upGradeBtn0.label==i18n("WeaponPanel_12")){Weapons.ins().sendWeaponsUse(this.roleId,this.weaponId)}break;case this.closeBtn:ViewManager.ins().close(this);break;case this.turnTxt:var win=ViewManager.ins().getView(ForgeWin);if(win){win.weaponsoul.open(this.roleId,false)}ViewManager.ins().close(this);break}};WeaponPanel.prototype.callback=function(){this.updateUI(this.weaponId)};WeaponPanel.prototype.destoryView=function(){_super.prototype.destoryView.call(this)};return WeaponPanel}(BaseEuiView);__reflect(WeaponPanel.prototype,"WeaponPanel");ViewManager.ins().reg(WeaponPanel,LayerManager.UI_Popup);var WeaponShowPanel=function(_super){__extends(WeaponShowPanel,_super);function WeaponShowPanel(){var _this=_super.call(this)||this;_this.skinName="weaponSoulSkinState";return _this}WeaponShowPanel.prototype.childrenCreated=function(){};WeaponShowPanel.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.observe(Weapons.ins().postWeaponsUpLevel,this.callback);this.roleId=0;this.weaponId=0};WeaponShowPanel.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.releaseEvent();this.removeObserve()};WeaponShowPanel.prototype.releaseEvent=function(){if(!this.currentState)return;DisplayUtils.removeFromParent(this.mc);this.mc=null;DisplayUtils.removeFromParent(this.masksp);this.masksp=null;for(var i=0;i<Number(this.currentState);i++){this.removeTouchEvent(this["item"+i],this.onClick)}};WeaponShowPanel.prototype.init=function(idx,rId){var id=idx?idx:this.weaponId;var roleId=!isNaN(rId)?rId:this.roleId;this.weaponId=id;this.roleId=roleId;var wsconfig=GlobalConfig.WeaponSoulConfig[id];if(!wsconfig)return;var state=wsconfig.actcond.length;this.releaseEvent();var role=SubRoles.ins().getSubRoleByIndex(roleId);this.currentState=state+"";var wsinfo=role.weapons.getWeapsInfoBySoulId(wsconfig.id);var isActNum=0;for(var i=0;i<wsconfig.actcond.length;i++){this.addTouchEvent(this["item"+i],this.onClick);if(wsinfo.id){isActNum++;if(this["lianjiexian"+i])this.setLight(this["lianjiexian"+i]);if(this["item"+i])this["item"+i].data=role.weapons.getSlotByInfo(wsconfig.actcond[i])}else{var winfo=role.weapons.getSlotByInfo(wsconfig.actcond[i]);if(winfo){isActNum++;if(this["lianjiexian"+i])this.setLight(this["lianjiexian"+i]);if(this["item"+i])this["item"+i].data=role.weapons.getSlotByInfo(wsconfig.actcond[i])}else{if(this["lianjiexian"+i])this.setGray(this["lianjiexian"+i]);if(this["item"+i])this["item"+i].data=GlobalConfig.WeaponSoulPosConfig[wsconfig.actcond[i]][0]}}}this.setEff(isActNum,wsconfig.actcond.length,wsconfig,role)};WeaponShowPanel.prototype.setEff=function(curEf,maxEf,wsconfig,role){if(!wsconfig)return;var eff=wsconfig.inside[role.job-1];if(!this.mc)this.mc=new MovieClip;if(!this.mc.parent)this.effgroup.addChild(this.mc);this.mc.playFile(RES_DIR_EFF+eff,-1);this.mc.x=this.effpos.x;this.mc.y=this.effpos.y;this.mc.rotation=this.effpos.rotation};WeaponShowPanel.prototype.onClick=function(e){for(var i=0;i<Number(this.currentState);i++){if(e.currentTarget==this["item"+i]){var slot=this["item"+i].slot;var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var winfo=role.weapons.getSlotByInfo(slot);if(!winfo||!winfo.level){ViewManager.ins().open(WeaponSoulBreakWin,WeaponSoulBreakWin.JIHUO,role.index,slot)}else if(winfo.assault){ViewManager.ins().open(WeaponSoulBreakWin,WeaponSoulBreakWin.TUPO,role.index,slot)}else{ViewManager.ins().open(WeaponSoulBreakWin,WeaponSoulBreakWin.SHENGJI,role.index,slot)}break}}};WeaponShowPanel.prototype.getJobSkinName=function(job){switch(job){case 1:return"zhan";case 2:return"fa";case 3:return"dao"}return""};WeaponShowPanel.prototype.callback=function(){this.init()};WeaponShowPanel.prototype.setGray=function(pic){var colorMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];pic.filters=[new egret.ColorMatrixFilter(colorMatrix)]};WeaponShowPanel.prototype.setLight=function(pic){pic.filters=[]};WeaponShowPanel.prototype.cleanFilters=function(State,i){this["zhan"+State+i].filters=[];this["fa"+State+i].filters=[];this["dao"+State+i].filters=[]};WeaponShowPanel.prototype.destructor=function(){};return WeaponShowPanel}(BaseView);__reflect(WeaponShowPanel.prototype,"WeaponShowPanel");var WeaponSkillItem=function(_super){__extends(WeaponSkillItem,_super);function WeaponSkillItem(){var _this=_super.call(this)||this;_this.skinName="weaponSkillItemSkin";return _this}WeaponSkillItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};WeaponSkillItem.prototype.dataChanged=function(){if(!this.data)return;this.skillIcon.source=this.data.icon+"_png"};WeaponSkillItem.prototype.destruct=function(){};WeaponSkillItem.prototype.clear=function(){};return WeaponSkillItem}(BaseItemRender);__reflect(WeaponSkillItem.prototype,"WeaponSkillItem");var WeaponSoulbreakItem=function(_super){__extends(WeaponSoulbreakItem,_super);function WeaponSoulbreakItem(){var _this=_super.call(this)||this;_this.skinName="weaponSoulbreakitem";return _this}WeaponSoulbreakItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};WeaponSoulbreakItem.prototype.dataChanged=function(){if(!this.data)return;var sum=this.data.sum;var costNum=this.data.costNum;var costItem=this.data.costItem;var colorStr;if(sum>=costNum)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N;this.lv.textFlow=TextFlowMaker.generateTextFlow1(i18n("WeaponSoulbreakItem_0",colorStr,sum,costNum));this.itemIcon.imgJob.visible=false;var itemconfig=GlobalConfig.ItemConfig[costItem];this.nameTxt.text=itemconfig.name;this.itemIcon.imgIcon.source=itemconfig.icon+"_png"};WeaponSoulbreakItem.prototype.destruct=function(){};WeaponSoulbreakItem.prototype.clear=function(){};return WeaponSoulbreakItem}(BaseItemRender);__reflect(WeaponSoulbreakItem.prototype,"WeaponSoulbreakItem");var WeaponSoulBreakWin=function(_super){__extends(WeaponSoulBreakWin,_super);function WeaponSoulBreakWin(){var _this=_super.call(this)||this;_this.calldesc="";_this.skinName="weaponSoulBreak";return _this}WeaponSoulBreakWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.btnjihuo,this.onClick);this.removeTouchEvent(this.btntupo,this.onClick);this.removeTouchEvent(this.btnlianhua,this.onClick);this.removeTouchEvent(this.bgClose,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick);TimerManager.ins().remove(this.timeClock,this);this.removeObserve();DisplayUtils.removeFromParent(this.upLvEff);DisplayUtils.removeFromParent(this.finisheff);for(var i=0;i<this.effs.length;i++)DisplayUtils.removeFromParent(this.effs[i])};WeaponSoulBreakWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnjihuo,this.onClick);this.addTouchEvent(this.btntupo,this.onClick);this.addTouchEvent(this.btnlianhua,this.onClick);this.addTouchEvent(this.bgClose,this.onClick);this.addTouchEvent(this.closeBtn,this.onClick);this.observe(Weapons.ins().postWeaponsUpLevel,this.callback);this.tipsType=param[0];this.roleId=param[1];this.slot=param[2];this.effs=[];this.flys=[];this.update()};WeaponSoulBreakWin.prototype.callback=function(){UserTips.ins().showTips(i18n("WeaponSoulBreakWin_0",this.calldesc));if(this.calldesc==i18n("WeaponSoulBreakWin_1")){this.star.visible=true;this.lock.visible=false;this.tipsType=WeaponSoulBreakWin.SHENGJI;this.callbackToUpdate()}else if(this.calldesc==i18n("WeaponSoulBreakWin_2")){this.playUpLvEff()}else if(this.calldesc==i18n("WeaponSoulBreakWin_3")){this.playflyEff()}};WeaponSoulBreakWin.prototype.callbackToUpdate=function(){var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var wsinfo=role.weapons.getSlotByInfo(this.slot);Assert(wsinfo,"WeaponSoulBreakWin slot:"+this.slot+", roleId:"+this.roleId);if(wsinfo.assault)this.tipsType=WeaponSoulBreakWin.TUPO;else if(this.calldesc==i18n("WeaponSoulBreakWin_4")){this.btntupo.touchEnabled=true;this.tipsType=WeaponSoulBreakWin.SHENGJI}this.update()};WeaponSoulBreakWin.prototype.update=function(){var wspconfig=GlobalConfig.WeaponSoulPosConfig[this.slot];if(this.tipsType==WeaponSoulBreakWin.JIHUO){this.title.text=i18n("WeaponSoulBreakWin_5");this.star.visible=false;this.lock.visible=true;this.jihuo.visible=true;this.tupo.visible=false;this.lianhua.visible=false;this.item1.imgIcon.source="b_"+wspconfig[0].icon+"_png";this.item1.imgBg.visible=false;this.item1.imgJob.visible=false;this.name1.text=wspconfig[0].name;var itemData=UserBag.ins().getBagItemById(wspconfig[0].costItem);var costItemLen=itemData?itemData.count:0;this.material1.data={costItem:wspconfig[0].costItem,costNum:wspconfig[0].costNum,sum:costItemLen};if(wspconfig[1].attr){var attname=AttributeData.getAttrStrByType(wspconfig[1].attr[0].type);this.jhattr0.text=attname+"+"+wspconfig[1].attr[0].value;this.jhattr1.visible=true;if(wspconfig[1].attr[1]){attname=AttributeData.getAttrStrByType(wspconfig[1].attr[1].type);this.jhattr1.text=attname+"+"+wspconfig[1].attr[1].value}else this.jhattr1.visible=false}this.needItemId=wspconfig[0].costItem;this.curSum=costItemLen;this.maxSum=wspconfig[0].costNum}else if(this.tipsType==WeaponSoulBreakWin.TUPO){this.title.text=i18n("WeaponSoulBreakWin_6");this.star.visible=true;this.lock.visible=false;var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var winfo=role.weapons.getSlotByInfo(this.slot);this.jihuo.visible=false;this.tupo.visible=true;this.lianhua.visible=false;this.item1.imgIcon.source="b_"+wspconfig[0].icon+"_png";this.item1.imgBg.visible=false;this.item1.imgJob.visible=false;this.name3.text=wspconfig[0].name;this.tpattr1.text=winfo.showlv+"";this.tpattr2.text=winfo.assault+"";this.tpright0.x=this.tpattr1.x+this.tpattr1.width;this.tpattr2.x=this.tpright0.x+this.tpright0.width;if(winfo.attr){this.tpattr0.text=AttributeData.getAttrStrByType(winfo.attr[0].type);this.tpattr3.text=winfo.attr[0].value+"";var nextconfig=GlobalConfig.WeaponSoulPosConfig[winfo.id][winfo.level+1];this.tpattr4.text=nextconfig.attr[0].value+"";this.tpright1.x=this.tpattr3.x+this.tpattr3.width;this.tpattr4.x=this.tpright1.x+this.tpright1.width;if(winfo.attr[1]&&nextconfig.attr[1]){this.g2.visible=true;this.tpattr5.text=AttributeData.getAttrStrByType(winfo.attr[1].type);this.tpattr6.text=winfo.attr[1].value+"";this.tpattr7.text=nextconfig.attr[1].value+"";this.tpright2.x=this.tpattr6.x+this.tpattr6.width;this.tpattr7.x=this.tpright2.x+this.tpright2.width}else{this.g2.visible=false}}var itemData=UserBag.ins().getBagItemById(winfo.costItem);var costItemLen=itemData?itemData.count:0;this.material.data={costItem:winfo.costItem,costNum:winfo.costNum,sum:costItemLen};this.needItemId=winfo.costItem;this.curSum=costItemLen;this.maxSum=winfo.costNum}else if(this.tipsType==WeaponSoulBreakWin.SHENGJI){this.title.text=i18n("WeaponSoulBreakWin_7");this.star.visible=true;this.lock.visible=false;this.lianhua.visible=true;this.jihuo.visible=false;this.tupo.visible=false;var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var winfo=role.weapons.getSlotByInfo(this.slot);var wspconfig_1=GlobalConfig.WeaponSoulPosConfig[winfo.id][0];var nextconfig=GlobalConfig.WeaponSoulPosConfig[winfo.id][winfo.level+1];if(!nextconfig){this.costgroup0.visible=false;this.btnlianhua.visible=this.costgroup0.visible;this.lhright1.visible=this.costgroup0.visible;this.lhright0.visible=this.costgroup0.visible;this.lhattr4.visible=this.costgroup0.visible;this.lhattr6.visible=this.costgroup0.visible;this.maxdesc0.visible=!this.costgroup0.visible;this.lhright2.visible=this.costgroup0.visible;this.lhattr8.visible=this.costgroup0.visible;if(winfo.attr){this.lhattr3.text=winfo.showlv+"";this.lhattr1.text=AttributeData.getAttrStrByType(winfo.attr[0].type);this.lhattr5.text=winfo.attr[0].value+"";if(winfo.attr[1]){this["attr2"].visible=true;this.lhattr2.text=AttributeData.getAttrStrByType(winfo.attr[1].type);this.lhattr7.text=winfo.attr[1].value+""}else{this["attr2"].visible=false}}this.name2.text=wspconfig_1.name;this.item1.imgIcon.source="b_"+wspconfig_1.icon+"_png";this.item1.imgBg.visible=false;this.item1.imgJob.visible=false;this.updateEff();this.addCheckEff();return}this.item1.imgIcon.source="b_"+wspconfig_1.icon+"_png";this.item1.imgBg.visible=false;this.item1.imgJob.visible=false;this.name2.text=wspconfig_1.name;if(winfo.attr){this.lhattr3.text=winfo.showlv+"";this.lhattr4.text=nextconfig.showlv+"";this.lhright1.x=this.lhattr3.x+this.lhattr3.width+this.lhright1.width;this.lhattr4.x=this.lhright1.x;this.lhattr1.text=AttributeData.getAttrStrByType(winfo.attr[0].type);this.lhattr5.text=winfo.attr[0].value+"";this.lhattr6.text=nextconfig.attr[0].value+"";this.lhright0.x=this.lhattr5.x+this.lhattr5.width+this.lhright0.width;this.lhattr6.x=this.lhright0.x;if(winfo.attr[1]&&nextconfig.attr[1]){this["attr2"].visible=true;this.lhattr2.text=AttributeData.getAttrStrByType(winfo.attr[1].type);this.lhattr7.text=winfo.attr[1].value+"";this.lhattr8.text=nextconfig.attr[1].value+"";this.lhright2.x=this.lhattr7.x+this.lhattr7.width+this.lhright2.width;this.lhattr8.x=this.lhright2.x}else{this["attr2"].visible=false}var itemData=UserBag.ins().getBagItemById(winfo.costItem);var costItemLen=itemData?itemData.count:0;var itemconfig=GlobalConfig.ItemConfig[winfo.costItem];this.micon0.source=itemconfig.icon+"_png";var colorStr=void 0;if(costItemLen>=winfo.costNum)colorStr=ColorUtil.GREEN_COLOR_N;else colorStr=ColorUtil.RED_COLOR_N;this.countLabel1.textFlow=TextFlowMaker.generateTextFlow1(i18n("WeaponSoulBreakWin_14",colorStr,costItemLen,winfo.costNum));this.needItemId=winfo.costItem;this.curSum=costItemLen;this.maxSum=winfo.costNum}}this.updateEff();this.addCheckEff()};WeaponSoulBreakWin.prototype.updateEff=function(){if(this.star.visible){var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var winfo=role.weapons.getSlotByInfo(this.slot);if(!winfo){UserTips.ins().showTips(i18n("WeaponSoulBreakWin_8"));return}this.cirimg.visible=true;if(!winfo.level){for(var i=0;i<WeaponSoulBreakWin.maxCir;i++){this["s"+i].visible=false}this.cirimg.visible=false;return}if(this.maxdesc0.visible||this.tipsType==WeaponSoulBreakWin.TUPO){for(var i=0;i<WeaponSoulBreakWin.maxCir;i++){this["s"+i].visible=true}DisplayUtils.drawCir(this._shap,this.star.width>>1,360);return}var lv=winfo.level%10;for(var i=0;i<WeaponSoulBreakWin.maxCir;i++){if(!lv)this["s"+i].visible=false;else this["s"+i].visible=lv>i;if(!this._shap)this._shap=new egret.Shape;if(!this._shap.parent){this.star.addChild(this._shap);this.cirimg.mask=this._shap;this._shap.x=this._shap.y=this.star.width>>1;this._shap.rotation=-90}if(i>0&&lv>0){DisplayUtils.drawCir(this._shap,this.star.width>>1,(lv-1)*360/WeaponSoulBreakWin.maxCir)}else this._shap.graphics.clear()}}};WeaponSoulBreakWin.prototype.addCheckEff=function(){for(var i=0;i<WeaponSoulBreakWin.maxCir;i++){if(this["s"+i].visible){if(!this.effs[i]){var mc=new MovieClip;this.effs[i]=mc}if(!this.effs[i].parent){this["star"+i].addChild(this.effs[i])}this.effs[i].x=21;this.effs[i].y=21;this.effs[i].playFile(RES_DIR_EFF+"bally2",-1)}else{if(this.effs[i]&&this.effs[i].parent){DisplayUtils.removeFromParent(this.effs[i])}}}};WeaponSoulBreakWin.prototype.playUpLvEff=function(){if(!this.upLvEff)this.upLvEff=new MovieClip;if(!this.upLvEff.parent)this.star.addChild(this.upLvEff);this.upLvEff.x=145;this.upLvEff.y=140;var self=this;this.upLvEff.playFile(RES_DIR_EFF+"forgeSuccess",1,function(){DisplayUtils.removeFromParent(self.upLvEff)});self.callbackToUpdate()};WeaponSoulBreakWin.prototype.playflyEff=function(){var self=this;var _loop_29=function(i){if(this_22.effs[i]&&this_22.effs[i].parent){this_22.flys[i]=true;var point=this_22.item1.localToGlobal();this_22["star"+i].globalToLocal(point.x+38,point.y+38,point);egret.Tween.get(this_22.effs[i]).to({x:point.x,y:point.y},500).call(function(){self.flys[i]=false;egret.Tween.removeTweens(self.effs[i]);DisplayUtils.removeFromParent(self.effs[i])})}};var this_22=this;for(var i=0;i<this.effs.length;i++){_loop_29(i)}TimerManager.ins().remove(this.timeClock,this);TimerManager.ins().doTimer(100,0,this.timeClock,this)};WeaponSoulBreakWin.prototype.timeClock=function(){for(var i=0;i<this.flys.length;i++){if(this.flys[i])return}TimerManager.ins().remove(this.timeClock,this);if(!this.finisheff)this.finisheff=new MovieClip;if(!this.finisheff.parent)this.star.addChild(this.finisheff);this.finisheff.x=145;this.finisheff.y=140;var self=this;this.finisheff.playFile(RES_DIR_EFF+"spirittupo",1,function(){self.callbackToUpdate();DisplayUtils.removeFromParent(self.finisheff)})};WeaponSoulBreakWin.prototype.onClick=function(e){switch(e.target){case this.btnjihuo:case this.btntupo:if(e.target==this.btnjihuo)this.calldesc=i18n("WeaponSoulBreakWin_9");else{this.calldesc=i18n("WeaponSoulBreakWin_10");this.btntupo.touchEnabled=true}if(this.curSum<this.maxSum){UserTips.ins().showTips(i18n("WeaponSoulBreakWin_11"));UserWarn.ins().setBuyGoodsWarn(this.needItemId);return}Weapons.ins().sendWeaponsUpLevel(this.roleId,this.slot);SoundUtil.ins().playEffect(SoundUtil.FORGE);break;case this.btnlianhua:if(this.curSum<this.maxSum){UserTips.ins().showTips(i18n("WeaponSoulBreakWin_12"));UserWarn.ins().setBuyGoodsWarn(this.needItemId);return}this.calldesc=i18n("WeaponSoulBreakWin_13");Weapons.ins().sendWeaponsUpLevel(this.roleId,this.slot);SoundUtil.ins().playEffect(SoundUtil.FORGE);break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};WeaponSoulBreakWin.TUPO=1;WeaponSoulBreakWin.JIHUO=2;WeaponSoulBreakWin.SHENGJI=3;WeaponSoulBreakWin.maxCir=9;return WeaponSoulBreakWin}(BaseEuiView);__reflect(WeaponSoulBreakWin.prototype,"WeaponSoulBreakWin");ViewManager.ins().reg(WeaponSoulBreakWin,LayerManager.UI_Popup);var WeaponSoulItem=function(_super){__extends(WeaponSoulItem,_super);function WeaponSoulItem(){var _this=_super.call(this)||this;_this.skinName="weaponSoulitem";return _this}WeaponSoulItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this);this.slot=0};WeaponSoulItem.prototype.dataChanged=function(){if(!this.data)return;var wsinfo;this.black.visible=false;if(this.data instanceof WeaponsInfo){wsinfo=this.data;this.itemIcon.setActived(true)}else{wsinfo=this.data;this.black.visible=true}this.slot=wsinfo.id;var cfg=GlobalConfig.WeaponSoulPosConfig[wsinfo.id][0];this.itemIcon.imgIcon.source=cfg.icon+"_png";this.lv.text=(!isNaN(wsinfo.level)?wsinfo.level:cfg.level)+"";this.nameTxt.text=cfg.name;var nextcfg=GlobalConfig.WeaponSoulPosConfig[wsinfo.id][Number(this.lv.text)+1];if(!wsinfo.costNum||!nextcfg)this.redPoint.visible=false;else{var itemData=UserBag.ins().getBagItemById(wsinfo.costItem);var costItemLen=itemData?itemData.count:0;this.redPoint.visible=costItemLen>=wsinfo.costNum?true:false}};WeaponSoulItem.prototype.destruct=function(){};WeaponSoulItem.prototype.clear=function(){};return WeaponSoulItem}(BaseItemRender);__reflect(WeaponSoulItem.prototype,"WeaponSoulItem");var WeaponSoulSkillTips=function(_super){__extends(WeaponSoulSkillTips,_super);function WeaponSoulSkillTips(){var _this=_super.call(this)||this;_this.skinName="weaponSoulSkilltips";return _this}WeaponSoulSkillTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClick);this.roleId=param[0];this.weaponId=param[1];var role=SubRoles.ins().getSubRoleByIndex(this.roleId);this.head(role);this.curSkill(role);this.nextSkill(role)};WeaponSoulSkillTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.bgClose,this.onClick)};WeaponSoulSkillTips.prototype.head=function(role){var config=role.weapons.getSuitConfig(this.weaponId);if(!config)config=GlobalConfig.WeaponSoulSuit[this.weaponId][0];this.skillicon.data={icon:config.skillicon};this.skillname.text=config.skillname};WeaponSoulSkillTips.prototype.curSkill=function(role){var config=role.weapons.getSuitConfig(this.weaponId);if(!config)config=GlobalConfig.WeaponSoulSuit[this.weaponId][0];var wsconfig=GlobalConfig.WeaponSoulConfig[this.weaponId];var slotStrs="";var curNum=0;for(var i=0;i<wsconfig.actcond.length;i++){var slot=wsconfig.actcond[i];var level=role.weapons.getInfoLevel(slot);var wname=GlobalConfig.WeaponSoulPosConfig[slot][0].name;if(level&&level>=config.level){slotStrs+=i18n("WeaponSoulSkillTips_1",ColorUtil.WHITE_COLOR2,wname);curNum++}else{slotStrs+=i18n("WeaponSoulSkillTips_2",ColorUtil.GRAY_COLOR2,wname)}}this.num0.text="（"+curNum+"/"+wsconfig.actcond.length+"）";this.informationname0.textFlow=TextFlowMaker.generateTextFlow1(slotStrs);this.desc0.text=this.ShowSkillDesc(config)};WeaponSoulSkillTips.prototype.nextSkill=function(role){var config=role.weapons.getNextSuitConfig(this.weaponId);if(!config){this.name1.text=i18n("WeaponSoulSkillTips_0");this.num1.visible=false;this.nextdesc1.visible=false;this.informationname1.visible=false;this.ndesc0.visible=false;return}var wsconfig=GlobalConfig.WeaponSoulConfig[this.weaponId];var slotStrs="";var curNum=0;for(var i=0;i<wsconfig.actcond.length;i++){var slot=wsconfig.actcond[i];var level=role.weapons.getInfoLevel(slot);var wname=GlobalConfig.WeaponSoulPosConfig[slot][0].name;if(level>=config.level){slotStrs+=i18n("WeaponSoulSkillTips_3",ColorUtil.WHITE_COLOR2,wname);curNum++}else{slotStrs+=i18n("WeaponSoulSkillTips_4",ColorUtil.GRAY_COLOR2,wname)}}this.num1.text="（"+curNum+"/"+wsconfig.actcond.length+"）";this.informationname1.textFlow=TextFlowMaker.generateTextFlow1(slotStrs);this.ndesc0.text=this.ShowSkillDesc(config);var str=this.nextdesc1.text;var tmp=str.split("X");var s1=tmp[0];var s2=tmp[1];var newstr=s1+(""+config.level)+s2;this.nextdesc1.text=newstr};WeaponSoulSkillTips.prototype.ShowSkillDesc=function(config){return config.skilldesc};WeaponSoulSkillTips.prototype.onClick=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break}};return WeaponSoulSkillTips}(BaseEuiView);__reflect(WeaponSoulSkillTips.prototype,"WeaponSoulSkillTips");ViewManager.ins().reg(WeaponSoulSkillTips,LayerManager.UI_Popup);var WeaponSoulUplvWin=function(_super){__extends(WeaponSoulUplvWin,_super);function WeaponSoulUplvWin(){var _this=_super.call(this)||this;_this.skinName="weaponSoulUplv";return _this}WeaponSoulUplvWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btn1,this.onClick);this.addTouchEvent(this.bgClose,this.onClick);this.addTouchEvent(this.closeBtn,this.onClick);this.observe(Weapons.ins().postWeaponsUpLevel,this.callback);this.roleId=param[0];this.slot=param[1];this.update()};WeaponSoulUplvWin.prototype.callback=function(){UserTips.ins().showTips(i18n("WeaponSoulUplvWin_0"));this.update()};WeaponSoulUplvWin.prototype.update=function(){var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var winfo=role.weapons.getSlotByInfo(this.slot);var wspconfig=GlobalConfig.WeaponSoulPosConfig[winfo.id][0];var nextconfig=GlobalConfig.WeaponSoulPosConfig[winfo.id][winfo.level+1];if(!nextconfig){this.costgroup.visible=false;this.btn1.visible=this.costgroup.visible;this.rightIcon0.visible=this.costgroup.visible;this.rightIcon1.visible=this.costgroup.visible;this.attr6.visible=this.costgroup.visible;this.attr4.visible=this.costgroup.visible;this.maxdesc.visible=!this.costgroup.visible;if(winfo.attr){this.attr5.text=winfo.attr[0].value+"";this.attr2.text=AttributeData.getAttrStrByType(winfo.attr[0].type)}this.name0.text=wspconfig.name;this.item0.imgIcon.source=wspconfig.icon+"_png";this.item0.imgJob.visible=false;return}this.item0.imgIcon.source=wspconfig.icon+"_png";this.item0.imgJob.visible=false;this.name0.text=wspconfig.name;if(winfo.attr){this.attr5.text=winfo.attr[0].value+"";this.attr6.text=nextconfig.attr[0].value+"";this.rightIcon0.x=this.attr5.x+this.attr5.width+this.rightIcon0.width;this.attr6.x=this.rightIcon0.x;this.attr2.text=AttributeData.getAttrStrByType(winfo.attr[0].type);this.attr3.text=winfo.attr[0].value+"";this.attr4.text=nextconfig.attr[0].value+"";this.rightIcon1.x=this.attr3.x+this.attr3.width+this.rightIcon1.width;this.attr4.x=this.rightIcon1.x;var itemData=UserBag.ins().getBagItemById(winfo.costItem);var costItemLen=itemData?itemData.count:0;var itemconfig=GlobalConfig.ItemConfig[winfo.costItem];this.micon.source=itemconfig.icon+"";this.countLabel0.text=costItemLen+"/"+winfo.costNum;this.curSum=costItemLen;this.maxSum=winfo.costNum}};WeaponSoulUplvWin.prototype.onClick=function(e){switch(e.target){case this.btn1:if(this.curSum<this.maxSum){UserTips.ins().showTips(i18n("WeaponSoulUplvWin_1"));return}Weapons.ins().sendWeaponsUpLevel(this.roleId,this.slot);break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break}};WeaponSoulUplvWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.btn1,this.onClick);this.removeTouchEvent(this.bgClose,this.onClick);this.removeTouchEvent(this.closeBtn,this.onClick);this.removeObserve()};return WeaponSoulUplvWin}(BaseEuiView);__reflect(WeaponSoulUplvWin.prototype,"WeaponSoulUplvWin");ViewManager.ins().reg(WeaponSoulUplvWin,LayerManager.UI_Popup);var WeaponWin=function(_super){__extends(WeaponWin,_super);function WeaponWin(){var _this=_super.call(this)||this;_this.isTopLevel=true;return _this}WeaponWin.prototype.closeSoulCondition=function(b){this.normal.visible=b;this.soul.visible=!b};WeaponWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.leftbtn,this.onEvent);this.removeTouchEvent(this.rightbtn,this.onEvent);this.removeTouchEvent(this.active,this.onEvent);this.removeTouchEvent(this.turnBtn,this.onEvent);this.removeTouchEvent(this.backBtn,this.onEvent);this.removeTouchEvent(this.leftbtn0,this.onEvent);this.removeTouchEvent(this.rightbtn0,this.onEvent);this.removeTouchEvent(this.list1,this.onClick);this.list0.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSoulClick,this);this.removeObserve();ViewManager.ins().getView(ForgeWin).isNotMove=false;GiftPackBtnMgr.ins().removeBtn(this.btnGiftPack)};WeaponWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}ViewManager.ins().getView(ForgeWin).isNotMove=true;this.roleId=param[0];this.addTouchEvent(this.leftbtn,this.onEvent);this.addTouchEvent(this.rightbtn,this.onEvent);this.addTouchEvent(this.active,this.onEvent);this.addTouchEvent(this.turnBtn,this.onEvent);this.addTouchEvent(this.backBtn,this.onEvent);this.addTouchEvent(this.leftbtn0,this.onEvent);this.addTouchEvent(this.rightbtn0,this.onEvent);this.addTouchEvent(this.list1,this.onClick);this.addEvent(eui.UIEvent.CHANGE_END,this.list1Scroll,this.onChange);this.addEvent(eui.UIEvent.CHANGE_END,this.list0Scroll,this.onChangeFlex);this.list0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSoulClick,this);this.observe(Weapons.ins().postWeaponsAct,this.callback);this.observe(Weapons.ins().postWeaponsUse,this.callback);this.observe(Weapons.ins().postWeaponsUpLevel,this.callback);this.observe(Weapons.ins().postWeaponsFlexibleAct,this.callback);this.observe(Weapons.ins().postWeaponsFlexibleCount,this.callback);this.list1.itemRenderer=WeaponListItem;this.list0.itemRenderer=WeaponListItem;this.leftbtn.parent.touchEnabled=false;this.weaponId=1;this.weaponFlexible=0;this.closeSoulCondition(param[1]);this.updateBtn();this.init(this.weaponId);GiftPackBtnMgr.ins().addBtn(this.btnGiftPack,WinType.jianLing)};WeaponWin.prototype.updateBtn=function(){this.turnBtn.visible=true};WeaponWin.prototype.init=function(selectId){this.soulArr=[];this.listdata=[];this.dataArr=new eui.ArrayCollection(this.listdata);var role=SubRoles.ins().getSubRoleByIndex(this.roleId);for(var k in GlobalConfig.WeaponSoulConfig){var wsconfig=GlobalConfig.WeaponSoulConfig[k];var wsinfo=role.weapons.getSoulInfoData()[wsconfig.id];var wss=role.weapons.getSuitConfig(wsconfig.id);var tmp={isuse:role.weapons.weaponsId==wsconfig.id?true:false,id:wsinfo&&wsinfo.id&&wss?wss.id:0,isRedPoint:role.weapons.getRedPointBySuit(wsconfig.id),level:wsinfo&&wsinfo.id&&wss?wss.level:0,isSelect:k==selectId.toString()?true:false,showId:wsconfig.id,job:role.job};this.listdata.push(tmp);if(wsinfo&&wsinfo.id&&wss)this.soulArr.push(tmp)}this.updateUI();this.list1.dataProvider=this.dataArr;this.list1.scrollH=0;this.onChange();this.updateSoul(this.soulArr,true);this.updateRedPoint();this.onChangeFlex()};WeaponWin.prototype.setSelectId=function(selectId){for(var i=0;i<this.listdata.length;i++){var tmp=this.listdata[i];tmp.isSelect=i==selectId?true:false}this.dataArr.replaceAll(this.listdata);this.list1.dataProvider=this.dataArr};WeaponWin.prototype.onSoulClick=function(e){if(e&&e.itemRenderer&&e.item){var info=e.item;var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var fb=role.weapons.getFlexibleData();var wsconfig=role.weapons.getSuitConfig(info.id);if(wsconfig){var color="";if(info.isuse){color=i18n("WeaponWin_17");this.active.visible=true}else{this.active.visible=role.weapons.flexibleCount<=fb.length?false:true}this.weaponFlexible=wsconfig.id;this.skillicon0.data={icon:wsconfig.skillicon};this.skill.textFlow=TextFlowMaker.generateTextFlow1(color+wsconfig.skilldesc);this.skillname0.textFlow=TextFlowMaker.generateTextFlow1(wsconfig.skillname)}else{this.weaponFlexible=0}if(info.isuse){this.active.label=i18n("WeaponWin_0");this.redPoint.visible=false}else{this.active.label=i18n("WeaponWin_1");this.redPoint.visible=role.weapons.flexibleCount<=fb.length?false:true}}};WeaponWin.prototype.onClick=function(e){var selectIndex=e.currentTarget.selectedIndex;selectIndex=selectIndex>0?selectIndex:0;if(this.listdata[selectIndex]){this.weaponId=this.listdata[selectIndex].showId;this.setSelectId(selectIndex);ViewManager.ins().open(WeaponPanel,this.roleId,this.weaponId)}this.onChange()};WeaponWin.prototype.onChange=function(){if(this.list1.scrollH<150){this.leftbtn.visible=false;this.rightbtn.visible=true}else if(this.list1.scrollH>=(this.list1.dataProvider.length-3)*150){this.leftbtn.visible=true;this.rightbtn.visible=false}else{this.leftbtn.visible=true;this.rightbtn.visible=true}};WeaponWin.prototype.onChangeFlex=function(){if(this.nothingTips.visible){this.leftbtn0.visible=false;this.rightbtn0.visible=false;return}var role=SubRoles.ins().getSubRoleByIndex(this.roleId);if(role&&this.soulArr.length<=3){this.leftbtn0.visible=false;this.rightbtn0.visible=false;return}if(this.list0.scrollH<150){this.leftbtn0.visible=false;this.rightbtn0.visible=true}else if(this.list0.scrollH>=(this.list0.dataProvider.length-3)*150){this.leftbtn0.visible=true;this.rightbtn0.visible=false}else{this.leftbtn0.visible=true;this.rightbtn0.visible=true}};WeaponWin.prototype.onEvent=function(e){var num=150*3;switch(e.currentTarget){case this.leftbtn:if(this.list1.scrollH<=num)this.list1.scrollH=0;else this.list1.scrollH-=num;break;case this.rightbtn:if(this.list1.scrollH>=(this.list1.dataProvider.length-3)*150)this.list1.scrollH=(this.list1.dataProvider.length-3)*150;else this.list1.scrollH+=num;break;case this.leftbtn0:if(this.list0.scrollH<=num)this.list0.scrollH=0;else this.list0.scrollH-=num;break;case this.rightbtn0:if(this.list0.scrollH>=(this.list0.dataProvider.length-3)*150)this.list0.scrollH=(this.list0.dataProvider.length-3)*150;else this.list0.scrollH+=num;break;case this.active:if(this.active.label==i18n("WeaponWin_2")){var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var fb=role.weapons.getFlexibleData();if(role.weapons.flexibleCount<=fb.length){UserTips.ins().showCenterTips(i18n("WeaponWin_3",role.weapons.flexibleCount));return}if(!this.weaponFlexible){UserTips.ins().showCenterTips(i18n("WeaponWin_4"));return}this.isSendActFlex=true;Weapons.ins().sendWeaponsFlexibleAct(this.roleId,WeaponFlex.act,this.weaponFlexible)}else if(this.active.label==i18n("WeaponWin_5")){if(!this.weaponFlexible){UserTips.ins().showCenterTips(i18n("WeaponWin_6"));return}this.isSendActFlex=true;Weapons.ins().sendWeaponsFlexibleAct(this.roleId,WeaponFlex.cancel,this.weaponFlexible)}break;case this.turnBtn:this.close();this.open(this.roleId,false);var v=ViewManager.ins().getView(ForgeWin);if(v)v.redPointEx();var item=UserBag.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid);var r=SubRoles.ins().getSubRoleByIndex(this.roleId);if(item&&r.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum){ViewManager.ins().open(RoleChooseItemWin,this.roleId)}break;case this.backBtn:if(!UserBag.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid)){UserTips.ins().showTips(i18n("WeaponWin_7"));return}ViewManager.ins().open(RoleChooseItemWin,this.roleId);break}this.onChange();this.onChangeFlex()};WeaponWin.prototype.updateUI=function(){var role=SubRoles.ins().getSubRoleByIndex(this.roleId);this.powerPanel.setPower(role.getWeaponTotalPower());var filterAttr=[4,2,6,5];var attrValue=[0,0,0,0];var isHave=false;var infodata=role.weapons.getInfoData();for(var k in infodata){var wsinfo=infodata[k];for(var w in wsinfo){var info=wsinfo[w];for(var j=0;j<info.attr.length;j++){var attr=info.attr[j];if(filterAttr.indexOf(attr.type)!=-1){for(var z=0;z<filterAttr.length;z++){if(filterAttr[z]==attr.type){attrValue[z]+=attr.value;isHave=true}}}}}}var index=role.weapons.flexibleCount?role.weapons.flexibleCount-1:0;var cfg=GlobalConfig.WeaponSoulItemAttr[index];if(isHave&&cfg){for(var i=0;i<cfg.attr.length;i++){if(filterAttr.indexOf(cfg.attr[i].type)!=-1){for(var z=0;z<filterAttr.length;z++){if(filterAttr[z]==cfg.attr[i].type)attrValue[z]+=cfg.attr[i].value}}}}for(var i=0;i<4;i++){if(this["attr"+i]){var attname=AttributeData.getAttrStrByType(filterAttr[i]);this["attr"+i].text=attname+"+"+attrValue[i]}}};WeaponWin.prototype.callback=function(){this.soulArr=[];var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var wss=role.weapons.getSuitConfig(this.weaponId);for(var k in this.listdata){var wsinfo=role.weapons.getSoulInfoData()[this.listdata[k].showId];var info=this.listdata[k];if(info.showId==this.weaponId){info.isuse=role.weapons.weaponsId==this.weaponId?true:false;info.id=wsinfo&&wsinfo.id&&wss?wss.id:0;info.isRedPoint=role.weapons.getRedPointBySuit(info.showId);info.level=wsinfo&&wsinfo.id&&wss?wss.level:0;info.isSelect=true;info.showId=info.showId}else{info.isRedPoint=role.weapons.getRedPointBySuit(info.showId);info.isSelect=false;info.isuse=info.showId==role.weapons.weaponsId}if(wsinfo&&wsinfo.id&&wss)this.soulArr.push(info)}this.updateUI();this.dataArr.replaceAll(this.listdata);this.list1.dataProvider=this.dataArr;this.updateSoul(this.soulArr);this.updateActLabel();this.updateRedPoint()};WeaponWin.prototype.updateSoul=function(arr,init){var role=SubRoles.ins().getSubRoleByIndex(this.roleId);this.soulArr=[];if(role.weapons.flexibleCount){for(var i=0;i<arr.length;i++){var info={isuse:Weapons.ins().checkIsUseFlexible(role.index,arr[i].id),id:arr[i].id,isRedPoint:ForgeRedPoint.ins().getFlexibleRedPointOnly(role.index,arr[i].showId),level:arr[i].level,isSelect:arr[i].isSelect,showId:arr[i].showId,job:arr[i].job};this.soulArr.push(info)}}this.list0.dataProvider=new eui.ArrayCollection(this.soulArr);var count=role.weapons.flexibleCount?role.weapons.flexibleCount-1:0;this.desc.textFlow=TextFlowMaker.generateTextFlow1(i18n("WeaponWin_8",count,count+1));if(init){if(this.soulArr.length>0&&role.weapons.flexibleCount){this.active.visible=this.skillicon0.visible=this.skill.visible=this.skillname0.visible=true;var wsconfig=role.weapons.getSuitConfig(this.soulArr[0].id);if(wsconfig){var color="";if(this.soulArr[0].isuse)color=i18n("WeaponWin_18");this.skillicon0.data={icon:wsconfig.skillicon};this.skill.textFlow=TextFlowMaker.generateTextFlow1(color+wsconfig.skilldesc);this.skillname0.textFlow=TextFlowMaker.generateTextFlow1(wsconfig.skillname)}this.leftbtn0.visible=this.rightbtn0.visible=false;if(this.soulArr.length>3){this.rightbtn0.visible=true}if(this.soulArr[0].isuse){this.active.label=i18n("WeaponWin_9");this.redPoint.visible=false}else{this.active.label=i18n("WeaponWin_10");var fb=role.weapons.getFlexibleData();this.active.visible=this.redPoint.visible=role.weapons.flexibleCount<=fb.length?false:true}this.weaponFlexible=this.soulArr[0].showId}else{this.redPoint.visible=false;this.leftbtn0.visible=this.rightbtn0.visible=false;this.active.visible=this.skillicon0.visible=this.skill.visible=this.skillname0.visible=false}this.nothingTips.visible=!this.skillicon0.visible;if(this.nothingTips.visible){if(!role.weapons.flexibleCount)this.nothingTips.text=i18n("WeaponWin_11");else this.nothingTips.text=i18n("WeaponWin_12")}}};WeaponWin.prototype.updateActLabel=function(){if(!this.isSendActFlex){this.isSendActFlex=false;return}var role=SubRoles.ins().getSubRoleByIndex(this.roleId);var fb=role.weapons.getFlexibleData();this.isSendActFlex=false;var str=this.skill.text;if(this.active.label==i18n("WeaponWin_13")){this.active.label=i18n("WeaponWin_14");this.redPoint.visible=false;this.skill.textFlow=TextFlowMaker.generateTextFlow1(i18n("WeaponWin_19",str))}else if(this.active.label==i18n("WeaponWin_15")){this.active.label=i18n("WeaponWin_16");this.active.visible=this.redPoint.visible=role.weapons.flexibleCount<=fb.length?false:true;this.skill.textFlow=TextFlowMaker.generateTextFlow1(i18n("WeaponWin_20",str))}};WeaponWin.prototype.destoryView=function(){_super.prototype.destoryView.call(this)};WeaponWin.prototype.isShowSoul=function(){if(!this.soul)return false;return this.soul.visible};WeaponWin.prototype.updateRedPoint=function(){var item=UserBag.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid);var role=SubRoles.ins().getSubRoleByIndex(this.roleId);this.redPoint0.visible=ForgeRedPoint.ins().getFlexibleRedPoint(this.roleId)||item&&role.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum?true:false;this.backBtn.visible=this.redPoint1.visible=item&&role.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum?true:false};return WeaponWin}(BaseEuiView);__reflect(WeaponWin.prototype,"WeaponWin");var WingFeishengTipsWin=function(_super){__extends(WingFeishengTipsWin,_super);function WingFeishengTipsWin(){var _this=_super.call(this)||this;_this._curRole=0;_this.skinName="wingFeishengTips";_this.isTopLevel=true;return _this}WingFeishengTipsWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._curRole=args[0];this.observe(UserBag.ins().postItemAdd,this.itemChange);this.observe(UserBag.ins().postItemChange,this.itemChange);this.observe(UserBag.ins().postItemDel,this.itemChange);this.observe(Wing.ins().postUseDanSuccess,this.update);this.observe(Wing.ins().postWingUpgrade,this.update);this.addTouchEvent(this,this.onTouch);this.update()};WingFeishengTipsWin.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this,this.onTouch)};WingFeishengTipsWin.prototype.update=function(){var role=SubRoles.ins().getSubRoleByIndex(this._curRole);var cfg=GlobalConfig.WingLevelConfig[role.wingsData.lv];this.wingName.text=cfg.name;this.feishengLv.text=role.wingsData.flyUpDan+i18n("WingFeishengTipsWin_0");this.career.text=Role.getJobNameByJob(role.job);var maxNum=cfg.flyPill;if(role.wingsData.flyUpDan>=maxNum)this.currentState="maxLv";else{var itemData=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.flyPillId);var num=itemData?itemData.count:0;if(num)this.currentState="normal";else this.currentState="noitem"}this.updateAttrs()};WingFeishengTipsWin.prototype.updateAttrs=function(){var role=SubRoles.ins().getSubRoleByIndex(this._curRole);var cfg=GlobalConfig.WingLevelConfig[role.wingsData.lv];var len=cfg.attr.length;var flyAttrs=GlobalConfig.WingCommonConfig.flyPillAttr;var len2=flyAttrs.length;var pAttr=[];var attData;for(var i=1;i<=4;i++){this["attr"+i].text="";this["attr"+i+"NextLv"].text="";if(i<=len){attData=cfg.attr[i-1];this["attr"+i].text=AttributeData.getAttrStrByType(attData.type)+": +"+Math.floor(GlobalConfig.WingCommonConfig.flyPill/100)*role.wingsData.flyUpDan+"%";if(this.currentState=="normal")this["attr"+i+"NextLv"].text="+"+Math.floor(GlobalConfig.WingCommonConfig.flyPill/100)*(role.wingsData.flyUpDan+1)+"%";pAttr.push(new AttributeData(attData.type,Math.floor(attData.value*GlobalConfig.WingCommonConfig.flyPill/1e4*role.wingsData.flyUpDan)))}this["attr"+(i+4)].text="";this["attr"+(i+4)+"NextLv"].text="";if(i<=len2){attData=flyAttrs[i-1];this["attr"+(i+4)].text=AttributeData.getAttrStrByType(attData.type)+": +"+attData.value*role.wingsData.flyUpDan;if(this.currentState=="normal")this["attr"+(i+4)+"NextLv"].text="+"+attData.value*(role.wingsData.flyUpDan+1);pAttr.push(new AttributeData(attData.type,attData.value*role.wingsData.flyUpDan))}}this.powerPanel.setPower(UserBag.getAttrPower(pAttr))};WingFeishengTipsWin.prototype.itemChange=function(){if(this.currentState=="maxLv")return;var itemData=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.flyPillId);var num=itemData?itemData.count:0;var stateChange;if(num){stateChange=this.currentState!="normal";this.currentState="normal"}else{stateChange=this.currentState!="noitem";this.currentState="noitem"}if(stateChange)this.updateAttrs()};WingFeishengTipsWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.updateBtn:Wing.ins().sendUseDan(this._curRole,1);break}};return WingFeishengTipsWin}(BaseEuiView);__reflect(WingFeishengTipsWin.prototype,"WingFeishengTipsWin");ViewManager.ins().reg(WingFeishengTipsWin,LayerManager.UI_Main);var WingZizhiTipsWin=function(_super){__extends(WingZizhiTipsWin,_super);function WingZizhiTipsWin(){var _this=_super.call(this)||this;_this._curRole=0;_this.skinName="wingZizhiTips";_this.isTopLevel=true;return _this}WingZizhiTipsWin.prototype.open=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}this._curRole=args[0];this.observe(UserBag.ins().postItemAdd,this.itemChange);this.observe(UserBag.ins().postItemChange,this.itemChange);this.observe(UserBag.ins().postItemDel,this.itemChange);this.observe(Wing.ins().postUseDanSuccess,this.update);this.observe(Wing.ins().postWingUpgrade,this.update);this.addTouchEvent(this,this.onTouch);this.update()};WingZizhiTipsWin.prototype.close=function(){this.removeObserve();this.removeTouchEvent(this,this.onTouch)};WingZizhiTipsWin.prototype.update=function(){var role=SubRoles.ins().getSubRoleByIndex(this._curRole);var cfg=GlobalConfig.WingLevelConfig[role.wingsData.lv];this.wingName.text=cfg.name;this.zizhiLv.text=role.wingsData.aptitudeDan+i18n("WingZizhiTipsWin_0");this.career.text=Role.getJobNameByJob(role.job);var maxNum=cfg.attrPill;if(role.wingsData.aptitudeDan>=maxNum)this.currentState="maxLv";else{var itemData=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.attrPillId);var num=itemData?itemData.count:0;if(num)this.currentState="normal";else this.currentState="noitem"}this.updateAttrs()};WingZizhiTipsWin.prototype.updateAttrs=function(){var role=SubRoles.ins().getSubRoleByIndex(this._curRole);var attrs=GlobalConfig.WingCommonConfig.attrPill;var len=attrs.length;var pAttr=[];var attData;for(var i=1;i<=4;i++){this["attr"+i].text="";this["attr"+i+"NextLv"].text="";if(i<=len){attData=attrs[i-1];this["attr"+i].text=AttributeData.getAttrStrByType(attData.type)+": +"+attData.value*role.wingsData.aptitudeDan;pAttr.push(new AttributeData(attData.type,attData.value*role.wingsData.aptitudeDan));if(this.currentState=="normal")this["attr"+i+"NextLv"].text="+"+attrs[i-1].value*(role.wingsData.aptitudeDan+1)}}this.powerPanel.setPower(UserBag.getAttrPower(pAttr))};WingZizhiTipsWin.prototype.itemChange=function(){if(this.currentState=="maxLv")return;var itemData=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.attrPillId);var num=itemData?itemData.count:0;var stateChange;if(num){stateChange=this.currentState!="normal";this.currentState="normal"}else{stateChange=this.currentState!="noitem";this.currentState="noitem"}if(stateChange)this.updateAttrs()};WingZizhiTipsWin.prototype.onTouch=function(e){switch(e.target){case this.bgClose:ViewManager.ins().close(this);break;case this.updateBtn:Wing.ins().sendUseDan(this._curRole,0);break}};return WingZizhiTipsWin}(BaseEuiView);__reflect(WingZizhiTipsWin.prototype,"WingZizhiTipsWin");ViewManager.ins().reg(WingZizhiTipsWin,LayerManager.UI_Main);var WinOpenMgr=function(_super){__extends(WinOpenMgr,_super);function WinOpenMgr(){return _super.call(this)||this}WinOpenMgr.ins=function(){return _super.ins.call(this)};WinOpenMgr.prototype.isOpen=function(winId){if(winId<=0){return true}var winCfg=GlobalConfig.WinOpenConfig[winId];if(winCfg){if(winId==WinType.wing||winId==WinType.lingYu){var role=SubRoles.ins().getSubRoleByIndex(StrengthMgr.ins().curRoleId);if(role&&role.wingsData&&!role.wingsData.openStatus){return false}}if(winId==WinType.shengXing||winId==WinType.ringSkill){return SpecialRing.ins().isFireRingFuse()}else if(winId==WinType.wuShuangYin){var data=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(!data)return false;var stage=data?SpecialRing.ins().getRingStair(data.level):0;return stage>=16}else if(winId==WinType.fb){return OpenSystem.ins().checkSysOpen(SystemType.FB)&&!UserFb.ins().pkGqboss}else if(winId==WinType.ssBoss){return Recharge.ins().monthDay>0}else if(winId==WinType.mhBoss){return Recharge.ins().franchise>0}else{var isOpen=false;if(winCfg.openLevel!=null){isOpen=Actor.level>=winCfg.openLevel;if(!isOpen)return false}if(winCfg.openZSLevel!=null){isOpen=UserZs.ins().lv>=winCfg.openZSLevel;if(!isOpen)return false}if(winCfg.openGq!=null){isOpen=UserFb.ins().guanqiaID>=winCfg.openGq;if(!isOpen)return false}if(winCfg.openDays!=null){isOpen=GameServer.serverOpenDay>=winCfg.openDays;if(!isOpen)return false}if(winCfg.vipLv!=null){isOpen=UserVip.ins().lv>=winCfg.vipLv;if(!isOpen)return false}if(winId==WinType.heFuXunBao){isOpen=GameServer._serverHeZeroTime>0;if(!isOpen)return false}return isOpen}}return false};return WinOpenMgr}(BaseSystem);__reflect(WinOpenMgr.prototype,"WinOpenMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.winOpenMgr=WinOpenMgr.ins.bind(WinOpenMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var WinType;(function(WinType){WinType[WinType["shengXing"]=1]="shengXing";WinType[WinType["ringSkill"]=2]="ringSkill";WinType[WinType["wuShuangYin"]=3]="wuShuangYin";WinType[WinType["bazhuang"]=5]="bazhuang";WinType[WinType["jueShi"]=6]="jueShi";WinType[WinType["heirloom"]=7]="heirloom";WinType[WinType["yuXi"]=8]="yuXi";WinType[WinType["fuWen"]=9]="fuWen";WinType[WinType["wing"]=11]="wing";WinType[WinType["lingYu"]=12]="lingYu";WinType[WinType["liuDao"]=13]="liuDao";WinType[WinType["zhanJi"]=14]="zhanJi";WinType[WinType["neiGong"]=15]="neiGong";WinType[WinType["xueWei"]=16]="xueWei";WinType[WinType["xianYu"]=17]="xianYu";WinType[WinType["guanZhi"]=18]="guanZhi";WinType[WinType["yingHun"]=19]="yingHun";WinType[WinType["qiangHua"]=20]="qiangHua";WinType[WinType["yeLian"]=21]="yeLian";WinType[WinType["jingDiao"]=22]="jingDiao";WinType[WinType["jianLing"]=23]="jianLing";WinType[WinType["yuPei"]=25]="yuPei";WinType[WinType["bingFa"]=26]="bingFa";WinType[WinType["shengShou"]=27]="shengShou";WinType[WinType["hunPo"]=28]="hunPo";WinType[WinType["fb"]=29]="fb";WinType[WinType["zs"]=30]="zs";WinType[WinType["shenBing"]=31]="shenBing";WinType[WinType["slt"]=32]="slt";WinType[WinType["grBoss"]=33]="grBoss";WinType[WinType["ywBoss"]=34]="ywBoss";WinType[WinType["mjBoss"]=35]="mjBoss";WinType[WinType["syBoss"]=36]="syBoss";WinType[WinType["ssBoss"]=37]="ssBoss";WinType[WinType["mhBoss"]=38]="mhBoss";WinType[WinType["shapeShift"]=39]="shapeShift";WinType[WinType["tianMing"]=40]="tianMing";WinType[WinType["tmflood1"]=41]="tmflood1";WinType[WinType["tmflood2"]=42]="tmflood2";WinType[WinType["tmflood3"]=43]="tmflood3";WinType[WinType["tmflood4"]=44]="tmflood4";WinType[WinType["tmflood5"]=45]="tmflood5";WinType[WinType["jinDi1"]=46]="jinDi1";WinType[WinType["jinDi2"]=47]="jinDi2";WinType[WinType["jinDi3"]=48]="jinDi3";WinType[WinType["biWu"]=49]="biWu";WinType[WinType["shenLing"]=50]="shenLing";WinType[WinType["zhengBa"]=51]="zhengBa";WinType[WinType["shenJiang"]=52]="shenJiang";WinType[WinType["zhuangBei"]=53]="zhuangBei";WinType[WinType["fuWenXunBao"]=54]="fuWenXunBao";WinType[WinType["kuaFu3v3"]=55]="kuaFu3v3";WinType[WinType["maBiJieZhi"]=56]="maBiJieZhi";WinType[WinType["heFuXunBao"]=57]="heFuXunBao";WinType[WinType["bhTianShu"]=58]="bhTianShu";WinType[WinType["xwTianShu"]=59]="xwTianShu";WinType[WinType["qlTianShu"]=60]="qlTianShu";WinType[WinType["zqTianShu"]=61]="zqTianShu"})(WinType||(WinType={}));window["WinType"]=WinType;var ZeroPurchase=function(){function ZeroPurchase(){}ZeroPurchase.ins=function(){if(this._zeroPurchase==null){this._zeroPurchase=new ZeroPurchase}if(this.isInitData()){this.initData()}return this._zeroPurchase};ZeroPurchase.isInitData=function(){return this.zeroPurchaseConfig.length<=0};ZeroPurchase.initData=function(){this.initZeroPurchaseConfig();this.initActivityId()};ZeroPurchase.initZeroPurchaseConfig=function(){var cfg=GlobalConfig.ActivityType23Config;for(var k in cfg){if(k&&cfg[k]){for(var key in cfg[k]){this.zeroPurchaseConfig.push(cfg[k][key])}break}}};Object.defineProperty(ZeroPurchase.prototype,"zeroPurchaseConfig",{get:function(){return ZeroPurchase.zeroPurchaseConfig},enumerable:true,configurable:true});ZeroPurchase.initActivityId=function(){var cfg=GlobalConfig.ActivityType23Config;for(var k in cfg){if(k&&cfg[k]){this.activityId=parseInt(k);break}}};Object.defineProperty(ZeroPurchase.prototype,"activityId",{get:function(){return ZeroPurchase.activityId},enumerable:true,configurable:true});ZeroPurchase.prototype.getLeftTime=function(){var data=Activity.ins().getActivityDataById(this.activityId);var time=data?data.getLeftTime():0;return time};ZeroPurchase.prototype.isAbleToBuyOne=function(){return this.getAbleToBuyIndex()>=0};ZeroPurchase.prototype.getAbleToBuyIndex=function(){var result=-1;var cfg=ZeroPurchase.zeroPurchaseConfig;var len=cfg.length;for(var index=0;index<len;++index){if(this.isAbleToBuyByIndex(index)){result=index;break}}return result};ZeroPurchase.prototype.isAbleToBuyByIndex=function(index){return this.isHaveLeftBuyTimeByIndex(index)&&this.isYuanBaoEnoughByIndex(index)&&this.isReachVipLvByIndex(index)};ZeroPurchase.prototype.isHaveLeftBuyTimeByIndex=function(index){var cfg=ZeroPurchase.zeroPurchaseConfig;var itemIndex=index+1;if(cfg){for(var k in cfg){if(cfg[k]&&cfg[k].index==itemIndex){var data=Activity.ins().getActivityDataById(ZeroPurchase.activityId);var buyTimesData=data?data.buyTimesData:[];if(buyTimesData[itemIndex]<cfg[k].buyLimits){return true}}}}return false};ZeroPurchase.prototype.isYuanBaoEnoughByIndex=function(index){var cfg=ZeroPurchase.zeroPurchaseConfig;var itemIndex=index+1;if(cfg){for(var k in cfg){if(cfg[k]&&cfg[k].index==itemIndex){if(Actor.yb>=cfg[k].price){return true}}}}return false};ZeroPurchase.prototype.isReachVipLvByIndex=function(index){var cfg=ZeroPurchase.zeroPurchaseConfig;var itemIndex=index+1;if(cfg){for(var k in cfg){if(cfg[k]&&cfg[k].index==itemIndex){if(UserVip.ins().lv>=cfg[k].VIPLv){return true}}}}return false};ZeroPurchase.prototype.isHaveLeftBuyTime=function(){var cfg=ZeroPurchase.zeroPurchaseConfig;var len=cfg.length;for(var index=0;index<len;++index){if(this.isHaveLeftBuyTimeByIndex(index)){return true}}return false};ZeroPurchase.zeroPurchaseConfig=[];ZeroPurchase.activityId=0;return ZeroPurchase}();__reflect(ZeroPurchase.prototype,"ZeroPurchase");var ZeroPurchaseLocalStorageItem=function(){function ZeroPurchaseLocalStorageItem(icon,status){this.time="";this.icon="";this.status=false;this.time=(new Date).toDateString();this.icon=icon;this.status=status}ZeroPurchaseLocalStorageItem.getData=function(cb){ServerLocalStorage.getCurServer(function(server){LoginMgr.getItem(ZeroPurchaseLocalStorageItem.user,function(userId){LoginMgr.getItem(ZeroPurchaseLocalStorageItem.key+server+userId,function(v){if(!v){v="{}"}var d=JSON.parse(v);if(!d){d={};LoginMgr.setItem(ZeroPurchaseLocalStorageItem.key+server+userId,JSON.stringify(d))}cb(d)})})})};ZeroPurchaseLocalStorageItem.setData=function(newValue){var rule=ZeroPurchaseLocalStorageItem.rule;ZeroPurchaseLocalStorageItem.getData(function(data){for(var k in newValue){data[k]=newValue[k]}ServerLocalStorage.getCurServer(function(server){LoginMgr.getItem(ZeroPurchaseLocalStorageItem.user,function(userId){LoginMgr.setItem(ZeroPurchaseLocalStorageItem.key+server+userId,JSON.stringify(data));if(rule){var tar=rule.getTar();if(tar["redPoint"]){tar["redPoint"].visible=rule.checkShowRedPoint()}}ZeroPurchaseLocalStorageItem.setRedPoint(data)})})})};ZeroPurchaseLocalStorageItem.update=function(target){var today=(new Date).toDateString();if(today!=target.time){target.time=today;target.status=true}};ZeroPurchaseLocalStorageItem.setRedPoint=function(data){var result=false;for(var key in data){result=result||data[key].status}this.hasRedPoint=Object.keys(data).length==0?true:result};ZeroPurchaseLocalStorageItem.key="_ZeroPurchaseRedPoint_";ZeroPurchaseLocalStorageItem.user="__savedUserID";ZeroPurchaseLocalStorageItem.hasRedPoint=false;return ZeroPurchaseLocalStorageItem}();__reflect(ZeroPurchaseLocalStorageItem.prototype,"ZeroPurchaseLocalStorageItem");var ZeroPurchaseItem=function(_super){__extends(ZeroPurchaseItem,_super);function ZeroPurchaseItem(){var _this=_super.call(this)||this;_this.zpv="zpv";_this.skinName="ZeroPurchaseVipListItemSkin";return _this}ZeroPurchaseItem.prototype.dataChanged=function(){if(this.data==null)return;this.zpImg.source=this.zpv+this.data;console.log("selected = "+this.selected+"  index = "+this.itemIndex);if(this.selected){if(!this.mc){this.mc=new MovieClip;this.mc.x=32;this.mc.y=32}this.mc.playFile(RES_DIR_EFF+"quaeff4",-1);this.addChild(this.mc)}else{if(this.mc){DisplayUtils.removeFromParent(this.mc);this.mc=null}}};return ZeroPurchaseItem}(BaseItemRender);__reflect(ZeroPurchaseItem.prototype,"ZeroPurchaseItem");var ZeroPurchaseVipListItem=function(_super){__extends(ZeroPurchaseVipListItem,_super);function ZeroPurchaseVipListItem(){var _this=_super.call(this)||this;_this.zpv="zpv";_this.skinName="ZeroPurchaseVipListItemSkin";return _this}ZeroPurchaseVipListItem.prototype.dataChanged=function(){var _this=this;if(this.data==null)return;this.zpImg.source=this.zpv+this.data;ZeroPurchaseLocalStorageItem.getData(function(localData){_this.redPoint.visible=localData[_this.itemIndex]?ZeroPurchase.ins().isHaveLeftBuyTimeByIndex(_this.itemIndex)&&localData[_this.itemIndex].status:ZeroPurchase.ins().isHaveLeftBuyTimeByIndex(_this.itemIndex);if(_this.selected){if(!_this.mc){_this.mc=new MovieClip;_this.mc.x=_this.width/2-1;_this.mc.y=_this.height/2+6}_this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1);_this.addChild(_this.mc)}else{if(_this.mc){DisplayUtils.removeFromParent(_this.mc);_this.mc=null}}})};return ZeroPurchaseVipListItem}(BaseItemRender);__reflect(ZeroPurchaseVipListItem.prototype,"ZeroPurchaseVipListItem");var ZeroPurchaseWin=function(_super){__extends(ZeroPurchaseWin,_super);function ZeroPurchaseWin(){var _this=_super.call(this)||this;_this.zeroPurchaseConfig=[];_this.activityId=0;_this.lastEffIndex=0;_this.isTopLevel=true;_this.skinName="ZeroPurchaseSkin";return _this}ZeroPurchaseWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.vipList,this.onTouch);this.addTouchEvent(this.buyBtn,this.onTouch);this.addTouchEvent(this.closeBtn0,this.onTouch);this.addTouchEvent(this.itemBtn,this.onTouch);this.itemBase.visible=false;this.observe(Activity.ins().postRewardResult,this.dealBuyResult);this.initData1();this.initLists();this.loopSetLeftTime();this.updateShow();this.playEff()};ZeroPurchaseWin.prototype.playEff=function(){var groupEff=this.groupEff;var effMc=new MovieClip;effMc.x=0;effMc.y=0;var soure=RES_DIR_EFF+"syzsd_eff";effMc.playFile(soure,-1);this.groupEff.addChild(effMc)};ZeroPurchaseWin.prototype.initData1=function(){var zpIns=ZeroPurchase.ins();this.zeroPurchaseConfig=zpIns.zeroPurchaseConfig;this.activityId=zpIns.activityId};ZeroPurchaseWin.prototype.initLists=function(){var rewardsList=this.rewardsList;rewardsList.dataProvider=new ArrayCollection([]);rewardsList.itemRenderer=ItemBase;var vipList=this.vipList;vipList.dataProvider=new ArrayCollection([]);vipList.itemRenderer=ZeroPurchaseVipListItem;vipList.selectedIndex=0};ZeroPurchaseWin.prototype.setLeftTime=function(){var leftTime=ZeroPurchase.ins().getLeftTime();var leftTimeTxt="";if(leftTime>=DateUtils.SECOND_PER_DAY){leftTimeTxt=Math.floor(leftTime/DateUtils.SECOND_PER_DAY)+i18n("ZeroPurchaseWin_0")}else if(leftTime>0){var hour=Math.floor(leftTime/DateUtils.SECOND_PER_HOUR);var munite=Math.floor((leftTime-hour*DateUtils.SECOND_PER_HOUR)/DateUtils.SECOND_PER_MUNITE);var second=0;if(hour>0){leftTimeTxt+=hour+i18n("ZeroPurchaseWin_1")}else{second=leftTime-hour*DateUtils.SECOND_PER_HOUR-munite*DateUtils.SECOND_PER_MUNITE}if(munite>0){leftTimeTxt+=munite+i18n("ZeroPurchaseWin_2")}else if(munite==0&&hour>0){leftTimeTxt+=munite+i18n("ZeroPurchaseWin_3")}if(second>0){leftTimeTxt+=second+i18n("ZeroPurchaseWin_4")}}else if(leftTime<=0){leftTimeTxt=i18n("ZeroPurchaseWin_5")}this.leftTimeTxt.text=leftTimeTxt};ZeroPurchaseWin.prototype.dealBuyResult=function(activityID){if(Activity.ins().isSuccee&&activityID==this.activityId){ViewManager.ins().open(ZPRewardsWin,this.rewardsList.dataProvider);this.updateShow()}else{UserTips.ins().showTips(i18n("ZeroPurchaseWin_6"))}};ZeroPurchaseWin.prototype.loopSetLeftTime=function(){this.setLeftTime();TimerManager.ins().doTimer(1e3,0,this.setLeftTime,this)};ZeroPurchaseWin.prototype.updateShow=function(){var _this=this;var vipList=this.vipList;ZeroPurchaseLocalStorageItem.getData(function(v){_this._lastLocalData=v;_this.setVipListData();_this.setCurRewardsInfoByIndex(vipList.selectedIndex);_this.vipTxt.text="尊者"+vipList.selectedItem+i18n("ZeroPurchaseWin_7");_this.vipTxt.textColor=UserVip.ins().lv>=vipList.selectedItem?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N;if(_this.rewardsList.numElements<=3){_this.rewardsScroll.y=310}else{_this.rewardsScroll.y=240}})};ZeroPurchaseWin.prototype.setVipListData=function(){var _this=this;var cfg=this.zeroPurchaseConfig;var keyName;ZeroPurchaseLocalStorageItem.getData(function(data){if(cfg){var vipLevels=[];for(var k in cfg){var index=vipLevels.length;if(cfg[k]&&cfg[k].VIPLv!=null){vipLevels.push(cfg[k].VIPLv);keyName="zpv"+cfg[k].VIPLv;if(index in data){ZeroPurchaseLocalStorageItem.update(data[index])}else{data[index]=new ZeroPurchaseLocalStorageItem(keyName,true)}}}data[_this.vipList.selectedIndex]&&(data[_this.vipList.selectedIndex].status=false);var dataProvider=_this.vipList.dataProvider;dataProvider.replaceAll(vipLevels)}ZeroPurchaseLocalStorageItem.setData(data)})};ZeroPurchaseWin.prototype.setCurRewardsInfoByIndex=function(index){this.setRewardListData(index);this.setBuyBtn(index);this.setRewardEff(index)};ZeroPurchaseWin.prototype.setRewardListData=function(index){var cfg=this.zeroPurchaseConfig[index];if(cfg){var rewards=cfg.reward;var rewardsData=[];for(var key in rewards){if(!rewards[key])continue;var k=parseInt(key);if(k==0){this.itemBase.data=rewards[key]}rewardsData.push(rewards[key])}var dataProvider=this.rewardsList.dataProvider;dataProvider.replaceAll(rewardsData)}};ZeroPurchaseWin.prototype.setBuyBtn=function(index){var cfg=this.zeroPurchaseConfig[index];var data=this._lastLocalData;if(cfg){this.oldPriceTxt.textFlow=TextFlowMaker.generateTextFlow(i18n("ZeroPurchaseWin_8")+cfg.Oldprice+i18n("ZeroPurchaseWin_9"));this.desc.text=i18n("ZeroPurchaseWin_21",cfg.returnDays);if(ZeroPurchase.ins().isHaveLeftBuyTimeByIndex(index)){this.buyBtn.label=cfg.price+i18n("ZeroPurchaseWin_10");this.buyBtn.skinName="ZPBtnBuySkin";this.redPoint.visible=data[index]?data[index].status:true}else{this.buyBtn.label=i18n("ZeroPurchaseWin_11");this.buyBtn.skinName="ZPBtnNoBuySkin";this.redPoint.visible=false}}};ZeroPurchaseWin.prototype.setRewardEff=function(index){var config=this.zeroPurchaseConfig[index];if(!config){return}var itemConfig=GlobalConfig.ItemConfig;var id=config.reward[0].id;if(itemConfig[id]){this.labelName.text=itemConfig[id].name}if(config.showType==0){var imageNum=index+1;this.zpgiftbagImg.visible=true;this.ringMcGroup.visible=false;this.zpgiftbagImg.source="zpgiftbag"+imageNum}else{this.zpgiftbagImg.visible=false;this.ringMcGroup.visible=true;if(this.lastEffIndex==index){return}else{this.lastEffIndex=index;this.ringMcGroup.removeChildren()}this.ringMcGroup.y=index==4?280:320;var iconMc=new MovieClip;iconMc.x=0;iconMc.y=0;var soure=config.source||"";iconMc.playFile(soure,-1);this.ringMcGroup.addChild(iconMc)}};ZeroPurchaseWin.prototype.onTouch=function(e){if(!e||!e.target)return;switch(e.currentTarget){case this.vipList:this.updateShow();break;case this.buyBtn:this.onBuyBtn();break;case this.closeBtn0:this.onClose();break;case this.itemBtn:this.itemBase.onClick();break}};ZeroPurchaseWin.prototype.onBuyBtn=function(){var zpIns=ZeroPurchase.ins();var selectedIndex=this.vipList.selectedIndex;var errorTxt="";if(!zpIns.isHaveLeftBuyTimeByIndex(selectedIndex)){errorTxt=i18n("ZeroPurchaseWin_12")}else if(!zpIns.isYuanBaoEnoughByIndex(selectedIndex)){errorTxt=i18n("ZeroPurchaseWin_13");if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"));return}var warnWin=WarnWin.show(i18n("ZeroPurchaseWin_14"),this.openChargeFirstWin,this);warnWin.setBtnLabel(i18n("ZeroPurchaseWin_15"),i18n("ZeroPurchaseWin_16"))}else if(!zpIns.isReachVipLvByIndex(selectedIndex)){errorTxt=i18n("ZeroPurchaseWin_17");var warnWin=WarnWin.show(i18n("ZeroPurchaseWin_18"),this.openChargeFirstWin,this);warnWin.setBtnLabel(i18n("ZeroPurchaseWin_19"),i18n("ZeroPurchaseWin_20"))}if(errorTxt!=""){UserTips.ins().showTips(errorTxt);return}var itemIndex=selectedIndex+1;Activity.ins().sendReward(this.activityId,itemIndex)};ZeroPurchaseWin.prototype.openChargeFirstWin=function(){Recharge.ins().tryShowChargeFirstWin()};ZeroPurchaseWin.prototype.onClose=function(){this.removeTouchEvent(this.vipList,this.onTouch);this.removeTouchEvent(this.buyBtn,this.onTouch);this.removeTouchEvent(this.closeBtn0,this.onTouch);this.removeTouchEvent(this.itemBtn,this.onTouch);this.removeObserve();TimerManager.ins().removeAll(this);ViewManager.ins().close(this);_super.prototype.close.call(this)};return ZeroPurchaseWin}(BaseEuiView);__reflect(ZeroPurchaseWin.prototype,"ZeroPurchaseWin");ViewManager.ins().reg(ZeroPurchaseWin,LayerManager.UI_Main);var ZPRewardsWin=function(_super){__extends(ZPRewardsWin,_super);function ZPRewardsWin(){var _this=_super.call(this)||this;_this.skinName="ZPRewardsSkin";return _this}ZPRewardsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.bgClose,this.onClose);this.addTouchEvent(this.sureBtn,this.onClose);if(param&&param[0]){var selectIndex=param[0];var rewardsList=this.rewardsList;console.log("ZPRewards");console.log(param);rewardsList.dataProvider=param[0];rewardsList.itemRenderer=ItemBase}};ZPRewardsWin.prototype.onClose=function(){this.close()};ZPRewardsWin.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose);this.removeTouchEvent(this.sureBtn,this.onClose);_super.prototype.close.call(this);ViewManager.ins().close(this)};return ZPRewardsWin}(BaseEuiView);__reflect(ZPRewardsWin.prototype,"ZPRewardsWin");ViewManager.ins().reg(ZPRewardsWin,LayerManager.UI_Popup);var ZhanLing=function(_super){__extends(ZhanLing,_super);function ZhanLing(){var _this=_super.call(this)||this;_this.sysId=PackageID.WarSpirit;_this.regNetMsg(1,_this.postZhanLingInfo);_this.regNetMsg(2,_this.postZhanLingUpExp);_this.regNetMsg(3,_this.postZhanLingDrug);_this.regNetMsg(4,_this.postZhanLingWear);_this.regNetMsg(6,_this.postZhanLingComposeItem);_this.regNetMsg(7,_this.postZhanLingBubble);_this.regNetMsg(8,_this.doZhanLingSkill);_this.regNetMsg(11,_this.postZhanLingSkinUpGrade);_this.regNetMsg(12,_this.postZhangLingSkinChange);_this.observe(UserZs.ins().postZsLv,_this.initZhanLing);_this.observe(UserBag.ins().postItemAdd,ZhanLingModel.ins().updateShowZLlist);_this.observe(UserBag.ins().postItemDel,ZhanLingModel.ins().updateShowZLlist);_this.observe(UserBag.ins().postItemCountChange,ZhanLingModel.ins().updateShowZLlist);return _this}ZhanLing.ins=function(){return _super.ins.call(this)};ZhanLing.prototype.initLogin=function(){ZhanLingModel.ins().updateShowZLlist()};ZhanLing.prototype.initZero=function(){if(!ZhanLingModel.ins().getZhanLingDataById(0)&&ZhanLingModel.ins().ZhanLingOpen()){ZhanLingModel.ins().setZhanLingData(new ZhanLingData)}};ZhanLing.prototype.initZhanLing=function(){if(!ZhanLingModel.ins().getZhanLingDataById(0)&&ZhanLingModel.ins().ZhanLingOpen()){ZhanLingModel.ins().setZhanLingData(new ZhanLingData)}};ZhanLing.prototype.checkRedPoint=function(){if(!ZhanLingModel.ins().ZhanLingOpen())return false;var id=0;var b=ZhanLingModel.ins().isUpGradeByStar(id)||ZhanLingModel.ins().isHintNum(id);if(b)return true;b=ZhanLingModel.ins().isUpGradeByTalent(id);if(b)return true;var zllconfig=GlobalConfig.ZhanLingConfig;for(var k in zllconfig.upgradeInfo){b=ZhanLingModel.ins().getZhanLingDataByDrugUse(id,Number(k));if(b)return true}for(var i=0;i<ZhanLingModel.ins().showZLlist.length;i++){var zlBase=ZhanLingModel.ins().showZLlist[i];id=zlBase.id;if(id){b=ZhanLingModel.ins().isUpGradeByStar(id)||ZhanLingModel.ins().isHintNum(id);if(b)return true;b=ZhanLingModel.ins().isUpGradeByTalent(id);if(b)return true}}id=0;b=ZhanLingModel.ins().getZhanLingItemRedPoint(id);if(b)return true;return false};ZhanLing.prototype.ZhanLingItemTips=function(id,zlId,body){if(zlId===void 0){zlId=0}if(body===void 0){body=false}var itemid=id;var itemConfig=GlobalConfig.ItemConfig[itemid];var have=body?1:0;var power=ZhanLingModel.ins().getZhanLingItemPower(itemid,have);var score=power;var condition=itemConfig.level?i18n("ZhanLing_1",itemConfig.level):i18n("ZhanLing_0");var config=GlobalConfig.ZhanLingEquip[itemid];var desc={left:i18n("ZhanLing_2"),right:GlobalConfig.ZhanLingConfig.zlEquipName[config.pos-1]+"\n"+condition};var attrs=[];attrs.push({title:i18n("ZhanLing_3"),attr:config.attrs});var suitdesc="";var exdesc="";var suitLv=GlobalConfig.ZhanLingEquip[itemid].level;suitLv=suitLv?suitLv:1;var suitConfig=GlobalConfig.ZhanLingSuit[suitLv];var color=65280;var zlData=ZhanLingModel.ins().getZhanLingDataById(zlId);var titile2="";var colorName=16711935;var colorValue=16711935;var curSum=0;var itemNames="";for(var i=0;i<GlobalConfig.ZhanLingConfig.equipPosCount;i++){var icolor=65280;var equip=zlData?GlobalConfig.ZhanLingEquip[zlData.items[i]]:null;if(!zlData||!zlData.items[i]||!equip||equip.level<suitLv){icolor=color=16711680;colorName=colorValue=6710886}else{curSum++}if(!body){if(i+1==GlobalConfig.ZhanLingEquip[itemid].pos)icolor=65280}var iname=i18n("ZhanLing_5",icolor,GlobalConfig.ZhanLingConfig.zlEquipName[i]);if(i+1<GlobalConfig.ZhanLingConfig.equipPosCount)iname+=i18n("ZhanLing_6",icolor);itemNames+=iname}if(!body){curSum=1}exdesc=i18n("ZhanLing_4")+suitConfig.precent/100+"%";titile2=i18n("ZhanLing_7",color,curSum,GlobalConfig.ZhanLingConfig.equipPosCount);suitdesc=itemNames;attrs.push({title:i18n("ZhanLing_8",suitConfig.suitWithName,titile2),attr:suitConfig.attrs,colorName:colorName,colorValue:colorValue,others:{suitdesc:suitdesc,exdesc:exdesc}});ViewManager.ins().open(EquipTipsBase,UserBag.BAG_TYPE_OTHTER,itemid,score,power,desc,attrs)};ZhanLing.prototype.sendZhanLingUpExp=function(id,buy){if(buy===void 0){buy=0}var bytes=this.getBytes(2);bytes.writeByte(id);bytes.writeByte(buy);this.sendToServer(bytes)};ZhanLing.prototype.sendZhanLingDrug=function(id,itemid){var bytes=this.getBytes(3);bytes.writeByte(id);bytes.writeInt(itemid);this.sendToServer(bytes)};ZhanLing.prototype.sendZhanLingWear=function(id,itemid){var bytes=this.getBytes(4);bytes.writeByte(id);bytes.writeInt(itemid);this.sendToServer(bytes)};ZhanLing.prototype.sendZhanLingComposeItem=function(itemid){var bytes=this.getBytes(5);bytes.writeInt(itemid);this.sendToServer(bytes)};ZhanLing.prototype.sendZhanLingSkinUpGrade=function(id){var bytes=this.getBytes(11);bytes.writeByte(id);this.sendToServer(bytes)};ZhanLing.prototype.sendZhangLingSkinChange=function(id){var bytes=this.getBytes(12);bytes.writeByte(id);this.sendToServer(bytes)};ZhanLing.prototype.postZhanLingInfo=function(bytes){var len=bytes.readByte();for(var i=0;i<len;i++){var zlData=new ZhanLingData;zlData.id=bytes.readInt();zlData.talentLv=bytes.readByte();zlData.level=bytes.readShort();zlData.exp=bytes.readInt();zlData.drugs=[];var drugsLen=bytes.readByte();for(var j=0;j<drugsLen;j++){var itemid=bytes.readInt();var count=bytes.readShort();zlData.drugs.push({itemId:itemid,count:count})}var itemLen=bytes.readByte();if(itemLen){zlData.items=[];for(var k=0;k<itemLen;k++){zlData.items.push(bytes.readInt())}}ZhanLingModel.ins().setZhanLingData(zlData)}var skinId=bytes.readByte();ZhanLingModel.ins().ZhanLingSkinId=skinId};ZhanLing.prototype.postZhanLingUpExp=function(bytes){var id=bytes.readByte();var level=bytes.readShort();var exp=bytes.readInt();var zlData=ZhanLingModel.ins().getZhanLingDataById(id);if(!zlData)return;var oldlevel=zlData.level;zlData.level=level;zlData.exp=exp;if(level>oldlevel)this.postZhanLingUpgrade()};ZhanLing.prototype.postZhanLingUpgrade=function(){};ZhanLing.prototype.postZhanLingDrug=function(bytes){var id=bytes.readByte();var itemid=bytes.readInt();var count=bytes.readShort();var zlData=ZhanLingModel.ins().getZhanLingDataById(id);if(!zlData)return;var ishave=false;for(var i=0;i<zlData.drugs.length;i++){if(zlData.drugs[i].itemId==itemid){zlData.drugs[i].count=count;ishave=true;break}}if(!ishave){zlData.drugs.push({itemId:itemid,count:count})}};ZhanLing.prototype.postZhanLingWear=function(bytes){var id=bytes.readByte();var itemid=bytes.readInt();var zlData=ZhanLingModel.ins().getZhanLingDataById(id);if(!zlData)return;var config=GlobalConfig.ZhanLingEquip[itemid];if(!config)return;zlData.items[config.pos-1]=itemid};ZhanLing.prototype.postZhanLingComposeItem=function(bytes){var id=bytes.readByte();var itemNum=bytes.readByte();var zlData=ZhanLingModel.ins().getZhanLingDataById(id);if(!zlData)return;for(var i=0;i<itemNum;i++){zlData.items[i]=bytes.readInt()}};ZhanLing.prototype.postZhanLingBubble=function(bytes){var handle=bytes.readDouble();var lv=bytes.readInt();var id=bytes.readByte();var entity=EntityManager.ins().getEntityByHandle(handle);if(entity){entity.showZhanling(id,lv)}};ZhanLing.prototype.doZhanLingSkill=function(bytes){var id=0;var zlData=ZhanLingModel.ins().getZhanLingDataById(id);if(!zlData){return}var talentLv=GlobalConfig.ZhanLingLevel[id][zlData.level].talentLevel;var dp=GlobalConfig.ZhanLingTalent[id][talentLv];UserSkill.ins().postShowSkillWord(dp.showWords)};ZhanLing.prototype.postZhanLingSkinUpGrade=function(bytes){var id=bytes.readByte();var talentLv=bytes.readShort();var zlData=ZhanLingModel.ins().getZhanLingDataById(id);var oldtalentLv=0;if(!zlData){zlData=new ZhanLingData;zlData.id=id;ZhanLingModel.ins().setZhanLingData(zlData)}else{oldtalentLv=zlData.talentLv}if(talentLv!=oldtalentLv)this.postZhanLingTalentLvUpGrade();zlData.talentLv=talentLv};ZhanLing.prototype.postZhanLingTalentLvUpGrade=function(){};ZhanLing.prototype.postZhangLingSkinChange=function(bytes){var id=bytes.readByte();ZhanLingModel.ins().ZhanLingSkinId=id};return ZhanLing}(BaseSystem);__reflect(ZhanLing.prototype,"ZhanLing");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.zhanling=ZhanLing.ins.bind(ZhanLing)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ZhanLingData=function(){function ZhanLingData(id){this._id=id?id:0;this._level=0;this._exp=0;this._items=[];for(var i=0;i<GlobalConfig.ZhanLingConfig.equipPosCount;i++){this._items.push(0)}this._talentLv=0;this._drugs=[];for(var i in GlobalConfig.ZhanLingConfig.upgradeInfo){this._drugs.push({itemId:Number(i),count:0})}}Object.defineProperty(ZhanLingData.prototype,"id",{get:function(){return this._id},set:function(value){this._id=value},enumerable:true,configurable:true});Object.defineProperty(ZhanLingData.prototype,"level",{get:function(){return this._level},set:function(value){this._level=value},enumerable:true,configurable:true});Object.defineProperty(ZhanLingData.prototype,"exp",{get:function(){return this._exp},set:function(value){this._exp=value},enumerable:true,configurable:true});Object.defineProperty(ZhanLingData.prototype,"items",{get:function(){return this._items},set:function(value){this._items=value},enumerable:true,configurable:true});Object.defineProperty(ZhanLingData.prototype,"talentLv",{get:function(){return this._talentLv},set:function(value){this._talentLv=value},enumerable:true,configurable:true});Object.defineProperty(ZhanLingData.prototype,"drugs",{get:function(){return this._drugs},set:function(value){this._drugs=value},enumerable:true,configurable:true});return ZhanLingData}();__reflect(ZhanLingData.prototype,"ZhanLingData");var ZLPOS;(function(ZLPOS){ZLPOS[ZLPOS["ITEM1"]=1]="ITEM1";ZLPOS[ZLPOS["ITEM2"]=2]="ITEM2";ZLPOS[ZLPOS["ITEM3"]=3]="ITEM3";ZLPOS[ZLPOS["ITEM4"]=4]="ITEM4"})(ZLPOS||(ZLPOS={}));window["ZLPOS"]=ZLPOS;var ZhanLingModel=function(_super){__extends(ZhanLingModel,_super);function ZhanLingModel(){var _this=_super.call(this)||this;_this._ZhanLingData={};_this._ZhanLingSkinId=0;_this._showZLlist=[];return _this}ZhanLingModel.ins=function(){return _super.ins.call(this)};Object.defineProperty(ZhanLingModel.prototype,"ZhanLingData",{get:function(){return this._ZhanLingData},enumerable:true,configurable:true});ZhanLingModel.prototype.getZhanLingDataById=function(id){return this._ZhanLingData[id]};ZhanLingModel.prototype.setZhanLingData=function(value){if(!value)return;this._ZhanLingData[value.id]=value};Object.defineProperty(ZhanLingModel.prototype,"ZhanLingSkinId",{get:function(){return this._ZhanLingSkinId},set:function(value){this._ZhanLingSkinId=value},enumerable:true,configurable:true});Object.defineProperty(ZhanLingModel.prototype,"showZLlist",{get:function(){return this._showZLlist},set:function(value){this._showZLlist=value},enumerable:true,configurable:true});ZhanLingModel.prototype.ZhanLingOpen=function(){return UserZs.ins().lv>=GlobalConfig.ZhanLingConfig.openzhuanshenglv&&GameServer.serverOpenDay+1>=GlobalConfig.ZhanLingConfig.openserverday};ZhanLingModel.prototype.getZhanLingDataByLevel=function(id){return this._ZhanLingData[id]?this._ZhanLingData[id].level:0};ZhanLingModel.prototype.getMaxZhanLingDataByLevel=function(){var datas=this._ZhanLingData;var maxlv=0;for(var k in datas){var v=datas[k];if(maxlv<v.level){maxlv=v.level}}return maxlv};ZhanLingModel.prototype.getZhanLingDataByStage=function(id){if(!this._ZhanLingData[id].level)return 1;var stage=Math.floor(this._ZhanLingData[id].level/10);var stage2=Math.floor(this._ZhanLingData[id].level%10);stage+=1;if(!stage2){stage-=1}if(!stage)stage=1;return stage};ZhanLingModel.prototype.getZhanLingDataByNextStage=function(id){var talentLv=0;if(this._ZhanLingData[id]){talentLv=this._ZhanLingData[id].talentLv}var zlLevel=GlobalConfig.ZhanLingLevel[id];var nextConfig;for(var i in zlLevel){var cfg=zlLevel[i];if(cfg.talentLevel>talentLv){nextConfig=cfg;break}}if(!nextConfig)return null;return this.getStageLv(nextConfig.level)};ZhanLingModel.prototype.getZhanLingDataByStar=function(id){if(!this._ZhanLingData[id]||!this._ZhanLingData[id].level)return 0;var star=Math.floor(this._ZhanLingData[id].level%10);if(!star)star=10;return star};ZhanLingModel.prototype.getZhanLingDataByTalentLv=function(id){if(!this._ZhanLingData[id]){return 0}var lv=this.getZhanLingDataByLevel(id);var talentLevel=GlobalConfig.ZhanLingLevel[id][lv].talentLevel;if(talentLevel)this._ZhanLingData[id].talentLv=talentLevel;return this._ZhanLingData[id].talentLv};ZhanLingModel.prototype.getZhanLingDataByExp=function(id){return this._ZhanLingData[id]?this._ZhanLingData[id].exp:0};ZhanLingModel.prototype.getZhanLingDataByItem=function(id,pos){return this._ZhanLingData[id]?this._ZhanLingData[id].items[pos-1]:0};ZhanLingModel.prototype.getZhanLingDataByDrugUse=function(id,itemid){if(!this._ZhanLingData[id])return false;var myCount=0;var itemData=UserBag.ins().getBagItemById(itemid);myCount=itemData?itemData.count:0;if(!myCount)return false;var lv=this._ZhanLingData[id].level;var config=GlobalConfig.ZhanLingLevel[id][lv];if(id&&!config.maxCount)false;var isUseMax=false;if(config.maxCount&&config.maxCount[itemid]){for(var i=0;i<this._ZhanLingData[id].drugs.length;i++){if(this._ZhanLingData[id].drugs[i].itemId==itemid&&this._ZhanLingData[id].drugs[i].count>=config.maxCount[itemid]){isUseMax=true;break}}}if(isUseMax)return false;return true};ZhanLingModel.prototype.getZhanLingDataByTalentId=function(id){var config=GlobalConfig.ZhanLingBase[id];return config?config.talent:0};ZhanLingModel.prototype.getZhanLingDataBySkill=function(id){var skill=[];if(!this._ZhanLingData[id])return skill;return GlobalConfig.ZhanLingBase[id].skill};ZhanLingModel.prototype.getZhanLingDataByDrug=function(id,itemid){if(!this._ZhanLingData[id])return 0;for(var i=0;i<this._ZhanLingData[id].drugs.length;i++){if(this._ZhanLingData[id].drugs[i].itemId==itemid)return this._ZhanLingData[id].drugs[i].count}return 0};ZhanLingModel.prototype.getZhanLingDataBySuit=function(id){if(!this._ZhanLingData[id])return 0;var lv=0;for(var i=0;i<this._ZhanLingData[id].items.length;i++){var itemid=this._ZhanLingData[id].items[i];var config=GlobalConfig.ZhanLingEquip[itemid];if(!config)return 0;if(!lv)lv=config.level;if(lv>config.level)lv=config.level}return lv};ZhanLingModel.prototype.getZhanLingDataBySuitCount=function(id,lv){if(!this._ZhanLingData[id])return 0;var count=0;for(var i=0;i<this._ZhanLingData[id].items.length;i++){var itemid=this._ZhanLingData[id].items[i];var config=GlobalConfig.ZhanLingEquip[itemid];if(config.level>=lv){count++}}return count};ZhanLingModel.prototype.getZhanLingDataByMat=function(id,act){if(!act&&!this._ZhanLingData[id])return 0;var config=GlobalConfig.ZhanLingBase[id];var talent=config.talent;var lv=0;if(act){lv=1}else{if(!this._ZhanLingData[id].talentLv)return 0;lv=this._ZhanLingData[id].talentLv+1}var zltconfig=GlobalConfig.ZhanLingTalent[talent][lv];return zltconfig?zltconfig.costCount:0};ZhanLingModel.prototype.getZhanLingPower=function(id){var power=0;var lv=ZhanLingModel.ins().getZhanLingDataByLevel(id);var zllconfig=GlobalConfig.ZhanLingLevel[id][lv];if(!zllconfig)return[power,[],[]];var zlData=ZhanLingModel.ins().getZhanLingDataById(id);if(!zlData)return[power,[],[]];var nextzllconfig=GlobalConfig.ZhanLingLevel[id][lv+1];var zlValue=0;var zlAttr=[];var nzlAttr=[];var itValue=0;var tzValue=0;var tzAttr=[];var ntzAttr=[];var dyValue=0;var dyAttr=[];var ndyAttr=[];var tfValue=0;var jnValue=0;zlValue+=UserBag.getAttrPower(zllconfig.attrs)*SubRoles.ins().subRolesLen;for(var r=0;r<SubRoles.ins().subRolesLen;r++){var role=SubRoles.ins().getSubRoleByIndex(r);for(var i in zllconfig.attrs){zlValue+=ItemConfig.relatePower(zllconfig.attrs[i],role)}}zlValue+=(zllconfig.expower?zllconfig.expower:0)*SubRoles.ins().subRolesLen;zlAttr=this.addAttrs(zlAttr,zllconfig.attrs);if(nextzllconfig){nzlAttr=this.addAttrs(nzlAttr,nextzllconfig.attrs)}var suitLv=ZhanLingModel.ins().getZhanLingDataBySuit(id);if(suitLv){var cfg=GlobalConfig.ZhanLingSuit[suitLv];if(cfg&&cfg.attrs){tzValue+=UserBag.getAttrPower(cfg.attrs)*SubRoles.ins().subRolesLen;for(var i=0;i<cfg.attrs.length;i++){for(var r=0;r<SubRoles.ins().subRolesLen;r++){var role=SubRoles.ins().getSubRoleByIndex(r);tzValue+=ItemConfig.relatePower(cfg.attrs[i],role)}}tzAttr=AttributeData.getPercentAttr(zlAttr,cfg.precent/1e4);if(nextzllconfig){ntzAttr=AttributeData.getPercentAttr(nzlAttr,cfg.precent/1e4)}}}for(var i=0;i<zlData.drugs.length;i++){var tempdyAttr=[];var ntempdyAttr=[];var uginfo=GlobalConfig.ZhanLingConfig.upgradeInfo[zlData.drugs[i].itemId];var uginfoAttr=[];for(var d=0;d<uginfo.attr.length;d++){var atb=new AttributeData;atb.type=uginfo.attr[d].type;atb.value=uginfo.attr[d].value*zlData.drugs[i].count;uginfoAttr.push(atb)}var uginfoFB={attr:uginfoAttr,precent:uginfo.precent?uginfo.precent*zlData.drugs[i].count:0,sort:uginfo.sort};dyValue+=UserBag.getAttrPower(uginfoFB.attr)*SubRoles.ins().subRolesLen;dyAttr=this.addAttrs(dyAttr,uginfoFB.attr);ndyAttr=this.addAttrs(ndyAttr,uginfoFB.attr);if(uginfoFB.precent){dyValue+=Math.floor(zlValue*uginfoFB.precent/1e4);if(suitLv)dyValue+=Math.floor(zlValue*uginfoFB.precent/1e4);tempdyAttr=AttributeData.getPercentAttr(zlAttr,uginfoFB.precent/1e4);dyAttr=this.addAttrs(dyAttr,tempdyAttr);if(nextzllconfig){ntempdyAttr=AttributeData.getPercentAttr(nzlAttr,uginfoFB.precent/1e4);ndyAttr=this.addAttrs(ndyAttr,ntempdyAttr)}}for(var r=0;r<SubRoles.ins().subRolesLen;r++){var role=SubRoles.ins().getSubRoleByIndex(r);dyValue+=ItemConfig.relatePower(uginfoFB.attr[i],role)}}for(var i=1;i<=GlobalConfig.ZhanLingConfig.equipPosCount;i++){var itemid=ZhanLingModel.ins().getZhanLingDataByItem(id,i);itValue+=this.getZhanLingItemPower(itemid,1)}var talentId=this.getZhanLingDataByTalentId(id);var talentLv=this.getZhanLingDataByTalentLv(id);var zlTalent=GlobalConfig.ZhanLingTalent[talentId][talentLv];if(zlTalent){var tfexpower=zlTalent.expower;tfValue+=(tfexpower?tfexpower:0)*SubRoles.ins().subRolesLen;if(zlTalent.attrs)tfValue+=UserBag.getAttrPower(zlTalent.attrs)*SubRoles.ins().subRolesLen}var zlbase=GlobalConfig.ZhanLingBase[id];for(var i=0;i<zlbase.skill.length;i++){var zlsConfig=GlobalConfig.ZhanLingSkill[zlbase.skill[i].id];if(!zlsConfig.attrs)continue;jnValue+=UserBag.getAttrPower(zlsConfig.attrs)*SubRoles.ins().subRolesLen;for(var r=0;r<SubRoles.ins().subRolesLen;r++){var role=SubRoles.ins().getSubRoleByIndex(r);for(var j=0;j<zlsConfig.attrs.length;j++){jnValue+=ItemConfig.relatePower(zlsConfig.attrs[j],role)}}if(zlsConfig.expower)jnValue+=zlsConfig.expower}power=zlValue+itValue+tzValue+dyValue+tfValue+jnValue;zlAttr=this.addAttrs(zlAttr,tzAttr);zlAttr=this.addAttrs(zlAttr,dyAttr);if(nextzllconfig){nzlAttr=this.addAttrs(nzlAttr,ntzAttr);nzlAttr=this.addAttrs(nzlAttr,ndyAttr)}return[power,zlAttr,nzlAttr]};ZhanLingModel.prototype.addAttrs=function(srcAttrs,descAttrs,clone){if(clone===void 0){clone=true}var arr=clone?[]:srcAttrs;if(clone){for(var a=0;a<srcAttrs.length;a++){if(ZhanLingModel.showTypeList.indexOf(srcAttrs[a].type)!=-1)arr.push(new AttributeData(srcAttrs[a].type,srcAttrs[a].value))}}for(var i=0;i<descAttrs.length;i++){var isHave=false;if(ZhanLingModel.showTypeList.indexOf(descAttrs[i].type)==-1)continue;for(var j=0;j<srcAttrs.length;j++){if(srcAttrs[j].type==descAttrs[i].type){arr[j].value+=descAttrs[i].value;isHave=true;break}}if(!isHave){arr.push(new AttributeData(descAttrs[i].type,descAttrs[i].value))}}return arr};ZhanLingModel.prototype.getZhanLingItemPower=function(itemid,have){if(have===void 0){have=0}var power=0;var config=GlobalConfig.ZhanLingEquip[itemid];if(!config)return power;var len=have?SubRoles.ins().subRolesLen:3;power+=UserBag.getAttrPower(config.attrs)*len;if(have){for(var i=0;i<len;i++){var role=SubRoles.ins().getSubRoleByIndex(i);for(var j=0;j<config.attrs.length;j++){power+=ItemConfig.relatePower(config.attrs[j],role)}}}return power};ZhanLingModel.prototype.isUpGradeByStar=function(id){if(!this.getZhanLingDataById(id)){return this.isUpGradeByTalent(id,true)}var curLv=ZhanLingModel.ins().getZhanLingDataByLevel(id);var config=GlobalConfig.ZhanLingLevel[id][curLv];if(!config||!config.exp)return false;var curExp=ZhanLingModel.ins().getZhanLingDataByExp(id);var reExp=config.exp-curExp;reExp=reExp>0?reExp:0;var needCount=Math.ceil(reExp/GlobalConfig.ZhanLingConfig.stageitemexp);var itemData=UserBag.ins().getBagItemById(GlobalConfig.ZhanLingConfig.stageitemid);var curCount=itemData?itemData.count:0;return curCount>=needCount};ZhanLingModel.prototype.isHintNum=function(id){var zlData=ZhanLingModel.ins().getZhanLingDataById(id);if(!zlData)return false;var config=GlobalConfig.ZhanLingLevel[id][zlData.level];if(!config||!config.exp)return false;var itemData=UserBag.ins().getBagItemById(GlobalConfig.ZhanLingConfig.stageitemid);var curCount=itemData?itemData.count:0;return curCount>=GlobalConfig.ZhanLingConfig.hintNum};ZhanLingModel.prototype.isUpGradeByTalent=function(id,isAct){if(isAct===void 0){isAct=false}var zlData=ZhanLingModel.ins().getZhanLingDataById(id);if(!isAct&&!zlData)return false;var baseconfig=GlobalConfig.ZhanLingBase[id];if(!baseconfig.mat)return false;var itemData=UserBag.ins().getBagItemById(baseconfig.mat);var curCount=itemData?itemData.count:0;var needCount=this.getZhanLingDataByMat(id,isAct);return needCount?curCount>=needCount:false};ZhanLingModel.prototype.updateShowZLlist=function(){var arr=[];for(var k in GlobalConfig.ZhanLingBase){if(!GlobalConfig.ZhanLingBase[k].sort)continue;arr.push(GlobalConfig.ZhanLingBase[k])}arr.sort(function(a,b){if(a.sort<b.sort)return-1;else return 1});this.showZLlist=[];for(var i=0;i<arr.length;i++){if(arr[i].show){var zlData=ZhanLingModel.ins().getZhanLingDataById(arr[i].id);if(zlData)this.showZLlist.push(arr[i]);else{var itemData=UserBag.ins().getBagItemById(arr[i].mat);if(itemData&&itemData.count)this.showZLlist.push(arr[i])}}else{this.showZLlist.push(arr[i])}}};ZhanLingModel.prototype.getZhanLingItemRedPoint=function(zlId){var zlData=this.getZhanLingDataById(zlId);if(!zlData)return false;var itemData=UserBag.ins().getBagGoodsByType(ItemType.TYPE_21);if(itemData)itemData.sort(function(a,b){var aconfig=GlobalConfig.ZhanLingEquip[a.configID];var bconfig=GlobalConfig.ZhanLingEquip[b.configID];if(aconfig.level>bconfig.level)return-1;else return 1});for(var k=0;k<zlData.items.length;k++){var slot=k+1;var itemid=zlData.items[k];var curequip=void 0;if(itemid){curequip=GlobalConfig.ZhanLingEquip[itemid]}for(var i=0;i<itemData.length;i++){var id=itemData[i].configID;var config=GlobalConfig.ItemConfig[id];if(!config)continue;var zlequip=GlobalConfig.ZhanLingEquip[id];if(!zlequip)continue;if(slot!=zlequip.pos)continue;var lv=config.level?config.level:0;var zslv=config.zsLevel?config.zsLevel:0;if(UserZs.ins().lv>=zslv&&Actor.level>=lv){if(curequip){if(zlequip.level>curequip.level){return true}else{break}}else{return true}}}}return false};ZhanLingModel.prototype.getStageLv=function(level){var stage=Math.floor(level/10);var stage2=Math.floor(level%10);if(!stage2){if(level&&level%10==0)stage2=10;else stage+=1}else{stage+=1}return[stage,stage2]};ZhanLingModel.showTypeList=[AttributeType.atAttack,AttributeType.atMaxHp,AttributeType.atDef,AttributeType.atRes];return ZhanLingModel}(BaseClass);__reflect(ZhanLingModel.prototype,"ZhanLingModel");var ZhanLingItemRender=function(_super){__extends(ZhanLingItemRender,_super);function ZhanLingItemRender(){var _this=_super.call(this)||this;_this.skinName="ZhanlingEquipSkin";_this.init();return _this}ZhanLingItemRender.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};ZhanLingItemRender.prototype.dataChanged=function(){if(!this.data)return;var id=this.data.id;this.equips=this.data.equips;this.bg.source=this.getPosImg(Number(this.name));this.bg.visible=true;this.equip.visible=!this.bg.visible;this.redPoint.visible=this.getRedPoint();if(!this.data.id)return;var config=GlobalConfig.ItemConfig[id];if(!config)return;this.quality.source="quality"+ItemConfig.getQuality(config);this.equip.source=config.icon+"_png";this.bg.visible=false;this.equip.visible=!this.bg.visible};ZhanLingItemRender.prototype.getRedPoint=function(){var curequip;if(this.data.id){curequip=GlobalConfig.ZhanLingEquip[this.data.id]}for(var i=0;i<this.equips.length;i++){var id=this.equips[i].configID;var config=GlobalConfig.ItemConfig[id];if(!config)continue;var zlequip=GlobalConfig.ZhanLingEquip[id];if(!zlequip)continue;if(Number(this.name)!=zlequip.pos)continue;var lv=config.level?config.level:0;var zslv=config.zsLevel?config.zsLevel:0;if(UserZs.ins().lv>=zslv&&Actor.level>=lv){if(curequip){if(zlequip.level>curequip.level){this.bestId=zlequip.id;return true}else{return false}}else{this.bestId=zlequip.id;return true}}}return false};ZhanLingItemRender.prototype.getPosImg=function(pos){var str="zl_equip_bg_"+pos;return str};ZhanLingItemRender.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};ZhanLingItemRender.prototype.onClick=function(){if(!this.data)return;if(!this.data.id&&!this.redPoint.visible){UserTips.ins().showTips(i18n("ZhanLingItemRender_0"));return}if(this.data.id&&!this.redPoint.visible){ZhanLing.ins().ZhanLingItemTips(this.data.id,0,true);return}if(isNaN(this.data.zlId)){UserTips.ins().showTips(i18n("ZhanLingItemRender_2"));return}if(!this.bestId){UserTips.ins().showTips(i18n("ZhanLingItemRender_3"));return}if(!this.data.id&&this.redPoint.visible){ZhanLing.ins().sendZhanLingWear(this.data.zlId,this.bestId);return}ZhanLing.ins().sendZhanLingWear(this.data.zlId,this.bestId)};return ZhanLingItemRender}(BaseItemRender);__reflect(ZhanLingItemRender.prototype,"ZhanLingItemRender");var ZhanLingItemTips=function(_super){__extends(ZhanLingItemTips,_super);function ZhanLingItemTips(){var _this=_super.call(this)||this;_this.skinName="ZhanglingUpTipsSkin";return _this}ZhanLingItemTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};ZhanLingItemTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.addTouchEvent(this.bgClose,this.otherClose);this.id=param[0];this.itemid=param[1];var config=GlobalConfig.ItemConfig[this.itemid];this.itemIcon.setData(config);this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1(config.name);var curCount=ZhanLingModel.ins().getZhanLingDataByDrug(this.id,this.itemid);var level=ZhanLingModel.ins().getZhanLingDataByLevel(this.id);var zllevel=GlobalConfig.ZhanLingLevel[this.id][level];var maxCount=zllevel.maxCount[this.itemid];var color=curCount>=maxCount?65280:16711680;this.use.textFlow=TextFlowMaker.generateTextFlow1(i18n("ZhanLingItemTips_2",color,curCount,maxCount));var itemData=UserBag.ins().getBagItemById(this.itemid);this.num.text=itemData?""+itemData.count:"0";var stage=ZhanLingModel.ins().getZhanLingDataByStage(this.id)+1;if(stage*10>CommonUtils.getObjectLength(GlobalConfig.ZhanLingLevel[this.id])){DisplayUtils.removeFromParent(this.info)}else{this.num0.text=i18n("ZhanLingItemTips_0",stage,1)}var upgradeInfo=GlobalConfig.ZhanLingConfig.upgradeInfo[this.itemid];var attrtext=AttributeData.getAttStr(upgradeInfo.attr,0,1,"+");if(upgradeInfo.precent){attrtext+=i18n("ZhanLingItemTips_1",upgradeInfo.precent/100)}this.attr.text=attrtext};ZhanLingItemTips.prototype.otherClose=function(e){ViewManager.ins().close(this)};return ZhanLingItemTips}(BaseEuiView);__reflect(ZhanLingItemTips.prototype,"ZhanLingItemTips");ViewManager.ins().reg(ZhanLingItemTips,LayerManager.UI_Popup);var ZhanLingPanelEx=function(_super){__extends(ZhanLingPanelEx,_super);function ZhanLingPanelEx(){var _this=_super.call(this)||this;_this.skinName="ZhanlingSkin";_this.isTopLevel=true;return _this}ZhanLingPanelEx.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.openView(param)};return ZhanLingPanelEx}(ZhanLingPanel);__reflect(ZhanLingPanelEx.prototype,"ZhanLingPanelEx");ViewManager.ins().reg(ZhanLingPanelEx,LayerManager.UI_Main);var ZhanLingSkinItem=function(_super){__extends(ZhanLingSkinItem,_super);function ZhanLingSkinItem(){var _this=_super.call(this)||this;_this.skinName="ZhanlingZBItemSkin";return _this}ZhanLingSkinItem.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this)};ZhanLingSkinItem.prototype.dataChanged=function(){if(!this.data)return;var id=this.data.id;var config=GlobalConfig.ZhanLingBase[id];if(!config)return;var level=ZhanLingModel.ins().getZhanLingDataByLevel(id);this.icon.source=config.icon;this.state.visible=ZhanLingModel.ins().getZhanLingDataById(id)?false:true;this.select.visible=false;this.label.text=level+"";this.label.visible=!this.state.visible;var b=ZhanLingModel.ins().isUpGradeByStar(id)||ZhanLingModel.ins().isHintNum(id);if(!b){b=ZhanLingModel.ins().isUpGradeByTalent(id)}this.redPoint.visible=b};ZhanLingSkinItem.prototype.destruct=function(){};ZhanLingSkinItem.prototype.setSelect=function(v){this.select.visible=v};return ZhanLingSkinItem}(BaseItemRender);__reflect(ZhanLingSkinItem.prototype,"ZhanLingSkinItem");var ZhanLingSuitTip=function(_super){__extends(ZhanLingSuitTip,_super);function ZhanLingSuitTip(){var _this=_super.call(this)||this;_this.skinName="ZhanlingSuitTipsSkin";return _this}ZhanLingSuitTip.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};ZhanLingSuitTip.prototype.otherClose=function(e){ViewManager.ins().close(this)};ZhanLingSuitTip.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.addTouchEvent(this.bgClose,this.otherClose);this.id=param[0];var lv=ZhanLingModel.ins().getZhanLingDataBySuit(this.id);var maxLv=CommonUtils.getObjectLength(GlobalConfig.ZhanLingSuit);var maxCount=GlobalConfig.ZhanLingConfig.equipPosCount;var curCount=0;if(!lv){this.currentState="unactive";lv=1}else{curCount=ZhanLingModel.ins().getZhanLingDataBySuitCount(this.id,lv);if(lv>=maxLv&&curCount>=maxCount){this.currentState="max"}else{this.currentState="active"}}this.validateNow();var config=GlobalConfig.ZhanLingSuit[lv];var content=StringUtils.replace(config.suitCondition,""+curCount,""+maxCount);if(this.currentState=="unactive"){this.content0.textFlow=TextFlowMaker.generateTextFlow1(content)}var attStr=AttributeData.getAttStr(config.attrs,0,1,"+");attStr+="\n"+i18n("ZhanLingSuitTip_0")+config.precent/100+"%";this.attr0.text=attStr;this.name0.text=config.suitTname;if(this.currentState=="active"){var nextconfig=GlobalConfig.ZhanLingSuit[lv+1];curCount=ZhanLingModel.ins().getZhanLingDataBySuitCount(this.id,lv+1);content=StringUtils.replace(nextconfig.suitCondition,""+curCount,""+maxCount);this.content1.textFlow=TextFlowMaker.generateTextFlow1(content);var nattStr=AttributeData.getAttStr(nextconfig.attrs,0,1,"+");nattStr+="\n"+i18n("ZhanLingSuitTip_1")+nextconfig.precent/100+"%";this.attr1.text=nattStr;this.name1.text=nextconfig.suitTname}};return ZhanLingSuitTip}(BaseEuiView);__reflect(ZhanLingSuitTip.prototype,"ZhanLingSuitTip");ViewManager.ins().reg(ZhanLingSuitTip,LayerManager.UI_Popup);var ZhanLingTips=function(_super){__extends(ZhanLingTips,_super);function ZhanLingTips(){var _this=_super.call(this)||this;_this.skinName="ZhanlingSkillTipsSkin";return _this}ZhanLingTips.prototype.initUI=function(){_super.prototype.initUI.call(this)};ZhanLingTips.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.addTouchEvent(this.bgClose,this.otherClose);this.id=param[0]||0;this.skillid=param[1];var tips={name:"",desc:"",lock:""};var ntips={name:"",desc:"",lock:""};var state="";if(this.skillid){state="unactive";var zlData=ZhanLingModel.ins().getZhanLingDataById(this.id);var skill=ZhanLingModel.ins().getZhanLingDataBySkill(this.id);var zlBase=GlobalConfig.ZhanLingBase[this.id];var level=ZhanLingModel.ins().getZhanLingDataByLevel(this.id);for(var i=0;i<zlBase.skill.length;i++){if(zlBase.skill[i].id==this.skillid){var zlskill=GlobalConfig.ZhanLingSkill[zlBase.skill[i].id];var skillconfig=GlobalConfig.SkillsConfig[zlskill.passive];var descId=skillconfig?skillconfig.desc:0;var sdconfig=GlobalConfig.SkillsDescConfig[descId];if(!zlData||level<zlBase.skill[i].open){var stage=Math.floor(zlBase.skill[i].open/10);var stage2=Math.floor(zlBase.skill[i].open%10);if(!stage2){if(zlBase.skill[i].open&&zlBase.skill[i].open%10==0)stage2=10;else stage+=1}else{stage+=1}if(sdconfig){tips.name=sdconfig.name;tips.desc=sdconfig.desc}tips.lock=i18n("ZhanLingTips_0",stage,stage2)}else{state="max";if(sdconfig){tips.name=sdconfig.name;tips.desc=sdconfig.desc}}if(skillconfig&&sdconfig&&tips.desc){tips.desc=StringUtils.replace(tips.desc,""+skillconfig.desc_ex[0])}if(zlskill.desc&&zlskill.desc.name)tips.name=zlskill.desc.name;if(zlskill.desc&&zlskill.desc.desc){tips.desc=zlskill.desc.desc}if(zlskill.attrs){if(tips.desc)tips.desc+="\n";tips.desc+=i18n("ZhanLingTips_10",AttributeData.getAttStr(zlskill.attrs,0,1,"："))}break}}}else{var talentId=ZhanLingModel.ins().getZhanLingDataByTalentId(this.id);var talentLv=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.id);var maxTalentLv=CommonUtils.getObjectLength(GlobalConfig.ZhanLingTalent[this.id]);var zltalent=GlobalConfig.ZhanLingTalent[talentId][talentLv];if(!zltalent){state="unactive";zltalent=GlobalConfig.ZhanLingTalent[talentId][1];if(!zltalent.costCount){var stages=ZhanLingModel.ins().getZhanLingDataByNextStage(this.id);if(stages)tips.lock=i18n("ZhanLingTips_2",stages[0],stages[1])}else{tips.lock=i18n("ZhanLingTips_3")}}else if(talentLv>=maxTalentLv){state="max"}else{state="active";var nzlBase=GlobalConfig.ZhanLingBase[this.id];var itemcfg=GlobalConfig.ItemConfig[nzlBase.mat];var nzltalent=GlobalConfig.ZhanLingTalent[talentId][talentLv+1];if(!nzltalent.talentDesc){var skillid=nzltalent.passive[0].id;var skconfig=GlobalConfig.SkillsConfig[skillid];var descId=skconfig.desc;var sdconfig=GlobalConfig.SkillsDescConfig[descId];ntips.name=sdconfig.name;ntips.desc=StringUtils.replace(sdconfig.desc,""+skconfig.desc_ex[0]);if(!nzltalent.costCount){var stages=ZhanLingModel.ins().getZhanLingDataByNextStage(this.id);if(stages)ntips.lock=i18n("ZhanLingTips_4",stages[0],stages[1])}else{ntips.lock=i18n("ZhanLingTips_6",itemcfg.name,nzltalent.costCount);DisplayUtils.removeFromParent(this["lock1"])}}else{ntips.name=nzltalent.talentDesc.name;ntips.desc=StringUtils.replace(nzltalent.talentDesc.desc,""+nzltalent.rate/100);if(!nzltalent.costCount){var stages=ZhanLingModel.ins().getZhanLingDataByNextStage(this.id);if(stages)ntips.lock=i18n("ZhanLingTips_8",stages[0],stages[1])}else{ntips.lock=i18n("ZhanLingTips_9",itemcfg.name,nzltalent.costCount);DisplayUtils.removeFromParent(this["lock1"])}}}if(!zltalent.talentDesc){var skillid=zltalent.passive[0].id;var descId=GlobalConfig.SkillsConfig[skillid].desc;var sdconfig=GlobalConfig.SkillsDescConfig[descId];tips.name=sdconfig.name;tips.desc=sdconfig.desc;tips.desc=StringUtils.replace(tips.desc,""+GlobalConfig.SkillsConfig[skillid].desc_ex[0])}else{tips.name=zltalent.talentDesc.name;tips.desc=StringUtils.replace(zltalent.talentDesc.desc,""+zltalent.rate/100)}}this.currentState=state;this.validateNow();this.skillName0.textFlow=TextFlowMaker.generateTextFlow1(tips.name);this.skillDesc0.textFlow=TextFlowMaker.generateTextFlow1(tips.desc);if(!tips.lock)DisplayUtils.removeFromParent(this.condition0.parent);else this.condition0.textFlow=TextFlowMaker.generateTextFlow1(tips.lock);if(ntips.name){if(state=="active"){this.skillName1.textFlow=TextFlowMaker.generateTextFlow1(ntips.name);this.skillDesc1.textFlow=TextFlowMaker.generateTextFlow1(ntips.desc);if(!ntips.lock)DisplayUtils.removeFromParent(this.condition1.parent);else this.condition1.textFlow=TextFlowMaker.generateTextFlow1(ntips.lock)}else{DisplayUtils.removeFromParent(this.nextGroup)}}};ZhanLingTips.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};ZhanLingTips.prototype.otherClose=function(e){ViewManager.ins().close(this)};return ZhanLingTips}(BaseEuiView);__reflect(ZhanLingTips.prototype,"ZhanLingTips");ViewManager.ins().reg(ZhanLingTips,LayerManager.UI_Popup);var ZhanlingZBTipItemsRender=function(_super){__extends(ZhanlingZBTipItemsRender,_super);function ZhanlingZBTipItemsRender(){var _this=_super.call(this)||this;_this.skinName="ZhanlingZBTipItemsSkin";_this.init();return _this}ZhanlingZBTipItemsRender.prototype.init=function(){};ZhanlingZBTipItemsRender.prototype.dataChanged=function(){if(!this.data)return;var zlId=this.data.zlId;var skillid=this.data.id;var zlskill=GlobalConfig.ZhanLingSkill[skillid];if(zlskill.desc&&zlskill.desc.icon)this.skillIcon1.source=zlskill.desc.icon;else this.skillIcon1.source=Math.floor(zlskill.passive/1e3)*1e3+"_png";var zlBase=GlobalConfig.ZhanLingBase[zlId];var openLv=0;for(var i=0;i<zlBase.skill.length;i++){if(zlBase.skill[i].id==skillid){openLv=zlBase.skill[i].open;break}}var skillconfig=GlobalConfig.SkillsConfig[zlskill.passive];var descId=skillconfig?skillconfig.desc:0;var sdconfig=GlobalConfig.SkillsDescConfig[descId];var tips={name:"",desc:""};if(sdconfig){tips.name=sdconfig.name;tips.desc=sdconfig.desc}if(skillconfig&&sdconfig&&tips.desc){tips.desc=StringUtils.replace(tips.desc,""+skillconfig.desc_ex[0])}if(zlskill.desc&&zlskill.desc.name)tips.name=zlskill.desc.name;if(zlskill.desc&&zlskill.desc.desc){tips.desc=zlskill.desc.desc}if(zlskill.attrs){if(tips.desc)tips.desc+="\n";tips.desc+=i18n("ZhanlingZBTipItemsRender_1",AttributeData.getAttStr(zlskill.attrs,0,1,"："))}var stageLv=ZhanLingModel.ins().getStageLv(openLv);this.desc.textFlow=TextFlowMaker.generateTextFlow1(i18n("ZhanlingZBTipItemsRender_0",stageLv[0],tips.name,tips.desc))};ZhanlingZBTipItemsRender.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)};ZhanlingZBTipItemsRender.prototype.onClick=function(){};return ZhanlingZBTipItemsRender}(BaseItemRender);__reflect(ZhanlingZBTipItemsRender.prototype,"ZhanlingZBTipItemsRender");var ZhanlingZBTipWin=function(_super){__extends(ZhanlingZBTipWin,_super);function ZhanlingZBTipWin(){var _this=_super.call(this)||this;_this.skinName="ZhanlingZBTipsSkin";return _this}ZhanlingZBTipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};ZhanlingZBTipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);this.gainList.itemRenderer=GainGoodsItem;this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);this.skillList.itemRenderer=ZhanlingZBTipItemsRender;this.itemid=param[0];for(var k in GlobalConfig.ZhanLingBase){var zlBase_1=GlobalConfig.ZhanLingBase[k];if(zlBase_1.mat==this.itemid){this.zlId=zlBase_1.id;break}}var cfg=GlobalConfig.ZhanLingLevel[this.zlId][0];this.zhanlingName.source=cfg.zlName;if(!this.model)this.model=new MovieClip;if(!this.model.parent)this.zhanling.addChild(this.model);if(this.model.name!=RES_DIR_EFF+cfg.innerAppearance)this.model.playFile(RES_DIR_EFF+cfg.innerAppearance,-1);if(!this.bottomMc)this.bottomMc=new MovieClip;if(!this.bottomMc.parent)this.bottomD.addChild(this.bottomMc);if(!this.bottomMc.isPlaying)this.bottomMc.playFile(RES_DIR_EFF+"zhanlingbottom",-1);var itemConfig=GlobalConfig.ItemConfig[this.itemid];this.itemname.textFlow=TextFlowMaker.generateTextFlow1(i18n("ZhanlingZBTipWin_1",ItemConfig.getQualityColor(itemConfig),itemConfig.name));this.itemname.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);var q=ItemConfig.getQuality(itemConfig);this.quali.source=q>0?"quali"+q:"";var zlBase=GlobalConfig.ZhanLingBase[this.zlId];var zlTconfig=GlobalConfig.ZhanLingTalent[zlBase.talent][1];if(!zlTconfig)zlTconfig=GlobalConfig.ZhanLingTalent[zlBase.talent][1];var tfdesc=i18n("ZhanlingZBTipWin_0");if(zlTconfig.talentDesc&&zlTconfig.talentDesc.icon){this.skillIcon0.source=zlTconfig.talentDesc.icon;if(zlTconfig.talentDesc.desc)tfdesc+=zlTconfig.talentDesc.desc}else{if(zlTconfig.passive)this.skillIcon0.source=Math.floor(zlTconfig.passive[0].id/1e3)*1e3+"_png";var skconfig=GlobalConfig.SkillsConfig[zlTconfig.passive[0].id];var skdconfig=GlobalConfig.SkillsDescConfig[skconfig.desc];tfdesc+=StringUtils.replace(skdconfig.desc,skconfig.desc_ex)}this.desc.textFlow=TextFlowMaker.generateTextFlow1(tfdesc);var roleLen=3;var zlLevel=GlobalConfig.ZhanLingLevel[this.zlId][0];var zlValue=UserBag.getAttrPower(zlLevel.attrs)*roleLen;var tfValue=(zlTconfig.expower+UserBag.getAttrPower(zlTconfig.attrs?zlTconfig.attrs:[]))*roleLen;var jnValue=0;var arrSkId=[];for(var i=0;i<zlBase.skill.length;i++){var skillid=zlBase.skill[i].id;var zlsConfig=GlobalConfig.ZhanLingSkill[skillid];if(!zlsConfig.attrs)continue;jnValue+=UserBag.getAttrPower(zlsConfig.attrs)*roleLen;arrSkId.push({id:skillid,zlId:zlBase.id})}this.skillList.dataProvider=new ArrayCollection(arrSkId);zlValue=zlValue+tfValue+jnValue;this.powerPanel.setPower(zlValue);var gainConfig=GlobalConfig.GainItemConfig[this.itemid];if(gainConfig)this.gainList.dataProvider=new eui.ArrayCollection(gainConfig.gainWay)};ZhanlingZBTipWin.prototype.otherClose=function(e){ViewManager.ins().close(this)};ZhanlingZBTipWin.prototype.onTouchList=function(e){var item=e.item;if(e.item==null||!item[1]){return}ViewManager.ins().open(item[1],item[2])};return ZhanlingZBTipWin}(BaseEuiView);__reflect(ZhanlingZBTipWin.prototype,"ZhanlingZBTipWin");ViewManager.ins().reg(ZhanlingZBTipWin,LayerManager.UI_Popup);var ZhuZaiData=function(){function ZhuZaiData(){}ZhuZaiData.prototype.parser=function(bytes){this.id=bytes.readInt();this.rank=bytes.readShort();this.growupID=bytes.readInt()};Object.defineProperty(ZhuZaiData.prototype,"lv",{get:function(){return this.rank*GlobalConfig.EquipPointConstConfig.rankGrowUp+this.growupID},enumerable:true,configurable:true});ZhuZaiData.prototype.isMaxLevel=function(){var nextConfig=GlobalConfig.EquipPointGrowUpConfig[this.id][this.lv+1];return nextConfig?false:true};ZhuZaiData.prototype.canLevelup=function(){var config=GlobalConfig.EquipPointGrowUpConfig[this.id][this.lv];var itemID=config.growUpItem.id;var needZs=config.needLevel/1e3>>0;var needLv=config.needLevel%1e3;if(this.isMaxLevel()||needZs&&UserZs.ins().lv<needZs||Actor.level<needLv){return false}if(UserBag.ins().getBagGoodsCountById(0,itemID)<config.growUpItem.count){return false}return true};ZhuZaiData.prototype.canAdvance=function(){var config=GlobalConfig.EquipPointRankConfig[this.id][this.rank];if(!this.lv||!config)return false;var itemID=config.rankUpItem.id;if(UserBag.ins().getBagGoodsCountById(0,itemID)<config.rankUpItem.count){return false}return true};return ZhuZaiData}();__reflect(ZhuZaiData.prototype,"ZhuZaiData");var ZhuzaiEquip=function(_super){__extends(ZhuzaiEquip,_super);function ZhuzaiEquip(){var _this=_super.call(this)||this;_this.sysId=PackageID.ZhuZaiEquip;_this.regNetMsg(1,_this.postZhuZaiData);_this.regNetMsg(3,_this.postShengjie);_this.regNetMsg(4,_this.postShengjie);return _this}ZhuzaiEquip.ins=function(){return _super.ins.call(this)};ZhuzaiEquip.prototype.postZhuZaiData=function(bytes){var count=bytes.readShort();var index;for(var i=0;i<count;i++){index=bytes.readByte();var len=bytes.readShort();for(var j=0;j<len;j++){var data=new ZhuZaiData;data.parser(bytes);SubRoles.ins().getSubRoleByIndex(index).setZhuZaiData(data.id-1,data)}}};ZhuzaiEquip.prototype.sendShengjie=function(roleID,id){var bytes=this.getBytes(3);bytes.writeByte(roleID);bytes.writeInt(id);this.sendToServer(bytes)};ZhuzaiEquip.prototype.postShengjie=function(bytes){return bytes.readBoolean()};ZhuzaiEquip.prototype.sendGrow=function(roleID,id){var bytes=this.getBytes(4);bytes.writeByte(roleID);bytes.writeInt(id);this.sendToServer(bytes)};ZhuzaiEquip.prototype.sendFenjie=function(){this.sendBaseProto(5)};ZhuzaiEquip.prototype.canFengjie=function(){return false};ZhuzaiEquip.prototype.canAllLevelup=function(){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(this.canLevelup(i))return true}return false};ZhuzaiEquip.prototype.canLevelup=function(roleIndex){var config=GlobalConfig.EquipPointBasicConfig;var b=false;for(var i in config){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);var zhuzaiData=role.getZhuZaiDataByIndex(parseInt(i)-1);b=zhuzaiData&&zhuzaiData.canLevelup();if(b)return true}return false};ZhuzaiEquip.prototype.canAllAdvance=function(){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){if(this.canAdvance(i))return true}return false};ZhuzaiEquip.prototype.canAdvance=function(roleIndex){var config=GlobalConfig.EquipPointBasicConfig;var b=false;for(var i in config){var role=SubRoles.ins().getSubRoleByIndex(roleIndex);var zhuzaiData=role.getZhuZaiDataByIndex(parseInt(i)-1);b=zhuzaiData&&zhuzaiData.canAdvance();if(b)return true}return false};return ZhuzaiEquip}(BaseSystem);__reflect(ZhuzaiEquip.prototype,"ZhuzaiEquip");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.zhuzaiEquip=ZhuzaiEquip.ins.bind(ZhuzaiEquip)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ZhuzaiEquipDecomWin=function(_super){__extends(ZhuzaiEquipDecomWin,_super);function ZhuzaiEquipDecomWin(){return _super.call(this)||this}ZhuzaiEquipDecomWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ZhuzaiEquipDecomSkin"};ZhuzaiEquipDecomWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.closeBtn0,this.onClick)};ZhuzaiEquipDecomWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.closeBtn0,this.onClick)};ZhuzaiEquipDecomWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};return ZhuzaiEquipDecomWin}(BaseEuiView);__reflect(ZhuzaiEquipDecomWin.prototype,"ZhuzaiEquipDecomWin");ViewManager.ins().reg(ZhuzaiEquipDecomWin,LayerManager.UI_Main);var ZhuZaiEquipWin=function(_super){__extends(ZhuZaiEquipWin,_super);function ZhuZaiEquipWin(){return _super.call(this)||this}ZhuZaiEquipWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ZhuzaiEquipSkin"};ZhuZaiEquipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onClick);this.addTouchEvent(this.closeBtn0,this.onClick);this.selectRole=param[1];this.select=param[2];this.tab.selectedIndex=param?param[0]:0;this.viewStack.selectedIndex=this.tab.selectedIndex;this.onTabChange();this.addChangeEvent(this.tab,this.onTabChange);this.observe(ZhuzaiEquip.ins().postZhuZaiData,this.updateRedPoint);this.observe(ZhuzaiEquip.ins().postShengjie,this.playEff);this.updateRedPoint()};ZhuZaiEquipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onClick);this.removeTouchEvent(this.closeBtn0,this.onClick);this.growPanel.close();this.advancePanel.close();this.fenjiePanel.close();this.removeObserve()};ZhuZaiEquipWin.prototype.onTabChange=function(e){this.viewStack.selectedChild["open"](this.selectRole,this.select)};ZhuZaiEquipWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};ZhuZaiEquipWin.prototype.updateRedPoint=function(){var ins=ZhuzaiEquip.ins();this.redPoint0.visible=ins.canAllLevelup();this.redPoint1.visible=ins.canAllAdvance();this.redPoint2.visible=false};ZhuZaiEquipWin.prototype.playEff=function(b){var mc=ObjectPool.pop("MovieClip");mc.scaleX=mc.scaleY=1;mc.rotation=0;mc.x=250;mc.y=330;mc.playFile(RES_DIR_EFF+(b?"successeff":"faileff"),1,function(){ObjectPool.push(mc)});this.addChild(mc)};return ZhuZaiEquipWin}(BaseEuiView);__reflect(ZhuZaiEquipWin.prototype,"ZhuZaiEquipWin");ViewManager.ins().reg(ZhuZaiEquipWin,LayerManager.UI_Main);var UserMiji=function(_super){__extends(UserMiji,_super);function UserMiji(){var _this=_super.call(this)||this;_this.grid=[0,0,0];_this.minNewLevels=[0,0,0];_this.showXianyuName=false;_this.reqList={};_this.exPower=[0,0,0];_this.myHistoryList=[];_this.sysId=PackageID.Miji;_this.regNetMsg(1,_this.postMijiData);_this.regNetMsg(2,_this.postMijiUpDate);_this.regNetMsg(3,_this.postMijiChange);_this.regNetMsg(6,_this.postMijiLockInfo);_this.regNetMsg(7,_this.postSetMiji);_this.regNetMsg(8,_this.postUnsetMiji);_this.regNetMsg(9,_this.postAdditionUpdate);_this.regNetMsg(10,_this.postMijiGive);_this.regNetMsg(11,_this.postMijiSearchUserByName);_this.regNetMsg(12,_this.postMyGiveHistory);_this.regNetMsg(13,_this.postNewGiveHistory);_this.regNetMsg(14,_this.postGetUserMijiByName);_this.init();return _this}Object.defineProperty(UserMiji,"guanqiaID",{get:function(){return GlobalConfig.MijiBaseConfig.openChapterLevel},enumerable:true,configurable:true});UserMiji.isOpen=function(){var guanQiaID=UserFb.ins().guanqiaIDFast;return guanQiaID>UserMiji.guanqiaID};UserMiji.prototype.init=function(){var self=this;var cb=function(res){if(res!=null&&res!=""){self.showXianyuName=true}};this.getShowState(cb);this.reqList={}};UserMiji.prototype.getShowState=function(cb){LoginMgr.getItem("showXianyuName",function(res){if(cb){cb(res)}})};UserMiji.prototype.setShowState=function(f){if(f===void 0){f=false}if(f==this.showXianyuName){return}if(f){LoginMgr.setItem("showXianyuName","yes")}else{LoginMgr.setItem("showXianyuName","")}this.showXianyuName=f;LoginMgr.ins().dispatchEventWith(LoginMgr.EVENT_SHOW_XIANYU_NAME,false)};UserMiji.ins=function(){return _super.ins.call(this)};UserMiji.prototype.canGive=function(){var limit=GlobalConfig.MijiBaseConfig.sendGiftVipLevel;return UserVip.ins().lv>=limit};UserMiji.prototype.isMiJiIdBound=function(mijiId){return Math.floor(mijiId/1e5)%10!=0};UserMiji.prototype.getMijiColor=function(mijiId){return mijiId%10};UserMiji.prototype.getMijiLevel=function(mijiId){return Math.floor(mijiId/1e3)%100};UserMiji.prototype.getMijiType=function(mijiId){return Math.floor(mijiId/10)%100};UserMiji.prototype.sendMijiGive=function(actor_name,item_data){var bytes=this.getBytes(10);bytes.writeString(actor_name);bytes.writeString(item_data);this.sendToServer(bytes)};UserMiji.prototype.postMijiGive=function(bytes){var is_ok=bytes.readByte();var msg=bytes.readString();return[is_ok,msg]};UserMiji.prototype.sendMijiSearchUserByName=function(name){var bytes=this.getBytes(11);bytes.writeString(name);this.sendToServer(bytes)};UserMiji.prototype.postMijiSearchUserByName=function(bytes){var is_ok=bytes.readByte();return[is_ok]};UserMiji.prototype.postMyGiveHistory=function(bytes){this.myHistoryList=[];var len=bytes.readInt();for(var i=0;i<len;i++){var ts=bytes.readUnsignedInt();var name_12=bytes.readString();var giftLen=bytes.readInt();var gift=[];for(var j=0;j<giftLen;j++){var type=bytes.readInt();var id=bytes.readInt();var count=bytes.readInt();var temp={type:type,id:id,count:count};gift.push(temp)}var obj={ts:ts,name:name_12,gift:gift};this.myHistoryList.push(obj)}return[this.myHistoryList]};UserMiji.prototype.postNewGiveHistory=function(bytes){var ts=bytes.readUnsignedInt();var name=bytes.readString();var giftLen=bytes.readInt();var gift=[];for(var j=0;j<giftLen;j++){var type=bytes.readInt();var id=bytes.readInt();var count=bytes.readInt();var temp={type:type,id:id,count:count};gift.push(temp)}var obj={ts:ts,name:name,gift:gift};this.myHistoryList.push(obj);return[this.myHistoryList]};UserMiji.prototype.sendSetMiji=function(roleid,grid,id){grid+=1;var bytes=this.getBytes(7);bytes.writeShort(roleid);bytes.writeByte(grid);bytes.writeInt(id);this.sendToServer(bytes)};UserMiji.prototype.postSetMiji=function(bytes){var roleid=bytes.readShort();var grid=bytes.readByte();grid-=1;var id=bytes.readInt();var ok=bytes.readByte();this.miji[roleid][grid].id=id;return[roleid,grid,id,ok]};UserMiji.prototype.sendUnsetMiji=function(roleid,grid){grid+=1;var bytes=this.getBytes(8);bytes.writeShort(roleid);bytes.writeByte(grid);this.sendToServer(bytes)};UserMiji.prototype.postUnsetMiji=function(bytes){var roleid=bytes.readShort();var grid=bytes.readByte();grid-=1;var ok=bytes.readByte();this.miji[roleid][grid].id=0;return[roleid,grid,ok]};UserMiji.prototype.sendAdditionUpdate=function(roldid){var bytes=this.getBytes(9);bytes.writeShort(roldid);this.sendToServer(bytes)};UserMiji.prototype.postAdditionUpdate=function(bytes){var roldid=bytes.readShort();var canEnhance=bytes.readByte();var minNewLevel=bytes.readShort();var exPower=bytes.readUnsignedInt();this.canEnhance=canEnhance!=0;this.minNewLevel=minNewLevel;this.minNewLevels[roldid]=minNewLevel;this.exPower[roldid]=exPower||0;return[roldid,canEnhance,minNewLevel,exPower]};UserMiji.prototype.postMijiData=function(bytes){for(var i=0;i<3;i++){this.grid[i]=bytes.readShort()}var count=SubRoles.ins().subRolesLen;this.miji=[];var isOpen=[];for(var i=0;i<count;i++){this.miji[i]=[];for(var k=0;k<10;k++){isOpen[k]=bytes.readInt()}for(var j in isOpen){if(isOpen[j]==1){var mijiData=new MijiData;mijiData.id=bytes.readInt();mijiData.isLocked=bytes.readInt();this.miji[i][j]=mijiData}else{this.miji[i][j]=null}}}};UserMiji.prototype.sendMijiLearn=function(roleID,skillID){var bytes=this.getBytes(2);bytes.writeShort(roleID);bytes.writeInt(skillID);this.sendToServer(bytes)};UserMiji.prototype.postMijiUpDate=function(bytes){var roleID=bytes.readShort();var index=bytes.readShort()-1;var id=bytes.readInt();var isSuss=bytes.readByte();var oldID=this.miji[roleID][index].id;this.miji[roleID][index].id=id;return[index,id,oldID,isSuss]};UserMiji.prototype.sendMijiChange=function(id1,id2,id3){var bytes=this.getBytes(3);bytes.writeInt(id1);bytes.writeInt(id2);bytes.writeInt(id3);this.sendToServer(bytes)};UserMiji.prototype.sendMijiwancheng=function(roleID){var bytes=this.getBytes(4);bytes.writeShort(roleID);this.sendToServer(bytes)};UserMiji.prototype.sendMijiAddLock=function(roleID,mijiID){var bytes=this.getBytes(5);bytes.writeInt(roleID);bytes.writeInt(mijiID);this.sendToServer(bytes)};UserMiji.prototype.sendMijiDelLock=function(roleID,mijiID){var bytes=this.getBytes(6);bytes.writeInt(roleID);bytes.writeInt(mijiID);this.sendToServer(bytes)};UserMiji.prototype.getSkillListOfRole=function(roleID){return this.miji&&this.miji[roleID]?this.miji[roleID]:null};UserMiji.prototype.getMijiData=function(roleID,skillID){var list=this.getSkillListOfRole(roleID);return list&&list[skillID]?list[skillID].id:null};UserMiji.prototype.hasSpecificSkillOfRole=function(roleID,skillID){var result=false;var propId=Math.floor(skillID/10)%100;var skillList=this.getSkillListOfRole(roleID);if(skillList!=null){var b=false;for(var i=0;i<skillList.length;i++){if(skillList[i]&&skillList[i].id){var curPropId=Math.floor(skillList[i].id/10)%100;if(curPropId==propId){b=true}}}if(b){result=true}}return result};UserMiji.prototype.mijiIsLock=function(roleID,skillID){var isLock=false;var skillList=this.getSkillListOfRole(roleID);if(skillList!=null){var b=false;for(var i=0;i<skillList.length;i++){if(skillList[i]&&skillList[i].id){if(Math.floor(skillList[i].id/10)==Math.floor(skillID/10)&&skillList[i].isLocked){b=true}}}if(b){isLock=true}}return isLock};UserMiji.prototype.hasNewSkillOfRole=function(roleID){var result=false;var skillList=this.getSkillListOfRole(roleID);if(skillList!=null){skillList.every(function(obj){if(obj.id>0){result=true;return false}return true})}return result};UserMiji.prototype.postMijiChange=function(bytes){var itemID=bytes.readInt();var isBoom=bytes.readInt();var levelUp=bytes.readInt();return[itemID,isBoom,levelUp]};UserMiji.prototype.postMijiLockInfo=function(bytes){var arr=this.miji[bytes.readInt()];var mijiid=bytes.readInt();for(var i=0;i<arr.length;i++){if(arr[i].id==mijiid){var dd=bytes.readInt();arr[i].isLocked=dd;break}}};UserMiji.prototype.sendGetUserMijiByName=function(name){var bytes=this.getBytes(14);bytes.writeString(name);this.sendToServer(bytes)};UserMiji.prototype.postGetUserMijiByName=function(bytes){var name=bytes.readString();var isExists=bytes.readByte();console.log("postGetUserMijiByName",isExists);if(isExists==0){return[name,isExists,null,null]}var grid=bytes.readShort();var count=bytes.readShort();var miji=[];var levels=[];for(var i=0;i<count;i++){miji[i]=[];levels[i]=bytes.readShort();for(var j=0;j<grid;j++){var mijiData={};mijiData["id"]=bytes.readInt();mijiData["isLocked"]=bytes.readInt();miji[i][j]=mijiData}}console.log(grid,count,levels,miji);return[name,isExists,miji,levels]};UserMiji.prototype.getPowerByRole=function(index){var power=0;var mijiArr=this.miji[index];for(var i=0;i<mijiArr.length;i++){if(mijiArr[i].id){var cfg=GlobalConfig.MiJiSkillConfig[mijiArr[i].id];if(cfg){power+=cfg.power}}}return power};UserMiji.prototype.postSelectedMiji=function(itemNumber,name){return[itemNumber,name]};UserMiji.prototype.postBagUseMiji=function(itemId){return itemId};UserMiji.prototype.hasEquipMiji=function(itemId,index){if(index===void 0){index=0}var numList=this.miji[index];if(!numList)return false;for(var j=0;j<numList.length;j++){if(numList[j]&&numList[j].id!=0){var cfg=GlobalConfig.MiJiSkillConfig[numList[j].id];if(cfg.item==itemId){return true}}}return false};UserMiji.prototype.isMjiSum=function(roleID,gridID){if(roleID===void 0){roleID=-1}if(gridID===void 0){gridID=-1}if(!UserMiji.isOpen())return false;if(!this.miji)return false;var itemArr=UserBag.ins().getBagGoodsByType(2);var have=itemArr.length>0?true:false;if(!have)return false;var mijiRedPoint=Setting.ins().getValue(ClientSet.mijiRedPoint);var roleIDs=[roleID];if(roleID==-1){var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;++i){roleIDs[i]=i}}var unusedTypes={};for(var _i=0,itemArr_1=itemArr;_i<itemArr_1.length;_i++){var item=itemArr_1[_i];var skillID=MiJiSkillConfig.getSkillIDByItem(item._configID);unusedTypes[UserMiji.ins().getMijiType(skillID)]=1}for(var _a=0,roleIDs_1=roleIDs;_a<roleIDs_1.length;_a++){var id=roleIDs_1[_a];var numList=this.miji[id];if(numList){var usedSlotCnt=0;for(var j=0;j<numList.length;j++){if(numList[j]&&numList[j].id){usedSlotCnt++}}var gridnum=UserMiji.ins().grid[id];var isMarried=MarryMgr.ins().isMarried();if(isMarried){gridnum=UserMiji.ins().grid[id]-2}var hasEmptySlot=usedSlotCnt<(gridnum||0);if(gridID>=0){var id_6=numList[gridID]&&numList[gridID].id||0;hasEmptySlot=id_6>0?false:true}var unusedTypesCopy=deepCopy(unusedTypes);for(var j=0;j<numList.length;j++){if(numList[j]&&numList[j].id){var mijiType=UserMiji.ins().getMijiType(numList[j].id);unusedTypesCopy[mijiType]=0}}var hasUnusedType=false;for(var k in unusedTypesCopy){if(unusedTypesCopy[k]==1){hasUnusedType=true;break}}if(hasEmptySlot&&hasUnusedType){Setting.ins().setValue(ClientSet.mijiRedPoint,1);return true}}}return false};UserMiji.prototype.replaceDec=function(desc,id){if(desc===void 0){desc=""}var str=desc||"";var res="";var c=1;while(str.indexOf("&T:X")>0||str.indexOf("&T:Y")>0){var i=0;var i1=str.indexOf("&T:X");var i2=str.indexOf("&T:Y");var isPercent=false;if(i1>0){i=i1+4}else if(str.indexOf("&T:Y")>0){i=i2+4;isPercent=true}res+=str.slice(0,i-1);str=str.slice(i,str.length);var j=str.indexOf("|");var value=str.slice(0,j);var skillID=MiJiSkillConfig.getSkillIDByItem(id);var config=GlobalConfig.MiJiSkillConfig[skillID];if(config&&config["p"+c.toString()]){if(isPercent){var float=stringToNum(config["p"+c.toString()])/100;var int=Math.floor(float);if(Math.abs(int-float)>0){res+=formatFloat(float,2)}else{res+=int}res+="%"}else{res+=config["p"+c.toString()]}}else{res+=value}res+="|";str=str.slice(j+1,str.length);c++}res+=str;return res};UserMiji.prototype.getZiNum=function(mijidata){var count=0;if(!mijidata){return 0}for(var i=0;i<8;i++){var d=mijidata[i];if(d){var id=d["id"];if(id<=0){continue}var color=UserMiji.ins().getMijiColor(id);if(color==1){count++}}}return count};UserMiji.prototype.getXianYuNum=function(mijidata){var count=0;if(!mijidata){return 0}for(var i=0;i<8;i++){var d=mijidata[i];if(d){var id=d["id"];if(id<=0){continue}count++}}return count};UserMiji.prototype.getZiNumTotal=function(){var count=0;for(var i=0;i<3;i++){var data=this.miji[i];var c=this.getZiNum(data);count+=c}return count};UserMiji.prototype.getXianYuNumTotal=function(){var count=0;for(var i=0;i<3;i++){var data=this.miji[i];var c=this.getXianYuNum(data);count+=c}return count};UserMiji.prototype.getMinLevelTotal=function(){var m=100;for(var i=0;i<3;i++){var l=this.minNewLevels[i];if(l<m){m=l}}return m};UserMiji.prototype.getTotelXYPower=function(){var v=0;for(var i=0;i<this.exPower.length;i++){v=v+this.exPower[i]}return v};UserMiji.BAGOPEN=5;return UserMiji}(BaseSystem);__reflect(UserMiji.prototype,"UserMiji");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userMiji=UserMiji.ins.bind(UserMiji)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var UserZs=function(_super){__extends(UserZs,_super);function UserZs(){var _this=_super.call(this)||this;_this.isSendXW=[];_this.sysId=PackageID.Zs;_this.regNetMsg(1,_this.postZsData);_this.exchange=false;return _this}UserZs.ins=function(){return _super.ins.call(this)};UserZs.prototype.postZsData=function(bytes){this.lv=bytes.readInt();var oldexp=this.exp;this.exp=bytes.readInt();this.upgradeCount=[bytes.readShort(),bytes.readShort(),bytes.readShort()];if(oldexp)Actor.ins().postZsExpChange(this.exp-oldexp);this.postZsLv()};UserZs.prototype.postZsLv=function(){};UserZs.prototype.sendGetXiuWei=function(type){var bytes=this.getBytes(1);bytes.writeByte(type);this.sendToServer(bytes)};UserZs.prototype.sendZsUpgrade=function(){this.sendBaseProto(2)};UserZs.prototype.canUpgrade=function(){var nextAttConfig=GlobalConfig.ZhuanShengLevelConfig[this.lv+1];if(!nextAttConfig)return false;return this.exp>=nextAttConfig.exp};UserZs.prototype.isMaxLv=function(){return GlobalConfig.ZhuanShengLevelConfig[this.lv+1]?false:true};UserZs.prototype.canGet=function(){var sum=0;if(!this.upgradeCount)return sum;var config=GlobalConfig.ZhuanShengConfig;var canCount=[config.conversionCount,config.normalCount,config.advanceCount];var items=[0,config.normalItem,config.advanceItem];var items2=[0,config.normalItemUnlimit,config.advanceItemUnlimit];for(var i=0;i<canCount.length;i++){if(canCount[i]-this.upgradeCount[i]){if(!items[i]&&Actor.level>80||UserBag.ins().getBagGoodsCountById(0,items[i])||UserBag.ins().getBagGoodsCountById(0,items2[i]))if(i==0){if(!UserZs.ins().exchange)sum=sum|1<<i}else sum=sum|1<<i}}var escortCnt=EscortMgr.ins().getMaxProtectCount()-EscortMgr.ins().escorted;if(EscortMgr.ins().checkRedPoint()&&escortCnt>0){sum=sum|1<<3}return sum};UserZs.prototype.canOpenZSWin=function(){var lv=Actor.level;var zs=this.lv!=null?this.lv:0;if(zs<=0&&lv<80)return false;else return true};return UserZs}(BaseSystem);__reflect(UserZs.prototype,"UserZs");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.userZs=UserZs.ins.bind(UserZs)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var MijiData=function(){function MijiData(){}return MijiData}();__reflect(MijiData.prototype,"MijiData");var DressGuideMgr=function(_super){__extends(DressGuideMgr,_super);function DressGuideMgr(){var _this=_super.call(this)||this;_this.step=0;_this.needGuide=true;_this.jiaID=[1000001,1000002,1000003];if(_this.needGuide){Actor.ins().sendSyncGuideStep("DressGuide",0,1)}return _this}DressGuideMgr.ins=function(){if(this._singleton==null){this._singleton=new DressGuideMgr}return this._singleton};DressGuideMgr.prototype.isJia=function(id){var res=false;for(var _i=0,_a=this.jiaID;_i<_a.length;_i++){var v=_a[_i];if(v==id){res=true;break}}return res};DressGuideMgr.prototype.setStep=function(stepNum,isLogin){if(stepNum===void 0){stepNum=0}if(isLogin===void 0){isLogin=0}this.step=stepNum;DressGuideMgr.ins().dispatchEventWith(DressGuideMgr.EVENT_DRESS_GUIDE_STEP_CHANGE,false,null);switch(this.step){case 1:if(isLogin==0){ViewManager.ins().open(BagWin,1)}break;case 2:if(isLogin==0){ViewManager.ins().open(DressWin)}break}};DressGuideMgr.prototype.getStep=function(){return this.step};DressGuideMgr.prototype.toStep=function(step){if(!this.needGuide){this.step=1;return}if(step<this.step){return}Actor.ins().sendSyncGuideStep("DressGuide",step,0)};DressGuideMgr.EVENT_DRESS_GUIDE_STEP_CHANGE="EVENT_DRESS_GUIDE_STEP_CHANGE";return DressGuideMgr}(egret.EventDispatcher);__reflect(DressGuideMgr.prototype,"DressGuideMgr");var MijiGuideFinishTip=function(_super){__extends(MijiGuideFinishTip,_super);function MijiGuideFinishTip(){return _super.call(this)||this}MijiGuideFinishTip.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="MijiGuideFinishTipSkin";this.isTopLevel=true};MijiGuideFinishTip.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.colorCanvas,this.onClose);var str=i18n("MijiGuideFinishTip_0");str+=i18n("MijiGuideFinishTip_1");str+=i18n("MijiGuideFinishTip_2");str+=i18n("MijiGuideFinishTip_3");this.info.textFlow=TextFlowMaker.generateTextFlow(str)};MijiGuideFinishTip.prototype.onClose=function(e){MijiGuideMgr.ins().toStep(4);ViewManager.ins().close(this)};MijiGuideFinishTip.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onClose)};return MijiGuideFinishTip}(BaseEuiView);__reflect(MijiGuideFinishTip.prototype,"MijiGuideFinishTip");ViewManager.ins().reg(MijiGuideFinishTip,LayerManager.UI_Popup);var MijiGuideMgr=function(_super){__extends(MijiGuideMgr,_super);function MijiGuideMgr(){var _this=_super.call(this)||this;_this.step=0;_this.needGuide=true;_this.jiaID=[220010,220011,220013,220014];_this.showJia=false;if(_this.needGuide){Actor.ins().sendSyncGuideStep("MijiGuide",0,1)}return _this}MijiGuideMgr.ins=function(){if(this._singleton==null){this._singleton=new MijiGuideMgr}return this._singleton};MijiGuideMgr.prototype.isJia=function(id){var res=false;for(var _i=0,_a=this.jiaID;_i<_a.length;_i++){var v=_a[_i];if(v==id){res=true;break}}return res};MijiGuideMgr.prototype.checkStep0=function(){if(!this.needGuide){return}var isMijiOpen=UserMiji.isOpen();if(!isMijiOpen&&this.step>0){return}var goodsList=UserBag.ins().getBagGoodsBySort(0);var goodsList2=UserBag.ins().getBagGoodsBySort(2);var goodsList3=goodsList2.concat(goodsList);var jia=null;for(var _i=0,goodsList3_2=goodsList3;_i<goodsList3_2.length;_i++){var v=goodsList3_2[_i];var itemConfig=v.itemConfig;var id=itemConfig.id;if(this.isJia(id)){jia=v;break}}if(jia&&!this.showJia){this.showJia=true;ViewManager.ins().open(UseXianYuJiaTip,jia)}};MijiGuideMgr.prototype.setStep=function(stepNum,isLogin){if(stepNum===void 0){stepNum=0}if(isLogin===void 0){isLogin=0}this.step=stepNum;if(this.step>0){TimerManager.ins().remove(this.checkStep0,this);this.showJia=false}MijiGuideMgr.ins().dispatchEventWith(MijiGuideMgr.EVENT_MIJI_GUIDE_STEP_CHANGE,false,null);switch(this.step){case 0:TimerManager.ins().doTimer(1e3,0,this.checkStep0,this);break;case 1:if(isLogin==0){ViewManager.ins().open(BagWin,1)}break;case 2:if(isLogin==0){ViewManager.ins().open(BagWin,1)}break;case 3:ViewManager.ins().open(MijiGuideFinishTip);break}};MijiGuideMgr.prototype.getStep=function(){return this.step};MijiGuideMgr.prototype.toStep=function(step){if(!this.needGuide){this.step=0;return}if(step<this.step){return}Actor.ins().sendSyncGuideStep("MijiGuide",step,0)};MijiGuideMgr.EVENT_MIJI_GUIDE_STEP_CHANGE="EVENT_MIJI_GUIDE_STEP_CHANGE";return MijiGuideMgr}(egret.EventDispatcher);__reflect(MijiGuideMgr.prototype,"MijiGuideMgr");var UseXianYuJiaTip=function(_super){__extends(UseXianYuJiaTip,_super);function UseXianYuJiaTip(){var _this=_super.call(this)||this;_this.skinName="UseXIanYuJiaTipSkin";return _this}UseXianYuJiaTip.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.btnUse,this.onEvent);this.removeObserve()};UseXianYuJiaTip.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnUse,this.onEvent);this.init(param[0])};UseXianYuJiaTip.prototype.init=function(itemdata){this.itemdata=itemdata;if(this.itemdata&&this.itemdata.itemConfig){this.equipName.text=this.itemdata.itemConfig.name;this.equipName.textColor=ItemConfig.getQualityColor(this.itemdata.itemConfig);this.equipName.strokeColor=ItemConfig.getQualityStrokeColor(this.itemdata.itemConfig);this.setItemImg(this.itemdata.itemConfig.icon.toString()+"_png");var itemConfig=this.itemdata.itemConfig;var itemType=ItemConfig.getType(itemConfig);if(itemType==ItemType.TYPE_17){this.titleText.text=i18n("UseXianYuJiaTip_0")}}};UseXianYuJiaTip.prototype.setItemImg=function(str){this.itemIcon.source=str};UseXianYuJiaTip.prototype.onEvent=function(e){switch(e.target){case this.btnUse:this.nextStep();break}};UseXianYuJiaTip.prototype.nextStep=function(){ViewManager.ins().close(UseXianYuJiaTip);var itemConfig=this.itemdata.itemConfig;var itemType=ItemConfig.getType(itemConfig);if(itemType==ItemType.TYPE_17){ViewManager.ins().open(TreasureChuanshiGiftWin,0,itemConfig.id,this.itemdata.count);return}MijiGuideMgr.ins().toStep(1)};UseXianYuJiaTip.prototype.onClose=function(){this.close()};return UseXianYuJiaTip}(BaseEuiView);__reflect(UseXianYuJiaTip.prototype,"UseXianYuJiaTip");ViewManager.ins().reg(UseXianYuJiaTip,LayerManager.UI_Popup);var GainZsWin=function(_super){__extends(GainZsWin,_super);function GainZsWin(){return _super.call(this)||this}GainZsWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="GainZsSkin";this.infoTxts=[this["infoTxt0"],this["infoTxt1"],this["infoTxt2"],this["infoTxt3"]];this.toDays=[this["toDay0"],this["toDay1"],this["toDay2"],this["toDay3"]];this.items=[this["item0"],this["item1"],this["item2"],this["item3"]];this.btns=[this["btn0"],this["btn1"],this["btn2"],this["btn3"]];this.addTouchEvent(this.btn3,this.onTap);for(var i=0;i<this.items.length;i++){if(i!=1&&i!=2){this.items[i].isShowName(false)}}this.priceIcon1.setType(MoneyConst.yuanbao);this.priceIcon2.setType(MoneyConst.yuanbao);var reward=new RewardData;reward.type=0;reward.id=0;reward.count=0;this.items[0].data=reward;this.isTopLevel=true;this.tipsExp=0};GainZsWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this,this.onTap);this.observe(UserZs.ins().postZsData,this.setData);this.observe(Actor.ins().postLevelChange,this.setData);this.observe(Shop.ins().postBuyResult,this.setData);this.observe(Shop.ins().postBuyCount,this.setData);this.observe(EscortMgr.ins().postStatus,this.setData);this.observe(EscortMgr.ins().postStartEscort,this.setData);this.observe(EscortMgr.ins().postEndTimeReached,this.setData);this.observe(EscortMgr.ins().postBuyEscort,this.setData);this.observe(UserBag.ins().postItemChange,this.setData);this.observe(UserBag.ins().postItemAdd,this.setData);this.setData()};GainZsWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onTap);this.removeObserve()};GainZsWin.prototype.setData=function(){var config=GlobalConfig.ZhuanShengConfig;var lowestLv=config.level+1;var lv=Math.max(Actor.level,lowestLv);var lvConfig=GlobalConfig.ZhuanShengLevelConfig[lv];var expConfig=GlobalConfig.ZhuanShengExpConfig[lv];var ins=UserZs.ins();var sCount;this.toDays[0].textColor=Actor.level<lowestLv?15937822:11050120;this.infoTxts[0].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_0",expConfig.exp));sCount=config.conversionCount-ins.upgradeCount[0];this.toDays[0].textFlow=(new egret.HtmlTextParser).parser(Actor.level<=80?i18n("GainZsWin_1",lowestLv-1):i18n("GainZsWin_2",sCount));this.btns[0].enabled=sCount>0;var itemID=config.normalItemUnlimit;var count=UserBag.ins().getBagGoodsCountById(0,itemID);var itemConfig;var itemStoreConfig;this.btns[1].name=config.normalExp+"";sCount=config.normalCount-ins.upgradeCount[1];this.toDays[1].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_7",sCount));if(count>0){this.items[1].data=itemID;this.btns[1].label=i18n("GainZsWin_3");this.infoTxts[1].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_12",config.normalExp,count,i18n("GainZsWin_22")));this.btns[1].enabled=true;this.priceIcon1.visible=false;this.normalId=itemID}else{itemID=config.normalItem;count=UserBag.ins().getBagGoodsCountById(0,itemID);itemConfig=GlobalConfig.ItemConfig[itemID];itemStoreConfig=ItemStoreConfig.getStoreByItemID(itemID);this.normalId=itemID;this.items[1].data=itemID;this.btns[1].label=count>0?i18n("GainZsWin_3"):i18n("GainZsWin_4");if(count>0){this.infoTxts[1].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_6",config.normalExp,count,""))}else{this.infoTxts[1].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_6",config.normalExp,count,""))}this.priceIcon1.visible=count==0;this.priceIcon1.setPrice(itemStoreConfig.price);this.priceIcon1.name=itemConfig.name;var countStr=count?i18n("GainZsWin_5",count):"";this.btns[1].enabled=sCount>0}itemConfig=GlobalConfig.ItemConfig[config.normalItem];this.items[1].setName(itemConfig.name);itemID=config.advanceItemUnlimit;count=UserBag.ins().getBagGoodsCountById(0,itemID);this.btns[2].name=config.advanceExp+"";sCount=config.advanceCount-ins.upgradeCount[2];this.toDays[2].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_13",sCount));if(count>0){this.items[2].data=itemID;this.btns[2].label=i18n("GainZsWin_3");this.infoTxts[2].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_12",config.advanceExp,count,i18n("GainZsWin_22")));this.btns[2].enabled=true;this.priceIcon2.visible=false;this.advanceId=itemID}else{itemID=config.advanceItem;count=UserBag.ins().getBagGoodsCountById(0,itemID);itemConfig=GlobalConfig.ItemConfig[itemID];itemStoreConfig=ItemStoreConfig.getStoreByItemID(itemID);this.advanceId=itemID;this.items[2].data=itemID;this.btns[2].label=count>0?i18n("GainZsWin_3"):i18n("GainZsWin_4");if(count>0){this.infoTxts[2].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_6",config.advanceExp,count,""))}else{this.infoTxts[2].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_6",config.advanceExp,count,""))}this.priceIcon2.visible=count==0;this.priceIcon2.setPrice(itemStoreConfig.price);this.priceIcon2.name=itemConfig.name;var countStr=count?i18n("GainZsWin_5",count):"";this.btns[2].enabled=sCount>0}itemConfig=GlobalConfig.ItemConfig[config.advanceItem];this.items[2].setName(itemConfig.name);var escortCnt=EscortMgr.ins().getMaxProtectCount()-EscortMgr.ins().escorted;this.toDays[3].textFlow=(new egret.HtmlTextParser).parser(i18n("GainZsWin_15",escortCnt));this.items[3].data=290002;this.btns[3].enabled=escortCnt>0;var sum=ins.canGet();for(var i=0;i<4;i++){this["redPoint"+i].visible=sum>>i&1;if(this["redPointRule"+i]){this["redPointRule"+i]()}}lv=Math.max(Actor.level+1,lowestLv);expConfig=GlobalConfig.ZhuanShengExpConfig[lv];if(UserZs.ins().isSendXW[0]){UserZs.ins().isSendXW[0]=false}else if(UserZs.ins().isSendXW[1]){UserZs.ins().isSendXW[1]=false}else if(UserZs.ins().isSendXW[2]){UserZs.ins().isSendXW[2]=false}};GainZsWin.prototype.redPointRule0=function(){if(!UserZs.ins().exchange)UserZs.ins().exchange=true};GainZsWin.prototype.onTap=function(e){switch(e.target){case this.colorCanvas:case this.closeBtn0:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;default:var index=this.btns.indexOf(e.target);if(index>-1){if(index==0){UserZs.ins().isSendXW[index]=true;UserZs.ins().sendGetXiuWei(index+1)}else if(this.btns[index].label==i18n("GainZsWin_19")){UserZs.ins().isSendXW[index]=true;var config=GlobalConfig.ZhuanShengConfig;if(index==1){if(this.normalId==config.normalItemUnlimit){UserBag.ins().sendUseItem(this.normalId,1)}else{UserZs.ins().sendGetXiuWei(index+1)}}else if(index==2){if(this.advanceId==config.advanceItemUnlimit){UserBag.ins().sendUseItem(this.advanceId,1)}else{UserZs.ins().sendGetXiuWei(index+1)}}}else{var price=this["priceIcon"+index].getPrice();if(Actor.yb<price){if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("GainZsWin_20"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("GainZsWin_21"))}ViewManager.ins().close(this);return}if(index==1){var conf=GlobalConfig.ItemStoreConfig;for(var k in conf){if(conf[k].itemId==200009){this.buyGoodsId(conf[k].id);return}}}else if(index==2){var conf=GlobalConfig.ItemStoreConfig;for(var k in conf){if(conf[k].itemId==200010){this.buyGoodsId(conf[k].id);return}}}else if(index==3){ViewManager.ins().open(LadderWin,3);ViewManager.ins().close(this)}}}}};GainZsWin.prototype.buyGoodsId=function(id){if(Shop.ins().shopData.checkBuyGoodsId(id)){ViewManager.ins().open(BuyWin,id)}};return GainZsWin}(BaseEuiView);__reflect(GainZsWin.prototype,"GainZsWin");ViewManager.ins().reg(GainZsWin,LayerManager.UI_Popup);var MIjiGiveHistoryItemRenderer=function(_super){__extends(MIjiGiveHistoryItemRenderer,_super);function MIjiGiveHistoryItemRenderer(){var _this=_super.call(this)||this;var self=_this;_this.skinName="MijiGiveHistoryItemSkin";return _this}MIjiGiveHistoryItemRenderer.prototype.dataChanged=function(){this.info.textFlow=TextFlowMaker.generateTextFlow1(this.data["info"])};return MIjiGiveHistoryItemRenderer}(BaseItemRender);__reflect(MIjiGiveHistoryItemRenderer.prototype,"MIjiGiveHistoryItemRenderer");var MIjiGiveItemRenderer=function(_super){__extends(MIjiGiveItemRenderer,_super);function MIjiGiveItemRenderer(){var _this=_super.call(this)||this;var self=_this;_this.skinName="MijiGiveItemSkin";_this.touchChildren=true;_this.btnRemove.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var gridIdx=self.data["grid"];LoginMgr.ins().dispatchEventWith(LoginMgr.EVENT_REMOVE_GIVE_SELECT,false,gridIdx)},_this);return _this}MIjiGiveItemRenderer.prototype.dataChanged=function(){var obj=this.data;this.item.data=obj["item"];this.btnRemove.visible=obj["selected"];if(obj["selected"]){this.item.count.text=obj["selCount"].toString()+"/"+this.item.data.count.toString()}else{this.item.count.text=this.item.data.count.toString()}this.imgSelected.visible=obj["isCurSelect"]};return MIjiGiveItemRenderer}(BaseItemRender);__reflect(MIjiGiveItemRenderer.prototype,"MIjiGiveItemRenderer");var MijiGiveWin=function(_super){__extends(MijiGiveWin,_super);function MijiGiveWin(){var _this=_super.call(this)||this;_this.shakeTimerID=null;_this.shakeCnt=0;_this.shakeX0=0;_this.shakeY0=0;_this.selectedList=[];_this.sendGiftMaxGroup=GlobalConfig.MijiBaseConfig.sendGiftMaxGroup;_this.sendGiftGroupLimit=GlobalConfig.MijiBaseConfig.sendGiftGroupLimit;_this.gridDataArr=[];_this.first=true;_this.skinName="MijiGiveSkin";return _this}MijiGiveWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.itemList.itemRenderer=MIjiGiveItemRenderer;this.itemScroller.viewport=this.itemList;this.historyScroller.viewport=this.historyList;this.historyList.itemRenderer=MIjiGiveHistoryItemRenderer;this.isTopLevel=true;this.labelFindOK.visible=false;this.labelFindError.visible=false;this.btnGive.enabled=false};MijiGiveWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var targetName=param[0];if(targetName!=null){this.textReceiverName.text=targetName;this.onBtnFind()}else{this.addTouchEvent(this.textReceiverName,this.clearTxt)}this.addTouchEvent(this.btnClose,this.onBtnClose);this.addTouchEvent(this.btnFind,this.onBtnFind);this.addTouchEvent(this.btnAdd,this.addNum);this.addTouchEvent(this.btnSub,this.subNum);this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.addTouchEvent(this.btnGive,this.onBtnGive);this.addTouchEvent(this.btnGive0,this.showTip);this.addChangeEvent(this.textSelectCount,this.onTxtChange);this.addChangeEvent(this.textReceiverName,this.onBtnFind);this.observe(UserMiji.ins().postMijiSearchUserByName,this.onMijiSearchUserByName);this.observe(UserMiji.ins().postMijiGive,this.onMijiGiveResult);this.observe(UserMiji.ins().postNewGiveHistory,this.updateHistory);LoginMgr.ins().addEventListener(LoginMgr.EVENT_REMOVE_GIVE_SELECT,this.removeSelectGive,this);this.clearData();this.initItem();this.updateHistory(null)};MijiGiveWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}if(this.shakeTimerID){clearInterval(this.shakeTimerID);this.shakeTimerID=null}this.removeTouchEvent(this.btnClose,this.onBtnClose);this.removeTouchEvent(this.btnGive,this.onBtnGive);this.itemList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.removeObserve()};MijiGiveWin.prototype.showTip=function(){UserTips.ins().showTips(i18n("MijiGiveWin_0"))};MijiGiveWin.prototype.onMijiSearchUserByName=function(params){var is_ok=params[0];var error_str=i18n("MijiGiveWin_1");if(this.textReceiverName.text==Actor.myName){is_ok=0;error_str=i18n("MijiGiveWin_2")}this.labelFindError.text=error_str;this.labelFindOK.visible=is_ok==1;this.labelFindError.visible=is_ok!=1;this.btnGive.enabled=is_ok==1;if(this.labelFindError.visible){this.shakeErrorLabel()}};MijiGiveWin.prototype.shakeErrorLabel=function(){var self=this;this.shakeCnt=15;self.shakeX0=self.labelFindError.x;self.shakeY0=self.labelFindError.y;this.shakeTimerID=setInterval(function(){self.shakeCnt--;if(self.shakeCnt>0){self.labelFindError.x=self.shakeX0+Math.random()*10-5;self.labelFindError.y=self.shakeY0+Math.random()*10-5}else{self.labelFindError.x=self.shakeX0;self.labelFindError.y=self.shakeY0;clearInterval(this.shakeTimerID);this.shakeTimerID=null}},200)};MijiGiveWin.prototype.onBtnFind=function(){var s=this.textReceiverName.text;if(s==null||s.length==0){WarnWin.show(i18n("MijiGiveWin_3"),function(){},this);return}UserMiji.ins().sendMijiSearchUserByName(s)};MijiGiveWin.prototype.onBtnGive=function(){var self=this;var actor_name=this.textReceiverName.text;var obj={};if(self.selectedList.length<0){WarnWin.show(i18n("MijiGiveWin_4"),function(){},this);return}for(var _i=0,_a=self.selectedList;_i<_a.length;_i++){var v=_a[_i];for(var gridIdx in v){var configID=self.gridDataArr[gridIdx]["item"]["configID"];var skillID=MiJiSkillConfig.getSkillIDByItem(configID);if(obj[skillID]){obj[skillID]+=v[gridIdx]}else{obj[skillID]=v[gridIdx]}}}WarnWin.show(i18n("MijiGiveWin_5")+i18n("MijiGiveWin_12",14502316,actor_name)+i18n("MijiGiveWin_13",4740980),function(){UserMiji.ins().sendMijiGive(actor_name,JSON.stringify(obj))},this)};MijiGiveWin.prototype.onMijiGiveResult=function(params){var is_ok=params[0];var msg=params[1];if(is_ok==1){WarnWin.show(i18n("MijiGiveWin_6"),function(){},this,undefined,undefined,"sure");this.initItem()}else{WarnWin.show(msg,function(){},this,undefined,undefined,"sure")}};MijiGiveWin.prototype.onBtnClose=function(){ViewManager.ins().close(this)};MijiGiveWin.prototype.sortFun=function(aItem,bItem){var ins=UserMiji.ins();var aid=MiJiSkillConfig.getSkillIDByItem(aItem.configID);var bid=MiJiSkillConfig.getSkillIDByItem(bItem.configID);if(aItem.configID<bItem.configID)return-1;if(aItem.configID>bItem.configID)return 1;return 0};MijiGiveWin.prototype.initItem=function(){var self=this;self.clearData();var arr=UserBag.ins().getBagGoodsByType(2);arr.sort(this.sortFun.bind(this));var newArr=[];for(var _i=0,arr_7=arr;_i<arr_7.length;_i++){var v=arr_7[_i];if(v.count>self.sendGiftGroupLimit){var groupNum=Math.ceil(v.count/self.sendGiftGroupLimit);for(var i=0;i<groupNum;i++){var vv=deepCopy(v,true);if(i<groupNum-1){vv.count=self.sendGiftGroupLimit}else{vv.count=v.count%self.sendGiftGroupLimit}newArr.push(vv)}}else{newArr.push(v)}}var unBound=[];for(var i_25=0;i_25<newArr.length;i_25++){var id=MiJiSkillConfig.getSkillIDByItem(newArr[i_25].configID);var isBound=UserMiji.ins().isMiJiIdBound(id);if(!isBound){var obj=new Object;obj["grid"]=unBound.length;obj["item"]=newArr[i_25];obj["selected"]=0;obj["isCurSelect"]=false;obj["selCount"]=0;unBound.push(obj)}}this.gridDataArr=unBound;if(unBound.length){this.onSelected(0,unBound[0]);this.itemList.selectedIndex=0;return}this.updateItemList()};MijiGiveWin.prototype.updateItemList=function(){for(var i=0;i<this.gridDataArr.length;i++){var g=this.gridDataArr[i];g["selCount"]=this.getSelectCount(i);g["selected"]=g["selCount"]>0?true:false;g["isCurSelect"]=i==this.itemList.selectedIndex?true:false}this.itemList.dataProvider=new eui.ArrayCollection(this.gridDataArr);this.updateSelectState()};MijiGiveWin.prototype.updateHistory=function(params){if(params===void 0){params=null}var self=this;var arr=UserMiji.ins().myHistoryList;if(arr.length<0){this.historyList.dataProvider=new eui.ArrayCollection([]);return}var infoArr=[];for(var i=arr.length-1;i>=0;i--){var str="";var data=arr[i];str+=getFullDateString(data.ts);str+=i18n("MijiGiveWin_7");for(var j=0;j<data.gift.length;j++){var g=data.gift[j];var id=g.id;var count=g.count;var itemConfig=GlobalConfig.ItemConfig[id];var name=itemConfig.name;str+=i18n("MijiGiveWin_14",2933496," ["+name+"] *"+count.toString());if(j<data.gift.length-1){str+=i18n("MijiGiveWin_15",5375653)}}str+=i18n("MijiGiveWin_8",5375653)+i18n("MijiGiveWin_16",14502316,data.name)+i18n("MijiGiveWin_9",5375653);var obj={info:str};infoArr.push(obj)}if(infoArr.length>10){infoArr.splice(10,infoArr.length-10)}this.historyList.dataProvider=new eui.ArrayCollection(infoArr)};MijiGiveWin.prototype.setSelectCount=function(gridIdx,count){if(gridIdx===void 0){gridIdx=0}if(count===void 0){count=0}var newSelect=true;for(var _i=0,_a=this.selectedList;_i<_a.length;_i++){var v=_a[_i];if(v[gridIdx]!=undefined){if(count>0){v[gridIdx]=count}else{var index=this.selectedList.indexOf(v);this.selectedList.splice(index,1);this.itemList.selectedIndex=-1}newSelect=false;break}}if(newSelect&&this.selectedList.length<this.sendGiftMaxGroup&&count>0){var obj={};obj[gridIdx]=count;this.selectedList.push(obj)}this.textSelectCount.text=count.toString();if(count==0){this.textSelectCount.text=""}this.updateItemList()};MijiGiveWin.prototype.updateSelectState=function(){var len=this.selectedList.length;var color=6003669;this.labelSelected.text=len.toString()+"/"+this.sendGiftMaxGroup;if(len>=this.sendGiftMaxGroup){color=16711680}this.labelSelected.textColor=color};MijiGiveWin.prototype.getSelectCount=function(gridIdx){if(gridIdx===void 0){gridIdx=0}var c=0;for(var _i=0,_a=this.selectedList;_i<_a.length;_i++){var v=_a[_i];if(v[gridIdx]){c=v[gridIdx];break}}return c};MijiGiveWin.prototype.onSelected=function(gridIdx,data){if(gridIdx===void 0){gridIdx=0}var self=this;if(self.selectedList.length>=self.sendGiftMaxGroup&&!data["selected"]){this.itemList.selectedIndex=-1;return}var count=data["item"]["count"];if(!data["selected"]){data["selected"]=true;data["selCount"]=count;self.setSelectCount(gridIdx,count)}else{var sc=self.getSelectCount(gridIdx);self.textSelectCount.text=sc.toString();self.updateItemList()}};MijiGiveWin.prototype.clearData=function(){this.itemList.selectedIndex=-1;this.selectedList=[]};MijiGiveWin.prototype.onItemTap=function(e){var data=this.itemList.dataProvider.getItemAt(e.itemIndex);this.itemList.selectedIndex=e.itemIndex;this.onSelected(e.itemIndex,data)};MijiGiveWin.prototype.removeSelectGive=function(e){var grid=e.data;this.setSelectCount(grid,0);this.itemList.selectedIndex=-1};MijiGiveWin.prototype.addNum=function(){var self=this;var i=self.itemList.selectedIndex;if(i<0){self.clearCount();return}var data=this.itemList.dataProvider.getItemAt(i);var curNum=stringToNum(self.textSelectCount.text);if(curNum<data["item"]["count"]){curNum++}self.setSelectCount(i,curNum)};MijiGiveWin.prototype.subNum=function(){var self=this;var i=self.itemList.selectedIndex;if(i<0){self.clearCount();return}var data=this.itemList.dataProvider.getItemAt(i);var curNum=stringToNum(self.textSelectCount.text);if(curNum>1){curNum--}else{curNum=data["item"]["count"]}self.setSelectCount(i,curNum)};MijiGiveWin.prototype.clearTxt=function(e){if(this.first){this.textReceiverName.text=""}this.first=false};MijiGiveWin.prototype.onTxtChange=function(e){var self=this;var i=self.itemList.selectedIndex;if(i<0){self.clearCount();return}var data=this.itemList.dataProvider.getItemAt(i);var curNum=stringToNum(self.textSelectCount.text);if(curNum>data["item"]["count"]){curNum=data["item"]["count"]}self.setSelectCount(i,curNum)};MijiGiveWin.prototype.clearCount=function(){var self=this;if(self.gridDataArr.length<=0){WarnWin.show(i18n("MijiGiveWin_10"),function(){},this)}else{WarnWin.show(i18n("MijiGiveWin_11"),function(){},this)}this.textSelectCount.text=""};return MijiGiveWin}(BaseEuiView);__reflect(MijiGiveWin.prototype,"MijiGiveWin");ViewManager.ins().reg(MijiGiveWin,LayerManager.UI_Popup);var MijiLearnItemRenderer=function(_super){__extends(MijiLearnItemRenderer,_super);function MijiLearnItemRenderer(){var _this=_super.call(this)||this;_this.skinName="MijiLearnItemSkin";return _this}MijiLearnItemRenderer.prototype.dataChanged=function(){var obj=this.data;this.item.data=obj["item"];this.imgSelected.visible=obj["isCurSelect"];if(obj["isLock"]){this.label.visible=true;this.label.text=i18n("MijiLearnItemRenderer_0")}else if(obj["islearn"]){this.label.visible=true;this.label.text=i18n("MijiLearnItemRenderer_1")}else if(obj["isBound"]){this.label.visible=true;this.label.text=i18n("MijiLearnItemRenderer_2")}else this.label.visible=false};return MijiLearnItemRenderer}(BaseItemRender);__reflect(MijiLearnItemRenderer.prototype,"MijiLearnItemRenderer");var MijiLearnWin=function(_super){__extends(MijiLearnWin,_super);function MijiLearnWin(){var _this=_super.call(this)||this;_this.curSelIndex=0;_this.skinName="MijiLearnSkin";return _this}MijiLearnWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.itemList.itemRenderer=MijiLearnItemRenderer;this.itemScroller.viewport=this.itemList;this.isTopLevel=true;this.link.textFlow=(new egret.HtmlTextParser).parser(i18n("MijiLearnWin_0"))};MijiLearnWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.roleIndex=param[0];this.grid=param[1];this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.addTouchEvent(this.smeltBtn,this.onTap);this.addTouchEvent(this.link,this.onTap);this.observe(UserBag.ins().postItemAdd,this.updateItem);this.observe(UserBag.ins().postItemDel,this.updateItem);this.observe(UserBag.ins().postItemChange,this.updateItem);this.clearData();this.updateItem(true)};MijiLearnWin.prototype.sortFun=function(aItem,bItem){var ins=UserMiji.ins();var aid=MiJiSkillConfig.getSkillIDByItem(aItem.configID);var bid=MiJiSkillConfig.getSkillIDByItem(bItem.configID);if(ins.hasSpecificSkillOfRole(this.roleIndex,aid)==true)return-1;if(ins.hasSpecificSkillOfRole(this.roleIndex,bid)==true)return 1;var aCfg=GlobalConfig.MiJiSkillConfig[aid];if(aCfg==null){WarnWin.show("mijiSkillId: "+aid.toString()+i18n("MijiLearnWin_1"),function(){},undefined,undefined,undefined,"sure")}var bCfg=GlobalConfig.MiJiSkillConfig[bid];if(bCfg==null){WarnWin.show("mijiSkillId: "+bid.toString()+i18n("MijiLearnWin_2"),function(){},undefined,undefined,undefined,"sure")}var a=aCfg.id;var b=bCfg.id;var aColor=UserMiji.ins().getMijiColor(a);var bColor=UserMiji.ins().getMijiColor(b);var aLevel=UserMiji.ins().getMijiLevel(a);var bLevel=UserMiji.ins().getMijiLevel(b);var aBound=UserMiji.ins().isMiJiIdBound(a);var bBound=UserMiji.ins().isMiJiIdBound(b);if(aBound&&!bBound)return-1;if(!aBound&&bBound)return 1;if(aColor<bColor)return 1;if(aColor>bColor)return-1;if(aLevel<bLevel)return 1;if(aLevel>bLevel)return-1;if(aItem.configID<bItem.configID)return 1;if(aItem.configID>bItem.configID)return-1;return 0};MijiLearnWin.prototype.updateItem=function(autoSet){if(autoSet===void 0){autoSet=false}var arr=UserBag.ins().getBagGoodsByType(2);arr.sort(this.sortFun.bind(this));var learnAry=[];var j=0;for(var i=0;i<arr.length;i++){var id=MiJiSkillConfig.getSkillIDByItem(arr[i].configID);var obj=new Object;obj["islearn"]=UserMiji.ins().hasSpecificSkillOfRole(this.roleIndex,id);if(!obj["islearn"]){obj["isLock"]=UserMiji.ins().mijiIsLock(this.roleIndex,id);obj["isBound"]=UserMiji.ins().isMiJiIdBound(id);obj["item"]=arr[i];obj["isCurSelect"]=j==this.curSelIndex;if(obj["isCurSelect"]){console.log("obj[isCurSelect]")}learnAry.push(obj);j++}}if(!this.dataArr){this.dataArr=new eui.ArrayCollection(learnAry)}else{this.dataArr.replaceAll(learnAry)}this.itemList.dataProvider=this.dataArr;if(autoSet&&learnAry.length){this.setData(learnAry[0].item);this.itemList.selectedIndex=0}};MijiLearnWin.prototype.setData=function(data){this.curItemData=data;this.mijiLearnIcon.data=MiJiSkillConfig.getSkillIDByItem(data.configID);var color=ItemConfig.getQualityColor(data.itemConfig).toString(16);this.mijiName.textFlow=(new egret.HtmlTextParser).parser("<font color='#"+color+"'>"+data.itemConfig.name+"</font>");this.mijiName.strokeColor=ItemConfig.getQualityStrokeColor(data.itemConfig);var str=UserMiji.ins().replaceDec(data.itemConfig.desc,data.configID);this.info.textFlow=TextFlowMaker.generateTextFlow1(str);this.mijiLearnIcon.visible=true;var id=MiJiSkillConfig.getSkillIDByItem(data.configID);var isLearn=UserMiji.ins().hasSpecificSkillOfRole(this.roleIndex,id);this.smeltBtn.enabled=!isLearn;if(UserMiji.ins().mijiIsLock(this.roleIndex,id)){this.smeltBtn.label=i18n("MijiLearnWin_3");this.smeltBtn.enabled=false}else this.smeltBtn.label=isLearn?i18n("MijiLearnWin_4"):i18n("MijiLearnWin_5");this.curName=data.itemConfig.name};MijiLearnWin.prototype.clearData=function(){this.itemList.selectedIndex=-1;this.mijiLearnIcon.visible=false;this.mijiLearnIcon.data=null;this.info.text="";this.curName="";this.mijiName.text=""};MijiLearnWin.prototype.onItemTap=function(e){this.curSelIndex=e.itemIndex;var data=this.itemList.dataProvider.getItemAt(e.itemIndex);this.setData(data["item"]);this.updateItem(false)};MijiLearnWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.smeltBtn:if(this.mijiLearnIcon.data<=0){UserTips.ins().showTips(i18n("MijiLearnWin_6"));return}var id_7=this.mijiLearnIcon.data;var self=this;var setMiji=function(){UserMiji.ins().sendSetMiji(self.roleIndex,self.grid,id_7);self.clearData();ViewManager.ins().close(self)};var unbound=!UserMiji.ins().isMiJiIdBound(id_7);if(unbound&&UserMiji.ins().getMijiColor(id_7)==1){WarnWin.show(i18n("MijiLearnWin_7"),function(){setMiji()},this,function(){},this)}else{setMiji()}break;case this.link:ViewManager.ins().close(this);UserWarn.ins().setBuyGoodsWarn(200099,1);break}};MijiLearnWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.itemList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.removeTouchEvent(this.smeltBtn,this.onTap);this.removeTouchEvent(this.link,this.onTap);this.removeObserve()};return MijiLearnWin}(BaseEuiView);__reflect(MijiLearnWin.prototype,"MijiLearnWin");ViewManager.ins().reg(MijiLearnWin,LayerManager.UI_Main);var MijiLevelDescItemRenderer=function(_super){__extends(MijiLevelDescItemRenderer,_super);function MijiLevelDescItemRenderer(){var _this=_super.call(this)||this;_this.skinName="MijiLevelDescItem";return _this}MijiLevelDescItemRenderer.prototype.dataChanged=function(){var data=this.data;if(data){this.info.text=data.info.text;if(data.info.red){this.info.textColor=16711680}else{this.info.textColor=6003669}}};return MijiLevelDescItemRenderer}(BaseItemRender);__reflect(MijiLevelDescItemRenderer.prototype,"MijiLevelDescItemRenderer");var MijiLevelTipWin=function(_super){__extends(MijiLevelTipWin,_super);function MijiLevelTipWin(){return _super.call(this)||this}MijiLevelTipWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="MijiLevelTipSkin";this.isTopLevel=true};MijiLevelTipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.minLevel=param[0];var config=GlobalConfig.MiJiNewLevelAdditionConfig;var arr=[];var ci=0;for(ci=0;ci<9999;++ci){if(!(ci in config)){break}}for(var i=0;i<ci;++i){var c=config[i];if(i>0){arr.push({info:{text:i.toString()+i18n("MijiLevelTipWin_0")+c.blueAddition.toString()+i18n("MijiLevelTipWin_1")+c.purpleAddition+"%",red:this.minLevel==i}})}}var dp=new eui.ArrayCollection(arr);this.infoList.itemRenderer=MijiLevelDescItemRenderer;this.infoList.dataProvider=dp;this.infoList.visible=false;var self=this;if(this.minLevel>6&&this.minLevel<999){setTimeout(function(){var h=self.scroller.height;var scrollV=self.minLevel*26-h/2;self.scroller.viewport.scrollV=scrollV;self.infoList.visible=true},100)}else{self.infoList.visible=true}this.addTouchEvent(this.colorCanvas,this.onClose)};MijiLevelTipWin.prototype.onClose=function(e){ViewManager.ins().close(this)};MijiLevelTipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onClose)};return MijiLevelTipWin}(BaseEuiView);__reflect(MijiLevelTipWin.prototype,"MijiLevelTipWin");ViewManager.ins().reg(MijiLevelTipWin,LayerManager.UI_Popup);var MijiLockWin=function(_super){__extends(MijiLockWin,_super);function MijiLockWin(){var _this=_super.call(this)||this;_this.curRole=0;_this.selItem=0;_this.isFirst=true;_this.GRIDNUMBER=10;_this.skinName="MijiLockSkin";return _this}MijiLockWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.mijiBtns=[this.mijiBtn0,this.mijiBtn1,this.mijiBtn2,this.mijiBtn3,this.mijiBtn4,this.mijiBtn5,this.mijiBtn6,this.mijiBtn7];this.link.textFlow=(new egret.HtmlTextParser).parser(i18n("MijiLockWin_0"))};MijiLockWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.isFirst=true;this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.smeltBtn,this.onTap);this.addTouchEvent(this.link,this.onTap);this.addChangeEvent(this.roleSelect,this.onChange);this.addTouchEndEvent(this.otherRect,this.otherClose);for(var a in this.mijiBtns){this.addTouchEvent(this.mijiBtns[a],this.onTap)}this.observe(UserMiji.ins().postMijiLockInfo,this.setData);if(param[0]==UserMiji.BAGOPEN){this.bagSelectIndex()}else{this.roleSelect.setCurRole(isNaN(param[0])?0:param[0]);this.selItem=this.getindex(isNaN(param[0])?0:param[0])}this.setCurRole(this.roleSelect.getCurRole())};MijiLockWin.prototype.otherClose=function(evt){ViewManager.ins().close(this)};MijiLockWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}};MijiLockWin.prototype.onChange=function(e){var roleId=this.roleSelect.getCurRole();if(!this.isFirst)this.selItem=this.getindex(roleId);this.isFirst=false;this.setCurRole(roleId)};MijiLockWin.prototype.setCurRole=function(roleId){this.curRole=roleId;this.setData()};MijiLockWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.smeltBtn:var mijiData=this.mijiBtns[this.selItem].data;if(mijiData.isLocked){UserMiji.ins().sendMijiDelLock(this.curRole,mijiData.id);return}UserMiji.ins().sendMijiAddLock(this.curRole,mijiData.id);break;case this.link:UserWarn.ins().setBuyGoodsWarn(GlobalConfig.MijiBaseConfig.lockId,1);break;default:var index=this.mijiBtns.indexOf(e.target.parent);var data=this.mijiBtns[index].data;if(!this.mijiBtns[index]||!data)return;if(data.id==0){UserTips.ins().showCenterTips(i18n("MijiLockWin_1"));return}this.selItem=index;var ins=UserMiji.ins();if(!ins.grid||this.selItem>=ins.grid[this.curRole]){UserTips.ins().showTips(i18n("MijiLockWin_2"));return}this.updateBtnState();break}};MijiLockWin.prototype.updateBtnState=function(){for(var i=0;i<this.mijiBtns.length;i++){this.mijiBtns[i].setSelected(false)}this.labCount.text="";this.link.visible=false;var num=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.MijiBaseConfig.lockId);var isHas=num>0;if(isHas){this.labCount.text=i18n("MijiLockWin_3",num)}this.link.visible=!isHas;if(this.selItem<0){this.smeltBtn.label=i18n("MijiLockWin_4");this.smeltBtn.enabled=false;return}this.mijiBtns[this.selItem].setSelected(true);var mijiData=this.mijiBtns[this.selItem].data;if(mijiData.isLocked){this.smeltBtn.label=i18n("MijiLockWin_5");this.smeltBtn.enabled=true}else{this.smeltBtn.label=i18n("MijiLockWin_6");this.smeltBtn.enabled=isHas}};MijiLockWin.prototype.setData=function(){var ins=UserMiji.ins();var showSetCount=true;for(var i=0;i<this.GRIDNUMBER;i++){if(ErrorLog.Assert(ins.miji,"MijiPanel   data.miji is null")){this.mijiBtns[i].data=null}else{var numList=ins.miji[this.curRole];if(ErrorLog.Assert(numList,"MijiPanel   numList "+"is null  roleId = "+this.curRole)){this.mijiBtns[i].data=null}else{this.mijiBtns[i].data=!numList[i]?null:numList[i];if(numList[i]&&numList[i].id==0)this.mijiBtns[i].setUnlearn(true);else this.mijiBtns[i].setUnlearn(false);if(!numList[i]){if(showSetCount){this.mijiBtns[i].setCountLabel(i);showSetCount=false}}}}}this.updateBtnState()};MijiLockWin.prototype.getindex=function(roleId){var numList=UserMiji.ins().miji[roleId];for(var i=0;i<numList.length;i++){if(numList[i].id!=0)return i}return-1};MijiLockWin.prototype.bagSelectIndex=function(){var role=0;var b=false;this.selItem=0;var len=SubRoles.ins().subRolesLen;for(var i=0;i<len;i++){var numList=UserMiji.ins().miji[i];for(var j=0;j<numList.length;j++){if(numList[j].id!=0&&numList[j].isLocked==0){role=i;this.selItem=j;b=true;break}}if(b)break}this.roleSelect.setCurRole(role)};return MijiLockWin}(BaseEuiView);__reflect(MijiLockWin.prototype,"MijiLockWin");ViewManager.ins().reg(MijiLockWin,LayerManager.UI_Popup);var MijiTipWin=function(_super){__extends(MijiTipWin,_super);function MijiTipWin(){return _super.call(this)||this}MijiTipWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="MijiTipSkin";this.isTopLevel=true};MijiTipWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.item.data=param[0].id;this.roleid=param[1];this.grid=param[2];var itemID=GlobalConfig.MiJiSkillConfig[param[0].id].item;var data=GlobalConfig.ItemConfig[itemID];var str=UserMiji.ins().replaceDec(data.desc,itemID);this.info.textFlow=TextFlowMaker.generateTextFlow1(data.name+"\n\n"+str);var powertext=this.CalcMijiPower(param[0].id)+GlobalConfig.MiJiSkillConfig[param[0].id].power;this.power.text=i18n("MijiTipWin_0")+powertext;var mijiId=GlobalConfig.MiJiSkillConfig[param[0].id].id;this.labelBind.text=UserMiji.ins().isMiJiIdBound(mijiId)?i18n("MijiTipWin_1"):i18n("MijiTipWin_2");this.addTouchEvent(this,this.onClose);this.addTouchEvent(this.removeBtn,this.onRemoveBtn)};MijiTipWin.prototype.CalcMijiPower=function(mijiId){var old_id=mijiId%1e3;var mijiAttrType=Math.floor(old_id/10);var mod=old_id%10;var powerConfig=GlobalConfig.AttrPowerConfig;var config=null;var config2=null;var val=null;var val2=null;var mijiAttrpower=0;switch(mijiAttrType){case 1:config=powerConfig[AttributeType.atMaxHp];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 2:config=powerConfig[AttributeType.atAttack];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 3:config=powerConfig[AttributeType.atDef];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;config2=powerConfig[AttributeType.atRes];val2=GlobalConfig.MiJiSkillConfig[mijiId].p2;val=val+val2;break;case 4:config=powerConfig[AttributeType.atCrit];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 5:config=powerConfig[AttributeType.atDamageReduction];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 6:config=powerConfig[AttributeType.atCritEnhance];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 7:config=powerConfig[AttributeType.atPenetrate];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 9:config=powerConfig[AttributeType.atAtkEx];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break;case 12:config=powerConfig[AttributeType.atRegeneration];val=GlobalConfig.MiJiSkillConfig[mijiId].p1;break}if(val&&config){mijiAttrpower=val*config.power/100}return mijiAttrpower};MijiTipWin.prototype.onClose=function(e){ViewManager.ins().close(this)};MijiTipWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this,this.onClose);this.removeTouchEvent(this.removeBtn,this.onRemoveBtn)};MijiTipWin.prototype.onRemoveBtn=function(e){UserMiji.ins().sendUnsetMiji(this.roleid,this.grid);ViewManager.ins().close(this)};return MijiTipWin}(BaseEuiView);__reflect(MijiTipWin.prototype,"MijiTipWin");ViewManager.ins().reg(MijiTipWin,LayerManager.UI_Main);var MiJiTujianWin=function(_super){__extends(MiJiTujianWin,_super);function MiJiTujianWin(){return _super.call(this)||this}MiJiTujianWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="MijiPhotoSkin";this.mijiList.itemRenderer=ItemBaseNoTap;this.isTopLevel=true};MiJiTujianWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.mijiList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.addTouchEvent(this.mijiOpen,this.onTap);this.updateData()};MiJiTujianWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.mijiList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.removeTouchEvent(this.mijiOpen,this.onTap)};MiJiTujianWin.prototype.updateData=function(){this.mijiOpen.textFlow=(new egret.HtmlTextParser).parser(i18n("MiJiTujianWin_0"));var mijiAry=[];for(var _i=0,_a=GlobalConfig.ItemConfig;_i<_a.length;_i++){var config=_a[_i];if(ItemConfig.getType(config)==2){mijiAry.push(config.id)}}this.mijiList.dataProvider=new eui.ArrayCollection(mijiAry);if(mijiAry.length){this.setData(mijiAry[0]);this.mijiList.selectedIndex=0}};MiJiTujianWin.prototype.onItemTap=function(e){var data=this.mijiList.dataProvider.getItemAt(e.itemIndex);this.setData(data)};MiJiTujianWin.prototype.setData=function(data){var itemConfig=GlobalConfig.ItemConfig[data];this.mijiIcon.setData(itemConfig);var color=ItemConfig.getQualityColor(itemConfig).toString(16);var str=UserMiji.ins().replaceDec(itemConfig.desc,data);this.info.textFlow=(new egret.HtmlTextParser).parser("<font color='#"+color+"'>"+itemConfig.name+"</font>\n"+str);this.info.strokeColor=ItemConfig.getQualityStrokeColor(itemConfig);this.mijiIcon.visible=true;var miji=10;for(var _i=0,_a=GlobalConfig.MiJiSkillConfig;_i<_a.length;_i++){var config=_a[_i];if(config.item==data){miji=config.id}}this.power.text=i18n("MiJiTujianWin_1")+GlobalConfig.MiJiSkillConfig[miji].power};MiJiTujianWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.mijiOpen:ViewManager.ins().close(this);UserWarn.ins().setBuyGoodsWarn(200099,1);break}};return MiJiTujianWin}(BaseEuiView);__reflect(MiJiTujianWin.prototype,"MiJiTujianWin");ViewManager.ins().reg(MiJiTujianWin,LayerManager.UI_Main);var MijiZhItemRenderer=function(_super){__extends(MijiZhItemRenderer,_super);function MijiZhItemRenderer(){var _this=_super.call(this)||this;var self=_this;_this.skinName="MijiZhItemSkin";_this.touchChildren=true;return _this}MijiZhItemRenderer.prototype.dataChanged=function(){var obj=this.data;this.item.data=obj["item"];if(obj["selCount"]>0){this.item.count.text=obj["selCount"].toString()+"/"+this.item.data.count.toString()}else{this.item.count.text=this.item.data.count.toString()}if(obj["isBound"]){this.label.visible=true;this.label.text=i18n("MijiZhItemRenderer_0")}else this.label.visible=false;this.imgSelected.visible=obj["isCurSelect"]};return MijiZhItemRenderer}(BaseItemRender);__reflect(MijiZhItemRenderer.prototype,"MijiZhItemRenderer");var MijiZhWin=function(_super){__extends(MijiZhWin,_super);function MijiZhWin(){var _this=_super.call(this)||this;_this.curSelectedItemId=0;_this.dataArr=null;_this.isSmeltING=false;_this.autoSmelt=false;_this.cancelAuto=false;return _this}MijiZhWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="MijiZhSkin";this.itemList.itemRenderer=MijiZhItemRenderer;this.itemScroller.viewport=this.itemList;this.touchChildren=true;this.mijiItem0.touchEnabled=true;this.mijiItem0.touchChildren=true;this.mijiItem0.addImgEnabled=false;this.mijiItem1.touchEnabled=true;this.mijiItem1.touchChildren=true;this.mijiItem1.addImgEnabled=false;this.mijiItem2.touchEnabled=true;this.mijiItem2.touchChildren=true;this.mijiItem2.addImgEnabled=false;this.mijiItem3.addImgEnabled=false;this.mcEff1=new MovieClip;this.mcEff1.x=20+43;this.mcEff1.y=60+39;this.mcEff2=new MovieClip;this.mcEff2.x=153;this.mcEff2.y=60+39;this.mcEff3=new MovieClip;this.mcEff3.x=243;this.mcEff3.y=60+39;this.nameArr=[];this.isTopLevel=true;this.tips.visible=false;var self=this;LoginMgr.getItem("isFirstMijiZh",function(res){if(res!="no"){LoginMgr.setItem("isFirstMijiZh","no");self.onBtnHelp()}});if(!UserVip.ins().canSmeltAll()){this.limitTxt.text="尊者"+GlobalConfig.PrivilegeData.autoSynthetise+i18n("MijiZhWin_0")}else{this.limitTxt.text=""}};MijiZhWin.prototype.onItemClick=function(itemData,isAuto){if(isAuto===void 0){isAuto=false}if(this.mijiItem0.data&&this.mijiItem1.data&&this.mijiItem2.data){return}if(this.isSmeltING||this.autoSmelt){if(!isAuto){return}}if(isAuto){if(!this.autoSmelt){return}}var count=itemData.count;var id=MiJiSkillConfig.getSkillIDByItem(itemData.configID);if(this.mijiItem0.data==id)count--;if(this.mijiItem1.data==id)count--;if(this.mijiItem2.data==id)count--;var str=i18n("MijiZhWin_1");if(count<=0){UserTips.ins().showTips(str);this.curSelectedItemId=itemData.itemConfig.id;return}if(!this.mijiItem0.data){this.mijiItem0.data=id;this.nameArr[0]=itemData.itemConfig.name}else if(!this.mijiItem1.data){this.mijiItem1.data=id;this.nameArr[1]=itemData.itemConfig.name}else if(!this.mijiItem2.data){this.mijiItem2.data=id;this.nameArr[2]=itemData.itemConfig.name}this.mijiItem3.data="";this.curSelectedItemId=itemData.itemConfig.id;this.updateItem()};MijiZhWin.prototype.onItemTap=function(e){var itemData=e.item.item;this.onItemClick(itemData)};MijiZhWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addTouchEvent(this.smeltBtn,this.onTap);this.addTouchEvent(this.smeltAllBtn,this.onTap);this.addTouchEvent(this.mijiItem0,this.onTap);this.addTouchEvent(this.mijiItem1,this.onTap);this.addTouchEvent(this.mijiItem2,this.onTap);this.addTouchEvent(this.mijiItem3,this.onTap);this.addTouchEvent(this.bgClose,this.onTap);this.addTouchEvent(this.btnHelp,this.onBtnHelp);this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.observe(UserBag.ins().postItemAdd,this.updateItem);this.observe(UserBag.ins().postItemDel,this.updateItem);this.observe(UserBag.ins().postItemChange,this.updateItem);this.observe(UserMiji.ins().postMijiChange,this.showResult);this.clearData();this.updateItem()};MijiZhWin.prototype.onBtnHelp=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[42].text)};MijiZhWin.prototype.sortFun=function(aItem,bItem){var aCfg=GlobalConfig.MiJiSkillConfig[aItem.mijiID];if(aCfg==null){WarnWin.show("mijiSkillId: "+aItem.mijiID.toString()+i18n("MijiZhWin_2"),function(){},undefined,undefined,undefined,"sure")}var bCfg=GlobalConfig.MiJiSkillConfig[bItem.mijiID];if(bCfg==null){WarnWin.show("mijiSkillId: "+bItem.mijiID.toString()+i18n("MijiZhWin_3"),function(){},undefined,undefined,undefined,"sure")}var a=aCfg.id;var b=bCfg.id;var aColor=UserMiji.ins().getMijiColor(a);var bColor=UserMiji.ins().getMijiColor(b);var aLevel=UserMiji.ins().getMijiLevel(a);var bLevel=UserMiji.ins().getMijiLevel(b);var aBound=UserMiji.ins().isMiJiIdBound(a);var bBound=UserMiji.ins().isMiJiIdBound(b);if(aColor<bColor)return-1;if(aColor>bColor)return 1;if(aLevel<bLevel)return-1;if(aLevel>bLevel)return 1;if(aBound&&!bBound)return-1;if(!aBound&&bBound)return 1;if(aItem.configID<bItem.configID)return-1;if(aItem.configID>bItem.configID)return 1;return 0};MijiZhWin.prototype.updateItem=function(){var self=this;var arr=UserBag.ins().getBagGoodsByType(2);var datas=[];var selectedIds=[this.mijiItem0.data,this.mijiItem1.data,this.mijiItem2.data];for(var i=0;i<arr.length;i++){var item=arr[i];var sID=MiJiSkillConfig.getSkillIDByItem(item.itemConfig.id);var selCount=0;for(var _i=0,selectedIds_1=selectedIds;_i<selectedIds_1.length;_i++){var selectedId=selectedIds_1[_i];if(selectedId==sID){selCount++}}var isCurSelect=false;var id=MiJiSkillConfig.getSkillIDByItem(item.itemConfig.id);if(this.mijiItem0.data==id||this.mijiItem1.data==id||this.mijiItem2.data==id){isCurSelect=true}var isBound=UserMiji.ins().isMiJiIdBound(id);datas.push({item:item,isCurSelect:isCurSelect,mijiID:sID,selCount:selCount,isBound:isBound})}datas.sort(this.sortFun);if(this.dataArr){this.dataArr.replaceAll(datas)}else{var d=new eui.ArrayCollection(datas);this.dataArr=d}this.itemList.dataProvider=this.dataArr};MijiZhWin.prototype.getItemPos=function(i){var x=i%4*(90+10);var y=Math.floor(i/4)*108;var pos={x:x,y:y};return pos};MijiZhWin.prototype.clearData=function(){this.itemList.selectedIndex=-1;this.mijiItem0.data="";this.mijiItem1.data="";this.mijiItem2.data="";this.mijiItem3.data=""};MijiZhWin.prototype.playEffect=function(){this.mcEff1.playFile(RES_DIR_EFF+"forgeSuccess",1);this.anigroup.addChild(this.mcEff1);this.mcEff2.playFile(RES_DIR_EFF+"forgeSuccess",1);this.anigroup.addChild(this.mcEff2);this.mcEff3.playFile(RES_DIR_EFF+"forgeSuccess",1);this.anigroup.addChild(this.mcEff3)};MijiZhWin.prototype.hasEnoughXianYu=function(){var dataProvider=this.itemList.dataProvider;var has=false;for(var i=0;i<dataProvider.length;i++){var data=dataProvider.getItemAt(i);var item=data.item;if(item.count>=3){has=true;break}}return has};MijiZhWin.prototype.startAutoMelt=function(){if(!this.autoSmelt){return}var dataProvider=this.itemList.dataProvider;var has=false;for(var i=0;i<dataProvider.length;i++){var data=dataProvider.getItemAt(i);var item=data.item;if(item.count>=3){has=true;this.smelt(item);break}}if(!has){this.cancelAutoMelt()}};MijiZhWin.prototype.smelt=function(item){if(item===void 0){item=null}if(!item){return}if(item.count<3){return}this.mijiItem0.data="";this.mijiItem1.data="";this.mijiItem2.data="";var self=this;this.isSmeltING=true;TimerManager.ins().doTimer(1,1,function(){self.onItemClick(item,true)},this);TimerManager.ins().doTimer(1e3,1,function(){self.onItemClick(item,true)},this);TimerManager.ins().doTimer(2e3,1,function(){self.onItemClick(item,true)},this);TimerManager.ins().doTimer(3e3,1,function(){self.onSmeltBtnClick(true)},this)};MijiZhWin.prototype.onSmeltBtnClick=function(isAuto){if(isAuto===void 0){isAuto=false}if(!isAuto){if(this.autoSmelt){UserTips.ins().showTips(i18n("MijiZhWin_5"));return}}if(isAuto){if(!this.autoSmelt){return}}if(!this.mijiItem0.data||!this.mijiItem1.data||!this.mijiItem2.data){UserTips.ins().showTips(i18n("MijiZhWin_6"));return}var self=this;var skillID1=this.mijiItem0.data;var skillID2=this.mijiItem1.data;var skillID3=this.mijiItem2.data;if(this.autoSmelt){UserMiji.ins().sendMijiChange(skillID1,skillID2,skillID3);this.clearData();this.playEffect();return}var str="";var name0=this.nameArr[0];var name1=this.nameArr[1];var name2=this.nameArr[2];if(this.nameArr[0]==this.nameArr[1]&&this.nameArr[1]==this.nameArr[2]){str=i18n("MijiZhWin_7",name0)}else{str=i18n("MijiZhWin_8",name0,name1,name2)}var fuc=function(str){WarnWin.show(str,function(){skillID1;skillID2;skillID3;UserMiji.ins().sendMijiChange(skillID1,skillID2,skillID3);self.clearData();self.playEffect()},this)};var fuc1=function(){var str2=i18n("MijiZhWin_9");WarnWin.show(str2,function(){setTimeout(function(){fuc(str)},2)},this)};var isBound1=UserMiji.ins().isMiJiIdBound(skillID1);var isBound2=UserMiji.ins().isMiJiIdBound(skillID2);var isBound3=UserMiji.ins().isMiJiIdBound(skillID3);if(isBound1||isBound2||isBound3){fuc1()}else{fuc(str)}};MijiZhWin.prototype.onTap=function(e){var self=this;switch(e.currentTarget){case this.smeltAllBtn:if(this.autoSmelt){this.cancelAutoMelt()}else{if(!UserVip.ins().canSmeltAll()){var tip="尊者"+GlobalConfig.PrivilegeData.autoSynthetise+i18n("MijiZhWin_10");WarnWin.show(tip,function(){ViewManager.ins().open(VipWin)},this);this.autoSmelt=false;this.autoTxt.visible=false}else{if(this.hasEnoughXianYu()){WarnWin.show(i18n("MijiZhWin_11"),function(){self.autoSmelt=true;self.autoTxt.visible=true;self.smeltAllBtn.label=i18n("MijiZhWin_12");self.startAutoMelt()},this)}else{UserTips.ins().showTips(i18n("MijiZhWin_13"))}}}break;case this.smeltBtn:this.onSmeltBtnClick();break;case this.closeBtn:case this.closeBtn0:case this.bgClose:ViewManager.ins().close(this);break;case this.mijiItem0:case this.mijiItem1:case this.mijiItem2:e.currentTarget.data="";this.updateItem();break;case this.mijiItem3:if(this.mijiItem3&&this.mijiItem3.data){var tempData=GlobalConfig.MiJiSkillConfig[this.mijiItem3.data];if(tempData){var tempItem=UserBag.ins().getBagItemById(tempData.item);if(tempItem)ViewManager.ins().open(ItemDetailedWin,0,tempItem.itemConfig.id,tempItem.count)}}break}};MijiZhWin.prototype.showResult=function(params){var itemID=params[0];var isBoom=params[1];var levelUp=params[2];this.mijiItem3.data=MiJiSkillConfig.getSkillIDByItem(itemID);if(isBoom){showFadeOutTips(this.tips,this.tipsLabel,i18n("MijiZhWin_15"),256)}else if(levelUp>0){var sidx=levelUp-1;if(sidx>2){sidx=2}var strs=[i18n("MijiZhWin_16"),i18n("MijiZhWin_17"),i18n("MijiZhWin_18")];var s=strs[sidx];s=s.replace("LEVEL",levelUp.toString());showFadeOutTips(this.tips,this.tipsLabel,s,256)}this.isSmeltING=false;if(this.cancelAuto){this.cancelAutoMelt()}if(this.autoSmelt){TimerManager.ins().doTimer(1600,1,this.startAutoMelt,this)}};MijiZhWin.prototype.cancelAutoMelt=function(){this.isSmeltING=false;this.autoSmelt=false;this.cancelAuto=false;this.smeltAllBtn.label=i18n("MijiZhWin_19");this.autoTxt.visible=false};MijiZhWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap);this.removeTouchEvent(this.smeltBtn,this.onTap);this.itemList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);this.removeTouchEvent(this.mijiItem0,this.onTap);this.removeTouchEvent(this.mijiItem1,this.onTap);this.removeTouchEvent(this.mijiItem2,this.onTap);this.removeObserve();DisplayUtils.removeFromParent(this.mcEff1);DisplayUtils.removeFromParent(this.mcEff2);DisplayUtils.removeFromParent(this.mcEff3);TimerManager.ins().removeAll(this)};return MijiZhWin}(BaseEuiView);__reflect(MijiZhWin.prototype,"MijiZhWin");ViewManager.ins().reg(MijiZhWin,LayerManager.UI_Popup);var XianYuEffectItem=function(_super){__extends(XianYuEffectItem,_super);function XianYuEffectItem(){var _this=_super.call(this)||this;_this.skinName="XianyuEffectItemSkin";return _this}XianYuEffectItem.prototype.setData=function(xianyu,lv,name){if(name===void 0){name=""}this.clear();if(xianyu.length>0){var m=new MovieClip;m.x=this.eff_xianyu.width/2;m.y=this.eff_xianyu.height/2;m.playFileRes(""+RES_DIR_XIANYUEFFECT+xianyu,xianyu.toString(),-1);this.eff_xianyu.addChild(m)}if(lv.length>0){var m2=new MovieClip;m2.x=this.eff_dengji.width/2;m2.y=this.eff_dengji.height/2;m2.playFileRes(""+RES_DIR_XIANYUEFFECT+lv,lv.toString(),-1);this.eff_dengji.addChild(m2)}};XianYuEffectItem.prototype.clear=function(){this.eff_xianyu.removeChildren();this.eff_dengji.removeChildren()};return XianYuEffectItem}(BaseComponent);__reflect(XianYuEffectItem.prototype,"XianYuEffectItem");var XianYuEffecWin=function(_super){__extends(XianYuEffecWin,_super);function XianYuEffecWin(data,name,roleId,isMy){var _this=_super.call(this)||this;_this.skinName="XianYuEffectSkin";_this.mijidata=data;_this.nickname=name;_this.roleId=roleId;_this.isMy=isMy;_this.setData();_this.addEventListener();if(isMy){UserMiji.ins().sendAdditionUpdate(_this.roleId)}else{var self_19=_this;if(roleId==0){if(!UserMiji.ins().reqList[name]){_this.reqOthersMijiData(roleId,name);TimerManager.ins().removeAll(_this);TimerManager.ins().doTimer(5e3,0,function(){self_19.reqOthersMijiData(self_19.roleId,self_19.nickname)},_this);UserMiji.ins().reqList[name]=true}}}return _this}XianYuEffecWin.prototype.reqOthersMijiData=function(roleId,name){if(!name){return}if(roleId){return}UserMiji.ins().sendGetUserMijiByName(name);console.log(i18n("XianYuEffectWin_0")+name+i18n("XianYuEffectWin_1"))};XianYuEffecWin.prototype.onRemoveEntity=function(_a){var handle=_a[0],entity=_a[1];if(entity.isMy||!(entity instanceof CharRole)||this.isMy){return}if(entity&&entity.infoModel&&entity.infoModel.name&&entity.infoModel.name==this.nickname){UserMiji.ins().reqList[this.nickname]=false;TimerManager.ins().removeAll(this)}};XianYuEffecWin.prototype.addEventListener=function(){this.observe(UserMiji.ins().postMijiData,this.resetMyMiji);this.observe(UserMiji.ins().postMijiUpDate,this.resetMyMiji);this.observe(UserMiji.ins().postSetMiji,this.resetMyMiji);this.observe(UserMiji.ins().postUnsetMiji,this.resetMyMiji);this.observe(UserMiji.ins().postAdditionUpdate,this.resetMyMiji);this.observe(UserMiji.ins().postGetUserMijiByName,this.onGetOtherMiji);this.observe(GameLogic.ins().postRemoveEntity,this.onRemoveEntity)};XianYuEffecWin.prototype.onGetOtherMiji=function(params){var name=params[0];var isExists=params[1];if(isExists==0){this.clearLabel();return}var miji=params[2];var levels=params[3];if(name==this.nickname){this.mijidata=miji[this.roleId]||null;this.minNewLevel=levels[this.roleId]||0;this.setData()}};XianYuEffecWin.prototype.getZiNum=function(){return UserMiji.ins().getZiNum(this.mijidata)};XianYuEffecWin.prototype.getXianYuNum=function(){return UserMiji.ins().getXianYuNum(this.mijidata)};XianYuEffecWin.prototype.lvMapEff=function(lv){var eff="";if(this.getXianYuNum()==0){return""}if(this.getXianYuNum()>0){eff="taozhuang00"}if(this.getXianYuNum()==8){eff="taozhuang01";if(lv<=4){eff="taozhuang01"}else if(lv<=9){eff="taozhuang02"}else if(lv<=14){eff="taozhuang03"}else if(lv<=15){eff="taozhuang04"}}var ziyuNum=this.getZiNum();if(ziyuNum>=4&&eff){eff+="2"}else if(eff){eff+="1"}return eff};XianYuEffecWin.prototype.setData=function(){this.clearLabel();if(!this.mijidata){return}this.playTaoZhuangEff();this.playXianYuEff()};XianYuEffecWin.prototype.playTaoZhuangEff=function(){this.eff_taozhuang.removeChildren();var tf=this.lvMapEff(this.minNewLevel);if(tf.length>0){var m=new MovieClip;m.x=this.eff_taozhuang.width/2;m.y=this.eff_taozhuang.height/2;m.playFileRes(""+RES_DIR_XIANYUEFFECT+tf,tf,-1);this.eff_taozhuang.addChild(m)}};XianYuEffecWin.prototype.playXianYuEff=function(){for(var i=0;i<8;i++){var idx=i+1;var d=this.mijidata[i];var eff_xianyu="";var eff_lv="";var xianyu_name="";if(d){var id=d["id"];if(id>0){eff_xianyu=GlobalConfig.MiJiSkillConfig[id].eff_xianyu.toString()||"";eff_lv=GlobalConfig.MiJiSkillConfig[id].eff_lv||"";var item=GlobalConfig.MiJiSkillConfig[id].item;var itemConfig=GlobalConfig.ItemConfig[item];if(itemConfig&&UserMiji.ins().showXianyuName){xianyu_name=itemConfig.name}}}this["xianyu"+idx.toString()].setData(eff_xianyu,eff_lv,xianyu_name)}};XianYuEffecWin.prototype.resetMyMiji=function(){if(this.isMy){this.mijidata=UserMiji.ins().getSkillListOfRole(this.roleId);this.minNewLevel=UserMiji.ins().minNewLevels[this.roleId];this.setData()}};XianYuEffecWin.prototype.clearLabel=function(){for(var i=0;i<8;i++){this["xianyu"+(i+1).toString()].clear()}this.eff_taozhuang.removeChildren()};return XianYuEffecWin}(BaseComponent);__reflect(XianYuEffecWin.prototype,"XianYuEffecWin");var ZsBoss=function(_super){__extends(ZsBoss,_super);function ZsBoss(){var _this=_super.call(this)||this;_this.promptList=["",i18n("ZsBoss_0"),i18n("ZsBoss_1"),i18n("ZsBoss_2"),i18n("ZsBoss_3"),i18n("ZsBoss_4"),i18n("ZsBoss_5")];_this.firstShowWin=false;_this._clearOther=false;_this.canChange=true;_this.sysId=PackageID.ZsBoss;_this.regNetMsg(1,_this.postBossList);_this.regNetMsg(2,_this.postBossOpen);_this.regNetMsg(3,_this.postRrmainTime);_this.regNetMsg(4,_this.postRankInfo);_this.regNetMsg(5,_this.postLotteryInfo);_this.regNetMsg(7,_this.postChallengeResult);_this.regNetMsg(8,_this.postHudunPoint);_this.regNetMsg(9,_this.postWinResult);_this.regNetMsg(11,_this.doGetMyPoint);_this.regNetMsg(12,_this.doTalkMaxPoint);return _this}ZsBoss.ins=function(){return _super.ins.call(this)};ZsBoss.prototype.sendGetBossList=function(){this.sendBaseProto(1)};ZsBoss.prototype.sendRequstChallenge=function(){this.sendBaseProto(3)};ZsBoss.prototype.sendRequstBossRank=function(bossId){var bytes=this.getBytes(4);bytes.writeInt(bossId);this.sendToServer(bytes)};ZsBoss.prototype.sendJoinChoujiang=function(){this.sendBaseProto(5)};ZsBoss.prototype.sendBuyCd=function(){this.sendBaseProto(6)};ZsBoss.prototype.postBossList=function(bytes){var len=bytes.readShort();this.bossInfoList=[];for(var i=0;i<len;i++){this.bossInfoList.push(new BossInfoData(bytes))}this.aliveBossNum=bytes.readShort()};ZsBoss.prototype.getBossListLength=function(){var result=0;if(this.bossInfoList!=null){result=this.bossInfoList.length}return result};ZsBoss.prototype.getBossInfoByIndex=function(index){var result=null;if(this.bossInfoList!=null){if(index>=0&&index<this.bossInfoList.length){result=this.bossInfoList[index]}}return result};ZsBoss.prototype.postBossOpen=function(bytes){this.acIsOpen=bytes.readBoolean();if(!this.acIsOpen){this.reliveTime=0}else{if(UserZs.ins().lv>0){if(UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_WORLDBOSS]){UserBoss.ins().postBossData(true,this.canPlayBossName())}}}};ZsBoss.prototype.postRrmainTime=function(bytes){this.remainTime=bytes.readShort();this.reliveTime=bytes.readShort()};ZsBoss.prototype.postRankInfo=function(bytes){this.parseBossRankList(bytes)};ZsBoss.prototype.postLotteryInfo=function(bytes){this.lotteryItemId=bytes.readInt();ViewManager.ins().open(ZSBossLotteryWin)};ZsBoss.prototype.postChallengeResult=function(bytes){var index=bytes.readByte();if(index>0){UserTips.ins().showTips(ZsBoss.ins().promptList[index])}else if(index==0){ViewManager.ins().close(BossWin)}};ZsBoss.prototype.postHudunPoint=function(bytes){this.hudun=bytes.readInt()};ZsBoss.prototype.postWinResult=function(bytes){var infoArr=[bytes.readString(),bytes.readString(),bytes.readShort()];var len=bytes.readShort();var list=[];var item;for(var i=0;i<len;i++){item=new RewardData;item.parser(bytes);list.push(item)}ViewManager.ins().open(ZsBossResultWin,infoArr,list)};Object.defineProperty(ZsBoss.prototype,"reliveTime",{get:function(){return this._reliveTime},set:function(num){if(this._reliveTime!=num){this._reliveTime=num;TimerManager.ins().remove(this.timeClock,this);TimerManager.ins().doTimer(1e3,this._reliveTime,this.timeClock,this)}},enumerable:true,configurable:true});ZsBoss.prototype.timeClock=function(){this._reliveTime--;if(this._reliveTime<=0){TimerManager.ins().remove(this.timeClock,this)}};ZsBoss.prototype.parseBossRankList=function(bytes){this.bossRankList=[];var bossId=bytes.readInt();var len=bytes.readShort();for(var i=0;i<len;i++){this.bossRankList.push(new BossRankInfo(bytes,i+1))}};ZsBoss.prototype.getBarList=function(){if(this.barList&&this.barList.length>0){return this.barList}if(!this.barList){this.barList=[]}var config;for(var i=1;i<5;i++){config=GlobalConfig.OtherBoss1Config[i];this.barList.push(config.llimit+"-"+config.hlimit+i18n("ZsBoss_6"))}return this.barList};ZsBoss.prototype.isZsBossFb=function(fbId){var config;for(var i=1;i<5;i++){config=GlobalConfig.OtherBoss1Config[i];if(fbId==config.fbid){return true}}return false};ZsBoss.prototype.checkIsMoreMoney=function(){return Actor.yb>=GlobalConfig.WorldBossBaseConfig.clearCdCost[UserBoss.ins().currBossSubType-1]};ZsBoss.prototype.checkIsShowNoticeWin=function(){return false};ZsBoss.prototype.canPlayBossIndex=function(){var zsLv=UserZs.ins().lv;var config;for(var i=4;i>=1;i--){config=GlobalConfig.OtherBoss1Config[i];if(zsLv>=config.llimit&&zsLv<=config.hlimit){if(this.aliveBossNum>=i){return i}}}return 0};ZsBoss.prototype.canPlayBossName=function(){var index=this.canPlayBossIndex();if(index>0){var config=GlobalConfig.OtherBoss1Config[index];return GlobalConfig.MonstersConfig[config.bossId].name}return i18n("ZsBoss_7")};Object.defineProperty(ZsBoss.prototype,"clearOther",{get:function(){return this._clearOther},set:function(value){if(this._clearOther!=value){this._clearOther=value;this.canChange=false;TimerManager.ins().doTimer(1e3,10,this.overDealy,this,this.dealyOver,this)}},enumerable:true,configurable:true});ZsBoss.prototype.dealyOver=function(){TimerManager.ins().remove(this.overDealy,this);this.canChange=true};ZsBoss.prototype.overDealy=function(){};ZsBoss.prototype.doGetMyPoint=function(bytes){this.postLotteryPoint(bytes.readShort())};ZsBoss.prototype.postLotteryPoint=function(n){return n};ZsBoss.prototype.doTalkMaxPoint=function(bytes){this.postLotteryMaxPost(bytes.readString(),bytes.readShort())};ZsBoss.prototype.postLotteryMaxPost=function(str,n){return[str,n]};return ZsBoss}(BaseSystem);__reflect(ZsBoss.prototype,"ZsBoss");var BossInfoData=function(){function BossInfoData(bytes){this.bossId=bytes.readInt();this.kill=bytes.readBoolean();this.challengeIn=bytes.readBoolean()}return BossInfoData}();__reflect(BossInfoData.prototype,"BossInfoData");var BossRankInfo=function(){function BossRankInfo(bytes,ranks){this.id=bytes.readInt();this.names=bytes.readString();this.shanghai=bytes.readDouble();this.rank=ranks}return BossRankInfo}();__reflect(BossRankInfo.prototype,"BossRankInfo");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.zsBoss=ZsBoss.ins.bind(ZsBoss)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var ZSBossCDWin=function(_super){__extends(ZSBossCDWin,_super);function ZSBossCDWin(){return _super.call(this)||this}ZSBossCDWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ZSBossCDSkin";this.isTopLevel=true};ZSBossCDWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.check.selected=param[0];this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.sure,this.onTap);this.addTouchEvent(this.giveUp,this.onTap);this.addChangeEvent(this.check,this.selectChange)};ZSBossCDWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.sure,this.onTap);this.removeTouchEvent(this.giveUp,this.onTap);this.check.removeEventListener(egret.Event.CHANGE,this.selectChange,this)};ZSBossCDWin.prototype.selectChange=function(e){if(this.check.selected){UserTips.ins().showTips(i18n("ZSBossCDWin_0"))}};ZSBossCDWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.sure:if(ZsBoss.ins().checkIsMoreMoney()){UserBoss.ins().sendClearCD();ViewManager.ins().close(this)}break;case this.giveUp:ViewManager.ins().close(this);break}};return ZSBossCDWin}(BaseEuiView);__reflect(ZSBossCDWin.prototype,"ZSBossCDWin");ViewManager.ins().reg(ZSBossCDWin,LayerManager.UI_Popup);var ZSBossLotteryWin=function(_super){__extends(ZSBossLotteryWin,_super);function ZSBossLotteryWin(){var _this=_super.call(this)||this;_this.configTimes=0;return _this}ZSBossLotteryWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ZSBossLotterySkin";this.bar.labelFunction=function(){return""};this.isTopLevel=true;this.pointImg=BitmapNumber.ins().createNumPic(0,"1",10);this.pointImg.x=this["point"].x;this.pointImg.y=this["point"].y;DisplayUtils.removeFromParent(this["point"])};ZSBossLotteryWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.play,this.onTap);this.addTouchEvent(this.giveUp,this.onTap);this.observe(UserBoss.ins().postLotteryRan,this.getMyPoint);this.observe(UserBoss.ins().postLotteryResult,this.getMaxPoint);this.observe(GuildWar.ins().postLotteryPoint,this.getMyPoint);this.observe(GuildWar.ins().postLotteryMaxPost,this.getMaxPoint);this.statu=0;if(param[0])this.statu=param[0];else this.statu=0;if(ZsBoss.ins().isZsBossFb(GameMap.fubenID)){this.configTimes=GlobalConfig.WorldBossBaseConfig.lotteryTime}else{this.configTimes=10}this.bar.maximum=10*this.configTimes;this.refushInfo();this.play.enabled=true};ZSBossLotteryWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.play,this.onTap);this.removeTouchEvent(this.giveUp,this.onTap);TimerManager.ins().remove(this.refushBar,this);this.removeObserve()};ZSBossLotteryWin.prototype.refushInfo=function(){this.times=0;this.item0.data=UserBoss.ins().worldPrize;TimerManager.ins().doTimer(100,10*this.configTimes,this.refushBar,this,this.TimeOver,this);this.timeLabel.text=i18n("ZSBossLotteryWin_0",this.configTimes)};ZSBossLotteryWin.prototype.refushBar=function(){this.times++;var value=10*this.configTimes-this.times;this.bar.value=value;this.timeLabel.text=Math.floor(this.configTimes-this.times/10)+i18n("ZSBossLotteryWin_1")};ZSBossLotteryWin.prototype.TimeOver=function(){ViewManager.ins().close(ZSBossLotteryWin)};ZSBossLotteryWin.prototype.getMyPoint=function(point){this.play.enabled=false;BitmapNumber.ins().changeNum(this.pointImg,point,"7",2);this.addChild(this.pointImg)};ZSBossLotteryWin.prototype.getMaxPoint=function(info){this.maxPoint.textFlow=(new egret.HtmlTextParser).parser("<font color = '#FFB82A'>"+info[0]+i18n("ZSBossLotteryWin_2")+info[1]+i18n("ZSBossLotteryWin_3"))};ZSBossLotteryWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(ZSBossLotteryWin);break;case this.play:if(this.statu==0){UserBoss.ins().sendJoinLottery()}else if(this.statu==1){GuildWar.ins().sendPlayLotteryInfo()}break;case this.giveUp:ViewManager.ins().close(ZSBossLotteryWin);break}};return ZSBossLotteryWin}(BaseEuiView);__reflect(ZSBossLotteryWin.prototype,"ZSBossLotteryWin");ViewManager.ins().reg(ZSBossLotteryWin,LayerManager.UI_Popup);var ZsBossPanel=function(_super){__extends(ZsBossPanel,_super);function ZsBossPanel(){return _super.call(this)||this}ZsBossPanel.prototype.childrenCreated=function(){};ZsBossPanel.prototype.initData=function(){var config;for(var i=1;i<5;i++){config=GlobalConfig.OtherBoss1Config[i];this["head"+i].source="monhead"+GlobalConfig.MonstersConfig[config.bossId].head+"_png";this["bossName"+i].text=GlobalConfig.MonstersConfig[config.bossId].name+"("+config.llimit+"-"+config.hlimit+i18n("ZsBossPanel_0");this["rewardList"+i].itemRenderer=ItemBase;this["rewardList"+i].dataProvider=new eui.ArrayCollection(config.showReward)}this.seeReward.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor(i18n("ZsBossPanel_1"),"#23C42A"))};ZsBossPanel.prototype.open=function(){ZsBoss.ins().sendGetBossList();var playIn=ZsBoss.ins().acIsOpen?i18n("ZsBossPanel_2"):i18n("ZsBossPanel_3");for(var i=1;i<5;i++){this["rank"+i].textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor("<u>"+playIn+"</u>","#23C42A"));this.addTouchEvent(this["head"+i],this.onTouch);this.addTouchEvent(this["rank"+i],this.onTouch)}this.addTouchEvent(this.seeReward,this.onTouch);this.addTouchEvent(this.enterGame,this.onTouch);this.addTouchEvent(this.clearBtn,this.onTouch);this.observe(ZsBoss.ins().postRrmainTime,this.reliveInfoChange);this.observe(ZsBoss.ins().postBossList,this.refushBtn);this.reliveInfoChange();this.refushBtn();this.initData()};ZsBossPanel.prototype.close=function(){for(var i=1;i<5;i++){this.removeTouchEvent(this["head"+i],this.onTouch);this.removeTouchEvent(this["rank"+i],this.onTouch)}this.removeTouchEvent(this.seeReward,this.onTouch);this.removeTouchEvent(this.enterGame,this.onTouch);this.removeTouchEvent(this.clearBtn,this.onTouch);this.removeObserve()};ZsBossPanel.prototype.cleanWarnWin=function(){if(this.warnWin){ViewManager.ins().close(WarnWin)}};ZsBossPanel.prototype.refushBtn=function(){var isPlay=false;var model=ZsBoss.ins();if(model.acIsOpen){var bossListLen=model.getBossListLength();var data=void 0;for(var i=0;i<bossListLen;i++){data=model.getBossInfoByIndex(i);if(data.challengeIn){this["bossBg"+(i+1)].source="zsboss_04";if(data.kill){this.sign.source="zsboss_03";model.reliveTime=0;this.reliveInfoChange()}else{this.sign.source="zsboss_07"}this.setSignPoint(i);isPlay=true;break}else{this["bossBg"+(i+1)].source="zsboss_01"}}if(!isPlay){var canIndex=model.canPlayBossIndex();if(canIndex>0){this["bossBg"+canIndex].source="zsboss_04";data=model.getBossInfoByIndex(canIndex-1);if(data){if(data.kill){this.sign.source="zsboss_03";model.reliveTime=0;this.reliveInfoChange()}else{this.sign.source=""}this.setSignPoint(canIndex-1)}}}}else{this.sign.source="";var canIndex=model.canPlayBossIndex();if(canIndex>0){this["bossBg"+canIndex].source="zsboss_04"}}for(var index=2;index<5;index++){if(index>model.aliveBossNum)this["sign"+index].source="zsboss_17";else this["sign"+index].source=""}};ZsBossPanel.prototype.setSignPoint=function(i){this.sign.x=i%2*210+133;this.sign.y=Math.floor(i/2)*230+25};ZsBossPanel.prototype.reliveInfoChange=function(){var model=ZsBoss.ins();this.timeLable.text=i18n("ZsBossPanel_10")+"："+model.reliveTime+i18n("ZsBossPanel_4");TimerManager.ins().remove(this.refushLabel,this);if(this.cd.visible){this.remainM=model.reliveTime;TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this)}};ZsBossPanel.prototype.overTime=function(){this.cd.visible=false;this.cleanWarnWin()};ZsBossPanel.prototype.refushLabel=function(){this.remainM--;this.timeLable.text=i18n("ZsBossPanel_10")+"："+this.remainM+i18n("ZsBossPanel_5")};ZsBossPanel.prototype.onTouch=function(e){switch(e.target){case this.head1:case this.rank1:this.openRankWin(1);break;case this.head2:case this.rank2:this.openRankWin(2);break;case this.head3:case this.rank3:this.openRankWin(3);break;case this.head4:case this.rank4:this.openRankWin(4);break;case this.seeReward:ViewManager.ins().open(ZsBossRewardShowWin);break;case this.enterGame:if(ZsBoss.ins().checkIsShowNoticeWin()){this.warnWin=WarnWin.show(i18n("ZsBossPanel_6"),function(){ZsBoss.ins().sendRequstChallenge();ZsBoss.ins().firstShowWin=true},this)}else{ZsBoss.ins().sendRequstChallenge()}break;case this.clearBtn:if(ZsBoss.ins().checkIsMoreMoney()){this.warnWin=WarnWin.show(i18n("ZsBossPanel_7"),function(){ZsBoss.ins().sendBuyCd()},this)}else{if(ChannelMgr.ins().isRechargeHidden()){UserTips.ins().showTips(i18n("UserTips_0"))}else{var warnWin=WarnWin.show(i18n("ZsBossPanel_8"),function(){Recharge.ins().tryShowChargeFirstWin()},this,null,null,"sure");warnWin.setBtnLabel(i18n("ZsBossPanel_9"))}}break}};ZsBossPanel.prototype.openRankWin=function(index){ZsBoss.ins().sendRequstBossRank(index);ViewManager.ins().open(ZsBossRankWin)};return ZsBossPanel}(BaseComponent);__reflect(ZsBossPanel.prototype,"ZsBossPanel");var ZsBossRankRenderer=function(_super){__extends(ZsBossRankRenderer,_super);function ZsBossRankRenderer(){return _super.call(this)||this}ZsBossRankRenderer.prototype.dataChanged=function(){this.bg.visible=this.itemIndex%2==0;this.txt0.text=this.data.rank+"";this.txt1.text=this.data.names;this.txt2.text=this.data.shanghai};return ZsBossRankRenderer}(BaseItemRender);__reflect(ZsBossRankRenderer.prototype,"ZsBossRankRenderer");var ZsBossRankWin=function(_super){__extends(ZsBossRankWin,_super);function ZsBossRankWin(){return _super.call(this)||this}ZsBossRankWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ZSBossJoinSkin";this.isTopLevel=true};ZsBossRankWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.observe(ZsBoss.ins().postRankInfo,this.refushListInfo);this.refushListInfo()};ZsBossRankWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeObserve()};ZsBossRankWin.prototype.refushListInfo=function(){this.list.dataProvider=new eui.ArrayCollection(ZsBoss.ins().bossRankList)};ZsBossRankWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};return ZsBossRankWin}(BaseEuiView);__reflect(ZsBossRankWin.prototype,"ZsBossRankWin");ViewManager.ins().reg(ZsBossRankWin,LayerManager.UI_Main);var ZsBossResultWin=function(_super){__extends(ZsBossResultWin,_super);function ZsBossResultWin(){return _super.call(this)||this}ZsBossResultWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ZsBossResultSkin";this.closeBtn.name=i18n("ZsBossResultWin_0");this.isTopLevel=true};ZsBossResultWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}var params=param;this.first.text=params[0][0];this.kill.text=params[0][1];this.myrank.text=i18n("ZsBossResultWin_1")+params[0][2];this.list.dataProvider=new eui.ArrayCollection(params[1]);this.s=10;this.updateCloseBtnLabel();TimerManager.ins().doTimer(1e3,10,this.updateCloseBtnLabel,this);this.addTouchEvent(this.closeBtn,this.onTap)};ZsBossResultWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}TimerManager.ins().remove(this.updateCloseBtnLabel,this);this.removeTouchEvent(this.closeBtn,this.onTap);if(GameMap.fubenID>0){UserFb.ins().sendExitFb()}};ZsBossResultWin.prototype.onTap=function(){ViewManager.ins().close(this)};ZsBossResultWin.prototype.updateCloseBtnLabel=function(){this.s--;if(this.s<=0)ViewManager.ins().close(this);this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"};return ZsBossResultWin}(BaseEuiView);__reflect(ZsBossResultWin.prototype,"ZsBossResultWin");ViewManager.ins().reg(ZsBossResultWin,LayerManager.UI_Popup);var ZsBossRewardShowWin=function(_super){__extends(ZsBossRewardShowWin,_super);function ZsBossRewardShowWin(){return _super.call(this)||this}ZsBossRewardShowWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="ZSBossRewardSkin";this.tab.dataProvider=new eui.ArrayCollection(ZsBoss.ins().getBarList());this.itemList1.itemRenderer=ItemBase;this.itemList2.itemRenderer=ItemBase;this.itemList3.itemRenderer=ItemBase;this.itemList4.itemRenderer=ItemBase;this.isTopLevel=true};ZsBossRewardShowWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.closeBtn,this.onTap);this.addTouchEvent(this.closeBtn0,this.onTap);this.addChangeEvent(this.tab,this.selectIndexChange);this.selectIndexChange(null)};ZsBossRewardShowWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeTouchEvent(this.closeBtn,this.onTap);this.removeTouchEvent(this.closeBtn0,this.onTap)};ZsBossRewardShowWin.prototype.selectIndexChange=function(e){var cruIndex=this.tab.selectedIndex;var config=GlobalConfig.OtherBoss1Config[cruIndex+1];this.bossName.text=GlobalConfig.MonstersConfig[config.bossId].name+"("+config.llimit+"-"+config.hlimit+i18n("ZsBossRewardShowWin_0");this.ranklabel1.text=config.rankname[0];this.ranklabel2.text=config.rankname[1];this.ranklabel3.text=config.rankname[2];this.ranklabel4.text=config.rankname[3];this.ranklabel5.text=config.rankname[4];this.ranklabel6.text=config.rankname[5];this.itemList1.dataProvider=new eui.ArrayCollection(config.rank1);this.itemList2.dataProvider=new eui.ArrayCollection(config.rank2);this.itemList3.dataProvider=new eui.ArrayCollection(config.rank3);this.itemList4.dataProvider=new eui.ArrayCollection(config.rank4);this.itemList5.data=config.killReward;this.itemList6.data=config.shield[0].reward};ZsBossRewardShowWin.prototype.onTap=function(e){switch(e.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break}};return ZsBossRewardShowWin}(BaseEuiView);__reflect(ZsBossRewardShowWin.prototype,"ZsBossRewardShowWin");ViewManager.ins().reg(ZsBossRewardShowWin,LayerManager.UI_Popup);var ZsBossRuleSpeak=function(_super){__extends(ZsBossRuleSpeak,_super);function ZsBossRuleSpeak(){return _super.call(this)||this}ZsBossRuleSpeak.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="HelpTipsSkin";this.isTopLevel=true};ZsBossRuleSpeak.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEndEvent(this,this.otherClose);var index=param[0];var cfg=GlobalConfig.HelpInfoConfig[index];if(Assert(cfg,"HelpInfoConfig do not have index:"+index))return;this.textInfo.textFlow=TextFlowMaker.generateTextFlow(GlobalConfig.HelpInfoConfig[index].text);this.textInfo.height=this.textInfo.textHeight;this.background.height=this.textInfo.textHeight+60;this.anigroup.y=(StageUtils.ins().getHeight()-this.background.height)/2};ZsBossRuleSpeak.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)};ZsBossRuleSpeak.prototype.otherClose=function(evt){ViewManager.ins().close(this)};return ZsBossRuleSpeak}(BaseEuiView);__reflect(ZsBossRuleSpeak.prototype,"ZsBossRuleSpeak");ViewManager.ins().reg(ZsBossRuleSpeak,LayerManager.UI_Popup);var CreateRoleScene=function(_super){__extends(CreateRoleScene,_super);function CreateRoleScene(){return _super.call(this)||this}CreateRoleScene.prototype.onEnter=function(){_super.prototype.onEnter.call(this);ViewManager.ins().close(ConnectingWin);this.addLayer(LayerManager.UI_Main);this.addLayer(LayerManager.UI_Tips);ViewManager.ins().open(CreateRoleView);ReportData.getIns().report("entercreaterole",ReportData.LOAD)};CreateRoleScene.prototype.onExit=function(){_super.prototype.onExit.call(this)};return CreateRoleScene}(BaseScene);__reflect(CreateRoleScene.prototype,"CreateRoleScene");var CreateRoleView=function(_super){__extends(CreateRoleView,_super);function CreateRoleView(){var _this=_super.call(this)||this;_this._selectJob=0;_this.isAutoEnter=false;_this.sex=[0,1,1];_this.roleAni1=null;_this.roleAni2=null;_this.roleAni3=null;_this.skinName="CreateRoleSkin";_this.jobImage=[_this.j0,_this.j1,_this.j2];_this.enterGroup.visible=false;_this.groupSpark=new eui.Group;_this.addChild(_this.groupSpark);_this.groupSpark.touchChildren=false;_this.groupSpark.touchEnabled=false;_this.list.itemRenderer=CreateRoleViewItem;var arrName=["","","",""];var addName=[i18n("CreateRoleView_0"),i18n("CreateRoleView_1"),i18n("CreateRoleView_2"),i18n("CreateRoleView_3"),i18n("CreateRoleView_4"),i18n("CreateRoleView_5"),i18n("CreateRoleView_6"),i18n("CreateRoleView_7"),i18n("CreateRoleView_8"),i18n("CreateRoleView_9"),i18n("CreateRoleView_10"),i18n("CreateRoleView_11"),i18n("CreateRoleView_12"),i18n("CreateRoleView_13"),i18n("CreateRoleView_14"),i18n("CreateRoleView_15"),i18n("CreateRoleView_16"),i18n("CreateRoleView_17"),i18n("CreateRoleView_18"),i18n("CreateRoleView_19"),i18n("CreateRoleView_20"),i18n("CreateRoleView_21"),i18n("CreateRoleView_22"),i18n("CreateRoleView_23"),i18n("CreateRoleView_24"),i18n("CreateRoleView_25"),i18n("CreateRoleView_26"),i18n("CreateRoleView_27"),i18n("CreateRoleView_28"),i18n("CreateRoleView_29"),i18n("CreateRoleView_30")];for(var i=0;i<3;i++){arrName=arrName.concat(addName)}_this.list.dataProvider=new eui.ArrayCollection(arrName);_this.scroller.touchChildren=false;_this.scroller.touchEnabled=false;return _this}CreateRoleView.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.selectJob=0;this.bg.visible=false;for(var i=0;i<this.jobImage.length;i++){this.jobImage[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.createBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);this.diceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var str=LocationProperty.nickName;if(str=="null"||str==""){RoleMgr.ins().sendRandomName(this.curSex())}else this.setName(str);this.sparkTween();this.listH=this.list.height-200;this.scroller.viewport.scrollV=0;var t=egret.Tween.get(this.scroller.viewport);t.to({scrollV:this.listH},40*this.listH).call(this.loopT,this);this.observe(GameApp.ins().postPerLoadProgress,this.perloadProgress);this.observe(RoleMgr.ins().postCreateRole,this.createRuselt);this.openTime=egret.getTimer()+15*1e3;this.timeLab.text="";this.nameInput.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);this.setBtnEff();TimerManager.ins().doTimer(1e3*15,0,function(){var gameSvr=GameServer.ins();var bytes=gameSvr.getBytes(255);gameSvr.sendToServer(bytes)},this);var channel=window["GetChannel"]()||"0_1";var c=channel.split("_");AppDotUp.Ins().PostAppDot("7",c[0],c[1],UUID,"",LoginName,SelectServerMgr.ins().recommended_server_id,SelectServerMgr.ins().serverName,"","",DeviceUtils.deviceOS);if(window["isSmallGame"]){TimerManager.ins().doTimer(1e3,0,this.updateTime,this)}};CreateRoleView.prototype.showbg=function(job,show){if(job===void 0){job="1"}if(show===void 0){show=false}var state=this.currentState;if(job==state){this.bg.visible=show}};CreateRoleView.prototype.playRoleAni1=function(){var self=this;if(!ProfilingMgr.ins().webglSupport()){self.showbg("0",false);return}if(!this.roleAni1){self.showbg("0",false);var roleAni1=new DragonBones("nanzhanshi",2,null,["nanzhanshi_once","nanzhanshi_loop"],true,"_png",false,function(){self.showbg("0",true)});self.roleMc1.addChild(roleAni1);self.roleAni1=roleAni1}else{self.showbg("0",true);this.roleAni1.playActionArray(["nanzhanshi_once","nanzhanshi_loop"],true)}};CreateRoleView.prototype.playRoleAni2=function(){var self=this;if(!ProfilingMgr.ins().webglSupport()){self.showbg("1",false);return}if(!this.roleAni2){self.showbg("1",false);var roleAni2=new DragonBones("nv_fashi",2,null,["fashi_nv_once","fashi_nv_loop"],true,"_png",false,function(){self.showbg("1",true)});self.roleMc2.addChild(roleAni2);self.roleAni2=roleAni2}else{self.showbg("1",true);this.roleAni2.playActionArray(["fashi_nv_once","fashi_nv_loop"],true)}};CreateRoleView.prototype.playRoleAni3=function(){var self=this;if(!ProfilingMgr.ins().webglSupport()){self.showbg("2",false);return}if(!this.roleAni3){self.showbg("2",false);var roleAni3=new DragonBones("nv_daoshi",2,null,["fashi_nv_once","fashi_nv_loop"],true,"_png",false,function(){self.showbg("2",true)});self.roleMc3.addChild(roleAni3);self.roleAni3=roleAni3}else{self.showbg("2",true);this.roleAni3.playActionArray(["fashi_nv_once","fashi_nv_loop"],true)}};CreateRoleView.prototype.setBtnEff=function(){if(!this.btnMc){this.btnMc=new MovieClip;this.btnMc.x=this.createBtn.x+this.createBtn.width/2;this.btnMc.y=this.createBtn.y+this.createBtn.height/2;this.createBtn.addChild(this.btnMc);this.btnMc.touchEnabled=false}this.btnMc.playFile(RES_DIR_EFF+"chuangjuebtn",-1)};CreateRoleView.prototype.updateTime=function(){var s=Math.ceil((this.openTime-egret.getTimer())/1e3);this.timeLab.text="（"+Math.max(s,0)+"）";if(s<=0){this.isAutoEnter=true;this.sendCreateRole()}};CreateRoleView.prototype.createRuselt=function(result){this.enterGroup.visible=false;if(Math.abs(result)==6){RoleMgr.ins().sendRandomName(this.curSex())}};CreateRoleView.prototype.perloadProgress=function(arr){var loaded=arr[0],total=arr[1];this.loadText.text=i18n("CreateRoleView_32",Math.ceil(loaded/total*100))};CreateRoleView.prototype.loopT=function(){this.scroller.viewport.scrollV=200;var t=egret.Tween.get(this.scroller.viewport);t.to({scrollV:this.listH},40*this.listH).call(this.loopT,this)};CreateRoleView.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}for(var i=0;i<this.jobImage.length;i++){this.jobImage[i].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)}this.createBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);this.diceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);this.closeTween();TimerManager.ins().removeAll(this);DisplayUtils.removeFromParent(this.btnMc);this.btnMc=null};CreateRoleView.prototype.sendCreateRoleReal=function(){RoleMgr.ins().sendCreateRole(this.nameInput.text,this.curSex(),this.curJob(),0,0,"");TimerManager.ins().removeAll(this)};CreateRoleView.prototype.sendCreateRole=function(){if(ChannelMgr.ins().isQQSmallGameChannel()){var self_20=this;console.log("channel "+ChannelMgr.ins().main_channel+" dyb.msg_check0:"+this.nameInput.text);dyb.msg_check(this.nameInput.text,function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.msg_check0 callback:"+JSON.stringify(callback));var code=callback.code;if(code==1){self_20.sendCreateRoleReal();return true}else{UserTips.ins().showTips(i18n("CreateRoleView_33"));return false}})}else{this.sendCreateRoleReal();return true}};CreateRoleView.prototype.onClick=function(e){switch(e.currentTarget){case this.createBtn:ReportData.getIns().report("clickstart",ReportData.LOAD);var b=this.sendCreateRole();if(b){this.enterGroup.visible=true}break;case this.diceBtn:RoleMgr.ins().sendRandomName(this.curSex());case this.nameInput:break;default:var jobIndex=this.jobImage.indexOf(e.currentTarget);if(jobIndex>=0)this.selectJob=jobIndex;break}this.timeLab.text="";TimerManager.ins().remove(this.updateTime,this);SoundManager.ins().touchBg()};Object.defineProperty(CreateRoleView.prototype,"selectJob",{set:function(jobIndex){this._selectJob=jobIndex;this.currentState=""+jobIndex;if(jobIndex==0){this.roleStill.source="choose_bg_zs_jpg";this.playRoleAni1();if(this.rolesound1)SoundManager.ins().stopEffect(this.rolesound1);if(this.rolesound2)SoundManager.ins().stopEffect(this.rolesound2);this.rolesound0=SoundManager.ins().playEffectImpl(SoundUtil.ROLE_ZHENWU)}if(jobIndex==1){this.roleStill.source="choose_bg_fs_jpg";this.playRoleAni2();if(this.rolesound0)SoundManager.ins().stopEffect(this.rolesound0);if(this.rolesound2)SoundManager.ins().stopEffect(this.rolesound2);this.rolesound1=SoundManager.ins().playEffectImpl(SoundUtil.ROLE_TIANHUA)}if(jobIndex==2){this.roleStill.source="choose_bg_ds_jpg";this.playRoleAni3();if(this.rolesound0)SoundManager.ins().stopEffect(this.rolesound0);if(this.rolesound1)SoundManager.ins().stopEffect(this.rolesound1);this.rolesound2=SoundManager.ins().playEffectImpl(SoundUtil.ROLE_LINGLONG)}},enumerable:true,configurable:true});CreateRoleView.prototype.setName=function(str){this.nameInput.text=str;if(this.isAutoEnter)this.sendCreateRole()};CreateRoleView.prototype.curJob=function(){return Math.floor(this._selectJob+1)};CreateRoleView.prototype.curSex=function(){return this.sex[this._selectJob]};CreateRoleView.prototype.sparkTween=function(){var _this=this;for(var i=0;i<15;i++){TimerManager.ins().doTimer(Math.random()*1e3+1500,1,function(){_this.randomSpark()},this)}TimerManager.ins().doTimer(1500,1,function(){_this.sparkTween()},this)};CreateRoleView.prototype.randomSpark=function(){var image=ObjectPool.pop("eui.Image");image.source="cr_3";image.x=Math.random()*300+500;image.rotation=Math.random()*180;image.touchEnabled=false;this.groupSpark.addChild(image);var scale=MathUtils.limit(.7,1);image.scaleX=image.scaleY=scale;image.y=MathUtils.limit(-50,250)+700;var t=egret.Tween.get(image);t.to({x:Math.random()*480,y:Math.random()*500},3500).call(function(){image.parent.removeChild(image);egret.Tween.removeTweens(image);ObjectPool.push(image)})};CreateRoleView.prototype.closeTween=function(){var len=this.groupSpark.numChildren;for(var i=0;i<len;i++){var obj=this.groupSpark.getChildAt(i);egret.Tween.removeTweens(obj)}egret.Tween.removeTweens(this.scroller.viewport)};return CreateRoleView}(BaseEuiView);__reflect(CreateRoleView.prototype,"CreateRoleView");ViewManager.ins().reg(CreateRoleView,LayerManager.UI_Main);var CreateRoleViewItem=function(_super){__extends(CreateRoleViewItem,_super);function CreateRoleViewItem(){return _super.call(this)||this}CreateRoleViewItem.prototype.dataChanged=function(){if(this.data==""){this.labelInfo.text="";return}var str=i18n("CreateRoleViewItem_0")+i18n("CreateRoleViewItem_2")+this.data+"|"+i18n("CreateRoleViewItem_1");this.labelInfo.textFlow=TextFlowMaker.generateTextFlow1(str)};return CreateRoleViewItem}(eui.ItemRenderer);__reflect(CreateRoleViewItem.prototype,"CreateRoleViewItem");var RoleMgr=function(_super){__extends(RoleMgr,_super);function RoleMgr(){var _this=_super.call(this)||this;_this.canEnter=false;_this.enterID=-1;_this.isFirstEnter=true;_this.lastRoleID=-1;_this.lastroleName="";_this.dontReconnect=false;_this.sysId=PackageID.Login;_this.regNetMsg(1,_this.doCheckAccount);_this.regNetMsg(2,_this.postCreateRole);_this.regNetMsg(4,_this.doRoleList);_this.regNetMsg(5,_this.doEnterGame);_this.regNetMsg(6,_this.doRandom);_this.regNetMsg(7,_this.doKickMsg);_this.observe(GameApp.ins().postPerLoadComplete,_this.perCom);return _this}Object.defineProperty(RoleMgr.prototype,"errorCode",{get:function(){var _errorCode=this._errorCode;if(_errorCode==null){_errorCode=["",i18n("RoleMgr_0"),i18n("RoleMgr_1"),i18n("RoleMgr_2"),i18n("RoleMgr_3"),i18n("RoleMgr_4"),i18n("RoleMgr_5"),i18n("RoleMgr_6"),i18n("RoleMgr_7"),i18n("RoleMgr_8"),i18n("RoleMgr_9"),i18n("RoleMgr_10"),i18n("RoleMgr_11"),i18n("RoleMgr_12"),i18n("RoleMgr_13"),i18n("RoleMgr_14")];this._errorCode=_errorCode}return _errorCode},enumerable:true,configurable:true});Object.defineProperty(RoleMgr,"LONGIN_ERROR_CODE",{get:function(){var _LONGIN_ERROR_CODE=this._LONGIN_ERROR_CODE;if(_LONGIN_ERROR_CODE==null){_LONGIN_ERROR_CODE=["",i18n("RoleMgr_15"),i18n("RoleMgr_16"),i18n("RoleMgr_17"),i18n("RoleMgr_18"),i18n("RoleMgr_19"),i18n("RoleMgr_20"),i18n("RoleMgr_21"),i18n("RoleMgr_22")];this._LONGIN_ERROR_CODE=_LONGIN_ERROR_CODE}return _LONGIN_ERROR_CODE},enumerable:true,configurable:true});RoleMgr.ins=function(){return _super.ins.call(this)};RoleMgr.prototype.perCom=function(){this.canEnter=true;if(this.enterID!=-1){this.sendEnterGame(this.enterID)}};RoleMgr.prototype.connectServer=function(){this.startBtnEnable(false);GameSocket.ins().login(LocationProperty.openID,LocationProperty.password,LocationProperty.srvid,LocationProperty.serverIP,LocationProperty.serverPort)};RoleMgr.prototype.doCheckAccount=function(bytes){var result=bytes.readByte();if(result==0){this.dontReconnect=false;var bytes_2=this.getBytes(4);this.sendToServer(bytes_2)}else{this.dontReconnect=true;this.startBtnEnable(true);if(result==3){var reload=function(){ChannelMgr.ins().reload()};WarnWin.show(RoleMgr.LONGIN_ERROR_CODE[result],reload,this,reload,this,"sure")}}};RoleMgr.prototype.doRoleList=function(bytes){var id=bytes.readInt();var code=bytes.readByte();LocationProperty.isCreated=false;switch(code){case 0:SceneManager.ins().runScene(CreateRoleScene);LocationProperty.isCreated=true;console.log("========CREATE_ROLE 111doRoleList:",LocationProperty.isCreated);break;case 1:var roleNum=bytes.readInt();var roleArr=[];for(var i=0;i<roleNum;i++){var role=new SelectRoleData(bytes);roleArr.push(role)}if(ChannelMgr.ins().isChuDongChannel()&&typeof TDGA!="undefined"){if(roleNum>0){TDGA.Account.setAccountName(roleArr[0].name);TDGA.Account.setLevel(roleArr[0].level)}}if(roleNum==1){this.enterID=roleArr[0].id;this.sendEnterGame(roleArr[0].id);LocationProperty.isCreated=false}else if(!this.isFirstEnter&&this.lastRoleID!=-1){this.sendEnterGame(this.lastRoleID);LocationProperty.isCreated=false}else{SceneManager.ins().runScene(SelectRoleScene);ViewManager.ins().open(SelectRoleWin,roleArr);ViewManager.ins().close(ConnectingWin)}break}};RoleMgr.prototype.sendEnterGame=function(roleID){var bytes=this.getBytes(5);bytes.writeInt(roleID);bytes.writeString(LocationProperty.pf);bytes.writeString(LocationProperty.pfid);bytes.writeString(LocationProperty.appid);this.sendToServer(bytes);this.lastRoleID=roleID;if(ChannelMgr.ins().isChuDongChannel()&&typeof TDGA!="undefined"){TDGA.Account({accountId:LocationProperty.accountUserID,gameServer:"["+(LocationProperty.srvid?LocationProperty.srvid.toString():"")+"]"+(LocationProperty.srvName?LocationProperty.srvName:"")})}if(ChannelMgr.ins().isChuDongChannel()&&typeof mqq!="undefined"&&typeof TDGA!="undefined"){mqq.ui.setOnCloseHandler(function(type){TDGA.onPageLeave()})}};RoleMgr.prototype.doEnterGame=function(bytes){var result=bytes.readByte();switch(result){case 0:break;case 1:debug.log(i18n("RoleMgr_23"));RealNameRewardMgr.ins().sendGetRewardReq();KFServerSys.ins().linkingKFState(false);SceneManager.ins().runScene(MainScene);EntityManager.ins().removeAll();Encounter.ins().clearEncounterModel();Chat.ins().initData();Guild.ins().initData();MarryMgr.ins().sendGetTaskList();MarryMgr.ins().sendGetProrosalList();ShapeShiftingMgr.ins().sendGetShapeShiftingInfo();ShapeShiftingMgr.ins().sendPowerReq();Notice.ins().getWelfareNotice();initFrontBackFunc();Friends.ins().sendFriendsList();UserTask.ins().getSevenDayTasks();Auction.ins().sendGetList(0);ChannelNet.ins().channelShareInit();if(window["isIOS_AppStore"]==true){ShoppingGift.ins().control(0)}if(ChannelMgr.ins().isRechargeHidden()){Recharge.ins().postChangeRecharge(false)}if(this.isFirstEnter){this.isFirstEnter=false;ReportData.getIns().report("entergame",ReportData.LOAD);var channel=window["GetChannel"]()||"0_1";var c=channel.split("_");GetLoginName();if(this.lastroleName!="")AppDotUp.Ins().PostAppDot("8",c[0],c[1],UUID,"",LoginName,"","",this.lastRoleID||"",this.lastroleName||"",DeviceUtils.deviceOS)}FirstRank.ins().checkLastHour();StrategySys.ins().sendGetData();SysPreview.ins().sendGetInfo();break;default:alert(i18n("RoleMgr_24")+result);break}};RoleMgr.prototype.sendCreateRole=function(roleName,sex,job,head,camp,pf){var bytes=this.getBytes(2);this.lastroleName=roleName;bytes.writeString(roleName);bytes.writeByte(sex);bytes.writeByte(job);bytes.writeByte(head);bytes.writeString(LocationProperty.pf);bytes.writeString(LocationProperty.pfid);bytes.writeString(LocationProperty.appid);this.sendToServer(bytes)};RoleMgr.prototype.postCreateRole=function(bytes){var id=bytes.readInt();var result=bytes.readByte();if(result!=0){this.showErrorTips(result);return result}ReportData.getIns().report("createRole",ReportData.LOAD);ReportData.getIns().createRole(id);SoundUtil.ins().playEffect(SoundUtil.CREATE_ROLE);SoundUtil.ins().delayTime(3e3);if(!LocationProperty.isFirstLoad||this.canEnter){this.sendEnterGame(id);return false}this.enterID=id;return false};RoleMgr.prototype.sendRandomName=function(sex){var bytes=this.getBytes(6);bytes.writeByte(sex);this.sendToServer(bytes)};RoleMgr.prototype.doRandom=function(bytes){var result=bytes.readByte();if(result==0){var sex=bytes.readByte();var name_13=bytes.readUTF();if(ChannelMgr.ins().isQQSmallGameChannel()){var self_21=this;console.log("channel "+ChannelMgr.ins().main_channel+" dyb.msg_check1:"+name_13);dyb.msg_check(name_13,function(callback){console.log("channel "+ChannelMgr.ins().main_channel+" dyb.msg_check1 callback:"+JSON.stringify(callback));var code=callback.code;if(code==1){self_21.setName(name_13)}else{self_21.sendRandomName(self_21.createRoleView.curSex())}})}else{this.setName(name_13)}}};RoleMgr.prototype.doKickMsg=function(bytes){var reason=bytes.readByte();var msg=bytes.readString();var kick_reason={login_other_place:0,server_is_shutdowning:1,admin_kick:2,heartbeat_timeout:3,req_timeout:4,idip_kick:5,may_cheating:6,cheating:7,fast_msg:8,inactive_long_time:9};if(reason==kick_reason.heartbeat_timeout||reason==kick_reason.req_timeout||reason==kick_reason.inactive_long_time){return}this.dontReconnect=true;var reload=function(){ChannelMgr.ins().reload()};WarnWin.show(msg,reload,this,reload,this,"sure");if(reason==0&&ChannelMgr.ins().isQuickH5SDKChannel()){ChannelMgr.ins().QuickH5logout()}};RoleMgr.prototype.startBtnEnable=function(value){if(this.startGameWin)this.startGameWin.enterBtn.enabled=value};Object.defineProperty(RoleMgr.prototype,"startGameWin",{get:function(){return ViewManager.ins().getView(StartGameWin)},enumerable:true,configurable:true});RoleMgr.prototype.setName=function(str){this.createRoleView.setName(str)};Object.defineProperty(RoleMgr.prototype,"createRoleView",{get:function(){return ViewManager.ins().getView(CreateRoleView)},enumerable:true,configurable:true});RoleMgr.prototype.showErrorTips=function(result){if(result==0)return;UserTips.ins().showTips(this.errorCode[Math.abs(result)])};return RoleMgr}(BaseSystem);__reflect(RoleMgr.prototype,"RoleMgr");var GameSystem=window["GameSystem"];(function(GameSystem){GameSystem.roleMgr=RoleMgr.ins.bind(RoleMgr)})(GameSystem||(GameSystem={}));window["GameSystem"]=GameSystem;var SelectRoleScene=function(_super){__extends(SelectRoleScene,_super);function SelectRoleScene(){return _super.call(this)||this}SelectRoleScene.prototype.onEnter=function(){_super.prototype.onEnter.call(this);this.addLayer(LayerManager.UI_Main);this.addLayer(LayerManager.UI_Tips)};SelectRoleScene.prototype.onExit=function(){_super.prototype.onExit.call(this)};return SelectRoleScene}(BaseScene);__reflect(SelectRoleScene.prototype,"SelectRoleScene");var StartGameScene=function(_super){__extends(StartGameScene,_super);function StartGameScene(){return _super.call(this)||this}StartGameScene.prototype.onEnter=function(){var mgr=RoleMgr.ins();_super.prototype.onEnter.call(this);if(LocationProperty.isCanLogin())RoleMgr.ins().connectServer();else{this.addLayer(LayerManager.UI_Main)}RES.loadGroup("gamePer")};StartGameScene.prototype.onExit=function(){_super.prototype.onExit.call(this)};return StartGameScene}(BaseScene);__reflect(StartGameScene.prototype,"StartGameScene");var SelectRoleData=function(){function SelectRoleData(bytes){this.id=bytes.readInt();this.name=bytes.readString();this.roleClass=bytes.readInt();this.zsLevel=bytes.readInt();this.level=bytes.readInt();this.power=bytes.readDouble();this.vipLevel=bytes.readInt();this.sex=bytes.readInt()}return SelectRoleData}();__reflect(SelectRoleData.prototype,"SelectRoleData");var SelectRoleItem=function(_super){__extends(SelectRoleItem,_super);function SelectRoleItem(){var _this=_super.call(this)||this;_this.skinName="SelectRoleItemSkin";return _this}SelectRoleItem.prototype.dataChanged=function(){var _data=this.data;this.labelName.text=_data.name;if(_data.zsLevel==0){this.labelLevel.text=i18n("SelectRoleItem_0")+""+_data.level}else{this.labelLevel.text=i18n("SelectRoleItem_1")+_data.zsLevel+i18n("SelectRoleItem_2")+_data.level+i18n("SelectRoleItem_3")}if(_data.power<=1e5){this.labelPower.text=i18n("SelectRoleItem_4")+_data.power+""}else{var num=Math.floor(_data.power/1e3);num=num/10;this.labelPower.text=i18n("SelectRoleItem_5")+num+i18n("SelectRoleItem_6")}if(_data.vipLevel==0){this.groupVip.visible=false}else{this.vipLabel.text=_data.vipLevel+"";this.groupVip.visible=true}var job=fixJob(_data.roleClass);var sex=fixSex(_data.sex);this.imgRole.source="head_"+job+sex;this.select.visible=this.selected};return SelectRoleItem}(BaseItemRender);__reflect(SelectRoleItem.prototype,"SelectRoleItem");var SelectRoleWin=function(_super){__extends(SelectRoleWin,_super);function SelectRoleWin(){var _this=_super.call(this)||this;_this.waitTime=10;_this.isTopLevel=true;return _this}SelectRoleWin.prototype.initUI=function(){_super.prototype.initUI.call(this);this.skinName="SelectRoleSkin";this.list.itemRenderer=SelectRoleItem};SelectRoleWin.prototype.open=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.addTouchEvent(this.btnStart,this.onStartGame);this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickList,this);var list=param[0];list.sort(function(a,b){return a.power<b.power?1:-1});var selectIndex=0;for(var i=0;i<list.length;++i){var svrid=list[i].id&65535;var lastSvrID=SelectServerMgr.ins().last_login_serverid;console.log("SelectRoleWin Role's svrid = "+svrid+"  lastSvrID = "+lastSvrID);if(lastSvrID>-1&&svrid==lastSvrID){selectIndex=i;break}}this.list.dataProvider=new eui.ArrayCollection(list);this.list.selectedIndex=selectIndex;this.btnStart.label=i18n("SelectRoleWin_0")+this.waitTime+"S)";TimerManager.ins().doTimer(1e3,this.waitTime,this.timeToStart,this);this.addTouchEvent(this.closeBtn,this.onClick)};SelectRoleWin.prototype.onClick=function(e){switch(e.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break}};SelectRoleWin.prototype.timeToStart=function(){--this.waitTime;if(this.waitTime>0){this.btnStart.label=i18n("SelectRoleWin_1")+this.waitTime+"S)"}else{this.onStartGame()}};SelectRoleWin.prototype.onClickList=function(e){if(!e)return;this.list.selectedIndex=e.itemIndex;var dataPro=this.list.dataProvider;dataPro.source.forEach(function(item,index){dataPro.itemUpdated(item)})};SelectRoleWin.prototype.removeAll=function(){TimerManager.ins().remove(this.timeToStart,this);this.removeTouchEvent(this.btnStart,this.onStartGame);this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickList,this)};SelectRoleWin.prototype.close=function(){var param=[];for(var _i=0;_i<arguments.length;_i++){param[_i]=arguments[_i]}this.removeAll()};SelectRoleWin.prototype.onStartGame=function(){this.btnStart.label=i18n("SelectRoleWin_2");this.removeAll();var _data=this.list.getVirtualElementAt(this.list.selectedIndex);RoleMgr.ins().sendEnterGame(_data.data.id)};return SelectRoleWin}(BaseEuiView);__reflect(SelectRoleWin.prototype,"SelectRoleWin");ViewManager.ins().reg(SelectRoleWin,LayerManager.UI_Main);