var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{a(s.next(t))}catch(e){n(e)}}function h(t){try{a(s["throw"](t))}catch(e){n(e)}}function a(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(o,h)}a((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,n,o,h,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},Begin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.btn_game_rule.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameRuleClick,this),this.btn_ranking_list.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rankingListClick,this),this.btn_task.addEventListener(egret.TouchEvent.TOUCH_TAP,this.taskClick,this),this.btn_start_game.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGameClick,this)},e.prototype.gameRuleClick=function(){this.addChild(GameRule.getInstance())},e.prototype.rankingListClick=function(){this.addChild(RankingList.getInstance())},e.prototype.taskClick=function(){this.addChild(Task.getInstance())},e.prototype.startGameClick=function(){this.addChild(GamePage.getInstance())},e}(eui.Component);__reflect(Begin.prototype,"Begin",["eui.UIComponent","egret.DisplayObject"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function s(s){e.call(i,s,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?s(r):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),this.startAnimation(t),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[4,platform.showShareMenu()];case 5:return i.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var s=new eui.Theme("resource/default.thm.json",t.stage);s.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.addChild(Begin.getInstance())},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,s=t.map(function(t){return i.parse(t)}),r=this.textfield,n=-1,o=function(){n++,n>=s.length&&(n=0);var t=s[n];r.textFlow=t;var i=egret.Tween.get(r);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(o,e)};o()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.showShareMenu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,s){function r(t){e.call(s,t)}function n(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(s))}var o=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(s,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(s,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GameOver=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.btn_again_game.addEventListener(egret.TouchEvent.TOUCH_TAP,this.againGame,this),this.btn_to_share.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toShare,this),this.btn_ranking_list.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rankingListClick,this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnClick,this)},e.prototype.againGame=function(){this.parent.removeChild(this),GamePage.getInstance().initGame()},e.prototype.toShare=function(){this.addChild(Task.getInstance())},e.prototype.rankingListClick=function(){this.addChild(RankingList.getInstance())},e.prototype.returnClick=function(){GamePage.getInstance().initGame(),this.parent.removeChild(this),GamePage.getInstance().returnClick()},e.prototype.setScore=function(){var t="score",e=egret.localStorage.getItem(t);this.total_score.text=e,egret.setTimeout(function(){egret.localStorage.removeItem(t)},this,5e3)},e}(eui.Component);__reflect(GameOver.prototype,"GameOver",["eui.UIComponent","egret.DisplayObject"]);var GamePage=function(t){function e(){var e=t.call(this)||this;return e.score=0,e.deathX=300,e.whichCloud=2,e.deathReason="",e.cloudList=[e.img_cloud1,e.img_cloud2,e.img_cloud3,e.img_cloud4,e.img_cloud5],e}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init(),this.initGame()},e.prototype.initGame=function(){"jump"==this.deathReason?(this.whichCloud<5?this.whichCloud+=1:5==this.whichCloud&&(this.whichCloud=1),1==this.whichCloud?(this.img_cloud1.x=this.deathX-20,this.img_gift1.x=this.img_cloud1.x+100):2==this.whichCloud?(this.img_cloud2.x=this.deathX-20,this.img_gift2.x=this.img_cloud2.x+100):3==this.whichCloud?(this.img_cloud3.x=this.deathX-20,this.img_gift3.x=this.img_cloud3.x+100):4==this.whichCloud?(this.img_cloud4.x=this.deathX-20,this.img_gift4.x=this.img_cloud4.x+100):5==this.whichCloud&&(this.img_cloud5.x=this.deathX-20,this.img_gift5.x=this.img_cloud5.x+100)):this.deathReason="walk",this.score=0,this.total_score.text="0",this.img_face_right.x=this.deathX,this.img_face_right.y=530;var t=this.img_face_right.source;1==this.whichCloud?(egret.Tween.pauseTweens(this.img_cloud1),egret.Tween.pauseTweens(this.img_gift1),this.img_face_right.source=t):2==this.whichCloud?(egret.Tween.pauseTweens(this.img_cloud2),egret.Tween.pauseTweens(this.img_gift2),this.img_face_right.source=t):3==this.whichCloud?(egret.Tween.pauseTweens(this.img_cloud3),egret.Tween.pauseTweens(this.img_gift3),this.img_face_right.source=t):4==this.whichCloud?(egret.Tween.pauseTweens(this.img_cloud4),egret.Tween.pauseTweens(this.img_gift4),this.img_face_right.source=t):5==this.whichCloud&&(egret.Tween.pauseTweens(this.img_cloud5),egret.Tween.pauseTweens(this.img_gift5),this.img_face_right.source=t)},e.prototype.init=function(){this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnClick,this),this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leftClick,this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upClick,this),this.btn_right.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rightClick,this),this.sc_cloud.scrollPolicyH=eui.ScrollPolicy.OFF,this.sc_cloud.scrollPolicyV=eui.ScrollPolicy.OFF,this.sc_cloud.verticalScrollBar.autoVisibility=!1,this.sc_cloud.verticalScrollBar.visible=!1;var t=new eui.Image("resource/assets/RedHat/bg.png");this.gp_cloud.addChildAt(t,0);this.cross(),egret.Tween.pauseTweens(this.img_cloud2)},e.prototype.cross=function(){var t=2500,e=3500;this.cloudList=[this.img_cloud1,this.img_cloud2,this.img_cloud3,this.img_cloud4,this.img_cloud5];for(var i=0;i<this.cloudList.length;i++)1==i?egret.Tween.get(this.cloudList[i],{loop:!0}).to({x:0},t/2,egret.Ease.sineIn).to({x:640-this.cloudList[i].width},t,egret.Ease.sineIn).to({x:this.cloudList[i].x},t/2,egret.Ease.sineIn):i%2==0?egret.Tween.get(this.cloudList[i],{loop:!0}).to({x:640-this.cloudList[i].width},e,egret.Ease.sineIn).to({x:0},e,egret.Ease.sineIn):i%2==1&&egret.Tween.get(this.cloudList[i],{loop:!0}).to({x:0},t,egret.Ease.sineIn).to({x:this.cloudList[i].x},t,egret.Ease.sineIn);for(var s=[this.img_gift1,this.img_gift2,this.img_gift3,this.img_gift4,this.img_gift5],i=0;i<s.length;i++)i%2==0?egret.Tween.get(s[i],{loop:!0}).to({x:740-this.cloudList[i].width},e,egret.Ease.sineIn).to({x:100},e,egret.Ease.sineIn):i%2==1&&egret.Tween.get(s[i],{loop:!0}).to({x:100},t,egret.Ease.sineIn).to({x:s[i].x},t,egret.Ease.sineIn)},e.prototype.startLoad=function(t){var e,i=["gift1_png","gift2_png","gift3_png"],s=Math.floor(Math.random()*i.length);1==this.whichCloud?(t=this.img_cloud5,e=this.img_gift5):2==this.whichCloud?(t=this.img_cloud1,e=this.img_gift1):3==this.whichCloud?(t=this.img_cloud2,e=this.img_gift2):4==this.whichCloud?(t=this.img_cloud3,e=this.img_gift3):5==this.whichCloud&&(t=this.img_cloud4,e=this.img_gift4),t.x=0,t.y=-105,e!=this.img_gift2&&(e.y=t.x+100,e.width=46,e.y=-143,e.source=i[s])},e.prototype.onLoadComplete=function(t){var e=new egret.Texture;e.bitmapData=t.target.data;new egret.Bitmap(e)},e.prototype.returnClick=function(){this.parent.removeChild(this)},e.prototype.leftClick=function(){this.hiddenGift(),this.img_face_right.x>0&&("face_right_png"==this.img_face_right.source?(this.img_face_right.source="face_left_png",this.img_face_right.x=this.img_face_right.x-20,this.redHatDrop("left"),this.redHatGift("walk")):(this.img_face_right.x=this.img_face_right.x-20,this.redHatDrop("left"),this.redHatGift("walk")))},e.prototype.upClick=function(){this.hiddenUp();var t=this.img_face_right.source;this.img_face_right.source="face_me_png";var e,i;1==this.whichCloud?(e=this.img_cloud1,i=this.img_gift1):2==this.whichCloud?(e=this.img_cloud2,i=this.img_gift2):3==this.whichCloud?(e=this.img_cloud3,i=this.img_gift3):4==this.whichCloud?(e=this.img_cloud4,i=this.img_gift4):5==this.whichCloud&&(e=this.img_cloud5,i=this.img_gift5),this.resumeTweens(e,i),egret.Tween.get(this.img_face_right).to({y:this.img_face_right.y-100},700,egret.Ease.sineOut).to({y:this.img_face_right.y},400,egret.Ease.sineOut).wait(1).call(this.hiddenUp,this,[]),1==this.whichCloud?egret.setTimeout(function(){this.pauseTweens(this.img_cloud2,this.img_gift2,t)},this,1100):2==this.whichCloud?egret.setTimeout(function(){this.pauseTweens(this.img_cloud3,this.img_gift3,t)},this,1100):3==this.whichCloud?egret.setTimeout(function(){this.pauseTweens(this.img_cloud4,this.img_gift4,t)},this,1100):4==this.whichCloud?egret.setTimeout(function(){this.pauseTweens(this.img_cloud5,this.img_gift5,t)},this,1100):5==this.whichCloud&&egret.setTimeout(function(){this.pauseTweens(this.img_cloud1,this.img_gift1,t)},this,1100);for(var s=[this.img_cloud1,this.img_cloud2,this.img_cloud3,this.img_cloud4,this.img_cloud5,this.img_gift1,this.img_gift2,this.img_gift3,this.img_gift4,this.img_gift5],r=0;r<s.length;r++)egret.Tween.get(s[r]).to({y:s[r].y+250},1100,egret.Ease.sineOut).wait(1).call(this.changeCloudGift,this,[s[r]]);this.cross()},e.prototype.hiddenUp=function(){112==this.btn_up.width?(this.btn_up.width=0,this.btn_left.width=0,this.btn_right.width=0):112!=this.btn_up.width&&(this.btn_up.width=112,this.btn_left.width=112,this.btn_right.width=112)},e.prototype.hiddenGift=function(){for(var t=[this.img_gift1,this.img_gift2,this.img_gift3,this.img_gift4,this.img_gift5],e=0;e<t.length;e++)""==t[e].source&&(t[e].x=0,t[e].width=0)},e.prototype.changeCloudGift=function(t){t.y+t.height>1136&&this.startLoad(t)},e.prototype.pauseTweens=function(t,e,i){if(egret.Tween.pauseTweens(t),egret.Tween.pauseTweens(e),this.img_face_right.source=i,this.img_face_right.x+this.img_face_right.width/2>t.x&&this.img_face_right.x+this.img_face_right.width/2<t.x+t.width)this.whichCloud<5?this.whichCloud=this.whichCloud+1:(this.whichCloud=5)&&(this.whichCloud=1),this.redHatGift("jump");else{this.deathReason="jump",this.resumeTweens(t,e),egret.Tween.get(this.img_face_right).to({rotation:720,y:this.img_face_right.y+1e3},500,egret.Ease.sineIn),this.addChild(GameOver.getInstance());var s="score";egret.localStorage.setItem(s,String(this.score)),GameOver.getInstance().setScore()}},e.prototype.resumeTweens=function(t,e){egret.Tween.resumeTweens(t),egret.Tween.resumeTweens(e)},e.prototype.redHatGift=function(t){var e;1==this.whichCloud?e=this.img_gift1:2==this.whichCloud?e=this.img_gift2:3==this.whichCloud?e=this.img_gift3:4==this.whichCloud?e=this.img_gift4:5==this.whichCloud&&(e=this.img_gift5),this.img_face_right.x+this.img_face_right.width-10<e.x+e.width&&this.img_face_right.x+this.img_face_right.width-10>e.x||this.img_face_right.x+10>e.x&&this.img_face_right.x+10<e.x+e.width?"walk"==t?(e.x=0,e.width=0,this.img_score.source="score2_png",this.score=this.score+15,this.total_score.text=String(this.score),egret.setTimeout(function(){this.img_score.source=""},this,1e3)):"jump"==t&&(e.x=0,e.width=0,this.img_score.source="score3_png",this.score=this.score+20,this.total_score.text=String(this.score),egret.setTimeout(function(){this.img_score.source=""},this,1e3)):"jump"==t&&(this.img_score.source="score1_png",this.score=this.score+5,this.total_score.text=String(this.score),egret.setTimeout(function(){this.img_score.source=""},this,1e3))},e.prototype.rightClick=function(){this.hiddenGift(),this.img_face_right.x+this.img_face_right.width<640&&("face_left_png"==this.img_face_right.source?(this.img_face_right.source="face_right_png",this.img_face_right.x=this.img_face_right.x+20,this.redHatDrop("right"),this.redHatGift("walk")):(this.img_face_right.x=this.img_face_right.x+20,this.redHatDrop("right"),this.redHatGift("walk")))},e.prototype.redHatDrop=function(t){this.deathReason="walk";var e;if(1==this.whichCloud?e=this.img_cloud1:2==this.whichCloud?e=this.img_cloud2:3==this.whichCloud?e=this.img_cloud3:4==this.whichCloud?e=this.img_cloud4:5==this.whichCloud&&(e=this.img_cloud5),"left"==t){if(this.deathX=this.img_face_right.x+50,this.img_face_right.x+this.img_face_right.width/2<e.x){egret.Tween.get(this.img_face_right).to({rotation:720,y:this.img_face_right.y+1e3},500,egret.Ease.sineIn),this.addChild(GameOver.getInstance());var i="score";egret.localStorage.setItem(i,String(this.score)),GameOver.getInstance().setScore()}}else if("right"==t&&(this.deathX=this.img_face_right.x-50,this.img_face_right.x+this.img_face_right.width/2>e.x+e.width)){egret.Tween.get(this.img_face_right).to({rotation:720,y:this.img_face_right.y+1e3},500,egret.Ease.sineIn),this.addChild(GameOver.getInstance());var i="score";egret.localStorage.setItem(i,String(this.score)),GameOver.getInstance().setScore()}},e}(eui.Component);__reflect(GamePage.prototype,"GamePage",["eui.UIComponent","egret.DisplayObject"]);var GameRule=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnClick,this)},e.prototype.returnClick=function(){this.parent.removeChild(this)},e}(eui.Component);__reflect(GameRule.prototype,"GameRule",["eui.UIComponent","egret.DisplayObject"]);var RankingList=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnClick,this)},e.prototype.returnClick=function(){this.parent.removeChild(this)},e}(eui.Component);__reflect(RankingList.prototype,"RankingList",["eui.UIComponent","egret.DisplayObject"]);var Task=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnClick,this),this.btn_to_share.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toShare,this)},e.prototype.returnClick=function(){this.parent.removeChild(this)},e.prototype.toShare=function(){platform.showShareMenu()},e}(eui.Component);__reflect(Task.prototype,"Task",["eui.UIComponent","egret.DisplayObject"]),window.Main=Main;