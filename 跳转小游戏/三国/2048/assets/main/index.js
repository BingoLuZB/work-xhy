window.__require=function t(o,e,c){function i(a,s){if(!e[a]){if(!o[a]){var r=a.split("/");if(r=r[r.length-1],!o[r]){var l="function"==typeof __require&&__require;if(!s&&l)return l(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var h=e[a]={exports:{}};o[a][0].call(h.exports,function(t){return i(o[a][1][t]||t)},h,h.exports,t,o,e,c)}return e[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<c.length;a++)i(c[a]);return i}({GameOverMenu:[function(t,o){"use strict";cc._RF.push(o,"122dc/Bj4pIr6Ly0+yI6ytG","GameOverMenu"),cc.Class({extends:cc.Component,properties:{scoreLabel:cc.Label,restartBtn:cc.Button},onLoad:function(){},init:function(t){this.game=t},show:function(){this.node.setPosition(0,0),this.scoreLabel.getComponent(cc.Label).string=""+this.game.currentScore},hide:function(){this.node.x=3e3},onRestartBtnTouched:function(){this.hide(),this.game.restart()}}),cc._RF.pop()},{}],Game:[function(t,o){"use strict";cc._RF.push(o,"4dfa9RUi/ZBqageHftYr/rP","Game"),cc.Class({extends:cc.Component,properties:{block:cc.Prefab,bg:cc.Sprite,currentScoreLabel:cc.Label,bestScoreLabel:cc.Label,currentScore:0,bestScore:0,gameOverMenu:cc.Node,moving:!1},onLoad:function(){this.creatBgBlocks(),this.addTouchEvents(),this.initColor()},start:function(){this.initData(),this.gameOverMenu.getComponent("GameOverMenu").init(this),this.bestScore=cc.sys.localStorage.getItem("bestScore"),this.bestScore||(this.bestScore=0),this.bestScoreLabel.getComponent(cc.Label).string="\u6700\u9ad8\u5206\u6570: "+this.bestScore},restart:function(){this.initData(),this.currentScore=0,this.updateSocreLabel()},creatBgBlocks:function(){var t=(cc.winSize.width-100)/4;this.blockSize=t;var o=20+t/2,e=t;this.positions=[];for(var c=0;c<4;c++){this.positions.push([]);for(var i=0;i<4;i++){var n=cc.instantiate(this.block);n.getChildByName("label").active=!1,n.attr({x:o,y:e,width:t,height:t}),this.positions[c].push(cc.v2(o,e)),o+=t+20,this.bg.node.addChild(n)}e+=t+20,o=20+t/2}},initData:function(){if(this.blocks)for(var t=0;t<this.blocks.length;t++)for(var o=0;o<this.blocks[t].length;o++)this.blocks[t][o]&&this.blocks[t][o].destroy();for(this.data=[],this.blocks=[],t=0;t<4;t++)this.data.push([0,0,0,0]),this.blocks.push([null,null,null,null]);this.addBlock(1,1,0),this.addBlock(1,2,0),this.addBlock(1,3,1),cc.log(this.data)},initColor:function(){this.colors=[],this.colors[2]=cc.color(237,241,21,255),this.colors[4]=cc.color(241,180,21,255),this.colors[8]=cc.color(171,241,21,255),this.colors[16]=cc.color(149,160,216,255),this.colors[32]=cc.color(187,149,216,255),this.colors[64]=cc.color(216,149,209,255),this.colors[128]=cc.color(28,118,156,255),this.colors[256]=cc.color(16,74,99,255),this.colors[512]=cc.color(168,85,25,255),this.colors[1024]=cc.color(236,122,38,255),this.colors[2048]=cc.color(236,86,33,255)},getEmptyLocations:function(){for(var t=[],o=0;o<this.data.length;o++)for(var e=0;e<this.data[o].length;e++)0==this.data[o][e]&&t.push(4*o+e);return t},addBlock:function(t,o,e){var c=this.getEmptyLocations();if(0==c.length)return!1;var i=Math.floor(Math.random()*c.length);i=c[i];var n=Math.floor(i/4),a=Math.floor(i%4);n=t||n,a=o||a;var s=[2,4],r=Math.floor(Math.random()*s.length);null!=e&&(r=e);var l=cc.instantiate(this.block);l.attr({width:this.blockSize,height:this.blockSize}),l.color=new cc.Color(this.colors[s[r]]),l.setPosition(this.positions[n][a]),l.getChildByName("label").getComponent(cc.Label).string=s[r],this.bg.node.addChild(l),this.blocks[n][a]=l,l.scaleX=0,l.scaleY=0;var h=cc.scaleTo(.1,1,1);return l.runAction(h),this.data[n][a]=s[r],!0},afterMove:function(t){console.log("afterMove"),t&&(this.currentScore+=1,this.updateSocreLabel(),this.addBlock()),this.isGameOver()&&this.gameOver(),this.moving=!1},isGameOver:function(){for(var t=0;t<4;t++)for(var o=0;o<4;o++){var e=this.data[t][o];if(0==e)return!1;if(t-1>=0&&this.data[t-1][o]==e)return!1;if(t+1<4&&this.data[t+1][o]==e)return!1;if(o-1>=0&&this.data[t][o-1]==e)return!1;if(o+1<4&&this.data[t][o+1]==e)return!1}return!0},gameOver:function(){this.gameOverMenu.getComponent("GameOverMenu").show(),this.updateBestScore()},updateBestScore:function(){this.currentScore>this.bestScore&&(this.bestScore=this.currentScore,this.bestScoreLabel.getComponent(cc.Label).string="\u6700\u9ad8\u5206\u6570: "+this.bestScore,cc.sys.localStorage.setItem("bestScore",this.bestScore))},addTouchEvents:function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(t){return console.log("\u5f53\u524d\u65f6\u95f4",Date.now()),this.touchStartTime=Date.now(),this.touchStartPoint=t.getLocation(),!0},this),this.node.on(cc.Node.EventType.TOUCH_END,function(o){this.touchEndTime=Date.now(),console.log("\u7ed3\u675f\u65f6\u95f4",Date.now()),this.touchEndPoint=o.getLocation();var e=cc.v2(this.touchEndPoint.x-this.touchStartPoint.x,this.touchEndPoint.y-this.touchStartPoint.y);if(this.touchEndTime-this.touchStartTime<400){if(this.moving)return;Math.abs(e.x)>Math.abs(e.y)?e.x>50?(t.moving=!0,t.moveRight()):e.x<-50&&(t.moving=!0,t.moveLeft()):e.y>50?(t.moving=!0,t.moveUp()):e.y<-50&&(t.moving=!0,t.moveDown())}},this)},moveAction:function(t,o,e){var c=cc.moveTo(.08,o),i=cc.callFunc(function(){e()});t.runAction(cc.sequence(c,i))},mergeAction:function(t,o,e,c){var i=this;t.destroy();var n=cc.scaleTo(.1,1.1),a=cc.scaleTo(.1,1),s=cc.callFunc(function(){o.color=new cc.Color(i.colors[e]),o.getChildByName("label").getComponent(cc.Label).string=e}),r=cc.callFunc(function(){c()});o.runAction(cc.sequence(n,s,a,r))},moveLeft:function(){for(var t=this,o=!1,e=[],c=0;c<4;c++)e.push([0,0,0,0]);for(var i=function c(i,n,a){if(0!=n)if(0==t.data[i][n-1]||t.data[i][n-1]==t.data[i][n])if(t.data[i][n-1]!=t.data[i][n]||e[i][n-1])if(0==t.data[i][n-1]){t.data[i][n-1]=t.data[i][n],t.data[i][n]=0;var s=t.blocks[i][n];h=t.positions[i][n-1],t.blocks[i][n-1]=s,t.blocks[i][n]=null,t.moveAction(s,h,function(){c(i,n-1,a)}),o=!0}else a();else{e[i][n-1]=1,t.data[i][n-1]*=2,t.data[i][n]=0;var r=t.blocks[i][n-1],l=t.blocks[i][n],h=t.positions[i][n-1];t.blocks[i][n]=null,t.moveAction(l,h,function(){t.mergeAction(l,r,t.data[i][n-1],a)}),o=!0}else a&&a();else a&&a()},n=0,a=0,s=[],r=1;r<4;r++)for(var l=0;l<4;l++)0!=this.data[l][r]&&(n+=1,s.push({x:l,y:r}));for(c=0;c<s.length;c++)i(l=s[c].x,r=s[c].y,function(){(a+=1)==n&&(console.log("counter: "+a+" total: "+n),t.afterMove(o))})},moveRight:function(){for(var t=this,o=!1,e=[],c=0;c<4;c++)e.push([0,0,0,0]);for(var i=function c(i,n,a){if(3!=n)if(0==t.data[i][n+1]||t.data[i][n+1]==t.data[i][n])if(t.data[i][n+1]!=t.data[i][n]||e[i][n+1])0==t.data[i][n+1]?(t.data[i][n+1]=t.data[i][n],t.data[i][n]=0,r=t.blocks[i][n],l=t.positions[i][n+1],t.blocks[i][n+1]=r,t.blocks[i][n]=null,t.moveAction(r,l,function(){c(i,n+1,a),o=!0})):a();else{e[i][n+1]=1,t.data[i][n+1]*=2,t.data[i][n]=0;var s=t.blocks[i][n+1],r=t.blocks[i][n],l=t.positions[i][n+1];t.blocks[i][n]=null,t.moveAction(r,l,function(){t.mergeAction(r,s,t.data[i][n+1],a)}),o=!0}else a&&a();else a&&a()},n=0,a=0,s=[],r=2;r>=0;r--)for(var l=0;l<4;l++)0!=this.data[l][r]&&(n+=1,s.push({x:l,y:r}));for(c=0;c<s.length;c++)i(l=s[c].x,r=s[c].y,function(){(a+=1)==n&&(console.log("counter: "+a+" total: "+n),t.afterMove(o))})},moveUp:function(){for(var t=this,o=!1,e=[],c=0;c<4;c++)e.push([0,0,0,0]);for(var i=function c(i,n,a){if(3!=i)if(0==t.data[i+1][n]||t.data[i+1][n]==t.data[i][n])if(t.data[i+1][n]!=t.data[i][n]||e[i+1][n])0==t.data[i+1][n]?(t.data[i+1][n]=t.data[i][n],t.data[i][n]=0,r=t.blocks[i][n],l=t.positions[i+1][n],t.blocks[i+1][n]=r,t.blocks[i][n]=null,t.moveAction(r,l,function(){c(i+1,n,a),o=!0})):a();else{e[i+1][n]=1,t.data[i+1][n]*=2,t.data[i][n]=0;var s=t.blocks[i+1][n],r=t.blocks[i][n],l=t.positions[i+1][n];t.blocks[i][n]=null,t.moveAction(r,l,function(){t.mergeAction(r,s,t.data[i+1][n],a)}),o=!0}else a&&a();else a&&a()},n=0,a=0,s=[],r=2;r>=0;r--)for(var l=0;l<4;l++)0!=this.data[r][l]&&(n+=1,s.push({x:r,y:l}));for(c=0;c<s.length;c++)i(r=s[c].x,l=s[c].y,function(){(a+=1)==n&&(console.log("counter: "+a+" total: "+n),t.afterMove(o))})},moveDown:function(){for(var t=this,o=!1,e=[],c=0;c<4;c++)e.push([0,0,0,0]);for(var i=function c(i,n,a){if(0!=i)if(0==t.data[i-1][n]||t.data[i-1][n]==t.data[i][n])if(t.data[i-1][n]!=t.data[i][n]||e[i-1][n])0==t.data[i-1][n]?(t.data[i-1][n]=t.data[i][n],t.data[i][n]=0,r=t.blocks[i][n],l=t.positions[i-1][n],t.blocks[i-1][n]=r,t.blocks[i][n]=null,t.moveAction(r,l,function(){c(i-1,n,a),o=!0})):a();else{e[i-1][n]=1,t.data[i-1][n]*=2,t.data[i][n]=0;var s=t.blocks[i-1][n],r=t.blocks[i][n],l=t.positions[i-1][n];t.blocks[i][n]=null,t.moveAction(r,l,function(){t.mergeAction(r,s,t.data[i-1][n],a)}),o=!0}else a&&a();else a&&a()},n=0,a=0,s=[],r=1;r<4;r++)for(var l=0;l<4;l++)0!=this.data[r][l]&&(n+=1,s.push({x:r,y:l}));for(c=0;c<s.length;c++)i(r=s[c].x,l=s[c].y,function(){(a+=1)==n&&(console.log("counter: "+a+" total: "+n),t.afterMove(o))})},updateSocreLabel:function(){this.currentScoreLabel.getComponent(cc.Label).string="\u5206\u6570: "+this.currentScore}}),cc._RF.pop()},{}],"use_v2.0.x_cc.Toggle_event":[function(t,o){"use strict";cc._RF.push(o,"e3decRi2kVJCYNsuRZlJqWr","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["use_v2.0.x_cc.Toggle_event","Game","GameOverMenu"]);